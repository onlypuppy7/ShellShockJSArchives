(()=>{var __defProp=Object.defineProperty,__getOwnPropNames=Object.getOwnPropertyNames,__require=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)((function(e){if("undefined"!=typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')})),__esm=(e,t)=>function(){return e&&(t=(0,e[__getOwnPropNames(e)[0]])(e=0)),t},__export=(e,t)=>{for(var i in t)__defProp(e,i,{get:t[i],enumerable:!0})},ShaderStore,init_shaderStore=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Engines/shaderStore.js"(){(ShaderStore=class e{static GetIncludesShadersStore(t=0){return 0===t?e.IncludesShadersStore:e.IncludesShadersStoreWGSL}static GetShadersRepository(t=0){return 0===t?e.ShadersRepository:e.ShadersRepositoryWGSL}static GetShadersStore(t=0){return 0===t?e.ShadersStore:e.ShadersStoreWGSL}}).ShadersRepository="src/Shaders/",ShaderStore.ShadersStore={},ShaderStore.IncludesShadersStore={},ShaderStore.ShadersRepositoryWGSL="src/ShadersWGSL/",ShaderStore.ShadersStoreWGSL={},ShaderStore.IncludesShadersStoreWGSL={}}}),postprocess_vertex_exports={},name,shader,postprocessVertexShader;__export(postprocess_vertex_exports,{postprocessVertexShader:()=>postprocessVertexShader});var init_postprocess_vertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/postprocess.vertex.js"(){init_shaderStore(),name="postprocessVertexShader",shader="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStore[name]=shader,postprocessVertexShader={name:name,shader:shader}}}),postprocess_vertex_exports2={},name2,shader2,postprocessVertexShaderWGSL;__export(postprocess_vertex_exports2,{postprocessVertexShaderWGSL:()=>postprocessVertexShaderWGSL});var init_postprocess_vertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/postprocess.vertex.js"(){init_shaderStore(),name2="postprocessVertexShader",shader2="attribute position: vec2<f32>;uniform scale: vec2<f32>;varying vUV: vec2<f32>;const madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvertexOutputs.vUV=(vertexInputs.position*madd+madd)*uniforms.scale;vertexOutputs.position=vec4(vertexInputs.position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}\n",ShaderStore.ShadersStoreWGSL[name2]=shader2,postprocessVertexShaderWGSL={name:name2,shader:shader2}}}),pass_fragment_exports={},name3,shader3,passPixelShader;__export(pass_fragment_exports,{passPixelShader:()=>passPixelShader});var init_pass_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/pass.fragment.js"(){init_shaderStore(),name3="passPixelShader",shader3="varying vec2 vUV;uniform sampler2D textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=texture2D(textureSampler,vUV);}",ShaderStore.ShadersStore[name3]=shader3,passPixelShader={name:name3,shader:shader3}}}),bonesDeclaration_exports={},name5,shader5,bonesDeclarationWGSL;__export(bonesDeclaration_exports,{bonesDeclarationWGSL:()=>bonesDeclarationWGSL});var init_bonesDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bonesDeclaration.js"(){init_shaderStore(),name5="bonesDeclaration",shader5="#if NUM_BONE_INFLUENCERS>0\nattribute matricesIndices : vec4<f32>;attribute matricesWeights : vec4<f32>;\n#if NUM_BONE_INFLUENCERS>4\nattribute matricesIndicesExtra : vec4<f32>;attribute matricesWeightsExtra : vec4<f32>;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nvar boneSampler : texture_2d<f32>;uniform boneTextureWidth : f32;\n#else\nuniform mBones : array<mat4x4,BonesPerMesh>;\n#ifdef BONES_VELOCITY_ENABLED\nuniform mPreviousBones : array<mat4x4,BonesPerMesh>;\n#endif\n#endif\n#ifdef BONETEXTURE\nfn readMatrixFromRawSampler(smp : texture_2d<f32>,index : f32)->mat4x4<f32>\n{let offset=i32(index) *4; \nlet m0=textureLoad(smp,vec2<i32>(offset+0,0),0);let m1=textureLoad(smp,vec2<i32>(offset+1,0),0);let m2=textureLoad(smp,vec2<i32>(offset+2,0),0);let m3=textureLoad(smp,vec2<i32>(offset+3,0),0);return mat4x4<f32>(m0,m1,m2,m3);}\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name5]=shader5,bonesDeclarationWGSL={name:name5,shader:shader5}}}),bonesVertex_exports={},name6,shader6,bonesVertexWGSL;__export(bonesVertex_exports,{bonesVertexWGSL:()=>bonesVertexWGSL});var init_bonesVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bonesVertex.js"(){init_shaderStore(),name6="bonesVertex",shader6="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nvar influence : mat4x4<f32>;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[0])*vertexInputs.matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[1])*vertexInputs.matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[2])*vertexInputs.matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[3])*vertexInputs.matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[0])*vertexInputs.matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[1])*vertexInputs.matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[2])*vertexInputs.matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[3])*vertexInputs.matricesWeightsExtra[3];\n#endif \n#else \ninfluence=uniforms.mBones[int(vertexInputs.matricesIndices[0])]*vertexInputs.matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndices[1])]*vertexInputs.matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndices[2])]*vertexInputs.matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndices[3])]*vertexInputs.matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndicesExtra[0])]*vertexInputs.matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndicesExtra[1])]*vertexInputs.matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndicesExtra[2])]*vertexInputs.matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndicesExtra[3])]*vertexInputs.matricesWeightsExtra[3];\n#endif \n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name6]=shader6,bonesVertexWGSL={name:name6,shader:shader6}}}),bonesDeclaration_exports2={},name7,shader7,bonesDeclaration;__export(bonesDeclaration_exports2,{bonesDeclaration:()=>bonesDeclaration});var init_bonesDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bonesDeclaration.js"(){init_shaderStore(),name7="bonesDeclaration",shader7="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;attribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;attribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform highp sampler2D boneSampler;uniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{float offset=index *4.0;float dx=1.0/boneTextureWidth;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));return mat4(m0,m1,m2,m3);}\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name7]=shader7,bonesDeclaration={name:name7,shader:shader7}}}),bonesVertex_exports2={},name8,shader8,bonesVertex;__export(bonesVertex_exports2,{bonesVertex:()=>bonesVertex});var init_bonesVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bonesVertex.js"(){init_shaderStore(),name8="bonesVertex",shader8="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name8]=shader8,bonesVertex={name:name8,shader:shader8}}}),lightFragment_exports={},name9,shader9,lightFragmentWGSL;__export(lightFragment_exports,{lightFragmentWGSL:()=>lightFragmentWGSL});var init_lightFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightFragment.js"(){init_shaderStore(),name9="lightFragment",shader9="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,input.vPositionW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,input.vPositionW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);info.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightTexture{X},projectionLightTexture{X}Sampler,uniforms.textureProjectionMatrix{X},input.vPositionW);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSMDEBUG{X} \nvar shadowDebug{X}: vec3f;\n#endif\n#ifdef SHADOWCSM{X}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nvar index{X}: i32=-1;\n#else\nvar index{X}: i32=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nvar diff{X}: f32=0.;vPositionFromLight{X}[0]=fragmentInputs.vPositionFromLight{X}_0;vPositionFromLight{X}[1]=fragmentInputs.vPositionFromLight{X}_1;vPositionFromLight{X}[2]=fragmentInputs.vPositionFromLight{X}_2;vPositionFromLight{X}[3]=fragmentInputs.vPositionFromLight{X}_3;vDepthMetric{X}[0]=fragmentInputs.vDepthMetric{X}_0;vDepthMetric{X}[1]=fragmentInputs.vDepthMetric{X}_1;vDepthMetric{X}[2]=fragmentInputs.vDepthMetric{X}_2;vDepthMetric{X}[3]=fragmentInputs.vDepthMetric{X}_3;for (var i:i32=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=uniforms.viewFrustumZ{X}[i]+fragmentInputs.vPositionFromCamera{X}.z;\n#else\ndiff{X}=uniforms.viewFrustumZ{X}[i]-fragmentInputs.vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {index{X}=i;break;}}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3f(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nvar frustumLength:f32=uniforms.frustumLengths{X}[index{X}];var diffRatio:f32=clamp(diff{X}/frustumLength,0.,1.)*uniforms.cascadeBlendFactor{X};if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{index{X}+=1;var nextShadow: f32=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],,shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(input.vPositionW,light{X}.vLightData.xyz,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(input.vPositionW,light{X}.vLightData.xyz,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(input.vPositionW,light{X}.vLightData.xyz,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(input.vPositionW,light{X}.vLightData.xyz,shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;shadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\naggShadow+=shadow;numLights+=1.0;\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name9]=shader9,lightFragmentWGSL={name:name9,shader:shader9}}}),lightUboDeclaration_exports={},name10,shader10,lightUboDeclarationWGSL;__export(lightUboDeclaration_exports,{lightUboDeclarationWGSL:()=>lightUboDeclarationWGSL});var init_lightUboDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightUboDeclaration.js"(){init_shaderStore(),name10="lightUboDeclaration",shader10="#ifdef LIGHT{X}\nstruct Light{X}\n{vLightData: vec4f,\nvLightDiffuse: vec4f,\nvLightSpecular: vec4f,\n#ifdef SPOTLIGHT{X}\nvLightDirection: vec4f,\nvLightFalloff: vec4f,\n#elif defined(POINTLIGHT{X})\nvLightFalloff: vec4f,\n#elif defined(HEMILIGHT{X})\nvLightGround: vec3f,\n#endif\nshadowsInfo: vec4f,\ndepthValues: vec2f} ;var<uniform> light{X} : Light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform textureProjectionMatrix{X}: mat4x4f;var projectionLightTexture{X}Sampler: sampler;var projectionLightTexture{X}: texture_2d<f32>;\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform lightMatrix{X}: array<mat4x4f,SHADOWCSMNUM_CASCADES{X}>;uniform viewFrustumZ{X}: array<f32,SHADOWCSMNUM_CASCADES{X}>;uniform frustumLengths{X}: array<f32,SHADOWCSMNUM_CASCADES{X}>;uniform cascadeBlendFactor{X}: f32;varying vPositionFromLight{X}_0: vec4f;varying vDepthMetric{X}_0: f32;varying vPositionFromLight{X}_1: vec4f;varying vDepthMetric{X}_1: f32;varying vPositionFromLight{X}_2: vec4f;varying vDepthMetric{X}_2: f32;varying vPositionFromLight{X}_3: vec4f;varying vDepthMetric{X}_3: f32;varying vPositionFromCamera{X}: vec4f;var<private> vPositionFromLight{X}: array<vec4f,4>;var<private> vDepthMetric{X} : array<f32,4>;\n#if defined(SHADOWPCSS{X})\nvar shadowTexture{X}Sampler: sampler_comparison; \nvar shadowTexture{X}: texture_depth_2d_array;var depthTexture{X}Sampler: sampler;var depthTexture{X}: texture_2d_array<f32>;uniform lightSizeUVCorrection{X}: array<vec2f,SHADOWCSMNUM_CASCADES{X}>;uniform depthCorrection{X}: array<f32,SHADOWCSMNUM_CASCADES{X}>;uniform penumbraDarkness{X}: f32;\n#elif defined(SHADOWPCF{X})\nvar shadowTexture{X}Sampler: sampler_comparison;var shadowTexture{X}: texture_depth_2d_array;\n#else \nvar shadowTexture{X}Sampler: sampler; \nvar shadowTexture{X}: texture_2d_array<f32>;\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vCascadeColorsMultiplier{X}: array<vec3f,8>=array<vec3f,8>\n(\nvec3f ( 1.5,0.0,0.0 ),\nvec3f ( 0.0,1.5,0.0 ),\nvec3f ( 0.0,0.0,5.5 ),\nvec3f ( 1.5,0.0,5.5 ),\nvec3f ( 1.5,1.5,0.0 ),\nvec3f ( 1.0,1.0,1.0 ),\nvec3f ( 0.0,1.0,5.5 ),\nvec3f ( 0.5,3.5,0.75 )\n);\n#endif\n#elif defined(SHADOWCUBE{X})\nvar shadowTexture{X}Sampler: sampler;var shadowTexture{X}: texture_cube<f32>;\n#else\nvarying vPositionFromLight{X}: vec4f;varying vDepthMetric{X}: f32;\n#if defined(SHADOWPCSS{X})\nvar shadowTexture{X}Sampler: sampler_comparison; \nvar shadowTexture{X}: texture_depth_2d;var depthTexture{X}Sampler: sampler; \nvar depthTexture{X}: texture_2d<f32>;\n#elif defined(SHADOWPCF{X})\nvar shadowTexture{X}Sampler: sampler_comparison;var shadowTexture{X}: texture_depth_2d;\n#else\nvar shadowTexture{X}Sampler: sampler; \nvar shadowTexture{X}: texture_2d<f32>;\n#endif\nuniform lightMatrix{X}: mat4x4f;\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name10]=shader10,lightUboDeclarationWGSL={name:name10,shader:shader10}}}),lightVxUboDeclaration_exports={},name11,shader11,lightVxUboDeclarationWGSL;__export(lightVxUboDeclaration_exports,{lightVxUboDeclarationWGSL:()=>lightVxUboDeclarationWGSL});var init_lightVxUboDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightVxUboDeclaration.js"(){init_shaderStore(),name11="lightVxUboDeclaration",shader11="#ifdef LIGHT{X}\nstruct Light{X}\n{vLightData: vec4f,\nvLightDiffuse: vec4f,\nvLightSpecular: vec4f,\n#ifdef SPOTLIGHT{X}\nvLightDirection: vec4f,\nvLightFalloff: vec4f,\n#elif defined(POINTLIGHT{X})\nvLightFalloff: vec4f,\n#elif defined(HEMILIGHT{X})\nvLightGround: vec3f,\n#endif\nshadowsInfo: vec4f,\ndepthValues: vec2f} ;var<uniform> light{X} : Light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform lightMatrix{X}: array<mat4x4f,SHADOWCSMNUM_CASCADES{X}>;varying vPositionFromLight{X}_0: vec4f;varying vDepthMetric{X}_0: f32;varying vPositionFromLight{X}_1: vec4f;varying vDepthMetric{X}_1: f32;varying vPositionFromLight{X}_2: vec4f;varying vDepthMetric{X}_2: f32;varying vPositionFromLight{X}_3: vec4f;varying vDepthMetric{X}_3: f32;varying vPositionFromCamera{X}: vec4f;\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vPositionFromLight{X}: vec4f;varying vDepthMetric{X}: f32;uniform lightMatrix{X}: mat4x4f;\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name11]=shader11,lightVxUboDeclarationWGSL={name:name11,shader:shader11}}}),helperFunctions_exports={},name12,shader12,helperFunctionsWGSL;__export(helperFunctions_exports,{helperFunctionsWGSL:()=>helperFunctionsWGSL});var init_helperFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/helperFunctions.js"(){init_shaderStore(),name12="helperFunctions",shader12="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n",ShaderStore.IncludesShadersStoreWGSL[name12]=shader12,helperFunctionsWGSL={name:name12,shader:shader12}}}),lightsFragmentFunctions_exports={},name13,shader13,lightsFragmentFunctionsWGSL;__export(lightsFragmentFunctions_exports,{lightsFragmentFunctionsWGSL:()=>lightsFragmentFunctionsWGSL});var init_lightsFragmentFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightsFragmentFunctions.js"(){init_shaderStore(),name13="lightsFragmentFunctions",shader13="struct lightingInfo\n{diffuse: vec3f,\n#ifdef SPECULARTERM\nspecular: vec3f,\n#endif\n#ifdef NDOTL\nndl: f32,\n#endif\n};fn computeLighting(viewDirectionW: vec3f,vNormal: vec3f,lightData: vec4f,diffuseColor: vec3f,specularColor: vec3f,range: f32,glossiness: f32)->lightingInfo {var result: lightingInfo;var lightVectorW: vec3f;var attenuation: f32=1.0;if (lightData.w==0.)\n{var direction: vec3f=lightData.xyz-fragmentInputs.vPositionW;var attenuation: f32=max(0.,1.0-length(direction)/range);lightVectorW=normalize(direction);}\nelse\n{lightVectorW=normalize(-lightData.xyz);}\nvar ndl: f32=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvar angleW: vec3f=normalize(viewDirectionW+lightVectorW);var specComp: f32=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nfn computeSpotLighting(viewDirectionW: vec3f,vNormal: vec3f ,lightData: vec4f,lightDirection: vec4f,diffuseColor: vec3f,specularColor: vec3f,range: f32,glossiness: f32)->lightingInfo {var result: lightingInfo;var direction: vec3f=lightData.xyz-fragmentInputs.vPositionW;var lightVectorW: vec3f=normalize(direction);var attenuation: f32=max(0.,1.0-length(direction)/range);var cosAngle: f32=max(0.,dot(lightDirection.xyz,-lightVectorW));if (cosAngle>=lightDirection.w)\n{cosAngle=max(0.,pow(cosAngle,lightData.w));attenuation*=cosAngle;var ndl: f32=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvar angleW: vec3f=normalize(viewDirectionW+lightVectorW);var specComp: f32=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nresult.diffuse=vec3f(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3f(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;}\nfn computeHemisphericLighting(viewDirectionW: vec3f,vNormal: vec3f,lightData: vec4f,diffuseColor: vec3f,specularColor: vec3f,groundColor: vec3f,glossiness: f32)->lightingInfo {var result: lightingInfo;var ndl: f32=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvar angleW: vec3f=normalize(viewDirectionW+lightData.xyz);var specComp: f32=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor;\n#endif\nreturn result;}\nfn computeProjectionTextureDiffuseLighting(projectionLightTexture: texture_2d<f32>,projectionLightSampler: sampler,textureProjectionMatrix: mat4x4f,posW: vec3f)->vec3f {var strq: vec4f=textureProjectionMatrix*vec4f(posW,1.0);strq/=strq.w;var textureColor: vec3f=textureSample(projectionLightTexture,projectionLightSampler,strq.xy).rgb;return textureColor;}",ShaderStore.IncludesShadersStoreWGSL[name13]=shader13,lightsFragmentFunctionsWGSL={name:name13,shader:shader13}}}),shadowsFragmentFunctions_exports={},name14,shader14,shadowsFragmentFunctionsWGSL;__export(shadowsFragmentFunctions_exports,{shadowsFragmentFunctionsWGSL:()=>shadowsFragmentFunctionsWGSL});var init_shadowsFragmentFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowsFragmentFunctions.js"(){init_shaderStore(),name14="shadowsFragmentFunctions",shader14="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfn unpack(color: vec4f)->f32\n{const bit_shift: vec4f= vec4f(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}\n#endif\nfn computeFallOff(value: f32,clipSpace: vec2f,frustumEdgeFalloff: f32)->f32\n{var mask: f32=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));return mix(value,1.0,mask);}\nfn computeShadowCube(worldPos: vec3f,lightPosition: vec3f,shadowTexture: texture_cube<f32>,shadowSampler: sampler,darkness: f32,depthValues: vec2f)->f32\n{var directionToLight: vec3f=worldPos-lightPosition;var depth: f32=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nvar shadow: f32=unpack(textureSample(shadowTexture,shadowSampler,directionToLight));\n#else\nvar shadow: f32=textureSample(shadowTexture,shadowSampler,directionToLight).x;\n#endif\nreturn select(darkness,1.0,depth>shadow);}\nfn computeShadowWithPoissonSamplingCube(worldPos: vec3f,lightPosition: vec3f,shadowTexture: texture_cube<f32>,shadowSampler: sampler,mapSize: f32,darkness: f32,depthValues: vec2f)->f32\n{var directionToLight: vec3f=worldPos-lightPosition;var depth: f32=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;var visibility: f32=1.;var poissonDisk: array<vec3f,4>;poissonDisk[0]= vec3f(-1.0,1.0,-1.0);poissonDisk[1]= vec3f(1.0,-1.0,-1.0);poissonDisk[2]= vec3f(-1.0,-1.0,-1.0);poissonDisk[3]= vec3f(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) {visibility-=0.25;};if (unpack(textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) {visibility-=0.25;};if (unpack(textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) {visibility-=0.25;};if (unpack(textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) {visibility-=0.25;};\n#else\nif (textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) {visibility-=0.25;};if (textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) {visibility-=0.25;};if (textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) {visibility-=0.25;};if (textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) {visibility-=0.25;};\n#endif\nreturn min(1.0,visibility+darkness);}\nfn computeShadowWithESMCube(worldPos: vec3f,lightPosition: vec3f,shadowTexture: texture_cube<f32>,shadowSampler: sampler,darkness: f32,depthScale: f32,depthValues: vec2f)->f32\n{var directionToLight: vec3f=worldPos-lightPosition;var depth: f32=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);var shadowPixelDepth: f32=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nvar shadowMapSample: f32=unpack(textureSample(shadowTexture,shadowSampler,directionToLight));\n#else\nvar shadowMapSample: f32=textureSample(shadowTexture,shadowSampler,directionToLight).x;\n#endif\nvar esm: f32=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return esm;}\nfn computeShadowWithCloseESMCube(worldPos: vec3f,lightPosition: vec3f,shadowTexture: texture_cube<f32>,shadowSampler: sampler,darkness: f32,depthScale: f32,depthValues: vec2f)->f32\n{var directionToLight: vec3f=worldPos-lightPosition;var depth: f32=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);var shadowPixelDepth: f32=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nvar shadowMapSample: f32=unpack(textureSample(shadowTexture,shadowSampler,directionToLight));\n#else\nvar shadowMapSample: f32=textureSample(shadowTexture,shadowSampler,directionToLight).x;\n#endif\nvar esm: f32=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return esm;}\nfn computeShadowCSM(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d_array<f32>,shadowSampler: sampler,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nvar shadow: f32=unpack(textureSample(shadowTexture,shadowSampler,uv,layer));\n#else\nvar shadow: f32=textureSample(shadowTexture,shadowSampler,uv,layer).x;\n#endif\nreturn select(1.,computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff),shadowPixelDepth>shadow );}\nfn computeShadow(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d<f32>,shadowSampler: sampler,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nvar shadow: f32=unpack(textureSampleLevel(shadowTexture,shadowSampler,uv,0.));\n#else\nvar shadow: f32=textureSampleLevel(shadowTexture,shadowSampler,uv,0.).x;\n#endif\nreturn select(1.,computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff),shadowPixelDepth>shadow );}}\nfn computeShadowWithPoissonSampling(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d<f32>,shadowSampler: sampler,mapSize: f32,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0);var visibility: f32=1.;var poissonDisk: array<vec2f,4>;poissonDisk[0]= vec2f(-0.94201624,-0.39906216);poissonDisk[1]= vec2f(0.94558609,-0.76890725);poissonDisk[2]= vec2f(-0.094184101,-0.92938870);poissonDisk[3]= vec2f(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[0]*mapSize,0.))<shadowPixelDepth) {visibility-=0.25;}\nif (unpack(textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[1]*mapSize,0.))<shadowPixelDepth) {visibility-=0.25;}\nif (unpack(textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[2]*mapSize,0.))<shadowPixelDepth) {visibility-=0.25;}\nif (unpack(textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[3]*mapSize,0.))<shadowPixelDepth) {visibility-=0.25;}\n#else\nif (textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[0]*mapSize,0.).x<shadowPixelDepth) {visibility-=0.25;}\nif (textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[1]*mapSize,0.).x<shadowPixelDepth) {visibility-=0.25;}\nif (textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[2]*mapSize,0.).x<shadowPixelDepth) {visibility-=0.25;}\nif (textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[3]*mapSize,0.).x<shadowPixelDepth) {visibility-=0.25;}\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);}}\nfn computeShadowWithESM(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d<f32>,shadowSampler: sampler,darkness: f32,depthScale: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nvar shadowMapSample: f32=unpack(textureSampleLevel(shadowTexture,shadowSampler,uv,0.));\n#else\nvar shadowMapSample: f32=textureSampleLevel(shadowTexture,shadowSampler,uv,0.).x;\n#endif\nvar esm: f32=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\nfn computeShadowWithCloseESM(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d<f32>,shadowSampler: sampler,darkness: f32,depthScale: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nvar shadowMapSample: f32=unpack(textureSampleLevel(shadowTexture,shadowSampler,uv,0.));\n#else\nvar shadowMapSample: f32=textureSampleLevel(shadowTexture,shadowSampler,uv,0.).x;\n#endif\nvar esm: f32=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\nfn getZInClip(clipSpace: vec3f,uvDepth: vec3f)->f32\n{\n#ifdef IS_NDC_HALF_ZRANGE\nreturn clipSpace.z;\n#else\nreturn uvDepth.z;\n#endif\n}\nconst GREATEST_LESS_THAN_ONE: f32=0.99999994;\n#define DISABLE_UNIFORMITY_ANALYSIS\nfn computeShadowWithCSMPCF1(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=clamp(getZInClip(clipSpace,uvDepth),0.,GREATEST_LESS_THAN_ONE);var shadow: f32=textureSampleCompare(shadowTexture,shadowSampler,uvDepth.xy,layer,uvDepth.z);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\nfn computeShadowWithCSMPCF3(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeAndInverse: vec2f,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=clamp(getZInClip(clipSpace,uvDepth),0.,GREATEST_LESS_THAN_ONE);var uv: vec2f=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvar st: vec2f=fract(uv); \nvar base_uv: vec2f=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvar uvw0: vec2f=3.-2.*st;var uvw1: vec2f=1.+2.*st;var u: vec2f= vec2f((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;var v: vec2f= vec2f((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;var shadow: f32=0.;shadow+=uvw0.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[0]),layer,uvDepth.z);shadow+=uvw1.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[0]),layer,uvDepth.z);shadow+=uvw0.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[1]),layer,uvDepth.z);shadow+=uvw1.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[1]),layer,uvDepth.z);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\nfn computeShadowWithCSMPCF5(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeAndInverse: vec2f,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=clamp(getZInClip(clipSpace,uvDepth),0.,GREATEST_LESS_THAN_ONE);var uv: vec2f=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvar st: vec2f=fract(uv); \nvar base_uv: vec2f=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvar uvw0: vec2f=4.-3.*st;var uvw1: vec2f= vec2f(7.);var uvw2: vec2f=1.+3.*st;var u: vec3f= vec3f((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;var v: vec3f= vec3f((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;var shadow: f32=0.;shadow+=uvw0.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[0]),layer,uvDepth.z);shadow+=uvw1.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[0]),layer,uvDepth.z);shadow+=uvw2.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[0]),layer,uvDepth.z);shadow+=uvw0.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[1]),layer,uvDepth.z);shadow+=uvw1.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[1]),layer,uvDepth.z);shadow+=uvw2.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[1]),layer,uvDepth.z);shadow+=uvw0.x*uvw2.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[2]),layer,uvDepth.z);shadow+=uvw1.x*uvw2.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[2]),layer,uvDepth.z);shadow+=uvw2.x*uvw2.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[2]),layer,uvDepth.z);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\nfn computeShadowWithPCF1(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,darkness: f32,frustumEdgeFalloff: f32)->f32\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=getZInClip(clipSpace,uvDepth);var shadow: f32=textureSampleCompareLevel(shadowTexture,shadowSampler,uvDepth.xy,uvDepth.z);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nfn computeShadowWithPCF3(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeAndInverse: vec2f,darkness: f32,frustumEdgeFalloff: f32)->f32\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=getZInClip(clipSpace,uvDepth);var uv: vec2f=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvar st: vec2f=fract(uv); \nvar base_uv: vec2f=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvar uvw0: vec2f=3.-2.*st;var uvw1: vec2f=1.+2.*st;var u: vec2f= vec2f((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;var v: vec2f= vec2f((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;var shadow: f32=0.;shadow+=uvw0.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[0]),uvDepth.z);shadow+=uvw1.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[0]),uvDepth.z);shadow+=uvw0.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[1]),uvDepth.z);shadow+=uvw1.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[1]),uvDepth.z);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nfn computeShadowWithPCF5(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeAndInverse: vec2f,darkness: f32,frustumEdgeFalloff: f32)->f32\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=getZInClip(clipSpace,uvDepth);var uv: vec2f=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvar st: vec2f=fract(uv); \nvar base_uv: vec2f=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvar uvw0: vec2f=4.-3.*st;var uvw1: vec2f= vec2f(7.);var uvw2: vec2f=1.+3.*st;var u: vec3f= vec3f((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;var v: vec3f= vec3f((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;var shadow: f32=0.;shadow+=uvw0.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[0]),uvDepth.z);shadow+=uvw1.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[0]),uvDepth.z);shadow+=uvw2.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[0]),uvDepth.z);shadow+=uvw0.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[1]),uvDepth.z);shadow+=uvw1.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[1]),uvDepth.z);shadow+=uvw2.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[1]),uvDepth.z);shadow+=uvw0.x*uvw2.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[2]),uvDepth.z);shadow+=uvw1.x*uvw2.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[2]),uvDepth.z);shadow+=uvw2.x*uvw2.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[2]),uvDepth.z);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nconst PoissonSamplers32: array<vec3f,64>=array<vec3f,64> (\nvec3f(0.06407013,0.05409927,0.),\nvec3f(0.7366577,0.5789394,0.),\nvec3f(-0.6270542,-0.5320278,0.),\nvec3f(-0.4096107,0.8411095,0.),\nvec3f(0.6849564,-0.4990818,0.),\nvec3f(-0.874181,-0.04579735,0.),\nvec3f(0.9989998,0.0009880066,0.),\nvec3f(-0.004920578,-0.9151649,0.),\nvec3f(0.1805763,0.9747483,0.),\nvec3f(-0.2138451,0.2635818,0.),\nvec3f(0.109845,0.3884785,0.),\nvec3f(0.06876755,-0.3581074,0.),\nvec3f(0.374073,-0.7661266,0.),\nvec3f(0.3079132,-0.1216763,0.),\nvec3f(-0.3794335,-0.8271583,0.),\nvec3f(-0.203878,-0.07715034,0.),\nvec3f(0.5912697,0.1469799,0.),\nvec3f(-0.88069,0.3031784,0.),\nvec3f(0.5040108,0.8283722,0.),\nvec3f(-0.5844124,0.5494877,0.),\nvec3f(0.6017799,-0.1726654,0.),\nvec3f(-0.5554981,0.1559997,0.),\nvec3f(-0.3016369,-0.3900928,0.),\nvec3f(-0.5550632,-0.1723762,0.),\nvec3f(0.925029,0.2995041,0.),\nvec3f(-0.2473137,0.5538505,0.),\nvec3f(0.9183037,-0.2862392,0.),\nvec3f(0.2469421,0.6718712,0.),\nvec3f(0.3916397,-0.4328209,0.),\nvec3f(-0.03576927,-0.6220032,0.),\nvec3f(-0.04661255,0.7995201,0.),\nvec3f(0.4402924,0.3640312,0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.)\n);const PoissonSamplers64: array<vec3f,64>=array<vec3f,64> (\nvec3f(-0.613392,0.617481,0.),\nvec3f(0.170019,-0.040254,0.),\nvec3f(-0.299417,0.791925,0.),\nvec3f(0.645680,0.493210,0.),\nvec3f(-0.651784,0.717887,0.),\nvec3f(0.421003,0.027070,0.),\nvec3f(-0.817194,-0.271096,0.),\nvec3f(-0.705374,-0.668203,0.),\nvec3f(0.977050,-0.108615,0.),\nvec3f(0.063326,0.142369,0.),\nvec3f(0.203528,0.214331,0.),\nvec3f(-0.667531,0.326090,0.),\nvec3f(-0.098422,-0.295755,0.),\nvec3f(-0.885922,0.215369,0.),\nvec3f(0.566637,0.605213,0.),\nvec3f(0.039766,-0.396100,0.),\nvec3f(0.751946,0.453352,0.),\nvec3f(0.078707,-0.715323,0.),\nvec3f(-0.075838,-0.529344,0.),\nvec3f(0.724479,-0.580798,0.),\nvec3f(0.222999,-0.215125,0.),\nvec3f(-0.467574,-0.405438,0.),\nvec3f(-0.248268,-0.814753,0.),\nvec3f(0.354411,-0.887570,0.),\nvec3f(0.175817,0.382366,0.),\nvec3f(0.487472,-0.063082,0.),\nvec3f(-0.084078,0.898312,0.),\nvec3f(0.488876,-0.783441,0.),\nvec3f(0.470016,0.217933,0.),\nvec3f(-0.696890,-0.549791,0.),\nvec3f(-0.149693,0.605762,0.),\nvec3f(0.034211,0.979980,0.),\nvec3f(0.503098,-0.308878,0.),\nvec3f(-0.016205,-0.872921,0.),\nvec3f(0.385784,-0.393902,0.),\nvec3f(-0.146886,-0.859249,0.),\nvec3f(0.643361,0.164098,0.),\nvec3f(0.634388,-0.049471,0.),\nvec3f(-0.688894,0.007843,0.),\nvec3f(0.464034,-0.188818,0.),\nvec3f(-0.440840,0.137486,0.),\nvec3f(0.364483,0.511704,0.),\nvec3f(0.034028,0.325968,0.),\nvec3f(0.099094,-0.308023,0.),\nvec3f(0.693960,-0.366253,0.),\nvec3f(0.678884,-0.204688,0.),\nvec3f(0.001801,0.780328,0.),\nvec3f(0.145177,-0.898984,0.),\nvec3f(0.062655,-0.611866,0.),\nvec3f(0.315226,-0.604297,0.),\nvec3f(-0.780145,0.486251,0.),\nvec3f(-0.371868,0.882138,0.),\nvec3f(0.200476,0.494430,0.),\nvec3f(-0.494552,-0.711051,0.),\nvec3f(0.612476,0.705252,0.),\nvec3f(-0.578845,-0.768792,0.),\nvec3f(-0.772454,-0.090976,0.),\nvec3f(0.504440,0.372295,0.),\nvec3f(0.155736,0.065157,0.),\nvec3f(0.391522,0.849605,0.),\nvec3f(-0.620106,-0.328104,0.),\nvec3f(0.789239,-0.419965,0.),\nvec3f(-0.545396,0.538133,0.),\nvec3f(-0.178564,-0.596057,0.)\n);fn computeShadowWithCSMPCSS(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d_array<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,searchTapCount: i32,pcfTapCount: i32,poissonSamplers: array<vec3f,64>,lightSizeUVCorrection: vec2f,depthCorrection: f32,penumbraDarkness: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=clamp(getZInClip(clipSpace,uvDepth),0.,GREATEST_LESS_THAN_ONE);var uvDepthLayer: vec4f= vec4f(uvDepth.x,uvDepth.y,f32(layer),uvDepth.z);var blockerDepth: f32=0.0;var sumBlockerDepth: f32=0.0;var numBlocker: f32=0.0;for (var i: i32=0; i<searchTapCount; i ++) {blockerDepth=textureSample(depthTexture,depthSampler, uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer).r;numBlocker+=select(0.,1.,blockerDepth<depthMetric);sumBlockerDepth+=select(0.,blockerDepth,blockerDepth<depthMetric);}\nvar avgBlockerDepth: f32=sumBlockerDepth/numBlocker;var AAOffset: f32=shadowMapSizeInverse*10.;var penumbraRatio: f32=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);var filterRadius: vec4f= vec4f(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);var random: f32=getRand(vPositionFromLight.xy);var rotationAngle: f32=random*3.1415926;var rotationVector: vec2f= vec2f(cos(rotationAngle),sin(rotationAngle));var shadow: f32=0.;for (var i: i32=0; i<pcfTapCount; i++) {var offset: vec4f= vec4f(poissonSamplers[i],0.);offset= vec4f(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);let coords=uvDepthLayer+offset*filterRadius;shadow+=textureSampleCompare(shadowTexture,shadowSampler,coords.xy,i32(coords.z),coords.w);}\nshadow/= f32(pcfTapCount);shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));shadow=mix(darkness,1.,shadow);return select(computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff),1.0,numBlocker<1.0);}\nfn computeShadowWithPCSS(vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,searchTapCount: i32,pcfTapCount: i32,poissonSamplers: array<vec3f,64>)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=getZInClip(clipSpace,uvDepth);var blockerDepth: f32=0.0;var sumBlockerDepth: f32=0.0;var numBlocker: f32=0.0;var exitCondition: bool=depthMetric>1.0 || depthMetric<0.0;for (var i: i32=0; i<searchTapCount; i ++) {if (exitCondition) {break;}\nblockerDepth=textureSampleLevel(depthTexture,depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy),0).r;numBlocker+=select(0.,1.,blockerDepth<depthMetric);sumBlockerDepth+=select(0.,blockerDepth,blockerDepth<depthMetric);}\nexitCondition=exitCondition || numBlocker<1.0;var avgBlockerDepth: f32=sumBlockerDepth/numBlocker;var AAOffset: f32=shadowMapSizeInverse*10.;var penumbraRatio: f32=((depthMetric-avgBlockerDepth)+AAOffset);var filterRadius: f32=penumbraRatio*lightSizeUV*shadowMapSizeInverse;var random: f32=getRand(vPositionFromLight.xy);var rotationAngle: f32=random*3.1415926;var rotationVector: vec2f= vec2f(cos(rotationAngle),sin(rotationAngle));var shadow: f32=0.;for (var i: i32=0; i<pcfTapCount; i++) {if (exitCondition) {break;}\nvar offset: vec3f=poissonSamplers[i];offset= vec3f(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);let coords=uvDepth+offset*filterRadius;shadow+=textureSampleCompareLevel(shadowTexture,shadowSampler,coords.xy,coords.z);}\nshadow/= f32(pcfTapCount);shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);shadow=mix(darkness,1.,shadow);return select(computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff),1.0,exitCondition);}\nfn computeShadowWithPCSS16(vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32)->f32\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);}\nfn computeShadowWithPCSS32(vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32)->f32\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);}\nfn computeShadowWithPCSS64(vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32)->f32\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);}\nfn computeShadowWithCSMPCSS16(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d_array<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,lightSizeUVCorrection: vec2f,depthCorrection: f32,penumbraDarkness: f32)->f32\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\nfn computeShadowWithCSMPCSS32(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d_array<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,lightSizeUVCorrection: vec2f,depthCorrection: f32,penumbraDarkness: f32)->f32\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\nfn computeShadowWithCSMPCSS64(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d_array<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,lightSizeUVCorrection: vec2f,depthCorrection: f32,penumbraDarkness: f32)->f32\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name14]=shader14,shadowsFragmentFunctionsWGSL={name:name14,shader:shader14}}}),shadowsVertex_exports={},name15,shader15,shadowsVertexWGSL;__export(shadowsVertex_exports,{shadowsVertexWGSL:()=>shadowsVertexWGSL});var init_shadowsVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowsVertex.js"(){init_shaderStore(),name15="shadowsVertex",shader15="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvertexOutputs.vPositionFromCamera{X}=scene.view*worldPos;\n#if SHADOWCSMNUM_CASCADES{X}>0\nvertexOutputs.vPositionFromLight{X}_0=uniforms.lightMatrix{X}[0]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}_0=(-vertexOutputs.vPositionFromLight{X}_0.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}_0= (vertexOutputs.vPositionFromLight{X}_0.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#if SHADOWCSMNUM_CASCADES{X}>1\nvertexOutputs.vPositionFromLight{X}_1=uniforms.lightMatrix{X}[1]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}_1=(-vertexOutputs.vPositionFromLight{X}_1.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}_1= (vertexOutputs.vPositionFromLight{X}_1.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif \n#if SHADOWCSMNUM_CASCADES{X}>2\nvertexOutputs.vPositionFromLight{X}_2=uniforms.lightMatrix{X}[2]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}_2=(-vertexOutputs.vPositionFromLight{X}_2.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}_2= (vertexOutputs.vPositionFromLight{X}_2.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif \n#if SHADOWCSMNUM_CASCADES{X}>3\nvertexOutputs.vPositionFromLight{X}_3=uniforms.lightMatrix{X}[3]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}_3=(-vertexOutputs.vPositionFromLight{X}_3.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}_3= (vertexOutputs.vPositionFromLight{X}_3.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif \n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvertexOutputs.vPositionFromLight{X}=uniforms.lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}=(-vertexOutputs.vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}=(vertexOutputs.vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name15]=shader15,shadowsVertexWGSL={name:name15,shader:shader15}}}),lightFragmentDeclaration_exports={},name16,shader16,lightFragmentDeclaration;__export(lightFragmentDeclaration_exports,{lightFragmentDeclaration:()=>lightFragmentDeclaration});var init_lightFragmentDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/lightFragmentDeclaration.js"(){init_shaderStore(),name16="lightFragmentDeclaration",shader16="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};uniform highp sampler2DArray depthTexture{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};\n#else\nuniform highp sampler2DArray shadowTexture{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);vec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowTexture{X};\n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowTexture{X};uniform highp sampler2D depthTexture{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowTexture{X};\n#else\nuniform sampler2D shadowTexture{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightTexture{X};\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name16]=shader16,lightFragmentDeclaration={name:name16,shader:shader16}}}),lightFragment_exports2={},name17,shader17,lightFragment;__export(lightFragment_exports2,{lightFragment:()=>lightFragment});var init_lightFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/lightFragment.js"(){init_shaderStore(),name17="lightFragment",shader17="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,vPositionW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,vPositionW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);info.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightTexture{X},textureProjectionMatrix{X},vPositionW);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {index{X}=i;break;}}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{index{X}+=1;float nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;shadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\naggShadow+=shadow;numLights+=1.0;\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name17]=shader17,lightFragment={name:name17,shader:shader17}}}),lightUboDeclaration_exports2={},name18,shader18,lightUboDeclaration;__export(lightUboDeclaration_exports2,{lightUboDeclaration:()=>lightUboDeclaration});var init_lightUboDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/lightUboDeclaration.js"(){init_shaderStore(),name18="lightUboDeclaration",shader18="#ifdef LIGHT{X}\nuniform Light{X}\n{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;vec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;vec2 depthValues;} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightTexture{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};uniform highp sampler2DArray depthTexture{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};\n#else\nuniform highp sampler2DArray shadowTexture{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);vec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowTexture{X}; \n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowTexture{X};uniform highp sampler2D depthTexture{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowTexture{X};\n#else\nuniform sampler2D shadowTexture{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name18]=shader18,lightUboDeclaration={name:name18,shader:shader18}}}),lightVxUboDeclaration_exports2={},name19,shader19,lightVxUboDeclaration;__export(lightVxUboDeclaration_exports2,{lightVxUboDeclaration:()=>lightVxUboDeclaration});var init_lightVxUboDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/lightVxUboDeclaration.js"(){init_shaderStore(),name19="lightVxUboDeclaration",shader19="#ifdef LIGHT{X}\nuniform Light{X}\n{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;vec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;vec2 depthValues;} light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};uniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name19]=shader19,lightVxUboDeclaration={name:name19,shader:shader19}}}),lightVxFragmentDeclaration_exports={},name20,shader20,lightVxFragmentDeclaration;__export(lightVxFragmentDeclaration_exports,{lightVxFragmentDeclaration:()=>lightVxFragmentDeclaration});var init_lightVxFragmentDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/lightVxFragmentDeclaration.js"(){init_shaderStore(),name20="lightVxFragmentDeclaration",shader20="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};uniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name20]=shader20,lightVxFragmentDeclaration={name:name20,shader:shader20}}}),helperFunctions_exports2={},name21,shader21,helperFunctions;__export(helperFunctions_exports2,{helperFunctions:()=>helperFunctions});var init_helperFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/helperFunctions.js"(){init_shaderStore(),name21="helperFunctions",shader21="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n",ShaderStore.IncludesShadersStore[name21]=shader21,helperFunctions={name:name21,shader:shader21}}}),lightsFragmentFunctions_exports2={},name22,shader22,lightsFragmentFunctions;__export(lightsFragmentFunctions_exports2,{lightsFragmentFunctions:()=>lightsFragmentFunctions});var init_lightsFragmentFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/lightsFragmentFunctions.js"(){init_shaderStore(),name22="lightsFragmentFunctions",shader22="struct lightingInfo\n{vec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 lightVectorW;float attenuation=1.0;if (lightData.w==0.)\n{vec3 direction=lightData.xyz-vPositionW;attenuation=max(0.,1.0-length(direction)/range);lightVectorW=normalize(direction);}\nelse\n{lightVectorW=normalize(-lightData.xyz);}\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 direction=lightData.xyz-vPositionW;vec3 lightVectorW=normalize(direction);float attenuation=max(0.,1.0-length(direction)/range);float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));if (cosAngle>=lightDirection.w)\n{cosAngle=max(0.,pow(cosAngle,lightData.w));attenuation*=cosAngle;float ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {lightingInfo result;float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor;\n#endif\nreturn result;}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix,vec3 posW){vec4 strq=textureProjectionMatrix*vec4(posW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return textureColor;}",ShaderStore.IncludesShadersStore[name22]=shader22,lightsFragmentFunctions={name:name22,shader:shader22}}}),shadowsFragmentFunctions_exports2={},name23,shader23,shadowsFragmentFunctions;__export(shadowsFragmentFunctions_exports2,{shadowsFragmentFunctions:()=>shadowsFragmentFunctions});var init_shadowsFragmentFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowsFragmentFunctions.js"(){init_shaderStore(),name23="shadowsFragmentFunctions",shader23="#ifdef SHADOWS\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)\n#else\n#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)\n#endif\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));return mix(value,1.0,mask);}\n#define inline\nfloat computeShadowCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nreturn depth>shadow ? darkness : 1.0;}\n#define inline\nfloat computeShadowWithPoissonSamplingCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;float visibility=1.;vec3 poissonDisk[4];poissonDisk[0]=vec3(-1.0,1.0,-1.0);poissonDisk[1]=vec3(1.0,-1.0,-1.0);poissonDisk[2]=vec3(-1.0,-1.0,-1.0);poissonDisk[3]=vec3(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);}\n#define inline\nfloat computeShadowWithESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return esm;}\n#define inline\nfloat computeShadowWithCloseESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return esm;}\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define inline\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);vec3 uvLayer=vec3(uv.x,uv.y,layer);float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}\n#endif\n#define inline\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadow=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}}\n#define inline\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);float visibility=1.;vec2 poissonDisk[4];poissonDisk[0]=vec2(-0.94201624,-0.39906216);poissonDisk[1]=vec2(0.94558609,-0.76890725);poissonDisk[2]=vec2(-0.094184101,-0.92938870);poissonDisk[3]=vec2(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;\n#else\nif (TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\n#ifdef IS_NDC_HALF_ZRANGE\n#define ZINCLIP clipSpace.z\n#else\n#define ZINCLIP uvDepth.z\n#endif\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define GREATEST_LESS_THAN_ONE 0.99999994\n#define DISABLE_UNIFORMITY_ANALYSIS\n#define inline\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float shadow=texture2D(shadowSampler,uvDepthLayer);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float shadow=TEXTUREFUNC(shadowSampler,uvDepth,0.);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw2.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow+=uvw2.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z),0.);shadow+=uvw0.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z),0.);shadow+=uvw1.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z),0.);shadow+=uvw2.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z),0.);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.)\n);const vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n#define inline\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec4 offset=vec4(poissonSamplers[i],0.);offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);}\nshadow/=float(pcfTapCount);shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));shadow=mix(darkness,1.,shadow);if (numBlocker<1.0) {return 1.0;}\nelse\n{return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=TEXTUREFUNC(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy),0.).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}\nif (numBlocker<1.0) {return 1.0;}\nelse\n{float avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec3 offset=poissonSamplers[i];offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);shadow+=TEXTUREFUNC(shadowSampler,uvDepth+offset*filterRadius,0.);}\nshadow/=float(pcfTapCount);shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}}\n#define inline\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);}\n#define inline\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);}\n#define inline\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);}\n#define inline\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#define inline\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#define inline\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name23]=shader23,shadowsFragmentFunctions={name:name23,shader:shader23}}}),shadowsVertex_exports2={},name24,shader24,shadowsVertex;__export(shadowsVertex_exports2,{shadowsVertex:()=>shadowsVertex});var init_shadowsVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowsVertex.js"(){init_shaderStore(),name24="shadowsVertex",shader24="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name24]=shader24,shadowsVertex={name:name24,shader:shader24}}}),fogFragmentDeclaration_exports={},name25,shader25,fogFragmentDeclarationWGSL;__export(fogFragmentDeclaration_exports,{fogFragmentDeclarationWGSL:()=>fogFragmentDeclarationWGSL});var init_fogFragmentDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fogFragmentDeclaration.js"(){init_shaderStore(),name25="fogFragmentDeclaration",shader25="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name25]=shader25,fogFragmentDeclarationWGSL={name:name25,shader:shader25}}}),fogFragmentDeclaration_exports2={},name26,shader26,fogFragmentDeclaration;__export(fogFragmentDeclaration_exports2,{fogFragmentDeclaration:()=>fogFragmentDeclaration});var init_fogFragmentDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/fogFragmentDeclaration.js"(){init_shaderStore(),name26="fogFragmentDeclaration",shader26="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n",ShaderStore.IncludesShadersStore[name26]=shader26,fogFragmentDeclaration={name:name26,shader:shader26}}}),shadowMapVertexMetric_exports={},name27,shader27,shadowMapVertexMetricWGSL;__export(shadowMapVertexMetric_exports,{shadowMapVertexMetricWGSL:()=>shadowMapVertexMetricWGSL});var init_shadowMapVertexMetric=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapVertexMetric.js"(){init_shaderStore(),name27="shadowMapVertexMetric",shader27="#if SM_USEDISTANCE==1\nvertexOutputs.vPositionWSM=worldPos.xyz;\n#endif\n#if SM_DEPTHTEXTURE==1\n#ifdef IS_NDC_HALF_ZRANGE\n#define BIASFACTOR 0.5\n#else\n#define BIASFACTOR 1.0\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.position.z-=uniforms.biasAndScaleSM.x*vertexOutputs.position.w*BIASFACTOR;\n#else\nvertexOutputs.position.z+=uniforms.biasAndScaleSM.x*vertexOutputs.position.w*BIASFACTOR;\n#endif\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvertexOutputs.zSM=vertexOutputs.position.z;vertexOutputs.position.z=0.0;\n#elif SM_USEDISTANCE==0\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetricSM=(-vertexOutputs.position.z+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#else\nvertexOutputs.vDepthMetricSM=(vertexOutputs.position.z+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name27]=shader27,shadowMapVertexMetricWGSL={name:name27,shader:shader27}}}),packingFunctions_exports={},name28,shader28,packingFunctionsWGSL;__export(packingFunctions_exports,{packingFunctionsWGSL:()=>packingFunctionsWGSL});var init_packingFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/packingFunctions.js"(){init_shaderStore(),name28="packingFunctions",shader28="fn pack(depth: f32)->vec4f\n{const bit_shift: vec4f= vec4f(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const bit_mask: vec4f= vec4f(0.0,1.0/255.0,1.0/255.0,1.0/255.0);var res: vec4f=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\nfn unpack(color: vec4f)->f32\n{const bit_shift: vec4f= vec4f(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}",ShaderStore.IncludesShadersStoreWGSL[name28]=shader28,packingFunctionsWGSL={name:name28,shader:shader28}}}),shadowMapFragment_exports={},name29,shader29,shadowMapFragmentWGSL;__export(shadowMapFragment_exports,{shadowMapFragmentWGSL:()=>shadowMapFragmentWGSL});var init_shadowMapFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapFragment.js"(){init_shaderStore(),name29="shadowMapFragment",shader29="var depthSM: f32=fragmentInputs.vDepthMetricSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\n#if SM_USEDISTANCE==1\ndepthSM=(length(fragmentInputs.vPositionWSM-uniforms.lightDataSM)+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\ndepthSM=(-fragmentInputs.zSM+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#else\ndepthSM=(fragmentInputs.zSM+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#endif\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\nfragmentOutputs.fragDepth=clamp(1.0-depthSM,0.0,1.0);\n#else\nfragmentOutputs.fragDepth=clamp(depthSM,0.0,1.0); \n#endif\n#elif SM_USEDISTANCE==1\ndepthSM=(length(fragmentInputs.vPositionWSM-uniforms.lightDataSM)+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#endif\n#if SM_ESM==1\ndepthSM=clamp(exp(-min(87.,uniforms.biasAndScaleSM.z*depthSM)),0.,1.);\n#endif\n#if SM_FLOAT==1\nfragmentOutputs.color= vec4f(depthSM,1.0,1.0,1.0);\n#else\nfragmentOutputs.color=pack(depthSM);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name29]=shader29,shadowMapFragmentWGSL={name:name29,shader:shader29}}}),shadowMapVertexMetric_exports2={},name30,shader30,shadowMapVertexMetric;__export(shadowMapVertexMetric_exports2,{shadowMapVertexMetric:()=>shadowMapVertexMetric});var init_shadowMapVertexMetric2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexMetric.js"(){init_shaderStore(),name30="shadowMapVertexMetric",shader30="#if SM_USEDISTANCE==1\nvPositionWSM=worldPos.xyz;\n#endif\n#if SM_DEPTHTEXTURE==1\n#ifdef IS_NDC_HALF_ZRANGE\n#define BIASFACTOR 0.5\n#else\n#define BIASFACTOR 1.0\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\ngl_Position.z-=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;\n#else\ngl_Position.z+=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;\n#endif\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nzSM=gl_Position.z;gl_Position.z=0.0;\n#elif SM_USEDISTANCE==0\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetricSM=(-gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\nvDepthMetricSM=(gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name30]=shader30,shadowMapVertexMetric={name:name30,shader:shader30}}}),packingFunctions_exports2={},name31,shader31,packingFunctions;__export(packingFunctions_exports2,{packingFunctions:()=>packingFunctions});var init_packingFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/packingFunctions.js"(){init_shaderStore(),name31="packingFunctions",shader31="vec4 pack(float depth)\n{const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\nfloat unpack(vec4 color)\n{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}",ShaderStore.IncludesShadersStore[name31]=shader31,packingFunctions={name:name31,shader:shader31}}}),shadowMapFragment_exports2={},name32,shader32,shadowMapFragment;__export(shadowMapFragment_exports2,{shadowMapFragment:()=>shadowMapFragment});var init_shadowMapFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragment.js"(){init_shaderStore(),name32="shadowMapFragment",shader32="float depthSM=vDepthMetricSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\n#if SM_USEDISTANCE==1\ndepthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\ndepthSM=(-zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\ndepthSM=(zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\ngl_FragDepth=clamp(1.0-depthSM,0.0,1.0);\n#else\ngl_FragDepth=clamp(depthSM,0.0,1.0); \n#endif\n#elif SM_USEDISTANCE==1\ndepthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#if SM_ESM==1\ndepthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);\n#endif\n#if SM_FLOAT==1\ngl_FragColor=vec4(depthSM,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depthSM);\n#endif\nreturn;",ShaderStore.IncludesShadersStore[name32]=shader32,shadowMapFragment={name:name32,shader:shader32}}}),name33,shader33,init_kernelBlurVaryingDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurVaryingDeclaration.js"(){init_shaderStore(),name33="kernelBlurVaryingDeclaration",shader33="varying vec2 sampleCoord{X};",ShaderStore.IncludesShadersStore[name33]=shader33}}),name34,shader34,init_kernelBlurFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurFragment.js"(){init_shaderStore(),name34="kernelBlurFragment",shader34="#ifdef DOF\nfactor=sampleCoC(sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif\n",ShaderStore.IncludesShadersStore[name34]=shader34}}),name35,shader35,init_kernelBlurFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurFragment2.js"(){init_shaderStore(),name35="kernelBlurFragment2",shader35="#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});computedWeight=KERNEL_DEP_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif\n",ShaderStore.IncludesShadersStore[name35]=shader35}}),kernelBlur_fragment_exports={},name36,shader36,kernelBlurPixelShader;__export(kernelBlur_fragment_exports,{kernelBlurPixelShader:()=>kernelBlurPixelShader});var init_kernelBlur_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/kernelBlur.fragment.js"(){init_shaderStore(),init_kernelBlurVaryingDeclaration(),init_packingFunctions2(),init_kernelBlurFragment(),init_kernelBlurFragment2(),name36="kernelBlurPixelShader",shader36="uniform sampler2D textureSampler;uniform vec2 delta;varying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;float sampleCoC(in vec2 offset) {float coc=texture2D(circleOfConfusionSampler,offset).r;return coc; }\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\n#include<packingFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{float computedWeight=0.0;\n#ifdef PACKEDFLOAT\nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT; \nfloat factor=0.0;\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}",ShaderStore.ShadersStore[name36]=shader36,kernelBlurPixelShader={name:name36,shader:shader36}}}),name37,shader37,init_kernelBlurVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurVertex.js"(){init_shaderStore(),name37="kernelBlurVertex",shader37="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",ShaderStore.IncludesShadersStore[name37]=shader37}}),kernelBlur_vertex_exports={},name38,shader38,kernelBlurVertexShader;__export(kernelBlur_vertex_exports,{kernelBlurVertexShader:()=>kernelBlurVertexShader});var init_kernelBlur_vertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/kernelBlur.vertex.js"(){init_shaderStore(),init_kernelBlurVaryingDeclaration(),init_kernelBlurVertex(),name38="kernelBlurVertexShader",shader38="attribute vec2 position;uniform vec2 delta;varying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStore[name38]=shader38,kernelBlurVertexShader={name:name38,shader:shader38}}}),name39,shader39,init_kernelBlurVaryingDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/kernelBlurVaryingDeclaration.js"(){init_shaderStore(),name39="kernelBlurVaryingDeclaration",shader39="varying sampleCoord{X}: vec2f;",ShaderStore.IncludesShadersStoreWGSL[name39]=shader39}}),name40,shader40,init_kernelBlurFragment3=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/kernelBlurFragment.js"(){init_shaderStore(),name40="kernelBlurFragment",shader40="#ifdef DOF\nfactor=sampleCoC(fragmentInputs.sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCoord{X}))*computedWeight;\n#else\nblend+=textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCoord{X})*computedWeight;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name40]=shader40}}),name41,shader41,init_kernelBlurFragment22=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/kernelBlurFragment2.js"(){init_shaderStore(),name41="kernelBlurFragment2",shader41="#ifdef DOF\nfactor=sampleCoC(fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X});computedWeight=KERNEL_DEP_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name41]=shader41}}),kernelBlur_fragment_exports2={},name42,shader42,kernelBlurPixelShaderWGSL;__export(kernelBlur_fragment_exports2,{kernelBlurPixelShaderWGSL:()=>kernelBlurPixelShaderWGSL});var init_kernelBlur_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/kernelBlur.fragment.js"(){init_shaderStore(),init_kernelBlurVaryingDeclaration2(),init_packingFunctions(),init_kernelBlurFragment3(),init_kernelBlurFragment22(),name42="kernelBlurPixelShader",shader42="var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;uniform delta: vec2f;varying sampleCenter: vec2f;\n#ifdef DOF\nvar circleOfConfusionSamplerSampler: sampler;var circleOfConfusionSampler: texture_2d<f32>;fn sampleCoC(offset: vec2f)->f32 {var coc: f32=textureSample(circleOfConfusionSampler,circleOfConfusionSamplerSampler,offset).r;return coc; }\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\n#include<packingFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {var computedWeight: f32=0.0;\n#ifdef PACKEDFLOAT\nvar blend: f32=0.;\n#else\nvar blend: vec4f= vec4f(0.);\n#endif\n#ifdef DOF\nvar sumOfWeights: f32=CENTER_WEIGHT; \nvar factor: f32=0.0;\n#ifdef PACKEDFLOAT\nblend+=unpack(textureSample(textureSampler,textureSamplerSampler,input.sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=textureSample(textureSampler,textureSamplerSampler,input.sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\nfragmentOutputs.color=pack(blend);\n#else\nfragmentOutputs.color=blend;\n#endif\n#ifdef DOF\nfragmentOutputs.color/=sumOfWeights;\n#endif\n}",ShaderStore.ShadersStoreWGSL[name42]=shader42,kernelBlurPixelShaderWGSL={name:name42,shader:shader42}}}),name43,shader43,init_kernelBlurVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/kernelBlurVertex.js"(){init_shaderStore(),name43="kernelBlurVertex",shader43="vertexOutputs.sampleCoord{X}=vertexOutputs.sampleCenter+uniforms.delta*KERNEL_OFFSET{X};",ShaderStore.IncludesShadersStoreWGSL[name43]=shader43}}),kernelBlur_vertex_exports2={},name44,shader44,kernelBlurVertexShaderWGSL;__export(kernelBlur_vertex_exports2,{kernelBlurVertexShaderWGSL:()=>kernelBlurVertexShaderWGSL});var init_kernelBlur_vertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/kernelBlur.vertex.js"(){init_shaderStore(),init_kernelBlurVaryingDeclaration2(),init_kernelBlurVertex2(),name44="kernelBlurVertexShader",shader44="attribute position: vec2f;uniform delta: vec2f;varying sampleCenter: vec2f;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {const madd: vec2f= vec2f(0.5,0.5);\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvertexOutputs.sampleCenter=(input.position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\nvertexOutputs.position= vec4f(input.position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStoreWGSL[name44]=shader44,kernelBlurVertexShaderWGSL={name:name44,shader:shader44}}}),name45,shader45,init_bayerDitherFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bayerDitherFunctions.js"(){init_shaderStore(),name45="bayerDitherFunctions",shader45="fn bayerDither2(_P: vec2f)->f32 {return ((2.0*_P.y+_P.x+1.0)%(4.0));}\nfn bayerDither4(_P: vec2f)->f32 {var P1: vec2f=((_P)%(2.0)); \nvar P2: vec2f=floor(0.5*((_P)%(4.0))); \nreturn 4.0*bayerDither2(P1)+bayerDither2(P2);}\nfn bayerDither8(_P: vec2f)->f32 {var P1: vec2f=((_P)%(2.0)); \nvar P2: vec2f=floor(0.5 *((_P)%(4.0))); \nvar P4: vec2f=floor(0.25*((_P)%(8.0))); \nreturn 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);}\n",ShaderStore.IncludesShadersStoreWGSL[name45]=shader45}}),name46,shader46,init_shadowMapFragmentExtraDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapFragmentExtraDeclaration.js"(){init_shaderStore(),init_packingFunctions(),init_bayerDitherFunctions(),name46="shadowMapFragmentExtraDeclaration",shader46="#if SM_FLOAT==0\n#include<packingFunctions>\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#include<bayerDitherFunctions>\nuniform softTransparentShadowSM: vec2f;\n#endif\nvarying vDepthMetricSM: f32;\n#if SM_USEDISTANCE==1\nuniform lightDataSM: vec3f;varying vPositionWSM: vec3f;\n#endif\nuniform biasAndScaleSM: vec3f;uniform depthValuesSM: vec2f;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying zSM: f32;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name46]=shader46}}),name47,shader47,init_clipPlaneFragmentDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/clipPlaneFragmentDeclaration.js"(){init_shaderStore(),name47="clipPlaneFragmentDeclaration",shader47="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name47]=shader47}}),name48,shader48,init_clipPlaneFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/clipPlaneFragment.js"(){init_shaderStore(),name48="clipPlaneFragment",shader48="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name48]=shader48}}),shadowMap_fragment_exports={},name49,shader49,shadowMapPixelShaderWGSL;__export(shadowMap_fragment_exports,{shadowMapPixelShaderWGSL:()=>shadowMapPixelShaderWGSL});var init_shadowMap_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/shadowMap.fragment.js"(){init_shaderStore(),init_shadowMapFragmentExtraDeclaration(),init_clipPlaneFragmentDeclaration(),init_clipPlaneFragment(),init_shadowMapFragment(),name49="shadowMapPixelShader",shader49="#include<shadowMapFragmentExtraDeclaration>\n#ifdef ALPHATEXTURE\nvarying vUV: vec2f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#include<clipPlaneFragment>\n#ifdef ALPHATEXTURE\nvar opacityMap: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,fragmentInputs.vUV);var alphaFromAlphaTexture: f32=opacityMap.a;\n#if SM_SOFTTRANSPARENTSHADOW==1\nif (uniforms.softTransparentShadowSM.y==1.0) {opacityMap=vec4f(opacityMap.rgb* vec3f(0.3,0.59,0.11),opacityMap.a);alphaFromAlphaTexture=opacityMap.x+opacityMap.y+opacityMap.z;}\n#endif\n#ifdef ALPHATESTVALUE\nif (alphaFromAlphaTexture<ALPHATESTVALUE) {discard;}\n#endif\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#ifdef ALPHATEXTURE\nif ((bayerDither8(floor(((fragmentInputs.position.xy)%(8.0)))))/64.0>=uniforms.softTransparentShadowSM.x*alphaFromAlphaTexture) {discard;}\n#else\nif ((bayerDither8(floor(((fragmentInputs.position.xy)%(8.0)))))/64.0>=uniforms.softTransparentShadowSM.x) {discard;} \n#endif\n#endif\n#include<shadowMapFragment>\n}",ShaderStore.ShadersStoreWGSL[name49]=shader49,shadowMapPixelShaderWGSL={name:name49,shader:shader49}}}),name50,shader50,init_bakedVertexAnimationDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bakedVertexAnimationDeclaration.js"(){init_shaderStore(),name50="bakedVertexAnimationDeclaration",shader50="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform bakedVertexAnimationTime: f32;uniform bakedVertexAnimationTextureSizeInverted: vec2<f32>;uniform bakedVertexAnimationSettings: vec4<f32>;var bakedVertexAnimationTexture : texture_2d<f32>;\n#ifdef INSTANCES\nattribute bakedVertexAnimationSettingsInstanced : vec4<f32>;\n#endif\nfn readMatrixFromRawSamplerVAT(smp : texture_2d<f32>,index : f32,frame : f32)->mat4x4<f32>\n{let offset=i32(index)*4;let frameUV=i32(frame);let m0=textureLoad(smp,vec2<i32>(offset+0,frameUV),0);let m1=textureLoad(smp,vec2<i32>(offset+1,frameUV),0);let m2=textureLoad(smp,vec2<i32>(offset+2,frameUV),0);let m3=textureLoad(smp,vec2<i32>(offset+3,frameUV),0);return mat4x4<f32>(m0,m1,m2,m3);}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name50]=shader50}}),name51,shader51,init_morphTargetsVertexGlobalDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/morphTargetsVertexGlobalDeclaration.js"(){init_shaderStore(),name51="morphTargetsVertexGlobalDeclaration",shader51="#ifdef MORPHTARGETS\nuniform morphTargetInfluences : array<f32,NUM_MORPH_INFLUENCERS>;\n#ifdef MORPHTARGETS_TEXTURE \nuniform morphTargetTextureIndices : array<f32,NUM_MORPH_INFLUENCERS>;uniform morphTargetTextureInfo : vec3<f32>;var morphTargets : texture_2d_array<f32>;var morphTargetsSampler : sampler;fn readVector3FromRawSampler(targetIndex : i32,vertexIndex : f32)->vec3<f32>\n{ \nlet y=floor(vertexIndex/uniforms.morphTargetTextureInfo.y);let x=vertexIndex-y*uniforms.morphTargetTextureInfo.y;let textureUV=vec2<f32>((x+0.5)/uniforms.morphTargetTextureInfo.y,(y+0.5)/uniforms.morphTargetTextureInfo.z);return textureSampleLevel(morphTargets,morphTargetsSampler,textureUV,i32(uniforms.morphTargetTextureIndices[targetIndex]),0.0).xyz;}\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name51]=shader51}}),name52,shader52,init_morphTargetsVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/morphTargetsVertexDeclaration.js"(){init_shaderStore(),name52="morphTargetsVertexDeclaration",shader52="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute position{X} : vec3<f32>;\n#ifdef MORPHTARGETS_NORMAL\nattribute normal{X} : vec3<f32>;\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute tangent{X} : vec3<f32>;\n#endif\n#ifdef MORPHTARGETS_UV\nattribute uv_{X} : vec2<f32>;\n#endif\n#elif {X}==0\nuniform morphTargetCount: i32;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name52]=shader52}}),name53,shader53,init_sceneUboDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/sceneUboDeclaration.js"(){init_shaderStore(),name53="sceneUboDeclaration",shader53="struct Scene {viewProjection : mat4x4<f32>,\n#ifdef MULTIVIEW\nviewProjectionR : mat4x4<f32>,\n#endif \nview : mat4x4<f32>,\nprojection : mat4x4<f32>,\nvEyePosition : vec4<f32>,};var<uniform> scene : Scene;\n",ShaderStore.IncludesShadersStoreWGSL[name53]=shader53}}),name54,shader54,init_meshUboDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/meshUboDeclaration.js"(){init_shaderStore(),name54="meshUboDeclaration",shader54="struct Mesh {world : mat4x4<f32>,\nvisibility : f32,};var<uniform> mesh : Mesh;\n#define WORLD_UBO\n",ShaderStore.IncludesShadersStoreWGSL[name54]=shader54}}),name55,shader55,init_shadowMapVertexExtraDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapVertexExtraDeclaration.js"(){init_shaderStore(),name55="shadowMapVertexExtraDeclaration",shader55="#if SM_NORMALBIAS==1\nuniform lightDataSM: vec3f;\n#endif\nuniform biasAndScaleSM: vec3f;uniform depthValuesSM: vec2f;varying vDepthMetricSM: f32;\n#if SM_USEDISTANCE==1\nvarying vPositionWSM: vec3f;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying zSM: f32;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name55]=shader55}}),name56,shader56,init_clipPlaneVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/clipPlaneVertexDeclaration.js"(){init_shaderStore(),name56="clipPlaneVertexDeclaration",shader56="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name56]=shader56}}),name57,shader57,init_morphTargetsVertexGlobal=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/morphTargetsVertexGlobal.js"(){init_shaderStore(),name57="morphTargetsVertexGlobal",shader57="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nvar vertexID : f32;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name57]=shader57}}),name58,shader58,init_morphTargetsVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/morphTargetsVertex.js"(){init_shaderStore(),name58="morphTargetsVertex",shader58="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\n#if {X}==0\nfor (var i=0; i<NUM_MORPH_INFLUENCERS; i=i+1) {if (i>=uniforms.morphTargetCount) {break;}\nvertexID=f32(vertexInputs.vertexIndex)*uniforms.morphTargetTextureInfo.x;positionUpdated=positionUpdated+(readVector3FromRawSampler(i,vertexID)-vertexInputs.position)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated=normalUpdated+(readVector3FromRawSampler(i,vertexID) -vertexInputs.normal)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated=uvUpdated+(readVector3FromRawSampler(i,vertexID).xy-vertexInputs.uv)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated=vec4f(tangentUpdated.xyz+(readVector3FromRawSampler(i,vertexID) -vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[i],tangentUpdated.a);\n#endif\n}\n#endif\n#else\npositionUpdated=positionUpdated+(vertexInputs.position{X}-vertexInputs.position)*uniforms.morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(vertexInputs.normal{X}-vertexInputs.normal)*uniforms.morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated=vec4f(tangentUpdated.xyz+(vertexInputs.tangent{X}-vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[{X}],tangentUpdated.a);\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated=uvUpdated+(vertexInputs.uv_{X}-vertexInputs.uv)*uniforms.morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name58]=shader58}}),name59,shader59,init_instancesVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/instancesVertex.js"(){init_shaderStore(),name59="instancesVertex",shader59="#ifdef INSTANCES\nvar finalWorld=mat4x4<f32>(vertexInputs.world0,vertexInputs.world1,vertexInputs.world2,vertexInputs.world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nvar finalPreviousWorld=mat4x4<f32>(vertexInputs.previousWorld0,vertexInputs.previousWorld1,vertexInputs.previousWorld2,vertexInputs.previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\n#if !defined(WORLD_UBO)\nfinalWorld=uniforms.world*finalWorld;\n#else\nfinalWorld=mesh.world*finalWorld;\n#endif\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=uniforms.previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nvar finalWorld=uniforms.world;\n#else\nvar finalWorld=mesh.world;\n#endif\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nvar finalPreviousWorld=uniforms.previousWorld;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name59]=shader59}}),name60,shader60,init_bakedVertexAnimation=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bakedVertexAnimation.js"(){init_shaderStore(),name60="bakedVertexAnimation",shader60="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\nlet VATStartFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.x;let VATEndFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.y;let VATOffsetFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.z;let VATSpeed: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.w;\n#else\nlet VATStartFrame: f32=uniforms.bakedVertexAnimationSettings.x;let VATEndFrame: f32=uniforms.bakedVertexAnimationSettings.y;let VATOffsetFrame: f32=uniforms.bakedVertexAnimationSettings.z;let VATSpeed: f32=uniforms.bakedVertexAnimationSettings.w;\n#endif\nlet totalFrames: f32=VATEndFrame-VATStartFrame+1.0;let time: f32=uniforms.bakedVertexAnimationTime*VATSpeed/totalFrames;let frameCorrection: f32=select(1.0,0.0,time<1.0);let numOfFrames: f32=totalFrames-frameCorrection;var VATFrameNum: f32=fract(time)*numOfFrames;VATFrameNum=(VATFrameNum+VATOffsetFrame) % numOfFrames;VATFrameNum=floor(VATFrameNum);VATFrameNum=VATFrameNum+VATStartFrame+frameCorrection;var VATInfluence : mat4x4<f32>;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[0],VATFrameNum)*vertexInputs.matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[1],VATFrameNum)*vertexInputs.matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[2],VATFrameNum)*vertexInputs.matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[3],VATFrameNum)*vertexInputs.matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[0],VATFrameNum)*vertexInputs.matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[1],VATFrameNum)*vertexInputs.matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[2],VATFrameNum)*vertexInputs.matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[3],VATFrameNum)*vertexInputs.matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name60]=shader60}}),name61,shader61,init_shadowMapVertexNormalBias=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapVertexNormalBias.js"(){init_shaderStore(),name61="shadowMapVertexNormalBias",shader61="#if SM_NORMALBIAS==1\n#if SM_DIRECTIONINLIGHTDATA==1\nvar worldLightDirSM: vec3f=normalize(-uniforms.lightDataSM.xyz);\n#else\nvar directionToLightSM: vec3f=uniforms.lightDataSM.xyz-worldPos.xyz;var worldLightDirSM: vec3f=normalize(directionToLightSM);\n#endif\nvar ndlSM: f32=dot(vNormalW,worldLightDirSM);var sinNLSM: f32=sqrt(1.0-ndlSM*ndlSM);var normalBiasSM: f32=uniforms.biasAndScaleSM.y*sinNLSM;worldPos=vec4f(worldPos.xyz-vNormalW*normalBiasSM,worldPos.w);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name61]=shader61}}),name62,shader62,init_clipPlaneVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/clipPlaneVertex.js"(){init_shaderStore(),name62="clipPlaneVertex",shader62="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name62]=shader62}}),shadowMap_vertex_exports={},name63,shader63,shadowMapVertexShaderWGSL;__export(shadowMap_vertex_exports,{shadowMapVertexShaderWGSL:()=>shadowMapVertexShaderWGSL});var init_shadowMap_vertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/shadowMap.vertex.js"(){init_shaderStore(),init_bonesDeclaration(),init_bakedVertexAnimationDeclaration(),init_morphTargetsVertexGlobalDeclaration(),init_morphTargetsVertexDeclaration(),init_helperFunctions(),init_sceneUboDeclaration(),init_meshUboDeclaration(),init_shadowMapVertexExtraDeclaration(),init_clipPlaneVertexDeclaration(),init_morphTargetsVertexGlobal(),init_morphTargetsVertex(),init_instancesVertex(),init_bonesVertex(),init_bakedVertexAnimation(),init_shadowMapVertexNormalBias(),init_shadowMapVertexMetric(),init_clipPlaneVertex(),name63="shadowMapVertexShader",shader63="attribute position: vec3f;\n#ifdef NORMAL\nattribute normal: vec3f;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef INSTANCES\nattribute world0: vec4f;attribute world1: vec4f;attribute world2: vec4f;attribute world3: vec4f;\n#endif\n#include<helperFunctions>\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n#ifdef ALPHATEXTURE\nvarying vUV: vec2f;uniform diffuseMatrix: mat4x4f;\n#ifdef UV1\nattribute uv: vec2f;\n#endif\n#ifdef UV2\nattribute uv2: vec2f;\n#endif\n#endif\n#include<shadowMapVertexExtraDeclaration>\n#include<clipPlaneVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {var positionUpdated: vec3f=input.position;\n#ifdef UV1\nvar uvUpdated: vec2f=input.uv;\n#endif\n#ifdef NORMAL\nvar normalUpdated: vec3f=input.normal;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld* vec4f(positionUpdated,1.0);\n#ifdef NORMAL\nvar normWorldSM: mat3x3f= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvar vNormalW: vec3f=normalUpdated/ vec3f(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));vNormalW=normalize(normWorldSM*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormWorldSM=transposeMat3(inverseMat3(normWorldSM));\n#endif\nvar vNormalW: vec3f=normalize(normWorldSM*normalUpdated);\n#endif\n#endif\n#include<shadowMapVertexNormalBias>\nvertexOutputs.position=scene.viewProjection*worldPos;\n#include<shadowMapVertexMetric>\n#ifdef ALPHATEXTURE\n#ifdef UV1\nvertexOutputs.vUV= (uniforms.diffuseMatrix* vec4f(uvUpdated,1.0,0.0)).xy;\n#endif\n#ifdef UV2\nvertexOutputs.vUV= (uniforms.diffuseMatrix* vec4f(input.uv2,1.0,0.0)).xy;\n#endif\n#endif\n#include<clipPlaneVertex>\n}",ShaderStore.ShadersStoreWGSL[name63]=shader63,shadowMapVertexShaderWGSL={name:name63,shader:shader63}}}),depthBoxBlur_fragment_exports={},name64,shader64,depthBoxBlurPixelShaderWGSL;__export(depthBoxBlur_fragment_exports,{depthBoxBlurPixelShaderWGSL:()=>depthBoxBlurPixelShaderWGSL});var init_depthBoxBlur_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/depthBoxBlur.fragment.js"(){init_shaderStore(),name64="depthBoxBlurPixelShader",shader64="varying vUV: vec2f;var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;uniform screenSize: vec2f;\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {var colorDepth: vec4f=vec4f(0.0);for (var x: i32=-OFFSET; x<=OFFSET; x++) {for (var y: i32=-OFFSET; y<=OFFSET; y++) {colorDepth+=textureSample(textureSampler,textureSamplerSampler,input.vUV+ vec2f(f32(x),f32(y))/uniforms.screenSize);}}\nfragmentOutputs.color=(colorDepth/ f32((OFFSET*2+1)*(OFFSET*2+1)));}",ShaderStore.ShadersStoreWGSL[name64]=shader64,depthBoxBlurPixelShaderWGSL={name:name64,shader:shader64}}}),shadowMapFragmentSoftTransparentShadow_exports={},name65,shader65,shadowMapFragmentSoftTransparentShadowWGSL;__export(shadowMapFragmentSoftTransparentShadow_exports,{shadowMapFragmentSoftTransparentShadowWGSL:()=>shadowMapFragmentSoftTransparentShadowWGSL});var init_shadowMapFragmentSoftTransparentShadow=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapFragmentSoftTransparentShadow.js"(){init_shaderStore(),name65="shadowMapFragmentSoftTransparentShadow",shader65="#if SM_SOFTTRANSPARENTSHADOW==1\nif ((bayerDither8(floor(((fragmentInputs.position.xy)%(8.0)))))/64.0>=uniforms.softTransparentShadowSM.x*alpha) {discard;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name65]=shader65,shadowMapFragmentSoftTransparentShadowWGSL={name:name65,shader:shader65}}}),name66,shader66,init_bayerDitherFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bayerDitherFunctions.js"(){init_shaderStore(),name66="bayerDitherFunctions",shader66="float bayerDither2(vec2 _P) {return mod(2.0*_P.y+_P.x+1.0,4.0);}\nfloat bayerDither4(vec2 _P) {vec2 P1=mod(_P,2.0); \nvec2 P2=floor(0.5*mod(_P,4.0)); \nreturn 4.0*bayerDither2(P1)+bayerDither2(P2);}\nfloat bayerDither8(vec2 _P) {vec2 P1=mod(_P,2.0); \nvec2 P2=floor(0.5 *mod(_P,4.0)); \nvec2 P4=floor(0.25*mod(_P,8.0)); \nreturn 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);}\n",ShaderStore.IncludesShadersStore[name66]=shader66}}),name67,shader67,init_shadowMapFragmentExtraDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragmentExtraDeclaration.js"(){init_shaderStore(),init_packingFunctions2(),init_bayerDitherFunctions2(),name67="shadowMapFragmentExtraDeclaration",shader67="#if SM_FLOAT==0\n#include<packingFunctions>\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#include<bayerDitherFunctions>\nuniform vec2 softTransparentShadowSM;\n#endif\nvarying float vDepthMetricSM;\n#if SM_USEDISTANCE==1\nuniform vec3 lightDataSM;varying vec3 vPositionWSM;\n#endif\nuniform vec3 biasAndScaleSM;uniform vec2 depthValuesSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying float zSM;\n#endif\n",ShaderStore.IncludesShadersStore[name67]=shader67}}),name68,shader68,init_clipPlaneFragmentDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneFragmentDeclaration.js"(){init_shaderStore(),name68="clipPlaneFragmentDeclaration",shader68="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n",ShaderStore.IncludesShadersStore[name68]=shader68}}),name69,shader69,init_clipPlaneFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneFragment.js"(){init_shaderStore(),name69="clipPlaneFragment",shader69="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n",ShaderStore.IncludesShadersStore[name69]=shader69}}),shadowMap_fragment_exports2={},name70,shader70,shadowMapPixelShader;__export(shadowMap_fragment_exports2,{shadowMapPixelShader:()=>shadowMapPixelShader});var init_shadowMap_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/shadowMap.fragment.js"(){init_shaderStore(),init_shadowMapFragmentExtraDeclaration2(),init_clipPlaneFragmentDeclaration2(),init_clipPlaneFragment2(),init_shadowMapFragment2(),name70="shadowMapPixelShader",shader70="#include<shadowMapFragmentExtraDeclaration>\n#ifdef ALPHATEXTURE\nvarying vec2 vUV;uniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEXTURE\nvec4 opacityMap=texture2D(diffuseSampler,vUV);float alphaFromAlphaTexture=opacityMap.a;\n#if SM_SOFTTRANSPARENTSHADOW==1\nif (softTransparentShadowSM.y==1.0) {opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);alphaFromAlphaTexture=opacityMap.x+opacityMap.y+opacityMap.z;}\n#endif\n#ifdef ALPHATESTVALUE\nif (alphaFromAlphaTexture<ALPHATESTVALUE)\ndiscard;\n#endif\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#ifdef ALPHATEXTURE\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM.x*alphaFromAlphaTexture) discard;\n#else\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM.x) discard;\n#endif\n#endif\n#include<shadowMapFragment>\n}",ShaderStore.ShadersStore[name70]=shader70,shadowMapPixelShader={name:name70,shader:shader70}}}),name71,shader71,init_bakedVertexAnimationDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bakedVertexAnimationDeclaration.js"(){init_shaderStore(),name71="bakedVertexAnimationDeclaration",shader71="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}\n#endif\n",ShaderStore.IncludesShadersStore[name71]=shader71}}),name72,shader72,init_morphTargetsVertexGlobalDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexGlobalDeclaration.js"(){init_shaderStore(),name72="morphTargetsVertexGlobalDeclaration",shader72="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name72]=shader72}}),name73,shader73,init_morphTargetsVertexDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexDeclaration.js"(){init_shaderStore(),name73="morphTargetsVertexDeclaration",shader73="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#elif {X}==0\nuniform int morphTargetCount;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name73]=shader73}}),name74,shader74,init_sceneVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/sceneVertexDeclaration.js"(){init_shaderStore(),name74="sceneVertexDeclaration",shader74="uniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\nuniform mat4 view;uniform mat4 projection;uniform vec4 vEyePosition;\n",ShaderStore.IncludesShadersStore[name74]=shader74}}),name75,shader75,init_meshVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/meshVertexDeclaration.js"(){init_shaderStore(),name75="meshVertexDeclaration",shader75="uniform mat4 world;uniform float visibility;\n",ShaderStore.IncludesShadersStore[name75]=shader75}}),name76,shader76,init_shadowMapVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexDeclaration.js"(){init_shaderStore(),init_sceneVertexDeclaration(),init_meshVertexDeclaration(),name76="shadowMapVertexDeclaration",shader76="#include<sceneVertexDeclaration>\n#include<meshVertexDeclaration>\n",ShaderStore.IncludesShadersStore[name76]=shader76}}),name77,shader77,init_sceneUboDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/sceneUboDeclaration.js"(){init_shaderStore(),name77="sceneUboDeclaration",shader77="layout(std140,column_major) uniform;uniform Scene {mat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif \nmat4 view;mat4 projection;vec4 vEyePosition;};\n",ShaderStore.IncludesShadersStore[name77]=shader77}}),name78,shader78,init_meshUboDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/meshUboDeclaration.js"(){init_shaderStore(),name78="meshUboDeclaration",shader78="#ifdef WEBGL2\nuniform mat4 world;uniform float visibility;\n#else\nlayout(std140,column_major) uniform;uniform Mesh\n{mat4 world;float visibility;};\n#endif\n#define WORLD_UBO\n",ShaderStore.IncludesShadersStore[name78]=shader78}}),name79,shader79,init_shadowMapUboDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapUboDeclaration.js"(){init_shaderStore(),init_sceneUboDeclaration2(),init_meshUboDeclaration2(),name79="shadowMapUboDeclaration",shader79="layout(std140,column_major) uniform;\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",ShaderStore.IncludesShadersStore[name79]=shader79}}),name80,shader80,init_shadowMapVertexExtraDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexExtraDeclaration.js"(){init_shaderStore(),name80="shadowMapVertexExtraDeclaration",shader80="#if SM_NORMALBIAS==1\nuniform vec3 lightDataSM;\n#endif\nuniform vec3 biasAndScaleSM;uniform vec2 depthValuesSM;varying float vDepthMetricSM;\n#if SM_USEDISTANCE==1\nvarying vec3 vPositionWSM;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying float zSM;\n#endif\n",ShaderStore.IncludesShadersStore[name80]=shader80}}),name81,shader81,init_clipPlaneVertexDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneVertexDeclaration.js"(){init_shaderStore(),name81="clipPlaneVertexDeclaration",shader81="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n",ShaderStore.IncludesShadersStore[name81]=shader81}}),name82,shader82,init_morphTargetsVertexGlobal2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexGlobal.js"(){init_shaderStore(),name82="morphTargetsVertexGlobal",shader82="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name82]=shader82}}),name83,shader83,init_morphTargetsVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertex.js"(){init_shaderStore(),name83="morphTargetsVertex",shader83="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\n#if {X}==0\nfor (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (i>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;positionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];vertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];vertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];vertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];\n#endif\n}\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name83]=shader83}}),name84,shader84,init_instancesVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/instancesVertex.js"(){init_shaderStore(),name84="instancesVertex",shader84="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name84]=shader84}}),name85,shader85,init_bakedVertexAnimation2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bakedVertexAnimation.js"(){init_shaderStore(),name85="bakedVertexAnimation",shader85="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;}\n#endif\n",ShaderStore.IncludesShadersStore[name85]=shader85}}),name86,shader86,init_shadowMapVertexNormalBias2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexNormalBias.js"(){init_shaderStore(),name86="shadowMapVertexNormalBias",shader86="#if SM_NORMALBIAS==1\n#if SM_DIRECTIONINLIGHTDATA==1\nvec3 worldLightDirSM=normalize(-lightDataSM.xyz);\n#else\nvec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;vec3 worldLightDirSM=normalize(directionToLightSM);\n#endif\nfloat ndlSM=dot(vNormalW,worldLightDirSM);float sinNLSM=sqrt(1.0-ndlSM*ndlSM);float normalBiasSM=biasAndScaleSM.y*sinNLSM;worldPos.xyz-=vNormalW*normalBiasSM;\n#endif\n",ShaderStore.IncludesShadersStore[name86]=shader86}}),name87,shader87,init_clipPlaneVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneVertex.js"(){init_shaderStore(),name87="clipPlaneVertex",shader87="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n",ShaderStore.IncludesShadersStore[name87]=shader87}}),shadowMap_vertex_exports2={},name88,shader88,shadowMapVertexShader;__export(shadowMap_vertex_exports2,{shadowMapVertexShader:()=>shadowMapVertexShader});var init_shadowMap_vertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/shadowMap.vertex.js"(){init_shaderStore(),init_bonesDeclaration2(),init_bakedVertexAnimationDeclaration2(),init_morphTargetsVertexGlobalDeclaration2(),init_morphTargetsVertexDeclaration2(),init_helperFunctions2(),init_shadowMapVertexDeclaration(),init_shadowMapUboDeclaration(),init_shadowMapVertexExtraDeclaration2(),init_clipPlaneVertexDeclaration2(),init_morphTargetsVertexGlobal2(),init_morphTargetsVertex2(),init_instancesVertex2(),init_bonesVertex2(),init_bakedVertexAnimation2(),init_shadowMapVertexNormalBias2(),init_shadowMapVertexMetric2(),init_clipPlaneVertex2(),name88="shadowMapVertexShader",shader88="attribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef INSTANCES\nattribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;\n#endif\n#include<helperFunctions>\n#include<__decl__shadowMapVertex>\n#ifdef ALPHATEXTURE\nvarying vec2 vUV;uniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<shadowMapVertexExtraDeclaration>\n#include<clipPlaneVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{vec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normWorldSM=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvec3 vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));vNormalW=normalize(normWorldSM*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormWorldSM=transposeMat3(inverseMat3(normWorldSM));\n#endif\nvec3 vNormalW=normalize(normWorldSM*normalUpdated);\n#endif\n#endif\n#include<shadowMapVertexNormalBias>\ngl_Position=viewProjection*worldPos;\n#include<shadowMapVertexMetric>\n#ifdef ALPHATEXTURE\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<clipPlaneVertex>\n}",ShaderStore.ShadersStore[name88]=shader88,shadowMapVertexShader={name:name88,shader:shader88}}}),depthBoxBlur_fragment_exports2={},name89,shader89,depthBoxBlurPixelShader;__export(depthBoxBlur_fragment_exports2,{depthBoxBlurPixelShader:()=>depthBoxBlurPixelShader});var init_depthBoxBlur_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/depthBoxBlur.fragment.js"(){init_shaderStore(),name89="depthBoxBlurPixelShader",shader89="varying vec2 vUV;uniform sampler2D textureSampler;uniform vec2 screenSize;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{vec4 colorDepth=vec4(0.0);for (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));}",ShaderStore.ShadersStore[name89]=shader89,depthBoxBlurPixelShader={name:name89,shader:shader89}}}),shadowMapFragmentSoftTransparentShadow_exports2={},name90,shader90,shadowMapFragmentSoftTransparentShadow;__export(shadowMapFragmentSoftTransparentShadow_exports2,{shadowMapFragmentSoftTransparentShadow:()=>shadowMapFragmentSoftTransparentShadow});var init_shadowMapFragmentSoftTransparentShadow2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragmentSoftTransparentShadow.js"(){init_shaderStore(),name90="shadowMapFragmentSoftTransparentShadow",shader90="#if SM_SOFTTRANSPARENTSHADOW==1\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM.x*alpha) discard;\n#endif\n",ShaderStore.IncludesShadersStore[name90]=shader90,shadowMapFragmentSoftTransparentShadow={name:name90,shader:shader90}}}),pass_fragment_exports2={},name91,shader91,passPixelShaderWGSL;__export(pass_fragment_exports2,{passPixelShaderWGSL:()=>passPixelShaderWGSL});var init_pass_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/pass.fragment.js"(){init_shaderStore(),name91="passPixelShader",shader91="varying vUV: vec2f;var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=textureSample(textureSampler,textureSamplerSampler,input.vUV);}",ShaderStore.ShadersStoreWGSL[name91]=shader91,passPixelShaderWGSL={name:name91,shader:shader91}}}),name94,shader94,init_defaultUboDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/defaultUboDeclaration.js"(){init_shaderStore(),init_sceneUboDeclaration(),init_meshUboDeclaration(),name94="defaultUboDeclaration",shader94="uniform diffuseLeftColor: vec4f;uniform diffuseRightColor: vec4f;uniform opacityParts: vec4f;uniform reflectionLeftColor: vec4f;uniform reflectionRightColor: vec4f;uniform refractionLeftColor: vec4f;uniform refractionRightColor: vec4f;uniform emissiveLeftColor: vec4f;uniform emissiveRightColor: vec4f;uniform vDiffuseInfos: vec2f;uniform vAmbientInfos: vec2f;uniform vOpacityInfos: vec2f;uniform vReflectionInfos: vec2f;uniform vReflectionPosition: vec3f;uniform vReflectionSize: vec3f;uniform vEmissiveInfos: vec2f;uniform vLightmapInfos: vec2f;uniform vSpecularInfos: vec2f;uniform vBumpInfos: vec3f;uniform diffuseMatrix: mat4x4f;uniform ambientMatrix: mat4x4f;uniform opacityMatrix: mat4x4f;uniform reflectionMatrix: mat4x4f;uniform emissiveMatrix: mat4x4f;uniform lightmapMatrix: mat4x4f;uniform specularMatrix: mat4x4f;uniform bumpMatrix: mat4x4f;uniform vTangentSpaceParams: vec2f;uniform pointSize: f32;uniform alphaCutOff: f32;uniform refractionMatrix: mat4x4f;uniform vRefractionInfos: vec4f;uniform vRefractionPosition: vec3f;uniform vRefractionSize: vec3f;uniform vSpecularColor: vec4f;uniform vEmissiveColor: vec3f;uniform vDiffuseColor: vec4f;uniform vAmbientColor: vec3f;\n#define ADDITIONAL_UBO_DECLARATION\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",ShaderStore.IncludesShadersStoreWGSL[name94]=shader94}}),name95,shader95,init_uvAttributeDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/uvAttributeDeclaration.js"(){init_shaderStore(),name95="uvAttributeDeclaration",shader95="#ifdef UV{X}\nattribute uv{X}: vec2f;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name95]=shader95}}),name96,shader96,init_instancesDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/instancesDeclaration.js"(){init_shaderStore(),name96="instancesDeclaration",shader96="#ifdef INSTANCES\nattribute world0 : vec4<f32>;attribute world1 : vec4<f32>;attribute world2 : vec4<f32>;attribute world3 : vec4<f32>;\n#ifdef INSTANCESCOLOR\nattribute instanceColor : vec4<f32>;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform world : mat4x4<f32>;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute previousWorld0 : vec4<f32>;attribute previousWorld1 : vec4<f32>;attribute previousWorld2 : vec4<f32>;attribute previousWorld3 : vec4<f32>;\n#ifdef THIN_INSTANCES\nuniform previousWorld : mat4x4<f32>;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform world : mat4x4<f32>;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform previousWorld : mat4x4<f32>;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name96]=shader96}}),name97,shader97,init_prePassVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/prePassVertexDeclaration.js"(){init_shaderStore(),name97="prePassVertexDeclaration",shader97="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vViewPos: vec3f;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform previousViewProjection: mat4x4f;varying vCurrentPosition: vec4f;varying vPreviousPosition: vec4f;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name97]=shader97}}),name98,shader98,init_mainUVVaryingDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/mainUVVaryingDeclaration.js"(){init_shaderStore(),name98="mainUVVaryingDeclaration",shader98="#ifdef MAINUV{X}\nvarying vMainUV{X}: vec2f;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name98]=shader98}}),name99,shader99,init_samplerVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/samplerVertexDeclaration.js"(){init_shaderStore(),name99="samplerVertexDeclaration",shader99="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name99]=shader99}}),name100,shader100,init_bumpVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpVertexDeclaration.js"(){init_shaderStore(),name100="bumpVertexDeclaration",shader100="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying vTBN0: vec3f;varying vTBN1: vec3f;varying vTBN2: vec3f;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name100]=shader100}}),name101,shader101,init_fogVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fogVertexDeclaration.js"(){init_shaderStore(),name101="fogVertexDeclaration",shader101="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name101]=shader101}}),name102,shader102,init_lightVxFragmentDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightVxFragmentDeclaration.js"(){init_shaderStore(),name102="lightVxFragmentDeclaration",shader102="#ifdef LIGHT{X}\nuniform vLightData{X}: vec4f;uniform vLightDiffuse{X}: vec4f;\n#ifdef SPECULARTERM\nuniform vLightSpecular{X}: vec4f;\n#else\nvar vLightSpecular{X}: vec4f= vec4f(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform lightMatrix{X}: mat4x4f[SHADOWCSMNUM_CASCADES{X}];varying var vPositionFromLight{X}: vec4f[SHADOWCSMNUM_CASCADES{X}];varying var vDepthMetric{X}: f32[SHADOWCSMNUM_CASCADES{X}];varying var vPositionFromCamera{X}: vec4f;\n#elif defined(SHADOWCUBE{X})\n#else\nvarying var vPositionFromLight{X}: vec4f;varying var vDepthMetric{X}: f32;uniform lightMatrix{X}: mat4x4f;\n#endif\nuniform shadowsInfo{X}: vec4f;uniform depthValues{X}: vec2f;\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vLightDirection{X}: vec4f;uniform vLightFalloff{X}: vec4f;\n#elif defined(POINTLIGHT{X})\nuniform vLightFalloff{X}: vec4f;\n#elif defined(HEMILIGHT{X})\nuniform vLightGround{X}: vec3f;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name102]=shader102}}),name103,shader103,init_logDepthDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/logDepthDeclaration.js"(){init_shaderStore(),name103="logDepthDeclaration",shader103="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name103]=shader103}}),name104,shader104,init_prePassVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/prePassVertex.js"(){init_shaderStore(),name104="prePassVertex",shader104="#ifdef PREPASS_DEPTH\nvertexOutputs.vViewPos=(scene.view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvertexOutputs.vCurrentPosition=scene.viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nvar previousInfluence: mat4x4f;previousInfluence=mPreviousBones[ i32(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld*previousInfluence* vec4f(positionUpdated,1.0);\n#else\nvertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld* vec4f(positionUpdated,1.0);\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name104]=shader104}}),name105,shader105,init_uvVariableDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/uvVariableDeclaration.js"(){init_shaderStore(),name105="uvVariableDeclaration",shader105="#ifdef MAINUV{X}\n#if !defined(UV{X})\nvar uv{X}: vec2f=vec2f(0.,0.);\n#else\nvar uv{X}: vec2f=vertexInputs.uv{X};\n#endif\nvertexOutputs.vMainUV{X}=uv{X};\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name105]=shader105}}),name106,shader106,init_samplerVertexImplementation=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/samplerVertexImplementation.js"(){init_shaderStore(),name106="samplerVertexImplementation",shader106="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (uniforms.v_INFONAME_==0.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(uvUpdated,1.0,0.0)).xy;}\n#ifdef UV2\nelse if (uniforms.v_INFONAME_==1.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv2,1.0,0.0)).xy;}\n#endif\n#ifdef UV3\nelse if (uniforms.v_INFONAME_==2.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv3,1.0,0.0)).xy;}\n#endif\n#ifdef UV4\nelse if (uniforms.v_INFONAME_==3.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv4,1.0,0.0)).xy;}\n#endif\n#ifdef UV5\nelse if (uniforms.v_INFONAME_==4.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv5,1.0,0.0)).xy;}\n#endif\n#ifdef UV6\nelse if (uniforms.v_INFONAME_==5.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv6,1.0,0.0)).xy;}\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name106]=shader106}}),name107,shader107,init_bumpVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpVertex.js"(){init_shaderStore(),name107="bumpVertex",shader107="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvar tbnNormal: vec3f=normalize(normalUpdated);var tbnTangent: vec3f=normalize(tangentUpdated.xyz);var tbnBitangent: vec3f=cross(tbnNormal,tbnTangent)*tangentUpdated.w;var matTemp= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz)* mat3x3f(tbnTangent,tbnBitangent,tbnNormal);vertexOutputs.vTBN0=matTemp[0];vertexOutputs.vTBN1=matTemp[1];vertexOutputs.vTBN2=matTemp[2];\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name107]=shader107}}),name108,shader108,init_fogVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fogVertex.js"(){init_shaderStore(),name108="fogVertex",shader108="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name108]=shader108}}),name109,shader109,init_vertexColorMixing=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/vertexColorMixing.js"(){init_shaderStore(),name109="vertexColorMixing",shader109="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvertexOutputs.vColor=vec4f(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvertexOutputs.vColor*=vertexInputs.color;\n#else\nvertexOutputs.vColor=vec4f(vertexOutputs.vColor.rgb*vertexInputs.color.rgb,vertexOutputs.vColor.a);\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvertexOutputs.vColor*=vertexInputs.instanceColor;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name109]=shader109}}),name110,shader110,init_logDepthVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/logDepthVertex.js"(){init_shaderStore(),name110="logDepthVertex",shader110="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name110]=shader110}}),default_vertex_exports={},name111,shader111,defaultVertexShaderWGSL;__export(default_vertex_exports,{defaultVertexShaderWGSL:()=>defaultVertexShaderWGSL});var init_default_vertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/default.vertex.js"(){init_shaderStore(),init_defaultUboDeclaration(),init_uvAttributeDeclaration(),init_helperFunctions(),init_bonesDeclaration(),init_bakedVertexAnimationDeclaration(),init_instancesDeclaration(),init_prePassVertexDeclaration(),init_mainUVVaryingDeclaration(),init_samplerVertexDeclaration(),init_bumpVertexDeclaration(),init_clipPlaneVertexDeclaration(),init_fogVertexDeclaration(),init_lightVxFragmentDeclaration2(),init_lightVxUboDeclaration(),init_morphTargetsVertexGlobalDeclaration(),init_morphTargetsVertexDeclaration(),init_logDepthDeclaration(),init_morphTargetsVertexGlobal(),init_morphTargetsVertex(),init_instancesVertex(),init_bonesVertex(),init_bakedVertexAnimation(),init_prePassVertex(),init_uvVariableDeclaration(),init_samplerVertexImplementation(),init_bumpVertex(),init_clipPlaneVertex(),init_fogVertex(),init_shadowsVertex(),init_vertexColorMixing(),init_logDepthVertex(),name111="defaultVertexShader",shader111="#include<defaultUboDeclaration>\n#define CUSTOM_VERTEX_BEGIN\nattribute position: vec3f;\n#ifdef NORMAL\nattribute normal: vec3f;\n#endif\n#ifdef TANGENT\nattribute tangent: vec4f;\n#endif\n#ifdef UV1\nattribute uv: vec2f;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute color: vec4f;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)\nvarying vPositionW: vec3f;\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar positionUpdated: vec3f=vertexInputs.position;\n#ifdef NORMAL\nvar normalUpdated: vec3f=vertexInputs.normal;\n#endif\n#ifdef TANGENT\nvar tangentUpdated: vec4f=vertexInputs.tangent;\n#endif\n#ifdef UV1\nvar uvUpdated: vec2f=vertexInputs.uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvertexOutputs.vPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvertexOutputs.vCurrentPosition=scene.viewProjection*finalWorld* vec4f(positionUpdated,1.0);vertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld* vec4f(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld*vec4f(positionUpdated,1.0);\n#ifdef NORMAL\nvar normalWorld: mat3x3f= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvertexOutputs.vNormalW=normalUpdated/ vec3f(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vertexOutputs.vNormalW=normalize(normalWorld*vertexOutputs.vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvertexOutputs.vNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {vertexOutputs.position=scene.viewProjection*worldPos;} else {vertexOutputs.position=scene.viewProjectionR*worldPos;}\n#else\nvertexOutputs.position=scene.viewProjection*worldPos;\n#endif\nvertexOutputs.vPositionW= worldPos.xyz;\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvertexOutputs.vDirectionW=normalize((finalWorld* vec4f(positionUpdated,0.0)).xyz);\n#endif\n#ifndef UV1\nvar uvUpdated: vec2f=vec2f(0.,0.);\n#endif\n#ifdef MAINUV1\nvertexOutputs.vMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n",ShaderStore.ShadersStoreWGSL[name111]=shader111,defaultVertexShaderWGSL={name:name111,shader:shader111}}}),name112,shader112,init_prePassDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/prePassDeclaration.js"(){init_shaderStore(),name112="prePassDeclaration",shader112="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vViewPos: vec3f;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying vCurrentPosition: vec4f;varying vPreviousPosition: vec4f;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name112]=shader112}}),name113,shader113,init_oitDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/oitDeclaration.js"(){init_shaderStore(),name113="oitDeclaration",shader113="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#define MAX_DEPTH 99999.0\nvar oitDepthSamplerSampler: sampler;var oitDepthSampler: texture_2d<f32>;var oitFrontColorSamplerSampler: sampler;var oitFrontColorSampler: texture_2d<f32>;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name113]=shader113}}),name114,shader114,init_samplerFragmentDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/samplerFragmentDeclaration.js"(){init_shaderStore(),name114="samplerFragmentDeclaration",shader114="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\nvar _SAMPLERNAME_SamplerSampler: sampler;var _SAMPLERNAME_Sampler: texture_2d<f32>;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name114]=shader114}}),name115,shader115,init_fresnelFunction=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fresnelFunction.js"(){init_shaderStore(),name115="fresnelFunction",shader115="#ifdef FRESNEL\nfn computeFresnelTerm(viewDirection: vec3f,worldNormal: vec3f,bias: f32,power: f32)->f32\n{let fresnelTerm: f32=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name115]=shader115}}),name116,shader116,init_reflectionFunction=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/reflectionFunction.js"(){init_shaderStore(),name116="reflectionFunction",shader116="fn computeFixedEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,direction: vec3f)->vec3f\n{var lon: f32=atan2(direction.z,direction.x);var lat: f32=acos(direction.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(s,t,0); }\nfn computeMirroredFixedEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,direction: vec3f)->vec3f\n{var lon: f32=atan2(direction.z,direction.x);var lat: f32=acos(direction.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(1.0-s,t,0); }\nfn computeEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var cameraToVertex: vec3f=normalize(worldPos.xyz-eyePosition);var r: vec3f=normalize(reflect(cameraToVertex,worldNormal));r= (reflectionMatrix* vec4f(r,0)).xyz;var lon: f32=atan2(r.z,r.x);var lat: f32=acos(r.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(s,t,0);}\nfn computeSphericalCoords(worldPos: vec4f,worldNormal: vec3f,view: mat4x4f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=normalize((view*worldPos).xyz);var viewNormal: vec3f=normalize((view* vec4f(worldNormal,0.0)).xyz);var r: vec3f=reflect(viewDir,viewNormal);r= (reflectionMatrix* vec4f(r,0)).xyz;r.z=r.z-1.0;var m: f32=2.0*length(r);return vec3f(r.x/m+0.5,1.0-r.y/m-0.5,0);}\nfn computePlanarCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=worldPos.xyz-eyePosition;var coords: vec3f=normalize(reflect(viewDir,worldNormal));return (reflectionMatrix* vec4f(coords,1)).xyz;}\nfn computeCubicCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=normalize(worldPos.xyz-eyePosition);var coords: vec3f=reflect(viewDir,worldNormal);coords= (reflectionMatrix* vec4f(coords,0)).xyz;\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nfn computeCubicLocalCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f,reflectionSize: vec3f,reflectionPosition: vec3f)->vec3f\n{var viewDir: vec3f=normalize(worldPos.xyz-eyePosition);var coords: vec3f=reflect(viewDir,worldNormal);coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);coords=(reflectionMatrix* vec4f(coords,0)).xyz;\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nfn computeProjectionCoords(worldPos: vec4f,view: mat4x4f,reflectionMatrix: mat4x4f)->vec3f\n{return (reflectionMatrix*(view*worldPos)).xyz;}\nfn computeSkyBoxCoords(positionW: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{return (reflectionMatrix* vec4f(positionW,1.)).xyz;}\n#ifdef REFLECTION\nfn computeReflectionCoords(worldPos: vec4f,worldNormal: vec3f)->vec3f\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvar direction: vec3f=normalize(fragmentInputs.vDirectionW);return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvar direction: vec3f=normalize(fragmentInputs.vDirectionW);return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,scene.view,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix,uniforms.vReflectionSize,uniforms.vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,scene.view,uniforms.reflectionMatrix);\n#endif\n#ifndef REFLECTIONMAP_CUBIC\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(fragmentInputs.vPositionUVW,uniforms.reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3f(0,0,0);\n#endif\n}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name116]=shader116}}),name117,shader117,init_imageProcessingDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/imageProcessingDeclaration.js"(){init_shaderStore(),name117="imageProcessingDeclaration",shader117="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name117]=shader117}}),name118,shader118,init_imageProcessingFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/imageProcessingFunctions.js"(){init_shaderStore(),name118="imageProcessingFunctions",shader118="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}",ShaderStore.IncludesShadersStoreWGSL[name118]=shader118}}),name119,shader119,init_bumpFragmentMainFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpFragmentMainFunctions.js"(){init_shaderStore(),name119="bumpFragmentMainFunctions",shader119="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying vTBN0: vec3f;varying vTBN1: vec3f;varying vTBN2: vec3f;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform normalMatrix: mat4x4f;fn toNormalMatrix(m: mat4x4f)->mat4x4f\n{var a00=m[0][0];var a01=m[0][1];var a02=m[0][2];var a03=m[0][3];var a10=m[1][0];var a11=m[1][1];var a12=m[1][2];var a13=m[1][3];var a20=m[2][0]; \nvar a21=m[2][1];var a22=m[2][2];var a23=m[2][3];var a30=m[3][0]; \nvar a31=m[3][1];var a32=m[3][2];var a33=m[3][3];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;var mi=mat4x4<f32>(\n(a11*b11-a12*b10+a13*b09)/det,\n(a02*b10-a01*b11-a03*b09)/det,\n(a31*b05-a32*b04+a33*b03)/det,\n(a22*b04-a21*b05-a23*b03)/det,\n(a12*b08-a10*b11-a13*b07)/det,\n(a00*b11-a02*b08+a03*b07)/det,\n(a32*b02-a30*b05-a33*b01)/det,\n(a20*b05-a22*b02+a23*b01)/det,\n(a10*b10-a11*b08+a13*b06)/det,\n(a01*b08-a00*b10-a03*b06)/det,\n(a30*b04-a31*b02+a33*b00)/det,\n(a21*b02-a20*b04-a23*b00)/det,\n(a11*b07-a10*b09-a12*b06)/det,\n(a00*b09-a01*b07+a02*b06)/det,\n(a31*b01-a30*b03-a32*b00)/det,\n(a20*b03-a21*b01+a22*b00)/det);return mat4x4<f32>(mi[0][0],mi[1][0],mi[2][0],mi[3][0],\nmi[0][1],mi[1][1],mi[2][1],mi[3][1],\nmi[0][2],mi[1][2],mi[2][2],mi[3][2],\nmi[0][3],mi[1][3],mi[2][3],mi[3][3]);}\n#endif\nfn perturbNormalBase(cotangentFrame: mat3x3f,normal: vec3f,scale: f32)->vec3f\n{var output=normal;\n#ifdef NORMALXYSCALE\noutput=normalize(output* vec3f(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*output);}\nfn perturbNormal(cotangentFrame: mat3x3f,textureSample: vec3f,scale: f32)->vec3f\n{return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);}\nfn cotangent_frame(normal: vec3f,p: vec3f,uv: vec2f,tangentSpaceParams: vec2f)->mat3x3f\n{var dp1: vec3f=dpdx(p);var dp2: vec3f=dpdy(p);var duv1: vec2f=dpdx(uv);var duv2: vec2f=dpdy(uv);var dp2perp: vec3f=cross(dp2,normal);var dp1perp: vec3f=cross(normal,dp1);var tangent: vec3f=dp2perp*duv1.x+dp1perp*duv2.x;var bitangent: vec3f=dp2perp*duv1.y+dp1perp*duv2.y;tangent*=tangentSpaceParams.x;bitangent*=tangentSpaceParams.y;var det: f32=max(dot(tangent,tangent),dot(bitangent,bitangent));var invmax: f32=select(inverseSqrt(det),0.0,det==0.0);return mat3x3f(tangent*invmax,bitangent*invmax,normal);}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name119]=shader119}}),name120,shader120,init_bumpFragmentFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpFragmentFunctions.js"(){init_shaderStore(),init_samplerFragmentDeclaration(),name120="bumpFragmentFunctions",shader120="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst minSamples: f32=4.;const maxSamples: f32=15.;const iMaxSamples: i32=15;fn parallaxOcclusion(vViewDirCoT: vec3f,vNormalCoT: vec3f,texCoord: vec2f,parallaxScale: f32)->vec2f {var parallaxLimit: f32=length(vViewDirCoT.xy)/vViewDirCoT.z;parallaxLimit*=parallaxScale;var vOffsetDir: vec2f=normalize(vViewDirCoT.xy);var vMaxOffset: vec2f=vOffsetDir*parallaxLimit;var numSamples: f32=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));var stepSize: f32=1.0/numSamples;var currRayHeight: f32=1.0;var vCurrOffset: vec2f= vec2f(0,0);var vLastOffset: vec2f= vec2f(0,0);var lastSampledHeight: f32=1.0;var currSampledHeight: f32=1.0;var keepWorking: bool=true;for (var i: i32=0; i<iMaxSamples; i++)\n{currSampledHeight=textureSample(bumpSampler,bumpSamplerSampler,texCoord+vCurrOffset).w;if (!keepWorking)\n{}\nelse if (currSampledHeight>currRayHeight)\n{var delta1: f32=currSampledHeight-currRayHeight;var delta2: f32=(currRayHeight+stepSize)-lastSampledHeight;var ratio: f32=delta1/(delta1+delta2);vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;keepWorking=false;}\nelse\n{currRayHeight-=stepSize;vLastOffset=vCurrOffset;\n#ifdef PARALLAX_RHS\nvCurrOffset-=stepSize*vMaxOffset;\n#else\nvCurrOffset+=stepSize*vMaxOffset;\n#endif\nlastSampledHeight=currSampledHeight;}}\nreturn vCurrOffset;}\nfn parallaxOffset(viewDir: vec3f,heightScale: f32)->vec2f\n{var height: f32=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).w;var texCoordOffset: vec2f=heightScale*viewDir.xy*height;\n#ifdef PARALLAX_RHS\nreturn texCoordOffset;\n#else\nreturn -texCoordOffset;\n#endif\n}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name120]=shader120}}),name121,shader121,init_bumpFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpFragment.js"(){init_shaderStore(),name121="bumpFragment",shader121="var uvOffset: vec2f= vec2f(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nvar normalScale: f32=1.0;\n#elif defined(BUMP)\nvar normalScale: f32=uniforms.vBumpInfos.y;\n#else\nvar normalScale: f32=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nvar TBN: mat3x3f=mat3x3<f32>(input.vTBN0,input.vTBN1,input.vTBN2); \n#elif defined(BUMP)\nvar TBNUV: vec2f=select(-fragmentInputs.vBumpUV,fragmentInputs.vBumpUV,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW*normalScale,input.vPositionW,TBNUV,uniforms.vTangentSpaceParams);\n#else\nvar TBNUV: vec2f=select(-fragmentInputs.vDetailUV,fragmentInputs.vDetailUV,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW*normalScale,input.vPositionW,TBNUV, vec2f(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvar TBN: mat3x3f=mat3x3<f32>(input.vTBN0,input.vTBN1,input.vTBN2); \n#else\nvar TBNUV: vec2f=select( -fragmentInputs.vMainUV1,fragmentInputs.vMainUV1,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW,input.vPositionW,TBNUV, vec2f(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nvar invTBN: mat3x3f=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,fragmentInputs.vBumpUV,uniforms.vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,uniforms.vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvar detailColor: vec4f=textureSample(detailSampler,detailSamplerSampler,fragmentInputs.vDetailUV+uvOffset);var detailNormalRG: vec2f=detailColor.wy*2.0-1.0;var detailNormalB: f32=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));var detailNormal: vec3f= vec3f(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\n#define CUSTOM_FRAGMENT_BUMP_FRAGMENT\nnormalW=normalize(textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).xyz *2.0-1.0);normalW=normalize(mat3x3f(uniforms.normalMatrix[0].xyz,uniforms.normalMatrix[1].xyz,uniforms.normalMatrix[2].xyz)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV+uvOffset).xyz,uniforms.vBumpInfos.y);\n#else\nvar bumpNormal: vec3f=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);var blendedNormal: vec3f=normalize( vec3f(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);bumpNormal+= vec3f(0.0,0.0,1.0);detailNormal*= vec3f(-1.0,-1.0,1.0);var blendedNormal: vec3f=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,uniforms.vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);normalW=perturbNormalBase(TBN,detailNormal,uniforms.vDetailInfos.z);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name121]=shader121}}),name122,shader122,init_decalFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/decalFragment.js"(){init_shaderStore(),name122="decalFragment",shader122="#ifdef DECAL\nvar decalTempColor=decalColor.rgb;var decalTempAlpha=decalColor.a;\n#ifdef GAMMADECAL\ndecalTempColor=toLinearSpaceVec3(decalColor.rgb);\n#endif\n#ifdef DECAL_SMOOTHALPHA\ndecalTempAlpha=decalColor.a*decalColor.a;\n#endif\nsurfaceAlbedo=mix(surfaceAlbedo.rgb,decalTempColor,decalTempAlpha);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name122]=shader122}}),name123,shader123,init_depthPrePass=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/depthPrePass.js"(){init_shaderStore(),name123="depthPrePass",shader123="#ifdef DEPTHPREPASS\nfragmentOutputs.color= vec4f(0.,0.,0.,1.0);return fragmentOutputs;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name123]=shader123}}),name124,shader124,init_logDepthFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/logDepthFragment.js"(){init_shaderStore(),name124="logDepthFragment",shader124="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name124]=shader124}}),name125,shader125,init_fogFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fogFragment.js"(){init_shaderStore(),name125="fogFragment",shader125="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name125]=shader125}}),name126,shader126,init_oitFragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/oitFragment.js"(){init_shaderStore(),name126="oitFragment",shader126="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nvar fragDepth: f32=fragmentInputs.position.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nvar halfFloat: i32=packHalf2x16( vec2f(fragDepth));var full: vec2f=unpackHalf2x16(halfFloat);fragDepth=full.x;\n#endif\nvar fragCoord: vec2i=vec2i(fragmentInputs.position.xy);var lastDepth: vec2f=textureLoad(oitDepthSampler,fragCoord,0).rg;var lastFrontColor: vec4f=textureLoad(oitFrontColorSampler,fragCoord,0);fragmentOutputs.depth=vec2f(-MAX_DEPTH);fragmentOutputs.frontColor=lastFrontColor;fragmentOutputs.backColor= vec4f(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nvar furthestDepth: f32=-lastDepth.x;var nearestDepth: f32=lastDepth.y;\n#else\nvar nearestDepth: f32=-lastDepth.x;var furthestDepth: f32=lastDepth.y;\n#endif\nvar alphaMultiplier: f32=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn fragmentOutputs;}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\nfragmentOutputs.depth=vec2f(-fragDepth,fragDepth);return fragmentOutputs;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name126]=shader126}}),default_fragment_exports={},name127,shader127,defaultPixelShaderWGSL;__export(default_fragment_exports,{defaultPixelShaderWGSL:()=>defaultPixelShaderWGSL});var init_default_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/default.fragment.js"(){init_shaderStore(),init_defaultUboDeclaration(),init_prePassDeclaration(),init_oitDeclaration(),init_mainUVVaryingDeclaration(),init_helperFunctions(),init_lightUboDeclaration(),init_lightsFragmentFunctions(),init_shadowsFragmentFunctions(),init_samplerFragmentDeclaration(),init_fresnelFunction(),init_reflectionFunction(),init_imageProcessingDeclaration(),init_imageProcessingFunctions(),init_bumpFragmentMainFunctions(),init_bumpFragmentFunctions(),init_clipPlaneFragmentDeclaration(),init_logDepthDeclaration(),init_fogFragmentDeclaration(),init_clipPlaneFragment(),init_bumpFragment(),init_decalFragment(),init_depthPrePass(),init_lightFragment(),init_logDepthFragment(),init_fogFragment(),init_oitFragment(),name127="defaultPixelShader",shader127="#include<defaultUboDeclaration>\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\nvarying vPositionW: vec3f;\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<lightUboDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nvar refractionCubeSamplerSampler: sampler;var refractionCubeSampler: texture_cube<f32>;\n#else\nvar refraction2DSamplerSampler: sampler;var refraction2DSampler: texture_2d<f32>;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nvar reflectionCubeSamplerSampler: sampler;var reflectionCubeSampler: texture_cube<f32>;\n#else\nvar reflection2DSamplerSampler: sampler;var reflection2DSampler: texture_2d<f32>;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar viewDirectionW: vec3f=normalize(scene.vEyePosition.xyz-fragmentInputs.vPositionW);var baseColor: vec4f= vec4f(1.,1.,1.,1.);var diffuseColor: vec3f=uniforms.vDiffuseColor.rgb;var alpha: f32=uniforms.vDiffuseColor.a;\n#ifdef NORMAL\nvar normalW: vec3f=normalize(fragmentInputs.vNormalW);\n#else\nvar normalW: vec3f=normalize(-cross(dpdx(fragmentInputs.vPositionW),dpdy(fragmentInputs.vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=select(-normalW,normalW,fragmentInputs.frontFacing);\n#endif\n#ifdef DIFFUSE\nbaseColor=textureSample(diffuseSampler,diffuseSamplerSampler,fragmentInputs.vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<uniforms.alphaCutOff) {discard;}\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor=vec4f(baseColor.rgb*uniforms.vDiffuseInfos.y,baseColor.a);\n#endif\n#if defined(DECAL) && !defined(DECAL_AFTER_DETAIL)\nvar decalColor: vec4f=textureSample(decalSampler,decalSamplerSampler,fragmentInputs.vDecalUV+uvOffset);\n#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nbaseColor=vec4f(baseColor.rgb*fragmentInputs.vColor.rgb,baseColor.a);\n#endif\n#ifdef DETAIL\nbaseColor=vec4f(baseColor.rgb*2.0*mix(0.5,detailColor.r,uniforms.vDetailInfos.y),baseColor.a);\n#endif\n#if defined(DECAL) && defined(DECAL_AFTER_DETAIL)\nvar decalColor: vec4f=textureSample(decalSampler,decalSamplerSampler,fragmentInputs.vDecalUV+uvOffset);\n#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvar baseAmbientColor: vec3f= vec3f(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=textureSample(ambientSampler,ambientSamplerSampler,fragmentInputs.vAmbientUV+uvOffset).rgb*uniforms.vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nvar glossiness: f32=uniforms.vSpecularColor.a;var specularColor: vec3f=uniforms.vSpecularColor.rgb;\n#ifdef SPECULAR\nvar specularMapColor: vec4f=textureSample(specularSampler,specularSamplerSampler,fragmentInputs.vSpecularUV+uvOffset);specularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nvar glossiness: f32=0.;\n#endif\nvar diffuseBase: vec3f= vec3f(0.,0.,0.);var info: lightingInfo;\n#ifdef SPECULARTERM\nvar specularBase: vec3f= vec3f(0.,0.,0.);\n#endif\nvar shadow: f32=1.;var aggShadow: f32=0.;var numLights: f32=0.;\n#ifdef LIGHTMAP\nvar lightmapColor: vec4f=textureSample(lightmapSampler,lightmapSamplerSampler,fragmentInputs.vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor=vec4f(fromRGBD(lightmapColor),lightmapColor.a);\n#endif\nlightmapColor=vec4f(lightmapColor.rgb*vLightmapInfos.y,lightmapColor.a);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\naggShadow=aggShadow/numLights;var refractionColor: vec4f= vec4f(0.,0.,0.,1.);\n#ifdef REFRACTION\nvar refractionVector: vec3f=normalize(refract(-viewDirectionW,normalW,uniforms.vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(fragmentInputs.vPositionW,refractionVector,uniforms.vRefractionSize,uniforms.vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*uniforms.vRefractionInfos.w;var refractionLookup: vec4f=textureSample(refractionCubeSampler,refractionCubeSamplerSampler,refractionVector);if (dot(refractionVector,viewDirectionW)<1.0) {refractionColor=refractionLookup;}\n#else\nvar vRefractionUVW: vec3f= (uniforms.refractionMatrix*(scene.view* vec4f(fragmentInputs.vPositionW+refractionVector*uniforms.vRefractionInfos.z,1.0))).xyz;var refractionCoords: vec2f=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;refractionColor=textureSample(refraction2DSampler,refraction2DSamplerSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor=vec4f(fromRGBD(refractionColor),refractionColor.a);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=vec4f(toGammaSpaceVec3(refractionColor.rgb),refractionColor.a);\n#endif\nrefractionColor=vec4f(refractionColor.rgb*uniforms.vRefractionInfos.x,refractionColor.a);\n#endif\nvar reflectionColor: vec4f= vec4f(0.,0.,0.,1.);\n#ifdef REFLECTION\nvar vReflectionUVW: vec3f=computeReflectionCoords( vec4f(fragmentInputs.vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW=vec3f(vReflectionUVW.x,vReflectionUVW.y,vReflectionUVW.z*-1.0);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nvar bias: f32=uniforms.vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureSample(reflectionCubeSampler,reflectionCubeSamplerSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureSample(reflectionCubeSampler,reflectionCubeSamplerSampler,vReflectionUVW);\n#endif\n#else\nvar coords: vec2f=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;reflectionColor=textureSample(reflection2DSampler,reflection2DSamplerSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor=vec4f(fromRGBD(reflectionColor),reflectionColor.a);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=vec4f(toGammaSpaceVec3(reflectionColor.rgb),reflectionColor.a);\n#endif\nreflectionColor=vec4f(reflectionColor.rgb*uniforms.vReflectionInfos.x,reflectionColor.a);\n#ifdef REFLECTIONFRESNEL\nvar reflectionFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.reflectionRightColor.a,uniforms.reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor=vec4f(reflectionColor.rgb*specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*uniforms.reflectionRightColor.rgb,reflectionColor.a);\n#else\nreflectionColor=vec4f(reflectionColor.rgb*uniforms.reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*uniforms.reflectionRightColor.rgb,reflectionColor.a);\n#endif\n#else\nreflectionColor=vec4f(reflectionColor.rgb*uniforms.reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*uniforms.reflectionRightColor.rgb,reflectionColor.a);\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nvar refractionFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.refractionRightColor.a,uniforms.refractionLeftColor.a);refractionColor=vec4f(refractionColor.rgb*uniforms.refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*uniforms.refractionRightColor.rgb,refractionColor.a);\n#endif\n#ifdef OPACITY\nvar opacityMap: vec4f=textureSample(opacitySampler,opacitySamplerSampler,fragmentInputs.vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap=vec4f(opacityMap.rgb* vec3f(0.3,0.59,0.11),opacityMap.a);alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* uniforms.vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*uniforms.vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=fragmentInputs.vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nvar opacityFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.opacityParts.z,uniforms.opacityParts.w);alpha+=uniforms.opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*uniforms.opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<uniforms.alphaCutOff) {discard;}\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvar emissiveColor: vec3f=uniforms.vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=textureSample(emissiveSampler,emissiveSamplerSampler,fragmentInputs.vEmissiveUV+uvOffset).rgb*uniforms.vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nvar emissiveFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.emissiveRightColor.a,uniforms.emissiveLeftColor.a);emissiveColor*=uniforms.emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*uniforms.emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nvar diffuseFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.diffuseRightColor.a,uniforms.diffuseLeftColor.a);diffuseBase*=uniforms.diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*uniforms.diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvar finalDiffuse: vec3f=clamp(diffuseBase*diffuseColor+uniforms.vAmbientColor,vec3f(0.0),vec3f(1.0))*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvar finalDiffuse: vec3f=clamp((diffuseBase+emissiveColor)*diffuseColor+uniforms.vAmbientColor,vec3f(0.0),vec3f(1.0))*baseColor.rgb;\n#else\nvar finalDiffuse: vec3f=clamp(diffuseBase*diffuseColor+emissiveColor+uniforms.vAmbientColor,vec3f(0.0),vec3f(1.0))*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvar finalSpecular: vec3f=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular, vec3f(0.3,0.59,0.11)),0.0,1.0);\n#endif\n#else\nvar finalSpecular: vec3f= vec3f(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb, vec3f(0.3,0.59,0.11)),0.0,1.0);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvar color: vec4f= vec4f(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvar color: vec4f= vec4f(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor=vec4f(color.rgb*lightmapColor.rgb,color.a);\n#else\ncolor=vec4f(color.rgb+lightmapColor.rgb,color.a);\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor=vec4f(max(color.rgb,vec3f(0.)),color.a);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor=vec4f(toLinearSpaceVec3(color.rgb),color.a);\n#else\n#ifdef IMAGEPROCESSING\ncolor=vec4f(toLinearSpaceVec3(color.rgb),color.a);color=applyImageProcessing(color);\n#endif\n#endif\ncolor=vec4f(color.rgb,color.a*mesh.visibility);\n#ifdef PREMULTIPLYALPHA\ncolor=vec4f(color.rgb*color.a, color.a);\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nvar writeGeometryInfo: f32=select(0.0,1.0,color.a>0.4);var fragData: array<vec4<f32>,SCENE_MRT_COUNT>;fragData[0]=color; \n#ifdef PREPASS_POSITION\nfragData[PREPASS_POSITION_INDEX]= vec4f(fragmentInputs.vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvar a: vec2f=(fragmentInputs.vCurrentPosition.xy/fragmentInputs.vCurrentPosition.w)*0.5+0.5;var b: vec2f=(fragmentInputs.vPreviousPosition.xy/fragmentInputs.vPreviousPosition.w)*0.5+0.5;var velocity: vec2f=abs(a-b);velocity= vec2f(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;fragData[PREPASS_VELOCITY_INDEX]= vec4f(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\nfragData[PREPASS_IRRADIANCE_INDEX]= vec4f(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\nfragData[PREPASS_DEPTH_INDEX]= vec4f(fragmentInputs.vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\n#ifdef PREPASS_NORMAL_WORLDSPACE\nfragData[PREPASS_NORMAL_INDEX]= vec4f(normalW,writeGeometryInfo); \n#else\nfragData[PREPASS_NORMAL_INDEX]= vec4f(normalize((scene.view* vec4f(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nfragData[PREPASS_ALBEDO_SQRT_INDEX]= vec4f(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f(toLinearSpaceVec4(specularMapColor))*writeGeometryInfo; \n#else\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f(toLinearSpaceVec3(specularColor),1.0)*writeGeometryInfo;\n#endif\n#else\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#if SCENE_MRT_COUNT>0\nfragmentOutputs.fragData0= fragData[0];\n#endif\n#if SCENE_MRT_COUNT>1\nfragmentOutputs.fragData1= fragData[1];\n#endif\n#if SCENE_MRT_COUNT>2\nfragmentOutputs.fragData2= fragData[2];\n#endif\n#if SCENE_MRT_COUNT>3\nfragmentOutputs.fragData3= fragData[3];\n#endif\n#if SCENE_MRT_COUNT>4\nfragmentOutputs.fragData4= fragData[4];\n#endif\n#if SCENE_MRT_COUNT>5\nfragmentOutputs.fragData5= fragData[5];\n#endif\n#if SCENE_MRT_COUNT>6\nfragmentOutputs.fragData6= fragData[6];\n#endif\n#if SCENE_MRT_COUNT>7\nfragmentOutputs.fragData7= fragData[7];\n#endif\n#endif\n#if !defined(PREPASS) && !defined(ORDER_INDEPENDENT_TRANSPARENCY)\nfragmentOutputs.color=color;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {fragmentOutputs.frontColor=vec4f(fragmentOutputs.frontColor.rgb+color.rgb*color.a*alphaMultiplier,1.0-alphaMultiplier*(1.0-color.a));} else {fragmentOutputs.backColor+=color;}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n",ShaderStore.ShadersStoreWGSL[name127]=shader127,defaultPixelShaderWGSL={name:name127,shader:shader127}}}),name128,shader128,init_decalVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/decalVertexDeclaration.js"(){init_shaderStore(),name128="decalVertexDeclaration",shader128="#ifdef DECAL\nuniform vec4 vDecalInfos;uniform mat4 decalMatrix;\n#endif\n",ShaderStore.IncludesShadersStore[name128]=shader128}}),name129,shader129,init_defaultVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultVertexDeclaration.js"(){init_shaderStore(),init_decalVertexDeclaration(),name129="defaultVertexDeclaration",shader129="uniform mat4 viewProjection;uniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;uniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;uniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;uniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;uniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;uniform mat4 detailMatrix;\n#endif\n#include<decalVertexDeclaration>\n#define ADDITIONAL_VERTEX_DECLARATION\n",ShaderStore.IncludesShadersStore[name129]=shader129}}),name130,shader130,init_defaultUboDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultUboDeclaration.js"(){init_shaderStore(),init_sceneUboDeclaration2(),init_meshUboDeclaration2(),name130="defaultUboDeclaration",shader130="layout(std140,column_major) uniform;uniform Material\n{vec4 diffuseLeftColor;vec4 diffuseRightColor;vec4 opacityParts;vec4 reflectionLeftColor;vec4 reflectionRightColor;vec4 refractionLeftColor;vec4 refractionRightColor;vec4 emissiveLeftColor;vec4 emissiveRightColor;vec2 vDiffuseInfos;vec2 vAmbientInfos;vec2 vOpacityInfos;vec2 vReflectionInfos;vec3 vReflectionPosition;vec3 vReflectionSize;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec2 vSpecularInfos;vec3 vBumpInfos;mat4 diffuseMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 reflectionMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 specularMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;float pointSize;float alphaCutOff;mat4 refractionMatrix;vec4 vRefractionInfos;vec3 vRefractionPosition;vec3 vRefractionSize;vec4 vSpecularColor;vec3 vEmissiveColor;vec4 vDiffuseColor;vec3 vAmbientColor;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",ShaderStore.IncludesShadersStore[name130]=shader130}}),name131,shader131,init_uvAttributeDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/uvAttributeDeclaration.js"(){init_shaderStore(),name131="uvAttributeDeclaration",shader131="#ifdef UV{X}\nattribute vec2 uv{X};\n#endif\n",ShaderStore.IncludesShadersStore[name131]=shader131}}),name132,shader132,init_instancesDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/instancesDeclaration.js"(){init_shaderStore(),name132="instancesDeclaration",shader132="#ifdef INSTANCES\nattribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name132]=shader132}}),name133,shader133,init_prePassVertexDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassVertexDeclaration.js"(){init_shaderStore(),name133="prePassVertexDeclaration",shader133="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform mat4 previousViewProjection;varying vec4 vCurrentPosition;varying vec4 vPreviousPosition;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name133]=shader133}}),name134,shader134,init_mainUVVaryingDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/mainUVVaryingDeclaration.js"(){init_shaderStore(),name134="mainUVVaryingDeclaration",shader134="#ifdef MAINUV{X}\nvarying vec2 vMainUV{X};\n#endif\n",ShaderStore.IncludesShadersStore[name134]=shader134}}),name135,shader135,init_samplerVertexDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerVertexDeclaration.js"(){init_shaderStore(),name135="samplerVertexDeclaration",shader135="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n",ShaderStore.IncludesShadersStore[name135]=shader135}}),name136,shader136,init_bumpVertexDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpVertexDeclaration.js"(){init_shaderStore(),name136="bumpVertexDeclaration",shader136="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name136]=shader136}}),name137,shader137,init_fogVertexDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/fogVertexDeclaration.js"(){init_shaderStore(),name137="fogVertexDeclaration",shader137="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n",ShaderStore.IncludesShadersStore[name137]=shader137}}),name138,shader138,init_logDepthDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthDeclaration.js"(){init_shaderStore(),name138="logDepthDeclaration",shader138="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n",ShaderStore.IncludesShadersStore[name138]=shader138}}),name139,shader139,init_prePassVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassVertex.js"(){init_shaderStore(),name139="prePassVertex",shader139="#ifdef PREPASS_DEPTH\nvViewPos=(view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name139]=shader139}}),name140,shader140,init_uvVariableDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/uvVariableDeclaration.js"(){init_shaderStore(),name140="uvVariableDeclaration",shader140="#if !defined(UV{X}) && defined(MAINUV{X})\nvec2 uv{X}=vec2(0.,0.);\n#endif\n#ifdef MAINUV{X}\nvMainUV{X}=uv{X};\n#endif\n",ShaderStore.IncludesShadersStore[name140]=shader140}}),name141,shader141,init_samplerVertexImplementation2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerVertexImplementation.js"(){init_shaderStore(),name141="samplerVertexImplementation",shader141="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (v_INFONAME_==0.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));}\n#ifdef UV2\nelse if (v_INFONAME_==1.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));}\n#endif\n#ifdef UV3\nelse if (v_INFONAME_==2.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));}\n#endif\n#ifdef UV4\nelse if (v_INFONAME_==3.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));}\n#endif\n#ifdef UV5\nelse if (v_INFONAME_==4.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));}\n#endif\n#ifdef UV6\nelse if (v_INFONAME_==5.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));}\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name141]=shader141}}),name142,shader142,init_bumpVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpVertex.js"(){init_shaderStore(),name142="bumpVertex",shader142="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);vec3 tbnTangent=normalize(tangentUpdated.xyz);vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name142]=shader142}}),name143,shader143,init_fogVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/fogVertex.js"(){init_shaderStore(),name143="fogVertex",shader143="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n",ShaderStore.IncludesShadersStore[name143]=shader143}}),name144,shader144,init_vertexColorMixing2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/vertexColorMixing.js"(){init_shaderStore(),name144="vertexColorMixing",shader144="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name144]=shader144}}),name145,shader145,init_pointCloudVertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pointCloudVertex.js"(){init_shaderStore(),name145="pointCloudVertex",shader145="#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n",ShaderStore.IncludesShadersStore[name145]=shader145}}),name146,shader146,init_logDepthVertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthVertex.js"(){init_shaderStore(),name146="logDepthVertex",shader146="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n",ShaderStore.IncludesShadersStore[name146]=shader146}}),default_vertex_exports2={},name147,shader147,defaultVertexShader;__export(default_vertex_exports2,{defaultVertexShader:()=>defaultVertexShader});var init_default_vertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/default.vertex.js"(){init_shaderStore(),init_defaultVertexDeclaration(),init_defaultUboDeclaration2(),init_uvAttributeDeclaration2(),init_helperFunctions2(),init_bonesDeclaration2(),init_bakedVertexAnimationDeclaration2(),init_instancesDeclaration2(),init_prePassVertexDeclaration2(),init_mainUVVaryingDeclaration2(),init_samplerVertexDeclaration2(),init_bumpVertexDeclaration2(),init_clipPlaneVertexDeclaration2(),init_fogVertexDeclaration2(),init_lightVxFragmentDeclaration(),init_lightVxUboDeclaration2(),init_morphTargetsVertexGlobalDeclaration2(),init_morphTargetsVertexDeclaration2(),init_logDepthDeclaration2(),init_morphTargetsVertexGlobal2(),init_morphTargetsVertex2(),init_instancesVertex2(),init_bonesVertex2(),init_bakedVertexAnimation2(),init_prePassVertex2(),init_uvVariableDeclaration2(),init_samplerVertexImplementation2(),init_bumpVertex2(),init_clipPlaneVertex2(),init_fogVertex2(),init_shadowsVertex2(),init_vertexColorMixing2(),init_pointCloudVertex(),init_logDepthVertex2(),name147="defaultVertexShader",shader147="#include<__decl__defaultVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);vPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n",ShaderStore.ShadersStore[name147]=shader147,defaultVertexShader={name:name147,shader:shader147}}}),name148,shader148,init_decalFragmentDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/decalFragmentDeclaration.js"(){init_shaderStore(),name148="decalFragmentDeclaration",shader148="#ifdef DECAL\nuniform vec4 vDecalInfos;\n#endif\n",ShaderStore.IncludesShadersStore[name148]=shader148}}),name149,shader149,init_defaultFragmentDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultFragmentDeclaration.js"(){init_shaderStore(),init_decalFragmentDeclaration(),name149="defaultFragmentDeclaration",shader149="uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;uniform vec3 vAmbientColor;uniform float visibility;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform vec2 vTangentSpaceParams;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;uniform vec4 refractionRightColor;\n#endif\n#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)\nuniform vec3 vRefractionPosition;uniform vec3 vRefractionSize; \n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;uniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;uniform vec4 emissiveRightColor;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;uniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;uniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#include<decalFragmentDeclaration>\n#define ADDITIONAL_FRAGMENT_DECLARATION\n",ShaderStore.IncludesShadersStore[name149]=shader149}}),name150,shader150,init_prePassDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassDeclaration.js"(){init_shaderStore(),name150="prePassDeclaration",shader150="#ifdef PREPASS\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;\n#ifdef PREPASS_DEPTH\nvarying highp vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name150]=shader150}}),name151,shader151,init_oitDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/oitDeclaration.js"(){init_shaderStore(),name151="oitDeclaration",shader151="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out vec2 depth; \nlayout(location=1) out vec4 frontColor;layout(location=2) out vec4 backColor;\n#define MAX_DEPTH 99999.0\nhighp vec4 gl_FragColor;uniform sampler2D oitDepthSampler;uniform sampler2D oitFrontColorSampler;\n#endif\n",ShaderStore.IncludesShadersStore[name151]=shader151}}),name152,shader152,init_samplerFragmentDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerFragmentDeclaration.js"(){init_shaderStore(),name152="samplerFragmentDeclaration",shader152="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\nuniform sampler2D _SAMPLERNAME_Sampler;\n#endif\n",ShaderStore.IncludesShadersStore[name152]=shader152}}),name153,shader153,init_fresnelFunction2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/fresnelFunction.js"(){init_shaderStore(),name153="fresnelFunction",shader153="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}\n#endif\n",ShaderStore.IncludesShadersStore[name153]=shader153}}),name154,shader154,init_reflectionFunction2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/reflectionFunction.js"(){init_shaderStore(),name154="reflectionFunction",shader154="vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0); }\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(1.0-s,t,0); }\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);vec3 r=normalize(reflect(cameraToVertex,worldNormal));r=vec3(reflectionMatrix*vec4(r,0));float lon=atan(r.z,r.x);float lat=acos(r.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0);}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{vec3 viewDir=normalize(vec3(view*worldPos));vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));vec3 r=reflect(viewDir,viewNormal);r=vec3(reflectionMatrix*vec4(r,0));r.z=r.z-1.0;float m=2.0*length(r);return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 viewDir=worldPos.xyz-eyePosition;vec3 coords=normalize(reflect(viewDir,worldNormal));return vec3(reflectionMatrix*vec4(coords,1));}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);coords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{return vec3(reflectionMatrix*(view*worldPos));}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{return vec3(reflectionMatrix*vec4(positionW,1.));}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\n",ShaderStore.IncludesShadersStore[name154]=shader154}}),name155,shader155,init_imageProcessingDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/imageProcessingDeclaration.js"(){init_shaderStore(),name155="imageProcessingDeclaration",shader155="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n",ShaderStore.IncludesShadersStore[name155]=shader155}}),name156,shader156,init_imageProcessingFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/imageProcessingFunctions.js"(){init_shaderStore(),name156="imageProcessingFunctions",shader156="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}",ShaderStore.IncludesShadersStore[name156]=shader156}}),name157,shader157,init_bumpFragmentMainFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragmentMainFunctions.js"(){init_shaderStore(),name157="bumpFragmentMainFunctions",shader157="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#if defined(WEBGL2) || defined(WEBGPU)\nmat4 toNormalMatrix(mat4 wMatrix)\n{mat4 ret=inverse(wMatrix);ret=transpose(ret);ret[0][3]=0.;ret[1][3]=0.;ret[2][3]=0.;ret[3]=vec4(0.,0.,0.,1.);return ret;}\n#else\nmat4 toNormalMatrix(mat4 m)\n{float\na00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],\na10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],\na20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],\na30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],\nb00=a00*a11-a01*a10,\nb01=a00*a12-a02*a10,\nb02=a00*a13-a03*a10,\nb03=a01*a12-a02*a11,\nb04=a01*a13-a03*a11,\nb05=a02*a13-a03*a12,\nb06=a20*a31-a21*a30,\nb07=a20*a32-a22*a30,\nb08=a20*a33-a23*a30,\nb09=a21*a32-a22*a31,\nb10=a21*a33-a23*a31,\nb11=a22*a33-a23*a32,\ndet=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;mat4 mi=mat4(\na11*b11-a12*b10+a13*b09,\na02*b10-a01*b11-a03*b09,\na31*b05-a32*b04+a33*b03,\na22*b04-a21*b05-a23*b03,\na12*b08-a10*b11-a13*b07,\na00*b11-a02*b08+a03*b07,\na32*b02-a30*b05-a33*b01,\na20*b05-a22*b02+a23*b01,\na10*b10-a11*b08+a13*b06,\na01*b08-a00*b10-a03*b06,\na30*b04-a31*b02+a33*b00,\na21*b02-a20*b04-a23*b00,\na11*b07-a10*b09-a12*b06,\na00*b09-a01*b07+a02*b06,\na31*b01-a30*b03-a32*b00,\na20*b03-a21*b01+a22*b00)/det;return mat4(mi[0][0],mi[1][0],mi[2][0],mi[3][0],\nmi[0][1],mi[1][1],mi[2][1],mi[3][1],\nmi[0][2],mi[1][2],mi[2][2],mi[3][2],\nmi[0][3],mi[1][3],mi[2][3],mi[3][3]);}\n#endif\n#endif\nvec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)\n{\n#ifdef NORMALXYSCALE\nnormal=normalize(normal*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*normal);}\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);}\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{vec3 dp1=dFdx(p);vec3 dp2=dFdy(p);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;tangent*=tangentSpaceParams.x;bitangent*=tangentSpaceParams.y;float det=max(dot(tangent,tangent),dot(bitangent,bitangent));float invmax=det==0.0 ? 0.0 : inversesqrt(det);return mat3(tangent*invmax,bitangent*invmax,normal);}\n#endif\n",ShaderStore.IncludesShadersStore[name157]=shader157}}),name158,shader158,init_bumpFragmentFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragmentFunctions.js"(){init_shaderStore(),init_samplerFragmentDeclaration2(),name158="bumpFragmentFunctions",shader158="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;const float maxSamples=15.;const int iMaxSamples=15;vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;parallaxLimit*=parallaxScale;vec2 vOffsetDir=normalize(vViewDirCoT.xy);vec2 vMaxOffset=vOffsetDir*parallaxLimit;float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));float stepSize=1.0/numSamples;float currRayHeight=1.0;vec2 vCurrOffset=vec2(0,0);vec2 vLastOffset=vec2(0,0);float lastSampledHeight=1.0;float currSampledHeight=1.0;bool keepWorking=true;for (int i=0; i<iMaxSamples; i++)\n{currSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;if (!keepWorking)\n{}\nelse if (currSampledHeight>currRayHeight)\n{float delta1=currSampledHeight-currRayHeight;float delta2=(currRayHeight+stepSize)-lastSampledHeight;float ratio=delta1/(delta1+delta2);vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;keepWorking=false;}\nelse\n{currRayHeight-=stepSize;vLastOffset=vCurrOffset;\n#ifdef PARALLAX_RHS\nvCurrOffset-=stepSize*vMaxOffset;\n#else\nvCurrOffset+=stepSize*vMaxOffset;\n#endif\nlastSampledHeight=currSampledHeight;}}\nreturn vCurrOffset;}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{float height=texture2D(bumpSampler,vBumpUV).w;vec2 texCoordOffset=heightScale*viewDir.xy*height;\n#ifdef PARALLAX_RHS\nreturn texCoordOffset;\n#else\nreturn -texCoordOffset;\n#endif\n}\n#endif\n",ShaderStore.IncludesShadersStore[name158]=shader158}}),name159,shader159,init_bumpFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragment.js"(){init_shaderStore(),name159="bumpFragment",shader159="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#elif defined(BUMP)\nfloat normalScale=vBumpInfos.y;\n#else\nfloat normalScale=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#elif defined(BUMP)\nvec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);\n#else\nvec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nvec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;mat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);vec2 detailNormalRG=detailColor.wy*2.0-1.0;float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));vec3 detailNormal=vec3(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\n#define CUSTOM_FRAGMENT_BUMP_FRAGMENT\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);normalW=normalize(mat3(normalMatrix)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);\n#else\nvec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal.xy*=vDetailInfos.z;vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal.xy*=vDetailInfos.z;bumpNormal+=vec3(0.0,0.0,1.0);detailNormal*=vec3(-1.0,-1.0,1.0);vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal.xy*=vDetailInfos.z;normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);\n#endif\n",ShaderStore.IncludesShadersStore[name159]=shader159}}),name160,shader160,init_decalFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/decalFragment.js"(){init_shaderStore(),name160="decalFragment",shader160="#ifdef DECAL\n#ifdef GAMMADECAL\ndecalColor.rgb=toLinearSpace(decalColor.rgb);\n#endif\n#ifdef DECAL_SMOOTHALPHA\ndecalColor.a*=decalColor.a;\n#endif\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,decalColor.rgb,decalColor.a);\n#endif\n",ShaderStore.IncludesShadersStore[name160]=shader160}}),name161,shader161,init_depthPrePass2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/depthPrePass.js"(){init_shaderStore(),name161="depthPrePass",shader161="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);return;\n#endif\n",ShaderStore.IncludesShadersStore[name161]=shader161}}),name162,shader162,init_logDepthFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthFragment.js"(){init_shaderStore(),name162="logDepthFragment",shader162="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n",ShaderStore.IncludesShadersStore[name162]=shader162}}),name163,shader163,init_fogFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/fogFragment.js"(){init_shaderStore(),name163="fogFragment",shader163="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n",ShaderStore.IncludesShadersStore[name163]=shader163}}),name164,shader164,init_oitFragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/oitFragment.js"(){init_shaderStore(),name164="oitFragment",shader164="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nfloat fragDepth=gl_FragCoord.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nuint halfFloat=packHalf2x16(vec2(fragDepth));vec2 full=unpackHalf2x16(halfFloat);fragDepth=full.x;\n#endif\nivec2 fragCoord=ivec2(gl_FragCoord.xy);vec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;vec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);depth.rg=vec2(-MAX_DEPTH);frontColor=lastFrontColor;backColor=vec4(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nfloat furthestDepth=-lastDepth.x;float nearestDepth=lastDepth.y;\n#else\nfloat nearestDepth=-lastDepth.x;float furthestDepth=lastDepth.y;\n#endif\nfloat alphaMultiplier=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn;}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\ndepth.rg=vec2(-fragDepth,fragDepth);return;}\n#endif\n",ShaderStore.IncludesShadersStore[name164]=shader164}}),default_fragment_exports2={},name165,shader165,defaultPixelShader;__export(default_fragment_exports2,{defaultPixelShader:()=>defaultPixelShader});var init_default_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/default.fragment.js"(){init_shaderStore(),init_defaultFragmentDeclaration(),init_defaultUboDeclaration2(),init_prePassDeclaration2(),init_oitDeclaration2(),init_mainUVVaryingDeclaration2(),init_helperFunctions2(),init_lightFragmentDeclaration(),init_lightUboDeclaration2(),init_lightsFragmentFunctions2(),init_shadowsFragmentFunctions2(),init_samplerFragmentDeclaration2(),init_fresnelFunction2(),init_reflectionFunction2(),init_imageProcessingDeclaration2(),init_imageProcessingFunctions2(),init_bumpFragmentMainFunctions2(),init_bumpFragmentFunctions2(),init_clipPlaneFragmentDeclaration2(),init_logDepthDeclaration2(),init_fogFragmentDeclaration2(),init_clipPlaneFragment2(),init_bumpFragment2(),init_decalFragment2(),init_depthPrePass2(),init_lightFragment2(),init_logDepthFragment2(),init_fogFragment2(),init_oitFragment2(),name165="defaultPixelShader",shader165="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#if defined(DECAL) && !defined(DECAL_AFTER_DETAIL)\nvec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);\n#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef DETAIL\nbaseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);\n#endif\n#if defined(DECAL) && defined(DECAL_AFTER_DETAIL)\nvec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);\n#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;vec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);specularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;float aggShadow=0.;float numLights=0.;\n#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\naggShadow=aggShadow/numLights;vec4 refractionColor=vec4(0.,0.,0.,1.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,vRefractionSize,vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;vec4 refractionLookup=textureCube(refractionCubeSampler,refractionVector);if (dot(refractionVector,viewDirectionW)<1.0) {refractionColor=refractionLookup;}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;refractionColor=texture2D(refraction2DSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor.rgb=fromRGBD(refractionColor);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor.rgb=toGammaSpace(refractionColor.rgb);\n#endif\nrefractionColor.rgb*=vRefractionInfos.x;\n#endif\nvec4 reflectionColor=vec4(0.,0.,0.,1.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;reflectionColor=texture2D(reflection2DSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor.rgb=toGammaSpace(reflectionColor.rgb);\n#endif\nreflectionColor.rgb*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);refractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<alphaCutOff)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor.rgb;\n#else\ncolor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);color=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;gl_FragData[0]=color; \n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;vec2 velocity=abs(a-b);velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\n#ifdef PREPASS_NORMAL_WORLDSPACE\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalW,writeGeometryInfo); \n#else\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalize((view*vec4(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toLinearSpace(specularMapColor))*writeGeometryInfo; \n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toLinearSpace(specularColor),1.0)*writeGeometryInfo;\n#endif\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=color;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {frontColor.rgb+=color.rgb*color.a*alphaMultiplier;frontColor.a=1.0-alphaMultiplier*(1.0-color.a);} else {backColor+=color;}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n",ShaderStore.ShadersStore[name165]=shader165,defaultPixelShader={name:name165,shader:shader165}}}),sprites_vertex_exports={},name166,shader166,spritesVertexShaderWGSL;__export(sprites_vertex_exports,{spritesVertexShaderWGSL:()=>spritesVertexShaderWGSL});var init_sprites_vertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/sprites.vertex.js"(){init_shaderStore(),init_fogVertexDeclaration(),init_logDepthDeclaration(),init_logDepthVertex(),name166="spritesVertexShader",shader166="attribute position: vec4f;attribute options: vec2f;attribute offsets: vec2f;attribute inverts: vec2f;attribute cellInfo: vec4f;attribute color: vec4f;uniform view: mat4x4f;uniform projection: mat4x4f;varying vUV: vec2f;varying vColor: vec4f;\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar viewPos: vec3f=(uniforms.view* vec4f(input.position.xyz,1.0)).xyz; \nvar cornerPos: vec2f;var angle: f32=input.position.w;var size: vec2f= vec2f(input.options.x,input.options.y);var offset: vec2f=input.offsets.xy;cornerPos= vec2f(offset.x-0.5,offset.y -0.5)*size;var rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;viewPos+=rotatedCorner;vertexOutputs.position=uniforms.projection*vec4f(viewPos,1.0); \nvertexOutputs.vColor=input.color;var uvOffset: vec2f= vec2f(abs(offset.x-input.inverts.x),abs(1.0-offset.y-input.inverts.y));var uvPlace: vec2f=input.cellInfo.xy;var uvSize: vec2f=input.cellInfo.zw;vertexOutputs.vUV.x=uvPlace.x+uvSize.x*uvOffset.x;vertexOutputs.vUV.y=uvPlace.y+uvSize.y*uvOffset.y;\n#ifdef FOG\nvertexOutputs.vFogDistance=viewPos;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStoreWGSL[name166]=shader166,spritesVertexShaderWGSL={name:name166,shader:shader166}}}),name167,shader167,init_imageProcessingCompatibility=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/imageProcessingCompatibility.js"(){init_shaderStore(),name167="imageProcessingCompatibility",shader167="#ifdef IMAGEPROCESSINGPOSTPROCESS\nfragmentOutputs.color=vec4f(pow(fragmentOutputs.color.rgb, vec3f(2.2)),fragmentOutputs.color.a);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name167]=shader167}}),sprites_fragment_exports={},name168,shader168,spritesPixelShaderWGSL;__export(sprites_fragment_exports,{spritesPixelShaderWGSL:()=>spritesPixelShaderWGSL});var init_sprites_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/sprites.fragment.js"(){init_shaderStore(),init_fogFragmentDeclaration(),init_logDepthDeclaration(),init_logDepthFragment(),init_fogFragment(),init_imageProcessingCompatibility(),name168="spritesPixelShader",shader168="uniform alphaTest: i32;varying vColor: vec4f;varying vUV: vec2f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<fogFragmentDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#ifdef PIXEL_PERFECT\nfn uvPixelPerfect(uv: vec2f)->vec2f {var res: vec2f= vec2f(textureDimensions(diffuseSampler,0));var uvTemp=uv*res;var seam: vec2f=floor(uvTemp+0.5);uvTemp=seam+clamp((uvTemp-seam)/fwidth(uvTemp),vec2f(-0.5),vec2f(0.5));return uvTemp/res;}\n#endif\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#ifdef PIXEL_PERFECT\nvar uv: vec2f=uvPixelPerfect(input.vUV);\n#else\nvar uv: vec2f=input.vUV;\n#endif\nvar color: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,uv);var fAlphaTest: f32= f32(uniforms.alphaTest);if (fAlphaTest != 0.)\n{if (color.a<0.95) {discard;}}\ncolor*=input.vColor;\n#include<logDepthFragment>\n#include<fogFragment>\nfragmentOutputs.color=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}",ShaderStore.ShadersStoreWGSL[name168]=shader168,spritesPixelShaderWGSL={name:name168,shader:shader168}}}),sprites_vertex_exports2={},name169,shader169,spritesVertexShader;__export(sprites_vertex_exports2,{spritesVertexShader:()=>spritesVertexShader});var init_sprites_vertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/sprites.vertex.js"(){init_shaderStore(),init_fogVertexDeclaration2(),init_logDepthDeclaration2(),init_logDepthVertex2(),name169="spritesVertexShader",shader169="attribute vec4 position;attribute vec2 options;attribute vec2 offsets;attribute vec2 inverts;attribute vec4 cellInfo;attribute vec4 color;uniform mat4 view;uniform mat4 projection;varying vec2 vUV;varying vec4 vColor;\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;float angle=position.w;vec2 size=vec2(options.x,options.y);vec2 offset=offsets.xy;cornerPos=vec2(offset.x-0.5,offset.y -0.5)*size;vec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;viewPos+=rotatedCorner;gl_Position=projection*vec4(viewPos,1.0); \nvColor=color;vec2 uvOffset=vec2(abs(offset.x-inverts.x),abs(1.0-offset.y-inverts.y));vec2 uvPlace=cellInfo.xy;vec2 uvSize=cellInfo.zw;vUV.x=uvPlace.x+uvSize.x*uvOffset.x;vUV.y=uvPlace.y+uvSize.y*uvOffset.y;\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStore[name169]=shader169,spritesVertexShader={name:name169,shader:shader169}}}),name170,shader170,init_imageProcessingCompatibility2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/imageProcessingCompatibility.js"(){init_shaderStore(),name170="imageProcessingCompatibility",shader170="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n",ShaderStore.IncludesShadersStore[name170]=shader170}}),sprites_fragment_exports2={},name171,shader171,spritesPixelShader;__export(sprites_fragment_exports2,{spritesPixelShader:()=>spritesPixelShader});var init_sprites_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/sprites.fragment.js"(){init_shaderStore(),init_fogFragmentDeclaration2(),init_logDepthDeclaration2(),init_logDepthFragment2(),init_fogFragment2(),init_imageProcessingCompatibility2(),name171="spritesPixelShader",shader171="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform bool alphaTest;varying vec4 vColor;varying vec2 vUV;uniform sampler2D diffuseSampler;\n#include<fogFragmentDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#ifdef PIXEL_PERFECT\nvec2 uvPixelPerfect(vec2 uv) {vec2 res=vec2(textureSize(diffuseSampler,0));uv=uv*res;vec2 seam=floor(uv+0.5);uv=seam+clamp((uv-seam)/fwidth(uv),-0.5,0.5);return uv/res;}\n#endif\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#ifdef PIXEL_PERFECT\nvec2 uv=uvPixelPerfect(vUV);\n#else\nvec2 uv=vUV;\n#endif\nvec4 color=texture2D(diffuseSampler,uv);float fAlphaTest=float(alphaTest);if (fAlphaTest != 0.)\n{if (color.a<0.95)\ndiscard;}\ncolor*=vColor;\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}",ShaderStore.ShadersStore[name171]=shader171,spritesPixelShader={name:name171,shader:shader171}}}),color_vertex_exports={},name172,shader172,colorVertexShaderWGSL;__export(color_vertex_exports,{colorVertexShaderWGSL:()=>colorVertexShaderWGSL});var init_color_vertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/color.vertex.js"(){init_shaderStore(),init_bonesDeclaration(),init_bakedVertexAnimationDeclaration(),init_clipPlaneVertexDeclaration(),init_fogVertexDeclaration(),init_instancesDeclaration(),init_instancesVertex(),init_bonesVertex(),init_bakedVertexAnimation(),init_clipPlaneVertex(),init_fogVertex(),init_vertexColorMixing(),name172="colorVertexShader",shader172="attribute position: vec3f;\n#ifdef VERTEXCOLOR\nattribute color: vec4f;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#ifdef FOG\nuniform view: mat4x4f;\n#endif\n#include<instancesDeclaration>\nuniform viewProjection: mat4x4f;\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld* vec4f(input.position,1.0);vertexOutputs.position=uniforms.viewProjection*worldPos;\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<vertexColorMixing>\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStoreWGSL[name172]=shader172,colorVertexShaderWGSL={name:name172,shader:shader172}}}),color_fragment_exports={},name173,shader173,colorPixelShaderWGSL;__export(color_fragment_exports,{colorPixelShaderWGSL:()=>colorPixelShaderWGSL});var init_color_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/color.fragment.js"(){init_shaderStore(),init_clipPlaneFragmentDeclaration(),init_fogFragmentDeclaration(),init_clipPlaneFragment(),init_fogFragment(),name173="colorPixelShader",shader173="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\n#define VERTEXCOLOR\nvarying vColor: vec4f;\n#else\nuniform color: vec4f;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nfragmentOutputs.color=input.vColor;\n#else\nfragmentOutputs.color=uniforms.color;\n#endif\n#include<fogFragment>(color,fragmentOutputs.color)\n#define CUSTOM_FRAGMENT_MAIN_END\n}",ShaderStore.ShadersStoreWGSL[name173]=shader173,colorPixelShaderWGSL={name:name173,shader:shader173}}}),color_vertex_exports2={},name174,shader174,colorVertexShader;__export(color_vertex_exports2,{colorVertexShader:()=>colorVertexShader});var init_color_vertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/color.vertex.js"(){init_shaderStore(),init_bonesDeclaration2(),init_bakedVertexAnimationDeclaration2(),init_clipPlaneVertexDeclaration2(),init_fogVertexDeclaration2(),init_instancesDeclaration2(),init_instancesVertex2(),init_bonesVertex2(),init_bakedVertexAnimation2(),init_clipPlaneVertex2(),init_fogVertex2(),init_vertexColorMixing2(),name174="colorVertexShader",shader174="attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#ifdef FOG\nuniform mat4 view;\n#endif\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<vertexColorMixing>\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStore[name174]=shader174,colorVertexShader={name:name174,shader:shader174}}}),color_fragment_exports2={},name175,shader175,colorPixelShader;__export(color_fragment_exports2,{colorPixelShader:()=>colorPixelShader});var init_color_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/color.fragment.js"(){init_shaderStore(),init_clipPlaneFragmentDeclaration2(),init_fogFragmentDeclaration2(),init_clipPlaneFragment2(),init_fogFragment2(),name175="colorPixelShader",shader175="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\n#define VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n#include<fogFragment>(color,gl_FragColor)\n#define CUSTOM_FRAGMENT_MAIN_END\n}",ShaderStore.ShadersStore[name175]=shader175,colorPixelShader={name:name175,shader:shader175}}}),depth_fragment_exports={},name176,shader176,depthPixelShader;__export(depth_fragment_exports,{depthPixelShader:()=>depthPixelShader});var init_depth_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/depth.fragment.js"(){init_shaderStore(),init_clipPlaneFragmentDeclaration2(),init_packingFunctions2(),init_clipPlaneFragment2(),name176="depthPixelShader",shader176="#ifdef ALPHATEST\nvarying vec2 vUV;uniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvarying float vDepthMetric;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\n#ifdef STORE_CAMERASPACE_Z\nvarying vec4 vViewPos;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef STORE_CAMERASPACE_Z\n#ifdef PACKED\ngl_FragColor=pack(vViewPos.z);\n#else\ngl_FragColor=vec4(vViewPos.z,0.0,0.0,1.0);\n#endif\n#else\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\ngl_FragColor=pack(gl_FragCoord.z);\n#else\ngl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\ngl_FragColor=pack(vDepthMetric);\n#else\ngl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n#endif\n}",ShaderStore.ShadersStore[name176]=shader176,depthPixelShader={name:name176,shader:shader176}}}),name177,shader177,init_pointCloudVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pointCloudVertexDeclaration.js"(){init_shaderStore(),name177="pointCloudVertexDeclaration",shader177="#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",ShaderStore.IncludesShadersStore[name177]=shader177}}),depth_vertex_exports={},name178,shader178,depthVertexShader;__export(depth_vertex_exports,{depthVertexShader:()=>depthVertexShader});var init_depth_vertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/depth.vertex.js"(){init_shaderStore(),init_bonesDeclaration2(),init_bakedVertexAnimationDeclaration2(),init_morphTargetsVertexGlobalDeclaration2(),init_morphTargetsVertexDeclaration2(),init_clipPlaneVertexDeclaration2(),init_instancesDeclaration2(),init_pointCloudVertexDeclaration(),init_morphTargetsVertexGlobal2(),init_morphTargetsVertex2(),init_instancesVertex2(),init_bonesVertex2(),init_bakedVertexAnimation2(),init_clipPlaneVertex2(),init_pointCloudVertex(),name178="depthVertexShader",shader178="attribute vec3 position;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;uniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;uniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#ifdef STORE_CAMERASPACE_Z\nuniform mat4 view;varying vec4 vViewPos;\n#endif\n#include<pointCloudVertexDeclaration>\nvarying float vDepthMetric;\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{vec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#include<clipPlaneVertex>\ngl_Position=viewProjection*worldPos;\n#ifdef STORE_CAMERASPACE_Z\nvViewPos=view*worldPos;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));\n#else\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#endif\n#endif\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<pointCloudVertex>\n}\n",ShaderStore.ShadersStore[name178]=shader178,depthVertexShader={name:name178,shader:shader178}}}),depth_vertex_exports2={},name179,shader179,depthVertexShaderWGSL;__export(depth_vertex_exports2,{depthVertexShaderWGSL:()=>depthVertexShaderWGSL});var init_depth_vertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/depth.vertex.js"(){init_shaderStore(),init_bonesDeclaration(),init_bakedVertexAnimationDeclaration(),init_morphTargetsVertexGlobalDeclaration(),init_morphTargetsVertexDeclaration(),init_clipPlaneVertexDeclaration(),init_instancesDeclaration(),init_morphTargetsVertexGlobal(),init_morphTargetsVertex(),init_instancesVertex(),init_bonesVertex(),init_bakedVertexAnimation(),init_clipPlaneVertex(),name179="depthVertexShader",shader179="attribute position: vec3f;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform viewProjection: mat4x4f;uniform depthValues: vec2f;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vUV: vec2f;uniform diffuseMatrix: mat4x4f;\n#ifdef UV1\nattribute uv: vec2f;\n#endif\n#ifdef UV2\nattribute uv2: vec2f;\n#endif\n#endif\n#ifdef STORE_CAMERASPACE_Z\nuniform view: mat4x4f;varying vViewPos: vec4f;\n#endif\nvarying vDepthMetric: f32;\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {var positionUpdated: vec3f=input.position;\n#ifdef UV1\nvar uvUpdated: vec2f=input.uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld* vec4f(positionUpdated,1.0);\n#include<clipPlaneVertex>\nvertexOutputs.position=uniforms.viewProjection*worldPos;\n#ifdef STORE_CAMERASPACE_Z\nvertexOutputs.vViewPos=uniforms.view*worldPos;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric=((-vertexOutputs.position.z+uniforms.depthValues.x)/(uniforms.depthValues.y));\n#else\nvertexOutputs.vDepthMetric=((vertexOutputs.position.z+uniforms.depthValues.x)/(uniforms.depthValues.y));\n#endif\n#endif\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvertexOutputs.vUV= (uniforms.diffuseMatrix* vec4f(uvUpdated,1.0,0.0)).xy;\n#endif\n#ifdef UV2\nvertexOutputs.vUV= (uniforms.diffuseMatrix* vec4f(input.uv2,1.0,0.0)).xy;\n#endif\n#endif\n}\n",ShaderStore.ShadersStoreWGSL[name179]=shader179,depthVertexShaderWGSL={name:name179,shader:shader179}}}),depth_fragment_exports2={},name180,shader180,depthPixelShaderWGSL;__export(depth_fragment_exports2,{depthPixelShaderWGSL:()=>depthPixelShaderWGSL});var init_depth_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/depth.fragment.js"(){init_shaderStore(),init_clipPlaneFragmentDeclaration(),init_packingFunctions(),init_clipPlaneFragment(),name180="depthPixelShader",shader180="#ifdef ALPHATEST\nvarying vUV: vec2f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvarying vDepthMetric: f32;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\n#ifdef STORE_CAMERASPACE_Z\nvarying vViewPos: vec4f;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV).a<0.4) {discard;}\n#endif\n#ifdef STORE_CAMERASPACE_Z\n#ifdef PACKED\nfragmentOutputs.color=pack(input.vViewPos.z);\n#else\nfragmentOutputs.color= vec4f(input.vViewPos.z,0.0,0.0,1.0);\n#endif\n#else\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\nfragmentOutputs.color=pack(input.position.z);\n#else\nfragmentOutputs.color= vec4f(input.position.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\nfragmentOutputs.color=pack(input.vDepthMetric);\n#else\nfragmentOutputs.color= vec4f(input.vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n#endif\n}",ShaderStore.ShadersStoreWGSL[name180]=shader180,depthPixelShaderWGSL={name:name180,shader:shader180}}}),rgbdDecode_fragment_exports={},name182,shader182,rgbdDecodePixelShaderWGSL;__export(rgbdDecode_fragment_exports,{rgbdDecodePixelShaderWGSL:()=>rgbdDecodePixelShaderWGSL});var init_rgbdDecode_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/rgbdDecode.fragment.js"(){init_shaderStore(),init_helperFunctions(),name182="rgbdDecodePixelShader",shader182="varying vUV: vec2f;var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=vec4f(fromRGBD(textureSample(textureSampler,textureSamplerSampler,input.vUV)),1.0);}",ShaderStore.ShadersStoreWGSL[name182]=shader182,rgbdDecodePixelShaderWGSL={name:name182,shader:shader182}}}),rgbdEncode_fragment_exports={},name183,shader183,rgbdEncodePixelShaderWGSL;__export(rgbdEncode_fragment_exports,{rgbdEncodePixelShaderWGSL:()=>rgbdEncodePixelShaderWGSL});var init_rgbdEncode_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/rgbdEncode.fragment.js"(){init_shaderStore(),init_helperFunctions(),name183="rgbdEncodePixelShader",shader183="varying vUV: vec2f;var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=toRGBD(textureSample(textureSampler,textureSamplerSampler,input.vUV).rgb);}",ShaderStore.ShadersStoreWGSL[name183]=shader183,rgbdEncodePixelShaderWGSL={name:name183,shader:shader183}}}),rgbdDecode_fragment_exports2={},name184,shader184,rgbdDecodePixelShader;__export(rgbdDecode_fragment_exports2,{rgbdDecodePixelShader:()=>rgbdDecodePixelShader});var init_rgbdDecode_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/rgbdDecode.fragment.js"(){init_shaderStore(),init_helperFunctions2(),name184="rgbdDecodePixelShader",shader184="varying vec2 vUV;uniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);}",ShaderStore.ShadersStore[name184]=shader184,rgbdDecodePixelShader={name:name184,shader:shader184}}}),rgbdEncode_fragment_exports2={},name185,shader185,rgbdEncodePixelShader;__export(rgbdEncode_fragment_exports2,{rgbdEncodePixelShader:()=>rgbdEncodePixelShader});var init_rgbdEncode_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/rgbdEncode.fragment.js"(){init_shaderStore(),init_helperFunctions2(),name185="rgbdEncodePixelShader",shader185="varying vec2 vUV;uniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);}",ShaderStore.ShadersStore[name185]=shader185,rgbdEncodePixelShader={name:name185,shader:shader185}}}),name186,shader186,init_pbrUboDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrUboDeclaration.js"(){init_shaderStore(),init_sceneUboDeclaration(),init_meshUboDeclaration(),name186="pbrUboDeclaration",shader186="uniform vAlbedoInfos: vec2f;uniform vAmbientInfos: vec4f;uniform vOpacityInfos: vec2f;uniform vEmissiveInfos: vec2f;uniform vLightmapInfos: vec2f;uniform vReflectivityInfos: vec3f;uniform vMicroSurfaceSamplerInfos: vec2f;uniform vReflectionInfos: vec2f;uniform vReflectionFilteringInfo: vec2f;uniform vReflectionPosition: vec3f;uniform vReflectionSize: vec3f;uniform vBumpInfos: vec3f;uniform albedoMatrix: mat4x4f;uniform ambientMatrix: mat4x4f;uniform opacityMatrix: mat4x4f;uniform emissiveMatrix: mat4x4f;uniform lightmapMatrix: mat4x4f;uniform reflectivityMatrix: mat4x4f;uniform microSurfaceSamplerMatrix: mat4x4f;uniform bumpMatrix: mat4x4f;uniform vTangentSpaceParams: vec2f;uniform reflectionMatrix: mat4x4f;uniform vReflectionColor: vec3f;uniform vAlbedoColor: vec4f;uniform vLightingIntensity: vec4f;uniform vReflectionMicrosurfaceInfos: vec3f;uniform pointSize: f32;uniform vReflectivityColor: vec4f;uniform vEmissiveColor: vec3f;uniform vAmbientColor: vec3f;uniform vDebugMode: vec2f;uniform vMetallicReflectanceFactors: vec4f;uniform vMetallicReflectanceInfos: vec2f;uniform metallicReflectanceMatrix: mat4x4f;uniform vReflectanceInfos: vec2f;uniform reflectanceMatrix: mat4x4f;uniform vSphericalL00: vec3f;uniform vSphericalL1_1: vec3f;uniform vSphericalL10: vec3f;uniform vSphericalL11: vec3f;uniform vSphericalL2_2: vec3f;uniform vSphericalL2_1: vec3f;uniform vSphericalL20: vec3f;uniform vSphericalL21: vec3f;uniform vSphericalL22: vec3f;uniform vSphericalX: vec3f;uniform vSphericalY: vec3f;uniform vSphericalZ: vec3f;uniform vSphericalXX_ZZ: vec3f;uniform vSphericalYY_ZZ: vec3f;uniform vSphericalZZ: vec3f;uniform vSphericalXY: vec3f;uniform vSphericalYZ: vec3f;uniform vSphericalZX: vec3f;\n#define ADDITIONAL_UBO_DECLARATION\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",ShaderStore.IncludesShadersStoreWGSL[name186]=shader186}}),name187,shader187,init_harmonicsFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/harmonicsFunctions.js"(){init_shaderStore(),name187="harmonicsFunctions",shader187="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nfn computeEnvironmentIrradiance(normal: vec3f)->vec3f {return uniforms.vSphericalL00\n+ uniforms.vSphericalL1_1*(normal.y)\n+ uniforms.vSphericalL10*(normal.z)\n+ uniforms.vSphericalL11*(normal.x)\n+ uniforms.vSphericalL2_2*(normal.y*normal.x)\n+ uniforms.vSphericalL2_1*(normal.y*normal.z)\n+ uniforms.vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ uniforms.vSphericalL21*(normal.z*normal.x)\n+ uniforms.vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));}\n#else\nfn computeEnvironmentIrradiance(normal: vec3f)->vec3f {var Nx: f32=normal.x;var Ny: f32=normal.y;var Nz: f32=normal.z;var C1: vec3f=uniforms.vSphericalZZ.rgb;var Cx: vec3f=uniforms.vSphericalX.rgb;var Cy: vec3f=uniforms.vSphericalY.rgb;var Cz: vec3f=uniforms.vSphericalZ.rgb;var Cxx_zz: vec3f=uniforms.vSphericalXX_ZZ.rgb;var Cyy_zz: vec3f=uniforms.vSphericalYY_ZZ.rgb;var Cxy: vec3f=uniforms.vSphericalXY.rgb;var Cyz: vec3f=uniforms.vSphericalYZ.rgb;var Czx: vec3f=uniforms.vSphericalZX.rgb;var a1: vec3f=Cyy_zz*Ny+Cy;var a2: vec3f=Cyz*Nz+a1;var b1: vec3f=Czx*Nz+Cx;var b2: vec3f=Cxy*Ny+b1;var b3: vec3f=Cxx_zz*Nx+b2;var t1: vec3f=Cz *Nz+C1;var t2: vec3f=a2 *Ny+t1;var t3: vec3f=b3 *Nx+t2;return t3;}\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name187]=shader187}}),pbr_vertex_exports={},name188,shader188,pbrVertexShaderWGSL;__export(pbr_vertex_exports,{pbrVertexShaderWGSL:()=>pbrVertexShaderWGSL});var init_pbr_vertex=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/pbr.vertex.js"(){init_shaderStore(),init_pbrUboDeclaration(),init_uvAttributeDeclaration(),init_mainUVVaryingDeclaration(),init_helperFunctions(),init_bonesDeclaration(),init_bakedVertexAnimationDeclaration(),init_instancesDeclaration(),init_prePassVertexDeclaration(),init_samplerVertexDeclaration(),init_harmonicsFunctions(),init_bumpVertexDeclaration(),init_clipPlaneVertexDeclaration(),init_fogVertexDeclaration(),init_lightVxUboDeclaration(),init_morphTargetsVertexGlobalDeclaration(),init_morphTargetsVertexDeclaration(),init_logDepthDeclaration(),init_morphTargetsVertexGlobal(),init_morphTargetsVertex(),init_instancesVertex(),init_bonesVertex(),init_bakedVertexAnimation(),init_prePassVertex(),init_uvVariableDeclaration(),init_samplerVertexImplementation(),init_bumpVertex(),init_clipPlaneVertex(),init_fogVertex(),init_shadowsVertex(),init_vertexColorMixing(),init_logDepthVertex(),name188="pbrVertexShader",shader188="#include<pbrUboDeclaration>\n#define CUSTOM_VERTEX_BEGIN\nattribute position: vec3f;\n#ifdef NORMAL\nattribute normal: vec3f;\n#endif\n#ifdef TANGENT\nattribute tangent: vec4f;\n#endif\n#ifdef UV1\nattribute uv: vec2f;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef VERTEXCOLOR\nattribute color: vec4f;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)\n#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)\n#ifdef CLEARCOAT\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor)\n#endif\nvarying vPositionW: vec3f;\n#if DEBUGMODE>0\nvarying vClipSpacePosition: vec4f;\n#endif\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vEnvironmentIrradiance: vec3f;\n#include<harmonicsFunctions>\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<lightVxUboDeclaration>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar positionUpdated: vec3f=vertexInputs.position;\n#ifdef NORMAL\nvar normalUpdated: vec3f=vertexInputs.normal;\n#endif\n#ifdef TANGENT\nvar tangentUpdated: vec4f=vertexInputs.tangent;\n#endif\n#ifdef UV1\nvar uvUpdated: vec2f=vertexInputs.uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvertexOutputs.vPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvertexOutputs.vCurrentPosition=scene.viewProjection*finalWorld* vec4f(positionUpdated,1.0);vertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld* vec4f(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld* vec4f(positionUpdated,1.0);vertexOutputs.vPositionW= worldPos.xyz;\n#include<prePassVertex>\n#ifdef NORMAL\nvar normalWorld: mat3x3f= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvertexOutputs.vNormalW=normalUpdated/ vec3f(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vertexOutputs.vNormalW=normalize(normalWorld*vertexOutputs.vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvertexOutputs.vNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvar reflectionVector: vec3f= (uniforms.reflectionMatrix* vec4f(vertexOutputs.vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvertexOutputs.vEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {vertexOutputs.position=scene.viewProjection*worldPos;} else {vertexOutputs.position=scene.viewProjectionR*worldPos;}\n#else\nvertexOutputs.position=scene.viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvertexOutputs.vClipSpacePosition=vertexOutputs.position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvertexOutputs.vDirectionW=normalize((finalWorld*vec4f(positionUpdated,0.0)).xyz);\n#endif\n#ifndef UV1\nvar uvUpdated: vec2f= vec2f(0.,0.);\n#endif\n#ifdef MAINUV1\nvertexOutputs.vMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)\n#ifdef CLEARCOAT\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)\n#endif\n#ifdef SHEEN\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheenRoughness,_INFONAME_,SheenInfos.z)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_MATRIXNAME_,translucencyColor,_INFONAME_,TranslucencyColorInfos.x)\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStoreWGSL[name188]=shader188,pbrVertexShaderWGSL={name:name188,shader:shader188}}}),name189,shader189,init_pbrFragmentExtraDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrFragmentExtraDeclaration.js"(){init_shaderStore(),init_mainUVVaryingDeclaration(),name189="pbrFragmentExtraDeclaration",shader189="varying vPositionW: vec3f;\n#if DEBUGMODE>0\nvarying vClipSpacePosition: vec4f;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vEnvironmentIrradiance: vec3f;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name189]=shader189}}),name190,shader190,init_samplerFragmentAlternateDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/samplerFragmentAlternateDeclaration.js"(){init_shaderStore(),name190="samplerFragmentAlternateDeclaration",shader190="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name190]=shader190}}),name191,shader191,init_pbrFragmentSamplersDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrFragmentSamplersDeclaration.js"(){init_shaderStore(),init_samplerFragmentDeclaration(),init_samplerFragmentAlternateDeclaration(),name191="pbrFragmentSamplersDeclaration",shader191="#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nvar clearCoatRoughnessSamplerSampler: sampler;var clearCoatRoughnessSampler: texture_2d<f32>;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS)\nvar sheenRoughnessSamplerSampler: sampler;var sheenRoughnessSampler: texture_2d<f32>;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nvar reflectionSamplerSampler: sampler;var reflectionSampler: texture_cube<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar reflectionLowSamplerSampler: sampler;var reflectionLowSampler: texture_cube<f32>;var reflectionHighSamplerSampler: sampler;var reflectionHighSampler: texture_cube<f32>;\n#endif\n#ifdef USEIRRADIANCEMAP\nvar irradianceSamplerSampler: sampler;var irradianceSampler: texture_cube<f32>;\n#endif\n#else\nvar reflectionSamplerSampler: sampler;var reflectionSampler: texture_2d<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar reflectionLowSamplerSampler: sampler;var reflectionLowSampler: texture_2d<f32>;var reflectionHighSamplerSampler: sampler;var reflectionHighSampler: texture_2d<f32>;\n#endif\n#ifdef USEIRRADIANCEMAP\nvar irradianceSamplerSampler: sampler;var irradianceSampler: texture_2d<f32>;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nvar environmentBrdfSamplerSampler: sampler;var environmentBrdfSampler: texture_2d<f32>;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\nvar refractionSamplerSampler: sampler;var refractionSampler: texture_cube<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar refractionLowSamplerSampler: sampler;var refractionLowSampler: texture_cube<f32>;var refractionHighSamplerSampler: sampler;var refractionHighSampler: texture_cube<f32>;\n#endif\n#else\nvar refractionSamplerSampler: sampler;var refractionSampler: texture_2d<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar refractionLowSamplerSampler: sampler;var refractionLowSampler: texture_2d<f32>;var refractionHighSamplerSampler: sampler;var refractionHighSampler: texture_2d<f32>;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_SAMPLERNAME_,translucencyColor)\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name191]=shader191}}),name192,shader192,init_subSurfaceScatteringFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/subSurfaceScatteringFunctions.js"(){init_shaderStore(),name192="subSurfaceScatteringFunctions",shader192="fn testLightingForSSS(diffusionProfile: f32)->bool\n{return diffusionProfile<1.;}",ShaderStore.IncludesShadersStoreWGSL[name192]=shader192}}),name193,shader193,init_importanceSampling=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/importanceSampling.js"(){init_shaderStore(),name193="importanceSampling",shader193="fn hemisphereCosSample(u: vec2f)->vec3f {var phi: f32=2.*PI*u.x;var cosTheta2: f32=1.-u.y;var cosTheta: f32=sqrt(cosTheta2);var sinTheta: f32=sqrt(1.-cosTheta2);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nfn hemisphereImportanceSampleDggx(u: vec2f,a: f32)->vec3f {var phi: f32=2.*PI*u.x;var cosTheta2: f32=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));var cosTheta: f32=sqrt(cosTheta2);var sinTheta: f32=sqrt(1.-cosTheta2);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nfn hemisphereImportanceSampleDCharlie(u: vec2f,a: f32)->vec3f { \nvar phi: f32=2.*PI*u.x;var sinTheta: f32=pow(u.y,a/(2.*a+1.));var cosTheta: f32=sqrt(1.-sinTheta*sinTheta);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}",ShaderStore.IncludesShadersStoreWGSL[name193]=shader193}}),name194,shader194,init_pbrHelperFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrHelperFunctions.js"(){init_shaderStore(),name194="pbrHelperFunctions",shader194="#define MINIMUMVARIANCE 0.0005\nfn convertRoughnessToAverageSlope(roughness: f32)->f32\n{return roughness*roughness+MINIMUMVARIANCE;}\nfn fresnelGrazingReflectance(reflectance0: f32)->f32 {var reflectance90: f32=saturate(reflectance0*25.0);return reflectance90;}\nfn getAARoughnessFactors(normalVector: vec3f)->vec2f {\n#ifdef SPECULARAA\nvar nDfdx: vec3f=dpdx(normalVector.xyz);var nDfdy: vec3f=dpdy(normalVector.xyz);var slopeSquare: f32=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));var geometricRoughnessFactor: f32=pow(saturate(slopeSquare),0.333);var geometricAlphaGFactor: f32=sqrt(slopeSquare);geometricAlphaGFactor*=0.75;return vec2f(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2f(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_LEGACY\nfn getAnisotropicRoughness(alphaG: f32,anisotropy: f32)->vec2f {var alphaT: f32=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);var alphaB: f32=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);return vec2f(alphaT,alphaB);}\nfn getAnisotropicBentNormals(T: vec3f,B: vec3f,N: vec3f,V: vec3f,anisotropy: f32,roughness: f32)->vec3f {var anisotropicFrameDirection: vec3f=select(T,B,anisotropy>=0.0);var anisotropicFrameTangent: vec3f=cross(normalize(anisotropicFrameDirection),V);var anisotropicFrameNormal: vec3f=cross(anisotropicFrameTangent,anisotropicFrameDirection);var anisotropicNormal: vec3f=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));return anisotropicNormal;}\n#else\nfn getAnisotropicRoughness(alphaG: f32,anisotropy: f32)->vec2f {var alphaT: f32=max(mix(alphaG,1.0,anisotropy*anisotropy),MINIMUMVARIANCE);var alphaB: f32=max(alphaG,MINIMUMVARIANCE);return vec2f(alphaT,alphaB);}\nfn getAnisotropicBentNormals(T: vec3f,B: vec3f,N: vec3f,V: vec3f,anisotropy: f32,roughness: f32)->vec3f {var bentNormal: vec3f=cross(B,V);bentNormal=normalize(cross(bentNormal,B));var sq=1.0-anisotropy*(1.0-roughness);var a: f32=sq*sq*sq*sq;bentNormal=normalize(mix(bentNormal,N,a));return bentNormal;}\n#endif\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nfn cocaLambertVec3(alpha: vec3f,distance: f32)->vec3f {return exp(-alpha*distance);}\nfn cocaLambert(NdotVRefract: f32,NdotLRefract: f32,alpha: vec3f,thickness: f32)->vec3f {return cocaLambertVec3(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));}\nfn computeColorAtDistanceInMedia(color: vec3f,distance: f32)->vec3f {return -log(color)/distance;}\nfn computeClearCoatAbsorption(NdotVRefract: f32,NdotLRefract: f32,clearCoatColor: vec3f,clearCoatThickness: f32,clearCoatIntensity: f32)->vec3f {var clearCoatAbsorption: vec3f=mix( vec3f(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);return clearCoatAbsorption;}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfn computeDefaultMicroSurface(microSurface: f32,reflectivityColor: vec3f)->f32\n{const kReflectivityNoAlphaWorkflow_SmoothnessMax: f32=0.95;var reflectivityLuminance: f32=getLuminance(reflectivityColor);var reflectivityLuma: f32=sqrt(reflectivityLuminance);var resultMicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;return resultMicroSurface;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name194]=shader194}}),name195,shader195,init_pbrDirectLightingSetupFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrDirectLightingSetupFunctions.js"(){init_shaderStore(),name195="pbrDirectLightingSetupFunctions",shader195="struct preLightingInfo\n{lightOffset: vec3f,\nlightDistanceSquared: f32,\nlightDistance: f32,\nattenuation: f32,\nL: vec3f,\nH: vec3f,\nNdotV: f32,\nNdotLUnclamped: f32,\nNdotL: f32,\nVdotH: f32,\nroughness: f32,\n#ifdef IRIDESCENCE\niridescenceIntensity: f32\n#endif\n};fn computePointAndSpotPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f,posW: vec3f)->preLightingInfo {var result: preLightingInfo;result.lightOffset=lightData.xyz-posW;result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);result.lightDistance=sqrt(result.lightDistanceSquared);result.L=normalize(result.lightOffset);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\nfn computeDirectionalPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f)->preLightingInfo {var result: preLightingInfo;result.lightDistance=length(-lightData.xyz);result.L=normalize(-lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\nfn computeHemisphericPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f)->preLightingInfo {var result: preLightingInfo;result.NdotL=dot(N,lightData.xyz)*0.5+0.5;result.NdotL=saturateEps(result.NdotL);result.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;}",ShaderStore.IncludesShadersStoreWGSL[name195]=shader195}}),name196,shader196,init_pbrDirectLightingFalloffFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrDirectLightingFalloffFunctions.js"(){init_shaderStore(),name196="pbrDirectLightingFalloffFunctions",shader196="fn computeDistanceLightFalloff_Standard(lightOffset: vec3f,range: f32)->f32\n{return max(0.,1.0-length(lightOffset)/range);}\nfn computeDistanceLightFalloff_Physical(lightDistanceSquared: f32)->f32\n{return 1.0/maxEps(lightDistanceSquared);}\nfn computeDistanceLightFalloff_GLTF(lightDistanceSquared: f32,inverseSquaredRange: f32)->f32\n{var lightDistanceFalloff: f32=1.0/maxEps(lightDistanceSquared);var factor: f32=lightDistanceSquared*inverseSquaredRange;var attenuation: f32=saturate(1.0-factor*factor);attenuation*=attenuation;lightDistanceFalloff*=attenuation;return lightDistanceFalloff;}\nfn computeDistanceLightFalloff(lightOffset: vec3f,lightDistanceSquared: f32,range: f32,inverseSquaredRange: f32)->f32\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfn computeDirectionalLightFalloff_Standard(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32,exponent: f32)->f32\n{var falloff: f32=0.0;var cosAngle: f32=maxEps(dot(-lightDirection,directionToLightCenterW));if (cosAngle>=cosHalfAngle)\n{falloff=max(0.,pow(cosAngle,exponent));}\nreturn falloff;}\nfn computeDirectionalLightFalloff_Physical(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32)->f32\n{const kMinusLog2ConeAngleIntensityRatio: f32=6.64385618977; \nvar concentrationKappa: f32=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);var lightDirectionSpreadSG: vec4f= vec4f(-lightDirection*concentrationKappa,-concentrationKappa);var falloff: f32=exp2(dot( vec4f(directionToLightCenterW,1.0),lightDirectionSpreadSG));return falloff;}\nfn computeDirectionalLightFalloff_GLTF(lightDirection: vec3f,directionToLightCenterW: vec3f,lightAngleScale: f32,lightAngleOffset: f32)->f32\n{var cd: f32=dot(-lightDirection,directionToLightCenterW);var falloff: f32=saturate(cd*lightAngleScale+lightAngleOffset);falloff*=falloff;return falloff;}\nfn computeDirectionalLightFalloff(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32,exponent: f32,lightAngleScale: f32,lightAngleOffset: f32)->f32\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}",ShaderStore.IncludesShadersStoreWGSL[name196]=shader196}}),name197,shader197,init_pbrBRDFFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBRDFFunctions.js"(){init_shaderStore(),name197="pbrBRDFFunctions",shader197="#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nfn getEnergyConservationFactor(specularEnvironmentR0: vec3f,environmentBrdf: vec3f)->vec3f {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}\n#endif\n#ifdef ENVIRONMENTBRDF\nfn getBRDFLookup(NdotV: f32,perceptualRoughness: f32)->vec3f {var UV: vec2f= vec2f(NdotV,perceptualRoughness);var brdfLookup: vec4f= textureSample(environmentBrdfSampler,environmentBrdfSamplerSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup=vec4f(fromRGBD(brdfLookup.rgba),brdfLookup.a);\n#endif\nreturn brdfLookup.rgb;}\nfn getReflectanceFromBRDFWithEnvLookup(specularEnvironmentR0: vec3f,specularEnvironmentR90: vec3f,environmentBrdf: vec3f)->vec3f {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar reflectance: vec3f=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvar reflectance: vec3f=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;}\nfn getReflectanceFromBRDFLookup(specularEnvironmentR0: vec3f,environmentBrdf: vec3f)->vec3f {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar reflectance: vec3f=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvar reflectance: vec3f=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfn getBRDFLookupCharlieSheen(NdotV: f32,perceptualRoughness: f32)->f32\n{var c: f32=1.0-NdotV;var c3: f32=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nfn getReflectanceFromAnalyticalBRDFLookup_Jones(VdotN: f32,reflectance0: vec3f,reflectance90: vec3f,smoothness: f32)->vec3f\n{var weight: f32=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nfn getSheenReflectanceFromBRDFLookup(reflectance0: vec3f,environmentBrdf: vec3f)->vec3f {var sheenEnvironmentReflectance: vec3f=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}\n#endif\nfn fresnelSchlickGGXVec3(VdotH: f32,reflectance0: vec3f,reflectance90: vec3f)->vec3f\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\nfn fresnelSchlickGGX(VdotH: f32,reflectance0: f32,reflectance90: f32)->f32\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\n#ifdef CLEARCOAT\nfn getR0RemappedForClearCoat(f0: vec3f)->vec3f {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturateVec3(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturateVec3(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvar s: vec3f=sqrt(f0);var t: vec3f=(uniforms.vClearCoatRefractionParams.z+uniforms.vClearCoatRefractionParams.w*s)/(uniforms.vClearCoatRefractionParams.w+uniforms.vClearCoatRefractionParams.z*s);return squareVec3(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst XYZ_TO_REC709: mat3x3f= mat3x3f(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);fn getIORTfromAirToSurfaceR0(f0: vec3f)->vec3f {var sqrtF0: vec3f=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}\nfn getR0fromIORsVec3(iorT: vec3f,iorI: f32)->vec3f {return squareVec3((iorT- vec3f(iorI))/(iorT+ vec3f(iorI)));}\nfn getR0fromIORs(iorT: f32,iorI: f32)->f32 {return square((iorT-iorI)/(iorT+iorI));}\nfn evalSensitivity(opd: f32,shift: vec3f)->vec3f {var phase: f32=2.0*PI*opd*1.0e-9;const val: vec3f= vec3f(5.4856e-13,4.4201e-13,5.2481e-13);const pos: vec3f= vec3f(1.6810e+06,1.7953e+06,2.2084e+06);const vr: vec3f= vec3f(4.3278e+09,9.3046e+09,6.6121e+09);var xyz: vec3f=val*sqrt(2.0*PI*vr)*cos(pos*phase+shift)*exp(-square(phase)*vr);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;var srgb: vec3f=XYZ_TO_REC709*xyz;return srgb;}\nfn evalIridescence(outsideIOR: f32,eta2: f32,cosTheta1: f32,thinFilmThickness: f32,baseF0: vec3f)->vec3f {var I: vec3f= vec3f(1.0);var iridescenceIOR: f32=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));var sinTheta2Sq: f32=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));var cosTheta2Sq: f32=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}\nvar cosTheta2: f32=sqrt(cosTheta2Sq);var R0: f32=getR0fromIORs(iridescenceIOR,outsideIOR);var R12: f32=fresnelSchlickGGX(cosTheta1,R0,1.);var R21: f32=R12;var T121: f32=1.0-R12;var phi12: f32=0.0;if (iridescenceIOR<outsideIOR) {phi12=PI;}\nvar phi21: f32=PI-phi12;var baseIOR: vec3f=getIORTfromAirToSurfaceR0(clamp(baseF0,vec3f(0.0),vec3f(0.9999))); \nvar R1: vec3f=getR0fromIORsVec3(baseIOR,iridescenceIOR);var R23: vec3f=fresnelSchlickGGXVec3(cosTheta2,R1, vec3f(1.));var phi23: vec3f= vec3f(0.0);if (baseIOR[0]<iridescenceIOR) {phi23[0]=PI;}\nif (baseIOR[1]<iridescenceIOR) {phi23[1]=PI;}\nif (baseIOR[2]<iridescenceIOR) {phi23[2]=PI;}\nvar opd: f32=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;var phi: vec3f= vec3f(phi21)+phi23;var R123: vec3f=clamp(R12*R23,vec3f(1e-5),vec3f(0.9999));var r123: vec3f=sqrt(R123);var Rs: vec3f=(T121*T121)*R23/( vec3f(1.0)-R123);var C0: vec3f=R12+Rs;I=C0;var Cm: vec3f=Rs-T121;for (var m: i32=1; m<=2; m++)\n{Cm*=r123;var Sm: vec3f=2.0*evalSensitivity( f32(m)*opd, f32(m)*phi);I+=Cm*Sm;}\nreturn max(I, vec3f(0.0));}\n#endif\nfn normalDistributionFunction_TrowbridgeReitzGGX(NdotH: f32,alphaG: f32)->f32\n{var a2: f32=alphaG*alphaG;var d: f32=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}\n#ifdef SHEEN\nfn normalDistributionFunction_CharlieSheen(NdotH: f32,alphaG: f32)->f32\n{var invR: f32=1./alphaG;var cos2h: f32=NdotH*NdotH;var sin2h: f32=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}\n#endif\n#ifdef ANISOTROPIC\nfn normalDistributionFunction_BurleyGGX_Anisotropic(NdotH: f32,TdotH: f32,BdotH: f32,alphaTB: vec2f)->f32 {var a2: f32=alphaTB.x*alphaTB.y;var v: vec3f= vec3f(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);var v2: f32=dot(v,v);var w2: f32=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfn smithVisibility_GGXCorrelated(NdotL: f32,NdotV: f32,alphaG: f32)->f32 {\n#ifdef MOBILE\nvar GGXV: f32=NdotL*(NdotV*(1.0-alphaG)+alphaG);var GGXL: f32=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);\n#else\nvar a2: f32=alphaG*alphaG;var GGXV: f32=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);var GGXL: f32=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfn smithVisibilityG1_TrowbridgeReitzGGXFast(dot: f32,alphaG: f32)->f32\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nvar alphaSquared: f32=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfn smithVisibility_TrowbridgeReitzGGXFast(NdotL: f32,NdotV: f32,alphaG: f32)->f32\n{var visibility: f32=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}\n#endif\n#ifdef ANISOTROPIC\nfn smithVisibility_GGXCorrelated_Anisotropic(NdotL: f32,NdotV: f32,TdotV: f32,BdotV: f32,TdotL: f32,BdotL: f32,alphaTB: vec2f)->f32 {var lambdaV: f32=NdotL*length( vec3f(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));var lambdaL: f32=NdotV*length( vec3f(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));var v: f32=0.5/(lambdaV+lambdaL);return v;}\n#endif\n#ifdef CLEARCOAT\nfn visibility_Kelemen(VdotH: f32)->f32 {return 0.25/(VdotH*VdotH); }\n#endif\n#ifdef SHEEN\nfn visibility_Ashikhmin(NdotL: f32,NdotV: f32)->f32\n{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfn l(x: f32,alphaG: f32)->f32\n{var oneMinusAlphaSq: f32=(1.0-alphaG)*(1.0-alphaG);var a: f32=mix(21.5473,25.3245,oneMinusAlphaSq);var b: f32=mix(3.82987,3.32435,oneMinusAlphaSq);var c: f32=mix(0.19823,0.16801,oneMinusAlphaSq);var d: f32=mix(-1.97760,-1.27393,oneMinusAlphaSq);var e: f32=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}\nfn lambdaSheen(cosTheta: f32,alphaG: f32)->f32\n{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}\nfn visibility_CharlieSheen(NdotL: f32,NdotV: f32,alphaG: f32)->f32\n{var G: f32=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}\n#endif\n*/\n#endif\nfn diffuseBRDF_Burley(NdotL: f32,NdotV: f32,VdotH: f32,roughness: f32)->f32 {var diffuseFresnelNV: f32=pow5(saturateEps(1.0-NdotL));var diffuseFresnelNL: f32=pow5(saturateEps(1.0-NdotV));var diffuseFresnel90: f32=0.5+2.0*VdotH*VdotH*roughness;var fresnel: f32 =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}\n#ifdef SS_TRANSLUCENCY\nfn transmittanceBRDF_Burley(tintColor: vec3f,diffusionDistance: vec3f,thickness: f32)->vec3f {var S: vec3f=1./maxEpsVec3(diffusionDistance);var temp: vec3f=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}\nfn computeWrappedDiffuseNdotL(NdotL: f32,w: f32)->f32 {var t: f32=1.0+w;var invt2: f32=1.0/(t*t);return saturate((NdotL+w)*invt2);}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name197]=shader197}}),name198,shader198,init_hdrFilteringFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/hdrFilteringFunctions.js"(){init_shaderStore(),name198="hdrFilteringFunctions",shader198="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\nfn radicalInverse_VdC(value: u32)->f32 \n{var bits=(value<<16u) | (value>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return f32(bits)*2.3283064365386963e-10; }\nfn hammersley(i: u32,N: u32)->vec2f\n{return vec2f( f32(i)/ f32(N),radicalInverse_VdC(i));}\nfn log4(x: f32)->f32 {return log2(x)/2.;}\nconst NUM_SAMPLES_FLOAT: f32= f32(NUM_SAMPLES);const NUM_SAMPLES_FLOAT_INVERSED: f32=1./NUM_SAMPLES_FLOAT;const K: f32=4.;fn irradiance(inputTexture: texture_cube<f32>,inputSampler: sampler,inputN: vec3f,filteringInfo: vec2f)->vec3f\n{var n: vec3f=normalize(inputN);var result: vec3f= vec3f(0.0);var tangent: vec3f=select(vec3f(1.,0.,0.),vec3f(0.,0.,1.),abs(n.z)<0.999);tangent=normalize(cross(tangent,n));var bitangent: vec3f=cross(n,tangent);var tbn: mat3x3f= mat3x3f(tangent,bitangent,n);var maxLevel: f32=filteringInfo.y;var dim0: f32=filteringInfo.x;var omegaP: f32=(4.*PI)/(6.*dim0*dim0);for(var i: u32=0u; i<NUM_SAMPLES; i++)\n{var Xi: vec2f=hammersley(i,NUM_SAMPLES);var Ls: vec3f=hemisphereCosSample(Xi);Ls=normalize(Ls);var Ns: vec3f= vec3f(0.,0.,1.);var NoL: f32=dot(Ns,Ls);if (NoL>0.) {var pdf_inversed: f32=PI/NoL;var omegaS: f32=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;var l: f32=log4(omegaS)-log4(omegaP)+log4(K);var mipLevel: f32=clamp(l,0.0,maxLevel);var c: vec3f=textureSampleLevel(inputTexture,inputSampler,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpaceVec3(c);\n#endif\nresult+=c;}}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}\nfn radiance(alphaG: f32,inputTexture: texture_cube<f32>,inputSampler: sampler,inputN: vec3f,filteringInfo: vec2f)->vec3f\n{var n: vec3f=normalize(inputN);var c: vec3f=textureSample(inputTexture,inputSampler,n).rgb; \nif (alphaG==0.) {\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;} else {var result: vec3f= vec3f(0.);var tangent: vec3f=select(vec3f(1.,0.,0.),vec3f(0.,0.,1.),abs(n.z)<0.999);tangent=normalize(cross(tangent,n));var bitangent: vec3f=cross(n,tangent);var tbn: mat3x3f= mat3x3f(tangent,bitangent,n);var maxLevel: f32=filteringInfo.y;var dim0: f32=filteringInfo.x;var omegaP: f32=(4.*PI)/(6.*dim0*dim0);var weight: f32=0.;for(var i: u32=0u; i<NUM_SAMPLES; i++)\n{var Xi: vec2f=hammersley(i,NUM_SAMPLES);var H: vec3f=hemisphereImportanceSampleDggx(Xi,alphaG);var NoV: f32=1.;var NoH: f32=H.z;var NoH2: f32=H.z*H.z;var NoL: f32=2.*NoH2-1.;var L: vec3f= vec3f(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {var pdf_inversed: f32=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);var omegaS: f32=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;var l: f32=log4(omegaS)-log4(omegaP)+log4(K);var mipLevel: f32=clamp( f32(l),0.0,maxLevel);weight+=NoL;var c: vec3f=textureSampleLevel(inputTexture,inputSampler,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;}}\nresult=result/weight;return result;}}\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name198]=shader198}}),name199,shader199,init_pbrDirectLightingFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrDirectLightingFunctions.js"(){init_shaderStore(),name199="pbrDirectLightingFunctions",shader199="#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{diffuse: vec3f,\n#ifdef SPECULARTERM\nspecular: vec3f,\n#endif\n#ifdef CLEARCOAT\nclearCoat: vec4f,\n#endif\n#ifdef SHEEN\nsheen: vec3f\n#endif\n};fn adjustRoughnessFromLightProperties(roughness: f32,lightRadius: f32,lightDistance: f32)->f32 {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nvar lightRoughness: f32=lightRadius/lightDistance;var totalRoughness: f32=saturate(lightRoughness+roughness);return totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfn computeHemisphericDiffuseLighting(info: preLightingInfo,lightColor: vec3f,groundColor: vec3f)->vec3f {return mix(groundColor,lightColor,info.NdotL);}\nfn computeDiffuseLighting(info: preLightingInfo,lightColor: vec3f)->vec3f {var diffuseTerm: f32=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*info.attenuation*info.NdotL*lightColor;}\nfn computeProjectionTextureDiffuseLighting(projectionLightTexture: texture_2d<f32>,projectionLightSampler: sampler,textureProjectionMatrix: mat4x4f,posW: vec3f)->vec3f{var strq: vec4f=textureProjectionMatrix* vec4f(posW,1.0);strq/=strq.w;var textureColor: vec3f=textureSample(projectionLightTexture,projectionLightSampler,strq.xy).rgb;return toLinearSpaceVec3(textureColor);}\n#ifdef SS_TRANSLUCENCY\nfn computeDiffuseAndTransmittedLighting(info: preLightingInfo,lightColor: vec3f,transmittance: vec3f)->vec3f {var NdotL: f32=absEps(info.NdotLUnclamped);var wrapNdotL: f32=computeWrappedDiffuseNdotL(NdotL,0.02);var trAdapt: f32=step(0.,info.NdotLUnclamped);var transmittanceNdotL: vec3f=mix(transmittance*wrapNdotL, vec3f(wrapNdotL),trAdapt);var diffuseTerm: f32=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;}\n#endif\n#ifdef SPECULARTERM\nfn computeSpecularLighting(info: preLightingInfo,N: vec3f,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var roughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var fresnel: vec3f=fresnelSchlickGGXVec3(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nvar distribution: f32=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar smithVisibility: f32=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nvar smithVisibility: f32=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvar specTerm: vec3f=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef ANISOTROPIC\nfn computeAnisotropicSpecularLighting(info: preLightingInfo,V: vec3f,N: vec3f,T: vec3f,B: vec3f,anisotropy: f32,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var TdotH: f32=dot(T,info.H);var BdotH: f32=dot(B,info.H);var TdotV: f32=dot(T,V);var BdotV: f32=dot(B,V);var TdotL: f32=dot(T,info.L);var BdotL: f32=dot(B,info.L);var alphaG: f32=convertRoughnessToAverageSlope(info.roughness);var alphaTB: vec2f=getAnisotropicRoughness(alphaG,anisotropy);alphaTB=max(alphaTB,vec2f(geometricRoughnessFactor*geometricRoughnessFactor));var fresnel: vec3f=fresnelSchlickGGXVec3(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nvar distribution: f32=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);var smithVisibility: f32=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);var specTerm: vec3f=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef CLEARCOAT\nfn computeClearCoatLighting(info: preLightingInfo,Ncc: vec3f,geometricRoughnessFactor: f32,clearCoatIntensity: f32,lightColor: vec3f)->vec4f {var NccdotL: f32=saturateEps(dot(Ncc,info.L));var NccdotH: f32=saturateEps(dot(Ncc,info.H));var clearCoatRoughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(clearCoatRoughness);var fresnel: f32=fresnelSchlickGGX(info.VdotH,uniforms.vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnel*=clearCoatIntensity;var distribution: f32=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);var kelemenVisibility: f32=visibility_Kelemen(info.VdotH);var clearCoatTerm: f32=fresnel*distribution*kelemenVisibility;return vec4f(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);}\nfn computeClearCoatLightingAbsorption(NdotVRefract: f32,L: vec3f,Ncc: vec3f,clearCoatColor: vec3f,clearCoatThickness: f32,clearCoatIntensity: f32)->vec3f {var LRefract: vec3f=-refract(L,Ncc,uniforms.vClearCoatRefractionParams.y);var NdotLRefract: f32=saturateEps(dot(Ncc,LRefract));var absorption: vec3f=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);return absorption;}\n#endif\n#ifdef SHEEN\nfn computeSheenLighting(info: preLightingInfo,N: vec3f,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var roughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var fresnel: f32=1.;var distribution: f32=normalDistributionFunction_CharlieSheen(NdotH,alphaG);/*#ifdef SHEEN_SOFTER\nvar visibility: f32=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nvar visibility: f32=visibility_Ashikhmin(info.NdotL,info.NdotV);/* #endif */\nvar sheenTerm: f32=fresnel*distribution*visibility;return sheenTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name199]=shader199}}),name200,shader200,init_pbrIBLFunctions=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrIBLFunctions.js"(){init_shaderStore(),name200="pbrIBLFunctions",shader200="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfn getLodFromAlphaG(cubeMapDimensionPixels: f32,microsurfaceAverageSlope: f32)->f32 {var microsurfaceAverageSlopeTexels: f32=cubeMapDimensionPixels*microsurfaceAverageSlope;var lod: f32=log2(microsurfaceAverageSlopeTexels);return lod;}\nfn getLinearLodFromRoughness(cubeMapDimensionPixels: f32,roughness: f32)->f32 {var lod: f32=log2(cubeMapDimensionPixels)*roughness;return lod;}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfn environmentRadianceOcclusion(ambientOcclusion: f32,NdotVUnclamped: f32)->f32 {var temp: f32=NdotVUnclamped+ambientOcclusion;return saturate(temp*temp-1.0+ambientOcclusion);}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfn environmentHorizonOcclusion(view: vec3f,normal: vec3f,geometricNormal: vec3f)->f32 {var reflection: vec3f=reflect(view,normal);var temp: f32=saturate(1.0+1.1*dot(reflection,geometricNormal));return temp*temp;}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\nfn UNPACK_LOD(x: f32)->f32 {return (1.0-x)*255.0;}\nfn getLodFromAlphaGNdotV(cubeMapDimensionPixels: f32,alphaG: f32,NdotV: f32)->f32 {var microsurfaceAverageSlope: f32=alphaG;microsurfaceAverageSlope*=sqrt(abs(NdotV));return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name200]=shader200}}),name201,shader201,init_pbrBlockAlbedoOpacity=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockAlbedoOpacity.js"(){init_shaderStore(),init_decalFragment(),name201="pbrBlockAlbedoOpacity",shader201="struct albedoOpacityOutParams\n{surfaceAlbedo: vec3f,\nalpha: f32};\n#define pbr_inline\nfn albedoOpacityBlock(\nvAlbedoColor: vec4f\n#ifdef ALBEDO\n,albedoTexture: vec4f\n,albedoInfos: vec2f\n#endif\n#ifdef OPACITY\n,opacityMap: vec4f\n,vOpacityInfos: vec2f\n#endif\n#ifdef DETAIL\n,detailColor: vec4f\n,vDetailInfos: vec4f\n#endif\n#ifdef DECAL\n,decalColor: vec4f\n,vDecalInfos: vec4f\n#endif\n)->albedoOpacityOutParams\n{var outParams: albedoOpacityOutParams;var surfaceAlbedo: vec3f=vAlbedoColor.rgb;var alpha: f32=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpaceVec3(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#ifndef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nsurfaceAlbedo*=fragmentInputs.vColor.rgb;\n#endif\n#ifdef DETAIL\nvar detailAlbedo: f32=2.0*mix(0.5,detailColor.r,vDetailInfos.y);surfaceAlbedo=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#ifdef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=fragmentInputs.vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST \n#if DEBUGMODE != 88\nif (alpha<ALPHATESTVALUE) {discard;}\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;outParams.alpha=alpha;return outParams;}\n",ShaderStore.IncludesShadersStoreWGSL[name201]=shader201}}),name202,shader202,init_pbrBlockReflectivity=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockReflectivity.js"(){init_shaderStore(),name202="pbrBlockReflectivity",shader202="struct reflectivityOutParams\n{microSurface: f32,\nroughness: f32,\nsurfaceReflectivityColor: vec3f,\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo: vec3f,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nambientOcclusionColor: vec3f,\n#endif\n#if DEBUGMODE>0\n#ifdef METALLICWORKFLOW\nmetallicRoughness: vec2f,\n#ifdef REFLECTIVITY\nsurfaceMetallicColorMap: vec4f,\n#endif\n#ifndef FROSTBITE_REFLECTANCE\nmetallicF0: vec3f,\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColorMap: vec4f,\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nfn reflectivityBlock(\nvReflectivityColor: vec4f\n#ifdef METALLICWORKFLOW\n,surfaceAlbedo: vec3f\n,metallicReflectanceFactors: vec4f\n#endif\n#ifdef REFLECTIVITY\n,reflectivityInfos: vec3f\n,surfaceMetallicOrReflectivityColorMap: vec4f\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,ambientOcclusionColorIn: vec3f\n#endif\n#ifdef MICROSURFACEMAP\n,microSurfaceTexel: vec4f\n#endif\n#ifdef DETAIL\n,detailColor: vec4f\n,vDetailInfos: vec4f\n#endif\n)->reflectivityOutParams\n{var outParams: reflectivityOutParams;var microSurface: f32=vReflectivityColor.a;var surfaceReflectivityColor: vec3f=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvar metallicRoughness: vec2f=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvar aoStoreInMetalMap: vec3f= vec3f(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nvar detailRoughness: f32=mix(0.5,detailColor.b,vDetailInfos.w);var loLerp: f32=mix(0.,metallicRoughness.g,detailRoughness*2.);var hiLerp: f32=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;var baseColor: vec3f=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvar metallicF0: vec3f=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0), vec3f(0.,0.,0.),metallicRoughness.r);surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;microSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);var roughness: f32=1.-microSurface;outParams.microSurface=microSurface;outParams.roughness=roughness;outParams.surfaceReflectivityColor=surfaceReflectivityColor;return outParams;}\n",ShaderStore.IncludesShadersStoreWGSL[name202]=shader202}}),name203,shader203,init_pbrBlockAmbientOcclusion=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockAmbientOcclusion.js"(){init_shaderStore(),name203="pbrBlockAmbientOcclusion",shader203="struct ambientOcclusionOutParams\n{ambientOcclusionColor: vec3f,\n#if DEBUGMODE>0 && defined(AMBIENT)\nambientOcclusionColorMap: vec3f\n#endif\n};\n#define pbr_inline\nfn ambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap_: vec3f,\nvAmbientInfos: vec4f\n#endif\n)->ambientOcclusionOutParams\n{ \nvar outParams: ambientOcclusionOutParams;var ambientOcclusionColor: vec3f= vec3f(1.,1.,1.);\n#ifdef AMBIENT\nvar ambientOcclusionColorMap: vec3f=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap= vec3f(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;return outParams;}\n",ShaderStore.IncludesShadersStoreWGSL[name203]=shader203}}),name204,shader204,init_pbrBlockAlphaFresnel=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockAlphaFresnel.js"(){init_shaderStore(),name204="pbrBlockAlphaFresnel",shader204="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{alpha: f32};fn faceforward(N: vec3<f32>,I: vec3<f32>,Nref: vec3<f32>)->vec3<f32> {return select(N,-N,dot(Nref,I)>0.0);}\n#define pbr_inline\nfn alphaFresnelBlock(\nnormalW: vec3f,\nviewDirectionW: vec3f,\nalpha: f32,\nmicroSurface: f32\n)->alphaFresnelOutParams\n{var outParams: alphaFresnelOutParams;var opacityPerceptual: f32=alpha;\n#ifdef LINEARALPHAFRESNEL\nvar opacity0: f32=opacityPerceptual;\n#else\nvar opacity0: f32=opacityPerceptual*opacityPerceptual;\n#endif\nvar opacity90: f32=fresnelGrazingReflectance(opacity0);var normalForward: vec3f=faceforward(normalW,-viewDirectionW,normalW);outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)), vec3f(opacity0), vec3f(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE) {discard;}\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\nreturn outParams;}\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name204]=shader204}}),name205,shader205,init_pbrBlockAnisotropic=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockAnisotropic.js"(){init_shaderStore(),name205="pbrBlockAnisotropic",shader205="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{anisotropy: f32,\nanisotropicTangent: vec3f,\nanisotropicBitangent: vec3f,\nanisotropicNormal: vec3f,\n#if DEBUGMODE>0 && defined(ANISOTROPIC_TEXTURE)\nanisotropyMapData: vec3f\n#endif\n};\n#define pbr_inline\nfn anisotropicBlock(\nvAnisotropy: vec3f,\nroughness: f32,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData: vec3f,\n#endif\nTBN: mat3x3f,\nnormalW: vec3f,\nviewDirectionW: vec3f\n)->anisotropicOutParams\n{ \nvar outParams: anisotropicOutParams;var anisotropy: f32=vAnisotropy.b;var anisotropyDirection: vec3f= vec3f(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nvar amd=anisotropyMapData.rg;anisotropy*=anisotropyMapData.b;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\namd=amd*2.0-1.0;\n#ifdef ANISOTROPIC_LEGACY\nanisotropyDirection=vec3f(anisotropyDirection.xy*amd,anisotropyDirection.z);\n#else\nanisotropyDirection=vec3f(mat2x2f(anisotropyDirection.x,anisotropyDirection.y,-anisotropyDirection.y,anisotropyDirection.x)*normalize(amd),anisotropyDirection.z);\n#endif\n#endif\nvar anisoTBN: mat3x3f= mat3x3f(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));var anisotropicTangent: vec3f=normalize(anisoTBN*anisotropyDirection);var anisotropicBitangent: vec3f=normalize(cross(anisoTBN[2],anisotropicTangent));outParams.anisotropy=anisotropy;outParams.anisotropicTangent=anisotropicTangent;outParams.anisotropicBitangent=anisotropicBitangent;outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy,roughness);return outParams;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name205]=shader205}}),name206,shader206,init_pbrBlockReflection=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockReflection.js"(){init_shaderStore(),name206="pbrBlockReflection",shader206="#ifdef REFLECTION\nstruct reflectionOutParams\n{environmentRadiance: vec4f\n,environmentIrradiance: vec3f\n#ifdef REFLECTIONMAP_3D\n,reflectionCoords: vec3f\n#else\n,reflectionCoords: vec2f\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,irradianceVector: vec3f\n#endif\n#endif\n#endif\n};\n#define pbr_inline\n#ifdef REFLECTIONMAP_3D\nfn createReflectionCoords(\nvPositionW: vec3f,\nnormalW: vec3f,\n#ifdef ANISOTROPIC\nanisotropicOut: anisotropicOutParams,\n#endif\n)->vec3f\n{var reflectionCoords: vec3f;\n#else\nfn createReflectionCoords(\nvPositionW: vec3f,\nnormalW: vec3f,\n#ifdef ANISOTROPIC\nanisotropicOut: anisotropicOutParams,\n#endif\n)->vec2f\n{ \nvar reflectionCoords: vec2f;\n#endif\n#ifdef ANISOTROPIC\nvar reflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvar reflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\nreturn reflectionCoords;}\n#define pbr_inline\nfn sampleReflectionTexture(\nalphaG: f32\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped: f32\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness: f32\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec3f\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec2f\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler\n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler\n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler\n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif \n)->vec4f\n{var environmentRadiance: vec4f;\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nvar reflectionLOD: f32=getLodFromAlphaGNdotV(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nvar reflectionLOD: f32=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nvar reflectionLOD: f32=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nvar automaticReflectionLOD: f32=UNPACK_LOD(textureSample(reflectionSampler,reflectionSamplerSampler,reflectionCoords).a);var requestedReflectionLOD: f32=max(automaticReflectionLOD,reflectionLOD);\n#else\nvar requestedReflectionLOD: f32=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance= vec4f(radiance(alphaG,reflectionSampler,reflectionSamplerSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=textureSampleLevel(reflectionSampler,reflectionSamplerSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nvar lodReflectionNormalized: f32=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));var lodReflectionNormalizedDoubled: f32=lodReflectionNormalized*2.0;var environmentMid: vec4f=textureSample(reflectionSampler,reflectionSamplerSampler,reflectionCoords);if (lodReflectionNormalizedDoubled<1.0){environmentRadiance=mix(\ntextureSample(reflectionHighSampler,reflectionHighSamplerSampler,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);} else {environmentRadiance=mix(\nenvironmentMid,\ntextureSample(reflectionLowSampler,reflectionLowSamplerSampler,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);}\n#endif\nvar envRadiance=environmentRadiance.rgb;\n#ifdef RGBDREFLECTION\nenvRadiance=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvRadiance=toLinearSpaceVec3(environmentRadiance.rgb);\n#endif\nenvRadiance*=vReflectionInfos.x;envRadiance*=vReflectionColor.rgb;return vec4f(envRadiance,environmentRadiance.a);}\n#define pbr_inline\nfn reflectionBlock(\nvPositionW: vec3f\n,normalW: vec3f\n,alphaG: f32\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped: f32\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness: f32\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,vEnvironmentIrradiance: vec3f\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionMatrix: mat4x4f\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,irradianceSampler: texture_cube<f32>\n,irradianceSamplerSampler: sampler \n#else\n,irradianceSampler: texture_2d<f32>\n,irradianceSamplerSampler: sampler \n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n)->reflectionOutParams\n{var outParams: reflectionOutParams;var environmentRadiance: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvar reflectionCoords: vec3f= vec3f(0.);\n#else\nvar reflectionCoords: vec2f= vec2f(0.);\n#endif\nreflectionCoords=createReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif \n);environmentRadiance=sampleReflectionTexture(\nalphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#else\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#endif\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif \n);var environmentIrradiance: vec3f= vec3f(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,reflectionSamplerSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvar environmentIrradiance4: vec4f=textureSample(irradianceSampler,irradianceSamplerSampler,reflectionCoords);environmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance=toLinearSpaceVec3(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;outParams.environmentRadiance=environmentRadiance;outParams.environmentIrradiance=environmentIrradiance;outParams.reflectionCoords=reflectionCoords;return outParams;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name206]=shader206}}),name207,shader207,init_pbrBlockSheen=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockSheen.js"(){init_shaderStore(),name207="pbrBlockSheen",shader207="#ifdef SHEEN\nstruct sheenOutParams\n{sheenIntensity: f32\n,sheenColor: vec3f\n,sheenRoughness: f32\n#ifdef SHEEN_LINKWITHALBEDO\n,surfaceAlbedo: vec3f\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\n,sheenAlbedoScaling: f32\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,finalSheenRadianceScaled: vec3f\n#endif\n#if DEBUGMODE>0\n#ifdef SHEEN_TEXTURE\n,sheenMapData: vec4f\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,sheenEnvironmentReflectance: vec3f\n#endif\n#endif\n};\n#define pbr_inline\nfn sheenBlock(\nvSheenColor: vec4f\n#ifdef SHEEN_ROUGHNESS\n,vSheenRoughness: f32\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,sheenMapRoughnessData: vec4f\n#endif\n#endif\n,roughness: f32\n#ifdef SHEEN_TEXTURE\n,sheenMapData: vec4f\n,sheenMapLevel: f32\n#endif\n,reflectance: f32\n#ifdef SHEEN_LINKWITHALBEDO\n,baseColor: vec3f\n,surfaceAlbedo: vec3f\n#endif\n#ifdef ENVIRONMENTBRDF\n,NdotV: f32\n,environmentBrdf: vec3f\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,AARoughnessFactors: vec2f\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n,vLightingIntensity: vec4f\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec3f\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec2f\n#endif\n,NdotVUnclamped: f32\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,seo: f32\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,eho: f32\n#endif\n#endif\n)->sheenOutParams\n{var outParams: sheenOutParams;var sheenIntensity: f32=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nvar sheenFactor: f32=pow5(1.0-sheenIntensity);var sheenColor: vec3f=baseColor.rgb*(1.0-sheenFactor);var sheenRoughness: f32=sheenIntensity;outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvar sheenColor: vec3f=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor*=toLinearSpaceVec3(sheenMapData.rgb);\n#else\nsheenColor*=sheenMapData.rgb;\n#endif\nsheenColor*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nvar sheenRoughness: f32=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#else\nvar sheenRoughness: f32=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvar environmentSheenBrdf: vec3f= vec3f(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvar environmentSheenBrdf: vec3f=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvar environmentSheenBrdf: vec3f=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvar sheenAlphaG: f32=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvar environmentSheenRadiance: vec4f= vec4f(0.,0.,0.,0.);environmentSheenRadiance=sampleReflectionTexture(\nsheenAlphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,sheenRoughness\n#endif\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n);var sheenEnvironmentReflectance: vec3f=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;outParams.sheenColor=sheenColor;outParams.sheenRoughness=sheenRoughness;return outParams;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name207]=shader207}}),name208,shader208,init_pbrBlockClearcoat=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockClearcoat.js"(){init_shaderStore(),name208="pbrBlockClearcoat",shader208="struct clearcoatOutParams\n{specularEnvironmentR0: vec3f,\nconservationFactor: f32,\nclearCoatNormalW: vec3f,\nclearCoatAARoughnessFactors: vec2f,\nclearCoatIntensity: f32,\nclearCoatRoughness: f32,\n#ifdef REFLECTION\nfinalClearCoatRadianceScaled: vec3f,\n#endif\n#ifdef CLEARCOAT_TINT\nabsorption: vec3f,\nclearCoatNdotVRefract: f32,\nclearCoatColor: vec3f,\nclearCoatThickness: f32,\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nenergyConservationFactorClearCoat: vec3f,\n#endif\n#if DEBUGMODE>0\n#ifdef CLEARCOAT_BUMP\nTBNClearCoat: mat3x3f,\n#endif\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData: vec2f,\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nclearCoatTintMapData: vec4f,\n#endif\n#ifdef REFLECTION\nenvironmentClearCoatRadiance: vec4f,\nclearCoatEnvironmentReflectance: vec3f,\n#endif\nclearCoatNdotV: f32\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\nfn clearcoatBlock(\nvPositionW: vec3f\n,geometricNormalW: vec3f\n,viewDirectionW: vec3f\n,vClearCoatParams: vec2f\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,clearCoatMapRoughnessData: vec4f\n#endif\n,specularEnvironmentR0: vec3f\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData: vec2f\n#endif\n#ifdef CLEARCOAT_TINT\n,vClearCoatTintParams: vec4f\n,clearCoatColorAtDistance: f32\n,vClearCoatRefractionParams: vec4f\n#ifdef CLEARCOAT_TINT_TEXTURE\n,clearCoatTintMapData: vec4f\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,vClearCoatBumpInfos: vec2f\n,clearCoatBumpMapData: vec4f\n,vClearCoatBumpUV: vec2f\n#if defined(TANGENT) && defined(NORMAL)\n,vTBN: mat3x3f\n#else\n,vClearCoatTangentSpaceParams: vec2f\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,normalMatrix: mat4x4f\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,faceNormal: vec3f\n#endif\n#ifdef REFLECTION\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n,vLightingIntensity: vec4f\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,ambientMonochrome: f32\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,frontFacingMultiplier: f32\n#endif \n)->clearcoatOutParams\n{var outParams: clearcoatOutParams;var clearCoatIntensity: f32=vClearCoatParams.x;var clearCoatRoughness: f32=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;outParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvar clearCoatColor: vec3f=vClearCoatTintParams.rgb;var clearCoatThickness: f32=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpaceVec3(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);outParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvar specularEnvironmentR0Updated: vec3f=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvar specularEnvironmentR0Updated: vec3f=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);var clearCoatNormalW: vec3f=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nvar clearCoatNormalScale: f32=1.0;\n#else\nvar clearCoatNormalScale: f32=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nvar TBNClearCoat: mat3x3f=vTBN;\n#else\nvar TBNClearCoatUV: vec2f=vClearCoatBumpUV*frontFacingMultiplier;var TBNClearCoat: mat3x3f=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);clearCoatNormalW=normalize( mat3x3f(normalMatrix[0].xyz,normalMatrix[1].xyz,normalMatrix[2].xyz)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);var clearCoatNdotVUnclamped: f32=dot(clearCoatNormalW,viewDirectionW);var clearCoatNdotV: f32=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvar clearCoatVRefract: vec3f=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvar environmentClearCoatBrdf: vec3f=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nvar clearCoatAlphaG: f32=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvar environmentClearCoatRadiance: vec4f= vec4f(0.,0.,0.,0.);var clearCoatReflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvar clearCoatReflectionCoords: vec3f=clearCoatReflectionVector;\n#else\nvar clearCoatReflectionCoords: vec2f=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nenvironmentClearCoatRadiance=sampleReflectionTexture(\nclearCoatAlphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,clearCoatNdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,clearCoatRoughness\n#endif\n,reflectionSampler\n,reflectionSamplerSampler\n,clearCoatReflectionCoords\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif \n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvar clearCoatEnvironmentReflectance: vec3f=getReflectanceFromBRDFLookup(vec3f(uniforms.vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nvar clearCoatEho: f32=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);clearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvar clearCoatEnvironmentReflectance: vec3f=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV, vec3f(1.), vec3f(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nvar fresnelIBLClearCoat: f32=fresnelSchlickGGX(clearCoatNdotV,uniforms.vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnelIBLClearCoat*=clearCoatIntensity;outParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\nreturn outParams;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name208]=shader208}}),name209,shader209,init_pbrBlockIridescence=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockIridescence.js"(){init_shaderStore(),name209="pbrBlockIridescence",shader209="struct iridescenceOutParams\n{iridescenceIntensity: f32,\niridescenceIOR: f32,\niridescenceThickness: f32,\nspecularEnvironmentR0: vec3f};\n#ifdef IRIDESCENCE\nfn iridescenceBlock(\nvIridescenceParams: vec4f\n,viewAngle: f32\n,specularEnvironmentR0: vec3f\n#ifdef IRIDESCENCE_TEXTURE\n,iridescenceMapData: vec2f\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,iridescenceThicknessMapData: vec2f\n#endif\n#ifdef CLEARCOAT\n,NdotVUnclamped: f32\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData: vec2f\n#endif\n#endif\n)->iridescenceOutParams\n{var outParams: iridescenceOutParams;var iridescenceIntensity: f32=vIridescenceParams.x;var iridescenceIOR: f32=vIridescenceParams.y;var iridescenceThicknessMin: f32=vIridescenceParams.z;var iridescenceThicknessMax: f32=vIridescenceParams.w;var iridescenceThicknessWeight: f32=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nvar iridescenceThickness: f32=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);var topIor: f32=1.; \n#ifdef CLEARCOAT\nvar clearCoatIntensity: f32=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,uniforms.vClearCoatRefractionParams.w-1.,clearCoatIntensity);viewAngle=sqrt(1.0+((1.0/topIor)*(1.0/topIor))*((NdotVUnclamped*NdotVUnclamped)-1.0));\n#endif\nvar iridescenceFresnel: vec3f=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);outParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);outParams.iridescenceIntensity=iridescenceIntensity;outParams.iridescenceThickness=iridescenceThickness;outParams.iridescenceIOR=iridescenceIOR;return outParams;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name209]=shader209}}),name210,shader210,init_pbrBlockSubSurface=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockSubSurface.js"(){init_shaderStore(),name210="pbrBlockSubSurface",shader210="struct subSurfaceOutParams\n{specularEnvironmentReflectance: vec3f,\n#ifdef SS_REFRACTION\nfinalRefraction: vec3f,\nsurfaceAlbedo: vec3f,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha: f32,\n#endif\n#ifdef REFLECTION\nrefractionFactorForIrradiance: f32,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\ntransmittance: vec3f,\ntranslucencyIntensity: f32,\n#ifdef REFLECTION\nrefractionIrradiance: vec3f,\n#endif\n#endif\n#if DEBUGMODE>0\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nthicknessMap: vec4f,\n#endif\n#ifdef SS_REFRACTION\nenvironmentRefraction: vec4f,\nrefractionTransmittance: vec3f\n#endif\n#endif\n};\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#define pbr_inline\nfn sampleEnvironmentRefraction(\nior: f32\n,thickness: f32\n,refractionLOD: f32\n,normalW: vec3f\n,vPositionW: vec3f\n,viewDirectionW: vec3f\n,view: mat4x4f\n,vRefractionInfos: vec4f\n,refractionMatrix: mat4x4f\n,vRefractionMicrosurfaceInfos: vec4f\n,alphaG: f32\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler: texture_cube<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_cube<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_cube<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#else\n,refractionSampler: texture_2d<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_2d<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_2d<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo: vec2f\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition: vec3f\n,refractionSize: vec3f\n#endif\n)->vec4f {var environmentRefraction: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvar refractionVector: vec3f=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,ior);\n#else\nvar refractionVector: vec3f=refract(-viewDirectionW,normalW,ior);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;var refractionCoords: vec3f=refractionVector;refractionCoords= (refractionMatrix* vec4f(refractionCoords,0)).xyz;\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvar vRefractionUVW: vec3f= (refractionMatrix*(view* vec4f(vPositionW+refractionVector*thickness,1.0))).xyz;\n#else\nvar vRefractionUVW: vec3f= (refractionMatrix*(view* vec4f(vPositionW+refractionVector*vRefractionInfos.z,1.0))).xyz;\n#endif\nvar refractionCoords: vec2f=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODBASEDMICROSFURACE\nvar lod=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nvar automaticRefractionLOD: f32=UNPACK_LOD(textureSample(refractionSampler,refractionSamplerSampler,refractionCoords).a);var requestedRefractionLOD: f32=max(automaticRefractionLOD,lod);\n#else\nvar requestedRefractionLOD: f32=lod;\n#endif\n#if defined(REALTIME_FILTERING) && defined(SS_REFRACTIONMAP_3D)\nenvironmentRefraction= vec4f(radiance(alphaG,refractionSampler,refractionSamplerSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=textureSampleLevel(refractionSampler,refractionSamplerSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nvar lodRefractionNormalized: f32=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));var lodRefractionNormalizedDoubled: f32=lodRefractionNormalized*2.0;var environmentRefractionMid: vec4f=textureSample(refractionSampler,refractionSamplerSampler,refractionCoords);if (lodRefractionNormalizedDoubled<1.0){environmentRefraction=mix(\ntextureSample(refractionHighSampler,refractionHighSamplerSampler,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);} else {environmentRefraction=mix(\nenvironmentRefractionMid,\ntextureSample(refractionLowSampler,refractionLowSamplerSampler,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);}\n#endif\nvar refraction=environmentRefraction.rgb;\n#ifdef SS_RGBDREFRACTION\nrefraction=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nrefraction=toLinearSpaceVec3(environmentRefraction.rgb);\n#endif\nreturn vec4f(refraction,environmentRefraction.a);}\n#endif\n#define pbr_inline\nfn subSurfaceBlock(\nvSubSurfaceIntensity: vec3f\n,vThicknessParam: vec2f\n,vTintColor: vec4f\n,normalW: vec3f\n,specularEnvironmentReflectance: vec3f\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,thicknessMap: vec4f\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,refractionIntensityMap: vec4f\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,translucencyIntensityMap: vec4f\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,reflectionMatrix: mat4x4f\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,irradianceVector_: vec3f\n#endif\n#if defined(REALTIME_FILTERING)\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,vReflectionFilteringInfo: vec2f\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,irradianceSampler: texture_cube<f32>\n,irradianceSamplerSampler: sampler\n#else\n,irradianceSampler: texture_2d<f32>\n,irradianceSamplerSampler: sampler\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,surfaceAlbedo: vec3f\n#endif\n#ifdef SS_REFRACTION\n,vPositionW: vec3f\n,viewDirectionW: vec3f\n,view: mat4x4f\n,vRefractionInfos: vec4f\n,refractionMatrix: mat4x4f\n,vRefractionMicrosurfaceInfos: vec4f\n,vLightingIntensity: vec4f\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,alpha: f32\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,NdotVUnclamped: f32\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,roughness: f32\n#endif\n,alphaG: f32\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler: texture_cube<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_cube<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_cube<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#else\n,refractionSampler: texture_2d<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_2d<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_2d<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo: vec2f\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition: vec3f\n,refractionSize: vec3f\n#endif\n#ifdef SS_DISPERSION\n,dispersion: f32\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,vDiffusionDistance: vec3f\n,vTranslucencyColor: vec4f\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,translucencyColorMap: vec4f\n#endif\n#endif\n)->subSurfaceOutParams\n{var outParams: subSurfaceOutParams;outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvar refractionIntensity: f32=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);outParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvar translucencyIntensity: f32=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nvar thickness: f32=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nvar thickness: f32=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=thicknessMap.a;\n#else\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nvar thickness: f32=vThicknessParam.y;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTIONINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCYINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=translucencyIntensityMap.a;\n#else\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);var translucencyColor: vec4f=vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\ntranslucencyColor*=translucencyColorMap;\n#endif\nvar transmittance: vec3f=transmittanceBRDF_Burley(translucencyColor.rgb,vDiffusionDistance,thickness);transmittance*=translucencyIntensity;outParams.transmittance=transmittance;outParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvar environmentRefraction: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef SS_HAS_THICKNESS\nvar ior: f32=vRefractionInfos.y;\n#else\nvar ior: f32=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nvar refractionAlphaG: f32=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLodFromAlphaGNdotV(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nvar refractionRoughness: f32=alphaG;refractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nvar refractionAlphaG: f32=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\nvar refraction_ior: f32=vRefractionInfos.y;\n#ifdef SS_DISPERSION\nvar realIOR: f32=1.0/refraction_ior;var iorDispersionSpread: f32=0.04*dispersion*(realIOR-1.0);var iors: vec3f= vec3f(1.0/(realIOR-iorDispersionSpread),refraction_ior,1.0/(realIOR+iorDispersionSpread));for (var i: i32=0; i<3; i++) {refraction_ior=iors[i];\n#endif\nvar envSample: vec4f=sampleEnvironmentRefraction(refraction_ior,thickness,refractionLOD,normalW,vPositionW,viewDirectionW,view,vRefractionInfos,refractionMatrix,vRefractionMicrosurfaceInfos,alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler\n,refractionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler\n,refractionLowSamplerSampler\n,refractionHighSampler\n,refractionHighSamplerSampler\n#endif\n#else\n,refractionSampler\n,refractionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler\n,refractionLowSamplerSampler\n,refractionHighSampler\n,refractionHighSamplerSampler\n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition\n,refractionSize\n#endif\n);\n#ifdef SS_DISPERSION\nenvironmentRefraction[i]=envSample[i];}\n#else\nenvironmentRefraction=envSample;\n#endif\nenvironmentRefraction=vec4f(environmentRefraction.rgb*vRefractionInfos.x,environmentRefraction.a);\n#endif\n#ifdef SS_REFRACTION\nvar refractionTransmittance: vec3f= vec3f(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvar volumeAlbedo: vec3f=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambertVec3(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nvar maxChannel: f32=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);var volumeAlbedo: vec3f=saturateVec3(maxChannel*surfaceAlbedo);environmentRefraction=vec4f(environmentRefraction.rgb*volumeAlbedo,environmentRefraction.a);\n#else\nvar volumeAlbedo: vec3f=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambertVec3(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction=vec4f(environmentRefraction.rgb*surfaceAlbedo.rgb,environmentRefraction.a);\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvar bounceSpecularEnvironmentReflectance: vec3f=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvar irradianceVector: vec3f=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvar refractionIrradiance: vec3f=irradiance(reflectionSampler,reflectionSamplerSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvar refractionIrradiance: vec3f=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvar irradianceCoords: vec3f=irradianceVector;\n#else\nvar irradianceCoords: vec2f=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvar temp: vec4f=textureSample(irradianceSampler,irradianceSamplerSampler,-irradianceCoords);var refractionIrradiance=temp.rgb;\n#ifdef RGBDREFLECTION\nrefractionIrradiance=fromRGBD(temp).rgb;\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance=toLinearSpaceVec3(refractionIrradiance);\n#endif\n#else\nvar refractionIrradiance: vec3f= vec3f(0.);\n#endif\nrefractionIrradiance*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance;\n#endif\nreturn outParams;}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name210]=shader210}}),name211,shader211,init_pbrBlockNormalGeometric=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockNormalGeometric.js"(){init_shaderStore(),name211="pbrBlockNormalGeometric",shader211="var viewDirectionW: vec3f=normalize(scene.vEyePosition.xyz-input.vPositionW);\n#ifdef NORMAL\nvar normalW: vec3f=normalize(input.vNormalW);\n#else\nvar normalW: vec3f=normalize(cross(dpdx(input.vPositionW),dpdy(input.vPositionW)))*scene.vEyePosition.w;\n#endif\nvar geometricNormalW: vec3f=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=select(-geometricNormalW,geometricNormalW,fragmentInputs.frontFacing);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name211]=shader211}}),name212,shader212,init_pbrBlockNormalFinal=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockNormalFinal.js"(){init_shaderStore(),name212="pbrBlockNormalFinal",shader212="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvar faceNormal: vec3f=normalize(cross(dpdx(fragmentInputs.vPositionW),dpdy(fragmentInputs.vPositionW)))*scene.vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=select(-faceNormal,faceNormal,fragmentInputs.frontFacing);\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=select(-normalW,normalW,fragmentInputs.frontFacing);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name212]=shader212}}),name213,shader213,init_pbrBlockLightmapInit=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockLightmapInit.js"(){init_shaderStore(),name213="pbrBlockLightmapInit",shader213="#ifdef LIGHTMAP\nvar lightmapColor: vec4f=textureSample(lightmapSampler,lightmapSamplerSampler,fragmentInputs.vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor=vec4f(fromRGBD(lightmapColor),lightmapColor.a);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor=vec4f(toLinearSpaceVec3(lightmapColor.rgb),lightmapColor.a);\n#endif\nlightmapColor=vec4f(lightmapColor.rgb*uniforms.vLightmapInfos.y,lightmapColor.a);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name213]=shader213}}),name214,shader214,init_pbrBlockGeometryInfo=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockGeometryInfo.js"(){init_shaderStore(),name214="pbrBlockGeometryInfo",shader214="var NdotVUnclamped: f32=dot(normalW,viewDirectionW);var NdotV: f32=absEps(NdotVUnclamped);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var AARoughnessFactors: vec2f=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvar environmentBrdf: vec3f=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nvar ambientMonochrome: f32=aoOut.ambientOcclusionColor.r;\n#else\nvar ambientMonochrome: f32=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nvar seo: f32=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nvar eho: f32=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name214]=shader214}}),name215,shader215,init_pbrBlockReflectance0=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockReflectance0.js"(){init_shaderStore(),name215="pbrBlockReflectance0",shader215="var reflectance: f32=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);var specularEnvironmentR0: vec3f=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvar specularEnvironmentR90: vec3f= vec3f(metallicReflectanceFactors.a);\n#else \nvar specularEnvironmentR90: vec3f= vec3f(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nvar reflectance90: f32=fresnelGrazingReflectance(reflectance);specularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name215]=shader215}}),name216,shader216,init_pbrBlockReflectance=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockReflectance.js"(){init_shaderStore(),name216="pbrBlockReflectance",shader216="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvar specularEnvironmentReflectance: vec3f=getReflectanceFromBRDFWithEnvLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvar specularEnvironmentReflectance: vec3f=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name216]=shader216}}),name217,shader217,init_pbrBlockDirectLighting=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockDirectLighting.js"(){init_shaderStore(),name217="pbrBlockDirectLighting",shader217="var diffuseBase: vec3f=vec3f(0.,0.,0.);\n#ifdef SPECULARTERM\nvar specularBase: vec3f=vec3f(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvar clearCoatBase: vec3f=vec3f(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvar sheenBase: vec3f=vec3f(0.,0.,0.);\n#endif\nvar preInfo: preLightingInfo;var info: lightingInfo;var shadow: f32=1.; \nvar aggShadow: f32=0.;var numLights: f32=0.;\n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvar absorption: vec3f=vec3f(0.);\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name217]=shader217}}),name218,shader218,init_pbrBlockFinalLitComponents=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockFinalLitComponents.js"(){init_shaderStore(),name218="pbrBlockFinalLitComponents",shader218="aggShadow=aggShadow/numLights;\n#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvar energyConservationFactor: vec3f=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvar finalIrradiance: vec3f=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);finalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;finalIrradiance*=uniforms.vLightingIntensity.z;finalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvar finalSpecular: vec3f=specularBase;finalSpecular=max(finalSpecular,vec3f(0.0));var finalSpecularScaled: vec3f=finalSpecular*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvar finalRadiance: vec3f=reflectionOut.environmentRadiance.rgb;finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;var finalRadianceScaled: vec3f=finalRadiance*uniforms.vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvar finalSheen: vec3f=sheenBase*sheenOut.sheenColor;finalSheen=max(finalSheen,vec3f(0.0));var finalSheenScaled: vec3f=finalSheen*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvar finalClearCoat: vec3f=clearCoatBase;finalClearCoat=max(finalClearCoat,vec3f(0.0));var finalClearCoatScaled: vec3f=finalClearCoat*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nvar luminanceOverAlpha: f32=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name218]=shader218}}),name219,shader219,init_pbrBlockFinalUnlitComponents=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockFinalUnlitComponents.js"(){init_shaderStore(),name219="pbrBlockFinalUnlitComponents",shader219="var finalDiffuse: vec3f=diffuseBase;finalDiffuse*=surfaceAlbedo.rgb;finalDiffuse=max(finalDiffuse,vec3f(0.0));finalDiffuse*=uniforms.vLightingIntensity.x;var finalAmbient: vec3f=uniforms.vAmbientColor;finalAmbient*=surfaceAlbedo.rgb;var finalEmissive: vec3f=uniforms.vEmissiveColor;\n#ifdef EMISSIVE\nvar emissiveColorTex: vec3f=textureSample(emissiveSampler,emissiveSamplerSampler,fragmentInputs.vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpaceVec3(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= uniforms.vEmissiveInfos.y;\n#endif\nfinalEmissive*=uniforms.vLightingIntensity.y;\n#ifdef AMBIENT\nvar ambientOcclusionForDirectDiffuse: vec3f=mix( vec3f(1.),aoOut.ambientOcclusionColor,uniforms.vAmbientInfos.w);\n#else\nvar ambientOcclusionForDirectDiffuse: vec3f=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;finalDiffuse*=ambientOcclusionForDirectDiffuse;\n",ShaderStore.IncludesShadersStoreWGSL[name219]=shader219}}),name220,shader220,init_pbrBlockFinalColorComposition=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockFinalColorComposition.js"(){init_shaderStore(),name220="pbrBlockFinalColorComposition",shader220="var finalColor: vec4f= vec4f(\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalAmbient +\nfinalDiffuse,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor=vec4f(finalColor.rgb*lightmapColor.rgb,finalColor.a);\n#else\nfinalColor=vec4f(finalColor.rgb+lightmapColor.rgb,finalColor.a);\n#endif\n#endif\n#endif\nfinalColor=vec4f(finalColor.rgb+finalEmissive,finalColor.a);\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,vec4f(0.0));\n",ShaderStore.IncludesShadersStoreWGSL[name220]=shader220}}),name221,shader221,init_pbrBlockImageProcessing=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockImageProcessing.js"(){init_shaderStore(),name221="pbrBlockImageProcessing",shader221="#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor=vec4f(clamp(finalColor.rgb,vec3f(0.),vec3f(30.0)),finalColor.a);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor=vec4f(finalColor.rgb,finalColor.a*mesh.visibility);\n#ifdef PREMULTIPLYALPHA\nfinalColor=vec4f(finalColor.rgb*finalColor.a,finalColor.a);;\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name221]=shader221}}),name222,shader222,init_pbrDebug=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrDebug.js"(){init_shaderStore(),name222="pbrDebug",shader222="#if DEBUGMODE>0\nif (input.vClipSpacePosition.x/input.vClipSpacePosition.w>=uniforms.vDebugMode.x) {var color: vec3f;\n#if DEBUGMODE==1\ncolor=fragmentInputs.vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ncolor=fragmentInputs.vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ncolor=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ncolor=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ncolor=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ncolor= vec3f(input.vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ncolor= vec3f(input.vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ncolor=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ncolor=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ncolor=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ncolor=albedoTexture.rgb;\n#ifndef GAMMAALBEDO\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==21 && defined(AMBIENT)\ncolor=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ncolor=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ncolor=emissiveColorTex.rgb;\n#ifndef GAMMAEMISSIVE\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ncolor=lightmapColor;\n#ifndef GAMMALIGHTMAP\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ncolor=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ncolor=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ncolor= vec3f(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ncolor=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ncolor=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ncolor=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ncolor=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==32 && defined(BUMP)\ncolor=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ncolor=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ncolor=reflectionOut.environmentRadiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ncolor=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ncolor=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ncolor=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ncolor=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ncolor=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ncolor=reflectionOut.environmentIrradiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==60\ncolor=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ncolor=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ncolor= vec3f(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ncolor=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ncolor= vec3f(roughness);\n#elif DEBUGMODE==64\ncolor= vec3f(alphaG);\n#elif DEBUGMODE==65\ncolor= vec3f(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ncolor=clearcoatOut.clearCoatColor;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ncolor= vec3f(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ncolor= vec3f(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ncolor=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ncolor=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==72\ncolor= vec3f(microSurface);\n#elif DEBUGMODE==73\ncolor=uniforms.vAlbedoColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==74 && !defined(METALLICWORKFLOW)\ncolor=uniforms.vReflectivityColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==75\ncolor=uniforms.vEmissiveColor;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ncolor= vec3f(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\ncolor= vec3f(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ncolor= vec3f(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ncolor=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ncolor=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ncolor=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ncolor= vec3f(luminanceOverAlpha);\n#elif DEBUGMODE==87\ncolor= vec3f(alpha);\n#elif DEBUGMODE==88 && defined(ALBEDO)\ncolor= vec3f(albedoTexture.a);\n#elif DEBUGMODE==89\ncolor=aoOut.ambientOcclusionColor;\n#else\nvar stripeWidth: f32=30.;var stripePos: f32=abs(floor(input.position.x/stripeWidth));var whichColor: f32=((stripePos)%(2.));var color1: vec3f= vec3f(.6,.2,.2);var color2: vec3f= vec3f(.3,.1,.1);color=mix(color1,color2,whichColor);\n#endif\ncolor*=uniforms.vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ncolor=normalize(color)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ncolor=toGammaSpaceVec3(color);\n#endif\nfragmentOutputs.color=vec4f(color,1.0);\n#ifdef PREPASS\nfragmentOutputs.fragData0=toLinearSpaceVec3(color); \nfragmentOutputs.fragData1=vec4f(0.,0.,0.,0.); \n#endif\n#ifdef DEBUGMODE_FORCERETURN\nreturn fragmentOutputs;\n#endif\n}\n#endif\n",ShaderStore.IncludesShadersStoreWGSL[name222]=shader222}}),pbr_fragment_exports={},name223,shader223,pbrPixelShaderWGSL;__export(pbr_fragment_exports,{pbrPixelShaderWGSL:()=>pbrPixelShaderWGSL});var init_pbr_fragment=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/ShadersWGSL/pbr.fragment.js"(){init_shaderStore(),init_prePassDeclaration(),init_oitDeclaration(),init_pbrUboDeclaration(),init_pbrFragmentExtraDeclaration(),init_lightUboDeclaration(),init_pbrFragmentSamplersDeclaration(),init_imageProcessingDeclaration(),init_clipPlaneFragmentDeclaration(),init_logDepthDeclaration(),init_fogFragmentDeclaration(),init_helperFunctions(),init_subSurfaceScatteringFunctions(),init_importanceSampling(),init_pbrHelperFunctions(),init_imageProcessingFunctions(),init_shadowsFragmentFunctions(),init_harmonicsFunctions(),init_pbrDirectLightingSetupFunctions(),init_pbrDirectLightingFalloffFunctions(),init_pbrBRDFFunctions(),init_hdrFilteringFunctions(),init_pbrDirectLightingFunctions(),init_pbrIBLFunctions(),init_bumpFragmentMainFunctions(),init_bumpFragmentFunctions(),init_reflectionFunction(),init_pbrBlockAlbedoOpacity(),init_pbrBlockReflectivity(),init_pbrBlockAmbientOcclusion(),init_pbrBlockAlphaFresnel(),init_pbrBlockAnisotropic(),init_pbrBlockReflection(),init_pbrBlockSheen(),init_pbrBlockClearcoat(),init_pbrBlockIridescence(),init_pbrBlockSubSurface(),init_clipPlaneFragment(),init_pbrBlockNormalGeometric(),init_bumpFragment(),init_pbrBlockNormalFinal(),init_depthPrePass(),init_pbrBlockLightmapInit(),init_pbrBlockGeometryInfo(),init_pbrBlockReflectance0(),init_pbrBlockReflectance(),init_pbrBlockDirectLighting(),init_lightFragment(),init_pbrBlockFinalLitComponents(),init_pbrBlockFinalUnlitComponents(),init_pbrBlockFinalColorComposition(),init_logDepthFragment(),init_fogFragment(),init_pbrBlockImageProcessing(),init_oitFragment(),init_pbrDebug(),name223="pbrPixelShader",shader223="#define CUSTOM_FRAGMENT_BEGIN\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n#include<pbrUboDeclaration>\n#include<pbrFragmentExtraDeclaration>\n#include<lightUboDeclaration>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockIridescence>\n#include<pbrBlockSubSurface>\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\nvar albedoOpacityOut: albedoOpacityOutParams;\n#ifdef ALBEDO\nvar albedoTexture: vec4f=textureSample(albedoSampler,albedoSamplerSampler,fragmentInputs.vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvar opacityMap: vec4f=textureSample(opacitySampler,opacitySamplerSampler,fragmentInputs.vOpacityUV+uvOffset);\n#endif\n#ifdef DECAL\nvar decalColor: vec4f=textureSample(decalSampler,decalSamplerSampler,fragmentInputs.vDecalUV+uvOffset);\n#endif\nalbedoOpacityOut=albedoOpacityBlock(\nuniforms.vAlbedoColor\n#ifdef ALBEDO\n,albedoTexture\n,uniforms.vAlbedoInfos\n#endif\n#ifdef OPACITY\n,opacityMap\n,uniforms.vOpacityInfos\n#endif\n#ifdef DETAIL\n,detailColor\n,uniforms.vDetailInfos\n#endif\n#ifdef DECAL\n,decalColor\n,uniforms.vDecalInfos\n#endif\n);var surfaceAlbedo: vec3f=albedoOpacityOut.surfaceAlbedo;var alpha: f32=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\nvar aoOut: ambientOcclusionOutParams;\n#ifdef AMBIENT\nvar ambientOcclusionColorMap: vec3f=textureSample(ambientSampler,ambientSamplerSampler,fragmentInputs.vAmbientUV+uvOffset).rgb;\n#endif\naoOut=ambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nuniforms.vAmbientInfos\n#endif \n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvar diffuseBase: vec3f= vec3f(1.,1.,1.);\n#else\nvar baseColor: vec3f=surfaceAlbedo;var reflectivityOut: reflectivityOutParams;\n#if defined(REFLECTIVITY)\nvar surfaceMetallicOrReflectivityColorMap: vec4f=textureSample(reflectivitySampler,reflectivitySamplerSampler,fragmentInputs.vReflectivityUV+uvOffset);var baseReflectivity: vec4f=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\n#ifdef REFLECTIVITY_GAMMA\nsurfaceMetallicOrReflectivityColorMap=toLinearSpaceVec4(surfaceMetallicOrReflectivityColorMap);\n#endif\nsurfaceMetallicOrReflectivityColorMap=vec4f(surfaceMetallicOrReflectivityColorMap.rgb*uniforms.vReflectivityInfos.y,surfaceMetallicOrReflectivityColorMap.a);\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvar microSurfaceTexel: vec4f=textureSample(microSurfaceSampler,microSurfaceSamplerSampler,fragmentInputs.vMicroSurfaceSamplerUV+uvOffset)*uniforms.vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvar metallicReflectanceFactors: vec4f=uniforms.vMetallicReflectanceFactors;\n#ifdef REFLECTANCE\nvar reflectanceFactorsMap: vec4f=textureSample(reflectanceSampler,reflectanceSamplerSampler,fragmentInputs.vReflectanceUV+uvOffset);\n#ifdef REFLECTANCE_GAMMA\nreflectanceFactorsMap=toLinearSpaceVec4(reflectanceFactorsMap);\n#endif\nmetallicReflectanceFactors=vec4f(metallicReflectanceFactors.rgb*reflectanceFactorsMap.rgb,metallicReflectanceFactors.a);\n#endif\n#ifdef METALLIC_REFLECTANCE\nvar metallicReflectanceFactorsMap: vec4f=textureSample(metallicReflectanceSampler,metallicReflectanceSamplerSampler,fragmentInputs.vMetallicReflectanceUV+uvOffset);\n#ifdef METALLIC_REFLECTANCE_GAMMA\nmetallicReflectanceFactorsMap=toLinearSpaceVec4(metallicReflectanceFactorsMap);\n#endif\n#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY\nmetallicReflectanceFactors=vec4f(metallicReflectanceFactors.rgb*reflectanceFactorsMap.rgb,metallicReflectanceFactors.a);\n#endif\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap.a;\n#endif\n#endif\nreflectivityOut=reflectivityBlock(\nuniforms.vReflectivityColor\n#ifdef METALLICWORKFLOW\n,surfaceAlbedo\n,metallicReflectanceFactors\n#endif\n#ifdef REFLECTIVITY\n,uniforms.vReflectivityInfos\n,surfaceMetallicOrReflectivityColorMap\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,aoOut.ambientOcclusionColor\n#endif\n#ifdef MICROSURFACEMAP\n,microSurfaceTexel\n#endif\n#ifdef DETAIL\n,detailColor\n,uniforms.vDetailInfos\n#endif\n);var microSurface: f32=reflectivityOut.microSurface;var roughness: f32=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nvar alphaFresnelOut: alphaFresnelOutParams;alphaFresnelOut=alphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface\n);alpha=alphaFresnelOut.alpha;\n#endif\n#endif\n#include<pbrBlockGeometryInfo>\n#ifdef ANISOTROPIC\nvar anisotropicOut: anisotropicOutParams;\n#ifdef ANISOTROPIC_TEXTURE\nvar anisotropyMapData: vec3f=textureSample(anisotropySampler,anisotropySamplerSampler,fragmentInputs.vAnisotropyUV+uvOffset).rgb*uniforms.vAnisotropyInfos.y;\n#endif\nanisotropicOut=anisotropicBlock(\nuniforms.vAnisotropy,\nroughness,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW \n);\n#endif\n#ifdef REFLECTION\nvar reflectionOut: reflectionOutParams;\n#ifndef USE_CUSTOM_REFLECTION\nreflectionOut=reflectionBlock(\ninput.vPositionW\n,normalW\n,alphaG\n,uniforms.vReflectionMicrosurfaceInfos\n,uniforms.vReflectionInfos\n,uniforms.vReflectionColor\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness\n#endif\n,reflectionSampler\n,reflectionSamplerSampler\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,input.vEnvironmentIrradiance\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,uniforms.reflectionMatrix\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n,irradianceSampler\n,irradianceSamplerSampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,uniforms.vReflectionFilteringInfo\n#endif\n);\n#else\n#define CUSTOM_REFLECTION\n#endif\n#endif\n#include<pbrBlockReflectance0>\n#ifdef SHEEN\nvar sheenOut: sheenOutParams;\n#ifdef SHEEN_TEXTURE\nvar sheenMapData: vec4f=textureSample(sheenSampler,sheenSamplerSampler,fragmentInputs.vSheenUV+uvOffset);\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvar sheenMapRoughnessData: vec4f=textureSample(sheenRoughnessSampler,sheenRoughnessSamplerSampler,fragmentInputs.vSheenRoughnessUV+uvOffset)*uniforms.vSheenInfos.w;\n#endif\nsheenOut=sheenBlock(\nuniforms.vSheenColor\n#ifdef SHEEN_ROUGHNESS\n,uniforms.vSheenRoughness\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,sheenMapRoughnessData\n#endif\n#endif\n,roughness\n#ifdef SHEEN_TEXTURE\n,sheenMapData\n,uniforms.vSheenInfos.y\n#endif\n,reflectance\n#ifdef SHEEN_LINKWITHALBEDO\n,baseColor\n,surfaceAlbedo\n#endif\n#ifdef ENVIRONMENTBRDF\n,NdotV\n,environmentBrdf\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,AARoughnessFactors\n,uniforms.vReflectionMicrosurfaceInfos\n,uniforms.vReflectionInfos\n,uniforms.vReflectionColor\n,uniforms.vLightingIntensity\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionOut.reflectionCoords\n,NdotVUnclamped\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,seo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,eho\n#endif\n#endif\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvar clearCoatMapData: vec2f=textureSample(clearCoatSampler,clearCoatSamplerSampler,fragmentInputs.vClearCoatUV+uvOffset).rg*uniforms.vClearCoatInfos.y;\n#endif\n#endif\n#ifdef IRIDESCENCE\nvar iridescenceOut: iridescenceOutParams;\n#ifdef IRIDESCENCE_TEXTURE\nvar iridescenceMapData: vec2f=textureSample(iridescenceSampler,iridescenceSamplerSampler,fragmentInputs.vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nvar iridescenceThicknessMapData: vec2f=textureSample(iridescenceThicknessSampler,iridescenceThicknessSamplerSampler,fragmentInputs.vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;\n#endif\niridescenceOut=iridescenceBlock(\nuniforms.vIridescenceParams\n,NdotV\n,specularEnvironmentR0\n#ifdef IRIDESCENCE_TEXTURE\n,iridescenceMapData\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,iridescenceThicknessMapData\n#endif\n#ifdef CLEARCOAT\n,NdotVUnclamped\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData\n#endif\n#endif\n);var iridescenceIntensity: f32=iridescenceOut.iridescenceIntensity;specularEnvironmentR0=iridescenceOut.specularEnvironmentR0;\n#endif\nvar clearcoatOut: clearcoatOutParams;\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvar clearCoatMapRoughnessData: vec4f=textureSample(clearCoatRoughnessSampler,clearCoatRoughnessSamplerSampler,fragmentInputs.vClearCoatRoughnessUV+uvOffset)*uniforms.vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvar clearCoatTintMapData: vec4f=textureSample(clearCoatTintSampler,clearCoatTintSamplerSampler,fragmentInputs.vClearCoatTintUV+uvOffset);\n#endif\n#ifdef CLEARCOAT_BUMP\nvar clearCoatBumpMapData: vec4f=textureSample(clearCoatBumpSampler,clearCoatBumpSamplerSampler,fragmentInputs.vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatOut=clearcoatBlock(\ninput.vPositionW\n,geometricNormalW\n,viewDirectionW\n,uniforms.vClearCoatParams\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,clearCoatMapRoughnessData\n#endif\n,specularEnvironmentR0\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData\n#endif\n#ifdef CLEARCOAT_TINT\n,uniforms.vClearCoatTintParams\n,uniforms.clearCoatColorAtDistance\n,uniforms.vClearCoatRefractionParams\n#ifdef CLEARCOAT_TINT_TEXTURE\n,clearCoatTintMapData\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,uniforms.vClearCoatBumpInfos\n,clearCoatBumpMapData\n,fragmentInputs.vClearCoatBumpUV\n#if defined(TANGENT) && defined(NORMAL)\n,vTBN\n#else\n,uniforms.vClearCoatTangentSpaceParams\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,uniforms.normalMatrix\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,faceNormal\n#endif\n#ifdef REFLECTION\n,uniforms.vReflectionMicrosurfaceInfos\n,uniforms.vReflectionInfos\n,uniforms.vReflectionColor\n,uniforms.vLightingIntensity\n,reflectionSampler\n,reflectionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,uniforms.vReflectionFilteringInfo\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,ambientMonochrome\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,select(-1.,1.,fragmentInputs.frontFacing)\n#endif\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n#include<pbrBlockReflectance>\nvar subSurfaceOut: subSurfaceOutParams;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvar thicknessMap: vec4f=textureSample(thicknessSampler,thicknessSamplerSampler,fragmentInputs.vThicknessUV+uvOffset);\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nvar refractionIntensityMap: vec4f=textureSample(refractionIntensitySampler,refractionIntensitySamplerSampler,fragmentInputs.vRefractionIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nvar translucencyIntensityMap: vec4f=textureSample(translucencyIntensitySampler,translucencyIntensitySamplerSampler,fragmentInputs.vTranslucencyIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nvar translucencyColorMap: vec4f=textureSample(translucencyColorSampler,translucencyColorSamplerSampler,fragmentInputs.vTranslucencyColorUV+uvOffset);\n#endif\nsubSurfaceOut=subSurfaceBlock(\nuniforms.vSubSurfaceIntensity\n,uniforms.vThicknessParam\n,uniforms.vTintColor\n,normalW\n,specularEnvironmentReflectance\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,thicknessMap\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,refractionIntensityMap\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,translucencyIntensityMap\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,uniforms.reflectionMatrix\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionOut.irradianceVector\n#endif\n#if defined(REALTIME_FILTERING)\n,reflectionSampler\n,reflectionSamplerSampler\n,vReflectionFilteringInfo\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n,irradianceSampler\n,irradianceSamplerSampler\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,surfaceAlbedo\n#endif\n#ifdef SS_REFRACTION\n,input.vPositionW\n,viewDirectionW\n,scene.view\n,uniforms.vRefractionInfos\n,uniforms.refractionMatrix\n,uniforms.vRefractionMicrosurfaceInfos\n,uniforms.vLightingIntensity\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,alpha\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,NdotVUnclamped\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,roughness\n#endif\n,alphaG\n,refractionSampler\n,refractionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler\n,refractionLowSamplerSampler\n,refractionHighSampler\n,refractionHighSamplerSampler\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,uniforms.vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,uniforms.vRefractionPosition\n,uniforms.vRefractionSize\n#endif\n#ifdef SS_DISPERSION\n,dispersion\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,uniforms.vDiffusionDistance\n,uniforms.vTranslucencyColor\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,translucencyColorMap\n#endif\n#endif\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n#include<pbrBlockFinalLitComponents>\n#endif \n#include<pbrBlockFinalUnlitComponents>\n#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nvar writeGeometryInfo: f32=select(0.0,1.0,finalColor.a>0.4);var fragData: array<vec4<f32>,SCENE_MRT_COUNT>;\n#ifdef PREPASS_POSITION\nfragData[PREPASS_POSITION_INDEX]= vec4f(input.vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvar a: vec2f=(fragmentInputs.vCurrentPosition.xy/fragmentInputs.vCurrentPosition.w)*0.5+0.5;var b: vec2f=(fragmentInputs.vPreviousPosition.xy/fragmentInputs.vPreviousPosition.w)*0.5+0.5;var velocity: vec2f=abs(a-b);velocity= vec2f(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;fragData[PREPASS_VELOCITY_INDEX]= vec4f(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nvar sqAlbedo: vec3f=sqrt(surfaceAlbedo); \n#endif\n#ifdef PREPASS_IRRADIANCE\nvar irradiance: vec3f=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\n#ifdef SS_SCATTERING\nfragData[0]= vec4f(finalColor.rgb-irradiance,finalColor.a); \nirradiance/=sqAlbedo;\n#else\nfragData[0]=finalColor; \nvar scatteringDiffusionProfile: f32=255.;\n#endif\nfragData[PREPASS_IRRADIANCE_INDEX]= vec4f(clamp(irradiance, vec3f(0.), vec3f(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); \n#else\nfragData[0]= vec4f(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTH\nfragData[PREPASS_DEPTH_INDEX]= vec4f(fragmentInputs.vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\n#ifdef PREPASS_NORMAL_WORLDSPACE\nfragData[PREPASS_NORMAL_INDEX]= vec4f(normalW,writeGeometryInfo); \n#else\nfragData[PREPASS_NORMAL_INDEX]= vec4f(normalize((scene.view* vec4f(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nfragData[PREPASS_ALBEDO_SQRT_INDEX]= vec4f(sqAlbedo,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#ifndef UNLIT\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f(specularEnvironmentR0,microSurface)*writeGeometryInfo;\n#else\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f( 0.0,0.0,0.0,1.0 )*writeGeometryInfo;\n#endif\n#endif\n#if SCENE_MRT_COUNT>0\nfragmentOutputs.fragData0= fragData[0];\n#endif\n#if SCENE_MRT_COUNT>1\nfragmentOutputs.fragData1= fragData[1];\n#endif\n#if SCENE_MRT_COUNT>2\nfragmentOutputs.fragData2= fragData[2];\n#endif\n#if SCENE_MRT_COUNT>3\nfragmentOutputs.fragData3= fragData[3];\n#endif\n#if SCENE_MRT_COUNT>4\nfragmentOutputs.fragData4= fragData[4];\n#endif\n#if SCENE_MRT_COUNT>5\nfragmentOutputs.fragData5= fragData[5];\n#endif\n#if SCENE_MRT_COUNT>6\nfragmentOutputs.fragData6= fragData[6];\n#endif\n#if SCENE_MRT_COUNT>7\nfragmentOutputs.fragData7= fragData[7];\n#endif\n#endif\n#if !defined(PREPASS) && !defined(ORDER_INDEPENDENT_TRANSPARENCY)\nfragmentOutputs.color=finalColor;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {fragmentOutputs.frontColor=vec4f(fragmentOutputs.frontColor.rgb+finalColor.rgb*finalColor.a*alphaMultiplier,1.0-alphaMultiplier*(1.0-finalColor.a));} else {fragmentOutputs.backColor+=finalColor;}\n#endif\n#include<pbrDebug>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n",ShaderStore.ShadersStoreWGSL[name223]=shader223,pbrPixelShaderWGSL={name:name223,shader:shader223}}}),name224,shader224,init_pbrVertexDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrVertexDeclaration.js"(){init_shaderStore(),init_decalVertexDeclaration(),name224="pbrVertexDeclaration",shader224="uniform mat4 view;uniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;uniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;uniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;uniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;uniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;uniform mat4 reflectivityMatrix;\n#endif\n#ifdef METALLIC_REFLECTANCE\nuniform vec2 vMetallicReflectanceInfos;uniform mat4 metallicReflectanceMatrix;\n#endif\n#ifdef REFLECTANCE\nuniform vec2 vReflectanceInfos;uniform mat4 reflectanceMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;uniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;uniform mat4 reflectionMatrix;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;uniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;uniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#ifdef IRIDESCENCE\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;uniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;uniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;uniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;uniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;uniform mat4 translucencyIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nuniform vec2 vTranslucencyColorInfos;uniform mat4 translucencyColorMatrix;\n#endif\n#endif\n#ifdef NORMAL\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;uniform vec3 vSphericalL1_1;uniform vec3 vSphericalL10;uniform vec3 vSphericalL11;uniform vec3 vSphericalL2_2;uniform vec3 vSphericalL2_1;uniform vec3 vSphericalL20;uniform vec3 vSphericalL21;uniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;uniform vec3 vSphericalY;uniform vec3 vSphericalZ;uniform vec3 vSphericalXX_ZZ;uniform vec3 vSphericalYY_ZZ;uniform vec3 vSphericalZZ;uniform vec3 vSphericalXY;uniform vec3 vSphericalYZ;uniform vec3 vSphericalZX;\n#endif\n#endif\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;uniform mat4 detailMatrix;\n#endif\n#include<decalVertexDeclaration>\n#define ADDITIONAL_VERTEX_DECLARATION\n",ShaderStore.IncludesShadersStore[name224]=shader224}}),name225,shader225,init_pbrUboDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrUboDeclaration.js"(){init_shaderStore(),init_sceneUboDeclaration2(),init_meshUboDeclaration2(),name225="pbrUboDeclaration",shader225="layout(std140,column_major) uniform;uniform Material {vec2 vAlbedoInfos;vec4 vAmbientInfos;vec2 vOpacityInfos;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec3 vReflectivityInfos;vec2 vMicroSurfaceSamplerInfos;vec2 vReflectionInfos;vec2 vReflectionFilteringInfo;vec3 vReflectionPosition;vec3 vReflectionSize;vec3 vBumpInfos;mat4 albedoMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 reflectivityMatrix;mat4 microSurfaceSamplerMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;mat4 reflectionMatrix;vec3 vReflectionColor;vec4 vAlbedoColor;vec4 vLightingIntensity;vec3 vReflectionMicrosurfaceInfos;float pointSize;vec4 vReflectivityColor;vec3 vEmissiveColor;vec3 vAmbientColor;vec2 vDebugMode;vec4 vMetallicReflectanceFactors;vec2 vMetallicReflectanceInfos;mat4 metallicReflectanceMatrix;vec2 vReflectanceInfos;mat4 reflectanceMatrix;vec3 vSphericalL00;vec3 vSphericalL1_1;vec3 vSphericalL10;vec3 vSphericalL11;vec3 vSphericalL2_2;vec3 vSphericalL2_1;vec3 vSphericalL20;vec3 vSphericalL21;vec3 vSphericalL22;vec3 vSphericalX;vec3 vSphericalY;vec3 vSphericalZ;vec3 vSphericalXX_ZZ;vec3 vSphericalYY_ZZ;vec3 vSphericalZZ;vec3 vSphericalXY;vec3 vSphericalYZ;vec3 vSphericalZX;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",ShaderStore.IncludesShadersStore[name225]=shader225}}),name226,shader226,init_harmonicsFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/harmonicsFunctions.js"(){init_shaderStore(),name226="harmonicsFunctions",shader226="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nvec3 computeEnvironmentIrradiance(vec3 normal) {return vSphericalL00\n+ vSphericalL1_1*(normal.y)\n+ vSphericalL10*(normal.z)\n+ vSphericalL11*(normal.x)\n+ vSphericalL2_2*(normal.y*normal.x)\n+ vSphericalL2_1*(normal.y*normal.z)\n+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ vSphericalL21*(normal.z*normal.x)\n+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));}\n#else\nvec3 computeEnvironmentIrradiance(vec3 normal) {float Nx=normal.x;float Ny=normal.y;float Nz=normal.z;vec3 C1=vSphericalZZ.rgb;vec3 Cx=vSphericalX.rgb;vec3 Cy=vSphericalY.rgb;vec3 Cz=vSphericalZ.rgb;vec3 Cxx_zz=vSphericalXX_ZZ.rgb;vec3 Cyy_zz=vSphericalYY_ZZ.rgb;vec3 Cxy=vSphericalXY.rgb;vec3 Cyz=vSphericalYZ.rgb;vec3 Czx=vSphericalZX.rgb;vec3 a1=Cyy_zz*Ny+Cy;vec3 a2=Cyz*Nz+a1;vec3 b1=Czx*Nz+Cx;vec3 b2=Cxy*Ny+b1;vec3 b3=Cxx_zz*Nx+b2;vec3 t1=Cz *Nz+C1;vec3 t2=a2 *Ny+t1;vec3 t3=b3 *Nx+t2;return t3;}\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name226]=shader226}}),pbr_vertex_exports2={},name227,shader227,pbrVertexShader;__export(pbr_vertex_exports2,{pbrVertexShader:()=>pbrVertexShader});var init_pbr_vertex2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/pbr.vertex.js"(){init_shaderStore(),init_pbrVertexDeclaration(),init_pbrUboDeclaration2(),init_uvAttributeDeclaration2(),init_mainUVVaryingDeclaration2(),init_helperFunctions2(),init_bonesDeclaration2(),init_bakedVertexAnimationDeclaration2(),init_instancesDeclaration2(),init_prePassVertexDeclaration2(),init_samplerVertexDeclaration2(),init_harmonicsFunctions2(),init_bumpVertexDeclaration2(),init_clipPlaneVertexDeclaration2(),init_fogVertexDeclaration2(),init_lightVxFragmentDeclaration(),init_lightVxUboDeclaration2(),init_morphTargetsVertexGlobalDeclaration2(),init_morphTargetsVertexDeclaration2(),init_logDepthDeclaration2(),init_morphTargetsVertexGlobal2(),init_morphTargetsVertex2(),init_instancesVertex2(),init_bonesVertex2(),init_bakedVertexAnimation2(),init_prePassVertex2(),init_uvVariableDeclaration2(),init_samplerVertexImplementation2(),init_bumpVertex2(),init_clipPlaneVertex2(),init_fogVertex2(),init_shadowsVertex2(),init_vertexColorMixing2(),init_logDepthVertex2(),name227="pbrVertexShader",shader227="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)\n#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)\n#ifdef CLEARCOAT\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor)\n#endif\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);vPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);vPositionW=vec3(worldPos);\n#include<prePassVertex>\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)\n#ifdef CLEARCOAT\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)\n#endif\n#ifdef SHEEN\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheenRoughness,_INFONAME_,SheenInfos.z)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_MATRIXNAME_,translucencyColor,_INFONAME_,TranslucencyColorInfos.x)\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}",ShaderStore.ShadersStore[name227]=shader227,pbrVertexShader={name:name227,shader:shader227}}}),name228,shader228,init_pbrFragmentDeclaration=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentDeclaration.js"(){init_shaderStore(),init_decalFragmentDeclaration(),name228="pbrFragmentDeclaration",shader228="uniform vec4 vEyePosition;uniform vec3 vReflectionColor;uniform vec4 vAlbedoColor;uniform vec4 vLightingIntensity;uniform vec4 vReflectivityColor;uniform vec4 vMetallicReflectanceFactors;uniform vec3 vEmissiveColor;uniform float visibility;uniform vec3 vAmbientColor;\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REALTIME_FILTERING\nuniform vec2 vReflectionFilteringInfo;\n#endif\nuniform mat4 reflectionMatrix;uniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;uniform vec3 vReflectionSize; \n#endif\n#endif\n#if defined(SS_REFRACTION) && defined(SS_USE_LOCAL_REFRACTIONMAP_CUBIC)\nuniform vec3 vRefractionPosition;uniform vec3 vRefractionSize; \n#endif\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;uniform vec4 vClearCoatRefractionParams;\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;uniform vec2 vClearCoatTangentSpaceParams;uniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;uniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;uniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n#ifdef IRIDESCENCE\nuniform vec4 vIridescenceParams;\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;uniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_ROUGHNESS\nuniform float vSheenRoughness;\n#endif\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionMicrosurfaceInfos;uniform vec4 vRefractionInfos;uniform mat4 refractionMatrix;\n#ifdef REALTIME_FILTERING\nuniform vec2 vRefractionFilteringInfo;\n#endif\n#ifdef SS_DISPERSION\nuniform float dispersion;\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;uniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;uniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;uniform mat4 translucencyIntensityMatrix;\n#endif\nuniform vec2 vThicknessParam;uniform vec3 vDiffusionDistance;uniform vec4 vTintColor;uniform vec3 vSubSurfaceIntensity;uniform vec4 vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nuniform vec2 vTranslucencyColorInfos;uniform mat4 translucencyColorMatrix;\n#endif\n#endif\n#ifdef PREPASS\n#ifdef SS_SCATTERING\nuniform float scatteringDiffusionProfile;\n#endif\n#endif\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#include<decalFragmentDeclaration>\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;uniform vec3 vSphericalL1_1;uniform vec3 vSphericalL10;uniform vec3 vSphericalL11;uniform vec3 vSphericalL2_2;uniform vec3 vSphericalL2_1;uniform vec3 vSphericalL20;uniform vec3 vSphericalL21;uniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;uniform vec3 vSphericalY;uniform vec3 vSphericalZ;uniform vec3 vSphericalXX_ZZ;uniform vec3 vSphericalYY_ZZ;uniform vec3 vSphericalZZ;uniform vec3 vSphericalXY;uniform vec3 vSphericalYZ;uniform vec3 vSphericalZX;\n#endif\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n",ShaderStore.IncludesShadersStore[name228]=shader228}}),name229,shader229,init_pbrFragmentExtraDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentExtraDeclaration.js"(){init_shaderStore(),init_mainUVVaryingDeclaration2(),name229="pbrFragmentExtraDeclaration",shader229="varying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n",ShaderStore.IncludesShadersStore[name229]=shader229}}),name230,shader230,init_samplerFragmentAlternateDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerFragmentAlternateDeclaration.js"(){init_shaderStore(),name230="samplerFragmentAlternateDeclaration",shader230="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name230]=shader230}}),name231,shader231,init_pbrFragmentSamplersDeclaration2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentSamplersDeclaration.js"(){init_shaderStore(),init_samplerFragmentDeclaration2(),init_samplerFragmentAlternateDeclaration2(),name231="pbrFragmentSamplersDeclaration",shader231="#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform sampler2D clearCoatRoughnessSampler;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform sampler2D sheenRoughnessSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;uniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;uniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;uniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D refractionSamplerLow;uniform sampler2D refractionSamplerHigh;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_SAMPLERNAME_,translucencyColor)\n#endif\n",ShaderStore.IncludesShadersStore[name231]=shader231}}),name232,shader232,init_subSurfaceScatteringFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/subSurfaceScatteringFunctions.js"(){init_shaderStore(),name232="subSurfaceScatteringFunctions",shader232="bool testLightingForSSS(float diffusionProfile)\n{return diffusionProfile<1.;}",ShaderStore.IncludesShadersStore[name232]=shader232}}),name233,shader233,init_importanceSampling2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/importanceSampling.js"(){init_shaderStore(),name233="importanceSampling",shader233="vec3 hemisphereCosSample(vec2 u) {float phi=2.*PI*u.x;float cosTheta2=1.-u.y;float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {float phi=2.*PI*u.x;float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { \nfloat phi=2.*PI*u.x;float sinTheta=pow(u.y,a/(2.*a+1.));float cosTheta=sqrt(1.-sinTheta*sinTheta);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}",ShaderStore.IncludesShadersStore[name233]=shader233}}),name234,shader234,init_pbrHelperFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrHelperFunctions.js"(){init_shaderStore(),name234="pbrHelperFunctions",shader234="#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{return square(roughness)+MINIMUMVARIANCE;}\nfloat fresnelGrazingReflectance(float reflectance0) {float reflectance90=saturate(reflectance0*25.0);return reflectance90;}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);vec3 nDfdy=dFdy(normalVector.xyz);float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);float geometricAlphaGFactor=sqrt(slopeSquare);geometricAlphaGFactor*=0.75;return vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_LEGACY\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);return vec2(alphaT,alphaB);}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy,float roughness) {vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));return anisotropicNormal;}\n#else\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {float alphaT=max(mix(alphaG,1.0,anisotropy*anisotropy),MINIMUMVARIANCE);float alphaB=max(alphaG,MINIMUMVARIANCE);return vec2(alphaT,alphaB);}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy,float roughness) {vec3 bentNormal=cross(B,V);bentNormal=normalize(cross(bentNormal,B));float a=square(square(1.0-anisotropy*(1.0-roughness)));bentNormal=normalize(mix(bentNormal,N,a));return bentNormal;}\n#endif\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nvec3 cocaLambert(vec3 alpha,float distance) {return exp(-alpha*distance);}\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));}\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {return -log(color)/distance;}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {vec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);return clearCoatAbsorption;}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;float reflectivityLuminance=getLuminance(reflectivityColor);float reflectivityLuma=sqrt(reflectivityLuminance);microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;return microSurface;}\n#endif\n",ShaderStore.IncludesShadersStore[name234]=shader234}}),name235,shader235,init_pbrDirectLightingSetupFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingSetupFunctions.js"(){init_shaderStore(),name235="pbrDirectLightingSetupFunctions",shader235="struct preLightingInfo\n{vec3 lightOffset;float lightDistanceSquared;float lightDistance;float attenuation;vec3 L;vec3 H;float NdotV;float NdotLUnclamped;float NdotL;float VdotH;float roughness;\n#ifdef IRIDESCENCE\nfloat iridescenceIntensity;\n#endif\n};preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N,vec3 posW) {preLightingInfo result;result.lightOffset=lightData.xyz-posW;result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);result.lightDistance=sqrt(result.lightDistanceSquared);result.L=normalize(result.lightOffset);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.lightDistance=length(-lightData.xyz);result.L=normalize(-lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.NdotL=dot(N,lightData.xyz)*0.5+0.5;result.NdotL=saturateEps(result.NdotL);result.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;}",ShaderStore.IncludesShadersStore[name235]=shader235}}),name236,shader236,init_pbrDirectLightingFalloffFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingFalloffFunctions.js"(){init_shaderStore(),name236="pbrDirectLightingFalloffFunctions",shader236="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{return max(0.,1.0-length(lightOffset)/range);}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{return 1.0/maxEps(lightDistanceSquared);}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);float factor=lightDistanceSquared*inverseSquaredRange;float attenuation=saturate(1.0-factor*factor);attenuation*=attenuation;lightDistanceFalloff*=attenuation;return lightDistanceFalloff;}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{float falloff=0.0;float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));if (cosAngle>=cosHalfAngle)\n{falloff=max(0.,pow(cosAngle,exponent));}\nreturn falloff;}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{const float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));return falloff;}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{float cd=dot(-lightDirection,directionToLightCenterW);float falloff=saturate(cd*lightAngleScale+lightAngleOffset);falloff*=falloff;return falloff;}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}",ShaderStore.IncludesShadersStore[name236]=shader236}}),name237,shader237,init_pbrBRDFFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBRDFFunctions.js"(){init_shaderStore(),name237="pbrBRDFFunctions",shader237="#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {vec2 UV=vec2(NdotV,perceptualRoughness);vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{float c=1.0-NdotV;float c3=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);return square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);vec3 getIORTfromAirToSurfaceR0(vec3 f0) {vec3 sqrtF0=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {return square((iorT-vec3(iorI))/(iorT+vec3(iorI)));}\nfloat getR0fromIORs(float iorT,float iorI) {return square((iorT-iorI)/(iorT+iorI));}\nvec3 evalSensitivity(float opd,vec3 shift) {float phase=2.0*PI*opd*1.0e-9;const vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);const vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);const vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);vec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;vec3 srgb=XYZ_TO_REC709*xyz;return srgb;}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {vec3 I=vec3(1.0);float iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));float sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));float cosTheta2Sq=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}\nfloat cosTheta2=sqrt(cosTheta2Sq);float R0=getR0fromIORs(iridescenceIOR,outsideIOR);float R12=fresnelSchlickGGX(cosTheta1,R0,1.);float R21=R12;float T121=1.0-R12;float phi12=0.0;if (iridescenceIOR<outsideIOR) phi12=PI;float phi21=PI-phi12;vec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);vec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));vec3 phi23=vec3(0.0);if (baseIOR[0]<iridescenceIOR) phi23[0]=PI;if (baseIOR[1]<iridescenceIOR) phi23[1]=PI;if (baseIOR[2]<iridescenceIOR) phi23[2]=PI;float opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;vec3 phi=vec3(phi21)+phi23;vec3 R123=clamp(R12*R23,1e-5,0.9999);vec3 r123=sqrt(R123);vec3 Rs=square(T121)*R23/(vec3(1.0)-R123);vec3 C0=R12+Rs;I=C0;vec3 Cm=Rs-T121;for (int m=1; m<=2; ++m)\n{Cm*=r123;vec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);I+=Cm*Sm;}\nreturn max(I,vec3(0.0));}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{float a2=square(alphaG);float d=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{float invR=1./alphaG;float cos2h=NdotH*NdotH;float sin2h=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {float a2=alphaTB.x*alphaTB.y;vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);float v2=dot(v,v);float w2=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));float v=0.5/(lambdaV+lambdaL);return v;}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {return 0.25/(VdotH*VdotH); }\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{float oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);float a=mix(21.5473,25.3245,oneMinusAlphaSq);float b=mix(3.82987,3.32435,oneMinusAlphaSq);float c=mix(0.19823,0.16801,oneMinusAlphaSq);float d=mix(-1.97760,-1.27393,oneMinusAlphaSq);float e=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{float G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;float fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {vec3 S=1./maxEps(diffusionDistance);vec3 temp=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {float t=1.0+w;float invt2=1.0/square(t);return saturate((NdotL+w)*invt2);}\n#endif\n",ShaderStore.IncludesShadersStore[name237]=shader237}}),name238,shader238,init_hdrFilteringFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/hdrFilteringFunctions.js"(){init_shaderStore(),name238="hdrFilteringFunctions",shader238="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfloat radicalInverse_VdC(uint bits) \n{bits=(bits<<16u) | (bits>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return float(bits)*2.3283064365386963e-10; }\nvec2 hammersley(uint i,uint N)\n{return vec2(float(i)/float(N),radicalInverse_VdC(i));}\n#else\nfloat vanDerCorpus(int n,int base)\n{float invBase=1.0/float(base);float denom =1.0;float result =0.0;for(int i=0; i<32; ++i)\n{if(n>0)\n{denom =mod(float(n),2.0);result+=denom*invBase;invBase=invBase/2.0;n =int(float(n)/2.0);}}\nreturn result;}\nvec2 hammersley(int i,int N)\n{return vec2(float(i)/float(N),vanDerCorpus(i,2));}\n#endif\nfloat log4(float x) {return log2(x)/2.;}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;const float K=4.;\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{vec3 n=normalize(inputN);vec3 result=vec3(0.0);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 Ls=hemisphereCosSample(Xi);Ls=normalize(Ls);vec3 Ns=vec3(0.,0.,1.);float NoL=dot(Ns,Ls);if (NoL>0.) {float pdf_inversed=PI/NoL;float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(l,0.0,maxLevel);vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;}}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{vec3 n=normalize(inputN);vec3 c=textureCube(inputTexture,n).rgb; \nif (alphaG==0.) {\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;} else {vec3 result=vec3(0.);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);float weight=0.;\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);float NoV=1.;float NoH=H.z;float NoH2=H.z*H.z;float NoL=2.*NoH2-1.;vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(float(l),0.0,maxLevel);weight+=NoL;vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;}}\nresult=result/weight;return result;}}\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name238]=shader238}}),name239,shader239,init_pbrDirectLightingFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingFunctions.js"(){init_shaderStore(),name239="pbrDirectLightingFunctions",shader239="#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{vec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nfloat lightRoughness=lightRadius/lightDistance;float totalRoughness=saturate(lightRoughness+roughness);return totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {return mix(groundColor,lightColor,info.NdotL);}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*info.attenuation*info.NdotL*lightColor;}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix,vec3 posW){vec4 strq=textureProjectionMatrix*vec4(posW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return toLinearSpace(textureColor);}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {float NdotL=absEps(info.NdotLUnclamped);float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);float trAdapt=step(0.,info.NdotLUnclamped);vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float roughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(roughness);vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float TdotH=dot(T,info.H);float BdotH=dot(B,info.H);float TdotV=dot(T,V);float BdotV=dot(B,V);float TdotL=dot(T,info.L);float BdotL=dot(B,info.L);float alphaG=convertRoughnessToAverageSlope(info.roughness);vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);alphaTB=max(alphaTB,square(geometricRoughnessFactor));vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);float smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);vec3 specTerm=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {float NccdotL=saturateEps(dot(Ncc,info.L));float NccdotH=saturateEps(dot(Ncc,info.H));float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnel*=clearCoatIntensity;float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);float kelemenVisibility=visibility_Kelemen(info.VdotH);float clearCoatTerm=fresnel*distribution*kelemenVisibility;return vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);float NdotLRefract=saturateEps(dot(Ncc,LRefract));vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);return absorption;}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float roughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(roughness);float fresnel=1.;float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);/*#ifdef SHEEN_SOFTER\nfloat visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);/* #endif */\nfloat sheenTerm=fresnel*distribution*visibility;return sheenTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n",ShaderStore.IncludesShadersStore[name239]=shader239}}),name240,shader240,init_pbrIBLFunctions2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrIBLFunctions.js"(){init_shaderStore(),name240="pbrIBLFunctions",shader240="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {float microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;float lod=log2(microsurfaceAverageSlopeTexels);return lod;}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {float lod=log2(cubeMapDimensionPixels)*roughness;return lod;}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {float temp=NdotVUnclamped+ambientOcclusion;return saturate(square(temp)-1.0+ambientOcclusion);}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {vec3 reflection=reflect(view,normal);float temp=saturate(1.0+1.1*dot(reflection,geometricNormal));return square(temp);}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {float microsurfaceAverageSlope=alphaG;microsurfaceAverageSlope*=sqrt(abs(NdotV));return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);}\n#endif\n",ShaderStore.IncludesShadersStore[name240]=shader240}}),name241,shader241,init_pbrBlockAlbedoOpacity2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAlbedoOpacity.js"(){init_shaderStore(),init_decalFragment2(),name241="pbrBlockAlbedoOpacity",shader241="struct albedoOpacityOutParams\n{vec3 surfaceAlbedo;float alpha;};\n#define pbr_inline\nalbedoOpacityOutParams albedoOpacityBlock(\nin vec4 vAlbedoColor\n#ifdef ALBEDO\n,in vec4 albedoTexture\n,in vec2 albedoInfos\n#endif\n#ifdef OPACITY\n,in vec4 opacityMap\n,in vec2 vOpacityInfos\n#endif\n#ifdef DETAIL\n,in vec4 detailColor\n,in vec4 vDetailInfos\n#endif\n#ifdef DECAL\n,in vec4 decalColor\n,in vec4 vDecalInfos\n#endif \n)\n{albedoOpacityOutParams outParams;vec3 surfaceAlbedo=vAlbedoColor.rgb;float alpha=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#ifndef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#ifdef DETAIL\nfloat detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);surfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#ifdef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST \n#if DEBUGMODE != 88\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;outParams.alpha=alpha;return outParams;}\n",ShaderStore.IncludesShadersStore[name241]=shader241}}),name242,shader242,init_pbrBlockReflectivity2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectivity.js"(){init_shaderStore(),name242="pbrBlockReflectivity",shader242="struct reflectivityOutParams\n{float microSurface;float roughness;vec3 surfaceReflectivityColor;\n#ifdef METALLICWORKFLOW\nvec3 surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nvec3 ambientOcclusionColor;\n#endif\n#if DEBUGMODE>0\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap;\n#endif\n#ifndef FROSTBITE_REFLECTANCE\nvec3 metallicF0;\n#endif\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nreflectivityOutParams reflectivityBlock(\nin vec4 vReflectivityColor\n#ifdef METALLICWORKFLOW\n,in vec3 surfaceAlbedo\n,in vec4 metallicReflectanceFactors\n#endif\n#ifdef REFLECTIVITY\n,in vec3 reflectivityInfos\n,in vec4 surfaceMetallicOrReflectivityColorMap\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,in vec3 ambientOcclusionColorIn\n#endif\n#ifdef MICROSURFACEMAP\n,in vec4 microSurfaceTexel\n#endif\n#ifdef DETAIL\n,in vec4 detailColor\n,in vec4 vDetailInfos\n#endif\n)\n{reflectivityOutParams outParams;float microSurface=vReflectivityColor.a;vec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nfloat detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);float loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);float hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;vec3 baseColor=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;microSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);float roughness=1.-microSurface;outParams.microSurface=microSurface;outParams.roughness=roughness;outParams.surfaceReflectivityColor=surfaceReflectivityColor;return outParams;}\n",ShaderStore.IncludesShadersStore[name242]=shader242}}),name243,shader243,init_pbrBlockAmbientOcclusion2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAmbientOcclusion.js"(){init_shaderStore(),name243="pbrBlockAmbientOcclusion",shader243="struct ambientOcclusionOutParams\n{vec3 ambientOcclusionColor;\n#if DEBUGMODE>0 && defined(AMBIENT)\nvec3 ambientOcclusionColorMap;\n#endif\n};ambientOcclusionOutParams ambientOcclusionBlock(\n#ifdef AMBIENT\nin vec3 ambientOcclusionColorMap_,\nin vec4 vAmbientInfos\n#endif\n)\n{ambientOcclusionOutParams outParams;vec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;return outParams;}\n",ShaderStore.IncludesShadersStore[name243]=shader243}}),name244,shader244,init_pbrBlockAlphaFresnel2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAlphaFresnel.js"(){init_shaderStore(),name244="pbrBlockAlphaFresnel",shader244="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{float alpha;};\n#define pbr_inline\nalphaFresnelOutParams alphaFresnelBlock(\nin vec3 normalW,\nin vec3 viewDirectionW,\nin float alpha,\nin float microSurface\n)\n{alphaFresnelOutParams outParams;float opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\nreturn outParams;}\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name244]=shader244}}),name245,shader245,init_pbrBlockAnisotropic2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAnisotropic.js"(){init_shaderStore(),name245="pbrBlockAnisotropic",shader245="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{float anisotropy;vec3 anisotropicTangent;vec3 anisotropicBitangent;vec3 anisotropicNormal;\n#if DEBUGMODE>0 && defined(ANISOTROPIC_TEXTURE)\nvec3 anisotropyMapData;\n#endif\n};\n#define pbr_inline\nanisotropicOutParams anisotropicBlock(\nin vec3 vAnisotropy,\nin float roughness,\n#ifdef ANISOTROPIC_TEXTURE\nin vec3 anisotropyMapData,\n#endif\nin mat3 TBN,\nin vec3 normalW,\nin vec3 viewDirectionW\n)\n{anisotropicOutParams outParams;float anisotropy=vAnisotropy.b;vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nanisotropy*=anisotropyMapData.b;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\nanisotropyMapData.rg=anisotropyMapData.rg*2.0-1.0;\n#ifdef ANISOTROPIC_LEGACY\nanisotropyDirection.rg*=anisotropyMapData.rg;\n#else\nanisotropyDirection.xy=mat2(anisotropyDirection.x,anisotropyDirection.y,-anisotropyDirection.y,anisotropyDirection.x)*normalize(anisotropyMapData.rg);\n#endif\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));outParams.anisotropy=anisotropy;outParams.anisotropicTangent=anisotropicTangent;outParams.anisotropicBitangent=anisotropicBitangent;outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy,roughness);return outParams;}\n#endif\n",ShaderStore.IncludesShadersStore[name245]=shader245}}),name246,shader246,init_pbrBlockReflection2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflection.js"(){init_shaderStore(),name246="pbrBlockReflection",shader246="#ifdef REFLECTION\nstruct reflectionOutParams\n{vec4 environmentRadiance;vec3 environmentIrradiance;\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords;\n#else\nvec2 reflectionCoords;\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nvec3 irradianceVector;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nvoid createReflectionCoords(\nin vec3 vPositionW,\nin vec3 normalW,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REFLECTIONMAP_3D\nout vec3 reflectionCoords\n#else\nout vec2 reflectionCoords\n#endif\n)\n{\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n}\n#define pbr_inline\n#define inline\nvoid sampleReflectionTexture(\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nconst vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nconst vec2 reflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout vec4 environmentRadiance\n)\n{\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;vec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);if (lodReflectionNormalizedDoubled<1.0){environmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);} else {environmentRadiance=mix(\nenvironmentMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\nenvironmentRadiance.rgb*=vReflectionInfos.x;environmentRadiance.rgb*=vReflectionColor.rgb;}\n#define pbr_inline\n#define inline\nreflectionOutParams reflectionBlock(\nin vec3 vPositionW\n,in vec3 normalW\n,in float alphaG\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,in float NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,in float roughness\n#endif\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n#else\n,in sampler2D reflectionSampler\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,in vec3 vEnvironmentIrradiance\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,in mat4 reflectionMatrix\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,in samplerCube irradianceSampler\n#else\n,in sampler2D irradianceSampler\n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n)\n{reflectionOutParams outParams;vec4 environmentRadiance=vec4(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=vec3(0.);\n#else\nvec2 reflectionCoords=vec2(0.);\n#endif\ncreateReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\nreflectionCoords\n);sampleReflectionTexture(\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionSampler,\nreflectionCoords,\n#else\nreflectionSampler,\nreflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentRadiance\n);vec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);environmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;outParams.environmentRadiance=environmentRadiance;outParams.environmentIrradiance=environmentIrradiance;outParams.reflectionCoords=reflectionCoords;return outParams;}\n#endif\n",ShaderStore.IncludesShadersStore[name246]=shader246}}),name247,shader247,init_pbrBlockSheen2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockSheen.js"(){init_shaderStore(),name247="pbrBlockSheen",shader247="#ifdef SHEEN\nstruct sheenOutParams\n{float sheenIntensity;vec3 sheenColor;float sheenRoughness;\n#ifdef SHEEN_LINKWITHALBEDO\nvec3 surfaceAlbedo;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfloat sheenAlbedoScaling;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 finalSheenRadianceScaled;\n#endif\n#if DEBUGMODE>0\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 sheenEnvironmentReflectance;\n#endif\n#endif\n};\n#define pbr_inline\n#define inline\nsheenOutParams sheenBlock(\nin vec4 vSheenColor\n#ifdef SHEEN_ROUGHNESS\n,in float vSheenRoughness\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,in vec4 sheenMapRoughnessData\n#endif\n#endif\n,in float roughness\n#ifdef SHEEN_TEXTURE\n,in vec4 sheenMapData\n,in float sheenMapLevel\n#endif\n,in float reflectance\n#ifdef SHEEN_LINKWITHALBEDO\n,in vec3 baseColor\n,in vec3 surfaceAlbedo\n#endif\n#ifdef ENVIRONMENTBRDF\n,in float NdotV\n,in vec3 environmentBrdf\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,in vec2 AARoughnessFactors\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n,in vec4 vLightingIntensity\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n,in vec3 reflectionCoords\n#else\n,in sampler2D reflectionSampler\n,in vec2 reflectionCoords\n#endif\n,in float NdotVUnclamped\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,in float seo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,in float eho\n#endif\n#endif\n)\n{sheenOutParams outParams;float sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);float sheenRoughness=sheenIntensity;outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#else\nsheenColor.rgb*=sheenMapData.rgb;\n#endif\nsheenColor.rgb*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nfloat sheenRoughness=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#else\nfloat sheenRoughness=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvec3 environmentSheenBrdf=vec3(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvec3 environmentSheenBrdf=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);sampleReflectionTexture(\nsheenAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nsheenRoughness,\n#endif\nreflectionSampler,\nreflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentSheenRadiance\n);vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;outParams.sheenColor=sheenColor;outParams.sheenRoughness=sheenRoughness;return outParams;}\n#endif\n",ShaderStore.IncludesShadersStore[name247]=shader247}}),name248,shader248,init_pbrBlockClearcoat2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockClearcoat.js"(){init_shaderStore(),name248="pbrBlockClearcoat",shader248="struct clearcoatOutParams\n{vec3 specularEnvironmentR0;float conservationFactor;vec3 clearCoatNormalW;vec2 clearCoatAARoughnessFactors;float clearCoatIntensity;float clearCoatRoughness;\n#ifdef REFLECTION\nvec3 finalClearCoatRadianceScaled;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 absorption;float clearCoatNdotVRefract;vec3 clearCoatColor;float clearCoatThickness;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nvec3 energyConservationFactorClearCoat;\n#endif\n#if DEBUGMODE>0\n#ifdef CLEARCOAT_BUMP\nmat3 TBNClearCoat;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData;\n#endif\n#ifdef REFLECTION\nvec4 environmentClearCoatRadiance;vec3 clearCoatEnvironmentReflectance;\n#endif\nfloat clearCoatNdotV;\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\n#define inline\nclearcoatOutParams clearcoatBlock(\nin vec3 vPositionW\n,in vec3 geometricNormalW\n,in vec3 viewDirectionW\n,in vec2 vClearCoatParams\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,in vec4 clearCoatMapRoughnessData\n#endif\n,in vec3 specularEnvironmentR0\n#ifdef CLEARCOAT_TEXTURE\n,in vec2 clearCoatMapData\n#endif\n#ifdef CLEARCOAT_TINT\n,in vec4 vClearCoatTintParams\n,in float clearCoatColorAtDistance\n,in vec4 vClearCoatRefractionParams\n#ifdef CLEARCOAT_TINT_TEXTURE\n,in vec4 clearCoatTintMapData\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,in vec2 vClearCoatBumpInfos\n,in vec4 clearCoatBumpMapData\n,in vec2 vClearCoatBumpUV\n#if defined(TANGENT) && defined(NORMAL)\n,in mat3 vTBN\n#else\n,in vec2 vClearCoatTangentSpaceParams\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,in mat4 normalMatrix\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,in vec3 faceNormal\n#endif\n#ifdef REFLECTION\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n,in vec4 vLightingIntensity\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n#else\n,in sampler2D reflectionSampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,in float ambientMonochrome\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,in float frontFacingMultiplier\n#endif\n)\n{clearcoatOutParams outParams;float clearCoatIntensity=vClearCoatParams.x;float clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;outParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;float clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);outParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvec3 specularEnvironmentR0Updated=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);vec3 clearCoatNormalW=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nvec2 TBNClearCoatUV=vClearCoatBumpUV*frontFacingMultiplier;mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatVRefract=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nsampleReflectionTexture(\nclearCoatAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nclearCoatNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nclearCoatRoughness,\n#endif\nreflectionSampler,\nclearCoatReflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentClearCoatRadiance\n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);clearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnelIBLClearCoat*=clearCoatIntensity;outParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\nreturn outParams;}\n#endif\n",ShaderStore.IncludesShadersStore[name248]=shader248}}),name249,shader249,init_pbrBlockIridescence2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockIridescence.js"(){init_shaderStore(),name249="pbrBlockIridescence",shader249="struct iridescenceOutParams\n{float iridescenceIntensity;float iridescenceIOR;float iridescenceThickness;vec3 specularEnvironmentR0;};\n#ifdef IRIDESCENCE\n#define pbr_inline\n#define inline\niridescenceOutParams iridescenceBlock(\nin vec4 vIridescenceParams\n,in float viewAngle\n,in vec3 specularEnvironmentR0\n#ifdef IRIDESCENCE_TEXTURE\n,in vec2 iridescenceMapData\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,in vec2 iridescenceThicknessMapData\n#endif\n#ifdef CLEARCOAT\n,in float NdotVUnclamped\n#ifdef CLEARCOAT_TEXTURE\n,in vec2 clearCoatMapData\n#endif\n#endif\n)\n{iridescenceOutParams outParams;float iridescenceIntensity=vIridescenceParams.x;float iridescenceIOR=vIridescenceParams.y;float iridescenceThicknessMin=vIridescenceParams.z;float iridescenceThicknessMax=vIridescenceParams.w;float iridescenceThicknessWeight=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nfloat iridescenceThickness=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);float topIor=1.; \n#ifdef CLEARCOAT\nfloat clearCoatIntensity=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,vClearCoatRefractionParams.w-1.,clearCoatIntensity);viewAngle=sqrt(1.0+square(1.0/topIor)*(square(NdotVUnclamped)-1.0));\n#endif\nvec3 iridescenceFresnel=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);outParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);outParams.iridescenceIntensity=iridescenceIntensity;outParams.iridescenceThickness=iridescenceThickness;outParams.iridescenceIOR=iridescenceIOR;return outParams;}\n#endif\n",ShaderStore.IncludesShadersStore[name249]=shader249}}),name250,shader250,init_pbrBlockSubSurface2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockSubSurface.js"(){init_shaderStore(),name250="pbrBlockSubSurface",shader250="struct subSurfaceOutParams\n{vec3 specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvec3 finalRefraction;vec3 surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nfloat alpha;\n#endif\n#ifdef REFLECTION\nfloat refractionFactorForIrradiance;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvec3 transmittance;float translucencyIntensity;\n#ifdef REFLECTION\nvec3 refractionIrradiance;\n#endif\n#endif\n#if DEBUGMODE>0\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction;vec3 refractionTransmittance;\n#endif\n#endif\n};\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#define pbr_inline\n#define inline\nvec4 sampleEnvironmentRefraction(\nin float ior\n,in float thickness\n,in float refractionLOD\n,in vec3 normalW\n,in vec3 vPositionW\n,in vec3 viewDirectionW\n,in mat4 view\n,in vec4 vRefractionInfos\n,in mat4 refractionMatrix\n,in vec4 vRefractionMicrosurfaceInfos\n,in float alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,in samplerCube refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in samplerCube refractionSamplerLow\n,in samplerCube refractionSamplerHigh\n#endif\n#else\n,in sampler2D refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in sampler2D refractionSamplerLow\n,in sampler2D refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,in vec3 refractionPosition\n,in vec3 refractionSize\n#endif\n) {vec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,ior);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,ior);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;vec3 refractionCoords=refractionVector;refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*thickness,1.0)));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\n#endif\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODBASEDMICROSFURACE\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\n#if defined(REALTIME_FILTERING) && defined(SS_REFRACTIONMAP_3D)\nenvironmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);if (lodRefractionNormalizedDoubled<1.0){environmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);} else {environmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\nreturn environmentRefraction;}\n#endif\n#define pbr_inline\n#define inline\nsubSurfaceOutParams subSurfaceBlock(\nin vec3 vSubSurfaceIntensity\n,in vec2 vThicknessParam\n,in vec4 vTintColor\n,in vec3 normalW\n,in vec3 specularEnvironmentReflectance\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,in vec4 thicknessMap\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,in vec4 refractionIntensityMap\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,in vec4 translucencyIntensityMap\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,in mat4 reflectionMatrix\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,in vec3 irradianceVector_\n#endif\n#if defined(REALTIME_FILTERING)\n,in samplerCube reflectionSampler\n,in vec2 vReflectionFilteringInfo\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,in samplerCube irradianceSampler\n#else\n,in sampler2D irradianceSampler\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,in vec3 surfaceAlbedo\n#endif\n#ifdef SS_REFRACTION\n,in vec3 vPositionW\n,in vec3 viewDirectionW\n,in mat4 view\n,in vec4 vRefractionInfos\n,in mat4 refractionMatrix\n,in vec4 vRefractionMicrosurfaceInfos\n,in vec4 vLightingIntensity\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,in float alpha\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,in float NdotVUnclamped\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,in float roughness\n#endif\n,in float alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,in samplerCube refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in samplerCube refractionSamplerLow\n,in samplerCube refractionSamplerHigh\n#endif\n#else\n,in sampler2D refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in sampler2D refractionSamplerLow\n,in sampler2D refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,in vec3 refractionPosition\n,in vec3 refractionSize\n#endif\n#ifdef SS_DISPERSION\n,in float dispersion\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,in vec3 vDiffusionDistance\n,in vec4 vTranslucencyColor\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,in vec4 translucencyColorMap\n#endif\n#endif\n)\n{subSurfaceOutParams outParams;outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);outParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nfloat thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=thicknessMap.a;\n#else\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTIONINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCYINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=translucencyIntensityMap.a;\n#else\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);vec4 translucencyColor=vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\ntranslucencyColor*=translucencyColorMap;\n#endif\nvec3 transmittance=transmittanceBRDF_Burley(translucencyColor.rgb,vDiffusionDistance,thickness);transmittance*=translucencyIntensity;outParams.transmittance=transmittance;outParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef SS_HAS_THICKNESS\nfloat ior=vRefractionInfos.y;\n#else\nfloat ior=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionAlphaG=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionRoughness=alphaG;refractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nfloat refractionAlphaG=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\nfloat refraction_ior=vRefractionInfos.y;\n#ifdef SS_DISPERSION\nfloat realIOR=1.0/refraction_ior;float iorDispersionSpread=0.04*dispersion*(realIOR-1.0);vec3 iors=vec3(1.0/(realIOR-iorDispersionSpread),refraction_ior,1.0/(realIOR+iorDispersionSpread));for (int i=0; i<3; i++) {refraction_ior=iors[i];\n#endif\nvec4 envSample=sampleEnvironmentRefraction(refraction_ior,thickness,refractionLOD,normalW,vPositionW,viewDirectionW,view,vRefractionInfos,refractionMatrix,vRefractionMicrosurfaceInfos,alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionSamplerLow\n,refractionSamplerHigh\n#endif\n#else\n,refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionSamplerLow\n,refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition\n,refractionSize\n#endif\n);\n#ifdef SS_DISPERSION\nenvironmentRefraction[i]=envSample[i];}\n#else\nenvironmentRefraction=envSample;\n#endif\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);environmentRefraction.rgb*=volumeAlbedo;\n#else\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvec3 irradianceVector=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvec3 irradianceCoords=irradianceVector;\n#else\nvec2 irradianceCoords=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec4 refractionIrradiance=vec4(0.);\n#endif\nrefractionIrradiance.rgb*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance.rgb;\n#endif\nreturn outParams;}\n#endif\n",ShaderStore.IncludesShadersStore[name250]=shader250}}),name251,shader251,init_pbrBlockNormalGeometric2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockNormalGeometric.js"(){init_shaderStore(),name251="pbrBlockNormalGeometric",shader251="vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\nvec3 geometricNormalW=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;\n#endif\n",ShaderStore.IncludesShadersStore[name251]=shader251}}),name252,shader252,init_pbrBlockNormalFinal2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockNormalFinal.js"(){init_shaderStore(),name252="pbrBlockNormalFinal",shader252="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n",ShaderStore.IncludesShadersStore[name252]=shader252}}),name253,shader253,init_pbrBlockLightmapInit2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockLightmapInit.js"(){init_shaderStore(),name253="pbrBlockLightmapInit",shader253="#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n",ShaderStore.IncludesShadersStore[name253]=shader253}}),name254,shader254,init_pbrBlockGeometryInfo2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockGeometryInfo.js"(){init_shaderStore(),name254="pbrBlockGeometryInfo",shader254="float NdotVUnclamped=dot(normalW,viewDirectionW);float NdotV=absEps(NdotVUnclamped);float alphaG=convertRoughnessToAverageSlope(roughness);vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=aoOut.ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name254]=shader254}}),name255,shader255,init_pbrBlockReflectance02=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectance0.js"(){init_shaderStore(),name255="pbrBlockReflectance0",shader255="float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);vec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);\n#else \nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nfloat reflectance90=fresnelGrazingReflectance(reflectance);specularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n",ShaderStore.IncludesShadersStore[name255]=shader255}}),name256,shader256,init_pbrBlockReflectance2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectance.js"(){init_shaderStore(),name256="pbrBlockReflectance",shader256="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name256]=shader256}}),name257,shader257,init_pbrBlockDirectLighting2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockDirectLighting.js"(){init_shaderStore(),name257="pbrBlockDirectLighting",shader257="vec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\npreLightingInfo preInfo;lightingInfo info;float shadow=1.; \nfloat aggShadow=0.;float numLights=0.;\n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvec3 absorption=vec3(0.);\n#endif\n",ShaderStore.IncludesShadersStore[name257]=shader257}}),name258,shader258,init_pbrBlockFinalLitComponents2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalLitComponents.js"(){init_shaderStore(),name258="pbrBlockFinalLitComponents",shader258="aggShadow=aggShadow/numLights;\n#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvec3 finalIrradiance=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);finalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;finalIrradiance*=vLightingIntensity.z;finalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;finalSpecular=max(finalSpecular,0.0);vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvec3 finalRadiance=reflectionOut.environmentRadiance.rgb;finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenOut.sheenColor;finalSheen=max(finalSheen,0.0);vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;finalClearCoat=max(finalClearCoat,0.0);vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n",ShaderStore.IncludesShadersStore[name258]=shader258}}),name259,shader259,init_pbrBlockFinalUnlitComponents2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalUnlitComponents.js"(){init_shaderStore(),name259="pbrBlockFinalUnlitComponents",shader259="vec3 finalDiffuse=diffuseBase;finalDiffuse*=surfaceAlbedo.rgb;finalDiffuse=max(finalDiffuse,0.0);finalDiffuse*=vLightingIntensity.x;vec3 finalAmbient=vAmbientColor;finalAmbient*=surfaceAlbedo.rgb;vec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= vEmissiveInfos.y;\n#endif\nfinalEmissive*=vLightingIntensity.y;\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;finalDiffuse*=ambientOcclusionForDirectDiffuse;\n",ShaderStore.IncludesShadersStore[name259]=shader259}}),name260,shader260,init_pbrBlockFinalColorComposition2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalColorComposition.js"(){init_shaderStore(),name260="pbrBlockFinalColorComposition",shader260="vec4 finalColor=vec4(\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalAmbient +\nfinalDiffuse,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\nfinalColor.rgb+=finalEmissive;\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,0.0);\n",ShaderStore.IncludesShadersStore[name260]=shader260}}),name261,shader261,init_pbrBlockImageProcessing2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockImageProcessing.js"(){init_shaderStore(),name261="pbrBlockImageProcessing",shader261="#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\nfinalColor.rgb*=finalColor.a;\n#endif\n",ShaderStore.IncludesShadersStore[name261]=shader261}}),name262,shader262,init_pbrDebug2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDebug.js"(){init_shaderStore(),name262="pbrDebug",shader262="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {\n#if DEBUGMODE==1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#ifndef GAMMAALBEDO\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==21 && defined(AMBIENT)\ngl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#ifndef GAMMAEMISSIVE\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#ifndef GAMMALIGHTMAP\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==32 && defined(BUMP)\ngl_FragColor.rgb=texture2D(bumpSampler,vBumpUV).rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ngl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE==64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE==65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==72\ngl_FragColor.rgb=vec3(microSurface);\n#elif DEBUGMODE==73\ngl_FragColor.rgb=vAlbedoColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==74 && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vReflectivityColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==75\ngl_FragColor.rgb=vEmissiveColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE==87\ngl_FragColor.rgb=vec3(alpha);\n#elif DEBUGMODE==88 && defined(ALBEDO)\ngl_FragColor.rgb=vec3(albedoTexture.a);\n#elif DEBUGMODE==89\ngl_FragColor.rgb=aoOut.ambientOcclusionColor.rgb;\n#else\nfloat stripeWidth=30.;float stripePos=floor(gl_FragCoord.x/stripeWidth);float whichColor=mod(stripePos,2.);vec3 color1=vec3(.6,.2,.2);vec3 color2=vec3(.3,.1,.1);gl_FragColor.rgb=mix(color1,color2,whichColor);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#ifdef PREPASS\ngl_FragData[0]=toLinearSpace(gl_FragColor); \ngl_FragData[1]=vec4(0.,0.,0.,0.); \n#endif\n#ifdef DEBUGMODE_FORCERETURN\nreturn;\n#endif\n}\n#endif\n",ShaderStore.IncludesShadersStore[name262]=shader262}}),pbr_fragment_exports2={},name263,shader263,pbrPixelShader;__export(pbr_fragment_exports2,{pbrPixelShader:()=>pbrPixelShader});var init_pbr_fragment2=__esm({"../node_modules/.pnpm/@babylonjs+core@7.21.1/node_modules/@babylonjs/core/Shaders/pbr.fragment.js"(){init_shaderStore(),init_prePassDeclaration2(),init_oitDeclaration2(),init_pbrFragmentDeclaration(),init_pbrUboDeclaration2(),init_pbrFragmentExtraDeclaration2(),init_lightFragmentDeclaration(),init_lightUboDeclaration2(),init_pbrFragmentSamplersDeclaration2(),init_imageProcessingDeclaration2(),init_clipPlaneFragmentDeclaration2(),init_logDepthDeclaration2(),init_fogFragmentDeclaration2(),init_helperFunctions2(),init_subSurfaceScatteringFunctions2(),init_importanceSampling2(),init_pbrHelperFunctions2(),init_imageProcessingFunctions2(),init_shadowsFragmentFunctions2(),init_harmonicsFunctions2(),init_pbrDirectLightingSetupFunctions2(),init_pbrDirectLightingFalloffFunctions2(),init_pbrBRDFFunctions2(),init_hdrFilteringFunctions2(),init_pbrDirectLightingFunctions2(),init_pbrIBLFunctions2(),init_bumpFragmentMainFunctions2(),init_bumpFragmentFunctions2(),init_reflectionFunction2(),init_pbrBlockAlbedoOpacity2(),init_pbrBlockReflectivity2(),init_pbrBlockAmbientOcclusion2(),init_pbrBlockAlphaFresnel2(),init_pbrBlockAnisotropic2(),init_pbrBlockReflection2(),init_pbrBlockSheen2(),init_pbrBlockClearcoat2(),init_pbrBlockIridescence2(),init_pbrBlockSubSurface2(),init_clipPlaneFragment2(),init_pbrBlockNormalGeometric2(),init_bumpFragment2(),init_pbrBlockNormalFinal2(),init_depthPrePass2(),init_pbrBlockLightmapInit2(),init_pbrBlockGeometryInfo2(),init_pbrBlockReflectance02(),init_pbrBlockReflectance2(),init_pbrBlockDirectLighting2(),init_lightFragment2(),init_pbrBlockFinalLitComponents2(),init_pbrBlockFinalUnlitComponents2(),init_pbrBlockFinalColorComposition2(),init_logDepthFragment2(),init_fogFragment2(),init_pbrBlockImageProcessing2(),init_oitFragment2(),init_pbrDebug2(),name263="pbrPixelShader",shader263="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\nprecision highp float;\n#include<oitDeclaration>\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockIridescence>\n#include<pbrBlockSubSurface>\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\nalbedoOpacityOutParams albedoOpacityOut;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#endif\n#ifdef DECAL\nvec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);\n#endif\nalbedoOpacityOut=albedoOpacityBlock(\nvAlbedoColor\n#ifdef ALBEDO\n,albedoTexture\n,vAlbedoInfos\n#endif\n#ifdef OPACITY\n,opacityMap\n,vOpacityInfos\n#endif\n#ifdef DETAIL\n,detailColor\n,vDetailInfos\n#endif\n#ifdef DECAL\n,decalColor\n,vDecalInfos\n#endif\n);vec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;float alpha=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\nambientOcclusionOutParams aoOut;\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;\n#endif\naoOut=ambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nvAmbientInfos\n#endif \n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\nvec3 baseColor=surfaceAlbedo;reflectivityOutParams reflectivityOut;\n#if defined(REFLECTIVITY)\nvec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);vec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\n#ifdef REFLECTIVITY_GAMMA\nsurfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);\n#endif\nsurfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvec4 metallicReflectanceFactors=vMetallicReflectanceFactors;\n#ifdef REFLECTANCE\nvec4 reflectanceFactorsMap=texture2D(reflectanceSampler,vReflectanceUV+uvOffset);\n#ifdef REFLECTANCE_GAMMA\nreflectanceFactorsMap=toLinearSpace(reflectanceFactorsMap);\n#endif\nmetallicReflectanceFactors.rgb*=reflectanceFactorsMap.rgb;\n#endif\n#ifdef METALLIC_REFLECTANCE\nvec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);\n#ifdef METALLIC_REFLECTANCE_GAMMA\nmetallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);\n#endif\n#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY\nmetallicReflectanceFactors.rgb*=metallicReflectanceFactorsMap.rgb;\n#endif\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap.a;\n#endif\n#endif\nreflectivityOut=reflectivityBlock(\nvReflectivityColor\n#ifdef METALLICWORKFLOW\n,surfaceAlbedo\n,metallicReflectanceFactors\n#endif\n#ifdef REFLECTIVITY\n,vReflectivityInfos\n,surfaceMetallicOrReflectivityColorMap\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,aoOut.ambientOcclusionColor\n#endif\n#ifdef MICROSURFACEMAP\n,microSurfaceTexel\n#endif\n#ifdef DETAIL\n,detailColor\n,vDetailInfos\n#endif\n);float microSurface=reflectivityOut.microSurface;float roughness=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nalphaFresnelOutParams alphaFresnelOut;alphaFresnelOut=alphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface\n);alpha=alphaFresnelOut.alpha;\n#endif\n#endif\n#include<pbrBlockGeometryInfo>\n#ifdef ANISOTROPIC\nanisotropicOutParams anisotropicOut;\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\n#endif\nanisotropicOut=anisotropicBlock(\nvAnisotropy,\nroughness,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW \n);\n#endif\n#ifdef REFLECTION\nreflectionOutParams reflectionOut;\n#ifndef USE_CUSTOM_REFLECTION\nreflectionOut=reflectionBlock(\nvPositionW\n,normalW\n,alphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness\n#endif\n,reflectionSampler\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,vEnvironmentIrradiance\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionMatrix\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n,irradianceSampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n,reflectionSamplerLow\n,reflectionSamplerHigh\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n);\n#else\n#define CUSTOM_REFLECTION\n#endif\n#endif\n#include<pbrBlockReflectance0>\n#ifdef SHEEN\nsheenOutParams sheenOut;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset);\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;\n#endif\nsheenOut=sheenBlock(\nvSheenColor\n#ifdef SHEEN_ROUGHNESS\n,vSheenRoughness\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,sheenMapRoughnessData\n#endif\n#endif\n,roughness\n#ifdef SHEEN_TEXTURE\n,sheenMapData\n,vSheenInfos.y\n#endif\n,reflectance\n#ifdef SHEEN_LINKWITHALBEDO\n,baseColor\n,surfaceAlbedo\n#endif\n#ifdef ENVIRONMENTBRDF\n,NdotV\n,environmentBrdf\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,AARoughnessFactors\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n,vLightingIntensity\n,reflectionSampler\n,reflectionOut.reflectionCoords\n,NdotVUnclamped\n#ifndef LODBASEDMICROSFURACE\n,reflectionSamplerLow\n,reflectionSamplerHigh\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,seo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,eho\n#endif\n#endif\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\n#endif\n#endif\n#ifdef IRIDESCENCE\niridescenceOutParams iridescenceOut;\n#ifdef IRIDESCENCE_TEXTURE\nvec2 iridescenceMapData=texture2D(iridescenceSampler,vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nvec2 iridescenceThicknessMapData=texture2D(iridescenceThicknessSampler,vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;\n#endif\niridescenceOut=iridescenceBlock(\nvIridescenceParams\n,NdotV\n,specularEnvironmentR0\n#ifdef IRIDESCENCE_TEXTURE\n,iridescenceMapData\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,iridescenceThicknessMapData\n#endif\n#ifdef CLEARCOAT\n,NdotVUnclamped\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData\n#endif\n#endif\n);float iridescenceIntensity=iridescenceOut.iridescenceIntensity;specularEnvironmentR0=iridescenceOut.specularEnvironmentR0;\n#endif\nclearcoatOutParams clearcoatOut;\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\n#endif\n#ifdef CLEARCOAT_BUMP\nvec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatOut=clearcoatBlock(\nvPositionW\n,geometricNormalW\n,viewDirectionW\n,vClearCoatParams\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,clearCoatMapRoughnessData\n#endif\n,specularEnvironmentR0\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData\n#endif\n#ifdef CLEARCOAT_TINT\n,vClearCoatTintParams\n,clearCoatColorAtDistance\n,vClearCoatRefractionParams\n#ifdef CLEARCOAT_TINT_TEXTURE\n,clearCoatTintMapData\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,vClearCoatBumpInfos\n,clearCoatBumpMapData\n,vClearCoatBumpUV\n#if defined(TANGENT) && defined(NORMAL)\n,vTBN\n#else\n,vClearCoatTangentSpaceParams\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,normalMatrix\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,faceNormal\n#endif\n#ifdef REFLECTION\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n,vLightingIntensity\n,reflectionSampler\n#ifndef LODBASEDMICROSFURACE\n,reflectionSamplerLow\n,reflectionSamplerHigh\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,ambientMonochrome\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,(gl_FrontFacing ? 1. : -1.)\n#endif\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n#include<pbrBlockReflectance>\nsubSurfaceOutParams subSurfaceOut;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nvec4 refractionIntensityMap=texture2D(refractionIntensitySampler,vRefractionIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nvec4 translucencyIntensityMap=texture2D(translucencyIntensitySampler,vTranslucencyIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nvec4 translucencyColorMap=texture2D(translucencyColorSampler,vTranslucencyColorUV+uvOffset);\n#endif\nsubSurfaceOut=subSurfaceBlock(\nvSubSurfaceIntensity\n,vThicknessParam\n,vTintColor\n,normalW\n,specularEnvironmentReflectance\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,thicknessMap\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,refractionIntensityMap\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,translucencyIntensityMap\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,reflectionMatrix\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionOut.irradianceVector\n#endif\n#if defined(REALTIME_FILTERING)\n,reflectionSampler\n,vReflectionFilteringInfo\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n,irradianceSampler\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,surfaceAlbedo\n#endif\n#ifdef SS_REFRACTION\n,vPositionW\n,viewDirectionW\n,view\n,vRefractionInfos\n,refractionMatrix\n,vRefractionMicrosurfaceInfos\n,vLightingIntensity\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,alpha\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,NdotVUnclamped\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,roughness\n#endif\n,alphaG\n,refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionSamplerLow\n,refractionSamplerHigh\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,vRefractionPosition\n,vRefractionSize\n#endif\n#ifdef SS_DISPERSION\n,dispersion\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,vDiffusionDistance\n,vTranslucencyColor\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,translucencyColorMap\n#endif\n#endif\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n#include<pbrBlockFinalLitComponents>\n#endif \n#include<pbrBlockFinalUnlitComponents>\n#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=finalColor.a>0.4 ? 1.0 : 0.0;\n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;vec2 velocity=abs(a-b);velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nvec3 sqAlbedo=sqrt(surfaceAlbedo); \n#endif\n#ifdef PREPASS_IRRADIANCE\nvec3 irradiance=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\n#ifdef SS_SCATTERING\ngl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a); \nirradiance/=sqAlbedo;\n#else\ngl_FragData[0]=finalColor; \nfloat scatteringDiffusionProfile=255.;\n#endif\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(clamp(irradiance,vec3(0.),vec3(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); \n#else\ngl_FragData[0]=vec4(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\n#ifdef PREPASS_NORMAL_WORLDSPACE\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalW,writeGeometryInfo); \n#else\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalize((view*vec4(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(sqAlbedo,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#ifndef UNLIT\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularEnvironmentR0,microSurface)*writeGeometryInfo;\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4( 0.0,0.0,0.0,1.0 )*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=finalColor;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {frontColor.rgb+=finalColor.rgb*finalColor.a*alphaMultiplier;frontColor.a=1.0-alphaMultiplier*(1.0-finalColor.a);} else {backColor+=finalColor;}\n#endif\n#include<pbrDebug>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n",ShaderStore.ShadersStore[name263]=shader263,pbrPixelShader={name:name263,shader:shader263}}}),CloseCode={gameNotFound:0,gameFull:0,badName:0,mainMenu:0,gameIdleExceeded:0,corruptedLoginData0:0,corruptedLoginData1:0,corruptedLoginData2:0,corruptedLoginData3:0,corruptedLoginData4:0,corruptedLoginData5:0,gameMaxPlayersExceeded:0,gameDestroyUser:0,joinGameOutOfOrder:0,gameShuttingDown:0,readyBeforeReady:0,booted:0,gameErrorOnUserSocket:0,uuidNotFound:0,sessionNotFound:0,clusterFullCpu:0,clusterFullMem:0,noClustersAvailable:0,locked:0},i=4e3;Object.keys(CloseCode).forEach((e=>{CloseCode[e]=i++}));var BkKPwUww={W:100,P:101,u:102,i:103,G:104,O:105,t:106,j:107,V:108,k:109,D:110,I:111,J:112,S:113,U:114,K:115,C:116,H:117,F:118,v:119,N:120,M:121,T:122,cc:123,bc:124,zc:125,xc:126,lc:127,Xc:128,hc:129,fc:130,Zc:131,wc:132,mc:133,Wc:134,qc:135,Pc:136,uc:137,Gc:138,Oc:139,sc:140,dc:141,tc:142,Rc:143,jc:144,Vc:145,Lc:146,Qc:147,gc:148,rc:149,kc:150,ac:151,Dc:152,oc:153,Ic:154,Jc:155,Yc:156,Sc:157,Ac:158,Uc:159,yc:160,Bc:161},i=0;Object.keys(BkKPwUww).forEach((e=>{BkKPwUww[e]=i++}));var BkKPwUwwToKey=Object.keys(BkKPwUww).reduce(((e,t)=>(e[BkKPwUww[t]]=t,e)),{}),ChatFlags={none:0,pinned:2,team:4},Team={blue:1,red:2},GameType={ffa:0,teams:1,ctf:2,king:3},GameTypes=[{shortName:"FFA",longName:"Free For All",value:0},{shortName:"Teams",longName:"Teams",value:1},{shortName:"Spatula",longName:"Captula the Spatula",value:2},{shortName:"King",longName:"King of the Coop",value:3}],DmgType=[{name:"Eggk47"},{name:"Scrambler"},{name:"FreeRanger"},{name:"Cluck9mm"},{name:"Rpegg"},{name:"Whipper"},{name:"Crackshot"},{name:"TriHard"},{name:"Grenade"},{name:"Melee"},{name:"Fall"}],SyncRate=10,FramesBetweenSyncs=Math.ceil(30/SyncRate),Reward={perKill:10,video:100,perKillModTwo:20,discord:"rew_1200",tiktok:"rew_1208",Instagram:"rew_1219",Steam:"rew_1223",Facebook:"rew_1227",Twitter:"rew_1234",Twitch:"rew_twitch_social"},FeedbackType={comment:0,feature:1,bug:2,purchase:3,account:4,abuse:5,other:6,deleteAccount:7},ShellStreak={HardBoiled:1,EggBreaker:2,Restock:4,OverHeal:8,DoubleEggs:16,MiniEgg:32},CHICKWINNER={dailyLimit:3,cooldown:240,dailyCooldown:86400},Slot={Primary:0,Secondary:1},ItemType2={Hat:1,Stamp:2,Primary:3,Secondary:4,Grenade:6,Melee:7},CharClass={Soldier:0,Scrambler:1,Ranger:2,Eggsploder:3,Whipper:4,Crackshot:5,TriHard:6};CharClass.length=Object.keys(CharClass).length;var StatsArr=["kills","deaths","streak","killsCluck9mm","killsGrenade","killsRpegg","killsEggk47","killsScrambler","killsFreeRanger","killsWhipper","killsCrackshot","killsTriHard","killsMelee","killsPrivate","killsPublic","killsKing","killsSpatula","killsTeams","killsFFA","deathsCluck9mm","deathsGrenade","deathsRpegg","deathsEggk47","deathsScrambler","deathsFreeRanger","deathsWhipper","deathsCrackshot","deathsTriHard","deathsMelee","deathsFall","deathsPrivate","deathsPublic","deathsKing","deathsSpatula","deathsTeams","deathsFFA","kotcCaptured","kotcWins"],FactionsItems={0:1584,1:1585},EggOrgFactionsReward={0:"rew_eggfu",1:"rew_eggsassin"},AbTestPercentage={a:20,b:20,c:20},versionNumber="2d2f6766f",Pool=class{retrieve(e){if(null!=e){for(;e>=this.size;)this.expand(this.originalSize);return this.numActive++,this.objects[e].active=!0,this.objects[e]}var t=this.idx;do{t=(t+1)%this.size;var i=this.objects[t];if(!i.active)return this.idx=t,this.numActive++,i.active=!0,i}while(t!=this.idx);return this.expand(this.originalSize),console.log("Expanding pool for: "+this.objects[0].constructor.name+" to: "+this.size),this.retrieve()}expand(e){for(var t=0;t<e;t++){var i=this.constructorFn();i.id=t+this.size,i.active=!1,this.objects.push(i)}this.size+=e}recycle(e){e.active=!1,this.numActive--}constructor(e,t){this.size=0,this.originalSize=t,this.constructorFn=e,this.objects=[],this.idx=0,this.numActive=0,this.expand(t)}forEachActive(e){for(var t=0;t<this.size;t++){var i=this.objects[t];!0===i.active&&e(i,t)}}},OutBuffer=class{kKPwUzb(e){this.ABkKPwUxo(8192*(e+Math.PI))}AAAAAABkKPwUzE(e){"string"!=typeof e&&(e=""),this.ABkKPwUxo(e.length);for(var t=0;t<e.length;t++)this.ABkKPwUxo(e.charCodeAt(t))}ABkKPwUxo(e){this.buffer[this.idx]=255&e,this.buffer[this.idx+1]=e>>8&255,this.idx+=2}AABkKPwUyt(e){"string"!=typeof e&&(e=""),this.BkKPwUxd(e.length);for(var t=0;t<e.length;t++)this.ABkKPwUxo(e.charCodeAt(t))}ABkKPwUyA(e){this.buffer[this.idx]=255&e,this.buffer[this.idx+1]=e>>8&255,this.buffer[this.idx+2]=e>>16&255,this.idx+=3}BkKPwUxd(e){this.buffer[this.idx]=255&e,this.idx++}BkKPwUzQ(e){this.ABkKPwUyA(2097152*e)}ABkKPwUyL(e){this.buffer[this.idx]=255&e,this.buffer[this.idx+1]=e>>8&255,this.buffer[this.idx+2]=e>>16&255,this.buffer[this.idx+3]=e>>24&255,this.idx+=4}constructor(e){this.idx=0,this.arrayBuffer=new ArrayBuffer(e),this.buffer=new Uint8Array(this.arrayBuffer,0,e)}send(e){var t=new Uint8Array(this.arrayBuffer,0,this.idx);e.send(t),kKPwUxS.bufferPool.recycle(this)}AABkKPwUyi(e){this.ABkKPwUyL(1048576*e)}ABkKPwUyW(e){this.ABkKPwUxo(256*e)}},kKPwUxS=class{static getBuffer(){var e=this.bufferPool.retrieve();return e.idx=0,e}};kKPwUxS.buffer=null,kKPwUxS.bufferPool=new Pool((()=>new OutBuffer(16384)),2);var KPwUxH=class{static unPackRadU(){return this.unPackInt24U()/2097152}static unPackInt24U(){var e=this.idx;return this.idx+=3,this.buffer[e]+256*this.buffer[e+1]+65536*this.buffer[e+2]}static unPackInt8U(){var e=this.idx;return this.idx++,this.buffer[e]}static unPackInt16U(){var e=this.idx;return this.idx+=2,this.buffer[e]+256*this.buffer[e+1]}static peekInt8U(){return this.buffer[this.idx]}static unPackString(e){e=e||255;var t=Math.min(this.unPackInt8U(),e);return this.unPackStringHelper(t)}static unPackDouble(){return this.unPackInt32()/1048576}static unPackLongString(e){e=e||16383;var t=Math.min(this.unPackInt16U(),e);return this.unPackStringHelper(t)}static unPackInt32U(){var e=this.idx;return this.idx+=4,this.buffer[e]+256*this.buffer[e+1]+65536*this.buffer[e+2]+16777216*this.buffer[e+3]}static unPackInt32(){return(this.unPackInt32U()+2147483648)%4294967296-2147483648}static unPackStringHelper(e){if(this.isMoreDataAvailable()<e)return 0;for(var t=new String,i=0;i<e;i++){var a=this.unPackInt16U();a>0&&(t+=String.fromCodePoint(a))}return t}static unPackInt16(){return(this.unPackInt16U()+32768)%65536-32768}static unPackRad(){return this.unPackInt16U()/8192-Math.PI}static unPackInt8(){return(this.unPackInt8U()+128)%256-128}static isMoreDataAvailable(){return Math.max(0,this.buffer.length-this.idx)}static unPackFloat(){return this.unPackInt16()/256}static init(e){this.buffer=new Uint8Array(e),this.idx=0}},BAWK2=class e{static async loadSprite(t){var i=await fetch(t),a=await i.json(),n=await e.loadSpriteBuffer(t,a);Object.keys(a.spritemap).forEach((t=>{var i=a.spritemap[t];e.sounds[t]={buffer:n,start:i.start,end:i.end}}))}static detach(){e.position={x:e.position.x,y:e.position.y,z:e.position.z},e.orientation={x:e.orientation.x,y:e.orientation.y,z:e.orientation.z}}static update(){for(var t of(e.position&&e.setPosition(e.position),e.orientation&&e.setOrientation(e.orientation),e.children))t.update()}static async loadSpriteBuffer(t,i){for(var a of i.resources)if(a.endsWith(e.format))break;var n=t.match(/.+\//)+a;return console.log("BAWK! loading "+n),await e.getAudioBuffer(n+"?"+versionNumber)}static resume(){e.audioCtx&&e.audioCtx.resume()}static init(){console.log("BAWK! initializing...");var e=new AudioContext;this.audioCtx=e,this.children=[],this.sounds={},this.position={x:0,y:0,z:0},this.orientation={x:0,y:0,z:-1},this.detectFormats(),this.gainNode=e.createGain(),this.compNode=e.createDynamicsCompressor(),this.compNode.connect(this.gainNode),this.gainNode.connect(e.destination),this.inputNode=this.compNode,null!=this.volume&&(this.gainNode.gain.value=this.volume)}static suspend(){e.audioCtx&&e.audioCtx.suspend()}static detectFormats(){var t=e.formats||{webm:"audio/webm",ogg:"audio/ogg",mp3:"audio/mpeg"};/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&delete t.webm;var i=document.createElement("audio"),a=Object.keys(t);for(var n of a){var s=i.canPlayType(t[n]);if(console.log("BAWK! testing "+n,s),s){e.format=n,console.log("BAWK! selected "+n);break}}}static async load(t,i){e.audioCtx||e.init();var a=t.match(/[^/\\&\?]+\..{1,4}(?=([\?\#&].*$|$))/)[0],n=a.match(/[^\.]*$/).join(""),s=a.replace("."+n,"");"json"==n?await e.loadSprite(t):await e.loadSound(t,i||s)}static setVolume(t){e.volume=t,e.gainNode&&(e.gainNode.gain.value=t)}static setFormats(e){this.formats=e}static setOrientation(t){var i=e.audioCtx.listener;i.forwardX?(i.forwardX.value=t.x,i.forwardY.value=t.y,i.forwardZ.value=t.z):i.setOrientation(t.x,t.y,t.z,0,1,0)}static request(e){return new Promise(((t,i)=>{let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer";let n=Loader.addTask();a.onprogress=e=>{n=Loader.progress(n,e.loaded,e.total)},a.onload=()=>{200!=a.status?(console.log("ERROR"),i()):t(a.response),Loader.finish(n)},a.send()}))}static setPosition(t){var i=e.audioCtx.listener;i.positionX?(i.positionX.value=t.x,i.positionY.value=t.y,i.positionZ.value=t.z):i.setPosition(t.x,t.y,t.z)}static async loadSound(t,i){t=t.replace("*",e.format);var a=await e.getAudioBuffer(t);a&&(e.sounds[i]&&console.warn('BAWK! duplicate sound name, "'+i+'" will be over-written'),e.sounds[i]={buffer:a})}static addChild(t){e.children.push(t)}static dispose(){this.audioCtx.close()}static getVolume(){return e.volume}static play(t,i,a){var n=e.audioCtx;i=i||e.inputNode,"suspended"===n.state&&e.resume();var s=e.sounds[t];if(!s){let i;if(a&&(i=` or ${a}`,s=e.sounds[a]),!s)return console.error(`BAWK! ${t} ${i} not found. Did you wait for it to load?`),!1}if(s.end)var r=s.start,o=s.end-r;var l=n.createBufferSource();return l.buffer=s.buffer,l.connect(i),o?l.start(0,r,o):l.start(),l}static attach(t,i){e.position=t,e.orientation=i}static removeChild(t){e.children.splice(e.children.indexOf(t),1)}static async getAudioBuffer(t){var i=await e.request(t);return await new Promise(((t,a)=>{e.audioCtx.decodeAudioData(i,t,a)}))}},PositionalAudio=class e{findFreeChannel(e){var t=this.channels,i=this.numChannels,a=BAWK2.position;if(this.numPlaying<i)for(var n of t)if(!n.source)return n;var s,r=-1;for(var n of t){var o=Math.pow(e.x-a.x,2)+Math.pow(e.y-a.y,2)+Math.pow(e.z-a.z,2);o>r&&(r=o,s=n)}return s}static onEnded(e){e.target.channel.parent.numPlaying--,e.target.channel.source=null,e.target.channel=null}setVolume(e){this.gainNode.gain.value=e}play(t,i,a){if(BAWK2.sounds[t]){var n=this.findFreeChannel(i);n.source&&n.source.stop();var s=n.node;n.position=i,n.follow=a,e.setNodePosition(s,i),n.source=BAWK2.play(t,s),n.source.channel=n,n.source.onended=e.onEnded,this.numPlaying++}else console.error("BAWK! "+t+" not found. Did you wait for it to load?")}getVolume(){return this.gainNode.gain.value}dispose(){this.gainNode.disconnect(),BAWK2.removeChild(this)}update(){for(var t of this.channels)t.source&&t.follow&&e.setNodePosition(t.node,t.position)}constructor(e,t){BAWK2.addChild(this),e=e||{},this.numChannels=e.numChannels||16,this.numPlaying=0,this.channels=[],this.nextChannelIdx=0,this.gainNode=BAWK2.audioCtx.createGain(),this.gainNode.connect(BAWK2.inputNode);for(var i=0;i<this.numChannels;i++){var a=BAWK2.audioCtx.createPanner(t);a.connect(this.gainNode),this.channels.push({parent:this,source:null,position:{x:0,y:0,z:0},follow:!1,node:a})}}static setNodePosition(e,t){var i=BAWK2.position.y+4*(t.y-BAWK2.position.y);e.positionX?(e.positionX.value=t.x,e.positionY.value=i,e.positionZ.value=t.z):e.setPosition(t.x,i,t.z)}};window.BAWK=BAWK2;var G={productBlockAds:!1,vipSubEnded:!1,passEnded:!1},StatsObj=class{updateStats(e,t){return{total:void 0!==e.total?e.total:this[t].deaths,mode:{public:void 0!==e.mode.public?e.mode.public:this[t].mode.public,private:void 0!==e.mode.private?e.mode.private:this[t].mode.private},dmgType:{pistol:void 0!==e.dmgType.pistol?e.dmgType.pistol:this[t].dmgType.pistol,grenade:void 0!==e.dmgType.grenade?e.dmgType.grenade:this[t].dmgType.grenade,rpegg:void 0!==e.dmgType.rpegg?e.dmgType.rpegg:this[t].dmgType.rpegg,eggk:void 0!==e.dmgType.eggk?e.dmgType.eggk:this[t].dmgType.eggk,scrambler:void 0!==e.dmgType.scrambler?e.dmgType.scrambler:this[t].dmgType.scrambler,ranger:void 0!==e.dmgType.ranger?e.dmgType.ranger:this[t].dmgType.ranger,whipper:void 0!==e.dmgType.whipper?e.dmgType.whipper:this[t].dmgType.whipper,crackshot:void 0!==e.dmgType.crackshot?e.dmgType.crackshot:this[t].dmgType.crackshot,trihard:void 0!==e.dmgType.trihard?e.dmgType.trihard:this[t].dmgType.trihard,melee:void 0!==e.dmgType.melee?e.dmgType.melee:this[t].dmgType.melee,fall:void 0!==e.dmgType.fall?e.dmgType.fall:this[t].dmgType.fall},gameType:{kotc:void 0!==e.gameType.kotc?e.gameType.kotc:this[t].gameType.kotc,spatula:void 0!==e.gameType.spatula?e.gameType.spatula:this[t].gameType.spatula,team:void 0!==e.gameType.team?e.gameType.team:this[t].gameType.team,ffa:void 0!==e.gameType.ffa?e.gameType.ffa:this[t].gameType.ffa}}}constructor(){this.statStateTemp={total:0,mode:{public:0,private:0},dmgType:{pistol:0,grenade:0,rpegg:0,eggk:0,scrambler:0,ranger:0,whipper:0,crackshot:0,trihard:0,melee:0,fall:0},gameType:{kotc:0,spatula:0,team:0,ffa:0},kdr:{private:0,public:0,ffa:0,teams:0,kotc:0,spatula:0}},this.kills=Object.create(this.statStateTemp),this.deaths=Object.create(this.statStateTemp),this.gameType={kotc:{captured:0,wins:0}},this.streak=0,this.dateReset=null}set(e){if(!e||void 0!==e.error)return vueApp.showGenericPopup("uh_oh","auth_stat_error_msg","ok");void 0!==e.kills&&(this.kills=this.updateStats(e.kills,"kills")),void 0!==e.deaths&&(this.deaths=this.updateStats(e.deaths,"deaths")),void 0!==e.gameType&&(this.gameType={kotc:{captured:void 0!==e.gameType.kotc.captured?e.gameType.kotc.captured:this.gameType.kotc.captured,wins:void 0!==e.gameType.kotc.wins?e.gameType.kotc.wins:this.gameType.kotc.wins}}),e.streak&&(this.streak=void 0!==e.streak?e.streak:this.streak)}get(){return{kills:this.kills,deaths:this.deaths,gameType:this.gameType,streak:this.streak,dateReset:this.dateReset}}},sessionRenewalWorkerCode="\nvar sessionId;\nvar servicesServer;\nvar timeout;\n\nonmessage = function (e) {\n\tservicesServer = e.data.servicesServer;\n\tsessionId = e.data.sessionId;\n\tconsole.log(getTime(), 'Session: worker received session ID:', sessionId);\n\tclearTimeout(timeout);\n\n\tif (sessionId !== null) {\n\t\ttimeout = setTimeout(() => renewSession(), 600000);\n\t}\n}\n\nfunction getTime () {\n\tlet d = new Date();\n\treturn d.toTimeString();\n}\n\nfunction renewSession () {\n\tcallRenew(res => {\n\t\tconsole.log(getTime(), 'Session: renew result:', res.data);\n\n\t\tif (res.data === 'renewed') {\n\t\t\tconsole.log(getTime(), 'Session: session renewed');\n\t\t\ttimeout = setTimeout(() => renewSession(), 600000);\n\t\t}\n\t\telse {\n\t\t\tconsole.log(getTime(), 'Session: session expired');\n\t\t\tpostMessage('expired');\n\t\t}\n\t},\n\t\t() => {\n\t\t\tconsole.log(getTime(), 'Session: failed to renew - Trying again in 30 seconds');\n\t\t\ttimeout = setTimeout(() => renewSession(), 30000);\n\t\t}\n\t);\n}\n\nfunction callRenew (successCallback, errorCallback) {\n\tconsole.log(getTime(), 'Session: callRenew');\n\n\ttry {\n        var servicesWs = new WebSocket(servicesServer);\n\t} catch (e) {\n\t\terrorCallback();\n\t}\n\n\tservicesWs.onopen = function (e) {\n\t\tservicesWs.send(JSON.stringify({\n\t\t\tcmd: 'renewSession',\n\t\t\tsessionId: sessionId\n\t\t}));\n\t};\n\n\tservicesWs.onmessage = function (e) {\n\t\tvar response = null;\n\t\ttry {\n\t\t\tresponse = JSON.parse(e.data);\n\t\t\tsuccessCallback(response);\n\t\t} catch (e) {\n\t\t\terrorCallback();\n\t\t}\n\n\t\tservicesWs.close();\n\t};\n\n\tservicesWs.onerror = function (e) {\n\t\terrorCallback();\n\t};\n}\n",blob=new Blob([sessionRenewalWorkerCode]),blobURL=window.URL.createObjectURL(blob),sessionRenewalWorker=new Worker(blobURL);sessionRenewalWorker.onmessage=e=>{"expired"===e.data&&vueApp.showGenericPopup("session_expired","session_expired_msg","ok")};var PlayerAccount=class{getSecondaryWeapon(){return this.getPickedWeaponInSlot(Slot.Secondary)}setStats(e,t){this.statsLifetime=e,this.statsCurrent=t}factionChangedRemovePrevious(e){const t=this.getOtherFactionItemId(e);if(!t)return;this.removeFromInventory(G.catalog.findItemById(t));const i=this.generateLoadoutObject();i.hatId===t&&(i.hatId=1,setTimeout((()=>{this.applyLoadoutObject(i),i.hatId=null,this.applyLocalLoadout(i),this.syncToServer()}),0))}convertLoadout(e){e||(e=this.generateLoadoutObject());return{primaryId:[e.soldier_primary_item_id,e.scrambler_primary_item_id,e.ranger_primary_item_id,e.eggsploder_primary_item_id,e.whipper_primary_item_id,e.crackshot_primary_item_id,e.trihard_primary_item_id],secondaryId:[e.soldier_secondary_item_id,e.scrambler_secondary_item_id,e.ranger_secondary_item_id,e.eggsploder_secondary_item_id,e.whipper_secondary_item_id,e.crackshot_secondary_item_id,e.trihard_secondary_item_id],hatId:e.hat_id,stampId:e.stamp_id,stampPositionX:e.stamp_position_x,stampPositionY:e.stamp_position_y,grenadeId:e.grenade_id,meleeId:e.melee_id,classIdx:e.class_idx,colorIdx:e.color}}addToInventory(e,t){this.isItemOwned(e)||this.inventory.push(e),!0===t&&this.tryEquipItem(e)}syncToServer(e){var t=this.generateLoadoutObject();G.api_saveLoadout(t,e),null!==t&&this.applyLocalLoadout(t)}generateLoadoutObject(){return{classIdx:this.classIdx,hatId:hasValue(this.hatItem)?this.hatItem.id:null,stampId:hasValue(this.stampItem)?this.stampItem.id:null,stampPositionX:this.stampPositionX,stampPositionY:this.stampPositionY,grenadeId:hasValue(this.grenadeItem)?this.grenadeItem.id:null,meleeId:hasValue(this.meleeItem)?this.meleeItem.id:null,colorIdx:this.colorIdx,primaryId:this.pickedWeapons.map((e=>e[Slot.Primary].id)),secondaryId:this.pickedWeapons.map((e=>e[Slot.Secondary].id))}}constructor(){this.pickedWeapons=[];for(var e=0;e<CharClass.length;e++){var t=[G.catalog.forClass[e].primaryWeapons[0],G.catalog.forClass[e].secondaryWeapons[0]];this.pickedWeapons.push(t)}this.firebaseId=null,this.session=null,this.maskedEmail=null,this.classIdx=0,this.inventory=[],this.hatItem=null,this.stampItem=null,this.stampPositionX=0,this.stampPositionY=0,this.grenadeItem=G.catalog.grenades[0],this.meleeItem=G.catalog.melee[0],this.colorIdx=0,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.upgradeProductId=null,this.killMultiplier=1,this.hideAds=!1,this.maybeSchoolEmail=!1,this.upgradeExpiryDate=null,this.upgradeIsExpired=null,this.upgradeName="",this.isSubscriber=!1,this.twitchLinked=!1,this.twitchName="",this.contentCreator=!1,this.dateCreated=null,this.accountAge=null,this.notification=null,this.statsCurrent=new StatsObj,this.statsLifetime=new StatsObj,this.eggsSpent=0,this.eggsSpentMonthly=0,this.eggsEarnedBalance=0,this.challenges=[],this.challengesDailyEnd=0,this.faction=null,this.factionActivated=!1,this._firebaseId,Object.defineProperty(this,"firebaseId",{get:function(){return this._firebaseId},set:function(e){this._firebaseId=e,vueApp.firebaseId=this._firebaseId}}),this._id,Object.defineProperty(this,"id",{get:function(){return this._id},set:function(e){this._id=e,vueApp.id=this._id}}),this._isAnonymous,Object.defineProperty(this,"isAnonymous",{get:function(){return this._isAnonymous},set:function(e){this._isAnonymous=e,vueApp.isAnonymous=this._isAnonymous,vueApp.googleAnalytics.isUser=this._isAnonymous?"Unclaimed":"Claimed",ga("set","dimension1",vueData.googleAnalytics.isUser)}}),this._currentBalance,Object.defineProperty(this,"currentBalance",{get:function(){return this._currentBalance},set:function(e){this._currentBalance=e,vueApp.eggs=this._currentBalance}}),this._kills,Object.defineProperty(this,"kills",{get:function(){return this._kills},set:function(e){this._kills=e,vueApp.kills=this._kills}}),this._deaths,Object.defineProperty(this,"deaths",{get:function(){return this._deaths},set:function(e){this._deaths=e,vueApp.deaths=this._deaths}}),this._kdr,Object.defineProperty(this,"kdr",{get:function(){return this._kdr},set:function(e){this._kdr=e,vueApp.kdr=this._kdr}}),this._kdrLifetime,Object.defineProperty(this,"kdrLifetime",{get:function(){return this._kdrLifetime},set:function(e){this._kdrLifetime=e,vueApp.kdrLifetime=this._kdrLifetime}}),this._streak,Object.defineProperty(this,"streak",{get:function(){return this._streak},set:function(e){this._streak=e,vueApp.streak=this._streak}}),this._statsCurrent=new StatsObj,Object.defineProperty(this,"statsCurrent",{get:function(){return this._statsCurrent},set:function(e){this._statsCurrent.set(e),this.kills=this._statsCurrent.kills.total,this.deaths=this._statsCurrent.deaths.total,this.streak=this._statsCurrent.streak,this.kdr=Math.floor(this._statsCurrent.kills.total/Math.max(this._statsCurrent.deaths.total,1)*100)/100,vueApp.statsCurrent=this._statsCurrent}}),this._statsLifetime=new StatsObj,Object.defineProperty(this,"statsLifetime",{get:function(){return this._statsLifetime},set:function(e){this._statsLifetime.set(e),this.kdrLifetime=Math.floor(this._statsLifetime.kills.total/Math.max(this._statsLifetime.deaths.total,1)*100)/100,vueApp.statsLifetime=this._statsLifetime}}),this._eggsSpent,Object.defineProperty(this,"eggsSpent",{get:function(){return this._eggsSpent},set:function(e){this._eggsSpent=null===e?0:e,vueApp.eggsSpent=this._eggsSpent}}),this._eggsSpentMonthly,Object.defineProperty(this,"eggsSpentMonthly",{get:function(){return this._eggsSpentMonthly},set:function(e){this._eggsSpentMonthly=e,vueApp.eggsSpentMonthly=this._eggsSpentMonthly}}),this._eggsEarnedBalance,Object.defineProperty(this,"eggsEarnedBalance",{get:function(){return this._eggsEarnedBalance},set:function(e){void 0!==e&&(this._eggsEarnedBalance=null===e?0:e,vueApp.eggsEarnedBalance=this._eggsEarnedBalance)}}),this._playerName,Object.defineProperty(this,"playerName",{get:function(){return this._playerName},set:function(e){this._playerName=e,vueApp.playerName=this._playerName}}),this._maskedEmail,Object.defineProperty(this,"maskedEmail",{get:function(){return this._maskedEmail},set:function(e){this._maskedEmail=e,vueApp.maskedEmail=this._maskedEmail}}),this._isEmailVerified,Object.defineProperty(this,"isEmailVerified",{get:function(){return this._isEmailVerified},set:function(e){this._isEmailVerified=e,vueApp.isEmailVerified=this._isEmailVerified}}),this._isSubscriber,Object.defineProperty(this,"isSubscriber",{get:function(){return this._isSubscriber},set:function(e){this._isSubscriber=e,vueApp.isSubscriber=e}}),this._upgradeName,Object.defineProperty(this,"upgradeName",{get:function(){return this._upgradeName},set:function(e){this._upgradeName=e,vueApp.upgradeName=e}}),this._hideAds,Object.defineProperty(this,"hideAds",{get:function(){return this._hideAds},set:function(e){vueApp.hideAds=!!e}}),this._twitchLinked,Object.defineProperty(this,"twitchLinked",{get(){return this._twitchLinked},set(e){this._twitchLinked=e,vueApp.twitchLinked=e}}),this._twitchName,Object.defineProperty(this,"twitchName",{get(){return this._twitchName},set(e){this._twitchName=e,vueApp.twitchName=e}}),this._challenges=[],Object.defineProperty(this,"challenges",{get(){return this._challenges},set(e){if(e.length){if(this._challenges.length>0){const[t,i]=this.getDifferenceIndexes(this._challenges,e,"challengeId");if(void 0!==t&&void 0!==i){const a=e.splice(i,1)[0];e.splice(t,0,a)}}this._challenges=e.slice(),vueApp.player.challenges=e.slice(),this.challengesSet()}}}),this._challengesClaimed=[],this.challengesClaimedUnique=[],Object.defineProperty(this,"challengesClaimed",{get:()=>this._challengesClaimed,set:e=>{this._challengesClaimed=e,this.challengesClaimedUnique=[...new Set(e)],vueApp.challengesClaimed.total=this._challengesClaimed.length,vueApp.challengesClaimed.unique=this.challengesClaimedUnique.length}}),this.isItemOwned,Object.defineProperty(this,"isItemOwned",{value:function(e){if(!e)return!1;for(var t=0;t<this.inventory.length;t++)if(this.inventory[t]&&this.inventory[t].id===e.id)return!0;return!1}}),this._contentCreator,Object.defineProperty(this,"contentCreator",{get(){return this._contentCreator},set(e){e&&(this._contentCreator=!0,vueApp.contentCreator=this._contentCreator)}}),this._dateCreated,Object.defineProperty(this,"dateCreated",{get(){return this._dateCreated},set(e){if(e){const t=new Date(e).toLocaleDateString();this._dateCreated=t,vueApp.accountCreated=t}else vueApp.accountCreated=null}})}calculateKdr(){this.kdr=Math.floor(this.statsCurrent.kills/Math.max(this.statsCurrent.deaths,1)*100)/100,this.kdrLifetime=Math.floor(this.statslifetime.kills/Math.max(this.statslifetime.deaths,1)*100)/100}checkNotification(e){e&&!e.read&&(this.notification=e)}getEquippedItems(){return{[ItemType.Primary]:this.pickedWeapons[this.classIdx][Slot.Primary],[ItemType.Secondary]:this.pickedWeapons[this.classIdx][Slot.Secondary],[ItemType.Hat]:this.hatItem,[ItemType.Stamp]:this.stampItem,[ItemType.Grenade]:this.grenadeItem,[ItemType.Melee]:this.meleeItem}}applyLocalLoadout(e){if(!hasValue(e))return;let t=e;e.hasOwnProperty("primaryId")||(t=this.convertLoadout(e));let i={items:t,kills:this.kills?this.kills:0,deaths:this.deaths?this.deaths:0,kdr:this.kdr?this.kdr:0,streak:this.streak?this.streak:0,balance:this._currentBalance};localStore.setItem("localLoadOut",JSON.stringify(i))}setEggBalances(e){this.currentBalance=e,this.eggsEarnedBalance=this.eggsSpent+this.currentBalance}getDifferenceIndexes(e,t,i){const a=Math.max(e.length,t.length),n=[];for(let s=0;s<a;s++){const a=e[s],r=t[s];a&&r?i?a[i]!==r[i]&&n.push(s):JSON.stringify(a)!==JSON.stringify(r)&&n.push(s):n.push(s)}return n}loggedOut(){this.firebaseId=null,this.id=null,this.session=null,this.sessionId=null,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.classIdx=0,this.inventory=[],this.pickedWeapons=[],this.stampItem=null,this.stampPositionX=0,this.stampPositionY=0,this.grenadeItem=G.catalog.findItemById(16e3),this.meleeItem=G.catalog.findItemById(15e3),this.hatItem=null,this.colorIdx=0,this.killMultiplier=1,this.hideAds=!1,this.maybeSchoolEmail=!1,this.isAnonymous=!0,this.upgradeIsExpired=null,this.upgradeExpiryDate=null,this.upgradeName="",this.isSubscriber=!1,this.twitchLinked=!1,this.twitchName="",this.contentCreator=!1,this.dateCreated=null,this.eggsSpent=0,this.eggsSpentMonthly=0,this.eggsEarnedBalance=0,this.challenges=[],this.statsCurrent=new StatsObj,this.statsLifetime=new StatsObj,this.faction=null,this.factionActivated=!1;for(var e=0;e<CharClass.length;e++){var t=[G.catalog.forClass[e].primaryWeapons[0],G.catalog.forClass[e].secondaryWeapons[0]];this.pickedWeapons.push(t)}sessionRenewalWorker.postMessage({sessionId:null}),G.adminRoles=0}pickWeapon(e,t){t.item_type_id===ItemType.Primary&&this.setClass(t.exclusive_for_class),!1===G.catalog.findItemInListById(t,G.catalog.forClass[this.classIdx].forWeaponSlot[e])&&(t=G.catalog.forClass[this.classIdx].forWeaponSlot[e][0]),this.pickedWeapons[this.classIdx][e]=t}tryEquipItem(e){if(this.isItemOwned(e)){switch(e.item_type_id){case ItemType.Hat:this.hatItem=e;break;case ItemType.Stamp:this.stampItem=e;break;case ItemType.Primary:e.exclusive_for_class!==this.classIdx&&this.setClass(e.exclusive_for_class),this.pickWeapon(Slot.Primary,e);break;case ItemType.Secondary:this.pickWeapon(Slot.Secondary,e);break;case ItemType.Grenade:this.grenadeItem=e;break;case ItemType.Melee:this.meleeItem=e}this.syncToServer()}}addFactionItemToInventory(e){const t=G.catalog.findItemById(e);this.addToInventory(t,!1)}getPrimaryWeapon(){return this.getPickedWeaponInSlot(Slot.Primary)}loggingOut(){this.loggedOut(),this.applyLoadoutObject(),this.getPrimaryWeapon(),this.getSecondaryWeapon(),this.setClass(this.classIdx),vueApp.signOut()}applyRandomLoadout(){let e=G.catalog.hats.filter((e=>0===e.price&&"default"===e.unlock)),t=e[Math.randomInt(0,e.length)].id;this.hatItem=G.catalog.findItemById(t),this.colorIdx=Math.randomInt(0,7);let i=this.generateLoadoutObject();i.hatId=t,i.stampId=null,i.stampPositionX=0,i.stampPositionY=0,i.color=this.colorIdx,this.applyLocalLoadout(i),setTimeout((()=>this.applyLoadoutObject(i)),0)}challengesAutoClaimed(e){const t=e.filter((e=>"claimed"===e.status));if(t.length>0){for(const e of t){const t=extern.playerChallenges.challengeGet(e.id);t&&t.loc_ref?ga("send","event","dailyChallenge","auto_claim",t.loc_ref):console.error("Challenge or loc_ref not found for id:",e.id)}return t}return!1}isUpgraded(){return hasValue(this.upgradeProductId)&&!this.upgradeIsExpired}getPickedWeaponInSlot(e){return this.pickedWeapons[this.classIdx][e]}challengesSet(){if(this.challenges.length>0){let e=this.challenges.reduce(((e,t)=>e&&e.period>t.period?e:t));null!==e&&(this.challengesDailyEnd=Math.trunc(Date.now()/1e3)+e.period)}else console.log("Player challenges empty. Most likely reason: No challenges available for this player")}setFaction(e){for(const t in FactionsItems){const i=G.catalog.findItemById(FactionsItems[t]);if(this.isItemOwned(i)){this.faction=parseInt(t),vueApp.faction.playerFaction=this.faction,vueApp.faction.switchTimer=e;break}}}signedIn(e,t){if(e.uid===t.firebaseId){if(this.isAnonymous=e.isAnonymous,this.isEmailVerified=!this.isAnonymous&&t.emailVerified,this.id=t.id,this.firebaseId=t.firebaseId,this.sessionId=t.sessionId,this.session=t.session,this.maskedEmail=t.maskedEmail,this.kills=t.kills,this.deaths=t.deaths,this.streak=t.streak,this.currentBalance=t.currentBalance,this.maybeSchoolEmail=t.maybeSchoolEmail,this.subscriptionEnded=t.subscriptionEnded,this.passEnded=t.passEnded,this.twitchLinked=t.twitchLinked,this.twitchName=t.twitchName,this.contentCreator=t.social&&t.social.length&&t.social[0]?t.social:"",this.checkNotification(t.notification),this.setStats(t.statsLifetime,t.statsCurrent),this.dateCreated=t.dateCreated,this.accountAge=t.accountAge,this.eggsSpent=t.eggsSpent,this.eggsSpentMonthly=t.eggsSpentMonthly,this.eggsEarnedBalance=this.setEggBalances(this.currentBalance),this.challengesHasAutoClaim=this.challengesAutoClaimed(t.unclaimedRewards),this.challengesClaimed=t.claimedChallenges,this.setUpgrade(t),this.challenges=t.challenges,G.adminRoles=t.adminRoles,hasValue(t.ownedItemIds))for(var i=0;i<t.ownedItemIds.length;i++){var a=G.catalog.findItemById(t.ownedItemIds[i]);this.inventory.push(a)}this.activateFaction(t.eggOrgNeedsFaction),this.setFaction(t.eggOrgSwitchTimer),G.productBlockAds=G.playerAccount.isUpgraded(),this.subscriptionEnded&&(G.vipSubEnded=!0),t.passEnded&&(G.passEnded=!0),t.firstSignin&&(G.showSigninBonus=!0),this.applyLoadoutObject(t.loadout),this.applyLocalLoadout(t.loadout),sessionRenewalWorker.postMessage({servicesServer:G.servicesServer,sessionId:this.sessionId})}else console.log("Firebase user ID does not match account returned from API")}applyLoadoutObject(e){if(hasValue(e)){void 0!==e.classIdx&&null!==e.classIdx&&this.setClass(e.classIdx);for(var t=this,i=function(e,i,a){var n=G.catalog.forClass[i].forWeaponSlot[a][0];if(hasValue(e)){let t=G.catalog.findItemById(e);t&&(n=t)}t.pickedWeapons[i][a]=n},a=0;a<CharClass.length;a++)i(e.primaryId[a],a,Slot.Primary),i(e.secondaryId[a],a,Slot.Secondary);if(hasValue(e.hatId)){var n=G.catalog.findItemById(e.hatId);this.isItemOwned(n)||(this.hatItem=null),this.hatItem=n}if(hasValue(e.stampId)){var s=G.catalog.findItemById(e.stampId);this.isItemOwned(s)||(this.stampItem=null),this.stampItem=s}if(hasValue(e.grenadeId)){var r=G.catalog.findItemById(e.grenadeId);this.isItemOwned(r)||(r=G.catalog.findItemById(16e3)),this.grenadeItem=r}if(hasValue(e.meleeId)){var o=G.catalog.findItemById(e.meleeId);this.isItemOwned(o)||(o=G.catalog.findItemById(15e3)),this.meleeItem=o}hasValue(e.colorIdx)&&(this.colorIdx=e.colorIdx,this.colorIdx>=7&&!1===this.isUpgraded()&&(this.colorIdx=0)),hasValue(e.stampPositionX)&&(this.stampPositionX=e.stampPositionX),hasValue(e.stampPositionY)&&(this.stampPositionY=e.stampPositionY)}G.resetPaperDoll()}setUpgrade(e){const{upgradeProductId:t,upgradeMultiplier:i=1,upgradeExpiryDate:a=null,upgradeIsExpired:n=null,upgradeAdFree:s=!1,upgradeType:r,upgradePlanId:o,upgradeName:l}=e;this.upgradeProductId=t,this.upgradePlanId=o,this.multiplier=i,this.upgradeExpiryDate=a,this.upgradeIsExpired=n,this.hideAds=s&&!n,this.isSubscriber=("subscription"===r||"pass"===r)&&!n,this.upgradeName=l;const c=this.isUpgraded(),h=c?this.upgradeExpiryDate:null;this.colorIdx>=7&&!c&&(this.colorIdx=0),vueApp.setAccountUpgraded(c,h)}removeFromInventory(e){const t=this.inventory.findIndex((t=>t===e));-1!==t&&this.inventory.splice(t,1)}getOtherFactionItemId(e){const t=Object.keys(FactionsItems).find((t=>FactionsItems[t]===e));if(void 0===t)return null;const i=Object.keys(FactionsItems).find((e=>e!==t));return void 0!==i?FactionsItems[i]:null}factionChanged(e){e&&(this.addFactionItemToInventory(e),this.factionChangedRemovePrevious(e),this.setFaction())}activateFaction(e){if(!e)return;const t=Object.keys(EggOrgFactionsReward).find((t=>EggOrgFactionsReward[t]===e));if(void 0===t)return;const i=FactionsItems[t];this.addFactionItemToInventory(i),vueApp.faction.showPopup=!0,this.factionActivated=!0}setClass(e){(null==e||e>=G.classes.length)&&(e=0),this.classIdx=e,vueApp&&(vueApp.classIdx=this.classIdx)}};function __decorate(e,t,i,a){var n,s=arguments.length,r=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,a);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r}var __mergedStore={},__decoratorInitialStore={};function GetDirectStore(e){const t=e.getClassName();return __decoratorInitialStore[t]||(__decoratorInitialStore[t]={}),__decoratorInitialStore[t]}function GetMergedStore(e){const t=e.getClassName();if(__mergedStore[t])return __mergedStore[t];__mergedStore[t]={};const i=__mergedStore[t];let a=e,n=t;for(;n;){const e=__decoratorInitialStore[n];for(const t in e)i[t]=e[t];let t,s=!1;do{if(t=Object.getPrototypeOf(a),!t.getClassName){s=!0;break}if(t.getClassName()!==n)break;a=t}while(t);if(s)break;n=t.getClassName(),a=t}return i}function generateSerializableMember(e,t){return(i,a)=>{const n=GetDirectStore(i);n[a]||(n[a]={type:e,sourceName:t})}}function generateExpandMember(e,t=null){return(i,a)=>{const n=t||"_"+a;Object.defineProperty(i,a,{get:function(){return this[n]},set:function(t){"function"==typeof this.equals&&this.equals(t)||this[n]!==t&&(this[n]=t,i[e].apply(this))},enumerable:!0,configurable:!0})}}function expandToProperty(e,t=null){return generateExpandMember(e,t)}function serialize(e){return generateSerializableMember(0,e)}function serializeAsTexture(e){return generateSerializableMember(1,e)}function serializeAsColor3(e){return generateSerializableMember(2,e)}function serializeAsFresnelParameters(e){return generateSerializableMember(3,e)}function serializeAsVector2(e){return generateSerializableMember(4,e)}function serializeAsVector3(e){return generateSerializableMember(5,e)}function serializeAsMeshReference(e){return generateSerializableMember(6,e)}function serializeAsColorCurves(e){return generateSerializableMember(7,e)}function serializeAsColor4(e){return generateSerializableMember(8,e)}function serializeAsImageProcessingConfiguration(e){return generateSerializableMember(9,e)}function serializeAsQuaternion(e){return generateSerializableMember(10,e)}function serializeAsMatrix(e){return generateSerializableMember(12,e)}function nativeOverride(e,t,i,a){const n=i.value;i.value=(...i)=>{let s=n;if("undefined"!=typeof _native&&_native[t]){const e=_native[t];s=a?(...t)=>a(...t)?e(...t):n(...t):e}return e[t]=s,s(...i)}}nativeOverride.filter=function(e){return(t,i,a)=>nativeOverride(t,i,a,e)};var warnedMap={};function _WarnImport(e,t=!1){if(!t||!warnedMap[e])return warnedMap[e]=!0,`${e} needs to be imported before as it contains a side-effect required by your code.`}var AndOrNotEvaluator=class e{static _SimplifyNegation(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(e=>(e=e.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?e="false":"!false"===e&&(e="true"),e}static Eval(t,i){return"true"===(t=t.match(/\([^()]*\)/g)?t.replace(/\([^()]*\)/g,(t=>(t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,i)))):e._HandleParenthesisContent(t,i))||"false"!==t&&e.Eval(t,i)}static _HandleParenthesisContent(t,i){let a;i=i||(e=>"true"===e);const n=t.split("||");for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let s=e._SimplifyNegation(n[t].trim());const r=s.split("&&");if(r.length>1)for(let t=0;t<r.length;++t){const n=e._SimplifyNegation(r[t].trim());if(a="true"!==n&&"false"!==n?"!"===n[0]?!i(n.substring(1)):i(n):"true"===n,!a){s="false";break}}if(a||"true"===s){a=!0;break}a="true"!==s&&"false"!==s?"!"===s[0]?!i(s.substring(1)):i(s):"true"===s}return a?"true":"false"}},Tags=class e{static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static _RemoveTagFrom(e,t){delete e._tags[t]}static AddTagsTo(t,i){if(!i)return;if("string"!=typeof i)return;i.split(" ").forEach((function(i){e._AddTagTo(t,i)}))}static MatchesQuery(t,i){return void 0===i||(""===i?e.HasTags(t):AndOrNotEvaluator.Eval(i,(i=>e.HasTags(t)&&t._tags[i])))}static HasTags(e){if(!e._tags)return!1;const t=e._tags;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}static RemoveTagsFrom(t,i){if(!e.HasTags(t))return;const a=i.split(" ");for(const i in a)e._RemoveTagFrom(t,a[i])}static _AddTagTo(t,i){""!==(i=i.trim())&&"true"!==i&&"false"!==i&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[i]=!0))}static EnableFor(t){t._tags=t._tags||{},t.hasTags=()=>e.HasTags(t),t.addTags=i=>e.AddTagsTo(t,i),t.removeTags=i=>e.RemoveTagsFrom(t,i),t.matchesTagsQuery=i=>e.MatchesQuery(t,i)}static GetTags(e,t=!0){if(!e._tags)return null;if(t){const t=[];for(const i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&t.push(i);return t.join(" ")}return e._tags}};function BuildArray(e,t){const i=[];for(let a=0;a<e;++a)i.push(t());return i}function BuildTuple(e,t){return BuildArray(e,t)}function _observeArrayfunction(e,t,i){const a=e[t];if("function"!=typeof a)return null;const n=function(){const a=e.length,s=n.previous.apply(e,arguments);return i(t,a),s};return a.next=n,n.previous=a,e[t]=n,()=>{const i=n.previous;if(!i)return;const a=n.next;a?(i.next=a,a.previous=i):(i.next=void 0,e[t]=i),n.next=void 0,n.previous=void 0}}var observedArrayFunctions=["push","splice","pop","shift","unshift"];function _ObserveArray(e,t){const i=observedArrayFunctions.map((i=>_observeArrayfunction(e,i,t)));return()=>{i.forEach((e=>{e?.()}))}}var _RegisteredTypes={};function RegisterClass(e,t){_RegisteredTypes[e]=t}function GetClass(e){return _RegisteredTypes[e]}var ToGammaSpace=1/2.2,ToLinearSpace=2.2,PHI=(1+Math.sqrt(5))/2,Epsilon=.001;function WithinEpsilon(e,t,i=1401298e-51){return Math.abs(e-t)<=i}function RandomRange(e,t){return e===t?e:Math.random()*(t-e)+e}function Lerp(e,t,i){return e+(t-e)*i}function Clamp(e,t=0,i=1){return Math.min(i,Math.max(t,e))}function NormalizeRadians(e){return e-=2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function ToHex(e){const t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}var Scalar=class e{static Normalize(e,t,i){return(e-t)/(i-t)}static Sign(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1}static MoveTowardsAngle(t,i,a){const n=e.DeltaAngle(t,i);let s=0;return-a<n&&n<a?s=i:(i=t+n,s=e.MoveTowards(t,i,a)),s}static PingPong(t,i){const a=e.Repeat(t,2*i);return i-Math.abs(a-i)}static Denormalize(e,t,i){return e*(i-t)+t}static InverseLerp(e,t,i){let a=0;return a=e!=t?Clamp((i-e)/(t-e)):0,a}static SmoothStep(t,i,a){let n=e.Clamp(a);return n=-2*n*n*n+3*n*n,i*n+t*(1-n)}static RangeToPercent(e,t,i){return(e-t)/(i-t)}static Log2(e){return Math.log(e)*Math.LOG2E}static Repeat(e,t){return e-Math.floor(e/t)*t}static MoveTowards(t,i,a){let n=0;return n=Math.abs(i-t)<=a?i:t+e.Sign(i-t)*a,n}static LerpAngle(t,i,a){let n=e.Repeat(i-t,360);return n>180&&(n-=360),t+n*Clamp(a)}static DeltaAngle(t,i){let a=e.Repeat(i-t,360);return a>180&&(a-=360),a}static PercentToRange(e,t,i){return(i-t)*e+t}static ILog2(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;let t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}static Hermite1stDerivative(e,t,i,a,n){const s=n*n;return 6*(s-n)*e+(3*s-4*n+1)*t+6*(-s+n)*i+(3*s-2*n)*a}static Hermite(e,t,i,a,n){const s=n*n,r=n*s;return e*(2*r-3*s+1)+i*(-2*r+3*s)+t*(r-2*s+n)+a*(r-s)}static HCF(t,i){const a=t%i;return 0===a?i:e.HCF(i,a)}};function colorChannelToLinearSpace(e){return Math.pow(e,ToLinearSpace)}function colorChannelToLinearSpaceExact(e){return e<=.04045?.0773993808*e:Math.pow(.947867299*(e+.055),2.4)}function colorChannelToGammaSpace(e){return Math.pow(e,ToGammaSpace)}function colorChannelToGammaSpaceExact(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}Scalar.TwoPi=2*Math.PI,Scalar.WithinEpsilon=WithinEpsilon,Scalar.ToHex=ToHex,Scalar.Clamp=Clamp,Scalar.Lerp=Lerp,Scalar.RandomRange=RandomRange,Scalar.NormalizeRadians=NormalizeRadians;var Color3=class e{static Random(){return new e(Math.random(),Math.random(),Math.random())}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}subtract(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)}static Teal(){return new e(0,1,1)}static FromArray(t,i=0){return new e(t[i],t[i+1],t[i+2])}maximizeInPlaceFromFloats(e,t,i){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this}fromArray(t,i=0){return e.FromArrayToRef(t,i,this),this}asArray(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}constructor(e=0,t=0,i=0){this.r=e,this.g=t,this.b=i}toLinearSpaceToRef(e,t=!1){return t?(e.r=colorChannelToLinearSpaceExact(this.r),e.g=colorChannelToLinearSpaceExact(this.g),e.b=colorChannelToLinearSpaceExact(this.b)):(e.r=colorChannelToLinearSpace(this.r),e.g=colorChannelToLinearSpace(this.g),e.b=colorChannelToLinearSpace(this.b)),this}fract(){throw new ReferenceError("Can not fract a color")}copyFromFloats(e,t,i){return this.r=e,this.g=t,this.b=i,this}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}divideInPlace(e){throw new ReferenceError("Can not divide a color")}multiplyByFloats(t,i,a){return new e(this.r*t,this.g*i,this.b*a)}addInPlaceFromFloats(e,t,i){return this.r+=e,this.g+=t,this.b+=i,this}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}static Gray(){return new e(.5,.5,.5)}static Magenta(){return new e(1,0,1)}equalsWithEpsilon(e,t=Epsilon){return Scalar.WithinEpsilon(this.r,e.r,t)&&Scalar.WithinEpsilon(this.g,e.g,t)&&Scalar.WithinEpsilon(this.b,e.b,t)}fractToRef(e){throw new ReferenceError("Can not fract a color")}static FromHexString(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);const i=parseInt(t.substring(1,3),16),a=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16);return e.FromInts(i,a,n)}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}set(e,t,i){return this.copyFromFloats(e,t,i)}toHSV(){return this.toHSVToRef(new e)}toHSVToRef(e){const t=this.r,i=this.g,a=this.b,n=Math.max(t,i,a),s=Math.min(t,i,a);let r=0,o=0;const l=n,c=n-s;return 0!==n&&(o=c/n),n!=s&&(n==t?(r=(i-a)/c,i<a&&(r+=6)):n==i?r=(a-t)/c+2:n==a&&(r=(t-i)/c+4),r*=60),e.r=r,e.g=o,e.b=l,e}toHexString(){const e=Math.round(255*this.r),t=Math.round(255*this.g),i=Math.round(255*this.b);return"#"+ToHex(e)+ToHex(t)+ToHex(i)}scale(t){return new e(this.r*t,this.g*t,this.b*t)}static Red(){return new e(1,0,0)}floorToRef(e){throw new ReferenceError("Can not floor a color")}static Purple(){return new e(.5,0,.5)}minimizeInPlaceFromFloats(e,t,i){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this}subtractFromFloatsToRef(e,t,i,a){return a.r=this.r-e,a.g=this.g-t,a.b=this.b-i,a}static Hermite(t,i,a,n,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,u=o-r,m=t.r*l+a.r*c+i.r*h+n.r*u,d=t.g*l+a.g*c+i.g*h+n.g*u,f=t.b*l+a.b*c+i.b*h+n.b*u;return new e(m,d,f)}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}equalsToFloats(e,t,i){return this.r===e&&this.g===t&&this.b===i}clone(){return new e(this.r,this.g,this.b)}toGammaSpaceToRef(e,t=!1){return t?(e.r=colorChannelToGammaSpaceExact(this.r),e.g=colorChannelToGammaSpaceExact(this.g),e.b=colorChannelToGammaSpaceExact(this.b)):(e.r=colorChannelToGammaSpace(this.r),e.g=colorChannelToGammaSpace(this.g),e.b=colorChannelToGammaSpace(this.b)),this}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}setAll(e){return this.r=this.g=this.b=e,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}static get BlackReadOnly(){return e._BlackReadOnly}divide(e){throw new ReferenceError("Can not divide a color")}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2]}clampToRef(e=0,t=1,i){return i.r=Clamp(this.r,e,t),i.g=Clamp(this.g,e,t),i.b=Clamp(this.b,e,t),i}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}subtractFromFloats(t,i,a){return new e(this.r-t,this.g-i,this.b-a)}static Black(){return new e(0,0,0)}floor(){throw new ReferenceError("Can not floor a color")}static White(){return new e(1,1,1)}static Green(){return new e(0,1,0)}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}toColor4(e=1){return new Color4(this.r,this.g,this.b,e)}static Yellow(){return new e(1,1,0)}static HSVtoRGBToRef(e,t,i,a){const n=i*t,s=e/60,r=n*(1-Math.abs(s%2-1));let o=0,l=0,c=0;s>=0&&s<=1?(o=n,l=r):s>=1&&s<=2?(o=r,l=n):s>=2&&s<=3?(l=n,c=r):s>=3&&s<=4?(l=r,c=n):s>=4&&s<=5?(o=r,c=n):s>=5&&s<=6&&(o=n,c=r);const h=i-n;return a.r=o+h,a.g=l+h,a.b=c+h,a}toGammaSpace(t=!1){const i=new e;return this.toGammaSpaceToRef(i,t),i}equalsFloats(e,t,i){return this.equalsToFloats(e,t,i)}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}static Hermite1stDerivative(t,i,a,n,s){const r=e.Black();return this.Hermite1stDerivativeToRef(t,i,a,n,s,r),r}negateInPlace(){throw new ReferenceError("Can not negate a color")}getHashCode(){let e=255*this.r|0;return e=397*e^255*this.g,e=397*e^255*this.b,e}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}toLinearSpace(t=!1){const i=new e;return this.toLinearSpaceToRef(i,t),i}add(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)}static Hermite1stDerivativeToRef(e,t,i,a,n,s){const r=n*n;s.r=6*(r-n)*e.r+(3*r-4*n+1)*t.r+6*(-r+n)*i.r+(3*r-2*n)*a.r,s.g=6*(r-n)*e.g+(3*r-4*n+1)*t.g+6*(-r+n)*i.g+(3*r-2*n)*a.g,s.b=6*(r-n)*e.b+(3*r-4*n+1)*t.b+6*(-r+n)*i.b+(3*r-2*n)*a.b}static LerpToRef(e,t,i,a){a.r=e.r+(t.r-e.r)*i,a.g=e.g+(t.g-e.g)*i,a.b=e.b+(t.b-e.b)*i}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}negate(){throw new ReferenceError("Can not negate a color")}static Blue(){return new e(0,0,1)}static FromHSV(t,i,a){const n=new e(0,0,0);return e.HSVtoRGBToRef(t,i,a,n),n}getClassName(){return"Color3"}static FromInts(t,i,a){return new e(t/255,i/255,a/255)}multiply(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}negateToRef(e){throw new ReferenceError("Can not negate a color")}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}static Lerp(t,i,a){const n=new e(0,0,0);return e.LerpToRef(t,i,a,n),n}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}};Color3._BlackReadOnly=Color3.Black(),Object.defineProperties(Color3.prototype,{dimension:{value:[3]},rank:{value:1}});var Color4=class e{static Hermite1stDerivativeToRef(e,t,i,a,n,s){const r=n*n;s.r=6*(r-n)*e.r+(3*r-4*n+1)*t.r+6*(-r+n)*i.r+(3*r-2*n)*a.r,s.g=6*(r-n)*e.g+(3*r-4*n+1)*t.g+6*(-r+n)*i.g+(3*r-2*n)*a.g,s.b=6*(r-n)*e.b+(3*r-4*n+1)*t.b+6*(-r+n)*i.b+(3*r-2*n)*a.b,s.a=6*(r-n)*e.a+(3*r-4*n+1)*t.a+6*(-r+n)*i.a+(3*r-2*n)*a.a}floorToRef(e){throw new ReferenceError("Can not floor a color")}getClassName(){return"Color4"}fractToRef(e){throw new ReferenceError("Can not fract a color")}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}toLinearSpaceToRef(e,t=!1){return t?(e.r=colorChannelToLinearSpaceExact(this.r),e.g=colorChannelToLinearSpaceExact(this.g),e.b=colorChannelToLinearSpaceExact(this.b)):(e.r=colorChannelToLinearSpace(this.r),e.g=colorChannelToLinearSpace(this.g),e.b=colorChannelToLinearSpace(this.b)),e.a=this.a,this}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}equalsWithEpsilon(e,t=Epsilon){return Scalar.WithinEpsilon(this.r,e.r,t)&&Scalar.WithinEpsilon(this.g,e.g,t)&&Scalar.WithinEpsilon(this.b,e.b,t)&&Scalar.WithinEpsilon(this.a,e.a,t)}set(e,t,i,a){return this.copyFromFloats(e,t,i,a)}addInPlaceFromFloats(e,t,i,a){return this.r+=e,this.g+=t,this.b+=i,this.a+=a,this}static Hermite1stDerivative(t,i,a,n,s){const r=new e;return this.Hermite1stDerivativeToRef(t,i,a,n,s,r),r}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}toLinearSpace(t=!1){const i=new e;return this.toLinearSpaceToRef(i,t),i}multiplyByFloats(t,i,a,n){return new e(this.r*t,this.g*i,this.b*a,this.a*n)}asArray(){return[this.r,this.g,this.b,this.a]}static FromArray(t,i=0){return new e(t[i],t[i+1],t[i+2],t[i+3])}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}negateInPlace(){throw new ReferenceError("Can not negate a color")}negate(){throw new ReferenceError("Can not negate a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}static Lerp(t,i,a){return e.LerpToRef(t,i,a,new e)}getHashCode(){let e=255*this.r|0;return e=397*e^255*this.g,e=397*e^255*this.b,e=397*e^255*this.a,e}constructor(e=0,t=0,i=0,a=1){this.r=e,this.g=t,this.b=i,this.a=a}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}floor(){throw new ReferenceError("Can not floor a color")}maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}static FromColor3(t,i=1){return new e(t.r,t.g,t.b,i)}setAll(e){return this.r=this.g=this.b=this.a=e,this}divide(e){throw new ReferenceError("Can not divide a color")}add(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}static FromInts(t,i,a,n){return new e(t/255,i/255,a/255,n/255)}subtractFromFloatsToRef(e,t,i,a,n){return n.r=this.r-e,n.g=this.g-t,n.b=this.b-i,n.a=this.a-a,n}clone(){return(new e).copyFrom(this)}minimizeInPlaceFromFloats(e,t,i,a){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this.a=Math.min(a,this.a),this}copyFromFloats(e,t,i,a){return this.r=e,this.g=t,this.b=i,this.a=a,this}clampToRef(e=0,t=1,i){return i.r=Clamp(this.r,e,t),i.g=Clamp(this.g,e,t),i.b=Clamp(this.b,e,t),i.a=Clamp(this.a,e,t),i}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}fract(){throw new ReferenceError("Can not fract a color")}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}toHexString(e=!1){const t=Math.round(255*this.r),i=Math.round(255*this.g),a=Math.round(255*this.b);if(e)return"#"+ToHex(t)+ToHex(i)+ToHex(a);const n=Math.round(255*this.a);return"#"+ToHex(t)+ToHex(i)+ToHex(a)+ToHex(n)}static CheckColors4(e,t){if(e.length===3*t){const t=[];for(let i=0;i<e.length;i+=3){const a=i/3*4;t[a]=e[i],t[a+1]=e[i+1],t[a+2]=e[i+2],t[a+3]=1}return t}return e}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}scale(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)}subtract(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}negateToRef(e){throw new ReferenceError("Can not negate a color")}static LerpToRef(e,t,i,a){return a.r=e.r+(t.r-e.r)*i,a.g=e.g+(t.g-e.g)*i,a.b=e.b+(t.b-e.b)*i,a.a=e.a+(t.a-e.a)*i,a}toGammaSpaceToRef(e,t=!1){return t?(e.r=colorChannelToGammaSpaceExact(this.r),e.g=colorChannelToGammaSpaceExact(this.g),e.b=colorChannelToGammaSpaceExact(this.b)):(e.r=colorChannelToGammaSpace(this.r),e.g=colorChannelToGammaSpace(this.g),e.b=colorChannelToGammaSpace(this.b)),e.a=this.a,this}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}equalsToFloats(e,t,i,a){return this.r===e&&this.g===t&&this.b===i&&this.a===a}multiply(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}maximizeInPlaceFromFloats(e,t,i,a){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this.a=Math.max(a,this.a),this}subtractFromFloats(t,i,a,n){return new e(this.r-t,this.g-i,this.b-a,this.a-n)}static Hermite(t,i,a,n,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,u=o-r,m=t.r*l+a.r*c+i.r*h+n.r*u,d=t.g*l+a.g*c+i.g*h+n.g*u,f=t.b*l+a.b*c+i.b*h+n.b*u,p=t.a*l+a.a*c+i.a*h+n.a*u;return new e(m,d,f,p)}toGammaSpace(t=!1){const i=new e;return this.toGammaSpaceToRef(i,t),i}static FromHexString(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return new e(0,0,0,0);const i=parseInt(t.substring(1,3),16),a=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16),s=9===t.length?parseInt(t.substring(7,9),16):255;return e.FromInts(i,a,n,s)}};Object.defineProperties(Color4.prototype,{dimension:{value:[4]},rank:{value:1}});var TmpColors=class{};TmpColors.Color3=BuildArray(3,Color3.Black),TmpColors.Color4=BuildArray(3,(()=>new Color4(0,0,0,0))),RegisterClass("BABYLON.Color3",Color3),RegisterClass("BABYLON.Color4",Color4);var PerformanceConfigurator=class e{static SetMatrixPrecision(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(let t=0;t<e.MatrixTrackedMatrices.length;++t){const i=e.MatrixTrackedMatrices[t],a=i._m;i._m=new Array(16);for(let e=0;e<16;++e)i._m[e]=a[e]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null}};PerformanceConfigurator.MatrixUse64Bits=!1,PerformanceConfigurator.MatrixTrackPrecisionChange=!0,PerformanceConfigurator.MatrixCurrentType=Float32Array,PerformanceConfigurator.MatrixTrackedMatrices=[];var EventState=class{initialize(e,t=!1,i,a){return this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=a,this}constructor(e,t=!1,i,a){this.initialize(e,t,i,a)}},Observer=class{remove(){this._remove&&this._remove()}constructor(e,t,i=null){this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}},Observable=class e{get observers(){return this._observers}clone(){const t=new e;return t._observers=this._observers.slice(0),t}notifyObserver(e,t,i=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;const a=this._eventState;a.mask=i,a.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,a)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}remove(e){if(!e)return!1;e._remove=null;return-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)}_remove(e,t=!0){if(!e)return!1;const i=this._observers.indexOf(e);return-1!==i&&(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}notifyObservers(e,t=-1,i,a,n){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;const s=this._eventState;s.mask=t,s.target=i,s.currentTarget=a,s.skipNextObservers=!1,s.lastReturnValue=e,s.userInfo=n;for(const i of this._observers)if(!i._willBeUnregistered&&(i.mask&t&&(i.unregisterOnNextCall&&this._deferUnregister(i),i.scope?s.lastReturnValue=i.callback.apply(i.scope,[e,s]):s.lastReturnValue=i.callback(e,s)),s.skipNextObservers))return!1;return!0}static FromPromise(t,i){const a=new e;return t.then((e=>{a.notifyObservers(e)})).catch((e=>{if(!i)throw e;i.notifyObservers(e)})),a}add(e,t=-1,i=!1,a=null,n=!1){if(!e)return null;const s=new Observer(e,t,a);return s.unregisterOnNextCall=n,i?this._observers.unshift(s):this._observers.push(s),this._onObserverAdded&&this._onObserverAdded(s),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(s,this._lastNotifiedValue),s._remove=()=>{this.remove(s)},s}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}clear(){for(;this._observers.length;){const e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((()=>{this._remove(e)}),0))}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}hasSpecificMask(e=-1){for(const t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}removeCallback(e,t){for(let i=0;i<this._observers.length;i++){const a=this._observers[i];if(!a._willBeUnregistered&&(a.callback===e&&(!t||t===a.scope)))return this._deferUnregister(a),!0}return!1}constructor(e,t=!1){this.notifyIfTriggered=t,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new EventState(0),e&&(this._onObserverAdded=e)}},EngineStore=class{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}};EngineStore.Instances=[],EngineStore.OnEnginesDisposedObservable=new Observable,EngineStore._LastCreatedScene=null,EngineStore.UseFallbackTexture=!0,EngineStore.FallbackTexture="";var _ExtractAsInt=e=>parseInt(e.toString().replace(/\W/g,"")),Vector2=class e{static Center(t,i){return e.CenterToRef(t,i,new e)}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(RandomRange(e,t),RandomRange(e,t))}static Random(t=0,i=1){return new e(RandomRange(t,i),RandomRange(t,i))}set(e,t){return this.copyFromFloats(e,t)}static Hermite(t,i,a,n,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,u=o-r,m=t.x*l+a.x*c+i.x*h+n.x*u,d=t.y*l+a.y*c+i.y*h+n.y*u;return new e(m,d)}setAll(e){return this.copyFromFloats(e,e)}static DistanceOfPointFromSegment(t,i,a){const n=e.DistanceSquared(i,a);if(0===n)return e.Distance(t,i);const s=a.subtract(i),r=Math.max(0,Math.min(1,e.Dot(t.subtract(i),s)/n)),o=i.add(s.multiplyByFloats(r,r));return e.Distance(t,o)}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}scale(t){return new e(this.x*t,this.y*t)}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t}copyFromFloats(e,t){return this.x=e,this.y=t,this}static Normalize(t){return e.NormalizeToRef(t,new e)}equalsToFloats(e,t){return this.x===e&&this.y===t}constructor(e=0,t=0){this.x=e,this.y=t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this}equals(e){return e&&this.x===e.x&&this.y===e.y}static PointInTriangle(e,t,i,a){const n=.5*(-i.y*a.x+t.y*(-i.x+a.x)+t.x*(i.y-a.y)+i.x*a.y),s=n<0?-1:1,r=(t.y*a.x-t.x*a.y+(a.y-t.y)*e.x+(t.x-a.x)*e.y)*s,o=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*s;return r>0&&o>0&&r+o<2*n*s}divide(t){return new e(this.x/t.x,this.y/t.y)}static TransformToRef(e,t,i){const a=t.m,n=e.x*a[0]+e.y*a[4]+a[12],s=e.x*a[1]+e.y*a[5]+a[13];return i.x=n,i.y=s,i}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t}static FromFloatsToRef(e,t,i){return i.copyFromFloats(e,t),i}getClassName(){return"Vector2"}maximizeInPlaceFromFloats(e,t){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this}normalizeToNew(){const t=new e;return this.normalizeToRef(t),t}static Distance(t,i){return Math.sqrt(e.DistanceSquared(t,i))}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t}normalize(){return this.normalizeFromLength(this.length())}getHashCode(){let e=_ExtractAsInt(this.x);return e=397*e^_ExtractAsInt(this.y),e}static Hermite1stDerivativeToRef(e,t,i,a,n,s){const r=n*n;return s.x=6*(r-n)*e.x+(3*r-4*n+1)*t.x+6*(-r+n)*i.x+(3*r-2*n)*a.x,s.y=6*(r-n)*e.y+(3*r-4*n+1)*t.y+6*(-r+n)*i.y+(3*r-2*n)*a.y,s}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,this}negate(){return new e(-this.x,-this.y)}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e}fromArray(t,i=0){return e.FromArrayToRef(t,i,this),this}subtractFromFloats(t,i){return new e(this.x-t,this.y-i)}copyFrom(e){return this.x=e.x,this.y=e.y,this}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}negateInPlace(){return this.x*=-1,this.y*=-1,this}static Zero(){return new e(0,0)}static Minimize(t,i){const a=t.x<i.x?t.x:i.x,n=t.y<i.y?t.y:i.y;return new e(a,n)}negateToRef(e){return e.x=-this.x,e.y=-this.y,e}multiply(t){return new e(this.x*t.x,this.y*t.y)}static DistanceSquared(e,t){const i=e.x-t.x,a=e.y-t.y;return i*i+a*a}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t}clone(){return new e(this.x,this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}add(t){return new e(this.x+t.x,this.y+t.y)}divideInPlace(e){return this.x=this.x/e.x,this.y=this.y/e.y,this}addVector3(t){return new e(this.x+t.x,this.y+t.y)}subtractFromFloatsToRef(e,t,i){return i.x=this.x-e,i.y=this.y-t,i}static Transform(t,i){return e.TransformToRef(t,i,new e)}scaleInPlace(e){return this.x*=e,this.y*=e,this}asArray(){return[this.x,this.y]}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this}toString(){return`{X: ${this.x} Y: ${this.y}}`}fract(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}multiplyByFloats(t,i){return new e(this.x*t,this.y*i)}static LerpToRef(e,t,i,a){return a.x=e.x+(t.x-e.x)*i,a.y=e.y+(t.y-e.y)*i,a}minimizeInPlaceFromFloats(e,t){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this}static Clamp(t,i,a){const n=Clamp(t.x,i.x,a.x),s=Clamp(t.y,i.y,a.y);return new e(n,s)}addInPlace(e){return this.x+=e.x,this.y+=e.y,this}static Hermite1stDerivative(t,i,a,n,s){return this.Hermite1stDerivativeToRef(t,i,a,n,s,new e)}static Dot(e,t){return e.x*t.x+e.y*t.y}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.x,e.y)}dot(e){return this.x*e.x+this.y*e.y}static FromArray(t,i=0){return new e(t[i],t[i+1])}static One(){return new e(1,1)}addInPlaceFromFloats(e,t){return this.x+=e,this.y+=t,this}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.x,e.y)}static Maximize(t,i){const a=t.x>i.x?t.x:i.x,n=t.y>i.y?t.y:i.y;return new e(a,n)}static get ZeroReadOnly(){return e._ZeroReadOnly}rotateToRef(e,t){const i=Math.cos(e),a=Math.sin(e),n=i*this.x-a*this.y,s=a*this.x+i*this.y;return t.x=n,t.y=s,t}subtract(t){return new e(this.x-t.x,this.y-t.y)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t}static Lerp(t,i,a){return e.LerpToRef(t,i,a,new e)}floor(){return new e(Math.floor(this.x),Math.floor(this.y))}static ClampToRef(e,t,i,a){return a.x=Clamp(e.x,t.x,i.x),a.y=Clamp(e.y,t.y,i.y),a}equalsWithEpsilon(e,t=Epsilon){return e&&WithinEpsilon(this.x,e.x,t)&&WithinEpsilon(this.y,e.y,t)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t}normalizeToRef(e){const t=this.length();return 0===t&&(e.x=this.x,e.y=this.y),this.scaleToRef(1/t,e)}static CatmullRom(t,i,a,n,s){const r=s*s,o=s*r,l=.5*(2*i.x+(-t.x+a.x)*s+(2*t.x-5*i.x+4*a.x-n.x)*r+(-t.x+3*i.x-3*a.x+n.x)*o),c=.5*(2*i.y+(-t.y+a.y)*s+(2*t.y-5*i.y+4*a.y-n.y)*r+(-t.y+3*i.y-3*a.y+n.y)*o);return new e(l,c)}};Vector2._ZeroReadOnly=Vector2.Zero(),Object.defineProperties(Vector2.prototype,{dimension:{value:[2]},rank:{value:1}});var Vector3=class e{addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._isDirty=!0,this}static FromArray(t,i=0){return new e(t[i],t[i+1],t[i+2])}static TransformNormalFromFloatsToRef(e,t,i,a,n){const s=a.m;return n._x=e*s[0]+t*s[4]+i*s[8],n._y=e*s[1]+t*s[5]+i*s[9],n._z=e*s[2]+t*s[6]+i*s[10],n._isDirty=!0,n}floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}get x(){return this._x}static get UpReadOnly(){return e._UpReadOnly}applyRotationQuaternionToRef(e,t){const i=this._x,a=this._y,n=this._z,s=e._x,r=e._y,o=e._z,l=e._w,c=2*(r*n-o*a),h=2*(o*i-s*n),u=2*(s*a-r*i);return t._x=i+l*c+r*u-o*h,t._y=a+l*h+o*c-s*u,t._z=n+l*u+s*h-r*c,t._isDirty=!0,t}equalsToFloats(e,t,i){return this._x===e&&this._y===t&&this._z===i}static Reflect(t,i){return this.ReflectToRef(t,i,new e)}getNormalToRef(e){const t=this.length();let i=Math.acos(this.y/t);const a=Math.atan2(this.z,this.x);i>Math.PI/2?i-=Math.PI/2:i+=Math.PI/2;const n=t*Math.sin(i)*Math.cos(a),s=t*Math.cos(i),r=t*Math.sin(i)*Math.sin(a);return e.set(n,s,r),e}get isNonUniform(){const e=Math.abs(this._x);if(e!==Math.abs(this._y))return!0;return e!==Math.abs(this._z)}static GetAngleBetweenVectors(t,i,a){const n=t.normalizeToRef(MathTmp.Vector3[1]),s=i.normalizeToRef(MathTmp.Vector3[2]);let r=e.Dot(n,s);r=Clamp(r,-1,1);const o=Math.acos(r),l=MathTmp.Vector3[3];return e.CrossToRef(n,s,l),e.Dot(l,a)>0?isNaN(o)?0:o:isNaN(o)?-Math.PI:-Math.acos(r)}static Down(){return new e(0,-1,0)}reorderInPlace(e){if("xyz"===(e=e.toLowerCase()))return this;const t=MathTmp.Vector3[0].copyFrom(this);return this.x=t[e[0]],this.y=t[e[1]],this.z=t[e[2]],this}fractToRef(e){return e._x=this.x-Math.floor(this._x),e._y=this.y-Math.floor(this._y),e._z=this.z-Math.floor(this._z),e._isDirty=!0,e}static RotationFromAxis(t,i,a){const n=new e;return e.RotationFromAxisToRef(t,i,a,n),n}applyRotationQuaternion(t){return this.applyRotationQuaternionToRef(t,new e)}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this}static Distance(t,i){return Math.sqrt(e.DistanceSquared(t,i))}setAll(e){return this._x=this._y=this._z=e,this._isDirty=!0,this}static Hermite1stDerivativeToRef(e,t,i,a,n,s){const r=n*n;return s._x=6*(r-n)*e._x+(3*r-4*n+1)*t._x+6*(-r+n)*i._x+(3*r-2*n)*a._x,s._y=6*(r-n)*e._y+(3*r-4*n+1)*t._y+6*(-r+n)*i._y+(3*r-2*n)*a._y,s._z=6*(r-n)*e._z+(3*r-4*n+1)*t._z+6*(-r+n)*i._z+(3*r-2*n)*a._z,s._isDirty=!0,s}static GetClipFactor(t,i,a,n){const s=e.Dot(t,a);return(s-n)/(s-e.Dot(i,a))}static Up(){return new e(0,1,0)}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._isDirty=!0,i}static DistanceSquared(e,t){const i=e._x-t._x,a=e._y-t._y,n=e._z-t._z;return i*i+a*a+n*n}multiplyToRef(e,t){return t._x=this._x*e._x,t._y=this._y*e._y,t._z=this._z*e._z,t._isDirty=!0,t}static Hermite1stDerivative(t,i,a,n,s){const r=new e;return this.Hermite1stDerivativeToRef(t,i,a,n,s,r),r}static Normalize(t){const i=e.Zero();return e.NormalizeToRef(t,i),i}multiply(e){return this.multiplyByFloats(e._x,e._y,e._z)}static get LeftHandedBackwardReadOnly(){return e._LeftHandedBackwardReadOnly}rotateByQuaternionToRef(t,i){return t.toRotationMatrix(MathTmp.Matrix[0]),e.TransformCoordinatesToRef(this,MathTmp.Matrix[0],i),i}static TransformCoordinates(t,i){const a=e.Zero();return e.TransformCoordinatesToRef(t,i,a),a}static CatmullRom(t,i,a,n,s){const r=s*s,o=s*r,l=.5*(2*i._x+(-t._x+a._x)*s+(2*t._x-5*i._x+4*a._x-n._x)*r+(-t._x+3*i._x-3*a._x+n._x)*o),c=.5*(2*i._y+(-t._y+a._y)*s+(2*t._y-5*i._y+4*a._y-n._y)*r+(-t._y+3*i._y-3*a._y+n._y)*o),h=.5*(2*i._z+(-t._z+a._z)*s+(2*t._z-5*i._z+4*a._z-n._z)*r+(-t._z+3*i._z-3*a._z+n._z)*o);return new e(l,c,h)}static LerpToRef(e,t,i,a){return a._x=e._x+(t._x-e._x)*i,a._y=e._y+(t._y-e._y)*i,a._z=e._z+(t._z-e._z)*i,a._isDirty=!0,a}set(e,t,i){return this.copyFromFloats(e,t,i)}minimizeInPlaceFromFloats(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this}static Clamp(t,i,a){const n=new e;return e.ClampToRef(t,i,a,n),n}normalize(){return this.normalizeFromLength(this.length())}static get RightReadOnly(){return e._RightReadOnly}toQuaternion(){return Quaternion.Kc(this._y,this._x,this._z)}static UnprojectFromTransform(e,t,i,a,n){return this.Unproject(e,t,i,a,n,Matrix.IdentityReadOnly)}static TransformNormalToRef(e,t,i){return this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i),i}projectOnPlaneToRef(t,i,a){const n=t.normal,s=t.d,r=MathTmp.Vector3[0];this.subtractToRef(i,r),r.normalize();const o=e.Dot(r,n);if(Math.abs(o)<1e-10)a.setAll(1/0);else{const t=-(e.Dot(i,n)+s)/o,l=r.scaleInPlace(t);i.addToRef(l,a)}return a}negate(){return new e(-this._x,-this._y,-this._z)}static Forward(t=!1){return new e(0,0,t?-1:1)}static Center(t,i){return e.CenterToRef(t,i,e.Zero())}multiplyByFloats(t,i,a){return new e(this._x*t,this._y*i,this._z*a)}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._isDirty=!0,this}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._isDirty=!0,t}static _UnprojectFromInvertedMatrixToRef(t,i,a){e.TransformCoordinatesToRef(t,i,a);const n=i.m,s=t._x*n[3]+t._y*n[7]+t._z*n[11]+n[15];return WithinEpsilon(s,1)&&a.scaleInPlace(1/s),a}static get RightHandedBackwardReadOnly(){return e._RightHandedBackwardReadOnly}static CenterToRef(e,t,i){return i.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)}static Backward(t=!1){return new e(0,0,t?1:-1)}static Hermite(t,i,a,n,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,u=o-r,m=t._x*l+a._x*c+i._x*h+n._x*u,d=t._y*l+a._y*c+i._y*h+n._y*u,f=t._z*l+a._z*c+i._z*h+n._z*u;return new e(m,d,f)}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}normalizeToNew(){return this.normalizeToRef(new e)}subtractFromFloats(t,i,a){return new e(this._x-t,this._y-i,this._z-a)}static Zero(){return new e(0,0,0)}static FromFloatArrayToRef(t,i,a){return e.FromArrayToRef(t,i,a)}static get LeftHandedForwardReadOnly(){return e._LeftHandedForwardReadOnly}subtractToRef(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)}rotateByQuaternionAroundPointToRef(e,t,i){return this.subtractToRef(t,MathTmp.Vector3[0]),MathTmp.Vector3[0].rotateByQuaternionToRef(e,MathTmp.Vector3[0]),t.addToRef(MathTmp.Vector3[0],i),i}static Lerp(t,i,a){const n=new e(0,0,0);return e.LerpToRef(t,i,a,n),n}static ProjectOnTriangleToRef(t,i,a,n,s){const r=MathTmp.Vector3[0],o=MathTmp.Vector3[1],l=MathTmp.Vector3[2],c=MathTmp.Vector3[3],h=MathTmp.Vector3[4];a.subtractToRef(i,r),n.subtractToRef(i,o),n.subtractToRef(a,l);const u=r.length(),m=o.length(),d=l.length();if(u<Epsilon||m<Epsilon||d<Epsilon)return s.copyFrom(i),e.Distance(t,i);t.subtractToRef(i,h),e.CrossToRef(r,o,c);const f=c.length();if(f<Epsilon)return s.copyFrom(i),e.Distance(t,i);c.normalizeFromLength(f);let p=h.length();if(p<Epsilon)return s.copyFrom(i),0;h.normalizeFromLength(p);const _=e.Dot(c,h),g=MathTmp.Vector3[5],v=MathTmp.Vector3[6];g.copyFrom(c).scaleInPlace(-p*_),v.copyFrom(t).addInPlace(g);const y=MathTmp.Vector3[4],S=MathTmp.Vector3[5],C=MathTmp.Vector3[7],E=MathTmp.Vector3[8];y.copyFrom(r).scaleInPlace(1/u),E.copyFrom(o).scaleInPlace(1/m),y.addInPlace(E).scaleInPlace(-1),S.copyFrom(r).scaleInPlace(-1/u),E.copyFrom(l).scaleInPlace(1/d),S.addInPlace(E).scaleInPlace(-1),C.copyFrom(l).scaleInPlace(-1/d),E.copyFrom(o).scaleInPlace(-1/m),C.addInPlace(E).scaleInPlace(-1);const A=MathTmp.Vector3[9];let T;A.copyFrom(v).subtractInPlace(i),e.CrossToRef(y,A,E),T=e.Dot(E,c);const M=T;A.copyFrom(v).subtractInPlace(a),e.CrossToRef(S,A,E),T=e.Dot(E,c);const x=T;A.copyFrom(v).subtractInPlace(n),e.CrossToRef(C,A,E),T=e.Dot(E,c);const b=T,w=MathTmp.Vector3[10];let I,P;M>0&&x<0?(w.copyFrom(r),I=i,P=a):x>0&&b<0?(w.copyFrom(l),I=a,P=n):(w.copyFrom(o).scaleInPlace(-1),I=n,P=i);const R=MathTmp.Vector3[9],N=MathTmp.Vector3[4];I.subtractToRef(v,E),P.subtractToRef(v,R),e.CrossToRef(E,R,N);if(!(e.Dot(N,c)<0))return s.copyFrom(v),Math.abs(p*_);const k=MathTmp.Vector3[5];e.CrossToRef(w,N,k),k.normalize();const D=MathTmp.Vector3[9];D.copyFrom(I).subtractInPlace(v);const B=D.length();if(B<Epsilon)return s.copyFrom(I),e.Distance(t,I);D.normalizeFromLength(B);const F=e.Dot(k,D),L=MathTmp.Vector3[7];L.copyFrom(v).addInPlace(k.scaleInPlace(B*F)),E.copyFrom(L).subtractInPlace(I),p=w.length(),w.normalizeFromLength(p);let O=e.Dot(E,w)/Math.max(p,Epsilon);return O=Clamp(O,0,1),L.copyFrom(I).addInPlace(w.scaleInPlace(O*p)),s.copyFrom(L),e.Distance(t,L)}static ProjectToRef(t,i,a,n,s){const r=n.width,o=n.height,l=n.x,c=n.y,h=MathTmp.Matrix[1],u=EngineStore.LastCreatedEngine?.isNDCHalfZRange,m=u?1:.5,d=u?0:.5;Matrix.FromValuesToRef(r/2,0,0,0,0,-o/2,0,0,0,0,m,0,l+r/2,o/2+c,d,1,h);const f=MathTmp.Matrix[0];return i.multiplyToRef(a,f),f.multiplyToRef(h,f),e.TransformCoordinatesToRef(t,f,s),s}static ClampToRef(e,t,i,a){let n=e._x;n=n>i._x?i._x:n,n=n<t._x?t._x:n;let s=e._y;s=s>i._y?i._y:s,s=s<t._y?t._y:s;let r=e._z;return r=r>i._z?i._z:r,r=r<t._z?t._z:r,a.copyFromFloats(n,s,r),a}set y(e){this._y=e,this._isDirty=!0}static get DownReadOnly(){return e._DownReadOnly}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)}static RotationFromAxisToRef(e,t,i,a){const n=MathTmp.Cc[0];return Quaternion.RotationQuaternionFromAxisToRef(e,t,i,n),n.toEulerAnglesToRef(a),a}static TransformNormal(t,i){const a=e.Zero();return e.TransformNormalToRef(t,i,a),a}static UnprojectToRef(t,i,a,n,s,r,o){return e.UnprojectFloatsToRef(t._x,t._y,t._z,i,a,n,s,r,o),o}add(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z)}static Unproject(t,i,a,n,s,r){const o=new e;return e.UnprojectToRef(t,i,a,n,s,r,o),o}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._isDirty=!0,this}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._isDirty=!0,t}static Right(){return new e(1,0,0)}divide(t){return new e(this._x/t._x,this._y/t._y,this._z/t._z)}static Cross(t,i){const a=new e;return e.CrossToRef(t,i,a),a}static get ZeroReadOnly(){return e._ZeroReadOnly}static Project(t,i,a,n){const s=new e;return e.ProjectToRef(t,i,a,n,s),s}subtractFromFloatsToRef(e,t,i,a){return a._x=this._x-e,a._y=this._y-t,a._z=this._z-i,a._isDirty=!0,a}equalsWithEpsilon(e,t=Epsilon){return e&&WithinEpsilon(this._x,e._x,t)&&WithinEpsilon(this._y,e._y,t)&&WithinEpsilon(this._z,e._z,t)}set z(e){this._z=e,this._isDirty=!0}normalizeToRef(e){const t=this.length();return 0===t||1===t?(e._x=this._x,e._y=this._y,e._z=this._z,e._isDirty=!0,e):this.scaleToRef(1/t,e)}getClassName(){return"Vector3"}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)}copyFrom(e){return this.copyFromFloats(e._x,e._y,e._z)}static FromFloatsToRef(e,t,i,a){return a.copyFromFloats(e,t,i),a}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(RandomRange(e,t),RandomRange(e,t),RandomRange(e,t))}static TransformCoordinatesFromFloatsToRef(e,t,i,a,n){const s=a.m,r=e*s[0]+t*s[4]+i*s[8]+s[12],o=e*s[1]+t*s[5]+i*s[9]+s[13],l=e*s[2]+t*s[6]+i*s[10]+s[14],c=1/(e*s[3]+t*s[7]+i*s[11]+s[15]);return n._x=r*c,n._y=o*c,n._z=l*c,n._isDirty=!0,n}get z(){return this._z}static UnprojectFloatsToRef(t,i,a,n,s,r,o,l,c){const h=MathTmp.Matrix[0];r.multiplyToRef(o,h),h.multiplyToRef(l,h),h.invert();const u=MathTmp.Vector3[0];return u.x=t/n*2-1,u.y=-(i/s*2-1),EngineStore.LastCreatedEngine?.isNDCHalfZRange?u.z=a:u.z=2*a-1,e._UnprojectFromInvertedMatrixToRef(u,h,c),c}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}isNonUniformWithinEpsilon(e){const t=Math.abs(this._x),i=Math.abs(this._y);if(!WithinEpsilon(t,i,e))return!0;const a=Math.abs(this._z);return!WithinEpsilon(t,a,e)||!WithinEpsilon(i,a,e)}constructor(e=0,t=0,i=0){this._isDirty=!0,this._x=e,this._y=t,this._z=i}static Random(t=0,i=1){return new e(RandomRange(t,i),RandomRange(t,i),RandomRange(t,i))}static Minimize(t,i){const a=new e;return a.copyFrom(t),a.minimizeInPlace(i),a}addInPlaceFromFloats(e,t,i){return this._x+=e,this._y+=t,this._z+=i,this._isDirty=!0,this}divideInPlace(e){return this._x=this._x/e._x,this._y=this._y/e._y,this._z=this._z/e._z,this._isDirty=!0,this}static FromFloatArray(t,i){return e.FromArray(t,i)}static PitchYawRollToMoveBetweenPoints(t,i){const a=e.Zero();return e.PitchYawRollToMoveBetweenPointsToRef(t,i,a)}getHashCode(){let e=_ExtractAsInt(this._x);return e=397*e^_ExtractAsInt(this._y),e=397*e^_ExtractAsInt(this._z),e}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._isDirty=!0,t}fract(){return new e(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}scale(t){return new e(this._x*t,this._y*t,this._z*t)}static get RightHandedForwardReadOnly(){return e._RightHandedForwardReadOnly}static Left(){return new e(-1,0,0)}static Maximize(t,i){const a=new e;return a.copyFrom(t),a.maximizeInPlace(i),a}static GetAngleBetweenVectorsOnPlane(t,i,a){MathTmp.Vector3[0].copyFrom(t);const n=MathTmp.Vector3[0];MathTmp.Vector3[1].copyFrom(i);const s=MathTmp.Vector3[1];MathTmp.Vector3[2].copyFrom(a);const r=MathTmp.Vector3[2],o=MathTmp.Vector3[3],l=MathTmp.Vector3[4];n.normalize(),s.normalize(),r.normalize(),e.CrossToRef(r,n,o),e.CrossToRef(o,r,l);return NormalizeRadians(Math.atan2(e.Dot(s,o),e.Dot(s,l)))}static TransformCoordinatesToRef(t,i,a){return e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,i,a),a}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z}clone(){return new e(this._x,this._y,this._z)}divideToRef(e,t){return t._x=this._x/e._x,t._y=this._y/e._y,t._z=this._z/e._z,t._isDirty=!0,t}static get LeftReadOnly(){return e._LeftReadOnly}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}projectOnPlane(t,i){return this.projectOnPlaneToRef(t,i,new e)}multiplyInPlace(e){return this._x*=e._x,this._y*=e._y,this._z*=e._z,this._isDirty=!0,this}copyFromFloats(e,t,i){return this._x=e,this._y=t,this._z=i,this._isDirty=!0,this}fromArray(t,i=0){return e.FromArrayToRef(t,i,this),this}get hasAZeroComponent(){return this._x*this._y*this._z==0}subtract(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}set x(e){this._x=e,this._isDirty=!0}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z}static SlerpToRef(t,i,a,n){a=Clamp(a,0,1);const s=MathTmp.Vector3[0],r=MathTmp.Vector3[1];s.copyFrom(t);const o=s.length();s.normalizeFromLength(o),r.copyFrom(i);const l=r.length();r.normalizeFromLength(l);const c=e.Dot(s,r);let h,u;if(c<1-Epsilon){const e=Math.acos(c),t=1/Math.sin(e);h=Math.sin((1-a)*e)*t,u=Math.sin(a*e)*t}else h=1-a,u=a;return s.scaleInPlace(h),r.scaleInPlace(u),n.copyFrom(s).addInPlace(r),n.scaleInPlace(Lerp(o,l,a)),n}cross(t){return e.CrossToRef(this,t,new e)}get y(){return this._y}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}static SmoothToRef(t,i,a,n,s){return e.SlerpToRef(t,i,0===n?1:a/n,s),s}negateToRef(e){return e._x=-1*this._x,e._y=-1*this._y,e._z=-1*this._z,e._isDirty=!0,e}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static get OneReadOnly(){return e._OneReadOnly}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z}asArray(){return[this._x,this._y,this._z]}maximizeInPlaceFromFloats(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this}static PitchYawRollToMoveBetweenPointsToRef(e,t,i){const a=TmpVectors.Vector3[0];return t.subtractToRef(e,a),i._y=Math.atan2(a.x,a.z)||0,i._x=Math.atan2(Math.sqrt(a.x**2+a.z**2),a.y)||0,i._z=0,i._isDirty=!0,i}floorToRef(e){return e._x=Math.floor(this._x),e._y=Math.floor(this._y),e._z=Math.floor(this._z),e._isDirty=!0,e}static CrossToRef(e,t,i){const a=e._y*t._z-e._z*t._y,n=e._z*t._x-e._x*t._z,s=e._x*t._y-e._y*t._x;return i.copyFromFloats(a,n,s),i}static One(){return new e(1,1,1)}applyRotationQuaternionInPlace(e){return this.applyRotationQuaternionToRef(e,this)}static ReflectToRef(t,i,a){const n=TmpVectors.Vector3[0];return n.copyFrom(i).scaleInPlace(2*e.Dot(t,i)),a.copyFrom(t).subtractInPlace(n)}};Vector3._UpReadOnly=Vector3.Up(),Vector3._DownReadOnly=Vector3.Down(),Vector3._LeftHandedForwardReadOnly=Vector3.Forward(!1),Vector3._RightHandedForwardReadOnly=Vector3.Forward(!0),Vector3._LeftHandedBackwardReadOnly=Vector3.Backward(!1),Vector3._RightHandedBackwardReadOnly=Vector3.Backward(!0),Vector3._RightReadOnly=Vector3.Right(),Vector3._LeftReadOnly=Vector3.Left(),Vector3._ZeroReadOnly=Vector3.Zero(),Vector3._OneReadOnly=Vector3.One(),Object.defineProperties(Vector3.prototype,{dimension:{value:[3]},rank:{value:1}});var Vector4=class e{static Clamp(t,i,a){return e.ClampToRef(t,i,a,new e)}subtract(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}asArray(){return[this.x,this.y,this.z,this.w]}static DistanceSquared(e,t){const i=e.x-t.x,a=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return i*i+a*a+n*n+s*s}static ClampToRef(e,t,i,a){return a.x=Clamp(e.x,t.x,i.x),a.y=Clamp(e.y,t.y,i.y),a.z=Clamp(e.z,t.z,i.z),a.w=Clamp(e.w,t.w,i.w),a}set(e,t,i,a){return this.copyFromFloats(e,t,i,a)}static Dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}equalsToFloats(e,t,i,a){return this.x===e&&this.y===t&&this.z===i&&this.w===a}subtractFromFloats(t,i,a,n){return new e(this.x-t,this.y-i,this.z-a,this.w-n)}static get ZeroReadOnly(){return e._ZeroReadOnly}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}static TransformNormalToRef(e,t,i){const a=t.m,n=e.x*a[0]+e.y*a[4]+e.z*a[8],s=e.x*a[1]+e.y*a[5]+e.z*a[9],r=e.x*a[2]+e.y*a[6]+e.z*a[10];return i.x=n,i.y=s,i.z=r,i.w=e.w,i}normalize(){return this.normalizeFromLength(this.length())}static FromArray(t,i){return i||(i=0),new e(t[i],t[i+1],t[i+2],t[i+3])}clone(){return new e(this.x,this.y,this.z,this.w)}static Normalize(t){return e.NormalizeToRef(t,new e)}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}equalsWithEpsilon(e,t=Epsilon){return e&&WithinEpsilon(this.x,e.x,t)&&WithinEpsilon(this.y,e.y,t)&&WithinEpsilon(this.z,e.z,t)&&WithinEpsilon(this.w,e.w,t)}multiplyByFloats(t,i,a,n){return new e(this.x*t,this.y*i,this.z*a,this.w*n)}copyFromFloats(e,t,i,a){return this.x=e,this.y=t,this.z=i,this.w=a,this}maximizeInPlace(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,t}floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}add(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}equals(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}addInPlace(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}constructor(e=0,t=0,i=0,a=0){this.x=e,this.y=t,this.z=i,this.w=a}scaleInPlace(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}fract(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}negate(){return new e(-this.x,-this.y,-this.z,-this.w)}static TransformCoordinates(t,i){return e.TransformCoordinatesToRef(t,i,new e)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}scale(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)}static Maximize(t,i){const a=new e;return a.copyFrom(t),a.maximizeInPlace(i),a}static TransformNormalFromFloatsToRef(e,t,i,a,n,s){const r=n.m;return s.x=e*r[0]+t*r[4]+i*r[8],s.y=e*r[1]+t*r[5]+i*r[9],s.z=e*r[2]+t*r[6]+i*r[10],s.w=a,s}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,t}static FromFloatsToRef(e,t,i,a,n){return n.x=e,n.y=t,n.z=i,n.w=a,n}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,t}minimizeInPlace(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3],i}getHashCode(){let e=_ExtractAsInt(this.x);return e=397*e^_ExtractAsInt(this.y),e=397*e^_ExtractAsInt(this.z),e=397*e^_ExtractAsInt(this.w),e}static FromVector3(t,i=0){return new e(t._x,t._y,t._z,i)}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static Zero(){return new e(0,0,0,0)}static Distance(t,i){return Math.sqrt(e.DistanceSquared(t,i))}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}divide(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)}static CenterToRef(e,t,i){return i.x=(e.x+t.x)/2,i.y=(e.y+t.y)/2,i.z=(e.z+t.z)/2,i.w=(e.w+t.w)/2,i}toArray(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}setAll(e){return this.x=this.y=this.z=this.w=e,this}normalizeToNew(){return this.normalizeToRef(new e)}static TransformCoordinatesFromFloatsToRef(e,t,i,a,n){const s=a.m,r=e*s[0]+t*s[4]+i*s[8]+s[12],o=e*s[1]+t*s[5]+i*s[9]+s[13],l=e*s[2]+t*s[6]+i*s[10]+s[14],c=e*s[3]+t*s[7]+i*s[11]+s[15];return n.x=r,n.y=o,n.z=l,n.w=c,n}static Random(t=0,i=1){return new e(RandomRange(t,i),RandomRange(t,i),RandomRange(t,i),RandomRange(t,i))}multiply(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}static RandomToRef(e=0,t=1,i){return i.x=RandomRange(e,t),i.y=RandomRange(e,t),i.z=RandomRange(e,t),i.w=RandomRange(e,t),i}divideInPlace(e){return this.divideToRef(e,this)}addInPlaceFromFloats(e,t,i,a){return this.x+=e,this.y+=t,this.z+=i,this.w+=a,this}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e.z=Math.floor(this.z),e.w=Math.floor(this.w),e}static Center(t,i){return e.CenterToRef(t,i,new e)}subtractFromFloatsToRef(e,t,i,a,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-i,n.w=this.w-a,n}maximizeInPlaceFromFloats(e,t,i,a){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this.z=Math.max(i,this.z),this.w=Math.max(a,this.w),this}toVector3(){return new Vector3(this.x,this.y,this.z)}static One(){return new e(1,1,1,1)}normalizeToRef(e){const t=this.length();return 0===t||1===t?(e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e):this.scaleToRef(1/t,e)}getClassName(){return"Vector4"}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,t}fromArray(t,i=0){return e.FromArrayToRef(t,i,this),this}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e.z=this.z-Math.floor(this.z),e.w=this.w-Math.floor(this.w),e}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,t}negateToRef(e){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=-this.w,e}static TransformNormal(t,i){return e.TransformNormalToRef(t,i,new e)}static Minimize(t,i){const a=new e;return a.copyFrom(t),a.minimizeInPlace(i),a}static TransformCoordinatesToRef(t,i,a){return e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,i,a),a}minimizeInPlaceFromFloats(e,t,i,a){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this.z=Math.min(i,this.z),this.w=Math.min(a,this.w),this}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,t}static FromFloatArrayToRef(t,i,a){return e.FromArrayToRef(t,i,a),a}};Vector4._ZeroReadOnly=Vector4.Zero(),Object.defineProperties(Vector4.prototype,{dimension:{value:[4]},rank:{value:1}});var Quaternion=class e{floorToRef(e){throw new ReferenceError("Can not floor a quaternion")}get z(){return this._z}conjugate(){return new e(-this._x,-this._y,-this._z,this._w)}static Kc(t,i,a){const n=new e;return e.RotationYawPitchRollToRef(t,i,a,n),n}subtractToRef(e,t){return t._x=this._x-e._x,t._y=this._y-e._y,t._z=this._z-e._z,t._w=this._w-e._w,t._isDirty=!0,t}static FromRotationMatrixToRef(e,t){const i=e.m,a=i[0],n=i[4],s=i[8],r=i[1],o=i[5],l=i[9],c=i[2],h=i[6],u=i[10],m=a+o+u;let d;return m>0?(d=.5/Math.sqrt(m+1),t._w=.25/d,t._x=(h-l)*d,t._y=(s-c)*d,t._z=(r-n)*d,t._isDirty=!0):a>o&&a>u?(d=2*Math.sqrt(1+a-o-u),t._w=(h-l)/d,t._x=.25*d,t._y=(n+r)/d,t._z=(s+c)/d,t._isDirty=!0):o>u?(d=2*Math.sqrt(1+o-a-u),t._w=(s-c)/d,t._x=(n+r)/d,t._y=.25*d,t._z=(l+h)/d,t._isDirty=!0):(d=2*Math.sqrt(1+u-a-o),t._w=(r-n)/d,t._x=(s+c)/d,t._y=(l+h)/d,t._z=.25*d,t._isDirty=!0),t}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._w+=this._w*e,t._isDirty=!0,t}multiply(t){const i=new e(0,0,0,1);return this.multiplyToRef(t,i),i}static Distance(t,i){return Math.sqrt(e.DistanceSquared(t,i))}static SlerpToRef(e,t,i,a){let n,s,r=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,o=!1;if(r<0&&(o=!0,r=-r),r>.999999)s=1-i,n=o?-i:i;else{const e=Math.acos(r),t=1/Math.sin(e);s=Math.sin((1-i)*e)*t,n=o?-Math.sin(i*e)*t:Math.sin(i*e)*t}return a._x=s*e._x+n*t._x,a._y=s*e._y+n*t._y,a._z=s*e._z+n*t._z,a._w=s*e._w+n*t._w,a._isDirty=!0,a}multiplyInPlace(e){return this.multiplyToRef(e,this)}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,this}static Zero(){return new e(0,0,0,0)}static RotationAlphaBetaGammaToRef(e,t,i,a){const n=.5*(i+e),s=.5*(i-e),r=.5*t;return a._x=Math.cos(s)*Math.sin(r),a._y=Math.sin(s)*Math.sin(r),a._z=Math.sin(n)*Math.cos(r),a._w=Math.cos(n)*Math.cos(r),a._isDirty=!0,a}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}set z(e){this._z=e,this._isDirty=!0}toRotationMatrix(e){return Matrix.FromQuaternionToRef(this,e),e}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w}getHashCode(){let e=_ExtractAsInt(this._x);return e=397*e^_ExtractAsInt(this._y),e=397*e^_ExtractAsInt(this._z),e=397*e^_ExtractAsInt(this._w),e}get y(){return this._y}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._w=this._w*e,t._isDirty=!0,t}static FromEulerVectorToRef(t,i){return e.RotationYawPitchRollToRef(t._y,t._x,t._z,i),i}invert(){const e=this.conjugate(),t=this.lengthSquared();return 0==t||1==t||e.scaleInPlace(1/t),e}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}fractToRef(e){throw new ReferenceError("Can not fract a quaternion")}static AreClose(t,i,a=.1){const n=e.Dot(t,i);return 1-n*n<=a}static RotationYawPitchRollToRef(e,t,i,a){const n=.5*i,s=.5*t,r=.5*e,o=Math.sin(n),l=Math.cos(n),c=Math.sin(s),h=Math.cos(s),u=Math.sin(r),m=Math.cos(r);return a._x=m*c*l+u*h*o,a._y=u*h*l-m*c*o,a._z=m*h*o-u*c*l,a._w=m*h*l+u*c*o,a._isDirty=!0,a}static FromEulerVector(t){const i=new e;return e.RotationYawPitchRollToRef(t._y,t._x,t._z,i),i}static FromLookDirectionLHToRef(t,i,a){const n=MathTmp.Matrix[0];return Matrix.LookDirectionLHToRef(t,i,n),e.FromRotationMatrixToRef(n,a),a}floor(){throw new ReferenceError("Can not floor a quaternion")}static RotationQuaternionFromAxisToRef(t,i,a,n){const s=MathTmp.Matrix[0];return t=t.normalizeToRef(MathTmp.Vector3[0]),i=i.normalizeToRef(MathTmp.Vector3[1]),a=a.normalizeToRef(MathTmp.Vector3[2]),Matrix.FromXYZAxesToRef(t,i,a,s),e.FromRotationMatrixToRef(s,n),n}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}getClassName(){return"Quaternion"}equalsToFloats(e,t,i,a){return this._x===e&&this._y===t&&this._z===i&&this._w===a}clone(){return new e(this._x,this._y,this._z,this._w)}equalsWithEpsilon(e,t=Epsilon){return e&&WithinEpsilon(this._x,e._x,t)&&WithinEpsilon(this._y,e._y,t)&&WithinEpsilon(this._z,e._z,t)&&WithinEpsilon(this._w,e._w,t)}fract(){throw new ReferenceError("Can not fract a quaternion")}get x(){return this._x}negate(){return this.negateToRef(new e)}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}static FromEulerAngles(t,i,a){const n=new e;return e.RotationYawPitchRollToRef(i,t,a,n),n}static Center(t,i){return e.CenterToRef(t,i,e.Zero())}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}divideInPlace(e){throw new ReferenceError("Can not divide a quaternion")}subtractFromFloatsToRef(e,t,i,a,n){return n._x=this._x-e,n._y=this._y-t,n._z=this._z-i,n._w=this._w-a,n._isDirty=!0,n}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w}toAlphaBetaGammaToRef(e){const t=this._z,i=this._x,a=this._y,n=this._w,s=Math.sqrt(i*i+a*a),r=Math.sqrt(t*t+n*n),o=2*Math.atan2(s,r),l=2*Math.atan2(t,n),c=2*Math.atan2(a,i),h=(l+c)/2,u=(l-c)/2;return e.set(u,o,h),e}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}set y(e){this._y=e,this._isDirty=!0}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._w*=e,this._isDirty=!0,this}copyFromFloats(e,t,i,a){return this._x=e,this._y=t,this._z=i,this._w=a,this._isDirty=!0,this}fromRotationMatrix(t){return e.FromRotationMatrixToRef(t,this),this}divide(e){throw new ReferenceError("Can not divide a quaternion")}static IsIdentity(e){return e&&0===e._x&&0===e._y&&0===e._z&&1===e._w}copyFrom(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._isDirty=!0,this}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}normalizeToRef(e){const t=this.length();return 0===t||1===t?e.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/t,e)}multiplyToRef(e,t){const i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,a=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,n=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,s=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,a,n,s),t}subtract(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)}static Inverse(t){return new e(-t._x,-t._y,-t._z,t._w)}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._w=e[t+3],i._isDirty=!0,i}static FromEulerAnglesToRef(t,i,a,n){return e.RotationYawPitchRollToRef(i,t,a,n),n}multiplyByFloats(e,t,i,a){return this._x*=e,this._y*=t,this._z*=i,this._w*=a,this._isDirty=!0,this}set w(e){this._w=e,this._isDirty=!0}scale(t){return new e(this._x*t,this._y*t,this._z*t,this._w*t)}toEulerAnglesToRef(e){const t=this._z,i=this._x,a=this._y,n=this._w,s=a*t-i*n,r=.4999999;if(s<-r)e._y=2*Math.atan2(a,n),e._x=Math.PI/2,e._z=0,e._isDirty=!0;else if(s>r)e._y=2*Math.atan2(a,n),e._x=-Math.PI/2,e._z=0,e._isDirty=!0;else{const r=n*n,o=t*t,l=i*i,c=a*a;e._z=Math.atan2(2*(i*a+t*n),-o-l+c+r),e._x=Math.asin(-2*s),e._y=Math.atan2(2*(t*i+a*n),o-l-c+r),e._isDirty=!0}return e}static DistanceSquared(e,t){const i=e.x-t.x,a=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return i*i+a*a+n*n+s*s}divideToRef(e,t){throw new ReferenceError("Can not divide a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}fromArray(t,i=0){return e.FromArrayToRef(t,i,this)}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)}static FromLookDirectionRH(t,i){const a=new e;return e.FromLookDirectionRHToRef(t,i,a),a}subtractFromFloats(t,i,a,n){return this.subtractFromFloatsToRef(t,i,a,n,new e)}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static FromUnitVectorsToRef(e,t,i,a=Epsilon){const n=Vector3.Dot(e,t)+1;return n<a?Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0,0):i.set(0,-e.z,e.y,0):(Vector3.CrossToRef(e,t,TmpVectors.Vector3[0]),i.set(TmpVectors.Vector3[0].x,TmpVectors.Vector3[0].y,TmpVectors.Vector3[0].z,n)),i.normalize()}static RotationQuaternionFromAxis(t,i,a){const n=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,i,a,n),n}static FromLookDirectionRHToRef(t,i,a){const n=MathTmp.Matrix[0];return Matrix.LookDirectionRHToRef(t,i,n),e.FromRotationMatrixToRef(n,a)}set(e,t,i,a){return this.copyFromFloats(e,t,i,a)}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(RandomRange(e,t),RandomRange(e,t),RandomRange(e,t),RandomRange(e,t))}add(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)}get w(){return this._w}static Hermite1stDerivativeToRef(e,t,i,a,n,s){const r=n*n;return s._x=6*(r-n)*e._x+(3*r-4*n+1)*t._x+6*(-r+n)*i._x+(3*r-2*n)*a._x,s._y=6*(r-n)*e._y+(3*r-4*n+1)*t._y+6*(-r+n)*i._y+(3*r-2*n)*a._y,s._z=6*(r-n)*e._z+(3*r-4*n+1)*t._z+6*(-r+n)*i._z+(3*r-2*n)*a._z,s._w=6*(r-n)*e._w+(3*r-4*n+1)*t._w+6*(-r+n)*i._w+(3*r-2*n)*a._w,s._isDirty=!0,s}setAll(e){return this.copyFromFloats(e,e,e,e)}static Hermite(t,i,a,n,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,u=o-r,m=t._x*l+a._x*c+i._x*h+n._x*u,d=t._y*l+a._y*c+i._y*h+n._y*u,f=t._z*l+a._z*c+i._z*h+n._z*u,p=t._w*l+a._w*c+i._w*h+n._w*u;return new e(m,d,f,p)}static Normalize(t){const i=e.Zero();return e.NormalizeToRef(t,i),i}static Clamp(t,i,a){const n=new e;return e.ClampToRef(t,i,a,n),n}addInPlaceFromFloats(e,t,i,a){return this._x+=e,this._y+=t,this._z+=i,this._w+=a,this._isDirty=!0,this}constructor(e=0,t=0,i=0,a=1){this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=a}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalizeToNew(){const t=new e(0,0,0,1);return this.normalizeToRef(t),t}static Hermite1stDerivative(t,i,a,n,s){const r=new e;return this.Hermite1stDerivativeToRef(t,i,a,n,s,r),r}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._w=this._w+e._w,t._isDirty=!0,t}static ClampToRef(e,t,i,a){return a.copyFromFloats(Clamp(e.x,t.x,i.x),Clamp(e.y,t.y,i.y),Clamp(e.z,t.z,i.z),Clamp(e.w,t.w,i.w))}static SmoothToRef(t,i,a,n,s){let r=0===n?1:a/n;return r=Clamp(r,0,1),e.SlerpToRef(t,i,r,s),s}static InverseToRef(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this._isDirty=!0,this}static Identity(){return new e(0,0,0,1)}asArray(){return[this._x,this._y,this._z,this._w]}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}static Random(t=0,i=1){return new e(RandomRange(t,i),RandomRange(t,i),RandomRange(t,i),RandomRange(t,i))}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}static RotationAxisToRef(e,t,i){i._w=Math.cos(t/2);const a=Math.sin(t/2)/e.length();return i._x=e._x*a,i._y=e._y*a,i._z=e._z*a,i._isDirty=!0,i}negateToRef(e){return e._x=-this._x,e._y=-this._y,e._z=-this._z,e._w=-this._w,e._isDirty=!0,e}static FromRotationMatrix(t){const i=new e;return e.FromRotationMatrixToRef(t,i),i}static FromLookDirectionLH(t,i){const a=new e;return e.FromLookDirectionLHToRef(t,i,a),a}static RotationAlphaBetaGamma(t,i,a){const n=new e;return e.RotationAlphaBetaGammaToRef(t,i,a,n),n}static FromArray(t,i){return i||(i=0),new e(t[i],t[i+1],t[i+2],t[i+3])}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this._isDirty=!0,this}invertInPlace(){this.conjugateInPlace();const e=this.lengthSquared();return 0==e||1==e||this.scaleInPlace(1/e),this}conjugateToRef(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),e}static FromFloatsToRef(e,t,i,a,n){return n.copyFromFloats(e,t,i,a),n}static RotationAxis(t,i){return e.RotationAxisToRef(t,i,new e)}static Slerp(t,i,a){const n=e.Identity();return e.SlerpToRef(t,i,a,n),n}length(){return Math.sqrt(this.lengthSquared())}set x(e){this._x=e,this._isDirty=!0}toEulerAngles(){const e=Vector3.Zero();return this.toEulerAnglesToRef(e),e}normalize(){return this.normalizeFromLength(this.length())}};Object.defineProperties(Quaternion.prototype,{dimension:{value:[4]},rank:{value:1}});var Matrix=class e{copyFrom(e){e.copyToArray(this._m);const t=e;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this}static OrthoOffCenterRH(t,i,a,n,s,r,o){const l=new e;return e.OrthoOffCenterRHToRef(t,i,a,n,s,r,l,o),l}multiplyByFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e[i];return this.markAsUpdated(),this}static PerspectiveFovRH(t,i,a,n,s,r=0,o=!1){const l=new e;return e.PerspectiveFovRHToRef(t,i,a,n,l,!0,s,r,o),l}static GetAsMatrix3x3(e){const t=e.m,i=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return PerformanceConfigurator.MatrixUse64Bits?i:new Float32Array(i)}negateToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=-t[e];return e.markAsUpdated(),e}static LookAtLHToRef(t,i,a,n){const s=MathTmp.Vector3[0],r=MathTmp.Vector3[1],o=MathTmp.Vector3[2];i.subtractToRef(t,o),o.normalize(),Vector3.CrossToRef(a,o,s);const l=s.lengthSquared();0===l?s.x=1:s.normalizeFromLength(Math.sqrt(l)),Vector3.CrossToRef(o,s,r),r.normalize();const c=-Vector3.Dot(s,t),h=-Vector3.Dot(r,t),u=-Vector3.Dot(o,t);return e.FromValuesToRef(s._x,r._x,o._x,0,s._y,r._y,o._y,0,s._z,r._z,o._z,0,c,h,u,1,n),n}add(t){const i=new e;return this.addToRef(t,i),i}static FromFloat32ArrayToRefScaled(e,t,i,a){return a._m[0]=e[0+t]*i,a._m[1]=e[1+t]*i,a._m[2]=e[2+t]*i,a._m[3]=e[3+t]*i,a._m[4]=e[4+t]*i,a._m[5]=e[5+t]*i,a._m[6]=e[6+t]*i,a._m[7]=e[7+t]*i,a._m[8]=e[8+t]*i,a._m[9]=e[9+t]*i,a._m[10]=e[10+t]*i,a._m[11]=e[11+t]*i,a._m[12]=e[12+t]*i,a._m[13]=e[13+t]*i,a._m[14]=e[14+t]*i,a._m[15]=e[15+t]*i,a.markAsUpdated(),a}multiply(t){const i=new e;return this.multiplyToRef(t,i),i}toArray(e=null,t=0){if(!e)return this._m;const i=this._m;for(let a=0;a<16;a++)e[t+a]=i[a];return this}static RotationZToRef(t,i){const a=Math.sin(t),n=Math.cos(t);return e.FromValuesToRef(n,a,0,0,-a,n,0,0,0,0,1,0,0,0,0,1,i),i._updateIdentityStatus(1===n&&0===a),i}static FromQuaternionToRef(e,t){const i=e._x*e._x,a=e._y*e._y,n=e._z*e._z,s=e._x*e._y,r=e._z*e._w,o=e._z*e._x,l=e._y*e._w,c=e._y*e._z,h=e._x*e._w;return t._m[0]=1-2*(a+n),t._m[1]=2*(s+r),t._m[2]=2*(o-l),t._m[3]=0,t._m[4]=2*(s-r),t._m[5]=1-2*(n+i),t._m[6]=2*(c+h),t._m[7]=0,t._m[8]=2*(o+l),t._m[9]=2*(c-h),t._m[10]=1-2*(a+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated(),t}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,PerformanceConfigurator.MatrixTrackPrecisionChange&&PerformanceConfigurator.MatrixTrackedMatrices.push(this),this._m=new PerformanceConfigurator.MatrixCurrentType(16),this.markAsUpdated()}transposeToRef(t){return e.TransposeToRef(this,t),t}static FromArrayToRef(e,t,i){for(let a=0;a<16;a++)i._m[a]=e[a+t];return i.markAsUpdated(),i}static RotationAxis(t,i){const a=new e;return e.RotationAxisToRef(t,i,a),a}static RotationAxisToRef(e,t,i){const a=Math.sin(-t),n=Math.cos(-t),s=1-n;e=e.normalizeToRef(MathTmp.Vector3[0]);const r=i._m;return r[0]=e._x*e._x*s+n,r[1]=e._x*e._y*s-e._z*a,r[2]=e._x*e._z*s+e._y*a,r[3]=0,r[4]=e._y*e._x*s+e._z*a,r[5]=e._y*e._y*s+n,r[6]=e._y*e._z*s-e._x*a,r[7]=0,r[8]=e._z*e._x*s-e._y*a,r[9]=e._z*e._y*s+e._x*a,r[10]=e._z*e._z*s+n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,i.markAsUpdated(),i}static get IdentityReadOnly(){return e._IdentityReadOnly}static Translation(t,i,a){const n=new e;return e.TranslationToRef(t,i,a,n),n}static LookDirectionLHToRef(t,i,a){const n=MathTmp.Vector3[0];n.copyFrom(t),n.scaleInPlace(-1);const s=MathTmp.Vector3[1];return Vector3.CrossToRef(i,n,s),e.FromValuesToRef(s._x,s._y,s._z,0,i._x,i._y,i._z,0,n._x,n._y,n._z,0,0,0,0,1,a),a}static FromValuesToRef(e,t,i,a,n,s,r,o,l,c,h,u,m,d,f,p,_){const g=_._m;g[0]=e,g[1]=t,g[2]=i,g[3]=a,g[4]=n,g[5]=s,g[6]=r,g[7]=o,g[8]=l,g[9]=c,g[10]=h,g[11]=u,g[12]=m,g[13]=d,g[14]=f,g[15]=p,_.markAsUpdated()}multiplyToRef(e,t){return this._isIdentity?(t.copyFrom(e),t):e._isIdentity?(t.copyFrom(this),t):(this.multiplyToArray(e,t._m,0),t.markAsUpdated(),t)}static RotationYawPitchRollToRef(e,t,i,a){return Quaternion.RotationYawPitchRollToRef(e,t,i,MathTmp.Cc[0]),MathTmp.Cc[0].toRotationMatrix(a),a}copyFromFloats(...t){return e.FromArrayToRef(t,0,this)}multiplyAtIndex(e,t){return this._m[e]*=t,this.markAsUpdated(),this}divide(t){return this.divideToRef(t,new e)}static OrthoOffCenterLH(t,i,a,n,s,r,o){const l=new e;return e.OrthoOffCenterLHToRef(t,i,a,n,s,r,l,o),l}static Transpose(t){const i=new e;return e.TransposeToRef(t,i),i}static TranslationToRef(t,i,a,n){return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,i,a,1,n),n._updateIdentityStatus(0===t&&0===i&&0===a),n}static OrthoOffCenterRHToRef(t,i,a,n,s,r,o,l){return e.OrthoOffCenterLHToRef(t,i,a,n,s,r,o,l),o._m[10]*=-1,o}static RotationZ(t){const i=new e;return e.RotationZToRef(t,i),i}subtractInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]-=i[e];return this.markAsUpdated(),this}divideToRef(e,t){const i=this._m,a=e.m,n=t._m;for(let e=0;e<16;e++)n[e]=i[e]/a[e];return t.markAsUpdated(),t}static TransposeToRef(e,t){const i=e.m,a=i[0],n=i[4],s=i[8],r=i[12],o=i[1],l=i[5],c=i[9],h=i[13],u=i[2],m=i[6],d=i[10],f=i[14],p=i[3],_=i[7],g=i[11],v=i[15],y=t._m;return y[0]=a,y[1]=n,y[2]=s,y[3]=r,y[4]=o,y[5]=l,y[6]=c,y[7]=h,y[8]=u,y[9]=m,y[10]=d,y[11]=f,y[12]=p,y[13]=_,y[14]=g,y[15]=v,t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty),t}subtractFromFloats(...t){return this.subtractFromFloatsToRef(...t,new e)}static DecomposeLerpToRef(t,i,a,n){const s=MathTmp.Vector3[0],r=MathTmp.Cc[0],o=MathTmp.Vector3[1];t.decompose(s,r,o);const l=MathTmp.Vector3[2],c=MathTmp.Cc[1],h=MathTmp.Vector3[3];i.decompose(l,c,h);const u=MathTmp.Vector3[4];Vector3.LerpToRef(s,l,a,u);const m=MathTmp.Cc[2];Quaternion.SlerpToRef(r,c,a,m);const d=MathTmp.Vector3[5];return Vector3.LerpToRef(o,h,a,d),e.ComposeToRef(u,m,d,n),n}subtract(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]-=i[e];return this.markAsUpdated(),this}setTranslation(e){return this.setTranslationFromFloats(e._x,e._y,e._z)}static RotationAlignToRef(e,t,i,a=!1){const n=Vector3.Dot(t,e),s=i._m;if(n<-1+Epsilon)s[0]=-1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a?1:-1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=a?-1:1,s[11]=0;else{const i=Vector3.Cross(t,e),a=1/(1+n);s[0]=i._x*i._x*a+n,s[1]=i._y*i._x*a-i._z,s[2]=i._z*i._x*a+i._y,s[3]=0,s[4]=i._x*i._y*a+i._z,s[5]=i._y*i._y*a+n,s[6]=i._z*i._y*a-i._x,s[7]=0,s[8]=i._x*i._z*a-i._y,s[9]=i._y*i._z*a+i._x,s[10]=i._z*i._z*a+n,s[11]=0}return s[12]=0,s[13]=0,s[14]=0,s[15]=1,i.markAsUpdated(),i}static FromValues(t,i,a,n,s,r,o,l,c,h,u,m,d,f,p,_){const g=new e,v=g._m;return v[0]=t,v[1]=i,v[2]=a,v[3]=n,v[4]=s,v[5]=r,v[6]=o,v[7]=l,v[8]=c,v[9]=h,v[10]=u,v[11]=m,v[12]=d,v[13]=f,v[14]=p,v[15]=_,g.markAsUpdated(),g}floorToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=Math.floor(t[e]);return e.markAsUpdated(),e}static Kc(t,i,a){const n=new e;return e.RotationYawPitchRollToRef(t,i,a,n),n}getClassName(){return"Matrix"}equals(e){const t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;const i=this.m,a=t.m;return i[0]===a[0]&&i[1]===a[1]&&i[2]===a[2]&&i[3]===a[3]&&i[4]===a[4]&&i[5]===a[5]&&i[6]===a[6]&&i[7]===a[7]&&i[8]===a[8]&&i[9]===a[9]&&i[10]===a[10]&&i[11]===a[11]&&i[12]===a[12]&&i[13]===a[13]&&i[14]===a[14]&&i[15]===a[15]}fromArray(t,i=0){return e.FromArrayToRef(t,i,this)}static OrthoLHToRef(t,i,a,n,s,r){const o=2/t,l=2/i,c=2/(n-a),h=-(n+a)/(n-a);return e.FromValuesToRef(o,0,0,0,0,l,0,0,0,0,c,0,0,0,h,1,s),r&&s.multiplyToRef(mtxConvertNDCToHalfZRange,s),s._updateIdentityStatus(1===o&&1===l&&1===c&&0===h),s}static RotationXToRef(t,i){const a=Math.sin(t),n=Math.cos(t);return e.FromValuesToRef(1,0,0,0,0,n,a,0,0,-a,n,0,0,0,0,1,i),i._updateIdentityStatus(1===n&&0===a),i}static PerspectiveFovRHToRef(t,i,a,n,s,r=!0,o,l=0,c=!1){const h=a,u=n,m=1/Math.tan(.5*t),d=r?m/i:m,f=r?m:m*i,p=c&&0===h?1:0!==u?-(u+h)/(u-h):-1,_=c&&0===h?2*u:0!==u?-2*u*h/(u-h):-2*h,g=Math.tan(l);return e.FromValuesToRef(d,0,0,0,0,f,0,g,0,0,p,-1,0,0,_,0,s),o&&s.multiplyToRef(mtxConvertNDCToHalfZRange,s),s._updateIdentityStatus(!1),s}static Reflection(t){const i=new e;return e.ReflectionToRef(t,i),i}static LookDirectionLH(t,i){const a=new e;return e.LookDirectionLHToRef(t,i,a),a}negateInPlace(){const e=this._m;for(let t=0;t<16;t++)e[t]=-e[t];return this.markAsUpdated(),this}equalsWithEpsilon(e,t=0){const i=this._m,a=e.m;for(let e=0;e<16;e++)if(!WithinEpsilon(i[e],a[e],t))return!1;return!0}subtractFromFloatsToRef(...e){const t=e.pop(),i=this._m,a=t._m,n=e;for(let e=0;e<16;e++)a[e]=i[e]-n[e];return t.markAsUpdated(),t}markAsUpdated(){this.updateFlag=e._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}scale(t){const i=new e;return this.scaleToRef(t,i),i}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}maximizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}decomposeToTransformNode(e){return e.rotationQuaternion=e.rotationQuaternion||new Quaternion,this.decompose(e.scaling,e.rotationQuaternion,e.position)}invert(){return this.invertToRef(this),this}static Compose(t,i,a){const n=new e;return e.ComposeToRef(t,i,a,n),n}static DecomposeLerp(t,i,a){const n=new e;return e.DecomposeLerpToRef(t,i,a,n),n}invertToRef(t){if(!0===this._isIdentity)return e.IdentityToRef(t),t;const i=this._m,a=i[0],n=i[1],s=i[2],r=i[3],o=i[4],l=i[5],c=i[6],h=i[7],u=i[8],m=i[9],d=i[10],f=i[11],p=i[12],_=i[13],g=i[14],v=i[15],y=d*v-g*f,S=m*v-_*f,C=m*g-_*d,E=u*v-p*f,A=u*g-d*p,T=u*_-p*m,M=+(l*y-c*S+h*C),x=-(o*y-c*E+h*A),b=+(o*S-l*E+h*T),w=-(o*C-l*A+c*T),I=a*M+n*x+s*b+r*w;if(0===I)return t.copyFrom(this),t;const P=1/I,R=c*v-g*h,N=l*v-_*h,k=l*g-_*c,D=o*v-p*h,B=o*g-p*c,F=o*_-p*l,L=c*f-d*h,O=l*f-m*h,G=l*d-m*c,V=o*f-u*h,U=o*d-u*c,H=o*m-u*l,W=-(n*y-s*S+r*C),z=+(a*y-s*E+r*A),X=-(a*S-n*E+r*T),Y=+(a*C-n*A+s*T),j=+(n*R-s*N+r*k),K=-(a*R-s*D+r*B),$=+(a*N-n*D+r*F),J=-(a*k-n*B+s*F),q=-(n*L-s*O+r*G),Q=+(a*L-s*V+r*U),Z=-(a*O-n*V+r*H),ee=+(a*G-n*U+s*H);return e.FromValuesToRef(M*P,W*P,j*P,q*P,x*P,z*P,K*P,Q*P,b*P,X*P,$*P,Z*P,w*P,Y*P,J*P,ee*P,t),t}getRowToRef(e,t){if(e>=0&&e<=3){const i=4*e;t.x=this._m[i+0],t.y=this._m[i+1],t.z=this._m[i+2],t.w=this._m[i+3]}return t}static PerspectiveFovLH(t,i,a,n,s,r=0,o=!1){const l=new e;return e.PerspectiveFovLHToRef(t,i,a,n,l,!0,s,r,o),l}static LookDirectionRH(t,i){const a=new e;return e.LookDirectionRHToRef(t,i,a),a}static LookAtLH(t,i,a){const n=new e;return e.LookAtLHToRef(t,i,a,n),n}scaleToRef(e,t){for(let i=0;i<16;i++)t._m[i]=this._m[i]*e;return t.markAsUpdated(),t}static GetAsMatrix2x2(e){const t=e.m,i=[t[0],t[1],t[4],t[5]];return PerformanceConfigurator.MatrixUse64Bits?i:new Float32Array(i)}asArray(){return this._m}static Invert(t){const i=new e;return t.invertToRef(i),i}static FromXYZAxesToRef(t,i,a,n){return e.FromValuesToRef(t._x,t._y,t._z,0,i._x,i._y,i._z,0,a._x,a._y,a._z,0,0,0,0,1,n),n}static OrthoLH(t,i,a,n,s){const r=new e;return e.OrthoLHToRef(t,i,a,n,r,s),r}setRow(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)}static ScalingToRef(t,i,a,n){return e.FromValuesToRef(t,0,0,0,0,i,0,0,0,0,a,0,0,0,0,1,n),n._updateIdentityStatus(1===t&&1===i&&1===a),n}reset(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}static OrthoOffCenterLHToRef(t,i,a,n,s,r,o,l){const c=2/(i-t),h=2/(n-a),u=2/(r-s),m=-(r+s)/(r-s),d=(t+i)/(t-i),f=(n+a)/(a-n);return e.FromValuesToRef(c,0,0,0,0,h,0,0,0,0,u,0,d,f,m,1,o),l&&o.multiplyToRef(mtxConvertNDCToHalfZRange,o),o.markAsUpdated(),o}getRotationMatrix(){const t=new e;return this.getRotationMatrixToRef(t),t}toggleProjectionMatrixHandInPlace(){const e=this._m;return e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated(),this}static FromArray(t,i=0){const a=new e;return e.FromArrayToRef(t,i,a),a}addToRef(e,t){const i=this._m,a=t._m,n=e.m;for(let e=0;e<16;e++)a[e]=i[e]+n[e];return t.markAsUpdated(),t}getRotationMatrixToRef(t){const i=MathTmp.Vector3[0];if(!this.decompose(i))return e.IdentityToRef(t),t;const a=this._m,n=1/i._x,s=1/i._y,r=1/i._z;return e.FromValuesToRef(a[0]*n,a[1]*n,a[2]*n,0,a[4]*s,a[5]*s,a[6]*s,0,a[8]*r,a[9]*r,a[10]*r,0,0,0,0,1,t),t}getHashCode(){let e=_ExtractAsInt(this._m[0]);for(let t=1;t<16;t++)e=397*e^_ExtractAsInt(this._m[t]);return e}determinant(){if(!0===this._isIdentity)return 1;const e=this._m,t=e[0],i=e[1],a=e[2],n=e[3],s=e[4],r=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],m=e[11],d=e[12],f=e[13],p=e[14],_=e[15],g=u*_-p*m,v=h*_-f*m,y=h*p-f*u,S=c*_-d*m,C=c*p-u*d,E=c*f-d*h;return t*+(r*g-o*v+l*y)+i*-(s*g-o*S+l*C)+a*+(s*v-r*S+l*E)+n*-(s*y-r*C+o*E)}copyToArray(e,t=0){const i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this}fract(){return this.fractToRef(new e)}removeRotationAndScaling(){const t=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this}static LookDirectionRHToRef(t,i,a){const n=MathTmp.Vector3[2];return Vector3.CrossToRef(i,t,n),e.FromValuesToRef(n._x,n._y,n._z,0,i._x,i._y,i._z,0,t._x,t._y,t._z,0,0,0,0,1,a),a}static LookAtRH(t,i,a){const n=new e;return e.LookAtRHToRef(t,i,a,n),n}_updateIdentityStatus(e,t=!1,i=!1,a=!0){this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&a}getTranslation(){return new Vector3(this._m[12],this._m[13],this._m[14])}set(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=e[i];return this.markAsUpdated(),this}static PerspectiveFovReverseRHToRef(t,i,a,n,s,r=!0,o,l=0){const c=1/Math.tan(.5*t),h=r?c/i:c,u=r?c:c*i,m=Math.tan(l);return e.FromValuesToRef(h,0,0,0,0,u,0,m,0,0,-a,-1,0,0,-1,0,s),o&&s.multiplyToRef(mtxConvertNDCToHalfZRange,s),s._updateIdentityStatus(!1),s}toggleModelMatrixHandInPlace(){const e=this._m;return e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated(),this}addToSelf(e){const t=this._m,i=e.m;return t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[3],t[4]+=i[4],t[5]+=i[5],t[6]+=i[6],t[7]+=i[7],t[8]+=i[8],t[9]+=i[9],t[10]+=i[10],t[11]+=i[11],t[12]+=i[12],t[13]+=i[13],t[14]+=i[14],t[15]+=i[15],this.markAsUpdated(),this}addAtIndex(e,t){return this._m[e]+=t,this.markAsUpdated(),this}floor(){return this.floorToRef(new e)}divideInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]/=i[e];return this.markAsUpdated(),this}clone(){const t=new e;return t.copyFrom(this),t}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}multiplyByFloatsToRef(...e){const t=e.pop(),i=this._m,a=t._m,n=e;for(let e=0;e<16;e++)a[e]=i[e]*n[e];return t.markAsUpdated(),t}addInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]+=e[i];return this.markAsUpdated(),this}static IdentityToRef(t){return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0),t}static ObliqueOffCenterLHToRef(t,i,a,n,s,r,o,l,c,h,u){const m=-o*Math.cos(l),d=-o*Math.sin(l);return e.TranslationToRef(0,0,-c,MathTmp.Matrix[1]),e.FromValuesToRef(1,0,0,0,0,1,0,0,m,d,1,0,0,0,0,1,MathTmp.Matrix[0]),MathTmp.Matrix[1].multiplyToRef(MathTmp.Matrix[0],MathTmp.Matrix[0]),e.TranslationToRef(0,0,c,MathTmp.Matrix[1]),MathTmp.Matrix[0].multiplyToRef(MathTmp.Matrix[1],MathTmp.Matrix[0]),e.OrthoOffCenterLHToRef(t,i,a,n,s,r,h,u),MathTmp.Matrix[0].multiplyToRef(h,h),h}static RotationYToRef(t,i){const a=Math.sin(t),n=Math.cos(t);return e.FromValuesToRef(n,0,-a,0,0,1,0,0,a,0,n,0,0,0,0,1,i),i._updateIdentityStatus(1===n&&0===a),i}minimizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}multiplyToArray(e,t,i){const a=this._m,n=e.m,s=a[0],r=a[1],o=a[2],l=a[3],c=a[4],h=a[5],u=a[6],m=a[7],d=a[8],f=a[9],p=a[10],_=a[11],g=a[12],v=a[13],y=a[14],S=a[15],C=n[0],E=n[1],A=n[2],T=n[3],M=n[4],x=n[5],b=n[6],w=n[7],I=n[8],P=n[9],R=n[10],N=n[11],k=n[12],D=n[13],B=n[14],F=n[15];return t[i]=s*C+r*M+o*I+l*k,t[i+1]=s*E+r*x+o*P+l*D,t[i+2]=s*A+r*b+o*R+l*B,t[i+3]=s*T+r*w+o*N+l*F,t[i+4]=c*C+h*M+u*I+m*k,t[i+5]=c*E+h*x+u*P+m*D,t[i+6]=c*A+h*b+u*R+m*B,t[i+7]=c*T+h*w+u*N+m*F,t[i+8]=d*C+f*M+p*I+_*k,t[i+9]=d*E+f*x+p*P+_*D,t[i+10]=d*A+f*b+p*R+_*B,t[i+11]=d*T+f*w+p*N+_*F,t[i+12]=g*C+v*M+y*I+S*k,t[i+13]=g*E+v*x+y*P+S*D,t[i+14]=g*A+v*b+y*R+S*B,t[i+15]=g*T+v*w+y*N+S*F,this}static RotationY(t){const i=new e;return e.RotationYToRef(t,i),i}static LerpToRef(e,t,i,a){const n=a._m,s=e.m,r=t.m;for(let e=0;e<16;e++)n[e]=s[e]*(1-i)+r[e]*i;return a.markAsUpdated(),a}decompose(t,i,a,n,s=!0){if(this._isIdentity)return a&&a.setAll(0),t&&t.setAll(1),i&&i.copyFromFloats(0,0,0,1),!0;const r=this._m;if(a&&a.copyFromFloats(r[12],r[13],r[14]),(t=t||MathTmp.Vector3[0]).x=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),t.y=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),t.z=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),n){const e=(s?n.absoluteScaling.x:n.scaling.x)<0?-1:1,i=(s?n.absoluteScaling.y:n.scaling.y)<0?-1:1,a=(s?n.absoluteScaling.z:n.scaling.z)<0?-1:1;t.x*=e,t.y*=i,t.z*=a}else this.determinant()<=0&&(t.y*=-1);if(0===t._x||0===t._y||0===t._z)return i&&i.copyFromFloats(0,0,0,1),!1;if(i){const a=1/t._x,n=1/t._y,s=1/t._z;e.FromValuesToRef(r[0]*a,r[1]*a,r[2]*a,0,r[4]*n,r[5]*n,r[6]*n,0,r[8]*s,r[9]*s,r[10]*s,0,0,0,0,1,MathTmp.Matrix[0]),Quaternion.FromRotationMatrixToRef(MathTmp.Matrix[0],i)}return!0}setAll(e){const t=this._m;for(let i=0;i<16;i++)t[i]=e;return this.markAsUpdated(),this}setRowFromFloats(e,t,i,a,n){if(e<0||e>3)return this;const s=4*e;return this._m[s+0]=t,this._m[s+1]=i,this._m[s+2]=a,this._m[s+3]=n,this.markAsUpdated(),this}toNormalMatrix(t){const i=MathTmp.Matrix[0];this.invertToRef(i),i.transposeToRef(t);const a=t._m;return e.FromValuesToRef(a[0],a[1],a[2],0,a[4],a[5],a[6],0,a[8],a[9],a[10],0,0,0,0,1,t),t}scaleAndAddToRef(e,t){for(let i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t.markAsUpdated(),t}get m(){return this._m}getTranslationToRef(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],e}scaleInPlace(e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e;return this.markAsUpdated(),this}static Scaling(t,i,a){const n=new e;return e.ScalingToRef(t,i,a,n),n}static ReflectionToRef(t,i){t.normalize();const a=t.normal.x,n=t.normal.y,s=t.normal.z,r=-2*a,o=-2*n,l=-2*s;return e.FromValuesToRef(r*a+1,o*a,l*a,0,r*n,o*n+1,l*n,0,r*s,o*s,l*s+1,0,r*t.d,o*t.d,l*t.d,1,i),i}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity}static get Use64Bits(){return PerformanceConfigurator.MatrixUse64Bits}maximizeInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]=Math.min(t[e],i[e]);return this.markAsUpdated(),this}static RotationX(t){const i=new e;return e.RotationXToRef(t,i),i}static GetFinalMatrix(t,i,a,n,s,r){const o=t.width,l=t.height,c=t.x,h=t.y,u=e.FromValues(o/2,0,0,0,0,-l/2,0,0,0,0,r-s,0,c+o/2,l/2+h,s,1),m=new e;return i.multiplyToRef(a,m),m.multiplyToRef(n,m),m.multiplyToRef(u,m)}subtractToRef(e,t){const i=this._m,a=e.m,n=t._m;for(let e=0;e<16;e++)n[e]=i[e]-a[e];return t.markAsUpdated(),t}fractToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=t[e]-Math.floor(t[e]);return e.markAsUpdated(),e}minimizeInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]=Math.min(t[e],i[e]);return this.markAsUpdated(),this}addInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]+=i[e];return this.markAsUpdated(),this}static PerspectiveFovLHToRef(t,i,a,n,s,r=!0,o,l=0,c=!1){const h=a,u=n,m=1/Math.tan(.5*t),d=r?m/i:m,f=r?m:m*i,p=c&&0===h?-1:0!==u?(u+h)/(u-h):1,_=c&&0===h?2*u:0!==u?-2*u*h/(u-h):-2*h,g=Math.tan(l);return e.FromValuesToRef(d,0,0,0,0,f,0,g,0,0,p,1,0,0,_,0,s),o&&s.multiplyToRef(mtxConvertNDCToHalfZRange,s),s._updateIdentityStatus(!1),s}static PerspectiveLH(t,i,a,n,s,r=0){const o=new e,l=2*a/t,c=2*a/i,h=(n+a)/(n-a),u=-2*n*a/(n-a),m=Math.tan(r);return e.FromValuesToRef(l,0,0,0,0,c,0,m,0,0,h,1,0,0,u,0,o),s&&o.multiplyToRef(mtxConvertNDCToHalfZRange,o),o._updateIdentityStatus(!1),o}getRow(e){if(e<0||e>3)return null;const t=4*e;return new Vector4(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])}negate(){return this.negateToRef(new e)}equalsToFloats(...e){const t=this._m;for(let i=0;i<16;i++)if(t[i]!=e[i])return!1;return!0}static ObliqueOffCenterRHToRef(t,i,a,n,s,r,o,l,c,h,u){const m=o*Math.cos(l),d=o*Math.sin(l);return e.TranslationToRef(0,0,c,MathTmp.Matrix[1]),e.FromValuesToRef(1,0,0,0,0,1,0,0,m,d,1,0,0,0,0,1,MathTmp.Matrix[0]),MathTmp.Matrix[1].multiplyToRef(MathTmp.Matrix[0],MathTmp.Matrix[0]),e.TranslationToRef(0,0,-c,MathTmp.Matrix[1]),MathTmp.Matrix[0].multiplyToRef(MathTmp.Matrix[1],MathTmp.Matrix[0]),e.OrthoOffCenterRHToRef(t,i,a,n,s,r,h,u),MathTmp.Matrix[0].multiplyToRef(h,h),h}transpose(){const t=new e;return e.TransposeToRef(this,t),t}multiplyInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]*=i[e];return this.markAsUpdated(),this}static PerspectiveFovReverseLHToRef(t,i,a,n,s,r=!0,o,l=0){const c=1/Math.tan(.5*t),h=r?c/i:c,u=r?c:c*i,m=Math.tan(l);return e.FromValuesToRef(h,0,0,0,0,u,0,m,0,0,-a,1,0,0,1,0,s),o&&s.multiplyToRef(mtxConvertNDCToHalfZRange,s),s._updateIdentityStatus(!1),s}static Zero(){const t=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t}static LookAtRHToRef(t,i,a,n){const s=MathTmp.Vector3[0],r=MathTmp.Vector3[1],o=MathTmp.Vector3[2];t.subtractToRef(i,o),o.normalize(),Vector3.CrossToRef(a,o,s);const l=s.lengthSquared();0===l?s.x=1:s.normalizeFromLength(Math.sqrt(l)),Vector3.CrossToRef(o,s,r),r.normalize();const c=-Vector3.Dot(s,t),h=-Vector3.Dot(r,t),u=-Vector3.Dot(o,t);return e.FromValuesToRef(s._x,r._x,o._x,0,s._y,r._y,o._y,0,s._z,r._z,o._z,0,c,h,u,1,n),n}static ComposeToRef(e,t,i,a){const n=a._m,s=t._x,r=t._y,o=t._z,l=t._w,c=s+s,h=r+r,u=o+o,m=s*c,d=s*h,f=s*u,p=r*h,_=r*u,g=o*u,v=l*c,y=l*h,S=l*u,C=e._x,E=e._y,A=e._z;return n[0]=(1-(p+g))*C,n[1]=(d+S)*C,n[2]=(f-y)*C,n[3]=0,n[4]=(d-S)*E,n[5]=(1-(m+g))*E,n[6]=(_+v)*E,n[7]=0,n[8]=(f+y)*A,n[9]=(_-v)*A,n[10]=(1-(m+p))*A,n[11]=0,n[12]=i._x,n[13]=i._y,n[14]=i._z,n[15]=1,a.markAsUpdated(),a}static Identity(){const t=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t}static Lerp(t,i,a){const n=new e;return e.LerpToRef(t,i,a,n),n}addTranslationFromFloats(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this.markAsUpdated(),this}setTranslationFromFloats(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this.markAsUpdated(),this}};Matrix._UpdateFlagSeed=0,Matrix._IdentityReadOnly=Matrix.Identity(),Object.defineProperties(Matrix.prototype,{dimension:{value:[4,4]},rank:{value:2}});var MathTmp=class{};MathTmp.Vector3=BuildTuple(11,Vector3.Zero),MathTmp.Matrix=BuildTuple(2,Matrix.Identity),MathTmp.Cc=BuildTuple(3,Quaternion.Zero);var TmpVectors=class{};TmpVectors.Vector2=BuildTuple(3,Vector2.Zero),TmpVectors.Vector3=BuildTuple(13,Vector3.Zero),TmpVectors.Vector4=BuildTuple(3,Vector4.Zero),TmpVectors.Cc=BuildTuple(3,Quaternion.Zero),TmpVectors.Matrix=BuildTuple(8,Matrix.Identity),RegisterClass("BABYLON.Vector2",Vector2),RegisterClass("BABYLON.Vector3",Vector3),RegisterClass("BABYLON.Vector4",Vector4),RegisterClass("BABYLON.Matrix",Matrix);var mtxConvertNDCToHalfZRange=Matrix.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1),_copySource=function(e,t,i,a={}){const n=e();Tags&&Tags.HasTags(t)&&Tags.AddTagsTo(n,Tags.GetTags(t,!0));const s=GetMergedStore(n),r={};for(const e in s){const o=s[e],l=t[e],c=o.type;if(null!=l&&("uniqueId"!==e||SerializationHelper.AllowLoadingUniqueId))switch(c){case 0:case 6:case 11:n[e]=l;break;case 1:a.cloneTexturesOnlyOnce&&r[l.Hc]?n[e]=r[l.Hc]:(n[e]=i||l.isRenderTarget?l:l.clone(),r[l.Hc]=n[e]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:n[e]=i?l:l.clone()}}return n},SerializationHelper=class e{static ParseProperties(t,i,a,n){n||(n="");const s=GetMergedStore(i);for(const r in s){const o=s[r],l=t[o.sourceName||r],c=o.type;if(null!=l&&("uniqueId"!==r||e.AllowLoadingUniqueId)){const t=i;switch(c){case 0:t[r]=l;break;case 1:a&&(t[r]=e._TextureParser(l,a,n));break;case 2:t[r]=Color3.FromArray(l);break;case 3:t[r]=e._FresnelParametersParser(l);break;case 4:t[r]=Vector2.FromArray(l);break;case 5:t[r]=Vector3.FromArray(l);break;case 6:a&&(t[r]=a.getLastMeshById(l));break;case 7:t[r]=e._ColorCurvesParser(l);break;case 8:t[r]=Color4.FromArray(l);break;case 9:t[r]=e._ImageProcessingConfigurationParser(l);break;case 10:t[r]=Quaternion.FromArray(l);break;case 11:a&&(t[r]=a.getCameraById(l));break;case 12:t[r]=Matrix.FromArray(l)}}}}static Instanciate(e,t){return _copySource(e,t,!0)}static Serialize(t,i){i||(i={}),Tags&&(i.tags=Tags.GetTags(t));const a=GetMergedStore(t);for(const n in a){const s=a[n],r=s.sourceName||n,o=s.type,l=t[n];if(null!=l&&("uniqueId"!==n||e.AllowLoadingUniqueId))switch(o){case 0:i[r]=l;break;case 1:case 3:case 7:case 9:i[r]=l.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:i[r]=l.asArray();break;case 6:case 11:i[r]=l.id}}return i}static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let i=0;i<e.animations.length;i++){const a=e.animations[i];t.animations.push(a.serialize())}}}static Parse(t,i,a,n=null){const s=t();return Tags&&Tags.AddTagsTo(s,i.tags),e.ParseProperties(i,s,a,n),s}static Clone(e,t,i={}){return _copySource(e,t,!1,i)}};SerializationHelper.AllowLoadingUniqueId=!1,SerializationHelper._ImageProcessingConfigurationParser=e=>{throw _WarnImport("ImageProcessingConfiguration")},SerializationHelper._FresnelParametersParser=e=>{throw _WarnImport("FresnelParameters")},SerializationHelper._ColorCurvesParser=e=>{throw _WarnImport("ColorCurves")},SerializationHelper._TextureParser=(e,t,i)=>{throw _WarnImport("Texture")};var _InternalNodeDataInfo=class{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new Observable,this._onClonedObservable=new Observable}},Node=class e{_serializeAsParent(e){e.parentId=this.Hc}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}isDescendantOf(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}createAnimationRange(t,i,a){if(!this._ranges[t]){this._ranges[t]=e._AnimationRangeFactory(t,i,a);for(let e=0,n=this.animations.length;e<n;e++)this.animations[e]&&this.animations[e].createRange(t,i,a)}}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}getAnimationRange(e){return this._ranges[e]||null}getDescendants(e,t){const i=[];return this._getDescendants(i,e,t),i}removeBehavior(e){const t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}static ParseAnimationRanges(e,t,i){if(t.ranges)for(let i=0;i<t.ranges.length;i++){const a=t.ranges[i];e.createAnimationRange(a.name,a.from,a.to)}}_setReady(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getClassName(){return"Node"}set parent(e){if(this._parentNode===e)return;const t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((e=>{e._syncParentEnabledState()}))}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}deleteAnimationRange(e,t=!0){for(let i=0,a=this.animations.length;i<a;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}_getActionManagerForTrigger(e,t=!0){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}beginAnimation(e,t,i,a){const n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,i,a):null}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}get parent(){return this._parentNode}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}serializeAnimationRanges(){const e=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const a={};a.name=t,a.from=i.from,a.to=i.to,e.push(a)}return e}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){const i=this.animations[t];if(i.name===e)return i}return null}_updateCache(e){}_isSynchronized(){return!0}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}isReady(e=!1){return this._nodeDataStorage._isReady}_initCache(){this._cache={}}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}getChildMeshes(e,t){const i=[];return this._getDescendants(i,e,(e=>(!t||t(e))&&void 0!==e.cullingStrategy)),i}getHierarchyBoundingVectors(e=!0,t=null){let i,a;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const n=this;if(n.getBoundingInfo&&n.subMeshes){const e=n.getBoundingInfo();i=e.boundingBox.minimumWorld.clone(),a=e.boundingBox.maximumWorld.clone()}else i=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const e=this.getDescendants(!1);for(const n of e){const e=n;if(e.computeWorldMatrix(!0),t&&!t(e))continue;if(!e.getBoundingInfo||0===e.getTotalVertices())continue;const s=e.getBoundingInfo().boundingBox,r=s.minimumWorld,o=s.maximumWorld;Vector3.CheckExtends(r,i,a),Vector3.CheckExtends(o,i,a)}}return{min:i,max:a}}constructor(e,t=null,i=!0){this._isDirty=!1,this._nodeDataStorage=new _InternalNodeDataInfo,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new Observable,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=Matrix.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new Observable,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||EngineStore.LastCreatedScene,this.Hc=this._scene.getUniqueId(),this._initCache(),i&&this._addToSceneRootNodes()}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=Matrix.Identity()),this._worldMatrix}isDisposed(){return this._nodeDataStorage._isDisposed}addBehavior(e,t=!1){return-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((()=>{e.attach(this)})):e.attach(this),this._behaviors.push(e)),this}get accessibilityTag(){return this._accessibilityTag}_getDescendants(e,t=!1,i){if(this._children)for(let a=0;a<this._children.length;a++){const n=this._children[a];i&&!i(n)||e.push(n),t||n._getDescendants(e,!1,i)}}isEnabled(e=!0){return!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}clone(t,i,a){const n=SerializationHelper.Clone((()=>new e(t,this.getScene())),this);if(i&&(n.parent=i),!a){const e=this.getDescendants(!0);for(let i=0;i<e.length;i++){const a=e[i];a.clone(t+"."+a.name,n)}}return n}get behaviors(){return this._behaviors}updateCache(e){!e&&this.isSynchronized()||this._updateCache()}getChildren(e,t=!0){return this.getDescendants(t,e)}getScene(){return this._scene}dispose(e,t=!1){if(this._nodeDataStorage._isDisposed=!0,!e){const i=this.getDescendants(!0);for(const a of i)a.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const e of this._behaviors)e.detach();this._behaviors.length=0,this.metadata=null}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}get worldMatrixFromCache(){return this._worldMatrix}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}static Construct(e,t,i,a){const n=this._NodeConstructors[e];return n?n(t,i,a):null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}getEngine(){return this._scene.getEngine()}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}};Node._AnimationRangeFactory=(e,t,i)=>{throw _WarnImport("AnimationRange")},Node._NodeConstructors={},__decorate([serialize()],Node.prototype,"name",void 0),__decorate([serialize()],Node.prototype,"id",void 0),__decorate([serialize()],Node.prototype,"uniqueId",void 0),__decorate([serialize()],Node.prototype,"state",void 0),__decorate([serialize()],Node.prototype,"metadata",void 0);var convertRHSToLHS=Matrix.Compose(Vector3.One(),Quaternion.FromEulerAngles(0,Math.PI,0),Vector3.Zero()),TransformNode=class e extends Node{getAbsolutePivotPoint(){const e=Vector3.Zero();return this.getAbsolutePivotPointToRef(e),e}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}_getEffectiveParent(){return this.parent}addChild(e,t=!1){return e.setParent(this,t),this}unregisterAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}_afterComputeWorldMatrix(){}instantiateHierarchy(e=null,t,i){const a=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);a&&i&&i(this,a);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(a,t,i);return a}setPivotMatrix(e,t=!0){return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=Matrix.Invert(this._pivotMatrix)),this}get nonUniformScaling(){return this._nonUniformScaling}set rotation(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0}clone(t,i,a){const n=SerializationHelper.Clone((()=>new e(t,this.getScene())),this);if(n.name=t,n.id=t,i&&(n.parent=i),!a){const e=this.getDescendants(!0);for(let i=0;i<e.length;i++){const a=e[i];a.clone&&a.clone(t+"."+a.name,n)}}return n}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=Matrix.Identity()),this._poseMatrix}rotateAround(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=Quaternion.Kc(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const a=TmpVectors.Vector3[0],n=TmpVectors.Vector3[1],s=TmpVectors.Vector3[2],r=TmpVectors.Cc[0],o=TmpVectors.Matrix[0],l=TmpVectors.Matrix[1],c=TmpVectors.Matrix[2],h=TmpVectors.Matrix[3];return e.subtractToRef(this.position,a),Matrix.TranslationToRef(a.x,a.y,a.z,o),Matrix.TranslationToRef(-a.x,-a.y,-a.z,l),Matrix.RotationAxisToRef(t,i,c),l.multiplyToRef(c,h),h.multiplyToRef(o,h),h.decompose(n,r,s),this.position.addInPlace(s),r.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}detachFromBone(e=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._cache.useBillboardPosition=!!(this._billboardMode&e.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}set preserveParentRotationForBillboard(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==e.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get up(){return Vector3.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}setPivotPoint(e,t=0){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);const i=this.getWorldMatrix();if(1==t){const t=TmpVectors.Matrix[0];i.invertToRef(t),e=Vector3.TransformCoordinates(e,t)}return this.setPivotMatrix(Matrix.Translation(-e.x,-e.y,-e.z),!0)}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const e=TmpVectors.Matrix[0];return this._localMatrix.invertToRef(e),Vector3.TransformNormal(this.position,e)}get infiniteDistance(){return this._infiniteDistance}getClassName(){return"TransformNode"}markAsDirty(e){if(this._isDirty)return this;if(this._children)for(const t of this._children)t.markAsDirty(e);return super.markAsDirty(e)}setDirection(e,t=0,i=0,a=0){const n=-Math.atan2(e.z,e.x)+Math.PI/2,s=Math.sqrt(e.x*e.x+e.z*e.z),r=-Math.atan2(e.y,s);return this.rotationQuaternion?Quaternion.RotationYawPitchRollToRef(n+t,r+i,a,this.rotationQuaternion):(this.rotation.x=r+i,this.rotation.y=n+t,this.rotation.z=a),this}serialize(e){const t=SerializationHelper.Serialize(this,e);return t.type=this.getClassName(),t.Hc=this.Hc,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),SerializationHelper.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t}resetLocalMatrix(e=!0){if(this.computeWorldMatrix(),e){const e=this.getChildren();for(let t=0;t<e.length;++t){const i=e[t];if(i){i.computeWorldMatrix();const e=TmpVectors.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,e);const t=TmpVectors.Cc[0];e.decompose(i.scaling,t,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(i.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=Quaternion.Identity()),this._worldMatrix=Matrix.Identity()}lookAt(t,i=0,a=0,n=0,s=0){const r=e._LookAtVectorCache,o=0===s?this.position:this.getAbsolutePosition();if(t.subtractToRef(o,r),this.setDirection(r,i,a,n),1===s&&this.parent)if(this.rotationQuaternion){const e=TmpVectors.Matrix[0];this.rotationQuaternion.toRotationMatrix(e);const t=TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.invert(),e.multiplyToRef(t,e),this.rotationQuaternion.fromRotationMatrix(e)}else{const e=TmpVectors.Cc[0];Quaternion.FromEulerVectorToRef(this.rotation,e);const t=TmpVectors.Matrix[0];e.toRotationMatrix(t);const i=TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.invert(),t.multiplyToRef(i,t),e.fromRotationMatrix(t),e.toEulerAnglesToRef(this.rotation)}return this}get rotation(){return this._rotation}set rotationQuaternion(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0}setParent(t,i=!1,a=!1){if(!t&&!this.parent)return this;const n=TmpVectors.Cc[0],s=TmpVectors.Vector3[0],r=TmpVectors.Vector3[1],o=TmpVectors.Matrix[1];Matrix.IdentityToRef(o);const l=TmpVectors.Matrix[0];this.computeWorldMatrix(!0);let c=this.rotationQuaternion;return c||(c=e._TmpRotation,Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,c)),Matrix.ComposeToRef(this.scaling,c,this.position,l),this.parent&&l.multiplyToRef(this.parent.computeWorldMatrix(!0),l),t&&(t.computeWorldMatrix(!0).invertToRef(o),l.multiplyToRef(o,l)),l.decompose(r,n,s,i?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(n):n.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(r),this.position.copyFrom(s),this.parent=t,a&&this.setPivotMatrix(Matrix.Identity()),this}updatePoseMatrix(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}locallyTranslate(e){return this.computeWorldMatrix(!0),this.position=Vector3.TransformCoordinates(e,this._localMatrix),this}set scaling(e){this._scaling=e,this._isDirty=!0}isUsingPivotMatrix(){return this._usePivotMatrix}addRotation(e,t,i){let a;this.rotationQuaternion?a=this.rotationQuaternion:(a=TmpVectors.Cc[1],Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,a));const n=TmpVectors.Cc[0];return Quaternion.RotationYawPitchRollToRef(t,e,i,n),a.multiplyInPlace(n),this.rotationQuaternion||a.toEulerAnglesToRef(this.rotation),this}normalizeToUnitCube(e=!0,t=!1,i){let a=null,n=null;t&&(this.rotationQuaternion?(n=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(a=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const s=this.getHierarchyBoundingVectors(e,i),r=s.max.subtract(s.min),o=Math.max(r.x,r.y,r.z);if(0===o)return this;const l=1/o;return this.scaling.scaleInPlace(l),t&&(this.rotationQuaternion&&n?this.rotationQuaternion.copyFrom(n):this.rotation&&a&&this.rotation.copyFrom(a)),this}dispose(e,t=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const e=this._parentContainer.transformNodes.indexOf(this);e>-1&&this._parentContainer.transformNodes.splice(e,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){const e=this.getChildTransformNodes(!0);for(const t of e)t.parent=null,t.computeWorldMatrix(!0)}super.dispose(e,t)}get scaling(){return this._scaling}getPositionInCameraSpace(e=null){return e||(e=this.getScene().activeCamera),Vector3.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}set infiniteDistance(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}freezeWorldMatrix(e=null,t=!1){return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||Quaternion.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}setPreTransformMatrix(e){return this.setPivotMatrix(e,!1)}get position(){return this._position}constructor(t,i=null,a=!0){super(t,i,!1),this._forward=new Vector3(0,0,1),this._up=new Vector3(0,1,0),this._right=new Vector3(1,0,0),this._position=Vector3.Zero(),this._rotation=Vector3.Zero(),this._rotationQuaternion=null,this._scaling=Vector3.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=e.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=Matrix.Zero(),this._usePivotMatrix=!1,this._absolutePosition=Vector3.Zero(),this._absoluteScaling=Vector3.Zero(),this._absoluteRotationQuaternion=Quaternion.Identity(),this._pivotMatrix=Matrix.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new Observable,this._nonUniformScaling=!1,a&&this.getScene().addTransformNode(this)}attachToBone(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(!0),e.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}getPivotPointToRef(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}static Parse(t,i,a){const n=SerializationHelper.Parse((()=>new e(t.name,i)),t,i,a);if(t.localMatrix?n.setPreTransformMatrix(Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&n.setPivotMatrix(Matrix.FromArray(t.pivotMatrix)),n.setEnabled(t.isEnabled),n._waitingParsedUniqueId=t.Hc,void 0!==t.parentId&&(n._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(n._waitingParentInstanceIndex=t.parentInstanceIndex),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],a=GetClass("BABYLON.Animation");a&&n.animations.push(a.Parse(i))}Node.ParseAnimationRanges(n,t,i)}return t.autoAnimate&&i.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),n}getDistanceToCamera(e=null){return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getDirection(e){const t=Vector3.Zero();return this.getDirectionToRef(e,t),t}rotate(t,i,a){let n;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),a&&0!==a){if(this.parent){const e=this.parent.getWorldMatrix(),a=TmpVectors.Matrix[0];e.invertToRef(a),t=Vector3.TransformNormal(t,a),e.determinant()<0&&(i*=-1)}n=Quaternion.RotationAxisToRef(t,i,e._RotationAxisCache),n.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else n=Quaternion.RotationAxisToRef(t,i,e._RotationAxisCache),this.rotationQuaternion.multiplyToRef(n,this.rotationQuaternion);return this}get absolutePosition(){return this.getAbsolutePosition()}getAbsolutePivotPointToRef(e){return this.getPivotPointToRef(e),Vector3.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}get rotationQuaternion(){return this._rotationQuaternion}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==e.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}registerAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}setPositionWithLocalVector(e){return this.computeWorldMatrix(),this.position=Vector3.TransformNormal(e,this._localMatrix),this}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}_isSynchronized(){const t=this._cache;return this._billboardMode===t.billboardMode&&this._billboardMode===e.BILLBOARDMODE_NONE&&(!t.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}removeChild(e,t=!1){return e.setParent(null,t),this}getChildTransformNodes(t,i){const a=[];return this._getDescendants(a,t,(t=>(!i||i(t))&&t instanceof e)),a}translate(e,t,i){const a=e.scale(t);if(i&&0!==i)this.setAbsolutePosition(this.getAbsolutePosition().add(a));else{const e=this.getPositionExpressedInLocalSpace().add(a);this.setPositionWithLocalVector(e)}return this}_initCache(){super._initCache();const e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1,e.useBillboardPosition=!1,e.useBillboardPath=!1}getDirectionToRef(e,t){return Vector3.TransformNormalToRef(e,this.getWorldMatrix(),t),this}setAbsolutePosition(e){if(!e)return this;let t,i,a;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],i=arguments[1],a=arguments[2]}else t=e.x,i=e.y,a=e.z;if(this.parent){const e=TmpVectors.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),Vector3.TransformCoordinatesFromFloatsToRef(t,i,a,e,this.position)}else this.position.x=t,this.position.y=i,this.position.z=a;return this._absolutePosition.copyFrom(e),this}get billboardMode(){return this._billboardMode}get right(){return Vector3.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}getPivotMatrix(){return this._pivotMatrix}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}_updateNonUniformScalingState(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)}get forward(){return Vector3.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}computeWorldMatrix(t=!1,i=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const a=this.getScene().getRenderId();if(!this._isDirty&&!t&&(this._currentRenderId===a||this.isSynchronized()))return this._currentRenderId=a,this._worldMatrix;i=i||this.getScene().activeCamera,this._updateCache();const n=this._cache;n.pivotMatrixUpdated=!1,n.billboardMode=this.billboardMode,n.infiniteDistance=this.infiniteDistance,n.parent=this._parentNode,this._currentRenderId=a,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const s=this._getEffectiveParent(),r=e._TmpScaling;let o,l=this._position;if(this._infiniteDistance&&!this.parent&&i){const t=i.getWorldMatrix(),a=new Vector3(t.m[12],t.m[13],t.m[14]);l=e._TmpTranslation,l.copyFromFloats(this._position.x+a.x,this._position.y+a.y,this._position.z+a.z)}if(r.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,o=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(Quaternion.Kc(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else o=e._TmpRotation,Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,o);if(this._usePivotMatrix){const e=TmpVectors.Matrix[1];Matrix.ScalingToRef(r.x,r.y,r.z,e);const t=TmpVectors.Matrix[0];o.toRotationMatrix(t),this._pivotMatrix.multiplyToRef(e,TmpVectors.Matrix[4]),TmpVectors.Matrix[4].multiplyToRef(t,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(l.x,l.y,l.z)}else Matrix.ComposeToRef(r,o,l,this._localMatrix);if(s&&s.getWorldMatrix){if(t&&s.computeWorldMatrix(t),n.useBillboardPath){if(this._transformToBoneReferal){const e=this.parent;e.getSkeleton().prepare(),e.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),TmpVectors.Matrix[7])}else TmpVectors.Matrix[7].copyFrom(s.getWorldMatrix());const t=TmpVectors.Vector3[5],i=TmpVectors.Vector3[6],a=TmpVectors.Cc[0];TmpVectors.Matrix[7].decompose(i,a,t),Matrix.ScalingToRef(i.x,i.y,i.z,TmpVectors.Matrix[7]),TmpVectors.Matrix[7].setTranslation(t),e.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(a,t),this._localMatrix.setTranslation(t)),this._localMatrix.multiplyToRef(TmpVectors.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const e=this.parent;e.getSkeleton().prepare(),this._localMatrix.multiplyToRef(e.getFinalMatrix(),TmpVectors.Matrix[6]),TmpVectors.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(s.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(n.useBillboardPath&&i&&this.billboardMode&&!n.useBillboardPosition){const t=TmpVectors.Vector3[0];if(this._worldMatrix.getTranslationToRef(t),TmpVectors.Matrix[1].copyFrom(i.getViewMatrix()),this._scene.useRightHandedSystem&&TmpVectors.Matrix[1].multiplyToRef(convertRHSToLHS,TmpVectors.Matrix[1]),TmpVectors.Matrix[1].setTranslationFromFloats(0,0,0),TmpVectors.Matrix[1].invertToRef(TmpVectors.Matrix[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){TmpVectors.Matrix[0].decompose(void 0,TmpVectors.Cc[0],void 0);const t=TmpVectors.Vector3[1];TmpVectors.Cc[0].toEulerAnglesToRef(t),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(t.z=0),Matrix.RotationYawPitchRollToRef(t.y,t.x,t.z,TmpVectors.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(TmpVectors.Vector3[0])}else if(n.useBillboardPath&&i&&n.useBillboardPosition){const t=TmpVectors.Vector3[0];this._worldMatrix.getTranslationToRef(t);const a=i.globalPosition;this._worldMatrix.invertToRef(TmpVectors.Matrix[1]);const n=TmpVectors.Vector3[1];Vector3.TransformCoordinatesToRef(a,TmpVectors.Matrix[1],n),n.normalize();const s=-Math.atan2(n.z,n.x)+Math.PI/2,r=Math.sqrt(n.x*n.x+n.z*n.z),o=-Math.atan2(n.y,r);if(Quaternion.RotationYawPitchRollToRef(s,o,0,TmpVectors.Cc[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){const t=TmpVectors.Vector3[1];TmpVectors.Cc[0].toEulerAnglesToRef(t),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(t.z=0),Matrix.RotationYawPitchRollToRef(t.y,t.x,t.z,TmpVectors.Matrix[0])}else Matrix.FromQuaternionToRef(TmpVectors.Cc[0],TmpVectors.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(TmpVectors.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(TmpVectors.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):s&&s._nonUniformScaling?this._updateNonUniformScalingState(s._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}getPivotPoint(){const e=Vector3.Zero();return this.getPivotPointToRef(e),e}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set position(e){this._position=e,this._isDirty=!0}};TransformNode.BILLBOARDMODE_NONE=0,TransformNode.BILLBOARDMODE_X=1,TransformNode.BILLBOARDMODE_Y=2,TransformNode.BILLBOARDMODE_Z=4,TransformNode.BILLBOARDMODE_ALL=7,TransformNode.BILLBOARDMODE_USE_POSITION=128,TransformNode.BillboardUseParentOrientation=!1,TransformNode._TmpRotation=Quaternion.Zero(),TransformNode._TmpScaling=Vector3.Zero(),TransformNode._TmpTranslation=Vector3.Zero(),TransformNode._LookAtVectorCache=new Vector3(0,0,0),TransformNode._RotationAxisCache=new Quaternion,__decorate([serializeAsVector3("position")],TransformNode.prototype,"_position",void 0),__decorate([serializeAsVector3("rotation")],TransformNode.prototype,"_rotation",void 0),__decorate([serializeAsQuaternion("rotationQuaternion")],TransformNode.prototype,"_rotationQuaternion",void 0),__decorate([serializeAsVector3("scaling")],TransformNode.prototype,"_scaling",void 0),__decorate([serialize("billboardMode")],TransformNode.prototype,"_billboardMode",void 0),__decorate([serialize()],TransformNode.prototype,"scalingDeterminant",void 0),__decorate([serialize("infiniteDistance")],TransformNode.prototype,"_infiniteDistance",void 0),__decorate([serialize()],TransformNode.prototype,"ignoreNonUniformScaling",void 0),__decorate([serialize()],TransformNode.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);var DataBuffer=class e{constructor(){this.references=0,this.Fc=0,this.is32Bits=!1,this.Hc=e._Counter++}get underlyingResource(){return null}};DataBuffer._Counter=0;var Logger=class e{static _AddLogEntry(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)}static _FormatMessage(e){const t=e=>e<10?"0"+e:""+e,i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e}static ClearLogCache(){e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0}static _LogEnabled(t=1,i,a){const n=Array.isArray(i)?i[0]:i;if(void 0!==a&&!e._CheckLimit(n,a))return;const s=e._FormatMessage(n),r=this._Levels[t],o=Array.isArray(i)?i.slice(1):[];r.logFunc&&r.logFunc("BJS - "+s,...o);const l=`<div style='color:${r.color}'>${s}</div><br>`;e._AddLogEntry(l),e._GenerateLimitMessage(n,t)}static get LogCache(){return e._LogCache}static _LogDisabled(e,t){}static set LogLevels(t){e.Log=e._LogDisabled,e.Warn=e._LogDisabled,e.Error=e._LogDisabled,[e.MessageLogLevel,e.WarningLogLevel,e.ErrorLogLevel].forEach((i=>{if((t&i)===i){const t=this._Levels[i];e[t.name]=e._LogEnabled.bind(e,i)}}))}static _GenerateLimitMessage(t,i=1){const a=e._LogLimitOutputs[t];if(!a||!e.MessageLimitReached)return;const n=this._Levels[i];a.current===a.limit&&e[n.name](e.MessageLimitReached.replace(/%LIMIT%/g,""+a.limit).replace(/%TYPE%/g,n.name??""))}static _CheckLimit(t,i){let a=e._LogLimitOutputs[t];return a?a.current++:(a={limit:i,current:1},e._LogLimitOutputs[t]=a),a.current<=a.limit}};Logger.NoneLogLevel=0,Logger.MessageLogLevel=1,Logger.WarningLogLevel=2,Logger.ErrorLogLevel=4,Logger.AllLogLevel=7,Logger.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Logger._LogCache="",Logger._LogLimitOutputs={},Logger._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],Logger.errorsCount=0,Logger.Log=Logger._LogEnabled.bind(Logger,Logger.MessageLogLevel),Logger.Warn=Logger._LogEnabled.bind(Logger,Logger.WarningLogLevel),Logger.Error=Logger._LogEnabled.bind(Logger,Logger.ErrorLogLevel);var Buffer2=class{getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}createVertexBuffer(e,t,i,a,n,s=!1,r){const o=s?t:t*Float32Array.BYTES_PER_ELEMENT,l=a?s?a:a*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new VertexBuffer(this._engine,this,e,this._updatable,!0,l,void 0===n?this._instanced:n,o,i,void 0,void 0,!0,this._divisor||r)}getData(){return this._data}constructor(e,t,i,a=0,n=!1,s=!1,r=!1,o,l){this._isAlreadyOwned=!1,this._isDisposed=!1,e&&e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=s,this._divisor=o||1,this._label=l,t instanceof DataBuffer?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=r?a:a*Float32Array.BYTES_PER_ELEMENT,n||this.create()}create(e=null){!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e,this._label),this._data=e):this._buffer=this._engine.createVertexBuffer(e,void 0,this._label))}update(e){this.create(e)}get isDisposed(){return this._isDisposed}getBuffer(){return this._buffer}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}updateDirectly(e,t,i,a=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,a?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===t&&void 0===i?e:null)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}isUpdatable(){return this._updatable}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Fc>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Fc,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Fc,void 0,this._label));Logger.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.Hc+")":""}. Buffer reconstruction failed.`),this._buffer=null}}},VertexBuffer=class e{_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}set instanceDivisor(e){const t=0!=e;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}updateDirectly(e,t,i=!1){this._buffer.updateDirectly(e,t,void 0,i),this._alignBuffer()}get isDisposed(){return this._isDisposed}getFloatData(t,i){const a=this.getData();return a?e.GetFloatData(a,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,i):null}getWrapperBuffer(){return this._buffer}getInstanceDivisor(){return this._instanceDivisor}update(e){this._buffer.update(e),this._alignBuffer()}forEach(t,i){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,i)}static _GetFloatValue(t,i,a,n){switch(i){case e.BYTE:{let e=t.getInt8(a);return n&&(e=Math.max(e/127,-1)),e}case e.UNSIGNED_BYTE:{let e=t.getUint8(a);return n&&(e/=255),e}case e.SHORT:{let e=t.getInt16(a,!0);return n&&(e=Math.max(e/32767,-1)),e}case e.UNSIGNED_SHORT:{let e=t.getUint16(a,!0);return n&&(e/=65535),e}case e.INT:return t.getInt32(a,!0);case e.UNSIGNED_INT:return t.getUint32(a,!0);case e.FLOAT:return t.getFloat32(a,!0);default:throw new Error(`Invalid component type ${i}`)}}getIsInstanced(){return this._instanced}get _maxVerticesCount(){const e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}create(e){this._buffer.create(e),this._alignBuffer()}getOffset(){return this.byteOffset/e.GetTypeByteLength(this.type)}static GetTypeByteLength(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error(`Invalid type '${t}'`)}}getSize(t=!1){return t?this._size*e.GetTypeByteLength(this.type):this._size}_alignBuffer(){}getStrideSize(){return this.byteStride/e.GetTypeByteLength(this.type)}constructor(t,i,a,n,s,r,o,l,c,h,u=!1,m=!1,d=1,f=!1){this._isDisposed=!1;let p=!1;if(this.engine=t,"object"==typeof n&&null!==n?(p=n.updatable??!1,s=n.postponeInternalCreation,r=n.stride,o=n.instanced,l=n.offset,c=n.size,h=n.type,u=n.normalized??!1,m=n.useBytes??!1,d=n.divisor??1,f=n.takeBufferOwnership??!1,this._label=n.label):p=!!n,i instanceof Buffer2?(this._buffer=i,this._ownsBuffer=f):(this._buffer=new Buffer2(t,i,p,r,s,o,m,d,this._label),this._ownsBuffer=!0),this.Hc=e._Counter++,this._kind=a,void 0===h){const t=this.getData();this.type=t?e.GetDataType(t):e.FLOAT}else this.type=h;const _=e.GetTypeByteLength(this.type);m?(this._size=c||(r?r/_:e.DeduceStride(a)),this.byteStride=r||this._buffer.byteStride||this._size*_,this.byteOffset=l||0):(this._size=c||r||e.DeduceStride(a),this.byteStride=r?r*_:this._buffer.byteStride||this._size*_,this.byteOffset=(l||0)*_),this.normalized=u,this._instanced=void 0!==o&&o,this._instanceDivisor=o?d:0,this._alignBuffer(),this._computeHashCode()}getBuffer(){return this._buffer.getBuffer()}getKind(){return this._kind}_rebuild(){this._buffer?._rebuild()}get instanceDivisor(){return this._instanceDivisor}static GetFloatData(t,i,a,n,s,r,o,l){const c=i*e.GetTypeByteLength(a),h=o*i;if(a!==e.FLOAT||s!==c){const o=new Float32Array(h);return e.ForEach(t,n,s,i,a,h,r,((e,t)=>o[t]=e)),o}if(!(t instanceof Array||t instanceof Float32Array)||0!==n||t.length!==h){if(t instanceof Array){const e=n/4;return t.slice(e,e+h)}if(t instanceof ArrayBuffer)return new Float32Array(t,n,h);{const e=t.byteOffset+n;if(3&e&&(Logger.Warn("Float array must be aligned to 4-bytes border"),l=!0),l){const i=new Uint8Array(h*Float32Array.BYTES_PER_ELEMENT),a=new Uint8Array(t.buffer,e,i.length);return i.set(a),new Float32Array(i.buffer)}return new Float32Array(t.buffer,e,h)}}return l?t.slice():t}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}static GetDataType(t){return t instanceof Int8Array?e.BYTE:t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int16Array?e.SHORT:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int32Array?e.INT:t instanceof Uint32Array?e.UNSIGNED_INT:e.FLOAT}static ForEach(t,i,a,n,s,r,o,l){if(t instanceof Array){let e=i/4;const s=a/4;for(let i=0;i<r;i+=n){for(let a=0;a<n;a++)l(t[e+a],i+a);e+=s}}else{const c=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),h=e.GetTypeByteLength(s);for(let t=0;t<r;t+=n){let r=i;for(let i=0;i<n;i++){l(e._GetFloatValue(c,s,r,o),t+i),r+=h}i+=a}}}getData(){return this._buffer.getData()}static DeduceStride(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.ColorInstanceKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}isUpdatable(){return this._buffer.isUpdatable()}};function inlineScheduler(e,t,i){try{const a=e.next();a.done?t(a):a.value?a.value.then((()=>{a.value=void 0,t(a)}),i):t(a)}catch(e){i(e)}}function createYieldingScheduler(e=25){let t;return(i,a,n)=>{const s=performance.now();void 0===t||s-t>e?(t=s,setTimeout((()=>{inlineScheduler(i,a,n)}),0)):inlineScheduler(i,a,n)}}function runCoroutine(e,t,i,a,n){const s=()=>{let r;const o=e=>{e.done?i(e.value):void 0===r?r=!0:s()};do{r=void 0,n&&n.aborted?a(new Error("Aborted")):t(e,o,a),void 0===r&&(r=!1)}while(r)};s()}function runCoroutineSync(e,t){let i;return runCoroutine(e,inlineScheduler,(e=>i=e),(e=>{throw e}),t),i}function runCoroutineAsync(e,t,i){return new Promise(((a,n)=>{runCoroutine(e,t,a,n,i)}))}function makeSyncFunction(e,t){return(...i)=>runCoroutineSync(e(...i),t)}VertexBuffer._Counter=0,VertexBuffer.BYTE=5120,VertexBuffer.UNSIGNED_BYTE=5121,VertexBuffer.SHORT=5122,VertexBuffer.UNSIGNED_SHORT=5123,VertexBuffer.INT=5124,VertexBuffer.UNSIGNED_INT=5125,VertexBuffer.FLOAT=5126,VertexBuffer.PositionKind="position",VertexBuffer.NormalKind="normal",VertexBuffer.TangentKind="tangent",VertexBuffer.UVKind="uv",VertexBuffer.UV2Kind="uv2",VertexBuffer.UV3Kind="uv3",VertexBuffer.UV4Kind="uv4",VertexBuffer.UV5Kind="uv5",VertexBuffer.UV6Kind="uv6",VertexBuffer.ColorKind="color",VertexBuffer.ColorInstanceKind="instanceColor",VertexBuffer.MatricesIndicesKind="matricesIndices",VertexBuffer.MatricesWeightsKind="matricesWeights",VertexBuffer.MatricesIndicesExtraKind="matricesIndicesExtra",VertexBuffer.MatricesWeightsExtraKind="matricesWeightsExtra";var BaseError=class extends Error{};BaseError._setPrototypeOf=Object.setPrototypeOf||((e,t)=>(e.__proto__=t,e));var ErrorCodes={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},RuntimeError=class e extends BaseError{constructor(t,i,a){super(t),this.errorCode=i,this.innerError=a,this.name="RuntimeError",BaseError._setPrototypeOf(this,e.prototype)}},IntersectionInfo=class{constructor(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}},BoundingBox=class e{scale(t){const i=e._TmpVector3,a=this.maximum.subtractToRef(this.minimum,i[0]),n=a.length();a.normalizeFromLength(n);const s=n*t,r=a.scaleInPlace(.5*s),o=this.center.subtractToRef(r,i[1]),l=this.center.addToRef(r,i[2]);return this.reConstruct(o,l,this._worldMatrix),this}dispose(){this._drawWrapperFront?.dispose(),this._drawWrapperBack?.dispose()}intersectsSphere(t){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}static IntersectsSphere(t,i,a,n){const s=e._TmpVector3[0];Vector3.ClampToRef(a,t,i,s);return Vector3.DistanceSquared(a,s)<=n*n}static IsInFrustum(e,t){for(let i=0;i<6;++i){let a=!0;const n=t[i];for(let t=0;t<8;++t)if(n.dotCoordinate(e[t])>=0){a=!1;break}if(a)return!1}return!0}constructor(e,t,i){this.vectors=BuildArray(8,Vector3.Zero),this.center=Vector3.Zero(),this.centerWorld=Vector3.Zero(),this.extendSize=Vector3.Zero(),this.extendSizeWorld=Vector3.Zero(),this.directions=BuildArray(3,Vector3.Zero),this.vectorsWorld=BuildArray(8,Vector3.Zero),this.minimumWorld=Vector3.Zero(),this.maximumWorld=Vector3.Zero(),this.minimum=Vector3.Zero(),this.maximum=Vector3.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,i)}static IsCompletelyInFrustum(e,t){for(let i=0;i<6;++i){const a=t[i];for(let t=0;t<8;++t)if(a.dotCoordinate(e[t])<0)return!1}return!0}isCompletelyInFrustum(t){return e.IsCompletelyInFrustum(this.vectorsWorld,t)}reConstruct(e,t,i){const a=e.x,n=e.y,s=e.z,r=t.x,o=t.y,l=t.z,c=this.vectors;this.minimum.copyFromFloats(a,n,s),this.maximum.copyFromFloats(r,o,l),c[0].copyFromFloats(a,n,s),c[1].copyFromFloats(r,o,l),c[2].copyFromFloats(r,n,s),c[3].copyFromFloats(a,o,s),c[4].copyFromFloats(a,n,l),c[5].copyFromFloats(r,o,s),c[6].copyFromFloats(a,o,l),c[7].copyFromFloats(r,n,l),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||Matrix.IdentityReadOnly,this._update(this._worldMatrix)}getWorldMatrix(){return this._worldMatrix}intersectsMinMax(e,t){const i=this.minimumWorld,a=this.maximumWorld,n=i.x,s=i.y,r=i.z,o=a.x,l=a.y,c=a.z,h=e.x,u=e.y,m=e.z,d=t.x,f=t.y,p=t.z;return!(o<h||n>d)&&(!(l<u||s>f)&&!(c<m||r>p))}static Intersects(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}isInFrustum(t){return e.IsInFrustum(this.vectorsWorld,t)}_update(e){const t=this.minimumWorld,i=this.maximumWorld,a=this.directions,n=this.vectorsWorld,s=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let e=0;e<8;++e)n[e].copyFrom(s[e]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let a=0;a<8;++a){const r=n[a];Vector3.TransformCoordinatesToRef(s[a],e,r),t.minimizeInPlace(r),i.maximizeInPlace(r)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}Vector3.FromArrayToRef(e.m,0,a[0]),Vector3.FromArrayToRef(e.m,4,a[1]),Vector3.FromArrayToRef(e.m,8,a[2]),this._worldMatrix=e}intersectsPoint(e){const t=this.minimumWorld,i=this.maximumWorld,a=t.x,n=t.y,s=t.z,r=i.x,o=i.y,l=i.z,c=e.x,h=e.y,u=e.z,m=-Epsilon;return!(r-c<m||m>c-a)&&(!(o-h<m||m>h-n)&&!(l-u<m||m>u-s))}};BoundingBox._TmpVector3=BuildArray(3,Vector3.Zero);var BoundingSphere=class e{static Intersects(e,t){const i=Vector3.DistanceSquared(e.centerWorld,t.centerWorld),a=e.radiusWorld+t.radiusWorld;return!(a*a<i)}intersectsPoint(e){const t=Vector3.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}isInFrustum(e){const t=this.centerWorld,i=this.radiusWorld;for(let a=0;a<6;a++)if(e[a].dotCoordinate(t)<=-i)return!1;return!0}isCenterInFrustum(e){const t=this.centerWorld;for(let i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0}getWorldMatrix(){return this._worldMatrix}reConstruct(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);const a=Vector3.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*a,this._update(i||Matrix.IdentityReadOnly)}static CreateFromCenterAndRadius(t,i,a){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,i),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const n=new e(this._TmpVector3[0],this._TmpVector3[2]);return n._worldMatrix=a||Matrix.Identity(),n}_update(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld);const i=e._TmpVector3[0];Vector3.TransformNormalFromFloatsToRef(1,1,1,t,i),this.radiusWorld=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z))*this.radius}}scale(t){const i=this.radius*t,a=e._TmpVector3,n=a[0].setAll(i),s=this.center.subtractToRef(n,a[1]),r=this.center.addToRef(n,a[2]);return this.reConstruct(s,r,this._worldMatrix),this}constructor(e,t,i){this.center=Vector3.Zero(),this.centerWorld=Vector3.Zero(),this.minimum=Vector3.Zero(),this.maximum=Vector3.Zero(),this.reConstruct(e,t,i)}};BoundingSphere._TmpVector3=BuildArray(3,Vector3.Zero);var _result0={min:0,max:0},_result1={min:0,max:0},computeBoxExtents=(e,t,i)=>{const a=Vector3.Dot(t.centerWorld,e),n=Math.abs(Vector3.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(Vector3.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(Vector3.Dot(t.directions[2],e))*t.extendSize.z;i.min=a-n,i.max=a+n},axisOverlap=(e,t,i)=>(computeBoxExtents(e,t,_result0),computeBoxExtents(e,i,_result1),!(_result0.min>_result1.max||_result1.min>_result0.max)),BoundingInfo=class e{update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}encapsulateBoundingInfo(e){const t=TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);const i=TmpVectors.Vector3[0];return Vector3.TransformCoordinatesToRef(e.boundingBox.minimumWorld,t,i),this.encapsulate(i),Vector3.TransformCoordinatesToRef(e.boundingBox.maximumWorld,t,i),this.encapsulate(i),this}constructor(e,t,i){this._isLocked=!1,this.boundingBox=new BoundingBox(e,t,i),this.boundingSphere=new BoundingSphere(e,t,i)}isInFrustum(e,t=0){if((2===t||3===t)&&this.boundingSphere.isCenterInFrustum(e))return!0;if(!this.boundingSphere.isInFrustum(e))return!1;return!(1!==t&&3!==t)||this.boundingBox.isInFrustum(e)}reConstruct(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)}get diagonalLength(){const t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,e._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}get maximum(){return this.boundingBox.maximum}intersects(e,t){if(!BoundingSphere.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!BoundingBox.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;const i=this.boundingBox,a=e.boundingBox;return!!axisOverlap(i.directions[0],i,a)&&(!!axisOverlap(i.directions[1],i,a)&&(!!axisOverlap(i.directions[2],i,a)&&(!!axisOverlap(a.directions[0],i,a)&&(!!axisOverlap(a.directions[1],i,a)&&(!!axisOverlap(a.directions[2],i,a)&&(!!axisOverlap(Vector3.Cross(i.directions[0],a.directions[0]),i,a)&&(!!axisOverlap(Vector3.Cross(i.directions[0],a.directions[1]),i,a)&&(!!axisOverlap(Vector3.Cross(i.directions[0],a.directions[2]),i,a)&&(!!axisOverlap(Vector3.Cross(i.directions[1],a.directions[0]),i,a)&&(!!axisOverlap(Vector3.Cross(i.directions[1],a.directions[1]),i,a)&&(!!axisOverlap(Vector3.Cross(i.directions[1],a.directions[2]),i,a)&&(!!axisOverlap(Vector3.Cross(i.directions[2],a.directions[0]),i,a)&&(!!axisOverlap(Vector3.Cross(i.directions[2],a.directions[1]),i,a)&&!!axisOverlap(Vector3.Cross(i.directions[2],a.directions[2]),i,a))))))))))))))}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}encapsulate(e){const t=Vector3.Minimize(this.minimum,e),i=Vector3.Maximize(this.maximum,e);return this.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this}intersectsPoint(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))}set isLocked(e){this._isLocked=e}get minimum(){return this.boundingBox.minimum}get isLocked(){return this._isLocked}centerOn(t,i){const a=e._TmpVector3[0].copyFrom(t).subtractInPlace(i),n=e._TmpVector3[1].copyFrom(t).addInPlace(i);return this.boundingBox.reConstruct(a,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(a,n,this.boundingBox.getWorldMatrix()),this}};BoundingInfo._TmpVector3=BuildArray(2,Vector3.Zero);var MathHelpers=class{static extractMinAndMax(e,t,i,a,n,s){for(let r=t,o=t*a;r<t+i;r++,o+=a){const t=e[o],i=e[o+1],a=e[o+2];n.minimizeInPlaceFromFloats(t,i,a),s.maximizeInPlaceFromFloats(t,i,a)}}static extractMinAndMaxIndexed(e,t,i,a,n,s){for(let r=i;r<i+a;r++){const i=3*t[r],a=e[i],o=e[i+1],l=e[i+2];n.minimizeInPlaceFromFloats(a,o,l),s.maximizeInPlaceFromFloats(a,o,l)}}};function extractMinAndMaxIndexed(e,t,i,a,n=null){const s=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return MathHelpers.extractMinAndMaxIndexed(e,t,i,a,s,r),n&&(s.x-=s.x*n.x+n.y,s.y-=s.y*n.x+n.y,s.z-=s.z*n.x+n.y,r.x+=r.x*n.x+n.y,r.y+=r.y*n.x+n.y,r.z+=r.z*n.x+n.y),{minimum:s,maximum:r}}function extractMinAndMax(e,t,i,a=null,n){const s=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n||(n=3),MathHelpers.extractMinAndMax(e,t,i,n,s,r),a&&(s.x-=s.x*a.x+a.y,s.y-=s.y*a.x+a.y,s.z-=s.z*a.x+a.y,r.x+=r.x*a.x+a.y,r.y+=r.y*a.x+a.y,r.z+=r.z*a.x+a.y),{minimum:s,maximum:r}}__decorate([nativeOverride.filter(((...[e,t])=>!Array.isArray(e)&&!Array.isArray(t)))],MathHelpers,"extractMinAndMaxIndexed",null),__decorate([nativeOverride.filter(((...[e])=>!Array.isArray(e)))],MathHelpers,"extractMinAndMax",null);var DrawWrapper=class{dispose(){this.drawContext?.dispose()}static GetEffect(e){return void 0===e.getPipelineContext?e.effect:e}setEffect(e,t,i=!0){this.effect=e,void 0!==t&&(this.defines=t),i&&this.drawContext?.reset()}constructor(e,t=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}},SubMesh=class e{_intersectUnIndexedLines(e,t,i,a,n){let s=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=2){const r=t[i],o=t[i+1],l=e.intersectionSegment(r,o,a);if(!(l<0)&&((n||!s||l<s.distance)&&(s=new IntersectionInfo(null,null,l),s.faceId=i/2,n)))break}return s}constructor(e,t,i,a,n,s,r,o=!0,l=!0){this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=a,this.indexCount=n,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=r||s,l&&s.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=s.subMeshes.length-1,o&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}getRenderingMesh(){return this._renderingMesh}get materialDefines(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:this._getDrawWrapper()?.defines}getClassName(){return"SubMesh"}getEffectiveMesh(){const e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}refreshBoundingInfo(e=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(VertexBuffer.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const t=this._renderingMesh.getIndices();let i;if(0===this.indexStart&&this.indexCount===t.length){const e=this._renderingMesh.getBoundingInfo();i={minimum:e.minimum.clone(),maximum:e.maximum.clone()}}else i=extractMinAndMaxIndexed(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new BoundingInfo(i.minimum,i.maximum),this}static AddToMesh(t,i,a,n,s,r,o,l=!0){return new e(t,i,a,n,s,r,o,l)}set materialDefines(e){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=e}getMaterial(e=!0){const t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!t)return e?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(t)){const e=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this.resetDrawCache()),e}return t}intersects(e,t,i,a,n){const s=this.getMaterial();if(!s)return null;let r=3,o=!1;switch(s.fillMode){case 3:case 5:case 6:case 8:return null;case 7:r=1,o=!0}return 4===s.fillMode?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,a):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,a):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,a,n):this._intersectTriangles(e,t,i,r,o,a,n)}static CreateFromIndices(t,i,a,n,s,r=!0){let o=Number.MAX_VALUE,l=-Number.MAX_VALUE;const c=(s||n).getIndices();for(let e=i;e<i+a;e++){const t=c[e];t<o&&(o=t),t>l&&(l=t)}return new e(t,o,l-o+1,i,a,n,s,r)}setEffect(e,t=null,i,a=!0){const n=this._drawWrapper;n.setEffect(e,t,a),void 0!==i&&(n.materialContext=i),e||(n.defines=null,n.materialContext=void 0)}isCompletelyInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}dispose(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}isInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)}get effect(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:this._getDrawWrapper()?.effect??null}canIntersects(e){const t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}clone(t,i){const a=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,i,!1);if(!this.IsGlobal){const e=this.getBoundingInfo();if(!e)return a;a._boundingInfo=new BoundingInfo(e.minimum,e.maximum)}return a}_isMultiMaterial(e){return void 0!==e.getSubMaterial}resetDrawCache(e){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e);for(const e of this._drawWrappers)e?.dispose()}this._drawWrappers=[]}_intersectUnIndexedTriangles(e,t,i,a,n){let s=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=3){const r=t[i],o=t[i+1],l=t[i+2];if(n&&!n(r,o,l,e,-1,-1,-1))continue;const c=e.intersectsTriangle(r,o,l);if(c){if(c.distance<0)continue;if((a||!s||c.distance<s.distance)&&(s=c,s.faceId=i/3,a))break}}return s}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}setBoundingInfo(e){return this._boundingInfo=e,this}_getDrawWrapper(e,t=!1){e=e??this._engine.currentRenderPassId;let i=this._drawWrappers[e];return!i&&t&&(this._drawWrappers[e]=i=new DrawWrapper(this._mesh.getScene().getEngine())),i}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){const i=[];for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)i.push(e[t],e[t+1],e[t+1],e[t+2],e[t+2],e[t]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer}getMesh(){return this._mesh}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}_intersectLines(e,t,i,a,n){let s=null;for(let r=this.indexStart;r<this.indexStart+this.indexCount;r+=2){const o=t[i[r]],l=t[i[r+1]],c=e.intersectionSegment(o,l,a);if(!(c<0)&&((n||!s||c<s.distance)&&(s=new IntersectionInfo(null,null,c),s.faceId=r/2,n)))break}return s}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_removeDrawWrapper(e,t=!0){t&&this._drawWrappers[e]?.dispose(),this._drawWrappers[e]=void 0}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}_intersectTriangles(e,t,i,a,n,s,r){let o=null,l=-1;for(let c=this.indexStart;c<this.indexStart+this.indexCount-(3-a);c+=a){l++;const a=i[c],h=i[c+1],u=i[c+2];if(n&&4294967295===u){c+=2;continue}const m=t[a],d=t[h],f=t[u];if(!m||!d||!f)continue;if(r&&!r(m,d,f,e,a,h,u))continue;const p=e.intersectsTriangle(m,d,f);if(p){if(p.distance<0)continue;if((s||!o||p.distance<o.distance)&&(o=p,o.faceId=l,s))break}}return o}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}},VertexDataMaterialInfo=class{},VertexData=class e{splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const t=[];for(const i of this.materialInfos){const a=new e;if(this.positions&&(a.positions=this.positions.slice(3*i.verticesStart,3*(i.verticesCount+i.verticesStart))),this.normals&&(a.normals=this.normals.slice(3*i.verticesStart,3*(i.verticesCount+i.verticesStart))),this.tangents&&(a.tangents=this.tangents.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.colors&&(a.colors=this.colors.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.uvs&&(a.uvs=this.uvs.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs2&&(a.uvs2=this.uvs2.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs3&&(a.uvs3=this.uvs3.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs4&&(a.uvs4=this.uvs4.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs5&&(a.uvs5=this.uvs5.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs6&&(a.uvs6=this.uvs6.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.matricesIndices&&(a.matricesIndices=this.matricesIndices.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesIndicesExtra&&(a.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesWeights&&(a.matricesWeights=this.matricesWeights.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesWeightsExtra&&(a.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.indices){a.indices=[];for(let e=i.indexStart;e<i.indexStart+i.indexCount;e++)a.indices.push(this.indices[e]-i.verticesStart)}const n=new VertexDataMaterialInfo;n.indexStart=0,n.indexCount=a.indices?a.indices.length:0,n.materialIndex=i.materialIndex,n.verticesStart=0,n.verticesCount=(a.positions?a.positions.length:0)/3,a.materialInfos=[n],t.push(a)}return t}static vc(e){throw _WarnImport("sphereBuilder")}static Ec(e){throw _WarnImport("cylinderBuilder")}_validate(){if(!this.positions)throw new RuntimeError("Positions are required",ErrorCodes.MeshInvalidPositionsError);const e=(e,t)=>{const i=VertexBuffer.DeduceStride(e);if(t.length%i!=0)throw new Error("The "+e+"s array count must be a multiple of "+i);return t.length/i},t=e(VertexBuffer.PositionKind,this.positions),i=(i,a)=>{const n=e(i,a);if(n!==t)throw new Error("The "+i+"s element count ("+n+") does not match the positions count ("+t+")")};this.normals&&i(VertexBuffer.NormalKind,this.normals),this.tangents&&i(VertexBuffer.TangentKind,this.tangents),this.uvs&&i(VertexBuffer.UVKind,this.uvs),this.uvs2&&i(VertexBuffer.UV2Kind,this.uvs2),this.uvs3&&i(VertexBuffer.UV3Kind,this.uvs3),this.uvs4&&i(VertexBuffer.UV4Kind,this.uvs4),this.uvs5&&i(VertexBuffer.UV5Kind,this.uvs5),this.uvs6&&i(VertexBuffer.UV6Kind,this.uvs6),this.colors&&i(VertexBuffer.ColorKind,this.colors),this.matricesIndices&&i(VertexBuffer.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(VertexBuffer.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra)}applyToMesh(e,t){return this._applyTo(e,t,!1),this}static ExtractFromGeometry(t,i,a){return e._ExtractFrom(t,i,a)}updateGeometry(e){return this._update(e),this}static Nc(e){throw _WarnImport("planeBuilder")}static _FlipFaces(e,t=0,i=e.length){for(let a=t;a<t+i;a+=3){const t=e[a+1];e[a+1]=e[a+2],e[a+2]=t}}static nc(e){throw _WarnImport("discBuilder")}static _TransformVector4Normals(e,t,i=0,a=e.length){const n=TmpVectors.Vector4[0],s=TmpVectors.Vector4[1];for(let r=i;r<i+a;r+=4)Vector4.FromArrayToRef(e,r,n),Vector4.TransformNormalToRef(n,t,s),e[r]=s.x,e[r+1]=s.y,e[r+2]=s.z,e[r+3]=s.w}static _ComputeSides(t,i,a,n,s,r,o){const l=a.length,c=n.length;let h,u;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:for(h=0;h<l;h+=3){const e=a[h];a[h]=a[h+2],a[h+2]=e}for(u=0;u<c;u++)n[u]=-n[u];break;case e.DOUBLESIDE:{const e=i.length,t=e/3;for(let t=0;t<e;t++)i[e+t]=i[t];for(h=0;h<l;h+=3)a[h+l]=a[h+2]+t,a[h+1+l]=a[h+1]+t,a[h+2+l]=a[h]+t;for(u=0;u<c;u++)n[c+u]=-n[u];const m=s.length;let d=0;for(d=0;d<m;d++)s[d+m]=s[d];for(r=r||new Vector4(0,0,1,1),o=o||new Vector4(0,0,1,1),d=0,h=0;h<m/2;h++)s[d]=r.x+(r.z-r.x)*s[d],s[d+1]=r.y+(r.w-r.y)*s[d+1],s[d+m]=o.x+(o.z-o.x)*s[d+m],s[d+m+1]=o.y+(o.w-o.y)*s[d+m+1],d+=2;break}}}static CreateTorusKnot(e){throw _WarnImport("torusKnotBuilder")}static Mc(e){throw _WarnImport("boxBuilder")}static ComputeNormals(e,t,i,a){let n=0,s=0,r=0,o=0,l=0,c=0,h=0,u=0,m=0,d=0,f=0,p=0,_=0,g=0,v=0,y=0,S=0,C=0,E=0,A=0,T=!1,M=!1,x=!1,b=!1,w=1,I=0,P=null;a&&(T=!!a.facetNormals,M=!!a.facetPositions,x=!!a.facetPartitioning,w=!0===a.useRightHandedSystem?-1:1,I=a.ratio||0,b=!!a.depthSort,P=a.distanceTo,b&&void 0===P&&(P=Vector3.Zero()));let R=0,N=0,k=0,D=0;for(x&&a&&a.bbSize&&(R=a.subDiv.X*I/a.bbSize.x,N=a.subDiv.Y*I/a.bbSize.y,k=a.subDiv.Z*I/a.bbSize.z,D=a.subDiv.max*a.subDiv.max,a.facetPartitioning.length=0),n=0;n<e.length;n++)i[n]=0;const B=t.length/3|0;for(n=0;n<B;n++){if(p=3*t[3*n],_=p+1,g=p+2,v=3*t[3*n+1],y=v+1,S=v+2,C=3*t[3*n+2],E=C+1,A=C+2,s=e[p]-e[v],r=e[_]-e[y],o=e[g]-e[S],l=e[C]-e[v],c=e[E]-e[y],h=e[A]-e[S],u=w*(r*h-o*c),m=w*(o*l-s*h),d=w*(s*c-r*l),f=Math.sqrt(u*u+m*m+d*d),f=0===f?1:f,u/=f,m/=f,d/=f,T&&a&&(a.facetNormals[n].x=u,a.facetNormals[n].y=m,a.facetNormals[n].z=d),M&&a&&(a.facetPositions[n].x=(e[p]+e[v]+e[C])/3,a.facetPositions[n].y=(e[_]+e[y]+e[E])/3,a.facetPositions[n].z=(e[g]+e[S]+e[A])/3),x&&a){const t=Math.floor((a.facetPositions[n].x-a.bInfo.minimum.x*I)*R),i=Math.floor((a.facetPositions[n].y-a.bInfo.minimum.y*I)*N),s=Math.floor((a.facetPositions[n].z-a.bInfo.minimum.z*I)*k),r=Math.floor((e[p]-a.bInfo.minimum.x*I)*R),o=Math.floor((e[_]-a.bInfo.minimum.y*I)*N),l=Math.floor((e[g]-a.bInfo.minimum.z*I)*k),c=Math.floor((e[v]-a.bInfo.minimum.x*I)*R),h=Math.floor((e[y]-a.bInfo.minimum.y*I)*N),u=Math.floor((e[S]-a.bInfo.minimum.z*I)*k),m=Math.floor((e[C]-a.bInfo.minimum.x*I)*R),d=Math.floor((e[E]-a.bInfo.minimum.y*I)*N),f=Math.floor((e[A]-a.bInfo.minimum.z*I)*k),T=r+a.subDiv.max*o+D*l,M=c+a.subDiv.max*h+D*u,x=m+a.subDiv.max*d+D*f,b=t+a.subDiv.max*i+D*s;a.facetPartitioning[b]=a.facetPartitioning[b]?a.facetPartitioning[b]:new Array,a.facetPartitioning[T]=a.facetPartitioning[T]?a.facetPartitioning[T]:new Array,a.facetPartitioning[M]=a.facetPartitioning[M]?a.facetPartitioning[M]:new Array,a.facetPartitioning[x]=a.facetPartitioning[x]?a.facetPartitioning[x]:new Array,a.facetPartitioning[T].push(n),M!=T&&a.facetPartitioning[M].push(n),x!=M&&x!=T&&a.facetPartitioning[x].push(n),b!=T&&b!=M&&b!=x&&a.facetPartitioning[b].push(n)}if(b&&a&&a.facetPositions){const e=a.depthSortedFacets[n];e.ind=3*n,e.sqDistance=Vector3.DistanceSquared(a.facetPositions[n],P)}i[p]+=u,i[_]+=m,i[g]+=d,i[v]+=u,i[y]+=m,i[S]+=d,i[C]+=u,i[E]+=m,i[A]+=d}for(n=0;n<i.length/3;n++)u=i[3*n],m=i[3*n+1],d=i[3*n+2],f=Math.sqrt(u*u+m*m+d*d),f=0===f?1:f,u/=f,m/=f,d/=f,i[3*n]=u,i[3*n+1]=m,i[3*n+2]=d}merge(e,t=!1,i=!1,a=!1,n=!1){const s=Array.isArray(e)?e.map((e=>({vertexData:e}))):[{vertexData:e}];return runCoroutineSync(this._mergeCoroutine(void 0,s,t,!1,i,a,n))}static _MergeElement(t,i,a,n){const s=n.filter((e=>null!==e[0]&&void 0!==e[0]));if(!i&&0==s.length)return i;if(!i)return this._MergeElement(t,s[0][0],s[0][1],s.slice(1));const r=s.reduce(((e,t)=>e+t[0].length),i.length),o=t===VertexBuffer.PositionKind?e._TransformVector3Coordinates:t===VertexBuffer.NormalKind?e._TransformVector3Normals:t===VertexBuffer.TangentKind?e._TransformVector4Normals:()=>{};if(i instanceof Float32Array){const e=new Float32Array(r);e.set(i),a&&o(e,a,0,i.length);let t=i.length;for(const[i,a]of s)e.set(i,t),a&&o(e,a,t,i.length),t+=i.length;return e}{const e=new Array(r);for(let t=0;t<i.length;t++)e[t]=i[t];a&&o(e,a,0,i.length);let t=i.length;for(const[i,a]of s){for(let a=0;a<i.length;a++)e[t+a]=i[a];a&&o(e,a,t,i.length),t+=i.length}return e}}constructor(){this.Hc=0,this.metadata={},this._applyTo=makeSyncFunction(this._applyToCoroutine.bind(this)),this.Hc=e._UniqueIDGenerator,e._UniqueIDGenerator++}static CreateTiledGround(e){throw _WarnImport("groundBuilder")}static _TransformVector3Coordinates(e,t,i=0,a=e.length){const n=TmpVectors.Vector3[0],s=TmpVectors.Vector3[1];for(let r=i;r<i+a;r+=3)Vector3.FromArrayToRef(e,r,n),Vector3.TransformCoordinatesToRef(n,t,s),e[r]=s.x,e[r+1]=s.y,e[r+2]=s.z}applyToGeometry(e,t){return this._applyTo(e,t,!1),this}static CreateTiledPlane(e){throw _WarnImport("tiledPlaneBuilder")}set(e,t){switch(e.length||Logger.Warn(`Setting vertex data kind '${t}' with an empty array`),t){case VertexBuffer.PositionKind:this.positions=e;break;case VertexBuffer.NormalKind:this.normals=e;break;case VertexBuffer.TangentKind:this.tangents=e;break;case VertexBuffer.UVKind:this.uvs=e;break;case VertexBuffer.UV2Kind:this.uvs2=e;break;case VertexBuffer.UV3Kind:this.uvs3=e;break;case VertexBuffer.UV4Kind:this.uvs4=e;break;case VertexBuffer.UV5Kind:this.uvs5=e;break;case VertexBuffer.UV6Kind:this.uvs6=e;break;case VertexBuffer.ColorKind:this.colors=e;break;case VertexBuffer.MatricesIndicesKind:this.matricesIndices=e;break;case VertexBuffer.MatricesWeightsKind:this.matricesWeights=e;break;case VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}}static CreateTorus(e){throw _WarnImport("torusBuilder")}clone(){const t=this.serialize();return e.Parse(t)}updateMesh(e){return this._update(e),this}static Parse(t){const i=new e,a=t.positions;a&&i.set(a,VertexBuffer.PositionKind);const n=t.normals;n&&i.set(n,VertexBuffer.NormalKind);const s=t.tangents;s&&i.set(s,VertexBuffer.TangentKind);const r=t.uvs;r&&i.set(r,VertexBuffer.UVKind);const o=t.uvs2;o&&i.set(o,VertexBuffer.UV2Kind);const l=t.uvs3;l&&i.set(l,VertexBuffer.UV3Kind);const c=t.uvs4;c&&i.set(c,VertexBuffer.UV4Kind);const h=t.uvs5;h&&i.set(h,VertexBuffer.UV5Kind);const u=t.uvs6;u&&i.set(u,VertexBuffer.UV6Kind);const m=t.colors;m&&(i.set(Color4.CheckColors4(m,a.length/3),VertexBuffer.ColorKind),void 0!==t.hasVertexAlpha&&(i.hasVertexAlpha=t.hasVertexAlpha));const d=t.matricesIndices;d&&i.set(d,VertexBuffer.MatricesIndicesKind);const f=t.matricesWeights;f&&i.set(f,VertexBuffer.MatricesWeightsKind);const p=t.indices;p&&(i.indices=p);const _=t.materialInfos;if(_){i.materialInfos=[];for(const e of _){const t=new VertexDataMaterialInfo;t.indexCount=e.indexCount,t.indexStart=e.indexStart,t.verticesCount=e.verticesCount,t.verticesStart=e.verticesStart,t.materialIndex=e.materialIndex,i.materialInfos.push(t)}}return i}static CreateTiledBox(e){throw _WarnImport("tiledBoxBuilder")}static ExtractFromMesh(t,i,a){return e._ExtractFrom(t,i,a)}static CreatePolygon(e,t,i,a,n,s,r){throw _WarnImport("polygonBuilder")}static CreateLineSystem(e){throw _WarnImport("linesBuilder")}static CreateGroundFromHeightMap(e){throw _WarnImport("groundBuilder")}static _ExtractFrom(t,i,a){const n=new e;if(t.isVerticesDataPresent(VertexBuffer.PositionKind)&&(n.positions=t.getVerticesData(VertexBuffer.PositionKind,i,a)),t.isVerticesDataPresent(VertexBuffer.NormalKind)&&(n.normals=t.getVerticesData(VertexBuffer.NormalKind,i,a)),t.isVerticesDataPresent(VertexBuffer.TangentKind)&&(n.tangents=t.getVerticesData(VertexBuffer.TangentKind,i,a)),t.isVerticesDataPresent(VertexBuffer.UVKind)&&(n.uvs=t.getVerticesData(VertexBuffer.UVKind,i,a)),t.isVerticesDataPresent(VertexBuffer.UV2Kind)&&(n.uvs2=t.getVerticesData(VertexBuffer.UV2Kind,i,a)),t.isVerticesDataPresent(VertexBuffer.UV3Kind)&&(n.uvs3=t.getVerticesData(VertexBuffer.UV3Kind,i,a)),t.isVerticesDataPresent(VertexBuffer.UV4Kind)&&(n.uvs4=t.getVerticesData(VertexBuffer.UV4Kind,i,a)),t.isVerticesDataPresent(VertexBuffer.UV5Kind)&&(n.uvs5=t.getVerticesData(VertexBuffer.UV5Kind,i,a)),t.isVerticesDataPresent(VertexBuffer.UV6Kind)&&(n.uvs6=t.getVerticesData(VertexBuffer.UV6Kind,i,a)),t.isVerticesDataPresent(VertexBuffer.ColorKind)){const e=t.geometry||t,s=e.getVertexBuffer(VertexBuffer.ColorKind),r=e.getVerticesData(VertexBuffer.ColorKind,i,a);if(3===s.getSize()){const e=new Float32Array(4*r.length/3);for(let t=0,i=0;t<r.length;t+=3,i+=4)e[i]=r[t],e[i+1]=r[t+1],e[i+2]=r[t+2],e[i+3]=1;n.colors=e}else{if(4!==s.getSize())throw new Error(`Unexpected number of color components: ${s.getSize()}`);n.colors=r}}return t.isVerticesDataPresent(VertexBuffer.MatricesIndicesKind)&&(n.matricesIndices=t.getVerticesData(VertexBuffer.MatricesIndicesKind,i,a)),t.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind)&&(n.matricesWeights=t.getVerticesData(VertexBuffer.MatricesWeightsKind,i,a)),t.isVerticesDataPresent(VertexBuffer.MatricesIndicesExtraKind)&&(n.matricesIndicesExtra=t.getVerticesData(VertexBuffer.MatricesIndicesExtraKind,i,a)),t.isVerticesDataPresent(VertexBuffer.MatricesWeightsExtraKind)&&(n.matricesWeightsExtra=t.getVerticesData(VertexBuffer.MatricesWeightsExtraKind,i,a)),n.indices=t.getIndices(i,a),n}static ImportVertexData(t,i){const a=e.Parse(t);i.setAllVerticesData(a,t.updatable)}static CreateGround(e){throw _WarnImport("groundBuilder")}serialize(){const e={};if(this.positions&&(e.positions=Array.from(this.positions)),this.normals&&(e.normals=Array.from(this.normals)),this.tangents&&(e.tangents=Array.from(this.tangents)),this.uvs&&(e.uvs=Array.from(this.uvs)),this.uvs2&&(e.uvs2=Array.from(this.uvs2)),this.uvs3&&(e.uvs3=Array.from(this.uvs3)),this.uvs4&&(e.uvs4=Array.from(this.uvs4)),this.uvs5&&(e.uvs5=Array.from(this.uvs5)),this.uvs6&&(e.uvs6=Array.from(this.uvs6)),this.colors&&(e.colors=Array.from(this.colors),e.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(e.matricesIndices=Array.from(this.matricesIndices),e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(e.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),e.indices=Array.from(this.indices),this.materialInfos){e.materialInfos=[];for(const t of this.materialInfos){const i={indexStart:t.indexStart,indexCount:t.indexCount,materialIndex:t.materialIndex,verticesStart:t.verticesStart,verticesCount:t.verticesCount};e.materialInfos.push(i)}}return e}static CreateCapsule(e={orientation:Vector3.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw _WarnImport("capsuleBuilder")}*_mergeCoroutine(t,i,a=!1,n,s,r=!1,o=!1){this._validate();let l=i.map((e=>e.vertexData)),c=this;if(o)for(const e of l)e&&(e._validate(),!this.normals&&e.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&e.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&e.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&e.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&e.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&e.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&e.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&e.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&e.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&e.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&e.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&e.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&e.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(const e of l)if(e)if(o)this.normals&&!e.normals&&(e.normals=new Float32Array(e.positions.length)),this.tangents&&!e.tangents&&(e.tangents=new Float32Array(e.positions.length/3*4)),this.uvs&&!e.uvs&&(e.uvs=new Float32Array(e.positions.length/3*2)),this.uvs2&&!e.uvs2&&(e.uvs2=new Float32Array(e.positions.length/3*2)),this.uvs3&&!e.uvs3&&(e.uvs3=new Float32Array(e.positions.length/3*2)),this.uvs4&&!e.uvs4&&(e.uvs4=new Float32Array(e.positions.length/3*2)),this.uvs5&&!e.uvs5&&(e.uvs5=new Float32Array(e.positions.length/3*2)),this.uvs6&&!e.uvs6&&(e.uvs6=new Float32Array(e.positions.length/3*2)),this.colors&&!e.colors&&(e.colors=new Float32Array(e.positions.length/3*4),e.colors.fill(1)),this.matricesIndices&&!e.matricesIndices&&(e.matricesIndices=new Float32Array(e.positions.length/3*4)),this.matricesWeights&&!e.matricesWeights&&(e.matricesWeights=new Float32Array(e.positions.length/3*4)),this.matricesIndicesExtra&&!e.matricesIndicesExtra&&(e.matricesIndicesExtra=new Float32Array(e.positions.length/3*4)),this.matricesWeightsExtra&&!e.matricesWeightsExtra&&(e.matricesWeightsExtra=new Float32Array(e.positions.length/3*4));else if(e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(r){let e=0,a=0,n=0;const s=[];let r=null;const o=[];for(const e of this.splitBasedOnMaterialID())o.push({vertexData:e,transform:t});for(const e of i)if(e.vertexData)for(const t of e.vertexData.splitBasedOnMaterialID())o.push({vertexData:t,transform:e.transform});o.sort(((e,t)=>{const i=e.vertexData.materialInfos?e.vertexData.materialInfos[0].materialIndex:0,a=t.vertexData.materialInfos?t.vertexData.materialInfos[0].materialIndex:0;return i>a?1:i===a?0:-1}));for(const t of o){const i=t.vertexData;if(e=i.materialInfos?i.materialInfos[0].materialIndex:0,r&&r.materialIndex===e)r.indexCount+=i.indices.length,r.verticesCount+=i.positions.length/3;else{const t=new VertexDataMaterialInfo;t.materialIndex=e,t.indexStart=a,t.indexCount=i.indices.length,t.verticesStart=n,t.verticesCount=i.positions.length/3,s.push(t),r=t}a+=i.indices.length,n+=i.positions.length/3}const h=o.splice(0,1)[0];c=h.vertexData,t=h.transform,l=o.map((e=>e.vertexData)),i=o,this.materialInfos=s}const h=l.reduce(((e,t)=>e+(t.indices?.length??0)),c.indices?.length??0);let u=s||l.some((e=>e.indices===c.indices))?c.indices?.slice():c.indices;if(h>0){let s=u?.length??0;if(u||(u=new Array(h)),u.length!==h){if(Array.isArray(u))u.length=h;else{const e=a||u instanceof Uint32Array?new Uint32Array(h):new Uint16Array(h);e.set(u),u=e}t&&t.determinant()<0&&e._FlipFaces(u,0,s)}let r=c.positions?c.positions.length/3:0;for(const{vertexData:t,transform:a}of i)if(t.indices){for(let e=0;e<t.indices.length;e++)u[s+e]=t.indices[e]+r;a&&a.determinant()<0&&e._FlipFaces(u,s,t.indices.length),r+=t.positions.length/3,s+=t.indices.length,n&&(yield)}}return this.indices=u,this.positions=e._MergeElement(VertexBuffer.PositionKind,c.positions,t,i.map((e=>[e.vertexData.positions,e.transform]))),n&&(yield),c.normals&&(this.normals=e._MergeElement(VertexBuffer.NormalKind,c.normals,t,i.map((e=>[e.vertexData.normals,e.transform]))),n&&(yield)),c.tangents&&(this.tangents=e._MergeElement(VertexBuffer.TangentKind,c.tangents,t,i.map((e=>[e.vertexData.tangents,e.transform]))),n&&(yield)),c.uvs&&(this.uvs=e._MergeElement(VertexBuffer.UVKind,c.uvs,t,i.map((e=>[e.vertexData.uvs,e.transform]))),n&&(yield)),c.uvs2&&(this.uvs2=e._MergeElement(VertexBuffer.UV2Kind,c.uvs2,t,i.map((e=>[e.vertexData.uvs2,e.transform]))),n&&(yield)),c.uvs3&&(this.uvs3=e._MergeElement(VertexBuffer.UV3Kind,c.uvs3,t,i.map((e=>[e.vertexData.uvs3,e.transform]))),n&&(yield)),c.uvs4&&(this.uvs4=e._MergeElement(VertexBuffer.UV4Kind,c.uvs4,t,i.map((e=>[e.vertexData.uvs4,e.transform]))),n&&(yield)),c.uvs5&&(this.uvs5=e._MergeElement(VertexBuffer.UV5Kind,c.uvs5,t,i.map((e=>[e.vertexData.uvs5,e.transform]))),n&&(yield)),c.uvs6&&(this.uvs6=e._MergeElement(VertexBuffer.UV6Kind,c.uvs6,t,i.map((e=>[e.vertexData.uvs6,e.transform]))),n&&(yield)),c.colors&&(this.colors=e._MergeElement(VertexBuffer.ColorKind,c.colors,t,i.map((e=>[e.vertexData.colors,e.transform]))),(void 0!==c.hasVertexAlpha||i.some((e=>void 0!==e.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=c.hasVertexAlpha||i.some((e=>e.vertexData.hasVertexAlpha))),n&&(yield)),c.matricesIndices&&(this.matricesIndices=e._MergeElement(VertexBuffer.MatricesIndicesKind,c.matricesIndices,t,i.map((e=>[e.vertexData.matricesIndices,e.transform]))),n&&(yield)),c.matricesWeights&&(this.matricesWeights=e._MergeElement(VertexBuffer.MatricesWeightsKind,c.matricesWeights,t,i.map((e=>[e.vertexData.matricesWeights,e.transform]))),n&&(yield)),c.matricesIndicesExtra&&(this.matricesIndicesExtra=e._MergeElement(VertexBuffer.MatricesIndicesExtraKind,c.matricesIndicesExtra,t,i.map((e=>[e.vertexData.matricesIndicesExtra,e.transform]))),n&&(yield)),c.matricesWeightsExtra&&(this.matricesWeightsExtra=e._MergeElement(VertexBuffer.MatricesWeightsExtraKind,c.matricesWeightsExtra,t,i.map((e=>[e.vertexData.matricesWeightsExtra,e.transform])))),this}static CreateIcoSphere(e){throw _WarnImport("icoSphereBuilder")}*_applyToCoroutine(e,t=!1,i){if(this.positions&&(e.setVerticesData(VertexBuffer.PositionKind,this.positions,t),i&&(yield)),this.normals&&(e.setVerticesData(VertexBuffer.NormalKind,this.normals,t),i&&(yield)),this.tangents&&(e.setVerticesData(VertexBuffer.TangentKind,this.tangents,t),i&&(yield)),this.uvs&&(e.setVerticesData(VertexBuffer.UVKind,this.uvs,t),i&&(yield)),this.uvs2&&(e.setVerticesData(VertexBuffer.UV2Kind,this.uvs2,t),i&&(yield)),this.uvs3&&(e.setVerticesData(VertexBuffer.UV3Kind,this.uvs3,t),i&&(yield)),this.uvs4&&(e.setVerticesData(VertexBuffer.UV4Kind,this.uvs4,t),i&&(yield)),this.uvs5&&(e.setVerticesData(VertexBuffer.UV5Kind,this.uvs5,t),i&&(yield)),this.uvs6&&(e.setVerticesData(VertexBuffer.UV6Kind,this.uvs6,t),i&&(yield)),this.colors&&(e.setVerticesData(VertexBuffer.ColorKind,this.colors,t),this.hasVertexAlpha&&void 0!==e.hasVertexAlpha&&(e.hasVertexAlpha=!0),i&&(yield)),this.matricesIndices&&(e.setVerticesData(VertexBuffer.MatricesIndicesKind,this.matricesIndices,t),i&&(yield)),this.matricesWeights&&(e.setVerticesData(VertexBuffer.MatricesWeightsKind,this.matricesWeights,t),i&&(yield)),this.matricesIndicesExtra&&(e.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),i&&(yield)),this.matricesWeightsExtra&&(e.setVerticesData(VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),i&&(yield)),this.indices?(e.setIndices(this.indices,null,t),i&&(yield)):e.setIndices([],null),e.subMeshes&&this.materialInfos&&this.materialInfos.length>1){const t=e;t.subMeshes=[];for(const e of this.materialInfos)new SubMesh(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,t)}return this}_update(e,t,i){return this.positions&&e.updateVerticesData(VertexBuffer.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(VertexBuffer.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(VertexBuffer.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(VertexBuffer.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(VertexBuffer.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(VertexBuffer.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(VertexBuffer.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(VertexBuffer.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(VertexBuffer.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(VertexBuffer.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(VertexBuffer.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(VertexBuffer.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this}static CreatePolyhedron(e){throw _WarnImport("polyhedronBuilder")}static _TransformVector3Normals(e,t,i=0,a=e.length){const n=TmpVectors.Vector3[0],s=TmpVectors.Vector3[1];for(let r=i;r<i+a;r+=3)Vector3.FromArrayToRef(e,r,n),Vector3.TransformNormalToRef(n,t,s),e[r]=s.x,e[r+1]=s.y,e[r+2]=s.z}static Tc(e){throw _WarnImport("ribbonBuilder")}static CreateDashedLines(e){throw _WarnImport("linesBuilder")}transform(t){const i=t.determinant()<0;return this.positions&&e._TransformVector3Coordinates(this.positions,t),this.normals&&e._TransformVector3Normals(this.normals,t),this.tangents&&e._TransformVector4Normals(this.tangents,t),i&&this.indices&&e._FlipFaces(this.indices),this}};function IsWindowObjectExist(){return"undefined"!=typeof window}function IsNavigatorAvailable(){return"undefined"!=typeof navigator}function IsDocumentAvailable(){return"undefined"!=typeof document}function GetDOMTextContent(e){let t="",i=e.firstChild;for(;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t}VertexData.FRONTSIDE=0,VertexData.BACKSIDE=1,VertexData.DOUBLESIDE=2,VertexData.DEFAULTSIDE=0,VertexData._UniqueIDGenerator=0,__decorate([nativeOverride.filter(((...[e])=>!Array.isArray(e)))],VertexData,"_TransformVector3Coordinates",null),__decorate([nativeOverride.filter(((...[e])=>!Array.isArray(e)))],VertexData,"_TransformVector3Normals",null),__decorate([nativeOverride.filter(((...[e])=>!Array.isArray(e)))],VertexData,"_TransformVector4Normals",null),__decorate([nativeOverride.filter(((...[e])=>!Array.isArray(e)))],VertexData,"_FlipFaces",null);var CloneValue=(e,t,i)=>e?e.getClassName&&"Mesh"===e.getClassName()?null:!e.getClassName||"SubMesh"!==e.getClassName()&&"PhysicsBody"!==e.getClassName()?e.clone?e.clone():Array.isArray(e)?e.slice():i&&"object"==typeof e?{...e}:null:e.clone(t):null;function GetAllPropertyNames(e){const t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}var DeepCopier=class{static DeepCopy(e,t,i,a,n=!1){const s=GetAllPropertyNames(e);for(const r of s){if("_"===r[0]&&(!a||-1===a.indexOf(r)))continue;if(r.endsWith("Observable"))continue;if(i&&-1!==i.indexOf(r))continue;const s=e[r],o=typeof s;if("function"!==o)try{if("object"===o)if(s instanceof Uint8Array)t[r]=Uint8Array.from(s);else if(s instanceof Array){if(t[r]=[],s.length>0)if("object"==typeof s[0])for(let e=0;e<s.length;e++){const i=CloneValue(s[e],t,n);-1===t[r].indexOf(i)&&t[r].push(i)}else t[r]=s.slice(0)}else t[r]=CloneValue(s,t,n);else t[r]=s}catch(e){Logger.Warn(e.message)}}}},PrecisionDate=class{static get Now(){return IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()}};function createXMLHttpRequest(){return"undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}var WebRequest=class e{get statusText(){return this._xhr.statusText}get responseURL(){return this._xhr.responseURL}removeEventListener(e,t,i){this._xhr.removeEventListener(e,t,i)}send(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)}set timeout(e){this._xhr.timeout=e}get responseText(){return this._xhr.responseText}getResponseHeader(e){return this._xhr.getResponseHeader(e)}_shouldSkipRequestModifications(t){return e.SkipRequestModificationForBabylonCDN&&(t.includes("preview.babylonjs.com")||t.includes("cdn.babylonjs.com"))}set onprogress(e){this._xhr.onprogress=e}get status(){return this._xhr.status}get readyState(){return this._xhr.readyState}constructor(){this._xhr=createXMLHttpRequest(),this._requestURL=""}get response(){return this._xhr.response}open(t,i){for(const t of e.CustomRequestModifiers){if(this._shouldSkipRequestModifications(i))return;t(this._xhr,i)}i=(i=i.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=i,this._xhr.open(t,i,!0)}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const t in e.CustomRequestHeaders){const i=e.CustomRequestHeaders[t];i&&this._xhr.setRequestHeader(t,i)}}abort(){this._xhr.abort()}static get IsCustomRequestAvailable(){return Object.keys(e.CustomRequestHeaders).length>0||e.CustomRequestModifiers.length>0}get onprogress(){return this._xhr.onprogress}get responseType(){return this._xhr.responseType}addEventListener(e,t,i){this._xhr.addEventListener(e,t,i)}get timeout(){return this._xhr.timeout}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}set responseType(e){this._xhr.responseType=e}};WebRequest.CustomRequestHeaders={},WebRequest.CustomRequestModifiers=new Array,WebRequest.SkipRequestModificationForBabylonCDN=!0;var FilesInputStore=class{};FilesInputStore.FilesToLoad={};var RetryStrategy=class{static ExponentialBackoff(e=3,t=500){return(i,a,n)=>0!==a.status||n>=e||-1!==i.indexOf("file:")?-1:Math.pow(2,n)*t}},Decode=e=>{if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t},EncodeArrayBufferToBase64=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i,a,n,s,r,o,l,c="",h=0;const u=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;h<u.length;)i=u[h++],a=h<u.length?u[h++]:Number.NaN,n=h<u.length?u[h++]:Number.NaN,s=i>>2,r=(3&i)<<4|a>>4,o=(15&a)<<2|n>>6,l=63&n,isNaN(a)?o=l=64:isNaN(n)&&(l=64),c+=t.charAt(s)+t.charAt(r)+t.charAt(o)+t.charAt(l);return c},DecodeBase64ToString=e=>atob(e),DecodeBase64ToBinary=e=>{const t=DecodeBase64ToString(e),i=t.length,a=new Uint8Array(new ArrayBuffer(i));for(let e=0;e<i;e++)a[e]=t.charCodeAt(e);return a.buffer},defaultAttributeKeywordName="attribute",defaultVaryingKeywordName="varying",ShaderCodeNode=class{isValid(e){return!0}constructor(){this.children=[]}process(e,t){let i="";if(this.line){let a=this.line;const n=t.processor;if(n){n.lineProcessor&&(a=n.lineProcessor(a,t.isFragment,t.processingContext));const i=t.processor?.attributeKeywordName??defaultAttributeKeywordName,s=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:defaultVaryingKeywordName;if(!t.isFragment&&n.attributeProcessor&&this.line.startsWith(i))a=n.attributeProcessor(this.line,e,t.processingContext);else if(n.varyingProcessor&&(n.varyingCheck?.(this.line,t.isFragment)||!n.varyingCheck&&this.line.startsWith(s)))a=n.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(n.uniformProcessor&&n.uniformRegexp&&n.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(a=n.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(n.uniformBufferProcessor&&n.uniformBufferRegexp&&n.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(a=n.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(n.textureProcessor&&n.textureRegexp&&n.textureRegexp.test(this.line))a=n.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((n.uniformProcessor||n.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?n.uniformProcessor&&(a=n.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):n.uniformBufferProcessor&&(a=n.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,n.endOfUniformBufferProcessor&&(a=n.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}i+=a+"\n"}return this.children.forEach((a=>{i+=a.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i}},ShaderCodeCursor=class{get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}constructor(){this._lines=[]}set lines(e){this._lines.length=0;for(const t of e){if(!t||"\r"===t)continue;if("#"===t[0]){this._lines.push(t);continue}const e=t.trim();if(!e)continue;if(e.startsWith("//")){this._lines.push(t);continue}const i=e.indexOf(";");if(-1===i)this._lines.push(e);else if(i===e.length-1)e.length>1&&this._lines.push(e);else{const e=t.split(";");for(let t=0;t<e.length;t++){let i=e[t];i&&(i=i.trim(),i&&this._lines.push(i+(t!==e.length-1?";":"")))}}}}},ShaderCodeConditionNode=class extends ShaderCodeNode{process(e,t){for(let i=0;i<this.children.length;i++){const a=this.children[i];if(a.isValid(e))return a.process(e,t)}return""}},ShaderCodeTestNode=class extends ShaderCodeNode{isValid(e){return this.testExpression.isTrue(e)}},ShaderDefineExpression=class e{isTrue(e){return!0}static ClearCache(){const t=Array.from(e._InfixToPostfixCache.entries()).sort(((e,t)=>e[1].accessTime-t[1].accessTime));for(let i=0;i<e.InfixToPostfixCacheCleanupSize;i++)e._InfixToPostfixCache.delete(t[i][0])}static infixToPostfix(t){const i=e._InfixToPostfixCache.get(t);if(i)return i.accessTime=Date.now(),i.result;if(!(t.includes("&&")||t.includes("||")||t.includes(")")||t.includes("(")))return[t];const a=[];let n=-1;const s=()=>{h=h.trim(),""!==h&&(a.push(h),h="")},r=t=>{n<e._Stack.length-1&&(e._Stack[++n]=t)},o=()=>e._Stack[n],l=()=>-1===n?"!!INVALID EXPRESSION!!":e._Stack[n--];let c=0,h="";for(;c<t.length;){const i=t.charAt(c),u=c<t.length-1?t.substr(c,2):"";if("("===i)h="",r(i);else if(")"===i){for(s();-1!==n&&"("!==o();)a.push(l());l()}else if(e._OperatorPriority[u]>1){for(s();-1!==n&&e._OperatorPriority[o()]>=e._OperatorPriority[u];)a.push(l());r(u),c++}else h+=i;c++}for(s();-1!==n;)"("===o()?l():a.push(l());return e._InfixToPostfixCache.size>=e.InfixToPostfixCacheLimitSize&&e.ClearCache(),e._InfixToPostfixCache.set(t,{result:a,accessTime:Date.now()}),a}static postfixToInfix(t){const i=[];for(const a of t)if(void 0===e._OperatorPriority[a])i.push(a);else{const e=i[i.length-1],t=i[i.length-2];i.length-=2,i.push(`(${t}${a}${e})`)}return i[i.length-1]}};ShaderDefineExpression.InfixToPostfixCacheLimitSize=5e4,ShaderDefineExpression.InfixToPostfixCacheCleanupSize=25e3,ShaderDefineExpression._InfixToPostfixCache=new Map,ShaderDefineExpression._OperatorPriority={")":0,"(":1,"||":2,"&&":3},ShaderDefineExpression._Stack=["","","","","","","","","","","","","","","","","","","",""];var ShaderDefineIsDefinedOperator=class extends ShaderDefineExpression{isTrue(e){let t=void 0!==e[this.define];return this.not&&(t=!t),t}constructor(e,t=!1){super(),this.define=e,this.not=t}},ShaderDefineOrOperator=class extends ShaderDefineExpression{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}},ShaderDefineAndOperator=class extends ShaderDefineExpression{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}},ShaderDefineArithmeticOperator=class extends ShaderDefineExpression{isTrue(e){let t=e[this.define];void 0===t&&(t=this.define);let i=!1;const a=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":i=a>n;break;case"<":i=a<n;break;case"<=":i=a<=n;break;case">=":i=a>=n;break;case"==":i=a===n;break;case"!=":i=a!==n}return i}constructor(e,t,i){super(),this.define=e,this.operand=t,this.testValue=i}},EngineFunctionContext={};function _ConcatenateShader(e,t,i=""){return i+(t?t+"\n":"")+e}function _loadFile(e,t,i,a,n,s,r){const o=r||EngineFunctionContext.loadFile;if(o){return o(e,t,i,a,n,s)}throw _WarnImport("FileTools")}function _getGlobalDefines(e,t,i,a){if(e)return t?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,i?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(a?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return t&&(e+="#define IS_NDC_HALF_ZRANGE"),i&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),a&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}var regexSE=/defined\s*?\((.+?)\)/g,regexSERevert=/defined\s*?\[(.+?)\]/g,regexShaderInclude=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,regexShaderDecl=/__decl__/,regexLightX=/light\{X\}.(\w*)/g,regexX=/\{X\}/g,reusableMatches=[],_MoveCursorRegex=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function Initialize(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function Process(e,t,i,a){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),_ProcessIncludes(e,t,(e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines));const n=_ProcessShaderConversion(e,t,a);i(n,e)}))}function Finalize(e,t,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(e,t,i.processingContext):{vertexCode:e,fragmentCode:t}}function _ProcessPrecision(e,t){if(t.processor?.noPrecision)return e;const i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e}function _ExtractOperation(e){const t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new ShaderDefineIsDefinedOperator(t[1].trim(),"!"===e[0]);const i=["==","!=",">=","<=","<",">"];let a="",n=0;for(a of i)if(n=e.indexOf(a),n>-1)break;if(-1===n)return new ShaderDefineIsDefinedOperator(e);const s=e.substring(0,n).trim(),r=e.substring(n+a.length).trim();return new ShaderDefineArithmeticOperator(s,a,r)}function _BuildSubExpression(e){e=e.replace(regexSE,"defined[$1]");const t=ShaderDefineExpression.infixToPostfix(e),i=[];for(const e of t)if("||"!==e&&"&&"!==e)i.push(e);else if(i.length>=2){let t=i[i.length-1],a=i[i.length-2];i.length-=2;const n="&&"==e?new ShaderDefineAndOperator:new ShaderDefineOrOperator;"string"==typeof t&&(t=t.replace(regexSERevert,"defined($1)")),"string"==typeof a&&(a=a.replace(regexSERevert,"defined($1)")),n.leftOperand="string"==typeof a?_ExtractOperation(a):a,n.rightOperand="string"==typeof t?_ExtractOperation(t):t,i.push(n)}let a=i[i.length-1];return"string"==typeof a&&(a=a.replace(regexSERevert,"defined($1)")),"string"==typeof a?_ExtractOperation(a):a}function _BuildExpression(e,t){const i=new ShaderCodeTestNode,a=e.substring(0,t);let n=e.substring(t);return n=n.substring(0,(n.indexOf("//")+1||n.length+1)-1).trim(),i.testExpression="#ifdef"===a?new ShaderDefineIsDefinedOperator(n):"#ifndef"===a?new ShaderDefineIsDefinedOperator(n,!0):_BuildSubExpression(n),i}function _MoveCursorWithinIf(e,t,i){let a=e.currentLine;for(;_MoveCursor(e,i);){a=e.currentLine;const n=a.substring(0,5).toLowerCase();if("#else"===n){const i=new ShaderCodeNode;return t.children.push(i),void _MoveCursor(e,i)}if("#elif"===n){const e=_BuildExpression(a,5);t.children.push(e),i=e}}}function _MoveCursor(e,t){for(;e.canRead;){e.lineIndex++;const i=e.currentLine;if(i.indexOf("#")>=0){const a=_MoveCursorRegex.exec(i);if(a&&a.length){switch(a[0]){case"#ifdef":{const a=new ShaderCodeConditionNode;t.children.push(a);const n=_BuildExpression(i,6);a.children.push(n),_MoveCursorWithinIf(e,a,n);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const a=new ShaderCodeConditionNode;t.children.push(a);const n=_BuildExpression(i,7);a.children.push(n),_MoveCursorWithinIf(e,a,n);break}case"#if":{const a=new ShaderCodeConditionNode,n=_BuildExpression(i,3);t.children.push(a),a.children.push(n),_MoveCursorWithinIf(e,a,n);break}}continue}}const a=new ShaderCodeNode;if(a.line=i,t.children.push(a),"#"===i[0]&&"d"===i[1]){const e=i.replace(";","").split(" ");a.additionalDefineKey=e[1],3===e.length&&(a.additionalDefineValue=e[2])}}return!1}function _EvaluatePreProcessors(e,t,i){const a=new ShaderCodeNode,n=new ShaderCodeCursor;return n.lineIndex=-1,n.lines=e.split("\n"),_MoveCursor(n,a),a.process(t,i)}function _PreparePreProcessors(e,t){const i=e.defines,a={};for(const e of i){const t=e.replace("#define","").replace(";","").trim().split(" ");a[t[0]]=t.length>1?t[1]:""}return 0===e.processor?.shaderLanguage&&(a.GL_ES="true"),a.__VERSION__=e.version,a[e.platformName]="true",_getGlobalDefines(a,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),a}function _ProcessShaderConversion(e,t,i){let a=_ProcessPrecision(e,t);if(!t.processor)return a;if(0===t.processor.shaderLanguage&&-1!==a.indexOf("#version 3")&&(a=a.replace("#version 300 es",""),!t.processor.parseGLES3))return a;const n=t.defines,s=_PreparePreProcessors(t,i);return t.processor.preProcessor&&(a=t.processor.preProcessor(a,n,s,t.isFragment,t.processingContext)),a=_EvaluatePreProcessors(a,s,t),t.processor.postProcessor&&(a=t.processor.postProcessor(a,n,t.isFragment,t.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{})),i?._features.needShaderCodeInlining&&(a=i.inlineShaderCode(a)),a}function _ProcessIncludes(e,t,i){let a;for(reusableMatches.length=0;null!==(a=regexShaderInclude.exec(e));)reusableMatches.push(a);let n=String(e),s=[e],r=!1;for(const e of reusableMatches){let a=e[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(regexShaderDecl,""),t.supportsUniformBuffers&&(a=a.replace("Vertex","Ubo").replace("Fragment","Ubo")),a+="Declaration"),!t.includesShadersStore[a]){const e=t.shadersRepository+"ShadersInclude/"+a+".fx";return void _functionContainer.loadFile(e,(e=>{t.includesShadersStore[a]=e,_ProcessIncludes(s.join(""),t,i)}))}{let i=t.includesShadersStore[a];if(e[2]){const t=e[3].split(",");for(let e=0;e<t.length;e+=2){const a=new RegExp(t[e],"g"),n=t[e+1];i=i.replace(a,n)}}if(e[4]){const a=e[5];if(-1!==a.indexOf("..")){const e=a.split(".."),n=parseInt(e[0]);let s=parseInt(e[1]),r=i.slice(0);i="",isNaN(s)&&(s=t.indexParameters[e[1]]);for(let e=n;e<s;e++)t.supportsUniformBuffers||(r=r.replace(regexLightX,((e,t)=>t+"{X}"))),i+=r.replace(regexX,e.toString())+"\n"}else t.supportsUniformBuffers||(i=i.replace(regexLightX,((e,t)=>t+"{X}"))),i=i.replace(regexX,a)}const n=[];for(const t of s){const a=t.split(e[0]);for(let e=0;e<a.length-1;e++)n.push(a[e]),n.push(i);n.push(a[a.length-1])}s=n,r=r||i.indexOf("#include<")>=0||i.indexOf("#include <")>=0}}reusableMatches.length=0,n=s.join(""),r?_ProcessIncludes(n.toString(),t,i):i(n)}var _functionContainer={loadFile:(e,t,i,a,n,s)=>{throw _WarnImport("FileTools")}},TimingTools=class{static SetImmediate(e){IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)}};init_shaderStore();var WebGLPipelineContext=class{setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}get isAsync(){return this.isParallelCompiled}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}_cacheFloat3(e,t,i,a){let n=this._valueCache[e];if(!n||3!==n.length)return n=[t,i,a],this._valueCache[e]=n,!0;let s=!1;return n[0]!==t&&(n[0]=t,s=!0),n[1]!==i&&(n[1]=i,s=!0),n[2]!==a&&(n[2]=a,s=!0),s}setInt(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setInt3(e,t,i,a){this._cacheFloat3(e,t,i,a)&&(this.engine.setInt3(this._uniforms[e],t,i,a)||(this._valueCache[e]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setFloat(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setColor4(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null))}setUInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setUInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setFloat3(e,t,i,a){this._cacheFloat3(e,t,i,a)&&(this.engine.setFloat3(this._uniforms[e],t,i,a)||(this._valueCache[e]=null))}setFloat4(e,t,i,a,n){this._cacheFloat4(e,t,i,a,n)&&(this.engine.setFloat4(this._uniforms[e],t,i,a,n)||(this._valueCache[e]=null))}_cacheFloat4(e,t,i,a,n){let s=this._valueCache[e];if(!s||4!==s.length)return s=[t,i,a,n],this._valueCache[e]=s,!0;let r=!1;return s[0]!==t&&(s[0]=t,r=!0),s[1]!==i&&(s[1]=i,r=!0),s[2]!==a&&(s[2]=a,r=!0),s[3]!==n&&(s[3]=n,r=!0),r}dispose(){this._uniforms={},this._isDisposed=!0}setUInt3(e,t,i,a){this._cacheFloat3(e,t,i,a)&&(this.engine.setUInt3(this._uniforms[e],t,i,a)||(this._valueCache[e]=null))}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUInt4(e,t,i,a,n){this._cacheFloat4(e,t,i,a,n)&&(this.engine.setUInt4(this._uniforms[e],t,i,a,n)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}_fillEffectInformation(e,t,i,a,n,s,r,o){const l=this.engine;if(l.supportsUniformBuffers)for(const i in t)e.bindUniformBlock(i,t[i]);let c;for(this.engine.getUniforms(this,i).forEach(((e,t)=>{a[i[t]]=e})),this._uniforms=a,c=0;c<n.length;c++){null==e.getUniform(n[c])&&(n.splice(c,1),c--)}n.forEach(((e,t)=>{s[e]=t}));for(const e of l.getAttributes(this,r))o.push(e)}setEngine(e){this.engine=e}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setFloat2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}_cacheFloat2(e,t,i){let a=this._valueCache[e];if(!a||2!==a.length)return a=[t,i],this._valueCache[e]=a,!0;let n=!1;return a[0]!==t&&(a[0]=t,n=!0),a[1]!==i&&(a[1]=i,n=!0),n}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setInt4(e,t,i,a,n){this._cacheFloat4(e,t,i,a,n)&&(this.engine.setInt4(this._uniforms[e],t,i,a,n)||(this._valueCache[e]=null))}_cacheMatrix(e,t){const i=this._valueCache[e],a=t.updateFlag;return(void 0===i||i!==a)&&(this._valueCache[e]=a,!0)}setInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}},_stateObject=new WeakMap,singleStateObject={_webGLVersion:2,cachedPipelines:{}};function getStateObject(e){let t=_stateObject.get(e);if(!t){if(!e)return singleStateObject;t={_webGLVersion:e.TEXTURE_BINDING_3D?2:1,_context:e,cachedPipelines:{}},_stateObject.set(e,t)}return t}function deleteStateObject(e){_stateObject.delete(e)}function createRawShaderProgram(e,t,i,a,n,s){const r=getStateObject(a);s||(s=r._createShaderProgramInjection??_createShaderProgram);return s(e,_compileRawShader(t,"vertex",a,r._contextWasLost),_compileRawShader(i,"fragment",a,r._contextWasLost),a,n,r.validateShaderPrograms)}function createShaderProgram(e,t,i,a,n,s=null,r){const o=getStateObject(n);r||(r=o._createShaderProgramInjection??_createShaderProgram);const l=o._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return r(e,_compileShader(t,"vertex",a,l,n,o._contextWasLost),_compileShader(i,"fragment",a,l,n,o._contextWasLost),n,s,o.validateShaderPrograms)}function createPipelineContext(e,t){const i=new WebGLPipelineContext,a=getStateObject(e);return a.parallelShaderCompile&&(i.isParallelCompiled=!0),i.context=a._context,i}function _createShaderProgram(e,t,i,a,n=null,s){const r=a.createProgram();if(e.program=r,!r)throw new Error("Unable to create program");return a.attachShader(r,t),a.attachShader(r,i),a.linkProgram(r),e.context=a,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||_finalizePipelineContext(e,a,s),r}function _finalizePipelineContext(e,t,i){const a=e.context,n=e.vertexShader,s=e.fragmentShader,r=e.program;if(!a.getProgramParameter(r,a.LINK_STATUS)){if(!t.getShaderParameter(n,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(n);if(i)throw e.vertexCompilationError=i,new Error("VERTEX SHADER "+i)}if(!t.getShaderParameter(s,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(s);if(i)throw e.fragmentCompilationError=i,new Error("FRAGMENT SHADER "+i)}const i=a.getProgramInfoLog(r);if(i)throw e.programLinkError=i,new Error(i)}if(i){a.validateProgram(r);if(!a.getProgramParameter(r,a.VALIDATE_STATUS)){const t=a.getProgramInfoLog(r);if(t)throw e.programValidationError=t,new Error(t)}}a.deleteShader(n),a.deleteShader(s),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}function _preparePipelineContext(e,t,i,a,n,s,r,o,l,c="",h,u,m){const d=getStateObject(e.context);u||(u=d.createRawShaderProgramInjection??createRawShaderProgram),m||(m=d.createShaderProgramInjection??createShaderProgram);const f=e;f.program=a?u(f,t,i,f.context,l):m(f,t,i,o,f.context,l),f.program.__SPECTOR_rebuildProgram=r,h()}function _compileShader(e,t,i,a,n,s){return _compileRawShader(_ConcatenateShader(e,i,a),t,n,s)}function _compileRawShader(e,t,i,a){const n=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!n){let e=i.NO_ERROR,n=i.NO_ERROR;for(;(n=i.getError())!==i.NO_ERROR;)e=n;throw new Error(`Something went wrong while creating a gl ${t} shader object. gl error=${e}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${a}`)}return i.shaderSource(n,e),i.compileShader(n),n}function _setProgram(e,t){t.useProgram(e)}function _executeWhenRenderingStateIsCompiled(e,t){const i=e;if(!i.isParallelCompiled)return void t(e);const a=i.onCompiled;i.onCompiled=()=>{a?.(),t(e)}}function getCachedPipeline(e,t){return getStateObject(t).cachedPipelines[e]}function resetCachedPipeline(e){const t=e._name,i=e.context;if(t&&i){const e=getStateObject(i),a=e.cachedPipelines[t];a?.dispose(),delete e.cachedPipelines[t]}}function _processShaderCode(e,t,i,a,n,s,r){let o,l;const c=IsWindowObjectExist()?s?.getHostDocument():null;o="string"==typeof t?t:t.vertexSource?"source:"+t.vertexSource:t.vertexElement?c?.getElementById(t.vertexElement)||t.vertexElement:t.vertex||t,l="string"==typeof t?t:t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?c?.getElementById(t.fragmentElement)||t.fragmentElement:t.fragment||t;const h=[void 0,void 0],u=()=>{if(h[0]&&h[1]){e.isFragment=!0;const[o,l]=h;Process(l,e,((s,l)=>{r&&(r._fragmentSourceCodeBeforeMigration=l),i&&(s=i("fragment",s));const c=Finalize(o,s,e);e=null;const h=_useFinalCode(c.vertexCode,c.fragmentCode,t,n);a?.(h.vertexSourceCode,h.fragmentSourceCode)}),s)}};_loadShader(o,"Vertex","",(t=>{Initialize(e),Process(t,e,((e,a)=>{r&&(r._rawVertexSourceCode=t,r._vertexSourceCodeBeforeMigration=a),i&&(e=i("vertex",e)),h[0]=e,u()}),s)}),n),_loadShader(l,"Fragment","Pixel",(e=>{r&&(r._rawFragmentSourceCode=e),h[1]=e,u()}),n)}function _loadShader(e,t,i,a,n,s){if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement){return void a(GetDOMTextContent(e))}if("source:"===e.substr(0,7))return void a(e.substr(7));if("base64:"===e.substr(0,7)){return void a(window.atob(e.substr(7)))}const r=ShaderStore.GetShadersStore(n);if(r[e+t+"Shader"])return void a(r[e+t+"Shader"]);if(i&&r[e+i+"Shader"])return void a(r[e+i+"Shader"]);let o;if(o="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:ShaderStore.GetShadersRepository(n)+e,!(s=s||_loadFile))throw new Error("loadFileInjection is not defined");s(o+"."+t.toLowerCase()+".fx",a)}function _useFinalCode(e,t,i,a){if(i){return{vertexSourceCode:(1===a?"//":"")+"#define SHADER_NAME vertex:"+(i.vertexElement||i.vertex||i.spectorName||i)+"\n"+e,fragmentSourceCode:(1===a?"//":"")+"#define SHADER_NAME fragment:"+(i.fragmentElement||i.fragment||i.spectorName||i)+"\n"+t}}return{vertexSourceCode:e,fragmentSourceCode:t}}init_shaderStore();var createAndPreparePipelineContext=(e,t,i,a)=>{try{const n=e.existingPipelineContext||t(e.shaderProcessingContext);if(n._name=e.name,e.name&&e.context){getStateObject(e.context).cachedPipelines[e.name]=n}return i(n,e.vertex,e.fragment,!!e.createAsRaw,"","",e.rebuildRebind,e.defines,e.transformFeedbackVaryings,"",(()=>{a(n,(()=>{e.onRenderingStateCompiled?.(n)}))})),n}catch(e){throw Logger.Error("Error compiling effect"),e}},Effect=class e{get key(){return this._key}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}isReady(){try{return this._isReadyInternal()}catch{return!1}}_processCompilationErrors(t,i=null){this._compilationError=t.message;const a=this._attributesNames,n=this._fallbacks;if(Logger.Error("Unable to compile effect:"),Logger.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),Logger.Error("Attributes: "+a.map((function(e){return" "+e}))),Logger.Error("Defines:\n"+this.defines),e.LogShaderCodeOnCompilationError){let e=null,t=null,i=null;this._pipelineContext?._getVertexShaderCode()&&([i,e]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),i&&(Logger.Error("Vertex code:"),Logger.Error(i))),this._pipelineContext?._getFragmentShaderCode()&&([i,t]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),i&&(Logger.Error("Fragment code:"),Logger.Error(i))),e&&Logger.Error(e),t&&Logger.Error(t)}Logger.Error("Error: "+this._compilationError);const s=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};i&&(this._pipelineContext=i,this._isReady=!0,s()),n?(this._pipelineContext=null,n.hasMoreFallbacks?(this._allFallbacksProcessed=!1,Logger.Error("Trying next fallback."),this.defines=n.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,s(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,i||s())}setUInt3(e,t,i,a){return this._pipelineContext.setUInt3(e,t,i,a),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}static ResetCache(){e._BaseCache={}}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}get rawVertexSourceCode(){return this._rawVertexSourceCode}static set ShadersRepository(e){ShaderStore.ShadersRepository=e}static get ShadersRepository(){return ShaderStore.ShadersRepository}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}getAttributeLocationByName(e){return this._attributeLocationByName[e]}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setInt3(e,t,i,a){return this._pipelineContext.setInt3(e,t,i,a),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}getUniform(e){return this._uniforms[e]}setTextureArray(e,t){const i=e+"Ex";if(-1===this._samplerList.indexOf(i+"0")){const a=this._samplerList.indexOf(e);for(let e=1;e<t.length;e++){const t=i+(e-1).toString();this._samplerList.splice(a+e,0,t)}let n=0;for(const e of this._samplerList)this._samplers[e]=n,n+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}_getShaderCodeAndErrorLine(e,t,i){const a=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let n=null;if(t&&e){const s=t.match(a);if(s&&2===s.length){const t=parseInt(s[1]),a=e.split("\n",-1);a.length>=t&&(n=`Offending line [${t}] in ${i?"fragment":"vertex"} code: ${a[t-1]}`)}}return[e,n]}getIndexParameters(){return this._indexParameters}_isReadyInternal(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}getCompilationError(){return this._compilationError}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}get isSupported(){return""===this._compilationError}getEngine(){return this._engine}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Observable),this._onBindObservable}constructor(t,i,a,n=null,s,r=null,o=null,l=null,c=null,h,u="",m=0){this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.Hc=0,this.onCompileObservable=new Observable,this.onErrorObservable=new Observable,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=t,this._key=u;const d=this._key.replace(/\r/g,"").replace(/\n/g,"|");let f;if(i.attributes){const e=i;if(this._engine=a,this._attributesNames=e.attributes,this._uniformsNames=e.uniformsNames.concat(e.samplers),this._samplerList=e.samplers.slice(),this.defines=e.defines,this.onError=e.onError,this.onCompiled=e.onCompiled,this._fallbacks=e.fallbacks,this._indexParameters=e.indexParameters,this._transformFeedbackVaryings=e.transformFeedbackVaryings||null,this._multiTarget=!!e.multiTarget,this._shaderLanguage=e.shaderLanguage??0,e.uniformBuffersNames){this._uniformBuffersNamesList=e.uniformBuffersNames.slice();for(let t=0;t<e.uniformBuffersNames.length;t++)this._uniformBuffersNames[e.uniformBuffersNames[t]]=t}this._processFinalCode=e.processFinalCode??null,this._processCodeAfterIncludes=e.processCodeAfterIncludes??void 0,f=e.existingPipelineContext}else this._engine=s,this.defines=null==r?"":r,this._uniformsNames=a.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=i,this._uniformBuffersNamesList=[],this._shaderLanguage=m,this.onError=c,this.onCompiled=l,this._indexParameters=h,this._fallbacks=o;"WEBGL2"===this._engine.shaderPlatformName&&(f=getCachedPipeline(d,this._engine._gl)??f),this._attributeLocationByName={},this.Hc=e._UniqueIdSeed++,f?(this._pipelineContext=f,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCode()}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}executeWhenCompiled(e){this.isReady()?e(this):(this.onCompileObservable.add((t=>{e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setFloat3(e,t,i,a){return this._pipelineContext.setFloat3(e,t,i,a),this}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&resetCachedPipeline(this._pipelineContext),this._engine._releaseEffect(this),this._isDisposed=!0)}setFloat4(e,t,i,a,n){return this._pipelineContext.setFloat4(e,t,i,a,n),this}setColor4(e,t,i){return this._pipelineContext.setColor4(e,t,i),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setInt4(e,t,i,a,n){return this._pipelineContext.setInt4(e,t,i,a,n),this}setUInt2(e,t,i){return this._pipelineContext.setUInt2(e,t,i),this}getSamplers(){return this._samplerList}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}get vertexSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}_prepareEffect(e=!1){const t=this._pipelineContext;this._isReady=!1;try{const i=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),a=i?null:this.defines,n=i?this._vertexSourceCodeOverride:this._vertexSourceCode,s=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,r=this._engine;this._pipelineContext=createAndPreparePipelineContext({existingPipelineContext:e?t:null,vertex:n,fragment:s,context:"WEBGL2"===r.shaderPlatformName?r._gl:void 0,rebuildRebind:(e,t,i,a)=>this._rebuildProgram(e,t,i,a),defines:a,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,parallelShaderCompile:r._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:i=>{t&&!e&&this._engine._deletePipelineContext(t),i&&this._onRenderingStateCompiled(i)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(e){this._processCompilationErrors(e,t)}}bindUniformBuffer(t,i){const a=this._uniformBuffersNames[i];void 0===a||e._BaseCache[a]===t&&this._engine._features.useUBOBindingCache||(e._BaseCache[a]=t,this._engine.bindUniformBufferBase(t,a,i))}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}setInt(e,t){return this._pipelineContext.setInt(e,t),this}_processShaderCode(e=null,t=!1,i=null){this._processingContext=i||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);_processShaderCode({defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:ShaderStore.GetShadersRepository(this._shaderLanguage),includesShadersStore:ShaderStore.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes},this.name,this._processFinalCode,((e,i)=>{this._vertexSourceCode=e,this._fragmentSourceCode=i,this._prepareEffect(t)}),this._shaderLanguage,this._engine,this)}static RegisterShader(e,t,i,a=0){t&&(ShaderStore.GetShadersStore(a)[`${e}PixelShader`]=t),i&&(ShaderStore.GetShadersStore(a)[`${e}VertexShader`]=i)}setUInt4(e,t,i,a,n){return this._pipelineContext.setUInt4(e,t,i,a,n),this}get fragmentSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}setFloat2(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this}getAttributesCount(){return this._attributes.length}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}_checkIsReady(e){try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}this._isDisposed||setTimeout((()=>{this._checkIsReady(e)}),16)}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}_onRenderingStateCompiled(e){if(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let e=0;e<this._attributesNames.length;e++){const t=this._attributesNames[e];this._attributeLocationByName[t]=this._attributes[e]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh()}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}allFallbacksProcessed(){return this._allFallbacksProcessed}setInt2(e,t,i){return this._pipelineContext.setInt2(e,t,i),this}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getPipelineContext(){return this._pipelineContext}get shaderLanguage(){return this._shaderLanguage}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}getUniformBuffersNames(){return this._uniformBuffersNamesList}getUniformNames(){return this._uniformsNames}_rebuildProgram(e,t,i,a){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(e,t)=>{a&&a(t)},this.onCompiled=()=>{const e=this.getEngine().scenes;if(e)for(let t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);this._pipelineContext._handlesSpectorRebuildCallback?.(i)},this._fallbacks=null,this._prepareEffect()}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}getAttributeLocation(e){return this._attributes[e]}getAttributesNames(){return this._attributesNames}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}};Effect.LogShaderCodeOnCompilationError=!0,Effect._UniqueIdSeed=0,Effect._BaseCache={},Effect.ShadersStore=ShaderStore.ShadersStore,Effect.IncludesShadersStore=ShaderStore.IncludesShadersStore;var DepthCullingState=class{reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}get depthMask(){return this._depthMask}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get zOffset(){return this._zOffset}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffsetUnits(){return this._zOffsetUnits}get frontFace(){return this._frontFace}get depthTest(){return this._depthTest}get cullFace(){return this._cullFace}get depthFunc(){return this._depthFunc}},StencilStateComposer=class{reset(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}apply(e){if(!e)return;const t=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get func(){return this._func}get enabled(){return this._enabled}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get mask(){return this._mask}get opDepthFail(){return this._opDepthFail}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}get opStencilFail(){return this._opStencilFail}get funcMask(){return this._funcMask}get funcRef(){return this._funcRef}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}},StencilState=class e{reset(){this.enabled=!1,this.mask=255,this.func=e.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE}set stencilMask(e){this.mask=e}get stencilFuncRef(){return this.funcRef}get stencilOpStencilFail(){return this.opStencilFail}set stencilFuncRef(e){this.funcRef=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilFunc(e){this.func=e}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilFunc(){return this.func}get stencilFuncMask(){return this.funcMask}get stencilMask(){return this.mask}set stencilOpDepthFail(e){this.opDepthFail=e}set stencilFuncMask(e){this.funcMask=e}set stencilTest(e){this.enabled=e}constructor(){this.reset()}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}get stencilTest(){return this.enabled}};StencilState.ALWAYS=519,StencilState.KEEP=7680,StencilState.REPLACE=7681;var AlphaState=class{reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}set alphaBlend(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}get alphaBlend(){return this._alphaBlend}setAlphaBlendConstants(e,t,i,a){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===a||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=a,this._isBlendConstantsDirty=!0)}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}setAlphaBlendFunctionParameters(e,t,i,a){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===a||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=a,this._isBlendFunctionParametersDirty=!0)}constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}setAlphaEquationParameters(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}},TextureSampler=class{get wrapV(){return this._cachedWrapV}setParameters(e=1,t=1,i=1,a=1,n=2,s=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=a,this.samplingMode=n,this._comparisonFunction=s,this}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get wrapR(){return this._cachedWrapR}set wrapU(e){this._cachedWrapU=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}set useMipMaps(e){this._useMipMaps=e}set wrapV(e){this._cachedWrapV=e}set wrapR(e){this._cachedWrapR=e}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get useMipMaps(){return this._useMipMaps}get wrapU(){return this._cachedWrapU}},InternalTextureSource,InternalTextureSource2;InternalTextureSource2=InternalTextureSource||(InternalTextureSource={}),InternalTextureSource2[InternalTextureSource2.Unknown=0]="Unknown",InternalTextureSource2[InternalTextureSource2.Url=1]="Url",InternalTextureSource2[InternalTextureSource2.Temp=2]="Temp",InternalTextureSource2[InternalTextureSource2.Raw=3]="Raw",InternalTextureSource2[InternalTextureSource2.Dynamic=4]="Dynamic",InternalTextureSource2[InternalTextureSource2.RenderTarget=5]="RenderTarget",InternalTextureSource2[InternalTextureSource2.MultiRenderTarget=6]="MultiRenderTarget",InternalTextureSource2[InternalTextureSource2.Cube=7]="Cube",InternalTextureSource2[InternalTextureSource2.CubeRaw=8]="CubeRaw",InternalTextureSource2[InternalTextureSource2.CubePrefiltered=9]="CubePrefiltered",InternalTextureSource2[InternalTextureSource2.Raw3D=10]="Raw3D",InternalTextureSource2[InternalTextureSource2.Raw2DArray=11]="Raw2DArray",InternalTextureSource2[InternalTextureSource2.DepthStencil=12]="DepthStencil",InternalTextureSource2[InternalTextureSource2.CubeRawRGBD=13]="CubeRawRGBD",InternalTextureSource2[InternalTextureSource2.Depth=14]="Depth";var InternalTexture=class e extends TextureSampler{get Hc(){return this._uniqueId}updateSize(e,t,i=1){this._engine.updateTextureDimensions(this,e,t,i),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i}get useMipMaps(){return this.generateMipMaps}constructor(t,i,a=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new Observable,this.onErrorObservable=new Observable,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=t,this._source=i,this._uniqueId=e._Counter++,a||(this._hardwareTexture=t._createHardwareTexture())}incrementReferences(){this._references++}set useMipMaps(e){this.generateMipMaps=e}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const e=this.onRebuildCallback(this),t=t=>{t._swapAndDie(this,!1),this.isReady=e.isReady};return void(e.isAsync?e.proxy.then(t):t(e.proxy))}let e;switch(this.source){case 2:case 12:case 14:break;case 1:return void(e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(e=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case 10:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 11:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 4:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(e=>{e&&e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(e._sphericalPolynomial=this._sphericalPolynomial)}}_setUniqueId(e){this._uniqueId=e}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}getEngine(){return this._engine}_swapAndDie(e,t=!0){this._hardwareTexture?.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);const i=this._engine.getLoadedTexturesCache();let a=i.indexOf(this);-1!==a&&i.splice(a,1),a=i.indexOf(e),-1===a&&i.push(e)}get source(){return this._source}};function QueueNewFrame(e,t){if(IsWindowObjectExist()){const{requestAnimationFrame:i}=t||window;if("function"==typeof i)return i(e)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(e);return setTimeout(e,16)}InternalTexture._Counter=0;var AbstractEngine=class e{_queueNewFrame(e,t){return QueueNewFrame(e,t)}get snapshotRenderingMode(){return 0}static _FileToolsLoadFile(e,t,i,a,n,s){if(EngineFunctionContext.loadFile)return EngineFunctionContext.loadFile(e,t,i,a,n,s);throw _WarnImport("FileTools")}resize(e=!1){let t,i;if(this.adaptToDeviceRatio){const e=IsWindowObjectExist()&&window.devicePixelRatio||1,t=this._lastDevicePixelRatio/e;this._lastDevicePixelRatio=e,this._hardwareScalingLevel*=t}if(IsWindowObjectExist()&&IsDocumentAvailable())if(this._renderingCanvas){const e=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};t=this._renderingCanvas.clientWidth||e.width||this._renderingCanvas.width||100,i=this._renderingCanvas.clientHeight||e.height||this._renderingCanvas.height||100}else t=window.innerWidth,i=window.innerHeight;else t=this._renderingCanvas?this._renderingCanvas.width:100,i=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,i/this._hardwareScalingLevel,e)}setViewport(e,t,i){const a=t||this.getRenderWidth(),n=i||this.getRenderHeight(),s=e.x||0,r=e.y||0;this._cachedViewport=e,this._viewport(s*a,r*n,a*e.width,n*e.height)}_createTextureBase(t,i,a,n,s=3,r=null,o=null,l,c,h=null,u=null,m=null,d=null,f,p,_){const g="data:"===(t=t||"").substr(0,5),v="blob:"===t.substr(0,5),y=g&&-1!==t.indexOf(";base64,"),S=u||new InternalTexture(this,1);S!==u&&(S.label=t.substring(0,60));const C=t;!this._transformTextureUrl||y||u||h||(t=this._transformTextureUrl(t)),C!==t&&(S._originalUrl=C);const E=t.lastIndexOf(".");let A=d||(E>-1?t.substring(E).toLowerCase():""),T=null;A.indexOf("?")>-1&&(A=A.split("?")[0]);for(const t of e._TextureLoaders)if(t.canLoad(A,f)){T=t;break}n&&n.addPendingData(S),S.url=t,S.generateMipMaps=!i,S.samplingMode=s,S.invertY=a,S._useSRGBBuffer=this._getUseSRGBBuffer(!!_,i),this._doNotHandleContextLost||(S._buffer=h);let M=null;r&&!u&&(M=S.onLoadedObservable.add(r)),u||this._internalTexturesCache.push(S);const x=(e,a)=>{n&&n.removePendingData(S),t===C?(M&&S.onLoadedObservable.remove(M),EngineStore.UseFallbackTexture&&t!==EngineStore.FallbackTexture&&this._createTextureBase(EngineStore.FallbackTexture,i,S.invertY,n,s,null,o,l,c,h,S),e=(e||"Unknown error")+(EngineStore.UseFallbackTexture?" - Fallback texture was used":""),S.onErrorObservable.notifyObservers({message:e,exception:a}),o&&o(e,a)):(Logger.Warn(`Failed to load ${t}, falling back to ${C}`),this._createTextureBase(C,i,S.invertY,n,s,r,o,l,c,h,S,m,d,f,p,_))};if(T){const e=e=>{T.loadData(e,S,((e,t,i,a,r,o)=>{o?x("TextureLoader failed to load data"):l(S,A,n,{width:e,height:t},S.invertY,!i,a,(()=>(r(),!1)),s)}),p)};h?h instanceof ArrayBuffer?e(new Uint8Array(h)):ArrayBuffer.isView(h)?e(h):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(t=>e(new Uint8Array(t))),void 0,n?n.offlineProvider:void 0,!0,((e,t)=>{x("Unable to load "+(e&&e.responseURL,t))}))}else{const a=e=>{v&&!this._doNotHandleContextLost&&(S._buffer=e),l(S,A,n,e,S.invertY,i,!1,c,s)};!g||y?h&&("string"==typeof h.decoding||h.close)?a(h):e._FileToolsLoadImage(t||"",a,x,n?n.offlineProvider:null,f,S.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof h||h instanceof ArrayBuffer||ArrayBuffer.isView(h)||h instanceof Blob?e._FileToolsLoadImage(h,a,x,n?n.offlineProvider:null,f,S.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):h&&a(h)}return S}constructor(e,t,i){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new DepthCullingState,this._stencilStateComposer=new StencilStateComposer,this._stencilState=new StencilState,this._alphaState=new AlphaState,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new Observable,this.onCanvasFocusObservable=new Observable,this.onNewSceneAddedObservable=new Observable,this.onResizeObservable=new Observable,this.onCanvasPointerOutObservable=new Observable,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new Observable,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new Observable,this.onAfterShaderCompilationObservable=new Observable,this.onBeginFrameObservable=new Observable,this.onEndFrameObservable=new Observable,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new Observable,this.onContextRestoredObservable=new Observable,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new Observable,EngineStore.Instances.push(this),this.startTime=PrecisionDate.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,PerformanceConfigurator.SetMatrixPrecision(!!t.useHighPrecisionMatrix),IsNavigatorAvailable()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=i??!1,t.antialias=e??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.audioEngine=t.audioEngine??!0,t.stencil=t.stencil??!0,this._audioContext=t.audioEngineOptions?.audioContext??null,this._audioDestination=t.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;const a=IsWindowObjectExist()&&window.devicePixelRatio||1,n=t.limitDeviceRatio||a;i=i||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=i?1/Math.min(n,a):1,this._lastDevicePixelRatio=a,this._creationOptions=t}_getGlobalDefines(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return this.isNDCHalfZRange&&(e+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}set snapshotRendering(e){}get activeRenderLoops(){return this._activeRenderLoops}getFontOffset(e){throw new Error("getFontOffset is not implemented")}createImageBitmap(e,t){return createImageBitmap(e,t)}getLoadedTexturesCache(){return this._internalTexturesCache}_rebuildTextures(){for(const e of this.scenes)e._rebuildTextures();for(const e of this._virtualScenes)e._rebuildTextures()}_flagContextRestored(){Logger.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}getTimeStep(){return 1e3*this._timeStep}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get isDisposed(){return this._isDisposed}get currentViewport(){return this._cachedViewport}_createImageBitmapFromSource(e,t){throw new Error("createImageBitmapFromSource is not implemented")}get isWebGPU(){return this._isWebGPU}getDeltaTime(){return this._deltaTime}static _FileToolsLoadImage(e,t,i,a,n,s){throw _WarnImport("FileTools")}_rebuildEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}Effect.ResetCache()}get stencilState(){return this._stencilState}_rebuildRenderTargetWrappers(){const e=this._renderTargetWrapperCache.slice();for(const t of e)t._rebuild()}get isStencilEnable(){return this._isStencilEnable}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:IsDocumentAvailable()?document:null}_cancelFrame(){if(0!==this._frameHandler){const e=this._frameHandler;if(this._frameHandler=0,IsWindowObjectExist()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if("function"==typeof t)return t(e)}else if("function"==typeof cancelAnimationFrame)return cancelAnimationFrame(e);return clearTimeout(e)}}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}getDepthBuffer(){return this._depthCullingState.depthTest}get name(){return this._name}static get Version(){return"7.21.1"}_getShaderProcessor(e){return this._shaderProcessor}getCreationOptions(){return this._creationOptions}resetTextureCache(){for(const e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}_reportDrawCall(e=1){this._drawCalls?.addCount(e,!1)}get emptyCubeTexture(){if(!this._emptyCubeTexture){const e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}get stencilStateComposer(){return this._stencilStateComposer}ec(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}clearInternalTexturesCache(){this._internalTexturesCache.length=0}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}createRawTexture(e,t,i,a,n,s,r,o,l,c,h){throw _WarnImport("engine.rawTexture")}set compatibilityMode(e){this._compatibilityMode=!0}createRawTexture2DArray(e,t,i,a,n,s,r,o,l,c,h){throw _WarnImport("engine.rawTexture")}getLockstepMaxSteps(){return this._lockstepMaxSteps}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}_rebuildInternalTextures(){const e=this._internalTexturesCache.slice();for(const t of e)t._rebuild()}_renderViews(){return!1}getCaps(){return this._caps}createVideoElement(e){return document.createElement("video")}get depthCullingState(){return this._depthCullingState}getAudioContext(){return this._audioContext}isDeterministicLockStep(){return this._deterministicLockstep}static DefaultLoadingScreenFactory(e){throw _WarnImport("LoadingScreen")}_loadFile(e,t,i,a,n,s){const r=_loadFile(e,t,i,a,n,s);return this._activeRequests.push(r),r.onCompleteObservable.add((()=>{const e=this._activeRequests.indexOf(r);-1!==e&&this._activeRequests.splice(e,1)})),r}get compatibilityMode(){return this._compatibilityMode}getClassName(){return"AbstractEngine"}getFps(){return this._fps}set snapshotRenderingMode(e){}_rebuildGraphicsResources(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_restoreEngineAfterContextLost(e){setTimeout((async()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,i=this._depthCullingState.depthFunc,a=this._depthCullingState.depthMask,n=this._stencilState.stencilTest;await e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=i,this._depthCullingState.depthMask=a,this._stencilState.stencilTest=n,this._flagContextRestored()}),0)}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)}createRawCubeTexture(e,t,i,a,n,s,r,o){throw _WarnImport("engine.rawTexture")}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}getZOffsetUnits(){const e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}set name(e){this._name=e}stopRenderLoop(e){if(!e)return this._activeRenderLoops.length=0,void this._cancelFrame();const t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),0==this._activeRenderLoops.length&&this._cancelFrame())}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}createCanvasImage(){return document.createElement("img")}resizeImageBitmap(e,t,i){throw new Error("resizeImageBitmap is not implemented")}getRenderingCanvas(){return this._renderingCanvas}get alphaState(){return this._alphaState}_releaseRenderTargetWrapper(e){const t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)}_sharedInit(e){this._renderingCanvas=e}_rebuildBuffers(){for(const e of this._uniformBuffers)e._rebuildAfterContextLost()}get shaderPlatformName(){return this._shaderPlatformName}getColorWrite(){return this._colorWrite}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}setDepthBuffer(e){this._depthCullingState.depthTest=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const e=navigator.userAgent;this.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&IsDocumentAvailable()&&"ontouchend"in document},this._checkForMobile(),IsWindowObjectExist()&&window.addEventListener("resize",this._checkForMobile))}static _CreateCanvas(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);const i=document.createElement("canvas");return i.width=e,i.height=t,i}dispose(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();this.releaseComputeEffects?.(),Effect.ResetCache();for(const e of this._activeRequests)e.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),IsWindowObjectExist()&&window.removeEventListener("resize",this._checkForMobile);const e=EngineStore.Instances.indexOf(this);e>=0&&EngineStore.Instances.splice(e,1),EngineStore.Instances.length||(EngineStore.OnEnginesDisposedObservable.notifyObservers(this),EngineStore.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}getHostWindow(){return IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}createCanvas(t,i){return e._CreateCanvas(t,i)}get snapshotRendering(){return!1}static get NpmPackage(){return"babylonjs@7.21.1"}createRawTexture3D(e,t,i,a,n,s,r,o,l,c,h){throw _WarnImport("engine.rawTexture")}getZOffset(){const e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}getAudioDestination(){return this._audioDestination}get frameId(){return this._frameId}getHardwareScalingLevel(){return this._hardwareScalingLevel}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get doNotHandleContextLost(){return this._doNotHandleContextLost}setSize(e,t,i=!1){if(!this._renderingCanvas)return!1;if(e|=0,t|=0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let e=0;e<this.scenes.length;e++){const t=this.scenes[e];for(let e=0;e<t.cameras.length;e++){t.cameras[e]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}};AbstractEngine._TextureLoaders=[],AbstractEngine._RenderPassIdCounter=0,AbstractEngine._RescalePostProcessFactory=null;var Base64DataUrlRegEx=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),LoadFileError=class e extends RuntimeError{constructor(t,i){super(t,ErrorCodes.LoadFileError),this.name="LoadFileError",BaseError._setPrototypeOf(this,e.prototype),i instanceof WebRequest?this.request=i:this.file=i}},RequestFileError=class e extends RuntimeError{constructor(t,i){super(t,ErrorCodes.RequestFileError),this.request=i,this.name="RequestFileError",BaseError._setPrototypeOf(this,e.prototype)}},ReadFileError=class e extends RuntimeError{constructor(t,i){super(t,ErrorCodes.ReadFileError),this.file=i,this.name="ReadFileError",BaseError._setPrototypeOf(this,e.prototype)}},CleanUrl=e=>e=e.replace(/#/gm,"%23"),FileToolsOptions={DefaultRetryStrategy:RetryStrategy.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:CleanUrl},SetCorsBehavior=(e,t)=>{if((!e||0!==e.indexOf("data:"))&&FileToolsOptions.CorsBehavior)if("string"==typeof FileToolsOptions.CorsBehavior||FileToolsOptions.CorsBehavior instanceof String)t.crossOrigin=FileToolsOptions.CorsBehavior;else{const i=FileToolsOptions.CorsBehavior(e);i&&(t.crossOrigin=i)}},LoadImage=(e,t,i,a,n="",s)=>{const r=EngineStore.LastCreatedEngine;if("undefined"==typeof HTMLImageElement&&!r?._features.forceBitmapOverHTMLImageElement)return i("LoadImage is only supported in web or BabylonNative environments."),null;let o,l=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(o=URL.createObjectURL(new Blob([e],{type:n})),l=!0):o=`data:${n};base64,`+EncodeArrayBufferToBase64(e):e instanceof Blob?(o=URL.createObjectURL(e),l=!0):(o=FileToolsOptions.CleanUrl(e),o=FileToolsOptions.PreprocessUrl(o));const c=t=>{if(i){const a=o||e.toString();i(`Error while trying to load image: ${0===a.indexOf("http")||a.length<=128?a:a.slice(0,128)+"..."}`,t)}};if(r?._features.forceBitmapOverHTMLImageElement)return LoadFile(o,(a=>{r.createImageBitmap(new Blob([a],{type:n}),{premultiplyAlpha:"none",...s}).then((e=>{t(e),l&&URL.revokeObjectURL(o)})).catch((t=>{i&&i("Error while trying to load image: "+e,t)}))}),void 0,a||void 0,!0,((e,t)=>{c(t)})),null;const h=new Image;SetCorsBehavior(o,h);const u=[],m=()=>{u.forEach((e=>{e.target.removeEventListener(e.name,e.handler)})),u.length=0};u.push({target:h,name:"load",handler:()=>{m(),t(h),l&&h.src&&URL.revokeObjectURL(h.src)}}),u.push({target:h,name:"error",handler:e=>{m(),c(e),l&&h.src&&URL.revokeObjectURL(h.src)}}),u.push({target:document,name:"securitypolicyviolation",handler:e=>{if(e.blockedURI!==h.src)return;m();const t=new Error(`CSP violation of policy ${e.effectiveDirective} ${e.blockedURI}. Current policy is ${e.originalPolicy}`);EngineStore.UseFallbackTexture=!1,c(t),l&&h.src&&URL.revokeObjectURL(h.src),h.src=""}}),u.forEach((e=>{e.target.addEventListener(e.name,e.handler)}));const d="blob:"===o.substring(0,5),f="data:"===o.substring(0,5),p=()=>{d||f||!WebRequest.IsCustomRequestAvailable?h.src=o:LoadFile(o,((e,t,i)=>{const a=new Blob([e],{type:!n&&i?i:n}),s=URL.createObjectURL(a);l=!0,h.src=s}),void 0,a||void 0,!0,((e,t)=>{c(t)}))},_=()=>{a&&a.loadImage(o,h)};if(!d&&!f&&a&&a.enableTexturesOffline)a.open(_,p);else{if(-1!==o.indexOf("file:")){const e=decodeURIComponent(o.substring(5).toLowerCase());if(FilesInputStore.FilesToLoad[e]&&"undefined"!=typeof URL){try{let t;try{t=URL.createObjectURL(FilesInputStore.FilesToLoad[e])}catch(i){t=URL.createObjectURL(FilesInputStore.FilesToLoad[e])}h.src=t,l=!0}catch(e){h.src=""}return h}}p()}return h},ReadFile=(e,t,i,a,n)=>{const s=new FileReader,r={onCompleteObservable:new Observable,abort:()=>s.abort()};return s.onloadend=()=>r.onCompleteObservable.notifyObservers(r),n&&(s.onerror=()=>{n(new ReadFileError(`Unable to read ${e.name}`,e))}),s.onload=e=>{t(e.target.result)},i&&(s.onprogress=i),a?s.readAsArrayBuffer(e):s.readAsText(e),r},LoadFile=(e,t,i,a,n,s,r)=>{if(e.name)return ReadFile(e,t,i,n,s?e=>{s(void 0,e)}:void 0);const o=e;if(-1!==o.indexOf("file:")){let e=decodeURIComponent(o.substring(5).toLowerCase());0===e.indexOf("./")&&(e=e.substring(2));const a=FilesInputStore.FilesToLoad[e];if(a)return ReadFile(a,t,i,n,s?e=>s(void 0,new LoadFileError(e.message,e.file)):void 0)}const{match:l,type:c}=TestBase64DataUrl(o);if(l){const e={onCompleteObservable:new Observable,abort:()=>()=>{}};try{const e=n?DecodeBase64UrlToBinary(o):DecodeBase64UrlToString(o);t(e,void 0,c)}catch(e){s?s(void 0,e):Logger.Error(e.message||"Failed to parse the Data URL")}return TimingTools.SetImmediate((()=>{e.onCompleteObservable.notifyObservers(e)})),e}return RequestFile(o,((e,i)=>{t(e,i?.responseURL,i?.getResponseHeader("content-type"))}),i,a,n,s?e=>{s(e.request,new LoadFileError(e.message,e.request))}:void 0,r)},RequestFile=(e,t,i,a,n,s,r)=>{e=FileToolsOptions.CleanUrl(e),e=FileToolsOptions.PreprocessUrl(e);const o=FileToolsOptions.BaseUrl+e;let l=!1;const c={onCompleteObservable:new Observable,abort:()=>l=!0},h=()=>{let e,a=new WebRequest,h=null;const u=()=>{a&&(i&&a.removeEventListener("progress",i),e&&a.removeEventListener("readystatechange",e),a.removeEventListener("loadend",m))};let m=()=>{u(),c.onCompleteObservable.notifyObservers(c),c.onCompleteObservable.clear(),i=void 0,e=null,m=null,s=void 0,r=void 0,t=void 0};c.abort=()=>{l=!0,m&&m(),a&&a.readyState!==(XMLHttpRequest.DONE||4)&&a.abort(),null!==h&&(clearTimeout(h),h=null),a=null};const d=e=>{const t=e.message||"Unknown error";s&&a?s(new RequestFileError(t,a)):Logger.Error(t)},f=c=>{if(a){if(a.open("GET",o),r)try{r(a)}catch(e){return void d(e)}n&&(a.responseType="arraybuffer"),i&&a.addEventListener("progress",i),m&&a.addEventListener("loadend",m),e=()=>{if(!l&&a&&a.readyState===(XMLHttpRequest.DONE||4)){if(e&&a.removeEventListener("readystatechange",e),a.status>=200&&a.status<300||0===a.status&&(!IsWindowObjectExist()||IsFileURL())){try{t&&t(n?a.response:a.responseText,a)}catch(e){d(e)}return}const i=FileToolsOptions.DefaultRetryStrategy;if(i){const e=i(o,a,c);if(-1!==e)return u(),a=new WebRequest,void(h=setTimeout((()=>f(c+1)),e))}const r=new RequestFileError("Error status: "+a.status+" "+a.statusText+" - Unable to load "+o,a);s&&s(r)}},a.addEventListener("readystatechange",e),a.send()}};f(0)};if(a&&a.enableSceneOffline){const r=e=>{e&&e.status>400?s&&s(e):h()},o=()=>{a&&a.loadFile(FileToolsOptions.BaseUrl+e,(e=>{!l&&t&&t(e),c.onCompleteObservable.notifyObservers(c)}),i?e=>{!l&&i&&i(e)}:void 0,r,n)};a.open(o,r)}else h();return c},IsFileURL=()=>"undefined"!=typeof location&&"file:"===location.protocol,IsBase64DataUrl=e=>Base64DataUrlRegEx.test(e),TestBase64DataUrl=e=>{const t=Base64DataUrlRegEx.exec(e);if(null===t||0===t.length)return{match:!1,type:""};return{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function DecodeBase64UrlToBinary(e){return DecodeBase64ToBinary(e.split(",")[1])}var DecodeBase64UrlToString=e=>DecodeBase64ToString(e.split(",")[1]),initSideEffects=()=>{AbstractEngine._FileToolsLoadImage=LoadImage,EngineFunctionContext.loadFile=LoadFile,_functionContainer.loadFile=LoadFile},FileTools;initSideEffects();var _injectLTSFileTools=(e,t,i,a,n,s,r,o,l,c)=>{FileTools={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:i.DefaultRetryStrategy,BaseUrl:i.BaseUrl,CorsBehavior:i.CorsBehavior,PreprocessUrl:i.PreprocessUrl,IsBase64DataUrl:a,IsFileURL:n,LoadFile:s,LoadImage:r,ReadFile:o,RequestFile:l,SetCorsBehavior:c},Object.defineProperty(FileTools,"DefaultRetryStrategy",{get:function(){return i.DefaultRetryStrategy},set:function(e){i.DefaultRetryStrategy=e}}),Object.defineProperty(FileTools,"BaseUrl",{get:function(){return i.BaseUrl},set:function(e){i.BaseUrl=e}}),Object.defineProperty(FileTools,"PreprocessUrl",{get:function(){return i.PreprocessUrl},set:function(e){i.PreprocessUrl=e}}),Object.defineProperty(FileTools,"CorsBehavior",{get:function(){return i.CorsBehavior},set:function(e){i.CorsBehavior=e}})};_injectLTSFileTools(DecodeBase64UrlToBinary,DecodeBase64UrlToString,FileToolsOptions,IsBase64DataUrl,IsFileURL,LoadFile,LoadImage,ReadFile,RequestFile,SetCorsBehavior);var InstantiationTools=class{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];const t=GetClass(e);if(t)return t;Logger.Warn(e+" not found, you may have missed an import.");const i=e.split(".");let a=window||this;for(let e=0,t=i.length;e<t;e++)a=a[i[e]];return"function"!=typeof a?null:a}};function RandomGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function IsExponentOfTwo(e){let t=1;do{t*=2}while(t<e);return t===e}function Mix(e,t,i){return e*(1-i)+t*i}function NearestPOT(e){const t=CeilingPOT(e),i=FloorPOT(e);return t-e>e-i?i:t}function CeilingPOT(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function FloorPOT(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)}function GetExponentOfTwo(e,t,i=2){let a;switch(i){case 1:a=FloorPOT(e);break;case 2:a=NearestPOT(e);break;default:a=CeilingPOT(e)}return Math.min(a,t)}InstantiationTools.RegisteredExternalClasses={};var Tools=class e{static RegisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const a=t[i];e.addEventListener(a.name,a.handler,!1);try{window.parent&&window.parent.addEventListener(a.name,a.handler,!1)}catch(e){}}}static DecodeBase64(e){return DecodeBase64UrlToBinary(e)}static FetchToRef(e,t,i,a,n,s){const r=4*((Math.abs(e)*i%i|0)+(Math.abs(t)*a%a|0)*i);s.r=n[r]/255,s.g=n[r+1]/255,s.b=n[r+2]/255,s.a=n[r+3]/255}static SetImmediate(e){TimingTools.SetImmediate(e)}static IsExponentOfTwo(e){return!0}static ReadFile(e,t,i,a,n){return ReadFile(e,t,i,a,n)}static get errorsCount(){return Logger.errorsCount}static IsSafari(){return!!IsNavigatorAvailable()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}static _IsOffScreenCanvas(e){return void 0!==e.convertToBlob}static _StartPerformanceConsole(t,i=!0){i&&(e._StartUserMark(t,i),console.time&&console.time(t))}static SmoothAngleChange(e,t,i=.9){const a=this.ToRadians(e),n=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-i)*Math.sin(n)+i*Math.sin(a),(1-i)*Math.cos(n)+i*Math.cos(a)))}static _StartUserMark(t,i=!0){if(!e._Performance){if(!IsWindowObjectExist())return;e._Performance=window.performance}i&&e._Performance.mark&&e._Performance.mark(t+"-Begin")}static getFullClassName(e,t=!1){let i=null,a=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){const n=t?e:Object.getPrototypeOf(e);i=n.constructor.__bjsclassName__,a=n.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(null!=a?a+".":"")+i:null}static GetPointerPrefix(e){let t="pointer";return IsWindowObjectExist()&&!window.PointerEvent&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document||(t="mouse"),t}static get ScriptBaseUrl(){return FileToolsOptions.ScriptBaseUrl}static BackCompatCameraNoPreventDefault(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]}static LoadScript(e,t,i,a){if("function"==typeof importScripts){try{importScripts(e),t()}catch(t){i?.(`Unable to load script '${e}' in worker`,t)}return}if(!IsWindowObjectExist())return void i?.(`Cannot load script '${e}' outside of a window or a worker`);const n=document.getElementsByTagName("head")[0],s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",e),a&&(s.id=a),s.onload=()=>{t&&t()},s.onerror=t=>{i&&i(`Unable to load script '${e}'`,t)},n.appendChild(s)}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static Mix(e,t,i){return 0}static get LogCache(){return Logger.LogCache}static _EndPerformanceConsole(t,i=!0){i&&(e._EndUserMark(t,i),console.timeEnd(t))}static get BaseUrl(){return FileToolsOptions.BaseUrl}static EncodeScreenshotCanvasData(t,i,a="image/png",n,s){if("string"!=typeof n&&i){if(i){if(e._IsOffScreenCanvas(t))return void t.convertToBlob({type:a,quality:s}).then((e=>{const t=new FileReader;t.readAsDataURL(e),t.onloadend=()=>{const e=t.result;i(e)}}));const n=t.toDataURL(a,s);i(n)}}else this.ToBlob(t,(function(t){t&&e.DownloadBlob(t,n),i&&i("")}),a,s)}static FloatRound(e){return Math.fround(e)}static get DefaultRetryStrategy(){return FileToolsOptions.DefaultRetryStrategy}static get RegisteredExternalClasses(){return InstantiationTools.RegisteredExternalClasses}static Warn(e){Logger.Warn(e)}static set RegisteredExternalClasses(e){InstantiationTools.RegisteredExternalClasses=e}static DelayAsync(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static CreateScreenshotAsync(e,t,i,a="image/png",n){throw _WarnImport("ScreenshotTools")}static IsAbsoluteUrl(e){return 0===e.indexOf("//")||-1!==e.indexOf("://")&&(-1!==e.indexOf(".")&&(-1!==e.indexOf("/")&&(!(e.indexOf(":")>e.indexOf("/"))&&(e.indexOf("://")<e.indexOf(".")||(0===e.indexOf("data:")||0===e.indexOf("blob:"))))))}static GetFolderPath(e,t=!1){const i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)}static First(e,t){for(const i of e)if(t(i))return i;return null}static ClearLogCache(){Logger.ClearLogCache()}static Format(e,t=2){return e.toFixed(t)}static GetFilename(e){const t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static LoadFileAsync(e,t=!0){return new Promise(((i,a)=>{LoadFile(e,(e=>{i(e)}),void 0,void 0,t,((e,t)=>{a(t)}))}))}static get Now(){return PrecisionDate.Now}static async DumpFramebuffer(e,t,i,a,n="image/png",s,r){throw _WarnImport("DumpTools")}static get CorsBehavior(){return FileToolsOptions.CorsBehavior}static set UseFallbackTexture(e){EngineStore.UseFallbackTexture=e}static DumpData(e,t,i,a,n="image/png",s,r=!1,o=!1,l){throw _WarnImport("DumpTools")}static CreateScreenshotUsingRenderTarget(e,t,i,a,n="image/png",s=1,r=!1,o,l=!1,c=!1,h=!0,u){throw _WarnImport("ScreenshotTools")}static get CleanUrl(){return FileToolsOptions.CleanUrl}static _EndUserMark(t,i=!0){i&&e._Performance.mark&&(e._Performance.mark(t+"-End"),e._Performance.measure(t,t+"-Begin",t+"-End"))}static _EndPerformanceCounterDisabled(e,t){}static CreateScreenshot(e,t,i,a,n="image/png",s=!1,r){throw _WarnImport("ScreenshotTools")}static GetClassName(e,t=!1){let i=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__}i||(i=typeof e)}return i}static set ScriptBaseUrl(e){FileToolsOptions.ScriptBaseUrl=e}static IsEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static set LogLevels(e){Logger.LogLevels=e}static set DefaultRetryStrategy(e){FileToolsOptions.DefaultRetryStrategy=e}static get ScriptPreprocessUrl(){return FileToolsOptions.ScriptPreprocessUrl}static LoadScriptAsync(e,t){return new Promise(((i,a)=>{this.LoadScript(e,(()=>{i()}),((e,t)=>{a(t||new Error(e))}),t)}))}static ToBlob(t,i,a="image/png",n){e._IsOffScreenCanvas(t)||t.toBlob||(t.toBlob=function(e,t,i){setTimeout((()=>{const a=atob(this.toDataURL(t,i).split(",")[1]),n=a.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=a.charCodeAt(e);e(new Blob([s]))}))}),e._IsOffScreenCanvas(t)?t.convertToBlob({type:a,quality:n}).then((e=>i(e))):t.toBlob((function(e){i(e)}),a,n)}static DownloadBlob(t,i){if("download"in document.createElement("a")){if(!i){const e=new Date;i="screenshot_"+((e.getFullYear()+"-"+(e.getMonth()+1)).slice(2)+"-"+e.getDate()+"_"+e.getHours()+"-"+("0"+e.getMinutes()).slice(-2))+".png"}e.Download(t,i)}else if(t&&"undefined"!=typeof URL){const e=URL.createObjectURL(t),i=window.open("");if(!i)return;const a=i.document.createElement("img");a.onload=function(){URL.revokeObjectURL(e)},a.src=e,i.document.body.appendChild(a)}}static CreateScreenshotUsingRenderTargetAsync(e,t,i,a="image/png",n=1,s=!1,r,o=!1,l=!1,c=!0,h){throw _WarnImport("ScreenshotTools")}static DumpDataAsync(e,t,i,a="image/png",n,s=!1,r=!1,o){throw _WarnImport("DumpTools")}static MakeArray(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null}static IsBase64(e){return IsBase64DataUrl(e)}static set CorsBehavior(e){FileToolsOptions.CorsBehavior=e}static Log(e){Logger.Log(e)}static ReadFileAsDataURL(e,t,i){const a=new FileReader,n={onCompleteObservable:new Observable,abort:()=>a.abort()};return a.onloadend=()=>{n.onCompleteObservable.notifyObservers(n)},a.onload=e=>{t(e.target.result)},a.onprogress=i,a.readAsDataURL(e),n}static LoadFile(e,t,i,a,n,s){return LoadFile(e,t,i,a,n,s)}static set CleanUrl(e){FileToolsOptions.CleanUrl=e}static set ScriptPreprocessUrl(e){FileToolsOptions.ScriptPreprocessUrl=e}static get PreprocessUrl(){return FileToolsOptions.PreprocessUrl}static Instantiate(e){return InstantiationTools.Instantiate(e)}static RandomId(){return RandomGUID()}static get UseFallbackTexture(){return EngineStore.UseFallbackTexture}static ToDegrees(e){return 180*e/Math.PI}static set PreprocessUrl(e){FileToolsOptions.PreprocessUrl=e}static set fallbackTexture(e){EngineStore.FallbackTexture=e}static DeepCopy(e,t,i,a){DeepCopier.DeepCopy(e,t,i,a)}static Download(e,t){if("undefined"==typeof URL)return;const i=window.URL.createObjectURL(e),a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=i,a.download=t,a.addEventListener("click",(()=>{a.parentElement&&a.parentElement.removeChild(a)})),a.click(),window.URL.revokeObjectURL(i)}static Error(e){Logger.Error(e)}static LoadImage(e,t,i,a,n,s){return LoadImage(e,t,i,a,n,s)}static GetBabylonScriptURL(t,i){if(!t)return"";if(e.ScriptBaseUrl&&t.startsWith(e._DefaultCdnUrl)){const i="/"===e.ScriptBaseUrl[e.ScriptBaseUrl.length-1]?e.ScriptBaseUrl.substring(0,e.ScriptBaseUrl.length-1):e.ScriptBaseUrl;t=t.replace(e._DefaultCdnUrl,i)}return t=e.ScriptPreprocessUrl(t),i&&(t=e.GetAbsoluteUrl(t)),t}static UnregisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const a=t[i];e.removeEventListener(a.name,a.handler);try{e.parent&&e.parent.removeEventListener(a.name,a.handler)}catch(e){}}}static LoadBabylonScriptAsync(t){return t=e.GetBabylonScriptURL(t),e.LoadScriptAsync(t)}static FileAsURL(e){const t=new Blob([e]);return window.URL.createObjectURL(t)}static set BaseUrl(e){FileToolsOptions.BaseUrl=e}static _StartPerformanceCounterDisabled(e,t){}static set PerformanceLogLevel(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))}static ToRadians(e){return e*Math.PI/180}static LoadBabylonScript(t,i,a,n){t=e.GetBabylonScriptURL(t),e.LoadScript(t,i,a)}static SetCorsBehavior(e,t){SetCorsBehavior(e,t)}static get fallbackTexture(){return EngineStore.FallbackTexture}};Tools.UseCustomRequestHeaders=!1,Tools.CustomRequestHeaders=WebRequest.CustomRequestHeaders,Tools.GetDOMTextContent=GetDOMTextContent,Tools._DefaultCdnUrl="https://cdn.babylonjs.com",Tools.GetAbsoluteUrl="object"==typeof document?e=>{const t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?e=>new URL(e,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},Tools.NoneLogLevel=Logger.NoneLogLevel,Tools.MessageLogLevel=Logger.MessageLogLevel,Tools.WarningLogLevel=Logger.WarningLogLevel,Tools.ErrorLogLevel=Logger.ErrorLogLevel,Tools.AllLogLevel=Logger.AllLogLevel,Tools.IsWindowObjectExist=IsWindowObjectExist,Tools.PerformanceNoneLogLevel=0,Tools.PerformanceUserMarkLogLevel=1,Tools.PerformanceConsoleLogLevel=2,Tools.StartPerformanceCounter=Tools._StartPerformanceCounterDisabled,Tools.EndPerformanceCounter=Tools._EndPerformanceCounterDisabled;var AsyncLoop=class e{static Run(t,i,a,n=0){const s=new e(t,i,a,n);return s.executeNext(),s}breakLoop(){this._done=!0,this._successCallback()}static SyncAsyncForLoop(t,i,a,n,s,r=0){return e.Run(Math.ceil(t/i),(e=>{s&&s()?e.breakLoop():setTimeout((()=>{for(let n=0;n<i;++n){const r=e.index*i+n;if(r>=t)break;if(a(r),s&&s()){e.breakLoop();break}}e.executeNext()}),r)}),n)}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}constructor(e,t,i,a=0){this.iterations=e,this.index=a-1,this._done=!1,this._fn=t,this._successCallback=i}};Tools.Mix=Mix,Tools.IsExponentOfTwo=IsExponentOfTwo,EngineStore.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";var SmartArray=class e{contains(e){return-1!==this.indexOf(e)}forEach(e){for(let t=0;t<this.length;t++)e(this.data[t])}dispose(){this.reset(),this.data&&(this.data.length=0)}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}indexOf(e){const t=this.data.indexOf(e);return t>=this.length?-1:t}sort(e){this.data.sort(e)}reset(){this.length=0}concat(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}constructor(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}};SmartArray._GlobalId=0;var SmartArrayNoDuplicate=class extends SmartArray{concatWithNoDuplicate(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let t=0;t<e.length;t++){const i=(e.data||e)[t];this.pushNoDuplicate(i)}}}constructor(){super(...arguments),this._duplicateId=0}pushNoDuplicate(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)}reset(){super.reset(),this._duplicateId++}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}},Viewport=class e{constructor(e,t,i,a){this.x=e,this.y=t,this.width=i,this.height=a}toGlobalToRef(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this}clone(){return new e(this.x,this.y,this.width,this.height)}toGlobal(t,i){return new e(this.x*t,this.y*i,this.width*t,this.height*i)}},Plane=class e{static FromPoints(t,i,a){const n=new e(0,0,0,0);return n.copyFromPoints(t,i,a),n}getHashCode(){let e=this.normal.getHashCode();return e=397*e^this.d,e}clone(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)}normalize(){const e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}static SignedDistanceToPlaneFromPositionAndNormal(e,t,i){const a=-(t.x*e.x+t.y*e.y+t.z*e.z);return Vector3.Dot(i,t)+a}constructor(e,t,i,a){this.normal=new Vector3(e,t,i),this.d=a}static FromArray(t){return new e(t[0],t[1],t[2],t[3])}static FromPositionAndNormal(t,i){const a=new e(0,0,0,0);return this.FromPositionAndNormalToRef(t,i,a)}transform(t){const i=e._TmpMatrix;t.invertToRef(i);const a=i.m,n=this.normal.x,s=this.normal.y,r=this.normal.z,o=this.d,l=n*a[0]+s*a[1]+r*a[2]+o*a[3],c=n*a[4]+s*a[5]+r*a[6]+o*a[7],h=n*a[8]+s*a[9]+r*a[10]+o*a[11],u=n*a[12]+s*a[13]+r*a[14]+o*a[15];return new e(l,c,h,u)}isFrontFacingTo(e,t){return Vector3.Dot(this.normal,e)<=t}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}getClassName(){return"Plane"}copyFromPoints(e,t,i){const a=t.x-e.x,n=t.y-e.y,s=t.z-e.z,r=i.x-e.x,o=i.y-e.y,l=i.z-e.z,c=n*l-s*o,h=s*r-a*l,u=a*o-n*r,m=Math.sqrt(c*c+h*h+u*u);let d;return d=0!==m?1/m:0,this.normal.x=c*d,this.normal.y=h*d,this.normal.z=u*d,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}signedDistanceTo(e){return Vector3.Dot(e,this.normal)+this.d}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}static FromPositionAndNormalToRef(e,t,i){return i.normal.copyFrom(t),i.normal.normalize(),i.d=-e.dot(i.normal),i}};Plane._TmpMatrix=Matrix.Identity();var Frustum=class e{static IsPointInFrustum(e,t){for(let i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0}static GetPlanesToRef(t,i){e.GetNearPlaneToRef(t,i[0]),e.GetFarPlaneToRef(t,i[1]),e.GetLeftPlaneToRef(t,i[2]),e.GetRightPlaneToRef(t,i[3]),e.GetTopPlaneToRef(t,i[4]),e.GetBottomPlaneToRef(t,i[5])}static GetNearPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()}static GetLeftPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()}static GetRightPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()}static GetFarPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()}static GetTopPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()}static GetPlanes(t){const i=[];for(let e=0;e<6;e++)i.push(new Plane(0,0,0,0));return e.GetPlanesToRef(t,i),i}static GetBottomPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()}},Camera=class e extends Node{get isLeftCamera(){return this._isLeftCamera}get upVector(){return this._upVector}getDirectionToRef(e,t){Vector3.TransformNormalToRef(e,this.getWorldMatrix(),t)}freezeProjectionMatrix(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)}set orthoRight(e){this._orthoRight=e;for(const t of this._rigCameras)t.orthoRight=e}set mode(e){this._mode=e;for(const t of this._rigCameras)t.mode=e}dispose(t,i=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this._parentContainer){const e=this._parentContainer.cameras.indexOf(this);e>-1&&this._parentContainer.cameras.splice(e,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==e.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let e=this._postProcesses.length;for(;--e>=0;){const t=this._postProcesses[e];t&&t.dispose(this)}}let a=this.customRenderTargets.length;for(;--a>=0;)this.customRenderTargets[a].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(t,i)}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}get rigPostProcess(){return this._rigPostProcess}set orthoBottom(e){this._orthoBottom=e;for(const t of this._rigCameras)t.orthoBottom=e}get isRightCamera(){return this._isRightCamera}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}getViewMatrix(e){return!e&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==e.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}get position(){return this._position}get screenArea(){let t=0,i=0;if(this.mode===e.PERSPECTIVE_CAMERA)this.fovMode===e.FOVMODE_VERTICAL_FIXED?(i=2*this.minZ*Math.tan(this.undefinedc/2),t=this.getEngine().getAspectRatio(this)*i):(t=2*this.minZ*Math.tan(this.undefinedc/2),i=t/this.getEngine().getAspectRatio(this));else{const e=this.getEngine().getRenderWidth()/2,a=this.getEngine().getRenderHeight()/2;t=(this.orthoRight??e)-(this.orthoLeft??-e),i=(this.orthoTop??a)-(this.orthoBottom??-a)}return t*i}constructor(t,i,a,n=!0){super(t,a,!1),this._position=Vector3.Zero(),this._upVector=Vector3.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.undefinedc=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=e.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new Viewport(0,0,1,1),this.layerMask=268435455,this.fovMode=e.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=e.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new Observable,this.onProjectionMatrixChangedObservable=new Observable,this.onAfterCheckInputsObservable=new Observable,this.onRestoreStateObservable=new Observable,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new Matrix,this._postProcesses=new Array,this._activeMeshes=new SmartArray(256),this._globalPosition=Vector3.Zero(),this._computedViewMatrix=Matrix.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=Matrix.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=Quaternion.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),n&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=i,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${t}`)}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}getActiveMeshes(){return this._activeMeshes}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}attachPostProcess(e,t=null){return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(Logger.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}set orthoLeft(e){this._orthoLeft=e;for(const t of this._rigCameras)t.orthoLeft=e}_calculateHandednessMultiplier(){let e=this.getScene().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),e}getForwardRayToRef(e,t=100,i,a){throw _WarnImport("Ray")}_setupInputs(){}_cascadePostProcessesToRigCams(){const e=this._getFirstPostProcess();e&&e.markTextureDirty();for(let e=0,t=this._rigCameras.length;e<t;e++){const t=this._rigCameras[e],i=t._rigPostProcess;if(i){"pass"===i.getEffectName()&&(t.isIntermediate=0===this._postProcesses.length),t._postProcesses=this._postProcesses.slice(0).concat(i),i.markTextureDirty()}else t._postProcesses=this._postProcesses.slice(0)}}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}serialize(){const e=SerializationHelper.Serialize(this);return e.Hc=this.Hc,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),SerializationHelper.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}_updateRigCameras(){for(let e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].undefinedc=this.undefinedc,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===e.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}setCameraRigMode(t,i){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=i.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==e.RIG_MODE_NONE){const e=this.createRigCamera(this.name+"_L",0);e&&(e._isLeftCamera=!0);const t=this.createRigCamera(this.name+"_R",1);t&&(t._isRightCamera=!0),e&&t&&(this._rigCameras.push(e),this._rigCameras.push(t))}this._setRigMode(i),this._cascadePostProcessesToRigCams(),this.update()}}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}_updateCache(e){e||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}get orthoLeft(){return this._orthoLeft}_setRigMode(e){}static Parse(t,i){const a=t.type,n=e.GetConstructorFromName(a,t.name,i,t.interaxial_distance,t.isStereoscopicSideBySide),s=SerializationHelper.Parse(n,t,i);if(void 0!==t.parentId&&(s._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(s._waitingParentInstanceIndex=t.parentInstanceIndex),s.inputs&&(s.inputs.parse(t),s._setupInputs()),t.upVector&&(s.upVector=Vector3.FromArray(t.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(Vector3.FromArray(t.position))),t.target&&s.setTarget&&s.setTarget(Vector3.FromArray(t.target)),t.cameraRigMode){const e=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};s.setCameraRigMode(t.cameraRigMode,e)}if(t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],a=GetClass("BABYLON.Animation");a&&s.animations.push(a.Parse(i))}Node.ParseAnimationRanges(s,t,i)}return t.autoAnimate&&i.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&s.setEnabled(t.isEnabled),s}isReady(e=!1){if(e)for(const e of this._postProcesses)if(e&&!e.isReady())return!1;return super.isReady(e)}getProjectionMatrix(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const i=this.getEngine(),a=this.getScene(),n=i.useReverseDepthBuffer;if(this.mode===e.PERSPECTIVE_CAMERA){let t;this._cache.undefinedc=this.undefinedc,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=i.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),t=a.useRightHandedSystem?Matrix.PerspectiveFovRHToRef:Matrix.PerspectiveFovLHToRef,t(this.undefinedc,i.getAspectRatio(this),n?this.maxZ:this.minZ,n?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===e.FOVMODE_VERTICAL_FIXED,i.isNDCHalfZRange,this.projectionPlaneTilt,n)}else{const e=i.getRenderWidth()/2,t=i.getRenderHeight()/2;a.useRightHandedSystem?this.oblique?Matrix.ObliqueOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-t,this.orthoTop??t,n?this.maxZ:this.minZ,n?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,i.isNDCHalfZRange):Matrix.OrthoOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-t,this.orthoTop??t,n?this.maxZ:this.minZ,n?this.minZ:this.maxZ,this._projectionMatrix,i.isNDCHalfZRange):this.oblique?Matrix.ObliqueOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-t,this.orthoTop??t,n?this.maxZ:this.minZ,n?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,i.isNDCHalfZRange):Matrix.OrthoOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-t,this.orthoTop??t,n?this.maxZ:this.minZ,n?this.minZ:this.maxZ,this._projectionMatrix,i.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=this.oblique?.angle,this._cache.obliqueLength=this.oblique?.length,this._cache.obliqueOffset=this.oblique?.offset,this._cache.renderWidth=i.getRenderWidth(),this._cache.renderHeight=i.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}detachPostProcess(e){const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}detachControl(e){}_initCache(){super._initCache(),this._cache.position=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.undefinedc=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}get rigCameras(){return this._rigCameras}_computeObliqueDistance(e){return(this.radius||(this.target?Vector3.Distance(this.position,this.target):this.position.length()))+e}isInFrustum(e,t=!1){if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){let t=!1;return this.rigCameras.forEach((i=>{i._updateFrustumPlanes(),t=t||e.isInFrustum(i._frustumPlanes)})),t}return e.isInFrustum(this._frustumPlanes)}_getFirstPostProcess(){for(let e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}toString(e){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}set upVector(e){this._upVector=e}getDirection(e){const t=Vector3.Zero();return this.getDirectionToRef(e,t),t}_getViewMatrix(){return Matrix.Identity()}_restoreStateValues(){return!!this._stateStored&&(this.undefinedc=this._storedFov,!0)}get globalPosition(){return this._globalPosition}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Frustum.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}_getVRProjectionMatrix(){return Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=Tools.ToRadians(t/.0637))}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Camera"}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}get orthoTop(){return this._orthoTop}computeWorldMatrix(){return this.getWorldMatrix()}attachControl(e,t){}isCompletelyInFrustum(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}set position(e){this._position=e}createRigCamera(e,t){return null}hasStateStored(){return!!this._stateStored}applyVerticalCorrection(){const e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}_isSynchronizedProjectionMatrix(){let t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;const i=this.getEngine();return this.mode===e.PERSPECTIVE_CAMERA?t=this._cache.undefinedc===this.undefinedc&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===i.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(t=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight(),this.oblique&&(t=t&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),t}getForwardRay(e=100,t,i){throw _WarnImport("Ray")}get mode(){return this._mode}clone(t,i=null){const a=SerializationHelper.Clone(e.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return a.name=t,a.parent=i,this.onClonedObservable.notifyObservers(a),a}set orthoTop(e){this._orthoTop=e;for(const t of this._rigCameras)t.orthoTop=e}get orthoBottom(){return this._orthoBottom}storeState(){return this._stateStored=!0,this._storedFov=this.undefinedc,this}get orthoRight(){return this._orthoRight}static GetConstructorFromName(t,i,a,n=0,s=!0){const r=Node.Construct(t,i,a,{interaxial_distance:n,isStereoscopicSideBySide:s});return r||(()=>e._CreateDefaultParsedCamera(i,a))}get hasMoved(){return this._hasMoved}};Camera._CreateDefaultParsedCamera=(e,t)=>{throw _WarnImport("UniversalCamera")},Camera.PERSPECTIVE_CAMERA=0,Camera.ORTHOGRAPHIC_CAMERA=1,Camera.FOVMODE_VERTICAL_FIXED=0,Camera.FOVMODE_HORIZONTAL_FIXED=1,Camera.RIG_MODE_NONE=0,Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Camera.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Camera.RIG_MODE_VR=20,Camera.RIG_MODE_CUSTOM=22,Camera.ForceAttachControlToAlwaysPreventDefault=!1,__decorate([serializeAsVector3("position")],Camera.prototype,"_position",void 0),__decorate([serializeAsVector3("upVector")],Camera.prototype,"_upVector",void 0),__decorate([serialize()],Camera.prototype,"orthoLeft",null),__decorate([serialize()],Camera.prototype,"orthoRight",null),__decorate([serialize()],Camera.prototype,"orthoBottom",null),__decorate([serialize()],Camera.prototype,"orthoTop",null),__decorate([serialize()],Camera.prototype,"fov",void 0),__decorate([serialize()],Camera.prototype,"projectionPlaneTilt",void 0),__decorate([serialize()],Camera.prototype,"minZ",void 0),__decorate([serialize()],Camera.prototype,"maxZ",void 0),__decorate([serialize()],Camera.prototype,"inertia",void 0),__decorate([serialize()],Camera.prototype,"mode",null),__decorate([serialize()],Camera.prototype,"layerMask",void 0),__decorate([serialize()],Camera.prototype,"fovMode",void 0),__decorate([serialize()],Camera.prototype,"cameraRigMode",void 0),__decorate([serialize()],Camera.prototype,"interaxialDistance",void 0),__decorate([serialize()],Camera.prototype,"isStereoscopicSideBySide",void 0);var SceneLoaderFlags=class e{static set loggingLevel(t){e._LoggingLevel=t}static get CleanBoneMatrixWeights(){return e._CleanBoneMatrixWeights}static get ShowLoadingScreen(){return e._ShowLoadingScreen}static set ShowLoadingScreen(t){e._ShowLoadingScreen=t}static set CleanBoneMatrixWeights(t){e._CleanBoneMatrixWeights=t}static set ForceFullSceneLoadingForIncremental(t){e._ForceFullSceneLoadingForIncremental=t}static get loggingLevel(){return e._LoggingLevel}static get ForceFullSceneLoadingForIncremental(){return e._ForceFullSceneLoadingForIncremental}};SceneLoaderFlags._ForceFullSceneLoadingForIncremental=!1,SceneLoaderFlags._ShowLoadingScreen=!0,SceneLoaderFlags._CleanBoneMatrixWeights=!1,SceneLoaderFlags._LoggingLevel=0;var useOpenGLOrientationForUV=!1;function CopyFloatData(e,t,i,a,n,s,r,o){const l=t*VertexBuffer.GetTypeByteLength(i),c=r*t;if(o.length!==c)throw new Error("Output length is not valid");if(i===VertexBuffer.FLOAT&&n===l)if(e instanceof Array){const t=a/4;o.set(e,t)}else if(e instanceof ArrayBuffer){const t=new Float32Array(e,a,c);o.set(t)}else{const t=e.byteOffset+a;if(t%4)return Logger.Warn("CopyFloatData: copied misaligned data."),void o.set(new Float32Array(e.buffer.slice(t,t+4*c)));const i=new Float32Array(e.buffer,t,c);o.set(i)}else VertexBuffer.ForEach(e,a,n,t,i,c,s,((e,t)=>o[t]=e))}var Geometry=class e{toLeftHanded(){const e=this.getIndices(!1);if(null!=e&&e.length>0){for(let t=0;t<e.length;t+=3){const i=e[t+0];e[t+0]=e[t+2],e[t+2]=i}this.setIndices(e)}const t=this.getVerticesData(VertexBuffer.PositionKind,!1);if(null!=t&&t.length>0){for(let e=0;e<t.length;e+=3)t[e+2]=-t[e+2];this.setVerticesData(VertexBuffer.PositionKind,t,!1)}const i=this.getVerticesData(VertexBuffer.NormalKind,!1);if(null!=i&&i.length>0){for(let e=0;e<i.length;e+=3)i[e+2]=-i[e+2];this.setVerticesData(VertexBuffer.NormalKind,i,!1)}}setIndices(e,t=null,i=!1){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i,"Geometry_"+this.id+"_IndexBuffer")),null!=t&&(this._totalVertices=t);for(const e of this._meshes)e._createGlobalSubMesh(!0),e.synchronizeInstances();this._notifyUpdate()}setVerticesData(e,t,i=!1,a){i&&Array.isArray(t)&&(t=new Float32Array(t));const n=new VertexBuffer(this._engine,t,e,{updatable:i,postponeInternalCreation:0===this._meshes.length,stride:a,label:"Geometry_"+this.id+"_"+e});this.setVerticesBuffer(n)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const e in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}_queueLoad(e,t){this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,(i=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(i),this),this.delayLoadState=1,this._delayInfo=[],e.removePendingData(this);const a=this._meshes,n=a.length;for(let e=0;e<n;e++)this._applyToMesh(a[e]);t&&t()}),void 0,!0))}releaseForMesh(e,t){const i=this._meshes,a=i.indexOf(e);-1!==a&&(i.splice(a,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===i.length&&t&&this.dispose())}serializeVerticeData(){const e=this.serialize();return this.isVerticesDataPresent(VertexBuffer.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(VertexBuffer.PositionKind)),this.isVertexBufferUpdatable(VertexBuffer.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(VertexBuffer.NormalKind)),this.isVertexBufferUpdatable(VertexBuffer.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(VertexBuffer.TangentKind)),this.isVertexBufferUpdatable(VertexBuffer.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(VertexBuffer.UVKind)),this.isVertexBufferUpdatable(VertexBuffer.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.UV2Kind)&&(e.uvs2=this._toNumberArray(this.getVerticesData(VertexBuffer.UV2Kind)),this.isVertexBufferUpdatable(VertexBuffer.UV2Kind)&&(e.uvs2._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.UV3Kind)&&(e.uvs3=this._toNumberArray(this.getVerticesData(VertexBuffer.UV3Kind)),this.isVertexBufferUpdatable(VertexBuffer.UV3Kind)&&(e.uvs3._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.UV4Kind)&&(e.uvs4=this._toNumberArray(this.getVerticesData(VertexBuffer.UV4Kind)),this.isVertexBufferUpdatable(VertexBuffer.UV4Kind)&&(e.uvs4._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.UV5Kind)&&(e.uvs5=this._toNumberArray(this.getVerticesData(VertexBuffer.UV5Kind)),this.isVertexBufferUpdatable(VertexBuffer.UV5Kind)&&(e.uvs5._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.UV6Kind)&&(e.uvs6=this._toNumberArray(this.getVerticesData(VertexBuffer.UV6Kind)),this.isVertexBufferUpdatable(VertexBuffer.UV6Kind)&&(e.uvs6._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(VertexBuffer.ColorKind)),this.isVertexBufferUpdatable(VertexBuffer.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(VertexBuffer.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(VertexBuffer.MatricesWeightsKind)),this.isVertexBufferUpdatable(VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}static _CleanMatricesWeights(e,t){const i=.001;if(!SceneLoaderFlags.CleanBoneMatrixWeights)return;let a=0;if(!(e.skeletonId>-1))return;{const i=t.getScene().getLastSkeletonById(e.skeletonId);if(!i)return;a=i.bones.length}const n=t.getVerticesData(VertexBuffer.MatricesIndicesKind),s=t.getVerticesData(VertexBuffer.MatricesIndicesExtraKind),r=e.matricesWeights,o=e.matricesWeightsExtra,l=e.numBoneInfluencer,c=r.length;for(let e=0;e<c;e+=4){let t=0,c=-1;for(let a=0;a<4;a++){const n=r[e+a];t+=n,n<i&&c<0&&(c=a)}if(o)for(let a=0;a<4;a++){const n=o[e+a];t+=n,n<i&&c<0&&(c=a+4)}if((c<0||c>l-1)&&(c=l-1),t>i){const i=1/t;for(let t=0;t<4;t++)r[e+t]*=i;if(o)for(let t=0;t<4;t++)o[e+t]*=i}else c>=4?(o[e+c-4]=1-t,s[e+c-4]=a):(r[e+c]=1-t,n[e+c]=a)}t.setVerticesData(VertexBuffer.MatricesIndicesKind,n),e.matricesWeightsExtra&&t.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,s)}getVerticesDataKinds(){const e=[];let t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}serialize(){const e={};return e.id=this.id,e.Hc=this.Hc,e.updatable=this._updatable,Tags&&Tags.HasTags(this)&&(e.tags=Tags.GetTags(this)),e}static Parse(t,i,a){const n=new e(t.id,i,void 0,t.updatable);return n._loadedUniqueId=t.Hc,Tags&&Tags.AddTagsTo(n,t.tags),t.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=a+t.delayLoadingFile,n._boundingInfo=new BoundingInfo(Vector3.FromArray(t.boundingBoxMinimum),Vector3.FromArray(t.boundingBoxMaximum)),n._delayInfo=[],t.hasUVs&&n._delayInfo.push(VertexBuffer.UVKind),t.hasUVs2&&n._delayInfo.push(VertexBuffer.UV2Kind),t.hasUVs3&&n._delayInfo.push(VertexBuffer.UV3Kind),t.hasUVs4&&n._delayInfo.push(VertexBuffer.UV4Kind),t.hasUVs5&&n._delayInfo.push(VertexBuffer.UV5Kind),t.hasUVs6&&n._delayInfo.push(VertexBuffer.UV6Kind),t.hasColors&&n._delayInfo.push(VertexBuffer.ColorKind),t.hasMatricesIndices&&n._delayInfo.push(VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&n._delayInfo.push(VertexBuffer.MatricesWeightsKind),n._delayLoadingFunction=VertexData.ImportVertexData):VertexData.ImportVertexData(t,n),i.pushGeometry(n,!0),n}copyVerticesData(e,t){const i=this.getVertexBuffer(e);if(!i)return;t[e]||(t[e]=new Float32Array(this._totalVertices*i.getSize()));const a=i.getData();a&&CopyFloatData(a,i.getSize(),i.type,i.byteOffset,i.byteStride,i.normalized,this._totalVertices,t[e])}applyToMesh(e){if(e._geometry===this)return;const t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();const i=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}load(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))}removeVerticesData(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}updateVerticesData(e,t,i=!1){const a=this.getVertexBuffer(e);a&&(a.update(t),e===VertexBuffer.PositionKind&&this._updateBoundingInfo(i,t),this._notifyUpdate(e))}_resetPointsArrayCache(){this._positions=null}static CreateGeometryForMesh(t){const i=new e(e.RandomId(),t.getScene());return i.applyToMesh(t),i}getIndices(e,t){if(!this.isReady())return null;const i=this._indices;return t||e&&1!==this._meshes.length?i.slice():i}updateVerticesDataDirectly(e,t,i,a=!1){const n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,i,a),this._notifyUpdate(e))}getTotalVertices(){return this.isReady()?this._totalVertices:0}setVerticesBuffer(e,t=null,i=!0){const a=e.getKind();this._vertexBuffers[a]&&i&&this._vertexBuffers[a].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[a]=e;const n=this._meshes,s=n.length;if(a===VertexBuffer.PositionKind){this._totalVertices=t??e._maxVerticesCount,this._updateExtend(e.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const i=this._extend&&this._extend.minimum||new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=this._extend&&this._extend.maximum||new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let e=0;e<s;e++){const t=n[e];t.buildBoundingInfo(i,a),t._createGlobalSubMesh(t.isUnIndexed),t.computeWorldMatrix(!0),t.synchronizeInstances()}}this._notifyUpdate(a)}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const e=new Set;for(const t in this._vertexBuffers)e.add(this._vertexBuffers[t].getWrapperBuffer());e.forEach((e=>{e._rebuild()}))}getVertexBuffer(e){return this.isReady()?this._vertexBuffers[e]:null}getEngine(){return this._engine}getVerticesData(e,t,i){const a=this.getVertexBuffer(e);return a?a.getFloatData(this._totalVertices,i||t&&1!==this._meshes.length):null}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}constructor(e,t,i,a=!1,n=null){this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||EngineStore.LastCreatedScene,this._scene&&(this.id=e,this.Hc=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=a,i?this.setAllVerticesData(i,a):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),n&&(this.applyToMesh(n),n.computeWorldMatrix(!0)))}_bind(e,t,i,a){if(!e)return;void 0===t&&(t=this._indexBuffer);const n=this.getVertexBuffers();if(!n)return;if(t!=this._indexBuffer||!this._vertexArrayObjects&&!a)return void this._engine.bindBuffers(n,t,e,i);const s=a||this._vertexArrayObjects,r=this._engine;s[e.key]||(s[e.key]=r.recordVertexArrayObject(n,t,e,i)),r.bindVertexArrayObject(s[e.key],t)}get extend(){return this._extend}get doNotSerialize(){for(let e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}dispose(){const e=this._meshes,t=e.length;let i;for(i=0;i<t;i++)this.releaseForMesh(e[i]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const e in this._vertexBuffers)this._vertexBuffers[e].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const e=this._parentContainer.geometries.indexOf(this);e>-1&&this._parentContainer.geometries.splice(e,1),this._parentContainer=null}this._isDisposed=!0}_toNumberArray(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}isDisposed(){return this._isDisposed}static RandomId(){return Tools.RandomId()}_notifyUpdate(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const e of this._meshes)e._markSubMeshesAsAttributesDirty()}static ExtractFromMesh(e,t){const i=e._geometry;return i?i.copy(t):null}_generatePointsArray(){if(this._positions)return!0;const e=this.getVerticesData(VertexBuffer.PositionKind);if(!e||0===e.length)return!1;for(let t=3*this._positionsCache.length,i=this._positionsCache.length;t<e.length;t+=3,++i)this._positionsCache[i]=Vector3.FromArray(e,t);for(let t=0,i=0;t<e.length;t+=3,++i)this._positionsCache[i].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}static _ImportGeometry(t,i){const a=i.getScene(),n=t.geometryUniqueId,s=t.geometryId;if(n||s){const e=n?this._GetGeometryByLoadedUniqueId(n,a):a.getGeometryById(s);e&&e.applyToMesh(i)}else if(t instanceof ArrayBuffer){const e=i._binaryInfo;if(e.positionsAttrDesc&&e.positionsAttrDesc.count>0){const a=new Float32Array(t,e.positionsAttrDesc.offset,e.positionsAttrDesc.count);i.setVerticesData(VertexBuffer.PositionKind,a,!1)}if(e.normalsAttrDesc&&e.normalsAttrDesc.count>0){const a=new Float32Array(t,e.normalsAttrDesc.offset,e.normalsAttrDesc.count);i.setVerticesData(VertexBuffer.NormalKind,a,!1)}if(e.tangetsAttrDesc&&e.tangetsAttrDesc.count>0){const a=new Float32Array(t,e.tangetsAttrDesc.offset,e.tangetsAttrDesc.count);i.setVerticesData(VertexBuffer.TangentKind,a,!1)}if(e.uvsAttrDesc&&e.uvsAttrDesc.count>0){const a=new Float32Array(t,e.uvsAttrDesc.offset,e.uvsAttrDesc.count);if(useOpenGLOrientationForUV)for(let e=1;e<a.length;e+=2)a[e]=1-a[e];i.setVerticesData(VertexBuffer.UVKind,a,!1)}if(e.uvs2AttrDesc&&e.uvs2AttrDesc.count>0){const a=new Float32Array(t,e.uvs2AttrDesc.offset,e.uvs2AttrDesc.count);if(useOpenGLOrientationForUV)for(let e=1;e<a.length;e+=2)a[e]=1-a[e];i.setVerticesData(VertexBuffer.UV2Kind,a,!1)}if(e.uvs3AttrDesc&&e.uvs3AttrDesc.count>0){const a=new Float32Array(t,e.uvs3AttrDesc.offset,e.uvs3AttrDesc.count);if(useOpenGLOrientationForUV)for(let e=1;e<a.length;e+=2)a[e]=1-a[e];i.setVerticesData(VertexBuffer.UV3Kind,a,!1)}if(e.uvs4AttrDesc&&e.uvs4AttrDesc.count>0){const a=new Float32Array(t,e.uvs4AttrDesc.offset,e.uvs4AttrDesc.count);if(useOpenGLOrientationForUV)for(let e=1;e<a.length;e+=2)a[e]=1-a[e];i.setVerticesData(VertexBuffer.UV4Kind,a,!1)}if(e.uvs5AttrDesc&&e.uvs5AttrDesc.count>0){const a=new Float32Array(t,e.uvs5AttrDesc.offset,e.uvs5AttrDesc.count);if(useOpenGLOrientationForUV)for(let e=1;e<a.length;e+=2)a[e]=1-a[e];i.setVerticesData(VertexBuffer.UV5Kind,a,!1)}if(e.uvs6AttrDesc&&e.uvs6AttrDesc.count>0){const a=new Float32Array(t,e.uvs6AttrDesc.offset,e.uvs6AttrDesc.count);if(useOpenGLOrientationForUV)for(let e=1;e<a.length;e+=2)a[e]=1-a[e];i.setVerticesData(VertexBuffer.UV6Kind,a,!1)}if(e.colorsAttrDesc&&e.colorsAttrDesc.count>0){const a=new Float32Array(t,e.colorsAttrDesc.offset,e.colorsAttrDesc.count);i.setVerticesData(VertexBuffer.ColorKind,a,!1,e.colorsAttrDesc.stride)}if(e.matricesIndicesAttrDesc&&e.matricesIndicesAttrDesc.count>0){const a=new Int32Array(t,e.matricesIndicesAttrDesc.offset,e.matricesIndicesAttrDesc.count),n=[];for(let e=0;e<a.length;e++){const t=a[e];n.push(255&t),n.push((65280&t)>>8),n.push((16711680&t)>>16),n.push(t>>24&255)}i.setVerticesData(VertexBuffer.MatricesIndicesKind,n,!1)}if(e.matricesIndicesExtraAttrDesc&&e.matricesIndicesExtraAttrDesc.count>0){const a=new Int32Array(t,e.matricesIndicesExtraAttrDesc.offset,e.matricesIndicesExtraAttrDesc.count),n=[];for(let e=0;e<a.length;e++){const t=a[e];n.push(255&t),n.push((65280&t)>>8),n.push((16711680&t)>>16),n.push(t>>24&255)}i.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,n,!1)}if(e.matricesWeightsAttrDesc&&e.matricesWeightsAttrDesc.count>0){const a=new Float32Array(t,e.matricesWeightsAttrDesc.offset,e.matricesWeightsAttrDesc.count);i.setVerticesData(VertexBuffer.MatricesWeightsKind,a,!1)}if(e.indicesAttrDesc&&e.indicesAttrDesc.count>0){const a=new Int32Array(t,e.indicesAttrDesc.offset,e.indicesAttrDesc.count);i.setIndices(a,null)}if(e.subMeshesAttrDesc&&e.subMeshesAttrDesc.count>0){const a=new Int32Array(t,e.subMeshesAttrDesc.offset,5*e.subMeshesAttrDesc.count);i.subMeshes=[];for(let t=0;t<e.subMeshesAttrDesc.count;t++){const e=a[5*t+0],n=a[5*t+1],s=a[5*t+2],r=a[5*t+3],o=a[5*t+4];SubMesh.AddToMesh(e,n,s,r,o,i)}}}else if(t.positions&&t.normals&&t.indices){if(i.setVerticesData(VertexBuffer.PositionKind,t.positions,t.positions._updatable),i.setVerticesData(VertexBuffer.NormalKind,t.normals,t.normals._updatable),t.tangents&&i.setVerticesData(VertexBuffer.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&i.setVerticesData(VertexBuffer.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&i.setVerticesData(VertexBuffer.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&i.setVerticesData(VertexBuffer.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&i.setVerticesData(VertexBuffer.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&i.setVerticesData(VertexBuffer.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&i.setVerticesData(VertexBuffer.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&i.setVerticesData(VertexBuffer.ColorKind,Color4.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(VertexBuffer.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{const e=[];for(let i=0;i<t.matricesIndices.length;i++){const a=t.matricesIndices[i];e.push(255&a),e.push((65280&a)>>8),e.push((16711680&a)>>16),e.push(a>>24&255)}i.setVerticesData(VertexBuffer.MatricesIndicesKind,e,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{const e=[];for(let i=0;i<t.matricesIndicesExtra.length;i++){const a=t.matricesIndicesExtra[i];e.push(255&a),e.push((65280&a)>>8),e.push((16711680&a)>>16),e.push(a>>24&255)}i.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,e,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,i),i.setVerticesData(VertexBuffer.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&i.setVerticesData(VertexBuffer.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),i.setIndices(t.indices,null)}if(t.subMeshes){i.subMeshes=[];for(let e=0;e<t.subMeshes.length;e++){const a=t.subMeshes[e];SubMesh.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,i)}}i._shouldGenerateFlatShading&&(i.convertToFlatShadedMesh(),i._shouldGenerateFlatShading=!1),i.computeWorldMatrix(!0),a.onMeshImportedObservable.notifyObservers(i)}setIndexBuffer(e,t,i){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=e,this._totalVertices=t,this._totalIndices=i,e.is32Bits||(e.is32Bits=this._totalIndices>65535);for(const e of this._meshes)e._createGlobalSubMesh(!0),e.synchronizeInstances();this._notifyUpdate()}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}set boundingBias(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}updateIndices(e,t,i=!1){if(this._indexBuffer)if(this._indexBufferIsUpdatable){const a=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),a)for(const e of this._meshes)e._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};const e=this._meshes,t=e.length;for(let i=0;i<t;i++)e[i]._invalidateInstanceVertexArrayObject()}}_releaseVertexArrayObject(e=null){e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}copy(t){const i=new VertexData;i.indices=[];const a=this.getIndices();if(a)for(let e=0;e<a.length;e++)i.indices.push(a[e]);let n,s=!1,r=!1;for(n in this._vertexBuffers){const e=this.getVerticesData(n);if(e&&(e instanceof Float32Array?i.set(new Float32Array(e),n):i.set(e.slice(0),n),!r)){const e=this.getVertexBuffer(n);e&&(s=e.isUpdatable(),r=!s)}}const o=new e(t,this._scene,i,s);for(n in o.delayLoadState=this.delayLoadState,o.delayLoadingFile=this.delayLoadingFile,o._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)o._delayInfo=o._delayInfo||[],o._delayInfo.push(n);return o._boundingInfo=new BoundingInfo(this._extend.minimum,this._extend.maximum),o}isVertexBufferUpdatable(e){const t=this._vertexBuffers[e];return!!t&&t.isUpdatable()}_updateBoundingInfo(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){const e=this._meshes;for(const t of e){t.hasBoundingInfo?t.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):t.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const e=t.subMeshes;for(const t of e)t.refreshBoundingInfo()}}}_applyToMesh(e){const t=this._meshes.length;for(const i in this._vertexBuffers)1===t&&this._vertexBuffers[i].create(),i===VertexBuffer.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}_updateExtend(e=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&!(e=this.getVerticesData(VertexBuffer.PositionKind)))return;this._extend=extractMinAndMax(e,0,this._totalVertices,this.boundingBias,3)}}get boundingBias(){return this._boundingBias}static _GetGeometryByLoadedUniqueId(e,t){for(let i=0;i<t.geometries.length;i++)if(t.geometries[i]._loadedUniqueId===e)return t.geometries[i];return null}isVerticesDataPresent(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}setAllVerticesData(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}getScene(){return this._scene}get meshes(){return this._meshes}};function IsWrapper(e){return void 0===e.getPipelineContext}var WebGLShaderProcessor=class{postProcessor(e,t,i,a,n){if(n.drawBuffersExtensionDisabled){const t=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(t,"")}return e}constructor(){this.shaderLanguage=0}},varyingRegex=/(flat\s)?\s*varying\s*.*/,WebGL2ShaderProcessor=class{varyingCheck(e,t){return varyingRegex.test(e)}postProcessor(e,t,i){const a=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i){const t=-1!==e.search(/layout *\(location *= *0\) *out/g);e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(a||t?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e}return e}constructor(){this.shaderLanguage=0}attributeProcessor(e){return e.replace("attribute","in")}varyingProcessor(e,t){return e.replace("varying",t?"in":"out")}},WebGLDataBuffer=class extends DataBuffer{constructor(e){super(),this._buffer=e}get underlyingResource(){return this._buffer}},WebGLHardwareTexture=class{release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}constructor(e=null,t){if(this._MSAARenderBuffers=null,this._context=t,!e&&!(e=t.createTexture()))throw new Error("Unable to create webGL texture");this.set(e)}addMSAARenderBuffer(e){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(e)}set(e){this._webGLTexture=e}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const e of this._MSAARenderBuffers)this._context.deleteRenderbuffer(e);this._MSAARenderBuffers=null}}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}setUsage(){}get underlyingResource(){return this._webGLTexture}getMSAARenderBuffer(e=0){return this._MSAARenderBuffers?.[e]??null}},BufferPointer=class{},ThinEngine=class e extends AbstractEngine{setIntArray(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)}bindIndexBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)}recordVertexArrayObject(e,t,i,a){const n=this._gl.createVertexArray();if(!n)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(n),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,a),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),n}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}setArray(e,t){return!!e&&(!(t.length<1)&&(this._gl.uniform1fv(e,t),!0))}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}disableInstanceAttributeByName(e){if(!this._currentEffect)return;const t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}_updateRenderBuffer(e,t,i,a,n,s,r,o=!0){const l=this._gl;return l.bindRenderbuffer(l.RENDERBUFFER,e),a>1&&l.renderbufferStorageMultisample?l.renderbufferStorageMultisample(l.RENDERBUFFER,a,s,t,i):l.renderbufferStorage(l.RENDERBUFFER,n,t,i),l.framebufferRenderbuffer(l.FRAMEBUFFER,r,l.RENDERBUFFER,e),o&&l.bindRenderbuffer(l.RENDERBUFFER,null),e}_deletePipelineContext(e){const t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,resetCachedPipeline(t),this._gl.deleteProgram(t.program))}_setTextureParameterInteger(e,t,i,a){a&&this._bindTextureDirectly(e,a,!0,!0),this._gl.texParameteri(e,t,i)}_setTextureParameterFloat(e,t,i,a){this._bindTextureDirectly(e,a,!0,!0),this._gl.texParameterf(e,t,i)}readPixels(e,t,i,a,n=!0,s=!0){const r=n?4:3,o=n?this._gl.RGBA:this._gl.RGB,l=new Uint8Array(a*i*r);return s&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,a,o,this._gl.UNSIGNED_BYTE,l),Promise.resolve(l)}_deleteBuffer(e){this._gl.deleteBuffer(e.underlyingResource)}setFloat3(e,t,i,a){return!!e&&(this._gl.uniform3f(e,t,i,a),!0)}_drawMode(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_setupFramebufferDepthAttachments(e,t,i,a,n=1){const s=this._gl;if(e&&t)return this._createRenderBuffer(i,a,n,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){let e=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(e=s.DEPTH_COMPONENT32F),this._createRenderBuffer(i,a,n,e,e,s.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(i,a,n,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const e=AbstractEngine._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}getUniforms(e,t){const i=new Array,a=e;for(let e=0;e<t.length;e++)i.push(this._gl.getUniformLocation(a.program,t[e]));return i}createVertexBuffer(e,t,i){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)}setTexture(e,t,i,a){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))}getInfo(){return this.getGlInfo()}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}_createShaderProgram(e,t,i,a,n=null){return _createShaderProgram(e,t,i,a,n)}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_createHardwareTexture(){return new WebGLHardwareTexture(this._createTexture(),this._gl)}draw(e,t,i,a){this.drawElementsType(e?0:1,t,i,a)}flushFramebuffer(){this._gl.flush()}areAllEffectsReady(){for(const e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0}setUIntArray4(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4uiv(e,t),!0)}updateTextureData(e,t,i,a,n,s,r=0,o=0,l=!1){const c=this._gl,h=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);let m=c.TEXTURE_2D,d=c.TEXTURE_2D;e.isCube&&(d=c.TEXTURE_CUBE_MAP_POSITIVE_X+r,m=c.TEXTURE_CUBE_MAP),this._bindTextureDirectly(m,e,!0),c.texSubImage2D(d,o,i,a,n,s,u,h,t),l&&this._gl.generateMipmap(d),this._bindTextureDirectly(m,null)}dispose(){IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&this._gl.getExtension("WEBGL_lose_context")?.loseContext(),deleteStateObject(this._gl)}setUInt2(e,t,i){return!!e&&(this._gl.uniform2ui(e,t,i),!0)}bindFramebuffer(e,t=0,i,a,n,s=0,r=0){const o=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(o._MSAAFramebuffer?o._MSAAFramebuffer:o._framebuffer);const l=this._gl;e.isMulti||(e.is2DArray||e.is3D?l.framebufferTextureLayer(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,e.texture._hardwareTexture?.underlyingResource,s,r):e.isCube?l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.texture._hardwareTexture?.underlyingResource,s):o._currentLOD!==s&&(l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,e.texture._hardwareTexture?.underlyingResource,s),o._currentLOD=s));const c=e._depthStencilTexture;if(c){e.is3D&&(e.texture.width===c.width&&e.texture.height===c.height&&e.texture.depth===c.depth||Logger.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const i=e._depthStencilTextureWithStencil?l.DEPTH_STENCIL_ATTACHMENT:l.DEPTH_ATTACHMENT;e.is2DArray||e.is3D?l.framebufferTextureLayer(l.FRAMEBUFFER,i,c._hardwareTexture?.underlyingResource,s,r):e.isCube?l.framebufferTexture2D(l.FRAMEBUFFER,i,l.TEXTURE_CUBE_MAP_POSITIVE_X+t,c._hardwareTexture?.underlyingResource,s):l.framebufferTexture2D(l.FRAMEBUFFER,i,l.TEXTURE_2D,c._hardwareTexture?.underlyingResource,s)}this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,a):(i||(i=e.width,s&&(i/=Math.pow(2,s))),a||(a=e.height,s&&(a/=Math.pow(2,s))),this._viewport(0,0,i,a)),this.wipeCaches()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}setUIntArray3(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3uiv(e,t),!0)}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}bindSamplers(e){const t=e.getPipelineContext();this._setProgram(t.program);const i=e.getSamplers();for(let t=0;t<i.length;t++){const a=e.getUniform(i[t]);a&&(this._boundUniforms[t]=a)}this._currentEffect=null}_getWebGLTextureType(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_uploadDataToTextureDirectly(e,t,i=0,a=0,n,s=!1){const r=this._gl,o=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format),c=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(n,e._useSRGBBuffer);this._unpackFlipY(e.invertY);let h=r.TEXTURE_2D;e.isCube&&(h=r.TEXTURE_CUBE_MAP_POSITIVE_X+i);const u=Math.round(Math.log(e.width)*Math.LOG2E),m=Math.round(Math.log(e.height)*Math.LOG2E),d=s?e.width:Math.pow(2,Math.max(u-a,0)),f=s?e.height:Math.pow(2,Math.max(m-a,0));r.texImage2D(h,a,c,d,f,0,l,o,t)}bindArrayBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)}_prepareWebGLTexture(e,t,i,a,n,s,r,o,l,c){const h=this.getCaps().maxTextureSize,u=Math.min(h,this.needPOTTextures?GetExponentOfTwo(a.width,h):a.width),m=Math.min(h,this.needPOTTextures?GetExponentOfTwo(a.height,h):a.height),d=this._gl;d&&(e._hardwareTexture?(this._bindTextureDirectly(d.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===n||!!n),e.baseWidth=a.width,e.baseHeight=a.height,e.width=u,e.height=m,e.isReady=!0,e.type=-1!==e.type?e.type:0,e.format=-1!==e.format?e.format:c??(".jpg"!==t||e._useSRGBBuffer?5:4),o(u,m,a,t,e,(()=>{this._prepareWebGLTextureContinuation(e,i,s,r,l)}))||this._prepareWebGLTextureContinuation(e,i,s,r,l)):i&&i.removePendingData(e))}releaseEffects(){const e=Object.keys(this._compiledEffects);for(const t of e){this._compiledEffects[t].dispose()}this._compiledEffects={}}bindUniformBlock(e,t,i){const a=e.program,n=this._gl.getUniformBlockIndex(a,t);this._gl.uniformBlockBinding(a,n,i)}setFloat(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)}createEffect(e,t,i,a,n,s,r,o,l,c=0){const h="string"==typeof e?e:e.vertexToken||e.vertexSource||e.vertexElement||e.vertex,u="string"==typeof e?e:e.fragmentToken||e.fragmentSource||e.fragmentElement||e.fragment,m=this._getGlobalDefines();let d=n??t.defines??"";m&&(d+=m);const f=h+"+"+u+"@"+d;if(this._compiledEffects[f]){const e=this._compiledEffects[f];return r&&e.isReady()&&r(e),e._refCount++,e}this._gl&&getStateObject(this._gl);const p=new Effect(e,t,i,a,this,n,s,r,o,l,f,t.shaderLanguage??c);return this._compiledEffects[f]=p,p}_isRenderingStateCompiled(e){const t=e;return!this._isDisposed&&!t._isDisposed&&(!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0))}setArray2(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2fv(e,t),!0)}getAttributes(e,t){const i=[],a=e;for(let e=0;e<t.length;e++)try{i.push(this._gl.getAttribLocation(a.program,t[e]))}catch(e){i.push(-1)}return i}bindBuffersDirectly(e,t,i,a,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;const t=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let s=0;for(let r=0;r<t;r++)if(r<i.length){const t=n.getAttributeLocation(r);t>=0&&(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0,this._vertexAttribPointer(e,t,i[r],this._gl.FLOAT,!1,a,s)),s+=4*i[r]}}this._bindIndexBufferWithCache(t)}static get IsSupported(){return this.isSupported()}drawArraysType(e,t,i,a){this.applyStates(),this._reportDrawCall();const n=this._drawMode(e);a?this._gl.drawArraysInstanced(n,t,i,a):this._gl.drawArrays(n,t,i)}_createInternalTexture(e,t,i=!0,a=0){let n,s=!1,r=0,o=3,l=5,c=!1,h=1;void 0!==t&&"object"==typeof t?(s=!!t.generateMipMaps,r=void 0===t.type?0:t.type,o=void 0===t.samplingMode?3:t.samplingMode,l=void 0===t.format?5:t.format,c=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer,h=t.samples??1,n=t.label):s=!!t,c&&(c=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==r||this._caps.textureFloatLinearFiltering)&&(2!==r||this._caps.textureHalfFloatLinearFiltering)||(o=1),1!==r||this._caps.textureFloat||(r=0,Logger.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const u=this._gl,m=new InternalTexture(this,a),d=e.width||e,f=e.height||e,p=e.depth||0,_=e.layers||0,g=this._getSamplingParameters(o,s),v=0!==_?u.TEXTURE_2D_ARRAY:0!==p?u.TEXTURE_3D:u.TEXTURE_2D,y=this._getRGBABufferInternalSizedFormat(r,l,c),S=this._getInternalFormat(l),C=this._getWebGLTextureType(r);return this._bindTextureDirectly(v,m),0!==_?(m.is2DArray=!0,u.texImage3D(v,0,y,d,f,_,0,S,C,null)):0!==p?(m.is3D=!0,u.texImage3D(v,0,y,d,f,p,0,S,C,null)):u.texImage2D(v,0,y,d,f,0,S,C,null),u.texParameteri(v,u.TEXTURE_MAG_FILTER,g.mag),u.texParameteri(v,u.TEXTURE_MIN_FILTER,g.min),u.texParameteri(v,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(v,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),s&&this._gl.generateMipmap(v),this._bindTextureDirectly(v,null),m._useSRGBBuffer=c,m.baseWidth=d,m.baseHeight=f,m.width=d,m.height=f,m.depth=_,m.isReady=!0,m.samples=h,m.generateMipMaps=s,m.samplingMode=o,m.type=r,m.format=l,m.label=n,this._internalTexturesCache.push(m),m}_executeWhenRenderingStateIsCompiled(e,t){_executeWhenRenderingStateIsCompiled(e,t)}unBindFramebuffer(e,t=!1,i){const a=e;this._currentRenderTarget=null;const n=this._gl;if(a._MSAAFramebuffer){if(e.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(e,t,i);n.bindFramebuffer(n.READ_FRAMEBUFFER,a._MSAAFramebuffer),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,a._framebuffer),n.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,n.COLOR_BUFFER_BIT,n.NEAREST)}!e.texture?.generateMipMaps||t||e.isCube||this.generateMipmaps(e.texture),i&&(a._MSAAFramebuffer&&this._bindUnboundFramebuffer(a._framebuffer),i()),this._bindUnboundFramebuffer(null)}createIndexBuffer(e,t,i){const a=this._gl.createBuffer(),n=new WebGLDataBuffer(a);if(!a)throw new Error("Unable to create index buffer");this.bindIndexBuffer(n);const s=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),n.references=1,n.is32Bits=4===s.BYTES_PER_ELEMENT,n}_setTexture(e,t,i=!1,a=!1,n=""){if(!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video){this._activeChannel=e;const i=t.getInternalTexture();i&&(i._associatedChannel=e),t.update()}else if(4===t.delayLoadState)return t.delayLoad(),!1;let s;s=a?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!i&&s&&(s._associatedChannel=e);let r=!0;this._boundTexturesCache[e]===s&&(i||this._bindSamplerUniformToChannel(s._associatedChannel,e),r=!1),this._activeChannel=e;const o=this._getTextureTarget(s);if(r&&this._bindTextureDirectly(o,s,i),s&&!s.isMultiview){if(s.isCube&&s._cachedCoordinatesMode!==t.coordinatesMode){s._cachedCoordinatesMode=t.coordinatesMode;const e=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=e,t.wrapV=e}s._cachedWrapU!==t.wrapU&&(s._cachedWrapU=t.wrapU,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),s)),s._cachedWrapV!==t.wrapV&&(s._cachedWrapV=t.wrapV,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),s)),s.is3D&&s._cachedWrapR!==t.wrapR&&(s._cachedWrapR=t.wrapR,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),s)),this._setAnisotropicLevel(o,s,t.anisotropicFilteringLevel)}return!0}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const e=this._colorWrite;this._gl.colorMask(e,e,e,e)}}setUIntArray(e,t){return!!e&&(this._gl.uniform1uiv(e,t),!0)}_prepareWebGLTextureContinuation(e,t,i,a,n){const s=this._gl;if(!s)return;const r=this._getSamplingParameters(n,!i);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,r.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,r.min),i||a||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t.removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}_bindTexture(e,t,i){if(void 0===e)return;t&&(t._associatedChannel=e),this._activeChannel=e;const a=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(a,t)}_releaseBuffer(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)}getClassName(){return"ThinEngine"}updateTextureSamplingMode(e,t,i=!1){const a=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.useMipMaps||i);this._setTextureParameterInteger(a,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(a,this._gl.TEXTURE_MIN_FILTER,n.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(a)),this._bindTextureDirectly(a,null),t.samplingMode=e}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}disableAttributeByIndex(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}setUInt(e,t){return!!e&&(this._gl.uniform1ui(e,t),!0)}drawElementsType(e,t,i,a){this.applyStates(),this._reportDrawCall();const n=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,r=this._uintIndicesCurrentlySet?4:2;a?this._gl.drawElementsInstanced(n,i,s,t*r,a):this._gl.drawElements(n,i,s,t*r)}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_bindVertexBuffersAttributes(e,t,i){const a=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let n=0;n<a.length;n++){const s=t.getAttributeLocation(n);if(s>=0){const t=a[n];let r=null;if(i&&(r=i[t]),r||(r=e[t]),!r)continue;this._gl.enableVertexAttribArray(s),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[s]=!0);const o=r.getBuffer();o&&(this._vertexAttribPointer(o,s,r.getSize(),r.type,r.normalized,r.byteStride,r.byteOffset),r.getIsInstanced()&&(this._gl.vertexAttribDivisor(s,r.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(o))))}}}wipeCaches(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}bindVertexArrayObject(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)}updateAndBindInstancesBuffer(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index)this.bindInstancesBuffer(e,i,!0);else for(let t=0;t<4;t++){const a=i[t];this._vertexAttribArraysEnabled[a]||(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0),this._vertexAttribPointer(e,a,4,this._gl.FLOAT,!1,64,16*t),this._gl.vertexAttribDivisor(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(e)}}setArray3(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3fv(e,t),!0)}_createRenderBuffer(e,t,i,a,n,s,r=!0){const o=this._gl.createRenderbuffer();return this._updateRenderBuffer(o,e,t,i,a,n,s,r)}_getTextureWrapMode(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setProgram(e){this._currentProgram!==e&&(_setProgram(e,this._gl),this._currentProgram=e)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}_createVertexBuffer(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");const a=new WebGLDataBuffer(i);return this.bindArrayBuffer(a),"number"!=typeof e?e instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t),a.Fc=4*e.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),a.Fc=e.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(e),t),a.Fc=e),this._resetVertexBufferBinding(),a.references=1,a}setIntArray4(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4iv(e,t),!0)}_setAnisotropicLevel(e,t,i){const a=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(i=1),a&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)}inlineShaderCode(e){return e}_bindTextureDirectly(e,t,i=!1,a=!1){let n=!1;const s=t&&t._associatedChannel>-1;i&&s&&(this._activeChannel=t._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==t||a){if(this._activateCurrentTexture(),t&&t.isMultiview)throw Logger.Error(["_bindTextureDirectly called with a multiview texture!",e,t]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,t?._hardwareTexture?.underlyingResource??null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(n=!0,this._activateCurrentTexture());return s&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n}_getTexImageParametersForCreateTexture(e,t){let i,a;return 1===this.webGLVersion?(i=this._getInternalFormat(e,t),a=i):(i=this._getInternalFormat(e,!1),a=this._getRGBABufferInternalSizedFormat(0,e,t)),{internalFormat:a,format:i,type:this._gl.UNSIGNED_BYTE}}_uploadArrayBufferViewToTexture(e,t,i=0,a=0){const n=this._gl,s=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,i,a),this._bindTextureDirectly(s,null,!0)}drawPointClouds(e,t,i){this.drawArraysType(2,e,t,i)}unbindInstanceAttributes(){let e;for(let t=0,i=this._currentInstanceLocations.length;t<i;t++){const i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));const a=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(a,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}setFloat2(e,t,i){return!!e&&(this._gl.uniform2f(e,t,i),!0)}disableInstanceAttribute(e){let t,i=!1;for(;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),i=!0,t=this._currentInstanceLocations.indexOf(e);i&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))}setFloat4(e,t,i,a,n){return!!e&&(this._gl.uniform4f(e,t,i,a,n),!0)}releaseVertexArrayObject(e){this._gl.deleteVertexArray(e)}enableEffect(e){(e=null!==e&&IsWrapper(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))}_bindUnboundFramebuffer(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)}setMatrix3x3(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else for(let e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}bindBuffers(e,t,i,a){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,a)),this._bindIndexBufferWithCache(t)}createShaderProgram(e,t,i,a,n,s=null){const r=getStateObject(this._gl);return r._contextWasLost=this._contextWasLost,r.validateShaderPrograms=this.validateShaderPrograms,createShaderProgram(e,t,i,a,n||this._gl,s)}getRenderWidth(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}setInt2(e,t,i){return!!e&&(this._gl.uniform2i(e,t,i),!0)}extractDriverInfo(){const e=this.getGlInfo();return e&&e.renderer?e.renderer:""}_deleteTexture(e){e?.release()}updateTextureDimensions(e,t,i,a=1){}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_getShaderProcessingContext(e){return null}attachContextLostEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)}createPipelineContext(e){if(this._gl){getStateObject(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const t=createPipelineContext(this._gl,e);return t.engine=this,t}createRawShaderProgram(e,t,i,a,n=null){const s=getStateObject(this._gl);return s._contextWasLost=this._contextWasLost,s.validateShaderPrograms=this.validateShaderPrograms,createRawShaderProgram(e,t,i,a||this._gl,n)}static get ShadersRepository(){return Effect.ShadersRepository}generateMipmaps(e){const t=this._getTextureTarget(e);this._bindTextureDirectly(t,e,!0),this._gl.generateMipmap(t),this._bindTextureDirectly(t,null)}_viewport(e,t,i,a){e===this._viewportCached.x&&t===this._viewportCached.y&&i===this._viewportCached.z&&a===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=a,this._gl.viewport(e,t,i,a))}setArray4(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4fv(e,t),!0)}_getRGBABufferInternalSizedFormat(e,t,i=!1){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}_createTexture(){const e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e}_unpackFlipY(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))}_canRenderToFramebuffer(e){const t=this._gl;for(;t.getError()!==t.NO_ERROR;);let i=!0;const a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&s===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);const e=t.RGBA,a=t.UNSIGNED_BYTE,n=new Uint8Array(4);t.readPixels(0,0,1,1,e,a,n),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(a),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i}createDynamicVertexBuffer(e,t){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)}setMatrix2x2(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)}get name(){return this._name}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"==typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}_releaseEffect(e){this._compiledEffects[e._key]&&delete this._compiledEffects[e._key];const t=e.getPipelineContext();t&&this._deletePipelineContext(t)}_uploadCompressedDataToTextureDirectly(e,t,i,a,n,s=0,r=0){const o=this._gl;let l=o.TEXTURE_2D;if(e.isCube&&(l=o.TEXTURE_CUBE_MAP_POSITIVE_X+s),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=o.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(l,r,t,i,a,0,n)}setUIntArray2(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2uiv(e,t),!0)}_bindBuffer(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}setInt4(e,t,i,a,n){return!!e&&(this._gl.uniform4i(e,t,i,a,n),!0)}_getUseSRGBBuffer(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||t)}setMatrices(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)}_bindSamplerUniformToChannel(e,t){const i=this._boundUniforms[e];i&&i._currentState!==t&&(this._gl.uniform1i(i,t),i._currentState=t)}set name(e){this._name=e}updateArrayBuffer(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)}setUInt3(e,t,i,a){return!!e&&(this._gl.uniform3ui(e,t,i,a),!0)}setInt3(e,t,i,a){return!!e&&(this._gl.uniform3i(e,t,i,a),!0)}get version(){return this._webGLVersion}drawUnIndexed(e,t,i,a){this.drawArraysType(e?0:1,t,i,a)}attachContextRestoredEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)}get webGLVersion(){return this._webGLVersion}setState(e,t=0,i,a=!1,n,s,r=0){(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);const o=this.cullBackFaces??n??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==o||i)&&(this._depthCullingState.cullFace=o),this.setZOffset(t),this.setZOffsetUnits(r);const l=a?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==l||i)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=s}_rescaleTexture(e,t,i,a,n){}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}endFrame(){super.endFrame(),this._badOS&&this.flushFramebuffer()}_releaseTexture(e){this._deleteTexture(e._hardwareTexture),this.unbindAllTextures();const t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()}_finalizePipelineContext(e){return _finalizePipelineContext(e,this._gl,this.validateShaderPrograms)}clear(t,i,a,n=!1){const s=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=s;let r=0;if(i&&t){let i=!0;if(this._currentRenderTarget){const a=this._currentRenderTarget.texture?.format;if(8===a||9===a||10===a||11===a){const a=this._currentRenderTarget.texture?.type;7===a||5===a?(e._TempClearColorUint32[0]=255*t.r,e._TempClearColorUint32[1]=255*t.g,e._TempClearColorUint32[2]=255*t.b,e._TempClearColorUint32[3]=255*t.a,this._gl.clearBufferuiv(this._gl.COLOR,0,e._TempClearColorUint32),i=!1):(e._TempClearColorInt32[0]=255*t.r,e._TempClearColorInt32[1]=255*t.g,e._TempClearColorInt32[2]=255*t.b,e._TempClearColorInt32[3]=255*t.a,this._gl.clearBufferiv(this._gl.COLOR,0,e._TempClearColorInt32),i=!1)}}i&&(this._gl.clearColor(t.r,t.g,t.b,void 0!==t.a?t.a:1),r|=this._gl.COLOR_BUFFER_BIT)}a&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),r|=this._gl.DEPTH_BUFFER_BIT),n&&(this._gl.clearStencil(0),r|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(r)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const e=AbstractEngine._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported}createMaterialContext(){}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{const e=this._gl.getExtension("WEBGL_draw_buffers");if(null!==e){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=e.drawBuffersWEBGL.bind(e),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let t=0;t<16;t++)this._gl["COLOR_ATTACHMENT"+t+"_WEBGL"]=e["COLOR_ATTACHMENT"+t+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const e=this._gl.getExtension("WEBGL_depth_texture");null!=e&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=e.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const e=this._gl.getExtension("OES_vertex_array_object");null!=e&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=e.createVertexArrayOES.bind(e),this._gl.bindVertexArray=e.bindVertexArrayOES.bind(e),this._gl.deleteVertexArray=e.deleteVertexArrayOES.bind(e))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const e=this._gl.getExtension("ANGLE_instanced_arrays");null!=e?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),this._gl.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),this._gl.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const e=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),t=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);e&&t&&(this._caps.highPrecisionShaderSupported=0!==e.precision&&0!==t.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const e=this._gl.getExtension("EXT_blend_minmax");null!=e&&(this._caps.blendMinMax=!0,this._gl.MAX=e.MAX_EXT,this._gl.MIN=e.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const e=this._gl.getExtension("EXT_sRGB");null!=e&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:e.SRGB_EXT,SRGB8:e.SRGB_ALPHA_EXT,SRGB8_ALPHA8:e.SRGB_ALPHA_EXT})}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let e=0;e<this._maxSimultaneousTextures;e++)this._nextFreeTextureSlots.push(e);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_normalizeIndexData(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(let t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)}setIntArray2(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2iv(e,t),!0)}_getShaderSource(e){return this._gl.getShaderSource(e)}setIntArray3(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3iv(e,t),!0)}createDrawContext(){}_bindIndexBufferWithCache(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)}_vertexAttribPointer(e,t,i,a,n,s,r){const o=this._currentBufferPointers[t];if(!o)return;let l=!1;o.active?(o.buffer!==e&&(o.buffer=e,l=!0),o.size!==i&&(o.size=i,l=!0),o.type!==a&&(o.type=a,l=!0),o.normalized!==n&&(o.normalized=n,l=!0),o.stride!==s&&(o.stride=s,l=!0),o.offset!==r&&(o.offset=r,l=!0)):(l=!0,o.active=!0,o.index=t,o.size=i,o.type=a,o.normalized=n,o.stride=s,o.offset=r,o.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),a===this._gl.UNSIGNED_INT||a===this._gl.INT?this._gl.vertexAttribIPointer(t,i,a,s,r):this._gl.vertexAttribPointer(t,i,a,n,s,r))}getRenderHeight(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}_getGlobalDefines(e){return _getGlobalDefines(e,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}get _supportsHardwareTextureRescaling(){return!1}_getInternalFormat(e,t=!1){let i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:i=this._gl.RED;break;case 7:i=this._gl.RG;break;case 4:i=t?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER}return i}getError(){return this._gl.getError()}_getTextureTarget(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}bindInstancesBuffer(e,t,i=!0){this.bindArrayBuffer(e);let a=0;if(i)for(let e=0;e<t.length;e++){a+=4*t[e].attributeSize}for(let i=0;i<t.length;i++){const n=t[i];void 0===n.index&&(n.index=this._currentEffect.getAttributeLocationByName(n.attributeName)),n.index<0||(this._vertexAttribArraysEnabled[n.index]||(this._gl.enableVertexAttribArray(n.index),this._vertexAttribArraysEnabled[n.index]=!0),this._vertexAttribPointer(e,n.index,n.attributeSize,n.attributeType||this._gl.FLOAT,n.normalized||!1,a,n.offset),this._gl.vertexAttribDivisor(n.index,void 0===n.divisor?1:n.divisor),this._currentInstanceLocations.push(n.index),this._currentInstanceBuffers.push(e))}}setTextureArray(e,t,i,a){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(let t=0;t<i.length;t++){const a=i[t].getInternalTexture();a?(this._textureUnits[t]=e+t,a._associatedChannel=e+t):this._textureUnits[t]=-1}this._gl.uniform1iv(t,this._textureUnits);for(let e=0;e<i.length;e++)this._setTexture(this._textureUnits[e],i[e],!0)}}_getSamplingParameters(e,t){const i=this._gl;let a=i.NEAREST,n=i.NEAREST;switch(e){case 11:a=i.LINEAR,n=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 3:a=i.LINEAR,n=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 8:a=i.NEAREST,n=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 4:a=i.NEAREST,n=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 5:a=i.NEAREST,n=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 6:a=i.NEAREST,n=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 7:a=i.NEAREST,n=i.LINEAR;break;case 1:a=i.NEAREST,n=i.NEAREST;break;case 9:a=i.LINEAR,n=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 10:a=i.LINEAR,n=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 2:a=i.LINEAR,n=i.LINEAR;break;case 12:a=i.LINEAR,n=i.NEAREST}return{min:n,mag:a}}static set ShadersRepository(e){Effect.ShadersRepository=e}_preparePipelineContext(e,t,i,a,n,s,r,o,l,c,h){const u=getStateObject(this._gl);return u._contextWasLost=this._contextWasLost,u.validateShaderPrograms=this.validateShaderPrograms,u._createShaderProgramInjection=this._createShaderProgram.bind(this),u.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),u.createShaderProgramInjection=this.createShaderProgram.bind(this),u.loadFileInjection=this._loadFile.bind(this),_preparePipelineContext(e,t,i,a,n,s,r,o,l,c,h)}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}updateTextureWrappingMode(e,t,i=null,a=null){const n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&null!==a&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(a),e),e._cachedWrapR=a),this._bindTextureDirectly(n,null)}createTexture(e,t,i,a,n=3,s=null,r=null,o=null,l=null,c=null,h=null,u,m,d,f){return this._createTextureBase(e,t,i,a,n,s,r,((...e)=>this._prepareWebGLTexture(...e,c)),((e,t,i,n,s,r)=>{const o=this._gl,l=i.width===e&&i.height===t;s._creationFlags=d??0;const c=this._getTexImageParametersForCreateTexture(s.format,s._useSRGBBuffer);if(l)return o.texImage2D(o.TEXTURE_2D,0,c.internalFormat,c.format,c.type,i),!1;const h=this._caps.maxTextureSize;if(i.width>h||i.height>h||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=e,this._workingCanvas.height=t,this._workingContext.drawImage(i,0,0,i.width,i.height,0,0,e,t),o.texImage2D(o.TEXTURE_2D,0,c.internalFormat,c.format,c.type,this._workingCanvas),s.width=e,s.height=t,!1);{const e=new InternalTexture(this,2);this._bindTextureDirectly(o.TEXTURE_2D,e,!0),o.texImage2D(o.TEXTURE_2D,0,c.internalFormat,c.format,c.type,i),this._rescaleTexture(e,s,a,c.format,(()=>{this._releaseTexture(e),this._bindTextureDirectly(o.TEXTURE_2D,s,!0),r()}))}return!0}),o,l,c,h,u,m,f)}snapshotRenderingReset(){this.snapshotRendering=!1}setUInt4(e,t,i,a,n){return!!e&&(this._gl.uniform4ui(e,t,i,a,n),!0)}unbindAllTextures(){for(let e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}constructor(t,i,a,n){if(a=a||{},super(i??a.antialias,a,n),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!t)return;let s=null;if(t.getContext){if(s=t,this._renderingCanvas=s,void 0===a.preserveDrawingBuffer&&(a.preserveDrawingBuffer=!1),void 0===a.xrCompatible&&(a.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const t=navigator.userAgent;for(const i of e.ExceptionList){const e=i.key,n=i.targets;if(new RegExp(e).test(t)){if(i.capture&&i.captureConstraint){const e=i.capture,a=i.captureConstraint,n=new RegExp(e).exec(t);if(n&&n.length>0){if(parseInt(n[n.length-1])>=a)continue}}for(const e of n)switch(e){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":a.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=e=>{e.preventDefault(),this._contextWasLost=!0,Logger.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},s.addEventListener("webglcontextlost",this._onContextLost,!1),s.addEventListener("webglcontextrestored",this._onContextRestored,!1),a.powerPreference=a.powerPreference||"high-performance"),this._badDesktopOS&&(a.xrCompatible=!1),!a.disableWebGL2Support)try{this._gl=s.getContext("webgl2",a)||s.getContext("experimental-webgl2",a),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(e){}if(!this._gl){if(!s)throw new Error("The provided canvas is null or undefined.");try{this._gl=s.getContext("webgl",a)||s.getContext("experimental-webgl",a)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const e=this._gl.getContextAttributes();e&&(a.stencil=e.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==a.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=a.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let e=0;e<this._caps.maxVertexAttribs;e++)this._currentBufferPointers[e]=new BufferPointer;this._shaderProcessor=this.webGLVersion>1?new WebGL2ShaderProcessor:new WebGLShaderProcessor;const r=`Babylon.js v${e.Version}`;Logger.Log(r+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",r);const o=getStateObject(this._gl);o.validateShaderPrograms=this.validateShaderPrograms,o.parallelShaderCompile=this._caps.parallelShaderCompile}setInt(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)}};ThinEngine._TempClearColorUint32=new Uint32Array(4),ThinEngine._TempClearColorInt32=new Int32Array(4),ThinEngine.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],ThinEngine.CollisionsEpsilon=.001,ThinEngine._ConcatenateShader=_ConcatenateShader,ThinEngine._IsSupported=null,ThinEngine._HasMajorPerformanceCaveat=null,ThinEngine.CeilingPOT=CeilingPOT,ThinEngine.FloorPOT=FloorPOT,ThinEngine.NearestPOT=NearestPOT,ThinEngine.GetExponentOfTwo=GetExponentOfTwo,ThinEngine.QueueNewFrame=QueueNewFrame;var PerformanceMonitor=class{constructor(e=30){this._enabled=!0,this._rollingFrameTime=new RollingAverage(e)}enable(){this._enabled=!0}get averageFrameTime(){return this._rollingFrameTime.average}get isSaturated(){return this._rollingFrameTime.isSaturated()}get averageFPS(){return 1e3/this._rollingFrameTime.average}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}get isEnabled(){return this._enabled}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFPS(){const e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e}disable(){this._enabled=!1,this._lastFrameTimeMs=null}sampleFrame(e=PrecisionDate.Now){if(this._enabled){if(null!=this._lastFrameTimeMs){const t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}},RollingAverage=class{add(e){let t;if(this.isSaturated()){const e=this._samples[this._pos];t=e-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(e-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}history(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;const t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(e){const t=this._samples.length;return(e%t+t)%t}constructor(e){this._samples=new Array(e),this.reset()}isSaturated(){return this._sampleCount>=this._samples.length}};function allocateAndCopyTypedBuffer(e,t,i=!1,a){switch(e){case 3:{const e=(ArrayBuffer,new Int8Array(t));return a&&e.set(new Int8Array(a)),e}case 0:{const e=(ArrayBuffer,new Uint8Array(t));return a&&e.set(new Uint8Array(a)),e}case 4:{const e=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(i?t/2:t);return a&&e.set(new Int16Array(a)),e}case 5:case 8:case 9:case 10:case 2:{const e=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(i?t/2:t);return a&&e.set(new Uint16Array(a)),e}case 6:{const e=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(i?t/4:t);return a&&e.set(new Int32Array(a)),e}case 7:case 11:case 12:case 13:case 14:case 15:{const e=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(i?t/4:t);return a&&e.set(new Uint32Array(a)),e}case 1:{const e=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(i?t/4:t);return a&&e.set(new Float32Array(a)),e}}const n=(ArrayBuffer,new Uint8Array(t));return a&&n.set(new Uint8Array(a)),n}function _DisableTouchAction(e){e&&e.setAttribute&&(e.setAttribute("touch-action","none"),e.style.touchAction="none",e.style.webkitTapHighlightColor="transparent")}function _CommonInit(e,t,i){e._onCanvasFocus=()=>{e.onCanvasFocusObservable.notifyObservers(e)},e._onCanvasBlur=()=>{e.onCanvasBlurObservable.notifyObservers(e)},e._onCanvasContextMenu=t=>{e.disableContextMenu&&t.preventDefault()},t.addEventListener("focus",e._onCanvasFocus),t.addEventListener("blur",e._onCanvasBlur),t.addEventListener("contextmenu",e._onCanvasContextMenu),e._onBlur=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.disable(),e._windowIsBackground=!0},e._onFocus=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.enable(),e._windowIsBackground=!1},e._onCanvasPointerOut=i=>{document.elementFromPoint(i.clientX,i.clientY)!==t&&e.onCanvasPointerOutObservable.notifyObservers(i)};const a=e.getHostWindow();a&&"function"==typeof a.addEventListener&&(a.addEventListener("blur",e._onBlur),a.addEventListener("focus",e._onFocus)),t.addEventListener("pointerout",e._onCanvasPointerOut),i.doNotHandleTouchAction||_DisableTouchAction(t),!AbstractEngine.audioEngine&&i.audioEngine&&AbstractEngine.AudioEngineFactory&&(AbstractEngine.audioEngine=AbstractEngine.AudioEngineFactory(e.getRenderingCanvas(),e.getAudioContext(),e.getAudioDestination())),IsDocumentAvailable()&&(e._onFullscreenChange=()=>{e.isFullscreen=!!document.fullscreenElement,e.isFullscreen&&e._pointerLockRequested&&t&&RequestPointerlock(t)},document.addEventListener("fullscreenchange",e._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",e._onFullscreenChange,!1),e._onPointerLockChange=()=>{e.isPointerLock=document.pointerLockElement===t},document.addEventListener("pointerlockchange",e._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",e._onPointerLockChange,!1)),e.enableOfflineSupport=void 0!==AbstractEngine.OfflineProviderFactory,e._deterministicLockstep=!!i.deterministicLockstep,e._lockstepMaxSteps=i.lockstepMaxSteps||0,e._timeStep=i.timeStep||1/60}function _CommonDispose(e,t){1===EngineStore.Instances.length&&AbstractEngine.audioEngine&&(AbstractEngine.audioEngine.dispose(),AbstractEngine.audioEngine=null);const i=e.getHostWindow();i&&"function"==typeof i.removeEventListener&&(i.removeEventListener("blur",e._onBlur),i.removeEventListener("focus",e._onFocus)),t&&(t.removeEventListener("focus",e._onCanvasFocus),t.removeEventListener("blur",e._onCanvasBlur),t.removeEventListener("pointerout",e._onCanvasPointerOut),t.removeEventListener("contextmenu",e._onCanvasContextMenu)),IsDocumentAvailable()&&(document.removeEventListener("fullscreenchange",e._onFullscreenChange),document.removeEventListener("mozfullscreenchange",e._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",e._onFullscreenChange),document.removeEventListener("msfullscreenchange",e._onFullscreenChange),document.removeEventListener("pointerlockchange",e._onPointerLockChange),document.removeEventListener("mspointerlockchange",e._onPointerLockChange),document.removeEventListener("mozpointerlockchange",e._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",e._onPointerLockChange))}function GetFontOffset(e){const t=document.createElement("span");t.textContent="Hg",t.style.font=e;const i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";const a=document.createElement("div");a.style.whiteSpace="nowrap",a.appendChild(t),a.appendChild(i),document.body.appendChild(a);let n=0,s=0;try{s=i.getBoundingClientRect().top-t.getBoundingClientRect().top,i.style.verticalAlign="baseline",n=i.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(a)}return{ascent:n,height:s,descent:s-n}}function CreateImageBitmapFromSource(e,t,i){return new Promise(((a,n)=>{const s=new Image;s.onload=()=>{s.decode().then((()=>{e.createImageBitmap(s,i).then((e=>{a(e)}))}))},s.onerror=()=>{n(`Error loading image ${s.src}`)},s.src=t}))}function ResizeImageBitmap(e,t,i,a){const n=e.createCanvas(i,a).getContext("2d");if(!n)throw new Error("Unable to get 2d context for resizeImageBitmap");n.drawImage(t,0,0);return n.getImageData(0,0,i,a).data}function RequestFullscreen(e){const t=e.requestFullscreen||e.webkitRequestFullscreen;t&&t.call(e)}function ExitFullscreen(){const e=document;document.exitFullscreen?document.exitFullscreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen()}function RequestPointerlock(e){if(e.requestPointerLock){const t=e.requestPointerLock();t instanceof Promise?t.then((()=>{e.focus()})).catch((()=>{})):e.focus()}}function ExitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}ThinEngine.prototype.setAlphaMode=function(e,t=!1){if(this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}else if(!t){const t=0===e;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}},ThinEngine.prototype._readTexturePixelsSync=function(e,t,i,a=-1,n=0,s=null,r=!0,o=!1,l=0,c=0){const h=this._gl;if(!h)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const e=h.createFramebuffer();if(!e)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=e}h.bindFramebuffer(h.FRAMEBUFFER,this._dummyFramebuffer),a>-1?h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+a,e._hardwareTexture?.underlyingResource,n):h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,e._hardwareTexture?.underlyingResource,n);let u=void 0!==e.type?this._getWebGLTextureType(e.type):h.UNSIGNED_BYTE;if(o)s||(s=allocateAndCopyTypedBuffer(e.type,4*t*i));else if(u===h.UNSIGNED_BYTE)s||(s=new Uint8Array(4*t*i)),u=h.UNSIGNED_BYTE;else s||(s=new Float32Array(4*t*i)),u=h.FLOAT;return r&&this.flushFramebuffer(),h.readPixels(l,c,t,i,h.RGBA,u,s),h.bindFramebuffer(h.FRAMEBUFFER,this._currentFramebuffer),s},ThinEngine.prototype._readTexturePixels=function(e,t,i,a=-1,n=0,s=null,r=!0,o=!1,l=0,c=0){return Promise.resolve(this._readTexturePixelsSync(e,t,i,a,n,s,r,o,l,c))},ThinEngine.prototype.updateDynamicIndexBuffer=function(e,t,i=0){let a;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),a=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,a,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},ThinEngine.prototype.updateDynamicVertexBuffer=function(e,t,i,a){this.bindArrayBuffer(e),void 0===i&&(i=0);const n=t.byteLength||t.length;void 0===a||a>=n&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+a)):(t=t instanceof ArrayBuffer?new Uint8Array(t,i,a):new Uint8Array(t.buffer,t.byteOffset+i,a),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},AbstractEngine.prototype.displayLoadingUI=function(){if(!IsWindowObjectExist())return;const e=this.loadingScreen;e&&e.displayLoadingUI()},AbstractEngine.prototype.hideLoadingUI=function(){if(!IsWindowObjectExist())return;const e=this._loadingScreen;e&&e.hideLoadingUI()},Object.defineProperty(AbstractEngine.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=AbstractEngine.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractEngine.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractEngine.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),AbstractEngine.prototype.getInputElement=function(){return this._renderingCanvas},AbstractEngine.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},AbstractEngine.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},AbstractEngine.prototype.getAspectRatio=function(e,t=!1){const i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},AbstractEngine.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},AbstractEngine.prototype._verifyPointerLock=function(){this._onPointerLockChange?.()},AbstractEngine.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},AbstractEngine.prototype.getInputElement=function(){return this._renderingCanvas},AbstractEngine.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},AbstractEngine.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},AbstractEngine.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},AbstractEngine.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},AbstractEngine.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},AbstractEngine.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},AbstractEngine.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},AbstractEngine.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},AbstractEngine.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},AbstractEngine.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},AbstractEngine.prototype.getStencilMask=function(){return this._stencilState.stencilMask},AbstractEngine.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},AbstractEngine.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},AbstractEngine.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},AbstractEngine.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},AbstractEngine.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},AbstractEngine.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},AbstractEngine.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},AbstractEngine.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},AbstractEngine.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},AbstractEngine.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},AbstractEngine.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},AbstractEngine.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},AbstractEngine.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},AbstractEngine.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},AbstractEngine.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},AbstractEngine.prototype.setAlphaConstants=function(e,t,i,a){this._alphaState.setAlphaBlendConstants(e,t,i,a)},AbstractEngine.prototype.getAlphaMode=function(){return this._alphaMode},AbstractEngine.prototype.getAlphaEquation=function(){return this._alphaEquation},AbstractEngine.prototype.getRenderPassNames=function(){return this._renderPassNames},AbstractEngine.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},AbstractEngine.prototype.createRenderPassId=function(e){const t=++AbstractEngine._RenderPassIdCounter;return this._renderPassNames[t]=e??"NONAME",t},AbstractEngine.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(let t=0;t<this.scenes.length;++t){const i=this.scenes[t];for(let t=0;t<i.meshes.length;++t){const a=i.meshes[t];if(a.subMeshes)for(let t=0;t<a.subMeshes.length;++t){a.subMeshes[t]._removeDrawWrapper(e)}}}},AbstractEngine.prototype.createDepthStencilTexture=function(e,t,i){if(t.isCube){const i=e.width||e;return this._createDepthStencilCubeTexture(i,t)}return this._createDepthStencilTexture(e,t,i)};var PerfCounter=class e{get average(){return this._average}endMonitoring(t=!0){if(!e.Enabled)return;t&&this.fetchNewFrame();const i=PrecisionDate.Now;this._current=i-this._startMonitoringTime,t&&this._fetchResult()}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const e=PrecisionDate.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}get total(){return this._totalAccumulated}get lastSecAverage(){return this._lastSecAverage}get count(){return this._totalValueCount}beginMonitoring(){e.Enabled&&(this._startMonitoringTime=PrecisionDate.Now)}addCount(t,i){e.Enabled&&(this._current+=t,i&&this._fetchResult())}get current(){return this._current}get max(){return this._max}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}endFrame(){this._fetchResult()}get min(){return this._min}};PerfCounter.Enabled=!0,AbstractEngine.AudioEngineFactory=(e,t,i)=>new AudioEngine(e,t,i);var AudioEngine=class{_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",(()=>{this.unlocked&&"running"!==this._audioContext?.state&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}_resumeAudioContext(){return this._audioContext?.resume?this._audioContext.resume():Promise.resolve()}lock(){this._triggerSuspendedState()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",t=document.createElement("style");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}constructor(e=null,t=null,i=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Observable,this.onAudioLockedObservable=new Observable,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!IsWindowObjectExist())return;void 0!==window.AudioContext&&(this.canUseWebAudio=!0);const a=document.createElement("audio");this._hostElement=e,this._audioContext=t,this._audioDestination=i;try{a&&a.canPlayType&&(a.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||a.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(e){}try{a&&a.canPlayType&&a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(e){this.canUseWebAudio=!1,Logger.Error("Web Audio: "+e.message)}}unlock(){if("running"===this._audioContext?.state)return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?this._audioContext?.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}},Engine=class e extends ThinEngine{beginFrame(){this._measureFps(),super.beginFrame()}static MarkAllMaterialsAsDirty(t,i){for(let a=0;a<e.Instances.length;a++){const n=e.Instances[a];for(let e=0;e<n.scenes.length;e++)n.scenes[e].markAllMaterialsAsDirty(t,i)}}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}setDirectViewport(e,t,i,a){const n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,a),n}getVertexShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}get performanceMonitor(){return this._performanceMonitor}static get Instances(){return EngineStore.Instances}enableScissor(e,t,i,a){const n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,i,a)}static DefaultLoadingScreenFactory(e){return AbstractEngine.DefaultLoadingScreenFactory(e)}setDitheringState(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}_createShaderProgram(e,t,i,a,n=null){const s=a.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");if(a.attachShader(s,t),a.attachShader(s,i),this.webGLVersion>1&&n){const t=this.createTransformFeedback();this.bindTransformFeedback(t),this.setTranformFeedbackVaryings(s,n),e.transformFeedback=t}return a.linkProgram(s),this.webGLVersion>1&&n&&this.bindTransformFeedback(null),e.context=a,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),s}getFontOffset(e){return GetFontOffset(e)}updateTextureComparisonFunction(e,t){if(1===this.webGLVersion)return void Logger.Error("WebGL 1 does not support texture comparison.");const i=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}_uploadImageToTexture(e,t,i=0,a=0){const n=this._gl,s=this._getWebGLTextureType(e.type),r=this._getInternalFormat(e.format),o=this._getRGBABufferInternalSizedFormat(e.type,r),l=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(l,e,!0),this._unpackFlipY(e.invertY);let c=n.TEXTURE_2D;e.isCube&&(c=n.TEXTURE_CUBE_MAP_POSITIVE_X+i),n.texImage2D(c,a,o,r,s,t),this._bindTextureDirectly(l,null,!0)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_createImageBitmapFromSource(e,t){return CreateImageBitmapFromSource(this,e,t)}constructor(e,t,i,a=!1){if(super(e,t,i,a),this.customAnimationFrameRequester=null,this._performanceMonitor=new PerformanceMonitor,this._drawCalls=new PerfCounter,e&&(this._features.supportRenderPasses=!0,i=this._creationOptions,e.getContext)){const t=e;this._sharedInit(t)}}wrapWebGLTexture(e,t=!1,i=3,a=0,n=0){const s=new WebGLHardwareTexture(e,this._gl),r=new InternalTexture(this,0,!0);return r._hardwareTexture=s,r.baseWidth=a,r.baseHeight=n,r.width=a,r.height=n,r.isReady=!0,r.useMipMaps=t,this.updateTextureSamplingMode(i,r),r}switchFullscreen(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}_deletePipelineContext(e){const t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),super._deletePipelineContext(e)}_loadFileAsync(e,t,i){return new Promise(((a,n)=>{this._loadFile(e,(e=>{a(e)}),void 0,t,i,((e,t)=>{n(t)}))}))}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}static get LastCreatedEngine(){return EngineStore.LastCreatedEngine}scissorClear(e,t,i,a,n){this.enableScissor(e,t,i,a),this.clear(n,!0,!0,!0),this.disableScissor()}static get LastCreatedScene(){return EngineStore.LastCreatedScene}_rebuildBuffers(){for(const e of this.scenes)e.resetCachedMaterial(),e._rebuildGeometries();for(const e of this._virtualScenes)e.resetCachedMaterial(),e._rebuildGeometries();super._rebuildBuffers()}enterPointerlock(){this._renderingCanvas&&RequestPointerlock(this._renderingCanvas)}_releaseTexture(e){super._releaseTexture(e)}createInstancesBuffer(e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");const i=new WebGLDataBuffer(t);return i.Fc=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i.references=1,i}_releaseRenderTargetWrapper(e){super._releaseRenderTargetWrapper(e),this.scenes.forEach((t=>{t.postProcesses.forEach((t=>{t._outputTexture===e&&(t._outputTexture=null)})),t.cameras.forEach((t=>{t._postProcesses.forEach((t=>{t&&t._outputTexture===e&&(t._outputTexture=null)}))}))}))}exitFullscreen(){this.isFullscreen&&ExitFullscreen()}createShaderProgram(e,t,i,a,n,s=null){n=n||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const r=super.createShaderProgram(e,t,i,a,n,s);return this.onAfterShaderCompilationObservable.notifyObservers(this),r}_readPixelsAsync(e,t,i,a,n,s,r){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const o=this._gl,l=o.createBuffer();o.bindBuffer(o.PIXEL_PACK_BUFFER,l),o.bufferData(o.PIXEL_PACK_BUFFER,r.byteLength,o.STREAM_READ),o.readPixels(e,t,i,a,n,s,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);const c=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);return c?(o.flush(),this._clientWaitAsync(c,0,10).then((()=>(o.deleteSync(c),o.bindBuffer(o.PIXEL_PACK_BUFFER,l),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,r),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.deleteBuffer(l),r)))):null}disableScissor(){const e=this._gl;e.disable(e.SCISSOR_TEST)}get _supportsHardwareTextureRescaling(){return!!e._RescalePostProcessFactory}deleteInstancesBuffer(e){this._gl.deleteBuffer(e)}exitPointerlock(){ExitPointerlock()}setRasterizerState(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}_clientWaitAsync(e,t=0,i=10){const a=this._gl;return new Promise(((n,s)=>{const r=()=>{const o=a.clientWaitSync(e,t,0);o!=a.WAIT_FAILED?o!=a.TIMEOUT_EXPIRED?n():setTimeout(r,i):s()};r()}))}_sharedInit(e){super._sharedInit(e),_CommonInit(this,e,this._creationOptions)}getFragmentShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),_CommonDispose(this,this._renderingCanvas),super.dispose()}static get Version(){return AbstractEngine.Version}static get NpmPackage(){return AbstractEngine.NpmPackage}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:e}=this.customAnimationFrameRequester;e&&e(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}resizeImageBitmap(e,t,i){return ResizeImageBitmap(this,e,t,i)}_rescaleTexture(t,i,a,n,s){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const r=this.createRenderTargetTexture({width:i.width,height:i.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&e._RescalePostProcessFactory&&(this._rescalePostProcess=e._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const e=()=>{this._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};let e=a;e||(e=this.scenes[this.scenes.length-1]),e.postProcessManager.directRender([this._rescalePostProcess],r,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,n,0,0,i.width,i.height,0),this.unBindFramebuffer(r),r.dispose(),s&&s()},o=this._rescalePostProcess.getEffect();o?o.executeWhenCompiled(e):this._rescalePostProcess.onEffectCreatedObservable.addOnce((t=>{t.executeWhenCompiled(e)}))}}enterFullscreen(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&RequestFullscreen(this._renderingCanvas))}};Engine.ALPHA_DISABLE=0,Engine.ALPHA_ADD=1,Engine.ALPHA_COMBINE=2,Engine.ALPHA_SUBTRACT=3,Engine.ALPHA_MULTIPLY=4,Engine.ALPHA_MAXIMIZED=5,Engine.ALPHA_ONEONE=6,Engine.ALPHA_PREMULTIPLIED=7,Engine.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Engine.ALPHA_INTERPOLATE=9,Engine.ALPHA_SCREENMODE=10,Engine.DELAYLOADSTATE_NONE=0,Engine.DELAYLOADSTATE_LOADED=1,Engine.DELAYLOADSTATE_LOADING=2,Engine.DELAYLOADSTATE_NOTLOADED=4,Engine.NEVER=512,Engine.ALWAYS=519,Engine.LESS=513,Engine.EQUAL=514,Engine.LEQUAL=515,Engine.GREATER=516,Engine.GEQUAL=518,Engine.NOTEQUAL=517,Engine.KEEP=7680,Engine.REPLACE=7681,Engine.INCR=7682,Engine.DECR=7683,Engine.INVERT=5386,Engine.INCR_WRAP=34055,Engine.DECR_WRAP=34056,Engine.TEXTURE_CLAMP_ADDRESSMODE=0,Engine.TEXTURE_WRAP_ADDRESSMODE=1,Engine.TEXTURE_MIRROR_ADDRESSMODE=2,Engine.TEXTUREFORMAT_ALPHA=0,Engine.TEXTUREFORMAT_LUMINANCE=1,Engine.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Engine.TEXTUREFORMAT_RGB=4,Engine.TEXTUREFORMAT_RGBA=5,Engine.TEXTUREFORMAT_RED=6,Engine.TEXTUREFORMAT_R=6,Engine.TEXTUREFORMAT_RG=7,Engine.TEXTUREFORMAT_RED_INTEGER=8,Engine.TEXTUREFORMAT_R_INTEGER=8,Engine.TEXTUREFORMAT_RG_INTEGER=9,Engine.TEXTUREFORMAT_RGB_INTEGER=10,Engine.TEXTUREFORMAT_RGBA_INTEGER=11,Engine.TEXTURETYPE_UNSIGNED_BYTE=0,Engine.TEXTURETYPE_UNSIGNED_INT=0,Engine.TEXTURETYPE_FLOAT=1,Engine.TEXTURETYPE_HALF_FLOAT=2,Engine.TEXTURETYPE_BYTE=3,Engine.TEXTURETYPE_SHORT=4,Engine.TEXTURETYPE_UNSIGNED_SHORT=5,Engine.TEXTURETYPE_INT=6,Engine.TEXTURETYPE_UNSIGNED_INTEGER=7,Engine.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Engine.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Engine.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Engine.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Engine.TEXTURETYPE_UNSIGNED_INT_24_8=12,Engine.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Engine.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Engine.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Engine.TEXTURE_NEAREST_SAMPLINGMODE=1,Engine.TEXTURE_BILINEAR_SAMPLINGMODE=2,Engine.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Engine.TEXTURE_NEAREST_LINEAR=7,Engine.TEXTURE_NEAREST_NEAREST=1,Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Engine.TEXTURE_LINEAR_LINEAR=2,Engine.TEXTURE_LINEAR_NEAREST=12,Engine.TEXTURE_EXPLICIT_MODE=0,Engine.TEXTURE_SPHERICAL_MODE=1,Engine.TEXTURE_PLANAR_MODE=2,Engine.TEXTURE_CUBIC_MODE=3,Engine.TEXTURE_PROJECTION_MODE=4,Engine.TEXTURE_SKYBOX_MODE=5,Engine.TEXTURE_INVCUBIC_MODE=6,Engine.TEXTURE_EQUIRECTANGULAR_MODE=7,Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Engine.SCALEMODE_FLOOR=1,Engine.SCALEMODE_NEAREST=2,Engine.SCALEMODE_CEILING=3;var PickingInfo=class{getTextureCoordinates(e=VertexBuffer.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e))return null;const t=this.pickedMesh.getIndices();if(!t)return null;const i=this.pickedMesh.getVerticesData(e);if(!i)return null;let a=Vector2.FromArray(i,2*t[3*this.faceId]),n=Vector2.FromArray(i,2*t[3*this.faceId+1]),s=Vector2.FromArray(i,2*t[3*this.faceId+2]);return a=a.scale(this.bu),n=n.scale(this.bv),s=s.scale(1-this.bu-this.bv),new Vector2(a.x+n.x+s.x,a.y+n.y+s.y)}constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(e=!1,t=!0){if(!this.pickedMesh||t&&!this.pickedMesh.isVerticesDataPresent(VertexBuffer.NormalKind))return null;let i,a=this.pickedMesh.getIndices();0===a?.length&&(a=null);const n=TmpVectors.Vector3[0],s=TmpVectors.Vector3[1],r=TmpVectors.Vector3[2];if(t){const e=this.pickedMesh.getVerticesData(VertexBuffer.NormalKind);let t=a?Vector3.FromArrayToRef(e,3*a[3*this.faceId],n):n.copyFromFloats(e[3*this.faceId*3],e[3*this.faceId*3+1],e[3*this.faceId*3+2]),o=a?Vector3.FromArrayToRef(e,3*a[3*this.faceId+1],s):s.copyFromFloats(e[3*(3*this.faceId+1)],e[3*(3*this.faceId+1)+1],e[3*(3*this.faceId+1)+2]),l=a?Vector3.FromArrayToRef(e,3*a[3*this.faceId+2],r):r.copyFromFloats(e[3*(3*this.faceId+2)],e[3*(3*this.faceId+2)+1],e[3*(3*this.faceId+2)+2]);t=t.scale(this.bu),o=o.scale(this.bv),l=l.scale(1-this.bu-this.bv),i=new Vector3(t.x+o.x+l.x,t.y+o.y+l.y,t.z+o.z+l.z)}else{const e=this.pickedMesh.getVerticesData(VertexBuffer.PositionKind),t=a?Vector3.FromArrayToRef(e,3*a[3*this.faceId],n):n.copyFromFloats(e[3*this.faceId*3],e[3*this.faceId*3+1],e[3*this.faceId*3+2]),o=a?Vector3.FromArrayToRef(e,3*a[3*this.faceId+1],s):s.copyFromFloats(e[3*(3*this.faceId+1)],e[3*(3*this.faceId+1)+1],e[3*(3*this.faceId+1)+2]),l=a?Vector3.FromArrayToRef(e,3*a[3*this.faceId+2],r):r.copyFromFloats(e[3*(3*this.faceId+2)],e[3*(3*this.faceId+2)+1],e[3*(3*this.faceId+2)+2]),c=t.subtract(o),h=l.subtract(o);i=Vector3.Cross(c,h)}const o=(e,t)=>{let i=e.getWorldMatrix();e.nonUniformScaling&&(TmpVectors.Matrix[0].copyFrom(i),i=TmpVectors.Matrix[0],i.setTranslationFromFloats(0,0,0),i.invert(),i.transposeToRef(TmpVectors.Matrix[1]),i=TmpVectors.Matrix[1]),Vector3.TransformNormalToRef(t,i,t)};if(e&&o(this.pickedMesh,i),this.ray){const t=TmpVectors.Vector3[0].copyFrom(i);e||o(this.pickedMesh,t),Vector3.Dot(t,this.ray.direction)>0&&i.negateInPlace()}return i.normalize(),i}};ThinEngine.prototype.createUniformBuffer=function(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create uniform buffer");const a=new WebGLDataBuffer(i);return this.bindUniformBuffer(a),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),a.references=1,a},ThinEngine.prototype.createDynamicUniformBuffer=function(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create dynamic uniform buffer");const a=new WebGLDataBuffer(i);return this.bindUniformBuffer(a),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),a.references=1,a},ThinEngine.prototype.updateUniformBuffer=function(e,t,i,a){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===a?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+a)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+a)),this.bindUniformBuffer(null)},ThinEngine.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},ThinEngine.prototype.bindUniformBufferBase=function(e,t,i){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},ThinEngine.prototype.bindUniformBlock=function(e,t,i){const a=e.program,n=this._gl.getUniformBlockIndex(a,t);4294967295!==n&&this._gl.uniformBlockBinding(a,n,i)};var UniformBuffer=class e{_updateUIntArrayForEffect(e,t){this._currentEffect.setUIntArray(e,t)}_updateIntForEffect(e,t,i=""){this._currentEffect.setInt(e+i,t)}get _indexBuffer(){return this._bufferIndex}addUniform(e,t,i=0){if(this._noUBO)return;if(void 0!==this._uniformLocations[e])return;let a;if(i>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:i},16==t)t*=i;else{t=t*i+(4-t)*i}a=[];for(let e=0;e<t;e++)a.push(0)}else{if(t instanceof Array)a=t,t=a.length;else{a=[];for(let e=0;e<t;e++)a.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(let e=0;e<t;e++)this._data.push(a[e]);this._needSync=!0}addMatrix2x2(e){this.addUniform(e,8)}_updateVector3ForUniform(t,i){e._TempBuffer[0]=i.x,e._TempBuffer[1]=i.y,e._TempBuffer[2]=i.z,this.updateUniform(t,e._TempBuffer,3)}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}_updateInt3ForEffect(e,t,i,a,n=""){this._currentEffect.setInt3(e+n,t,i,a)}_updateFloat2ForEffect(e,t,i,a=""){this._currentEffect.setFloat2(e+a,t,i)}addMatrix(e,t){this.addUniform(e,Array.prototype.slice.call(t.asArray()))}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_updateFloat4ForEffect(e,t,i,a,n,s=""){this._currentEffect.setFloat4(e+s,t,i,a,n)}_updateVector3ForEffect(e,t){this._currentEffect.setVector3(e,t)}_updateIntForUniform(t,i){e._TempBufferInt32View[0]=i,this.updateUniform(t,e._TempBuffer,1)}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(e._UpdatedUbosInFrame[this._name]||(e._UpdatedUbosInFrame[this._name]=0),e._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_updateArrayForEffect(e,t){this._currentEffect.setArray(e,t)}_updateInt2ForUniform(t,i,a){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=a,this.updateUniform(t,e._TempBuffer,2)}updateUniform(e,t,i){this._checkNewFrame();let a=this._uniformLocations[e];if(void 0===a){if(this._buffer)return void Logger.Error("Cannot add an uniform after UBO has been created. uniformName="+e);this.addUniform(e,i),a=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(let e=0;e<i;e++)this._bufferData[a+e]=t[e];else{let e=!1;for(let n=0;n<i;n++)(16===i&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[a+n]!==Math.fround(t[n]))&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[a+n]=t[n]);this._needSync=this._needSync||e}}_buffersEqual(e,t){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}_updateColor3ForUniform(t,i){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,this.updateUniform(t,e._TempBuffer,3)}_updateInt4ForEffect(e,t,i,a,n,s=""){this._currentEffect.setInt4(e+s,t,i,a,n)}_updateMatrixForUniform(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.asArray(),16)}isDynamic(){return void 0!==this._dynamic}_updateColor4ForEffect(e,t,i,a=""){this._currentEffect.setColor4(e+a,t,i)}_updateArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateMatrix3x3ForUniform(t,i){for(let t=0;t<3;t++)e._TempBuffer[4*t]=i[3*t],e._TempBuffer[4*t+1]=i[3*t+1],e._TempBuffer[4*t+2]=i[3*t+2],e._TempBuffer[4*t+3]=0;this.updateUniform(t,e._TempBuffer,12)}addColor3(e,t){const i=[t.r,t.g,t.b];this.addUniform(e,i)}get currentEffect(){return this._currentEffect}addMatrix3x3(e){this.addUniform(e,12)}_updateMatricesForUniform(e,t){this.updateUniform(e,t,t.length)}_updateUInt4ForEffect(e,t,i,a,n,s=""){this._currentEffect.setUInt4(e+s,t,i,a,n)}_updateUInt4ForUniform(t,i,a,n,s){e._TempBufferUInt32View[0]=i,e._TempBufferUInt32View[1]=a,e._TempBufferUInt32View[2]=n,e._TempBufferUInt32View[3]=s,this.updateUniform(t,e._TempBuffer,4)}_getNames(){const e=[];let t=0;for(const i in this._uniformLocations)if(e.push(i),10==++t)break;return e.join(",")}_updateFloatForUniform(t,i){e._TempBuffer[0]=i,this.updateUniform(t,e._TempBuffer,1)}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_updateMatrixForEffect(e,t){this._currentEffect.setMatrix(e,t)}_updateMatrix2x2ForEffect(e,t){this._currentEffect.setMatrix2x2(e,t)}_updateFloatArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}constructor(e,t,i,a,n=!1){this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||n,this._dynamic=i,this._name=a??"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}_cacheMatrix(e,t){this._checkNewFrame();const i=this._valueCache[e],a=t.updateFlag;return(void 0===i||i!==a)&&(this._valueCache[e]=a,!0)}_updateDirectColor4ForUniform(t,i){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,e._TempBuffer[3]=i.a,this.updateUniform(t,e._TempBuffer,4)}_updateDirectColor4ForEffect(e,t,i=""){this._currentEffect.setDirectColor4(e+i,t)}_updateInt3ForUniform(t,i,a,n){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=a,e._TempBufferInt32View[2]=n,this.updateUniform(t,e._TempBuffer,3)}_updateUInt3ForUniform(t,i,a,n){e._TempBufferUInt32View[0]=i,e._TempBufferUInt32View[1]=a,e._TempBufferUInt32View[2]=n,this.updateUniform(t,e._TempBuffer,3)}setDataBuffer(e){if(!this._buffers)return this._buffer===e;for(let t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}addColor4(e,t,i){const a=[t.r,t.g,t.b,i];this.addUniform(e,a)}_updateFloatForEffect(e,t){this._currentEffect.setFloat(e,t)}_updateColor3ForEffect(e,t,i=""){this._currentEffect.setColor3(e+i,t)}getData(){return this._bufferData}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}setTexture(e,t){this._currentEffect.setTexture(e,t)}get name(){return this._name}_updateVector4ForEffect(e,t){this._currentEffect.setVector4(e,t)}_updateUInt3ForEffect(e,t,i,a,n=""){this._currentEffect.setUInt3(e+n,t,i,a)}updateUniformArray(e,t,i){this._checkNewFrame();const a=this._uniformLocations[e];if(void 0===a)return void Logger.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const n=this._uniformArraySizes[e];if(this._dynamic)for(let e=0;e<i;e++)this._bufferData[a+e]=t[e];else{let e=!1,s=0,r=0;for(let o=0;o<i;o++)if(this._bufferData[a+4*r+s]!==Tools.FloatRound(t[o])&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[a+4*r+s]=t[o]),s++,s===n.strideSize){for(;s<4;s++)this._bufferData[a+4*r+s]=0;s=0,r++}this._needSync=this._needSync||e}}_updateMatricesForEffect(e,t){this._currentEffect.setMatrices(e,t)}_updateIntArrayForUniform(t,i){e._TempBufferInt32View.set(i),this.updateUniformArray(t,e._TempBuffer,i.length)}updateUniformDirectly(e,t){this.updateUniform(e,t,t.length),this.update()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}_updateUInt2ForEffect(e,t,i,a=""){this._currentEffect.setUInt2(e+a,t,i)}getBuffer(){return this._buffer}_updateInt2ForEffect(e,t,i,a=""){this._currentEffect.setInt2(e+a,t,i)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}get _numBuffers(){return this._buffers.length}_updateUInt2ForUniform(t,i,a){e._TempBufferUInt32View[0]=i,e._TempBufferUInt32View[1]=a,this.updateUniform(t,e._TempBuffer,2)}_updateFloatArrayForEffect(e,t){this._currentEffect.setFloatArray(e,t)}_updateUIntForEffect(e,t,i=""){this._currentEffect.setUInt(e+i,t)}_updateFloat2ForUniform(t,i,a){e._TempBuffer[0]=i,e._TempBuffer[1]=a,this.updateUniform(t,e._TempBuffer,2)}_updateFloat3ForEffect(e,t,i,a,n=""){this._currentEffect.setFloat3(e+n,t,i,a)}dispose(){if(this._noUBO)return;const e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let e=0;e<this._buffers.length;++e){const t=this._buffers[e][0];this._engine._releaseBuffer(t)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}addFloat2(e,t,i){const a=[t,i];this.addUniform(e,a)}_updateVector4ForUniform(t,i){e._TempBuffer[0]=i.x,e._TempBuffer[1]=i.y,e._TempBuffer[2]=i.z,e._TempBuffer[3]=i.w,this.updateUniform(t,e._TempBuffer,4)}_updateUIntForUniform(t,i){e._TempBufferUInt32View[0]=i,this.updateUniform(t,e._TempBuffer,1)}_updateMatrix2x2ForUniform(t,i){for(let t=0;t<2;t++)e._TempBuffer[4*t]=i[2*t],e._TempBuffer[4*t+1]=i[2*t+1],e._TempBuffer[4*t+2]=0,e._TempBuffer[4*t+3]=0;this.updateUniform(t,e._TempBuffer,8)}addFloat3(e,t,i,a){const n=[t,i,a];this.addUniform(e,n)}get isSync(){return!this._needSync}_fillAlignment(e){let t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){const e=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;const i=this._uniformLocationPointer-e;for(let e=0;e<i;e++)this._data.push(0)}}_updateIntArrayForEffect(e,t){this._currentEffect.setIntArray(e,t)}_updateFloat4ForUniform(t,i,a,n,s){e._TempBuffer[0]=i,e._TempBuffer[1]=a,e._TempBuffer[2]=n,e._TempBuffer[3]=s,this.updateUniform(t,e._TempBuffer,4)}_updateColor4ForUniform(t,i,a){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,e._TempBuffer[3]=a,this.updateUniform(t,e._TempBuffer,4)}_updateMatrix3x3ForEffect(e,t){this._currentEffect.setMatrix3x3(e,t)}_updateFloat3ForUniform(t,i,a,n){e._TempBuffer[0]=i,e._TempBuffer[1]=a,e._TempBuffer[2]=n,this.updateUniform(t,e._TempBuffer,3)}addVector3(e,t){const i=[t.x,t.y,t.z];this.addUniform(e,i)}_copyBuffer(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}bindToEffect(e,t){this._currentEffect=e,this._currentEffectName=t}_updateUIntArrayForUniform(t,i){e._TempBufferUInt32View.set(i),this.updateUniformArray(t,e._TempBuffer,i.length)}bindTexture(e,t){this._currentEffect._bindTexture(e,t)}_updateInt4ForUniform(t,i,a,n,s){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=a,e._TempBufferInt32View[2]=n,e._TempBufferInt32View[3]=s,this.updateUniform(t,e._TempBuffer,4)}};UniformBuffer._UpdatedUbosInFrame={},UniformBuffer._MAX_UNIFORM_SIZE=256,UniformBuffer._TempBuffer=new Float32Array(UniformBuffer._MAX_UNIFORM_SIZE),UniformBuffer._TempBufferInt32View=new Int32Array(UniformBuffer._TempBuffer.buffer),UniformBuffer._TempBufferUInt32View=new Uint32Array(UniformBuffer._TempBuffer.buffer);var _MeshCollisionData=class{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new Vector3(0,0,0),this._diffPositionForCollisions=new Vector3(0,0,0),this._collisionResponse=!0}},Space,Space2;Space2=Space||(Space={}),Space2[Space2.LOCAL=0]="LOCAL",Space2[Space2.WORLD=1]="WORLD",Space2[Space2.BONE=2]="BONE";var Axis=class{},Coordinate,Coordinate2;function applyMorph(e,t,i){let a=null;switch(t){case VertexBuffer.PositionKind:a=e=>e.getPositions();break;case VertexBuffer.NormalKind:a=e=>e.getNormals();break;case VertexBuffer.TangentKind:a=e=>e.getTangents();break;case VertexBuffer.UVKind:a=e=>e.getUVs();break;default:return}for(let t=0;t<e.length;t++){let n=e[t];for(let s=0;s<i.numTargets;s++){const r=i.getTarget(s),o=r.influence;if(0!==o){const i=a(r);i&&(n+=(i[t]-e[t])*o)}}e[t]=n}}function applySkeleton(e,t,i,a,n,s,r){const o=TmpVectors.Vector3[0],l=TmpVectors.Matrix[0],c=TmpVectors.Matrix[1],h=t===VertexBuffer.NormalKind?Vector3.TransformNormalFromFloatsToRef:Vector3.TransformCoordinatesFromFloatsToRef;for(let t=0,u=0;t<e.length;t+=3,u+=4){let m,d;for(l.reset(),m=0;m<4;m++)d=n[u+m],d>0&&(Matrix.FromFloat32ArrayToRefScaled(i,Math.floor(16*a[u+m]),d,c),l.addToSelf(c));if(s&&r)for(m=0;m<4;m++)d=r[u+m],d>0&&(Matrix.FromFloat32ArrayToRefScaled(i,Math.floor(16*s[u+m]),d,c),l.addToSelf(c));h(e[t],e[t+1],e[t+2],l,o),o.toArray(e,t)}}Axis.X=new Vector3(1,0,0),Axis.Y=new Vector3(0,1,0),Axis.Z=new Vector3(0,0,1),Coordinate2=Coordinate||(Coordinate={}),Coordinate2[Coordinate2.X=0]="X",Coordinate2[Coordinate2.Y=1]="Y",Coordinate2[Coordinate2.Z=2]="Z";var _FacetDataStorage=class{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=Vector3.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}},_InternalAbstractMeshDataInfo=class{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new _FacetDataStorage,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new _MeshCollisionData,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}},AbstractMesh=class e extends TransformNode{get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}get isAnInstance(){return!1}_resyncLightSource(e){const t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);let a=!1;if(-1===i){if(!t)return;this._lightSources.push(e)}else{if(t)return;a=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(a)}getWorldMatrix(){return this._masterMesh&&this.billboardMode===TransformNode.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}setMaterialForRenderPass(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}getFacetLocalPositions(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}set isVisible(e){this._isVisible=e}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}createNormals(e){const t=this.getVerticesData(VertexBuffer.PositionKind),i=this.getIndices();let a;return a=this.isVerticesDataPresent(VertexBuffer.NormalKind)?this.getVerticesData(VertexBuffer.NormalKind):[],VertexData.ComputeNormals(t,i,a,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(VertexBuffer.NormalKind,a,e),this}get material(){return this._internalAbstractMeshDataInfo._material}set undefinedc(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}get lightSources(){return this._lightSources}_getActionManagerForTrigger(e,t=!0){if(this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}updateVerticesData(e,t,i,a){return this}calcMovePOV(e,t,i){const a=new Matrix;(this.rotationQuaternion?this.rotationQuaternion:Quaternion.Kc(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(a);const n=Vector3.Zero(),s=this.definedFacingForward?-1:1;return Vector3.TransformCoordinatesFromFloatsToRef(e*s,t,i*s,a,n),n}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}constructor(t,i=null){switch(super(t,i,!1),this._internalAbstractMeshDataInfo=new _InternalAbstractMeshDataInfo,this._waitingMaterialId=null,this.cullingStrategy=e.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new Observable,this.onCollisionPositionChangeObservable=new Observable,this.onMaterialChangedObservable=new Observable,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=Color3.Red(),this.outlineWidth=.02,this.overlayColor=Color3.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new Vector3(.5,1,.5),this.ellipsoidOffset=new Vector3(0,0,0),this.edgesWidth=1,this.edgesColor=new Color4(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new Observable,this._onCollisionPositionChange=(e,t,i=null)=>{t.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>Engine.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),i&&this.onCollideObservable.notifyObservers(i),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},(i=this.getScene()).addMesh(this),this._resyncLightSources(),this._uniformBuffer=new UniformBuffer(this.getScene().getEngine(),void 0,void 0,t,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),i.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}enableEdgesRendering(e,t,i){throw _WarnImport("EdgesRenderer")}getClosestFacetAtLocalCoordinates(e,t,i,a,n=!1,s=!0){let r=null,o=0,l=0,c=0,h=0,u=0,m=0,d=0,f=0;const p=this.getFacetLocalPositions(),_=this.getFacetLocalNormals(),g=this.getFacetsAtLocalCoordinates(e,t,i);if(!g)return null;let v,y,S,C=Number.MAX_VALUE,E=C;for(let A=0;A<g.length;A++)v=g[A],y=_[v],S=p[v],h=(e-S.x)*y.x+(t-S.y)*y.y+(i-S.z)*y.z,(!n||n&&s&&h>=0||n&&!s&&h<=0)&&(h=y.x*S.x+y.y*S.y+y.z*S.z,u=-(y.x*e+y.y*t+y.z*i-h)/(y.x*y.x+y.y*y.y+y.z*y.z),m=e+y.x*u,d=t+y.y*u,f=i+y.z*u,o=m-e,l=d-t,c=f-i,E=o*o+l*l+c*c,E<C&&(C=E,r=v,a&&(a.x=m,a.y=d,a.z=f)));return r}static _ApplySkeleton(e,t,i,a,n,s,r){applySkeleton(e,t,i,a,n,s,r)}_refreshBoundingInfo(e,t){if(e){const i=extractMinAndMax(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new BoundingInfo(i.minimum,i.maximum)}if(this.subMeshes)for(let t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo(e);this._updateBoundingInfo()}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let e=this._parentNode;for(;e;){const t=e.isVisible;if(void 0!==t)return t;e=e.parent}}return this._isVisible}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}_unBindEffect(){for(const e of this.subMeshes)e.setEffect(null)}getClassName(){return"AbstractMesh"}set onCollide(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}disableEdgesRendering(){throw _WarnImport("EdgesRenderer")}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}getVerticesData(e){return null}_markSubMeshesAsLightDirty(e=!1){this._markSubMeshesAsDirty((t=>t.markAsLightDirty(e)))}dispose(e,t=!1){let i;const a=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.Hc]=void 0),a.freeActiveMeshes(),a.freeRenderingGroups(),a.renderingManager.maintainStateBetweenFrames&&a.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((e=>e!==this&&e.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){const e=this._intersectionsInProgress[i],t=e._intersectionsInProgress.indexOf(this);e._intersectionsInProgress.splice(t,1)}this._intersectionsInProgress.length=0;a.lights.forEach((e=>{let t=e.includedOnlyMeshes.indexOf(this);-1!==t&&e.includedOnlyMeshes.splice(t,1),t=e.excludedMeshes.indexOf(this),-1!==t&&e.excludedMeshes.splice(t,1);const i=e.getShadowGenerators();if(i){const e=i.values();for(let i=e.next();!0!==i.done;i=e.next()){const e=i.value.getShadowMap();e&&e.cb&&(t=e.cb.indexOf(this),-1!==t&&e.cb.splice(t,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const n=a.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,n.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),n.wipeCaches(),a.removeMesh(this),this._parentContainer){const e=this._parentContainer.meshes.indexOf(this);e>-1&&this._parentContainer.meshes.splice(e,1),this._parentContainer=null}if(t&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(i=0;i<a.particleSystems.length;i++)a.particleSystems[i].emitter===this&&(a.particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(e,t)}intersectsMesh(e,t=!1,i){const a=this.getBoundingInfo(),n=e.getBoundingInfo();if(a.intersects(n,t))return!0;if(i)for(const i of this.getChildMeshes())if(i.intersectsMesh(e,t,!0))return!0;return!1}_shouldConvertRHS(){return!1}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(e,t,i){return this._boundingInfo=new BoundingInfo(e,t,i),this._boundingInfo}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}normalizeToUnitCube(e=!0,t=!1,i){return super.normalizeToUnitCube(e,t,i)}isVerticesDataPresent(e){return!1}getFacetPositionToRef(e,t){const i=this.getFacetLocalPositions()[e],a=this.getWorldMatrix();return Vector3.TransformCoordinatesToRef(i,a,t),this}_generatePointsArray(){return!1}static get BILLBOARDMODE_X(){return TransformNode.BILLBOARDMODE_X}set inheritVisibility(e){this._internalAbstractMeshDataInfo._inheritVisibility=e}_freeze(){}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}set hasVertexAlpha(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}transferToEffect(e){const t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}getMaterialForRenderPass(e){return this._internalAbstractMeshDataInfo._materialForRenderPass?.[e]}getTotalVertices(){return 0}static get BILLBOARDMODE_NONE(){return TransformNode.BILLBOARDMODE_NONE}_preActivateForIntermediateRendering(e){}setBoundingInfo(e){return this._boundingInfo=e,this}_activate(e,t){return this._renderId=e,!0}_collideForSubMesh(e,t,i){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];const i=e.verticesStart,a=e.verticesStart+e.verticesCount;for(let n=i;n<a;n++)e._lastColliderWorldVertices.push(Vector3.TransformCoordinates(this._positions[n],t))}return i._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),7===e.getMaterial()?.fillMode),this}updateFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();const t=this.getVerticesData(VertexBuffer.PositionKind),i=this.getIndices(),a=this.getVerticesData(VertexBuffer.NormalKind),n=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,i instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(i);else{let t=!1;for(let e=0;e<i.length;e++)if(i[e]>65535){t=!0;break}e.depthSortedIndices=t?new Uint32Array(i):new Uint16Array(i)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){const t=this.getScene().activeCamera;e.facetDepthSortFrom=t?t.position:Vector3.Zero()}e.depthSortedFacets=[];for(let t=0;t<e.facetNb;t++){const i={ind:3*t,sqDistance:0};e.depthSortedFacets.push(i)}e.invertedMatrix=Matrix.Identity(),e.facetDepthSortOrigin=Vector3.Zero()}e.bbSize.x=n.maximum.x-n.minimum.x>Epsilon?n.maximum.x-n.minimum.x:Epsilon,e.bbSize.y=n.maximum.y-n.minimum.y>Epsilon?n.maximum.y-n.minimum.y:Epsilon,e.bbSize.z=n.maximum.z-n.minimum.z>Epsilon?n.maximum.z-n.minimum.z:Epsilon;let s=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(s=s>e.bbSize.z?s:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/s),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/s),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/s),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=n,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),Vector3.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,a&&VertexData.ComputeNormals(t,i,a,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);const t=e.depthSortedIndices.length/3|0;for(let a=0;a<t;a++){const t=e.depthSortedFacets[a].ind;e.depthSortedIndices[3*a]=i[t],e.depthSortedIndices[3*a+1]=i[t+1],e.depthSortedIndices[3*a+2]=i[t+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}_rebuild(e=!1){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){for(const e of this.subMeshes)e._rebuild();this.resetDrawCache()}}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==TransformNode.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}setIndices(e,t){return this}getFacetsAtLocalCoordinates(e,t,i){const a=this.getBoundingInfo(),n=this._internalAbstractMeshDataInfo._facetData,s=Math.floor((e-a.minimum.x*n.partitioningBBoxRatio)*n.subDiv.X*n.partitioningBBoxRatio/n.bbSize.x),r=Math.floor((t-a.minimum.y*n.partitioningBBoxRatio)*n.subDiv.Y*n.partitioningBBoxRatio/n.bbSize.y),o=Math.floor((i-a.minimum.z*n.partitioningBBoxRatio)*n.subDiv.Z*n.partitioningBBoxRatio/n.bbSize.z);return s<0||s>n.subDiv.max||r<0||r>n.subDiv.max||o<0||o>n.subDiv.max?null:n.facetPartitioning[s+n.subDiv.max*r+n.subDiv.max*n.subDiv.max*o]}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}static get BILLBOARDMODE_Z(){return TransformNode.BILLBOARDMODE_Z}set partitioningSubdivisions(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}releaseSubMeshes(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[];return this}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set pointerOverDisableMeshTesting(e){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=e}resetDrawCache(e){if(this.subMeshes)for(const t of this.subMeshes)t.resetDrawCache(e)}set checkCollisions(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}_checkOcclusionQuery(){return!1}set useVertexColors(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}get isBlocked(){return!1}getMeshUniformBuffer(){return this._uniformBuffer}_unFreeze(){}get visibility(){return this._internalAbstractMeshDataInfo._visibility}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}getFacetNormalToRef(e,t){const i=this.getFacetLocalNormals()[e];return Vector3.TransformNormalToRef(i,this.getWorldMatrix(),t),this}_updateSubMeshesBoundingInfo(e){if(!this.subMeshes)return this;const t=this.subMeshes.length;for(let i=0;i<t;i++){const a=this.subMeshes[i];(t>1||!a.IsGlobal)&&a.updateBoundingInfo(e)}return this}getIndices(){return null}set mustDepthSortFacets(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}set collisionMask(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}_preActivate(){}_getData(t,i,a=VertexBuffer.PositionKind){const n=t.cache,s=e=>{if(n){const t=n._vertexData||(n._vertexData={});return t[e]||this.copyVerticesData(e,t),t[e]}return this.getVerticesData(e)};if(i||(i=s(a)),!i)return null;if(n?(n._outputData?n._outputData.set(i):n._outputData=new Float32Array(i),i=n._outputData):(t.applyMorph&&this.morphTargetManager||t.applySkeleton&&this.skeleton)&&(i=i.slice()),t.applyMorph&&this.morphTargetManager&&applyMorph(i,a,this.morphTargetManager),t.applySkeleton&&this.skeleton){const t=s(VertexBuffer.MatricesIndicesKind),n=s(VertexBuffer.MatricesWeightsKind);if(n&&t){const r=this.numBoneInfluencers>4,o=r?s(VertexBuffer.MatricesIndicesExtraKind):null,l=r?s(VertexBuffer.MatricesWeightsExtraKind):null,c=this.skeleton.getTransformMatrices(this);e._ApplySkeleton(i,a,c,t,n,o,l)}}if(!1!==t.updatePositionsArray&&a===VertexBuffer.PositionKind){const e=this._internalAbstractMeshDataInfo._positions||[],t=e.length;if(e.length=i.length/3,t<e.length)for(let i=t;i<e.length;i++)e[i]=new Vector3;for(let t=0,a=0;t<e.length;t++,a+=3)e[t].copyFromFloats(i[a],i[a+1],i[a+2]);this._internalAbstractMeshDataInfo._positions=e}return i}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}set collisionResponse(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}rotatePOV(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this}movePOV(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this}set onCollisionPositionChange(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}set surroundingMeshes(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}get undefinedc(){return this._internalAbstractMeshDataInfo._renderingGroupId}set applyFog(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}static get BILLBOARDMODE_Y(){return TransformNode.BILLBOARDMODE_Y}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((e=>e.markAsAttributesDirty()))}set collisionRetryCount(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}_setMaterial(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.Hc]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.Hc]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}getPositionData(e=!1,t=!1,i=null){return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},i,VertexBuffer.PositionKind)}getFacetLocalPartitioning(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}set bakedVertexAnimationManager(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}static get BILLBOARDMODE_ALL(){return TransformNode.BILLBOARDMODE_ALL}_refreshBoundingInfoDirect(e){if(this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new BoundingInfo(e.minimum,e.maximum),this.subMeshes)for(let e=0;e<this.subMeshes.length;e++)this.subMeshes[e].refreshBoundingInfo(null);this._updateBoundingInfo()}calcRotatePOV(e,t,i){const a=this.definedFacingForward?1:-1;return new Vector3(e*a,t,i*a)}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((e=>e.markAsMiscDirty()))}set visibility(e){if(this._internalAbstractMeshDataInfo._visibility===e)return;const t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(1===t&&1!==e||1!==t&&1===e)&&this._markSubMeshesAsDirty((e=>{e.markAsMiscDirty(),e.markAsPrePassDirty()}))}set morphTargetManager(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}set rawBoundingInfo(e){this._internalAbstractMeshDataInfo._rawBoundingInfo=e}_removeLightSource(e,t){const i=this._lightSources.indexOf(e);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(t))}get hasInstances(){return!1}set skeleton(e){const t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}set collisionGroup(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}static get BILLBOARDMODE_USE_POSITION(){return TransformNode.BILLBOARDMODE_USE_POSITION}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new BoundingInfo(Vector3.Zero(),Vector3.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}toString(e){let t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const i=this._internalAbstractMeshDataInfo._skeleton;return i&&(t+=", skeleton: "+i.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}alignWithNormal(e,t){t||(t=Axis.Y);const i=TmpVectors.Vector3[0],a=TmpVectors.Vector3[1];return Vector3.CrossToRef(t,e,a),Vector3.CrossToRef(e,a,i),this.rotationQuaternion?Quaternion.RotationQuaternionFromAxisToRef(i,e,a,this.rotationQuaternion):Vector3.RotationFromAxisToRef(i,e,a,this.rotation),this}_processCollisionsForSubMeshes(e,t){const i=this._scene.getCollidingSubMeshCandidates(this,e),a=i.length;for(let n=0;n<a;n++){const s=i.data[n];a>1&&!s._checkCollision(e)||this._collideForSubMesh(s,t,e)}return this}_initFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=[]),e.facetPositions||(e.facetPositions=[]),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(let t=0;t<e.facetNb;t++)e.facetNormals[t]=Vector3.Zero(),e.facetPositions[t]=Vector3.Zero();return e.facetDataEnabled=!0,this}getTotalIndices(){return 0}set partitioningBBoxRatio(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}disableFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=[],e.facetNormals=[],e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this}setVerticesData(e,t,i,a){return this}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set numBoneInfluencers(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}updateIndices(e,t,i=!1){return this}_updateNonUniformScalingState(e){return!!super._updateNonUniformScalingState(e)&&(this._markSubMeshesAsMiscDirty(),!0)}moveWithCollisions(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.Hc),this}getNormalsData(e=!1,t=!1){return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},null,VertexBuffer.NormalKind)}_postActivate(){}intersects(e,t,i,a=!1,n,s=!1){const r=new PickingInfo,o=this.getClassName(),l="InstancedLinesMesh"===o||"LinesMesh"===o||"GreasedLineMesh"===o?this.intersectionThreshold:0,c=this.getBoundingInfo();if(!this.subMeshes)return r;if(!(s||e.intersectsSphere(c.boundingSphere,l)&&e.intersectsBox(c.boundingBox,l)))return r;if(a)return r.hit=!s,r.pickedMesh=s?null:this,r.distance=s?0:Vector3.Distance(e.origin,c.boundingSphere.center),r.subMeshId=0,r;if(!this._generatePointsArray())return r;let h=null;const u=this._scene.getIntersectingSubMeshCandidates(this,e),m=u.length;let d=!1;for(let e=0;e<m;e++){const t=u.data[e].getMaterial();if(t&&(7==t.fillMode||0==t.fillMode||1==t.fillMode||2==t.fillMode||4==t.fillMode)){d=!0;break}}if(!d)return r.hit=!0,r.pickedMesh=this,r.distance=Vector3.Distance(e.origin,c.boundingSphere.center),r.subMeshId=-1,r;for(let a=0;a<m;a++){const n=u.data[a];if(m>1&&!s&&!n.canIntersects(e))continue;const r=n.intersects(e,this._positions,this.getIndices(),t,i);if(r&&(t||!h||r.distance<h.distance)&&(h=r,h.subMeshId=a,t))break}if(h){const t=n??this.getWorldMatrix(),i=TmpVectors.Vector3[0],a=TmpVectors.Vector3[1];Vector3.TransformCoordinatesToRef(e.origin,t,i),e.direction.scaleToRef(h.distance,a);const s=Vector3.TransformNormal(a,t).addInPlace(i);return r.hit=!0,r.distance=Vector3.Distance(i,s),r.pickedPoint=s,r.pickedMesh=this,r.bu=h.bu||0,r.bv=h.bv||0,r.subMeshFaceId=h.faceId,r.faceId=h.faceId+u.data[h.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),r.subMeshId=h.subMeshId,r}return r}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}getClosestFacetAtCoordinates(e,t,i,a,n=!1,s=!0){const r=this.getWorldMatrix(),o=TmpVectors.Matrix[5];r.invertToRef(o);const l=TmpVectors.Vector3[8];Vector3.TransformCoordinatesFromFloatsToRef(e,t,i,o,l);const c=this.getClosestFacetAtLocalCoordinates(l.x,l.y,l.z,a,n,s);return a&&Vector3.TransformCoordinatesFromFloatsToRef(a.x,a.y,a.z,r,a),c}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}intersectsPoint(e){return this.getBoundingInfo().intersectsPoint(e)}clone(e,t,i){return null}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind)}set layerMask(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}getLOD(e){return this}set facetDepthSortFrom(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set receiveShadows(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}_checkCollision(e){if(!this.getBoundingInfo()._checkCollision(e))return this;const t=TmpVectors.Matrix[0],i=TmpVectors.Matrix[1];return Matrix.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,i),this._processCollisionsForSubMeshes(e,i),this}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}getFacetPosition(e){const t=Vector3.Zero();return this.getFacetPositionToRef(e,t),t}getFacetLocalNormals(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}getFacetNormal(e){const t=Vector3.Zero();return this.getFacetNormalToRef(e,t),t}isCompletelyInFrustum(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}set material(e){this._setMaterial(e)}_markSubMeshesAsDirty(e){if(this.subMeshes)for(const t of this.subMeshes)for(let i=0;i<t._drawWrappers.length;++i){const a=t._drawWrappers[i];a&&a.defines&&a.defines.markAllAsDirty&&e(a.defines)}}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get hasThinInstances(){return!1}_resyncLightSources(){this._lightSources.length=0;for(const e of this.getScene().lights)e.isEnabled()&&e.canAffectMesh(this)&&this._lightSources.push(e);this._markSubMeshesAsLightDirty()}getConnectedParticleSystems(){return this._scene.particleSystems.filter((e=>e.emitter===this))}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set enableDistantPicking(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}isInFrustum(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}};AbstractMesh.OCCLUSION_TYPE_NONE=0,AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC=1,AbstractMesh.OCCLUSION_TYPE_STRICT=2,AbstractMesh.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,AbstractMesh.CULLINGSTRATEGY_STANDARD=0,AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,__decorate([nativeOverride.filter(((...[e,t,i,a,n])=>!(Array.isArray(e)||Array.isArray(t)||Array.isArray(i)||Array.isArray(a)||Array.isArray(n))))],AbstractMesh,"_ApplySkeleton",null),RegisterClass("BABYLON.AbstractMesh",AbstractMesh);var MaterialStencilState=class{set func(e){this._func=e}get enabled(){return this._enabled}get opStencilDepthPass(){return this._opStencilDepthPass}copyTo(e){SerializationHelper.Clone((()=>e),this)}set enabled(e){this._enabled=e}parse(e,t,i){SerializationHelper.Parse((()=>this),e,t,i)}getClassName(){return"MaterialStencilState"}constructor(){this.reset()}set mask(e){this._mask=e}set opStencilFail(e){this._opStencilFail=e}set opStencilDepthPass(e){this._opStencilDepthPass=e}set funcRef(e){this._funcRef=e}get opDepthFail(){return this._opDepthFail}set funcMask(e){this._funcMask=e}get funcMask(){return this._funcMask}serialize(){return SerializationHelper.Serialize(this)}set opDepthFail(e){this._opDepthFail=e}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}get funcRef(){return this._funcRef}get mask(){return this._mask}get opStencilFail(){return this._opStencilFail}};__decorate([serialize()],MaterialStencilState.prototype,"func",null),__decorate([serialize()],MaterialStencilState.prototype,"funcRef",null),__decorate([serialize()],MaterialStencilState.prototype,"funcMask",null),__decorate([serialize()],MaterialStencilState.prototype,"opStencilFail",null),__decorate([serialize()],MaterialStencilState.prototype,"opDepthFail",null),__decorate([serialize()],MaterialStencilState.prototype,"opStencilDepthPass",null),__decorate([serialize()],MaterialStencilState.prototype,"mask",null),__decorate([serialize()],MaterialStencilState.prototype,"enabled",null);var LightConstants=class{static CompareLightsPriority(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}};function addClipPlaneUniforms(e){-1===e.indexOf("vClipPlane")&&e.push("vClipPlane"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")}function prepareStringDefinesForClipPlanes(e,t,i){const a=!!(e.clipPlane??t.clipPlane),n=!!(e.clipPlane2??t.clipPlane2),s=!!(e.clipPlane3??t.clipPlane3),r=!!(e.clipPlane4??t.clipPlane4),o=!!(e.clipPlane5??t.clipPlane5),l=!!(e.clipPlane6??t.clipPlane6);a&&i.push("#define CLIPPLANE"),n&&i.push("#define CLIPPLANE2"),s&&i.push("#define CLIPPLANE3"),r&&i.push("#define CLIPPLANE4"),o&&i.push("#define CLIPPLANE5"),l&&i.push("#define CLIPPLANE6")}function prepareDefinesForClipPlanes(e,t,i){let a=!1;const n=!!(e.clipPlane??t.clipPlane),s=!!(e.clipPlane2??t.clipPlane2),r=!!(e.clipPlane3??t.clipPlane3),o=!!(e.clipPlane4??t.clipPlane4),l=!!(e.clipPlane5??t.clipPlane5),c=!!(e.clipPlane6??t.clipPlane6);return i.CLIPPLANE!==n&&(i.CLIPPLANE=n,a=!0),i.CLIPPLANE2!==s&&(i.CLIPPLANE2=s,a=!0),i.CLIPPLANE3!==r&&(i.CLIPPLANE3=r,a=!0),i.CLIPPLANE4!==o&&(i.CLIPPLANE4=o,a=!0),i.CLIPPLANE5!==l&&(i.CLIPPLANE5=l,a=!0),i.CLIPPLANE6!==c&&(i.CLIPPLANE6=c,a=!0),a}function bindClipPlane(e,t,i){let a=t.clipPlane??i.clipPlane;setClipPlane(e,"vClipPlane",a),a=t.clipPlane2??i.clipPlane2,setClipPlane(e,"vClipPlane2",a),a=t.clipPlane3??i.clipPlane3,setClipPlane(e,"vClipPlane3",a),a=t.clipPlane4??i.clipPlane4,setClipPlane(e,"vClipPlane4",a),a=t.clipPlane5??i.clipPlane5,setClipPlane(e,"vClipPlane5",a),a=t.clipPlane6??i.clipPlane6,setClipPlane(e,"vClipPlane6",a)}function setClipPlane(e,t,i){i&&e.setFloat4(t,i.normal.x,i.normal.y,i.normal.z,i.d)}LightConstants.FALLOFF_DEFAULT=0,LightConstants.FALLOFF_PHYSICAL=1,LightConstants.FALLOFF_GLTF=2,LightConstants.FALLOFF_STANDARD=3,LightConstants.LIGHTMAP_DEFAULT=0,LightConstants.LIGHTMAP_SPECULAR=1,LightConstants.LIGHTMAP_SHADOWSONLY=2,LightConstants.INTENSITYMODE_AUTOMATIC=0,LightConstants.INTENSITYMODE_LUMINOUSPOWER=1,LightConstants.INTENSITYMODE_LUMINOUSINTENSITY=2,LightConstants.INTENSITYMODE_ILLUMINANCE=3,LightConstants.INTENSITYMODE_LUMINANCE=4,LightConstants.LIGHTTYPEID_POINTLIGHT=0,LightConstants.LIGHTTYPEID_DIRECTIONALLIGHT=1,LightConstants.LIGHTTYPEID_SPOTLIGHT=2,LightConstants.LIGHTTYPEID_HEMISPHERICLIGHT=3;var _TempFogColor=Color3.Black(),_TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0};function BindLogDepth(e,t,i){if(!e||e.LOGARITHMICDEPTH||e.indexOf&&e.indexOf("LOGARITHMICDEPTH")>=0){const e=i.activeCamera;1===e.mode&&Logger.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(e.maxZ+1)/Math.LN2))}}function BindFogParameters(e,t,i,a=!1){i&&e.fogEnabled&&(!t||t.applyFog)&&0!==e.fogMode&&(i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),a?(e.fogColor.toLinearSpaceToRef(_TempFogColor,e.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",_TempFogColor)):i.setColor3("vFogColor",e.fogColor))}function PrepareAttributesForMorphTargetsInfluencers(e,t,i){_TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=i,PrepareAttributesForMorphTargets(e,t,_TmpMorphInfluencers)}function PrepareAttributesForMorphTargets(e,t,i){const a=i.NUM_MORPH_INFLUENCERS;if(a>0&&EngineStore.LastCreatedEngine){const n=EngineStore.LastCreatedEngine.getCaps().maxVertexAttribs,s=t.morphTargetManager;if(s?.isUsingTextureForTargets)return;const r=s&&s.supportsNormals&&i.NORMAL,o=s&&s.supportsTangents&&i.TANGENT,l=s&&s.supportsUVs&&i.UV1;for(let i=0;i<a;i++)e.push("position"+i),r&&e.push("normal"+i),o&&e.push("tangent"+i),l&&e.push("uv_"+i),e.length>n&&Logger.Error("Cannot add more vertex attributes for mesh "+t.name)}}function PushAttributesForInstances(e,t=!1){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}function BindMorphTargetParameters(e,t){const i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)}function BindSceneUniformBuffer(e,t){t.bindToEffect(e,"Scene")}function PrepareDefinesForMergedUV(e,t,i){t._needUVs=!0,t[i]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[i+"DIRECTUV"]=0}function BindTextureMatrix(e,t,i){const a=e.getTextureMatrix();t.updateMatrix(i+"Matrix",a)}function PrepareAttributesForBakedVertexAnimation(e,t,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}function _CopyBonesTransformationMatrices(e,t){return t.set(e),t}function BindBonesParameters(e,t,i){if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){const a=e.skeleton;if(a.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){const i=a.getTransformMatrixTexture(e);t.setTexture("boneSampler",i),t.setFloat("boneTextureWidth",4*(a.bones.length+1))}else{const n=a.getTransformMatrices(e);n&&(t.setMatrices("mBones",n),i&&e.getScene().prePassRenderer&&e.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[e.Hc]||(i.previousBones[e.Hc]=n.slice()),t.setMatrices("mPreviousBones",i.previousBones[e.Hc]),_CopyBonesTransformationMatrices(n,i.previousBones[e.Hc])))}}}function BindLight(e,t,i,a,n,s=!0){e._bindLight(t,i,a,n,s)}function BindLights(e,t,i,a,n=4){const s=Math.min(t.lightSources.length,n);for(let n=0;n<s;n++){BindLight(t.lightSources[n],n,e,i,"boolean"==typeof a?a:a.SPECULARTERM,t.receiveShadows)}}function PrepareAttributesForBones(e,t,i,a){i.NUM_BONE_INFLUENCERS>0&&(a.addCPUSkinningFallback(0,t),e.push("matricesIndices"),e.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(e.push("matricesIndicesExtra"),e.push("matricesWeightsExtra")))}function PrepareAttributesForInstances(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&PushAttributesForInstances(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push("instanceColor")}function HandleFallbacksForShadows(e,t,i=4,a=0){let n=0;for(let s=0;s<i&&e["LIGHT"+s];s++)s>0&&(n=a+s,t.addFallback(n,"LIGHT"+s)),e.SHADOWS||(e["SHADOW"+s]&&t.addFallback(a,"SHADOW"+s),e["SHADOWPCF"+s]&&t.addFallback(a,"SHADOWPCF"+s),e["SHADOWPCSS"+s]&&t.addFallback(a,"SHADOWPCSS"+s),e["SHADOWPOISSON"+s]&&t.addFallback(a,"SHADOWPOISSON"+s),e["SHADOWESM"+s]&&t.addFallback(a,"SHADOWESM"+s),e["SHADOWCLOSEESM"+s]&&t.addFallback(a,"SHADOWCLOSEESM"+s));return n++}function GetFogState(e,t){return t.fogEnabled&&e.applyFog&&0!==t.fogMode}function PrepareDefinesForMisc(e,t,i,a,n,s,r,o=!1){r._areMiscDirty&&(r.LOGARITHMICDEPTH=i,r.POINTSIZE=a,r.FOG=n&&GetFogState(e,t),r.NONUNIFORMSCALING=e.nonUniformScaling,r.ALPHATEST=s,r.DECAL_AFTER_DETAIL=o)}function PrepareDefinesForLights(e,t,i,a,n=4,s=!1){if(!i._areLightsDirty)return i._needNormals;let r=0;const o={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!s)for(const s of t.lightSources)if(PrepareDefinesForLight(e,t,s,r,i,a,o),r++,r===n)break;i.SPECULARTERM=o.specularEnabled,i.SHADOWS=o.shadowEnabled;for(let e=r;e<n;e++)void 0!==i["LIGHT"+e]&&(i["LIGHT"+e]=!1,i["HEMILIGHT"+e]=!1,i["POINTLIGHT"+e]=!1,i["DIRLIGHT"+e]=!1,i["SPOTLIGHT"+e]=!1,i["SHADOW"+e]=!1,i["SHADOWCSM"+e]=!1,i["SHADOWCSMDEBUG"+e]=!1,i["SHADOWCSMNUM_CASCADES"+e]=!1,i["SHADOWCSMUSESHADOWMAXZ"+e]=!1,i["SHADOWCSMNOBLEND"+e]=!1,i["SHADOWCSM_RIGHTHANDED"+e]=!1,i["SHADOWPCF"+e]=!1,i["SHADOWPCSS"+e]=!1,i["SHADOWPOISSON"+e]=!1,i["SHADOWESM"+e]=!1,i["SHADOWCLOSEESM"+e]=!1,i["SHADOWCUBE"+e]=!1,i["SHADOWLOWQUALITY"+e]=!1,i["SHADOWMEDIUMQUALITY"+e]=!1);const l=e.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(o.needRebuild=!0),i.SHADOWFLOAT=o.shadowEnabled&&(l.textureFloatRender&&l.textureFloatLinearFiltering||l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=o.lightmapMode,o.needRebuild&&i.rebuild(),o.needNormals}function PrepareDefinesForLight(e,t,i,a,n,s,r){switch(r.needNormals=!0,void 0===n["LIGHT"+a]&&(r.needRebuild=!0),n["LIGHT"+a]=!0,n["SPOTLIGHT"+a]=!1,n["HEMILIGHT"+a]=!1,n["POINTLIGHT"+a]=!1,n["DIRLIGHT"+a]=!1,i.prepareLightSpecificDefines(n,a),n["LIGHT_FALLOFF_PHYSICAL"+a]=!1,n["LIGHT_FALLOFF_GLTF"+a]=!1,n["LIGHT_FALLOFF_STANDARD"+a]=!1,i.falloffType){case LightConstants.FALLOFF_GLTF:n["LIGHT_FALLOFF_GLTF"+a]=!0;break;case LightConstants.FALLOFF_PHYSICAL:n["LIGHT_FALLOFF_PHYSICAL"+a]=!0;break;case LightConstants.FALLOFF_STANDARD:n["LIGHT_FALLOFF_STANDARD"+a]=!0}if(s&&!i.specular.equalsFloats(0,0,0)&&(r.specularEnabled=!0),n["SHADOW"+a]=!1,n["SHADOWCSM"+a]=!1,n["SHADOWCSMDEBUG"+a]=!1,n["SHADOWCSMNUM_CASCADES"+a]=!1,n["SHADOWCSMUSESHADOWMAXZ"+a]=!1,n["SHADOWCSMNOBLEND"+a]=!1,n["SHADOWCSM_RIGHTHANDED"+a]=!1,n["SHADOWPCF"+a]=!1,n["SHADOWPCSS"+a]=!1,n["SHADOWPOISSON"+a]=!1,n["SHADOWESM"+a]=!1,n["SHADOWCLOSEESM"+a]=!1,n["SHADOWCUBE"+a]=!1,n["SHADOWLOWQUALITY"+a]=!1,n["SHADOWMEDIUMQUALITY"+a]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&i.shadowEnabled){const t=i.getShadowGenerator(e.activeCamera)??i.getShadowGenerator();if(t){const e=t.getShadowMap();e&&e.cb&&e.cb.length>0&&(r.shadowEnabled=!0,t.prepareDefines(n,a))}}i.lightmapMode!=LightConstants.LIGHTMAP_DEFAULT?(r.lightmapMode=!0,n["LIGHTMAPEXCLUDED"+a]=!0,n["LIGHTMAPNOSPECULAR"+a]=i.lightmapMode==LightConstants.LIGHTMAP_SHADOWSONLY):(n["LIGHTMAPEXCLUDED"+a]=!1,n["LIGHTMAPNOSPECULAR"+a]=!1)}function PrepareDefinesForFrameBoundValues(e,t,i,a,n,s=null,r=!1){let o=PrepareDefinesForCamera(e,a);!1!==s&&(o=prepareDefinesForClipPlanes(i,e,a)),a.DEPTHPREPASS!==!t.getColorWrite()&&(a.DEPTHPREPASS=!a.DEPTHPREPASS,o=!0),a.INSTANCES!==n&&(a.INSTANCES=n,o=!0),a.THIN_INSTANCES!==r&&(a.THIN_INSTANCES=r,o=!0),o&&a.markAsUnprocessed()}function PrepareDefinesForBones(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;const i=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&i)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!i&&void 0;const a=e.getScene().prePassRenderer;if(a&&a.enabled){const i=-1===a.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=i}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,void 0!==t.BONETEXTURE&&(t.BONETEXTURE=!1)}function PrepareDefinesForMorphTargets(e,t){const i=e.morphTargetManager;i?(t.MORPHTARGETS_UV=i.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=i.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=i.supportsNormals&&t.NORMAL,t.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,t.MORPHTARGETS=t.NUM_MORPH_INFLUENCERS>0,t.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}function PrepareDefinesForBakedVertexAnimation(e,t){const i=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!i||!i.isEnabled)}function PrepareDefinesForAttributes(e,t,i,a,n=!1,s=!0,r=!0){if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent("normal"),t._needNormals&&e.isVerticesDataPresent("tangent")&&(t.TANGENT=!0);for(let i=1;i<=6;++i)t["UV"+i]=!!t._needUVs&&e.isVerticesDataPresent(`uv${1===i?"":i}`);if(i){const i=e.useVertexColors&&e.isVerticesDataPresent("color");t.VERTEXCOLOR=i,t.VERTEXALPHA=e.hasVertexAlpha&&i&&s}return e.isVerticesDataPresent("instanceColor")&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),a&&PrepareDefinesForBones(e,t),n&&PrepareDefinesForMorphTargets(e,t),r&&PrepareDefinesForBakedVertexAnimation(e,t),!0}function PrepareDefinesForMultiview(e,t){if(e.activeCamera){const i=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=i&&t.markAsUnprocessed()}}function PrepareDefinesForOIT(e,t,i){const a=t.ORDER_INDEPENDENT_TRANSPARENCY,n=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&i,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,a===t.ORDER_INDEPENDENT_TRANSPARENCY&&n===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}function PrepareDefinesForPrePass(e,t,i){const a=t.PREPASS;if(!t._arePrePassDirty)return;const n=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&i){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount,t.PREPASS_NORMAL_WORLDSPACE=e.prePassRenderer.generateNormalsInWorldSpace;for(let i=0;i<n.length;i++){const a=e.prePassRenderer.getIndex(n[i].type);-1!==a?(t[n[i].define]=!0,t[n[i].index]=a):t[n[i].define]=!1}}else{t.PREPASS=!1;for(let e=0;e<n.length;e++)t[n[e].define]=!1}t.PREPASS!=a&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}function PrepareDefinesForCamera(e,t){let i=!1;if(e.activeCamera){const a=t.CAMERA_ORTHOGRAPHIC?1:0,n=t.CAMERA_PERSPECTIVE?1:0,s=1===e.activeCamera.mode?1:0,r=0===e.activeCamera.mode?1:0;(a^s||n^r)&&(t.CAMERA_ORTHOGRAPHIC=1===s,t.CAMERA_PERSPECTIVE=1===r,i=!0)}return i}function PrepareUniformsAndSamplersForLight(e,t,i,a,n=null,s=!1){n&&n.push("Light"+e),s||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),i.push("shadowTexture"+e),i.push("depthTexture"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),a&&(i.push("projectionLightTexture"+e),t.push("textureProjectionMatrix"+e)))}function PrepareUniformsAndSamplersList(e,t,i,a=4){let n,s=null;if(e.uniformsNames){const r=e;n=r.uniformsNames,s=r.uniformBuffersNames,t=r.samplers,i=r.defines,a=r.maxSimultaneousLights||0}else n=e,t||(t=[]);for(let e=0;e<a&&i["LIGHT"+e];e++)PrepareUniformsAndSamplersForLight(e,n,t,i["PROJECTEDLIGHTTEXTURE"+e],s);i.NUM_MORPH_INFLUENCERS&&(n.push("morphTargetInfluences"),n.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(n.push("bakedVertexAnimationSettings"),n.push("bakedVertexAnimationTextureSizeInverted"),n.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}var Material=class e{resetDrawCache(){const e=this.getScene().meshes;for(const t of e)if(t.subMeshes)for(const e of t.subMeshes)e.getMaterial()===this&&e.resetDrawCache()}static _ParsePlugins(e,t,i,a){if(e.plugins)for(const n in e.plugins){const s=e.plugins[n];let r=t.pluginManager?.getPlugin(s.name);if(!r){const e=Tools.Instantiate("BABYLON."+n);e&&(r=new e(t))}r?.parse(s,i,a)}}toString(e){return"Name: "+this.name}needAlphaTesting(){return!!this._forceAlphaTest}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Observable),this._onBindObservable}get fillMode(){return this._fillMode}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)}get _disableAlphaBlending(){return this._transparencyMode===e.MATERIAL_OPAQUE||this._transparencyMode===e.MATERIAL_ALPHATEST}forceCompilationAsync(e,t){return new Promise(((i,a)=>{this.forceCompilation(e,(()=>{i()}),t,(e=>{a(e)}))}))}bind(e,t){}isReadyForSubMesh(e,t,i){const a=t.materialDefines;return!!a&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}get wireframe(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe}get isPrePassCapable(){return!1}set backFaceCulling(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))}get pointsCloud(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(const t of this.pluginManager._plugins)e.plugins[t.getClassName()]=t.serialize()}releaseVertexArrayObject(e,t){const i=e.geometry;if(i)if(this._storeEffectOnSubMeshes){if(e.subMeshes)for(const a of e.subMeshes)i._releaseVertexArrayObject(a.effect),t&&a.effect&&a.effect.dispose()}else i._releaseVertexArrayObject(this._drawWrapper.effect)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new Observable),this._onUnBindObservable}set transparencyMode(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}dispose(e,t,i){const a=this.getScene();if(a.stopAnimation(this),a.freeProcessedMaterials(),a.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const e=this._parentContainer.materials.indexOf(this);e>-1&&this._parentContainer.materials.splice(e,1),this._parentContainer=null}if(!0!==i)if(this.meshMap)for(const t in this.meshMap){const i=this.meshMap[t];i&&(i.material=null,this.releaseVertexArrayObject(i,e))}else{const t=a.meshes;for(const i of t)i.material!==this||i.zb||(i.material=null,this.releaseVertexArrayObject(i,e))}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}needAlphaBlendingForMesh(e){return e.visibility<1||!this._disableAlphaBlending&&(e.hasVertexAlpha||this.needAlphaBlending())}_clonePlugins(t,i){const a={};if(this._serializePlugins(a),e._ParsePlugins(a,t,this._scene,i),this.pluginManager)for(const e of this.pluginManager._plugins){const i=t.pluginManager.getPlugin(e.name);i&&e.copyTo(i)}}get alphaMode(){return this._alphaMode}clone(e){return null}markAsDirty(t){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),t&e.PrePassDirtyFlag&&e._DirtyCallbackArray.push(e._PrePassDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}setPrePassRenderer(e){return!1}set fogEnabled(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))}bindForSubMesh(e,t,i){const a=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),a._forceRebindOnNextCall=!1}get fogEnabled(){return this._fogEnabled}get backFaceCulling(){return this._backFaceCulling}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.markDirty())}get isFrozen(){return this.checkReadyOnlyOnce}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}bindOnlyWorldMatrix(e){}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new Observable),this._onEffectCreatedObservable}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(e._AllDirtyCallBack)}getAlphaTestTexture(){return null}_afterBind(e,t=null,i){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,BindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){const e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(0!==this.depthFunction){const e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}}get cullBackFaces(){return this._cullBackFaces}_getDrawWrapper(){return this._drawWrapper}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(8,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}isReady(e,t){return!0}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}get canRenderToMRT(){return!1}bindEyePosition(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}constructor(t,i,a){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new Observable,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new MaterialStencilState,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;const n=i||EngineStore.LastCreatedScene;n&&(this._scene=n,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||Tools.RandomId(),this.Hc=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new DrawWrapper(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new UniformBuffer(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,a||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),e.OnEventObservable.notifyObservers(this,1))}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}set cullBackFaces(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.markAsDirty(e.TextureDirtyFlag))}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)}_markAllSubMeshesAsDirty(e){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.getScene().meshes;for(const i of t)if(i.subMeshes)for(const t of i.subMeshes)if(t.getMaterial(!1)===this)for(const i of t._drawWrappers)i&&i.defines&&i.defines.markAllAsDirty&&this._materialContext===i.materialContext&&e(i.defines)}getBindedMeshes(){if(this.meshMap){const e=[];for(const t in this.meshMap){const i=this.meshMap[t];i&&e.push(i)}return e}return this._scene.meshes.filter((e=>e.material===this))}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}markDirty(t=!1){const i=this.getScene().meshes;for(const e of i)if(e.subMeshes)for(const i of e.subMeshes)if(i.getMaterial()===this)for(const e of i._drawWrappers)e&&this._materialContext===e.materialContext&&(e._wasPreviouslyReady=!1,e._wasPreviouslyUsingInstances=null,e._forceRebindOnNextCall=t);t&&this.markAsDirty(e.AllDirtyFlag)}get useLogarithmicDepth(){return this._useLogarithmicDepth}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)}get _isMaterial(){return!0}forceCompilation(e,t,i,a){const n={clipPlane:!1,useInstances:!1,...i},s=this.getScene(),r=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const o=()=>{if(!this._scene||!this._scene.getEngine())return;const i=s.clipPlane;if(n.clipPlane&&(s.clipPlane=new Plane(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,s=null;if(e.subMeshes){const t=new SubMesh(0,0,0,0,0,e,void 0,!1,!1);t.materialDefines&&(t.materialDefines._renderId=-1),this.isReadyForSubMesh(e,t,n.useInstances)||(t.effect&&t.effect.getCompilationError()&&t.effect.allFallbacksProcessed()?s=t.effect.getCompilationError():(i=!1,setTimeout(o,16)))}i&&(this.allowShaderHotSwapping=r,s&&a&&a(s),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=r,t&&t(this)):setTimeout(o,16);n.clipPlane&&(s.clipPlane=i)};o()}_preBind(t,i=null){const a=this._scene.getEngine(),n=(null==i?this.sideOrientation:i)===e.ClockWiseSideOrientation;return a.enableEffect(t||this._getDrawWrapper()),a.setState(this.backFaceCulling,this.zOffset,!1,n,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),n}get blockDirtyMechanism(){return this._blockDirtyMechanism}static Parse(e,t,i){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return Logger.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";const a=Tools.Instantiate(e.customType).Parse(e,t,i);return a._loadedUniqueId=e.Hc,a}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)}get shaderLanguage(){return this._shaderLanguage}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}_getEffectiveOrientation(e){return null!==this.sideOrientation?this.sideOrientation:e.sideOrientation}_shouldTurnAlphaTestOn(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)}get alpha(){return this._alpha}set alpha(t){if(this._alpha===t)return;const i=this._alpha;this._alpha=t,1!==i&&1!==t||this.markAsDirty(e.MiscDirtyFlag+e.PrePassDirtyFlag)}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}serialize(){const e=SerializationHelper.Serialize(this);return e.stencil=this.stencil.serialize(),e.Hc=this.Hc,this._serializePlugins(e),e}getEffect(){return this._drawWrapper.effect}set useLogarithmicDepth(e){const t=this.getScene().getEngine().getCaps().fragmentDepthSupported;e&&!t&&Logger.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._markAllSubMeshesAsMiscDirty()}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}_setDrawWrapper(e){this._drawWrapper=e}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get needDepthPrePass(){return this._needDepthPrePass}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.onDisposeObservable.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)}))}}set wireframe(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode}getClassName(){return"Material"}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)}set alphaMode(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))}getScene(){return this._scene}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}get transparencyMode(){return this._transparencyMode}set fillMode(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)}set pointsCloud(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode}};Material.TriangleFillMode=0,Material.WireFrameFillMode=1,Material.PointFillMode=2,Material.PointListDrawMode=3,Material.LineListDrawMode=4,Material.LineLoopDrawMode=5,Material.LineStripDrawMode=6,Material.TriangleStripDrawMode=7,Material.TriangleFanDrawMode=8,Material.ClockWiseSideOrientation=0,Material.CounterClockWiseSideOrientation=1,Material.TextureDirtyFlag=1,Material.LightDirtyFlag=2,Material.FresnelDirtyFlag=4,Material.AttributesDirtyFlag=8,Material.MiscDirtyFlag=16,Material.PrePassDirtyFlag=32,Material.AllDirtyFlag=63,Material.MATERIAL_OPAQUE=0,Material.MATERIAL_ALPHATEST=1,Material.MATERIAL_ALPHABLEND=2,Material.MATERIAL_ALPHATESTANDBLEND=3,Material.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,Material.MATERIAL_NORMALBLENDMETHOD_RNM=1,Material.OnEventObservable=new Observable,Material._AllDirtyCallBack=e=>e.markAllAsDirty(),Material._ImageProcessingDirtyCallBack=e=>e.markAsImageProcessingDirty(),Material._TextureDirtyCallBack=e=>e.markAsTexturesDirty(),Material._FresnelDirtyCallBack=e=>e.markAsFresnelDirty(),Material._MiscDirtyCallBack=e=>e.markAsMiscDirty(),Material._PrePassDirtyCallBack=e=>e.markAsPrePassDirty(),Material._LightsDirtyCallBack=e=>e.markAsLightDirty(),Material._AttributeDirtyCallBack=e=>e.markAsAttributesDirty(),Material._FresnelAndMiscDirtyCallBack=e=>{Material._FresnelDirtyCallBack(e),Material._MiscDirtyCallBack(e)},Material._TextureAndMiscDirtyCallBack=e=>{Material._TextureDirtyCallBack(e),Material._MiscDirtyCallBack(e)},Material._DirtyCallbackArray=[],Material._RunDirtyCallBacks=e=>{for(const t of Material._DirtyCallbackArray)t(e)},__decorate([serialize()],Material.prototype,"id",void 0),__decorate([serialize()],Material.prototype,"uniqueId",void 0),__decorate([serialize()],Material.prototype,"name",void 0),__decorate([serialize()],Material.prototype,"metadata",void 0),__decorate([serialize()],Material.prototype,"checkReadyOnEveryCall",void 0),__decorate([serialize()],Material.prototype,"checkReadyOnlyOnce",void 0),__decorate([serialize()],Material.prototype,"state",void 0),__decorate([serialize("alpha")],Material.prototype,"_alpha",void 0),__decorate([serialize("backFaceCulling")],Material.prototype,"_backFaceCulling",void 0),__decorate([serialize("cullBackFaces")],Material.prototype,"_cullBackFaces",void 0),__decorate([serialize()],Material.prototype,"sideOrientation",void 0),__decorate([serialize("alphaMode")],Material.prototype,"_alphaMode",void 0),__decorate([serialize()],Material.prototype,"_needDepthPrePass",void 0),__decorate([serialize()],Material.prototype,"disableDepthWrite",void 0),__decorate([serialize()],Material.prototype,"disableColorWrite",void 0),__decorate([serialize()],Material.prototype,"forceDepthWrite",void 0),__decorate([serialize()],Material.prototype,"depthFunction",void 0),__decorate([serialize()],Material.prototype,"separateCullingPass",void 0),__decorate([serialize("fogEnabled")],Material.prototype,"_fogEnabled",void 0),__decorate([serialize()],Material.prototype,"pointSize",void 0),__decorate([serialize()],Material.prototype,"zOffset",void 0),__decorate([serialize()],Material.prototype,"zOffsetUnits",void 0),__decorate([serialize()],Material.prototype,"pointsCloud",null),__decorate([serialize()],Material.prototype,"fillMode",null),__decorate([serialize()],Material.prototype,"useLogarithmicDepth",null),__decorate([serialize()],Material.prototype,"transparencyMode",null);var MultiMaterial=class e extends Material{dispose(e,t,i){const a=this.getScene();if(!a)return;if(i)for(let i=0;i<this.subMaterials.length;i++){const a=this.subMaterials[i];a&&a.dispose(e,t)}const n=a.multiMaterials.indexOf(this);n>=0&&a.multiMaterials.splice(n,1),super.dispose(e,t)}set subMaterials(e){this._subMaterials=e,this._hookArray(e)}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map((e=>e?e.getActiveTextures():[])))}get subMaterials(){return this._subMaterials}hasTexture(e){if(super.hasTexture(e))return!0;for(let t=0;t<this.subMaterials.length;t++)if(this.subMaterials[t]?.hasTexture(e))return!0;return!1}clone(t,i){const a=new e(t,this.getScene());for(let e=0;e<this.subMaterials.length;e++){let n=null;const s=this.subMaterials[e];n=i&&s?s.clone(t+"-"+s.name):this.subMaterials[e],a.subMaterials.push(n)}return a}getSubMaterial(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}static ParseMultiMaterial(t,i){const a=new e(t.name,i);return a.id=t.id,a._loadedUniqueId=t.Hc,Tags&&Tags.AddTagsTo(a,t.tags),t.materialsUniqueIds?a._waitingSubMaterialsUniqueIds=t.materialsUniqueIds:t.materials.forEach((e=>a.subMaterials.push(i.getLastMaterialById(e)))),a}_hookArray(e){const t=e.push;e.push=(...i)=>{const a=t.apply(e,i);return this._markAllSubMeshesAsTexturesDirty(),a};const i=e.splice;e.splice=(t,a)=>{const n=i.apply(e,[t,a]);return this._markAllSubMeshesAsTexturesDirty(),n}}constructor(e,t){super(e,t,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}getChildren(){return this.subMaterials}getClassName(){return"MultiMaterial"}serialize(){const e={};e.name=this.name,e.id=this.id,e.Hc=this.Hc,Tags&&(e.tags=Tags.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(let t=0;t<this.subMaterials.length;t++){const i=this.subMaterials[t];i?(e.materialsUniqueIds.push(i.Hc),e.materials.push(i.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}isReadyForSubMesh(e,t,i){for(let a=0;a<this.subMaterials.length;a++){const n=this.subMaterials[a];if(n){if(n._storeEffectOnSubMeshes){if(!n.isReadyForSubMesh(e,t,i))return!1;continue}if(!n.isReady(e))return!1}}return!0}};RegisterClass("BABYLON.MultiMaterial",MultiMaterial);var SceneComponentConstants=class{};SceneComponentConstants.NAME_EFFECTLAYER="EffectLayer",SceneComponentConstants.NAME_LAYER="Layer",SceneComponentConstants.NAME_LENSFLARESYSTEM="LensFlareSystem",SceneComponentConstants.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",SceneComponentConstants.NAME_PARTICLESYSTEM="ParticleSystem",SceneComponentConstants.NAME_GAMEPAD="Gamepad",SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",SceneComponentConstants.NAME_PREPASSRENDERER="PrePassRenderer",SceneComponentConstants.NAME_DEPTHRENDERER="DepthRenderer",SceneComponentConstants.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",SceneComponentConstants.NAME_SPRITE="Sprite",SceneComponentConstants.NAME_SUBSURFACE="SubSurface",SceneComponentConstants.NAME_OUTLINERENDERER="Outline",SceneComponentConstants.NAME_PROCEDURALTEXTURE="ProceduralTexture",SceneComponentConstants.NAME_SHADOWGENERATOR="ShadowGenerator",SceneComponentConstants.NAME_OCTREE="Octree",SceneComponentConstants.NAME_PHYSICSENGINE="PhysicsEngine",SceneComponentConstants.NAME_AUDIO="Audio",SceneComponentConstants.NAME_FLUIDRENDERER="FluidRenderer",SceneComponentConstants.STEP_ISREADYFORMESH_EFFECTLAYER=0,SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,SceneComponentConstants.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,SceneComponentConstants.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,SceneComponentConstants.STEP_BEFORECAMERADRAW_PREPASS=0,SceneComponentConstants.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,SceneComponentConstants.STEP_BEFORECAMERADRAW_LAYER=2,SceneComponentConstants.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,SceneComponentConstants.STEP_BEFORERENDERTARGETDRAW_LAYER=1,SceneComponentConstants.STEP_BEFORERENDERINGMESH_PREPASS=0,SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE=1,SceneComponentConstants.STEP_AFTERRENDERINGMESH_PREPASS=0,SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE=1,SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,SceneComponentConstants.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,SceneComponentConstants.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,SceneComponentConstants.STEP_BEFORECLEAR_PREPASS=1,SceneComponentConstants.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,SceneComponentConstants.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,SceneComponentConstants.STEP_AFTERRENDERTARGETDRAW_LAYER=1,SceneComponentConstants.STEP_AFTERCAMERADRAW_PREPASS=0,SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,SceneComponentConstants.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,SceneComponentConstants.STEP_AFTERCAMERADRAW_LAYER=4,SceneComponentConstants.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,SceneComponentConstants.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,SceneComponentConstants.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,SceneComponentConstants.STEP_AFTERRENDER_AUDIO=0,SceneComponentConstants.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,SceneComponentConstants.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,SceneComponentConstants.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,SceneComponentConstants.STEP_POINTERMOVE_SPRITE=0,SceneComponentConstants.STEP_POINTERDOWN_SPRITE=0,SceneComponentConstants.STEP_POINTERUP_SPRITE=0;var Stage=class e extends Array{static Create(){return Object.create(e.prototype)}clear(){this.length=0}constructor(e){super(...e)}registerStep(e,t,i){let a=0,n=Number.MAX_VALUE;for(;a<this.length;a++){if(n=this[a].index,e<n)break}this.splice(a,0,{index:e,component:t,action:i.bind(t)})}},MeshLODLevel=class{constructor(e,t){this.distanceOrScreenCoverage=e,this.mesh=t}},_CreationDataStorage=class{},_InstanceDataStorage=class{constructor(){this.visibleInstances={},this.batchCache=new _InstancesBatch,this.batchCacheReplacementModeInFrozenMode=new _InstancesBatch,this.instancesBufferSize=2048}},_InstancesBatch=class{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}},_ThinInstanceDataStorage=class{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}},_InternalMeshDataInfo=class{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}},Mesh=class e extends AbstractMesh{_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}_invalidateInstanceVertexArrayObject(){}static CreateIcoSphere(e,t,i){throw new Error("Import MeshBuilder to populate this function")}_renderWithThinInstances(e,t,i,a){const n=this._thinInstanceDataStorage?.instancesCount??0;this.getScene()._activeIndices.addCount(e.indexCount*n,!1),a._currentDrawContext&&(a._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,n),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,n):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),a.unbindInstanceAttributes()}static CreateHemisphere(e,t,i,a){throw new Error("Import MeshBuilder to populate this function")}set sideOrientation(e){this._internalMeshDataInfo._sideOrientation=e,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===e||!this._scene.useRightHandedSystem&&0===e}get source(){return this._internalMeshDataInfo._source}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}registerAfterRender(e){return this.onAfterRenderObservable.add(e),this}_createGlobalSubMesh(e){const t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const i=this.getIndices();if(!i)return null;const a=i.length;let n=!1;if(e)n=!0;else for(const e of this.subMeshes){if(e.indexStart+e.indexCount>a){n=!0;break}if(e.verticesStart+e.verticesCount>t){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new SubMesh(0,0,t,0,this.getTotalIndices(),this)}_getInstancesRenderList(e,t=!1){if(this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const i=this.getScene(),a=i._isInIntermediateRendering(),n=a?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,s=this._instanceDataStorage.batchCache;if(s.mustReturn=!1,s.renderSelf[e]=t||!n&&this.isEnabled()&&this.isVisible,s.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){const t=this._instanceDataStorage.visibleInstances,n=i.getRenderId(),r=a?t.intermediateDefaultRenderId:t.defaultRenderId;s.visibleInstances[e]=t[n],!s.visibleInstances[e]&&r&&(s.visibleInstances[e]=t[r])}return s.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==s.visibleInstances[e]&&void 0!==s.visibleInstances[e],this._instanceDataStorage.previousBatch=s,s}updateIndices(e,t,i=!1){return this._geometry?(this._geometry.updateIndices(e,t,i),this):this}_checkDelayState(){const e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new Observable),this._internalMeshDataInfo._onBetweenPassObservable}unregisterAfterRender(e){return this.onAfterRenderObservable.removeCallback(e),this}setIndices(e,t=null,i=!1){if(this._geometry)this._geometry.setIndices(e,t,i);else{const t=new VertexData;t.indices=e;const a=this.getScene();new Geometry(Geometry.RandomId(),a,t,i,this)}return this}static _instancedMeshFactory(e,t){throw _WarnImport("InstancedMesh")}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return Logger.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(e.isUsingTextureForTargets)return;for(let t=0;t<e.numInfluencers;t++){const i=e.getActiveTarget(t),a=i.getPositions();if(!a)return void Logger.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(VertexBuffer.PositionKind+t,a,!1,3);const n=i.getNormals();n&&this.geometry.setVerticesData(VertexBuffer.NormalKind+t,n,!1,3);const s=i.getTangents();s&&this.geometry.setVerticesData(VertexBuffer.TangentKind+t,s,!1,3);const r=i.getUVs();r&&this.geometry.setVerticesData(VertexBuffer.UVKind+"_"+t,r,!1,2)}}else{let e=0;for(;this.geometry.isVerticesDataPresent(VertexBuffer.PositionKind+e);)this.geometry.removeVerticesData(VertexBuffer.PositionKind+e),this.geometry.isVerticesDataPresent(VertexBuffer.NormalKind+e)&&this.geometry.removeVerticesData(VertexBuffer.NormalKind+e),this.geometry.isVerticesDataPresent(VertexBuffer.TangentKind+e)&&this.geometry.removeVerticesData(VertexBuffer.TangentKind+e),this.geometry.isVerticesDataPresent(VertexBuffer.UVKind+e)&&this.geometry.removeVerticesData(VertexBuffer.UVKind+"_"+e),e++}}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}set overrideRenderingFillMode(e){this._internalMeshDataInfo._overrideRenderingFillMode=e}toString(e){let t=super.toString(e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){const e=this.getIndices(),i=this.getVerticesData(VertexBuffer.PositionKind);i&&e&&(t+=", flat shading: "+(i.length/3===e.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}unregisterBeforeRender(e){return this.onBeforeRenderObservable.removeCallback(e),this}_freeze(){if(this.subMeshes){for(let e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}set forcedInstanceCount(e){this._internalMeshDataInfo._forcedInstanceCount=e}renderWithRenderPassId(e,t,i,a,n=!0){const s=this._scene.getEngine(),r=s.currentRenderPassId;if(void 0!==e&&(s.currentRenderPassId=e),a)(!n||n&&a.isInFrustum(this._scene._frustumPlanes))&&this.render(a,!!t,i);else for(let e=0;e<this.subMeshes.length;e++){const a=this.subMeshes[e];(!n||n&&a.isInFrustum(this._scene._frustumPlanes))&&this.render(a,!!t,i)}return void 0!==e&&(s.currentRenderPassId=r),this}static MergeMeshesAsync(t,i=!0,a,n,s,r){return runCoroutineAsync(e._MergeMeshesCoroutine(t,i,a,n,s,r,!0),createYieldingScheduler())}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}_processInstancedBuffers(e,t){}clone(t="",i=null,a,n=!0){return new e(t,this.getScene(),i,this,a,n)}setMaterialById(e){const t=this.getScene().materials;let i;for(i=t.length-1;i>-1;i--)if(t[i].id===e)return this.material=t[i],this;const a=this.getScene().multiMaterials;for(i=a.length-1;i>-1;i--)if(a[i].id===e)return this.material=a[i],this;return this}applySkeleton(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind))return this;const t=this.isVerticesDataPresent(VertexBuffer.NormalKind),i=this._internalMeshDataInfo;if(!i._sourcePositions){const e=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=e}t&&!i._sourceNormals&&this.setNormalsForCPUSkinning();let a=this.getVerticesData(VertexBuffer.PositionKind);if(!a)return this;a instanceof Float32Array||(a=new Float32Array(a));let n=this.getVerticesData(VertexBuffer.NormalKind);if(t){if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n))}const s=this.getVerticesData(VertexBuffer.MatricesIndicesKind),r=this.getVerticesData(VertexBuffer.MatricesWeightsKind);if(!r||!s)return this;const o=this.numBoneInfluencers>4,l=o?this.getVerticesData(VertexBuffer.MatricesIndicesExtraKind):null,c=o?this.getVerticesData(VertexBuffer.MatricesWeightsExtraKind):null,h=e.getTransformMatrices(this),u=Vector3.Zero(),m=new Matrix,d=new Matrix;let f,p=0;for(let e=0;e<a.length;e+=3,p+=4){let _;for(f=0;f<4;f++)_=r[p+f],_>0&&(Matrix.FromFloat32ArrayToRefScaled(h,Math.floor(16*s[p+f]),_,d),m.addToSelf(d));if(o)for(f=0;f<4;f++)_=c[p+f],_>0&&(Matrix.FromFloat32ArrayToRefScaled(h,Math.floor(16*l[p+f]),_,d),m.addToSelf(d));Vector3.TransformCoordinatesFromFloatsToRef(i._sourcePositions[e],i._sourcePositions[e+1],i._sourcePositions[e+2],m,u),u.toArray(a,e),t&&(Vector3.TransformNormalFromFloatsToRef(i._sourceNormals[e],i._sourceNormals[e+1],i._sourceNormals[e+2],m,u),u.toArray(n,e)),m.reset()}return this.updateVerticesData(VertexBuffer.PositionKind,a),t&&this.updateVerticesData(VertexBuffer.NormalKind,n),this}getVerticesData(e,t,i,a){if(!this._geometry)return null;let n=a?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e]?.getFloatData(this.instances.length+1,i||t&&1!==this._geometry.meshes.length);return n||(n=this._geometry.getVerticesData(e,t,i)),n}applyDisplacementMap(e,t,i,a,n,s,r=!1,o){const l=this.getScene();return Tools.LoadImage(e,(e=>{const o=e.width,l=e.height,c=this.getEngine().createCanvas(o,l).getContext("2d");c.drawImage(e,0,0);const h=c.getImageData(0,0,o,l).data;this.applyDisplacementMapFromBuffer(h,o,l,t,i,n,s,r),a&&a(this)}),o||(()=>{}),l.offlineProvider),this}static nc(e,t,i,a,n,s){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(e,t,i,a,n,s,r){throw new Error("Import MeshBuilder to populate this function")}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const e=this._geometry,t=this._geometry.copy(Geometry.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this}static Tc(e,t,i,a,n,s,r,o,l){throw new Error("Import MeshBuilder to populate this function")}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}removeLODLevel(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this}static MinMax(e){let t=null,i=null;return e.forEach((function(e){const a=e.getBoundingInfo().boundingBox;t&&i?(t.minimizeInPlace(a.minimumWorld),i.maximizeInPlace(a.maximumWorld)):(t=a.minimumWorld,i=a.maximumWorld)})),t&&i?{min:t,max:i}:{min:Vector3.Zero(),max:Vector3.Zero()}}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const a=this.getScene().getEngine();return this._unIndexed||t==Material.PointFillMode?a.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||i):t==Material.WireFrameFillMode?a.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||i):a.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i),this}set isUnIndexed(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())}static vc(e,t,i,a,n,s){throw new Error("Import MeshBuilder to populate this function")}static Parse(t,i,a){let n;if(n=t.type&&"LinesMesh"===t.type?e._LinesMeshParser(t,i):t.type&&"GroundMesh"===t.type?e._GroundMeshParser(t,i):t.type&&"GoldbergMesh"===t.type?e._GoldbergMeshParser(t,i):t.type&&"GreasedLineMesh"===t.type?e._GreasedLineMeshParser(t,i):t.type&&"TrailMesh"===t.type?e._TrailMeshParser(t,i):new e(t.name,i),n.id=t.id,n._waitingParsedUniqueId=t.Hc,Tags&&Tags.AddTagsTo(n,t.tags),n.position=Vector3.FromArray(t.position),void 0!==t.metadata&&(n.metadata=t.metadata),t.rotationQuaternion?n.rotationQuaternion=Quaternion.FromArray(t.rotationQuaternion):t.rotation&&(n.rotation=Vector3.FromArray(t.rotation)),n.scaling=Vector3.FromArray(t.scaling),t.localMatrix?n.setPreTransformMatrix(Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&n.setPivotMatrix(Matrix.FromArray(t.pivotMatrix)),n.setEnabled(t.isEnabled),n.isVisible=t.isVisible,n.infiniteDistance=t.infiniteDistance,n.alwaysSelectAsActiveMesh=!!t.alwaysSelectAsActiveMesh,n.showBoundingBox=t.showBoundingBox,n.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(n.applyFog=t.applyFog),void 0!==t.pickable&&(n.isPickable=t.pickable),void 0!==t.alphaIndex&&(n.alphaIndex=t.alphaIndex),n.receiveShadows=t.receiveShadows,void 0!==t.billboardMode&&(n.billboardMode=t.billboardMode),void 0!==t.visibility&&(n.visibility=t.visibility),n.checkCollisions=t.checkCollisions,n.doNotSyncBoundingInfo=!!t.doNotSyncBoundingInfo,t.ellipsoid&&(n.ellipsoid=Vector3.FromArray(t.ellipsoid)),t.ellipsoidOffset&&(n.ellipsoidOffset=Vector3.FromArray(t.ellipsoidOffset)),null!=t.overrideMaterialSideOrientation&&(n.sideOrientation=t.overrideMaterialSideOrientation),void 0!==t.sideOrientation&&(n.sideOrientation=t.sideOrientation),void 0!==t.isBlocker&&(n.isBlocker=t.isBlocker),n._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(n._waitingData.freezeWorldMatrix=t.freezeWorldMatrix),void 0!==t.parentId&&(n._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(n._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.actions&&(n._waitingData.actions=t.actions),void 0!==t.overlayAlpha&&(n.overlayAlpha=t.overlayAlpha),void 0!==t.overlayColor&&(n.overlayColor=Color3.FromArray(t.overlayColor)),void 0!==t.renderOverlay&&(n.renderOverlay=t.renderOverlay),n.isUnIndexed=!!t.isUnIndexed,n.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=a+t.delayLoadingFile,n.buildBoundingInfo(Vector3.FromArray(t.boundingBoxMinimum),Vector3.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(n._binaryInfo=t._binaryInfo),n._delayInfo=[],t.hasUVs&&n._delayInfo.push(VertexBuffer.UVKind),t.hasUVs2&&n._delayInfo.push(VertexBuffer.UV2Kind),t.hasUVs3&&n._delayInfo.push(VertexBuffer.UV3Kind),t.hasUVs4&&n._delayInfo.push(VertexBuffer.UV4Kind),t.hasUVs5&&n._delayInfo.push(VertexBuffer.UV5Kind),t.hasUVs6&&n._delayInfo.push(VertexBuffer.UV6Kind),t.hasColors&&n._delayInfo.push(VertexBuffer.ColorKind),t.hasMatricesIndices&&n._delayInfo.push(VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&n._delayInfo.push(VertexBuffer.MatricesWeightsKind),n._delayLoadingFunction=Geometry._ImportGeometry,SceneLoaderFlags.ForceFullSceneLoadingForIncremental&&n._checkDelayState()):Geometry._ImportGeometry(t,n),t.materialUniqueId?n._waitingMaterialId=t.materialUniqueId:t.materialId&&(n._waitingMaterialId=t.materialId),t.morphTargetManagerId>-1&&(n.morphTargetManager=i.getMorphTargetManagerById(t.morphTargetManagerId)),void 0!==t.skeletonId&&null!==t.skeletonId&&(n.skeleton=i.getLastSkeletonById(t.skeletonId),t.numBoneInfluencers&&(n.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],a=GetClass("BABYLON.Animation");a&&n.animations.push(a.Parse(i))}Node.ParseAnimationRanges(n,t,i)}if(t.autoAnimate&&i.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?n.layerMask=Math.abs(parseInt(t.layerMask)):n.layerMask=268435455,t.physicsImpostor&&(n.physicsImpostor=e._PhysicsImpostorParser(i,n,t)),t.lodMeshIds&&(n._waitingData.lods={ids:t.lodMeshIds,distances:t.lodDistances?t.lodDistances:null,coverages:t.lodCoverages?t.lodCoverages:null}),t.instances)for(let a=0;a<t.instances.length;a++){const s=t.instances[a],r=n.createInstance(s.name);if(s.id&&(r.id=s.id),Tags&&(s.tags?Tags.AddTagsTo(r,s.tags):Tags.AddTagsTo(r,t.tags)),r.position=Vector3.FromArray(s.position),void 0!==s.metadata&&(r.metadata=s.metadata),void 0!==s.parentId&&(r._waitingParentId=s.parentId),void 0!==s.parentInstanceIndex&&(r._waitingParentInstanceIndex=s.parentInstanceIndex),void 0!==s.isEnabled&&null!==s.isEnabled&&r.setEnabled(s.isEnabled),void 0!==s.isVisible&&null!==s.isVisible&&(r.isVisible=s.isVisible),void 0!==s.isPickable&&null!==s.isPickable&&(r.isPickable=s.isPickable),s.rotationQuaternion?r.rotationQuaternion=Quaternion.FromArray(s.rotationQuaternion):s.rotation&&(r.rotation=Vector3.FromArray(s.rotation)),r.scaling=Vector3.FromArray(s.scaling),null!=s.checkCollisions&&null!=s.checkCollisions&&(r.checkCollisions=s.checkCollisions),null!=s.pickable&&null!=s.pickable&&(r.isPickable=s.pickable),null!=s.showBoundingBox&&null!=s.showBoundingBox&&(r.showBoundingBox=s.showBoundingBox),null!=s.showSubMeshesBoundingBox&&null!=s.showSubMeshesBoundingBox&&(r.showSubMeshesBoundingBox=s.showSubMeshesBoundingBox),null!=s.alphaIndex&&null!=s.showSubMeshesBoundingBox&&(r.alphaIndex=s.alphaIndex),s.physicsImpostor&&(r.physicsImpostor=e._PhysicsImpostorParser(i,r,s)),void 0!==s.actions&&(r._waitingData.actions=s.actions),s.animations){for(let e=0;e<s.animations.length;e++){const t=s.animations[e],i=GetClass("BABYLON.Animation");i&&r.animations.push(i.Parse(t))}Node.ParseAnimationRanges(r,s,i),s.autoAnimate&&i.beginAnimation(r,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1)}}if(t.thinInstances){const e=t.thinInstances;if(n.thinInstanceEnablePicking=!!e.enablePicking,e.matrixData?(n.thinInstanceSetBuffer("matrix",new Float32Array(e.matrixData),16,!1),n._thinInstanceDataStorage.matrixBufferSize=e.matrixBufferSize,n._thinInstanceDataStorage.instancesCount=e.instancesCount):n._thinInstanceDataStorage.matrixBufferSize=e.matrixBufferSize,t.thinInstances.userThinInstance){const e=t.thinInstances.userThinInstance;for(const t in e.data)n.thinInstanceSetBuffer(t,new Float32Array(e.data[t]),e.strides[t],!1),n._userThinInstanceBuffersStorage.sizes[t]=e.sizes[t]}}return n}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_disposeThinInstanceSpecificData(){}_bind(e,t,i,a=!0){if(!this._geometry)return this;const n=this.getScene().getEngine();let s;if(this._unIndexed)s=null;else switch(this._getRenderingFillMode(i)){case Material.PointFillMode:s=null;break;case Material.WireFrameFillMode:s=e._getLinesIndexBuffer(this.getIndices(),n);break;default:case Material.TriangleFillMode:s=this._geometry.getIndexBuffer()}return this._bindDirect(t,s,a)}static CreateCapsule(e,t,i){throw new Error("Import MeshBuilder to populate this function")}_sortLODLevels(){const e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((t,i)=>t.distanceOrScreenCoverage<i.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>i.distanceOrScreenCoverage?-e:0))}createInstance(t){return e._instancedMeshFactory(t,this)}isVerticesDataPresent(e,t){return this._geometry?!t&&void 0!==this._userInstancedBuffersStorage?.vertexBuffers[e]||this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}flipFaces(e=!1){const t=VertexData.ExtractFromMesh(this);let i;if(e&&this.isVerticesDataPresent(VertexBuffer.NormalKind)&&t.normals)for(i=0;i<t.normals.length;i++)t.normals[i]*=-1;if(t.indices){let e;for(i=0;i<t.indices.length;i+=3)e=t.indices[i+1],t.indices[i+1]=t.indices[i+2],t.indices[i+2]=e}return t.applyToMesh(this,this.isVertexBufferUpdatable(VertexBuffer.PositionKind)),this}removeInstance(e){const t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){const e=this.instances[this.instances.length-1];this.instances[t]=e,e._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set manualUpdateOfWorldMatrixInstancedBuffer(e){this._instanceDataStorage.manualUpdate=e}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}_registerInstanceForRenderId(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this}isInFrustum(e){return 2!==this.delayLoadState&&(!!super.isInFrustum(e)&&(this._checkDelayState(),!0))}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new Observable),this._internalMeshDataInfo._onBeforeDrawObservable}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(e){this._instanceDataStorage.previousManualUpdate=e}static CreateTorus(e,t,i,a,n,s,r){throw new Error("Import MeshBuilder to populate this function")}getVertexBuffer(e,t){return this._geometry?(t?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e])??this._geometry.getVertexBuffer(e):null}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}static Mc(e,t,i,a,n){throw new Error("Import MeshBuilder to populate this function")}getLOD(e,t){const i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;const a=t||this.getBoundingInfo().boundingSphere,n=e.mode===Camera.ORTHOGRAPHIC_CAMERA?e.minZ:a.centerWorld.subtract(e.globalPosition).length();let s=n,r=1;if(i._useLODScreenCoverage){const t=e.screenArea;let i=a.radiusWorld*e.minZ/n;i=i*i*Math.PI,s=i/t,r=-1}if(r*i._LODLevels[i._LODLevels.length-1].distanceOrScreenCoverage>r*s)return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this;for(let e=0;e<i._LODLevels.length;e++){const t=i._LODLevels[e];if(r*t.distanceOrScreenCoverage<r*s){if(t.mesh){if(4===t.mesh.delayLoadState)return t.mesh._checkDelayState(),this;if(2===t.mesh.delayLoadState)return this;t.mesh._preActivate(),t.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,t.mesh),t.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this}_renderWithInstances(t,i,a,n,s){const r=a.visibleInstances[t._id],o=r?r.length:0,l=this._instanceDataStorage,c=l.instancesBufferSize;let h=l.instancesBuffer,u=l.instancesPreviousBuffer;const m=16*(o+1)*4;for(;l.instancesBufferSize<m;)l.instancesBufferSize*=2;l.instancesData&&c==l.instancesBufferSize||(l.instancesData=new Float32Array(l.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousData||c!=l.instancesBufferSize)&&(l.instancesPreviousData=new Float32Array(l.instancesBufferSize/4));let d=0,f=0;const p=a.renderSelf[t._id],_=!h||c!==l.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||l.isFrozen&&!_)f=(p?1:0)+o;else{const i=this.getWorldMatrix();if(p&&(this._scene.needsPreviousWorldMatrices&&(l.masterMeshPreviousWorldMatrix?(l.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,d),l.masterMeshPreviousWorldMatrix.copyFrom(i)):(l.masterMeshPreviousWorldMatrix=i.clone(),l.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,d))),i.copyToArray(l.instancesData,d),d+=16,f++),r){if(e.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&t.getMaterial()?.needAlphaBlendingForMesh(t.getRenderingMesh())){const e=this._scene.activeCamera.globalPosition;for(let t=0;t<r.length;t++){const i=r[t];i._distanceToCamera=Vector3.Distance(i.getBoundingInfo().boundingSphere.centerWorld,e)}r.sort(((e,t)=>e._distanceToCamera>t._distanceToCamera?-1:e._distanceToCamera<t._distanceToCamera?1:0))}for(let e=0;e<r.length;e++){const t=r[e],i=t.getWorldMatrix();i.copyToArray(l.instancesData,d),this._scene.needsPreviousWorldMatrices&&(t._previousWorldMatrix?(t._previousWorldMatrix.copyToArray(l.instancesPreviousData,d),t._previousWorldMatrix.copyFrom(i)):(t._previousWorldMatrix=i.clone(),t._previousWorldMatrix.copyToArray(l.instancesPreviousData,d))),d+=16,f++}}}return _?(h&&h.dispose(),u&&u.dispose(),h=new Buffer2(s,l.instancesData,!0,16,!1,!0),l.instancesBuffer=h,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=h.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=h.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=h.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=h.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(u=new Buffer2(s,l.instancesPreviousData,!0,16,!1,!0),l.instancesPreviousBuffer=u,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=u.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=u.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=u.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=u.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(h.updateDirectly(l.instancesData,0,f),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||u.updateDirectly(l.instancesPreviousData,0,f)),this._processInstancedBuffers(r,p),this.getScene()._activeIndices.addCount(t.indexCount*f,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(t,n,i),this._draw(t,i,f),!this._scene.needsPreviousWorldMatrices||_||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||u.updateDirectly(l.instancesData,0,f),s.unbindInstanceAttributes(),this}set overrideMaterialSideOrientation(e){this.sideOrientation=e,this.material&&(this.material.sideOrientation=null)}_convertToUnIndexedMesh(e=!1){const t=this.getVerticesDataKinds(),i=this.getIndices(),a={},n=(e,t)=>{const a=new Float32Array(i.length*t);let n=0;for(let s=0;s<i.length;s++)for(let r=0;r<t;r++)a[n++]=e[i[s]*t+r];return a},s=this.getBoundingInfo(),r=this.geometry?this.subMeshes.slice(0):[];for(const e of t)a[e]=this.getVerticesData(e);for(const s of t){const t=this.getVertexBuffer(s),r=t.getSize();if(e&&s===VertexBuffer.NormalKind){const e=this._getFlattenedNormals(i,a[VertexBuffer.PositionKind]);this.setVerticesData(VertexBuffer.NormalKind,e,t.isUpdatable(),r)}else this.setVerticesData(s,n(a[s],r),t.isUpdatable(),r)}if(this.morphTargetManager){for(let t=0;t<this.morphTargetManager.numTargets;t++){const a=this.morphTargetManager.getTarget(t),s=a.getPositions();a.setPositions(n(s,3));const r=a.getNormals();r&&a.setNormals(e?this._getFlattenedNormals(i,s):n(r,3));const o=a.getTangents();o&&a.setTangents(n(o,3));const l=a.getUVs();l&&a.setUVs(n(l,2))}this.morphTargetManager.synchronize()}for(let e=0;e<i.length;e++)i[e]=e;this.setIndices(i),this._unIndexed=!0,this.releaseSubMeshes();for(const e of r){const t=e.getBoundingInfo();SubMesh.AddToMesh(e.materialIndex,e.indexStart,e.indexCount,e.indexStart,e.indexCount,this).setBoundingInfo(t)}return this.setBoundingInfo(s),this.synchronizeInstances(),this}static Center(t){const i=t instanceof Array?e.MinMax(t):t;return Vector3.Center(i.min,i.max)}bakeCurrentTransformIntoVertices(e=!0){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this}registerBeforeRender(e){return this.onBeforeRenderObservable.add(e),this}updateMeshPositions(e,t=!0){const i=this.getVerticesData(VertexBuffer.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(VertexBuffer.PositionKind,i,!1,!1),t){const e=this.getIndices(),t=this.getVerticesData(VertexBuffer.NormalKind);if(!t)return this;VertexData.ComputeNormals(i,e,t),this.updateVerticesData(VertexBuffer.NormalKind,t,!1,!1)}return this}synchronizeInstances(){for(let e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this}static _PhysicsImpostorParser(e,t,i){throw _WarnImport("PhysicsImpostor")}isVertexBufferUpdatable(e,t){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(e);if(!t){const t=this._userInstancedBuffersStorage?.vertexBuffers[e];if(t)return t.isUpdatable()}return this._geometry.isVertexBufferUpdatable(e)}validateSkinning(){const e=this.getVerticesData(VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(VertexBuffer.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};const i=t.length;let a=0,n=0,s=0,r=0;const o=null===e?4:8,l=[];for(let e=0;e<=o;e++)l[e]=0;for(let c=0;c<i;c+=4){let i=t[c],h=i,u=0===h?0:1;for(let n=1;n<o;n++){const s=n<4?t[c+n]:e[c+n-4];s>i&&a++,0!==s&&u++,h+=s,i=s}if(l[u]++,u>s&&(s=u),0===h)n++;else{const i=1/h;let a=0;for(let n=0;n<o;n++)a+=n<4?Math.abs(t[c+n]-t[c+n]*i):Math.abs(e[c+n-4]-e[c+n-4]*i);a>.001&&r++}}const c=this.skeleton.bones.length,h=this.getVerticesData(VertexBuffer.MatricesIndicesKind),u=this.getVerticesData(VertexBuffer.MatricesIndicesExtraKind);let m=0;for(let e=0;e<i;e+=4)for(let t=0;t<o;t++){const i=t<4?h[e+t]:u[e+t-4];(i>=c||i<0)&&m++}return{skinned:!0,valid:0===n&&0===r&&0===m,report:"Number of Weights = "+i/4+"\nMaximum influences = "+s+"\nMissing Weights = "+n+"\nNot Sorted = "+a+"\nNot Normalized = "+r+"\nWeightCounts = ["+l+"]\nNumber of bones = "+c+"\nBad Bone Indices = "+m}}setVerticesBuffer(e,t=!0){return this._geometry||(this._geometry=Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this}set forceWorldMatrixInstancedBufferUpdate(e){this._instanceDataStorage.forceMatrixUpdates=e}getLODLevelAtDistance(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++){const a=t._LODLevels[i];if(a.distanceOrScreenCoverage===e)return a.mesh}return null}isReady(e=!1,t=!1){if(2===this.delayLoadState)return!1;if(!super.isReady(e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;const i=this.getEngine(),a=this.getScene(),n=t||i.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const s=this.material||a.defaultMaterial;if(s)if(s._storeEffectOnSubMeshes)for(const e of this.subMeshes){const t=e.getMaterial();if(t)if(t._storeEffectOnSubMeshes){if(!t.isReadyForSubMesh(this,e,n))return!1}else if(!t.isReady(this,n))return!1}else if(!s.isReady(this,n))return!1;const r=i.currentRenderPassId;for(const e of this.lightSources){const t=e.getShadowGenerators();if(!t)continue;const a=t.values();for(let e=a.next();!0!==e.done;e=a.next()){const t=e.value;if(t&&(!t.getShadowMap()?.cb||t.getShadowMap()?.cb&&-1!==t.getShadowMap()?.cb?.indexOf(this))){const e=t.getShadowMap().renderPassIds??[i.currentRenderPassId];for(let a=0;a<e.length;++a){i.currentRenderPassId=e[a];for(const e of this.subMeshes)if(!t.isReady(e,n,e.getMaterial()?.needAlphaBlendingForMesh(this)??!1))return i.currentRenderPassId=r,!1}i.currentRenderPassId=r}}}for(const e of this._internalMeshDataInfo._LODLevels)if(e.mesh&&!e.mesh.isReady(n))return!1;return!0}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}set onBeforeDraw(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)}setPositionsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourcePositions){const t=this.getVerticesData(VertexBuffer.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(VertexBuffer.PositionKind)||this.setVerticesData(VertexBuffer.PositionKind,t,!0)}return e._sourcePositions}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}static CreateGround(e,t,i,a,n,s){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(e,t,i,a,n,s,r,o,l,c){throw new Error("Import MeshBuilder to populate this function")}get _isMesh(){return!0}_rebuild(e=!1){if(this._instanceDataStorage.instancesBuffer&&(e&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const t in this._userInstancedBuffersStorage.vertexBuffers){const i=this._userInstancedBuffersStorage.vertexBuffers[t];i&&(e&&i.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(e)}static Nc(e,t,i,a,n){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(e,t,i,a,n,s,r,o){throw new Error("Import MeshBuilder to populate this function")}addInstance(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)}_normalizeSkinWeightsAndExtra(){const e=this.getVerticesData(VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(VertexBuffer.MatricesWeightsKind),i=t.length;for(let a=0;a<i;a+=4){let i=t[a]+t[a+1]+t[a+2]+t[a+3];if(i+=e[a]+e[a+1]+e[a+2]+e[a+3],0===i)t[a]=1;else{const n=1/i;t[a]*=n,t[a+1]*=n,t[a+2]*=n,t[a+3]*=n,e[a]*=n,e[a+1]*=n,e[a+2]*=n,e[a+3]*=n}}this.setVerticesData(VertexBuffer.MatricesWeightsKind,t),this.setVerticesData(VertexBuffer.MatricesWeightsKind,e)}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new Observable),this._internalMeshDataInfo._onAfterRenderObservable}_preActivate(){const e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this}static MergeMeshes(t,i=!0,a,n,s,r){return runCoroutineSync(e._MergeMeshesCoroutine(t,i,a,n,s,r,!1))}constructor(t,i=null,a=null,n=null,s,r=!0){super(t,i),this._internalMeshDataInfo=new _InternalMeshDataInfo,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new _InstanceDataStorage,this._thinInstanceDataStorage=new _ThinInstanceDataStorage,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=e.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,i=this.getScene(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(e,t,i)=>{e&&i&&(this._uniformBuffer?this.transferToEffect(t):i.bindOnlyWorldMatrix(t))},n&&this._copySource(n,s,r),null!==a&&(this.parent=a),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=e=>{e.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new Observable(this._internalMeshDataInfo._onMeshReadyObserverAdded),n&&n.onClonedObservable.notifyObservers(this)}set material(e){e&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(e.sideOrientation=null),this._setMaterial(e)}getAnimatables(){const e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}cleanMatrixWeights(){this.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind)&&(this.isVerticesDataPresent(VertexBuffer.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}static CreatePolyhedron(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static xb(e,t,i,a,n,s,r){throw new Error("Import MeshBuilder to populate this function")}getClassName(){return"Mesh"}instantiateHierarchy(e=null,t,i){const a=0===this.getTotalVertices()||t&&t.doNotInstantiate&&(!0===t.doNotInstantiate||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));a.parent=e||this.parent,a.position=this.position.clone(),a.scaling=this.scaling.clone(),this.rotationQuaternion?a.rotationQuaternion=this.rotationQuaternion.clone():a.rotation=this.rotation.clone(),i&&i(this,a);for(const e of this.getChildTransformNodes(!0))"InstancedMesh"===e.getClassName()&&"Mesh"===a.getClassName()&&e.zb===this?e.instantiateHierarchy(a,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:a},i):e.instantiateHierarchy(a,t,i);return a}get overrideMaterialSideOrientation(){return this.sideOrientation}setIndexBuffer(e,t,i){let a=this._geometry;a||(a=new Geometry(Geometry.RandomId(),this.getScene(),void 0,void 0,this)),a.setIndexBuffer(e,t,i)}_getFlattenedNormals(e,t){const i=new Float32Array(3*e.length);let a=0;const n=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let s=0;s<e.length;s+=3){const r=Vector3.FromArray(t,3*e[s]),o=Vector3.FromArray(t,3*e[s+1]),l=Vector3.FromArray(t,3*e[s+2]),c=r.subtract(o),h=l.subtract(o),u=Vector3.Normalize(Vector3.Cross(c,h));n&&u.scaleInPlace(-1);for(let e=0;e<3;e++)i[a++]=u.x,i[a++]=u.y,i[a++]=u.z}return i}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}static CreateTiledGround(e,t,i,a,n,s,r,o,l){throw new Error("Import MeshBuilder to populate this function")}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}get geometry(){return this._geometry}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i;i="object"==typeof e?e:{applySkeleton:e,applyMorph:t};const a=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getData(i,null,VertexBuffer.PositionKind),a),this}_bindDirect(e,t,i=!0){return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(e),i&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(e,t,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(e,t),this):this}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}static lb(e,t,i,a,n){throw new Error("Import MeshBuilder to populate this function")}_queueLoad(e){e.addPendingData(this);const t=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return Tools.LoadFile(this.delayLoadingFile,(t=>{t instanceof ArrayBuffer?this._delayLoadingFunction(t,this):this._delayLoadingFunction(JSON.parse(t),this),this.instances.forEach((e=>{e.refreshBoundingInfo(),e._syncSubMeshes()})),this.delayLoadState=1,e.removePendingData(this)}),(()=>{}),e.offlineProvider,t),this}get isUnIndexed(){return this._unIndexed}bakeTransformIntoVertices(e){if(!this.isVerticesDataPresent(VertexBuffer.PositionKind))return this;const t=this.subMeshes.splice(0);this._resetPointsArrayCache();let i=this.getVerticesData(VertexBuffer.PositionKind);const a=Vector3.Zero();let n;for(n=0;n<i.length;n+=3)Vector3.TransformCoordinatesFromFloatsToRef(i[n],i[n+1],i[n+2],e,a).toArray(i,n);if(this.setVerticesData(VertexBuffer.PositionKind,i,this.getVertexBuffer(VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(VertexBuffer.NormalKind)){for(i=this.getVerticesData(VertexBuffer.NormalKind),n=0;n<i.length;n+=3)Vector3.TransformNormalFromFloatsToRef(i[n],i[n+1],i[n+2],e,a).normalize().toArray(i,n);this.setVerticesData(VertexBuffer.NormalKind,i,this.getVertexBuffer(VertexBuffer.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(VertexBuffer.TangentKind)){for(i=this.getVerticesData(VertexBuffer.TangentKind),n=0;n<i.length;n+=4)Vector3.TransformNormalFromFloatsToRef(i[n],i[n+1],i[n+2],e,a).normalize().toArray(i,n);this.setVerticesData(VertexBuffer.TangentKind,i,this.getVertexBuffer(VertexBuffer.TangentKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this}markVerticesDataAsUpdatable(e,t=!0){const i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)}setMaterialByID(e){return this.setMaterialById(e)}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===Material.CounterClockWiseSideOrientation}static ExtrudeShape(e,t,i,a,n,s,r,o,l,c){throw new Error("Import MeshBuilder to populate this function")}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}addLODLevel(e,t){if(t&&t._masterMesh)return Logger.Warn("You cannot use a mesh as LOD level twice"),this;const i=new MeshLODLevel(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this}optimizeIndices(e){const t=this.getIndices(),i=this.getVerticesData(VertexBuffer.PositionKind);if(!i||!t)return this;const a=[];for(let e=0;e<i.length;e+=3)a.push(Vector3.FromArray(i,e));const n=[];return AsyncLoop.SyncAsyncForLoop(a.length,40,(e=>{const t=a.length-1-e,i=a[t];for(let e=0;e<t;++e){const s=a[e];if(i.equals(s)){n[t]=e;break}}}),(()=>{for(let e=0;e<t.length;++e)t[e]=n[t[e]]||t[e];const i=this.subMeshes.slice(0);this.setIndices(t),this.subMeshes=i,e&&e(this)})),this}_processRendering(e,t,i,a,n,s,r,o){const l=this.getScene(),c=l.getEngine();if(a=this._getRenderingFillMode(a),s&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,a,i,c),this;if(s)this._renderWithInstances(t,a,n,i,c);else{c._currentDrawContext&&(c._currentDrawContext.useInstancing=!1);let i=0;n.renderSelf[t._id]&&(r&&r(!1,e.getWorldMatrix(),o),i++,this._draw(t,a,this._instanceDataStorage.overridenInstanceCount));const s=n.visibleInstances[t._id];if(s){const e=s.length;i+=e;for(let i=0;i<e;i++){const e=s[i].getWorldMatrix();r&&r(!0,e,o),this._draw(t,a)}}l._activeIndices.addCount(t.indexCount*i,!1)}return this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}_getRenderingFillMode(e){const t=this.getScene();return t.forcePointsCloud?Material.PointFillMode:t.forceWireframe?Material.WireFrameFillMode:this.overrideRenderingFillMode??e}increaseVertices(e=1){const t=VertexData.ExtractFromMesh(this),i=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,a=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,n=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,s=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(i&&a){t.indices=i,t.positions=a,n&&(t.uvs=n),s&&(t.normals=s);const r=e+1,o=new Array;for(let e=0;e<r+1;e++)o[e]=new Array;let l,c;const h=new Vector3(0,0,0),u=new Vector3(0,0,0),m=new Vector2(0,0),d=new Array,f=new Array,p=new Array;let _,g,v,y=a.length;n&&(g=n.length),s&&(v=s.length);for(let e=0;e<i.length;e+=3){f[0]=i[e],f[1]=i[e+1],f[2]=i[e+2];for(let e=0;e<3;e++)if(l=f[e],c=f[(e+1)%3],void 0===p[l]&&void 0===p[c]?(p[l]=new Array,p[c]=new Array):(void 0===p[l]&&(p[l]=new Array),void 0===p[c]&&(p[c]=new Array)),void 0===p[l][c]&&void 0===p[c][l]){p[l][c]=[],h.x=(a[3*c]-a[3*l])/r,h.y=(a[3*c+1]-a[3*l+1])/r,h.z=(a[3*c+2]-a[3*l+2])/r,s&&(u.x=(s[3*c]-s[3*l])/r,u.y=(s[3*c+1]-s[3*l+1])/r,u.z=(s[3*c+2]-s[3*l+2])/r),n&&(m.x=(n[2*c]-n[2*l])/r,m.y=(n[2*c+1]-n[2*l+1])/r),p[l][c].push(l);for(let e=1;e<r;e++)p[l][c].push(a.length/3),a[y++]=a[3*l]+e*h.x,a[y++]=a[3*l+1]+e*h.y,a[y++]=a[3*l+2]+e*h.z,s&&(s[v++]=s[3*l]+e*u.x,s[v++]=s[3*l+1]+e*u.y,s[v++]=s[3*l+2]+e*u.z),n&&(n[g++]=n[2*l]+e*m.x,n[g++]=n[2*l+1]+e*m.y);p[l][c].push(c),p[c][l]=new Array,_=p[l][c].length;for(let e=0;e<_;e++)p[c][l][e]=p[l][c][_-1-e]}o[0][0]=i[e],o[1][0]=p[i[e]][i[e+1]][1],o[1][1]=p[i[e]][i[e+2]][1];for(let t=2;t<r;t++){o[t][0]=p[i[e]][i[e+1]][t],o[t][t]=p[i[e]][i[e+2]][t],h.x=(a[3*o[t][t]]-a[3*o[t][0]])/t,h.y=(a[3*o[t][t]+1]-a[3*o[t][0]+1])/t,h.z=(a[3*o[t][t]+2]-a[3*o[t][0]+2])/t,s&&(u.x=(s[3*o[t][t]]-s[3*o[t][0]])/t,u.y=(s[3*o[t][t]+1]-s[3*o[t][0]+1])/t,u.z=(s[3*o[t][t]+2]-s[3*o[t][0]+2])/t),n&&(m.x=(n[2*o[t][t]]-n[2*o[t][0]])/t,m.y=(n[2*o[t][t]+1]-n[2*o[t][0]+1])/t);for(let e=1;e<t;e++)o[t][e]=a.length/3,a[y++]=a[3*o[t][0]]+e*h.x,a[y++]=a[3*o[t][0]+1]+e*h.y,a[y++]=a[3*o[t][0]+2]+e*h.z,s&&(s[v++]=s[3*o[t][0]]+e*u.x,s[v++]=s[3*o[t][0]+1]+e*u.y,s[v++]=s[3*o[t][0]+2]+e*u.z),n&&(n[g++]=n[2*o[t][0]]+e*m.x,n[g++]=n[2*o[t][0]+1]+e*m.y)}o[r]=p[i[e+1]][i[e+2]],d.push(o[0][0],o[1][0],o[1][1]);for(let e=1;e<r;e++){let t;for(t=0;t<e;t++)d.push(o[e][t],o[e+1][t],o[e+1][t+1]),d.push(o[e][t],o[e+1][t+1],o[e][t+1]);d.push(o[e][t],o[e+1][t],o[e+1][t+1])}}t.indices=d,t.applyToMesh(this,this.isVertexBufferUpdatable(VertexBuffer.PositionKind))}else Logger.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}getVerticesDataKinds(e){if(!this._geometry){const e=[];return this._delayInfo&&this._delayInfo.forEach((function(t){e.push(t)})),e}const t=this._geometry.getVerticesDataKinds();if(!e&&this._userInstancedBuffersStorage)for(const e in this._userInstancedBuffersStorage.vertexBuffers)-1===t.indexOf(e)&&t.push(e);return t}static ExtendToGoldberg(e){throw new Error("Import MeshBuilder to populate this function")}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}static CreateGroundFromHeightMap(e,t,i,a,n,s,r,o,l,c,h){throw new Error("Import MeshBuilder to populate this function")}_unBindEffect(){super._unBindEffect();for(const e of this.instances)e._unBindEffect()}static _GetDefaultSideOrientation(t){return t||e.FRONTSIDE}static*_MergeMeshesCoroutine(t,i=!0,a,n,s,r,o){if(0===(t=t.filter(Boolean)).length)return null;let l;if(!a){let e=0;for(l=0;l<t.length;l++)if(e+=t[l].getTotalVertices(),e>=65536)return Logger.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}r&&(s=!1);const c=new Array,h=new Array,u=new Array,m=t[0].sideOrientation;for(l=0;l<t.length;l++){const e=t[l];if(e.isAnInstance)return Logger.Warn("Cannot merge instance meshes."),null;if(m!==e.sideOrientation)return Logger.Warn("Cannot merge meshes with different sideOrientation values."),null;if(s&&u.push(e.getTotalIndices()),r)if(e.material){const t=e.material;if(t instanceof MultiMaterial){for(let e=0;e<t.subMaterials.length;e++)c.indexOf(t.subMaterials[e])<0&&c.push(t.subMaterials[e]);for(let i=0;i<e.subMeshes.length;i++)h.push(c.indexOf(t.subMaterials[e.subMeshes[i].materialIndex])),u.push(e.subMeshes[i].indexCount)}else{c.indexOf(t)<0&&c.push(t);for(let i=0;i<e.subMeshes.length;i++)h.push(c.indexOf(t)),u.push(e.subMeshes[i].indexCount)}}else for(let t=0;t<e.subMeshes.length;t++)h.push(0),u.push(e.subMeshes[t].indexCount)}const d=t[0],f=e=>{const t=e.computeWorldMatrix(!0);return{vertexData:VertexData.ExtractFromMesh(e,!1,!1),transform:t}},{vertexData:p,transform:_}=f(d);o&&(yield);const g=new Array(t.length-1);for(let e=1;e<t.length;e++)g[e-1]=f(t[e]),o&&(yield);const v=p._mergeCoroutine(_,g,a,o,!i);let y=v.next();for(;!y.done;)o&&(yield),y=v.next();const S=y.value;n||(n=new e(d.name+"_merged",d.getScene()));const C=S._applyToCoroutine(n,void 0,o);let E=C.next();for(;!E.done;)o&&(yield),E=C.next();if(n.checkCollisions=d.checkCollisions,n.sideOrientation=d.sideOrientation,i)for(l=0;l<t.length;l++)t[l].dispose();if(s||r){n.releaseSubMeshes(),l=0;let e=0;for(;l<u.length;)SubMesh.CreateFromIndices(0,e,u[l],n,void 0,!1),e+=u[l],l++;for(const e of n.subMeshes)e.refreshBoundingInfo();n.computeWorldMatrix(!0)}if(r){const e=new MultiMaterial(d.name+"_merged",d.getScene());e.subMaterials=c;for(let e=0;e<n.subMeshes.length;e++)n.subMeshes[e].materialIndex=h[e];n.material=e}else n.material=d.material;return n}set overridenInstanceCount(e){this._instanceDataStorage.overridenInstanceCount=e}getIndices(e,t){return this._geometry?this._geometry.getIndices(e,t):[]}setVerticesData(e,t,i=!1,a){if(this._geometry)this._geometry.setVerticesData(e,t,i,a);else{const a=new VertexData;a.set(t,e);const n=this.getScene();new Geometry(Geometry.RandomId(),n,a,i,this)}return this}getLODLevels(){return this._internalMeshDataInfo._LODLevels}setNormalsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourceNormals){const t=this.getVerticesData(VertexBuffer.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(VertexBuffer.NormalKind)||this.setVerticesData(VertexBuffer.NormalKind,t,!0)}return e._sourceNormals}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}get material(){return this._internalAbstractMeshDataInfo._material}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}removeVerticesData(e){this._geometry&&this._geometry.removeVerticesData(e)}get hasInstances(){return this.instances.length>0}set useLODScreenCoverage(e){this._internalMeshDataInfo._useLODScreenCoverage=e,this._sortLODLevels()}forceSharedVertices(){const e=VertexData.ExtractFromMesh(this),t=e.uvs,i=e.indices,a=e.positions,n=e.colors,s=e.matricesIndices,r=e.matricesWeights,o=e.matricesIndicesExtra,l=e.matricesWeightsExtra;if(void 0===i||void 0===a||null===i||null===a)Logger.Warn("VertexData contains empty entries");else{const c=new Array,h=new Array,u=new Array,m=new Array,d=new Array,f=new Array,p=new Array,_=new Array;let g=new Array,v=0;const y={};let S,C;for(let e=0;e<i.length;e+=3){C=[i[e],i[e+1],i[e+2]],g=[];for(let e=0;e<3;e++){g[e]="";for(let t=0;t<3;t++)Math.abs(a[3*C[e]+t])<1e-8&&(a[3*C[e]+t]=0),g[e]+=a[3*C[e]+t]+"|"}if(g[0]!=g[1]&&g[0]!=g[2]&&g[1]!=g[2])for(let e=0;e<3;e++){if(S=y[g[e]],void 0===S){y[g[e]]=v,S=v++;for(let t=0;t<3;t++)c.push(a[3*C[e]+t]);if(null!=n)for(let t=0;t<4;t++)m.push(n[4*C[e]+t]);if(null!=t)for(let i=0;i<2;i++)u.push(t[2*C[e]+i]);if(null!=s)for(let t=0;t<4;t++)d.push(s[4*C[e]+t]);if(null!=r)for(let t=0;t<4;t++)f.push(r[4*C[e]+t]);if(null!=o)for(let t=0;t<4;t++)p.push(o[4*C[e]+t]);if(null!=l)for(let t=0;t<4;t++)_.push(l[4*C[e]+t])}h.push(S)}}const E=new Array;VertexData.ComputeNormals(c,h,E),e.positions=c,e.indices=h,e.normals=E,null!=t&&(e.uvs=u),null!=n&&(e.colors=m),null!=s&&(e.matricesIndices=d),null!=r&&(e.matricesWeights=f),null!=o&&(e.matricesIndicesExtra=p),null!=r&&(e.matricesWeightsExtra=_),e.applyToMesh(this,this.isVertexBufferUpdatable(VertexBuffer.PositionKind))}}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}static CreateDecal(e,t,i,a,n,s){throw new Error("Import MeshBuilder to populate this function")}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(VertexBuffer.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(VertexBuffer.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}static Ec(e,t,i,a,n,s,r,o,l){throw new Error("Import MeshBuilder to populate this function")}updateVerticesData(e,t,i,a){return this._geometry?(a?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this}static ExtrudeShapeCustom(e,t,i,a,n,s,r,o,l,c,h,u){throw new Error("Import MeshBuilder to populate this function")}_normalizeSkinFourWeights(){const e=this.getVerticesData(VertexBuffer.MatricesWeightsKind),t=e.length;for(let i=0;i<t;i+=4){const t=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===t)e[i]=1;else{const a=1/t;e[i]*=a,e[i+1]*=a,e[i+2]*=a,e[i+3]*=a}}this.setVerticesData(VertexBuffer.MatricesWeightsKind,e)}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new Observable),this._internalMeshDataInfo._onBeforeRenderObservable}render(e,t,i){const a=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const n=a.activeCameras?.length??0;if((n>1&&a.activeCamera===a.activeCameras[0]||n<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const s=this._getInstancesRenderList(e._id,!!i);if(s.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const r=a.getEngine();let o=0,l=null;this.ignoreCameraMaxZ&&a.activeCamera&&!a._isInIntermediateRendering()&&(o=a.activeCamera.maxZ,l=a.activeCamera,a.activeCamera.maxZ=0,a.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const c=e.getRenderingMesh(),h=s.hardwareInstancedRendering[e._id]||c.hasThinInstances||!!this._userInstancedBuffersStorage&&!e.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,u=this._instanceDataStorage,m=e.getMaterial();if(!m)return l&&(l.maxZ=o,a.updateTransformMatrix(!0)),this;if(u.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===m){if(m._storeEffectOnSubMeshes&&!e._drawWrapper?._wasPreviouslyReady||!m._storeEffectOnSubMeshes&&!m._getDrawWrapper()._wasPreviouslyReady)return l&&(l.maxZ=o,a.updateTransformMatrix(!0)),this}else{if(m._storeEffectOnSubMeshes){if(!m.isReadyForSubMesh(this,e,h))return l&&(l.maxZ=o,a.updateTransformMatrix(!0)),this}else if(!m.isReady(this,h))return l&&(l.maxZ=o,a.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=m}let d;t&&r.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),d=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?e._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const f=d?.effect??null;for(const t of a._beforeRenderingMeshStage)t.action(this,e,s,f);if(!d||!f)return l&&(l.maxZ=o,a.updateTransformMatrix(!0)),this;const p=i||this;let _;if(u.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)_=u.sideOrientation;else{const e=p._getWorldMatrixDeterminant();_=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),e<0&&(_=_===Material.ClockWiseSideOrientation?Material.CounterClockWiseSideOrientation:Material.ClockWiseSideOrientation),u.sideOrientation=_}const g=this._internalMeshDataInfo._effectiveMaterial._preBind(d,_);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&r.setDepthWrite(!0);const v=this._internalMeshDataInfo._effectiveMaterial,y=v.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),h||this._bind(e,f,y,!1);const S=p.getWorldMatrix();v._storeEffectOnSubMeshes?v.bindForSubMesh(S,this,e):v.bind(S,this),!v.backFaceCulling&&v.separateCullingPass&&(r.setState(!0,v.zOffset,!1,!g,v.cullBackFaces,v.stencil,v.zOffsetUnits),this._processRendering(this,e,f,y,s,h,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),r.setState(!0,v.zOffset,!1,g,v.cullBackFaces,v.stencil,v.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,f,y,s,h,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const t of a._afterRenderingMeshStage)t.action(this,e,s,f);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),l&&(l.maxZ=o,a.updateTransformMatrix(!0)),2!==a.performancePriority||u.isFrozen||this._freeze(),this}serialize(e={}){e.name=this.name,e.id=this.id,e.Hc=this.Hc,e.type=this.getClassName(),Tags&&Tags.HasTags(this)&&(e.tags=Tags.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,e.checkCollisions=this.checkCollisions,e.ellipsoid=this.ellipsoid.asArray(),e.ellipsoidOffset=this.ellipsoidOffset.asArray(),e.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,e.isBlocker=this.isBlocker,e.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;const t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.Hc,e.geometryId=t.id,e.subMeshes=[];for(let t=0;t<this.subMeshes.length;t++){const i=this.subMeshes[t];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.Hc,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.Hc,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.Hc),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(SceneComponentConstants.NAME_PHYSICSENGINE)){const t=this.getPhysicsImpostor();t&&(e.physicsMass=t.getParam("mass"),e.physicsFriction=t.getParam("friction"),e.physicsRestitution=t.getParam("mass"),e.physicsImpostor=t.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(let t=0;t<this.instances.length;t++){const i=this.instances[t];if(i.doNotSerialize)continue;const a={name:i.name,id:i.id,isEnabled:i.isEnabled(!1),isVisible:i.isVisible,isPickable:i.isPickable,checkCollisions:i.checkCollisions,position:i.position.asArray(),scaling:i.scaling.asArray()};if(i.parent&&i.parent._serializeAsParent(a),i.rotationQuaternion?a.rotationQuaternion=i.rotationQuaternion.asArray():i.rotation&&(a.rotation=i.rotation.asArray()),this.getScene()._getComponent(SceneComponentConstants.NAME_PHYSICSENGINE)){const e=i.getPhysicsImpostor();e&&(a.physicsMass=e.getParam("mass"),a.physicsFriction=e.getParam("friction"),a.physicsRestitution=e.getParam("mass"),a.physicsImpostor=e.type)}i.metadata&&(a.metadata=i.metadata),i.actionManager&&(a.actions=i.actionManager.serialize(i.name)),e.instances.push(a),SerializationHelper.AppendSerializedAnimations(i,a),a.ranges=i.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const t={data:{},sizes:{},strides:{}};for(const e in this._userThinInstanceBuffersStorage.data)t.data[e]=Array.from(this._userThinInstanceBuffersStorage.data[e]),t.sizes[e]=this._userThinInstanceBuffersStorage.sizes[e],t.strides[e]=this._userThinInstanceBuffersStorage.strides[e];e.thinInstances.userThinInstance=t}return SerializationHelper.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name)),e}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new Observable),this._internalMeshDataInfo._onBeforeBindObservable}_copySource(e,t,i=!0){const a=this.getScene();if(e._geometry&&e._geometry.applyToMesh(this),DeepCopier.DeepCopy(e,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=e,a.useClonedMeshMap&&(e._internalMeshDataInfo.meshMap||(e._internalMeshDataInfo.meshMap={}),e._internalMeshDataInfo.meshMap[this.Hc]=this),this._originalBuilderSideOrientation=e._originalBuilderSideOrientation,this._creationDataStorage=e._creationDataStorage,e._ranges){const t=e._ranges;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]&&this.createAnimationRange(e,t[e].from,t[e].to)}if(e.metadata&&e.metadata.clone?this.metadata=e.metadata.clone():this.metadata=e.metadata,this._internalMetadata=e._internalMetadata,Tags&&Tags.HasTags(e)&&Tags.AddTagsTo(this,Tags.GetTags(e,!0)),this.setEnabled(e.isEnabled(!1)),this.parent=e.parent,this.setPivotMatrix(e.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+e.id,this.material=e.material,!t){const t=e.getDescendants(!0);for(let e=0;e<t.length;e++){const i=t[e];i.clone&&i.clone(this.name+"."+i.name,this)}}if(e.morphTargetManager&&(this.morphTargetManager=e.morphTargetManager),a.getPhysicsEngine){const t=a.getPhysicsEngine();if(i&&t)if(1===t.getPluginVersion()){const i=t.getImpostorForPhysicsObject(e);i&&(this.physicsImpostor=i.clone(this))}else 2===t.getPluginVersion()&&e.physicsBody&&e.physicsBody.clone(this)}for(let t=0;t<a.particleSystems.length;t++){const i=a.particleSystems[t];i.emitter===e&&i.clone(i.name,this)}this.skeleton=e.skeleton,this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}dispose(e,t=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),i._onBetweenPassObservable&&i._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(const e in i.meshMap){const t=i.meshMap[e];t&&(t._internalMeshDataInfo._source=null,i.meshMap[e]=void 0)}i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.Hc]=void 0)}else{const e=this.getScene().meshes;for(const t of e){const e=t;e._internalMeshDataInfo&&e._internalMeshDataInfo._source&&e._internalMeshDataInfo._source===this&&(e._internalMeshDataInfo._source=null)}}i._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(e,t)}copyVerticesData(e,t){this._geometry&&this._geometry.copyVerticesData(e,t)}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_disposeInstanceSpecificData(){}static CreateTorusKnot(e,t,i,a,n,s,r,o,l,c){throw new Error("Import MeshBuilder to populate this function")}applyDisplacementMapFromBuffer(e,t,i,a,n,s,r,o=!1){if(!this.isVerticesDataPresent(VertexBuffer.PositionKind)||!this.isVerticesDataPresent(VertexBuffer.NormalKind)||!this.isVerticesDataPresent(VertexBuffer.UVKind))return Logger.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const l=this.getVerticesData(VertexBuffer.PositionKind,!0,!0),c=this.getVerticesData(VertexBuffer.NormalKind),h=this.getVerticesData(VertexBuffer.UVKind);let u=Vector3.Zero();const m=Vector3.Zero(),d=Vector2.Zero();s=s||Vector2.Zero(),r=r||new Vector2(1,1);for(let o=0;o<l.length;o+=3){Vector3.FromArrayToRef(l,o,u),Vector3.FromArrayToRef(c,o,m),Vector2.FromArrayToRef(h,o/3*2,d);const f=4*((Math.abs(d.x*r.x+s.x%1)*(t-1)%t|0)+(Math.abs(d.y*r.y+s.y%1)*(i-1)%i|0)*t),p=.3*(e[f]/255)+.59*(e[f+1]/255)+.11*(e[f+2]/255);m.normalize(),m.scaleInPlace(a+(n-a)*p),u=u.add(m),u.toArray(l,o)}return VertexData.ComputeNormals(l,this.getIndices(),c),o?(this.setVerticesData(VertexBuffer.PositionKind,l),this.setVerticesData(VertexBuffer.NormalKind,c),this.setVerticesData(VertexBuffer.UVKind,h)):(this.updateVerticesData(VertexBuffer.PositionKind,l),this.updateVerticesData(VertexBuffer.NormalKind,c)),this}_preActivateForIntermediateRendering(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this}subdivide(e){if(e<1)return;const t=this.getTotalIndices();let i=t/e|0,a=0;for(;i%3!=0;)i++;this.releaseSubMeshes();for(let n=0;n<e&&!(a>=t);n++)SubMesh.CreateFromIndices(0,a,n===e-1?t-a:i,this,void 0,!1),a+=i;this.refreshBoundingInfo(),this.synchronizeInstances()}static CreateDashedLines(e,t,i,a,n,s,r,o){throw new Error("Import MeshBuilder to populate this function")}};Mesh.FRONTSIDE=VertexData.FRONTSIDE,Mesh.BACKSIDE=VertexData.BACKSIDE,Mesh.DOUBLESIDE=VertexData.DOUBLESIDE,Mesh.DEFAULTSIDE=VertexData.DEFAULTSIDE,Mesh.NO_CAP=0,Mesh.CAP_START=1,Mesh.CAP_END=2,Mesh.CAP_ALL=3,Mesh.NO_FLIP=0,Mesh.FLIP_TILE=1,Mesh.ROTATE_TILE=2,Mesh.FLIP_ROW=3,Mesh.ROTATE_ROW=4,Mesh.FLIP_N_ROTATE_TILE=5,Mesh.FLIP_N_ROTATE_ROW=6,Mesh.CENTER=0,Mesh.LEFT=1,Mesh.RIGHT=2,Mesh.TOP=3,Mesh.BOTTOM=4,Mesh.INSTANCEDMESH_SORT_TRANSPARENT=!1,Mesh._GroundMeshParser=(e,t)=>{throw _WarnImport("GroundMesh")},Mesh._GoldbergMeshParser=(e,t)=>{throw _WarnImport("GoldbergMesh")},Mesh._LinesMeshParser=(e,t)=>{throw _WarnImport("LinesMesh")},Mesh._GreasedLineMeshParser=(e,t)=>{throw _WarnImport("GreasedLineMesh")},Mesh._GreasedLineRibbonMeshParser=(e,t)=>{throw _WarnImport("GreasedLineRibbonMesh")},Mesh._TrailMeshParser=(e,t)=>{throw _WarnImport("TrailMesh")},RegisterClass("BABYLON.Mesh",Mesh);var HitMarker=class{constructor(e){this.Xb=new Mesh("hitMarker",e),this.Xb.updatable=!0,this.Xb.hasVertexAlpha=!0,this.Xb.layerMask=536870912,this.Xb.visibility=.2,this.positions=[1,2.5,0,0,3,0,-1,2.5,0];this.colors=new Array(12).fill(0),this.colors[0]=1,this.colors[4]=1,this.colors[8]=1,this.colors[7]=1;var t=new VertexData;return t.positions=this.positions,t.indices=[0,1,2],t.colors=this.colors,t.applyToMesh(this.Xb,!0),this.Xb.material=e.getMaterialByName("ui"),this.Xb}},HitMarkers=class{constructor(e){this.container=new TransformNode("hitMarkers",e),this.container.layerMask=536870912,this.markers=[];for(let t=0;t<4;t++){let t=new HitMarker(e);t.parent=this.container,this.markers.push({mesh:t,angle:0})}}resize(){let e=.1*G.engine.getRenderHeight();this.container.scaling.x=e,this.container.scaling.y=e}show(){this.container.setEnabled(!0)}hide(){this.container.setEnabled(!1)}hit(e,t){if(0===this.container.visibility)return;let i,a=Math.atan2(e,t),n=-Math.radRange(a);for(let e of this.markers)if(0===e.mesh.visibility){i=e;break}if(!i){let e=1e3;for(let t of this.markers){let a=Math.abs(Math.radRange(t.angle-n));a<e&&(e=a,i=t)}}i.angle=n,i.mesh.scaling.x=1.1,i.mesh.scaling.y=1.1,i.mesh.visibility=5,i.mesh.rotation.z=n}update(e,t){if(this.container.isEnabled()){this.container.rotation.z=t;for(let t of this.markers)if(t.mesh.visibility>0){t.mesh.visibility=Math.max(0,t.mesh.visibility-.06*e);let i=Math.max(1,t.mesh.scaling.x-.01*e);t.mesh.scaling.x=i,t.mesh.scaling.y=i}}}},PushMaterial=class extends Material{dispose(e,t,i){this._activeEffect=void 0,super.dispose(e,t,i)}_isReadyForSubMesh(e){const t=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!t||t._renderId!==this.getScene().getRenderId())}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}isReady(e,t){return!!e&&(!this._storeEffectOnSubMeshes||(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t)))}bind(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}_mustRebind(e,t,i,a=1){return i._drawWrapper._forceRebindOnNextCall||e.isCachedMaterialInvalid(this,t,a)}_afterBind(e,t=null,i){super._afterBind(e,t,i),this.getScene()._cachedEffect=t,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}constructor(e,t,i=!0){super(e,t),this._normalMatrix=new Matrix,this._storeEffectOnSubMeshes=i}},NodeMaterialBlockConnectionPointTypes,NodeMaterialBlockConnectionPointTypes2,NodeMaterialBlockTargets,NodeMaterialBlockTargets2;NodeMaterialBlockConnectionPointTypes2=NodeMaterialBlockConnectionPointTypes||(NodeMaterialBlockConnectionPointTypes={}),NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Float=1]="Float",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Int=2]="Int",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Vector2=4]="Vector2",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Vector3=8]="Vector3",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Vector4=16]="Vector4",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Color3=32]="Color3",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Color4=64]="Color4",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Matrix=128]="Matrix",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.Object=256]="Object",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.AutoDetect=1024]="AutoDetect",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.BasedOnInput=2048]="BasedOnInput",NodeMaterialBlockConnectionPointTypes2[NodeMaterialBlockConnectionPointTypes2.All=4095]="All",NodeMaterialBlockTargets2=NodeMaterialBlockTargets||(NodeMaterialBlockTargets={}),NodeMaterialBlockTargets2[NodeMaterialBlockTargets2.Vertex=1]="Vertex",NodeMaterialBlockTargets2[NodeMaterialBlockTargets2.Fragment=2]="Fragment",NodeMaterialBlockTargets2[NodeMaterialBlockTargets2.Neutral=4]="Neutral",NodeMaterialBlockTargets2[NodeMaterialBlockTargets2.VertexAndFragment=3]="VertexAndFragment",init_shaderStore();var NodeMaterialBuildState=class{_registerTempVariable(e){return-1===this.sharedData.temps.indexOf(e)&&(this.sharedData.temps.push(e),!0)}_emitFunction(e,t,i){this.functions[e]||(this.sharedData.emitComments&&(t=i+"\n"+t),this.functions[e]=t)}_generateTernary(e,t,i){return 1===this.shaderLanguage?`select(${t}, ${e}, ${i})`:`(${i}) ? ${e} : ${t}`}_samplerCubeFunc(){return 1===this.shaderLanguage?"textureSample":"textureCube"}_getGLType(e){switch(e){case NodeMaterialBlockConnectionPointTypes.Float:return"float";case NodeMaterialBlockConnectionPointTypes.Int:return"int";case NodeMaterialBlockConnectionPointTypes.Vector2:return"vec2";case NodeMaterialBlockConnectionPointTypes.Color3:case NodeMaterialBlockConnectionPointTypes.Vector3:return"vec3";case NodeMaterialBlockConnectionPointTypes.Color4:case NodeMaterialBlockConnectionPointTypes.Vector4:return"vec4";case NodeMaterialBlockConnectionPointTypes.Matrix:return"mat4"}return""}_convertFunctionsToWGSL(e){const t=/var\s+(\w+)\s*:\s*(\w+)\((.*)\)/g;let i;for(;null!==(i=t.exec(e));){const t=i[1],a=i[2],n=i[3].replace(/var\s/g,"");e=e.replace(i[0],`fn ${t}(${n}) -> ${a}`)}return e}_convertTernaryOperandsToGLSL(e){return e.replace(new RegExp("\\[(.+?)\\?(.+?):(.+)\\]","g"),((e,t,i,a)=>`${t} ? ${i} : ${a}`))}_getFreeDefineName(e){return void 0===this.sharedData.defineNames[e]?this.sharedData.defineNames[e]=0:this.sharedData.defineNames[e]++,e+this.sharedData.defineNames[e]}_emitFloat(e){return e.toString()===e.toFixed(0)?`${e}.0`:e.toString()}_emitVaryingFromString(e,t,i="",a=!1){if(-1!==this.sharedData.varyings.indexOf(e))return!1;this.sharedData.varyings.push(e),i&&(i.startsWith("defined(")?this.sharedData.varyingDeclaration+=`#if ${i}\n`:this.sharedData.varyingDeclaration+=`${a?"#ifndef":"#ifdef"} ${i}\n`);const n=this._getShaderType(t);return 1===this.shaderLanguage?this.sharedData.varyingDeclaration+=`varying ${e}: ${n};\n`:this.sharedData.varyingDeclaration+=`varying ${n} ${e};\n`,i&&(this.sharedData.varyingDeclaration+="#endif\n"),!0}_convertOutParametersToWGSL(e){return e.replace(new RegExp("out\\s+var\\s+(\\w+)\\s*:\\s*(\\w+)","g"),"$1: ptr<function, $2>")}_emitUniformFromString(e,t,i="",a=!1){if(-1!==this.uniforms.indexOf(e))return;this.uniforms.push(e),i&&(i.startsWith("defined(")?this._uniformDeclaration+=`#if ${i}\n`:this._uniformDeclaration+=`${a?"#ifndef":"#ifdef"} ${i}\n`);const n=this._getShaderType(t);1===this.shaderLanguage?this._uniformDeclaration+=`uniform ${e}: ${n};\n`:this._uniformDeclaration+=`uniform ${n} ${e};\n`,i&&(this._uniformDeclaration+="#endif\n")}_toLinearSpace(e){return 1===this.shaderLanguage&&(e.type===NodeMaterialBlockConnectionPointTypes.Color3||e.type===NodeMaterialBlockConnectionPointTypes.Vector3)?`toLinearSpaceVec3(${e.associatedVariableName})`:`toLinearSpace(${e.associatedVariableName})`}_emitCubeSampler(e,t="",i=!1){(this.samplers.indexOf(e)<0||i)&&(t&&(this._samplerDeclaration+=`#if ${t}\n`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;\n`,this._samplerDeclaration+=`var ${e}: texture_cube<f32>;\n`):this._samplerDeclaration+=`uniform samplerCube ${e};\n`,t&&(this._samplerDeclaration+="#endif\n"),i||this.samplers.push(e))}_generateTextureSampleCubeLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerCubeFunc()}(${t}, ${e}, ${i})`}_convertInnerFunctionsToWGSL(e){return e.replace(new RegExp("inversesqrt","g"),"inverseSqrt")}_emitFunctionFromInclude(e,t,i,a=""){const n=e+a;if(this.functions[n])return;const s=ShaderStore.GetIncludesShadersStore(this.shaderLanguage);if(!(i&&(i.removeAttributes||i.removeUniforms||i.removeVaryings||i.removeIfDef||i.replaceStrings)))return i&&i.repeatKey?this.functions[n]=`#include<${e}>${i.substitutionVars?"("+i.substitutionVars+")":""}[0..${i.repeatKey}]\n`:this.functions[n]=`#include<${e}>${i?.substitutionVars?"("+i?.substitutionVars+")":""}\n`,void(this.sharedData.emitComments&&(this.functions[n]=t+"\n"+this.functions[n]));if(this.functions[n]=s[e],this.sharedData.emitComments&&(this.functions[n]=t+"\n"+this.functions[n]),i.removeIfDef&&(this.functions[n]=this.functions[n].replace(/^\s*?#ifdef.+$/gm,""),this.functions[n]=this.functions[n].replace(/^\s*?#endif.*$/gm,""),this.functions[n]=this.functions[n].replace(/^\s*?#else.*$/gm,""),this.functions[n]=this.functions[n].replace(/^\s*?#elif.*$/gm,"")),i.removeAttributes&&(this.functions[n]=this.functions[n].replace(/\s*?attribute .+?;/g,"\n")),i.removeUniforms&&(this.functions[n]=this.functions[n].replace(/\s*?uniform .*?;/g,"\n")),i.removeVaryings&&(this.functions[n]=this.functions[n].replace(/\s*?(varying|in) .+?;/g,"\n")),i.replaceStrings)for(let e=0;e<i.replaceStrings.length;e++){const t=i.replaceStrings[e];this.functions[n]=this.functions[n].replace(t.search,t.replace)}}_getShaderType(e){const t=1===this.shaderLanguage;switch(e){case NodeMaterialBlockConnectionPointTypes.Float:return t?"f32":"float";case NodeMaterialBlockConnectionPointTypes.Int:return t?"i32":"int";case NodeMaterialBlockConnectionPointTypes.Vector2:return t?"vec2f":"vec2";case NodeMaterialBlockConnectionPointTypes.Color3:case NodeMaterialBlockConnectionPointTypes.Vector3:return t?"vec3f":"vec3";case NodeMaterialBlockConnectionPointTypes.Color4:case NodeMaterialBlockConnectionPointTypes.Vector4:return t?"vec4f":"vec4";case NodeMaterialBlockConnectionPointTypes.Matrix:return t?"mat4x4f":"mat4"}return""}_emitCodeFromInclude(e,t,i){const a=ShaderStore.GetIncludesShadersStore(this.shaderLanguage);if(i&&i.repeatKey)return`#include<${e}>${i.substitutionVars?"("+i.substitutionVars+")":""}[0..${i.repeatKey}]\n`;let n=a[e]+"\n";if(this.sharedData.emitComments&&(n=t+"\n"+n),!i)return n;if(i.replaceStrings)for(let e=0;e<i.replaceStrings.length;e++){const t=i.replaceStrings[e];n=n.replace(t.search,t.replace)}return n}constructor(){this.supportUniformBuffers=!1,this.attributes=[],this.uniforms=[],this.constants=[],this.samplers=[],this.functions={},this.extensions={},this.prePassOutput={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}_babylonSLtoGLSL(e){return e=e.replace(/\[\*\]/g,""),e=this._convertTernaryOperandsToGLSL(e)}_emit2DArraySampler(e){this.samplers.indexOf(e)<0&&(this._samplerDeclaration+=`uniform sampler2DArray ${e};\n`,this.samplers.push(e))}_convertVariableDeclarationToWGSL(e,t,i){return i.replace(new RegExp(`(${e})\\s+(\\w+)`,"g"),`var $2: ${t}`)}finalize(e){const t=e.sharedData.emitComments,i=this.target===NodeMaterialBlockTargets.Fragment;1===this.shaderLanguage?this.compilationString=i?`\n${t?"//Entry point\n":""}@fragment\nfn main(input: FragmentInputs) -> FragmentOutputs {\n${this.compilationString}`:`\n${t?"//Entry point\n":""}@vertex\nfn main(input: VertexInputs) -> FragmentInputs{\n${this.compilationString}`:this.compilationString=`\n${t?"//Entry point\n":""}void main(void) {\n${this.compilationString}`,this._constantDeclaration&&(this.compilationString=`\n${t?"//Constants\n":""}${this._constantDeclaration}\n${this.compilationString}`);let a="";for(const e in this.functions)a+=this.functions[e]+"\n";if(this.compilationString=`\n${a}\n${this.compilationString}`,!i&&this._varyingTransfer&&(this.compilationString=`${this.compilationString}\n${this._varyingTransfer}`),this._injectAtEnd&&(this.compilationString=`${this.compilationString}\n${this._injectAtEnd}`),this.compilationString=`${this.compilationString}\n}`,this.sharedData.varyingDeclaration&&(this.compilationString=`\n${t?"//Varyings\n":""}${this.sharedData.varyingDeclaration}\n${this.compilationString}`),this._samplerDeclaration&&(this.compilationString=`\n${t?"//Samplers\n":""}${this._samplerDeclaration}\n${this.compilationString}`),this._uniformDeclaration&&(this.compilationString=`\n${t?"//Uniforms\n":""}${this._uniformDeclaration}\n${this.compilationString}`),this._attributeDeclaration&&!i&&(this.compilationString=`\n${t?"//Attributes\n":""}${this._attributeDeclaration}\n${this.compilationString}`),1!==this.shaderLanguage){this.compilationString="precision highp float;\n"+this.compilationString,this.compilationString="#if defined(WEBGL2) || defined(WEBGPU)\nprecision highp sampler2DArray;\n#endif\n"+this.compilationString,i&&(this.compilationString="#if defined(PREPASS)\r\n#extension GL_EXT_draw_buffers : require\r\nlayout(location = 0) out highp vec4 glFragData[SCENE_MRT_COUNT];\r\nhighp vec4 gl_FragColor;\r\n#endif\r\n"+this.compilationString);for(const e in this.extensions){const t=this.extensions[e];this.compilationString=`\n${t}\n${this.compilationString}`}}this._builtCompilationString=this.compilationString}_convertVariableConstructorsToWGSL(e,t,i){return i.replace(new RegExp(`(${e})\\(`,"g"),` ${t}(`)}get fSuffix(){return 1===this.shaderLanguage?"f":""}_babylonSLtoWGSL(e){return e=this._convertVariableDeclarationToWGSL("void","voidnull",e),e=this._convertVariableDeclarationToWGSL("bool","bool",e),e=this._convertVariableDeclarationToWGSL("int","i32",e),e=this._convertVariableDeclarationToWGSL("uint","u32",e),e=this._convertVariableDeclarationToWGSL("float","f32",e),e=this._convertVariableDeclarationToWGSL("vec2","vec2f",e),e=this._convertVariableDeclarationToWGSL("vec3","vec3f",e),e=this._convertVariableDeclarationToWGSL("vec4","vec4f",e),e=this._convertVariableDeclarationToWGSL("mat2","mat2x2f",e),e=this._convertVariableDeclarationToWGSL("mat3","mat3x3f",e),e=this._convertVariableDeclarationToWGSL("mat4","mat4x4f",e),e=this._convertVariableConstructorsToWGSL("float","f32",e),e=this._convertVariableConstructorsToWGSL("vec2","vec2f",e),e=this._convertVariableConstructorsToWGSL("vec3","vec3f",e),e=this._convertVariableConstructorsToWGSL("vec4","vec4f",e),e=this._convertVariableConstructorsToWGSL("mat2","mat2x2f",e),e=this._convertVariableConstructorsToWGSL("mat3","mat3x3f",e),e=this._convertVariableConstructorsToWGSL("mat4","mat4x4f",e),e=this._convertTernaryOperandsToWGSL(e),e=this._convertModOperatorsToWGSL(e),e=this._convertConstToWGSL(e),e=this._convertInnerFunctionsToWGSL(e),e=(e=this._convertOutParametersToWGSL(e)).replace(/\[\*\]/g,"*"),e=(e=(e=(e=this._convertFunctionsToWGSL(e)).replace(/\s->\svoidnull/g,"")).replace(/dFdx/g,"dpdx")).replace(/dFdy/g,"dpdy")}get shaderLanguage(){return this.sharedData.nodeMaterial.shaderLanguage}_getVaryingName(e){return 1===this.shaderLanguage?(this.target!==NodeMaterialBlockTargets.Fragment?"vertexOutputs.":"fragmentInputs.")+e:e}_convertTernaryOperandsToWGSL(e){return e.replace(new RegExp("\\[(.*?)\\?(.*?):(.*)\\]","g"),((e,t,i,a)=>`select(${a}, ${i}, ${t})`))}_convertConstToWGSL(e){return e.replace(new RegExp("const var","g"),"const")}_excludeVariableName(e){this.sharedData.variableNames[e]=0}_samplerFunc(){return 1===this.shaderLanguage?"textureSample":"texture2D"}_generateTextureSampleCube(e,t){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerCubeFunc()}(${t}, ${e})`}get _repeatableContentAnchor(){return`###___ANCHOR${this._repeatableContentAnchorIndex++}___###`}_emit2DSampler(e,t="",i=!1){(this.samplers.indexOf(e)<0||i)&&(t&&(this._samplerDeclaration+=`#if ${t}\n`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;\n`,this._samplerDeclaration+=`var ${e}: texture_2d<f32>;\n`):this._samplerDeclaration+=`uniform sampler2D ${e};\n`,t&&(this._samplerDeclaration+="#endif\n"),i||this.samplers.push(e))}_declareOutput(e,t){return this._declareLocalVar(e.associatedVariableName,e.type,t)}_generateTextureSampleLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerLODFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerLODFunc()}(${t}, ${e}, ${i})`}_emitExtension(e,t,i=""){this.extensions[e]||(i&&(t=`#if ${i}\n${t}\n#endif`),this.extensions[e]=t)}_declareLocalVar(e,t,i){return 1===this.shaderLanguage?`${i?"const":"var"} ${e}: ${this._getShaderType(t)}`:`${this._getShaderType(t)} ${e}`}_convertModOperatorsToWGSL(e){return e.replace(new RegExp("mod\\((.+?),\\s*(.+?)\\)","g"),((e,t,i)=>`((${t})%(${i}))`))}_getFreeVariableName(e){return e=e.replace(/[^a-zA-Z_]+/g,""),void 0===this.sharedData.variableNames[e]?(this.sharedData.variableNames[e]=0,"output"===e||"texture"===e?e+this.sharedData.variableNames[e]:e):(this.sharedData.variableNames[e]++,e+this.sharedData.variableNames[e])}_samplerLODFunc(){return 1===this.shaderLanguage?"textureSampleLevel":"texture2DLodEXT"}_generateTextureSample(e,t){return 1===this.shaderLanguage?`${this._samplerFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerFunc()}(${t}, ${e})`}},NodeMaterialBuildStateSharedData=class{constructor(){this.temps=[],this.varyings=[],this.varyingDeclaration="",this.inputBlocks=[],this.textureBlocks=[],this.bindableBlocks=[],this.forcedBindableBlocks=[],this.blocksWithFallbacks=[],this.blocksWithDefines=[],this.repeatableContentBlocks=[],this.dynamicUniformBlocks=[],this.blockingBlocks=[],this.animatedInputs=[],this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}emitErrors(){let e="";this.checks.emitVertex||this.allowEmptyVertexProgram||(e+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\n"),this.checks.emitFragment||(e+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\n");for(const t of this.checks.notConnectedNonOptionalInputs)e+=`input ${t.name} from block ${t.ownerBlock.name}[${t.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(e)throw"Build of NodeMaterial failed:\n"+e}},MaterialDefines=class{reset(){this._keys.forEach((e=>this._setDefaultValue(e)))}get isDirty(){return this._isDirty}isEqual(e){if(this._keys.length!==e._keys.length)return!1;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];if(this[i]!==e[i])return!1}return!0}markAsLightDirty(e=!1){this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0}_setDefaultValue(e){const t=this._externalProperties?.[e]?.type??typeof this[e],i=this._externalProperties?.[e]?.default;switch(t){case"number":this[e]=i??0;break;case"string":this[e]=i??"";break;default:this[e]=i??!1}}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}cloneTo(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(let t=0;t<this._keys.length;t++){const i=this._keys[t];e[i]=this[i]}}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}constructor(e){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}rebuild(){this._keys.length=0;for(const e of Object.keys(this))"_"!==e[0]&&this._keys.push(e);if(this._externalProperties)for(const e in this._externalProperties)-1===this._keys.indexOf(e)&&this._keys.push(e)}toString(){let e="";for(let t=0;t<this._keys.length;t++){const i=this._keys[t],a=this[i];switch(typeof a){case"number":case"string":e+="#define "+i+" "+a+"\n";break;default:a&&(e+="#define "+i+"\n")}}return e}markAsUnprocessed(){this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}},NodeMaterialConnectionPointCompatibilityStates,NodeMaterialConnectionPointCompatibilityStates2,NodeMaterialConnectionPointDirection,NodeMaterialConnectionPointDirection2;NodeMaterialConnectionPointCompatibilityStates2=NodeMaterialConnectionPointCompatibilityStates||(NodeMaterialConnectionPointCompatibilityStates={}),NodeMaterialConnectionPointCompatibilityStates2[NodeMaterialConnectionPointCompatibilityStates2.Compatible=0]="Compatible",NodeMaterialConnectionPointCompatibilityStates2[NodeMaterialConnectionPointCompatibilityStates2.TypeIncompatible=1]="TypeIncompatible",NodeMaterialConnectionPointCompatibilityStates2[NodeMaterialConnectionPointCompatibilityStates2.TargetIncompatible=2]="TargetIncompatible",NodeMaterialConnectionPointCompatibilityStates2[NodeMaterialConnectionPointCompatibilityStates2.HierarchyIssue=3]="HierarchyIssue",NodeMaterialConnectionPointDirection2=NodeMaterialConnectionPointDirection||(NodeMaterialConnectionPointDirection={}),NodeMaterialConnectionPointDirection2[NodeMaterialConnectionPointDirection2.Input=0]="Input",NodeMaterialConnectionPointDirection2[NodeMaterialConnectionPointDirection2.Output=1]="Output";var NodeMaterialConnectionPoint=class e{get isConnectedToInputBlock(){return null!==this.connectedPoint&&this.connectedPoint.ownerBlock.isInput}get connectInputBlock(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null}get type(){if(this._type===NodeMaterialBlockConnectionPointTypes.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}if(this._type===NodeMaterialBlockConnectionPointTypes.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get _typeConnectionSource(){return this._typeConnectionSourceBackingField}static AreEquivalentTypes(e,t){switch(e){case NodeMaterialBlockConnectionPointTypes.Vector3:if(t===NodeMaterialBlockConnectionPointTypes.Color3)return!0;break;case NodeMaterialBlockConnectionPointTypes.Vector4:if(t===NodeMaterialBlockConnectionPointTypes.Color4)return!0;break;case NodeMaterialBlockConnectionPointTypes.Color3:if(t===NodeMaterialBlockConnectionPointTypes.Vector3)return!0;break;case NodeMaterialBlockConnectionPointTypes.Color4:if(t===NodeMaterialBlockConnectionPointTypes.Vector4)return!0}return!1}get connectedPoint(){return this._connectedPoint}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get _connectedPoint(){return this._connectedPointBackingField}_notifyTypeChanged(){this._isTypeChangeObservableNotifying||(this._isTypeChangeObservableNotifying=!0,this.onTypeChangedObservable.notifyObservers(this.type),this._isTypeChangeObservableNotifying=!1)}set _linkedConnectionSource(e){this._linkedConnectionSourceBackingField!==e&&(this._linkedConnectionSourceTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._linkedConnectionSourceBackingField=e)),this._linkedConnectionSourceBackingField&&(this._linkedConnectionSourceTypeChangedObserver=this._linkedConnectionSourceBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}get isConnectedInVertexShader(){if(this.target===NodeMaterialBlockTargets.Vertex)return!0;if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===NodeMaterialBlockTargets.Vertex)return!0;if(e.target===NodeMaterialBlockTargets.Vertex)return!0;if((e.ownerBlock.target===NodeMaterialBlockTargets.Neutral||e.ownerBlock.target===NodeMaterialBlockTargets.VertexAndFragment)&&e.ownerBlock.outputs.some((e=>e.isConnectedInVertexShader)))return!0}return!1}get _linkedConnectionSource(){return this._linkedConnectionSourceBackingField}constructor(e,t,i){this._connectedPointBackingField=null,this._endpoints=new Array,this._typeConnectionSourceBackingField=null,this._defaultConnectionPointTypeBackingField=null,this._linkedConnectionSourceBackingField=null,this._acceptedConnectionPointType=null,this._type=NodeMaterialBlockConnectionPointTypes.Float,this._enforceAssociatedVariableName=!1,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new Observable,this.onDisconnectionObservable=new Observable,this.onTypeChangedObservable=new Observable,this._isTypeChangeObservableNotifying=!1,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._prioritizeVertex=!1,this._target=NodeMaterialBlockTargets.VertexAndFragment,this._ownerBlock=t,this.name=e,this._direction=i}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((e=>e.ownerBlock))}addExcludedConnectionPointFromAllowedTypes(e){let t=1;for(;t<NodeMaterialBlockConnectionPointTypes.All;)e&t||this.excludedConnectionPointTypes.push(t),t<<=1}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear(),this.onTypeChangedObservable.clear(),this._connectedPoint=null,this._typeConnectionSource=null,this._linkedConnectionSource=null}createCustomInputBlock(){return null}get endpoints(){return this._endpoints}get declarationVariableName(){return this._ownerBlock.isInput?this._ownerBlock.declarationVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.declarationVariableName}get target(){return this._prioritizeVertex&&this._ownerBlock?this._target!==NodeMaterialBlockTargets.VertexAndFragment?this._target:this._ownerBlock.target===NodeMaterialBlockTargets.Fragment?NodeMaterialBlockTargets.Fragment:NodeMaterialBlockTargets.Vertex:this._target}set _typeConnectionSource(e){this._typeConnectionSourceBackingField!==e&&(this._typeConnectionSourceTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._typeConnectionSourceBackingField=e)),this._typeConnectionSourceBackingField&&(this._typeConnectionSourceTypeChangedObserver=this._typeConnectionSourceBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}set _defaultConnectionPointType(e){this._updateTypeDependentState((()=>this._defaultConnectionPointTypeBackingField=e))}get associatedVariableName(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName}_updateTypeDependentState(e){const t=this.type;e(),this.type!==t&&this._notifyTypeChanged()}checkCompatibilityState(t){const i=this._ownerBlock,a=t.ownerBlock;if(i.target===NodeMaterialBlockTargets.Fragment){if(a.target===NodeMaterialBlockTargets.Vertex)return 2;for(const e of a.outputs)if(e.ownerBlock.target!=NodeMaterialBlockTargets.Neutral&&e.isConnectedInVertexShader)return 2}if(this.type!==t.type&&t.innerType!==NodeMaterialBlockConnectionPointTypes.AutoDetect)return e.AreEquivalentTypes(this.type,t.type)||t.acceptedConnectionPointTypes&&-1!==t.acceptedConnectionPointTypes.indexOf(this.type)||t._acceptedConnectionPointType&&e.AreEquivalentTypes(t._acceptedConnectionPointType.type,this.type)?0:1;if(t.excludedConnectionPointTypes&&-1!==t.excludedConnectionPointTypes.indexOf(this.type))return 1;let n=a,s=i;return 0===this.direction&&(n=i,s=a),n.isAnAncestorOf(s)?3:0}canConnectTo(e){return 0===this.checkCompatibilityState(e)}set target(e){this._target=e}get innerType(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type}connectTo(e,t=!1){if(!t&&!this.canConnectTo(e))throw"Cannot connect these two connectors.";return this._endpoints.push(e),e._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this}disconnectFrom(e){const t=this._endpoints.indexOf(e);return-1===t||(this._endpoints.splice(t,1),e._connectedPoint=null,this._enforceAssociatedVariableName=!1,e._enforceAssociatedVariableName=!1,this.onDisconnectionObservable.notifyObservers(e),e.onDisconnectionObservable.notifyObservers(this)),this}set associatedVariableName(e){this._associatedVariableName=e}getClassName(){return"NodeMaterialConnectionPoint"}get direction(){return this._direction}get _defaultConnectionPointType(){return this._defaultConnectionPointTypeBackingField}set type(e){this._updateTypeDependentState((()=>this._type=e))}get ownerBlock(){return this._ownerBlock}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get isDirectlyConnectedToVertexOutput(){if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===NodeMaterialBlockTargets.Vertex)return!0;if((e.ownerBlock.target===NodeMaterialBlockTargets.Neutral||e.ownerBlock.target===NodeMaterialBlockTargets.VertexAndFragment)&&e.ownerBlock.outputs.some((e=>e.isDirectlyConnectedToVertexOutput)))return!0}return!1}get isConnectedInFragmentShader(){if(this.target===NodeMaterialBlockTargets.Fragment)return!0;if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===NodeMaterialBlockTargets.Fragment)return!0;if((e.ownerBlock.target===NodeMaterialBlockTargets.Neutral||e.ownerBlock.target===NodeMaterialBlockTargets.VertexAndFragment)&&e.ownerBlock.isConnectedInFragmentShader())return!0}return!1}serialize(e=!0){const t={};return t.name=this.name,t.displayName=this.displayName,e&&this.connectedPoint&&(t.inputName=this.name,t.targetBlockId=this.connectedPoint.ownerBlock.Hc,t.targetConnectionName=this.connectedPoint.name,t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),t}set _connectedPoint(e){this._connectedPointBackingField!==e&&(this._connectedPointTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._connectedPointBackingField=e)),this._connectedPointBackingField&&(this._connectedPointTypeChangedObserver=this._connectedPointBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}},UniqueIdGenerator=class{static get UniqueId(){const e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}};UniqueIdGenerator._UniqueIdCounter=1;var NodeMaterialBlock=class{_inputRename(e){return e}_customBuildStep(e,t){}get isInput(){return this._isInput}registerOutput(e,t,i,a){return(a=a??new NodeMaterialConnectionPoint(e,this,1)).type=t,i&&(a.target=i),this._outputs.push(a),this}getInputByName(e){const t=this._inputs.filter((t=>t.name===e));return t.length?t[0]:null}clone(e,t=""){const i=this.serialize(),a=GetClass(i.customType);if(a){const n=new a;return n._deserialize(i,e,t),n}return null}validateBlockName(e){const t=["position","normal","tangent","particle_positionw","uv","uv2","uv3","uv4","uv5","uv6","position2d","particle_uv","matricesIndices","matricesWeights","world0","world1","world2","world3","particle_color","particle_texturemask"];for(const i of t)if(e===i)return!1;return!0}_processBuild(e,t,i,a){e.build(t,a);const n=null!=t._vertexState,s=e._buildTarget===NodeMaterialBlockTargets.Vertex&&e.target!==NodeMaterialBlockTargets.VertexAndFragment;if(n&&(!(e.target&e._buildTarget)||!(e.target&i.target)||this.target!==NodeMaterialBlockTargets.VertexAndFragment&&s)&&(!e.isInput&&t.target!==e._buildTarget||e.isInput&&e.isAttribute&&!e._noContextSwitch)){const e=i.connectedPoint;if(t._vertexState._emitVaryingFromString("v_"+e.declarationVariableName,e.type)){const i=1===t.shaderLanguage?"vertexOutputs.":"";t._vertexState.compilationString+=`${i}${"v_"+e.declarationVariableName} = ${e.associatedVariableName};\n`}const a=1===t.shaderLanguage?"fragmentInputs.":"";i.associatedVariableName=a+"v_"+e.declarationVariableName,i._enforceAssociatedVariableName=!0}}getOutputByName(e){const t=this._outputs.filter((t=>t.name===e));return t.length?t[0]:null}get inputs(){return this._inputs}_outputRename(e){return e}_deserializePortDisplayNamesAndExposedOnFrame(e){const t=e.inputs,i=e.outputs;t&&t.forEach(((e,t)=>{e.displayName&&(this.inputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.inputs[t].isExposedOnFrame=e.isExposedOnFrame,this.inputs[t].exposedPortPosition=e.exposedPortPosition)})),i&&i.forEach(((e,t)=>{e.displayName&&(this.outputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.outputs[t].isExposedOnFrame=e.isExposedOnFrame,this.outputs[t].exposedPortPosition=e.exposedPortPosition)}))}getFirstAvailableOutput(e=null){for(const t of this._outputs)if(!e||!e.target||e.target===NodeMaterialBlockTargets.Neutral||e.target&t.target)return t;return null}get isTeleportOut(){return this._isTeleportOut}updateUniformsAndSamples(e,t,i,a){}_dumpPropertiesCode(){const e=this._codeVariableName;return`${e}.visibleInInspector = ${this.visibleInInspector};\n${e}.visibleOnFrame = ${this.visibleOnFrame};\n${e}.target = ${this.target};\n`}constructor(e,t=NodeMaterialBlockTargets.Vertex,i=!1){this._isFinalMerger=!1,this._isInput=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._name="",this._isUnique=!1,this._codeIsReady=!0,this.onCodeIsReadyObservable=new Observable,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.visibleInInspector=!1,this.visibleOnFrame=!1,this._target=t,this._originalTargetIsNeutral=t===NodeMaterialBlockTargets.Neutral,this._isFinalMerger=i,this._isInput="InputBlock"===this.getClassName(),this._isTeleportOut="NodeMaterialTeleportOutBlock"===this.getClassName(),this._isTeleportIn="NodeMaterialTeleportInBlock"===this.getClassName(),this._name=e,this.Hc=UniqueIdGenerator.UniqueId}build(e,t){if(this._buildId===e.sharedData.buildId)return!0;if(!this.isInput)for(const t of this._outputs)t.associatedVariableName||(t.associatedVariableName=e._getFreeVariableName(t.name));for(const i of this._inputs){if(!i.connectedPoint){i.isOptional||e.sharedData.checks.notConnectedNonOptionalInputs.push(i);continue}if(this.target!==NodeMaterialBlockTargets.Neutral){if(!(i.target&this.target))continue;if(!(i.target&e.target))continue}const a=i.connectedPoint.ownerBlock;a&&a!==this&&this._processBuild(a,e,i,t)}if(this._customBuildStep(e,t),this._buildId===e.sharedData.buildId)return!0;if(e.sharedData.verbose&&Logger.Log(`${e.target===NodeMaterialBlockTargets.Vertex?"Vertex shader":"Fragment shader"}: Building ${this.name} [${this.getClassName()}]`),this.isFinalMerger)switch(e.target){case NodeMaterialBlockTargets.Vertex:e.sharedData.checks.emitVertex=!0;break;case NodeMaterialBlockTargets.Fragment:e.sharedData.checks.emitFragment=!0}!this.isInput&&e.sharedData.emitComments&&(e.compilationString+=`\n//${this.name}\n`),this._buildBlock(e),this._buildId=e.sharedData.buildId,this._buildTarget=e.target;for(const i of this._outputs)if(i.target&e.target)for(const a of i.endpoints){const i=a.ownerBlock;i&&i.target&e.target&&-1!==t.indexOf(i)&&this._processBuild(i,e,a,t)}return!1}get buildId(){return this._buildId}_buildBlock(e){}get outputs(){return this._outputs}dispose(){this.onCodeIsReadyObservable.clear();for(const e of this.inputs)e.dispose();for(const e of this.outputs)e.dispose()}get target(){return this._target}serialize(){const e={};e.customType="BABYLON."+this.getClassName(),e.id=this.Hc,e.name=this.name,e.comments=this.comments,e.visibleInInspector=this.visibleInInspector,e.visibleOnFrame=this.visibleOnFrame,e.target=this.target,e.inputs=[],e.outputs=[];for(const t of this.inputs)e.inputs.push(t.serialize());for(const t of this.outputs)e.outputs.push(t.serialize(!1));return e}getFirstAvailableInput(e=null){for(const t of this._inputs)if(!(t.connectedPoint||e&&e.type!==t.type&&t.type!==NodeMaterialBlockConnectionPointTypes.AutoDetect))return t;return null}getSiblingOutput(e){const t=this._outputs.indexOf(e);return-1===t||t>=this._outputs.length?null:this._outputs[t+1]}get name(){return this._name}prepareDefines(e,t,i,a=!1,n){}initialize(e){}get isTeleportIn(){return this._isTeleportIn}_linkConnectionTypes(e,t,i=!1){i?this._inputs[t]._acceptedConnectionPointType=this._inputs[e]:this._inputs[e]._linkedConnectionSource=this._inputs[t],this._inputs[t]._linkedConnectionSource=this._inputs[e]}get willBeGeneratedIntoVertexShaderFromFragmentShader(){return!this.isInput&&!this.isFinalMerger&&(!this._outputs.some((e=>e.isDirectlyConnectedToVertexOutput))&&(this.target!==NodeMaterialBlockTargets.Vertex&&!(this.target!==NodeMaterialBlockTargets.VertexAndFragment&&this.target!==NodeMaterialBlockTargets.Neutral||!this._outputs.some((e=>e.isConnectedInVertexShader)))))}registerInput(e,t,i=!1,a,n){return(n=n??new NodeMaterialConnectionPoint(e,this,0)).type=t,n.isOptional=i,a&&(n.target=a),this._inputs.push(n),this}isConnectedInFragmentShader(){return this.outputs.some((e=>e.isConnectedInFragmentShader))}isReady(e,t,i,a=!1){return!0}_writeVariable(e){return e.connectedPoint?`${e.associatedVariableName}`:"0."}_deserialize(e,t,i,a){this.name=e.name,this.comments=e.comments,this.visibleInInspector=!!e.visibleInInspector,this.visibleOnFrame=!!e.visibleOnFrame,this._target=e.target??this.target,this._deserializePortDisplayNamesAndExposedOnFrame(e)}set buildId(e){this._buildId=e}isAnAncestorOf(e){for(const t of this._outputs)if(t.hasEndpoints)for(const i of t.endpoints){if(i.ownerBlock===e)return!0;if(i.ownerBlock.isAnAncestorOf(e))return!0}return!1}getClassName(){return"NodeMaterialBlock"}_dumpCodeForOutputConnections(e){let t="";if(-1!==e.indexOf(this))return t;e.push(this);for(const i of this.inputs){if(!i.isConnected)continue;const a=i.connectedPoint,n=a.ownerBlock;t+=n._dumpCodeForOutputConnections(e),t+=`${n._codeVariableName}.${n._outputRename(a.name)}.connectTo(${this._codeVariableName}.${this._inputRename(i.name)});\n`}return t}_setInitialTarget(e){this._target=e,this._originalTargetIsNeutral=e===NodeMaterialBlockTargets.Neutral}provideFallbacks(e,t){}initializeDefines(e,t,i,a=!1){}connectTo(e,t){if(0===this._outputs.length)return;let i=t&&t.output?this.getOutputByName(t.output):this.getFirstAvailableOutput(e),a=!0;for(;a;){const n=t&&t.input?e.getInputByName(t.input):e.getFirstAvailableInput(i);if(i&&n&&i.canConnectTo(n))i.connectTo(n),a=!1;else{if(!i)throw"Unable to find a compatible match";i=this.getSiblingOutput(i)}}return this}get isFinalMerger(){return this._isFinalMerger}autoConfigure(e,t=()=>!0){}_writeFloat(e){let t=e.toString();return-1===t.indexOf(".")&&(t+=".0"),`${t}`}replaceRepeatableContent(e,t,i,a){}bind(e,t,i,a){}set target(e){this._target&e||(this._target=e)}set name(e){this.validateBlockName(e)&&(this._name=e)}_dumpCode(e,t){t.push(this);const i=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=i||`${this.getClassName()}_${this.Hc}`,-1!==e.indexOf(this._codeVariableName)){let t=0;do{t++,this._codeVariableName=i+t}while(-1!==e.indexOf(this._codeVariableName))}e.push(this._codeVariableName);let a=`\n// ${this.getClassName()}\n`;this.comments&&(a+=`// ${this.comments}\n`),a+=`var ${this._codeVariableName} = new BABYLON.${this.getClassName()}("${this.name}");\n`,a+=this._dumpPropertiesCode();for(const i of this.inputs){if(!i.isConnected)continue;const n=i.connectedPoint.ownerBlock;-1===t.indexOf(n)&&(a+=n._dumpCode(e,t))}for(const i of this.outputs)if(i.hasEndpoints)for(const n of i.endpoints){const i=n.ownerBlock;i&&-1===t.indexOf(i)&&(a+=i._dumpCode(e,t))}return a}get codeIsReady(){return this._codeIsReady}get isUnique(){return this._isUnique}},TransformBlock=class extends NodeMaterialBlock{_deserialize(e,t,i){super._deserialize(e,t,i),this.complementZ=void 0!==e.complementZ?e.complementZ:0,this.complementW=void 0!==e.complementW?e.complementW:1}get output(){return this._outputs[0]}get vector(){return this._inputs[0]}get transform(){return this._inputs[1]}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.complementZ = ${this.complementZ};\n`;return e+=`${this._codeVariableName}.complementW = ${this.complementW};\n`,e}prepareDefines(e,t,i){e.nonUniformScaling&&i.setValue("NONUNIFORMSCALING",!0)}get xyz(){return this._outputs[1]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.complementW=1,this.complementZ=0,this.target=NodeMaterialBlockTargets.Vertex,this.registerInput("vector",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("transform",NodeMaterialBlockConnectionPointTypes.Matrix),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerOutput("xyz",NodeMaterialBlockConnectionPointTypes.Vector3),this._inputs[0].onConnectionObservable.add((e=>{if(e.ownerBlock.isInput){const t=e.ownerBlock;"normal"!==t.name&&"tangent"!==t.name||(this.complementW=0)}}))}getClassName(){return"TransformBlock"}serialize(){const e=super.serialize();return e.complementZ=this.complementZ,e.complementW=this.complementW,e}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=this.transform,a=e._getShaderType(NodeMaterialBlockConnectionPointTypes.Vector4),n=e._getShaderType(NodeMaterialBlockConnectionPointTypes.Vector3);if(t.connectedPoint){if(0===this.complementW){const s=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",s),e.sharedData.blocksWithDefines.push(this);const r=e._getFreeVariableName(`${i.associatedVariableName}_NUS`);switch(1===e.shaderLanguage?e.compilationString+=`var ${r}: mat3x3f = mat3x3f(${i.associatedVariableName}[0].xyz, ${i.associatedVariableName}[1].xyz, ${i.associatedVariableName}[2].xyz);\n`:e.compilationString+=`mat3 ${r} = mat3(${i.associatedVariableName});\n`,e.compilationString+="#ifdef NONUNIFORMSCALING\n",e.compilationString+=`${r} = transposeMat3(inverseMat3(${r}));\n`,e.compilationString+="#endif\n",t.connectedPoint.type){case NodeMaterialBlockConnectionPointTypes.Vector2:e.compilationString+=e._declareOutput(this.output)+` = ${a}(${r} * ${n}(${t.associatedVariableName}, ${this._writeFloat(this.complementZ)}), ${this._writeFloat(this.complementW)});\n`;break;case NodeMaterialBlockConnectionPointTypes.Vector3:case NodeMaterialBlockConnectionPointTypes.Color3:e.compilationString+=e._declareOutput(this.output)+` = ${a}(${r} * ${t.associatedVariableName}, ${this._writeFloat(this.complementW)});\n`;break;default:e.compilationString+=e._declareOutput(this.output)+` = ${a}(${r} * ${t.associatedVariableName}.xyz, ${this._writeFloat(this.complementW)});\n`}}else{const n=i.associatedVariableName;switch(t.connectedPoint.type){case NodeMaterialBlockConnectionPointTypes.Vector2:e.compilationString+=e._declareOutput(this.output)+` = ${n} * ${a}(${t.associatedVariableName}, ${this._writeFloat(this.complementZ)}, ${this._writeFloat(this.complementW)});\n`;break;case NodeMaterialBlockConnectionPointTypes.Vector3:case NodeMaterialBlockConnectionPointTypes.Color3:e.compilationString+=e._declareOutput(this.output)+` = ${n} * ${a}(${t.associatedVariableName}, ${this._writeFloat(this.complementW)});\n`;break;default:e.compilationString+=e._declareOutput(this.output)+` = ${n} * ${t.associatedVariableName};\n`}}this.xyz.hasEndpoints&&(e.compilationString+=e._declareOutput(this.xyz)+` = ${this.output.associatedVariableName}.xyz;\n`)}return this}};RegisterClass("BABYLON.TransformBlock",TransformBlock);var VertexOutputBlock=class extends NodeMaterialBlock{constructor(e){super(e,NodeMaterialBlockTargets.Vertex,!0),this.registerInput("vector",NodeMaterialBlockConnectionPointTypes.Vector4)}get vector(){return this._inputs[0]}_isLogarithmicDepthEnabled(e,t){if(t)return!0;for(const t of e)if(t.useLogarithmicDepth)return!0;return!1}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=1===e.shaderLanguage;if(1===e.shaderLanguage?e.compilationString+=`vertexOutputs.position = ${t.associatedVariableName};\n`:e.compilationString+=`gl_Position = ${t.associatedVariableName};\n`,this._isLogarithmicDepthEnabled(e.sharedData.fragmentOutputNodes,e.sharedData.nodeMaterial.useLogarithmicDepth)){e._emitUniformFromString("logarithmicDepthConstant",NodeMaterialBlockConnectionPointTypes.Float),e._emitVaryingFromString("vFragmentDepth",NodeMaterialBlockConnectionPointTypes.Float);const t=i?"vertexOutputs.vFragmentDepth":"vFragmentDepth",a=i?"uniforms.":"",n=i?"vertexOutputs.position":"gl_Position";e.compilationString+=`${t} = 1.0 + ${n}.w;\n`,e.compilationString+=`${n}.z = log2(max(0.000001, ${t})) * ${a}logarithmicDepthConstant;\n`}return this}getClassName(){return"VertexOutputBlock"}},PropertyTypeForEdition,PropertyTypeForEdition2;function editableInPropertyPage(e,t=0,i="PROPERTIES",a){return(n,s)=>{let r=n._propStore;r||(r=[],n._propStore=r),r.push({propertyName:s,displayName:e,type:t,groupName:i,options:a??{}})}}RegisterClass("BABYLON.VertexOutputBlock",VertexOutputBlock),PropertyTypeForEdition2=PropertyTypeForEdition||(PropertyTypeForEdition={}),PropertyTypeForEdition2[PropertyTypeForEdition2.Boolean=0]="Boolean",PropertyTypeForEdition2[PropertyTypeForEdition2.Float=1]="Float",PropertyTypeForEdition2[PropertyTypeForEdition2.Int=2]="Int",PropertyTypeForEdition2[PropertyTypeForEdition2.Vector2=3]="Vector2",PropertyTypeForEdition2[PropertyTypeForEdition2.List=4]="List";var FragmentOutputBlock=class extends NodeMaterialBlock{get a(){return this._inputs[2]}_buildBlock(e){super._buildBlock(e);const t=this.rgba,i=this.rgb,a=this.a,n=1===e.shaderLanguage;e.sharedData.hints.needAlphaBlending=t.isConnected||a.isConnected,e.sharedData.blocksWithDefines.push(this),(this.useLogarithmicDepth||e.sharedData.nodeMaterial.useLogarithmicDepth)&&(e._emitUniformFromString("logarithmicDepthConstant",NodeMaterialBlockConnectionPointTypes.Float),e._emitVaryingFromString("vFragmentDepth",NodeMaterialBlockConnectionPointTypes.Float),e.sharedData.bindableBlocks.push(this)),this._linearDefineName=e._getFreeDefineName("CONVERTTOLINEAR"),this._gammaDefineName=e._getFreeDefineName("CONVERTTOGAMMA");const s=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",s);let r="gl_FragColor";1===e.shaderLanguage&&(e.compilationString+="var fragmentOutputsColor : vec4<f32>;\r\n",r="fragmentOutputsColor");const o=e._getShaderType(NodeMaterialBlockConnectionPointTypes.Vector4);if(t.connectedPoint)a.isConnected?e.compilationString+=`${r} = ${o}(${t.associatedVariableName}.rgb, ${a.associatedVariableName});\n`:e.compilationString+=`${r}  = ${t.associatedVariableName};\n`;else if(i.connectedPoint){let t="1.0";a.connectedPoint&&(t=a.associatedVariableName),i.connectedPoint.type===NodeMaterialBlockConnectionPointTypes.Float?e.compilationString+=`${r}  = ${o}(${i.associatedVariableName}, ${i.associatedVariableName}, ${i.associatedVariableName}, ${t});\n`:e.compilationString+=`${r}  = ${o}(${i.associatedVariableName}, ${t});\n`}else e.sharedData.checks.notConnectedNonOptionalInputs.push(t);if(e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${r}  = toLinearSpace(${r});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${r}  = toGammaSpace(${r});\n`,e.compilationString+="#endif\n",1===e.shaderLanguage&&(e.compilationString+="#if !defined(PREPASS)\r\n",e.compilationString+="fragmentOutputs.color = fragmentOutputsColor;\r\n",e.compilationString+="#endif\r\n"),this.useLogarithmicDepth||e.sharedData.nodeMaterial.useLogarithmicDepth){const t=n?"input.vFragmentDepth":"vFragmentDepth",i=n?"uniforms.":"",a=n?"fragmentOutputs.fragDepth":"gl_FragDepthEXT";e.compilationString+=`${a} = log2(${t}) * ${i}logarithmicDepthConstant * 0.5;\n`}return e.compilationString+="#if defined(PREPASS)\r\n",e.compilationString+=`${n?"fragmentOutputs.fragData0":"gl_FragData[0]"} = ${r};\r\n`,e.compilationString+="#endif\r\n",this}get rgba(){return this._inputs[0]}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.convertToGammaSpace = ${this.convertToGammaSpace};\n`,e+=`${this._codeVariableName}.convertToLinearSpace = ${this.convertToLinearSpace};\n`,e+=`${this._codeVariableName}.useLogarithmicDepth = ${this.useLogarithmicDepth};\n`,e}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.useLogarithmicDepth=this.useLogarithmicDepth,e}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToLinearSpace,!0),i.setValue(this._gammaDefineName,this.convertToGammaSpace,!0)}bind(e,t,i){(this.useLogarithmicDepth||t.useLogarithmicDepth)&&i&&BindLogDepth(void 0,e,i.getScene())}constructor(e){super(e,NodeMaterialBlockTargets.Fragment,!0),this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this.useLogarithmicDepth=!1,this.registerInput("rgba",NodeMaterialBlockConnectionPointTypes.Color4,!0),this.registerInput("rgb",NodeMaterialBlockConnectionPointTypes.AutoDetect,!0),this.registerInput("a",NodeMaterialBlockConnectionPointTypes.Float,!0),this.rgb.addExcludedConnectionPointFromAllowedTypes(NodeMaterialBlockConnectionPointTypes.Color3|NodeMaterialBlockConnectionPointTypes.Vector3|NodeMaterialBlockConnectionPointTypes.Float)}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this.useLogarithmicDepth=e.useLogarithmicDepth??!1}get rgb(){return this._inputs[1]}initialize(e){e._excludeVariableName("logarithmicDepthConstant"),e._excludeVariableName("vFragmentDepth")}getClassName(){return"FragmentOutputBlock"}},NodeMaterialSystemValues,NodeMaterialSystemValues2,Orientation,Orientation2;__decorate([editableInPropertyPage("Convert to gamma space",0,"PROPERTIES",{notifiers:{update:!0}})],FragmentOutputBlock.prototype,"convertToGammaSpace",void 0),__decorate([editableInPropertyPage("Convert to linear space",0,"PROPERTIES",{notifiers:{update:!0}})],FragmentOutputBlock.prototype,"convertToLinearSpace",void 0),__decorate([editableInPropertyPage("Use logarithmic depth",0,"PROPERTIES")],FragmentOutputBlock.prototype,"useLogarithmicDepth",void 0),RegisterClass("BABYLON.FragmentOutputBlock",FragmentOutputBlock),NodeMaterialSystemValues2=NodeMaterialSystemValues||(NodeMaterialSystemValues={}),NodeMaterialSystemValues2[NodeMaterialSystemValues2.World=1]="World",NodeMaterialSystemValues2[NodeMaterialSystemValues2.View=2]="View",NodeMaterialSystemValues2[NodeMaterialSystemValues2.Projection=3]="Projection",NodeMaterialSystemValues2[NodeMaterialSystemValues2.ViewProjection=4]="ViewProjection",NodeMaterialSystemValues2[NodeMaterialSystemValues2.WorldView=5]="WorldView",NodeMaterialSystemValues2[NodeMaterialSystemValues2.WorldViewProjection=6]="WorldViewProjection",NodeMaterialSystemValues2[NodeMaterialSystemValues2.CameraPosition=7]="CameraPosition",NodeMaterialSystemValues2[NodeMaterialSystemValues2.FogColor=8]="FogColor",NodeMaterialSystemValues2[NodeMaterialSystemValues2.DeltaTime=9]="DeltaTime",NodeMaterialSystemValues2[NodeMaterialSystemValues2.CameraParameters=10]="CameraParameters",NodeMaterialSystemValues2[NodeMaterialSystemValues2.MaterialAlpha=11]="MaterialAlpha",Orientation2=Orientation||(Orientation={}),Orientation2[Orientation2.CW=0]="CW",Orientation2[Orientation2.CCW=1]="CCW";var Angle=class e{static FromDegrees(t){return new e(t*Math.PI/180)}static FromRadians(t){return new e(t)}radians(){return this._radians}static BetweenTwoVectors(t,i){let a=t.lengthSquared()*i.lengthSquared();if(0===a)return new e(Math.PI/2);a=Math.sqrt(a);let n=t.dot(i)/a;n=Scalar.Clamp(n,-1,1);const s=Math.acos(n);return new e(s)}degrees(){return 180*this._radians/Math.PI}constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}static BetweenTwoPoints(t,i){const a=i.subtract(t),n=Math.atan2(a.y,a.x);return new e(n)}},Arc2=class{constructor(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;const a=Math.pow(t.x,2)+Math.pow(t.y,2),n=(Math.pow(e.x,2)+Math.pow(e.y,2)-a)/2,s=(a-Math.pow(i.x,2)-Math.pow(i.y,2))/2,r=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new Vector2((n*(t.y-i.y)-s*(e.y-t.y))/r,((e.x-t.x)*s-(t.x-i.x)*n)/r),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);const o=this.startAngle.degrees();let l=Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();l-o>180&&(l-=360),l-o<-180&&(l+=360),c-l>180&&(c-=360),c-l<-180&&(c+=360),this.orientation=l-o<0?0:1,this.angle=Angle.FromDegrees(0===this.orientation?o-c:c-o)}},Path2=class e{static StartingAt(t,i){return new e(t,i)}addArcTo(e,t,i,a,n=36){if(this.closed)return this;const s=this._points[this._points.length-1],r=new Vector2(e,t),o=new Vector2(i,a),l=new Arc2(s,r,o);let c=l.angle.radians()/n;0===l.orientation&&(c*=-1);let h=l.startAngle.radians()+c;for(let e=0;e<n;e++){const e=Math.cos(h)*l.radius+l.centerPoint.x,t=Math.sin(h)*l.radius+l.centerPoint.y;this.addLineTo(e,t),h+=c}return this}isPointInside(e){let t=!1;const i=this._points.length;for(let a=i-1,n=0;n<i;a=n++){let i=this._points[a],s=this._points[n],r=s.x-i.x,o=s.y-i.y;if(Math.abs(o)>Number.EPSILON){if(o<0&&(i=this._points[n],r=-r,s=this._points[a],o=-o),e.y<i.y||e.y>s.y)continue;if(e.y===i.y&&e.x===i.x)return!0;{const a=o*(e.x-i.x)-r*(e.y-i.y);if(0===a)return!0;if(a<0)continue;t=!t}}else{if(e.y!==i.y)continue;if(s.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=s.x)return!0}}return t}addQuadraticCurveTo(e,t,i,a,n=36){if(this.closed)return this;const s=(e,t,i,a)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*a,r=this._points[this._points.length-1];for(let o=0;o<=n;o++){const l=o/n,c=s(l,r.x,e,i),h=s(l,r.y,t,a);this.addLineTo(c,h)}return this}constructor(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new Vector2(e,t))}getPointAtLengthPosition(e){if(e<0||e>1)return Vector2.Zero();const t=e*this.length();let i=0;for(let e=0;e<this._points.length;e++){const a=(e+1)%this._points.length,n=this._points[e],s=this._points[a].subtract(n),r=s.length()+i;if(t>=i&&t<=r){const e=s.normalize(),a=t-i;return new Vector2(n.x+e.x*a,n.y+e.y*a)}i=r}return Vector2.Zero()}addBezierCurveTo(e,t,i,a,n,s,r=36){if(this.closed)return this;const o=(e,t,i,a,n)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*a+e*e*e*n,l=this._points[this._points.length-1];for(let c=0;c<=r;c++){const h=c/r,u=o(h,l.x,e,i,n),m=o(h,l.y,t,a,s);this.addLineTo(u,m)}return this}close(){return this.closed=!0,this}getPoints(){return this._points}area(){const e=this._points.length;let t=0;for(let i=e-1,a=0;a<e;i=a++)t+=this._points[i].x*this._points[a].y-this._points[a].x*this._points[i].y;return.5*t}addLineTo(e,t){if(this.closed)return this;const i=new Vector2(e,t),a=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(a).length(),this}length(){let e=this._length;if(this.closed){const t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e}},Path3D=class e{getNormals(){return this._normals}getTangents(){return this._tangents}_getFirstNonNullVector(e){let t=1,i=this._curve[e+t].subtract(this._curve[e]);for(;0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i}_getLastNonNullVector(e){let t=1,i=this._curve[e].subtract(this._curve[e-t]);for(;0===i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i}_setPointAtData(e,t,i,a,n){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=a,this._pointAtData.interpolateReady=n,n&&this._updateInterpolationMatrix(),this._pointAtData}getTangentAt(e,t=!1){return this._updatePointAtData(e,t),t?Vector3.TransformCoordinates(Vector3.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}slice(t=0,i=1){if(t<0&&(t=1- -1*t%1),i<0&&(i=1- -1*i%1),t>i){const e=t;t=i,i=e}const a=this.getCurve(),n=this.getPointAt(t);let s=this.getPreviousPointIndexAt(t);const r=this.getPointAt(i),o=this.getPreviousPointIndexAt(i)+1,l=[];return 0!==t&&(s++,l.push(n)),l.push(...a.slice(s,o)),1===i&&1!==t||l.push(r),new e(l,this.getNormalAt(t),this._raw,this._alignTangentsWithPath)}getPoints(){return this._curve}getBinormals(){return this._binormals}update(e,t=null,i=!1){for(let t=0;t<e.length;t++)this._curve[t].x=e[t].x,this._curve[t].y=e[t].y,this._curve[t].z=e[t].z;return this._compute(t,i),this}getClosestPositionTo(e){let t=Number.MAX_VALUE,i=0;for(let a=0;a<this._curve.length-1;a++){const n=this._curve[a+0],s=this._curve[a+1].subtract(n).normalize(),r=this._distances[a+1]-this._distances[a+0],o=Math.min(Math.max(Vector3.Dot(s,e.subtract(n).normalize()),0)*Vector3.Distance(n,e)/r,1),l=Vector3.Distance(n.add(s.scale(o*r)),e);l<t&&(t=l,i=(this._distances[a+0]+r*o)/this.length())}return i}_normalVector(e,t){let i,a=e.length();if(0===a&&(a=1),null==t){let t;t=Scalar.WithinEpsilon(Math.abs(e.y)/a,1,Epsilon)?Scalar.WithinEpsilon(Math.abs(e.x)/a,1,Epsilon)?Scalar.WithinEpsilon(Math.abs(e.z)/a,1,Epsilon)?Vector3.Zero():new Vector3(0,0,1):new Vector3(1,0,0):new Vector3(0,-1,0),i=Vector3.Cross(e,t)}else i=Vector3.Cross(e,t),Vector3.CrossToRef(i,e,i);return i.normalize(),i}_compute(e,t=!1){const i=this._curve.length;if(i<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();const a=this._tangents[0],n=this._normalVector(a,e);let s,r,o,l,c;this._normals[0]=n,this._raw||this._normals[0].normalize(),this._binormals[0]=Vector3.Cross(a,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let e=1;e<i;e++)s=this._getLastNonNullVector(e),e<i-1&&(r=this._getFirstNonNullVector(e),this._tangents[e]=t?r:s.add(r),this._tangents[e].normalize()),this._distances[e]=this._distances[e-1]+this._curve[e].subtract(this._curve[e-1]).length(),o=this._tangents[e],c=this._binormals[e-1],this._normals[e]=Vector3.Cross(c,o),this._raw||(0===this._normals[e].length()?(l=this._normals[e-1],this._normals[e]=l.clone()):this._normals[e].normalize()),this._binormals[e]=Vector3.Cross(o,this._normals[e]),this._raw||this._binormals[e].normalize();this._pointAtData.id=NaN}getCurve(){return this._curve}getBinormalAt(e,t=!1){return this._updatePointAtData(e,t),t?Vector3.TransformCoordinates(Vector3.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}_updatePointAtData(e,t=!1){if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;const i=this.getPoints();if(e<=0)return this._setPointAtData(0,0,i[0],0,t);if(e>=1)return this._setPointAtData(1,1,i[i.length-1],i.length-1,t);let a,n=i[0],s=0;const r=e*this.length();for(let o=1;o<i.length;o++){a=i[o];const l=Vector3.Distance(n,a);if(s+=l,s===r)return this._setPointAtData(e,1,a,o,t);if(s>r){const i=(s-r)/l,c=n.subtract(a),h=a.add(c.scaleInPlace(i));return this._setPointAtData(e,1-i,h,o-1,t)}n=a}return this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=Matrix.Identity();const e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){const t=e+1,i=this._tangents[e].clone(),a=this._normals[e].clone(),n=this._binormals[e].clone(),s=this._tangents[t].clone(),r=this._normals[t].clone(),o=this._binormals[t].clone(),l=Quaternion.RotationQuaternionFromAxis(a,n,i),c=Quaternion.RotationQuaternionFromAxis(r,o,s);Quaternion.Slerp(l,c,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}getDistances(){return this._distances}getNormalAt(e,t=!1){return this._updatePointAtData(e,t),t?Vector3.TransformCoordinates(Vector3.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}constructor(e,t=null,i,a=!1){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:Vector3.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:Matrix.Identity()};for(let t=0;t<e.length;t++)this._curve[t]=e[t].clone();this._raw=i||!1,this._alignTangentsWithPath=a,this._compute(t,a)}getPointAt(e){return this._updatePointAtData(e).point}length(){return this._distances[this._distances.length-1]}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getDistanceAt(e){return this.length()*e}},Size=class e{static Zero(){return new e(0,0)}constructor(e,t){this.width=e,this.height=t}multiplyByFloats(t,i){return new e(this.width*t,this.height*i)}copyFrom(e){this.width=e.width,this.height=e.height}clone(){return new e(this.width,this.height)}set(e,t){return this.copyFromFloats(e,t)}add(t){return new e(this.width+t.width,this.height+t.height)}getHashCode(){let e=0|this.width;return e=397*e^this.height,e}getClassName(){return"Size"}toString(){return`{W: ${this.width}, H: ${this.height}}`}static Lerp(t,i,a){const n=t.width+(i.width-t.width)*a,s=t.height+(i.height-t.height)*a;return new e(n,s)}copyFromFloats(e,t){return this.width=e,this.height=t,this}equals(e){return!!e&&(this.width===e.width&&this.height===e.height)}scale(t){return new e(this.width*t,this.height*t)}subtract(t){return new e(this.width-t.width,this.height-t.height)}get surface(){return this.width*this.height}},AnimatedInputBlockTypes,AnimatedInputBlockTypes2;AnimatedInputBlockTypes2=AnimatedInputBlockTypes||(AnimatedInputBlockTypes={}),AnimatedInputBlockTypes2[AnimatedInputBlockTypes2.None=0]="None",AnimatedInputBlockTypes2[AnimatedInputBlockTypes2.Time=1]="Time",AnimatedInputBlockTypes2[AnimatedInputBlockTypes2.RealTime=2]="RealTime",AnimatedInputBlockTypes2[AnimatedInputBlockTypes2.MouseInfo=3]="MouseInfo";var remapAttributeName={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},attributeInFragmentOnly={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},attributeAsUniform={particle_texturemask:!0},InputBlock=class extends NodeMaterialBlock{get _noContextSwitch(){return attributeInFragmentOnly[this.name]}_emitConstant(e){switch(this.type){case NodeMaterialBlockConnectionPointTypes.Float:return`${e._emitFloat(this.value)}`;case NodeMaterialBlockConnectionPointTypes.Vector2:return`vec2(${this.value.x}, ${this.value.y})`;case NodeMaterialBlockConnectionPointTypes.Vector3:return`vec3(${this.value.x}, ${this.value.y}, ${this.value.z})`;case NodeMaterialBlockConnectionPointTypes.Vector4:return`vec4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;case NodeMaterialBlockConnectionPointTypes.Color3:return TmpColors.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&TmpColors.Color3[0].toGammaSpaceToRef(TmpColors.Color3[0],e.sharedData.scene.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&TmpColors.Color3[0].toLinearSpaceToRef(TmpColors.Color3[0],e.sharedData.scene.getEngine().useExactSrgbConversions),`vec3(${TmpColors.Color3[0].r}, ${TmpColors.Color3[0].g}, ${TmpColors.Color3[0].b})`;case NodeMaterialBlockConnectionPointTypes.Color4:return TmpColors.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&TmpColors.Color4[0].toGammaSpaceToRef(TmpColors.Color4[0],e.sharedData.scene.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&TmpColors.Color4[0].toLinearSpaceToRef(TmpColors.Color4[0],e.sharedData.scene.getEngine().useExactSrgbConversions),`vec4(${TmpColors.Color4[0].r}, ${TmpColors.Color4[0].g}, ${TmpColors.Color4[0].b}, ${TmpColors.Color4[0].a})`}return""}initialize(){this.associatedVariableName=""}get type(){if(this._type===NodeMaterialBlockConnectionPointTypes.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=NodeMaterialBlockConnectionPointTypes.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=NodeMaterialBlockConnectionPointTypes.Vector2,this._type;case"Vector3":return this._type=NodeMaterialBlockConnectionPointTypes.Vector3,this._type;case"Vector4":return this._type=NodeMaterialBlockConnectionPointTypes.Vector4,this._type;case"Color3":return this._type=NodeMaterialBlockConnectionPointTypes.Color3,this._type;case"Color4":return this._type=NodeMaterialBlockConnectionPointTypes.Color4,this._type;case"Matrix":return this._type=NodeMaterialBlockConnectionPointTypes.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"particle_positionw":return this._type=NodeMaterialBlockConnectionPointTypes.Vector3,this._type;case"uv":case"uv2":case"uv3":case"uv4":case"uv5":case"uv6":case"position2d":case"particle_uv":return this._type=NodeMaterialBlockConnectionPointTypes.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"matricesIndicesExtra":case"matricesWeightsExtra":case"world0":case"world1":case"world2":case"world3":case"tangent":return this._type=NodeMaterialBlockConnectionPointTypes.Vector4,this._type;case"color":case"instanceColor":case"particle_color":case"particle_texturemask":return this._type=NodeMaterialBlockConnectionPointTypes.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case NodeMaterialSystemValues.World:case NodeMaterialSystemValues.WorldView:case NodeMaterialSystemValues.WorldViewProjection:case NodeMaterialSystemValues.View:case NodeMaterialSystemValues.ViewProjection:case NodeMaterialSystemValues.Projection:return this._type=NodeMaterialBlockConnectionPointTypes.Matrix,this._type;case NodeMaterialSystemValues.CameraPosition:return this._type=NodeMaterialBlockConnectionPointTypes.Vector3,this._type;case NodeMaterialSystemValues.FogColor:return this._type=NodeMaterialBlockConnectionPointTypes.Color3,this._type;case NodeMaterialSystemValues.DeltaTime:case NodeMaterialSystemValues.MaterialAlpha:return this._type=NodeMaterialBlockConnectionPointTypes.Float,this._type;case NodeMaterialSystemValues.CameraParameters:return this._type=NodeMaterialBlockConnectionPointTypes.Vector4,this._type}}return this._type}setDefaultValue(){switch(this.type){case NodeMaterialBlockConnectionPointTypes.Float:this.value=0;break;case NodeMaterialBlockConnectionPointTypes.Vector2:this.value=Vector2.Zero();break;case NodeMaterialBlockConnectionPointTypes.Vector3:this.value=Vector3.Zero();break;case NodeMaterialBlockConnectionPointTypes.Vector4:this.value=Vector4.Zero();break;case NodeMaterialBlockConnectionPointTypes.Color3:this.value=Color3.White();break;case NodeMaterialBlockConnectionPointTypes.Color4:this.value=new Color4(1,1,1,1);break;case NodeMaterialBlockConnectionPointTypes.Matrix:this.value=Matrix.Identity()}}get isVarying(){return 2===this._mode}get isSystemValue(){return null!=this._systemValue}_deserialize(e,t,i){if(this._mode=e.mode,super._deserialize(e,t,i),this._type=e.type,this._systemValue=e.systemValue||e.wellKnownValue,this._animationType=e.animationType,this.min=e.min||0,this.max=e.max||0,this.isBoolean=!!e.isBoolean,this.matrixMode=e.matrixMode||0,this.isConstant=!!e.isConstant,this.groupInInspector=e.groupInInspector||"",this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,"tangent"===e.name&&1===e.mode&&e.type===NodeMaterialBlockConnectionPointTypes.Vector3&&(this._type=NodeMaterialBlockConnectionPointTypes.Vector4),e.valueType)if("number"===e.valueType)this._storedValue=e.value;else{const t=GetClass(e.valueType);t&&(this._storedValue=t.FromArray(e.value))}}get animationType(){return this._animationType}validateBlockName(e){return!!this.isAttribute||super.validateBlockName(e)}_dumpPropertiesCode(){const e=this._codeVariableName;if(this.isAttribute)return super._dumpPropertiesCode()+`${e}.setAsAttribute("${this.name}");\n`;if(this.isSystemValue)return super._dumpPropertiesCode()+`${e}.setAsSystemValue(BABYLON.NodeMaterialSystemValues.${NodeMaterialSystemValues[this._systemValue]});\n`;if(this.isUniform){const t=[];let i="";switch(this.type){case NodeMaterialBlockConnectionPointTypes.Float:i=`${this.value}`;break;case NodeMaterialBlockConnectionPointTypes.Vector2:i=`new BABYLON.Vector2(${this.value.x}, ${this.value.y})`;break;case NodeMaterialBlockConnectionPointTypes.Vector3:i=`new BABYLON.Vector3(${this.value.x}, ${this.value.y}, ${this.value.z})`;break;case NodeMaterialBlockConnectionPointTypes.Vector4:i=`new BABYLON.Vector4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;break;case NodeMaterialBlockConnectionPointTypes.Color3:i=`new BABYLON.Color3(${this.value.r}, ${this.value.g}, ${this.value.b})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case NodeMaterialBlockConnectionPointTypes.Color4:i=`new BABYLON.Color4(${this.value.r}, ${this.value.g}, ${this.value.b}, ${this.value.a})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case NodeMaterialBlockConnectionPointTypes.Matrix:i=`BABYLON.Matrix.FromArray([${this.value.m}])`}return t.push(`${e}.value = ${i}`),this.type===NodeMaterialBlockConnectionPointTypes.Float&&t.push(`${e}.min = ${this.min}`,`${e}.max = ${this.max}`,`${e}.isBoolean = ${this.isBoolean}`,`${e}.matrixMode = ${this.matrixMode}`,`${e}.animationType = BABYLON.AnimatedInputBlockTypes.${AnimatedInputBlockTypes[this.animationType]}`),t.push(`${e}.isConstant = ${this.isConstant}`),t.push(""),super._dumpPropertiesCode()+t.join(";\n")}return super._dumpPropertiesCode()}set associatedVariableName(e){this._associatedVariableName=e}get declarationVariableName(){return this._associatedVariableName}set isUniform(e){this._mode=e?0:3,this.associatedVariableName=""}get output(){return this._outputs[0]}get valueCallback(){return this._valueCallback}animate(e){switch(this._animationType){case AnimatedInputBlockTypes.Time:this.type===NodeMaterialBlockConnectionPointTypes.Float&&(this.value+=.01*e.getAnimationRatio());break;case AnimatedInputBlockTypes.RealTime:this.type===NodeMaterialBlockConnectionPointTypes.Float&&(this.value=(PrecisionDate.Now-e.getEngine().startTime)/1e3);break;case AnimatedInputBlockTypes.MouseInfo:if(this.type===NodeMaterialBlockConnectionPointTypes.Vector4){const t=e._inputManager._originMouseEvent;if(t){const e=t.offsetX,i=t.offsetY,a=1&t.buttons?1:0,n=2&t.buttons?1:0;this.value=new Vector4(e,i,a,n)}else this.value=new Vector4(0,0,0,0)}}}getClassName(){return"InputBlock"}get isUndefined(){return 3===this._mode}get value(){return this._storedValue}set valueCallback(e){this._valueCallback=e,this._mode=0}_emit(e,t){if(this.isUniform){if(this._associatedVariableName||(this._associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant){if(-1!==e.constants.indexOf(this.associatedVariableName))return;return e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=e._declareOutput(this.output,!0)+` = ${this._emitConstant(e)};\n`)}if(-1!==e.uniforms.indexOf(this.associatedVariableName))return;e.uniforms.push(this.associatedVariableName),t&&(e._uniformDeclaration+=this._emitDefine(t));const i=e._getShaderType(this.type);1===e.shaderLanguage?(e._uniformDeclaration+=`uniform ${this._associatedVariableName}: ${i};\n`,this._prefix="uniforms."):e._uniformDeclaration+=`uniform ${i} ${this.associatedVariableName};\n`,t&&(e._uniformDeclaration+="#endif\n");const a=e.sharedData.hints;if(null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case NodeMaterialSystemValues.WorldView:a.needWorldViewMatrix=!0;break;case NodeMaterialSystemValues.WorldViewProjection:a.needWorldViewProjectionMatrix=!0}else this._animationType!==AnimatedInputBlockTypes.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=remapAttributeName[this.name]??this.name,this.target===NodeMaterialBlockTargets.Vertex&&e._vertexState)return void(attributeInFragmentOnly[this.name]?attributeAsUniform[this.name]?(e._emitUniformFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="vertexInputs.")):e._emitVaryingFromString(this.declarationVariableName,this.type,t):this._emit(e._vertexState,t));if(-1!==e.attributes.indexOf(this.declarationVariableName))return;e.attributes.push(this.declarationVariableName),attributeInFragmentOnly[this.name]?attributeAsUniform[this.name]?(e._emitUniformFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="uniforms.")):(e._emitVaryingFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="fragmentInputs.")):(t&&(e._attributeDeclaration+=this._emitDefine(t)),1===e.shaderLanguage?(e._attributeDeclaration+=`attribute ${this.declarationVariableName}: ${e._getShaderType(this.type)};\n`,this._prefix="vertexInputs."):e._attributeDeclaration+=`attribute ${e._getShaderType(this.type)} ${this.declarationVariableName};\n`,t&&(e._attributeDeclaration+="#endif\n"))}}_transmit(e,t,i){if(this.isAttribute)return;const a=this._associatedVariableName;if(this._systemValue){switch(this._systemValue){case NodeMaterialSystemValues.World:case NodeMaterialSystemValues.WorldView:case NodeMaterialSystemValues.WorldViewProjection:return;case NodeMaterialSystemValues.View:e.setMatrix(a,t.getViewMatrix());break;case NodeMaterialSystemValues.Projection:e.setMatrix(a,t.getProjectionMatrix());break;case NodeMaterialSystemValues.ViewProjection:e.setMatrix(a,t.getTransformMatrix());break;case NodeMaterialSystemValues.CameraPosition:t.bindEyePosition(e,a,!0);break;case NodeMaterialSystemValues.FogColor:e.setColor3(a,t.fogColor);break;case NodeMaterialSystemValues.DeltaTime:e.setFloat(a,t.deltaTime/1e3);break;case NodeMaterialSystemValues.CameraParameters:t.activeCamera&&e.setFloat4(a,t.getEngine().hasOriginBottomLeft?-1:1,t.activeCamera.minZ,t.activeCamera.maxZ,1/t.activeCamera.maxZ);break;case NodeMaterialSystemValues.MaterialAlpha:e.setFloat(a,i.alpha)}return}const n=this._valueCallback?this._valueCallback():this._storedValue;if(null!==n)switch(this.type){case NodeMaterialBlockConnectionPointTypes.Float:e.setFloat(a,n);break;case NodeMaterialBlockConnectionPointTypes.Int:e.setInt(a,n);break;case NodeMaterialBlockConnectionPointTypes.Color3:TmpColors.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&TmpColors.Color3[0].toGammaSpaceToRef(TmpColors.Color3[0],t.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&TmpColors.Color3[0].toLinearSpaceToRef(TmpColors.Color3[0],t.getEngine().useExactSrgbConversions),e.setColor3(a,TmpColors.Color3[0]);break;case NodeMaterialBlockConnectionPointTypes.Color4:TmpColors.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&TmpColors.Color4[0].toGammaSpaceToRef(TmpColors.Color4[0],t.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&TmpColors.Color4[0].toLinearSpaceToRef(TmpColors.Color4[0],t.getEngine().useExactSrgbConversions),e.setDirectColor4(a,TmpColors.Color4[0]);break;case NodeMaterialBlockConnectionPointTypes.Vector2:e.setVector2(a,n);break;case NodeMaterialBlockConnectionPointTypes.Vector3:e.setVector3(a,n);break;case NodeMaterialBlockConnectionPointTypes.Vector4:e.setVector4(a,n);break;case NodeMaterialBlockConnectionPointTypes.Matrix:e.setMatrix(a,n)}}dispose(){this.onValueChangedObservable.clear(),super.dispose()}get systemValue(){return this._systemValue}_transmitWorld(e,t,i,a){if(!this._systemValue)return;const n=this._associatedVariableName;switch(this._systemValue){case NodeMaterialSystemValues.World:e.setMatrix(n,t);break;case NodeMaterialSystemValues.WorldView:e.setMatrix(n,i);break;case NodeMaterialSystemValues.WorldViewProjection:e.setMatrix(n,a)}}set systemValue(e){this._mode=0,this.associatedVariableName="",this._systemValue=e}setAsAttribute(e){return this._mode=1,e&&(this.name=e),this}setAsSystemValue(e){return this.systemValue=e,this}constructor(e,t=NodeMaterialBlockTargets.Vertex,i=NodeMaterialBlockConnectionPointTypes.AutoDetect){super(e,t,!1),this._mode=3,this._animationType=AnimatedInputBlockTypes.None,this._prefix="",this.min=0,this.max=0,this.isBoolean=!1,this.matrixMode=0,this._systemValue=null,this.isConstant=!1,this.groupInInspector="",this.onValueChangedObservable=new Observable,this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._type=i,this.setDefaultValue(),this.registerOutput("output",i)}set animationType(e){this._animationType=e}serialize(){const e=super.serialize();return e.type=this.type,e.mode=this._mode,e.systemValue=this._systemValue,e.animationType=this._animationType,e.min=this.min,e.max=this.max,e.isBoolean=this.isBoolean,e.matrixMode=this.matrixMode,e.isConstant=this.isConstant,e.groupInInspector=this.groupInInspector,e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,null!=this._storedValue&&0===this._mode&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e}_emitDefine(e){return"!"===e[0]?`#ifndef ${e.substring(1)}\n`:`#ifdef ${e}\n`}set isAttribute(e){this._mode=e?1:3,this.associatedVariableName=""}get associatedVariableName(){return this._prefix+this._associatedVariableName}set isVarying(e){this._mode=e?2:3,this.associatedVariableName=""}get isAttribute(){return 1===this._mode}_buildBlock(e){super._buildBlock(e),(this.isUniform||this.isSystemValue)&&e.sharedData.inputBlocks.push(this),this._emit(e)}get isUniform(){return 0===this._mode}set value(e){this.type===NodeMaterialBlockConnectionPointTypes.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=0,this.onValueChangedObservable.notifyObservers(this)}};RegisterClass("BABYLON.InputBlock",InputBlock);var ThinTexture=class e{isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}set isCube(e){this._texture&&(this._texture.isCube=e)}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get coordinatesMode(){return 0}get wrapV(){return this._wrapV}getClassName(){return"ThinTexture"}set is3D(e){this._texture&&(this._texture.is3D=e)}get wrapU(){return this._wrapU}get is3D(){return!!this._texture&&this._texture.is3D}static _IsRenderTargetWrapper(e){return void 0!==e?.shareDepth}get is2DArray(){return!!this._texture&&this._texture.is2DArray}getInternalTexture(){return this._texture}get isCube(){return!!this._texture&&this._texture.isCube}set wrapV(e){this._wrapV=e}delayLoad(){}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}set wrapU(e){this._wrapU=e}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}constructor(t){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=Size.Zero(),this._cachedBaseSize=Size.Zero(),this._initialSamplingMode=2,this._texture=e._IsRenderTargetWrapper(t)?t.texture:t,this._texture&&(this._engine=this._texture.getEngine())}},BaseTexture=class e extends ThinTexture{get isRGBD(){return null!=this._texture&&this._texture._isRGBD}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const e=this._parentContainer.textures.indexOf(this);e>-1&&this._parentContainer.textures.splice(e,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}serialize(e=!1){if(!this.name&&!e)return null;const t=SerializationHelper.Serialize(this);return SerializationHelper.AppendSerializedAnimations(this,t),t}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}get uid(){return this._uid||(this._uid=RandomGUID()),this._uid}get loadingError(){return this._loadingError}get wrapU(){return this._wrapU}_getFromCache(e,t,i,a,n,s){const r=this._getEngine();if(!r)return null;const o=r._getUseSRGBBuffer(!!n,t),l=r.getLoadedTexturesCache();for(let r=0;r<l.length;r++){const c=l[r];if(!(void 0!==n&&o!==c._useSRGBBuffer||void 0!==a&&a!==c.invertY||c.url!==e||c.generateMipMaps!==!t||i&&i!==c.samplingMode||void 0!==s&&s!==c.isCube))return c.incrementReferences(),c}return null}get canRescale(){return!1}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}_rebuild(e=!1){}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}set wrapU(e){this._wrapU=e}get errorObject(){return this._errorObject}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}clone(){return null}getReflectionTextureMatrix(){return Matrix.IdentityReadOnly}get coordinatesIndex(){return this._coordinatesIndex}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}get noMipmap(){return!1}get isCube(){return this._texture?this._texture.isCube:this._isCube}_readPixelsSync(e=0,t=0,i=null,a=!0,n=!1){if(!this._texture)return null;const s=this.getSize();let r=s.width,o=s.height;const l=this._getEngine();if(!l)return null;0!=t&&(r/=Math.pow(2,t),o/=Math.pow(2,t),r=Math.round(r),o=Math.round(o));try{return this._texture.isCube?l._readTexturePixelsSync(this._texture,r,o,e,t,i,a,n):l._readTexturePixelsSync(this._texture,r,o,-1,t,i,a,n)}catch(e){return null}}set wrapV(e){this._wrapV=e}readPixels(e=0,t=0,i=null,a=!0,n=!1,s=0,r=0,o=Number.MAX_VALUE,l=Number.MAX_VALUE){if(!this._texture)return null;const c=this._getEngine();if(!c)return null;const h=this.getSize();let u=h.width,m=h.height;0!==t&&(u/=Math.pow(2,t),m/=Math.pow(2,t),u=Math.round(u),m=Math.round(m)),o=Math.min(u,o),l=Math.min(m,l);try{return this._texture.isCube?c._readTexturePixels(this._texture,o,l,e,t,i,a,n,s,r):c._readTexturePixels(this._texture,o,l,-1,t,i,a,n,s,r)}catch(e){return null}}constructor(t,i=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new Observable,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,t?e._IsScene(t)?this._scene=t:this._engine=t:this._scene=EngineStore.LastCreatedScene,this._scene&&(this.Hc=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=i,this._uid=null}get getAlphaFromRGB(){return this._getAlphaFromRGB}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get isBlocking(){return!0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}_getEngine(){return this._engine}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}set isRGBD(e){e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}set is3D(e){this._texture&&(this._texture.is3D=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}toString(){return this.name}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get coordinatesMode(){return this._coordinatesMode}get wrapV(){return this._wrapV}getTextureMatrix(){return Matrix.IdentityReadOnly}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}get hasAlpha(){return this._hasAlpha}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get is2DArray(){return!!this._texture&&this._texture.is2DArray}getScene(){return this._scene}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))}static _IsScene(e){return"Scene"===e.getClassName()}scale(e){}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get is3D(){return!!this._texture&&this._texture.is3D}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}static WhenAllReady(e,t){let i=e.length;if(0!==i)for(let a=0;a<e.length;a++){const n=e[a];if(n.isReady())0==--i&&t();else{const e=n.onLoadObservable;e?e.addOnce((()=>{0==--i&&t()})):0==--i&&t()}}else t()}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}};function GenerateBase64StringFromPixelData(e,t,i=!1){const a=t.width,n=t.height;if(e instanceof Float32Array){let t=e.byteLength/e.BYTES_PER_ELEMENT;const i=new Uint8Array(t);for(;--t>=0;){let a=e[t];a<0?a=0:a>1&&(a=1),i[t]=255*a}e=i}const s=document.createElement("canvas");s.width=a,s.height=n;const r=s.getContext("2d");if(!r)return null;const o=r.createImageData(a,n);if(o.data.set(e),r.putImageData(o,0,0),i){const e=document.createElement("canvas");e.width=a,e.height=n;const t=e.getContext("2d");return t?(t.translate(0,n),t.scale(1,-1),t.drawImage(s,0,0),e.toDataURL("image/png")):null}return s.toDataURL("image/png")}function GenerateBase64StringFromTexture(e,t=0,i=0){const a=e.getInternalTexture();if(!a)return null;const n=e._readPixelsSync(t,i);return n?GenerateBase64StringFromPixelData(n,e.getSize(),a.invertY):null}async function GenerateBase64StringFromTextureAsync(e,t=0,i=0){const a=e.getInternalTexture();if(!a)return null;const n=await e.readPixels(t,i);return n?GenerateBase64StringFromPixelData(n,e.getSize(),a.invertY):null}BaseTexture.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,__decorate([serialize()],BaseTexture.prototype,"uniqueId",void 0),__decorate([serialize()],BaseTexture.prototype,"name",void 0),__decorate([serialize()],BaseTexture.prototype,"metadata",void 0),__decorate([serialize("hasAlpha")],BaseTexture.prototype,"_hasAlpha",void 0),__decorate([serialize("getAlphaFromRGB")],BaseTexture.prototype,"_getAlphaFromRGB",void 0),__decorate([serialize()],BaseTexture.prototype,"level",void 0),__decorate([serialize("coordinatesIndex")],BaseTexture.prototype,"_coordinatesIndex",void 0),__decorate([serialize()],BaseTexture.prototype,"optimizeUVAllocation",void 0),__decorate([serialize("coordinatesMode")],BaseTexture.prototype,"_coordinatesMode",void 0),__decorate([serialize()],BaseTexture.prototype,"wrapU",null),__decorate([serialize()],BaseTexture.prototype,"wrapV",null),__decorate([serialize()],BaseTexture.prototype,"wrapR",void 0),__decorate([serialize()],BaseTexture.prototype,"anisotropicFilteringLevel",void 0),__decorate([serialize()],BaseTexture.prototype,"isCube",null),__decorate([serialize()],BaseTexture.prototype,"is3D",null),__decorate([serialize()],BaseTexture.prototype,"is2DArray",null),__decorate([serialize()],BaseTexture.prototype,"gammaSpace",null),__decorate([serialize()],BaseTexture.prototype,"invertZ",void 0),__decorate([serialize()],BaseTexture.prototype,"lodLevelInAlpha",void 0),__decorate([serialize()],BaseTexture.prototype,"lodGenerationOffset",null),__decorate([serialize()],BaseTexture.prototype,"lodGenerationScale",null),__decorate([serialize()],BaseTexture.prototype,"linearSpecularLOD",null),__decorate([serializeAsTexture()],BaseTexture.prototype,"irradianceTexture",null),__decorate([serialize()],BaseTexture.prototype,"isRenderTarget",void 0);var Texture=class e extends BaseTexture{constructor(t,i,a,n,s=e.TRILINEAR_SAMPLINGMODE,r=null,o=null,l=null,c=!1,h,u,m,d,f){let p;super(i),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new Observable,this._isBlocking=!0,this.name=t||"",this.url=t;let _=!1,g=null,v=!0;"object"==typeof a&&null!==a?(p=a.noMipmap??!1,n=a.invertY??!useOpenGLOrientationForUV,s=a.samplingMode??e.TRILINEAR_SAMPLINGMODE,r=a.onLoad??null,o=a.onError??null,l=a.buffer??null,c=a.deleteBuffer??!1,h=a.format,u=a.mimeType,m=a.loaderOptions,d=a.creationFlags,_=a.useSRGBBuffer??!1,g=a.internalTexture??null,v=a.gammaSpace??v):p=!!a,this._gammaSpace=v,this._noMipmap=p,this._invertY=void 0===n?!useOpenGLOrientationForUV:n,this._initialSamplingMode=s,this._buffer=l,this._deleteBuffer=c,this._mimeType=u,this._loaderOptions=m,this._creationFlags=d,this._useSRGBBuffer=_,this._forcedExtension=f,h&&(this._format=h);const y=this.getScene(),S=this._getEngine();if(!S)return;S.onBeforeTextureInitObservable.notifyObservers(this);const C=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),r&&r(),!this.isBlocking&&y&&y.resetCachedMaterial()},E=(t,i)=>{this._loadingError=!0,this._errorObject={message:t,exception:i},o&&o(t,i),e.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!g)return this._delayedOnLoad=C,void(this._delayedOnError=E);if(this._texture=g??this._getFromCache(this.url,p,s,this._invertY,_,this.isCube),this._texture)if(this._texture.isReady)TimingTools.SetImmediate((()=>C()));else{const e=this._texture.onLoadedObservable.add(C);this._texture.onErrorObservable.add((t=>{E(t.message,t.exception),this._texture?.onLoadedObservable.remove(e)}))}else if(y&&y.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=E;else{try{this._texture=S.createTexture(this.url,p,this._invertY,y,s,C,E,this._buffer,void 0,this._format,this._forcedExtension,u,m,d,_)}catch(e){throw E("error loading",e),e}c&&(this._buffer=null)}}get isBlocking(){return this._isBlocking}static _CreateVideoTexture(t,i,a,n=!1,s=!1,r=e.TRILINEAR_SAMPLINGMODE,o={},l,c=5){throw _WarnImport("VideoTexture")}set isBlocking(e){this._isBlocking=e}static Parse(t,i,a){if(t.customType){const e=InstantiationTools.Instantiate(t.customType).Parse(t,i,a);return t.samplingMode&&e.updateSamplingMode&&e._samplingMode&&e._samplingMode!==t.samplingMode&&e.updateSamplingMode(t.samplingMode),e}if(t.isCube&&!t.isRenderTarget)return e._CubeTextureParser(t,i,a);const n=void 0!==t.internalTextureUniqueId;if(!t.name&&!t.isRenderTarget&&!n)return null;let s;if(n){const e=i.getEngine().getLoadedTexturesCache();for(const i of e)if(i.Hc===t.internalTextureUniqueId){s=i;break}}const r=e=>{if(e&&e._texture&&(e._texture._cachedWrapU=null,e._texture._cachedWrapV=null,e._texture._cachedWrapR=null),t.samplingMode){const i=t.samplingMode;e&&e.samplingMode!==i&&e.updateSamplingMode(i)}if(e&&t.animations)for(let i=0;i<t.animations.length;i++){const a=t.animations[i],n=GetClass("BABYLON.Animation");n&&e.animations.push(n.Parse(a))}n&&!s&&e?._texture?._setUniqueId(t.internalTextureUniqueId)};return SerializationHelper.Parse((()=>{let n=!0;if(t.noMipmap&&(n=!1),t.mirrorPlane){const a=e._CreateMirror(t.name,t.renderTargetSize,i,n);return a._waitingRenderList=t.cb,a.mirrorPlane=Plane.FromArray(t.mirrorPlane),r(a),a}if(t.isRenderTarget){let a=null;if(t.isCube){if(i.reflectionProbes)for(let e=0;e<i.reflectionProbes.length;e++){const a=i.reflectionProbes[e];if(a.name===t.name)return a.cubeTexture}}else a=e._CreateRenderTargetTexture(t.name,t.renderTargetSize,i,n,t._creationFlags??0),a._waitingRenderList=t.cb;return r(a),a}if(t.isVideo){const s=e._CreateVideoTexture(a+(t.url||t.name),a+(t.src||t.url),i,n,t.invertY,t.samplingMode,t.settings||{});return r(s),s}{let o;if(t.base64String&&!s)o=e.CreateFromBase64String(t.base64String,t.base64String,i,!n,t.invertY,t.samplingMode,(()=>{r(o)}),t._creationFlags??0,t._useSRGBBuffer??!1),o.name=t.name;else{let l;l=t.name&&(t.name.indexOf("://")>0||t.name.startsWith("data:"))?t.name:a+t.name,t.url&&(t.url.startsWith("data:")||e.UseSerializedUrlIfAny)&&(l=t.url);const c={noMipmap:!n,invertY:t.invertY,samplingMode:t.samplingMode,onLoad:()=>{r(o)},internalTexture:s};o=new e(l,i,c)}return o}}),t,i)}serialize(){const t=this.name;e.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const i=super.serialize(e._SerializeInternalTextureUniqueId);return i?((e.SerializeBuffers||e.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(i.base64String=this._buffer,i.name=i.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?i.base64String="data:image/png;base64,"+EncodeArrayBufferToBase64(this._buffer):(e.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(i.base64String=!this._engine||this._engine._features.supportSyncTextureRead?GenerateBase64StringFromTexture(this):GenerateBase64StringFromTextureAsync(this))),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i._creationFlags=this._creationFlags,i._useSRGBBuffer=this._useSRGBBuffer,e._SerializeInternalTextureUniqueId&&(i.internalTextureUniqueId=this._texture?.Hc??void 0),i.noMipmap=this._noMipmap,this.name=t,i):null}get invertY(){return this._invertY}getReflectionTextureMatrix(){const t=this.getScene();if(!t)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==e.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=Matrix.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=Matrix.Zero());const i=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case e.PLANAR_MODE:Matrix.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case e.PROJECTION_MODE:{Matrix.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const e=t.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=e.updateFlag,e.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:Matrix.IdentityToRef(this._cachedReflectionTextureMatrix)}return i&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedReflectionTextureMatrix}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=Matrix.Zero(),this._rowGenerationMatrix=new Matrix,this._t0=Vector3.Zero(),this._t1=Vector3.Zero(),this._t2=Vector3.Zero()),Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(Matrix.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,TmpVectors.Matrix[0]),Matrix.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,TmpVectors.Matrix[1]),Matrix.ScalingToRef(this._cachedUScale,this._cachedVScale,0,TmpVectors.Matrix[2]),Matrix.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,TmpVectors.Matrix[3]),TmpVectors.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(TmpVectors.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(TmpVectors.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(TmpVectors.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),Matrix.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();if(!t)return this._cachedTextureMatrix;const i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedTextureMatrix}get mimeType(){return this._mimeType}clone(){const t={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return SerializationHelper.Clone((()=>new e(this._texture?this._texture.url:null,this.getScene(),t)),this)}updateURL(e,t=null,i,a){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=a,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}_prepareRowForTextureGeneration(e,t,i,a){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,Vector3.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,a),a.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,a.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,a.z+=this.wRotationCenter}get noMipmap(){return this._noMipmap}delayLoad(){if(4!==this.delayLoadState)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?TimingTools.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}static CreateFromBase64String(t,i,a,n,s,r=e.TRILINEAR_SAMPLINGMODE,o=null,l=null,c=5,h,u){return new e("data:"+i,a,n,s,r,o,l,t,!1,c,void 0,void 0,h,u)}getClassName(){return"Texture"}static LoadFromDataString(t,i,a,n=!1,s,r=!0,o=e.TRILINEAR_SAMPLINGMODE,l=null,c=null,h=5,u,m){return"data:"!==t.substr(0,5)&&(t="data:"+t),new e(t,a,s,r,o,l,c,i,n,h,void 0,void 0,u,m)}};Texture.SerializeBuffers=!0,Texture.ForceSerializeBuffers=!1,Texture.OnTextureLoadErrorObservable=new Observable,Texture._SerializeInternalTextureUniqueId=!1,Texture._CubeTextureParser=(e,t,i)=>{throw _WarnImport("CubeTexture")},Texture._CreateMirror=(e,t,i,a)=>{throw _WarnImport("MirrorTexture")},Texture._CreateRenderTargetTexture=(e,t,i,a,n)=>{throw _WarnImport("RenderTargetTexture")},Texture.NEAREST_SAMPLINGMODE=1,Texture.NEAREST_NEAREST_MIPLINEAR=8,Texture.BILINEAR_SAMPLINGMODE=2,Texture.LINEAR_LINEAR_MIPNEAREST=11,Texture.TRILINEAR_SAMPLINGMODE=3,Texture.LINEAR_LINEAR_MIPLINEAR=3,Texture.NEAREST_NEAREST_MIPNEAREST=4,Texture.NEAREST_LINEAR_MIPNEAREST=5,Texture.NEAREST_LINEAR_MIPLINEAR=6,Texture.NEAREST_LINEAR=7,Texture.NEAREST_NEAREST=1,Texture.LINEAR_NEAREST_MIPNEAREST=9,Texture.LINEAR_NEAREST_MIPLINEAR=10,Texture.LINEAR_LINEAR=2,Texture.LINEAR_NEAREST=12,Texture.EXPLICIT_MODE=0,Texture.SPHERICAL_MODE=1,Texture.PLANAR_MODE=2,Texture.CUBIC_MODE=3,Texture.PROJECTION_MODE=4,Texture.SKYBOX_MODE=5,Texture.INVCUBIC_MODE=6,Texture.EQUIRECTANGULAR_MODE=7,Texture.FIXED_EQUIRECTANGULAR_MODE=8,Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Texture.CLAMP_ADDRESSMODE=0,Texture.WRAP_ADDRESSMODE=1,Texture.MIRROR_ADDRESSMODE=2,Texture.UseSerializedUrlIfAny=!1,__decorate([serialize()],Texture.prototype,"url",void 0),__decorate([serialize()],Texture.prototype,"uOffset",void 0),__decorate([serialize()],Texture.prototype,"vOffset",void 0),__decorate([serialize()],Texture.prototype,"uScale",void 0),__decorate([serialize()],Texture.prototype,"vScale",void 0),__decorate([serialize()],Texture.prototype,"uAng",void 0),__decorate([serialize()],Texture.prototype,"vAng",void 0),__decorate([serialize()],Texture.prototype,"wAng",void 0),__decorate([serialize()],Texture.prototype,"uRotationCenter",void 0),__decorate([serialize()],Texture.prototype,"vRotationCenter",void 0),__decorate([serialize()],Texture.prototype,"wRotationCenter",void 0),__decorate([serialize()],Texture.prototype,"homogeneousRotationInUVTransform",void 0),__decorate([serialize()],Texture.prototype,"isBlocking",null),RegisterClass("BABYLON.Texture",Texture),SerializationHelper._TextureParser=Texture.Parse;var CurrentScreenBlock=class extends NodeMaterialBlock{get a(){return this._outputs[5]}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=Texture.Parse(e.texture,t,i))}get rgb(){return this._outputs[1]}getClassName(){return"CurrentScreenBlock"}get target(){return this.uv.isConnected?this.uv.sourceBlock.isInput?NodeMaterialBlockTargets.VertexAndFragment:NodeMaterialBlockTargets.Fragment:NodeMaterialBlockTargets.VertexAndFragment}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}get g(){return this._outputs[3]}_writeOutput(e,t,i,a=!1){if(a){if(e.target===NodeMaterialBlockTargets.Fragment)return;e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`}else this.uv.ownerBlock.target!==NodeMaterialBlockTargets.Fragment?(e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n"):e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`}initialize(e){e._excludeVariableName(this._samplerName)}constructor(e){super(e,NodeMaterialBlockTargets.VertexAndFragment),this._samplerName="textureSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",NodeMaterialBlockConnectionPointTypes.AutoDetect,!1,NodeMaterialBlockTargets.VertexAndFragment),this.registerOutput("rgba",NodeMaterialBlockConnectionPointTypes.Color4,NodeMaterialBlockTargets.Neutral),this.registerOutput("rgb",NodeMaterialBlockConnectionPointTypes.Color3,NodeMaterialBlockTargets.Neutral),this.registerOutput("r",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Neutral),this.registerOutput("g",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Neutral),this.registerOutput("b",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Neutral),this.registerOutput("a",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NodeMaterialBlockConnectionPointTypes.Vector2|NodeMaterialBlockConnectionPointTypes.Vector3|NodeMaterialBlockConnectionPointTypes.Vector4),this._inputs[0]._prioritizeVertex=!1}get r(){return this._outputs[2]}_buildBlock(e){if(super._buildBlock(e),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.blockingBlocks.indexOf(this)<0&&e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.indexOf(this)<0&&e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.indexOf(this)<0&&e.sharedData.blocksWithDefines.push(this),e.target!==NodeMaterialBlockTargets.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(!this._outputs.some((e=>e.isConnectedInFragmentShader)))return;e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),this._writeTextureRead(e);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name);return this}get rgba(){return this._outputs[0]}_injectVertexCode(e){const t=this.uv;if(t.connectedPoint.ownerBlock.isInput){t.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(t.associatedVariableName,NodeMaterialBlockConnectionPointTypes.Vector2)}if(this._mainUVName="vMain"+t.associatedVariableName,e._emitVaryingFromString(this._mainUVName,NodeMaterialBlockConnectionPointTypes.Vector2),e.compilationString+=`${this._mainUVName} = ${t.associatedVariableName}.xy;\n`,this._outputs.some((e=>e.isConnectedInVertexShader))){this._writeTextureRead(e,!0);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name,!0)}}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}get b(){return this._outputs[4]}get uv(){return this._inputs[0]}_writeTextureRead(e,t=!1){const i=this.uv;if(t){if(e.target===NodeMaterialBlockTargets.Fragment)return;const t=0===e.shaderLanguage?`texture2D(${this._samplerName},`:`textureSampleLevel(${this._samplerName}, ${this._samplerName+"Sampler"},`,a=0===e.shaderLanguage?"":", 0";return void(e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,NodeMaterialBlockConnectionPointTypes.Vector4)} = ${t} ${i.associatedVariableName}${a});\n`)}const a=0===e.shaderLanguage?`texture2D(${this._samplerName},`:`textureSample(${this._samplerName}, ${this._samplerName+"Sampler"},`;this.uv.ownerBlock.target!==NodeMaterialBlockTargets.Fragment?e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,NodeMaterialBlockConnectionPointTypes.Vector4)} = ${a} ${this._mainUVName});\n`:e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,NodeMaterialBlockConnectionPointTypes.Vector4)} = ${a} ${i.associatedVariableName});\n`}};RegisterClass("BABYLON.CurrentScreenBlock",CurrentScreenBlock);var ParticleTextureBlock=class extends NodeMaterialBlock{get uv(){return this._inputs[0]}getClassName(){return"ParticleTextureBlock"}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}get r(){return this._outputs[2]}_writeOutput(e,t,i){e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n"}initialize(e){e._excludeVariableName("diffuseSampler")}_buildBlock(e){if(super._buildBlock(e),e.target===NodeMaterialBlockTargets.Vertex)return;this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,NodeMaterialBlockConnectionPointTypes.Vector4)} = ${e._generateTextureSample(this.uv.associatedVariableName,this._samplerName)};\n`;for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name);return this}get b(){return this._outputs[4]}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}get a(){return this._outputs[5]}get g(){return this._outputs[3]}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}autoConfigure(e,t=()=>!0){if(!this.uv.isConnected){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"particle_uv"===e.name&&t(e)));i||(i=new InputBlock("uv"),i.setAsAttribute("particle_uv")),i.output.connectTo(this.uv)}}constructor(e){super(e,NodeMaterialBlockTargets.Fragment),this._samplerName="diffuseSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",NodeMaterialBlockConnectionPointTypes.AutoDetect,!1,NodeMaterialBlockTargets.VertexAndFragment),this.registerOutput("rgba",NodeMaterialBlockConnectionPointTypes.Color4,NodeMaterialBlockTargets.Neutral),this.registerOutput("rgb",NodeMaterialBlockConnectionPointTypes.Color3,NodeMaterialBlockTargets.Neutral),this.registerOutput("r",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Neutral),this.registerOutput("g",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Neutral),this.registerOutput("b",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Neutral),this.registerOutput("a",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NodeMaterialBlockConnectionPointTypes.Vector2|NodeMaterialBlockConnectionPointTypes.Vector3|NodeMaterialBlockConnectionPointTypes.Vector4)}get rgb(){return this._outputs[1]}get rgba(){return this._outputs[0]}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=Texture.Parse(e.texture,t,i))}};RegisterClass("BABYLON.ParticleTextureBlock",ParticleTextureBlock);var ParticleRampGradientBlock=class extends NodeMaterialBlock{initialize(e){e._excludeVariableName("remapRanges"),e._excludeVariableName("rampSampler"),e._excludeVariableName("baseColor"),e._excludeVariableName("alpha"),e._excludeVariableName("remappedColorIndex"),e._excludeVariableName("rampColor")}constructor(e){super(e,NodeMaterialBlockTargets.Fragment),this._isUnique=!0,this.registerInput("color",NodeMaterialBlockConnectionPointTypes.Color4,!1,NodeMaterialBlockTargets.Fragment),this.registerOutput("rampColor",NodeMaterialBlockConnectionPointTypes.Color4,NodeMaterialBlockTargets.Fragment)}_buildBlock(e){if(super._buildBlock(e),e.target!==NodeMaterialBlockTargets.Vertex)return e._emit2DSampler("rampSampler","RAMPGRADIENT"),e._emitVaryingFromString("remapRanges",NodeMaterialBlockConnectionPointTypes.Vector4,"RAMPGRADIENT"),e.compilationString+=`\n            #ifdef RAMPGRADIENT\n                ${e._declareLocalVar("baseColor",NodeMaterialBlockConnectionPointTypes.Vector4)} = ${this.color.associatedVariableName};\n                ${e._declareLocalVar("alpha",NodeMaterialBlockConnectionPointTypes.Float)} = ${this.color.associatedVariableName}.a;\n\n                ${e._declareLocalVar("remappedColorIndex",NodeMaterialBlockConnectionPointTypes.Float)} = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);\n\n                ${e._declareLocalVar("rampColor",NodeMaterialBlockConnectionPointTypes.Vector4)} = ${e._generateTextureSample("vec2(1.0 - remappedColorIndex, 0.)","rampSampler")};\n\n                // Remapped alpha\n                ${e._declareOutput(this.rampColor)} = vec4${e.fSuffix}(baseColor.rgb * rampColor.rgb, clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0));\n            #else\n                ${e._declareOutput(this.rampColor)} = ${this.color.associatedVariableName};\n            #endif\n        `,this}get color(){return this._inputs[0]}getClassName(){return"ParticleRampGradientBlock"}get rampColor(){return this._outputs[0]}};RegisterClass("BABYLON.ParticleRampGradientBlock",ParticleRampGradientBlock);var ParticleBlendMultiplyBlock=class extends NodeMaterialBlock{get color(){return this._inputs[0]}get blendColor(){return this._outputs[0]}get alphaColor(){return this._inputs[2]}initialize(e){e._excludeVariableName("sourceAlpha")}constructor(e){super(e,NodeMaterialBlockTargets.Fragment),this._isUnique=!0,this.registerInput("color",NodeMaterialBlockConnectionPointTypes.Color4,!1,NodeMaterialBlockTargets.Fragment),this.registerInput("alphaTexture",NodeMaterialBlockConnectionPointTypes.Float,!1,NodeMaterialBlockTargets.Fragment),this.registerInput("alphaColor",NodeMaterialBlockConnectionPointTypes.Float,!1,NodeMaterialBlockTargets.Fragment),this.registerOutput("blendColor",NodeMaterialBlockConnectionPointTypes.Color4,NodeMaterialBlockTargets.Fragment)}getClassName(){return"ParticleBlendMultiplyBlock"}_buildBlock(e){if(super._buildBlock(e),e.target!==NodeMaterialBlockTargets.Vertex)return e.compilationString+=`\n            #ifdef BLENDMULTIPLYMODE\n                ${e._declareOutput(this.blendColor)};\n                ${e._declareLocalVar("sourceAlpha",NodeMaterialBlockConnectionPointTypes.Float)}  = ${this.alphaColor.associatedVariableName} * ${this.alphaTexture.associatedVariableName};\n                ${this.blendColor.associatedVariableName} = vec4${e.fSuffix}(${this.color.associatedVariableName}.rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha), ${this.color.associatedVariableName}.a);\n            #else\n                ${e._declareOutput(this.blendColor)} = ${this.color.associatedVariableName};\n            #endif\n        `,this}get alphaTexture(){return this._inputs[1]}};RegisterClass("BABYLON.ParticleBlendMultiplyBlock",ParticleBlendMultiplyBlock);var EffectFallbacks=class{reduce(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const i=this._mesh.getScene();for(let e=0;e<i.meshes.length;e++){const a=i.meshes[e];if(a.material){if(a.computeBonesUsingShaders&&0!==a.numBoneInfluencers)if(a.material.getEffect()===t)a.computeBonesUsingShaders=!1;else if(a.subMeshes)for(const e of a.subMeshes){if(e.effect===t){a.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&a.computeBonesUsingShaders&&a.numBoneInfluencers>0&&(a.computeBonesUsingShaders=!1)}}else{const t=this._defines[this._currentRank];if(t)for(let i=0;i<t.length;i++)e=e.replace("#define "+t[i],"");this._currentRank++}return e}unBindMesh(){this._mesh=null}constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}addFallback(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}addCPUSkinningFallback(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}};init_postprocess_vertex();var RenderTargetWrapper=class{get size(){return this.width}get textures(){return this._textures}_rebuild(){const e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){const t=this._depthStencilTexture.samplingMode,i=this._depthStencilTexture.format,a=2===t||3===t||11===t;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,a,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,i,this._depthStencilTextureLabel)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}}get layerIndices(){return this._layerIndices}get texture(){return this._textures?.[0]??null}get is3D(){return this.depth>0}_swapAndDie(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let e=null;if(this._isMulti){const t=this.textures;if(t&&t.length>0){let i=!1,a=t.length,n=-1;const s=t[t.length-1]._source;14!==s&&12!==s||(i=!0,n=t[t.length-1].format,a--);const r=[],o=[],l=[],c=[],h=[],u=[],m=[],d={};for(let e=0;e<a;++e){const i=t[e];r.push(i.samplingMode),o.push(i.type),l.push(i.format);void 0!==d[i.Hc]?(c.push(-1),m.push(0)):(d[i.Hc]=e,i.is2DArray?(c.push(35866),m.push(i.depth)):i.isCube?(c.push(34067),m.push(0)):i.is3D?(c.push(32879),m.push(i.depth)):(c.push(3553),m.push(0))),this._faceIndices&&h.push(this._faceIndices[e]??0),this._layerIndices&&u.push(this._layerIndices[e]??0)}const f={samplingModes:r,generateMipMaps:t[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:i,depthTextureFormat:n,types:o,formats:l,textureCount:a,targetTypes:c,faceIndex:h,layerIndex:u,layerCounts:m,label:this.label},p={width:this.width,height:this.height,depth:this.depth};e=this._engine.createMultipleRenderTarget(p,f);for(let i=0;i<a;++i){if(-1!==c[i])continue;const a=d[t[i].Hc];e.setTexture(e.textures[a],i)}}}else{const t={};if(t.generateDepthBuffer=this._generateDepthBuffer,t.generateMipMaps=this.texture?.generateMipMaps??!1,t.generateStencilBuffer=this._generateStencilBuffer,t.samplingMode=this.texture?.samplingMode,t.type=this.texture?.type,t.format=this.texture?.format,t.noColorAttachment=!this._textures,t.label=this.label,this.isCube)e=this._engine.createRenderTargetCubeTexture(this.width,t);else{const i={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?this.texture?.depth:void 0};e=this._engine.createRenderTargetTexture(i,t)}e.texture&&(e.texture.isReady=!0)}return e}get isCube(){return this._isCube}get depthStencilTexture(){return this._depthStencilTexture}get samples(){return this._samples}get depth(){return this._size.depth||0}constructor(e,t,i,a,n){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=e,this._isCube=t,this._size=i,this._engine=a,this._depthStencilTexture=null,this.label=n}setLayerAndFaceIndices(e,t){this._layerIndices=e,this._faceIndices=t}_swapRenderTargetWrapper(e){if(this._textures&&e._textures)for(let t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}setSamples(e,t=!0,i=!1){if(this.samples===e&&!i)return e;const a=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e);return this._samples=e,a}get is2DArray(){return this.layers>0}get height(){return this._size.height||this._size}shareDepth(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,e._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}dispose(e=!1){e||(this._depthStencilTexture?.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}_shareDepth(e){this.shareDepth(e)}createDepthStencilTexture(e=0,t=!0,i=!1,a=1,n=14,s){return this._depthStencilTexture?.dispose(),this._depthStencilTextureWithStencil=i,this._depthStencilTextureLabel=s,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this._isCube,samples:a,depthTextureFormat:n,label:s},this),this._depthStencilTexture}get layers(){return this._size.layers||0}get faceIndices(){return this._faceIndices}get width(){return this._size.width||this._size}setLayerAndFaceIndex(e=0,t,i){this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==t&&t>=0&&(this._layerIndices[e]=t),void 0!==i&&i>=0&&(this._faceIndices[e]=i)}get isMulti(){return this._isMulti}setTextures(e){Array.isArray(e)?this._textures=e:this._textures=e?[e]:null}setTexture(e,t=0,i=!0){this._textures||(this._textures=[]),this._textures[t]!==e&&(this._textures[t]&&i&&this._textures[t].dispose(),this._textures[t]=e)}releaseTextures(){if(this._textures)for(let e=0;e<this._textures?.length;++e)this._textures[e].dispose();this._textures=null}},WebGLRenderTargetWrapper=class extends RenderTargetWrapper{_swapRenderTargetWrapper(e){super._swapRenderTargetWrapper(e),e._framebuffer=this._framebuffer,e._depthStencilBuffer=this._depthStencilBuffer,e._MSAAFramebuffer=this._MSAAFramebuffer,e._colorTextureArray=this._colorTextureArray,e._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}setLayerAndFaceIndices(e,t){if(super.setLayerAndFaceIndices(e,t),!this.textures||!this.layerIndices||!this.faceIndices)return;const i=this._attachments?.length??this.textures.length;for(let e=0;e<i;e++){const t=this.textures[e];t&&(t.is2DArray||t.is3D?this._bindTextureRenderTarget(t,e,this.layerIndices[e]):t.isCube?this._bindTextureRenderTarget(t,e,this.faceIndices[e]):this._bindTextureRenderTarget(t,e))}}createDepthStencilTexture(e=0,t=!0,i=!1,a=1,n=14,s){if(this._depthStencilBuffer){const e=this._engine,t=e._currentFramebuffer,i=this._context;e._bindUnboundFramebuffer(this._framebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,null),e._bindUnboundFramebuffer(t),i.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(e,t,i,a,n,s)}constructor(e,t,i,a,n){super(e,t,i,a),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=n}_bindTextureRenderTarget(e,t=0,i,a=0){if(!e._hardwareTexture)return;const n=this._framebuffer,s=this._engine,r=s._currentFramebuffer;if(s._bindUnboundFramebuffer(n),s.webGLVersion>1){const n=this._context,s=n["COLOR_ATTACHMENT"+t];e.is2DArray||e.is3D?(i=i??this.layerIndices?.[t]??0,n.framebufferTextureLayer(n.FRAMEBUFFER,s,e._hardwareTexture.underlyingResource,a,i)):e.isCube?(i=i??this.faceIndices?.[t]??0,n.framebufferTexture2D(n.FRAMEBUFFER,s,n.TEXTURE_CUBE_MAP_POSITIVE_X+i,e._hardwareTexture.underlyingResource,a)):n.framebufferTexture2D(n.FRAMEBUFFER,s,n.TEXTURE_2D,e._hardwareTexture.underlyingResource,a)}else{const n=this._context,s=n["COLOR_ATTACHMENT"+t+"_WEBGL"],r=void 0!==i?n.TEXTURE_CUBE_MAP_POSITIVE_X+i:n.TEXTURE_2D;n.framebufferTexture2D(n.FRAMEBUFFER,s,r,e._hardwareTexture.underlyingResource,a)}s._bindUnboundFramebuffer(r)}shareDepth(e){super.shareDepth(e);const t=this._context,i=this._depthStencilBuffer,a=e._MSAAFramebuffer||e._framebuffer,n=this._engine;e._depthStencilBuffer&&e._depthStencilBuffer!==i&&t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=i;const s=e._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;n._bindUnboundFramebuffer(a),t.framebufferRenderbuffer(t.FRAMEBUFFER,s,t.RENDERBUFFER,i),n._bindUnboundFramebuffer(null)}dispose(e=this._disposeOnlyFramebuffers){const t=this._context;e||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(e)}setTexture(e,t=0,i=!0){super.setTexture(e,t,i),this._bindTextureRenderTarget(e,t)}setLayerAndFaceIndex(e=0,t,i){if(super.setLayerAndFaceIndex(e,t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;const a=this.textures[e];a.is2DArray||a.is3D?this._bindTextureRenderTarget(this.textures[e],e,this.layerIndices[e]):a.isCube&&this._bindTextureRenderTarget(this.textures[e],e,this.faceIndices[e])}_cloneRenderTargetWrapper(){let e=null;return this._colorTextureArray&&this._depthStencilTextureArray?(e=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),e.texture.isReady=!0):e=super._cloneRenderTargetWrapper(),e}};ThinEngine.prototype._createHardwareRenderTargetWrapper=function(e,t,i){const a=new WebGLRenderTargetWrapper(e,t,i,this,this._gl);return this._renderTargetWrapperCache.push(a),a},ThinEngine.prototype.createRenderTargetTexture=function(e,t){const i=this._createHardwareRenderTargetWrapper(!1,!1,e);let a,n,s=!0,r=!1,o=!1,l=1;void 0!==t&&"object"==typeof t&&(s=t.generateDepthBuffer??!0,r=!!t.generateStencilBuffer,o=!!t.noColorAttachment,a=t.colorAttachment,l=t.samples??1,n=t.label);const c=a||(o?null:this._createInternalTexture(e,t,!0,5)),h=e.width||e,u=e.height||e,m=this._currentFramebuffer,d=this._gl,f=d.createFramebuffer();return this._bindUnboundFramebuffer(f),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(r,s,h,u),!c||c.is2DArray||c.is3D||d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(m),i.label=n??"RenderTargetWrapper",i._framebuffer=f,i._generateDepthBuffer=s,i._generateStencilBuffer=r,i.setTextures(c),this.updateRenderTargetTextureSampleCount(i,l),i},ThinEngine.prototype._createDepthStencilTexture=function(e,t){const i=this._gl,a=e.layers||0,n=e.depth||0;let s=i.TEXTURE_2D;0!==a?s=i.TEXTURE_2D_ARRAY:0!==n&&(s=i.TEXTURE_3D);const r=new InternalTexture(this,12);if(r.label=t.label,!this._caps.depthTextureExtension)return Logger.Error("Depth texture is not supported by your browser or hardware."),r;const o={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t};if(this._bindTextureDirectly(s,r,!0),this._setupDepthStencilTexture(r,e,o.generateStencil,0!==o.comparisonFunction&&o.bilinearFiltering,o.comparisonFunction,o.samples),void 0!==o.depthTextureFormat){if(15!==o.depthTextureFormat&&16!==o.depthTextureFormat&&17!==o.depthTextureFormat&&13!==o.depthTextureFormat&&14!==o.depthTextureFormat&&18!==o.depthTextureFormat)return Logger.Error("Depth texture format is not supported."),r;r.format=o.depthTextureFormat}else r.format=o.generateStencil?13:16;const l=17===r.format||13===r.format||18===r.format;let c=i.UNSIGNED_INT;15===r.format?c=i.UNSIGNED_SHORT:17===r.format||13===r.format?c=i.UNSIGNED_INT_24_8:14===r.format?c=i.FLOAT:18===r.format&&(c=i.FLOAT_32_UNSIGNED_INT_24_8_REV);const h=l?i.DEPTH_STENCIL:i.DEPTH_COMPONENT;let u=h;return this.webGLVersion>1&&(15===r.format?u=i.DEPTH_COMPONENT16:16===r.format?u=i.DEPTH_COMPONENT24:17===r.format||13===r.format?u=i.DEPTH24_STENCIL8:14===r.format?u=i.DEPTH_COMPONENT32F:18===r.format&&(u=i.DEPTH32F_STENCIL8)),r.is2DArray?i.texImage3D(s,0,u,r.width,r.height,a,0,h,c,null):r.is3D?i.texImage3D(s,0,u,r.width,r.height,n,0,h,c,null):i.texImage2D(s,0,u,r.width,r.height,0,h,c,null),this._bindTextureDirectly(s,null),this._internalTexturesCache.push(r),r},ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e||!e.texture)return 1;if(e.samples===t)return t;const i=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);const a=e.texture._hardwareTexture;if(a.releaseMSAARenderBuffers(),t>1&&"function"==typeof i.renderbufferStorageMultisample){const n=i.createFramebuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=n,this._bindUnboundFramebuffer(e._MSAAFramebuffer);const s=this._createRenderBuffer(e.texture.width,e.texture.height,t,-1,this._getRGBABufferInternalSizedFormat(e.texture.type,e.texture.format,e.texture._useSRGBBuffer),i.COLOR_ATTACHMENT0,!1);if(!s)throw new Error("Unable to create multi sampled framebuffer");a.addMSAARenderBuffer(s)}else this._bindUnboundFramebuffer(e._framebuffer);return e.texture.samples=t,e._samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.texture.width,e.texture.height,t),this._bindUnboundFramebuffer(null),t},ThinEngine.prototype._setupDepthStencilTexture=function(e,t,i,a,n,s=1){const r=t.width||t,o=t.height||t,l=t.layers||0,c=t.depth||0;e.baseWidth=r,e.baseHeight=o,e.width=r,e.height=o,e.is2DArray=l>0,e.depth=l||c,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=a?2:1,e.type=0,e._comparisonFunction=n;const h=this._gl,u=this._getTextureTarget(e),m=this._getSamplingParameters(e.samplingMode,!1);h.texParameteri(u,h.TEXTURE_MAG_FILTER,m.mag),h.texParameteri(u,h.TEXTURE_MIN_FILTER,m.min),h.texParameteri(u,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(u,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===n?(h.texParameteri(u,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(u,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(u,h.TEXTURE_COMPARE_FUNC,n),h.texParameteri(u,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE)))},AbstractEngine.prototype.setTextureFromPostProcess=function(e,t,i){let a=null;t&&(t._forcedOutputTexture?a=t._forcedOutputTexture:t._textures.data[t._currentRenderTextureInd]&&(a=t._textures.data[t._currentRenderTextureInd])),this._bindTexture(e,a?.texture??null,i)},AbstractEngine.prototype.setTextureFromPostProcessOutput=function(e,t,i){this._bindTexture(e,t?._outputTexture?.texture??null,i)},Effect.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},Effect.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)};var PostProcess=class e{serialize(){const e=SerializationHelper.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e}static _Parse(t,i,a,n){return SerializationHelper.Parse((()=>new e(t.name,t.fragmentUrl,t.parameters,t.samplers,t.options,i,t.renderTargetSamplingMode,t._engine,t.reusable,t.defines,t.textureType,t.vertexUrl,t.indexParameters,!1,t.textureFormat)),t,a,n)}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}getClassName(){return"PostProcess"}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}isReady(){return!!this._shadersLoaded&&(this._drawWrapper.effect?.isReady()??!1)}_flushTextureCache(){const e=this._renderId;for(let t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){let e=!1;for(let i=0;i<this._textures.length;i++)if(this._textures.data[i]===this._textureCache[t].texture){e=!0;break}e||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}}resize(e,t,i=null,a=!1,n=!1){this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;let s=null;if(i)for(let e=0;e<i._postProcesses.length;e++)if(null!==i._postProcesses[e]){s=i._postProcesses[e];break}const r={width:this.width,height:this.height},o={generateMipMaps:a,generateDepthBuffer:n||s===this,generateStencilBuffer:(n||s===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(r,o,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(r,o,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let e;if(this._shareOutputWithPostProcess)e=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)e=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let t;e=this.inputTexture;for(let i=0;i<this._textureCache.length;i++)if(this._textureCache[i].texture===e){t=this._textureCache[i];break}t&&(t.lastUsedRenderId=this._renderId)}return e}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}useOwnOutput(){0==this._textures.length&&(this._textures=new SmartArray(2)),this._shareOutputWithPostProcess=null}getEngine(){return this._engine}constructor(e,t,i,a,n,s,r=1,o,l,c=null,h=0,u="postprocess",m,d=!1,f=5,p,_){this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.alphaMode=0,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._shadersLoaded=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new SmartArray(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new Vector2(1,1),this._texelSize=Vector2.Zero(),this.onEffectCreatedObservable=new Observable(void 0,!0),this.onActivateObservable=new Observable,this.onSizeChangedObservable=new Observable,this.onApplyObservable=new Observable,this.onBeforeRenderObservable=new Observable,this.onAfterRenderObservable=new Observable,this._onInitShadersDone=null,this.name=e;let g=1,v=null;if(i&&!Array.isArray(i)){const e=i;i=e.uniforms??null,a=e.samplers??null,g=e.size??1,s=e.camera??null,r=e.samplingMode??1,o=e.engine,l=e.reusable,c=e.defines??null,h=e.textureType??0,u=e.vertexUrl??"postprocess",m=e.indexParameters,d=e.blockCompilation??!1,f=e.textureFormat??5,p=e.shaderLanguage??0,v=e.uniformBuffers??null}else n&&(g="number"==typeof n?n:{width:n.width,height:n.height});null!=s?(this._camera=s,this._scene=s.getScene(),s.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.Hc=this._scene.getUniqueId()):o&&(this._engine=o,this._engine.postProcesses.push(this)),this._options=g,this.renderTargetSamplingMode=r||1,this._reusable=l||!1,this._textureType=h,this._textureFormat=f,this._shaderLanguage=p||0,this._samplers=a||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=u,this._parameters=i||[],this._parameters.push("scale"),this._uniformBuffers=v||[],this._indexParameters=m,this._drawWrapper=new DrawWrapper(this._engine),this._webGPUReady=1===this._shaderLanguage,this._postConstructor(d,c,_)}static _GetShaderCodeProcessing(t){return e._CustomShaderCodeProcessing[t]??e._CustomShaderCodeProcessing[""]}_createRenderTargetTexture(e,t,i=0){for(let a=0;a<this._textureCache.length;a++)if(this._textureCache[a].texture.width===e.width&&this._textureCache[a].texture.height===e.height&&this._textureCache[a].postProcessChannel===i&&this._textureCache[a].texture._generateDepthBuffer===t.generateDepthBuffer&&this._textureCache[a].texture.samples===t.samples)return this._textureCache[a].texture;const a=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:a,postProcessChannel:i,lastUsedRenderId:-1}),a}get isSupported(){return!this._shadersLoaded||this._drawWrapper.effect.isSupported}activate(e,t=null,i){const a=(e=e||this._camera).getScene(),n=a.getEngine(),s=n.getCaps().maxTextureSize,r=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,o=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0;let l=this._options.width||r,c=this._options.height||o;const h=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let u=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const e=n.currentViewport;e&&(l*=e.width,c*=e.height)}(h||this.alwaysForcePOT)&&(this._options.width||(l=n.needPOTTextures?GetExponentOfTwo(l,s,this.scaleMode):l),this._options.height||(c=n.needPOTTextures?GetExponentOfTwo(c,s,this.scaleMode):c)),this.width===l&&this.height===c&&(u=this._getTarget())||this.resize(l,c,e,h,i),this._textures.forEach((e=>{e.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(e,this.samples)})),this._flushTextureCache(),this._renderId++}return u||(u=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(r/l,o/c),this._engine.bindFramebuffer(u,0,r,o,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(u,0,void 0,void 0,this.forceFullscreenViewport)),this._engine._debugInsertMarker?.(`post process ${this.name} input`),this.onActivateObservable.notifyObservers(e),this.autoClear&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:a.clearColor,a._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),u}set onActivate(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))}setPrePassRenderer(e){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}_disposeTextureCache(){for(let e=this._textureCache.length-1;e>=0;e--)this._textureCache[e].texture.dispose();this._textureCache.length=0}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}apply(){if(!this._drawWrapper.effect?.isReady())return null;let t;return this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),t=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",t?.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),e._GetShaderCodeProcessing(this.name)?.bindCustomBindings?.(this.name,this._drawWrapper.effect),this._drawWrapper.effect}static Parse(e,t,i){const a=GetClass(e.customType);if(!a||!a._Parse)return null;const n=t?t.getCameraById(e.cameraId):null;return a._Parse(e,n,t,i)}set onSizeChanged(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)}dispose(e){let t;if(e=e||this._camera,this._disposeTextures(),this._scene&&(t=this._scene.postProcesses.indexOf(this),-1!==t&&this._scene.postProcesses.splice(t,1)),this._parentContainer){const e=this._parentContainer.postProcesses.indexOf(this);e>-1&&this._parentContainer.postProcesses.splice(e,1),this._parentContainer=null}if(t=this._engine.postProcesses.indexOf(this),-1!==t&&this._engine.postProcesses.splice(t,1),e){if(e.detachPostProcess(this),t=e._postProcesses.indexOf(this),0===t&&e._postProcesses.length>0){const e=this._camera._getFirstPostProcess();e&&e.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}set onApply(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)}getEffect(){return this._drawWrapper.effect}markTextureDirty(){this.width=-1}isReusable(){return this._reusable}getCamera(){return this._camera}static RegisterShaderCodeProcessing(t,i){i?e._CustomShaderCodeProcessing[t??""]=i:delete e._CustomShaderCodeProcessing[t??""]}clone(){const t=this.serialize();t._engine=this._engine,t.cameraId=null;const i=e.Parse(t,this._scene,"");return i?(i.onActivateObservable=this.onActivateObservable.clone(),i.onSizeChangedObservable=this.onSizeChangedObservable.clone(),i.onApplyObservable=this.onApplyObservable.clone(),i.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),i.onAfterRenderObservable=this.onAfterRenderObservable.clone(),i._prePassEffectConfiguration=this._prePassEffectConfiguration,i):null}get samples(){return this._samples}async _postConstructor(t,i=null,a){const n=this.getEngine().isWebGPU&&!e.ForceGLSL;await this._initShaderSourceAsync(n),a&&await a(n),n&&this._webGPUReady&&(this._shaderLanguage=1),this._onInitShadersDone?this._onInitShadersDone():(this._shadersLoaded=!0,t||this.updateEffect(i))}async _initShaderSourceAsync(e=!1){e&&this._webGPUReady?await Promise.all([Promise.resolve().then((()=>(init_postprocess_vertex2(),postprocess_vertex_exports2)))]):await Promise.all([Promise.resolve().then((()=>(init_postprocess_vertex(),postprocess_vertex_exports)))]),this._shadersLoaded=!0}get shaderLanguage(){return this._shaderLanguage}set samples(e){this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach((e=>{e.setSamples(this._samples)}))}getEffectName(){return this._fragmentUrl}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}updateEffect(t=null,i=null,a=null,n,s,r,o,l){if(!this._shadersLoaded)return void(this._onInitShadersDone=()=>{this._shadersLoaded=!0,this._onInitShadersDone=null,this.updateEffect(t,i,a,n,s,r,o,l)});const c=e._GetShaderCodeProcessing(this.name);if(c?.defineCustomBindings){const e=i?.slice()??[];e.push(...this._parameters);const n=a?.slice()??[];n.push(...this._samplers),t=c.defineCustomBindings(this.name,t,e,n),i=e,a=n}this._postProcessDefines=t,this._drawWrapper.effect=this._engine.createEffect({vertex:o??this._vertexUrl,fragment:l??this._fragmentUrl},{attributes:["position"],uniformsNames:i||this._parameters,uniformBuffersNames:this._uniformBuffers,samplers:a||this._samplers,defines:null!==t?t:"",fallbacks:null,onCompiled:s??null,onError:r??null,indexParameters:n||this._indexParameters,processCodeAfterIncludes:c?.processCodeAfterIncludes?(e,t)=>c.processCodeAfterIncludes(this.name,e,t):null,processFinalCode:c?.processFinalCode?(e,t)=>c.processFinalCode(this.name,e,t):null,shaderLanguage:this._shaderLanguage},this._engine),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}shareOutputWith(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this}set inputTexture(e){this._forcedOutputTexture=e}};PostProcess.ForceGLSL=!1,PostProcess._CustomShaderCodeProcessing={},__decorate([serialize()],PostProcess.prototype,"uniqueId",void 0),__decorate([serialize()],PostProcess.prototype,"name",void 0),__decorate([serialize()],PostProcess.prototype,"width",void 0),__decorate([serialize()],PostProcess.prototype,"height",void 0),__decorate([serialize()],PostProcess.prototype,"renderTargetSamplingMode",void 0),__decorate([serializeAsColor4()],PostProcess.prototype,"clearColor",void 0),__decorate([serialize()],PostProcess.prototype,"autoClear",void 0),__decorate([serialize()],PostProcess.prototype,"forceAutoClearInAlphaMode",void 0),__decorate([serialize()],PostProcess.prototype,"alphaMode",void 0),__decorate([serialize()],PostProcess.prototype,"alphaConstants",void 0),__decorate([serialize()],PostProcess.prototype,"enablePixelPerfectMode",void 0),__decorate([serialize()],PostProcess.prototype,"forceFullscreenViewport",void 0),__decorate([serialize()],PostProcess.prototype,"scaleMode",void 0),__decorate([serialize()],PostProcess.prototype,"alwaysForcePOT",void 0),__decorate([serialize("samples")],PostProcess.prototype,"_samples",void 0),__decorate([serialize()],PostProcess.prototype,"adaptScaleToCurrentViewport",void 0),RegisterClass("BABYLON.PostProcess",PostProcess);var VectorMergerBlock=class extends NodeMaterialBlock{get x(){return this._inputs[4]}get xyzw(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this.x,i=this.y,a=this.z,n=this.w,s=this.xyIn,r=this.zwIn,o=this.xyzIn,l=this.xyzwIn,c=this._outputs[0],h=this._outputs[1],u=this._outputs[2],m=this._outputs[3],d=e._getShaderType(NodeMaterialBlockConnectionPointTypes.Vector4),f=e._getShaderType(NodeMaterialBlockConnectionPointTypes.Vector3),p=e._getShaderType(NodeMaterialBlockConnectionPointTypes.Vector2);return l.isConnected?(c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${l.associatedVariableName}${this._buildSwizzle(4)};\n`),h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${l.associatedVariableName}${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${l.associatedVariableName}${this._buildSwizzle(2)};\n`)):o.isConnected?(c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${d}(${o.associatedVariableName}, ${n.isConnected?this._writeVariable(n):"0.0"})${this._buildSwizzle(4)};\n`),h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${o.associatedVariableName}${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${o.associatedVariableName}${this._buildSwizzle(2)};\n`)):s.isConnected?(c.hasEndpoints&&(r.isConnected?e.compilationString+=e._declareOutput(c)+` = ${d}(${s.associatedVariableName}, ${r.associatedVariableName})${this._buildSwizzle(4)};\n`:e.compilationString+=e._declareOutput(c)+` = ${d}(${s.associatedVariableName}, ${a.isConnected?this._writeVariable(a):"0.0"}, ${n.isConnected?this._writeVariable(n):"0.0"})${this._buildSwizzle(4)};\n`),h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${f}(${s.associatedVariableName}, ${a.isConnected?this._writeVariable(a):"0.0"})${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${s.associatedVariableName}${this._buildSwizzle(2)};\n`),m.hasEndpoints&&(r.isConnected?e.compilationString+=e._declareOutput(m)+` = ${r.associatedVariableName}${this._buildSwizzle(2)};\n`:e.compilationString+=e._declareOutput(m)+` = ${p}(${a.isConnected?this._writeVariable(a):"0.0"}, ${n.isConnected?this._writeVariable(n):"0.0"})${this._buildSwizzle(2)};\n`)):(c.hasEndpoints&&(r.isConnected?e.compilationString+=e._declareOutput(c)+` = ${d}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${r.associatedVariableName})${this._buildSwizzle(4)};\n`:e.compilationString+=e._declareOutput(c)+` = ${d}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${a.isConnected?this._writeVariable(a):"0.0"}, ${n.isConnected?this._writeVariable(n):"0.0"})${this._buildSwizzle(4)};\n`),h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${f}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${a.isConnected?this._writeVariable(a):"0.0"})${this._buildSwizzle(3)};\n`),u.hasEndpoints&&(e.compilationString+=e._declareOutput(u)+` = ${p}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"})${this._buildSwizzle(2)};\n`),m.hasEndpoints&&(r.isConnected?e.compilationString+=e._declareOutput(m)+` = ${r.associatedVariableName}${this._buildSwizzle(2)};\n`:e.compilationString+=e._declareOutput(m)+` = ${p}(${a.isConnected?this._writeVariable(a):"0.0"}, ${n.isConnected?this._writeVariable(n):"0.0"})${this._buildSwizzle(2)};\n`)),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.xSwizzle = "${this.xSwizzle}";\n`,e+=`${this._codeVariableName}.ySwizzle = "${this.ySwizzle}";\n`,e+=`${this._codeVariableName}.zSwizzle = "${this.zSwizzle}";\n`,e+=`${this._codeVariableName}.wSwizzle = "${this.wSwizzle}";\n`,e}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.xSwizzle="x",this.ySwizzle="y",this.zSwizzle="z",this.wSwizzle="w",this.registerInput("xyzw ",NodeMaterialBlockConnectionPointTypes.Vector4,!0),this.registerInput("xyz ",NodeMaterialBlockConnectionPointTypes.Vector3,!0),this.registerInput("xy ",NodeMaterialBlockConnectionPointTypes.Vector2,!0),this.registerInput("zw ",NodeMaterialBlockConnectionPointTypes.Vector2,!0),this.registerInput("x",NodeMaterialBlockConnectionPointTypes.Float,!0),this.registerInput("y",NodeMaterialBlockConnectionPointTypes.Float,!0),this.registerInput("z",NodeMaterialBlockConnectionPointTypes.Float,!0),this.registerInput("w",NodeMaterialBlockConnectionPointTypes.Float,!0),this.registerOutput("xyzw",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerOutput("xyz",NodeMaterialBlockConnectionPointTypes.Vector3),this.registerOutput("xy",NodeMaterialBlockConnectionPointTypes.Vector2),this.registerOutput("zw",NodeMaterialBlockConnectionPointTypes.Vector2)}get xyOut(){return this._outputs[2]}getClassName(){return"VectorMergerBlock"}serialize(){const e=super.serialize();return e.xSwizzle=this.xSwizzle,e.ySwizzle=this.ySwizzle,e.zSwizzle=this.zSwizzle,e.wSwizzle=this.wSwizzle,e}_inputRename(e){return"xyzw "===e?"xyzwIn":"xyz "===e?"xyzIn":"xy "===e?"xyIn":"zw "===e?"zwIn":e}get xyzIn(){return this._inputs[1]}get z(){return this._inputs[6]}get zwOut(){return this._outputs[3]}get y(){return this._inputs[5]}get xyIn(){return this._inputs[2]}_deserialize(e,t,i){super._deserialize(e,t,i),this.xSwizzle=e.xSwizzle??"x",this.ySwizzle=e.ySwizzle??"y",this.zSwizzle=e.zSwizzle??"z",this.wSwizzle=e.wSwizzle??"w"}get w(){return this._inputs[7]}get xyzOut(){return this._outputs[1]}get xyzwIn(){return this._inputs[0]}get zwIn(){return this._inputs[3]}_buildSwizzle(e){return"."+(this.xSwizzle+this.ySwizzle+this.zSwizzle+this.wSwizzle).substr(0,e)}get xy(){return this.xyOut}get xyz(){return this.xyzOut}};RegisterClass("BABYLON.VectorMergerBlock",VectorMergerBlock);var RemapBlock=class extends NodeMaterialBlock{get targetMin(){return this._inputs[3]}get output(){return this._outputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.sourceRange=new Vector2(-1,1),this.targetRange=new Vector2(0,1),this.registerInput("input",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("sourceMin",NodeMaterialBlockConnectionPointTypes.Float,!0),this.registerInput("sourceMax",NodeMaterialBlockConnectionPointTypes.Float,!0),this.registerInput("targetMin",NodeMaterialBlockConnectionPointTypes.Float,!0),this.registerInput("targetMax",NodeMaterialBlockConnectionPointTypes.Float,!0),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}serialize(){const e=super.serialize();return e.sourceRange=this.sourceRange.asArray(),e.targetRange=this.targetRange.asArray(),e}get input(){return this._inputs[0]}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.sourceRange = new BABYLON.Vector2(${this.sourceRange.x}, ${this.sourceRange.y});\n`;return e+=`${this._codeVariableName}.targetRange = new BABYLON.Vector2(${this.targetRange.x}, ${this.targetRange.y});\n`,e}getClassName(){return"RemapBlock"}get sourceMin(){return this._inputs[1]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),a=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),n=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),s=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return e.compilationString+=e._declareOutput(t)+` = ${n} + (${this._inputs[0].associatedVariableName} - ${i}) * (${s} - ${n}) / (${a} - ${i});\n`,this}get sourceMax(){return this._inputs[2]}_deserialize(e,t,i){super._deserialize(e,t,i),this.sourceRange=Vector2.FromArray(e.sourceRange),this.targetRange=Vector2.FromArray(e.targetRange)}get targetMax(){return this._inputs[4]}};__decorate([editableInPropertyPage("From",3)],RemapBlock.prototype,"sourceRange",void 0),__decorate([editableInPropertyPage("To",3)],RemapBlock.prototype,"targetRange",void 0),RegisterClass("BABYLON.RemapBlock",RemapBlock);var BaseMathBlock=class extends NodeMaterialBlock{dispose(){super.dispose(),this._connectionObservers.forEach((e=>e.remove())),this._connectionObservers.length=0}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===NodeMaterialBlockConnectionPointTypes.Int||this.left.type===NodeMaterialBlockConnectionPointTypes.Float&&this.right.type!==NodeMaterialBlockConnectionPointTypes.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[e,t]of[[this.left,this.right],[this.right,this.left]])e.acceptedConnectionPointTypes=[NodeMaterialBlockConnectionPointTypes.Int,NodeMaterialBlockConnectionPointTypes.Float],t.isConnected&&(e.acceptedConnectionPointTypes.push(t.type),t.type!==NodeMaterialBlockConnectionPointTypes.Int&&t.type!==NodeMaterialBlockConnectionPointTypes.Float||e.acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector2,NodeMaterialBlockConnectionPointTypes.Vector3,NodeMaterialBlockConnectionPointTypes.Vector4,NodeMaterialBlockConnectionPointTypes.Color3,NodeMaterialBlockConnectionPointTypes.Color4,NodeMaterialBlockConnectionPointTypes.Matrix))}get left(){return this._inputs[0]}get right(){return this._inputs[1]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("left",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("right",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this.output._typeConnectionSource=this.left,this._linkConnectionTypes(0,1,!0),this.left.acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Float),this.right.acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Float),this._connectionObservers=[this.left.onTypeChangedObservable.add((()=>this._updateInputOutputTypes())),this.right.onTypeChangedObservable.add((()=>this._updateInputOutputTypes()))]}get output(){return this._outputs[0]}},MultiplyBlock=class extends BaseMathBlock{_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} * ${this.right.associatedVariableName};\n`,this}constructor(e){super(e)}getClassName(){return"MultiplyBlock"}},NodeMaterialModes,NodeMaterialModes2;RegisterClass("BABYLON.MultiplyBlock",MultiplyBlock),NodeMaterialModes2=NodeMaterialModes||(NodeMaterialModes={}),NodeMaterialModes2[NodeMaterialModes2.Material=0]="Material",NodeMaterialModes2[NodeMaterialModes2.PostProcess=1]="PostProcess",NodeMaterialModes2[NodeMaterialModes2.Particle=2]="Particle",NodeMaterialModes2[NodeMaterialModes2.ProceduralTexture=3]="ProceduralTexture";var ImageProcessingConfigurationDefines=class extends MaterialDefines{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}},BaseParticleSystem=class e{_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}set maxEmitBox(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)}getLimitVelocityGradients(){return this._limitVelocityGradients}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Vector3.Zero()}set isBillboardBased(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())}_removeGradientAndTexture(e,t,i){if(!t)return this;let a=0;for(const i of t){if(i.gradient===e){t.splice(a,1);break}a++}return i&&i.dispose(),this}getColorRemapGradients(){return this._colorRemapGradients}createPointEmitter(e,t){throw new Error("Method not implemented.")}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._reset())}getAlphaRemapGradients(){return this._alphaRemapGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getColorGradients(){return this._colorGradients}set useLogarithmicDepth(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Vector3.Zero()}get billboardMode(){return this._billboardMode}getSizeGradients(){return this._sizeGradients}createBoxEmitter(e,t,i,a){throw new Error("Method not implemented.")}getVelocityGradients(){return this._velocityGradients}set direction2(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)}set noiseTexture(e){this._noiseTexture!==e&&(this._noiseTexture=e,this._reset())}_reset(){}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get useLogarithmicDepth(){return this._useLogarithmicDepth}createConeEmitter(e=1,t=Math.PI/4){throw new Error("Method not implemented.")}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Vector3.Zero()}getScene(){return this._scene}createDirectedSphereEmitter(e=1,t=new Vector3(0,1,0),i=new Vector3(0,1,0)){throw new Error("Method not implemented.")}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(!e&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=e)}createCylinderEmitter(e=1,t=1,i=1,a=0){throw new Error("Method not implemented.")}set isAnimationSheetEnabled(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())}getLifeTimeGradients(){return this._lifeTimeGradients}getDragGradients(){return this._dragGradients}getEmitRateGradients(){return this._emitRateGradients}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}getStartSizeGradients(){return this._startSizeGradients}createDirectedCylinderEmitter(e=1,t=1,i=1,a=new Vector3(0,1,0),n=new Vector3(0,1,0)){throw new Error("Method not implemented.")}get noiseTexture(){return this._noiseTexture}set direction1(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)}set minEmitBox(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e)}constructor(t){this.animations=[],this.undefinedc=0,this.emitter=Vector3.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Vector3(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Vector2(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new Vector3(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Vector3.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Color4(1,1,1,1),this.color2=new Color4(1,1,1,1),this.colorDead=new Color4(0,0,0,1),this.textureMask=new Color4(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new ImageProcessingConfigurationDefines,this.id=t,this.name=t}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Vector3.Zero()}createHemisphericEmitter(e=1,t=1){throw new Error("Method not implemented.")}createDirectedConeEmitter(e=1,t=Math.PI/4,i=new Vector3(0,1,0),a=new Vector3(0,1,0)){throw new Error("Method not implemented.")}get isBillboardBased(){return this._isBillboardBased}createSphereEmitter(e=1,t=1){throw new Error("Method not implemented.")}};BaseParticleSystem.BLENDMODE_ONEONE=0,BaseParticleSystem.BLENDMODE_STANDARD=1,BaseParticleSystem.BLENDMODE_ADD=2,BaseParticleSystem.BLENDMODE_MULTIPLY=3,BaseParticleSystem.BLENDMODE_MULTIPLYADD=4,RegisterClass("BABYLON.BaseParticleSystem",BaseParticleSystem);var ColorSplitterBlock=class extends NodeMaterialBlock{get rgbOut(){return this._outputs[0]}get rgba(){return this._inputs[0]}get rgbIn(){return this._inputs[1]}get g(){return this._outputs[2]}getClassName(){return"ColorSplitterBlock"}get a(){return this._outputs[4]}_outputRename(e){return"rgb"===e?"rgbOut":e}get r(){return this._outputs[1]}_buildBlock(e){super._buildBlock(e);const t=this.rgba.isConnected?this.rgba:this.rgbIn;if(!t.isConnected)return;const i=this._outputs[0],a=this._outputs[1],n=this._outputs[2],s=this._outputs[3],r=this._outputs[4];return i.hasEndpoints&&(e.compilationString+=e._declareOutput(i)+` = ${t.associatedVariableName}.rgb;\n`),a.hasEndpoints&&(e.compilationString+=e._declareOutput(a)+` = ${t.associatedVariableName}.r;\n`),n.hasEndpoints&&(e.compilationString+=e._declareOutput(n)+` = ${t.associatedVariableName}.g;\n`),s.hasEndpoints&&(e.compilationString+=e._declareOutput(s)+` = ${t.associatedVariableName}.b;\n`),r.hasEndpoints&&(e.compilationString+=e._declareOutput(r)+` = ${t.associatedVariableName}.a;\n`),this}get b(){return this._outputs[3]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("rgba",NodeMaterialBlockConnectionPointTypes.Color4,!0),this.registerInput("rgb ",NodeMaterialBlockConnectionPointTypes.Color3,!0),this.registerOutput("rgb",NodeMaterialBlockConnectionPointTypes.Color3),this.registerOutput("r",NodeMaterialBlockConnectionPointTypes.Float),this.registerOutput("g",NodeMaterialBlockConnectionPointTypes.Float),this.registerOutput("b",NodeMaterialBlockConnectionPointTypes.Float),this.registerOutput("a",NodeMaterialBlockConnectionPointTypes.Float),this.inputsAreExclusive=!0}_inputRename(e){return"rgb "===e?"rgbIn":e}};RegisterClass("BABYLON.ColorSplitterBlock",ColorSplitterBlock);var PostProcessManager=class{_finalizeFrame(e,t,i,a,n=!1){const s=this._scene.activeCamera;if(!s)return;if(0===(a=a||s._postProcesses.filter((e=>null!=e))).length||!this._scene.postProcessesEnabled)return;const r=this._scene.getEngine();for(let o=0,l=a.length;o<l;o++){const c=a[o];if(o<l-1?c._outputTexture=a[o+1].activate(s,t?.texture):(t?(r.bindFramebuffer(t,i,void 0,void 0,n),c._outputTexture=t):(r.restoreDefaultFramebuffer(),c._outputTexture=null),r._debugInsertMarker?.(`post process ${a[o].name} output`)),e)break;const h=c.apply();h&&(c.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,h),r.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(h))}r.setDepthBuffer(!0),r.setDepthWrite(!0),r.setAlphaMode(0)}dispose(){const e=this._vertexBuffers[VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}constructor(e){this._vertexBuffers={},this._scene=e}_buildIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}directRender(e,t=null,i=!1,a=0,n=0,s=!1){const r=this._scene.getEngine();for(let o=0;o<e.length;o++){o<e.length-1?e[o+1].activate(this._scene.activeCamera,t?.texture):(t?r.bindFramebuffer(t,a,void 0,void 0,i,n):s||r.restoreDefaultFramebuffer(),r._debugInsertMarker?.(`post process ${e[o].name} output`));const l=e[o],c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,c),r.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(c))}r.setDepthBuffer(!0),r.setDepthWrite(!0)}_rebuild(){const e=this._vertexBuffers[VertexBuffer.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}_prepareFrame(e=null,t=null){const i=this._scene.activeCamera;return!!i&&(!(!(t=t||i._postProcesses.filter((e=>null!=e)))||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(i,e,null!=t),!0))}_prepareBuffers(){if(this._vertexBuffers[VertexBuffer.PositionKind])return;const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[VertexBuffer.PositionKind]=new VertexBuffer(this._scene.getEngine(),e,VertexBuffer.PositionKind,!1,!1,2),this._buildIndexBuffer()}},RenderingGroup=class e{dispatch(e,t,i){void 0===t&&(t=e.getMesh()),void 0===i&&(i=e.getMaterial()),null!=i&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t.isEnabled()&&t.isVisible&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}constructor(e,t,i=null,a=null,n=null){this.index=e,this._opaqueSubMeshes=new SmartArray(256),this._transparentSubMeshes=new SmartArray(256),this._alphaTestSubMeshes=new SmartArray(256),this._depthOnlySubMeshes=new SmartArray(256),this._particleSystems=new SmartArray(256),this._spriteManagers=new SmartArray(256),this._empty=!0,this._edgesRenderers=new SmartArrayNoDuplicate(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=a,this.transparentSortCompareFn=n}set transparentSortCompareFn(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}_renderTransparentSorted(t){e._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)}set alphaTestSortCompareFn(t){this._alphaTestSortCompareFn=t||e.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}static _RenderSorted(t,i,a,n){let s,r=0;const o=a?a.globalPosition:e._ZeroVector;if(n)for(;r<t.length;r++)s=t.data[r],s._alphaIndex=s.getMesh().alphaIndex,s._distanceToCamera=Vector3.Distance(s.getBoundingInfo().boundingSphere.centerWorld,o);const l=t.length===t.data.length?t.data:t.data.slice(0,t.length);i&&l.sort(i);const c=l[0].getMesh().getScene();for(r=0;r<l.length;r++)if(s=l[r],!c._activeMeshesFrozenButKeepClipping||s.isInFrustum(c._frustumPlanes)){if(n){const e=s.getMaterial();if(e&&e.needDepthPrePass){const t=e.getScene().getEngine();t.setColorWrite(!1),t.setAlphaMode(0),s.render(!1),t.setColorWrite(!0)}}s.render(n)}}_renderParticles(e){if(0===this._particleSystems.length)return;const t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const a=this._particleSystems.data[i];if(0===(t&&t.layerMask&a.layerMask))continue;const n=a.emitter;n.position&&e&&-1===e.indexOf(n)||this._scene._activeParticles.addCount(a.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}static frontToBackSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}static backToFrontSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}static PainterSortCompare(e,t){const i=e.getMesh(),a=t.getMesh();return i.material&&a.material?i.material.Hc-a.material.Hc:i.Hc-a.Hc}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){const i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}_renderAlphaTestSorted(t){e._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}render(e,t,i,a){if(e)return void e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const n=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(n.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),n.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const s=n.getStencilBuffer();if(n.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(a),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(n.setStencilBuffer(s),this._scene.useOrderIndependentTransparency){const e=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);e.length&&this._renderTransparent(e)}else this._renderTransparent(this._transparentSubMeshes);n.setAlphaMode(0)}if(n.setStencilBuffer(!1),this._edgesRenderers.length){for(let e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();n.setAlphaMode(0)}n.setStencilBuffer(s)}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}prepareSprites(){this._spriteManagers.reset()}_renderOpaqueSorted(t){e._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}set opaqueSortCompareFn(t){this._opaqueSortCompareFn=t||e.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}static defaultTransparentSortCompare(t,i){return t._alphaIndex>i._alphaIndex?1:t._alphaIndex<i._alphaIndex?-1:e.backToFrontSortCompare(t,i)}};RenderingGroup._ZeroVector=Vector3.Zero();var RenderingGroupInfo=class{},RenderingManager=class e{setRenderingOrder(e,t=null,i=null,a=null){if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=a,this._renderingGroups[e]){const t=this._renderingGroups[e];t.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],t.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],t.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}setRenderingAutoClearDepthStencil(e,t,i=!0,a=!0){this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:a}}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}resetSprites(){if(!this.maintainStateBetweenFrames)for(let t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){const e=this._renderingGroups[t];e&&e.prepareSprites()}}render(t,i,a,n){const s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(let e=0;e<this._scene.spriteManagers.length;e++){const t=this._scene.spriteManagers[e];this.dispatchSprites(t)}for(let r=e.MIN_RENDERINGGROUPS;r<e.MAX_RENDERINGGROUPS;r++){this._depthStencilBufferAlreadyCleaned=r===e.MIN_RENDERINGGROUPS;const o=this._renderingGroups[r];if(!o||o._empty)continue;const l=1<<r;if(s.undefinedc=r,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,l),e.AUTOCLEAR){const e=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(r):this._autoClearDepthStencil[r];e&&e.autoClear&&this._clearDepthStencilBuffer(e.depth,e.stencil)}for(const e of this._scene._beforeRenderingGroupDrawStage)e.action(r);o.render(t,n,a,i);for(const e of this._scene._afterRenderingGroupDrawStage)e.action(r);this._scene.onAfterRenderingGroupObservable.notifyObservers(s,l)}}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.undefinedc).dispatchSprites(e))}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.undefinedc).dispatchParticles(e))}_clearDepthStencilBuffer(e=!0,t=!0){this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}reset(){if(!this.maintainStateBetweenFrames)for(let t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){const e=this._renderingGroups[t];e&&e.prepare()}}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(t.undefinedc).dispatch(e,t,i))}getRenderingGroup(e){const t=e||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}constructor(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new RenderingGroupInfo,this._maintainStateBetweenFrames=!1,this._scene=t;for(let t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}_prepareRenderingGroup(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new RenderingGroup(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}restoreDispachedFlags(){for(const e of this._scene.meshes)if(e.subMeshes)for(const t of e.subMeshes)t._wasDispatched=!1;if(this._scene.spriteManagers)for(const e of this._scene.spriteManagers)e._wasDispatched=!1;for(const e of this._scene.particleSystems)e._wasDispatched=!1}freeRenderingGroups(){for(let t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){const e=this._renderingGroups[t];e&&e.dispose()}}};RenderingManager.MAX_RENDERINGGROUPS=4,RenderingManager.MIN_RENDERINGGROUPS=0,RenderingManager.AUTOCLEAR=!0,ThinEngine.prototype.createRenderTargetCubeTexture=function(e,t){const i=this._createHardwareRenderTargetWrapper(!1,!0,e),a={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...t};a.generateStencilBuffer=a.generateDepthBuffer&&a.generateStencilBuffer,(1!==a.type||this._caps.textureFloatLinearFiltering)&&(2!==a.type||this._caps.textureHalfFloatLinearFiltering)||(a.samplingMode=1);const n=this._gl,s=new InternalTexture(this,5);this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,s,!0);const r=this._getSamplingParameters(a.samplingMode,a.generateMipMaps);1!==a.type||this._caps.textureFloat||(a.type=0,Logger.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,r.mag),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,r.min),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);for(let t=0;t<6;t++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this._getRGBABufferInternalSizedFormat(a.type,a.format),e,e,0,this._getInternalFormat(a.format),this._getWebGLTextureType(a.type),null);const o=n.createFramebuffer();return this._bindUnboundFramebuffer(o),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(a.generateStencilBuffer,a.generateDepthBuffer,e,e),a.generateMipMaps&&n.generateMipmap(n.TEXTURE_CUBE_MAP),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),i._framebuffer=o,i._generateDepthBuffer=a.generateDepthBuffer,i._generateStencilBuffer=a.generateStencilBuffer,s.width=e,s.height=e,s.isReady=!0,s.isCube=!0,s.samples=1,s.generateMipMaps=a.generateMipMaps,s.samplingMode=a.samplingMode,s.type=a.type,s.format=a.format,this._internalTexturesCache.push(s),i.setTextures(s),i},ThinEngine.prototype.setDepthStencilTexture=function(e,t,i,a){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0,a):this._setTexture(e,null,void 0,void 0,a))},init_postprocess_vertex();var defaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},EffectRenderer=class{restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}dispose(){const e=this._vertexBuffers[VertexBuffer.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[VertexBuffer.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}constructor(e,t=defaultOptions){this._fullscreenViewport=new Viewport(0,0,1,1);const i=t.positions??defaultOptions.positions,a=t.indices??defaultOptions.indices;this.engine=e,this._vertexBuffers={[VertexBuffer.PositionKind]:new VertexBuffer(e,i,VertexBuffer.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(a),this._onContextRestoredObserver=e.onContextRestoredObservable.add((()=>{this._indexBuffer=e.createIndexBuffer(a);for(const e in this._vertexBuffers){this._vertexBuffers[e]._rebuild()}}))}render(e,t=null){if(!e.effect.isReady())return;this.saveStates(),this.setViewport();const i=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;i&&this.engine.bindFramebuffer(i),this.applyEffectWrapper(e),this.draw(),i&&this.engine.unBindFramebuffer(i),this.restoreStates()}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e._drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}setViewport(e=this._fullscreenViewport){this.engine.setViewport(e)}_isRenderTargetTexture(e){return void 0!==e.renderTarget}draw(){this.engine.drawElementsType(0,0,6)}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}},EffectWrapper=class{constructor(e){let t;this.onApplyObservable=new Observable;const i=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(i.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)})));const a=e.defines?e.defines.join("\n"):"";this._drawWrapper=new DrawWrapper(e.engine),e.useShaderStore?(t.fragment=t.fragmentSource,t.vertex||(t.vertex=t.vertexSource),delete t.fragmentSource,delete t.vertexSource,this.effect=e.engine.createEffect(t,e.attributeNames||["position"],i,e.samplerNames,a,void 0,e.onCompiled,void 0,void 0,e.shaderLanguage)):(this.effect=new Effect(t,e.attributeNames||["position"],i,e.samplerNames,e.engine,a,void 0,e.onCompiled,void 0,void 0,void 0,e.shaderLanguage),this._onContextRestoredObserver=e.engine.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()})))}dispose(e=!1){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()}set effect(e){this._drawWrapper.effect=e}get effect(){return this._drawWrapper.effect}},_dumpToolsEngine;function _CreateDumpRenderer(){if(!_dumpToolsEngine){let e,t=null;const i={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};try{e=new OffscreenCanvas(100,100),t=new ThinEngine(e,!1,i)}catch(a){e=document.createElement("canvas"),t=new ThinEngine(e,!1,i)}EngineStore.Instances.pop(),EngineStore.OnEnginesDisposedObservable.add((e=>{t&&e!==t&&!t.isDisposed&&0===EngineStore.Instances.length&&Dispose()})),t.getCaps().parallelShaderCompile=void 0;const a=new EffectRenderer(t),n=new EffectWrapper({engine:t,name:passPixelShader.name,fragmentShader:passPixelShader.shader,samplerNames:["textureSampler"]});_dumpToolsEngine={canvas:e,engine:t,renderer:a,wrapper:n}}return _dumpToolsEngine}async function DumpFramebuffer(e,t,i,a,n="image/png",s,r){const o=await i.readPixels(0,0,e,t);DumpData(e,t,new Uint8Array(o.buffer),a,n,s,!0,void 0,r)}function DumpDataAsync(e,t,i,a="image/png",n,s=!1,r=!1,o){return new Promise((l=>{DumpData(e,t,i,(e=>l(e)),a,n,s,r,o)}))}function DumpData(e,t,i,a,n="image/png",s,r=!1,o=!1,l){const c=_CreateDumpRenderer();if(c.engine.setSize(e,t,!0),i instanceof Float32Array){const e=new Uint8Array(i.length);let t=i.length;for(;t--;){const a=i[t];e[t]=Math.round(255*Scalar.Clamp(a))}i=e}const h=c.engine.createRawTexture(i,e,t,5,!1,!r,1);c.renderer.setViewport(),c.renderer.applyEffectWrapper(c.wrapper),c.wrapper.effect._bindTexture("textureSampler",h),c.renderer.draw(),o?Tools.ToBlob(c.canvas,(e=>{const t=new FileReader;t.onload=e=>{const t=e.target.result;a&&a(t)},t.readAsArrayBuffer(e)}),n,l):Tools.EncodeScreenshotCanvasData(c.canvas,a,n,s,l),h.dispose()}function Dispose(){_dumpToolsEngine&&(_dumpToolsEngine.wrapper.dispose(),_dumpToolsEngine.renderer.dispose(),_dumpToolsEngine.engine.dispose()),_dumpToolsEngine=null}init_pass_fragment();var initSideEffects2=()=>{Tools.DumpData=DumpData,Tools.DumpDataAsync=DumpDataAsync,Tools.DumpFramebuffer=DumpFramebuffer};initSideEffects2(),Effect.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)};var RenderTargetTexture=class e extends Texture{isReadyForRendering(){return this._render(!1,!1,!0)}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}_releaseRenderPassId(){if(this._scene){const e=this._scene.getEngine();for(let t=0;t<this._renderPassIds.length;++t)e.releaseRenderPassId(this._renderPassIds[t])}this._renderPassIds=[]}constructor(e,t,i,a=!1,n=!0,s=0,r=!1,o=Texture.TRILINEAR_SAMPLINGMODE,l=!0,c=!1,h=!1,u=5,m=!1,d,f,p=!1,_=!1){let g,v=!0;if("object"==typeof a){const e=a;a=!!e.generateMipMaps,n=e.doNotChangeAspectRatio??!0,s=e.type??0,r=!!e.isCube,o=e.samplingMode??Texture.TRILINEAR_SAMPLINGMODE,l=e.generateDepthBuffer??!0,c=!!e.generateStencilBuffer,h=!!e.isMulti,u=e.format??5,m=!!e.delayAllocation,d=e.samples,f=e.creationFlags,p=!!e.noColorAttachment,_=!!e.useSRGBBuffer,g=e.colorAttachment,v=e.gammaSpace??v}if(super(null,i,!a,void 0,o,void 0,void 0,void 0,void 0,u),this._unObserveRenderList=null,this._renderListHasChanged=(e,t)=>{const i=this._renderList?this._renderList.length:0;(0===t&&i>0||0===i)&&this.getScene()?.meshes.forEach((e=>{e._markSubMeshesAsLightDirty()}))},this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new Observable,this.onAfterUnbindObservable=new Observable,this.onBeforeRenderObservable=new Observable,this.onAfterRenderObservable=new Observable,this.onClearObservable=new Observable,this.onResizeObservable=new Observable,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=Vector3.Zero(),!(i=this.getScene()))return;const y=this.getScene().getEngine();this._gammaSpace=v,this._coordinatesMode=Texture.PROJECTION_MODE,this.cb=[],this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._renderPassIds=[],this._isCubeData=r,this._processSizeParameter(t),this.renderPassId=this._renderPassIds[0],this._resizeObserver=y.onResizeObservable.add((()=>{})),this._generateMipMaps=!!a,this._doNotChangeAspectRatio=n,this._renderingManager=new RenderingManager(i),this._renderingManager._useSceneAutoClearSetup=!0,h||(this._renderTargetOptions={generateMipMaps:a,type:s,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:l,generateStencilBuffer:c,samples:d,creationFlags:f,noColorAttachment:p,useSRGBBuffer:_,colorAttachment:g,label:this.name},this.samplingMode===Texture.NEAREST_SAMPLINGMODE&&(this.wrapU=Texture.CLAMP_ADDRESSMODE,this.wrapV=Texture.CLAMP_ADDRESSMODE),m||(r?(this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=Texture.INVCUBIC_MODE,this._textureMatrix=Matrix.Identity()):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==d&&(this.samples=d)))}_bestReflectionRenderTargetDimension(e,t){const i=e*t,a=NearestPOT(i+16384/(128+i));return Math.min(FloorPOT(e),a)}_processSizeParameter(e,t=!0){if(e.ratio){this._sizeRatio=e.ratio;const t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e;t&&this._createRenderPassId()}get refreshRate(){return this._refreshRate}get renderPassIds(){return this._renderPassIds}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}_prepareFrame(e,t,i,a){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):a&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,i)}releaseInternalTexture(){this._renderTarget?.releaseTextures(),this._texture=null}get depthStencilTexture(){return this._renderTarget?._depthStencilTexture??null}get currentRefreshId(){return this._currentRefreshId}setRenderingOrder(e,t=null,i=null,a=null){this._renderingManager.setRenderingOrder(e,t,i,a)}get boundingBoxSize(){return this._boundingBoxSize}serialize(){if(!this.name)return null;const e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.cb=[],this.cb)for(let t=0;t<this.cb.length;t++)e.cb.push(this.cb[t].id);return e}_renderToTarget(e,t,i,a=0,n=null){const s=this.getScene();if(!s)return;const r=s.getEngine();r._debugPushGroup?.(`render to face #${e} layer #${a}`,1),this._prepareFrame(s,e,a,t),this.is2DArray||this.is3D?(r.currentRenderPassId=this._renderPassIds[a],this.onBeforeRenderObservable.notifyObservers(a)):(r.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e));if(r.snapshotRendering&&1===r.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(r):this.skipInitialClear||r.clear(this.clearColor||s.clearColor,!0,!0,!0);else{let o=null;const l=this.cb?this.cb:s.getActiveMeshes().data,c=this.cb?this.cb.length:s.getActiveMeshes().length;this.getCustomRenderList&&(o=this.getCustomRenderList(this.is2DArray||this.is3D?a:e,l,c)),o?this._prepareRenderingManager(o,o.length,n,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(l,c,n,!this.cb||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),o=l);for(const t of s._beforeRenderTargetClearStage)t.action(this,e,a);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(r):this.skipInitialClear||r.clear(this.clearColor||s.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||s.updateTransformMatrix(!0);for(const t of s._beforeRenderTargetDrawStage)t.action(this,e,a);this._renderingManager.render(this.customRenderFunction,o,this.renderParticles,this.renderSprites);for(const t of s._afterRenderTargetDrawStage)t.action(this,e,a);const h=this._texture?.generateMipMaps??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e,this._postProcesses,this.ignoreCameraViewport):t&&s.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e);for(const t of s._afterRenderTargetPostProcessStage)t.action(this,e,a);this._texture&&(this._texture.generateMipMaps=h),this._doNotChangeAspectRatio||s.updateTransformMatrix(!0),i&&DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),r)}this._unbindFrameBuffer(r,e),this._texture&&this.isCube&&5===e&&r.generateMipMapsForCubemap(this._texture,!0),r._debugPopGroup?.(1)}getRenderHeight(){return this._size.width?this._size.height:this._size}get postProcesses(){return this._postProcesses}getRenderSize(){return this.getRenderWidth()}dispose(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.cb=null;const e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);t>=0&&e.customRenderTargets.splice(t,1);for(const i of e.cameras)t=i.customRenderTargets.indexOf(this),t>=0&&i.customRenderTargets.splice(t,1);this._renderTarget?.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}disableRescaling(){this._canRescale=!1}removePostProcess(e){if(!this._postProcesses)return;const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}createDepthStencilTexture(e=0,t=!0,i=!1,a=1,n=14,s){this._renderTarget?.createDepthStencilTexture(e,t,i,a,n,s)}set cb(e){this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),e&&(this._unObserveRenderList=_ObserveArray(e,this._renderListHasChanged)),this._renderList=e}clone(){const t=this.getSize(),i=new e(this.name,t,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.coordinatesMode=this.coordinatesMode,this.cb&&(i.cb=this.cb.slice(0)),i}scale(e){const t=Math.max(1,this.getRenderSize()*e);this.resize(t)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}get samples(){return this._renderTarget?.samples??this._samples}_createRenderPassId(){this._releaseRenderPassId();const e=this._scene.getEngine(),t=this._isCubeData?6:this.getRenderLayers()||1;for(let i=0;i<t;++i)this._renderPassIds[i]=e.createRenderPassId(`RenderTargetTexture - ${this.name}#${i}`)}_bindFrameBuffer(e=0,t=0){const i=this.getScene();if(!i)return;const a=i.getEngine();this._renderTarget&&a.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}getRenderWidth(){return this._size.width?this._size.width:this._size}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get isMulti(){return this._renderTarget?.isMulti??!1}resetRefreshCounter(){this._currentRefreshId=-1}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(const e of this._postProcesses)e.dispose();this._postProcesses=[]}}setRenderingAutoClearDepthStencil(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get canRescale(){return this._canRescale}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}get renderTargetOptions(){return this._renderTargetOptions}disposeFramebufferObjects(){this._renderTarget?.dispose(!0)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}_prepareRenderingManager(e,t,i,a){const n=this.getScene();if(!n)return;this._renderingManager.reset();const s=n.getRenderId();for(let r=0;r<t;r++){const t=e[r];if(t&&!t.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(t,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!t.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!t._internalAbstractMeshDataInfo._currentLODIsUpToDate&&n.activeCamera&&(t._internalAbstractMeshDataInfo._currentLOD=n.customLODSelector?n.customLODSelector(t,this.activeCamera||n.activeCamera):t.getLOD(this.activeCamera||n.activeCamera),t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!t._internalAbstractMeshDataInfo._currentLOD)continue;let e,r=t._internalAbstractMeshDataInfo._currentLOD;if(r._preActivateForIntermediateRendering(s),e=!(!a||!i)&&!(t.layerMask&i.layerMask),t.isEnabled()&&t.isVisible&&t.subMeshes&&!e){if(r!==t&&r._activate(s,!0),t._activate(s,!0)&&t.subMeshes.length){t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(r=t):r._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,r._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(let e=0;e<r.subMeshes.length;e++){const t=r.subMeshes[e];this._renderingManager.dispatch(t,r)}}t._postActivate()}}}for(let e=0;e<n.particleSystems.length;e++){const t=n.particleSystems[e],i=t.emitter;t.isStarted()&&i&&(!i.position||i.isEnabled())&&this._renderingManager.dispatchParticles(t)}}setMaterialForRendering(e,t){let i;i=Array.isArray(e)?e:[e];for(let e=0;e<i.length;++e)for(let a=0;a<this._renderPassIds.length;++a)i[e].setMaterialForRenderPass(this._renderPassIds[a],void 0!==t?Array.isArray(t)?t[a]:t:void 0)}render(e=!1,t=!1){this._render(e,t)}addPostProcess(e){if(!this._postProcessManager){const e=this.getScene();if(!e)return;this._postProcessManager=new PostProcessManager(e),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}getViewCount(){return 1}get cb(){return this._renderList}resize(e){const t=this.isCube;this._renderTarget?.dispose(),this._renderTarget=null;const i=this.getScene();i&&(this._processSizeParameter(e,!1),this._renderTarget=t?i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}getRenderLayers(){const e=this._size.layers;if(e)return e;const t=this._size.depth;return t||0}_render(e=!1,t=!1,i=!1){const a=this.getScene();if(!a)return i;const n=a.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.cb=[];for(let e=0;e<this._waitingRenderList.length;e++){const t=this._waitingRenderList[e],i=a.getMeshById(t);i&&this.cb.push(i)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.cb?this.cb.length=0:this.cb=[];const e=this.getScene();if(!e)return i;const t=e.meshes;for(let e=0;e<t.length;e++){const i=t[e];this.renderListPredicate(i)&&this.cb.push(i)}}const s=n.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const r=this.activeCamera??a.activeCamera,o=a.activeCamera;r&&(r!==a.activeCamera&&(a.setTransformMatrix(r.getViewMatrix(),r.getProjectionMatrix(!0)),a.activeCamera=r),n.setViewport(r.rigParent?r.rigParent.viewport:r.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let l=i;if(i){a.getViewMatrix()||a.updateTransformMatrix();const e=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let t=0;t<e&&l;t++){let e=null;const s=this.cb?this.cb:a.getActiveMeshes().data,r=this.cb?this.cb.length:a.getActiveMeshes().length;n.currentRenderPassId=this._renderPassIds[t],this.onBeforeRenderObservable.notifyObservers(t),this.getCustomRenderList&&(e=this.getCustomRenderList(t,s,r)),e||(e=s),this._doNotChangeAspectRatio||a.updateTransformMatrix(!0);for(let t=0;t<e.length&&l;++t){const a=e[t];if(a.isEnabled()&&!a.isBlocked&&a.isVisible&&a.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(a,this.refreshRate,i)){l=!1;continue}}else if(!a.isReady(!0)){l=!1;continue}}this.onAfterRenderObservable.notifyObservers(t),(this.is2DArray||this.is3D||this.isCube)&&(a.incrementRenderId(),a.resetCachedMaterial())}}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let i=0;i<6;i++)this._renderToTarget(i,e,t,void 0,r),a.incrementRenderId(),a.resetCachedMaterial();else this._renderToTarget(0,e,t,void 0,r);else for(let i=0;i<this.getRenderLayers();i++)this._renderToTarget(0,e,t,i,r),a.incrementRenderId(),a.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),n.currentRenderPassId=s,o&&(a.activeCamera=o,this.activeCamera&&this.activeCamera!==a.activeCamera&&a.setTransformMatrix(a.activeCamera.getViewMatrix(),a.activeCamera.getProjectionMatrix(!0)),n.setViewport(a.activeCamera.viewport)),a.resetCachedMaterial(),l}_rebuild(){this.refreshRate===e.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=e.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(t)}))}get renderTarget(){return this._renderTarget}};RenderTargetTexture.REFRESHRATE_RENDER_ONCE=0,RenderTargetTexture.REFRESHRATE_RENDER_ONEVERYFRAME=1,RenderTargetTexture.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,Texture._CreateRenderTargetTexture=(e,t,i,a,n)=>new RenderTargetTexture(e,t,i,a);var ProceduralTextureSceneComponent=class{register(){this.scene._beforeClearStage.registerStep(SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)}_beforeClear(){if(this.scene.proceduralTexturesEnabled){Tools.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(let e=0;e<this.scene.proceduralTextures.length;e++){const t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}Tools.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}}dispose(){}constructor(e){this.name=SceneComponentConstants.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=[]}rebuild(){}};init_shaderStore();var name4="proceduralVertexShader",shader4="attribute vec2 position;varying vec2 vPosition;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvPosition=position;vUV=position*madd+madd;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";ShaderStore.ShadersStore[name4]=shader4;var ProceduralTexture=class e extends Texture{reset(){this._drawWrapper.effect?.dispose(),this._drawWrapper.effect=null,this._cachedDefines=null}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}executeWhenReady(e){if(this.isReady())return void e(this);const t=this.getEffect();t&&t.executeWhenCompiled((()=>{e(this)}))}get refreshRate(){return this._refreshRate}resize(e,t){if(this._fallbackTextureUsed||!this._rtWrapper||!this._texture)return;const i=this._texture.isCube;this._rtWrapper.dispose();const a=this._createRtWrapper(i,e,t,this._textureType);this._texture=a.texture,this._size=e,this._generateMipMaps=t}clone(){const t=this.getSize(),i=new e(this.name,t.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.coordinatesMode=this.coordinatesMode,i}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}getEffect(){return this._drawWrapper.effect}getRenderSize(){return this._size}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}_setEffect(e){this._drawWrapper.effect=e}_createRtWrapper(e,t,i,a){return e?(this._rtWrapper=this._fullEngine.createRenderTargetCubeTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:a,...this._options}),this.setFloat("face",0)):this._rtWrapper=this._fullEngine.createRenderTargetTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:a,...this._options}),this._rtWrapper}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}_checkUniform(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}render(e){const t=this.getScene();if(!t)return;const i=this._fullEngine;if(i.enableEffect(this._drawWrapper),this.onBeforeGenerationObservable.notifyObservers(this),i.setState(!1),!this.nodeMaterialSource){for(const e in this._textures)this._drawWrapper.effect.setTexture(e,this._textures[e]);for(const e in this._ints)this._drawWrapper.effect.setInt(e,this._ints[e]);for(const e in this._floats)this._drawWrapper.effect.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)this._drawWrapper.effect.setArray(e,this._floatsArrays[e]);for(const e in this._colors3)this._drawWrapper.effect.setColor3(e,this._colors3[e]);for(const e in this._colors4){const t=this._colors4[e];this._drawWrapper.effect.setFloat4(e,t.r,t.g,t.b,t.a)}for(const e in this._vectors2)this._drawWrapper.effect.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)this._drawWrapper.effect.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)this._drawWrapper.effect.setVector4(e,this._vectors4[e]);for(const e in this._matrices)this._drawWrapper.effect.setMatrix(e,this._matrices[e])}if(!this._texture||!this._rtWrapper)return;i._debugPushGroup?.(`procedural texture generation for ${this.name}`,1);const a=i.currentViewport;if(this.isCube)for(let e=0;e<6;e++)i.bindFramebuffer(this._rtWrapper,e,void 0,void 0,!0),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._drawWrapper.effect.setFloat("face",e),this.autoClear&&i.clear(t.clearColor,!0,!1,!1),i.drawElementsType(Material.TriangleFillMode,0,6);else{let e=1;this._rtWrapper.is3D?e=this._rtWrapper.depth:this._rtWrapper.is2DArray&&(e=this._rtWrapper.layers);for(let a=0;a<e;a++)i.bindFramebuffer(this._rtWrapper,0,void 0,void 0,!0,0,a),(this._rtWrapper.is3D||this._rtWrapper.is2DArray)&&this._drawWrapper.effect?.setFloat("layer",1!==e?a/(e-1):0),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this.autoClear&&i.clear(t.clearColor,!0,!1,!1),i.drawElementsType(Material.TriangleFillMode,0,6)}i.unBindFramebuffer(this._rtWrapper,this.isCube),a&&i.setViewport(a),this.isCube&&i.generateMipMapsForCubemap(this._texture,!0),i._debugPopGroup?.(1),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}_shouldRender(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}constructor(e,t,i,a,n=null,s=!0,r=!1,o=0){super(null,a,!s),this.isEnabled=!0,this.autoClear=!0,this.onGeneratedObservable=new Observable,this.onBeforeGenerationObservable=new Observable,this.nodeMaterialSource=null,this._textures={},this._currentRefreshId=-1,this._frameId=-1,this._refreshRate=1,this._vertexBuffers={},this._uniforms=new Array,this._samplers=new Array,this._floats={},this._ints={},this._floatsArrays={},this._colors3={},this._colors4={},this._vectors2={},this._vectors3={},this._vectors4={},this._matrices={},this._fallbackTextureUsed=!1,this._cachedDefines=null,this._contentUpdateId=-1,this._rtWrapper=null,null===n||n instanceof Texture?(this._options={},this._fallbackTexture=n):(this._options=n,this._fallbackTexture=n.fallbackTexture??null);let l=(a=this.getScene()||EngineStore.LastCreatedScene)._getComponent(SceneComponentConstants.NAME_PROCEDURALTEXTURE);l||(l=new ProceduralTextureSceneComponent(a),a._addComponent(l)),a.proceduralTextures.push(this),this._fullEngine=a.getEngine(),this.name=e,this.isRenderTarget=!0,this._size=t,this._textureType=o,this._generateMipMaps=s,this._drawWrapper=new DrawWrapper(this._fullEngine),this.setFragment(i);const c=this._createRtWrapper(r,t,s,o);this._texture=c.texture;const h=[];h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),this._vertexBuffers[VertexBuffer.PositionKind]=new VertexBuffer(this._fullEngine,h,VertexBuffer.PositionKind,!1,!1,2),this._createIndexBuffer()}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}getContent(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData?this._contentData.then((e=>{this._contentData=this.readPixels(0,0,e),this._contentUpdateId=this._frameId})):(this._contentData=this.readPixels(0,0),this._contentUpdateId=this._frameId)),this._contentData}_getDefines(){return""}resetRefreshCounter(){this._currentRefreshId=-1}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}_createIndexBuffer(){const e=this._fullEngine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)}isReady(){const e=this._fullEngine;if(this.nodeMaterialSource)return this._drawWrapper.effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;if(!this._texture)return!1;const t=this._getDefines();if(this._drawWrapper.effect&&t===this._cachedDefines&&this._drawWrapper.effect.isReady())return!0;const i={vertex:"procedural",fragmentElement:this._fragment.fragmentElement,fragmentSource:this._fragment.fragmentSource,fragment:"string"==typeof this._fragment?this._fragment:void 0};return this._cachedDefines!==t&&(this._cachedDefines=t,this._drawWrapper.effect=e.createEffect(i,[VertexBuffer.PositionKind],this._uniforms,this._samplers,t,void 0,void 0,(()=>{this._rtWrapper?.dispose(),this._rtWrapper=this._texture=null,this._fallbackTexture&&(this._texture=this._fallbackTexture._texture,this._texture&&this._texture.incrementReferences()),this._fallbackTextureUsed=!0}))),this._drawWrapper.effect.isReady()}setFragment(e){this._fragment=e}_rebuild(){const e=this._vertexBuffers[VertexBuffer.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===RenderTargetTexture.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=RenderTargetTexture.REFRESHRATE_RENDER_ONCE)}dispose(){const e=this.getScene();if(!e)return;const t=e.proceduralTextures.indexOf(this);t>=0&&e.proceduralTextures.splice(t,1);const i=this._vertexBuffers[VertexBuffer.PositionKind];i&&(i.dispose(),this._vertexBuffers[VertexBuffer.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),super.dispose()}setTexture(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this}},TrigonometryBlockOperations,TrigonometryBlockOperations2;__decorate([serialize()],ProceduralTexture.prototype,"isEnabled",void 0),__decorate([serialize()],ProceduralTexture.prototype,"autoClear",void 0),__decorate([serialize()],ProceduralTexture.prototype,"_generateMipMaps",void 0),__decorate([serialize()],ProceduralTexture.prototype,"_size",void 0),__decorate([serialize()],ProceduralTexture.prototype,"refreshRate",null),RegisterClass("BABYLON.ProceduralTexture",ProceduralTexture),TrigonometryBlockOperations2=TrigonometryBlockOperations||(TrigonometryBlockOperations={}),TrigonometryBlockOperations2[TrigonometryBlockOperations2.Cos=0]="Cos",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Sin=1]="Sin",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Abs=2]="Abs",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Exp=3]="Exp",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Exp2=4]="Exp2",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Round=5]="Round",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Floor=6]="Floor",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Ceiling=7]="Ceiling",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Sqrt=8]="Sqrt",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Log=9]="Log",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Tan=10]="Tan",TrigonometryBlockOperations2[TrigonometryBlockOperations2.ArcTan=11]="ArcTan",TrigonometryBlockOperations2[TrigonometryBlockOperations2.ArcCos=12]="ArcCos",TrigonometryBlockOperations2[TrigonometryBlockOperations2.ArcSin=13]="ArcSin",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Fract=14]="Fract",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Sign=15]="Sign",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Radians=16]="Radians",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Degrees=17]="Degrees",TrigonometryBlockOperations2[TrigonometryBlockOperations2.Set=18]="Set";var TrigonometryBlock=class extends NodeMaterialBlock{_deserialize(e,t,i){super._deserialize(e,t,i),this.operation=e.operation}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];let i="";switch(this.operation){case TrigonometryBlockOperations.Cos:i="cos";break;case TrigonometryBlockOperations.Sin:i="sin";break;case TrigonometryBlockOperations.Abs:i="abs";break;case TrigonometryBlockOperations.Exp:i="exp";break;case TrigonometryBlockOperations.Exp2:i="exp2";break;case TrigonometryBlockOperations.Round:i="round";break;case TrigonometryBlockOperations.Floor:i="floor";break;case TrigonometryBlockOperations.Ceiling:i="ceil";break;case TrigonometryBlockOperations.Sqrt:i="sqrt";break;case TrigonometryBlockOperations.Log:i="log";break;case TrigonometryBlockOperations.Tan:i="tan";break;case TrigonometryBlockOperations.ArcTan:i="atan";break;case TrigonometryBlockOperations.ArcCos:i="acos";break;case TrigonometryBlockOperations.ArcSin:i="asin";break;case TrigonometryBlockOperations.Fract:i="fract";break;case TrigonometryBlockOperations.Sign:i="sign";break;case TrigonometryBlockOperations.Radians:i="radians";break;case TrigonometryBlockOperations.Degrees:i="degrees";break;case TrigonometryBlockOperations.Set:i=""}return e.compilationString+=e._declareOutput(t)+` = ${i}(${this.input.associatedVariableName});\n`,this}getClassName(){return"TrigonometryBlock"}serialize(){const e=super.serialize();return e.operation=this.operation,e}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.operation = BABYLON.TrigonometryBlockOperations.${TrigonometryBlockOperations[this.operation]};\n`}get input(){return this._inputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.operation=TrigonometryBlockOperations.Cos,this.registerInput("input",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}};RegisterClass("BABYLON.TrigonometryBlock",TrigonometryBlock);var onCreatedEffectParameters={effect:null,subMesh:null},NodeMaterialDefines=class extends MaterialDefines{constructor(){super(),this.NORMAL=!1,this.TANGENT=!1,this.VERTEXCOLOR_NME=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.PREPASS=!1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.EXPOSURE=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.BUMPDIRECTUV=0,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.rebuild()}setValue(e,t,i=!1){void 0===this[e]&&this._keys.push(e),i&&this[e]!==t&&this.markAsUnprocessed(),this[e]=t}},NodeMaterial=class e extends PushMaterial{getInputBlockByPredicate(e){for(const t of this.attachedBlocks)if(t.isInput&&e(t))return t;return null}_getGlobalNodeMaterialEditor(){return"undefined"!=typeof NODEEDITOR?NODEEDITOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.NodeEditor?BABYLON:void 0}build(e=!1,t=!0,i=!1){if(this._buildIsInProgress)return void Logger.Warn("Build is already in progress, You can use NodeMaterial.onBuildObservable to determine when the build is completed.");this._buildIsInProgress=!0,this._vertexCompilationState||i||(i=!0),this._buildWasSuccessful=!1;const a=this.getScene().getEngine(),n=this._mode===NodeMaterialModes.Particle;if(0===this._vertexOutputNodes.length&&!n)throw"You must define at least one vertexOutputNode";if(0===this._fragmentOutputNodes.length)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new NodeMaterialBuildState,this._vertexCompilationState.supportUniformBuffers=a.supportsUniformBuffers,this._vertexCompilationState.target=NodeMaterialBlockTargets.Vertex,this._fragmentCompilationState=new NodeMaterialBuildState,this._fragmentCompilationState.supportUniformBuffers=a.supportsUniformBuffers,this._fragmentCompilationState.target=NodeMaterialBlockTargets.Fragment,this._sharedData=new NodeMaterialBuildStateSharedData,this._sharedData.nodeMaterial=this,this._sharedData.fragmentOutputNodes=this._fragmentOutputNodes,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=e,this._sharedData.scene=this.getScene(),this._sharedData.allowEmptyVertexProgram=n;const s=[],r=[];for(const e of this._vertexOutputNodes)s.push(e),this._initializeBlock(e,this._vertexCompilationState,r,i);for(const e of this._fragmentOutputNodes)r.push(e),this._initializeBlock(e,this._fragmentCompilationState,s,i);let o=0;for(const i of this.attachedBlocks)i.codeIsReady||(o++,i.onCodeIsReadyObservable.addOnce((()=>{o--,0===o&&this._finishBuildProcess(e,t,s,r)})));0===o&&this._finishBuildProcess(e,t,s,r)}get shaderLanguage(){return this._options.shaderLanguage}_gatherBlocks(e,t){if(-1===t.indexOf(e)){t.push(e);for(const i of e.inputs){const a=i.connectedPoint;if(a){const i=a.ownerBlock;i!==e&&this._gatherBlocks(i,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._gatherBlocks(i.entryPoint,t)}}}removeOutputNode(e){return null===e.target||(e.target&NodeMaterialBlockTargets.Vertex&&this._removeVertexOutputNode(e),e.target&NodeMaterialBlockTargets.Fragment&&this._removeFragmentOutputNode(e)),this}getInputBlocks(){const e=[];for(const t of this.attachedBlocks)t.isInput&&e.push(t);return e}_removeFragmentOutputNode(e){const t=this._fragmentOutputNodes.indexOf(e);if(-1!==t)return this._fragmentOutputNodes.splice(t,1),this}getBlockByName(e){let t=null;for(const i of this.attachedBlocks)if(i.name===e){if(t)return Tools.Warn("More than one block was found with the name `"+e+"`"),t;t=i}return t}getClassName(){return"NodeMaterial"}parseSerializedObject(e,t="",i=!1,a){i||this.clear();const n={};for(const i of e.blocks){const e=GetClass(i.customType);if(e){const s=new e;s._deserialize(i,this.getScene(),t,a),n[i.id]=s,this.attachedBlocks.push(s)}}for(const e of this.attachedBlocks)if(e.isTeleportOut){const t=e,i=t._tempEntryPointUniqueId;if(i){n[i].attachToEndpoint(t)}}for(let t=0;t<e.blocks.length;t++){const a=n[e.blocks[t].id];a&&(a.inputs.length&&!i||this._restoreConnections(a,e,n))}if(e.outputNodes)for(const t of e.outputNodes)this.addOutputNode(n[t]);if(e.locations||e.editorData&&e.editorData.locations){const t=e.locations||e.editorData.locations;for(const e of t)n[e.blockId]&&(e.blockId=n[e.blockId].Hc);i&&this.editorData&&this.editorData.locations&&t.concat(this.editorData.locations),e.locations?this.editorData={locations:t}:(this.editorData=e.editorData,this.editorData.locations=t);const a=[];for(const e in n)a[e]=n[e].Hc;this.editorData.map=a}this.comment=e.comment,void 0!==e.forceAlphaBlending&&(this.forceAlphaBlending=e.forceAlphaBlending),void 0!==e.alphaMode&&(this.alphaMode=e.alphaMode),i||(this._mode=e.mode??NodeMaterialModes.Material)}clear(){this._vertexOutputNodes.length=0,this._fragmentOutputNodes.length=0,this.attachedBlocks.length=0}_removeVertexOutputNode(e){const t=this._vertexOutputNodes.indexOf(e);if(-1!==t)return this._vertexOutputNodes.splice(t,1),this}static ParseFromSnippetAsync(t,i=EngineStore.LastCreatedScene,a="",n,s=!1,r=!1,o){return"_BLANK"===t?Promise.resolve(e.CreateDefault("blank",i)):new Promise(((l,c)=>{const h=new WebRequest;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const u=JSON.parse(JSON.parse(h.responseText).jsonPayload),m=JSON.parse(u.nodeMaterial);n||((n=SerializationHelper.Parse((()=>new e(t,i)),m,i,a)).Hc=i.getUniqueId()),n.parseSerializedObject(m,void 0,void 0,o),n.snippetId=t,n.sideOrientation=null;try{s||n.build()}catch(e){c(e)}r?n.whenTexturesReadyAsync().then((()=>{l(n)})).catch((e=>{c(e)})):l(n)}else c("Unable to load the snippet "+t)})),h.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),h.send()}))}_initializeBlock(e,t,i,a=!0){if(e.initialize(t),a&&e.autoConfigure(this),e._preparationId=this._buildId,-1===this.attachedBlocks.indexOf(e)){if(e.isUnique){const t=e.getClassName();for(const e of this.attachedBlocks)if(e.getClassName()===t)throw`Cannot have multiple blocks of type ${t} in the same NodeMaterial`}this.attachedBlocks.push(e)}for(const n of e.inputs){n.associatedVariableName="";const s=n.connectedPoint;if(s){const n=s.ownerBlock;n!==e&&this._processInitializeOnLink(n,t,i,a)}}if(e.isTeleportOut){const n=e;n.entryPoint&&this._processInitializeOnLink(n.entryPoint,t,i,a)}for(const t of e.outputs)t.associatedVariableName=""}_checkInternals(e){if(this._sharedData.animatedInputs){const e=this.getScene(),t=e.getFrameId();if(this._animationFrame!==t){for(const t of this._sharedData.animatedInputs)t.animate(e);this._animationFrame=t}}for(const t of this._sharedData.bindableBlocks)t.bind(e,this);for(const t of this._sharedData.inputBlocks)t._transmit(e,this.getScene(),this)}get isPrePassCapable(){return!0}serialize(e){const t=e?{}:SerializationHelper.Serialize(this);t.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];if(e)i=e;else{t.customType="BABYLON.NodeMaterial",t.outputNodes=[];for(const e of this._vertexOutputNodes)this._gatherBlocks(e,i),t.outputNodes.push(e.Hc);for(const e of this._fragmentOutputNodes)this._gatherBlocks(e,i),-1===t.outputNodes.indexOf(e.Hc)&&t.outputNodes.push(e.Hc)}t.blocks=[];for(const e of i)t.blocks.push(e.serialize());if(!e)for(const e of this.attachedBlocks)-1===i.indexOf(e)&&t.blocks.push(e.serialize());return t.Hc=this.Hc,t}_processDefines(e,t,i=!1,a){let n=null;if(PrepareDefinesForCamera(this.getScene(),t)&&t.markAsMiscDirty(),this._sharedData.blocksWithDefines.forEach((a=>{a.initializeDefines(e,this,t,i)})),this._sharedData.blocksWithDefines.forEach((n=>{n.prepareDefines(e,this,t,i,a)})),t.isDirty){const i=t._areLightsDisposed;t.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach((i=>{i.replaceRepeatableContent(this._vertexCompilationState,this._fragmentCompilationState,e,t)}));const a=[];this._sharedData.dynamicUniformBlocks.forEach((e=>{e.updateUniformsAndSamples(this._vertexCompilationState,this,t,a)}));const s=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach((e=>{-1===s.indexOf(e)&&s.push(e)}));const r=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach((e=>{-1===r.indexOf(e)&&r.push(e)}));const o=new EffectFallbacks;this._sharedData.blocksWithFallbacks.forEach((t=>{t.provideFallbacks(e,o)})),n={lightDisposed:i,uniformBuffers:a,mergedUniforms:s,mergedSamplers:r,fallbacks:o}}return n}setToDefaultPostProcess(){this.clear(),this.editorData=null;const e=new InputBlock("Position");e.setAsAttribute("position2d");const t=new InputBlock("Constant1");t.isConstant=!0,t.value=1;const i=new VectorMergerBlock("Position3D");e.connectTo(i),t.connectTo(i,{input:"w"});const a=new VertexOutputBlock("VertexOutput");i.connectTo(a);const n=new InputBlock("Scale");n.visibleInInspector=!0,n.value=new Vector2(1,1);const s=new RemapBlock("uv0");e.connectTo(s);const r=new MultiplyBlock("UV scale");s.connectTo(r),n.connectTo(r);const o=new CurrentScreenBlock("CurrentScreen");r.connectTo(o),o.texture=new Texture("https://assets.babylonjs.com/nme/currentScreenPostProcess.png",this.getScene());const l=new FragmentOutputBlock("FragmentOutput");o.connectTo(l,{output:"rgba"}),this.addOutputNode(a),this.addOutputNode(l),this._mode=NodeMaterialModes.PostProcess}_createNodeEditor(e){const t={nodeMaterial:this,...e};this.BJSNODEMATERIALEDITOR.NodeEditor.Show(t)}dispose(e,t,i){if(t)for(const e of this.getTextureBlocks().filter((e=>e.texture)).map((e=>e.texture)))e.dispose();for(const e of this.attachedBlocks)e.dispose();this.attachedBlocks.length=0,this._sharedData=null,this._vertexCompilationState=null,this._fragmentCompilationState=null,this.onBuildObservable.clear(),this._imageProcessingObserver&&(this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingObserver=null),super.dispose(e,t,i)}get mode(){return this._mode}static CreateDefault(t,i){const a=new e(t,i);return a.setToDefault(),a.build(),a}_addFragmentOutputNode(e){if(-1===this._fragmentOutputNodes.indexOf(e))return e.target=NodeMaterialBlockTargets.Fragment,this._fragmentOutputNodes.push(e),this}createEffectForParticles(e,t,i){this.mode===NodeMaterialModes.Particle?(this._createEffectForParticles(e,BaseParticleSystem.BLENDMODE_ONEONE,t,i),this._createEffectForParticles(e,BaseParticleSystem.BLENDMODE_MULTIPLY,t,i)):Logger.Log("Incompatible material mode")}static _BlockIsTextureBlock(e){return"TextureBlock"===e.getClassName()||"ReflectionTextureBaseBlock"===e.getClassName()||"ReflectionTextureBlock"===e.getClassName()||"ReflectionBlock"===e.getClassName()||"RefractionBlock"===e.getClassName()||"CurrentScreenBlock"===e.getClassName()||"ParticleTextureBlock"===e.getClassName()||"ImageSourceBlock"===e.getClassName()||"TriPlanarBlock"===e.getClassName()||"BiPlanarBlock"===e.getClassName()||"PrePassTextureBlock"===e.getClassName()}_prepareDefinesForAttributes(e,t){const i=t.NORMAL,a=t.TANGENT,n=t.VERTEXCOLOR_NME;t.NORMAL=e.isVerticesDataPresent(VertexBuffer.NormalKind),t.TANGENT=e.isVerticesDataPresent(VertexBuffer.TangentKind);const s=e.useVertexColors&&e.isVerticesDataPresent(VertexBuffer.ColorKind);t.VERTEXCOLOR_NME=s;let r=!1;for(let i=1;i<=6;++i){const a=t["UV"+i];t["UV"+i]=e.isVerticesDataPresent(`uv${1===i?"":i}`),r=r||t["UV"+i]!==a}const o=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;PrepareDefinesForPrePass(this.getScene(),t,!o),(i!==t.NORMAL||a!==t.TANGENT||n!==t.VERTEXCOLOR_NME||r)&&t.markAsAttributesDirty()}addOutputNode(e){if(null===e.target)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return e.target&NodeMaterialBlockTargets.Vertex&&this._addVertexOutputNode(e),e.target&NodeMaterialBlockTargets.Fragment&&this._addFragmentOutputNode(e),this}bindForSubMesh(e,t,i){const a=this.getScene(),n=i.effect;if(!n)return;this._activeEffect=n,this.bindOnlyWorldMatrix(e);const s=this._mustRebind(a,n,i,t.visibility),r=this._sharedData;if(s){for(const e of r.bindableBlocks)e.bind(n,this,t,i);for(const e of r.forcedBindableBlocks)e.bind(n,this,t,i);for(const e of r.inputBlocks)e._transmit(n,a,this)}else if(!this.isFrozen)for(const e of r.forcedBindableBlocks)e.bind(n,this,t,i);this._afterBind(t,this._activeEffect,i)}removeBlock(e){const t=this.attachedBlocks.indexOf(e);t>-1&&this.attachedBlocks.splice(t,1),e.isFinalMerger&&this.removeOutputNode(e)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}createEffectForPostProcess(e){this._createEffectForPostProcess(e)}_processInitializeOnLink(e,t,i,a=!0){(e.target===NodeMaterialBlockTargets.VertexAndFragment||t.target===NodeMaterialBlockTargets.Fragment&&e.target===NodeMaterialBlockTargets.Vertex&&e._preparationId!==this._buildId)&&i.push(e),this._initializeBlock(e,t,i,a)}constructor(t,i,a={}){if(super(t,i||EngineStore.LastCreatedScene),this._buildId=e._BuildIdGenerator++,this._buildWasSuccessful=!1,this._cachedWorldViewMatrix=new Matrix,this._cachedWorldViewProjectionMatrix=new Matrix,this._optimizers=new Array,this._animationFrame=-1,this._buildIsInProgress=!1,this.BJSNODEMATERIALEDITOR=this._getGlobalNodeMaterialEditor(),this.editorData=null,this.ignoreAlpha=!1,this.maxSimultaneousLights=4,this.onBuildObservable=new Observable,this._vertexOutputNodes=new Array,this._fragmentOutputNodes=new Array,this.attachedBlocks=[],this._mode=NodeMaterialModes.Material,this.forceAlphaBlending=!1,a&&1===a.shaderLanguage&&!this.getScene().getEngine().isWebGPU)throw new Error("WebGPU shader language is only supported with WebGPU engine");this._options={emitComments:!1,shaderLanguage:e.DefaultShaderLanguage,...a},this._attachImageProcessingConfiguration(null)}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}createProceduralTexture(e,t){if(this.mode!==NodeMaterialModes.ProceduralTexture)return Logger.Log("Incompatible material mode"),null;let i=this.name+this._buildId;const a=new ProceduralTexture(i,e,null,t),n=new Mesh(i+"Procedural",this.getScene());n.reservedDataStore={hidden:!0};const s=new NodeMaterialDefines,r=this._processDefines(n,s);Effect.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage);let o=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[VertexBuffer.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,s.toString(),r?.fallbacks,void 0,void 0,void 0,this.shaderLanguage);a.nodeMaterialSource=this,a._setEffect(o);let l=this._buildId;const c=()=>{l!==this._buildId&&(delete Effect.ShadersStore[i+"VertexShader"],delete Effect.ShadersStore[i+"PixelShader"],i=this.name+this._buildId,s.markAllAsDirty(),l=this._buildId);const e=this._processDefines(n,s);e&&(Effect.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage),TimingTools.SetImmediate((()=>{o=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[VertexBuffer.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,s.toString(),e?.fallbacks,void 0),a._setEffect(o)}))),this._checkInternals(o)};return a.onBeforeGenerationObservable.add((()=>{c()})),this.onBuildObservable.add((()=>{c()})),a}setToDefaultParticle(){this.clear(),this.editorData=null;const e=new InputBlock("uv");e.setAsAttribute("particle_uv");const t=new ParticleTextureBlock("ParticleTexture");e.connectTo(t);const i=new InputBlock("Color");i.setAsAttribute("particle_color");const a=new MultiplyBlock("Texture * Color");t.connectTo(a),i.connectTo(a);const n=new ParticleRampGradientBlock("ParticleRampGradient");a.connectTo(n);const s=new ColorSplitterBlock("ColorSplitter");i.connectTo(s);const r=new ParticleBlendMultiplyBlock("ParticleBlendMultiply");n.connectTo(r),t.connectTo(r,{output:"a"}),s.connectTo(r,{output:"a"});const o=new FragmentOutputBlock("FragmentOutput");r.connectTo(o),this.addOutputNode(o),this._mode=NodeMaterialModes.Particle}_restoreConnections(e,t,i){for(const a of e.outputs)for(const n of t.blocks){const s=i[n.id];if(s)for(const r of n.inputs)if(i[r.targetBlockId]!==e||r.targetConnectionName!==a.name);else{const e=s.getInputByName(r.inputName);if(!e||e.isConnected)continue;a.connectTo(e,!0),this._restoreConnections(s,t,i)}}}getBlockByPredicate(e){for(const t of this.attachedBlocks)if(e(t))return t;return null}get prePassTextureOutputs(){const e=this.getBlockByPredicate((e=>"PrePassOutputBlock"===e.getClassName())),t=[4];return e?(this.prePassTextureInputs.length||(e.viewDepth.isConnected&&t.push(5),e.viewNormal.isConnected&&t.push(6),e.worldPosition.isConnected&&t.push(1)),t):t}getTextureBlocks(){return this._sharedData?this._sharedData.textureBlocks:[]}static Parse(t,i,a="",n=0){const s=SerializationHelper.Parse((()=>new e(t.name,i,{shaderLanguage:n})),t,i,a);return s.parseSerializedObject(t,a),s.build(),s}_createEffectForParticles(e,t,i,a,n,s,r,o=""){let l=this.name+this._buildId+"_"+t;s||(s=new NodeMaterialDefines),r||(r=this.getScene().getMeshByName(this.name+"Particle"))||((r=new Mesh(this.name+"Particle",this.getScene())).reservedDataStore={hidden:!0});let c=this._buildId;const h=[];let u=o;if(!n){const o=this._processDefines(r,s);Effect.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,void 0,this.shaderLanguage),e.fillDefines(h,t,!1),u=h.join("\n"),n=this.getScene().getEngine().createEffectForParticles(l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,s.toString()+"\n"+u,o?.fallbacks,i,a,e,this.shaderLanguage),e.setCustomEffect(n,t)}n.onBindObservable.add((n=>{c!==this._buildId&&(delete Effect.ShadersStore[l+"PixelShader"],l=this.name+this._buildId+"_"+t,s.markAllAsDirty(),c=this._buildId),h.length=0,e.fillDefines(h,t,!1);const m=h.join("\n");m!==u&&(s.markAllAsDirty(),u=m);const d=this._processDefines(r,s);if(d)return Effect.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,void 0,this.shaderLanguage),n=this.getScene().getEngine().createEffectForParticles(l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,s.toString()+"\n"+u,d?.fallbacks,i,a,e),e.setCustomEffect(n,t),void this._createEffectForParticles(e,t,i,a,n,s,r,o);this._checkInternals(n)}))}registerOptimizer(e){if(!(this._optimizers.indexOf(e)>-1))return this._optimizers.push(e),this}needAlphaBlending(){return!this.ignoreAlpha&&(this.forceAlphaBlending||this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)}set buildId(e){this._buildId=e}createAsShadowDepthWrapper(e){this.mode===NodeMaterialModes.Material?e.shadowDepthWrapper=new BABYLON.ShadowDepthWrapper(this,this.getScene()):Logger.Log("Incompatible material mode")}needAlphaTesting(){return this._sharedData&&this._sharedData.hints.needAlphaTesting}setToDefault(){this.clear(),this.editorData=null;const e=new InputBlock("Position");e.setAsAttribute("position");const t=new InputBlock("World");t.setAsSystemValue(NodeMaterialSystemValues.World);const i=new TransformBlock("WorldPos");e.connectTo(i),t.connectTo(i);const a=new InputBlock("ViewProjection");a.setAsSystemValue(NodeMaterialSystemValues.ViewProjection);const n=new TransformBlock("WorldPos * ViewProjectionTransform");i.connectTo(n),a.connectTo(n);const s=new VertexOutputBlock("VertexOutput");n.connectTo(s);const r=new InputBlock("color");r.value=new Color4(.8,.8,.8,1);const o=new FragmentOutputBlock("FragmentOutput");r.connectTo(o),this.addOutputNode(s),this.addOutputNode(o),this._mode=NodeMaterialModes.Material}_addVertexOutputNode(e){if(-1===this._vertexOutputNodes.indexOf(e))return e.target=NodeMaterialBlockTargets.Vertex,this._vertexOutputNodes.push(e),this}_resetDualBlocks(e,t){e.target===NodeMaterialBlockTargets.VertexAndFragment&&(e.buildId=t);for(const i of e.inputs){const a=i.connectedPoint;if(a){const i=a.ownerBlock;i!==e&&this._resetDualBlocks(i,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._resetDualBlocks(i.entryPoint,t)}}set shaderLanguage(e){this._options.shaderLanguage=e}async loadAsync(t,i=""){return e.ParseFromFileAsync("",t,this.getScene(),i,!0,this)}hasTexture(e){if(super.hasTexture(e))return!0;if(!this._sharedData)return!1;for(const t of this._sharedData.textureBlocks)if(t.texture===e)return!0;return!1}get compiledShaders(){return`// Vertex shader\n${this._vertexCompilationState.compilationString}\n\n// Fragment shader\n${this._fragmentCompilationState.compilationString}`}clone(t,i=!1){const a=this.serialize(),n=SerializationHelper.Clone((()=>new e(t,this.getScene(),this.options)),this);return n.id=t,n.name=t,n.parseSerializedObject(a),n._buildId=this._buildId,n.build(!1,!i),n}setToDefaultProceduralTexture(){this.clear(),this.editorData=null;const e=new InputBlock("Position");e.setAsAttribute("position2d");const t=new InputBlock("Constant1");t.isConstant=!0,t.value=1;const i=new VectorMergerBlock("Position3D");e.connectTo(i),t.connectTo(i,{input:"w"});const a=new VertexOutputBlock("VertexOutput");i.connectTo(a);const n=new InputBlock("Time");n.value=0,n.min=0,n.max=0,n.isBoolean=!1,n.matrixMode=0,n.animationType=AnimatedInputBlockTypes.Time,n.isConstant=!1;const s=new InputBlock("Color3");s.value=new Color3(1,1,1),s.isConstant=!1;const r=new FragmentOutputBlock("FragmentOutput"),o=new VectorMergerBlock("VectorMerger");o.visibleInInspector=!1;const l=new TrigonometryBlock("Cos");l.operation=TrigonometryBlockOperations.Cos,e.connectTo(o),n.output.connectTo(l.input),l.output.connectTo(o.z),o.xyzOut.connectTo(r.rgb),this.addOutputNode(a),this.addOutputNode(r),this._mode=NodeMaterialModes.ProceduralTexture}loadFromSerialization(e,t="",i=!1){this.parseSerializedObject(e,t,i)}edit(t){return new Promise((i=>{if(this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),void 0===this.BJSNODEMATERIALEDITOR){const a=t&&t.editorURL?t.editorURL:e.EditorURL;Tools.LoadBabylonScript(a,(()=>{this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this._createNodeEditor(t?.nodeEditorConfig),i()}))}else this._createNodeEditor(t?.nodeEditorConfig),i()}))}static async ParseFromFileAsync(t,i,a,n="",s=!1,r,o){const l=r??new e(t,a),c=await a._loadFileAsync(i),h=JSON.parse(c);return l.parseSerializedObject(h,n,void 0,o),s||l.build(),l}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}whenTexturesReadyAsync(){const e=[];return this.getActiveTextures().forEach((t=>{const i=t.getInternalTexture();i&&!i.isReady&&e.push(new Promise(((e,t)=>{i.onLoadedObservable.addOnce((()=>{e()})),i.onErrorObservable.addOnce((e=>{t(e)}))})))})),Promise.all(e)}getActiveTextures(){const e=super.getActiveTextures();return this._sharedData&&e.push(...this._sharedData.textureBlocks.filter((e=>e.texture)).map((e=>e.texture))),e}unregisterOptimizer(e){const t=this._optimizers.indexOf(e);if(-1!==t)return this._optimizers.splice(t,1),this}set mode(e){this._mode=e}_finishBuildProcess(t=!1,i=!0,a,n){this.optimize();for(const e of a)e.build(this._vertexCompilationState,a);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(const e of n)this._resetDualBlocks(e,this._buildId-1);for(const e of n)e.build(this._fragmentCompilationState,n);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),i&&(this._buildId=e._BuildIdGenerator++),this._sharedData.emitErrors(),t&&(Logger.Log("Vertex shader:"),Logger.Log(this._vertexCompilationState.compilationString),Logger.Log("Fragment shader:"),Logger.Log(this._fragmentCompilationState.compilationString)),this._buildIsInProgress=!1,this._buildWasSuccessful=!0,this.onBuildObservable.notifyObservers(this);const s=this.getScene().meshes;for(const e of s)if(e.subMeshes)for(const t of e.subMeshes){if(t.getMaterial()!==this)continue;if(!t.materialDefines)continue;const e=t.materialDefines;e.markAllAsDirty(),e.reset()}this.prePassTextureInputs.length&&this.getScene().enablePrePassRenderer();const r=this.getScene().prePassRenderer;r&&r.markAsDirty()}get prePassTextureInputs(){const e=this.getAllTextureBlocks().filter((e=>"PrePassTextureBlock"===e.getClassName())),t=[];for(const i of e)i.position.isConnected&&!t.includes(1)&&t.push(1),i.depth.isConnected&&!t.includes(5)&&t.push(5),i.normal.isConnected&&!t.includes(6)&&t.push(6);return t}generateCode(){let e=[];const t=[],i=["const","var","let"];for(const e of this._vertexOutputNodes)this._gatherBlocks(e,t);const a=[];for(const e of this._fragmentOutputNodes)this._gatherBlocks(e,a);let n=`var nodeMaterial = new BABYLON.NodeMaterial("${this.name||"node material"}");\n`;n+=`nodeMaterial.mode = BABYLON.NodeMaterialModes.${NodeMaterialModes[this.mode]};\n`;for(const a of t)a.isInput&&-1===e.indexOf(a)&&(n+=a._dumpCode(i,e));for(const t of a)t.isInput&&-1===e.indexOf(t)&&(n+=t._dumpCode(i,e));e=[],n+="\n// Connections\n";for(const t of this._vertexOutputNodes)n+=t._dumpCodeForOutputConnections(e);for(const t of this._fragmentOutputNodes)n+=t._dumpCodeForOutputConnections(e);n+="\n// Output nodes\n";for(const e of this._vertexOutputNodes)n+=`nodeMaterial.addOutputNode(${e._codeVariableName});\n`;for(const e of this._fragmentOutputNodes)n+=`nodeMaterial.addOutputNode(${e._codeVariableName});\n`;return n+="nodeMaterial.build();\n",n}set options(e){this._options=e}isReadyForSubMesh(e,t,i=!1){if(!this._buildWasSuccessful)return!1;const a=this.getScene();if(this._sharedData.animatedInputs){const e=a.getFrameId();if(this._animationFrame!==e){for(const e of this._sharedData.animatedInputs)e.animate(a);this._animationFrame=e}}const n=t._drawWrapper;if(n.effect&&this.isFrozen&&n._wasPreviouslyReady&&n._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new NodeMaterialDefines);const s=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const r=a.getEngine();if(this._prepareDefinesForAttributes(e,s),this._sharedData.blockingBlocks.some((t=>!t.isReady(e,this,s,i))))return!1;const o=this._processDefines(e,s,i,t);if(o){const e=t.effect,i=s.toString();let n=r.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:o.mergedUniforms,uniformBuffersNames:o.uniformBuffers,samplers:o.mergedSamplers,defines:i,fallbacks:o.fallbacks,onCompiled:this.onCompiled,onError:this.onError,multiTarget:s.PREPASS,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:s.NUM_MORPH_INFLUENCERS},shaderLanguage:this.shaderLanguage},r);if(n)if(this._onEffectCreatedObservable&&(onCreatedEffectParameters.effect=n,onCreatedEffectParameters.subMesh=t,this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters)),this.allowShaderHotSwapping&&e&&!n.isReady()){if(n=e,s.markAsUnprocessed(),o.lightDisposed)return s._areLightsDisposed=!0,!1}else a.resetCachedMaterial(),t.setEffect(n,s,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(s._renderId=a.getRenderId(),n._wasPreviouslyReady=!0,n._wasPreviouslyUsingInstances=i,this._checkScenePerformancePriority(),!0)}setPrePassRenderer(e){const t=this.prePassTextureInputs.concat(this.prePassTextureOutputs);if(e&&t.length>1){let i=e.getEffectConfiguration("nodeMaterial");i||(i=e.addEffectConfiguration({enabled:!0,needsImageProcessing:!1,name:"nodeMaterial",texturesRequired:[]}));for(const e of t)i.texturesRequired.includes(e)||i.texturesRequired.push(e);i.enabled=!0}return t.length>1}getAllTextureBlocks(){const t=[];for(const i of this.attachedBlocks)e._BlockIsTextureBlock(i)&&t.push(i);return t}get options(){return this._options}createPostProcess(e,t=1,i=1,a,n,s=0,r=5){return this.mode!==NodeMaterialModes.PostProcess?(Logger.Log("Incompatible material mode"),null):this._createEffectForPostProcess(null,e,t,i,a,n,s,r)}bindOnlyWorldMatrix(e){const t=this.getScene();if(!this._activeEffect)return;const i=this._sharedData.hints;i.needWorldViewMatrix&&e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),i.needWorldViewProjectionMatrix&&e.multiplyToRef(t.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(const t of this._sharedData.inputBlocks)t._transmitWorld(this._activeEffect,e,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}_createEffectForPostProcess(e,t,i=1,a=1,n,s,r=0,o=5){let l=this.name+this._buildId;const c=new NodeMaterialDefines,h=new Mesh(l+"PostProcess",this.getScene());let u=this._buildId;return this._processDefines(h,c),Effect.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage),e?e.updateEffect(c.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,l,l):e=new PostProcess(this.name+"PostProcess",l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,i,t,a,n,s,c.toString(),r,l,{maxSimultaneousLights:this.maxSimultaneousLights},!1,o,this.shaderLanguage),e.nodeMaterialSource=this,e.onApplyObservable.add((t=>{u!==this._buildId&&(delete Effect.ShadersStore[l+"VertexShader"],delete Effect.ShadersStore[l+"PixelShader"],l=this.name+this._buildId,c.markAllAsDirty(),u=this._buildId);this._processDefines(h,c)&&(Effect.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString),TimingTools.SetImmediate((()=>e.updateEffect(c.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,l,l)))),this._checkInternals(t)})),e}optimize(){for(const e of this._optimizers)e.optimize(this._vertexOutputNodes,this._fragmentOutputNodes)}get buildId(){return this._buildId}};NodeMaterial._BuildIdGenerator=0,NodeMaterial.EditorURL=`${Tools._DefaultCdnUrl}/v${AbstractEngine.Version}/nodeEditor/babylon.nodeEditor.js`,NodeMaterial.SnippetUrl="https://snippet.babylonjs.com",NodeMaterial.IgnoreTexturesAtLoadTime=!1,NodeMaterial.DefaultShaderLanguage=0,__decorate([serialize()],NodeMaterial.prototype,"ignoreAlpha",void 0),__decorate([serialize()],NodeMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([serialize("mode")],NodeMaterial.prototype,"_mode",void 0),__decorate([serialize("comment")],NodeMaterial.prototype,"comment",void 0),__decorate([serialize()],NodeMaterial.prototype,"forceAlphaBlending",void 0),RegisterClass("BABYLON.NodeMaterial",NodeMaterial);var InstancesBlock=class extends NodeMaterialBlock{get world3(){return this._inputs[3]}get output(){return this._outputs[0]}getClassName(){return"InstancesBlock"}constructor(e){super(e,NodeMaterialBlockTargets.Vertex),this.registerInput("world0",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerInput("world1",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerInput("world2",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerInput("world3",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerInput("world",NodeMaterialBlockConnectionPointTypes.Matrix,!0),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.Matrix),this.registerOutput("instanceID",NodeMaterialBlockConnectionPointTypes.Float)}get world1(){return this._inputs[1]}get instanceID(){return this._outputs[1]}get world(){return this._inputs[4]}_buildBlock(e){super._buildBlock(e);const t=e.sharedData.scene.getEngine();e.sharedData.blocksWithDefines.push(this);const i=this._outputs[0],a=this._outputs[1],n=this.world0,s=this.world1,r=this.world2,o=this.world3;let l="mat4",c="gl_InstanceID",h="float";return 1===e.shaderLanguage&&(l="mat4x4f",c="vertexInputs.instanceIndex",h="f32"),e.compilationString+="#ifdef INSTANCES\n",e.compilationString+=e._declareOutput(i)+` = ${l}(${n.associatedVariableName}, ${s.associatedVariableName}, ${r.associatedVariableName}, ${o.associatedVariableName});\n`,e.compilationString+="#ifdef THIN_INSTANCES\n",e.compilationString+=`${i.associatedVariableName} = ${this.world.associatedVariableName} * ${i.associatedVariableName};\n`,e.compilationString+="#endif\n",t._caps.canUseGLInstanceID?e.compilationString+=e._declareOutput(a)+` = ${h}(${c});\n`:e.compilationString+=e._declareOutput(a)+" = 0.0;\n",e.compilationString+="#else\n",e.compilationString+=e._declareOutput(i)+` = ${this.world.associatedVariableName};\n`,e.compilationString+=e._declareOutput(a)+" = 0.0;\n",e.compilationString+="#endif\n",this}autoConfigure(e,t=()=>!0){if(!this.world0.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world0"===e.name&&t(e)));i||(i=new InputBlock("world0"),i.setAsAttribute("world0")),i.output.connectTo(this.world0)}if(!this.world1.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world1"===e.name&&t(e)));i||(i=new InputBlock("world1"),i.setAsAttribute("world1")),i.output.connectTo(this.world1)}if(!this.world2.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world2"===e.name&&t(e)));i||(i=new InputBlock("world2"),i.setAsAttribute("world2")),i.output.connectTo(this.world2)}if(!this.world3.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world3"===e.name&&t(e)));i||(i=new InputBlock("world3"),i.setAsAttribute("world3")),i.output.connectTo(this.world3)}if(!this.world.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world"===e.name&&t(e)));i||(i=new InputBlock("world"),i.setAsSystemValue(NodeMaterialSystemValues.World)),i.output.connectTo(this.world)}this.world.define="!INSTANCES || THIN_INSTANCES"}get world0(){return this._inputs[0]}get world2(){return this._inputs[2]}prepareDefines(e,t,i,a=!1,n){let s=!1;i.INSTANCES!==a&&(i.setValue("INSTANCES",a),s=!0),n&&i.THIN_INSTANCES!==!!n?.getRenderingMesh().hasThinInstances&&(i.setValue("THIN_INSTANCES",!!n?.getRenderingMesh().hasThinInstances),s=!0),s&&i.markAsUnprocessed()}};RegisterClass("BABYLON.InstancesBlock",InstancesBlock);var AddBlock=class extends BaseMathBlock{_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} + ${this.right.associatedVariableName};\n`,this}getClassName(){return"AddBlock"}constructor(e){super(e)}};RegisterClass("BABYLON.AddBlock",AddBlock);var DivideBlock=class extends BaseMathBlock{getClassName(){return"DivideBlock"}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} / ${this.right.associatedVariableName};\n`,this}constructor(e){super(e)}};RegisterClass("BABYLON.DivideBlock",DivideBlock);var SubtractBlock=class extends BaseMathBlock{constructor(e){super(e)}getClassName(){return"SubtractBlock"}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} - ${this.right.associatedVariableName};\n`,this}};RegisterClass("BABYLON.SubtractBlock",SubtractBlock);var ClampBlock=class extends NodeMaterialBlock{get output(){return this._outputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.minimum=0,this.maximum=1,this.registerInput("value",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ClampBlock"}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=1===e.shaderLanguage?e._getShaderType(this.value.type):"";return e.compilationString+=e._declareOutput(t)+` = clamp(${this.value.associatedVariableName}, ${i}(${this._writeFloat(this.minimum)}), ${i}(${this._writeFloat(this.maximum)}));\n`,this}serialize(){const e=super.serialize();return e.minimum=this.minimum,e.maximum=this.maximum,e}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.minimum = ${this.minimum};\n`;return e+=`${this._codeVariableName}.maximum = ${this.maximum};\n`,e}get value(){return this._inputs[0]}_deserialize(e,t,i){super._deserialize(e,t,i),this.minimum=e.minimum,this.maximum=e.maximum}};__decorate([editableInPropertyPage("Minimum",1)],ClampBlock.prototype,"minimum",void 0),__decorate([editableInPropertyPage("Maximum",1)],ClampBlock.prototype,"maximum",void 0),RegisterClass("BABYLON.ClampBlock",ClampBlock);var VectorSplitterBlock=class extends NodeMaterialBlock{_buildBlock(e){super._buildBlock(e);const t=this.xyzw.isConnected?this.xyzw:this.xyzIn.isConnected?this.xyzIn:this.xyIn,i=this._outputs[0],a=this._outputs[1],n=this._outputs[2],s=this._outputs[3],r=this._outputs[4],o=this._outputs[5],l=this._outputs[6],c=e._getShaderType(NodeMaterialBlockConnectionPointTypes.Vector3);return i.hasEndpoints&&(t===this.xyIn?e.compilationString+=e._declareOutput(i)+` = ${c}(${t.associatedVariableName}, 0.0);\n`:e.compilationString+=e._declareOutput(i)+` = ${t.associatedVariableName}.xyz;\n`),n.hasEndpoints&&this.xyzw.isConnected&&(e.compilationString+=e._declareOutput(n)+` = ${this.xyzw.associatedVariableName}.zw;\n`),a.hasEndpoints&&(e.compilationString+=e._declareOutput(a)+` = ${t.associatedVariableName}.xy;\n`),s.hasEndpoints&&(e.compilationString+=e._declareOutput(s)+` = ${t.associatedVariableName}.x;\n`),r.hasEndpoints&&(e.compilationString+=e._declareOutput(r)+` = ${t.associatedVariableName}.y;\n`),o.hasEndpoints&&(e.compilationString+=e._declareOutput(o)+` = ${t.associatedVariableName}.z;\n`),l.hasEndpoints&&(e.compilationString+=e._declareOutput(l)+` = ${t.associatedVariableName}.w;\n`),this}get xyzIn(){return this._inputs[1]}get z(){return this._outputs[5]}get w(){return this._outputs[6]}getClassName(){return"VectorSplitterBlock"}get xyzOut(){return this._outputs[0]}get zw(){return this._outputs[2]}get y(){return this._outputs[4]}get xyIn(){return this._inputs[2]}_inputRename(e){switch(e){case"xy ":return"xyIn";case"xyz ":return"xyzIn";default:return e}}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("xyzw",NodeMaterialBlockConnectionPointTypes.Vector4,!0),this.registerInput("xyz ",NodeMaterialBlockConnectionPointTypes.Vector3,!0),this.registerInput("xy ",NodeMaterialBlockConnectionPointTypes.Vector2,!0),this.registerOutput("xyz",NodeMaterialBlockConnectionPointTypes.Vector3),this.registerOutput("xy",NodeMaterialBlockConnectionPointTypes.Vector2),this.registerOutput("zw",NodeMaterialBlockConnectionPointTypes.Vector2),this.registerOutput("x",NodeMaterialBlockConnectionPointTypes.Float),this.registerOutput("y",NodeMaterialBlockConnectionPointTypes.Float),this.registerOutput("z",NodeMaterialBlockConnectionPointTypes.Float),this.registerOutput("w",NodeMaterialBlockConnectionPointTypes.Float),this.inputsAreExclusive=!0}get x(){return this._outputs[3]}get xyzw(){return this._inputs[0]}_outputRename(e){switch(e){case"xy":return"xyOut";case"xyz":return"xyzOut";default:return e}}get xyOut(){return this._outputs[1]}};RegisterClass("BABYLON.VectorSplitterBlock",VectorSplitterBlock);var BonesBlock=class extends NodeMaterialBlock{async _initShaderSourceAsync(e){this._codeIsReady=!1,1===e?await Promise.all([Promise.resolve().then((()=>(init_bonesDeclaration(),bonesDeclaration_exports))),Promise.resolve().then((()=>(init_bonesVertex(),bonesVertex_exports)))]):await Promise.all([Promise.resolve().then((()=>(init_bonesDeclaration2(),bonesDeclaration_exports2))),Promise.resolve().then((()=>(init_bonesVertex2(),bonesVertex_exports2)))]),this._codeIsReady=!0,this.onCodeIsReadyObservable.notifyObservers(this)}autoConfigure(e,t=()=>!0){if(!this.matricesIndices.isConnected){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"matricesIndices"===e.name&&t(e)));i||(i=new InputBlock("matricesIndices"),i.setAsAttribute("matricesIndices")),i.output.connectTo(this.matricesIndices)}if(!this.matricesWeights.isConnected){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"matricesWeights"===e.name&&t(e)));i||(i=new InputBlock("matricesWeights"),i.setAsAttribute("matricesWeights")),i.output.connectTo(this.matricesWeights)}if(!this.world.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===NodeMaterialSystemValues.World&&t(e)));i||(i=new InputBlock("world"),i.setAsSystemValue(NodeMaterialSystemValues.World)),i.output.connectTo(this.world)}}bind(e,t,i){BindBonesParameters(i,e)}_buildBlock(e){super._buildBlock(e),e.sharedData.blocksWithFallbacks.push(this),e.sharedData.forcedBindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.uniforms.push("boneTextureWidth"),e.uniforms.push("mBones"),e.samplers.push("boneSampler");const t=`//${this.name}`;e._emitFunctionFromInclude("bonesDeclaration",t,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});const i=e._getFreeVariableName("influence");e.compilationString+=e._emitCodeFromInclude("bonesVertex",t,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:i}]});const a=this._outputs[0],n=this.world;return e.compilationString+="#if NUM_BONE_INFLUENCERS>0\n",e.compilationString+=e._declareOutput(a)+` = ${n.associatedVariableName} * ${i};\n`,e.compilationString+="#else\n",e.compilationString+=e._declareOutput(a)+` = ${n.associatedVariableName};\n`,e.compilationString+="#endif\n",this}constructor(e){super(e,NodeMaterialBlockTargets.Vertex),this.registerInput("matricesIndices",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerInput("matricesWeights",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerInput("matricesIndicesExtra",NodeMaterialBlockConnectionPointTypes.Vector4,!0),this.registerInput("matricesWeightsExtra",NodeMaterialBlockConnectionPointTypes.Vector4,!0),this.registerInput("world",NodeMaterialBlockConnectionPointTypes.Matrix),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.Matrix)}provideFallbacks(e,t){e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton&&t.addCPUSkinningFallback(0,e)}get matricesWeightsExtra(){return this._inputs[3]}get output(){return this._outputs[0]}get matricesWeights(){return this._inputs[1]}get world(){return this._inputs[4]}get matricesIndicesExtra(){return this._inputs[2]}prepareDefines(e,t,i){i._areAttributesDirty&&PrepareDefinesForBones(e,i)}getClassName(){return"BonesBlock"}initialize(e){e._excludeVariableName("boneSampler"),e._excludeVariableName("boneTextureWidth"),e._excludeVariableName("mBones"),e._excludeVariableName("BonesPerMesh"),this._initShaderSourceAsync(e.shaderLanguage)}get matricesIndices(){return this._inputs[0]}};RegisterClass("BABYLON.BonesBlock",BonesBlock);var LightBlock=class extends NodeMaterialBlock{get worldNormal(){return this._inputs[1]}serialize(){const e=super.serialize();return e.generateOnlyFragmentCode=this.generateOnlyFragmentCode,this.light&&(e.lightId=this.light.id),e}get glossPower(){return this._inputs[4]}updateUniformsAndSamples(e,t,i,a){for(let n=0;n<t.maxSimultaneousLights&&i["LIGHT"+n];n++){const t=e.uniforms.indexOf("vLightData"+n)>=0;PrepareUniformsAndSamplersForLight(n,e.uniforms,e.samplers,i["PROJECTEDLIGHTTEXTURE"+n],a,t)}}bind(e,t,i){if(!i)return;const a=i.getScene();this.light?BindLight(this.light,this._lightId,a,e,!0):BindLights(a,i,e,!0,t.maxSimultaneousLights)}_injectUBODeclaration(e){const t=`//${this.name}`;this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",t,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",t,{repeatKey:"maxSimultaneousLights",substitutionVars:this.generateOnlyFragmentCode?"varying,":void 0})}initialize(e){this._initShaderSourceAsync(e.shaderLanguage)}get cameraPosition(){return this._inputs[2]}get shadow(){return this._outputs[2]}getClassName(){return"LightBlock"}_buildBlock(e){super._buildBlock(e);const t=1===e.shaderLanguage,i=t?"f":"",a=`//${this.name}`;if(e.target!==NodeMaterialBlockTargets.Fragment)return void this._injectVertexCode(e);this.generateOnlyFragmentCode&&e.sharedData.dynamicUniformBlocks.push(this);const n=1===e.shaderLanguage?"fragmentInputs.":"";e.sharedData.forcedBindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);const s=this.worldPosition;let r=s.associatedVariableName;this.generateOnlyFragmentCode?(r=e._getFreeVariableName("globalWorldPos"),e._emitFunction("light_globalworldpos",`${e._declareLocalVar(r,NodeMaterialBlockConnectionPointTypes.Vector3)};\n`,a),e.compilationString+=`${r} = ${s.associatedVariableName}.xyz;\n`,e.compilationString+=e._emitCodeFromInclude("shadowsVertex",a,{repeatKey:"maxSimultaneousLights",substitutionVars:this.generateOnlyFragmentCode?`worldPos,${s.associatedVariableName}`:void 0})):r=n+"v_"+r+".xyz",e._emitFunctionFromInclude("helperFunctions",a),e._emitFunctionFromInclude("lightsFragmentFunctions",a,{replaceStrings:[{search:/vPositionW/g,replace:r}]}),e._emitFunctionFromInclude("shadowsFragmentFunctions",a,{replaceStrings:[{search:/vPositionW/g,replace:r}]}),this._injectUBODeclaration(e),0===this._lightId&&(e._registerTempVariable("viewDirectionW")&&(e.compilationString+=`${e._declareLocalVar("viewDirectionW",NodeMaterialBlockConnectionPointTypes.Vector3)} = normalize(${this.cameraPosition.associatedVariableName} - ${r});\n`),e.compilationString+=t?"var info: lightingInfo;\n":"lightingInfo info;\n",e.compilationString+=`${e._declareLocalVar("shadow",NodeMaterialBlockConnectionPointTypes.Float)} = 1.;\n`,e.compilationString+=`${e._declareLocalVar("aggShadow",NodeMaterialBlockConnectionPointTypes.Float)} = 0.;\n`,e.compilationString+=`${e._declareLocalVar("numLights",NodeMaterialBlockConnectionPointTypes.Float)} = 0.;\n`,e.compilationString+=`${e._declareLocalVar("glossiness",NodeMaterialBlockConnectionPointTypes.Float)} = ${this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0"} * ${this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0"};\n`,e.compilationString+=`${e._declareLocalVar("diffuseBase",NodeMaterialBlockConnectionPointTypes.Vector3)} = vec3${i}(0., 0., 0.);\n`,e.compilationString+=`${e._declareLocalVar("specularBase",NodeMaterialBlockConnectionPointTypes.Vector3)}  = vec3${i}(0., 0., 0.);\n`,e.compilationString+=`${e._declareLocalVar("normalW",NodeMaterialBlockConnectionPointTypes.Vector3)} = ${this.worldNormal.associatedVariableName}.xyz;\n`),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",a,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/vPositionW/g,replace:r+".xyz"}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",a,{repeatKey:"maxSimultaneousLights",substitutionVars:`vPositionW,${r}.xyz`}),0===this._lightId&&(e.compilationString+="aggShadow = aggShadow / numLights;\n");const o=this.diffuseOutput,l=this.specularOutput;return e.compilationString+=e._declareOutput(o)+` = diffuseBase${this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:""};\n`,l.hasEndpoints&&(e.compilationString+=e._declareOutput(l)+` = specularBase${this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:""};\n`),this.shadow.hasEndpoints&&(e.compilationString+=e._declareOutput(this.shadow)+" = aggShadow;\n"),this}get diffuseColor(){return this._inputs[5]}_setTarget(){this._setInitialTarget(this.generateOnlyFragmentCode?NodeMaterialBlockTargets.Fragment:NodeMaterialBlockTargets.VertexAndFragment),this.getInputByName("worldPosition").target=this.generateOnlyFragmentCode?NodeMaterialBlockTargets.Fragment:NodeMaterialBlockTargets.Vertex}get diffuseOutput(){return this._outputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.VertexAndFragment),this._lightId=0,this.generateOnlyFragmentCode=!1,this._isUnique=!0,this.registerInput("worldPosition",NodeMaterialBlockConnectionPointTypes.Vector4,!1,NodeMaterialBlockTargets.Vertex),this.registerInput("worldNormal",NodeMaterialBlockConnectionPointTypes.Vector4,!1,NodeMaterialBlockTargets.Fragment),this.registerInput("cameraPosition",NodeMaterialBlockConnectionPointTypes.Vector3,!1,NodeMaterialBlockTargets.Fragment),this.registerInput("glossiness",NodeMaterialBlockConnectionPointTypes.Float,!0,NodeMaterialBlockTargets.Fragment),this.registerInput("glossPower",NodeMaterialBlockConnectionPointTypes.Float,!0,NodeMaterialBlockTargets.Fragment),this.registerInput("diffuseColor",NodeMaterialBlockConnectionPointTypes.Color3,!0,NodeMaterialBlockTargets.Fragment),this.registerInput("specularColor",NodeMaterialBlockConnectionPointTypes.Color3,!0,NodeMaterialBlockTargets.Fragment),this.registerInput("view",NodeMaterialBlockConnectionPointTypes.Matrix,!0),this.registerOutput("diffuseOutput",NodeMaterialBlockConnectionPointTypes.Color3,NodeMaterialBlockTargets.Fragment),this.registerOutput("specularOutput",NodeMaterialBlockConnectionPointTypes.Color3,NodeMaterialBlockTargets.Fragment),this.registerOutput("shadow",NodeMaterialBlockConnectionPointTypes.Float,NodeMaterialBlockTargets.Fragment)}get specularOutput(){return this._outputs[1]}get glossiness(){return this._inputs[3]}async _initShaderSourceAsync(e){this._codeIsReady=!1,1===e?await Promise.all([Promise.resolve().then((()=>(init_lightFragment(),lightFragment_exports))),Promise.resolve().then((()=>(init_lightUboDeclaration(),lightUboDeclaration_exports))),Promise.resolve().then((()=>(init_lightVxUboDeclaration(),lightVxUboDeclaration_exports))),Promise.resolve().then((()=>(init_helperFunctions(),helperFunctions_exports))),Promise.resolve().then((()=>(init_lightsFragmentFunctions(),lightsFragmentFunctions_exports))),Promise.resolve().then((()=>(init_shadowsFragmentFunctions(),shadowsFragmentFunctions_exports))),Promise.resolve().then((()=>(init_shadowsVertex(),shadowsVertex_exports)))]):await Promise.all([Promise.resolve().then((()=>(init_lightFragmentDeclaration(),lightFragmentDeclaration_exports))),Promise.resolve().then((()=>(init_lightFragment2(),lightFragment_exports2))),Promise.resolve().then((()=>(init_lightUboDeclaration2(),lightUboDeclaration_exports2))),Promise.resolve().then((()=>(init_lightVxUboDeclaration2(),lightVxUboDeclaration_exports2))),Promise.resolve().then((()=>(init_lightVxFragmentDeclaration(),lightVxFragmentDeclaration_exports))),Promise.resolve().then((()=>(init_helperFunctions2(),helperFunctions_exports2))),Promise.resolve().then((()=>(init_lightsFragmentFunctions2(),lightsFragmentFunctions_exports2))),Promise.resolve().then((()=>(init_shadowsFragmentFunctions2(),shadowsFragmentFunctions_exports2))),Promise.resolve().then((()=>(init_shadowsVertex2(),shadowsVertex_exports2)))]),this._codeIsReady=!0,this.onCodeIsReadyObservable.notifyObservers(this)}get specularColor(){return this._inputs[6]}get view(){return this._inputs[7]}get worldPosition(){return this._inputs[0]}_injectVertexCode(e){const t=this.worldPosition,i=`//${this.name}`;this.light?(this._lightId=(void 0!==e.counters.lightCounter?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",i,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));const a="v_"+t.associatedVariableName;e._emitVaryingFromString(a,NodeMaterialBlockConnectionPointTypes.Vector4)&&(e.compilationString+=(1===e.shaderLanguage?"vertexOutputs.":"")+`${a} = ${t.associatedVariableName};\n`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:t.associatedVariableName}]}):(e.compilationString+=`${e._declareLocalVar("worldPos",NodeMaterialBlockConnectionPointTypes.Vector4)} = ${t.associatedVariableName};\n`,this.view.isConnected&&(e.compilationString+=`${e._declareLocalVar("view",NodeMaterialBlockConnectionPointTypes.Matrix)} = ${this.view.associatedVariableName};\n`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",i,{repeatKey:"maxSimultaneousLights"}))}_deserialize(e,t,i){super._deserialize(e,t,i),e.lightId&&(this.light=t.getLightById(e.lightId)),this.generateOnlyFragmentCode=e.generateOnlyFragmentCode,this._setTarget()}autoConfigure(e,t=()=>!0){if(!this.cameraPosition.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===NodeMaterialSystemValues.CameraPosition&&t(e)));i||(i=new InputBlock("cameraPosition"),i.setAsSystemValue(NodeMaterialSystemValues.CameraPosition)),i.output.connectTo(this.cameraPosition)}}prepareDefines(e,t,i){if(!i._areLightsDirty)return;const a=e.getScene();if(this.light){const t={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};PrepareDefinesForLight(a,e,this.light,this._lightId,i,!0,t),t.needRebuild&&i.rebuild()}else PrepareDefinesForLights(a,e,i,!0,t.maxSimultaneousLights)}static _OnGenerateOnlyFragmentCodeChanged(e,t){const i=e;return i.worldPosition.isConnected?(i.generateOnlyFragmentCode=!i.generateOnlyFragmentCode,Logger.Error("The worldPosition input must not be connected to be able to switch!"),!1):(i._setTarget(),!0)}};__decorate([editableInPropertyPage("Generate only fragment code",0,"ADVANCED",{notifiers:{rebuild:!0,update:!0,onValidation:LightBlock._OnGenerateOnlyFragmentCodeChanged}})],LightBlock.prototype,"generateOnlyFragmentCode",void 0),RegisterClass("BABYLON.LightBlock",LightBlock);var PowBlock=class extends NodeMaterialBlock{get power(){return this._inputs[1]}get value(){return this._inputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("value",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("power",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = pow(${this.value.associatedVariableName}, ${this.power.associatedVariableName});\n`,this}getClassName(){return"PowBlock"}};RegisterClass("BABYLON.PowBlock",PowBlock);var NodeMaterialConnectionPointCustomObject=class e extends NodeMaterialConnectionPoint{constructor(e,t,i,a,n){super(e,t,i),this._blockType=a,this._blockName=n,this.needDualDirectionValidation=!0}checkCompatibilityState(t){return t instanceof e&&t._blockName===this._blockName?0:1}createCustomInputBlock(){return[new this._blockType(this._blockName),this.name]}},ImageSourceBlock=class e extends NodeMaterialBlock{getClassName(){return"ImageSourceBlock"}set texture(e){if(this._texture===e)return;const t=e?.getScene()??EngineStore.LastCreatedScene;!e&&t&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this._texture))),this._texture=e,e&&t&&t.markAllMaterialsAsDirty(1,(t=>t.hasTexture(e)))}bind(e){this.texture&&e.setTexture(this._samplerName,this.texture)}serialize(){const e=super.serialize();return this.texture&&!this.texture.isRenderTarget&&"VideoTexture"!==this.texture.getClassName()&&(e.texture=this.texture.serialize()),e}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}get samplerName(){return this._samplerName}get source(){return this._outputs[0]}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return this.texture?(e+=`${this._codeVariableName}.texture = new BABYLON.Texture("${this.texture.name}", null, ${this.texture.noMipmap}, ${this.texture.invertY}, ${this.texture.samplingMode});\n`,e+=`${this._codeVariableName}.texture.wrapU = ${this.texture.wrapU};\n`,e+=`${this._codeVariableName}.texture.wrapV = ${this.texture.wrapV};\n`,e+=`${this._codeVariableName}.texture.uAng = ${this.texture.uAng};\n`,e+=`${this._codeVariableName}.texture.vAng = ${this.texture.vAng};\n`,e+=`${this._codeVariableName}.texture.wAng = ${this.texture.wAng};\n`,e+=`${this._codeVariableName}.texture.uOffset = ${this.texture.uOffset};\n`,e+=`${this._codeVariableName}.texture.vOffset = ${this.texture.vOffset};\n`,e+=`${this._codeVariableName}.texture.uScale = ${this.texture.uScale};\n`,e+=`${this._codeVariableName}.texture.vScale = ${this.texture.vScale};\n`,e+=`${this._codeVariableName}.texture.coordinatesMode = ${this.texture.coordinatesMode};\n`,e):e}get texture(){return this._texture}_deserialize(e,t,i,a){super._deserialize(e,t,i,a),e.texture&&!NodeMaterial.IgnoreTexturesAtLoadTime&&void 0!==e.texture.url&&(0===e.texture.url.indexOf("data:")?i="":a&&(e.texture.url=a(e.texture.url),e.texture.name=e.texture.url),this.texture=Texture.Parse(e.texture,t,i))}_buildBlock(e){return super._buildBlock(e),e.target===NodeMaterialBlockTargets.Vertex&&(this._samplerName=e._getFreeVariableName(this.name+"Texture"),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.bindableBlocks.push(this)),e._emit2DSampler(this._samplerName),this}constructor(t){super(t,NodeMaterialBlockTargets.VertexAndFragment),this.registerOutput("source",NodeMaterialBlockConnectionPointTypes.Object,NodeMaterialBlockTargets.VertexAndFragment,new NodeMaterialConnectionPointCustomObject("source",this,1,e,"ImageSourceBlock"))}};RegisterClass("BABYLON.ImageSourceBlock",ImageSourceBlock);var CustomBlock=class extends NodeMaterialBlock{set options(e){this._deserializeOptions(e)}serialize(){const e=super.serialize();return e.options=this._options,e}_buildBlock(e){super._buildBlock(e);let t=this._code,i=this._options.functionName;this._inputs.forEach((a=>{const n=new RegExp("\\{TYPE_"+a.name+"\\}","gm"),s=e._getGLType(a.type);t=t.replace(n,s),i=i.replace(n,s)})),this._outputs.forEach((a=>{const n=new RegExp("\\{TYPE_"+a.name+"\\}","gm"),s=e._getGLType(a.type);t=t.replace(n,s),i=i.replace(n,s)})),e._emitFunction(i,t,""),this._outputs.forEach((t=>{e.compilationString+=e._declareOutput(t)+";\n"})),e.compilationString+=i+"(";let a=!1;return this._inputs.forEach(((t,i)=>{i>0&&(e.compilationString+=", "),this._inputSamplers&&-1!==this._inputSamplers.indexOf(t.name)?e.compilationString+=t.connectedPoint?.ownerBlock?.samplerName??t.associatedVariableName:e.compilationString+=t.associatedVariableName,a=!0})),this._outputs.forEach(((t,i)=>{(i>0||a)&&(e.compilationString+=", "),e.compilationString+=t.associatedVariableName})),e.compilationString+=");\n",this}_deserialize(e,t,i){this._deserializeOptions(e.options),super._deserialize(e,t,i)}_deserializeOptions(e){this._options=e,this._code=e.code.join("\n")+"\n",this.name=this.name||e.name,this.target=NodeMaterialBlockTargets[e.target],e.inParameters?.forEach(((e,t)=>{const i=NodeMaterialBlockConnectionPointTypes[e.type];"sampler2D"===e.type||"samplerCube"===e.type?(this._inputSamplers=this._inputSamplers||[],this._inputSamplers.push(e.name),this.registerInput(e.name,NodeMaterialBlockConnectionPointTypes.Object,!0,NodeMaterialBlockTargets.VertexAndFragment,new NodeMaterialConnectionPointCustomObject(e.name,this,0,ImageSourceBlock,"ImageSourceBlock"))):this.registerInput(e.name,i),Object.defineProperty(this,e.name,{get:function(){return this._inputs[t]},enumerable:!0,configurable:!0})})),e.outParameters?.forEach(((e,t)=>{this.registerOutput(e.name,NodeMaterialBlockConnectionPointTypes[e.type]),Object.defineProperty(this,e.name,{get:function(){return this._outputs[t]},enumerable:!0,configurable:!0}),"BasedOnInput"===e.type&&(this._outputs[t]._typeConnectionSource=this._findInputByName(e.typeFromInput)[0])})),e.inLinkedConnectionTypes?.forEach((e=>{this._linkConnectionTypes(this._findInputByName(e.input1)[1],this._findInputByName(e.input2)[1])}))}_findInputByName(e){if(!e)return null;for(let t=0;t<this._inputs.length;t++)if(this._inputs[t].name===e)return[this._inputs[t],t];return null}get options(){return this._options}constructor(e){super(e)}getClassName(){return"CustomBlock"}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.options = ${JSON.stringify(this._options)};\n`,e}};RegisterClass("BABYLON.CustomBlock",CustomBlock);var ScaleBlock=class extends NodeMaterialBlock{_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.input.associatedVariableName} * ${this.factor.associatedVariableName};\n`,this}get output(){return this._outputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("input",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("factor",NodeMaterialBlockConnectionPointTypes.Float),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}get input(){return this._inputs[0]}get factor(){return this._inputs[1]}getClassName(){return"ScaleBlock"}};RegisterClass("BABYLON.ScaleBlock",ScaleBlock);var LerpBlock=class extends NodeMaterialBlock{_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = mix(${this.left.associatedVariableName} , ${this.right.associatedVariableName}, ${this.gradient.associatedVariableName});\n`,this}get output(){return this._outputs[0]}get left(){return this._inputs[0]}get gradient(){return this._inputs[2]}getClassName(){return"LerpBlock"}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("left",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("right",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("gradient",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._linkConnectionTypes(1,2,!0),this._inputs[2].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Float)}get right(){return this._inputs[1]}};RegisterClass("BABYLON.LerpBlock",LerpBlock);var StepBlock=class extends NodeMaterialBlock{getClassName(){return"StepBlock"}get edge(){return this._inputs[1]}get value(){return this._inputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("value",NodeMaterialBlockConnectionPointTypes.Float),this.registerInput("edge",NodeMaterialBlockConnectionPointTypes.Float),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.Float)}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = step(${this.edge.associatedVariableName}, ${this.value.associatedVariableName});\n`,this}};RegisterClass("BABYLON.StepBlock",StepBlock);var ViewDirectionBlock=class extends NodeMaterialBlock{_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = normalize(${this.cameraPosition.associatedVariableName} - ${this.worldPosition.associatedVariableName}.xyz);\n`,this}autoConfigure(e,t=()=>!0){if(!this.cameraPosition.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===NodeMaterialSystemValues.CameraPosition&&t(e)));i||(i=new InputBlock("cameraPosition"),i.setAsSystemValue(NodeMaterialSystemValues.CameraPosition)),i.output.connectTo(this.cameraPosition)}}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("worldPosition",NodeMaterialBlockConnectionPointTypes.Vector4),this.registerInput("cameraPosition",NodeMaterialBlockConnectionPointTypes.Vector3),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.Vector3)}get worldPosition(){return this._inputs[0]}get cameraPosition(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"ViewDirectionBlock"}};RegisterClass("BABYLON.ViewDirectionBlock",ViewDirectionBlock);var DotBlock=class extends NodeMaterialBlock{getClassName(){return"DotBlock"}get right(){return this._inputs[1]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("left",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("right",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.Float),this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Float),this._inputs[0].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Matrix),this._inputs[1].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Float),this._inputs[1].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Matrix)}get left(){return this._inputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = dot(${this.left.associatedVariableName}, ${this.right.associatedVariableName});\n`,this}get output(){return this._outputs[0]}},ConditionalBlockConditions,ConditionalBlockConditions2;RegisterClass("BABYLON.DotBlock",DotBlock),ConditionalBlockConditions2=ConditionalBlockConditions||(ConditionalBlockConditions={}),ConditionalBlockConditions2[ConditionalBlockConditions2.Equal=0]="Equal",ConditionalBlockConditions2[ConditionalBlockConditions2.NotEqual=1]="NotEqual",ConditionalBlockConditions2[ConditionalBlockConditions2.LessThan=2]="LessThan",ConditionalBlockConditions2[ConditionalBlockConditions2.GreaterThan=3]="GreaterThan",ConditionalBlockConditions2[ConditionalBlockConditions2.LessOrEqual=4]="LessOrEqual",ConditionalBlockConditions2[ConditionalBlockConditions2.GreaterOrEqual=5]="GreaterOrEqual",ConditionalBlockConditions2[ConditionalBlockConditions2.Xor=6]="Xor",ConditionalBlockConditions2[ConditionalBlockConditions2.Or=7]="Or",ConditionalBlockConditions2[ConditionalBlockConditions2.And=8]="And";var ConditionalBlock=class extends NodeMaterialBlock{get b(){return this._inputs[1]}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.condition = BABYLON.ConditionalBlockConditions.${ConditionalBlockConditions[this.condition]};\n`}serialize(){const e=super.serialize();return e.condition=this.condition,e}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=this.true.isConnected?this.true.associatedVariableName:"1.0",a=this.false.isConnected?this.false.associatedVariableName:"0.0";switch(this.condition){case ConditionalBlockConditions.Equal:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`${this.a.associatedVariableName} == ${this.b.associatedVariableName}`)};\n`;break;case ConditionalBlockConditions.NotEqual:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`${this.a.associatedVariableName} != ${this.b.associatedVariableName}`)};\n`;break;case ConditionalBlockConditions.LessThan:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`${this.a.associatedVariableName} < ${this.b.associatedVariableName}`)};\n`;break;case ConditionalBlockConditions.LessOrEqual:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`${this.a.associatedVariableName} <= ${this.b.associatedVariableName}`)};\n`;break;case ConditionalBlockConditions.GreaterThan:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`${this.a.associatedVariableName} > ${this.b.associatedVariableName}`)};\n`;break;case ConditionalBlockConditions.GreaterOrEqual:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`${this.a.associatedVariableName} >= ${this.b.associatedVariableName}`)};\n`;break;case ConditionalBlockConditions.Xor:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`(((${this.a.associatedVariableName} + ${this.b.associatedVariableName}) % 2.0) > 0.0)`)};\n`;break;case ConditionalBlockConditions.Or:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`(min(${this.a.associatedVariableName} + ${this.b.associatedVariableName}, 1.0) > 0.0)`)};\n`;break;case ConditionalBlockConditions.And:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,a,`(${this.a.associatedVariableName} * ${this.b.associatedVariableName} > 0.0)`)};\n`}return this}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.condition=ConditionalBlockConditions.LessThan,this.registerInput("a",NodeMaterialBlockConnectionPointTypes.Float),this.registerInput("b",NodeMaterialBlockConnectionPointTypes.Float),this.registerInput("true",NodeMaterialBlockConnectionPointTypes.AutoDetect,!0),this.registerInput("false",NodeMaterialBlockConnectionPointTypes.AutoDetect,!0),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._linkConnectionTypes(2,3),this._outputs[0]._typeConnectionSource=this._inputs[2],this._outputs[0]._defaultConnectionPointType=NodeMaterialBlockConnectionPointTypes.Float}get a(){return this._inputs[0]}_deserialize(e,t,i){super._deserialize(e,t,i),this.condition=e.condition}get output(){return this._outputs[0]}getClassName(){return"ConditionalBlock"}get true(){return this._inputs[2]}get false(){return this._inputs[3]}};RegisterClass("BABYLON.ConditionalBlock",ConditionalBlock);var OneMinusBlock=class extends NodeMaterialBlock{get output(){return this._outputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("input",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Matrix)}get input(){return this._inputs[0]}getClassName(){return"OneMinusBlock"}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = 1. - ${this.input.associatedVariableName};\n`,this}};RegisterClass("BABYLON.OneMinusBlock",OneMinusBlock),RegisterClass("BABYLON.OppositeBlock",OneMinusBlock);var MaxBlock=class extends NodeMaterialBlock{getClassName(){return"MaxBlock"}get output(){return this._outputs[0]}get left(){return this._inputs[0]}get right(){return this._inputs[1]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = max(${this.left.associatedVariableName}, ${this.right.associatedVariableName});\n`,this}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("left",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("right",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}};RegisterClass("BABYLON.MaxBlock",MaxBlock);var DistanceBlock=class extends NodeMaterialBlock{get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = length(${this.left.associatedVariableName} - ${this.right.associatedVariableName});\n`,this}getClassName(){return"DistanceBlock"}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("left",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerInput("right",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.Float),this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Float),this._inputs[0].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Matrix),this._inputs[1].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Float),this._inputs[1].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Matrix)}get right(){return this._inputs[1]}get left(){return this._inputs[0]}};RegisterClass("BABYLON.DistanceBlock",DistanceBlock);var FogBlock=class extends NodeMaterialBlock{async _initShaderSourceAsync(e){this._codeIsReady=!1,1===e?await Promise.resolve().then((()=>(init_fogFragmentDeclaration(),fogFragmentDeclaration_exports))):await Promise.resolve().then((()=>(init_fogFragmentDeclaration2(),fogFragmentDeclaration_exports2))),this._codeIsReady=!0,this.onCodeIsReadyObservable.notifyObservers(this)}getClassName(){return"FogBlock"}get worldPosition(){return this._inputs[0]}get output(){return this._outputs[0]}autoConfigure(e,t=()=>!0){if(!this.view.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===NodeMaterialSystemValues.View&&t(e)));i||(i=new InputBlock("view"),i.setAsSystemValue(NodeMaterialSystemValues.View)),i.output.connectTo(this.view)}if(!this.fogColor.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===NodeMaterialSystemValues.FogColor&&t(e)));i||(i=new InputBlock("fogColor",void 0,NodeMaterialBlockConnectionPointTypes.Color3),i.setAsSystemValue(NodeMaterialSystemValues.FogColor)),i.output.connectTo(this.fogColor)}}bind(e,t,i){if(!i)return;const a=i.getScene();e.setFloat4(this._fogParameters,a.fogMode,a.fogStart,a.fogEnd,a.fogDensity)}get fogColor(){return this._inputs[3]}prepareDefines(e,t,i){const a=e.getScene();i.setValue("FOG",t.fogEnabled&&GetFogState(e,a))}initialize(e){this._initShaderSourceAsync(e.shaderLanguage)}get input(){return this._inputs[2]}constructor(e){super(e,NodeMaterialBlockTargets.VertexAndFragment,!1),this.registerInput("worldPosition",NodeMaterialBlockConnectionPointTypes.Vector4,!1,NodeMaterialBlockTargets.Vertex),this.registerInput("view",NodeMaterialBlockConnectionPointTypes.Matrix,!1,NodeMaterialBlockTargets.Vertex),this.registerInput("input",NodeMaterialBlockConnectionPointTypes.AutoDetect,!1,NodeMaterialBlockTargets.Fragment),this.registerInput("fogColor",NodeMaterialBlockConnectionPointTypes.AutoDetect,!1,NodeMaterialBlockTargets.Fragment),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.Color3,NodeMaterialBlockTargets.Fragment),this.input.addExcludedConnectionPointFromAllowedTypes(NodeMaterialBlockConnectionPointTypes.Color3|NodeMaterialBlockConnectionPointTypes.Vector3|NodeMaterialBlockConnectionPointTypes.Color4),this.fogColor.addExcludedConnectionPointFromAllowedTypes(NodeMaterialBlockConnectionPointTypes.Color3|NodeMaterialBlockConnectionPointTypes.Vector3|NodeMaterialBlockConnectionPointTypes.Color4)}get view(){return this._inputs[1]}_buildBlock(e){if(super._buildBlock(e),e.target===NodeMaterialBlockTargets.Fragment){e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this);let t=[],i="",a="";1===e.shaderLanguage?(t=[{search:/fn CalcFogFactor\(\)/,replace:"fn CalcFogFactor(vFogDistance: vec3f, vFogInfos: vec4f)"},{search:/uniforms.vFogInfos/g,replace:"vFogInfos"},{search:/fragmentInputs.vFogDistance/g,replace:"vFogDistance"}],i="fragmentInputs.",a="uniforms."):t=[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}],e._emitFunctionFromInclude("fogFragmentDeclaration",`//${this.name}`,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:t});const n=e._getFreeVariableName("fog"),s=this.input,r=this.fogColor;this._fogParameters=e._getFreeVariableName("fogParameters");const o=this._outputs[0];e._emitUniformFromString(this._fogParameters,NodeMaterialBlockConnectionPointTypes.Vector4),e.compilationString+="#ifdef FOG\n",e.compilationString+=`${e._declareLocalVar(n,NodeMaterialBlockConnectionPointTypes.Float)} = CalcFogFactor(${i}${this._fogDistanceName}, ${a}${this._fogParameters});\n`,e.compilationString+=e._declareOutput(o)+` = ${n} * ${s.associatedVariableName}.rgb + (1.0 - ${n}) * ${r.associatedVariableName}.rgb;\n`,e.compilationString+=`#else\n${e._declareOutput(o)} =  ${s.associatedVariableName}.rgb;\n`,e.compilationString+="#endif\n"}else{const t=this.worldPosition,i=this.view;this._fogDistanceName=e._getFreeVariableName("vFogDistance"),e._emitVaryingFromString(this._fogDistanceName,NodeMaterialBlockConnectionPointTypes.Vector3);const a=1===e.shaderLanguage?"vertexOutputs.":"";e.compilationString+=`${a}${this._fogDistanceName} = (${i.associatedVariableName} * ${t.associatedVariableName}).xyz;\n`}return this}};RegisterClass("BABYLON.FogBlock",FogBlock);var NegateBlock=class extends NodeMaterialBlock{getClassName(){return"NegateBlock"}get output(){return this._outputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Neutral),this.registerInput("value",NodeMaterialBlockConnectionPointTypes.AutoDetect),this.registerOutput("output",NodeMaterialBlockConnectionPointTypes.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = -1.0 * ${this.value.associatedVariableName};\n`,this}get value(){return this._inputs[0]}};RegisterClass("BABYLON.NegateBlock",NegateBlock);var ShadowMapBlock=class extends NodeMaterialBlock{get depth(){return this._outputs[0]}constructor(e){super(e,NodeMaterialBlockTargets.Fragment),this.registerInput("worldPosition",NodeMaterialBlockConnectionPointTypes.Vector4,!1),this.registerInput("viewProjection",NodeMaterialBlockConnectionPointTypes.Matrix,!1),this.registerInput("worldNormal",NodeMaterialBlockConnectionPointTypes.AutoDetect,!0),this.registerOutput("depth",NodeMaterialBlockConnectionPointTypes.Vector3),this.worldNormal.addExcludedConnectionPointFromAllowedTypes(NodeMaterialBlockConnectionPointTypes.Color3|NodeMaterialBlockConnectionPointTypes.Vector3|NodeMaterialBlockConnectionPointTypes.Vector4)}async _initShaderSourceAsync(e){this._codeIsReady=!1,1===e?await Promise.all([Promise.resolve().then((()=>(init_shadowMapVertexMetric(),shadowMapVertexMetric_exports))),Promise.resolve().then((()=>(init_packingFunctions(),packingFunctions_exports))),Promise.resolve().then((()=>(init_shadowMapFragment(),shadowMapFragment_exports)))]):await Promise.all([Promise.resolve().then((()=>(init_shadowMapVertexMetric2(),shadowMapVertexMetric_exports2))),Promise.resolve().then((()=>(init_packingFunctions2(),packingFunctions_exports2))),Promise.resolve().then((()=>(init_shadowMapFragment2(),shadowMapFragment_exports2)))]),this._codeIsReady=!0,this.onCodeIsReadyObservable.notifyObservers(this)}getClassName(){return"ShadowMapBlock"}get worldNormal(){return this._inputs[2]}get viewProjection(){return this._inputs[1]}_buildBlock(e){super._buildBlock(e);const t=`//${this.name}`,i=1===e.shaderLanguage;e._emitUniformFromString("biasAndScaleSM",NodeMaterialBlockConnectionPointTypes.Vector3),e._emitUniformFromString("lightDataSM",NodeMaterialBlockConnectionPointTypes.Vector3),e._emitUniformFromString("depthValuesSM",NodeMaterialBlockConnectionPointTypes.Vector2),e._emitFunctionFromInclude("packingFunctions",t),e.compilationString+=`${e._declareLocalVar("worldPos",NodeMaterialBlockConnectionPointTypes.Vector4)} = ${this.worldPosition.associatedVariableName};\n`,e.compilationString+=`${e._declareLocalVar("vPositionWSM",NodeMaterialBlockConnectionPointTypes.Vector3)};\n`,e.compilationString+=`${e._declareLocalVar("vDepthMetricSM",NodeMaterialBlockConnectionPointTypes.Float)} = 0.0;\n`,e.compilationString+=`${e._declareLocalVar("zSM",NodeMaterialBlockConnectionPointTypes.Float)};\n`,this.worldNormal.isConnected&&(e.compilationString+=`${e._declareLocalVar("vNormalW",NodeMaterialBlockConnectionPointTypes.Vector3)} = ${this.worldNormal.associatedVariableName}.xyz;\n`,e.compilationString+=e._emitCodeFromInclude("shadowMapVertexNormalBias",t)),e.compilationString+=`${e._declareLocalVar("clipPos",NodeMaterialBlockConnectionPointTypes.Vector4)} = ${this.viewProjection.associatedVariableName} * worldPos;\n`,e.compilationString+=e._emitCodeFromInclude("shadowMapVertexMetric",t,{replaceStrings:[{search:/gl_Position/g,replace:"clipPos"},{search:/vertexOutputs.position/g,replace:"clipPos"}]}),e.compilationString+=e._emitCodeFromInclude("shadowMapFragment",t,{replaceStrings:[{search:/return;/g,replace:""}]});const a=i?"fragmentOutputs.fragDepth":"gl_FragDepth";return e.compilationString+=`\n            #if SM_DEPTHTEXTURE == 1\n                #ifdef IS_NDC_HALF_ZRANGE\n                    ${a} = (clipPos.z / clipPos.w);\n                #else\n                    ${a} = (clipPos.z / clipPos.w) * 0.5 + 0.5;\n                #endif\n            #endif\n        `,e.compilationString+=`${e._declareOutput(this.depth)} = vec3${e.fSuffix}(depthSM, 1., 1.);\n`,this}initialize(e){e._excludeVariableName("vPositionWSM"),e._excludeVariableName("lightDataSM"),e._excludeVariableName("biasAndScaleSM"),e._excludeVariableName("depthValuesSM"),e._excludeVariableName("clipPos"),e._excludeVariableName("worldPos"),e._excludeVariableName("zSM"),this._initShaderSourceAsync(e.shaderLanguage)}get worldPosition(){return this._inputs[0]}};function standard(e,t){var i=new NodeMaterial(e,t);i.mode=NodeMaterialModes.Material;var a=new InputBlock("position");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsAttribute("position");var n=new TransformBlock("WorldPos");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.complementZ=0,n.complementW=1;var s=new BonesBlock("Bones");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1;var r=new InputBlock("matricesIndices");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsAttribute("matricesIndices");var o=new InputBlock("matricesWeights");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("matricesWeights");var l=new InputBlock("World");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsSystemValue(NodeMaterialSystemValues.World);var c=new TransformBlock("Transform");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.complementZ=0,c.complementW=0;var h=new InputBlock("normal");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsAttribute("normal");var u=new LightBlock("Lights");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=3;var m=new InputBlock("cameraPosition");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1,m.setAsSystemValue(NodeMaterialSystemValues.CameraPosition);var d=new MultiplyBlock("Multiply");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=4;var f=new PowBlock("Pow");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=4;var p=new ColorSplitterBlock("ColorSplitter");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;var _=new InputBlock("color");_.visibleInInspector=!1,_.visibleOnFrame=!1,_.target=1,_.setAsAttribute("color");var g=new VectorMergerBlock("VectorMerger");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=4,g.xSwizzle="x",g.ySwizzle="y",g.zSwizzle="z",g.wSwizzle="w";var v=new InputBlock("Float");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1,v.value=.5,v.min=0,v.max=0,v.isBoolean=!1,v.matrixMode=0,v.animationType=AnimatedInputBlockTypes.None,v.isConstant=!1;var y=new AddBlock("Add");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=4;var S=new InputBlock("emissiveColor");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=1,S.value=new Color3(0,0,0),S.isConstant=!1;var C=new FragmentOutputBlock("FragmentOutput");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=2,C.convertToGammaSpace=!1,C.convertToLinearSpace=!1,C.useLogarithmicDepth=!1;var E=new TransformBlock("WorldPos * ViewProjectionTransform");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=1,E.complementZ=0,E.complementW=1;var A=new InputBlock("ViewProjection");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1,A.setAsSystemValue(NodeMaterialSystemValues.ViewProjection);var T=new VertexOutputBlock("VertexOutput");return T.visibleInInspector=!1,T.visibleOnFrame=!1,T.target=1,a.output.connectTo(n.vector),r.output.connectTo(s.matricesIndices),o.output.connectTo(s.matricesWeights),l.output.connectTo(s.world),s.output.connectTo(n.transform),n.output.connectTo(E.vector),A.output.connectTo(E.transform),E.output.connectTo(T.vector),S.output.connectTo(y.left),n.output.connectTo(u.worldPosition),h.output.connectTo(c.vector),s.output.connectTo(c.transform),c.output.connectTo(u.worldNormal),m.output.connectTo(u.cameraPosition),u.diffuseOutput.connectTo(d.left),_.output.connectTo(p.rgba),p.rgbOut.connectTo(f.value),v.output.connectTo(g.x),v.output.connectTo(g.y),v.output.connectTo(g.z),g.xyz.connectTo(f.power),f.output.connectTo(d.right),d.output.connectTo(y.right),y.output.connectTo(C.rgb),i.addOutputNode(T),i.addOutputNode(C),i.build(),i}function shell(e,t){var i=new NodeMaterial(e,t);i.mode=NodeMaterialModes.Material;var a=new InputBlock("position");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsAttribute("position");var n=new TransformBlock("WorldPos");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.complementZ=0,n.complementW=1;var s=new BonesBlock("Bones");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1;var r=new InputBlock("matricesIndices");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsAttribute("matricesIndices");var o=new InputBlock("matricesWeights");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("matricesWeights");var l=new InputBlock("World");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsSystemValue(NodeMaterialSystemValues.World);var c=new TransformBlock("Transform");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.complementZ=0,c.complementW=0;var h=new InputBlock("normal");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsAttribute("normal");var u=new CustomBlock("StampNormal");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1,u.options={name:"StampNormal",comments:"Calculate stamp normal",target:"Vertex",inParameters:[{name:"vPosition",type:"Vector3"},{name:"vNormal",type:"Vector3"},{name:"stampPosition",type:"Vector2"}],outParameters:[{name:"vUV",type:"Vector2"},{name:"stampNormal",type:"Vector3"}],functionName:"eggStampNormal",code:["mat4 rotationMatrix(vec3 axis, float angle) {","axis = normalize(axis);","float s = sin(angle);","float c = cos(angle);","float oc = 1.0 - c;","return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","0.0,                                0.0,                                0.0,                                1.0);","}","void eggStampNormal(vec3 vPosition, vec3 vNormal, vec2 stampPosition, out vec2 vUV, out vec3 stampNormal) {","mat4 rotY = rotationMatrix(vec3(0., 1., 0.), stampPosition.x * 0.01745329 * 2.5); // stampPosition is a value from -1 to 1, multiply that with max angle","mat4 rotX = rotationMatrix(vec3(1., 0., 0.), stampPosition.y * 0.01745329 * 2.5);","vec4 pos = rotX * rotY * vec4(vPosition, 1.);","// Project the stamp","vUV = pos.xy * 0.118; // base scale","vUV = vUV + vec2(0.03125, 0.03125) / 2.; // half stamp offset","vUV.x = 0.03125 - vUV.x; // flip axis","vUV.y = vUV.y + 0.00125; // position correction","//vUV = vUV - stampPosition / 100.;","stampNormal = (rotX * rotY * vec4(vNormal, 1.)).xyz;","}"]};var m=new InputBlock("stampPosition");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1,m.value=new Vector2(.003,.001),m.isConstant=!1;var d=new CustomBlock("EggStamp");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=2,d.options={name:"EggStamp",comments:"Sample selected stamp",target:"Fragment",inParameters:[{name:"source",type:"sampler2D"},{name:"color",type:"Color3"},{name:"vUV",type:"Vector2"},{name:"stampOffset",type:"Vector2"},{name:"stampNormal",type:"Vector3"}],outParameters:[{name:"rgb",type:"Color3"}],functionName:"eggStamp",code:["void eggStamp(sampler2D source, vec3 color, vec2 vUV, vec2 stampOffset, vec3 stampNormal, out vec3 rgb) {","float d = dot(stampNormal, vec3(0.0, 0.0, 1.0));","vec2 uv = clamp(vUV, vec2(0., 0.), vec2(0.03125, 0.03125));","uv += stampOffset - vec2(0., 0.03125);","vec4 stampColor = texture2D(source, uv);","if (d > -0.1) {","stampColor.a = 0.;","}","rgb = mix(color.rgb, stampColor.rgb, stampColor.a);","}"]};var f=new ImageSourceBlock("ImageSource");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=3;var p=new MultiplyBlock("Multiply");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;var _=new InputBlock("customColor");_.visibleInInspector=!0,_.visibleOnFrame=!1,_.target=1,_.value=new Color3(1,1,1),_.isConstant=!1;var g=new PowBlock("Pow");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=4;var v=new ClampBlock("Clamp");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=2,v.minimum=0,v.maximum=1;var y=new ScaleBlock("Scale");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=1;var S=new AddBlock("Add");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=1;var C=new ColorSplitterBlock("ColorSplitter");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=4;var E=new InputBlock("color");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=1,E.setAsAttribute("color");var A=new ScaleBlock("Scale");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1;var T=new InputBlock("Color3");T.visibleInInspector=!1,T.visibleOnFrame=!1,T.target=1,T.value=new Color3(.16470588235294117,.16470588235294117,.16470588235294117),T.isConstant=!0;var M=new InputBlock("hp");M.visibleInInspector=!0,M.visibleOnFrame=!1,M.target=1,M.value=0,M.min=0,M.max=1,M.isBoolean=!1,M.matrixMode=0,M.animationType=AnimatedInputBlockTypes.None,M.isConstant=!1;var x=new InputBlock("Float");x.visibleInInspector=!1,x.visibleOnFrame=!1,x.target=1,x.value=6,x.min=0,x.max=0,x.isBoolean=!1,x.matrixMode=0,x.animationType=AnimatedInputBlockTypes.None,x.isConstant=!0;var b=new VectorMergerBlock("VectorMerger");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=4,b.xSwizzle="x",b.ySwizzle="y",b.zSwizzle="z",b.wSwizzle="w";var w=new InputBlock("Float");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=1,w.value=.5,w.min=0,w.max=0,w.isBoolean=!1,w.matrixMode=0,w.animationType=AnimatedInputBlockTypes.None,w.isConstant=!1;var I=new InputBlock("stampOffset");I.visibleInInspector=!1,I.visibleOnFrame=!1,I.target=1,I.value=new Vector2(.003,.001),I.isConstant=!1;var P=new MultiplyBlock("Multiply");P.visibleInInspector=!1,P.visibleOnFrame=!1,P.target=4;var R=new LightBlock("Lights");R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=3;var N=new InputBlock("cameraPosition");N.visibleInInspector=!1,N.visibleOnFrame=!1,N.target=1,N.setAsSystemValue(NodeMaterialSystemValues.CameraPosition);var k=new LerpBlock("Lerp");k.visibleInInspector=!1,k.visibleOnFrame=!1,k.target=2;var D=new ColorSplitterBlock("ColorSplitter");D.visibleInInspector=!1,D.visibleOnFrame=!1,D.target=1;var B=new InputBlock("teamColor");B.visibleInInspector=!0,B.visibleOnFrame=!1,B.target=1,B.value=new Color4(1,0,0,.3137254901960784),B.isConstant=!1;var F=new StepBlock("Step");F.visibleInInspector=!1,F.visibleOnFrame=!1,F.target=4;var L=new DotBlock("Dot");L.visibleInInspector=!1,L.visibleOnFrame=!1,L.target=1;var O=new ViewDirectionBlock("View direction");O.visibleInInspector=!1,O.visibleOnFrame=!1,O.target=1;var G=new InputBlock("cameraPosition");G.visibleInInspector=!1,G.visibleOnFrame=!1,G.target=1,G.setAsSystemValue(NodeMaterialSystemValues.CameraPosition);var V=new FragmentOutputBlock("FragmentOutput");V.visibleInInspector=!1,V.visibleOnFrame=!1,V.target=2,V.convertToGammaSpace=!1,V.convertToLinearSpace=!1,V.useLogarithmicDepth=!1;var U=new TransformBlock("WorldPos * ViewProjectionTransform");U.visibleInInspector=!1,U.visibleOnFrame=!1,U.target=1,U.complementZ=0,U.complementW=1;var H=new InputBlock("ViewProjection");H.visibleInInspector=!1,H.visibleOnFrame=!1,H.target=1,H.setAsSystemValue(NodeMaterialSystemValues.ViewProjection);var W=new VertexOutputBlock("VertexOutput");return W.visibleInInspector=!1,W.visibleOnFrame=!1,W.target=1,a.output.connectTo(n.vector),r.output.connectTo(s.matricesIndices),o.output.connectTo(s.matricesWeights),l.output.connectTo(s.world),s.output.connectTo(n.transform),n.output.connectTo(U.vector),H.output.connectTo(U.transform),U.output.connectTo(W.vector),B.output.connectTo(D.rgba),D.rgbOut.connectTo(k.left),n.output.connectTo(R.worldPosition),h.output.connectTo(c.vector),s.output.connectTo(c.transform),c.output.connectTo(R.worldNormal),N.output.connectTo(R.cameraPosition),R.diffuseOutput.connectTo(P.left),f.source.connectTo(d.source),_.output.connectTo(p.left),E.output.connectTo(C.rgba),C.rgbOut.connectTo(S.left),T.output.connectTo(A.input),M.output.connectTo(A.factor),A.output.connectTo(S.right),S.output.connectTo(y.input),x.output.connectTo(y.factor),y.output.connectTo(v.value),v.output.connectTo(g.value),w.output.connectTo(b.x),w.output.connectTo(b.y),w.output.connectTo(b.z),b.xyz.connectTo(g.power),g.output.connectTo(p.right),p.output.connectTo(d.color),a.output.connectTo(u.vPosition),h.output.connectTo(u.vNormal),m.output.connectTo(u.stampPosition),u.vUV.connectTo(d.vUV),I.output.connectTo(d.stampOffset),u.stampNormal.connectTo(d.stampNormal),d.rgb.connectTo(P.right),P.output.connectTo(k.right),n.output.connectTo(O.worldPosition),G.output.connectTo(O.cameraPosition),O.output.connectTo(L.left),c.xyz.connectTo(L.right),L.output.connectTo(F.value),D.a.connectTo(F.edge),F.output.connectTo(k.gradient),k.output.connectTo(V.rgb),i.addOutputNode(W),i.addOutputNode(V),i.build(),i}function instanced(e,t){var i=new NodeMaterial(e,t);i.mode=NodeMaterialModes.Material;var a=new InputBlock("position");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsAttribute("position");var n=new TransformBlock("WorldPos");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.complementZ=0,n.complementW=1;var s=new InstancesBlock("Instances");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1;var r=new InputBlock("world0");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsAttribute("world0");var o=new InputBlock("world1");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("world1");var l=new InputBlock("world2");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsAttribute("world2");var c=new InputBlock("world3");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsAttribute("world3");var h=new InputBlock("world");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsSystemValue(NodeMaterialSystemValues.World);var u=new TransformBlock("Transform");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1,u.complementZ=0,u.complementW=0;var m=new InputBlock("normal");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1,m.setAsAttribute("normal");var d=new LightBlock("Lights");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=3;var f=new InputBlock("cameraPosition");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.setAsSystemValue(NodeMaterialSystemValues.CameraPosition);var p=new MultiplyBlock("Multiply");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;var _=new PowBlock("Pow");_.visibleInInspector=!1,_.visibleOnFrame=!1,_.target=4;var g=new ColorSplitterBlock("ColorSplitter");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=4;var v=new InputBlock("color");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1,v.setAsAttribute("color");var y=new VectorMergerBlock("VectorMerger");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=4,y.xSwizzle="x",y.ySwizzle="y",y.zSwizzle="z",y.wSwizzle="w";var S=new InputBlock("Float");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=1,S.value=.5,S.min=0,S.max=0,S.isBoolean=!1,S.matrixMode=0,S.animationType=AnimatedInputBlockTypes.None,S.isConstant=!1;var C=new FragmentOutputBlock("FragmentOutput");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=2,C.convertToGammaSpace=!1,C.convertToLinearSpace=!1,C.useLogarithmicDepth=!1;var E=new TransformBlock("WorldPos * ViewProjectionTransform");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=1,E.complementZ=0,E.complementW=1;var A=new InputBlock("ViewProjection");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1,A.setAsSystemValue(NodeMaterialSystemValues.ViewProjection);var T=new VertexOutputBlock("VertexOutput");return T.visibleInInspector=!1,T.visibleOnFrame=!1,T.target=1,a.output.connectTo(n.vector),r.output.connectTo(s.world0),o.output.connectTo(s.world1),l.output.connectTo(s.world2),c.output.connectTo(s.world3),h.output.connectTo(s.world),s.output.connectTo(n.transform),n.output.connectTo(E.vector),A.output.connectTo(E.transform),E.output.connectTo(T.vector),n.output.connectTo(d.worldPosition),m.output.connectTo(u.vector),s.output.connectTo(u.transform),u.output.connectTo(d.worldNormal),f.output.connectTo(d.cameraPosition),d.diffuseOutput.connectTo(p.left),v.output.connectTo(g.rgba),g.rgbOut.connectTo(_.value),S.output.connectTo(y.x),S.output.connectTo(y.y),S.output.connectTo(y.z),y.xyz.connectTo(_.power),_.output.connectTo(p.right),p.output.connectTo(C.rgb),i.addOutputNode(T),i.addOutputNode(C),i.build(),i}function bullet(e,t){var i=new NodeMaterial(e,t);i.mode=NodeMaterialModes.Material;var a=new InputBlock("position");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsAttribute("position");var n=new TransformBlock("WorldPos");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.complementZ=0,n.complementW=1;var s=new InstancesBlock("Instances");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1;var r=new InputBlock("world0");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsAttribute("world0");var o=new InputBlock("world1");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("world1");var l=new InputBlock("world2");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsAttribute("world2");var c=new InputBlock("world3");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsAttribute("world3");var h=new InputBlock("world");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsSystemValue(NodeMaterialSystemValues.World);var u=new TransformBlock("WorldPos * ViewProjectionTransform");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1,u.complementZ=0,u.complementW=1;var m=new InputBlock("ViewProjection");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1,m.setAsSystemValue(NodeMaterialSystemValues.ViewProjection);var d=new VertexOutputBlock("VertexOutput");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=1;var f=new InputBlock("color");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.setAsAttribute("color");var p=new FragmentOutputBlock("FragmentOutput");return p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=2,p.convertToGammaSpace=!1,p.convertToLinearSpace=!1,p.useLogarithmicDepth=!1,a.output.connectTo(n.vector),r.output.connectTo(s.world0),o.output.connectTo(s.world1),l.output.connectTo(s.world2),c.output.connectTo(s.world3),h.output.connectTo(s.world),s.output.connectTo(n.transform),n.output.connectTo(u.vector),m.output.connectTo(u.transform),u.output.connectTo(d.vector),f.output.connectTo(p.rgba),i.addOutputNode(d),i.addOutputNode(p),i.build(),i}function map(e,t){var i=new NodeMaterial(e,t);i.mode=NodeMaterialModes.Material;var a=new InputBlock("position");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsAttribute("position");var n=new TransformBlock("WorldPos");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.complementZ=0,n.complementW=1;var s=new InputBlock("World");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1,s.setAsSystemValue(NodeMaterialSystemValues.World);var r=new TransformBlock("WorldPos * ViewProjectionTransform");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=1;var o=new InputBlock("ViewProjection");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsSystemValue(NodeMaterialSystemValues.ViewProjection);var l=new VertexOutputBlock("VertexOutput");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1;var c=new FogBlock("Fog");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=3;var h=new InputBlock("view");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsSystemValue(NodeMaterialSystemValues.View);var u=new MultiplyBlock("Multiply");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=4;var m=new PowBlock("Pow");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=4;var d=new ColorSplitterBlock("ColorSplitter");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=4;var f=new InputBlock("color");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.setAsAttribute("color");var p=new InputBlock("Vector3");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=1,p.value=new Vector3(.5,.5,.5),p.isConstant=!1;var _=new CustomBlock("Shadow");_.visibleInInspector=!1,_.visibleOnFrame=!1,_.target=2,_.options={name:"Shadow",comments:"Custom shadow shit",target:"Fragment",inParameters:[{name:"posFromLight",type:"Vector4"},{name:"shadowSampler",type:"sampler2D"}],outParameters:[{name:"output",type:"Float"}],functionName:"computeShadow",code:["void computeShadow(vec4 posFromLight, sampler2D shadowSampler, out float result) {","vec3 depth = posFromLight.xyz / posFromLight.w;","depth = 0.5 * depth + vec3(0.5);","vec2 uv = depth.xy;","float s = texture2D(shadowSampler, uv).x;","if (s < 1.) {","float d = depth.z;","s = 1. - (s - d) * 80. - 1.;","if (s < 0.) s = 1.;","s = clamp(s, 0., 1.);","}","else {","s = 1.;","}","result = s;","}"]};var g=new TransformBlock("Transform");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1,g.complementZ=0,g.complementW=1;var v=new InputBlock("shadowLightMatrix ");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1,v.value=Matrix.FromArray([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),v.isConstant=!1;var y=new ImageSourceBlock("shadowSampler");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=3;var S=new InputBlock("fogColor");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=1,S.setAsSystemValue(NodeMaterialSystemValues.FogColor);var C=new FragmentOutputBlock("FragmentOutput");return C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=2,C.convertToGammaSpace=!1,C.convertToLinearSpace=!1,C.useLogarithmicDepth=!1,a.output.connectTo(n.vector),s.output.connectTo(n.transform),n.output.connectTo(r.vector),o.output.connectTo(r.transform),r.output.connectTo(l.vector),n.output.connectTo(c.worldPosition),h.output.connectTo(c.view),f.output.connectTo(d.rgba),d.rgbOut.connectTo(m.value),p.output.connectTo(m.power),m.output.connectTo(u.left),n.output.connectTo(g.vector),v.output.connectTo(g.transform),g.output.connectTo(_.posFromLight),y.source.connectTo(_.shadowSampler),_.output.connectTo(u.right),u.output.connectTo(c.input),S.output.connectTo(c.fogColor),c.output.connectTo(C.rgb),i.addOutputNode(l),i.addOutputNode(C),i.build(),i}function colorized(e,t){var i=new NodeMaterial(e,t);i.mode=NodeMaterialModes.Material;var a=new InputBlock("position");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsAttribute("position");var n=new TransformBlock("WorldPos");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.complementZ=0,n.complementW=1;var s=new InputBlock("World");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1,s.setAsSystemValue(NodeMaterialSystemValues.World);var r=new TransformBlock("WorldPos * ViewProjectionTransform");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=1;var o=new InputBlock("ViewProjection");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsSystemValue(NodeMaterialSystemValues.ViewProjection);var l=new VertexOutputBlock("VertexOutput");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1;var c=new InputBlock("color");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.value=new Color3(0,0,0),c.isConstant=!1;var h=new FragmentOutputBlock("FragmentOutput");return h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=2,h.convertToGammaSpace=!1,h.convertToLinearSpace=!1,h.useLogarithmicDepth=!1,a.output.connectTo(n.vector),s.output.connectTo(n.transform),n.output.connectTo(r.vector),o.output.connectTo(r.transform),r.output.connectTo(l.vector),c.output.connectTo(h.rgb),i.addOutputNode(l),i.addOutputNode(h),i.build(),i}RegisterClass("BABYLON.ShadowMapBlock",ShadowMapBlock);var Shader={standard:standard,shell:shell,instanced:instanced,bullet:bullet,map:map,colorized:colorized},StringDictionary=class{get count(){return this._count}contains(e){return void 0!==this._data[e]}getAndRemove(e){const t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null}get(e){const t=this._data[e];if(void 0!==t)return t}getOrAdd(e,t){const i=this.get(e);return void 0!==i?i:(this.add(e,t),t)}constructor(){this._count=0,this._data={}}copyFrom(e){this.clear(),e.forEach(((e,t)=>this.add(e,t)))}first(e){for(const t in this._data){const i=e(t,this._data[t]);if(i)return i}return null}remove(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)}getOrAddWithFactory(e,t){let i=this.get(e);return void 0!==i||(i=t(e),i&&this.add(e,i)),i}add(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)}clear(){this._data={},this._count=0}set(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)}forEach(e){for(const t in this._data){e(t,this._data[t])}}},AbstractScene=class{static Parse(e,t,i,a){for(const n in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,n)&&this._BabylonFileParsers[n](e,t,i,a)}static AddParser(e,t){this._BabylonFileParsers[e]=t}static GetParser(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null}getNodes(){let e=[];return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach((t=>e=e.concat(t.bones))),e}constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[]}static AddIndividualParser(e,t){this._IndividualBabylonFileParsers[e]=t}set environmentTexture(e){this._environmentTexture=e}get environmentTexture(){return this._environmentTexture}static GetIndividualParser(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null}};function PrepareUniformsForColorCurves(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}AbstractScene._BabylonFileParsers={},AbstractScene._IndividualBabylonFileParsers={},RegisterClass("BABYLON.AbstractScene",AbstractScene);var ColorCurves=class e{serialize(){return SerializationHelper.Serialize(this)}get globalSaturation(){return this._globalSaturation}set shadowsExposure(e){this._shadowsExposure=e,this._dirty=!0}clone(){return SerializationHelper.Clone((()=>new e),this)}static Parse(t){return SerializationHelper.Parse((()=>new e),t,null,null)}set globalDensity(e){this._globalDensity=e,this._dirty=!0}_getColorGradingDataToRef(t,i,a,n,s){null!=t&&(t=e._Clamp(t,0,360),i=e._Clamp(i,-100,100),a=e._Clamp(a,-100,100),n=e._Clamp(n,-100,100),i=e._ApplyColorGradingSliderNonlinear(i),i*=.5,n=e._ApplyColorGradingSliderNonlinear(n),i<0&&(i*=-1,t=(t+180)%360),e._FromHSBToRef(t,i,50+.25*n,s),s.scaleToRef(2,s),s.a=1+.01*a)}set globalExposure(e){this._globalExposure=e,this._dirty=!0}static _FromHSBToRef(t,i,a,n){let s=e._Clamp(t,0,360);const r=e._Clamp(i/100,0,1),o=e._Clamp(a/100,0,1);if(0===r)n.r=o,n.g=o,n.b=o;else{s/=60;const e=Math.floor(s),t=s-e,i=o*(1-r),a=o*(1-r*t),l=o*(1-r*(1-t));switch(e){case 0:n.r=o,n.g=l,n.b=i;break;case 1:n.r=a,n.g=o,n.b=i;break;case 2:n.r=i,n.g=o,n.b=l;break;case 3:n.r=i,n.g=a,n.b=o;break;case 4:n.r=l,n.g=i,n.b=o;break;default:n.r=o,n.g=i,n.b=a}}n.a=1}set midtonesSaturation(e){this._midtonesSaturation=e,this._dirty=!0}constructor(){this._dirty=!0,this._tempColor=new Color4(0,0,0,0),this._globalCurve=new Color4(0,0,0,0),this._highlightsCurve=new Color4(0,0,0,0),this._midtonesCurve=new Color4(0,0,0,0),this._shadowsCurve=new Color4(0,0,0,0),this._positiveCurve=new Color4(0,0,0,0),this._negativeCurve=new Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}getClassName(){return"ColorCurves"}set shadowsDensity(e){this._shadowsDensity=e,this._dirty=!0}set midtonesExposure(e){this._midtonesExposure=e,this._dirty=!0}static _ApplyColorGradingSliderNonlinear(e){e/=100;let t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100,t}get highlightsSaturation(){return this._highlightsSaturation}get midtonesSaturation(){return this._midtonesSaturation}get shadowsSaturation(){return this._shadowsSaturation}get midtonesDensity(){return this._midtonesDensity}set globalHue(e){this._globalHue=e,this._dirty=!0}get highlightsHue(){return this._highlightsHue}static Bind(e,t,i="vCameraColorCurvePositive",a="vCameraColorCurveNeutral",n="vCameraColorCurveNegative"){e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(a,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(n,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}set highlightsHue(e){this._highlightsHue=e,this._dirty=!0}set highlightsDensity(e){this._highlightsDensity=e,this._dirty=!0}get globalExposure(){return this._globalExposure}get shadowsExposure(){return this._shadowsExposure}set shadowsSaturation(e){this._shadowsSaturation=e,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set globalSaturation(e){this._globalSaturation=e,this._dirty=!0}static _Clamp(e,t,i){return Math.min(Math.max(e,t),i)}get midtonesHue(){return this._midtonesHue}set highlightsSaturation(e){this._highlightsSaturation=e,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}get globalHue(){return this._globalHue}set shadowsHue(e){this._shadowsHue=e,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set midtonesDensity(e){this._midtonesDensity=e,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set highlightsExposure(e){this._highlightsExposure=e,this._dirty=!0}get globalDensity(){return this._globalDensity}get highlightsExposure(){return this._highlightsExposure}set midtonesHue(e){this._midtonesHue=e,this._dirty=!0}};function PrepareUniformsForImageProcessing(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&e.push("vInverseScreenSize"),t.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&PrepareUniformsForColorCurves(e),t.DITHER&&e.push("ditherIntensity")}function PrepareSamplersForImageProcessing(e,t){t.COLORGRADING&&e.push("txColorTransform")}ColorCurves.PrepareUniforms=PrepareUniformsForColorCurves,__decorate([serialize()],ColorCurves.prototype,"_globalHue",void 0),__decorate([serialize()],ColorCurves.prototype,"_globalDensity",void 0),__decorate([serialize()],ColorCurves.prototype,"_globalSaturation",void 0),__decorate([serialize()],ColorCurves.prototype,"_globalExposure",void 0),__decorate([serialize()],ColorCurves.prototype,"_highlightsHue",void 0),__decorate([serialize()],ColorCurves.prototype,"_highlightsDensity",void 0),__decorate([serialize()],ColorCurves.prototype,"_highlightsSaturation",void 0),__decorate([serialize()],ColorCurves.prototype,"_highlightsExposure",void 0),__decorate([serialize()],ColorCurves.prototype,"_midtonesHue",void 0),__decorate([serialize()],ColorCurves.prototype,"_midtonesDensity",void 0),__decorate([serialize()],ColorCurves.prototype,"_midtonesSaturation",void 0),__decorate([serialize()],ColorCurves.prototype,"_midtonesExposure",void 0),SerializationHelper._ColorCurvesParser=ColorCurves.Parse;var ImageProcessingConfiguration=class e{set colorGradingBGR(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}get contrast(){return this._contrast}constructor(){this.colorCurves=new ColorCurves,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new Color4(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new Observable}prepareDefines(t,i=!1){if(i!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=0,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.DITHER=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case e.TONEMAPPING_KHR_PBR_NEUTRAL:t.TONEMAPPING=3;break;case e.TONEMAPPING_ACES:t.TONEMAPPING=2;break;default:t.TONEMAPPING=1}else t.TONEMAPPING=0;t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.DITHER=this._ditheringEnabled,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||!!t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING||t.DITHER}set colorCurvesEnabled(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}set vignetteCentreX(e){this.vignetteCenterX=e}get toneMappingEnabled(){return this._toneMappingEnabled}bind(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&ColorCurves.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){const i=1/e.getEngine().getRenderWidth(),a=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",i,a),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const n=null!=t?t:a/i;let s=Math.tan(.5*this.vignetteCameraFov),r=s*n;const o=Math.sqrt(r*s);r=Mix(r,o,this.vignetteStretch),s=Mix(s,o,this.vignetteStretch),e.setFloat4("vignetteSettings1",r,s,-r*this.vignetteCenterX,-s*this.vignetteCenterY);const l=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);const t=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(t-1)/t,.5/t,t,this.colorGradingTexture.level)}}set vignetteEnabled(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}set toneMappingEnabled(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set colorGradingEnabled(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}clone(){return SerializationHelper.Clone((()=>new e),this)}get skipFinalColorClamp(){return this._skipFinalColorClamp}set colorGradingTexture(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}set colorGradingWithGreenDepth(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}get vignetteCentreY(){return this.vignetteCenterY}get vignetteBlendMode(){return this._vignetteBlendMode}getClassName(){return"ImageProcessingConfiguration"}get colorGradingEnabled(){return this._colorGradingEnabled}get ditheringIntensity(){return this._ditheringIntensity}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}set skipFinalColorClamp(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}set ditheringIntensity(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set vignetteBlendMode(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}get exposure(){return this._exposure}set isEnabled(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}set contrast(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}static Parse(t){const i=SerializationHelper.Parse((()=>new e),t,null,null);return void 0!==t.vignetteCentreX&&(i.vignetteCenterX=t.vignetteCentreX),void 0!==t.vignetteCentreY&&(i.vignetteCenterY=t.vignetteCentreY),i}get colorCurvesEnabled(){return this._colorCurvesEnabled}set applyByPostProcess(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}set exposure(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}get vignetteCentreX(){return this.vignetteCenterX}set toneMappingType(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}get toneMappingType(){return this._toneMappingType}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}get colorGradingBGR(){return this._colorGradingBGR}get colorGradingTexture(){return this._colorGradingTexture}set vignetteCentreY(e){this.vignetteCenterY=e}set ditheringEnabled(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}get vignetteEnabled(){return this._vignetteEnabled}serialize(){return SerializationHelper.Serialize(this)}get isEnabled(){return this._isEnabled}};ImageProcessingConfiguration.TONEMAPPING_STANDARD=0,ImageProcessingConfiguration.TONEMAPPING_ACES=1,ImageProcessingConfiguration.TONEMAPPING_KHR_PBR_NEUTRAL=2,ImageProcessingConfiguration.PrepareUniforms=PrepareUniformsForImageProcessing,ImageProcessingConfiguration.PrepareSamplers=PrepareSamplersForImageProcessing,ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY=0,ImageProcessingConfiguration._VIGNETTEMODE_OPAQUE=1,__decorate([serializeAsColorCurves()],ImageProcessingConfiguration.prototype,"colorCurves",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_colorCurvesEnabled",void 0),__decorate([serializeAsTexture("colorGradingTexture")],ImageProcessingConfiguration.prototype,"_colorGradingTexture",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_colorGradingEnabled",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_colorGradingWithGreenDepth",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_colorGradingBGR",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_exposure",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_toneMappingEnabled",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_toneMappingType",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_contrast",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteStretch",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteCenterX",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteCenterY",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteWeight",void 0),__decorate([serializeAsColor4()],ImageProcessingConfiguration.prototype,"vignetteColor",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteCameraFov",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_vignetteBlendMode",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_vignetteEnabled",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_ditheringEnabled",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_ditheringIntensity",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_skipFinalColorClamp",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_applyByPostProcess",void 0),__decorate([serialize()],ImageProcessingConfiguration.prototype,"_isEnabled",void 0),SerializationHelper._ImageProcessingConfigurationParser=ImageProcessingConfiguration.Parse,RegisterClass("BABYLON.ImageProcessingConfiguration",ImageProcessingConfiguration);var ActionEvent=class e{static CreateNewFromPrimitive(t,i,a,n){return new e(t,i.x,i.y,null,a,n)}static CreateNewFromSprite(t,i,a,n){return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer,a,n)}static CreateNewFromScene(t,i){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)}static CreateNew(t,i,a){const n=t.getScene();return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer||t,i,a)}constructor(e,t,i,a,n,s){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=a,this.sourceEvent=n,this.additionalData=s}},PointerEventTypes=class{};PointerEventTypes.POINTERDOWN=1,PointerEventTypes.POINTERUP=2,PointerEventTypes.POINTERMOVE=4,PointerEventTypes.POINTERWHEEL=8,PointerEventTypes.POINTERPICK=16,PointerEventTypes.POINTERTAP=32,PointerEventTypes.POINTERDOUBLETAP=64;var PointerInfoBase=class{constructor(e,t){this.type=e,this.event=t}},PointerInfoPre=class extends PointerInfoBase{constructor(e,t,i,a){super(e,t),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new Vector2(i,a)}},PointerInfo=class extends PointerInfoBase{constructor(e,t,i,a=null){super(e,t),this._pickInfo=i,this._inputManager=a}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}},AbstractActionManager=class e{static get HasPickTriggers(){for(const t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t)){const e=parseInt(t);if(e>=1&&e<=7)return!0}return!1}static HasSpecificTrigger(t){for(const i in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,i)){if(parseInt(i)===t)return!0}return!1}constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t))return!0;return!1}};AbstractActionManager.Triggers={};var KeyboardEventTypes=class{};KeyboardEventTypes.KEYDOWN=1,KeyboardEventTypes.KEYUP=2;var KeyboardInfo=class{constructor(e,t){this.type=e,this.event=t}},KeyboardInfoPre=class extends KeyboardInfo{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(e){this.skipOnKeyboardObservable=e}constructor(e,t){super(e,t),this.type=e,this.event=t,this.skipOnKeyboardObservable=!1}},DeviceType,DeviceType2,PointerInput,PointerInput2,NativePointerInput,NativePointerInput2,DualShockInput,DualShockInput2,DualSenseInput,DualSenseInput2,XboxInput,XboxInput2,SwitchInput,SwitchInput2,DeviceInputEventType,DeviceInputEventType2;DeviceType2=DeviceType||(DeviceType={}),DeviceType2[DeviceType2.Generic=0]="Generic",DeviceType2[DeviceType2.Keyboard=1]="Keyboard",DeviceType2[DeviceType2.Mouse=2]="Mouse",DeviceType2[DeviceType2.Touch=3]="Touch",DeviceType2[DeviceType2.DualShock=4]="DualShock",DeviceType2[DeviceType2.Xbox=5]="Xbox",DeviceType2[DeviceType2.Switch=6]="Switch",DeviceType2[DeviceType2.DualSense=7]="DualSense",PointerInput2=PointerInput||(PointerInput={}),PointerInput2[PointerInput2.Horizontal=0]="Horizontal",PointerInput2[PointerInput2.Vertical=1]="Vertical",PointerInput2[PointerInput2.LeftClick=2]="LeftClick",PointerInput2[PointerInput2.MiddleClick=3]="MiddleClick",PointerInput2[PointerInput2.RightClick=4]="RightClick",PointerInput2[PointerInput2.BrowserBack=5]="BrowserBack",PointerInput2[PointerInput2.BrowserForward=6]="BrowserForward",PointerInput2[PointerInput2.MouseWheelX=7]="MouseWheelX",PointerInput2[PointerInput2.MouseWheelY=8]="MouseWheelY",PointerInput2[PointerInput2.MouseWheelZ=9]="MouseWheelZ",PointerInput2[PointerInput2.Move=12]="Move",NativePointerInput2=NativePointerInput||(NativePointerInput={}),NativePointerInput2[NativePointerInput2.Horizontal=0]="Horizontal",NativePointerInput2[NativePointerInput2.Vertical=1]="Vertical",NativePointerInput2[NativePointerInput2.LeftClick=2]="LeftClick",NativePointerInput2[NativePointerInput2.MiddleClick=3]="MiddleClick",NativePointerInput2[NativePointerInput2.RightClick=4]="RightClick",NativePointerInput2[NativePointerInput2.BrowserBack=5]="BrowserBack",NativePointerInput2[NativePointerInput2.BrowserForward=6]="BrowserForward",NativePointerInput2[NativePointerInput2.MouseWheelX=7]="MouseWheelX",NativePointerInput2[NativePointerInput2.MouseWheelY=8]="MouseWheelY",NativePointerInput2[NativePointerInput2.MouseWheelZ=9]="MouseWheelZ",NativePointerInput2[NativePointerInput2.DeltaHorizontal=10]="DeltaHorizontal",NativePointerInput2[NativePointerInput2.DeltaVertical=11]="DeltaVertical",DualShockInput2=DualShockInput||(DualShockInput={}),DualShockInput2[DualShockInput2.Cross=0]="Cross",DualShockInput2[DualShockInput2.Circle=1]="Circle",DualShockInput2[DualShockInput2.Square=2]="Square",DualShockInput2[DualShockInput2.Triangle=3]="Triangle",DualShockInput2[DualShockInput2.L1=4]="L1",DualShockInput2[DualShockInput2.R1=5]="R1",DualShockInput2[DualShockInput2.L2=6]="L2",DualShockInput2[DualShockInput2.R2=7]="R2",DualShockInput2[DualShockInput2.Share=8]="Share",DualShockInput2[DualShockInput2.Options=9]="Options",DualShockInput2[DualShockInput2.L3=10]="L3",DualShockInput2[DualShockInput2.R3=11]="R3",DualShockInput2[DualShockInput2.DPadUp=12]="DPadUp",DualShockInput2[DualShockInput2.DPadDown=13]="DPadDown",DualShockInput2[DualShockInput2.DPadLeft=14]="DPadLeft",DualShockInput2[DualShockInput2.DPadRight=15]="DPadRight",DualShockInput2[DualShockInput2.Home=16]="Home",DualShockInput2[DualShockInput2.TouchPad=17]="TouchPad",DualShockInput2[DualShockInput2.LStickXAxis=18]="LStickXAxis",DualShockInput2[DualShockInput2.LStickYAxis=19]="LStickYAxis",DualShockInput2[DualShockInput2.RStickXAxis=20]="RStickXAxis",DualShockInput2[DualShockInput2.RStickYAxis=21]="RStickYAxis",DualSenseInput2=DualSenseInput||(DualSenseInput={}),DualSenseInput2[DualSenseInput2.Cross=0]="Cross",DualSenseInput2[DualSenseInput2.Circle=1]="Circle",DualSenseInput2[DualSenseInput2.Square=2]="Square",DualSenseInput2[DualSenseInput2.Triangle=3]="Triangle",DualSenseInput2[DualSenseInput2.L1=4]="L1",DualSenseInput2[DualSenseInput2.R1=5]="R1",DualSenseInput2[DualSenseInput2.L2=6]="L2",DualSenseInput2[DualSenseInput2.R2=7]="R2",DualSenseInput2[DualSenseInput2.Create=8]="Create",DualSenseInput2[DualSenseInput2.Options=9]="Options",DualSenseInput2[DualSenseInput2.L3=10]="L3",DualSenseInput2[DualSenseInput2.R3=11]="R3",DualSenseInput2[DualSenseInput2.DPadUp=12]="DPadUp",DualSenseInput2[DualSenseInput2.DPadDown=13]="DPadDown",DualSenseInput2[DualSenseInput2.DPadLeft=14]="DPadLeft",DualSenseInput2[DualSenseInput2.DPadRight=15]="DPadRight",DualSenseInput2[DualSenseInput2.Home=16]="Home",DualSenseInput2[DualSenseInput2.TouchPad=17]="TouchPad",DualSenseInput2[DualSenseInput2.LStickXAxis=18]="LStickXAxis",DualSenseInput2[DualSenseInput2.LStickYAxis=19]="LStickYAxis",DualSenseInput2[DualSenseInput2.RStickXAxis=20]="RStickXAxis",DualSenseInput2[DualSenseInput2.RStickYAxis=21]="RStickYAxis",XboxInput2=XboxInput||(XboxInput={}),XboxInput2[XboxInput2.A=0]="A",XboxInput2[XboxInput2.B=1]="B",XboxInput2[XboxInput2.X=2]="X",XboxInput2[XboxInput2.Y=3]="Y",XboxInput2[XboxInput2.LB=4]="LB",XboxInput2[XboxInput2.RB=5]="RB",XboxInput2[XboxInput2.LT=6]="LT",XboxInput2[XboxInput2.RT=7]="RT",XboxInput2[XboxInput2.Back=8]="Back",XboxInput2[XboxInput2.Start=9]="Start",XboxInput2[XboxInput2.LS=10]="LS",XboxInput2[XboxInput2.RS=11]="RS",XboxInput2[XboxInput2.DPadUp=12]="DPadUp",XboxInput2[XboxInput2.DPadDown=13]="DPadDown",XboxInput2[XboxInput2.DPadLeft=14]="DPadLeft",XboxInput2[XboxInput2.DPadRight=15]="DPadRight",XboxInput2[XboxInput2.Home=16]="Home",XboxInput2[XboxInput2.LStickXAxis=17]="LStickXAxis",XboxInput2[XboxInput2.LStickYAxis=18]="LStickYAxis",XboxInput2[XboxInput2.RStickXAxis=19]="RStickXAxis",XboxInput2[XboxInput2.RStickYAxis=20]="RStickYAxis",SwitchInput2=SwitchInput||(SwitchInput={}),SwitchInput2[SwitchInput2.B=0]="B",SwitchInput2[SwitchInput2.A=1]="A",SwitchInput2[SwitchInput2.Y=2]="Y",SwitchInput2[SwitchInput2.X=3]="X",SwitchInput2[SwitchInput2.L=4]="L",SwitchInput2[SwitchInput2.R=5]="R",SwitchInput2[SwitchInput2.ZL=6]="ZL",SwitchInput2[SwitchInput2.ZR=7]="ZR",SwitchInput2[SwitchInput2.Minus=8]="Minus",SwitchInput2[SwitchInput2.Plus=9]="Plus",SwitchInput2[SwitchInput2.LS=10]="LS",SwitchInput2[SwitchInput2.RS=11]="RS",SwitchInput2[SwitchInput2.DPadUp=12]="DPadUp",SwitchInput2[SwitchInput2.DPadDown=13]="DPadDown",SwitchInput2[SwitchInput2.DPadLeft=14]="DPadLeft",SwitchInput2[SwitchInput2.DPadRight=15]="DPadRight",SwitchInput2[SwitchInput2.Home=16]="Home",SwitchInput2[SwitchInput2.Capture=17]="Capture",SwitchInput2[SwitchInput2.LStickXAxis=18]="LStickXAxis",SwitchInput2[SwitchInput2.LStickYAxis=19]="LStickYAxis",SwitchInput2[SwitchInput2.RStickXAxis=20]="RStickXAxis",SwitchInput2[SwitchInput2.RStickYAxis=21]="RStickYAxis",DeviceInputEventType2=DeviceInputEventType||(DeviceInputEventType={}),DeviceInputEventType2[DeviceInputEventType2.PointerMove=0]="PointerMove",DeviceInputEventType2[DeviceInputEventType2.PointerDown=1]="PointerDown",DeviceInputEventType2[DeviceInputEventType2.PointerUp=2]="PointerUp";var EventConstants=class{};EventConstants.DOM_DELTA_PIXEL=0,EventConstants.DOM_DELTA_LINE=1,EventConstants.DOM_DELTA_PAGE=2;var DeviceEventFactory=class{static _CreateKeyboardEvent(e,t,i,a){const n=this._CreateEvent(a);return this._CheckNonCharacterKeys(n,i),n.deviceType=DeviceType.Keyboard,n.deviceSlot=0,n.inputIndex=e,n.type=1===t?"keydown":"keyup",n.key=String.fromCharCode(e),n.keyCode=e,n}static _CreateMouseEvent(e,t,i,a,n,s){const r=this._CreateEvent(s),o=n.pollInput(e,t,PointerInput.Horizontal),l=n.pollInput(e,t,PointerInput.Vertical);return s?(r.movementX=0,r.movementY=0,r.offsetX=r.movementX-s.getBoundingClientRect().x,r.offsetY=r.movementY-s.getBoundingClientRect().y):(r.movementX=n.pollInput(e,t,10),r.movementY=n.pollInput(e,t,11),r.offsetX=0,r.offsetY=0),this._CheckNonCharacterKeys(r,n),r.clientX=o,r.clientY=l,r.x=o,r.y=l,r.deviceType=e,r.deviceSlot=t,r.inputIndex=i,r}static _CreatePointerEvent(e,t,i,a,n,s,r){const o=this._CreateMouseEvent(e,t,i,a,n,s);e===DeviceType.Mouse?(o.deviceType=DeviceType.Mouse,o.pointerId=1,o.pointerType="mouse"):(o.deviceType=DeviceType.Touch,o.pointerId=r??t,o.pointerType="touch");let l=0;return l+=n.pollInput(e,t,PointerInput.LeftClick),l+=2*n.pollInput(e,t,PointerInput.RightClick),l+=4*n.pollInput(e,t,PointerInput.MiddleClick),o.buttons=l,i===PointerInput.Move?o.type="pointermove":i>=PointerInput.LeftClick&&i<=PointerInput.RightClick&&(o.type=1===a?"pointerdown":"pointerup",o.button=i-2),o}static _CreateEvent(e){const t={preventDefault:()=>{}};return t.target=e,t}static _CreateWheelEvent(e,t,i,a,n,s){const r=this._CreateMouseEvent(e,t,i,a,n,s);switch(r.pointerId=1,r.type="wheel",r.deltaMode=EventConstants.DOM_DELTA_PIXEL,r.deltaX=0,r.deltaY=0,r.deltaZ=0,i){case PointerInput.MouseWheelX:r.deltaX=a;break;case PointerInput.MouseWheelY:r.deltaY=a;break;case PointerInput.MouseWheelZ:r.deltaZ=a}return r}static _CheckNonCharacterKeys(e,t){const i=t.isDeviceAvailable(DeviceType.Keyboard),a=i&&1===t.pollInput(DeviceType.Keyboard,0,18),n=i&&1===t.pollInput(DeviceType.Keyboard,0,17),s=i&&(1===t.pollInput(DeviceType.Keyboard,0,91)||1===t.pollInput(DeviceType.Keyboard,0,92)||1===t.pollInput(DeviceType.Keyboard,0,93)),r=i&&1===t.pollInput(DeviceType.Keyboard,0,16);e.altKey=a,e.ctrlKey=n,e.metaKey=s,e.shiftKey=r}static CreateDeviceEvent(e,t,i,a,n,s,r){switch(e){case DeviceType.Keyboard:return this._CreateKeyboardEvent(i,a,n,s);case DeviceType.Mouse:if(i===PointerInput.MouseWheelX||i===PointerInput.MouseWheelY||i===PointerInput.MouseWheelZ)return this._CreateWheelEvent(e,t,i,a,n,s);case DeviceType.Touch:return this._CreatePointerEvent(e,t,i,a,n,s,r);default:throw`Unable to generate event for device ${DeviceType[e]}`}}},NativeDeviceInputSystem=class{dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}pollInput(e,t,i){return this._nativeInput.pollInput(e,t,i)}isDeviceAvailable(e){return e===DeviceType.Mouse||e===DeviceType.Touch}constructor(e,t,i){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,((e,t,a,n)=>{const s=DeviceEventFactory.CreateDeviceEvent(e,t,a,n,this);i(e,t,s)})):this._createDummyNativeInput()}},MAX_KEYCODES=255,MAX_POINTER_INPUTS=Object.keys(PointerInput).length/2,WebDeviceInputSystem=class{_enableEvents(){const e=this?._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs)for(const e of this._inputs)if(e)for(const t in e){const i=e[+t];if(i)for(let e=0;e<i.length;e++)i[e]=0}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}isDeviceAvailable(e){return void 0!==this._inputs[e]}_addPointerDevice(e,t,i,a){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,MAX_POINTER_INPUTS);const n=this._inputs[e][t];n[0]=i,n[1]=a}_addGamePad(e){const t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t}_getGamepadDeviceType(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?DeviceType.DualSense:DeviceType.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?DeviceType.Xbox:-1!==e.indexOf("057e")?DeviceType.Switch:DeviceType.Generic}_handleGamepadActions(){this._gamepadConnectedEvent=e=>{this._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=e=>{if(this._gamepads){const t=this._getGamepadDeviceType(e.gamepad.id),i=e.gamepad.index;this._unregisterDevice(t,i),delete this._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_checkForConnectedDevices(){if(navigator.getGamepads){const e=navigator.getGamepads();for(const t of e)t&&this._addGamePad(t)}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(DeviceType.Mouse,0,0,0)}_registerDevice(e,t,i){if(void 0===t)throw`Unable to register device ${DeviceType[e]} to undefined slot.`;if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){const a=new Array(i);a.fill(0),this._inputs[e][t]=a,this._onDeviceConnected(e,t)}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_updateDevice(e,t,i){const a=navigator.getGamepads()[t];if(a&&e===this._gamepads[t]){const n=this._inputs[e][t];i>=a.buttons.length?n[i]=a.axes[i-a.buttons.length].valueOf():n[i]=a.buttons[i].value}}pollInput(e,t,i){const a=this._inputs[e][t];if(!a)throw`Unable to find device ${DeviceType[e]}`;e>=DeviceType.DualShock&&e<=DeviceType.DualSense&&this._updateDevice(e,t,i);const n=a[i];if(void 0===n)throw`Unable to find input ${i} for device ${DeviceType[e]} in slot ${t}`;return i===PointerInput.Move&&Tools.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),n}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_handleKeyActions(){this._keyboardDownEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(DeviceType.Keyboard,0,MAX_KEYCODES));const t=this._inputs[DeviceType.Keyboard][0];if(t){t[e.keyCode]=1;const i=e;i.inputIndex=e.keyCode,this._usingMacOS&&e.metaKey&&"Meta"!==e.key&&(this._metaKeys.includes(e.keyCode)||this._metaKeys.push(e.keyCode)),this._onInputChanged(DeviceType.Keyboard,0,i)}},this._keyboardUpEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(DeviceType.Keyboard,0,MAX_KEYCODES));const t=this._inputs[DeviceType.Keyboard][0];if(t){t[e.keyCode]=0;const i=e;if(i.inputIndex=e.keyCode,this._usingMacOS&&"Meta"===e.key&&this._metaKeys.length>0){for(const e of this._metaKeys){const i=DeviceEventFactory.CreateDeviceEvent(DeviceType.Keyboard,0,e,0,this,this._elementToAttachTo);t[e]=0,this._onInputChanged(DeviceType.Keyboard,0,i)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(DeviceType.Keyboard,0,i)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const e=this._inputs[DeviceType.Keyboard][0];for(let t=0;t<e.length;t++)if(0!==e[t]){e[t]=0;const i=DeviceEventFactory.CreateDeviceEvent(DeviceType.Keyboard,0,t,0,this,this._elementToAttachTo);this._onInputChanged(DeviceType.Keyboard,0,i)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}constructor(e,t,i,a){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=Tools.IsSafari(),this._usingMacOS=IsNavigatorAvailable()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=e=>{},this._keyboardUpEvent=e=>{},this._keyboardBlurEvent=e=>{},this._pointerMoveEvent=e=>{},this._pointerDownEvent=e=>{},this._pointerUpEvent=e=>{},this._pointerCancelEvent=e=>{},this._pointerWheelEvent=e=>{},this._pointerBlurEvent=e=>{},this._pointerMacOSChromeOutEvent=e=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=e=>{},this._gamepadDisconnectedEvent=e=>{},this._eventPrefix=Tools.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=a,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}_getPointerType(e){let t=DeviceType.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=DeviceType.Touch),t}_unregisterDevice(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}_handlePointerActions(){this._maxTouchPoints=IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let e=0;e<this._maxTouchPoints;e++)this._activeTouchIds[e]=-1;this._pointerMoveEvent=e=>{const t=this._getPointerType(e);let i=t===DeviceType.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===DeviceType.Touch&&-1===i){const a=this._activeTouchIds.indexOf(-1);if(!(a>=0))return void Tools.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);i=a,this._activeTouchIds[a]=e.pointerId,this._onDeviceConnected(t,i)}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]||this._addPointerDevice(t,i,e.clientX,e.clientY);const a=this._inputs[t][i];if(a){const n=e;n.inputIndex=PointerInput.Move,a[PointerInput.Horizontal]=e.clientX,a[PointerInput.Vertical]=e.clientY,t===DeviceType.Touch&&0===a[PointerInput.LeftClick]&&(a[PointerInput.LeftClick]=1),void 0===e.pointerId&&(e.pointerId=this._mouseId),this._onInputChanged(t,i,n),this._usingSafari||-1===e.button||(n.inputIndex=e.button+2,a[e.button+2]=a[e.button+2]?0:1,this._onInputChanged(t,i,n))}},this._pointerDownEvent=e=>{const t=this._getPointerType(e);let i=t===DeviceType.Mouse?0:e.pointerId;if(t===DeviceType.Touch){let t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t&&(t=this._activeTouchIds.indexOf(-1)),!(t>=0))return void Tools.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);i=t,this._activeTouchIds[t]=e.pointerId}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]?t===DeviceType.Touch&&this._onDeviceConnected(t,i):this._addPointerDevice(t,i,e.clientX,e.clientY);const a=this._inputs[t][i];if(a){const n=a[PointerInput.Horizontal],s=a[PointerInput.Vertical];if(t===DeviceType.Mouse){if(void 0===e.pointerId&&(e.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(e){}}else if(e.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(e.pointerId)}catch(e){}a[PointerInput.Horizontal]=e.clientX,a[PointerInput.Vertical]=e.clientY,a[e.button+2]=1;const r=e;r.inputIndex=e.button+2,this._onInputChanged(t,i,r),n===e.clientX&&s===e.clientY||(r.inputIndex=PointerInput.Move,this._onInputChanged(t,i,r))}},this._pointerUpEvent=e=>{const t=this._getPointerType(e),i=t===DeviceType.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===DeviceType.Touch){if(-1===i)return;this._activeTouchIds[i]=-1}const a=this._inputs[t]?.[i];if(a&&0!==a[e.button+2]){const n=a[PointerInput.Horizontal],s=a[PointerInput.Vertical];a[PointerInput.Horizontal]=e.clientX,a[PointerInput.Vertical]=e.clientY,a[e.button+2]=0;const r=e;void 0===e.pointerId&&(e.pointerId=this._mouseId),n===e.clientX&&s===e.clientY||(r.inputIndex=PointerInput.Move,this._onInputChanged(t,i,r)),r.inputIndex=e.button+2,t===DeviceType.Mouse&&this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):e.pointerId&&this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._onInputChanged(t,i,r),t===DeviceType.Touch&&this._onDeviceDisconnected(t,i)}},this._pointerCancelEvent=e=>{if("mouse"===e.pointerType){const e=this._inputs[DeviceType.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=PointerInput.LeftClick;t<=PointerInput.BrowserForward;t++)if(1===e[t]){e[t]=0;const i=DeviceEventFactory.CreateDeviceEvent(DeviceType.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(DeviceType.Mouse,0,i)}}else{const t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t)return;this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._inputs[DeviceType.Touch][t][PointerInput.LeftClick]=0;const i=DeviceEventFactory.CreateDeviceEvent(DeviceType.Touch,t,PointerInput.LeftClick,0,this,this._elementToAttachTo,e.pointerId);this._onInputChanged(DeviceType.Touch,t,i),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(DeviceType.Touch,t)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let e=!1;const t=function(){};try{const i=Object.defineProperty({},"passive",{get:function(){e=!0}});this._elementToAttachTo.addEventListener("test",t,i),this._elementToAttachTo.removeEventListener("test",t,i)}catch(e){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(DeviceType.Mouse)){const e=this._inputs[DeviceType.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=PointerInput.LeftClick;t<=PointerInput.BrowserForward;t++)if(1===e[t]){e[t]=0;const i=DeviceEventFactory.CreateDeviceEvent(DeviceType.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(DeviceType.Mouse,0,i)}}if(this.isDeviceAvailable(DeviceType.Touch)){const e=this._inputs[DeviceType.Touch];for(let t=0;t<this._activeTouchIds.length;t++){const i=this._activeTouchIds[t];if(this._elementToAttachTo.hasPointerCapture?.(i)&&this._elementToAttachTo.releasePointerCapture(i),-1!==i&&1===e[t]?.[PointerInput.LeftClick]){e[t][PointerInput.LeftClick]=0;const a=DeviceEventFactory.CreateDeviceEvent(DeviceType.Touch,t,PointerInput.LeftClick,0,this,this._elementToAttachTo,i);this._onInputChanged(DeviceType.Touch,t,a),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(DeviceType.Touch,t)}}}},this._pointerWheelEvent=e=>{const t=DeviceType.Mouse;this._inputs[t]||(this._inputs[t]=[]),this._inputs[t][0]||(this._pointerActive=!0,this._registerDevice(t,0,MAX_POINTER_INPUTS));const i=this._inputs[t][0];if(i){i[PointerInput.MouseWheelX]=e.deltaX||0,i[PointerInput.MouseWheelY]=e.deltaY||e.wheelDelta||0,i[PointerInput.MouseWheelZ]=e.deltaZ||0;const a=e;void 0===e.pointerId&&(e.pointerId=this._mouseId),0!==i[PointerInput.MouseWheelX]&&(a.inputIndex=PointerInput.MouseWheelX,this._onInputChanged(t,0,a)),0!==i[PointerInput.MouseWheelY]&&(a.inputIndex=PointerInput.MouseWheelY,this._onInputChanged(t,0,a)),0!==i[PointerInput.MouseWheelZ]&&(a.inputIndex=PointerInput.MouseWheelZ,this._onInputChanged(t,0,a))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=e=>{e.buttons>1&&this._pointerCancelEvent(e)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!e&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(DeviceType.Mouse)){const e=this._inputs[DeviceType.Mouse][0];e[PointerInput.MouseWheelX]=0,e[PointerInput.MouseWheelY]=0,e[PointerInput.MouseWheelZ]=0}}))}},DeviceSource=class{getInput(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}constructor(e,t,i=0){this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new Observable,this._deviceInputSystem=e}},InternalDeviceSourceManager=class{constructor(e){this._registeredManagers=new Array,this._refCount=0,this.registerManager=e=>{for(let t=0;t<this._devices.length;t++){const i=this._devices[t];for(const a in i){const i=+a;e._addDevice(new DeviceSource(this._deviceInputSystem,t,i))}}this._registeredManagers.push(e)},this.unregisterManager=e=>{const t=this._registeredManagers.indexOf(e);t>-1&&this._registeredManagers.splice(t,1)};const t=Object.keys(DeviceType).length/2;this._devices=new Array(t);const i=(e,t)=>{this._devices[e]||(this._devices[e]=new Array),this._devices[e][t]||(this._devices[e][t]=t);for(const i of this._registeredManagers){const a=new DeviceSource(this._deviceInputSystem,e,t);i._addDevice(a)}},a=(e,t)=>{this._devices[e]?.[t]&&delete this._devices[e][t];for(const i of this._registeredManagers)i._removeDevice(e,t)},n=(e,t,i)=>{if(i)for(const a of this._registeredManagers)a._onInputChanged(e,t,i)};"undefined"!=typeof _native?this._deviceInputSystem=new NativeDeviceInputSystem(i,a,n):this._deviceInputSystem=new WebDeviceInputSystem(e,i,a,n)}dispose(){this._deviceInputSystem.dispose()}},DeviceSourceManager=class{_addDevice(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}getDeviceSources(e){return this._devices[e]?this._devices[e].filter((e=>!!e)):[]}constructor(e){const t=Object.keys(DeviceType).length/2;this._devices=new Array(t),this._firstDevice=new Array(t),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new InternalDeviceSourceManager(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new Observable((e=>{for(const t of this._devices)if(t)for(const i of t)i&&this.onDeviceConnectedObservable.notifyObserver(e,i)})),this.onDeviceDisconnectedObservable=new Observable,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add((()=>{this.dispose()}))}_onInputChanged(e,t,i){this._devices[e]?.[t]?.onInputChangedObservable.notifyObservers(i)}_updateFirstDevices(e){switch(e){case DeviceType.Keyboard:case DeviceType.Mouse:this._firstDevice[e]=0;break;case DeviceType.Touch:case DeviceType.DualSense:case DeviceType.DualShock:case DeviceType.Xbox:case DeviceType.Switch:case DeviceType.Generic:{delete this._firstDevice[e];const t=this._devices[e];if(t)for(let i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}break}}}_removeDevice(e,t){const i=this._devices[e]?.[t];this.onDeviceDisconnectedObservable.notifyObservers(i),this._devices[e]?.[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}getDeviceSource(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null}},_ClickInfo=class{set ignore(e){this._ignore=e}get doubleClick(){return this._doubleClick}get ignore(){return this._ignore}get singleClick(){return this._singleClick}set doubleClick(e){this._doubleClick=e}constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}set hasSwiped(e){this._hasSwiped=e}set singleClick(e){this._singleClick=e}get hasSwiped(){return this._hasSwiped}},InputManager=class e{simulatePointerUp(e,t,i){const a=new PointerEvent("pointerup",t);a.inputIndex=PointerInput.Move;const n=new _ClickInfo;i?n.doubleClick=!0:n.singleClick=!0,this._checkPrePointerObservable(e,a,PointerEventTypes.POINTERUP)||this._processPointerUp(e,a,n)}_setCursorAndPointerOverMesh(e,t,i){const a=i.getEngine().getInputElement();if(e?.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,t.pointerId,e,t),!i.doNotHandleCursors&&a&&this._pointerOverMesh){const e=this._pointerOverMesh._getActionManagerForTrigger();e&&e.hasPointerTriggers&&(a.style.cursor=e.hoverCursor||i.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,e,t)}_updatePointerPosition(e){const t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}constructor(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new Vector2(0,0),this._previousStartingPointerPosition=new Vector2(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||EngineStore.LastCreatedScene,this._scene}_isPointerSwiping(){return this._isSwiping}simulatePointerDown(e,t){const i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,this._checkPrePointerObservable(e,i,PointerEventTypes.POINTERDOWN)||this._processPointerDown(e,i)}get unTranslatedPointer(){return new Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)}isPointerCaptured(e=0){return this._pointerCaptures[e]}attachControl(t=!0,i=!0,a=!0,n=null){const s=this._scene,r=s.getEngine();n||(n=r.getInputElement()),this._alreadyAttached&&this.detachControl(),n&&(this._alreadyAttachedTo=n),this._deviceSourceManager=new DeviceSourceManager(r),this._initActionManager=e=>{if(!this._meshPickProceed){const t=s.skipPointerUpPicking||0===s._registeredActions&&!this._checkForPicking()&&!s.onPointerUp?null:s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,s.pointerUpPredicate,s.pointerUpFastCheck,s.cameraToUseForPointers,s.pointerUpTrianglePredicate);this._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return e},this._delayedSimpleClick=(t,i,a)=>{if((Date.now()-this._previousStartingPointerTime>e.DoubleClickDelay&&!this._doubleClickOccured||t!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,this._delayedClicks[t])){const e=this._delayedClicks[t].evt,i=PointerEventTypes.POINTERTAP,a=new PointerInfo(i,e,this._currentPickResult);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(i)&&s.onPointerObservable.notifyObservers(a,i),this._delayedClicks[t]=null}},this._initClickEvent=(t,i,a,n)=>{const s=new _ClickInfo;this._currentPickResult=null;let r=null,o=t.hasSpecificMask(PointerEventTypes.POINTERPICK)||i.hasSpecificMask(PointerEventTypes.POINTERPICK)||t.hasSpecificMask(PointerEventTypes.POINTERTAP)||i.hasSpecificMask(PointerEventTypes.POINTERTAP)||t.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)||i.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP);!o&&AbstractActionManager&&(r=this._initActionManager(r,s),r&&(o=r.hasPickTriggers));let l=!1;if(o){const o=a.button;if(s.hasSwiped=this._isPointerSwiping(),!s.hasSwiped){let c=!e.ExclusiveDoubleClickMode;if(c||(c=!t.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)&&!i.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP),c&&!AbstractActionManager.HasSpecificTrigger(6)&&(r=this._initActionManager(r,s),r&&(c=!r.hasSpecificTrigger(6)))),c)(Date.now()-this._previousStartingPointerTime>e.DoubleClickDelay||o!==this._previousButtonPressed)&&(s.singleClick=!0,n(s,this._currentPickResult),l=!0);else{const t={evt:a,clickInfo:s,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,o,s,n),e.DoubleClickDelay)};this._delayedClicks[o]=t}let h=t.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)||i.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP);!h&&AbstractActionManager.HasSpecificTrigger(6)&&(r=this._initActionManager(r,s),r&&(h=r.hasSpecificTrigger(6))),h&&(o===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<e.DoubleClickDelay&&!this._doubleClickOccured?(s.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=o,e.ExclusiveDoubleClickMode?(this._delayedClicks[o]&&(clearTimeout(this._delayedClicks[o]?.timeoutId),this._delayedClicks[o]=null),n(s,this._previousPickResult)):n(s,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,s.doubleClick=!0,s.ignore=!1,e.ExclusiveDoubleClickMode&&this._delayedClicks[o]&&(clearTimeout(this._delayedClicks[o]?.timeoutId),this._delayedClicks[o]=null),n(s,this._currentPickResult)),l=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=o))}}l||n(s,this._currentPickResult)},this._onPointerMove=t=>{if(this._updatePointerPosition(t),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold),r.isPointerLock&&r._verifyPointerLock(),this._checkPrePointerObservable(null,t,t.inputIndex>=PointerInput.MouseWheelX&&t.inputIndex<=PointerInput.MouseWheelZ?PointerEventTypes.POINTERWHEEL:PointerEventTypes.POINTERMOVE))return;if(!s.cameraToUseForPointers&&!s.activeCamera)return;if(s.skipPointerMovePicking)return void this._processPointerMove(new PickingInfo,t);s.pointerMovePredicate||(s.pointerMovePredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||s.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!s.cameraToUseForPointers||!!(s.cameraToUseForPointers.layerMask&e.layerMask)));const i=s._registeredActions>0||s.constantlyUpdateMeshUnderPointer?this._pickMove(t):null;this._processPointerMove(i,t)},this._onPointerDown=t=>{if(this._totalPointersPressed++,this._pickedDownMesh=null,this._meshPickProceed=!1,e.ExclusiveDoubleClickMode)for(let e=0;e<this._delayedClicks.length;e++)if(this._delayedClicks[e])if(t.button===e)clearTimeout(this._delayedClicks[e]?.timeoutId);else{const t=this._delayedClicks[e].clickInfo;this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1;const i=this._delayedClicks[e].evt,a=PointerEventTypes.POINTERTAP,n=new PointerInfo(a,i,this._currentPickResult);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(a)&&s.onPointerObservable.notifyObservers(n,a),this._delayedClicks[e]=null}if(this._updatePointerPosition(t),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=t.button),s.preventDefaultOnPointerDown&&n&&(t.preventDefault(),n.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,t,PointerEventTypes.POINTERDOWN))return;if(!s.cameraToUseForPointers&&!s.activeCamera)return;let i;this._pointerCaptures[t.pointerId]=!0,s.pointerDownPredicate||(s.pointerDownPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!s.cameraToUseForPointers||!!(s.cameraToUseForPointers.layerMask&e.layerMask))),this._pickedDownMesh=null,i=s.skipPointerDownPicking||0===s._registeredActions&&!this._checkForPicking()&&!s.onPointerDown?new PickingInfo:s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,s.pointerDownPredicate,s.pointerDownFastCheck,s.cameraToUseForPointers,s.pointerDownTrianglePredicate),this._processPointerDown(i,t)},this._onPointerUp=e=>{0!==this._totalPointersPressed&&(this._totalPointersPressed--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(e),s.preventDefaultOnPointerUp&&n&&(e.preventDefault(),n.focus()),this._initClickEvent(s.onPrePointerObservable,s.onPointerObservable,e,((t,i)=>{if(s.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!t.ignore)){if(this._checkPrePointerObservable(null,e,PointerEventTypes.POINTERUP))return this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1));t.hasSwiped||(t.singleClick&&s.onPrePointerObservable.hasSpecificMask(PointerEventTypes.POINTERTAP)&&this._checkPrePointerObservable(null,e,PointerEventTypes.POINTERTAP)&&(this._skipPointerTap=!0),t.doubleClick&&s.onPrePointerObservable.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,e,PointerEventTypes.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[e.pointerId]?(0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1),(s.cameraToUseForPointers||s.activeCamera)&&(s.pointerUpPredicate||(s.pointerUpPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!s.cameraToUseForPointers||!!(s.cameraToUseForPointers.layerMask&e.layerMask))),!this._meshPickProceed&&(AbstractActionManager&&AbstractActionManager.HasTriggers||this._checkForPicking()||s.onPointerUp)&&this._initActionManager(null,t),i||(i=this._currentPickResult),this._processPointerUp(i,e,t),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=e=>{const t=KeyboardEventTypes.KEYDOWN;if(s.onPreKeyboardObservable.hasObservers()){const i=new KeyboardInfoPre(t,e);if(s.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(s.onKeyboardObservable.hasObservers()){const i=new KeyboardInfo(t,e);s.onKeyboardObservable.notifyObservers(i,t)}s.actionManager&&s.actionManager.processTrigger(14,ActionEvent.CreateNewFromScene(s,e))},this._onKeyUp=e=>{const t=KeyboardEventTypes.KEYUP;if(s.onPreKeyboardObservable.hasObservers()){const i=new KeyboardInfoPre(t,e);if(s.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(s.onKeyboardObservable.hasObservers()){const i=new KeyboardInfo(t,e);s.onKeyboardObservable.notifyObservers(i,t)}s.actionManager&&s.actionManager.processTrigger(15,ActionEvent.CreateNewFromScene(s,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((e=>{e.deviceType===DeviceType.Mouse?e.onInputChangedObservable.add((n=>{this._originMouseEvent=n,n.inputIndex===PointerInput.LeftClick||n.inputIndex===PointerInput.MiddleClick||n.inputIndex===PointerInput.RightClick||n.inputIndex===PointerInput.BrowserBack||n.inputIndex===PointerInput.BrowserForward?i&&1===e.getInput(n.inputIndex)?this._onPointerDown(n):t&&0===e.getInput(n.inputIndex)&&this._onPointerUp(n):a&&(n.inputIndex===PointerInput.Move?this._onPointerMove(n):n.inputIndex!==PointerInput.MouseWheelX&&n.inputIndex!==PointerInput.MouseWheelY&&n.inputIndex!==PointerInput.MouseWheelZ||this._onPointerMove(n))})):e.deviceType===DeviceType.Touch?e.onInputChangedObservable.add((n=>{n.inputIndex===PointerInput.LeftClick&&(i&&1===e.getInput(n.inputIndex)?(this._onPointerDown(n),this._totalPointersPressed>1&&(this._isMultiTouchGesture=!0)):t&&0===e.getInput(n.inputIndex)&&(this._onPointerUp(n),0===this._totalPointersPressed&&(this._isMultiTouchGesture=!1))),a&&n.inputIndex===PointerInput.Move&&this._onPointerMove(n)})):e.deviceType===DeviceType.Keyboard&&e.onInputChangedObservable.add((e=>{"keydown"===e.type?this._onKeyDown(e):"keyup"===e.type&&this._onKeyUp(e)}))})),this._alreadyAttached=!0}_processPointerMove(e,t){const i=this._scene,a=i.getEngine(),n=a.getInputElement();n&&(n.tabIndex=a.canvasTabIndex,i.doNotHandleCursors||(n.style.cursor=i.defaultCursor)),this._setCursorAndPointerOverMesh(e,t,i);for(const a of i._pointerMoveStage){e=e||this._pickMove(t);const i=!!e?.pickedMesh;e=a.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,n)}const s=t.inputIndex>=PointerInput.MouseWheelX&&t.inputIndex<=PointerInput.MouseWheelZ?PointerEventTypes.POINTERWHEEL:PointerEventTypes.POINTERMOVE;let r;i.onPointerMove&&(e=e||this._pickMove(t),i.onPointerMove(t,e,s)),e?(r=new PointerInfo(s,t,e),this._setRayOnPointerInfo(e,t)):(r=new PointerInfo(s,t,null,this),this._movePointerInfo=r),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(r,s)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}_invalidateMesh(e){this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null);for(const t in this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}_checkPrePointerObservable(e,t,i){const a=this._scene,n=new PointerInfoPre(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(n.originalPickingInfo=e,n.ray=e.ray,"xr-near"===t.pointerType&&e.originMesh&&(n.nearInteractionPickingInfo=e)),a.onPrePointerObservable.notifyObservers(n,i),!!n.skipOnPointerObservable}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_pickMove(e){const t=this._scene,i=t.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(i,e,t),i}_processPointerUp(e,t,i){const a=this._scene;if(e?.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(a.onPointerPick&&a.onPointerPick(t,e),i.singleClick&&!i.ignore&&a.onPointerObservable.observers.length>this._cameraObserverCount)){const i=PointerEventTypes.POINTERPICK,n=new PointerInfo(i,t,e);this._setRayOnPointerInfo(e,t),a.onPointerObservable.notifyObservers(n,i)}const n=e.pickedMesh._getActionManagerForTrigger();if(n&&!i.ignore){n.processTrigger(7,ActionEvent.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&n.processTrigger(1,ActionEvent.CreateNew(e.pickedMesh,t,e));const a=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&a&&a.processTrigger(6,ActionEvent.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(const n of a._pointerUpStage)e=n.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,i.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const e=this._pickedDownMesh._getActionManagerForTrigger(16);e&&e.processTrigger(16,ActionEvent.CreateNew(this._pickedDownMesh,t))}if(!i.ignore){const n=new PointerInfo(PointerEventTypes.POINTERUP,t,e);if(this._setRayOnPointerInfo(e,t),a.onPointerObservable.notifyObservers(n,PointerEventTypes.POINTERUP),a.onPointerUp&&a.onPointerUp(t,e,PointerEventTypes.POINTERUP),!i.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let n=0;if(i.singleClick?n=PointerEventTypes.POINTERTAP:i.doubleClick&&(n=PointerEventTypes.POINTERDOUBLETAP),n){const i=new PointerInfo(n,t,e);a.onPointerObservable.hasObservers()&&a.onPointerObservable.hasSpecificMask(n)&&a.onPointerObservable.notifyObservers(i,n)}}}}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}set pointerX(e){this._pointerX=e}get pointerX(){return this._pointerX}setPointerOverMesh(e,t=0,i,a){if(!(this._meshUnderPointerId[t]!==e||e&&e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const n=this._meshUnderPointerId[t];let s;n&&(s=n._getActionManagerForTrigger(10),s&&s.processTrigger(10,ActionEvent.CreateNew(n,a,{pointerId:t}))),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,s=e._getActionManagerForTrigger(9),s&&s.processTrigger(9,ActionEvent.CreateNew(e,a,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}get pointerY(){return this._pointerY}_setRayOnPointerInfo(e,t){const i=this._scene;e&&i._pickingAvailable&&(e.ray||(e.ray=i.createPickingRay(t.offsetX,t.offsetY,Matrix.Identity(),i.activeCamera)))}set pointerY(e){this._pointerY=e}_processPointerDown(t,i){const a=this._scene;if(t?.pickedMesh){this._pickedDownMesh=t.pickedMesh;const n=t.pickedMesh._getActionManagerForTrigger();if(n){if(n.hasPickTriggers)switch(n.processTrigger(5,ActionEvent.CreateNew(t.pickedMesh,i,t)),i.button){case 0:n.processTrigger(2,ActionEvent.CreateNew(t.pickedMesh,i,t));break;case 1:n.processTrigger(4,ActionEvent.CreateNew(t.pickedMesh,i,t));break;case 2:n.processTrigger(3,ActionEvent.CreateNew(t.pickedMesh,i,t))}n.hasSpecificTrigger(8)&&window.setTimeout((()=>{const t=a.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,(e=>e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===this._pickedDownMesh),!1,a.cameraToUseForPointers);t?.pickedMesh&&n&&0!==this._totalPointersPressed&&Date.now()-this._startingPointerTime>e.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,n.processTrigger(8,ActionEvent.CreateNew(t.pickedMesh,i)))}),e.LongPressDelay)}}else for(const e of a._pointerDownStage)t=e.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,i,!1);let n;const s=PointerEventTypes.POINTERDOWN;t?(a.onPointerDown&&a.onPointerDown(i,t,s),n=new PointerInfo(s,i,t),this._setRayOnPointerInfo(t,i)):n=new PointerInfo(s,i,null,this),a.onPointerObservable.hasObservers()&&a.onPointerObservable.notifyObservers(n,s)}simulatePointerMove(e,t){const i=new PointerEvent("pointermove",t);i.inputIndex=PointerInput.Move,this._checkPrePointerObservable(e,i,PointerEventTypes.POINTERMOVE)||this._processPointerMove(e,i)}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}_addCameraPointerObserver(e,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,t)}};InputManager.DragMovementThreshold=10,InputManager.LongPressDelay=500,InputManager.DoubleClickDelay=300,InputManager.ExclusiveDoubleClickMode=!1;var PointerPickingConfiguration=class{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}},ScenePerformancePriority,ScenePerformancePriority2;ScenePerformancePriority2=ScenePerformancePriority||(ScenePerformancePriority={}),ScenePerformancePriority2[ScenePerformancePriority2.BackwardCompatible=0]="BackwardCompatible",ScenePerformancePriority2[ScenePerformancePriority2.Intermediate=1]="Intermediate",ScenePerformancePriority2[ScenePerformancePriority2.Aggressive=2]="Aggressive";var Scene=class e extends AbstractScene{getCachedMaterial(){return this._cachedMaterial}_activeMesh(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));let i=e.hasInstances||e.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh;if(t&&t.subMeshes&&t.subMeshes.length>0){const a=this.getActiveSubMeshCandidates(t),n=a.length;i=i||1===n;for(let s=0;s<n;s++){const n=a.data[s];this._evaluateSubMesh(n,t,e,i)}}}get animationPropertiesOverride(){return this._animationPropertiesOverride}pick(e,t,i,a,n,s){const r=_WarnImport("Ray",!0);return r&&Logger.Warn(r),new PickingInfo}_checkIntersections(){for(let e=0;e<this._meshesForIntersections.length;e++){const t=this._meshesForIntersections.data[e];if(t.actionManager)for(let e=0;t.actionManager&&e<t.actionManager.actions.length;e++){const i=t.actionManager.actions[e];if(12===i.trigger||13===i.trigger){const e=i.getTriggerParameter(),a=e.mesh?e.mesh:e,n=a.intersectsMesh(t,e.usePreciseIntersection),s=t._intersectionsInProgress.indexOf(a);n&&-1===s?12===i.trigger?(i._executeCurrent(ActionEvent.CreateNew(t,void 0,a)),t._intersectionsInProgress.push(a)):13===i.trigger&&t._intersectionsInProgress.push(a):!n&&s>-1&&(13===i.trigger&&i._executeCurrent(ActionEvent.CreateNew(t,void 0,a)),t.actionManager.hasSpecificTrigger(13,(e=>{const t=e.mesh?e.mesh:e;return a===t}))&&13!==i.trigger||t._intersectionsInProgress.splice(s,1))}}}}getFrameId(){return this._frameId}addMorphTargetManager(e){this._blockEntityCollection||this.morphTargetManagers.push(e)}addParticleSystem(e){this._blockEntityCollection||this.particleSystems.push(e)}_advancePhysicsEngineStep(e){}removeExternalData(e){return this._externalData.remove(e)}getCameraByID(e){return this.getCameraById(e)}addLight(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(const t of this.meshes)-1===t.lightSources.indexOf(e)&&(t.lightSources.push(e),t._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(e)}}getTotalVertices(){return this._totalVertices.current}getBoneByID(e){return this.getBoneById(e)}removePendingData(e){const t=this.isLoading,i=this._pendingData.indexOf(e);-1!==i&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}get activeBonesPerfCounter(){return this._activeBones}pickWithRay(e,t,i,a){throw _WarnImport("Ray")}finalizeSceneUbo(){const e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e}_getByTags(e,t,i){if(void 0===t)return e;const a=[];for(const n in e){const s=e[n];Tags&&Tags.MatchesQuery(s,t)&&(!i||i(s))&&a.push(s)}return a}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}setSceneUniformBuffer(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}executeWhenReady(e,t=!1){this.onReadyObservable.addOnce(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)}getMeshById(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null}get _pickingAvailable(){return!1}unregisterAfterRender(e){this.onAfterRenderObservable.removeCallback(e)}get skipFrustumClipping(){return this._skipFrustumClipping}addMultiMaterial(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))}removeTransformNode(e){const t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){const e=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=e,e._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t}getMaterialByID(e){return this.getMaterialById(e)}addTransformNode(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))}clearCachedVertexData(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e].geometry;t&&t.clearCachedData()}}multiPickWithRay(e,t,i){throw _WarnImport("Ray")}getLightByID(e){return this.getLightById(e)}markAllMaterialsAsDirty(e,t){if(!this._blockMaterialDirtyMechanism)for(const i of this.materials)t&&!t(i)||i.markAsDirty(e)}addAnimation(e){this._blockEntityCollection||this.animations.push(e)}static set DragMovementThreshold(e){InputManager.DragMovementThreshold=e}unregisterBeforeRender(e){this.onBeforeRenderObservable.removeCallback(e)}freeProcessedMaterials(){this._processedMaterials.dispose()}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}getSkeletonById(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=e.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}getLastEntryById(e){let t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null}_loadFile(e,t,i,a,n,s,r){const o=LoadFile(e,t,i,a?this.offlineProvider:void 0,n,s,r);return this._activeRequests.push(o),o.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),o}getActiveIndices(){return this._activeIndices.current}static set ExclusiveDoubleClickMode(e){InputManager.ExclusiveDoubleClickMode=e}addMesh(e,t=!1){this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.addMesh(e)})))}unfreezeActiveMeshes(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this}_renderForCamera(e,t,i=!0){if(e&&e._skipRendering)return;const a=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(a.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&i){let t=!0;e._renderingMultiview&&e.outputRenderTarget&&(t=e.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=t)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let e=0;e<this._softwareSkinnedMeshes.length;e++){const t=this._softwareSkinnedMeshes.data[e];t.applySkeleton(t.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const e of this._gatherActiveCameraRenderTargetsStage)e.action(this._renderTargets);let n=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let e=0;e<this._renderTargets.length;e++){const t=this._renderTargets.data[e];if(t._shouldRender()){this._renderId++;const e=t.activeCamera&&t.activeCamera!==this.activeCamera;t.render(e,this.dumpNextRenderTargets),n=!0}}Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const e of this._cameraDrawRenderTargetStage)n=e.action(this.activeCamera)||n;this._intermediateRendering=!1}this._engine.currentRenderPassId=e.outputRenderTarget?.renderPassId??e.renderPassId??0,n&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const e of this._beforeCameraDrawStage)e.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),a.snapshotRendering&&1===a.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const e of this._afterCameraDrawStage)e.action(this.activeCamera);if(this.postProcessManager&&!e._multiviewTexture){const t=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,t)}for(const e of this._afterCameraPostProcessStage)e.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}unfreezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].unfreeze()}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=e=>this._getDefaultSubMeshCandidates(e),this.getIntersectingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e),this.getCollidingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e)}getMorphTargetById(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let t=0;t<i.numTargets;++t){const a=i.getTarget(t);if(a.id===e)return a}}return null}addCamera(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())}_evaluateSubMesh(e,t,i,a){if(a||e.isInFrustum(this._frustumPlanes)){for(const i of this._evaluateSubMeshStage)i.action(t,e);const i=e.getMaterial();null!=i&&(i.hasRenderTargetTextures&&null!=i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._materialsRenderTargets.concatWithNoDuplicate(i.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,i))}}getMeshesById(e){return this.meshes.filter((function(t){return t.id===e}))}getGeometryById(e){for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null}getWorldExtends(e){const t=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||(()=>!0),this.meshes.filter(e).forEach((e=>{if(e.computeWorldMatrix(!0),!e.subMeshes||0===e.subMeshes.length||e.infiniteDistance)return;const a=e.getBoundingInfo(),n=a.boundingBox.minimumWorld,s=a.boundingBox.maximumWorld;Vector3.CheckExtends(n,t,i),Vector3.CheckExtends(s,t,i)})),{min:t,max:i}}animate(){if(this._engine.isDeterministicLockStep()){let t=Math.max(e.MinDeltaTime,Math.min(this._engine.getDeltaTime(),e.MaxDeltaTime))+this._timeAccumulator;const i=this._engine.getTimeStep(),a=1e3/i/1e3;let n=0;const s=this._engine.getLockstepMaxSteps();let r=Math.floor(t/i);for(r=Math.min(r,s);t>0&&n<r;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=i*a,this._animate(i),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(i),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,n++,t-=i;this._timeAccumulator=t<0?0:t}else{const t=this.useConstantAnimationDeltaTime?16:Math.max(e.MinDeltaTime,Math.min(this._engine.getDeltaTime(),e.MaxDeltaTime));this._animationRatio=.06*t,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t)}}setTransformMatrix(e,t,i,a){i||a||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Frustum.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,a):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}getLastTransformNodeById(e){for(let t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getNodeById(e){const t=this.getMeshById(e);if(t)return t;const i=this.getTransformNodeById(e);if(i)return i;const a=this.getLightById(e);if(a)return a;const n=this.getCameraById(e);if(n)return n;const s=this.getBoneById(e);return s||null}isCachedMaterialInvalid(e,t,i=1){return this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i}switchActiveCamera(e,t=!0){this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())}set pointerUpPredicate(e){this._pointerPickingConfiguration.pointerUpPredicate=e}set skeletonsEnabled(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))}get lightsEnabled(){return this._lightsEnabled}getEngine(){return this._engine}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}set pointerMoveFastCheck(e){this._pointerPickingConfiguration.pointerMoveFastCheck=e}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set lightsEnabled(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))}_executeOnceBeforeRender(e){const t=()=>{e(),setTimeout((()=>{this.unregisterBeforeRender(t)}))};this.registerBeforeRender(t)}getExternalData(e){return this._externalData?this._externalData.get(e):null}_disposeList(e,t){const i=e.slice(0);t=t??(e=>e.dispose());for(const e of i)t(e);e.length=0}_registerTransientComponents(){if(this._transientComponents.length>0){for(const e of this._transientComponents)e.register();this._transientComponents.length=0}}getLastSkeletonById(e){for(let t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null}incrementRenderId(){this._renderId++}set pointerX(e){this._inputManager.pointerX=e}set afterCameraRender(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)}get totalActiveIndicesPerfCounter(){return this._activeIndices}render(e=!0,t=!1){if(this.isDisposed)return;this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),this.activeCameras?.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(const e of this._beforeCameraUpdateStage)e.action();if(e)if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];if(t.update(),0!==t.cameraRigMode)for(let e=0;e<t._rigCameras.length;e++)t._rigCameras[e].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let e=0;e<this.activeCamera._rigCameras.length;e++)this.activeCamera._rigCameras[e].update();this.onBeforeRenderObservable.notifyObservers(this);const i=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const a=this.activeCameras?.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let e=0;e<this.customRenderTargets.length;e++){const t=this.customRenderTargets[e];if(t._shouldRender()){if(this._renderId++,this.activeCamera=t.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");i.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),t.render(a!==this.activeCamera,this.dumpNextRenderTargets)}}Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=a?.renderPassId??0,this.activeCamera=a,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const e of this._beforeClearStage)e.action();this._clearFrameBuffer(this.activeCamera);for(const e of this._gatherRenderTargetsStage)e.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++)this._processSubCameras(this.activeCameras[e],e>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(const e of this._afterRenderStage)e.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let e=0;e<this._toBeDisposed.length;e++){const t=this._toBeDisposed[e];t&&t.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}getMeshesByID(e){return this.getMeshesById(e)}get totalVerticesPerfCounter(){return this._totalVertices}get defaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=e.DefaultMaterialFactory(this)),this._defaultMaterial}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}isPointerCaptured(e=0){return this._inputManager.isPointerCaptured(e)}get performancePriority(){return this._performancePriority}set skipPointerDownPicking(e){this._pointerPickingConfiguration.skipPointerDownPicking=e}static get LongPressDelay(){return InputManager.LongPressDelay}set beforeCameraRender(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)}set shadowsEnabled(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))}getPerfCollector(){throw _WarnImport("performanceViewerSceneExtension")}removeSkeleton(e){const t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t}removeTexture(e){const t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set useRightHandedSystem(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))}getActiveMeshes(){return this._activeMeshes}get texturesEnabled(){return this._texturesEnabled}set texturesEnabled(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))}getRenderId(){return this._renderId}_getDefaultSubMeshCandidates(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates}getTextureByUniqueID(e){return this.getTextureByUniqueId(e)}detachControl(){this._inputManager.detachControl()}removeAnimation(e){const t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t}getAutoClearDepthStencilSetup(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}get activeParticlesPerfCounter(){return this._activeParticles}freezeActiveMeshes(e=!1,t,i,a=!0,n=!1){return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=n,this._skipEvaluateActiveMeshesCompletely=e,a)for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._freeze();t&&t()}else i&&i("No active camera found")})),this}getCameraByUniqueId(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].Hc===e)return this.cameras[t];return null}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}static get DragMovementThreshold(){return InputManager.DragMovementThreshold}setPointerOverMesh(e,t,i){this._inputManager.setPointerOverMesh(e,t,i)}_readFile(e,t,i,a,n){const s=ReadFile(e,t,i,a,n);return this._activeRequests.push(s),s.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),s}setRenderingOrder(e,t=null,i=null,a=null){this._renderingManager.setRenderingOrder(e,t,i,a)}set blockfreeActiveMeshesAndRenderingGroups(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)}getMaterialById(e,t=!1){return this._getMaterial(t,(t=>t.id===e))}getTransformMatrix(){return this._transformMatrix}getBoneById(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let t=0;t<i.bones.length;t++)if(i.bones[t].id===e)return i.bones[t]}return null}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}getLightByUniqueID(e){return this.getLightByUniqueId(e)}pickWithBoundingInfo(e,t,i,a,n){const s=_WarnImport("Ray",!0);return s&&Logger.Warn(s),new PickingInfo}createPickingRay(e,t,i,a,n=!1){throw _WarnImport("Ray")}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}_getMaterial(e,t){for(let e=0;e<this.materials.length;e++){const i=this.materials[e];if(t(i))return i}if(e)for(let e=0;e<this.multiMaterials.length;e++){const i=this.multiMaterials[e];if(t(i))return i}return null}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}}get environmentTexture(){return this._environmentTexture}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}getOrAddExternalDataWithFactory(e,t){return this._externalData||(this._externalData=new StringDictionary),this._externalData.getOrAddWithFactory(e,t)}set pointerMovePredicate(e){this._pointerPickingConfiguration.pointerMovePredicate=e}addMaterial(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))}resetLastAnimationTimeFrame(){this._animationTimeLast=PrecisionDate.Now}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let e=0;e<this.textures.length;e++){const t=this.textures[e];t&&t.cb&&t.freeRenderingGroups()}}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}get animatables(){return this._activeAnimatables}executeOnceBeforeRender(e,t){void 0!==t?setTimeout((()=>{this._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)}simulatePointerUp(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this}set pointerDownFastCheck(e){this._pointerPickingConfiguration.pointerDownFastCheck=e}removeMorphTargetManager(e){const t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t}setActiveCameraById(e){const t=this.getCameraById(e);return t?(this.activeCamera=t,t):null}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}getStepId(){return this._currentStepId}getMeshByUniqueID(e){return this.getMeshByUniqueId(e)}static set LongPressDelay(e){InputManager.LongPressDelay=e}registerAfterRender(e){this.onAfterRenderObservable.add(e)}isReady(e=!0){if(this._isDisposed)return!1;let t;const i=this.getEngine(),a=i.currentRenderPassId;i.currentRenderPassId=this.activeCamera?.renderPassId??a;let n=!0;for(this._pendingData.length>0&&(n=!1),this.prePassRenderer?.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&n&&(n=this.depthPeelingRenderer.isReady()),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),t=0;t<this.meshes.length;t++){const a=this.meshes[t];if(!a.subMeshes||0===a.subMeshes.length)continue;if(!a.isReady(!0)){n=!1;continue}const s=a.hasThinInstances||"InstancedMesh"===a.getClassName()||"InstancedLinesMesh"===a.getClassName()||i.getCaps().instancedArrays&&a.instances.length>0;for(const e of this._isReadyForMeshStage)e.action(a,s)||(n=!1);if(!e)continue;const r=a.material||this.defaultMaterial;if(r)if(r._storeEffectOnSubMeshes)for(const e of a.subMeshes){const t=e.getMaterial();t&&t.hasRenderTargetTextures&&null!=t.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(t)&&(this._processedMaterials.push(t),this._materialsRenderTargets.concatWithNoDuplicate(t.getRenderTargetTextures()))}else r.hasRenderTargetTextures&&null!=r.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(r)&&(this._processedMaterials.push(r),this._materialsRenderTargets.concatWithNoDuplicate(r.getRenderTargetTextures()))}if(e)for(t=0;t<this._materialsRenderTargets.length;++t){this._materialsRenderTargets.data[t].isReadyForRendering()||(n=!1)}for(t=0;t<this.geometries.length;t++){2===this.geometries[t].delayLoadState&&(n=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const e of this.activeCameras)e.isReady(!0)||(n=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(n=!1));for(const e of this.particleSystems)e.isReady()||(n=!1);if(this.layers)for(const e of this.layers)e.isReady()||(n=!1);return i.areAllEffectsReady()||(n=!1),i.currentRenderPassId=a,n}_forceBlockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism=e}static CollisionCoordinatorFactory(){throw _WarnImport("DefaultCollisionCoordinator")}updateTransformMatrix(e){const t=this.activeCamera;if(t)if(t._renderingMultiview){const i=t._rigCameras[0],a=t._rigCameras[1];this.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(e),a.getViewMatrix(),a.getProjectionMatrix(e))}else this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e))}removeMultiMaterial(e){const t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t}addSkeleton(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))}_addComponent(e){this._components.push(e),this._transientComponents.push(e);const t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}getTransformNodeByID(e){return this.getTransformNodeById(e)}getPostProcessByName(e){for(let t=0;t<this.postProcesses.length;++t){const i=this.postProcesses[t];if(i.name===e)return i}return null}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}get skipPointerMovePicking(){return this._pointerPickingConfiguration.skipPointerMovePicking}get pointerX(){return this._inputManager.pointerX}getBoneByName(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let t=0;t<i.bones.length;t++)if(i.bones[t].name===e)return i.bones[t]}return null}getMorphTargetManagerById(e){for(let t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].Hc===e)return this.morphTargetManagers[t];return null}freezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].freeze()}get forcePointsCloud(){return this._forcePointsCloud}constructor(t,i){super(),this._inputManager=new InputManager(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this.clearColor=new Color4(.2,.2,.3,1),this.ambientColor=new Color3(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new Observable,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.onDisposeObservable=new Observable,this._onDisposeObserver=null,this.onBeforeRenderObservable=new Observable,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new Observable,this.onAfterRenderCameraObservable=new Observable,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new Observable,this.onAfterAnimationsObservable=new Observable,this.onBeforeDrawPhaseObservable=new Observable,this.onAfterDrawPhaseObservable=new Observable,this.onReadyObservable=new Observable,this.onBeforeCameraRenderObservable=new Observable,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new Observable,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new Observable,this.onAfterActiveMeshesEvaluationObservable=new Observable,this.onBeforeParticlesRenderingObservable=new Observable,this.onAfterParticlesRenderingObservable=new Observable,this.onDataLoadedObservable=new Observable,this.onNewCameraAddedObservable=new Observable,this.onCameraRemovedObservable=new Observable,this.onNewLightAddedObservable=new Observable,this.onLightRemovedObservable=new Observable,this.onNewGeometryAddedObservable=new Observable,this.onGeometryRemovedObservable=new Observable,this.onNewTransformNodeAddedObservable=new Observable,this.onTransformNodeRemovedObservable=new Observable,this.onNewMeshAddedObservable=new Observable,this.onMeshRemovedObservable=new Observable,this.onNewSkeletonAddedObservable=new Observable,this.onSkeletonRemovedObservable=new Observable,this.onNewMaterialAddedObservable=new Observable,this.onNewMultiMaterialAddedObservable=new Observable,this.onMaterialRemovedObservable=new Observable,this.onMultiMaterialRemovedObservable=new Observable,this.onNewTextureAddedObservable=new Observable,this.onTextureRemovedObservable=new Observable,this.onBeforeRenderTargetsRenderObservable=new Observable,this.onAfterRenderTargetsRenderObservable=new Observable,this.onBeforeStepObservable=new Observable,this.onAfterStepObservable=new Observable,this.onActiveCameraChanged=new Observable,this.onActiveCamerasChanged=new Observable,this.onBeforeRenderingGroupObservable=new Observable,this.onAfterRenderingGroupObservable=new Observable,this.onMeshImportedObservable=new Observable,this.onAnimationFileImportedObservable=new Observable,this._registeredForLateAnimationBindings=new SmartArrayNoDuplicate(256),this._pointerPickingConfiguration=new PointerPickingConfiguration,this.onPrePointerObservable=new Observable,this.onPointerObservable=new Observable,this.onPreKeyboardObservable=new Observable,this.onKeyboardObservable=new Observable,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=e.FOGMODE_NONE,this.fogColor=new Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new Vector3(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new SmartArrayNoDuplicate(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new PerfCounter,this._activeIndices=new PerfCounter,this._activeParticles=new PerfCounter,this._activeBones=new PerfCounter,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new SmartArray(256),this._processedMaterials=new SmartArray(256),this._renderTargets=new SmartArrayNoDuplicate(256),this._materialsRenderTargets=new SmartArrayNoDuplicate(256),this._activeParticleSystems=new SmartArray(256),this._activeSkeletons=new SmartArrayNoDuplicate(32),this._softwareSkinnedMeshes=new SmartArrayNoDuplicate(32),this._activeAnimatables=new Array,this._transformMatrix=Matrix.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=Stage.Create(),this._beforeClearStage=Stage.Create(),this._beforeRenderTargetClearStage=Stage.Create(),this._gatherRenderTargetsStage=Stage.Create(),this._gatherActiveCameraRenderTargetsStage=Stage.Create(),this._isReadyForMeshStage=Stage.Create(),this._beforeEvaluateActiveMeshStage=Stage.Create(),this._evaluateSubMeshStage=Stage.Create(),this._preActiveMeshStage=Stage.Create(),this._cameraDrawRenderTargetStage=Stage.Create(),this._beforeCameraDrawStage=Stage.Create(),this._beforeRenderTargetDrawStage=Stage.Create(),this._beforeRenderingGroupDrawStage=Stage.Create(),this._beforeRenderingMeshStage=Stage.Create(),this._afterRenderingMeshStage=Stage.Create(),this._afterRenderingGroupDrawStage=Stage.Create(),this._afterCameraDrawStage=Stage.Create(),this._afterCameraPostProcessStage=Stage.Create(),this._afterRenderTargetDrawStage=Stage.Create(),this._afterRenderTargetPostProcessStage=Stage.Create(),this._afterRenderStage=Stage.Create(),this._pointerMoveStage=Stage.Create(),this._pointerDownStage=Stage.Create(),this._pointerUpStage=Stage.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const a={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...i};t=this._engine=t||EngineStore.LastCreatedEngine,a.virtual?t._virtualScenes.push(this):(EngineStore._LastCreatedScene=this,t.scenes.push(this)),this._uid=null,this._renderingManager=new RenderingManager(this),PostProcessManager&&(this.postProcessManager=new PostProcessManager(this)),IsWindowObjectExist()&&this.attachControl(),this._createUbo(),ImageProcessingConfiguration&&(this._imageProcessingConfiguration=new ImageProcessingConfiguration),this.setDefaultCandidateProviders(),a.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=a.useMaterialMeshMap,this.useClonedMeshMap=a.useClonedMeshMap,i&&i.virtual||t.onNewSceneAddedObservable.notifyObservers(this)}get renderingManager(){return this._renderingManager}set pointerDownPredicate(e){this._pointerPickingConfiguration.pointerDownPredicate=e}getActiveBones(){return this._activeBones.current}addExternalData(e,t){return this._externalData||(this._externalData=new StringDictionary),this._externalData.add(e,t)}_bindFrameBuffer(e,t=!0){e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}getAnimationGroupByName(e){for(let t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null}static get DoubleClickDelay(){return InputManager.DoubleClickDelay}getParticleSystemById(e){for(let t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null}setActiveCameraByName(e){const t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null}_rebuildGeometries(){for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const e of this._components)e.rebuild();for(const e of this.particleSystems)e.rebuild();if(this.spriteManagers)for(const e of this.spriteManagers)e.rebuild()}attachControl(e=!0,t=!0,i=!0){this._inputManager.attachControl(e,t,i)}getParticleSystemByID(e){return this.getParticleSystemById(e)}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}get activeCamera(){return this._activeCamera}getMeshByUniqueId(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].Hc===e)return this.meshes[t];return null}addPendingData(e){this._pendingData.push(e)}_clear(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}getLightById(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null}_loadFileAsync(e,t,i,a,n){return new Promise(((s,r)=>{this._loadFile(e,(e=>{s(e)}),t,i,a,((e,t)=>{r(t)}),n)}))}getSkeletonByName(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null}_checkIsReady(e=!1){return this._registerTransientComponents(),this.isReady(e)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(e)}),100))}getTransformNodeByUniqueId(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].Hc===e)return this.transformNodes[t];return null}set skipPointerMovePicking(e){this._pointerPickingConfiguration.skipPointerMovePicking=e}_processSubCameras(e,t=!0){if(0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(let t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)}get isDisposed(){return this._isDisposed}removeMaterial(e){const t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){const e=this.materials[this.materials.length-1];this.materials[t]=e,e._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t}getMaterialByName(e,t=!1){return this._getMaterial(t,(t=>t.name===e))}getMeshByID(e){return this.getMeshById(e)}getTransformNodeById(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}removeGeometry(e){let t;if(this._geometriesByUniqueId){if(t=this._geometriesByUniqueId[e.Hc],void 0===t)return!1}else if(t=this.geometries.indexOf(e),t<0)return!1;if(t!==this.geometries.length-1){const e=this.geometries[this.geometries.length-1];e&&(this.geometries[t]=e,this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.Hc]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.Hc]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0}getCachedEffect(){return this._cachedEffect}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}getMaterialByUniqueID(e,t=!1){return this._getMaterial(t,(t=>t.Hc===e))}set activeCameras(e){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),e&&(this._unObserveActiveCameras=_ObserveArray(e,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=e}getCameraByName(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null}set fogMode(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))}stopAnimation(e,t,i){}get shadowsEnabled(){return this._shadowsEnabled}removeParticleSystem(e){const t=this.particleSystems.indexOf(e);return-1!==t&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(LightConstants.CompareLightsPriority)}getViewMatrix(){return this._viewMatrix}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get fogMode(){return this._fogMode}getNodeByID(e){return this.getNodeById(e)}set defaultMaterial(e){this._defaultMaterial=e}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}getCameraByUniqueID(e){return this.getCameraByUniqueId(e)}addAnimationGroup(e){this._blockEntityCollection||this.animationGroups.push(e)}removeLight(e){const t=this.lights.indexOf(e);if(-1!==t){for(const t of this.meshes)t._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t}getGeometryByID(e){return this.getGeometryById(e)}getTransformNodesById(e){return this.transformNodes.filter((function(t){return t.id===e}))}getLastMeshById(e){for(let t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null}getLightByUniqueId(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].Hc===e)return this.lights[t];return null}set performancePriority(e){if(e!==this._performancePriority){switch(this._performancePriority=e,e){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(e)}}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)return void(this._activeMeshes.length>0&&(this.activeCamera?._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset()));if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const e=this._activeMeshes.length;for(let t=0;t<e;t++){this._activeMeshes.data[t].computeWorldMatrix()}}if(this._activeParticleSystems){const e=this._activeParticleSystems.length;for(let t=0;t<e;t++)this._activeParticleSystems.data[t].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const e of this._beforeEvaluateActiveMeshStage)e.action();const e=this.getActiveMeshCandidates(),t=e.length;for(let i=0;i<t;i++){const t=e.data[i];if(t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,t.isBlocked)continue;if(this._totalVertices.addCount(t.getTotalVertices(),!1),!t.isReady()||!t.isEnabled()||t.scaling.hasAZeroComponent)continue;t.computeWorldMatrix(),t.actionManager&&t.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(t);let a=this.customLODSelector?this.customLODSelector(t,this.activeCamera):t.getLOD(this.activeCamera);if(t._internalAbstractMeshDataInfo._currentLOD=a,t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,null!=a&&(a!==t&&0!==a.billboardMode&&a.computeWorldMatrix(),t._preActivate(),t.isVisible&&t.visibility>0&&t.layerMask&this.activeCamera.layerMask&&(this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||t.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(t),this.activeCamera._activeMeshes.push(t),a!==t&&a._activate(this._renderId,!1);for(const e of this._preActiveMeshStage)e.action(t);t._activate(this._renderId,!1)&&(t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(a=t):a._internalAbstractMeshDataInfo._onlyForInstances=!1,a._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(t,a)),t._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let e=0;e<this.particleSystems.length;e++){const t=this.particleSystems[e];if(!t.isStarted()||!t.emitter)continue;const i=t.emitter;i.position&&!i.isEnabled()||(this._activeParticleSystems.push(t),t.animate(),this._renderingManager.dispatchParticles(t))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}getLastEntryByID(e){return this.getLastEntryById(e)}bindEyePosition(e,t="vEyePosition",i=!1){const a=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,n=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return TmpVectors.Vector4[0].set(a.x,a.y,a.z,n?-1:1),e&&(i?e.setFloat3(t,TmpVectors.Vector4[0].x,TmpVectors.Vector4[0].y,TmpVectors.Vector4[0].z):e.setVector4(t,TmpVectors.Vector4[0])),TmpVectors.Vector4[0]}set forceWireframe(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))}registerBeforeRender(e){this.onBeforeRenderObservable.add(e)}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}removeMesh(e,t=!1){const i=this.meshes.indexOf(e);return-1!==i&&(this.meshes[i]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.removeMesh(e)})),i}getLastMeshByID(e){return this.getLastMeshById(e)}set activeCamera(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))}setActiveCameraByID(e){return this.setActiveCameraById(e)}getProjectionMatrix(){return this._projectionMatrix}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}addActionManager(e){this.actionManagers.push(e)}getTextureByUniqueId(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].Hc===e)return this.textures[t];return null}getGeometries(){return this.geometries}pushGeometry(e,t){return!(!t&&this._getGeometryByUniqueId(e.Hc))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))}getInternalStep(){return this._currentInternalStep}_clearFrameBuffer(e){if(e&&e._multiviewTexture);else if(e&&e.outputRenderTarget&&!e._renderingMultiview){const t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||e.isRightCamera||(this.autoClear&&this._engine.clear(t.clearColor||this.clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}get isLoading(){return this._pendingData.length>0}_rebuildTextures(){for(const e of this.textures)e._rebuild(!0);this.markAllMaterialsAsDirty(1)}set pointerUpFastCheck(e){this._pointerPickingConfiguration.pointerUpFastCheck=e}static DefaultMaterialFactory(e){throw _WarnImport("StandardMaterial")}_requestFileAsync(e,t,i,a,n){return new Promise(((s,r)=>{this._requestFile(e,(e=>{s(e)}),t,i,a,(e=>{r(e)}),n)}))}get fogEnabled(){return this._fogEnabled}getTextureByName(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null}getTransformNodesByID(e){return this.getTransformNodesById(e)}_getComponent(e){for(const t of this._components)if(t.name===e)return t;return null}_checkCameraRenderTarget(e){if(e?.outputRenderTarget&&!e?.isRigCamera&&(e.outputRenderTarget._cleared=!1),e?.rigCameras?.length)for(let t=0;t<e.rigCameras.length;++t){const i=e.rigCameras[t].outputRenderTarget;i&&(i._cleared=!1)}}getSkeletonByUniqueId(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].Hc===e)return this.skeletons[t];return null}createSceneUniformBuffer(e){const t=new UniformBuffer(this._engine,void 0,!1,e??"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}dispose(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this.stopAllAnimations&&(this._activeAnimatables.forEach((e=>{e.onAnimationEndObservable.clear(),e.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const e=this._activeRequests.slice();for(const t of e)t.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(e){Logger.Error("An error occurred while calling onDisposeObservable!",e)}this.detachControl();if(this._engine.getInputElement())for(let e=0;e<this.cameras.length;e++)this.cameras[e].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(e=>e.dispose(!0))),this._disposeList(this.transformNodes,(e=>e.dispose(!0)));const t=this.cameras;this._disposeList(t),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let i=this._engine.scenes.indexOf(this);i>-1&&this._engine.scenes.splice(i,1),EngineStore._LastCreatedScene===this&&(this._engine.scenes.length>0?EngineStore._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:EngineStore._LastCreatedScene=null),i=this._engine._virtualScenes.indexOf(this),i>-1&&this._engine._virtualScenes.splice(i,1),this._engine.wipeCaches(!0),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this._isDisposed=!0}_isInIntermediateRendering(){return this._intermediateRendering}get useRightHandedSystem(){return this._useRightHandedSystem}getClassName(){return"Scene"}set skipFrustumClipping(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)}set forcePointsCloud(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))}getTransformNodeByUniqueID(e){return this.getTransformNodeByUniqueId(e)}get forceWireframe(){return this._forceWireframe}getMorphTargetByName(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let t=0;t<i.numTargets;++t){const a=i.getTarget(t);if(a.name===e)return a}}return null}createPickingRayInCameraSpace(e,t,i){throw _WarnImport("Ray")}_readFileAsync(e,t,i){return new Promise(((a,n)=>{this._readFile(e,(e=>{a(e)}),t,i,(e=>{n(e)}))}))}_executeActiveContainerCleanup(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>e.dispose()))}getNodeByName(e){const t=this.getMeshByName(e);if(t)return t;const i=this.getTransformNodeByName(e);if(i)return i;const a=this.getLightByName(e);if(a)return a;const n=this.getCameraByName(e);if(n)return n;const s=this.getBoneByName(e);return s||null}set blockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))}_requestFile(e,t,i,a,n,s,r){const o=RequestFile(e,t,i,a?this.offlineProvider:void 0,n,s,r);return this._activeRequests.push(o),o.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),o}getUniqueId(){return UniqueIdGenerator.UniqueId}addTexture(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))}removeAnimationGroup(e){const t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}setRenderingAutoClearDepthStencil(e,t,i=!0,a=!0){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,a)}getMaterialByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}set afterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))}simulatePointerMove(e,t){return this._inputManager.simulatePointerMove(e,t),this}getMeshByName(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null}get frustumPlanes(){return this._frustumPlanes}get uid(){return this._uid||(this._uid=Tools.RandomId()),this._uid}getTransformNodeByName(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null}_getGeometryByUniqueId(e){if(this._geometriesByUniqueId){const t=this._geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].Hc===e)return this.geometries[t];return null}whenReadyAsync(e=!1){return new Promise((t=>{this.executeWhenReady((()=>{t()}),e)}))}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}getCachedVisibility(){return this._cachedVisibility}get skeletonsEnabled(){return this._skeletonsEnabled}set pointerY(e){this._inputManager.pointerY=e}getActiveParticles(){return this._activeParticles.current}getLastMaterialById(e,t=!1){for(let t=this.materials.length-1;t>=0;t--)if(this.materials[t].id===e)return this.materials[t];if(t)for(let t=this.multiMaterials.length-1;t>=0;t--)if(this.multiMaterials[t].id===e)return this.multiMaterials[t];return null}setStepId(e){this._currentStepId=e}get meshUnderPointer(){return this._inputManager.meshUnderPointer}set beforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))}getWaitingItemsCount(){return this._pendingData.length}set skipPointerUpPicking(e){this._pointerPickingConfiguration.skipPointerUpPicking=e}createPickingRayToRef(e,t,i,a,n,s=!1,r=!1){throw _WarnImport("Ray")}static set DoubleClickDelay(e){InputManager.DoubleClickDelay=e}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}set environmentTexture(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))}_animate(e){}get pointerY(){return this._inputManager.pointerY}removeActionManager(e){const t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t}addGeometry(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.Hc]=this.geometries.length),this.geometries.push(e))}cleanCachedTextureBuffer(){for(const e of this.textures){e._buffer&&(e._buffer=null)}}removeCamera(e){const t=this.cameras.indexOf(e);if(-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){const t=this.activeCameras.indexOf(e);-1!==t&&this.activeCameras.splice(t,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t}getLastMaterialByID(e){return this.getLastMaterialById(e)}static get ExclusiveDoubleClickMode(){return InputManager.ExclusiveDoubleClickMode}createPickingRayInCameraSpaceToRef(e,t,i,a){throw _WarnImport("Ray")}resetDrawCache(e){if(this.meshes)for(const t of this.meshes)t.resetDrawCache(e)}simulatePointerDown(e,t){return this._inputManager.simulatePointerDown(e,t),this}getLastSkeletonByID(e){return this.getLastSkeletonById(e)}getLightByName(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null}multiPick(e,t,i,a,n){throw _WarnImport("Ray")}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}getCameraById(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null}get activeCameras(){return this._activeCameras}};Scene.FOGMODE_NONE=0,Scene.FOGMODE_EXP=1,Scene.FOGMODE_EXP2=2,Scene.FOGMODE_LINEAR=3,Scene.MinDeltaTime=1,Scene.MaxDeltaTime=1e3,RegisterClass("BABYLON.Scene",Scene);var Light=class e extends Node{constructor(t,i){super(t,i,!1),this.diffuse=new Color3(1,1,1),this.specular=new Color3(1,1,1),this.falloffType=e.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=e.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new UniformBuffer(this.getScene().getEngine(),void 0,void 0,t),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}get shadowEnabled(){return this._shadowEnabled}setEnabled(e){super.setEnabled(e),this._resyncMeshes()}toString(e){let t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}_markMeshesAsLightDirty(){for(const e of this.getScene().meshes)-1!==e.lightSources.indexOf(this)&&e._markSubMeshesAsLightDirty()}set lightmapMode(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}clone(t,i=null){const a=e.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!a)return null;const n=SerializationHelper.Clone(a,this);return t&&(n.name=t),i&&(n.parent=i),n.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(n),n}static GetConstructorFromName(e,t,i){const a=Node.Construct("Light_Type_"+e,t,i);return a||null}set radius(e){this._radius=e,this._computePhotometricScale()}_hookArrayForIncludedOnly(e){const t=e.push;e.push=(...i)=>{const a=t.apply(e,i);return this._resyncMeshes(),a};const i=e.splice;e.splice=(t,a)=>{const n=i.apply(e,[t,a]);return this._resyncMeshes(),n},this._resyncMeshes()}_bindLight(e,t,i,a,n=!0){const s=e.toString();let r=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+s),this._renderId!==t.getRenderId()||this._lastUseSpecular!==a||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=a;const e=this.getScaledIntensity();this.transferToEffect(i,s),this.diffuse.scaleToRef(e,TmpColors.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",TmpColors.Color3[0],this.range,s),a&&(this.specular.scaleToRef(e,TmpColors.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",TmpColors.Color3[1],this.radius,s)),r=!0}if(this.transferTexturesToEffect(i,s),t.shadowsEnabled&&this.shadowEnabled&&n){const e=this.getShadowGenerator(t.activeCamera)??this.getShadowGenerator();e&&(e.bindShadowLight(s,i),r=!0)}r?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getTypeID(){return 0}get excludedMeshes(){return this._excludedMeshes}set intensityMode(e){this._intensityMode=e,this._computePhotometricScale()}get intensityMode(){return this._intensityMode}getProjectionMatrix(e,t){return null}get lightmapMode(){return this._lightmapMode}get range(){return this._range}get includedOnlyMeshes(){return this._includedOnlyMeshes}set shadowEnabled(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}_hookArrayForExcluded(e){const t=e.push;e.push=(...i)=>{const a=t.apply(e,i);for(const e of i)e._resyncLightSource(this);return a};const i=e.splice;e.splice=(t,a)=>{const n=i.apply(e,[t,a]);for(const e of n)e._resyncLightSource(this);return n};for(const t of e)t._resyncLightSource(this)}_resyncMeshes(){for(const e of this.getScene().meshes)e._resyncLightSource(this)}getAbsolutePosition(){return Vector3.Zero()}getClassName(){return"Light"}transferTexturesToEffect(e,t){return this}getShadowGenerator(e=null){return null===this._shadowGenerators?null:this._shadowGenerators.get(e)??null}canAffectMesh(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&(!!(0===this.includeOnlyWithLayerMask||this.includeOnlyWithLayerMask&e.layerMask)&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}_reorderLightsInScene(){const e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}_getPhotometricScale(){let t=0;const i=this.getTypeID();let a=this.intensityMode;switch(a===e.INTENSITYMODE_AUTOMATIC&&(a=i===e.LIGHTTYPEID_DIRECTIONALLIGHT?e.INTENSITYMODE_ILLUMINANCE:e.INTENSITYMODE_LUMINOUSINTENSITY),i){case e.LIGHTTYPEID_POINTLIGHT:case e.LIGHTTYPEID_SPOTLIGHT:switch(a){case e.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case e.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case e.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius}break;case e.LIGHTTYPEID_DIRECTIONALLIGHT:switch(a){case e.INTENSITYMODE_ILLUMINANCE:t=1;break;case e.INTENSITYMODE_LUMINANCE:{let e=this.radius;e=Math.max(e,.001);t=2*Math.PI*(1-Math.cos(e));break}}break;case e.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(e){this._excludeWithLayerMask=e,this._resyncMeshes()}set excludedMeshes(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}dispose(e,t=!1){if(this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next()){t.value.dispose()}this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const e=this._parentContainer.lights.indexOf(this);e>-1&&this._parentContainer.lights.splice(e,1),this._parentContainer=null}for(const e of this.getScene().meshes)e._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(e,t)}serialize(){const e=SerializationHelper.Serialize(this);return e.Hc=this.Hc,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((t=>{e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((t=>{e.includedOnlyMeshesIds.push(t.id)}))),SerializationHelper.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}get radius(){return this._radius}set range(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}getScaledIntensity(){return this._photometricScale*this.intensity}set includedOnlyMeshes(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}set includeOnlyWithLayerMask(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}getShadowGenerators(){return this._shadowGenerators}getViewMatrix(e){return null}static Parse(t,i){const a=e.GetConstructorFromName(t.type,t.name,i);if(!a)return null;const n=SerializationHelper.Parse(a,t,i);if(t.excludedMeshesIds&&(n._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(n._includedOnlyMeshesIds=t.includedOnlyMeshesIds),void 0!==t.parentId&&(n._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(n._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.falloffType&&(n.falloffType=t.falloffType),void 0!==t.lightmapMode&&(n.lightmapMode=t.lightmapMode),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],a=GetClass("BABYLON.Animation");a&&n.animations.push(a.Parse(i))}Node.ParseAnimationRanges(n,t,i)}return t.autoAnimate&&i.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&n.setEnabled(t.isEnabled),n}};Light.FALLOFF_DEFAULT=LightConstants.FALLOFF_DEFAULT,Light.FALLOFF_PHYSICAL=LightConstants.FALLOFF_PHYSICAL,Light.FALLOFF_GLTF=LightConstants.FALLOFF_GLTF,Light.FALLOFF_STANDARD=LightConstants.FALLOFF_STANDARD,Light.LIGHTMAP_DEFAULT=LightConstants.LIGHTMAP_DEFAULT,Light.LIGHTMAP_SPECULAR=LightConstants.LIGHTMAP_SPECULAR,Light.LIGHTMAP_SHADOWSONLY=LightConstants.LIGHTMAP_SHADOWSONLY,Light.INTENSITYMODE_AUTOMATIC=LightConstants.INTENSITYMODE_AUTOMATIC,Light.INTENSITYMODE_LUMINOUSPOWER=LightConstants.INTENSITYMODE_LUMINOUSPOWER,Light.INTENSITYMODE_LUMINOUSINTENSITY=LightConstants.INTENSITYMODE_LUMINOUSINTENSITY,Light.INTENSITYMODE_ILLUMINANCE=LightConstants.INTENSITYMODE_ILLUMINANCE,Light.INTENSITYMODE_LUMINANCE=LightConstants.INTENSITYMODE_LUMINANCE,Light.LIGHTTYPEID_POINTLIGHT=LightConstants.LIGHTTYPEID_POINTLIGHT,Light.LIGHTTYPEID_DIRECTIONALLIGHT=LightConstants.LIGHTTYPEID_DIRECTIONALLIGHT,Light.LIGHTTYPEID_SPOTLIGHT=LightConstants.LIGHTTYPEID_SPOTLIGHT,Light.LIGHTTYPEID_HEMISPHERICLIGHT=LightConstants.LIGHTTYPEID_HEMISPHERICLIGHT,__decorate([serializeAsColor3()],Light.prototype,"diffuse",void 0),__decorate([serializeAsColor3()],Light.prototype,"specular",void 0),__decorate([serialize()],Light.prototype,"falloffType",void 0),__decorate([serialize()],Light.prototype,"intensity",void 0),__decorate([serialize()],Light.prototype,"range",null),__decorate([serialize()],Light.prototype,"intensityMode",null),__decorate([serialize()],Light.prototype,"radius",null),__decorate([serialize()],Light.prototype,"_renderPriority",void 0),__decorate([expandToProperty("_reorderLightsInScene")],Light.prototype,"renderPriority",void 0),__decorate([serialize("shadowEnabled")],Light.prototype,"_shadowEnabled",void 0),__decorate([serialize("excludeWithLayerMask")],Light.prototype,"_excludeWithLayerMask",void 0),__decorate([serialize("includeOnlyWithLayerMask")],Light.prototype,"_includeOnlyWithLayerMask",void 0),__decorate([serialize("lightmapMode")],Light.prototype,"_lightmapMode",void 0),Node.AddNodeConstructor("Light_Type_3",((e,t)=>()=>new HemisphericLight(e,Vector3.Zero(),t)));var HemisphericLight=class extends Light{getTypeID(){return Light.LIGHTTYPEID_HEMISPHERICLIGHT}setDirectionToTarget(e){return this.direction=Vector3.Normalize(e.subtract(Vector3.Zero())),this.direction}getClassName(){return"HemisphericLight"}getShadowGenerator(){return null}transferToEffect(e,t){const i=Vector3.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}constructor(e,t,i){super(e,i),this.groundColor=new Color3(0,0,0),this.direction=t||Vector3.Up()}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=Matrix.Identity()),this._worldMatrix}transferToNodeMaterialEffect(e,t){const i=Vector3.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this}prepareLightSpecificDefines(e,t){e["HEMILIGHT"+t]=!0}};__decorate([serializeAsColor3()],HemisphericLight.prototype,"groundColor",void 0),__decorate([serializeAsVector3()],HemisphericLight.prototype,"direction",void 0),RegisterClass("BABYLON.HemisphericLight",HemisphericLight);var ShadowLight=class extends Light{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=Matrix.Identity(),this._projectionMatrix=Matrix.Identity()}getViewMatrix(e){const t=TmpVectors.Vector3[0];let i=this.position;this.computeTransformedInformation()&&(i=this.transformedPosition),Vector3.NormalizeToRef(this.getShadowDirection(e),t),1===Math.abs(Vector3.Dot(t,Vector3.Up()))&&(t.z=1e-13);const a=TmpVectors.Vector3[1];return i.addToRef(t,a),Matrix.LookAtLHToRef(i,a,Vector3.Up(),this._viewMatrix),this._viewMatrix}computeWorldMatrix(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=Matrix.Identity()),Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthScale(){return 50}_setDirection(e){this._direction=e}getShadowDirection(e){return this.transformedDirection?this.transformedDirection:this.direction}_initCache(){super._initCache(),this._cache.position=Vector3.Zero()}getProjectionMatrix(e,t){return this.setShadowProjectionMatrix(this._projectionMatrix,e??this._viewMatrix,t??[]),this._projectionMatrix}set shadowMaxZ(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()}get shadowMinZ(){return this._shadowMinZ}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getDepthMinZ(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ}set direction(e){this._setDirection(e)}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=Vector3.Zero()),Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=Vector3.Zero()),Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}set shadowMinZ(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()}_isSynchronized(){return!!this._cache.position.equals(this.position)}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}get shadowMaxZ(){return this._shadowMaxZ}_setPosition(e){this._position=e}get position(){return this._position}getDepthMaxZ(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ}setDirectionToTarget(e){return this.direction=Vector3.Normalize(e.subtract(this.position)),this.direction}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}getRotation(){this.direction.normalize();const e=Vector3.Cross(this.direction,Axis.Y),t=Vector3.Cross(e,this.direction);return Vector3.RotationFromAxis(e,t,this.direction)}set position(e){this._setPosition(e)}get direction(){return this._direction}setShadowProjectionMatrix(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this}needCube(){return!1}};__decorate([serializeAsVector3()],ShadowLight.prototype,"position",null),__decorate([serializeAsVector3()],ShadowLight.prototype,"direction",null),__decorate([serialize()],ShadowLight.prototype,"shadowMinZ",null),__decorate([serialize()],ShadowLight.prototype,"shadowMaxZ",null),Node.AddNodeConstructor("Light_Type_1",((e,t)=>()=>new DirectionalLight(e,Vector3.Zero(),t)));var DirectionalLight=class extends ShadowLight{prepareLightSpecificDefines(e,t){e["DIRLIGHT"+t]=!0}set shadowFrustumSize(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?(e.setFloat3(t,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(t,this.direction.x,this.direction.y,this.direction.z),this)}get orthoTop(){return this._orthoTop}set orthoLeft(e){this._orthoLeft=e}constructor(e,t,i){super(e,i),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=t.scale(-1),this.direction=t}get shadowOrthoScale(){return this._shadowOrthoScale}_setDefaultAutoExtendShadowProjectionMatrix(e,t,i){const a=this.getScene().activeCamera;if(!a)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const e=Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let a=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let s=0;s<i.length;s++){const r=i[s];if(!r)continue;const o=r.getBoundingInfo().boundingBox;for(let i=0;i<o.vectorsWorld.length;i++)Vector3.TransformCoordinatesToRef(o.vectorsWorld[i],t,e),e.x<this._orthoLeft&&(this._orthoLeft=e.x),e.y<this._orthoBottom&&(this._orthoBottom=e.y),e.x>this._orthoRight&&(this._orthoRight=e.x),e.y>this._orthoTop&&(this._orthoTop=e.y),this.autoCalcShadowZBounds&&(e.z<a&&(a=e.z),e.z>n&&(n=e.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=a,this._shadowMaxZ=n)}const n=this._orthoRight-this._orthoLeft,s=this._orthoTop-this._orthoBottom,r=void 0!==this.shadowMinZ?this.shadowMinZ:a.minZ,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,l=this.getScene().getEngine().useReverseDepthBuffer;Matrix.OrthoOffCenterLHToRef(this._orthoLeft-n*this.shadowOrthoScale,this._orthoRight+n*this.shadowOrthoScale,this._orthoBottom-s*this.shadowOrthoScale,this._orthoTop+s*this.shadowOrthoScale,l?o:r,l?r:o,e,this.getScene().getEngine().isNDCHalfZRange)}get orthoBottom(){return this._orthoBottom}transferToEffect(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)}getClassName(){return"DirectionalLight"}getDepthMaxZ(e){const t=this._scene.getEngine();return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}_setDefaultFixedFrustumShadowProjectionMatrix(e){const t=this.getScene().activeCamera;t&&Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e,this.getScene().getEngine().isNDCHalfZRange)}getTypeID(){return Light.LIGHTTYPEID_DIRECTIONALLIGHT}getDepthMinZ(e){const t=this._scene.getEngine();return!t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}get orthoLeft(){return this._orthoLeft}set orthoRight(e){this._orthoRight=e}_setDefaultShadowProjectionMatrix(e,t,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,i)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}set orthoBottom(e){this._orthoBottom=e}get shadowFrustumSize(){return this._shadowFrustumSize}get orthoRight(){return this._orthoRight}set shadowOrthoScale(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()}set orthoTop(e){this._orthoTop=e}};__decorate([serialize()],DirectionalLight.prototype,"shadowFrustumSize",null),__decorate([serialize()],DirectionalLight.prototype,"shadowOrthoScale",null),__decorate([serialize()],DirectionalLight.prototype,"autoUpdateExtends",void 0),__decorate([serialize()],DirectionalLight.prototype,"autoCalcShadowZBounds",void 0),__decorate([serialize("orthoLeft")],DirectionalLight.prototype,"_orthoLeft",void 0),__decorate([serialize("orthoRight")],DirectionalLight.prototype,"_orthoRight",void 0),__decorate([serialize("orthoTop")],DirectionalLight.prototype,"_orthoTop",void 0),__decorate([serialize("orthoBottom")],DirectionalLight.prototype,"_orthoBottom",void 0),RegisterClass("BABYLON.DirectionalLight",DirectionalLight),init_kernelBlur_fragment(),init_kernelBlur_vertex();var BlurPostProcess=class e extends PostProcess{get packedFloat(){return this._packedFloat}static _Parse(t,i,a,n){return SerializationHelper.Parse((()=>new e(t.name,t.direction,t.kernel,t.options,i,t.renderTargetSamplingMode,a.getEngine(),t.reusable,t.textureType,void 0,!1)),t,a,n)}get kernel(){return this._idealKernel}constructor(e,t,i,a,n,s=Texture.BILINEAR_SAMPLINGMODE,r,o,l=0,c="",h=!1,u=5){super(e,"kernelBlur",["delta","direction"],["circleOfConfusionSampler"],a,n,s,r,o,null,l,"kernelBlur",{varyingCount:0,depCount:0},!0,u),this._blockCompilation=h,this._packedFloat=!1,this._staticDefines="",this._staticDefines=c,this.direction=t,this.onApplyObservable.add((e=>{this._outputTexture?e.setFloat2("delta",1/this._outputTexture.width*this.direction.x,1/this._outputTexture.height*this.direction.y):e.setFloat2("delta",1/this.width*this.direction.x,1/this.height*this.direction.y)})),this.kernel=i}_glslFloat(e,t=8){return e.toFixed(t).replace(/0+$/,"")}getClassName(){return"BlurPostProcess"}_nearestBestKernel(e){const t=Math.round(e);for(const e of[t,t-1,t+1,t-2,t+2])if(e%2!=0&&Math.floor(e/2)%2==0&&e>0)return Math.max(e,3);return Math.max(t,3)}set kernel(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this._blockCompilation||this._updateParameters())}_gaussianWeight(e){const t=1/3,i=-e*e/(2*t*t);return 1/(Math.sqrt(2*Math.PI)*t)*Math.exp(i)}updateEffect(e=null,t=null,i=null,a,n,s){this._updateParameters(n,s)}async _initShaderSourceAsync(e){e?(this._webGPUReady=!0,await Promise.all([Promise.resolve().then((()=>(init_kernelBlur_fragment2(),kernelBlur_fragment_exports2))),Promise.resolve().then((()=>(init_kernelBlur_vertex2(),kernelBlur_vertex_exports2)))])):await Promise.all([Promise.resolve().then((()=>(init_kernelBlur_fragment(),kernelBlur_fragment_exports))),Promise.resolve().then((()=>(init_kernelBlur_vertex(),kernelBlur_vertex_exports)))]),await super._initShaderSourceAsync(e)}_updateParameters(e,t){const i=this._kernel,a=(i-1)/2;let n=[],s=[],r=0;for(let e=0;e<i;e++){const t=e/(i-1),o=this._gaussianWeight(2*t-1);n[e]=e-a,s[e]=o,r+=o}for(let e=0;e<s.length;e++)s[e]/=r;const o=[],l=[],c=[];for(let e=0;e<=a;e+=2){const t=Math.min(e+1,Math.floor(a));if(e===t)c.push({o:n[e],w:s[e]});else{const i=t===a,r=s[e]+s[t]*(i?.5:1),o=n[e]+1/(1+s[e]/s[t]);0===o?(c.push({o:n[e],w:s[e]}),c.push({o:n[e+1],w:s[e+1]})):(c.push({o:o,w:r}),c.push({o:-o,w:r}))}}for(let e=0;e<c.length;e++)l[e]=c[e].o,o[e]=c[e].w;n=l,s=o;const h=this.getEngine().getCaps().maxVaryingVectors-(1===this.shaderLanguage?1:0),u=Math.max(h,0)-1;let m=Math.min(n.length,u),d="";d+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(d+=`#define CENTER_WEIGHT ${this._glslFloat(s[m-1])}\n`,m--);for(let e=0;e<m;e++)d+=`#define KERNEL_OFFSET${e} ${this._glslFloat(n[e])}\n`,d+=`#define KERNEL_WEIGHT${e} ${this._glslFloat(s[e])}\n`;let f=0;for(let e=u;e<n.length;e++)d+=`#define KERNEL_DEP_OFFSET${f} ${this._glslFloat(n[e])}\n`,d+=`#define KERNEL_DEP_WEIGHT${f} ${this._glslFloat(s[e])}\n`,f++;this.packedFloat&&(d+="#define PACKEDFLOAT 1"),this._blockCompilation=!1,super.updateEffect(d,null,null,{varyingCount:m,depCount:f},e,t)}set packedFloat(e){this._packedFloat!==e&&(this._packedFloat=e,this._blockCompilation||this._updateParameters())}};__decorate([serialize("kernel")],BlurPostProcess.prototype,"_kernel",void 0),__decorate([serialize("packedFloat")],BlurPostProcess.prototype,"_packedFloat",void 0),__decorate([serializeAsVector2()],BlurPostProcess.prototype,"direction",void 0),RegisterClass("BABYLON.BlurPostProcess",BlurPostProcess);var ShadowGenerator=class e{_createTargetRenderTexture(){const e=this._scene.getEngine();e._features.supportDepthStencilTexture?(this._shadowMap=new RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1,void 0,this._useRedTextureType?6:5),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0,void 0,void 0,void 0,`DepthStencilForShadowGenerator-${this._light.name}`)):this._shadowMap=new RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.noPrePassRenderer=!0}_initializeGenerator(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()}set useBlurCloseExponentialShadowMap(t){const i=this._validateFilter(e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)}set useCloseExponentialShadowMap(t){const i=this._validateFilter(e.FILTER_CLOSEEXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)}_initializeShadowMap(){if(this._createTargetRenderTexture(),null===this._shadowMap)return;this._shadowMap.wrapU=Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.Hc=this._storedUniqueId),this._shadowMap.customRenderFunction=(e,t,i,a)=>this._renderForShadowMap(e,t,i,a),this._shadowMap.customIsReadyFunction=()=>!0;const t=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.add((()=>{this._currentSceneUBO=this._scene.getSceneUniformBuffer(),t._debugPushGroup?.(`shadow map generation for pass id ${t.currentRenderPassId}`,1)})),this._shadowMap.onBeforeRenderObservable.add((i=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[0]),this._currentFaceIndex=i,this._filter===e.FILTER_PCF&&t.setColorWrite(!1),this.getTransformMatrix(),this._scene.setTransformMatrix(this._viewMatrix,this._projectionMatrix),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onAfterUnbindObservable.add((()=>{if(this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._currentSceneUBO),this._scene.updateTransformMatrix(),this._filter===e.FILTER_PCF&&t.setColorWrite(!0),!this.useBlurExponentialShadowMap&&!this.useBlurCloseExponentialShadowMap)return void t._debugPopGroup?.(1);const i=this.getShadowMapForRendering();i&&(this._scene.postProcessManager.directRender(this._blurPostProcesses,i.renderTarget,!0),t.unBindFramebuffer(i.renderTarget,!0),t._debugPopGroup?.(1))}));const i=new Color4(0,0,0,0),a=new Color4(1,1,1,1);this._shadowMap.onClearObservable.add((t=>{this._filter===e.FILTER_PCF?t.clear(a,!1,!0,!1):this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t.clear(i,!0,!0,!1):t.clear(a,!0,!0,!1)})),this._shadowMap.onResizeObservable.add((e=>{this._storedUniqueId=this._shadowMap.Hc,this._mapSize=e.getRenderSize(),this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}));for(let e=RenderingManager.MIN_RENDERINGGROUPS;e<RenderingManager.MAX_RENDERINGGROUPS;e++)this._shadowMap.setRenderingAutoClearDepthStencil(e,!1)}set useContactHardeningShadow(t){const i=this._validateFilter(e.FILTER_PCSS);(t||this.filter===e.FILTER_PCSS)&&(this.filter=t?i:e.FILTER_NONE)}serialize(){const e={},t=this.getShadowMap();if(!t)return e;if(e.className=this.getClassName(),e.lightId=this._light.id,e.cameraId=this._camera?.id,e.id=this.id,e.mapSize=t.getRenderSize(),e.forceBackFacesOnly=this.forceBackFacesOnly,e.darkness=this.getDarkness(),e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.filteringQuality=this.filteringQuality,e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.depthScale=this.depthScale,e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.cb=[],t.cb)for(let i=0;i<t.cb.length;i++){const a=t.cb[i];e.cb.push(a.id)}return e}get filteringQuality(){return this._filteringQuality}set usePoissonSampling(t){const i=this._validateFilter(e.FILTER_POISSONSAMPLING);(t||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=t?i:e.FILTER_NONE)}setDarkness(e){return this._darkness=e>=1?1:e<=0?0:e,this}set filteringQuality(e){this._filteringQuality!==e&&(this._filteringQuality=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())}get viewMatrix(){return this._viewMatrix}get darkness(){return this._darkness}set blurBoxOffset(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())}async _initShaderSourceAsync(t=!1){!this._scene.getEngine().isWebGPU||t||e.ForceGLSL?await Promise.all([Promise.resolve().then((()=>(init_shadowMap_fragment2(),shadowMap_fragment_exports2))),Promise.resolve().then((()=>(init_shadowMap_vertex2(),shadowMap_vertex_exports2))),Promise.resolve().then((()=>(init_depthBoxBlur_fragment2(),depthBoxBlur_fragment_exports2))),Promise.resolve().then((()=>(init_shadowMapFragmentSoftTransparentShadow2(),shadowMapFragmentSoftTransparentShadow_exports2)))]):(this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(init_shadowMap_fragment(),shadowMap_fragment_exports))),Promise.resolve().then((()=>(init_shadowMap_vertex(),shadowMap_vertex_exports))),Promise.resolve().then((()=>(init_depthBoxBlur_fragment(),depthBoxBlur_fragment_exports))),Promise.resolve().then((()=>(init_shadowMapFragmentSoftTransparentShadow(),shadowMapFragmentSoftTransparentShadow_exports)))])),this._shadersLoaded=!0}set bias(e){this._bias=e}recreateShadowMap(){const e=this._shadowMap;if(!e)return;const t=e.cb;if(this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this._filter,this._applyFilterValues(),t){this._shadowMap.cb||(this._shadowMap.cb=[]);for(const e of t)this._shadowMap.cb.push(e)}else this._shadowMap.cb=null}forceCompilationAsync(e){return new Promise((t=>{this.forceCompilation((()=>{t()}),e)}))}bindShadowLight(t,i){const a=this._light;if(!this._scene.shadowsEnabled||!a.shadowEnabled)return;const n=this._getCamera();if(!n)return;const s=this.getShadowMap();if(!s)return;a.needCube()||i.setMatrix("lightMatrix"+t,this.getTransformMatrix());const r=this.getShadowMapForRendering();this._filter===e.FILTER_PCF?(i.setDepthStencilTexture("shadowTexture"+t,r),a._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s.getSize().width,1/s.getSize().width,this.frustumEdgeFalloff,t)):this._filter===e.FILTER_PCSS?(i.setDepthStencilTexture("shadowTexture"+t,r),i.setTexture("depthTexture"+t,r),a._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/s.getSize().width,this._contactHardeningLightSizeUVRatio*s.getSize().width,this.frustumEdgeFalloff,t)):(i.setTexture("shadowTexture"+t,r),a._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/s.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),a._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(n),this.getLight().getDepthMinZ(n)+this.getLight().getDepthMaxZ(n),t)}forceCompilation(e,t){const i={useInstances:!1,...t},a=this.getShadowMap();if(!a)return void(e&&e(this));const n=a.cb;if(!n)return void(e&&e(this));const s=[];for(const e of n)s.push(...e.subMeshes);if(0===s.length)return void(e&&e(this));let r=0;const o=()=>{if(this._scene&&this._scene.getEngine()){for(;this.isReady(s[r],i.useInstances,s[r].getMaterial()?.needAlphaBlendingForMesh(s[r].getMesh())??!1);)if(r++,r>=s.length)return void(e&&e(this));setTimeout(o,16)}};o()}set transparencyShadow(e){this.setTransparencyShadow(e)}get projectionMatrix(){return this._projectionMatrix}get contactHardeningLightSizeUVRatio(){return this._contactHardeningLightSizeUVRatio}set blurScale(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())}getDarkness(){return this._darkness}get bias(){return this._bias}get usePercentageCloserFiltering(){return this.filter===e.FILTER_PCF}set useBlurExponentialShadowMap(t){const i=this._validateFilter(e.FILTER_BLUREXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)}_applyFilterValues(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(Texture.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE))}_validateFilter(e){return e}getTransformMatrix(){const e=this._scene;if(this._currentRenderId===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderId=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;let t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(Vector3.Dot(this._lightDirection,Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),Matrix.LookAtLHToRef(t,t.add(this._lightDirection),Vector3.Up(),this._viewMatrix);const e=this.getShadowMap();if(e){const t=e.cb;t&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,t)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix}get useBlurExponentialShadowMap(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP}_isReadyCustomDefines(e,t,i){}getShadowMapForRendering(){return this._shadowMap2?this._shadowMap2:this._shadowMap}isReady(t,i,a){if(!this._shadersLoaded)return!1;const n=t.getMaterial(),s=n?.shadowDepthWrapper;if(this._opacityTexture=null,!n)return!1;const r=[];if(this._prepareShadowDefines(t,i,r,a),s){if(!s.isReadyForSubMesh(t,r,this,i,this._scene.getEngine().currentRenderPassId))return!1}else{const a=t._getDrawWrapper(void 0,!0);let s=a.effect,o=a.defines;const l=[VertexBuffer.PositionKind],c=t.getMesh();this.normalBias&&c.isVerticesDataPresent(VertexBuffer.NormalKind)&&(l.push(VertexBuffer.NormalKind),r.push("#define NORMAL"),c.nonUniformScaling&&r.push("#define NONUNIFORMSCALING"));const h=n.needAlphaTesting();if((h||n.needAlphaBlending())&&(this.useOpacityTextureForTransparentShadow?this._opacityTexture=n.opacityTexture:this._opacityTexture=n.getAlphaTestTexture(),this._opacityTexture)){if(!this._opacityTexture.isReady())return!1;const t=n.alphaCutOff??e.DEFAULT_ALPHA_CUTOFF;r.push("#define ALPHATEXTURE"),h&&r.push(`#define ALPHATESTVALUE ${t}${t%1==0?".":""}`),c.isVerticesDataPresent(VertexBuffer.UVKind)&&(l.push(VertexBuffer.UVKind),r.push("#define UV1")),c.isVerticesDataPresent(VertexBuffer.UV2Kind)&&1===this._opacityTexture.coordinatesIndex&&(l.push(VertexBuffer.UV2Kind),r.push("#define UV2"))}const u=new EffectFallbacks;if(c.useBones&&c.computeBonesUsingShaders&&c.skeleton){l.push(VertexBuffer.MatricesIndicesKind),l.push(VertexBuffer.MatricesWeightsKind),c.numBoneInfluencers>4&&(l.push(VertexBuffer.MatricesIndicesExtraKind),l.push(VertexBuffer.MatricesWeightsExtraKind));const e=c.skeleton;r.push("#define NUM_BONE_INFLUENCERS "+c.numBoneInfluencers),c.numBoneInfluencers>0&&u.addCPUSkinningFallback(0,c),e.isUsingTextureForMatrices?r.push("#define BONETEXTURE"):r.push("#define BonesPerMesh "+(e.bones.length+1))}else r.push("#define NUM_BONE_INFLUENCERS 0");const m=c.morphTargetManager;let d=0;if(m&&(d=m.numMaxInfluencers||m.numInfluencers,d>0&&(r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+d),m.isUsingTextureForTargets&&r.push("#define MORPHTARGETS_TEXTURE"),PrepareAttributesForMorphTargetsInfluencers(l,c,d))),prepareStringDefinesForClipPlanes(n,this._scene,r),i&&(r.push("#define INSTANCES"),PushAttributesForInstances(l),t.getRenderingMesh().hasThinInstances&&r.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(const e of this.customShaderOptions.defines)-1===r.indexOf(e)&&r.push(e);const f=c.bakedVertexAnimationManager;i&&f&&f.isEnabled&&(r.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),l.push("bakedVertexAnimationSettingsInstanced"));const p=r.join("\n");if(o!==p){o=p;let e="shadowMap";const t=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","morphTargetCount","boneTextureWidth","softTransparentShadowSM","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime","bakedVertexAnimationTexture"],i=["diffuseSampler","boneSampler","morphTargets","bakedVertexAnimationTexture"],n=["Scene","Mesh"];if(addClipPlaneUniforms(t),this.customShaderOptions){if(e=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(const e of this.customShaderOptions.attributes)-1===l.indexOf(e)&&l.push(e);if(this.customShaderOptions.uniforms)for(const e of this.customShaderOptions.uniforms)-1===t.indexOf(e)&&t.push(e);if(this.customShaderOptions.samplers)for(const e of this.customShaderOptions.samplers)-1===i.indexOf(e)&&i.push(e)}const r=this._scene.getEngine();s=r.createEffect(e,{attributes:l,uniformsNames:t,uniformBuffersNames:n,samplers:i,defines:p,fallbacks:u,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:d},shaderLanguage:this._shaderLanguage},r),a.setEffect(s,o)}if(!s.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady()))}getShadowMap(){return this._shadowMap}_bindCustomEffectForRenderSubMeshForShadowMap(e,t,i){t.setMatrix("viewProjection",this.getTransformMatrix())}_disposeSceneUBOs(){if(this._sceneUBOs){for(const e of this._sceneUBOs)e.dispose();this._sceneUBOs=[]}}removeShadowCaster(e,t=!0){if(!this._shadowMap||!this._shadowMap.cb)return this;const i=this._shadowMap.cb.indexOf(e);if(-1!==i&&this._shadowMap.cb.splice(i,1),t)for(const t of e.getChildren())this.removeShadowCaster(t);return this}get mapSize(){return this._mapSize}get useContactHardeningShadow(){return this.filter===e.FILTER_PCSS}constructor(t,i,a,n,s,r=!1){this.onBeforeShadowMapRenderObservable=new Observable,this.onAfterShadowMapRenderObservable=new Observable,this.onBeforeShadowMapRenderMeshObservable=new Observable,this.onAfterShadowMapRenderMeshObservable=new Observable,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.useOpacityTextureForTransparentShadow=!1,this.frustumEdgeFalloff=0,this._shaderLanguage=0,this.forceBackFacesOnly=!1,this._lightDirection=Vector3.Zero(),this._viewMatrix=Matrix.Zero(),this._projectionMatrix=Matrix.Zero(),this._transformMatrix=Matrix.Zero(),this._cachedPosition=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=Matrix.Identity(),this._shadersLoaded=!1,this._mapSize=t,this._light=i,this._scene=i.getScene(),this._camera=n??null,this._useRedTextureType=!!s,this._initShaderSourceAsync(r);let o=i._shadowGenerators;o||(o=i._shadowGenerators=new Map),o.set(this._camera,this),this.id=i.id,this._useUBO=this._scene.getEngine().supportsUniformBuffers,this._useUBO&&(this._sceneUBOs=[],this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for Shadow Generator (light "${this._light.name}")`))),e._SceneComponentInitialization(this._scene);const l=this._scene.getEngine().getCaps();a?l.textureFloatRender&&l.textureFloatLinearFiltering?this._textureType=1:l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering?this._textureType=2:this._textureType=0:l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering?this._textureType=2:l.textureFloatRender&&l.textureFloatLinearFiltering?this._textureType=1:this._textureType=0,this._initializeGenerator(),this._applyFilterValues()}get useBlurCloseExponentialShadowMap(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP}_prepareShadowDefines(e,t,i,a){i.push("#define SM_LIGHTTYPE_"+this._light.getClassName().toUpperCase()),i.push("#define SM_FLOAT "+(0!==this._textureType?"1":"0")),i.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),i.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));const n=e.getMesh();return i.push("#define SM_NORMALBIAS "+(this.normalBias&&n.isVerticesDataPresent(VertexBuffer.NormalKind)?"1":"0")),i.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===Light.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),i.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),i.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&a?"1":"0")),this._isReadyCustomDefines(i,e,t),i}get normalBias(){return this._normalBias}set filter(t){if(t=this._validateFilter(t),this._light.needCube()){if(t===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===e.FILTER_PCF||t===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==e.FILTER_PCF&&t!==e.FILTER_PCSS||this._scene.getEngine()._features.supportShadowSamplers?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0}set normalBias(e){this._normalBias=e}_disposeBlurPostProcesses(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]}get blurKernel(){return this._blurKernel}get blurScale(){return this._blurScale}addShadowCaster(e,t=!0){if(!this._shadowMap)return this;if(this._shadowMap.cb||(this._shadowMap.cb=[]),-1===this._shadowMap.cb.indexOf(e)&&this._shadowMap.cb.push(e),t)for(const t of e.getChildMeshes())-1===this._shadowMap.cb.indexOf(t)&&this._shadowMap.cb.push(t);return this}static Parse(t,i,a){const n=i.getLightById(t.lightId),s=void 0!==t.cameraId?i.getCameraById(t.cameraId):null,r=a?a(t.mapSize,n,s):new e(t.mapSize,n,void 0,s),o=r.getShadowMap();for(let e=0;e<t.cb.length;e++){i.getMeshesById(t.cb[e]).forEach((function(e){o&&(o.cb||(o.cb=[]),o.cb.push(e))}))}return void 0!==t.id&&(r.id=t.id),r.forceBackFacesOnly=!!t.forceBackFacesOnly,void 0!==t.darkness&&r.setDarkness(t.darkness),t.transparencyShadow&&r.setTransparencyShadow(!0),void 0!==t.frustumEdgeFalloff&&(r.frustumEdgeFalloff=t.frustumEdgeFalloff),void 0!==t.bias&&(r.bias=t.bias),void 0!==t.normalBias&&(r.normalBias=t.normalBias),t.usePercentageCloserFiltering?r.usePercentageCloserFiltering=!0:t.useContactHardeningShadow?r.useContactHardeningShadow=!0:t.usePoissonSampling?r.usePoissonSampling=!0:t.useExponentialShadowMap?r.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?r.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?r.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?r.useBlurCloseExponentialShadowMap=!0:t.useVarianceShadowMap?r.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(r.useBlurExponentialShadowMap=!0),void 0!==t.contactHardeningLightSizeUVRatio&&(r.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio),void 0!==t.filteringQuality&&(r.filteringQuality=t.filteringQuality),t.depthScale&&(r.depthScale=t.depthScale),t.blurScale&&(r.blurScale=t.blurScale),t.blurBoxOffset&&(r.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(r.useKernelBlur=t.useKernelBlur),t.blurKernel&&(r.blurKernel=t.blurKernel),r}get blurBoxOffset(){return this._blurBoxOffset}get useCloseExponentialShadowMap(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP}set depthScale(e){this._depthScale=e}_renderSubMeshForShadowMap(e,t=!1){const i=e.getRenderingMesh(),a=e.getEffectiveMesh(),n=this._scene,s=n.getEngine(),r=e.getMaterial();if(a._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!r||0===e.verticesCount||e._renderId===n.getRenderId())return;const o=n.useRightHandedSystem,l=a._getWorldMatrixDeterminant()<0;let c=r._getEffectiveOrientation(i);(l&&!o||!l&&o)&&(c=0===c?1:0);const h=0===c;s.setState(r.backFaceCulling,void 0,void 0,h,r.cullBackFaces);const u=i._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(u.mustReturn)return;const m=s.getCaps().instancedArrays&&(null!==u.visibleInstances[e._id]&&void 0!==u.visibleInstances[e._id]||i.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(e))if(this.isReady(e,m,t)){e._renderId=n.getRenderId();const o=r.shadowDepthWrapper,l=o?.getEffect(e,this,s.currentRenderPassId)??e._getDrawWrapper(),c=DrawWrapper.GetEffect(l);s.enableEffect(l),m||i._bind(e,c,r.fillMode),this.getTransformMatrix(),c.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===Light.LIGHTTYPEID_DIRECTIONALLIGHT?c.setVector3("lightDataSM",this._cachedDirection):c.setVector3("lightDataSM",this._cachedPosition);const h=this._getCamera();if(h&&c.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(h),this.getLight().getDepthMinZ(h)+this.getLight().getDepthMaxZ(h)),t&&this.enableSoftTransparentShadow&&c.setFloat2("softTransparentShadowSM",a.visibility*r.alpha,this._opacityTexture?.getAlphaFromRGB?1:0),o)e._setMainDrawWrapperOverride(l),o.standalone?o.baseMaterial.bindForSubMesh(a.getWorldMatrix(),i,e):r.bindForSubMesh(a.getWorldMatrix(),i,e),e._setMainDrawWrapperOverride(null);else{if(this._opacityTexture&&(c.setTexture("diffuseSampler",this._opacityTexture),c.setMatrix("diffuseMatrix",this._opacityTexture.getTextureMatrix()||this._defaultTextureMatrix)),i.useBones&&i.computeBonesUsingShaders&&i.skeleton){const e=i.skeleton;if(e.isUsingTextureForMatrices){const t=e.getTransformMatrixTexture(i);if(!t)return;c.setTexture("boneSampler",t),c.setFloat("boneTextureWidth",4*(e.bones.length+1))}else c.setMatrices("mBones",e.getTransformMatrices(i))}BindMorphTargetParameters(i,c),i.morphTargetManager&&i.morphTargetManager.isUsingTextureForTargets&&i.morphTargetManager._bind(c);const t=e.getMesh().bakedVertexAnimationManager;m&&t&&t.isEnabled&&t.bind(c,!0),bindClipPlane(c,r,n)}this._useUBO||o||this._bindCustomEffectForRenderSubMeshForShadowMap(e,c,a),BindSceneUniformBuffer(c,this._scene.getSceneUniformBuffer()),this._scene.getSceneUniformBuffer().bindUniformBuffer();const d=a.getWorldMatrix();m&&(a.getMeshUniformBuffer().bindToEffect(c,"Mesh"),a.transferToEffect(d)),this.forceBackFacesOnly&&s.setState(!0,0,!1,!0,r.cullBackFaces),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(i),this.onBeforeShadowMapRenderObservable.notifyObservers(c),i._processRendering(a,e,c,r.fillMode,u,m,((e,t)=>{a===i||e?(a.getMeshUniformBuffer().bindToEffect(c,"Mesh"),a.transferToEffect(e?t:d)):(i.getMeshUniformBuffer().bindToEffect(c,"Mesh"),i.transferToEffect(t))})),this.forceBackFacesOnly&&s.setState(!0,0,!1,!1,r.cullBackFaces),this.onAfterShadowMapRenderObservable.notifyObservers(c),this.onAfterShadowMapRenderMeshObservable.notifyObservers(i)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}dispose(){if(this._disposeRTTandPostProcesses(),this._disposeSceneUBOs(),this._light){if(this._light._shadowGenerators){const e=this._light._shadowGenerators.entries();for(let t=e.next();!0!==t.done;t=e.next()){const[e,i]=t.value;i===this&&this._light._shadowGenerators.delete(e)}0===this._light._shadowGenerators.size&&(this._light._shadowGenerators=null)}this._light._markMeshesAsLightDirty()}this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()}set contactHardeningLightSizeUVRatio(e){this._contactHardeningLightSizeUVRatio=e}get depthScale(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()}get filter(){return this._filter}_disposeRTTandPostProcesses(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()}get useExponentialShadowMap(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP}set darkness(e){this.setDarkness(e)}set useExponentialShadowMap(t){const i=this._validateFilter(e.FILTER_EXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)}_renderForShadowMap(e,t,i,a){let n;if(a.length)for(n=0;n<a.length;n++)this._renderSubMeshForShadowMap(a.data[n]);for(n=0;n<e.length;n++)this._renderSubMeshForShadowMap(e.data[n]);for(n=0;n<t.length;n++)this._renderSubMeshForShadowMap(t.data[n]);if(this._transparencyShadow)for(n=0;n<i.length;n++)this._renderSubMeshForShadowMap(i.data[n],!0);else for(n=0;n<i.length;n++)i.data[n].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}set useKernelBlur(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())}prepareDefines(t,i){const a=this._scene,n=this._light;a.shadowsEnabled&&n.shadowEnabled&&(t["SHADOW"+i]=!0,this.useContactHardeningShadow?(t["SHADOWPCSS"+i]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePercentageCloserFiltering?(t["SHADOWPCF"+i]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+i]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+i]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+i]=!0),n.needCube()&&(t["SHADOWCUBE"+i]=!0))}set usePercentageCloserFiltering(t){const i=this._validateFilter(e.FILTER_PCF);(t||this.filter===e.FILTER_PCF)&&(this.filter=t?i:e.FILTER_NONE)}set blurKernel(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())}get usePoissonSampling(){return this.filter===e.FILTER_POISSONSAMPLING}get transparencyShadow(){return this._transparencyShadow}set mapSize(e){this._mapSize=e,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}getLight(){return this._light}_getCamera(){return this._camera??this._scene.activeCamera}setTransparencyShadow(e){return this._transparencyShadow=e,this}getClassName(){return e.CLASSNAME}_initializeBlurRTTAndPostProcesses(){const e=this._scene.getEngine(),t=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new RenderTargetTexture(this._light.name+"_shadowMap2",t,this._scene,!1,!0,this._textureType,void 0,void 0,!1),this._shadowMap2.wrapU=Texture.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=Texture.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new BlurPostProcess(this._light.name+"KernelBlurX",new Vector2(1,0),this.blurKernel,1,null,Texture.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.width=t,this._kernelBlurXPostprocess.height=t,this._kernelBlurXPostprocess.externalTextureSamplerBinding=!0,this._kernelBlurXPostprocess.onApplyObservable.add((e=>{e.setTexture("textureSampler",this._shadowMap)})),this._kernelBlurYPostprocess=new BlurPostProcess(this._light.name+"KernelBlurY",new Vector2(0,1),this.blurKernel,1,null,Texture.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,0===this._textureType&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new PostProcess(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,Texture.BILINEAR_SAMPLINGMODE,e,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType,void 0,void 0,void 0,void 0,this._shaderLanguage),this._boxBlurPostprocess.externalTextureSamplerBinding=!0,this._boxBlurPostprocess.onApplyObservable.add((e=>{e.setFloat2("screenSize",t,t),e.setTexture("textureSampler",this._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])}get useKernelBlur(){return this._useKernelBlur}get shaderLanguage(){return this._shaderLanguage}};ShadowGenerator.CLASSNAME="ShadowGenerator",ShadowGenerator.ForceGLSL=!1,ShadowGenerator.FILTER_NONE=0,ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP=1,ShadowGenerator.FILTER_POISSONSAMPLING=2,ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP=3,ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,ShadowGenerator.FILTER_PCF=6,ShadowGenerator.FILTER_PCSS=7,ShadowGenerator.QUALITY_HIGH=0,ShadowGenerator.QUALITY_MEDIUM=1,ShadowGenerator.QUALITY_LOW=2,ShadowGenerator.DEFAULT_ALPHA_CUTOFF=.5,ShadowGenerator._SceneComponentInitialization=e=>{throw _WarnImport("ShadowGeneratorSceneComponent")},Node.AddNodeConstructor("TargetCamera",((e,t)=>()=>new TargetCamera(e,Vector3.Zero(),t)));var TargetCamera=class e extends Camera{_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,a=this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*a,t);break}case Camera.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}super._updateRigCameras()}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Axis.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(Quaternion.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Axis.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(e,t,i){if(this.ignoreParentScaling){if(this.parent){const a=this.parent.getWorldMatrix();Vector3.TransformCoordinatesToRef(e,a,this._globalPosition),Vector3.TransformCoordinatesToRef(t,a,this._tmpTargetVector),Vector3.TransformNormalToRef(i,a,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(t),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?Matrix.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):Matrix.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?Matrix.LookAtRHToRef(e,t,i,this._viewMatrix):Matrix.LookAtLHToRef(e,t,i,this._viewMatrix),this.parent){const e=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(e,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)}get target(){return this.getTarget()}_rotateUpVectorWithCameraRotationMatrix(){return Vector3.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}set target(e){this.setTarget(e)}setTarget(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=Epsilon),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),Matrix.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}_checkInputs(){const e=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),i=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.copyFrom(this.rotation),this._deferredPositionUpdate.copyFrom(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.copyFrom(this.rotationQuaternion),t&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*e,this._deferredRotationUpdate.y+=this.cameraRotation.y*e,!this.noRotationConstraint){const e=1.570796;this._deferredRotationUpdate.x>e&&(this._deferredRotationUpdate.x=e),this._deferredRotationUpdate.x<-e&&(this._deferredRotationUpdate.x=-e)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.copyFrom(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(Quaternion.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate))}}t&&(Math.abs(this.cameraDirection.x)<this.speed*Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCache(e){e||super._updateCache();const t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}getClassName(){return"TargetCamera"}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const e=this.lockedTarget;e.computeWorldMatrix().getTranslationToRef(e.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_getRigCamPositionAndTarget(t,i){this.getTarget().subtractToRef(this.position,e._TargetFocalPoint),e._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const a=e._TargetFocalPoint.addInPlace(this.position);Matrix.TranslationToRef(-a.x,-a.y,-a.z,e._TargetTransformMatrix),e._TargetTransformMatrix.multiplyToRef(Matrix.RotationAxis(i.upVector,t),e._RigCamTransformMatrix),Matrix.TranslationToRef(a.x,a.y,a.z,e._TargetTransformMatrix),e._RigCamTransformMatrix.multiplyToRef(e._TargetTransformMatrix,e._RigCamTransformMatrix),Vector3.TransformCoordinatesToRef(this.position,e._RigCamTransformMatrix,i.position),i.setTarget(a)}getTarget(){return this._currentTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}createRigCamera(t,i){if(this.cameraRigMode!==Camera.RIG_MODE_NONE){const i=new e(t,this.position.clone(),this.getScene());return i.isRigCamera=!0,i.rigParent=this,this.cameraRigMode===Camera.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new Quaternion),i._cameraRigParams={},i.rotationQuaternion=new Quaternion),i.mode=this.mode,i.orthoLeft=this.orthoLeft,i.orthoRight=this.orthoRight,i.orthoTop=this.orthoTop,i.orthoBottom=this.orthoBottom,i}return null}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}constructor(e,t,i,a=!0){super(e,t,i,a),this._tmpUpVector=Vector3.Zero(),this._tmpTargetVector=Vector3.Zero(),this.cameraDirection=new Vector3(0,0,0),this.cameraRotation=new Vector2(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new Quaternion,this.rotation=new Vector3(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=Vector3.Zero(),this._initialFocalDistance=1,this._viewMatrix=Matrix.Zero(),this._camMatrix=Matrix.Zero(),this._cameraTransformMatrix=Matrix.Zero(),this._cameraRotationMatrix=Matrix.Zero(),this._referencePoint=new Vector3(0,0,1),this._transformedReferencePoint=Vector3.Zero(),this._deferredPositionUpdate=new Vector3,this._deferredRotationQuaternionUpdate=new Quaternion,this._deferredRotationUpdate=new Vector3,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=Vector3.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(TmpVectors.Matrix[0]),Vector3.TransformNormalToRef(this.cameraDirection,TmpVectors.Matrix[0],TmpVectors.Vector3[0]),this._deferredPositionUpdate.addInPlace(TmpVectors.Vector3[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate)}_initCache(){super._initCache(),this._cache.lockedTarget=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))}getFrontPosition(e){this.getWorldMatrix();const t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)}};TargetCamera._RigCamTransformMatrix=new Matrix,TargetCamera._TargetTransformMatrix=new Matrix,TargetCamera._TargetFocalPoint=new Vector3,__decorate([serializeAsVector3()],TargetCamera.prototype,"rotation",void 0),__decorate([serialize()],TargetCamera.prototype,"speed",void 0),__decorate([serializeAsMeshReference("lockedTargetId")],TargetCamera.prototype,"lockedTarget",void 0);var AutoRotationBehavior=class{set idleRotationSpinupTime(e){this._idleRotationSpinupTime=e}init(){}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get zoomStopsAnimation(){return this._zoomStopsAnimation}attach(e){this._attachedCamera=e;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver=t.onPrePointerObservable.add((e=>{e.type!==PointerEventTypes.POINTERDOWN?e.type===PointerEventTypes.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const e=PrecisionDate.Now;let t=0;null!=this._lastFrameTime&&(t=e-this._lastFrameTime),this._lastFrameTime=e,this._applyUserInteraction();const i=e-this._lastInteractionTime-this._idleRotationWaitTime,a=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*a,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(t/1e3))}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}get name(){return"AutoRotation"}get idleRotationWaitTime(){return this._idleRotationWaitTime}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=PrecisionDate.Now)}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Epsilon}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}set idleRotationWaitTime(e){this._idleRotationWaitTime=e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}set idleRotationSpeed(e){this._idleRotationSpeed=e}get idleRotationSpeed(){return this._idleRotationSpeed}resetLastInteractionTime(e){this._lastInteractionTime=e??PrecisionDate.Now}},EasingFunction=class e{getEasingMode(){return this._easingMode}setEasingMode(e){const t=Math.min(Math.max(e,0),2);this._easingMode=t}constructor(){this._easingMode=e.EASINGMODE_EASEIN}ease(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}easeInCore(e){throw new Error("You must implement this method")}};EasingFunction.EASINGMODE_EASEIN=0,EasingFunction.EASINGMODE_EASEOUT=1,EasingFunction.EASINGMODE_EASEINOUT=2;var BackEase=class extends EasingFunction{easeInCore(e){const t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)}constructor(e=1){super(),this.amplitude=e}},CubicEase=class extends EasingFunction{easeInCore(e){return e*e*e}},ElasticEase=class extends EasingFunction{constructor(e=3,t=3){super(),this.oscillations=e,this.springiness=t}easeInCore(e){let t;const i=Math.max(0,this.oscillations),a=Math.max(0,this.springiness);return t=0==a?e:(Math.exp(a*e)-1)/(Math.exp(a)-1),t*Math.sin((6.283185307179586*i+1.5707963267948966)*e)}},ExponentialEase=class extends EasingFunction{constructor(e=2){super(),this.exponent=e}easeInCore(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}},AnimationRange=class e{constructor(e,t,i){this.name=e,this.from=t,this.to=i}clone(){return new e(this.name,this.from,this.to)}},_staticOffsetValueQuaternion=Object.freeze(new Quaternion(0,0,0,0)),_staticOffsetValueVector3=Object.freeze(Vector3.Zero()),_staticOffsetValueVector2=Object.freeze(Vector2.Zero()),_staticOffsetValueSize=Object.freeze(Size.Zero()),_staticOffsetValueColor3=Object.freeze(Color3.Black()),_staticOffsetValueColor4=Object.freeze(new Color4(0,0,0,0)),evaluateAnimationState={key:0,repeatCount:0,loopMode:2},Animation=class e{addEvent(e){this._events.push(e),this._events.sort(((e,t)=>e.frame-t.frame))}clone(){const t=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges){t._ranges={};for(const e in this._ranges){const i=this._ranges[e];i&&(t._ranges[e]=i.clone())}}return t}matrixInterpolateFunction(t,i,a,n){return e.AllowMatrixDecomposeForInterpolation?n?(Matrix.DecomposeLerpToRef(t,i,a,n),n):Matrix.DecomposeLerp(t,i,a):n?(Matrix.LerpToRef(t,i,a,n),n):Matrix.Lerp(t,i,a)}static CreateAnimation(t,i,a,n){const s=new e(t+"Animation",t,a,i,e.ANIMATIONLOOPMODE_CONSTANT);return s.setEasingFunction(n),s}sizeInterpolateFunction(e,t,i){return Size.Lerp(e,t,i)}static TransitionTo(e,t,i,a,n,s,r,o=null){if(r<=0)return i[e]=t,o&&o(),null;const l=n*(r/1e3);s.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:l,value:t}]),i.animations||(i.animations=[]),i.animations.push(s);const c=a.beginAnimation(i,0,l,!1);return c.onAnimationEnd=o,c}setKeys(e,t=!1){this._keys=t?e:e.slice(0)}toString(e){let t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";let e=!0;for(const i in this._ranges)e&&(t+=", ",e=!1),t+=i;t+="}"}return t}get runtimeAnimations(){return this._runtimeAnimations}createKeyForFrame(e){evaluateAnimationState.key=0;const t=this._interpolate(e,evaluateAnimationState,!0);if(!t)return this._keys[evaluateAnimationState.key].frame===e?evaluateAnimationState.key:evaluateAnimationState.key+1;const i={frame:e,value:t.clone?t.clone():t};return this._keys.splice(evaluateAnimationState.key+1,0,i),evaluateAnimationState.key+1}createRange(e,t,i){this._ranges[e]||(this._ranges[e]=new AnimationRange(e,t,i))}static ParseFromSnippetAsync(e){return new Promise(((t,i)=>{const a=new WebRequest;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const i=JSON.parse(JSON.parse(a.responseText).jsonPayload);if(i.animations){const a=JSON.parse(i.animations),n=[];for(const t of a.animations){const i=this.Parse(t);i.snippetId=e,n.push(i)}t(n)}else{const a=JSON.parse(i.animation),n=this.Parse(a);n.snippetId=e,t(n)}}else i("Unable to load the snippet "+e)})),a.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),a.send()}))}floatInterpolateFunctionWithTangents(e,t,i,a,n){return Scalar.Hermite(e,t,i,a,n)}setEasingFunction(e){this._easingFunction=e}serialize(){const t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;const i=this.dataType;t.keys=[];const a=this.getKeys();for(let n=0;n<a.length;n++){const s=a[n],r={};switch(r.frame=s.frame,i){case e.ANIMATIONTYPE_FLOAT:r.values=[s.value],void 0!==s.inTangent&&r.values.push(s.inTangent),void 0!==s.outTangent&&(void 0===s.inTangent&&r.values.push(void 0),r.values.push(s.outTangent)),void 0!==s.interpolation&&(void 0===s.inTangent&&r.values.push(void 0),void 0===s.outTangent&&r.values.push(void 0),r.values.push(s.interpolation));break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:r.values=s.value.asArray(),null!=s.inTangent&&r.values.push(s.inTangent.asArray()),null!=s.outTangent&&(void 0===s.inTangent&&r.values.push(void 0),r.values.push(s.outTangent.asArray())),void 0!==s.interpolation&&(void 0===s.inTangent&&r.values.push(void 0),void 0===s.outTangent&&r.values.push(void 0),r.values.push(s.interpolation))}t.keys.push(r)}t.ranges=[];for(const e in this._ranges){const i=this._ranges[e];if(!i)continue;const a={};a.name=e,a.from=i.from,a.to=i.to,t.ranges.push(a)}return t}vector3InterpolateFunction(e,t,i){return Vector3.Lerp(e,t,i)}color3InterpolateFunction(e,t,i){return Color3.Lerp(e,t,i)}get hasRunningRuntimeAnimations(){for(const e of this._runtimeAnimations)if(!e.isStopped())return!0;return!1}getEvents(){return this._events}getHighestFrame(){let e=0;for(let t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e}color4InterpolateFunctionWithTangents(e,t,i,a,n){return Color4.Hermite(e,t,i,a,n)}vector3InterpolateFunctionWithTangents(e,t,i,a,n){return Vector3.Hermite(e,t,i,a,n)}vector2InterpolateFunctionWithTangents(e,t,i,a,n){return Vector2.Hermite(e,t,i,a,n)}vector2InterpolateFunction(e,t,i){return Vector2.Lerp(e,t,i)}static MakeAnimationAdditive(t,i,a,n=!1,s){let r;r="object"==typeof i?i:{referenceFrame:i??0,range:a,cloneOriginalAnimation:n,clonedAnimationName:s};let o=t;if(r.cloneOriginalAnimation&&(o=t.clone(),o.name=r.clonedAnimationName||o.name),!o._keys.length)return o;const l=r.referenceFrame&&r.referenceFrame>=0?r.referenceFrame:0;let c=0;const h=o._keys[0];let u=o._keys.length-1;const m=o._keys[u],d={referenceValue:h.value,referencePosition:TmpVectors.Vector3[0],referenceQuaternion:TmpVectors.Cc[0],referenceScaling:TmpVectors.Vector3[1],keyPosition:TmpVectors.Vector3[2],keyQuaternion:TmpVectors.Cc[1],keyScaling:TmpVectors.Vector3[3]};let f=h.frame,p=m.frame;if(r.range){const e=o.getRange(r.range);e&&(f=e.from,p=e.to)}else f=r.fromFrame??f,p=r.toFrame??p;if(f!==h.frame&&(c=o.createKeyForFrame(f)),p!==m.frame&&(u=o.createKeyForFrame(p)),1===o._keys.length){const e=o._getKeyValue(o._keys[0]);d.referenceValue=e.clone?e.clone():e}else if(l<=h.frame){const e=o._getKeyValue(h.value);d.referenceValue=e.clone?e.clone():e}else if(l>=m.frame){const e=o._getKeyValue(m.value);d.referenceValue=e.clone?e.clone():e}else{evaluateAnimationState.key=0;const e=o._interpolate(l,evaluateAnimationState);d.referenceValue=e.clone?e.clone():e}o.dataType===e.ANIMATIONTYPE_QUATERNION?d.referenceValue.normalize().conjugateInPlace():o.dataType===e.ANIMATIONTYPE_MATRIX&&(d.referenceValue.decompose(d.referenceScaling,d.referenceQuaternion,d.referencePosition),d.referenceQuaternion.normalize().conjugateInPlace());let _=Number.MAX_VALUE;const g=r.clipKeys?[]:null;for(let t=c;t<=u;t++){let i=o._keys[t];if((g||r.cloneOriginalAnimation)&&(i={frame:i.frame,value:i.value.clone?i.value.clone():i.value,inTangent:i.inTangent,outTangent:i.outTangent,interpolation:i.interpolation,lockedTangent:i.lockedTangent},g&&(_===Number.MAX_VALUE&&(_=i.frame),i.frame-=_,g.push(i))),!t||o.dataType===e.ANIMATIONTYPE_FLOAT||i.value!==h.value)switch(o.dataType){case e.ANIMATIONTYPE_MATRIX:i.value.decompose(d.keyScaling,d.keyQuaternion,d.keyPosition),d.keyPosition.subtractInPlace(d.referencePosition),d.keyScaling.divideInPlace(d.referenceScaling),d.referenceQuaternion.multiplyToRef(d.keyQuaternion,d.keyQuaternion),Matrix.ComposeToRef(d.keyScaling,d.keyQuaternion,d.keyPosition,i.value);break;case e.ANIMATIONTYPE_QUATERNION:d.referenceValue.multiplyToRef(i.value,i.value);break;case e.ANIMATIONTYPE_VECTOR2:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:i.value.subtractToRef(d.referenceValue,i.value);break;case e.ANIMATIONTYPE_SIZE:i.value.width-=d.referenceValue.width,i.value.height-=d.referenceValue.height;break;default:i.value-=d.referenceValue}}return g&&o.setKeys(g,!0),o}static CreateMergeAndStartAnimation(t,i,a,n,s,r,o,l,c,h){const u=e._PrepareAnimation(t,a,n,s,r,o,l,c);return u?(i.animations.push(u),i.getScene().beginAnimation(i,0,s,1===u.loopMode,1,h)):null}color4InterpolateFunction(e,t,i){return Color4.Lerp(e,t,i)}static Parse(t){const i=new e(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),a=t.dataType,n=[];let s,r;for(t.enableBlending&&(i.enableBlending=t.enableBlending),t.blendingSpeed&&(i.blendingSpeed=t.blendingSpeed),r=0;r<t.keys.length;r++){const i=t.keys[r];let o,l,c;switch(a){case e.ANIMATIONTYPE_FLOAT:s=i.values[0],i.values.length>=2&&(o=i.values[1]),i.values.length>=3&&(l=i.values[2]),i.values.length>=4&&(c=i.values[3]);break;case e.ANIMATIONTYPE_QUATERNION:if(s=Quaternion.FromArray(i.values),i.values.length>=8){const e=Quaternion.FromArray(i.values.slice(4,8));e.equals(Quaternion.Zero())||(o=e)}if(i.values.length>=12){const e=Quaternion.FromArray(i.values.slice(8,12));e.equals(Quaternion.Zero())||(l=e)}i.values.length>=13&&(c=i.values[12]);break;case e.ANIMATIONTYPE_MATRIX:s=Matrix.FromArray(i.values),i.values.length>=17&&(c=i.values[16]);break;case e.ANIMATIONTYPE_COLOR3:s=Color3.FromArray(i.values),i.values[3]&&(o=Color3.FromArray(i.values[3])),i.values[4]&&(l=Color3.FromArray(i.values[4])),i.values[5]&&(c=i.values[5]);break;case e.ANIMATIONTYPE_COLOR4:s=Color4.FromArray(i.values),i.values[4]&&(o=Color4.FromArray(i.values[4])),i.values[5]&&(l=Color4.FromArray(i.values[5])),i.values[6]&&(c=Color4.FromArray(i.values[6]));break;case e.ANIMATIONTYPE_VECTOR3:default:s=Vector3.FromArray(i.values),i.values[3]&&(o=Vector3.FromArray(i.values[3])),i.values[4]&&(l=Vector3.FromArray(i.values[4])),i.values[5]&&(c=i.values[5])}const h={};h.frame=i.frame,h.value=s,null!=o&&(h.inTangent=o),null!=l&&(h.outTangent=l),null!=c&&(h.interpolation=c),n.push(h)}if(i.setKeys(n),t.ranges)for(r=0;r<t.ranges.length;r++)s=t.ranges[r],i.createRange(s.name,s.from,s.to);return i}getRange(e){return this._ranges[e]}floatInterpolateFunction(e,t,i){return Scalar.Lerp(e,t,i)}static CreateAndStartAnimation(t,i,a,n,s,r,o,l,c,h,u){const m=e._PrepareAnimation(t,a,n,s,r,o,l,c);return m?(i.getScene&&(u=i.getScene()),u?u.beginDirectAnimation(i,[m],0,s,1===m.loopMode,1,h):null):null}static CreateAndStartHierarchyAnimation(t,i,a,n,s,r,o,l,c,h,u){const m=e._PrepareAnimation(t,n,s,r,o,l,c,h);if(!m)return null;return i.getScene().beginDirectHierarchyAnimation(i,a,[m],0,r,1===m.loopMode,1,u)}quaternionInterpolateFunctionWithTangents(e,t,i,a,n){return Quaternion.Hermite(e,t,i,a,n).normalize()}getEasingFunction(){return this._easingFunction}evaluate(e){return evaluateAnimationState.key=0,this._interpolate(e,evaluateAnimationState)}static _UniversalLerp(e,t,i){const a=e.constructor;return a.Lerp?a.Lerp(e,t,i):a.Slerp?a.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t}static AppendSerializedAnimations(e,t){SerializationHelper.AppendSerializedAnimations(e,t)}constructor(t,i,a,n,s,r){this.name=t,this.targetProperty=i,this.framePerSecond=a,this.dataType=n,this.loopMode=s,this.enableBlending=r,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=i.split("."),this.dataType=n,this.loopMode=void 0===s?e.ANIMATIONLOOPMODE_CYCLE:s,this.Hc=e._UniqueIdGenerator++}getKeys(){return this._keys}static ParseFromFileAsync(e,t){return new Promise(((i,a)=>{const n=new WebRequest;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){let t=JSON.parse(n.responseText);if(t.animations&&(t=t.animations),t.length){const e=[];for(const i of t)e.push(this.Parse(i));i(e)}else{const a=this.Parse(t);e&&(a.name=e),i(a)}}else a("Unable to load the animation")})),n.open("GET",t),n.send()}))}_interpolate(t,i,a=!1){if(i.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&i.repeatCount>0)return i.highLimitValue.clone?i.highLimitValue.clone():i.highLimitValue;const n=this._keys,s=n.length;let r=i.key;for(;r>=0&&t<n[r].frame;)--r;for(;r+1<=s-1&&t>=n[r+1].frame;)++r;if(i.key=r,r<0)return a?void 0:this._getKeyValue(n[0].value);if(r+1>s-1)return a?void 0:this._getKeyValue(n[s-1].value);const o=n[r],l=n[r+1];if(a&&(t===o.frame||t===l.frame))return;const c=this._getKeyValue(o.value),h=this._getKeyValue(l.value);if(1===o.interpolation)return l.frame>t?c:h;const u=void 0!==o.outTangent&&void 0!==l.inTangent,m=l.frame-o.frame;let d=(t-o.frame)/m;const f=o.easingFunction||this.getEasingFunction();switch(null!==f&&(d=f.ease(d)),this.dataType){case e.ANIMATIONTYPE_FLOAT:{const t=u?this.floatInterpolateFunctionWithTangents(c,o.outTangent*m,h,l.inTangent*m,d):this.floatInterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(i.offsetValue??0)*i.repeatCount+t}break}case e.ANIMATIONTYPE_QUATERNION:{const t=u?this.quaternionInterpolateFunctionWithTangents(c,o.outTangent.scale(m),h,l.inTangent.scale(m),d):this.quaternionInterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.addInPlace((i.offsetValue||_staticOffsetValueQuaternion).scale(i.repeatCount))}return t}case e.ANIMATIONTYPE_VECTOR3:{const t=u?this.vector3InterpolateFunctionWithTangents(c,o.outTangent.scale(m),h,l.inTangent.scale(m),d):this.vector3InterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||_staticOffsetValueVector3).scale(i.repeatCount))}break}case e.ANIMATIONTYPE_VECTOR2:{const t=u?this.vector2InterpolateFunctionWithTangents(c,o.outTangent.scale(m),h,l.inTangent.scale(m),d):this.vector2InterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||_staticOffsetValueVector2).scale(i.repeatCount))}break}case e.ANIMATIONTYPE_SIZE:switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(c,h,d);case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(c,h,d).add((i.offsetValue||_staticOffsetValueSize).scale(i.repeatCount))}break;case e.ANIMATIONTYPE_COLOR3:{const t=u?this.color3InterpolateFunctionWithTangents(c,o.outTangent.scale(m),h,l.inTangent.scale(m),d):this.color3InterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||_staticOffsetValueColor3).scale(i.repeatCount))}break}case e.ANIMATIONTYPE_COLOR4:{const t=u?this.color4InterpolateFunctionWithTangents(c,o.outTangent.scale(m),h,l.inTangent.scale(m),d):this.color4InterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||_staticOffsetValueColor4).scale(i.repeatCount))}break}case e.ANIMATIONTYPE_MATRIX:switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return e.AllowMatricesInterpolation?this.matrixInterpolateFunction(c,h,d,i.workValue):c;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return c}}return 0}_getKeyValue(e){return"function"==typeof e?e():e}color3InterpolateFunctionWithTangents(e,t,i,a,n){return Color3.Hermite(e,t,i,a,n)}static _PrepareAnimation(t,i,a,n,s,r,o,l){let c;if(!isNaN(parseFloat(s))&&isFinite(s)?c=e.ANIMATIONTYPE_FLOAT:s instanceof Quaternion?c=e.ANIMATIONTYPE_QUATERNION:s instanceof Vector3?c=e.ANIMATIONTYPE_VECTOR3:s instanceof Vector2?c=e.ANIMATIONTYPE_VECTOR2:s instanceof Color3?c=e.ANIMATIONTYPE_COLOR3:s instanceof Color4?c=e.ANIMATIONTYPE_COLOR4:s instanceof Size&&(c=e.ANIMATIONTYPE_SIZE),null==c)return null;const h=new e(t,i,a,c,o),u=[{frame:0,value:s},{frame:n,value:r}];return h.setKeys(u),void 0!==l&&h.setEasingFunction(l),h}deleteRange(e,t=!0){const i=this._ranges[e];if(i){if(t){const e=i.from,t=i.to;for(let i=this._keys.length-1;i>=0;i--)this._keys[i].frame>=e&&this._keys[i].frame<=t&&this._keys.splice(i,1)}this._ranges[e]=null}}quaternionInterpolateFunction(e,t,i){return Quaternion.Slerp(e,t,i)}removeEvents(e){for(let t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)}};Animation._UniqueIdGenerator=0,Animation.AllowMatricesInterpolation=!1,Animation.AllowMatrixDecomposeForInterpolation=!0,Animation.SnippetUrl="https://snippet.babylonjs.com",Animation.ANIMATIONTYPE_FLOAT=0,Animation.ANIMATIONTYPE_VECTOR3=1,Animation.ANIMATIONTYPE_QUATERNION=2,Animation.ANIMATIONTYPE_MATRIX=3,Animation.ANIMATIONTYPE_COLOR3=4,Animation.ANIMATIONTYPE_COLOR4=7,Animation.ANIMATIONTYPE_VECTOR2=5,Animation.ANIMATIONTYPE_SIZE=6,Animation.ANIMATIONLOOPMODE_RELATIVE=0,Animation.ANIMATIONLOOPMODE_CYCLE=1,Animation.ANIMATIONLOOPMODE_CONSTANT=2,Animation.ANIMATIONLOOPMODE_YOYO=4,Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,Animation.CreateFromSnippetAsync=Animation.ParseFromSnippetAsync,RegisterClass("BABYLON.Animation",Animation),Node._AnimationRangeFactory=(e,t,i)=>new AnimationRange(e,t,i);var BouncingBehavior=class e{stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}_applyBoundRadiusAnimation(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=Animation.CreateAnimation("radius",Animation.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const i=Animation.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));i&&this._animatables.push(i)}get autoTransitionRange(){return this._autoTransitionRange}_isRadiusAtLimit(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)}set autoTransitionRange(e){if(this._autoTransitionRange===e)return;this._autoTransitionRange=e;const t=this._attachedCamera;t&&(e?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((e=>{if(e&&(e.computeWorldMatrix(!0),e.getBoundingInfo)){const t=e.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*t,this.upperRadiusTransitionRange=.05*t}})):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}get name(){return"Bouncing"}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}init(){}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}attach(e){this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}};BouncingBehavior.EasingFunction=new BackEase(.3),BouncingBehavior.EasingMode=EasingFunction.EASINGMODE_EASEOUT;var FramingBehavior=class e{set positionScale(e){this._positionScale=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set radiusScale(e){this._radiusScale=e}get radiusScale(){return this._radiusScale}zoomOnMeshesHierarchy(e,t=!1,i=null){const a=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let t=0;t<e.length;t++){const i=e[t].getHierarchyBoundingVectors(!0);Vector3.CheckExtends(i.min,a,n),Vector3.CheckExtends(i.max,a,n)}this.zoomOnBoundingInfo(a,n,t,i)}zoomOnBoundingInfo(t,i,a=!1,n=null){let s;if(!this._attachedCamera)return!1;const r=t.y,o=r+(i.y-r)*this._positionScale,l=i.subtract(t).scale(.5);if(a)s=new Vector3(0,o,0);else{const e=t.add(l);s=new Vector3(e.x,o,e.z)}this._vectorTransition||(this._vectorTransition=Animation.CreateAnimation("target",Animation.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;let c=Animation.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);c&&this._animatables.push(c);let h=0;if(this._mode===e.FitFrustumSidesMode){const e=this._calculateLowerRadiusFromModelBoundingSphere(t,i);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=l.length()+this._attachedCamera.minZ),h=e}else this._mode===e.IgnoreBoundsSizeMode&&(h=this._calculateLowerRadiusFromModelBoundingSphere(t,i),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const e=i.subtract(t).length();this._attachedCamera.panningSensibility=5e3/e,this._attachedCamera.wheelPrecision=100/h}return this._radiusTransition||(this._radiusTransition=Animation.CreateAnimation("radius",Animation.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),c=Animation.TransitionTo("radius",h,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),n&&n(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),c&&this._animatables.push(c),!0}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}set defaultElevation(e){this._defaultElevation=e}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get positionScale(){return this._positionScale}set elevationReturnWaitTime(e){this._elevationReturnWaitTime=e}zoomOnMesh(e,t=!1,i=null){e.computeWorldMatrix(!0);const a=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(a.minimumWorld,a.maximumWorld,t,i)}_clearAnimationLocks(){this._betaIsAnimating=!1}get defaultElevation(){return this._defaultElevation}get name(){return"Framing"}set framingTime(e){this._framingTime=e}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}set mode(e){this._mode=e}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const t=PrecisionDate.Now-this._lastInteractionTime,i=.5*Math.PI-this._defaultElevation,a=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>a&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Animation.CreateAnimation("beta",Animation.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));const t=Animation.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));t&&this._animatables.push(t)}}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}get framingTime(){return this._framingTime}constructor(){this.onTargetFramingAnimationEndObservable=new Observable,this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get elevationReturnTime(){return this._elevationReturnTime}_calculateLowerRadiusFromModelBoundingSphere(t,i){const a=this._attachedCamera;if(!a)return 0;let n=a._calculateLowerRadiusFromModelBoundingSphere(t,i,this._radiusScale);return a.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(n=n<a.lowerRadiusLimit?a.lowerRadiusLimit:n),a.upperRadiusLimit&&(n=n>a.upperRadiusLimit?a.upperRadiusLimit:n),n}init(){}get mode(){return this._mode}set elevationReturnTime(e){this._elevationReturnTime=e}attach(t){this._attachedCamera=t;const i=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add((e=>{e.type!==PointerEventTypes.POINTERDOWN?e.type===PointerEventTypes.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((e=>{e&&e.getBoundingInfo&&this.zoomOnMesh(e,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}zoomOnMeshHierarchy(e,t=!1,i=null){e.computeWorldMatrix(!0);const a=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(a.min,a.max,t,i)}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=PrecisionDate.Now,this.stopAllAnimations(),this._clearAnimationLocks())}};FramingBehavior.EasingFunction=new ExponentialEase,FramingBehavior.EasingMode=EasingFunction.EASINGMODE_EASEINOUT,FramingBehavior.IgnoreBoundsSizeMode=0,FramingBehavior.FitFrustumSidesMode=1;var CameraInputTypes={},CameraInputsManager=class{detachElement(e=!1){for(const t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const e in this.attached){const t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}attachInput(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}_addCheckInputs(e){const t=this.checkInputs;return()=>{t(),e()}}constructor(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=()=>{}}add(e){const t=e.getSimpleName();this.attached[t]?Logger.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault))}attachElement(e=!1){if(!this.attachedToElement){e=!Camera.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e;for(const t in this.attached)this.attached[t].attachControl(e)}}remove(e){for(const t in this.attached){const i=this.attached[t];if(i===e)return i.detachControl(),i.camera=null,delete this.attached[t],void this.rebuildInputCheck()}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}removeByType(e){for(const t in this.attached){const i=this.attached[t];i.getClassName()===e&&(i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}}serialize(e){const t={};for(const e in this.attached){const i=this.attached[e],a=SerializationHelper.Serialize(i);t[i.getClassName()]=a}e.inputsmgr=t}parse(e){const t=e.inputsmgr;if(t){this.clear();for(const e in t){const i=CameraInputTypes[e];if(i){const a=t[e],n=SerializationHelper.Parse((()=>new i),a,null);this.add(n)}}}else for(const t in this.attached){const i=CameraInputTypes[this.attached[t].getClassName()];if(i){const a=SerializationHelper.Parse((()=>new i),e,null);this.remove(this.attached[t]),this.add(a)}}}},BaseCameraPointersInput=class{attachControl(e){e=Tools.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();let a=0,n=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=s=>{const r=s.event,o="touch"===r.pointerType;if(s.type!==PointerEventTypes.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const l=r.target;if(this._altKey=r.altKey,this._ctrlKey=r.ctrlKey,this._metaKey=r.metaKey,this._shiftKey=r.shiftKey,this._buttonsPressed=r.buttons,t.isPointerLock){const e=r.movementX,t=r.movementY;this.onTouch(null,e,t),this._pointA=null,this._pointB=null}else{if(s.type!==PointerEventTypes.POINTERDOWN&&s.type!==PointerEventTypes.POINTERDOUBLETAP&&o&&this._pointA?.pointerId!==r.pointerId&&this._pointB?.pointerId!==r.pointerId)return;if(s.type!==PointerEventTypes.POINTERDOWN||-1!==this._currentActiveButton&&!o)if(s.type===PointerEventTypes.POINTERDOUBLETAP)this.onDoubleTap(r.pointerType);else if(s.type!==PointerEventTypes.POINTERUP||this._currentActiveButton!==r.button&&!o){if(s.type===PointerEventTypes.POINTERMOVE)if(e||r.preventDefault(),this._pointA&&null===this._pointB){const e=r.clientX-this._pointA.x,t=r.clientY-this._pointA.y;this._pointA.x=r.clientX,this._pointA.y=r.clientY,this.onTouch(this._pointA,e,t)}else if(this._pointA&&this._pointB){const e=this._pointA.pointerId===r.pointerId?this._pointA:this._pointB;e.x=r.clientX,e.y=r.clientY;const t=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,o=t*t+i*i,l={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:r.pointerId,type:s.type};this.onMultiTouch(this._pointA,this._pointB,a,o,n,l),n=l,a=o}}else{try{l?.releasePointerCapture(r.pointerId)}catch(e){}o||(this._pointB=null),t._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==r.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==r.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==a||n)&&(this.onMultiTouch(this._pointA,this._pointB,a,0,n,null),a=0,n=null),this._currentActiveButton=-1,this.onButtonUp(r),e||r.preventDefault()}else{try{l?.setPointerCapture(r.pointerId)}catch(e){}if(null===this._pointA)this._pointA={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType};else{if(null!==this._pointB)return;this._pointB={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}}-1!==this._currentActiveButton||o||(this._currentActiveButton=r.button),this.onButtonDown(r),e||(r.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,PointerEventTypes.POINTERDOWN|PointerEventTypes.POINTERUP|PointerEventTypes.POINTERMOVE|PointerEventTypes.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,a=0,n=null,this.onLostFocus()},this._contextMenuBind=e=>this.onContextMenu(e),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const s=this.camera.getScene().getEngine().getHostWindow();s&&Tools.RegisterTopRootEvents(s,[{name:"blur",handler:this._onLostFocus}])}onContextMenu(e){e.preventDefault()}onTouch(e,t,i){}onMultiTouch(e,t,i,a,n,s){}getClassName(){return"BaseCameraPointersInput"}onLostFocus(){}getSimpleName(){return"pointers"}constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}onButtonUp(e){}onDoubleTap(e){}onButtonDown(e){}detachControl(){if(this._onLostFocus){const e=this.camera.getScene().getEngine().getHostWindow();e&&Tools.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const e=this.camera.getScene().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}};__decorate([serialize()],BaseCameraPointersInput.prototype,"buttons",void 0);var ArcRotateCameraPointersInput=class e extends BaseCameraPointersInput{onButtonDown(e){this._isPanClick=e.button===this.camera._panningMouseButton}getClassName(){return"ArcRotateCameraPointersInput"}onTouch(e,t,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}_computeMultiTouchPanning(e,t){if(0!==this.panningSensibility&&e&&t){const i=t.x-e.x,a=t.y-e.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=a/this.panningSensibility}}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onButtonUp(e){this._twoFingerActivityCount=0,this._isPinching=!1}constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}_computePinchZoom(t,i){const a=this.camera.radius||e.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=a*Math.sqrt(t)/Math.sqrt(i):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(i-t)*a*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(i-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}onMultiTouch(e,t,i,a,n,s){0===i&&null===n||0===a&&null===s||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,a),this._computeMultiTouchPanning(n,s)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(a)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,a),this._isPinching=!0):this._computeMultiTouchPanning(n,s)):this.multiTouchPanning?this._computeMultiTouchPanning(n,s):this.pinchZoom&&this._computePinchZoom(i,a))}};ArcRotateCameraPointersInput.MinimumRadiusForPinch=.001,__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"buttons",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"angularSensibilityX",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"angularSensibilityY",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"pinchPrecision",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"pinchDeltaPercentage",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"useNaturalPinchZoom",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"pinchZoom",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"panningSensibility",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"multiTouchPanning",void 0),__decorate([serialize()],ArcRotateCameraPointersInput.prototype,"multiTouchPanAndZoom",void 0),CameraInputTypes.ArcRotateCameraPointersInput=ArcRotateCameraPointersInput;var ArcRotateCameraKeyboardMoveInput=class{getSimpleName(){return"keyboard"}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}}}attachControl(e){e=Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const i=t.event;if(!i.metaKey)if(t.type===KeyboardEventTypes.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(e||i.preventDefault())}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),i.preventDefault&&(e||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}};__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysUp",void 0),__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysDown",void 0),__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysLeft",void 0),__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysRight",void 0),__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysReset",void 0),__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"panningSensibility",void 0),__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"zoomingSensibility",void 0),__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"useAltToZoom",void 0),__decorate([serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"angularSpeed",void 0),CameraInputTypes.ArcRotateCameraKeyboardMoveInput=ArcRotateCameraKeyboardMoveInput;var ffMultiplier=40,ArcRotateCameraMouseWheelInput=class{_updateHitPlane(){const e=this.camera,t=e.target.subtract(e.position);this._hitPlane=Plane.FromPositionAndNormal(e.target,t)}getSimpleName(){return"mousewheel"}_zoomToMouse(e){const t=this.camera,i=1-t.inertia;if(t.lowerRadiusLimit){const a=t.lowerRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i<a&&(e=(t.radius-a)*i-t.inertialRadiusOffset)}if(t.upperRadiusLimit){const a=t.upperRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i>a&&(e=(t.radius-a)*i-t.inertialRadiusOffset)}const a=e/i/t.radius,n=this._getPosition(),s=TmpVectors.Vector3[6];n.subtractToRef(t.target,s),s.scaleInPlace(a),s.scaleInPlace(i),this._inertialPanning.addInPlace(s),t.inertialRadiusOffset+=e}getClassName(){return"ArcRotateCameraMouseWheelInput"}constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Vector3(0,0,0),this._globalOffset=new Vector3(0,0,0),this._inertialPanning=Vector3.Zero()}_getPosition(){const e=this.camera,t=e.getScene(),i=t.createPickingRay(t.pointerX,t.pointerY,Matrix.Identity(),e,!1);0===e.targetScreenOffset.x&&0===e.targetScreenOffset.y||(this._viewOffset.set(e.targetScreenOffset.x,e.targetScreenOffset.y,0),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),this._globalOffset=Vector3.TransformNormal(this._viewOffset,e._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let a=0;return this._hitPlane&&(a=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(a))}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}_computeDeltaFromMouseWheelLegacyEvent(e,t){let i=0;const a=.01*e*this.wheelDeltaPercentage*t;return i=e>0?a/(1+this.wheelDeltaPercentage):a*(1+this.wheelDeltaPercentage),i}_zeroIfClose(e){Math.abs(e.x)<Epsilon&&(e.x=0),Math.abs(e.y)<Epsilon&&(e.y=0),Math.abs(e.z)<Epsilon&&(e.z=0)}attachControl(e){e=Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==PointerEventTypes.POINTERWHEEL)return;const i=t.event;let a=0;const n=i.deltaMode===EventConstants.DOM_DELTA_LINE?ffMultiplier:1,s=-i.deltaY*n;if(this.customComputeDeltaFromMouseWheel)a=this.customComputeDeltaFromMouseWheel(s,this,i);else if(this.wheelDeltaPercentage){if(a=this._computeDeltaFromMouseWheelLegacyEvent(s,this.camera.radius),a>0){let e=this.camera.radius,t=this.camera.inertialRadiusOffset+a;for(let i=0;i<20&&Math.abs(t)>.001;i++)e-=t,t*=this.camera.inertia;e=Scalar.Clamp(e,0,Number.MAX_VALUE),a=this._computeDeltaFromMouseWheelLegacyEvent(s,e)}}else a=s/(40*this.wheelPrecision);a&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(a)):this.camera.inertialRadiusOffset+=a),i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,PointerEventTypes.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}};__decorate([serialize()],ArcRotateCameraMouseWheelInput.prototype,"wheelPrecision",void 0),__decorate([serialize()],ArcRotateCameraMouseWheelInput.prototype,"zoomToMouseLocation",void 0),__decorate([serialize()],ArcRotateCameraMouseWheelInput.prototype,"wheelDeltaPercentage",void 0),CameraInputTypes.ArcRotateCameraMouseWheelInput=ArcRotateCameraMouseWheelInput;var ArcRotateCameraInputsManager=class extends CameraInputsManager{addKeyboard(){return this.add(new ArcRotateCameraKeyboardMoveInput),this}constructor(e){super(e)}addMouseWheel(){return this.add(new ArcRotateCameraMouseWheelInput),this}addPointers(){return this.add(new ArcRotateCameraPointersInput),this}};Node.AddNodeConstructor("ArcRotateCamera",((e,t)=>()=>new ArcRotateCamera(e,0,0,1,Vector3.Zero(),t)));var ArcRotateCamera=class e extends TargetCamera{get framingBehavior(){return this._framingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const e=this._scene.getEngine().getDeltaTime()/1e3,t=1-Math.pow(2,-e/this.restoreStateInterpolationFactor);this.setTarget(Vector3.Lerp(this.getTarget(),this._storedTarget,t)),Quaternion.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,TmpVectors.Cc[0]),Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,TmpVectors.Cc[1]),Quaternion.SlerpToRef(TmpVectors.Cc[1],TmpVectors.Cc[0],t,TmpVectors.Cc[2]),TmpVectors.Cc[2].normalize(),TmpVectors.Cc[2].toAlphaBetaGammaToRef(TmpVectors.Vector3[0]),this.alpha=TmpVectors.Vector3[0].x,this.beta=TmpVectors.Vector3[0].y,this.radius+=(this._storedRadius-this.radius)*t,Vector2.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,t,this.targetScreenOffset),(Vector3.DistanceSquared(this.getTarget(),this._storedTarget)<Epsilon&&TmpVectors.Cc[2].equalsWithEpsilon(TmpVectors.Cc[0])&&Math.pow(this._storedRadius-this.radius,2)<Epsilon&&Vector2.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<Epsilon||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const e=this.invertRotation?-1:1,t=this._calculateHandednessMultiplier();let i=this.inertialAlphaOffset*t;this.beta<0&&(i*=-1),this.alpha+=i*e,this.beta+=this.inertialBetaOffset*e,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Epsilon&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const e=new Vector3(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.multiplyInPlace(this.panningAxis),Vector3.TransformNormalToRef(e,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const e=this.upVector,t=Vector3.CrossToRef(this._transformedDirection,e,this._transformedDirection);Vector3.CrossToRef(e,t,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Vector3.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else{if(this.parent){const e=TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.transposeToRef(e),Vector3.TransformCoordinatesToRef(this._transformedDirection,e,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Epsilon&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}getTarget(){return this.target}get targetHost(){return this._targetHost}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Epsilon&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}get pinchPrecision(){const e=this.inputs.attached.pointers;return e?e.pinchPrecision:0}setMatUp(){Matrix.RotationAlignToRef(Vector3.UpReadOnly,this._upVector,this._yToUpMatrix),Matrix.RotationAlignToRef(this._upVector,Vector3.UpReadOnly,this._upToYMatrix)}set wheelPrecision(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)}get wheelPrecision(){const e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0}set useFramingBehavior(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new FramingBehavior,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}set useBouncingBehavior(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new BouncingBehavior,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}set panningSensibility(e){const t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)}_getViewMatrix(){const e=Math.cos(this.alpha),t=Math.sin(this.alpha),i=Math.cos(this.beta);let a=Math.sin(this.beta);0===a&&(a=1e-4),0===this.radius&&(this.radius=1e-4);const n=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*a,this.radius*i,this.radius*t*a),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Vector3.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),n.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const e=this.getScene().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,e.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.Hc)}else{this._position.copyFrom(this._newPosition);let e=this.upVector;this.allowUpsideDown&&a<0&&(e=e.negate()),this._computeViewMatrix(this._position,n,e),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=n,this._viewMatrix}_updateCache(e){e||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}get position(){return this._position}attachControl(e,t,i=!0,a=2){const n=arguments;t=Tools.BackCompatCameraNoPreventDefault(n),this._useCtrlForPanning=i,this._panningMouseButton=a,"boolean"==typeof n[0]&&(n.length>1&&(this._useCtrlForPanning=n[1]),n.length>2&&(this._panningMouseButton=n[2])),this.inputs.attachElement(t),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set targetHost(e){e&&this.setTarget(e)}get angularSensibilityY(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0}createRigCamera(t,i){let a=0;switch(this.cameraRigMode){case Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:case Camera.RIG_MODE_VR:a=this._cameraRigParams.stereoHalfAngle*(0===i?1:-1);break;case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:a=this._cameraRigParams.stereoHalfAngle*(0===i?-1:1)}const n=new e(t,this.alpha+a,this.beta,this.radius,this._target,this.getScene());return n._cameraRigParams={},n.isRigCamera=!0,n.rigParent=this,n.upVector=this.upVector,n.mode=this.mode,n.orthoLeft=this.orthoLeft,n.orthoRight=this.orthoRight,n.orthoBottom=this.orthoBottom,n.orthoTop=this.orthoTop,n}get zoomToMouseLocation(){const e=this.inputs.attached.mousewheel;return!!e&&e.zoomToMouseLocation}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:case Camera.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}set position(e){this.setPosition(e)}set angularSensibilityY(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}set useNaturalPinchZoom(e){const t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)}get wheelDeltaPercentage(){const e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0}set useAutoRotationBehavior(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new AutoRotationBehavior,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}getClassName(){return"ArcRotateCamera"}set upVector(e){this._upToYMatrix||(this._yToUpMatrix=new Matrix,this._upToYMatrix=new Matrix,this._upVector=Vector3.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()}set pinchPrecision(e){const t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}get angularSensibilityX(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0}_calculateLowerRadiusFromModelBoundingSphere(e,t,i=1){const a=Vector3.Distance(e,t),n=this.getScene().getEngine().getAspectRatio(this),s=Math.tan(this.undefinedc/2),r=s*n,o=.5*a*i,l=o*Math.sqrt(1+1/(r*r)),c=o*Math.sqrt(1+1/(s*s));return Math.max(l,c)}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}set target(e){this.setTarget(e)}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}setTarget(e,t=!1,i=!1,a=!1){if(a=this.overrideCloneAlphaBetaRadius??a,e.computeWorldMatrix)t&&e.getBoundingInfo?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const t=e,a=this._getTargetPosition();if(a&&!i&&a.equals(t))return;this._targetHost=null,this._target=t,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}a||this.rebuildAnglesAndRadius()}set pinchDeltaPercentage(e){const t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Vector3.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const e=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const t=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}get panningSensibility(){const e=this.inputs.attached.pointers;return e?e.panningSensibility:0}set wheelDeltaPercentage(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}const e=this._getLockedTargetPosition();return e||this._target}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}setPosition(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())}get pinchDeltaPercentage(){const e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0}dispose(){this.inputs.clear(),super.dispose()}constructor(e,t,i,a,n,s,r=!0){super(e,Vector3.Zero(),s,r),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Vector3.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new Matrix,this.panningAxis=new Vector3(1,1,0),this._transformedDirection=new Vector3,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new Observable,this.checkCollisions=!1,this.collisionRadius=new Vector3(.5,.5,.5),this._previousPosition=Vector3.Zero(),this._collisionVelocity=Vector3.Zero(),this._newPosition=Vector3.Zero(),this._computationVector=Vector3.Zero(),this._onCollisionPositionChange=(e,t,i=null)=>{i?(this.setPosition(t),this.onCollide&&this.onCollide(i)):this._previousPosition.copyFrom(this._position);const a=Math.cos(this.alpha),n=Math.sin(this.alpha),s=Math.cos(this.beta);let r=Math.sin(this.beta);0===r&&(r=1e-4);const o=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*a*r,this.radius*s,this.radius*n*r),o.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let l=this.upVector;this.allowUpsideDown&&this.beta<0&&(l=l.clone(),l=l.negate()),this._computeViewMatrix(this._position,o,l),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=Vector3.Zero(),n&&this.setTarget(n),this.alpha=t,this.beta=i,this.radius=a,this.getViewMatrix(),this.inputs=new ArcRotateCameraInputsManager(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}get bouncingBehavior(){return this._bouncingBehavior}focusOn(e,t=!1){let i,a;if(void 0===e.min){const t=e||this.getScene().meshes;i=Mesh.MinMax(t),a=Vector3.Distance(i.min,i.max)}else{i=e,a=e.distance}this._target=Mesh.Center(i),t||(this.maxZ=2*a)}zoomOn(e,t=!1){e=e||this.getScene().meshes;const i=Mesh.MinMax(e);let a=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);a=Math.max(Math.min(a,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=a*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:a},t)}set angularSensibilityX(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)}get target(){return this._target}get useNaturalPinchZoom(){const e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom}get useFramingBehavior(){return null!=this._framingBehavior}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}get upVector(){return this._upVector}set zoomToMouseLocation(e){const t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=e)}_initCache(){super._initCache(),this._cache._target=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Vector2.Zero()}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}};__decorate([serialize()],ArcRotateCamera.prototype,"alpha",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"beta",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"radius",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"overrideCloneAlphaBetaRadius",void 0),__decorate([serializeAsVector3("target")],ArcRotateCamera.prototype,"_target",void 0),__decorate([serializeAsMeshReference("targetHost")],ArcRotateCamera.prototype,"_targetHost",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"inertialAlphaOffset",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"inertialBetaOffset",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"inertialRadiusOffset",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"lowerAlphaLimit",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"upperAlphaLimit",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"lowerBetaLimit",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"upperBetaLimit",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"lowerRadiusLimit",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"upperRadiusLimit",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"inertialPanningX",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"inertialPanningY",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"pinchToPanMaxDistance",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"panningDistanceLimit",void 0),__decorate([serializeAsVector3()],ArcRotateCamera.prototype,"panningOriginTarget",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"panningInertia",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"zoomToMouseLocation",null),__decorate([serialize()],ArcRotateCamera.prototype,"zoomOnFactor",void 0),__decorate([serializeAsVector2()],ArcRotateCamera.prototype,"targetScreenOffset",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"allowUpsideDown",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"useInputToRestoreState",void 0),__decorate([serialize()],ArcRotateCamera.prototype,"restoreStateInterpolationFactor",void 0),RegisterClass("BABYLON.ArcRotateCamera",ArcRotateCamera);var FreeCameraKeyboardMoveInput=class{getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}_getLocalRotation(){const e=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*e}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t],a=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?e._localDirection.copyFromFloats(-a,0,0):-1!==this.keysUp.indexOf(i)?e._localDirection.copyFromFloats(0,0,a):-1!==this.keysRight.indexOf(i)?e._localDirection.copyFromFloats(a,0,0):-1!==this.keysDown.indexOf(i)?e._localDirection.copyFromFloats(0,0,-a):-1!==this.keysUpward.indexOf(i)?e._localDirection.copyFromFloats(0,a,0):-1!==this.keysDownward.indexOf(i)?e._localDirection.copyFromFloats(0,-a,0):-1!==this.keysRotateLeft.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x+=this._getLocalRotation()),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),Vector3.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}getSimpleName(){return"keyboard"}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(e){e=Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const i=t.event;if(!i.metaKey)if(t.type===KeyboardEventTypes.KEYDOWN){if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),e||i.preventDefault()}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){const t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),e||i.preventDefault()}})))}};__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysUp",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysUpward",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysDown",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysDownward",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysLeft",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRight",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"rotationSpeed",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRotateLeft",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRotateRight",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRotateUp",void 0),__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRotateDown",void 0),CameraInputTypes.FreeCameraKeyboardMoveInput=FreeCameraKeyboardMoveInput;var FreeCameraMouseInput=class{onContextMenu(e){e.preventDefault()}constructor(e=!0){this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Observable,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}getClassName(){return"FreeCameraMouseInput"}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}attachControl(e){e=Tools.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();this._pointerInput||(this._pointerInput=a=>{const n=a.event,s="touch"===n.pointerType;if(!this.touchEnabled&&s)return;if(a.type!==PointerEventTypes.POINTERMOVE&&-1===this.buttons.indexOf(n.button))return;const r=n.target;if(a.type===PointerEventTypes.POINTERDOWN){if(s&&-1!==this._activePointerId||!s&&-1!==this._currentActiveButton)return;this._activePointerId=n.pointerId;try{r?.setPointerCapture(n.pointerId)}catch(e){}-1===this._currentActiveButton&&(this._currentActiveButton=n.button),this._previousPosition={x:n.clientX,y:n.clientY},e||(n.preventDefault(),i&&i.focus()),t.isPointerLock&&this._onMouseMove&&this._onMouseMove(a.event)}else if(a.type===PointerEventTypes.POINTERUP){if(s&&this._activePointerId!==n.pointerId||!s&&this._currentActiveButton!==n.button)return;try{r?.releasePointerCapture(n.pointerId)}catch(e){}this._currentActiveButton=-1,this._previousPosition=null,e||n.preventDefault(),this._activePointerId=-1}else if(a.type===PointerEventTypes.POINTERMOVE&&(this._activePointerId===n.pointerId||!s))if(t.isPointerLock&&this._onMouseMove)this._onMouseMove(a.event);else if(this._previousPosition){const t=this.camera._calculateHandednessMultiplier(),i=(n.clientX-this._previousPosition.x)*t,a=n.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=a/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:a}),this._previousPosition={x:n.clientX,y:n.clientY},e||n.preventDefault()}}),this._onMouseMove=i=>{if(!t.isPointerLock)return;const a=this.camera._calculateHandednessMultiplier(),n=i.movementX*a;this.camera.cameraRotation.y+=n/this.angularSensibility;const s=i.movementY;this.camera.cameraRotation.x+=s/this.angularSensibility,this._previousPosition=null,e||i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,PointerEventTypes.POINTERDOWN|PointerEventTypes.POINTERUP|PointerEventTypes.POINTERMOVE),i&&(this._contextMenuBind=e=>this.onContextMenu(e),i.addEventListener("contextmenu",this._contextMenuBind,!1))}getSimpleName(){return"mouse"}};__decorate([serialize()],FreeCameraMouseInput.prototype,"buttons",void 0),__decorate([serialize()],FreeCameraMouseInput.prototype,"angularSensibility",void 0),CameraInputTypes.FreeCameraMouseInput=FreeCameraMouseInput;var BaseCameraMouseWheelInput=class{detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}getClassName(){return"BaseCameraMouseWheelInput"}constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Observable,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}getSimpleName(){return"mousewheel"}attachControl(e){e=Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==PointerEventTypes.POINTERWHEEL)return;const i=t.event,a=i.deltaMode===EventConstants.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*a*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*a*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*a*i.deltaZ/this._normalize,i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,PointerEventTypes.POINTERWHEEL)}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}},_CameraProperty,_CameraProperty2;__decorate([serialize()],BaseCameraMouseWheelInput.prototype,"wheelPrecisionX",void 0),__decorate([serialize()],BaseCameraMouseWheelInput.prototype,"wheelPrecisionY",void 0),__decorate([serialize()],BaseCameraMouseWheelInput.prototype,"wheelPrecisionZ",void 0),_CameraProperty2=_CameraProperty||(_CameraProperty={}),_CameraProperty2[_CameraProperty2.MoveRelative=0]="MoveRelative",_CameraProperty2[_CameraProperty2.RotateRelative=1]="RotateRelative",_CameraProperty2[_CameraProperty2.MoveScene=2]="MoveScene";var FreeCameraMouseWheelInput=class extends BaseCameraMouseWheelInput{get wheelYMoveRelative(){return this._wheelYAction!==_CameraProperty.MoveRelative?null:this._wheelYActionCoordinate}set wheelXRotateRelative(e){null===e&&this._wheelXAction!==_CameraProperty.RotateRelative||(this._wheelXAction=_CameraProperty.RotateRelative,this._wheelXActionCoordinate=e)}get wheelXMoveScene(){return this._wheelXAction!==_CameraProperty.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(e){null===e&&this._wheelYAction!==_CameraProperty.MoveScene||(this._wheelYAction=_CameraProperty.MoveScene,this._wheelYActionCoordinate=e)}set wheelYMoveRelative(e){null===e&&this._wheelYAction!==_CameraProperty.MoveRelative||(this._wheelYAction=_CameraProperty.MoveRelative,this._wheelYActionCoordinate=e)}get wheelXRotateRelative(){return this._wheelXAction!==_CameraProperty.RotateRelative?null:this._wheelXActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);const e=Matrix.Zero();this.camera.getViewMatrix().invertToRef(e);const t=Vector3.Zero();Vector3.TransformNormalToRef(this._moveRelative,e,t),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(t),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}set wheelZMoveRelative(e){null===e&&this._wheelZAction!==_CameraProperty.MoveRelative||(this._wheelZAction=_CameraProperty.MoveRelative,this._wheelZActionCoordinate=e)}get wheelXMoveRelative(){return this._wheelXAction!==_CameraProperty.MoveRelative?null:this._wheelXActionCoordinate}get wheelZMoveScene(){return this._wheelZAction!==_CameraProperty.MoveScene?null:this._wheelZActionCoordinate}get wheelYMoveScene(){return this._wheelYAction!==_CameraProperty.MoveScene?null:this._wheelYActionCoordinate}getClassName(){return"FreeCameraMouseWheelInput"}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(e,t,i){if(0===e)return;if(null===t||null===i)return;let a=null;switch(t){case _CameraProperty.MoveRelative:a=this._moveRelative;break;case _CameraProperty.RotateRelative:a=this._rotateRelative;break;case _CameraProperty.MoveScene:a=this._moveScene}switch(i){case 0:a.set(e,0,0);break;case 1:a.set(0,e,0);break;case 2:a.set(0,0,e)}}get wheelZMoveRelative(){return this._wheelZAction!==_CameraProperty.MoveRelative?null:this._wheelZActionCoordinate}set wheelXMoveRelative(e){null===e&&this._wheelXAction!==_CameraProperty.MoveRelative||(this._wheelXAction=_CameraProperty.MoveRelative,this._wheelXActionCoordinate=e)}set wheelYRotateRelative(e){null===e&&this._wheelYAction!==_CameraProperty.RotateRelative||(this._wheelYAction=_CameraProperty.RotateRelative,this._wheelYActionCoordinate=e)}set wheelZMoveScene(e){null===e&&this._wheelZAction!==_CameraProperty.MoveScene||(this._wheelZAction=_CameraProperty.MoveScene,this._wheelZActionCoordinate=e)}get wheelZRotateRelative(){return this._wheelZAction!==_CameraProperty.RotateRelative?null:this._wheelZActionCoordinate}set wheelZRotateRelative(e){null===e&&this._wheelZAction!==_CameraProperty.RotateRelative||(this._wheelZAction=_CameraProperty.RotateRelative,this._wheelZActionCoordinate=e)}set wheelXMoveScene(e){null===e&&this._wheelXAction!==_CameraProperty.MoveScene||(this._wheelXAction=_CameraProperty.MoveScene,this._wheelXActionCoordinate=e)}constructor(){super(...arguments),this._moveRelative=Vector3.Zero(),this._rotateRelative=Vector3.Zero(),this._moveScene=Vector3.Zero(),this._wheelXAction=_CameraProperty.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=_CameraProperty.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}get wheelYRotateRelative(){return this._wheelYAction!==_CameraProperty.RotateRelative?null:this._wheelYActionCoordinate}};__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelXMoveRelative",null),__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelYMoveRelative",null),__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelZMoveRelative",null),__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelXRotateRelative",null),__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelYRotateRelative",null),__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelZRotateRelative",null),__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelXMoveScene",null),__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelYMoveScene",null),__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelZMoveScene",null),CameraInputTypes.FreeCameraMouseWheelInput=FreeCameraMouseWheelInput;var FreeCameraTouchInput=class{getClassName(){return"FreeCameraTouchInput"}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const e=this.camera,t=e._calculateHandednessMultiplier();e.cameraRotation.y=t*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const t=e._computeLocalCameraSpeed(),i=new Vector3(0,0,0!==this.touchMoveSensibility?t*this._offsetY/this.touchMoveSensibility:0);Matrix.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(Vector3.TransformCoordinates(i,e._cameraRotationMatrix))}}constructor(e=!1){this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=Tools.IsSafari()}attachControl(e){e=Tools.BackCompatCameraNoPreventDefault(arguments);let t=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const a=i.event,n="mouse"===a.pointerType||this._isSafari&&void 0===a.pointerType;if(this.allowMouse||!n)if(i.type===PointerEventTypes.POINTERDOWN){if(e||a.preventDefault(),this._pointerPressed.push(a.pointerId),1!==this._pointerPressed.length)return;t={x:a.clientX,y:a.clientY}}else if(i.type===PointerEventTypes.POINTERUP){e||a.preventDefault();const i=this._pointerPressed.indexOf(a.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;t=null,this._offsetX=null,this._offsetY=null}else if(i.type===PointerEventTypes.POINTERMOVE){if(e||a.preventDefault(),!t)return;if(0!=this._pointerPressed.indexOf(a.pointerId))return;this._offsetX=a.clientX-t.x,this._offsetY=-(a.clientY-t.y)}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,PointerEventTypes.POINTERDOWN|PointerEventTypes.POINTERUP|PointerEventTypes.POINTERMOVE),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.addEventListener("blur",this._onLostFocus)}}getSimpleName(){return"touch"}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}};__decorate([serialize()],FreeCameraTouchInput.prototype,"touchAngularSensibility",void 0),__decorate([serialize()],FreeCameraTouchInput.prototype,"touchMoveSensibility",void 0),CameraInputTypes.FreeCameraTouchInput=FreeCameraTouchInput;var FreeCameraInputsManager=class extends CameraInputsManager{addTouch(){return this.add(new FreeCameraTouchInput),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouse(e=!0){return this._mouseInput||(this._mouseInput=new FreeCameraMouseInput(e),this.add(this._mouseInput)),this}clear(){super.clear(),this._mouseInput=null}addKeyboard(){return this.add(new FreeCameraKeyboardMoveInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new FreeCameraMouseWheelInput,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}constructor(e){super(e),this._mouseInput=null,this._mouseWheelInput=null}},FreeCamera=class extends TargetCamera{set keysDownward(e){const t=this.inputs.attached.keyboard;t&&(t.keysDownward=e)}dispose(){this.inputs.clear(),super.dispose()}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}_collideWithWorld(e){let t;t=this.parent?Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let a=e;this.applyGravity&&(a=e.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,a,this._collider,3,null,this._onCollisionPositionChange,this.Hc)}set keysUpward(e){const t=this.inputs.attached.keyboard;t&&(t.keysUpward=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set needMoveForGravity(e){this._needMoveForGravity=e}set keysRotateUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateUp=e)}get keysRotateDown(){const e=this.inputs.attached.keyboard;return e?e.keysRotateDown:[]}get keysUpward(){const e=this.inputs.attached.keyboard;return e?e.keysUpward:[]}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get collisionMask(){return this._collisionMask}set keysRotateLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateLeft=e)}get keysDownward(){const e=this.inputs.attached.keyboard;return e?e.keysDownward:[]}set collisionMask(e){this._collisionMask=isNaN(e)?-1:e}set keysRotateRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateRight=e)}constructor(e,t,i,a=!0){super(e,t,i,a),this.ellipsoid=new Vector3(.5,1,.5),this.ellipsoidOffset=new Vector3(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Vector3.Zero(),this._diffPosition=Vector3.Zero(),this._newPosition=Vector3.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(e,t,i=null)=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>Engine.CollisionsEpsilon&&(this.position.addToRef(this._diffPosition,this._deferredPositionUpdate),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate),this.onCollide&&i&&this.onCollide(i))},this.inputs=new FreeCameraInputsManager(this),this.inputs.addKeyboard().addMouse()}get angularSensibility(){const e=this.inputs.attached.mouse;return e?e.angularSensibility:0}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}set keysRotateDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateDown=e)}get keysRotateUp(){const e=this.inputs.attached.keyboard;return e?e.keysRotateUp:[]}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}_checkInputs(){this._localDirection||(this._localDirection=Vector3.Zero(),this._transformedDirection=Vector3.Zero()),this.inputs.checkInputs(),super._checkInputs()}set angularSensibility(e){const t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)}attachControl(e,t){t=Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(t)}getClassName(){return"FreeCamera"}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}detachControl(){this.inputs.detachElement(),this.cameraDirection=new Vector3(0,0,0),this.cameraRotation=new Vector2(0,0)}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}get keysRotateRight(){const e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]}get keysRotateLeft(){const e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]}get needMoveForGravity(){return this._needMoveForGravity}};__decorate([serializeAsVector3()],FreeCamera.prototype,"ellipsoid",void 0),__decorate([serializeAsVector3()],FreeCamera.prototype,"ellipsoidOffset",void 0),__decorate([serialize()],FreeCamera.prototype,"checkCollisions",void 0),__decorate([serialize()],FreeCamera.prototype,"applyGravity",void 0),RegisterClass("BABYLON.FreeCamera",FreeCamera),ThinEngine.prototype.createDynamicTexture=function(e,t,i,a){const n=new InternalTexture(this,4);return n.baseWidth=e,n.baseHeight=t,i&&(e=this.needPOTTextures?GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?GetExponentOfTwo(t,this._caps.maxTextureSize):t),n.width=e,n.height=t,n.isReady=!1,n.generateMipMaps=i,n.samplingMode=a,this.updateTextureSamplingMode(a,n),this._internalTexturesCache.push(n),n},ThinEngine.prototype.updateDynamicTexture=function(e,t,i,a=!1,n,s=!1,r=!1){if(!e)return;const o=this._gl,l=o.TEXTURE_2D,c=this._bindTextureDirectly(l,e,!0,s);this._unpackFlipY(void 0===i?e.invertY:i),a&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const h=this._getWebGLTextureType(e.type),u=this._getInternalFormat(n||e.format),m=this._getRGBABufferInternalSizedFormat(e.type,u);o.texImage2D(l,0,m,u,h,t),e.generateMipMaps&&o.generateMipmap(l),c||this._bindTextureDirectly(l,null),a&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),n&&(e.format=n),e._dynamicTextureSource=t,e._premulAlpha=a,e.invertY=i||!1,e.isReady=!0};var DynamicTexture=class e extends Texture{getClassName(){return"DynamicTexture"}get canRescale(){return!0}clear(e){const t=this.getSize();e&&(this._context.fillStyle=e),this._context.clearRect(0,0,t.width,t.height)}scale(e){const t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)}drawText(e,t,i,a,n,s,r,o=!0){const l=this.getSize();if(s&&(this._context.fillStyle=s,this._context.fillRect(0,0,l.width,l.height)),this._context.font=a,null==t){const i=this._context.measureText(e);t=(l.width-i.width)/2}if(null==i){const e=parseInt(a.replace(/\D/g,""));i=l.height/2+e/3.65}this._context.fillStyle=n||"",this._context.fillText(e,t,i),o&&this.update(r)}constructor(e,t,i=null,a=!1,n=3,s=5,r){super(null,i,!a,r,n,void 0,void 0,void 0,void 0,s),this.name=e,this.wrapU=Texture.CLAMP_ADDRESSMODE,this.wrapV=Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=a;const o=this._getEngine();if(!o)return;t.getContext?(this._canvas=t,this._ownCanvas=!1,this._texture=o.createDynamicTexture(t.width,t.height,a,n)):(this._canvas=o.createCanvas(1,1),this._ownCanvas=!0,t.width||0===t.width?this._texture=o.createDynamicTexture(t.width,t.height,a,n):this._texture=o.createDynamicTexture(t,t,a,n));const l=this.getSize();this._canvas.width!==l.width&&(this._canvas.width=l.width),this._canvas.height!==l.height&&(this._canvas.height=l.height),this._context=this._canvas.getContext("2d")}clone(){const t=this.getScene();if(!t)return this;const i=this.getSize(),a=new e(this.name,i,t,this._generateMipMaps);return a.hasAlpha=this.hasAlpha,a.level=this.level,a.wrapU=this.wrapU,a.wrapV=this.wrapV,a}scaleTo(e,t){const i=this.getSize();i.width=e,i.height=t,this._recreate(i)}_recreate(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)}update(e,t=!1,i=!1){this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0,void 0,i)}_rebuild(){this.update()}dispose(){super.dispose(),this._ownCanvas&&this._canvas?.remove?.(),this._canvas=null,this._context=null}static _IsCanvasElement(e){return void 0!==e.toDataURL}getContext(){return this._context}serialize(){const t=this.getScene();t&&!t.isReady()&&Logger.Warn("The scene must be ready before serializing the dynamic texture");const i=super.serialize();return e._IsCanvasElement(this._canvas)&&(i.base64String=this._canvas.toDataURL()),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i}};AbstractEngine.prototype._partialLoadFile=function(e,t,i,a,n=null){this._loadFile(e,(e=>{i[t]=e,i._internalCount++,6===i._internalCount&&a(i)}),void 0,void 0,!0,((e,t)=>{n&&e&&n(e.status+" "+e.statusText,t)}))},AbstractEngine.prototype._cascadeLoadFiles=function(e,t,i,a=null){const n=[];n._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(i[e],e,n,t,a)},AbstractEngine.prototype._cascadeLoadImgs=function(e,t,i,a,n=null,s){const r=[];r._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(a[o],o,r,e,t,i,n,s)},AbstractEngine.prototype._partialLoadImg=function(e,t,i,a,n,s,r=null,o){const l=RandomGUID();LoadImage(e,(e=>{i[t]=e,i._internalCount++,a&&a.removePendingData(l),6===i._internalCount&&s&&s(n,i)}),((e,t)=>{a&&a.removePendingData(l),r&&r(e,t)}),a?a.offlineProvider:null,o),a&&a.addPendingData(l)},AbstractEngine.prototype.createCubeTextureBase=function(e,t,i,a,n=null,s=null,r,o=null,l=!1,c=0,h=0,u=null,m=null,d=null,f=!1,p=null){const _=u||new InternalTexture(this,7);_.isCube=!0,_.url=e,_.generateMipMaps=!a,_._lodGenerationScale=c,_._lodGenerationOffset=h,_._useSRGBBuffer=!!f&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!a),_!==u&&(_.label=e.substring(0,60)),this._doNotHandleContextLost||(_._extension=o,_._files=i,_._buffer=p);const g=e;this._transformTextureUrl&&!u&&(e=this._transformTextureUrl(e));const v=e.split("?")[0],y=v.lastIndexOf("."),S=o||(y>-1?v.substring(y).toLowerCase():"");let C=null;for(const e of AbstractEngine._TextureLoaders)if(e.canLoad(S)){C=e;break}const E=(u,v)=>{e===g?s&&u&&s(u.status+" "+u.statusText,v):(Logger.Warn(`Failed to load ${e}, falling back to the ${g}`),this.createCubeTextureBase(g,t,i,!!a,n,s,r,o,l,c,h,_,m,d,f,p))};if(C){const a=e=>{m&&m(_,e),C.loadCubeData(e,_,l,n,s)};p?a(p):i&&6===i.length?C.supportCascades?this._cascadeLoadFiles(t,(e=>a(e.map((e=>new Uint8Array(e))))),i,s):s?s("Textures type does not support cascades."):Logger.Warn("Texture loader does not support cascades."):this._loadFile(e,(e=>a(new Uint8Array(e))),void 0,void 0,!0,E)}else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,_,((e,t)=>{d&&d(e,t)}),i,s)}return this._internalTexturesCache.push(_),_},ThinEngine.prototype._createDepthStencilCubeTexture=function(e,t){const i=new InternalTexture(this,12);if(i.isCube=!0,1===this.webGLVersion)return Logger.Error("Depth cube texture is not supported by WebGL 1."),i;const a={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t},n=this._gl;this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,i,!0),this._setupDepthStencilTexture(i,e,a.generateStencil,a.bilinearFiltering,a.comparisonFunction);for(let t=0;t<6;t++)a.generateStencil?n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,n.DEPTH24_STENCIL8,e,e,0,n.DEPTH_STENCIL,n.UNSIGNED_INT_24_8,null):n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,n.DEPTH_COMPONENT24,e,e,0,n.DEPTH_COMPONENT,n.UNSIGNED_INT,null);return this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(i),i},ThinEngine.prototype._setCubeMapTextureParams=function(e,t,i){const a=this._gl;a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,t?a.LINEAR_MIPMAP_LINEAR:a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==i&&i>0&&(a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAX_LEVEL,i),e._maxLodLevel=i),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null)},ThinEngine.prototype.createCubeTexture=function(e,t,i,a,n=null,s=null,r,o=null,l=!1,c=0,h=0,u=null,m,d=!1,f=null){const p=this._gl;return this.createCubeTextureBase(e,t,i,!!a,n,s,r,o,l,c,h,u,(e=>this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,e,!0)),((e,t)=>{const i=this.needPOTTextures?GetExponentOfTwo(t[0].width,this._caps.maxCubemapTextureSize):t[0].width,s=i,o=[p.TEXTURE_CUBE_MAP_POSITIVE_X,p.TEXTURE_CUBE_MAP_POSITIVE_Y,p.TEXTURE_CUBE_MAP_POSITIVE_Z,p.TEXTURE_CUBE_MAP_NEGATIVE_X,p.TEXTURE_CUBE_MAP_NEGATIVE_Y,p.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(!1);const l=r?this._getInternalFormat(r,e._useSRGBBuffer):e._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:p.RGBA;let c=r?this._getInternalFormat(r):p.RGBA;e._useSRGBBuffer&&1===this.webGLVersion&&(c=l);for(let e=0;e<o.length;e++)if(t[e].width!==i||t[e].height!==s){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void Logger.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=i,this._workingCanvas.height=s,this._workingContext.drawImage(t[e],0,0,t[e].width,t[e].height,0,0,i,s),p.texImage2D(o[e],0,l,c,p.UNSIGNED_BYTE,this._workingCanvas)}else p.texImage2D(o[e],0,l,c,p.UNSIGNED_BYTE,t[e]);a||p.generateMipmap(p.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(e,!a),e.width=i,e.height=s,e.isReady=!0,r&&(e.format=r),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),n&&n()}),!!d,f)},ThinEngine.prototype.generateMipMapsForCubemap=function(e,t=!0){if(e.generateMipMaps){const i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)}};var SH3ylmBasisConstants=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],SH3ylmBasisTrigonometricTerms=[()=>1,e=>e.y,e=>e.z,e=>e.x,e=>e.x*e.y,e=>e.y*e.z,e=>3*e.z*e.z-1,e=>e.x*e.z,e=>e.x*e.x-e.y*e.y],applySH3=(e,t)=>SH3ylmBasisConstants[e]*SH3ylmBasisTrigonometricTerms[e](t),SHCosKernelConvolution=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],SphericalHarmonics=class e{constructor(){this.preScaled=!1,this.l00=Vector3.Zero(),this.l1_1=Vector3.Zero(),this.l10=Vector3.Zero(),this.l11=Vector3.Zero(),this.l2_2=Vector3.Zero(),this.l2_1=Vector3.Zero(),this.l20=Vector3.Zero(),this.l21=Vector3.Zero(),this.l22=Vector3.Zero()}addLight(e,t,i){TmpVectors.Vector3[0].set(t.r,t.g,t.b);const a=TmpVectors.Vector3[0],n=TmpVectors.Vector3[1];a.scaleToRef(i,n),n.scaleToRef(applySH3(0,e),TmpVectors.Vector3[2]),this.l00.addInPlace(TmpVectors.Vector3[2]),n.scaleToRef(applySH3(1,e),TmpVectors.Vector3[2]),this.l1_1.addInPlace(TmpVectors.Vector3[2]),n.scaleToRef(applySH3(2,e),TmpVectors.Vector3[2]),this.l10.addInPlace(TmpVectors.Vector3[2]),n.scaleToRef(applySH3(3,e),TmpVectors.Vector3[2]),this.l11.addInPlace(TmpVectors.Vector3[2]),n.scaleToRef(applySH3(4,e),TmpVectors.Vector3[2]),this.l2_2.addInPlace(TmpVectors.Vector3[2]),n.scaleToRef(applySH3(5,e),TmpVectors.Vector3[2]),this.l2_1.addInPlace(TmpVectors.Vector3[2]),n.scaleToRef(applySH3(6,e),TmpVectors.Vector3[2]),this.l20.addInPlace(TmpVectors.Vector3[2]),n.scaleToRef(applySH3(7,e),TmpVectors.Vector3[2]),this.l21.addInPlace(TmpVectors.Vector3[2]),n.scaleToRef(applySH3(8,e),TmpVectors.Vector3[2]),this.l22.addInPlace(TmpVectors.Vector3[2])}updateFromArray(e){return Vector3.FromArrayToRef(e[0],0,this.l00),Vector3.FromArrayToRef(e[1],0,this.l1_1),Vector3.FromArrayToRef(e[2],0,this.l10),Vector3.FromArrayToRef(e[3],0,this.l11),Vector3.FromArrayToRef(e[4],0,this.l2_2),Vector3.FromArrayToRef(e[5],0,this.l2_1),Vector3.FromArrayToRef(e[6],0,this.l20),Vector3.FromArrayToRef(e[7],0,this.l21),Vector3.FromArrayToRef(e[8],0,this.l22),this}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(SH3ylmBasisConstants[0]),this.l1_1.scaleInPlace(SH3ylmBasisConstants[1]),this.l10.scaleInPlace(SH3ylmBasisConstants[2]),this.l11.scaleInPlace(SH3ylmBasisConstants[3]),this.l2_2.scaleInPlace(SH3ylmBasisConstants[4]),this.l2_1.scaleInPlace(SH3ylmBasisConstants[5]),this.l20.scaleInPlace(SH3ylmBasisConstants[6]),this.l21.scaleInPlace(SH3ylmBasisConstants[7]),this.l22.scaleInPlace(SH3ylmBasisConstants[8])}static FromPolynomial(t){const i=new e;return i.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),i.l1_1=t.y.scale(.977204),i.l10=t.z.scale(.977204),i.l11=t.x.scale(.977204),i.l2_2=t.xy.scale(1.16538),i.l2_1=t.yz.scale(1.16538),i.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),i.l21=t.zx.scale(1.16538),i.l22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),i.l1_1.scaleInPlace(-1),i.l11.scaleInPlace(-1),i.l2_1.scaleInPlace(-1),i.l21.scaleInPlace(-1),i.scaleInPlace(Math.PI),i}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}updateFromFloatsArray(e){return Vector3.FromFloatsToRef(e[0],e[1],e[2],this.l00),Vector3.FromFloatsToRef(e[3],e[4],e[5],this.l1_1),Vector3.FromFloatsToRef(e[6],e[7],e[8],this.l10),Vector3.FromFloatsToRef(e[9],e[10],e[11],this.l11),Vector3.FromFloatsToRef(e[12],e[13],e[14],this.l2_2),Vector3.FromFloatsToRef(e[15],e[16],e[17],this.l2_1),Vector3.FromFloatsToRef(e[18],e[19],e[20],this.l20),Vector3.FromFloatsToRef(e[21],e[22],e[23],this.l21),Vector3.FromFloatsToRef(e[24],e[25],e[26],this.l22),this}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(SHCosKernelConvolution[0]),this.l1_1.scaleInPlace(SHCosKernelConvolution[1]),this.l10.scaleInPlace(SHCosKernelConvolution[2]),this.l11.scaleInPlace(SHCosKernelConvolution[3]),this.l2_2.scaleInPlace(SHCosKernelConvolution[4]),this.l2_1.scaleInPlace(SHCosKernelConvolution[5]),this.l20.scaleInPlace(SHCosKernelConvolution[6]),this.l21.scaleInPlace(SHCosKernelConvolution[7]),this.l22.scaleInPlace(SHCosKernelConvolution[8])}static FromArray(t){return(new e).updateFromArray(t)}},SphericalPolynomial=class e{addAmbient(e){TmpVectors.Vector3[0].copyFromFloats(e.r,e.g,e.b);const t=TmpVectors.Vector3[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}get preScaledHarmonics(){return this._harmonics||(this._harmonics=SphericalHarmonics.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}static FromArray(t){const i=new e;return Vector3.FromArrayToRef(t[0],0,i.x),Vector3.FromArrayToRef(t[1],0,i.y),Vector3.FromArrayToRef(t[2],0,i.z),Vector3.FromArrayToRef(t[3],0,i.xx),Vector3.FromArrayToRef(t[4],0,i.yy),Vector3.FromArrayToRef(t[5],0,i.zz),Vector3.FromArrayToRef(t[6],0,i.yz),Vector3.FromArrayToRef(t[7],0,i.zx),Vector3.FromArrayToRef(t[8],0,i.xy),i}constructor(){this.x=Vector3.Zero(),this.y=Vector3.Zero(),this.z=Vector3.Zero(),this.xx=Vector3.Zero(),this.yy=Vector3.Zero(),this.zz=Vector3.Zero(),this.xy=Vector3.Zero(),this.yz=Vector3.Zero(),this.zx=Vector3.Zero()}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),TmpVectors.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),TmpVectors.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(TmpVectors.Vector3[0]).addInPlace(TmpVectors.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(TmpVectors.Vector3[0]).subtractInPlace(TmpVectors.Vector3[1]),this.zz.copyFrom(e.l00),TmpVectors.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(TmpVectors.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}static FromHarmonics(t){return(new e).updateFromHarmonics(t)}},FileFaceOrientation=class{constructor(e,t,i,a){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=a}},CubeMapToSphericalPolynomialTools=class{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,i=e.readPixels(0,void 0,void 0,!1),a=e.readPixels(1,void 0,void 0,!1);let n,s;e.isRenderTarget?(n=e.readPixels(3,void 0,void 0,!1),s=e.readPixels(2,void 0,void 0,!1)):(n=e.readPixels(2,void 0,void 0,!1),s=e.readPixels(3,void 0,void 0,!1));const r=e.readPixels(4,void 0,void 0,!1),o=e.readPixels(5,void 0,void 0,!1),l=e.gammaSpace;let c=0;return 1!=e.textureType&&2!=e.textureType||(c=1),new Promise((e=>{Promise.all([a,i,n,s,r,o]).then((([i,a,n,s,r,o])=>{const h={size:t,right:a,left:i,up:n,down:s,front:r,back:o,format:5,type:c,gammaSpace:l};e(this.ConvertCubeMapToSphericalPolynomial(h))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new SphericalHarmonics;let i=0;const a=2/e.size,n=a,s=.5*a,r=s-1;for(let o=0;o<6;o++){const l=this._FileFaces[o],c=e[l.name];let h=r;const u=5===e.format?4:3;for(let o=0;o<e.size;o++){let m=r;for(let n=0;n<e.size;n++){const r=l.worldAxisForFileX.scale(m).add(l.worldAxisForFileY.scale(h)).add(l.worldAxisForNormal);r.normalize();const d=this._AreaElement(m-s,h-s)-this._AreaElement(m-s,h+s)-this._AreaElement(m+s,h-s)+this._AreaElement(m+s,h+s);let f=c[o*e.size*u+n*u+0],p=c[o*e.size*u+n*u+1],_=c[o*e.size*u+n*u+2];isNaN(f)&&(f=0),isNaN(p)&&(p=0),isNaN(_)&&(_=0),0===e.type&&(f/=255,p/=255,_/=255),e.gammaSpace&&(f=Math.pow(Scalar.Clamp(f),ToLinearSpace),p=Math.pow(Scalar.Clamp(p),ToLinearSpace),_=Math.pow(Scalar.Clamp(_),ToLinearSpace));const g=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(f,p,_);if(e>g){const t=g/e;f*=t,p*=t,_*=t}}else f=Scalar.Clamp(f,0,g),p=Scalar.Clamp(p,0,g),_=Scalar.Clamp(_,0,g);const v=new Color3(f,p,_);t.addLight(r,v,d),i+=d,m+=a}h+=n}}const o=6*(4*Math.PI)/6/i;return t.scaleInPlace(o),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),SphericalPolynomial.FromHarmonics(t)}};CubeMapToSphericalPolynomialTools._FileFaces=[new FileFaceOrientation("right",new Vector3(1,0,0),new Vector3(0,0,-1),new Vector3(0,-1,0)),new FileFaceOrientation("left",new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,-1,0)),new FileFaceOrientation("up",new Vector3(0,1,0),new Vector3(1,0,0),new Vector3(0,0,1)),new FileFaceOrientation("down",new Vector3(0,-1,0),new Vector3(1,0,0),new Vector3(0,0,-1)),new FileFaceOrientation("front",new Vector3(0,0,1),new Vector3(1,0,0),new Vector3(0,-1,0)),new FileFaceOrientation("back",new Vector3(0,0,-1),new Vector3(-1,0,0),new Vector3(0,-1,0))],CubeMapToSphericalPolynomialTools.MAX_HDRI_VALUE=4096,CubeMapToSphericalPolynomialTools.PRESERVE_CLAMPED_COLORS=!1;var PassPostProcess=class e extends PostProcess{getClassName(){return"PassPostProcess"}async _initShaderSourceAsync(e){e?(this._webGPUReady=!0,await Promise.all([Promise.resolve().then((()=>(init_pass_fragment2(),pass_fragment_exports2)))])):await Promise.all([Promise.resolve().then((()=>(init_pass_fragment(),pass_fragment_exports)))]),await super._initShaderSourceAsync(e)}constructor(e,t,i=null,a,n,s,r=0,o=!1){super(e,"pass",null,null,t,i,a,n,s,void 0,r,void 0,null,o)}static _Parse(t,i,a,n){return SerializationHelper.Parse((()=>new e(t.name,t.options,i,t.renderTargetSamplingMode,t._engine,t.reusable)),t,a,n)}};RegisterClass("BABYLON.PassPostProcess",PassPostProcess),AbstractEngine._RescalePostProcessFactory=e=>new PassPostProcess("rescale",1,null,2,e,!1,0),init_shaderStore();var name92="lodPixelShader",shader92="#extension GL_EXT_shader_texture_lod : enable\nprecision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform sampler2D textureSampler;uniform float lod;uniform vec2 texSize;uniform bool gamma;void main(void)\n{gl_FragColor=textureLod(textureSampler,vUV,lod);if (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n";ShaderStore.ShadersStore[name92]=shader92,init_shaderStore();var name93="lodCubePixelShader",shader93="precision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform samplerCube textureSampler;uniform float lod;uniform bool gamma;void main(void)\n{vec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x),lod);\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x),lod);\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x),lod);\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x),lod);\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001),lod);\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001),lod);\n#endif\nif (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n",floatView,int32View;function ApplyPostProcess(e,t,i,a,n,s,r,o){const l=t.getEngine();return t.isReady=!1,n=n??t.samplingMode,a=a??t.type,s=s??t.format,r=r??t.width,o=o??t.height,-1===a&&(a=0),new Promise((c=>{const h=new PostProcess("postprocess",e,null,null,1,null,n,l,!1,void 0,a,void 0,null,!1,s);h.externalTextureSamplerBinding=!0;const u=l.createRenderTargetTexture({width:r,height:o},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n,type:a,format:s});h.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{h.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},i.postProcessManager.directRender([h],u,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(t),h&&h.dispose(),u._swapAndDie(t),t.type=a,t.format=5,t.isReady=!0,c(t)}))}))}))}function ToHalfFloat(e){floatView||(floatView=new Float32Array(1),int32View=new Int32Array(floatView.buffer)),floatView[0]=e;const t=int32View[0];let i=t>>16&32768,a=t>>12&2047;const n=t>>23&255;return n<103?i:n>142?(i|=31744,i|=(255==n?0:1)&&8388607&t,i):n<113?(a|=2048,i|=(a>>114-n)+(a>>113-n&1),i):(i|=n-112<<10|a>>1,i+=1&a,i)}function FromHalfFloat(e){const t=(32768&e)>>15,i=(31744&e)>>10,a=1023&e;return 0===i?(t?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==i?a?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+a/Math.pow(2,10))}ShaderStore.ShadersStore[name93]=shader93;var DDS_MAGIC=542327876,DDSD_MIPMAPCOUNT=131072,DDSCAPS2_CUBEMAP=512,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_LUMINANCE=131072;function FourCCToInt32(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function Int32ToFourCC(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var FOURCC_DXT1=FourCCToInt32("DXT1"),FOURCC_DXT3=FourCCToInt32("DXT3"),FOURCC_DXT5=FourCCToInt32("DXT5"),FOURCC_DX10=FourCCToInt32("DX10"),FOURCC_D3DFMT_R16G16B16A16F=113,FOURCC_D3DFMT_R32G32B32A32F=116,DXGI_FORMAT_R32G32B32A32_FLOAT=2,DXGI_FORMAT_R16G16B16A16_FLOAT=10,DXGI_FORMAT_B8G8R8X8_UNORM=88,headerLengthInt=31,off_magic=0,off_size=1,off_flags=2,off_height=3,off_width=4,off_mipmapCount=7,off_pfFlags=20,off_pfFourCC=21,off_RGBbpp=22,off_RMask=23,off_GMask=24,off_BMask=25,off_AMask=26,off_caps2=28,off_dxgiFormat=32,DDSTools=class e{static _GetFloatAsHalfFloatRGBAArrayBuffer(t,i,a,n,s,r){const o=new Uint16Array(n),l=new Float32Array(s,a);let c=0;for(let a=0;a<i;a++)for(let i=0;i<t;i++)o[c]=ToHalfFloat(l[c]),o[c+1]=ToHalfFloat(l[c+1]),o[c+2]=ToHalfFloat(l[c+2]),e.StoreLODInAlphaChannel?o[c+3]=ToHalfFloat(r):o[c+3]=ToHalfFloat(l[c+3]),c+=4;return o}static _GetHalfFloatAsFloatRGBAArrayBuffer(t,i,a,n,s,r){const o=new Float32Array(n),l=new Uint16Array(s,a);let c=0;for(let a=0;a<i;a++)for(let i=0;i<t;i++){const n=4*(i+a*t);o[c]=FromHalfFloat(l[n]),o[c+1]=FromHalfFloat(l[n+1]),o[c+2]=FromHalfFloat(l[n+2]),e.StoreLODInAlphaChannel?o[c+3]=r:o[c+3]=FromHalfFloat(l[n+3]),c+=4}return o}static _GetFloatRGBAArrayBuffer(t,i,a,n,s,r){if(e.StoreLODInAlphaChannel){const e=new Float32Array(n),o=new Float32Array(s,a);let l=0;for(let a=0;a<i;a++)for(let i=0;i<t;i++){const n=4*(i+a*t);e[l]=o[n],e[l+1]=o[n+1],e[l+2]=o[n+2],e[l+3]=r,l+=4}return e}return new Float32Array(s,a,n)}static _GetRGBArrayBuffer(e,t,i,a,n,s,r,o){const l=new Uint8Array(a),c=new Uint8Array(n,i);let h=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const a=3*(t+i*e);l[h]=c[a+s],l[h+1]=c[a+r],l[h+2]=c[a+o],h+=3}return l}static _GetHalfFloatRGBAArrayBuffer(t,i,a,n,s,r){if(e.StoreLODInAlphaChannel){const e=new Uint16Array(n),o=new Uint16Array(s,a);let l=0;for(let a=0;a<i;a++)for(let i=0;i<t;i++){const n=4*(i+a*t);e[l]=o[n],e[l+1]=o[n+1],e[l+2]=o[n+2],e[l+3]=ToHalfFloat(r),l+=4}return e}return new Uint16Array(s,a,n)}static _GetHalfFloatAsUIntRGBAArrayBuffer(t,i,a,n,s,r){const o=new Uint8Array(n),l=new Uint16Array(s,a);let c=0;for(let a=0;a<i;a++)for(let i=0;i<t;i++){const n=4*(i+a*t);o[c]=255*Scalar.Clamp(FromHalfFloat(l[n])),o[c+1]=255*Scalar.Clamp(FromHalfFloat(l[n+1])),o[c+2]=255*Scalar.Clamp(FromHalfFloat(l[n+2])),e.StoreLODInAlphaChannel?o[c+3]=r:o[c+3]=255*Scalar.Clamp(FromHalfFloat(l[n+3])),c+=4}return o}static _GetFloatAsUIntRGBAArrayBuffer(t,i,a,n,s,r){const o=new Uint8Array(n),l=new Float32Array(s,a);let c=0;for(let a=0;a<i;a++)for(let i=0;i<t;i++){const n=4*(i+a*t);o[c]=255*Scalar.Clamp(l[n]),o[c+1]=255*Scalar.Clamp(l[n+1]),o[c+2]=255*Scalar.Clamp(l[n+2]),e.StoreLODInAlphaChannel?o[c+3]=r:o[c+3]=255*Scalar.Clamp(l[n+3]),c+=4}return o}static _GetLuminanceArrayBuffer(e,t,i,a,n){const s=new Uint8Array(a),r=new Uint8Array(n,i);let o=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const a=t+i*e;s[o]=r[a],o++}return s}static UploadDDSLevels(t,i,a,n,s,r,o=-1,l,c=!0){let h=null;n.sphericalPolynomial&&(h=[]);const u=!!t.getCaps().s3tc;i.generateMipMaps=s;const m=new Int32Array(a.buffer,a.byteOffset,headerLengthInt);let d,f,p,_,g,v,y,S=0,C=0,E=1;if(m[off_magic]!==DDS_MAGIC)return void Logger.Error("Invalid magic number in DDS header");if(!n.isFourCC&&!n.isRGB&&!n.isLuminance)return void Logger.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(n.isCompressed&&!u)return void Logger.Error("Compressed textures are not supported on this platform.");let A=m[off_RGBbpp];_=m[off_size]+4;let T=!1;if(n.isFourCC)switch(d=m[off_pfFourCC],d){case FOURCC_DXT1:E=8,C=33777;break;case FOURCC_DXT3:E=16,C=33778;break;case FOURCC_DXT5:E=16,C=33779;break;case FOURCC_D3DFMT_R16G16B16A16F:T=!0,A=64;break;case FOURCC_D3DFMT_R32G32B32A32F:T=!0,A=128;break;case FOURCC_DX10:{_+=20;let e=!1;switch(n.dxgiFormat){case DXGI_FORMAT_R16G16B16A16_FLOAT:T=!0,A=64,e=!0;break;case DXGI_FORMAT_R32G32B32A32_FLOAT:T=!0,A=128,e=!0;break;case DXGI_FORMAT_B8G8R8X8_UNORM:n.isRGB=!0,n.isFourCC=!1,A=32,e=!0}if(e)break}default:return void Logger.Error(["Unsupported FourCC code:",Int32ToFourCC(d)])}const M=e._ExtractLongWordOrder(m[off_RMask]),x=e._ExtractLongWordOrder(m[off_GMask]),b=e._ExtractLongWordOrder(m[off_BMask]),w=e._ExtractLongWordOrder(m[off_AMask]);T&&(C=t._getRGBABufferInternalSizedFormat(n.textureType)),v=1,m[off_flags]&DDSD_MIPMAPCOUNT&&!1!==s&&(v=Math.max(1,m[off_mipmapCount]));const I=l||0,P=t.getCaps();for(let s=I;s<r;s++){for(f=m[off_width],p=m[off_height],y=0;y<v;++y){if(-1===o||o===y){const r=-1===o?y:0;if(!n.isCompressed&&n.isFourCC){i.format=5,S=f*p*4;let n=null;if(t._badOS||t._badDesktopOS||!P.textureHalfFloat&&!P.textureFloat)128===A?(n=e._GetFloatAsUIntRGBAArrayBuffer(f,p,a.byteOffset+_,S,a.buffer,r),h&&0==r&&h.push(e._GetFloatRGBAArrayBuffer(f,p,a.byteOffset+_,S,a.buffer,r))):64===A&&(n=e._GetHalfFloatAsUIntRGBAArrayBuffer(f,p,a.byteOffset+_,S,a.buffer,r),h&&0==r&&h.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(f,p,a.byteOffset+_,S,a.buffer,r))),i.type=0;else{const t=P.textureFloat&&(c&&P.textureFloatLinearFiltering||!c),s=P.textureHalfFloat&&(c&&P.textureHalfFloatLinearFiltering||!c),o=(128===A||64===A&&!s)&&t?1:(64===A||128===A&&!t)&&s?2:0;let l,u=null;if(128===A)switch(o){case 1:l=e._GetFloatRGBAArrayBuffer,u=null;break;case 2:l=e._GetFloatAsHalfFloatRGBAArrayBuffer,u=e._GetFloatRGBAArrayBuffer;break;case 0:l=e._GetFloatAsUIntRGBAArrayBuffer,u=e._GetFloatRGBAArrayBuffer}else switch(o){case 1:l=e._GetHalfFloatAsFloatRGBAArrayBuffer,u=null;break;case 2:l=e._GetHalfFloatRGBAArrayBuffer,u=e._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:l=e._GetHalfFloatAsUIntRGBAArrayBuffer,u=e._GetHalfFloatAsFloatRGBAArrayBuffer}i.type=o,n=l(f,p,a.byteOffset+_,S,a.buffer,r),h&&0==r&&h.push(u?u(f,p,a.byteOffset+_,S,a.buffer,r):n)}n&&t._uploadDataToTextureDirectly(i,n,s,r)}else if(n.isRGB)i.type=0,24===A?(i.format=4,S=f*p*3,g=e._GetRGBArrayBuffer(f,p,a.byteOffset+_,S,a.buffer,M,x,b),t._uploadDataToTextureDirectly(i,g,s,r)):(i.format=5,S=f*p*4,g=e._GetRGBAArrayBuffer(f,p,a.byteOffset+_,S,a.buffer,M,x,b,w),t._uploadDataToTextureDirectly(i,g,s,r));else if(n.isLuminance){const n=t._getUnpackAlignement(),o=f;S=Math.floor((f+n-1)/n)*n*(p-1)+o,g=e._GetLuminanceArrayBuffer(f,p,a.byteOffset+_,S,a.buffer),i.format=1,i.type=0,t._uploadDataToTextureDirectly(i,g,s,r)}else S=Math.max(4,f)/4*Math.max(4,p)/4*E,g=new Uint8Array(a.buffer,a.byteOffset+_,S),i.type=0,t._uploadCompressedDataToTextureDirectly(i,C,f,p,g,s,r)}_+=A?f*p*(A/8):S,f*=.5,p*=.5,f=Math.max(1,f),p=Math.max(1,p)}if(void 0!==l)break}h&&h.length>0?n.sphericalPolynomial=CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial({size:m[off_width],right:h[0],left:h[1],up:h[2],down:h[3],front:h[4],back:h[5],format:5,type:1,gammaSpace:!1}):n.sphericalPolynomial=void 0}static _GetRGBAArrayBuffer(e,t,i,a,n,s,r,o,l){const c=new Uint8Array(a),h=new Uint8Array(n,i);let u=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const a=4*(t+i*e);c[u]=h[a+s],c[u+1]=h[a+r],c[u+2]=h[a+o],c[u+3]=h[a+l],u+=4}return c}static _ExtractLongWordOrder(t){return 0===t||255===t||-16777216===t?0:1+e._ExtractLongWordOrder(t>>8)}static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,headerLengthInt),i=new Int32Array(e.buffer,e.byteOffset,headerLengthInt+4);let a=1;t[off_flags]&DDSD_MIPMAPCOUNT&&(a=Math.max(1,t[off_mipmapCount]));const n=t[off_pfFourCC],s=n===FOURCC_DX10?i[off_dxgiFormat]:0;let r=0;switch(n){case FOURCC_D3DFMT_R16G16B16A16F:r=2;break;case FOURCC_D3DFMT_R32G32B32A32F:r=1;break;case FOURCC_DX10:if(s===DXGI_FORMAT_R16G16B16A16_FLOAT){r=2;break}if(s===DXGI_FORMAT_R32G32B32A32_FLOAT){r=1;break}}return{width:t[off_width],height:t[off_height],mipmapCount:a,isFourCC:(t[off_pfFlags]&DDPF_FOURCC)===DDPF_FOURCC,isRGB:(t[off_pfFlags]&DDPF_RGB)===DDPF_RGB,isLuminance:(t[off_pfFlags]&DDPF_LUMINANCE)===DDPF_LUMINANCE,isCube:(t[off_caps2]&DDSCAPS2_CUBEMAP)===DDSCAPS2_CUBEMAP,isCompressed:n===FOURCC_DXT1||n===FOURCC_DXT3||n===FOURCC_DXT5,dxgiFormat:s,textureType:r}}};DDSTools.StoreLODInAlphaChannel=!1,ThinEngine.prototype.createPrefilteredCubeTexture=function(e,t,i,a,n=null,s=null,r,o=null,l=!0){return this.createCubeTexture(e,t,null,!1,(e=>{if(!e)return void(n&&n(null));const s=e.texture;if(l?e.info.sphericalPolynomial&&(s._sphericalPolynomial=e.info.sphericalPolynomial):s._sphericalPolynomial=new SphericalPolynomial,s._source=9,this.getCaps().textureLOD)return void(n&&n(s));const r=this._gl,o=e.width;if(!o)return;const c=[];for(let n=0;n<3;n++){const l=1-n/2,h=a,u=Scalar.Log2(o)*i+a,m=h+(u-h)*l,d=Math.round(Math.min(Math.max(m,0),u)),f=new InternalTexture(this,2);if(f.type=s.type,f.format=s.format,f.width=Math.pow(2,Math.max(Scalar.Log2(o)-d,0)),f.height=f.width,f.isCube=!0,f._cachedWrapU=0,f._cachedWrapV=0,this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,f,!0),f.samplingMode=2,r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e.isDDS){const t=e.info,i=e.data;this._unpackFlipY(t.isCompressed),DDSTools.UploadDDSLevels(this,f,i,t,!0,6,d)}else Logger.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null);const p=new BaseTexture(t);p._isCube=!0,p._texture=f,f.isReady=!0,c.push(p)}s._lodTextureHigh=c[2],s._lodTextureMid=c[1],s._lodTextureLow=c[0],n&&n(s)}),s,r,o,l,i,a)};var defaultLodScale=.8,CubeTexture=class e extends BaseTexture{_loadTexture(e=null,t=null){const i=this.getScene(),a=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const n=()=>{this.onLoadObservable.notifyObservers(this),a&&(a.dispose(),this.getScene()?.markAllMaterialsAsDirty(1)),e&&e()},s=(e,i)=>{this._loadingError=!0,this._errorObject={message:e,exception:i},t&&t(e,i),Texture.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?Tools.SetImmediate((()=>n())):this._texture.onLoadedObservable.add((()=>n())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,e,s,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,e,s,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),this._texture?.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}updateURL(e,t=null,i=null,a=!1,n=null,s=null,r=!1,o=null,l=null){this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,t&&(this._forcedExtension=t);const c=e.lastIndexOf("."),h=t||(c>-1?e.substring(c).toLowerCase():""),u=0===h.indexOf(".dds"),m=0===h.indexOf(".env"),d=0===h.indexOf(".basis");if(m?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=a,a&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(d||m||u||s||(s=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,s){for(let t=0;t<s.length;t++)this._files.push(e+s[t]);this._extensions=s}this._buffer=l,r?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=n):this._loadTexture(i,n)}get rotationY(){return this._rotationY}setReflectionTextureMatrix(e){if(e.updateFlag===this._textureMatrix.updateFlag)return;if(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this))),this._textureMatrix=e,!this.getScene()?.useRightHandedSystem)return;const t=TmpVectors.Vector3[0],i=TmpVectors.Cc[0],a=TmpVectors.Vector3[1];this._textureMatrix.decompose(t,i,a),i.z*=-1,i.w*=-1,Matrix.ComposeToRef(t,i,a,this._textureMatrixRefraction)}getRefractionTextureMatrix(){return this.getScene()?.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}getReflectionTextureMatrix(){return this._textureMatrix}static CreateFromPrefilteredData(t,i,a=null,n=!0){const s=i.useDelayedTextureLoading;i.useDelayedTextureLoading=!1;const r=new e(t,i,null,!1,null,null,null,void 0,!0,a,n);return i.useDelayedTextureLoading=s,r}constructor(e,t,i=null,a=!1,n=null,s=null,r=null,o=5,l=!1,c=null,h=!1,u=defaultLodScale,m=0,d,f){super(t),this.onLoadObservable=new Observable,this.boundingBoxPosition=Vector3.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Matrix,this._buffer=null,this.name=e,this.url=e,this._noMipmap=a,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=Matrix.Identity(),this.coordinatesMode=Texture.CUBIC_MODE;let p=null,_=null;null===i||Array.isArray(i)?(this._noMipmap=a,this._format=o,this._createPolynomials=h,p=i,this._loaderOptions=d,this._useSRGBBuffer=f,this._lodScale=u,this._lodOffset=m):(p=i.extensions??null,this._noMipmap=i.noMipmap??!1,n=i.files??null,_=i.buffer??null,this._format=i.format??5,l=i.prefiltered??!1,c=i.forcedExtension??null,this._createPolynomials=i.createPolynomials??!1,this._lodScale=i.lodScale??defaultLodScale,this._lodOffset=i.lodOffset??0,this._loaderOptions=i.loaderOptions,this._useSRGBBuffer=i.useSRGBBuffer,s=i.onLoad??null,r=i.onError??null),(e||n)&&this.updateURL(e,c,s,l,r,p,this.getScene()?.useDelayedTextureLoading,n,_)}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}static Parse(t,i,a){const n=SerializationHelper.Parse((()=>{let n=!1;return t.prefiltered&&(n=t.prefiltered),new e(a+(t.url??t.name),i,t.extensions,!1,t.files||null,null,null,void 0,n,t.forcedExtension)}),t,i);if(t.boundingBoxPosition&&(n.boundingBoxPosition=Vector3.FromArray(t.boundingBoxPosition)),t.boundingBoxSize&&(n.boundingBoxSize=Vector3.FromArray(t.boundingBoxSize)),t.animations)for(let e=0;e<t.animations.length;e++){const i=t.animations[e],a=GetClass("BABYLON.Animation");a&&n.animations.push(a.Parse(i))}return n}get noMipmap(){return this._noMipmap}getClassName(){return"CubeTexture"}get boundingBoxSize(){return this._boundingBoxSize}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(Matrix.RotationY(this._rotationY))}get forcedExtension(){return this._forcedExtension}static CreateFromImages(t,i,a){let n="";return t.forEach((e=>n+=e)),new e(n,i,null,a,t)}clone(){let t=0;const i=SerializationHelper.Clone((()=>{const i=new e(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return t=i.Hc,i}),this);return i.Hc=t,i}};__decorate([serialize()],CubeTexture.prototype,"url",void 0),__decorate([serializeAsVector3()],CubeTexture.prototype,"boundingBoxPosition",void 0),__decorate([serializeAsVector3()],CubeTexture.prototype,"boundingBoxSize",null),__decorate([serialize("rotationY")],CubeTexture.prototype,"rotationY",null),__decorate([serialize("files")],CubeTexture.prototype,"_files",void 0),__decorate([serialize("forcedExtension")],CubeTexture.prototype,"_forcedExtension",void 0),__decorate([serialize("extensions")],CubeTexture.prototype,"_extensions",void 0),__decorate([serializeAsMatrix("textureMatrix")],CubeTexture.prototype,"_textureMatrix",void 0),__decorate([serializeAsMatrix("textureMatrixRefraction")],CubeTexture.prototype,"_textureMatrixRefraction",void 0),Texture._CubeTextureParser=CubeTexture.Parse,RegisterClass("BABYLON.CubeTexture",CubeTexture);var PrePassConfiguration=class{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(e){}bindForSubMesh(e,t,i,a,n){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&-1!==t.prePassRenderer.getIndex(2)){this.previousWorldMatrices[i.Hc]||(this.previousWorldMatrices[i.Hc]=a.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());const n=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=n.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==n.frameId&&(this._lastUpdateFrameId=n.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[i.Hc]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.Hc]=a.clone()}}},MaterialFlags=class{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set ClearCoatBumpTextureEnabled(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set ReflectionTextureEnabled(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set ClearCoatTextureEnabled(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set ClearCoatTintTextureEnabled(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set RefractionTextureEnabled(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set SheenTextureEnabled(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set DecalMapEnabled(e){this._DecalMapEnabled!==e&&(this._DecalMapEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set AnisotropicTextureEnabled(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set DiffuseTextureEnabled(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set ColorGradingTextureEnabled(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set LightmapTextureEnabled(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set ThicknessTextureEnabled(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set AmbientTextureEnabled(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set SpecularTextureEnabled(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set IridescenceTextureEnabled(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set FresnelEnabled(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,Engine.MarkAllMaterialsAsDirty(4))}static set DetailTextureEnabled(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set OpacityTextureEnabled(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set TranslucencyColorTextureEnabled(e){this._TranslucencyColorTextureEnabled!==e&&(this._TranslucencyColorTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set TranslucencyIntensityTextureEnabled(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set RefractionIntensityTextureEnabled(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set BumpTextureEnabled(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}static set EmissiveTextureEnabled(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,Engine.MarkAllMaterialsAsDirty(1))}};MaterialFlags._DiffuseTextureEnabled=!0,MaterialFlags._DetailTextureEnabled=!0,MaterialFlags._DecalMapEnabled=!0,MaterialFlags._AmbientTextureEnabled=!0,MaterialFlags._OpacityTextureEnabled=!0,MaterialFlags._ReflectionTextureEnabled=!0,MaterialFlags._EmissiveTextureEnabled=!0,MaterialFlags._SpecularTextureEnabled=!0,MaterialFlags._BumpTextureEnabled=!0,MaterialFlags._LightmapTextureEnabled=!0,MaterialFlags._RefractionTextureEnabled=!0,MaterialFlags._ColorGradingTextureEnabled=!0,MaterialFlags._FresnelEnabled=!0,MaterialFlags._ClearCoatTextureEnabled=!0,MaterialFlags._ClearCoatBumpTextureEnabled=!0,MaterialFlags._ClearCoatTintTextureEnabled=!0,MaterialFlags._SheenTextureEnabled=!0,MaterialFlags._AnisotropicTextureEnabled=!0,MaterialFlags._ThicknessTextureEnabled=!0,MaterialFlags._RefractionIntensityTextureEnabled=!0,MaterialFlags._TranslucencyIntensityTextureEnabled=!0,MaterialFlags._TranslucencyColorTextureEnabled=!0,MaterialFlags._IridescenceTextureEnabled=!0,init_shaderStore();var rxOption=new RegExp("^([gimus]+)!"),MaterialPluginManager=class e{_collectPointNames(e,t){if(t)for(const i in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][i]=!0}_handlePluginEventHasRenderTargetTextures(e){let t=!1;for(const e of this._activePluginsForExtraEvents)if(t=e.hasRenderTargetTextures(),t)break;e.hasRenderTargetTextures=t}_handlePluginEventIsReadyForSubMesh(e){let t=!0;for(const i of this._activePlugins)t=t&&i.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh);e.isReadyForSubMesh=t}_handlePluginEventFillRenderTargetTextures(e){for(const t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(e.renderTargets)}getPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}_handlePluginEvent(e,t){switch(e){case 512:{const e=t;for(const t of this._activePlugins)t.getActiveTextures(e.activeTextures);break}case 256:{const e=t;for(const t of this._activePlugins)t.getAnimatables(e.animatables);break}case 1024:{const e=t;let i=!1;for(const t of this._activePlugins)if(i=t.hasTexture(e.texture),i)break;e.hasTexture=i;break}case 2:{const e=t;for(const t of this._plugins)t.dispose(e.forceDisposeTextures);break}case 4:t.defineNames=this._defineNamesFromPlugins;break;case 128:{const e=t;for(const t of this._activePlugins)e.fallbackRank=t.addFallbacks(e.defines,e.fallbacks,e.fallbackRank),t.getAttributes(e.attributes,this._scene,e.mesh);this._uniformList.length>0&&e.uniforms.push(...this._uniformList),this._samplerList.length>0&&e.samplers.push(...this._samplerList),this._uboList.length>0&&e.uniformBuffersNames.push(...this._uboList),e.customCode=this._injectCustomCode(e,e.customCode);break}case 8:{const e=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const i=1===this._material.shaderLanguage;for(const t of this._plugins){const a=t.getUniforms(this._material.shaderLanguage);if(a){if(a.ubo)for(const t of a.ubo){if(t.size&&t.type){const a=t.arraySize??0;if(e.ubo.addUniform(t.name,t.size,a),i){let e;switch(t.type){case"mat4":e="mat4x4f";break;case"float":e="f32";break;default:e=`${t.type}f`}this._uboDeclaration+=`uniform ${t.name}: ${e}${a>0?`[${a}]`:""};\n`}else this._uboDeclaration+=`${t.type} ${t.name}${a>0?`[${a}]`:""};\n`}this._uniformList.push(t.name)}a.vertex&&(this._vertexDeclaration+=a.vertex+"\n"),a.fragment&&(this._fragmentDeclaration+=a.fragment+"\n")}t.getSamplers(this._samplerList),t.getUniformBuffersNames(this._uboList)}break}}}_handlePluginEventPrepareDefines(e){for(const t of this._activePlugins)t.prepareDefines(e.defines,this._scene,e.mesh)}_handlePluginEventHardBindForSubMesh(e){for(const t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}constructor(e){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=e,this._scene=e.getScene(),this._engine=this._scene.getEngine()}_addPlugin(t){for(let e=0;e<this._plugins.length;++e)if(this._plugins[e].name===t.name)return!1;if(this._material._uniformBufferLayoutBuilt)throw`The plugin "${t.name}" can't be added to the material "${this._material.name}" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.`;if(!t.isCompatible(this._material.shaderLanguage))throw`The plugin "${t.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const i=t.getClassName();e._MaterialPluginClassToMainDefine[i]||(e._MaterialPluginClassToMainDefine[i]="MATERIALPLUGIN_"+ ++e._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(e,t)=>this._handlePluginEvent(e,t),this._plugins.push(t),this._plugins.sort(((e,t)=>e.priority-t.priority)),this._codeInjectionPoints={};const a={};a[e._MaterialPluginClassToMainDefine[i]]={type:"boolean",default:!0};for(const e of this._plugins)e.collectDefines(a),this._collectPointNames("vertex",e.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",e.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=a,!0}_injectCustomCode(e,t){return(i,a)=>{t&&(a=t(i,a)),this._uboDeclaration&&(a=a.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(a=a.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(a=a.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const n=this._codeInjectionPoints?.[i];if(!n)return a;let s=null;for(let t in n){let n="";for(const a of this._activePlugins){let r=a.getCustomCode(i,this._material.shaderLanguage)?.[t];if(r){if(a.resolveIncludes){if(null===s){const t=0;s={defines:[],indexParameters:e.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:ShaderStore.GetShadersRepository(t),includesShadersStore:ShaderStore.GetIncludesShadersStore(t),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}s.isFragment="fragment"===i,_ProcessIncludes(r,s,(e=>r=e))}n+=r+"\n"}}if(n.length>0)if("!"===t.charAt(0)){t=t.substring(1);let e="g";if("!"===t.charAt(0))e="",t=t.substring(1);else{const i=rxOption.exec(t);i&&i.length>=2&&(e=i[1],t=t.substring(e.length+1))}e.indexOf("g")<0&&(e+="g");const i=a,s=new RegExp(t,e);let r=s.exec(i);for(;null!==r;){let e=n;for(let t=0;t<r.length;++t)e=e.replace("$"+t,r[t]);a=a.replace(r[0],e),r=s.exec(i)}}else{const e="#define "+t;a=a.replace(e,"\n"+n+"\n"+e)}}return a}}_activatePlugin(e){-1===this._activePlugins.indexOf(e)&&(this._activePlugins.push(e),this._activePlugins.sort(((e,t)=>e.priority-t.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort(((e,t)=>e.priority-t.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}_handlePluginEventPrepareDefinesBeforeAttributes(e){for(const t of this._activePlugins)t.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}_handlePluginEventBindForSubMesh(e){for(const t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}};MaterialPluginManager._MaterialPluginClassToMainDefine={},MaterialPluginManager._MaterialPluginCounter=0,EngineStore.OnEnginesDisposedObservable.add((()=>{UnregisterAllMaterialPlugins()}));var plugins=[],inited=!1,observer=null;function UnregisterAllMaterialPlugins(){plugins.length=0,inited=!1,Material.OnEventObservable.remove(observer),observer=null}var MaterialPluginBase=class{getSamplers(e){}hardBindForSubMesh(e,t,i,a){}getActiveTextures(e){}bindForSubMesh(e,t,i,a){}serialize(){return SerializationHelper.Serialize(this)}getClassName(){return"MaterialPluginBase"}copyTo(e){SerializationHelper.Clone((()=>e),this)}hasRenderTargetTextures(){return!1}getUniforms(e=0){return{}}dispose(e){}addFallbacks(e,t,i){return i}_enable(e){e&&this._pluginManager._activatePlugin(this)}prepareDefines(e,t,i){}collectDefines(e){if(this._pluginDefineNames)for(const t of Object.keys(this._pluginDefineNames)){if("_"===t[0])continue;const i=typeof this._pluginDefineNames[t];e[t]={type:"number"===i?"number":"string"===i?"string":"boolean"===i?"boolean":"object",default:this._pluginDefineNames[t]}}}getUniformBuffersNames(e){}getAnimatables(e){}getAttributes(e,t,i){}parse(e,t,i){SerializationHelper.Parse((()=>this),e,t,i)}hasTexture(e){return!1}fillRenderTargetTextures(e){}getCustomCode(e,t=0){return null}prepareDefinesBeforeAttributes(e,t,i){}constructor(e,t,i,a,n=!0,s=!1,r=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=e,this.name=t,this.priority=i,this.resolveIncludes=r,e.pluginManager||(e.pluginManager=new MaterialPluginManager(e),e.onDisposeObservable.add((()=>{e.pluginManager=void 0}))),this._pluginDefineNames=a,this._pluginManager=e.pluginManager,n&&this._pluginManager._addPlugin(this),s&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[63]}isCompatible(e){return 0===e}isReadyForSubMesh(e,t,i,a){return!0}};__decorate([serialize()],MaterialPluginBase.prototype,"name",void 0),__decorate([serialize()],MaterialPluginBase.prototype,"priority",void 0),__decorate([serialize()],MaterialPluginBase.prototype,"resolveIncludes",void 0),__decorate([serialize()],MaterialPluginBase.prototype,"registerForExtraEvents",void 0),RegisterClass("BABYLON.MaterialPluginBase",MaterialPluginBase);var MaterialDetailMapDefines=class extends MaterialDefines{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}},DetailMapConfiguration=class extends MaterialPluginBase{prepareDefines(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&MaterialFlags.DetailTextureEnabled&&this._isEnabled?(PrepareDefinesForMergedUV(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}getClassName(){return"DetailMapConfiguration"}isReadyForSubMesh(e,t,i){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&i.getCaps().standardDerivatives&&this._texture&&MaterialFlags.DetailTextureEnabled&&!this._texture.isReady())}hasTexture(e){return this._texture===e}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||this._texture&&MaterialFlags.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),BindTextureMatrix(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&MaterialFlags.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}getSamplers(e){e.push("detailSampler")}dispose(e){e&&this._texture?.dispose()}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}constructor(e,t=!0){super(e,"DetailMap",140,new MaterialDetailMapDefines,t),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=Material.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isCompatible(){return!0}getActiveTextures(e){this._texture&&e.push(this._texture)}};__decorate([serializeAsTexture("detailTexture"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"texture",void 0),__decorate([serialize()],DetailMapConfiguration.prototype,"diffuseBlendLevel",void 0),__decorate([serialize()],DetailMapConfiguration.prototype,"roughnessBlendLevel",void 0),__decorate([serialize()],DetailMapConfiguration.prototype,"bumpLevel",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"normalBlendMethod",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"isEnabled",void 0);var onCreatedEffectParameters2={effect:null,subMesh:null},StandardMaterialDefines=class extends MaterialDefines{setReflectionMode(e){const t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const i of t)this[i]=i===e}constructor(e){super(e),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}},StandardMaterial=class e extends PushMaterial{get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}static set ColorGradingTextureEnabled(e){MaterialFlags.ColorGradingTextureEnabled=e}static set DiffuseTextureEnabled(e){MaterialFlags.DiffuseTextureEnabled=e}get isPrePassCapable(){return!this.disableDepthWrite}static set OpacityTextureEnabled(e){MaterialFlags.OpacityTextureEnabled=e}getAlphaTestTexture(){return this._diffuseTexture}static set FresnelEnabled(e){MaterialFlags.FresnelEnabled=e}dispose(e,t){t&&(this._diffuseTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._specularTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._refractionTexture?.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}static get BumpTextureEnabled(){return MaterialFlags.BumpTextureEnabled}getAnimatables(){const e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}static set LightmapTextureEnabled(e){MaterialFlags.LightmapTextureEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}static Parse(t,i,a){const n=SerializationHelper.Parse((()=>new e(t.name,i)),t,i,a);return t.stencil&&n.stencil.parse(t.stencil,i,a),Material._ParsePlugins(t,n,i,a),n}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}getActiveTextures(){const e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}static get LightmapTextureEnabled(){return MaterialFlags.LightmapTextureEnabled}constructor(t,i,a=!1){super(t,i),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new Color3(0,0,0),this.diffuseColor=new Color3(1,1,1),this.specularColor=new Color3(1,1,1),this.emissiveColor=new Color3(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new SmartArray(16),this._worldViewProjectionMatrix=Matrix.Zero(),this._globalAmbientColor=new Color3(0,0,0),this._cacheHasRenderTargetTextures=!1,this._initShaderSourceAsync(a),this.detailMap=new DetailMapConfiguration(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new PrePassConfiguration,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}static get DetailTextureEnabled(){return MaterialFlags.DetailTextureEnabled}static get SpecularTextureEnabled(){return MaterialFlags.SpecularTextureEnabled}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}static set RefractionTextureEnabled(e){MaterialFlags.RefractionTextureEnabled=e}static set AmbientTextureEnabled(e){MaterialFlags.AmbientTextureEnabled=e}hasTexture(e){return!!super.hasTexture(e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))}static get DiffuseTextureEnabled(){return MaterialFlags.DiffuseTextureEnabled}get canRenderToMRT(){return!0}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}bindForSubMesh(t,i,a){const n=this.getScene(),s=a.materialDefines;if(!s)return;const r=a.effect;if(!r)return;this._activeEffect=r,i.getMeshUniformBuffer().bindToEffect(r,"Mesh"),i.transferToEffect(t),this._uniformBuffer.bindToEffect(r,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,n,i,t,this.isFrozen),this._eventInfo.subMesh=a,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),s.OBJECTSPACE_NORMALMAP&&(t.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const o=this._mustRebind(n,r,a,i.visibility);BindBonesParameters(i,r);const l=this._uniformBuffer;if(o){if(this.bindViewProjection(r),!l.useUbo||!this.isFrozen||!l.isSync||a._drawWrapper._forceRebindOnNextCall){if(e.FresnelEnabled&&s.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(l.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),l.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&l.updateColor4("opacityParts",new Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(l.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),l.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(l.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),l.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(l.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),l.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),n.texturesEnabled){if(this._diffuseTexture&&e.DiffuseTextureEnabled&&(l.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),BindTextureMatrix(this._diffuseTexture,l,"diffuse")),this._ambientTexture&&e.AmbientTextureEnabled&&(l.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),BindTextureMatrix(this._ambientTexture,l,"ambient")),this._opacityTexture&&e.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),BindTextureMatrix(this._opacityTexture,l,"opacity")),this._hasAlphaChannel()&&l.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&e.ReflectionTextureEnabled&&(l.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),l.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const e=this._reflectionTexture;l.updateVector3("vReflectionPosition",e.boundingBoxPosition),l.updateVector3("vReflectionSize",e.boundingBoxSize)}if(this._emissiveTexture&&e.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),BindTextureMatrix(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&e.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),BindTextureMatrix(this._lightmapTexture,l,"lightmap")),this._specularTexture&&e.SpecularTextureEnabled&&(l.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),BindTextureMatrix(this._specularTexture,l,"specular")),this._bumpTexture&&n.getEngine().getCaps().standardDerivatives&&e.BumpTextureEnabled&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),BindTextureMatrix(this._bumpTexture,l,"bump"),n._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&e.RefractionTextureEnabled){let e=1;if(this._refractionTexture.isCube||(l.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(e=this._refractionTexture.depth)),l.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,e,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const e=this._refractionTexture;l.updateVector3("vRefractionPosition",e.boundingBoxPosition),l.updateVector3("vRefractionSize",e.boundingBoxSize)}}}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),s.SPECULARTERM&&l.updateColor4("vSpecularColor",this.specularColor,this.specularPower),l.updateColor3("vEmissiveColor",e.EmissiveTextureEnabled?this.emissiveColor:Color3.BlackReadOnly),l.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),n.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),l.updateColor3("vAmbientColor",this._globalAmbientColor)}n.texturesEnabled&&(this._diffuseTexture&&e.DiffuseTextureEnabled&&r.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&e.AmbientTextureEnabled&&r.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&e.OpacityTextureEnabled&&r.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&e.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?r.setTexture("reflectionCubeSampler",this._reflectionTexture):r.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&e.EmissiveTextureEnabled&&r.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&e.LightmapTextureEnabled&&r.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&e.SpecularTextureEnabled&&r.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&n.getEngine().getCaps().standardDerivatives&&e.BumpTextureEnabled&&r.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&e.RefractionTextureEnabled&&(this._refractionTexture.isCube?r.setTexture("refractionCubeSampler",this._refractionTexture):r.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(i)&&this.getScene().depthPeelingRenderer.bind(r),this._eventInfo.subMesh=a,this._callbackPluginEventBindForSubMesh(this._eventInfo),bindClipPlane(r,this,n),this.bindEyePosition(r)}else n.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!o&&this.isFrozen||(n.lightsEnabled&&!this._disableLighting&&BindLights(n,i,r,s,this._maxSimultaneousLights),(n.fogEnabled&&i.applyFog&&n.fogMode!==Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||i.receiveShadows||s.PREPASS)&&this.bindView(r),BindFogParameters(n,i,r),s.NUM_MORPH_INFLUENCERS&&BindMorphTargetParameters(i,r),s.BAKED_VERTEX_ANIMATION_TEXTURE&&i.bakedVertexAnimationManager?.bind(r,s.INSTANCES),this.useLogarithmicDepth&&BindLogDepth(s,r,n),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(i,this._activeEffect,a),l.update()}isReadyForSubMesh(t,i,a=!1){if(!this._shadersLoaded)return!1;this._uniformBufferLayoutBuilt||this.buildUniformLayout();const n=i._drawWrapper;if(n.effect&&this.isFrozen&&n._wasPreviouslyReady&&n._wasPreviouslyUsingInstances===a)return!0;i.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),i.materialDefines=new StandardMaterialDefines(this._eventInfo.defineNames));const s=this.getScene(),r=i.materialDefines;if(this._isReadyForSubMesh(i))return!0;const o=s.getEngine();r._needNormals=PrepareDefinesForLights(s,t,r,!0,this._maxSimultaneousLights,this._disableLighting),PrepareDefinesForMultiview(s,r);const l=this.needAlphaBlendingForMesh(t)&&this.getScene().useOrderIndependentTransparency;if(PrepareDefinesForPrePass(s,r,this.canRenderToMRT&&!l),PrepareDefinesForOIT(s,r,l),r._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,r._needUVs=!1;for(let e=1;e<=6;++e)r["MAINUV"+e]=!1;if(s.texturesEnabled){if(r.DIFFUSEDIRECTUV=0,r.BUMPDIRECTUV=0,r.AMBIENTDIRECTUV=0,r.OPACITYDIRECTUV=0,r.EMISSIVEDIRECTUV=0,r.SPECULARDIRECTUV=0,r.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&e.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._diffuseTexture,r,"DIFFUSE")}else r.DIFFUSE=!1;if(this._ambientTexture&&e.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._ambientTexture,r,"AMBIENT")}else r.AMBIENT=!1;if(this._opacityTexture&&e.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._opacityTexture,r,"OPACITY"),r.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else r.OPACITY=!1;if(this._reflectionTexture&&e.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(r._needNormals=!0,r.REFLECTION=!0,r.ROUGHNESS=this._roughness>0,r.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,r.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===Texture.INVCUBIC_MODE,r.REFLECTIONMAP_3D=this._reflectionTexture.isCube,r.REFLECTIONMAP_OPPOSITEZ=r.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,r.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case Texture.EXPLICIT_MODE:r.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case Texture.PLANAR_MODE:r.setReflectionMode("REFLECTIONMAP_PLANAR");break;case Texture.PROJECTION_MODE:r.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case Texture.SKYBOX_MODE:r.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case Texture.SPHERICAL_MODE:r.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case Texture.EQUIRECTANGULAR_MODE:r.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case Texture.FIXED_EQUIRECTANGULAR_MODE:r.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:r.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case Texture.CUBIC_MODE:case Texture.INVCUBIC_MODE:default:r.setReflectionMode("REFLECTIONMAP_CUBIC")}r.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else r.REFLECTION=!1,r.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&e.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._emissiveTexture,r,"EMISSIVE")}else r.EMISSIVE=!1;if(this._lightmapTexture&&e.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._lightmapTexture,r,"LIGHTMAP"),r.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,r.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else r.LIGHTMAP=!1;if(this._specularTexture&&e.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;PrepareDefinesForMergedUV(this._specularTexture,r,"SPECULAR"),r.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else r.SPECULAR=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&e.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;PrepareDefinesForMergedUV(this._bumpTexture,r,"BUMP"),r.PARALLAX=this._useParallax,r.PARALLAX_RHS=s.useRightHandedSystem,r.PARALLAXOCCLUSION=this._useParallaxOcclusion,r.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else r.BUMP=!1,r.PARALLAX=!1,r.PARALLAX_RHS=!1,r.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&e.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;r._needUVs=!0,r.REFRACTION=!0,r.REFRACTIONMAP_3D=this._refractionTexture.isCube,r.RGBDREFRACTION=this._refractionTexture.isRGBD,r.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else r.REFRACTION=!1;r.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else r.DIFFUSE=!1,r.AMBIENT=!1,r.OPACITY=!1,r.REFLECTION=!1,r.EMISSIVE=!1,r.LIGHTMAP=!1,r.BUMP=!1,r.REFRACTION=!1;r.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),r.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,r.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,r.SPECULAROVERALPHA=this._useSpecularOverAlpha,r.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,r.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,r.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(t)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=r,this._eventInfo.subMesh=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(r._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(r),r.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,r.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}r._areFresnelDirty&&(e.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(r.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,r.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,r.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,r.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,r.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,r.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,r._needNormals=!0,r.FRESNEL=!0):r.FRESNEL=!1),PrepareDefinesForMisc(t,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(t)||this._forceAlphaTest,r,this._applyDecalMapAfterDetailMap),PrepareDefinesForFrameBoundValues(s,o,this,r,a,null,i.getRenderingMesh().hasThinInstances),this._eventInfo.defines=r,this._eventInfo.mesh=t,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),PrepareDefinesForAttributes(t,r,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let c=!1;if(r.isDirty){const e=r._areLightsDisposed;r.markAsProcessed();const a=new EffectFallbacks;r.REFLECTION&&a.addFallback(0,"REFLECTION"),r.SPECULAR&&a.addFallback(0,"SPECULAR"),r.BUMP&&a.addFallback(0,"BUMP"),r.PARALLAX&&a.addFallback(1,"PARALLAX"),r.PARALLAX_RHS&&a.addFallback(1,"PARALLAX_RHS"),r.PARALLAXOCCLUSION&&a.addFallback(0,"PARALLAXOCCLUSION"),r.SPECULAROVERALPHA&&a.addFallback(0,"SPECULAROVERALPHA"),r.FOG&&a.addFallback(1,"FOG"),r.POINTSIZE&&a.addFallback(0,"POINTSIZE"),r.LOGARITHMICDEPTH&&a.addFallback(0,"LOGARITHMICDEPTH"),HandleFallbacksForShadows(r,a,this._maxSimultaneousLights),r.SPECULARTERM&&a.addFallback(0,"SPECULARTERM"),r.DIFFUSEFRESNEL&&a.addFallback(1,"DIFFUSEFRESNEL"),r.OPACITYFRESNEL&&a.addFallback(2,"OPACITYFRESNEL"),r.REFLECTIONFRESNEL&&a.addFallback(3,"REFLECTIONFRESNEL"),r.EMISSIVEFRESNEL&&a.addFallback(4,"EMISSIVEFRESNEL"),r.FRESNEL&&a.addFallback(4,"FRESNEL"),r.MULTIVIEW&&a.addFallback(0,"MULTIVIEW");const n=[VertexBuffer.PositionKind];r.NORMAL&&n.push(VertexBuffer.NormalKind),r.TANGENT&&n.push(VertexBuffer.TangentKind);for(let e=1;e<=6;++e)r["UV"+e]&&n.push(`uv${1===e?"":e}`);r.VERTEXCOLOR&&n.push(VertexBuffer.ColorKind),PrepareAttributesForBones(n,t,r,a),PrepareAttributesForInstances(n,r),PrepareAttributesForMorphTargets(n,t,r),PrepareAttributesForBakedVertexAnimation(n,t,r);let l="default";const h=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],u=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],m=["Material","Scene","Mesh"],d={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:r.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=a,this._eventInfo.fallbackRank=0,this._eventInfo.defines=r,this._eventInfo.uniforms=h,this._eventInfo.attributes=n,this._eventInfo.samplers=u,this._eventInfo.uniformBuffersNames=m,this._eventInfo.customCode=void 0,this._eventInfo.mesh=t,this._eventInfo.indexParameters=d,this._callbackPluginEventGeneric(128,this._eventInfo),PrePassConfiguration.AddUniforms(h),PrePassConfiguration.AddSamplers(u),ImageProcessingConfiguration&&(ImageProcessingConfiguration.PrepareUniforms(h,r),ImageProcessingConfiguration.PrepareSamplers(u,r)),PrepareUniformsAndSamplersList({uniformsNames:h,uniformBuffersNames:m,samplers:u,defines:r,maxSimultaneousLights:this._maxSimultaneousLights}),addClipPlaneUniforms(h);const f={};this.customShaderNameResolve&&(l=this.customShaderNameResolve(l,h,m,u,r,n,f));const p=r.toString(),_=i.effect;let g=s.getEngine().createEffect(l,{attributes:n,uniformsNames:h,uniformBuffersNames:m,samplers:u,defines:p,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:d,processFinalCode:f.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:r.PREPASS,shaderLanguage:this._shaderLanguage},o);if(this._eventInfo.customCode=void 0,g)if(this._onEffectCreatedObservable&&(onCreatedEffectParameters2.effect=g,onCreatedEffectParameters2.subMesh=i,this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters2)),this.allowShaderHotSwapping&&_&&!g.isReady()){if(g=_,r.markAsUnprocessed(),c=this.isFrozen,e)return r._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),i.setEffect(g,r,this._materialContext)}return!(!i.effect||!i.effect.isReady())&&(r._renderId=s.getRenderId(),n._wasPreviouslyReady=!c,n._wasPreviouslyUsingInstances=a,this._checkScenePerformancePriority(),!0)}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get hasRenderTargetTextures(){return!!(e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}static get FresnelEnabled(){return MaterialFlags.FresnelEnabled}clone(t,i=!0,a=""){const n=SerializationHelper.Clone((()=>new e(t,this.getScene())),this,{cloneTexturesOnlyOnce:i});return n.name=t,n.id=t,this.stencil.copyTo(n.stencil),this._clonePlugins(n,a),n}static set ReflectionTextureEnabled(e){MaterialFlags.ReflectionTextureEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}getClassName(){return"StandardMaterial"}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}static set SpecularTextureEnabled(e){MaterialFlags.SpecularTextureEnabled=e}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Material.MATERIAL_ALPHATEST)}async _initShaderSourceAsync(t=!1){const i=this.getScene().getEngine();!i.isWebGPU||t||e.ForceGLSL?await Promise.all([Promise.resolve().then((()=>(init_default_vertex2(),default_vertex_exports2))),Promise.resolve().then((()=>(init_default_fragment2(),default_fragment_exports2)))]):(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new UniformBuffer(i,void 0,void 0,this.name,!0),this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(init_default_vertex(),default_vertex_exports))),Promise.resolve().then((()=>(init_default_fragment(),default_fragment_exports)))])),this._shadersLoaded=!0}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}static get AmbientTextureEnabled(){return MaterialFlags.AmbientTextureEnabled}get cameraContrast(){return this._imageProcessingConfiguration.contrast}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Material.MATERIAL_OPAQUE}static set BumpTextureEnabled(e){MaterialFlags.BumpTextureEnabled=e}static get EmissiveTextureEnabled(){return MaterialFlags.EmissiveTextureEnabled}static set DetailTextureEnabled(e){MaterialFlags.DetailTextureEnabled=e}static get ColorGradingTextureEnabled(){return MaterialFlags.ColorGradingTextureEnabled}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}static get ReflectionTextureEnabled(){return MaterialFlags.ReflectionTextureEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),super.buildUniformLayout()}static get RefractionTextureEnabled(){return MaterialFlags.RefractionTextureEnabled}static get OpacityTextureEnabled(){return MaterialFlags.OpacityTextureEnabled}static set EmissiveTextureEnabled(e){MaterialFlags.EmissiveTextureEnabled=e}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}};StandardMaterial.ForceGLSL=!1,__decorate([serializeAsTexture("diffuseTexture")],StandardMaterial.prototype,"_diffuseTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"diffuseTexture",void 0),__decorate([serializeAsTexture("ambientTexture")],StandardMaterial.prototype,"_ambientTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"ambientTexture",void 0),__decorate([serializeAsTexture("opacityTexture")],StandardMaterial.prototype,"_opacityTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"opacityTexture",void 0),__decorate([serializeAsTexture("reflectionTexture")],StandardMaterial.prototype,"_reflectionTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"reflectionTexture",void 0),__decorate([serializeAsTexture("emissiveTexture")],StandardMaterial.prototype,"_emissiveTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"emissiveTexture",void 0),__decorate([serializeAsTexture("specularTexture")],StandardMaterial.prototype,"_specularTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"specularTexture",void 0),__decorate([serializeAsTexture("bumpTexture")],StandardMaterial.prototype,"_bumpTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"bumpTexture",void 0),__decorate([serializeAsTexture("lightmapTexture")],StandardMaterial.prototype,"_lightmapTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"lightmapTexture",void 0),__decorate([serializeAsTexture("refractionTexture")],StandardMaterial.prototype,"_refractionTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"refractionTexture",void 0),__decorate([serializeAsColor3("ambient")],StandardMaterial.prototype,"ambientColor",void 0),__decorate([serializeAsColor3("diffuse")],StandardMaterial.prototype,"diffuseColor",void 0),__decorate([serializeAsColor3("specular")],StandardMaterial.prototype,"specularColor",void 0),__decorate([serializeAsColor3("emissive")],StandardMaterial.prototype,"emissiveColor",void 0),__decorate([serialize()],StandardMaterial.prototype,"specularPower",void 0),__decorate([serialize("useAlphaFromDiffuseTexture")],StandardMaterial.prototype,"_useAlphaFromDiffuseTexture",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"useAlphaFromDiffuseTexture",void 0),__decorate([serialize("useEmissiveAsIllumination")],StandardMaterial.prototype,"_useEmissiveAsIllumination",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useEmissiveAsIllumination",void 0),__decorate([serialize("linkEmissiveWithDiffuse")],StandardMaterial.prototype,"_linkEmissiveWithDiffuse",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"linkEmissiveWithDiffuse",void 0),__decorate([serialize("useSpecularOverAlpha")],StandardMaterial.prototype,"_useSpecularOverAlpha",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useSpecularOverAlpha",void 0),__decorate([serialize("useReflectionOverAlpha")],StandardMaterial.prototype,"_useReflectionOverAlpha",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useReflectionOverAlpha",void 0),__decorate([serialize("disableLighting")],StandardMaterial.prototype,"_disableLighting",void 0),__decorate([expandToProperty("_markAllSubMeshesAsLightsDirty")],StandardMaterial.prototype,"disableLighting",void 0),__decorate([serialize("useObjectSpaceNormalMap")],StandardMaterial.prototype,"_useObjectSpaceNormalMap",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useObjectSpaceNormalMap",void 0),__decorate([serialize("useParallax")],StandardMaterial.prototype,"_useParallax",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useParallax",void 0),__decorate([serialize("useParallaxOcclusion")],StandardMaterial.prototype,"_useParallaxOcclusion",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useParallaxOcclusion",void 0),__decorate([serialize()],StandardMaterial.prototype,"parallaxScaleBias",void 0),__decorate([serialize("roughness")],StandardMaterial.prototype,"_roughness",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"roughness",void 0),__decorate([serialize()],StandardMaterial.prototype,"indexOfRefraction",void 0),__decorate([serialize()],StandardMaterial.prototype,"invertRefractionY",void 0),__decorate([serialize()],StandardMaterial.prototype,"alphaCutOff",void 0),__decorate([serialize("useLightmapAsShadowmap")],StandardMaterial.prototype,"_useLightmapAsShadowmap",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useLightmapAsShadowmap",void 0),__decorate([serializeAsFresnelParameters("diffuseFresnelParameters")],StandardMaterial.prototype,"_diffuseFresnelParameters",void 0),__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"diffuseFresnelParameters",void 0),__decorate([serializeAsFresnelParameters("opacityFresnelParameters")],StandardMaterial.prototype,"_opacityFresnelParameters",void 0),__decorate([expandToProperty("_markAllSubMeshesAsFresnelAndMiscDirty")],StandardMaterial.prototype,"opacityFresnelParameters",void 0),__decorate([serializeAsFresnelParameters("reflectionFresnelParameters")],StandardMaterial.prototype,"_reflectionFresnelParameters",void 0),__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"reflectionFresnelParameters",void 0),__decorate([serializeAsFresnelParameters("refractionFresnelParameters")],StandardMaterial.prototype,"_refractionFresnelParameters",void 0),__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"refractionFresnelParameters",void 0),__decorate([serializeAsFresnelParameters("emissiveFresnelParameters")],StandardMaterial.prototype,"_emissiveFresnelParameters",void 0),__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"emissiveFresnelParameters",void 0),__decorate([serialize("useReflectionFresnelFromSpecular")],StandardMaterial.prototype,"_useReflectionFresnelFromSpecular",void 0),__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"useReflectionFresnelFromSpecular",void 0),__decorate([serialize("useGlossinessFromSpecularMapAlpha")],StandardMaterial.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useGlossinessFromSpecularMapAlpha",void 0),__decorate([serialize("maxSimultaneousLights")],StandardMaterial.prototype,"_maxSimultaneousLights",void 0),__decorate([expandToProperty("_markAllSubMeshesAsLightsDirty")],StandardMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([serialize("invertNormalMapX")],StandardMaterial.prototype,"_invertNormalMapX",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"invertNormalMapX",void 0),__decorate([serialize("invertNormalMapY")],StandardMaterial.prototype,"_invertNormalMapY",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"invertNormalMapY",void 0),__decorate([serialize("twoSidedLighting")],StandardMaterial.prototype,"_twoSidedLighting",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"twoSidedLighting",void 0),__decorate([serialize("applyDecalMapAfterDetailMap")],StandardMaterial.prototype,"_applyDecalMapAfterDetailMap",void 0),__decorate([expandToProperty("_markAllSubMeshesAsMiscDirty")],StandardMaterial.prototype,"applyDecalMapAfterDetailMap",void 0),RegisterClass("BABYLON.StandardMaterial",StandardMaterial),Scene.DefaultMaterialFactory=e=>new StandardMaterial("default material",e);var ThinSprite=class{get toIndex(){return this._toIndex}get loopAnimation(){return this._loopAnimation}playAnimation(e,t,i,a,n){this._fromIndex=e,this._toIndex=t,this._loopAnimation=i,this._delay=a||1,this._animationStarted=!0,this._onBaseAnimationEnd=n,e<t?this._direction=1:(this._direction=-1,this._toIndex=e,this._fromIndex=t),this.cellIndex=e,this._time=0}get animationStarted(){return this._animationStarted}get fromIndex(){return this._fromIndex}constructor(){this.width=1,this.height=1,this.angle=0,this.invertU=!1,this.invertV=!1,this.isVisible=!0,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._onBaseAnimationEnd=null,this.position={x:1,y:1,z:1},this.color={r:1,g:1,b:1,a:1}}stopAnimation(){this._animationStarted=!1}_animate(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onBaseAnimationEnd&&this._onBaseAnimationEnd()))))}get delay(){return Math.max(this._delay,1)}},Sprite=class e extends ThinSprite{serialize(){const e={};return e.name=this.name,e.position=this.position.asArray(),e.color=this.color.asArray(),e.width=this.width,e.height=this.height,e.angle=this.angle,e.cellIndex=this.cellIndex,e.cellRef=this.cellRef,e.invertU=this.invertU,e.invertV=this.invertV,e.disposeWhenFinishedAnimating=this.disposeWhenFinishedAnimating,e.isPickable=this.isPickable,e.isVisible=this.isVisible,e.useAlphaForPicking=this.useAlphaForPicking,e.animationStarted=this.animationStarted,e.fromIndex=this.fromIndex,e.toIndex=this.toIndex,e.loopAnimation=this.loopAnimation,e.delay=this.delay,e}static Parse(t,i){const a=new e(t.name,i);return a.position=Vector3.FromArray(t.position),a.color=Color4.FromArray(t.color),a.width=t.width,a.height=t.height,a.angle=t.angle,a.cellIndex=t.cellIndex,a.cellRef=t.cellRef,a.invertU=t.invertU,a.invertV=t.invertV,a.disposeWhenFinishedAnimating=t.disposeWhenFinishedAnimating,a.isPickable=t.isPickable,a.isVisible=t.isVisible,a.useAlphaForPicking=t.useAlphaForPicking,a._fromIndex=t.fromIndex,a._toIndex=t.toIndex,a._loopAnimation=t.loopAnimation,a._delay=t.delay,t.animationStarted&&a.playAnimation(a.fromIndex,a.toIndex,a.loopAnimation,a.delay),a}playAnimation(e,t,i,a,n=null){this._onAnimationEnd=n,super.playAnimation(e,t,i,a,this._endAnimation)}set size(e){this.width=e,this.height=e}get delay(){return Math.max(this._delay,1)}getClassName(){return"Sprite"}set fromIndex(e){this.playAnimation(e,this._toIndex,this._loopAnimation,this._delay,this._onAnimationEnd)}get toIndex(){return this._toIndex}dispose(){for(let e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1);this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}set delay(e){this.playAnimation(this._fromIndex,this._toIndex,this._loopAnimation,e,this._onAnimationEnd)}get manager(){return this._manager}get fromIndex(){return this._fromIndex}set toIndex(e){this.playAnimation(this._fromIndex,e,this._loopAnimation,this._delay,this._onAnimationEnd)}set loopAnimation(e){this.playAnimation(this._fromIndex,this._toIndex,e,this._delay,this._onAnimationEnd)}constructor(e,t){super(),this.name=e,this.animations=new Array,this.isPickable=!1,this.useAlphaForPicking=!1,this.onDisposeObservable=new Observable,this._onAnimationEnd=null,this._endAnimation=()=>{this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()},this.color=new Color4(1,1,1,1),this.position=Vector3.Zero(),this._manager=t,this._manager.sprites.push(this),this.Hc=this._manager.scene.getUniqueId()}get size(){return this.width}get loopAnimation(){return this._loopAnimation}},Ray=class e{static Transform(t,i){const a=new e(new Vector3(0,0,0),new Vector3(0,0,0));return e.TransformToRef(t,i,a),a}update(t,i,a,n,s,r,o,l=!1){if(l){e._RayDistant||(e._RayDistant=e.Zero()),e._RayDistant.unprojectRayToRef(t,i,a,n,Matrix.IdentityReadOnly,r,o);const l=TmpVectors.Matrix[0];s.invertToRef(l),e.TransformToRef(e._RayDistant,l,this)}else this.unprojectRayToRef(t,i,a,n,s,r,o);return this}intersectsBoxMinMax(t,i,a=0){const n=e._TmpVector3[0].copyFromFloats(t.x-a,t.y-a,t.z-a),s=e._TmpVector3[1].copyFromFloats(i.x+a,i.y+a,i.z+a);let r,o,l,c,h=0,u=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<n.x||this.origin.x>s.x)return!1}else if(r=1/this.direction.x,o=(n.x-this.origin.x)*r,l=(s.x-this.origin.x)*r,l===-1/0&&(l=1/0),o>l&&(c=o,o=l,l=c),h=Math.max(o,h),u=Math.min(l,u),h>u)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<n.y||this.origin.y>s.y)return!1}else if(r=1/this.direction.y,o=(n.y-this.origin.y)*r,l=(s.y-this.origin.y)*r,l===-1/0&&(l=1/0),o>l&&(c=o,o=l,l=c),h=Math.max(o,h),u=Math.min(l,u),h>u)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<n.z||this.origin.z>s.z)return!1}else if(r=1/this.direction.z,o=(n.z-this.origin.z)*r,l=(s.z-this.origin.z)*r,l===-1/0&&(l=1/0),o>l&&(c=o,o=l,l=c),h=Math.max(o,h),u=Math.min(l,u),h>u)return!1;return!0}intersectsPlane(e){let t;const i=Vector3.Dot(e.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const a=Vector3.Dot(e.normal,this.origin);return t=(-e.d-a)/i,t<0?t<-9.99999997475243e-7?null:0:t}}static CreateNewFromTo(t,i,a=Matrix.IdentityReadOnly){const n=new e(new Vector3(0,0,0),new Vector3(0,0,0));return e.CreateFromToToRef(t,i,n,a)}intersectsAxis(e,t=0){switch(e){case"y":{const e=(this.origin.y-t)/this.direction.y;return e>0?null:new Vector3(this.origin.x+this.direction.x*-e,t,this.origin.z+this.direction.z*-e)}case"x":{const e=(this.origin.x-t)/this.direction.x;return e>0?null:new Vector3(t,this.origin.y+this.direction.y*-e,this.origin.z+this.direction.z*-e)}case"z":{const e=(this.origin.z-t)/this.direction.z;return e>0?null:new Vector3(this.origin.x+this.direction.x*-e,this.origin.y+this.direction.y*-e,t)}default:return null}}static TransformToRef(e,t,i){Vector3.TransformCoordinatesToRef(e.origin,t,i.origin),Vector3.TransformNormalToRef(e.direction,t,i.direction),i.length=e.length,i.epsilon=e.epsilon;const a=i.direction,n=a.length();if(0!==n&&1!==n){const e=1/n;a.x*=e,a.y*=e,a.z*=e,i.length*=n}return i}intersectsBox(e,t=0){return this.intersectsBoxMinMax(e.minimum,e.maximum,t)}intersectionSegment(t,i,a){const n=this.origin,s=TmpVectors.Vector3[0],r=TmpVectors.Vector3[1],o=TmpVectors.Vector3[2],l=TmpVectors.Vector3[3];i.subtractToRef(t,s),this.direction.scaleToRef(e._Rayl,o),n.addToRef(o,r),t.subtractToRef(n,l);const c=Vector3.Dot(s,s),h=Vector3.Dot(s,o),u=Vector3.Dot(o,o),m=Vector3.Dot(s,l),d=Vector3.Dot(o,l),f=c*u-h*h;let p,_,g=f,v=f;f<e._Smallnum?(p=0,g=1,_=d,v=u):(p=h*d-u*m,_=c*d-h*m,p<0?(p=0,_=d,v=u):p>g&&(p=g,_=d+h,v=u)),_<0?(_=0,-m<0?p=0:-m>c?p=g:(p=-m,g=c)):_>v&&(_=v,-m+h<0?p=0:-m+h>c?p=g:(p=-m+h,g=c));const y=Math.abs(p)<e._Smallnum?0:p/g,S=Math.abs(_)<e._Smallnum?0:_/v,C=TmpVectors.Vector3[4];o.scaleToRef(S,C);const E=TmpVectors.Vector3[5];s.scaleToRef(y,E),E.addInPlace(l);const A=TmpVectors.Vector3[6];E.subtractToRef(C,A);return S>0&&S<=this.length&&A.lengthSquared()<a*a?E.length():-1}static CreateNew(t,i,a,n,s,r,o){return e.Zero().update(t,i,a,n,s,r,o)}unprojectRayToRef(e,t,i,a,n,s,r){const o=TmpVectors.Matrix[0];n.multiplyToRef(s,o),o.multiplyToRef(r,o),o.invert();const l=EngineStore.LastCreatedEngine,c=TmpVectors.Vector3[0];c.x=e/i*2-1,c.y=-(t/a*2-1),c.z=l?.useReverseDepthBuffer?1:l?.isNDCHalfZRange?0:-1;const h=TmpVectors.Vector3[1].copyFromFloats(c.x,c.y,1-1e-8),u=TmpVectors.Vector3[2],m=TmpVectors.Vector3[3];Vector3._UnprojectFromInvertedMatrixToRef(c,o,u),Vector3._UnprojectFromInvertedMatrixToRef(h,o,m),this.origin.copyFrom(u),m.subtractToRef(u,this.direction),this.direction.normalize()}constructor(e,t,i=Number.MAX_VALUE,a=Epsilon){this.origin=e,this.direction=t,this.length=i,this.epsilon=a}clone(){return new e(this.origin.clone(),this.direction.clone(),this.length)}intersectsMesh(t,i,a,n=!1,s,r=!1){const o=TmpVectors.Matrix[0];return t.getWorldMatrix().invertToRef(o),this._tmpRay?e.TransformToRef(this,o,this._tmpRay):this._tmpRay=e.Transform(this,o),t.intersects(this._tmpRay,i,a,n,s,r)}intersectsTriangle(t,i,a){const n=e._TmpVector3[0],s=e._TmpVector3[1],r=e._TmpVector3[2],o=e._TmpVector3[3],l=e._TmpVector3[4];i.subtractToRef(t,n),a.subtractToRef(t,s),Vector3.CrossToRef(this.direction,s,r);const c=Vector3.Dot(n,r);if(0===c)return null;const h=1/c;this.origin.subtractToRef(t,o);const u=Vector3.Dot(o,r)*h;if(u<-this.epsilon||u>1+this.epsilon)return null;Vector3.CrossToRef(o,n,l);const m=Vector3.Dot(this.direction,l)*h;if(m<-this.epsilon||u+m>1+this.epsilon)return null;const d=Vector3.Dot(s,l)*h;return d>this.length?null:new IntersectionInfo(1-u-m,u,d)}intersectsSphere(e,t=0){const i=e.center.x-this.origin.x,a=e.center.y-this.origin.y,n=e.center.z-this.origin.z,s=i*i+a*a+n*n,r=e.radius+t,o=r*r;if(s<=o)return!0;const l=i*this.direction.x+a*this.direction.y+n*this.direction.z;if(l<0)return!1;return s-l*l<=o}static Zero(){return new e(Vector3.Zero(),Vector3.Zero())}intersectsMeshes(e,t,i){i?i.length=0:i=[];for(let a=0;a<e.length;a++){const n=this.intersectsMesh(e[a],t);n.hit&&i.push(n)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}static CreateFromToToRef(t,i,a,n=Matrix.IdentityReadOnly){a.origin.copyFrom(t);const s=i.subtractToRef(t,a.direction),r=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return a.length=r,a.direction.normalize(),e.TransformToRef(a,n,a)}};Ray._TmpVector3=BuildArray(6,Vector3.Zero),Ray._RayDistant=Ray.Zero(),Ray._Smallnum=1e-8,Ray._Rayl=1e9,Scene.prototype.createPickingRay=function(e,t,i,a,n=!1){const s=Ray.Zero();return this.createPickingRayToRef(e,t,i,s,a,n),s},Scene.prototype.createPickingRayToRef=function(e,t,i,a,n,s=!1,r=!1){const o=this.getEngine();if(!n&&!(n=this.activeCamera))return this;const l=n.viewport,c=o.getRenderHeight(),{x:h,y:u,width:m,height:d}=l.toGlobal(o.getRenderWidth(),c),f=1/o.getHardwareScalingLevel();return e=e*f-h,t=t*f-(c-u-d),a.update(e,t,m,d,i||Matrix.IdentityReadOnly,s?Matrix.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix(),r),this},Scene.prototype.createPickingRayInCameraSpace=function(e,t,i){const a=Ray.Zero();return this.createPickingRayInCameraSpaceToRef(e,t,a,i),a},Scene.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,a){if(!PickingInfo)return this;const n=this.getEngine();if(!a&&!(a=this.activeCamera))throw new Error("Active camera not set");const s=a.viewport,r=n.getRenderHeight(),{x:o,y:l,width:c,height:h}=s.toGlobal(n.getRenderWidth(),r),u=Matrix.Identity(),m=1/n.getHardwareScalingLevel();return e=e*m-o,t=t*m-(r-l-h),i.update(e,t,c,h,u,u,a.getProjectionMatrix()),this},Scene.prototype._internalPickForMesh=function(e,t,i,a,n,s,r,o){const l=t(a,i.enableDistantPicking),c=i.intersects(l,n,r,s,a,o);return c&&c.hit?!n&&null!=e&&c.distance>=e.distance?null:c:null},Scene.prototype._internalPick=function(e,t,i,a,n){let s=null;const r=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),o=this.cameraToUseForPointers||this.activeCamera;for(let l=0;l<this.meshes.length;l++){const c=this.meshes[l];if(t){if(!t(c))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;const h=r&&c.isWorldMatrixCameraDependent(),u=c.computeWorldMatrix(h,o);if(c.hasThinInstances&&c.thinInstanceEnablePicking){const t=this._internalPickForMesh(s,e,c,u,!0,!0,n);if(t){if(a)return t;const r=TmpVectors.Matrix[1],o=c.thinInstanceGetWorldMatrices();for(let t=0;t<o.length;t++){o[t].multiplyToRef(u,r);const l=this._internalPickForMesh(s,e,c,r,i,a,n,!0);if(l&&(s=l,s.thinInstanceIndex=t,i))return s}}}else{const t=this._internalPickForMesh(s,e,c,u,i,a,n);if(t&&(s=t,i))return s}}return s||new PickingInfo},Scene.prototype._internalMultiPick=function(e,t,i){if(!PickingInfo)return null;const a=[],n=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),s=this.cameraToUseForPointers||this.activeCamera;for(let r=0;r<this.meshes.length;r++){const o=this.meshes[r];if(t){if(!t(o))continue}else if(!o.isEnabled()||!o.isVisible||!o.isPickable)continue;const l=n&&o.isWorldMatrixCameraDependent(),c=o.computeWorldMatrix(l,s);if(o.hasThinInstances&&o.thinInstanceEnablePicking){if(this._internalPickForMesh(null,e,o,c,!0,!0,i)){const t=TmpVectors.Matrix[1],n=o.thinInstanceGetWorldMatrices();for(let s=0;s<n.length;s++){n[s].multiplyToRef(c,t);const r=this._internalPickForMesh(null,e,o,t,!1,!1,i,!0);r&&(r.thinInstanceIndex=s,a.push(r))}}}else{const t=this._internalPickForMesh(null,e,o,c,!1,!1,i);t&&a.push(t)}}return a},Scene.prototype.pickWithBoundingInfo=function(e,t,i,a,n){if(!PickingInfo)return null;const s=this._internalPick((i=>(this._tempPickingRay||(this._tempPickingRay=Ray.Zero()),this.createPickingRayToRef(e,t,i,this._tempPickingRay,n||null),this._tempPickingRay)),i,a,!0);return s&&(s.ray=this.createPickingRay(e,t,Matrix.Identity(),n||null)),s},Object.defineProperty(Scene.prototype,"_pickingAvailable",{get:()=>!0,enumerable:!1,configurable:!1}),Scene.prototype.pick=function(e,t,i,a,n,s,r=!1){const o=this._internalPick(((i,a)=>(this._tempPickingRay||(this._tempPickingRay=Ray.Zero()),this.createPickingRayToRef(e,t,i,this._tempPickingRay,n||null,!1,a),this._tempPickingRay)),i,a,!1,s);return o&&(o.ray=this.createPickingRay(e,t,Matrix.Identity(),n||null)),o},Scene.prototype.pickWithRay=function(e,t,i,a){const n=this._internalPick((t=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=Matrix.Identity()),t.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=Ray.Zero()),Ray.TransformToRef(e,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),t,i,!1,a);return n&&(n.ray=e),n},Scene.prototype.multiPick=function(e,t,i,a,n){return this._internalMultiPick((i=>this.createPickingRay(e,t,i,a||null)),i,n)},Scene.prototype.multiPickWithRay=function(e,t,i){return this._internalMultiPick((t=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=Matrix.Identity()),t.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=Ray.Zero()),Ray.TransformToRef(e,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),t,i)},Camera.prototype.getForwardRay=function(e=100,t,i){return this.getForwardRayToRef(new Ray(Vector3.Zero(),Vector3.Zero(),e),e,t,i)},Camera.prototype.getForwardRayToRef=function(e,t=100,i,a){i||(i=this.getWorldMatrix()),e.length=t,a?e.origin.copyFrom(a):e.origin.copyFrom(this.position);const n=TmpVectors.Vector3[2];n.set(0,0,this._scene.useRightHandedSystem?-1:1);const s=TmpVectors.Vector3[3];return Vector3.TransformNormalToRef(n,i,s),Vector3.NormalizeToRef(s,e.direction),e},Scene.prototype._internalPickSprites=function(e,t,i,a){if(!PickingInfo)return null;let n=null;if(!a){if(!this.activeCamera)return null;a=this.activeCamera}if(this.spriteManagers&&this.spriteManagers.length>0)for(let s=0;s<this.spriteManagers.length;s++){const r=this.spriteManagers[s];if(!r.isPickable)continue;const o=r.intersects(e,a,t,i);if(o&&o.hit&&((i||null==n||!(o.distance>=n.distance))&&(n=o,i)))break}return n||new PickingInfo},Scene.prototype._internalMultiPickSprites=function(e,t,i){if(!PickingInfo)return null;let a=[];if(!i){if(!this.activeCamera)return null;i=this.activeCamera}if(this.spriteManagers&&this.spriteManagers.length>0)for(let n=0;n<this.spriteManagers.length;n++){const s=this.spriteManagers[n];if(!s.isPickable)continue;const r=s.multiIntersects(e,i,t);null!==r&&(a=a.concat(r))}return a},Scene.prototype.pickSprite=function(e,t,i,a,n){if(!this._tempSpritePickingRay)return null;this.createPickingRayInCameraSpaceToRef(e,t,this._tempSpritePickingRay,n);const s=this._internalPickSprites(this._tempSpritePickingRay,i,a,n);return s&&(s.ray=this.createPickingRayInCameraSpace(e,t,n)),s},Scene.prototype.pickSpriteWithRay=function(e,t,i,a){if(!this._tempSpritePickingRay)return null;if(!a){if(!this.activeCamera)return null;a=this.activeCamera}Ray.TransformToRef(e,a.getViewMatrix(),this._tempSpritePickingRay);const n=this._internalPickSprites(this._tempSpritePickingRay,t,i,a);return n&&(n.ray=e),n},Scene.prototype.multiPickSprite=function(e,t,i,a){return this.createPickingRayInCameraSpaceToRef(e,t,this._tempSpritePickingRay,a),this._internalMultiPickSprites(this._tempSpritePickingRay,i,a)},Scene.prototype.multiPickSpriteWithRay=function(e,t,i){if(!this._tempSpritePickingRay)return null;if(!i){if(!this.activeCamera)return null;i=this.activeCamera}return Ray.TransformToRef(e,i.getViewMatrix(),this._tempSpritePickingRay),this._internalMultiPickSprites(this._tempSpritePickingRay,t,i)},Scene.prototype.setPointerOverSprite=function(e){this._pointerOverSprite!==e&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(10,ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=e,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(9,ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},Scene.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var SpriteSceneComponent=class{_pickSpriteButKeepRay(e,t,i,a,n){const s=this.scene.pickSprite(t,i,this._spritePredicate,a,n);return s&&(s.ray=e?e.ray:null),s}_pointerUp(e,t,i,a,n){const s=this.scene;if(s.spriteManagers&&s.spriteManagers.length>0){const i=s.pickSprite(e,t,this._spritePredicate,!1,s.cameraToUseForPointers||void 0);i&&(i.hit&&i.pickedSprite&&i.pickedSprite.actionManager&&(i.pickedSprite.actionManager.processTrigger(7,ActionEvent.CreateNewFromSprite(i.pickedSprite,s,a)),i.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||i.pickedSprite.actionManager.processTrigger(1,ActionEvent.CreateNewFromSprite(i.pickedSprite,s,a)),n&&i.pickedSprite.actionManager.processTrigger(6,ActionEvent.CreateNewFromSprite(i.pickedSprite,s,a)))),s._pickedDownSprite&&s._pickedDownSprite.actionManager&&s._pickedDownSprite!==i.pickedSprite&&s._pickedDownSprite.actionManager.processTrigger(16,ActionEvent.CreateNewFromSprite(s._pickedDownSprite,s,a)))}return i}_pointerDown(e,t,i,a){const n=this.scene;if(n._pickedDownSprite=null,n.spriteManagers&&n.spriteManagers.length>0&&(i=n.pickSprite(e,t,this._spritePredicate,!1,n.cameraToUseForPointers||void 0))&&i.hit&&i.pickedSprite&&i.pickedSprite.actionManager){switch(n._pickedDownSprite=i.pickedSprite,a.button){case 0:i.pickedSprite.actionManager.processTrigger(2,ActionEvent.CreateNewFromSprite(i.pickedSprite,n,a));break;case 1:i.pickedSprite.actionManager.processTrigger(4,ActionEvent.CreateNewFromSprite(i.pickedSprite,n,a));break;case 2:i.pickedSprite.actionManager.processTrigger(3,ActionEvent.CreateNewFromSprite(i.pickedSprite,n,a))}i.pickedSprite.actionManager&&i.pickedSprite.actionManager.processTrigger(5,ActionEvent.CreateNewFromSprite(i.pickedSprite,n,a))}return i}dispose(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();const e=this.scene.spriteManagers;if(e)for(;e.length;)e[0].dispose()}constructor(e){this.name=SceneComponentConstants.NAME_SPRITE,this.scene=e,this.scene.spriteManagers=[],this.scene._tempSpritePickingRay=Ray?Ray.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new Observable,this.scene.onAfterSpritesRenderingObservable=new Observable,this._spritePredicate=e=>!!e.actionManager&&(e.isPickable&&e.actionManager.hasPointerTriggers)}_pointerMove(e,t,i,a,n){const s=this.scene;return a?s.setPointerOverSprite(null):(i=this._pickSpriteButKeepRay(i,e,t,!1,s.cameraToUseForPointers||void 0))&&i.hit&&i.pickedSprite?(s.setPointerOverSprite(i.pickedSprite),!s.doNotHandleCursors&&n&&(s._pointerOverSprite&&s._pointerOverSprite.actionManager&&s._pointerOverSprite.actionManager.hoverCursor?n.style.cursor=s._pointerOverSprite.actionManager.hoverCursor:n.style.cursor=s.hoverCursor)):s.setPointerOverSprite(null),i}register(){this.scene._pointerMoveStage.registerStep(SceneComponentConstants.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(SceneComponentConstants.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(SceneComponentConstants.STEP_POINTERUP_SPRITE,this,this._pointerUp)}rebuild(){}},SpriteRenderer=class e{get fogEnabled(){return this._fogEnabled}dispose(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this.texture&&(this.texture.dispose(),this.texture=null),this._drawWrapperBase.dispose(),this._drawWrapperDepth.dispose()}_buildIndexBuffer(){const e=[];let t=0;for(let i=0;i<this._capacity;i++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._engine.createIndexBuffer(e)}get shaderLanguage(){return this._shaderLanguage}get useLogarithmicDepth(){return this._useLogarithmicDepth}render(e,t,i,a,n=null){if(!(this._shadersLoaded&&this.texture&&this.texture.isReady()&&e.length))return;const s=this._drawWrapperBase,r=this._drawWrapperDepth,o=this.fogEnabled&&this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode,l=s.effect;if(!l.isReady())return;const c=this._engine,h=!(!this._scene||!this._scene.useRightHandedSystem),u=this.texture.getBaseSize(),m=Math.min(this._capacity,e.length);let d=0,f=!0;for(let i=0;i<m;i++){const a=e[i];a&&a.isVisible&&(f=!1,a._animate(t),this._appendSpriteVertex(d++,a,0,0,u,h,n),this._useInstancing||(this._appendSpriteVertex(d++,a,1,0,u,h,n),this._appendSpriteVertex(d++,a,1,1,u,h,n),this._appendSpriteVertex(d++,a,0,1,u,h,n)))}if(f)return;this._buffer.update(this._vertexData);const p=!!c.depthCullingState.cull,_=c.depthCullingState.zOffset,g=c.depthCullingState.zOffsetUnits;if(c.setState(p,_,!1,!1,void 0,void 0,g),c.enableEffect(s),l.setTexture("diffuseSampler",this.texture),l.setMatrix("view",i),l.setMatrix("projection",a),o){const e=this._scene;l.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),l.setColor3("vFogColor",e.fogColor)}this.useLogarithmicDepth&&this._scene&&BindLogDepth(s.defines,l,this._scene),this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=c.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,l)),c.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):c.bindBuffers(this._vertexBuffers,this._indexBuffer,l),c.depthCullingState.depthFunc=c.useReverseDepthBuffer?518:515,this.disableDepthWrite||(l.setBool("alphaTest",!0),c.setColorWrite(!1),c.enableEffect(r),this._useInstancing?c.drawArraysType(7,0,4,d):c.drawElementsType(0,0,d/4*6),c.enableEffect(s),c.setColorWrite(!0),l.setBool("alphaTest",!1)),c.setAlphaMode(this.blendMode),this._useInstancing?c.drawArraysType(7,0,4,d):c.drawElementsType(0,0,d/4*6),this.autoResetAlpha&&c.setAlphaMode(0),h&&this._scene.getEngine().setState(p,_,!1,!0,void 0,void 0,g),c.unbindInstanceAttributes()}set useLogarithmicDepth(e){const t=!!this._scene?.getEngine().getCaps().fragmentDepthSupported;e&&!t&&Logger.Warn("Logarithmic depth has been requested for a sprite renderer on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._createEffects()}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this._createEffects())}async _initShaderSourceAsync(){this._engine.isWebGPU&&!e.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(init_sprites_vertex(),sprites_vertex_exports))),Promise.resolve().then((()=>(init_sprites_fragment(),sprites_fragment_exports)))])):await Promise.all([Promise.resolve().then((()=>(init_sprites_vertex2(),sprites_vertex_exports2))),Promise.resolve().then((()=>(init_sprites_fragment2(),sprites_fragment_exports2)))]),this._shadersLoaded=!0,this._createEffects()}_createEffects(){this._drawWrapperBase?.dispose(),this._drawWrapperDepth?.dispose(),this._drawWrapperBase=new DrawWrapper(this._engine),this._drawWrapperDepth=new DrawWrapper(this._engine,!1),this._drawWrapperBase.drawContext&&(this._drawWrapperBase.drawContext.useInstancing=this._useInstancing),this._drawWrapperDepth.drawContext&&(this._drawWrapperDepth.drawContext.useInstancing=this._useInstancing);let e="";this._pixelPerfect&&(e+="#define PIXEL_PERFECT\n"),this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode&&this._fogEnabled&&(e+="#define FOG\n"),this._useLogarithmicDepth&&(e+="#define LOGARITHMICDEPTH\n"),this._drawWrapperBase.effect=this._engine.createEffect("sprites",[VertexBuffer.PositionKind,"options","offsets","inverts","cellInfo",VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor","logarithmicDepthConstant"],["diffuseSampler"],e,void 0,void 0,void 0,void 0,this._shaderLanguage),this._drawWrapperDepth.effect=this._drawWrapperBase.effect,this._drawWrapperDepth.materialContext=this._drawWrapperBase.materialContext}rebuild(){this._indexBuffer&&this._buildIndexBuffer(),this._useVAO&&(this._vertexArrayObject=void 0),this._buffer._rebuild();for(const e in this._vertexBuffers){this._vertexBuffers[e]._rebuild()}this._spriteBuffer?._rebuild()}_appendSpriteVertex(e,t,i,a,n,s,r){let o=e*this._vertexBufferSize;if(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===a?a=this._epsilon:1===a&&(a=1-this._epsilon),r)r(t,n);else{t.cellIndex||(t.cellIndex=0);const e=n.width/this.cellWidth,i=t.cellIndex/e|0;t._xOffset=(t.cellIndex-i*e)*this.cellWidth/n.width,t._yOffset=i*this.cellHeight/n.height,t._xSize=this.cellWidth,t._ySize=this.cellHeight}this._vertexData[o]=t.position.x,this._vertexData[o+1]=t.position.y,this._vertexData[o+2]=t.position.z,this._vertexData[o+3]=t.angle,this._vertexData[o+4]=t.width,this._vertexData[o+5]=t.height,this._useInstancing?o-=2:(this._vertexData[o+6]=i,this._vertexData[o+7]=a),this._vertexData[o+8]=s?t.invertU?0:1:t.invertU?1:0,this._vertexData[o+9]=t.invertV?1:0,this._vertexData[o+10]=t._xOffset,this._vertexData[o+11]=t._yOffset,this._vertexData[o+12]=t._xSize/n.width,this._vertexData[o+13]=t._ySize/n.height,this._vertexData[o+14]=t.color.r,this._vertexData[o+15]=t.color.g,this._vertexData[o+16]=t.color.b,this._vertexData[o+17]=t.color.a}get Fc(){return this._capacity}set pixelPerfect(e){this._pixelPerfect!==e&&(this._pixelPerfect=e,this._createEffects())}constructor(e,t,i=.01,a=null){this.blendMode=2,this.autoResetAlpha=!0,this.disableDepthWrite=!1,this._fogEnabled=!0,this._pixelPerfect=!1,this._shaderLanguage=0,this._useVAO=!1,this._useInstancing=!1,this._vertexBuffers={},this._shadersLoaded=!1,this._capacity=t,this._epsilon=i,this._engine=e,this._useInstancing=e.getCaps().instancedArrays&&e._features.supportSpriteInstancing,this._useVAO=e.getCaps().vertexArrayObject&&!e.disableVertexArrayObjects,this._scene=a,this._useInstancing||this._buildIndexBuffer(),this._vertexBufferSize=this._useInstancing?16:18,this._vertexData=new Float32Array(t*this._vertexBufferSize*(this._useInstancing?1:4)),this._buffer=new Buffer2(e,this._vertexData,!0,this._vertexBufferSize);const n=this._buffer.createVertexBuffer(VertexBuffer.PositionKind,0,4,this._vertexBufferSize,this._useInstancing),s=this._buffer.createVertexBuffer("options",4,2,this._vertexBufferSize,this._useInstancing);let r,o=6;if(this._useInstancing){const t=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Buffer2(e,t,!1,2),r=this._spriteBuffer.createVertexBuffer("offsets",0,2)}else r=this._buffer.createVertexBuffer("offsets",o,2,this._vertexBufferSize,this._useInstancing),o+=2;const l=this._buffer.createVertexBuffer("inverts",o,2,this._vertexBufferSize,this._useInstancing),c=this._buffer.createVertexBuffer("cellInfo",o+2,4,this._vertexBufferSize,this._useInstancing),h=this._buffer.createVertexBuffer(VertexBuffer.ColorKind,o+6,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[VertexBuffer.PositionKind]=n,this._vertexBuffers.options=s,this._vertexBuffers.offsets=r,this._vertexBuffers.inverts=l,this._vertexBuffers.cellInfo=c,this._vertexBuffers[VertexBuffer.ColorKind]=h,this._initShaderSourceAsync()}get pixelPerfect(){return this._pixelPerfect}};SpriteRenderer.ForceGLSL=!1;var SpriteManager=class e{constructor(e,t,i,a,n,s=.01,r=Texture.TRILINEAR_SAMPLINGMODE,o=!1,l=null){this.name=e,this.sprites=[],this.undefinedc=0,this.layerMask=268435455,this.isPickable=!1,this.metadata=null,this._wasDispatched=!1,this.onDisposeObservable=new Observable,this._disableDepthWrite=!1,this._packedAndReady=!1,this._customUpdate=(e,t)=>{e.cellRef||(e.cellIndex=0);const i=e.cellIndex;"number"==typeof i&&isFinite(i)&&Math.floor(i)===i&&(e.cellRef=this._spriteMap[e.cellIndex]),e._xOffset=this._cellData[e.cellRef].frame.x/t.width,e._yOffset=this._cellData[e.cellRef].frame.y/t.height,e._xSize=this._cellData[e.cellRef].frame.w,e._ySize=this._cellData[e.cellRef].frame.h},n||(n=EngineStore.LastCreatedScene),n._getComponent(SceneComponentConstants.NAME_SPRITE)||n._addComponent(new SpriteSceneComponent(n)),this._fromPacked=o,this._scene=n;const c=this._scene.getEngine();if(this._spriteRenderer=new SpriteRenderer(c,i,s,n),a.width&&a.height)this.cellWidth=a.width,this.cellHeight=a.height;else{if(void 0===a)return void(this._spriteRenderer=null);this.cellWidth=a,this.cellHeight=a}this._scene.spriteManagers&&this._scene.spriteManagers.push(this),this.Hc=this.scene.getUniqueId(),t&&(this.texture=new Texture(t,n,!0,!1,r)),this._fromPacked&&this._makePacked(t,l)}set disableDepthWrite(e){this._disableDepthWrite=e,this._spriteRenderer.disableDepthWrite=e}set fogEnabled(e){this._spriteRenderer.fogEnabled=e}render(){if(this._fromPacked&&(!this._packedAndReady||!this._spriteMap||!this._cellData))return;const e=this._scene.getEngine().getDeltaTime();this._packedAndReady?this._spriteRenderer.render(this.sprites,e,this._scene.getViewMatrix(),this._scene.getProjectionMatrix(),this._customUpdate):this._spriteRenderer.render(this.sprites,e,this._scene.getViewMatrix(),this._scene.getProjectionMatrix())}static ParseFromSnippetAsync(t,i,a=""){return"_BLANK"===t?Promise.resolve(new e("Default sprite manager","//playground.babylonjs.com/textures/player.png",500,64,i)):new Promise(((n,s)=>{const r=new WebRequest;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const s=JSON.parse(JSON.parse(r.responseText).jsonPayload),o=JSON.parse(s.spriteManager),l=e.Parse(o,i||EngineStore.LastCreatedScene,a);l.snippetId=t,n(l)}else s("Unable to load the snippet "+t)})),r.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),r.send()}))}get blendMode(){return this._spriteRenderer.blendMode}set cellHeight(e){this._spriteRenderer.cellHeight=e}static Parse(t,i,a){const n=new e(t.name,"",t.Fc,{width:t.cellWidth,height:t.cellHeight},i);void 0!==t.fogEnabled&&(n.fogEnabled=t.fogEnabled),void 0!==t.blendMode&&(n.blendMode=t.blendMode),void 0!==t.disableDepthWrite&&(n.disableDepthWrite=t.disableDepthWrite),void 0!==t.pixelPerfect&&(n.pixelPerfect=t.pixelPerfect),void 0!==t.useLogarithmicDepth&&(n.useLogarithmicDepth=t.useLogarithmicDepth),void 0!==t.metadata&&(n.metadata=t.metadata),t.texture?n.texture=Texture.Parse(t.texture,i,a):t.textureName&&(n.texture=new Texture(a+t.textureUrl,i,!1,void 0===t.invertY||t.invertY));for(const e of t.sprites)Sprite.Parse(e,n);return n}getClassName(){return"SpriteManager"}get cellHeight(){return this._spriteRenderer.cellHeight}set pixelPerfect(e){this._spriteRenderer.pixelPerfect=e,e&&3!==this.texture.samplingMode&&this.texture.updateSamplingMode(3)}static ParseFromFileAsync(t,i,a,n=""){return new Promise(((s,r)=>{const o=new WebRequest;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const i=JSON.parse(o.responseText),r=e.Parse(i,a||EngineStore.LastCreatedScene,n);t&&(r.name=t),s(r)}else r("Unable to load the sprite manager")})),o.open("GET",i),o.send()}))}get cellWidth(){return this._spriteRenderer.cellWidth}get useLogarithmicDepth(){return this._spriteRenderer.useLogarithmicDepth}_checkTextureAlpha(e,t,i,a,n){if(!e.useAlphaForPicking||!this.texture)return!0;const s=this.texture.getSize();this._textureContent||(this._textureContent=new Uint8Array(s.width*s.height*4),this.texture.readPixels(0,0,this._textureContent));const r=TmpVectors.Vector3[0];r.copyFrom(t.direction),r.normalize(),r.scaleInPlace(i),r.addInPlace(t.origin);const o=(r.x-a.x)/(n.x-a.x),l=1-(r.y-a.y)/(n.y-a.y),c=e._xOffset*s.width+o*e._xSize|0,h=e._yOffset*s.height+l*e._ySize|0;return this._textureContent[4*(c+h*s.width)+3]>.5}serialize(e=!1){const t={};t.name=this.name,t.Fc=this.Fc,t.cellWidth=this.cellWidth,t.cellHeight=this.cellHeight,t.fogEnabled=this.fogEnabled,t.blendMode=this.blendMode,t.disableDepthWrite=this.disableDepthWrite,t.pixelPerfect=this.pixelPerfect,t.useLogarithmicDepth=this.useLogarithmicDepth,this.texture&&(e?t.texture=this.texture.serialize():(t.textureUrl=this.texture.name,t.invertY=this.texture._invertY)),t.sprites=[];for(const e of this.sprites)t.sprites.push(e.serialize());return t.metadata=this.metadata,t}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set blendMode(e){this._spriteRenderer.blendMode=e}get pixelPerfect(){return this._spriteRenderer.pixelPerfect}get children(){return this.sprites}set useLogarithmicDepth(e){this._spriteRenderer.useLogarithmicDepth=e}get texture(){return this._spriteRenderer.texture}set texture(e){e.wrapU=Texture.CLAMP_ADDRESSMODE,e.wrapV=Texture.CLAMP_ADDRESSMODE,this._spriteRenderer.texture=e,this._textureContent=null}set cellWidth(e){this._spriteRenderer.cellWidth=e}_makePacked(e,t){if(null!==t)try{let e;if(e="string"==typeof t?JSON.parse(t):t,e.frames.length){const t={};for(let i=0;i<e.frames.length;i++){const a=e.frames[i];if("string"!=typeof Object.keys(a)[0])throw new Error("Invalid JSON Format.  Check the frame values and make sure the name is the first parameter.");t[a[Object.keys(a)[0]]]=a}e.frames=t}const i=Reflect.ownKeys(e.frames);this._spriteMap=i,this._packedAndReady=!0,this._cellData=e.frames}catch(e){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON from string. Spritesheet managed with constant cell size.")}else{const t=/\./g;let i;do{i=t.lastIndex,t.test(e)}while(t.lastIndex>0);const a=e.substring(0,i-1)+".json",n=()=>{Logger.Error("JSON ERROR: Unable to load JSON file."),this._fromPacked=!1,this._packedAndReady=!1},s=e=>{try{const t=JSON.parse(e),i=Reflect.ownKeys(t.frames);this._spriteMap=i,this._packedAndReady=!0,this._cellData=t.frames}catch(e){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON format. Please check documentation for format specifications.")}};Tools.LoadFile(a,s,void 0,void 0,!1,n)}}get scene(){return this._scene}rebuild(){this._spriteRenderer?.rebuild()}get Fc(){return this._spriteRenderer.Fc}get fogEnabled(){return this._spriteRenderer.fogEnabled}dispose(){if(this._spriteRenderer&&(this._spriteRenderer.dispose(),this._spriteRenderer=null),this._textureContent=null,this._scene.spriteManagers){const e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1)}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null}get disableDepthWrite(){return this._disableDepthWrite}multiIntersects(e,t,i){const a=Math.min(this.Fc,this.sprites.length),n=Vector3.Zero(),s=Vector3.Zero();let r;const o=[],l=TmpVectors.Vector3[0].copyFromFloats(0,0,0),c=TmpVectors.Vector3[1].copyFromFloats(0,0,0),h=t.getViewMatrix();for(let t=0;t<a;t++){const a=this.sprites[t];if(a){if(i){if(!i(a))continue}else if(!a.isPickable)continue;if(Vector3.TransformCoordinatesToRef(a.position,h,c),n.copyFromFloats(c.x-a.width/2,c.y-a.height/2,c.z),s.copyFromFloats(c.x+a.width/2,c.y+a.height/2,c.z),e.intersectsBoxMinMax(n,s)){if(r=Vector3.Distance(c,e.origin),!this._checkTextureAlpha(a,e,r,n,s))continue;const t=new PickingInfo;o.push(t),h.invertToRef(TmpVectors.Matrix[0]),t.hit=!0,t.pickedSprite=a,t.distance=r;const i=TmpVectors.Vector3[2];i.copyFrom(e.direction),i.normalize(),i.scaleInPlace(r),e.origin.addToRef(i,l),t.pickedPoint=Vector3.TransformCoordinates(l,TmpVectors.Matrix[0])}}}return o}intersects(e,t,i,a){const n=Math.min(this.Fc,this.sprites.length),s=Vector3.Zero(),r=Vector3.Zero();let o=Number.MAX_VALUE,l=null;const c=TmpVectors.Vector3[0],h=TmpVectors.Vector3[1],u=t.getViewMatrix();let m=e,d=e;for(let t=0;t<n;t++){const n=this.sprites[t];if(n){if(i){if(!i(n))continue}else if(!n.isPickable)continue;if(Vector3.TransformCoordinatesToRef(n.position,u,h),n.angle?(Matrix.TranslationToRef(-h.x,-h.y,0,TmpVectors.Matrix[1]),Matrix.TranslationToRef(h.x,h.y,0,TmpVectors.Matrix[2]),Matrix.RotationZToRef(-n.angle,TmpVectors.Matrix[3]),TmpVectors.Matrix[1].multiplyToRef(TmpVectors.Matrix[3],TmpVectors.Matrix[4]),TmpVectors.Matrix[4].multiplyToRef(TmpVectors.Matrix[2],TmpVectors.Matrix[0]),m=e.clone(),Vector3.TransformCoordinatesToRef(e.origin,TmpVectors.Matrix[0],m.origin),Vector3.TransformNormalToRef(e.direction,TmpVectors.Matrix[0],m.direction)):m=e,s.copyFromFloats(h.x-n.width/2,h.y-n.height/2,h.z),r.copyFromFloats(h.x+n.width/2,h.y+n.height/2,h.z),m.intersectsBoxMinMax(s,r)){const e=Vector3.Distance(h,m.origin);if(o>e){if(!this._checkTextureAlpha(n,m,e,s,r))continue;if(d=m,o=e,l=n,a)break}}}}if(l){const e=new PickingInfo;u.invertToRef(TmpVectors.Matrix[0]),e.hit=!0,e.pickedSprite=l,e.distance=o;const t=TmpVectors.Vector3[2];return t.copyFrom(d.direction),t.normalize(),t.scaleInPlace(o),d.origin.addToRef(t,c),e.pickedPoint=Vector3.TransformCoordinates(c,TmpVectors.Matrix[0]),e}return null}};SpriteManager.SnippetUrl="https://snippet.babylonjs.com",SpriteManager.CreateFromSnippetAsync=SpriteManager.ParseFromSnippetAsync;var Constants=class{};function CreateRibbonVertexData(e){let t=e.pathArray;const i=e.closeArray||!1,a=e.closePath||!1,n=e.invertUV||!1,s=Math.floor(t[0].length/2);let r=e.offset||s;r=r>s?s:Math.floor(r);const o=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,l=e.uvs,c=e.colors,h=[],u=[],m=[],d=[],f=[],p=[],_=[],g=[];let v;const y=[],S=[];let C,E,A;if(t.length<2){const e=[],i=[];for(E=0;E<t[0].length-r;E++)e.push(t[0][E]),i.push(t[0][E+r]);t=[e,i]}let T=0;const M=a?1:0,x=i?1:0;let b,w,I,P,R,N;for(v=t[0].length,C=0;C<t.length+x;C++){for(_[C]=0,f[C]=[0],b=C===t.length?t[0]:t[C],w=b.length,v=v<w?v:w,A=0;A<w;)h.push(b[A].x,b[A].y,b[A].z),A>0&&(I=b[A].subtract(b[A-1]).length(),P=I+_[C],f[C].push(P),_[C]=P),A++;a&&(A--,h.push(b[0].x,b[0].y,b[0].z),I=b[A].subtract(b[0]).length(),P=I+_[C],f[C].push(P),_[C]=P),y[C]=w+M,S[C]=T,T+=w+M}let k,D,B=null,F=null;for(E=0;E<v+M;E++)for(g[E]=0,p[E]=[0],C=0;C<t.length-1+x;C++)R=t[C],N=C===t.length-1?t[0]:t[C+1],E===v?(B=R[0],F=N[0]):(B=R[E],F=N[E]),I=F.subtract(B).length(),P=I+g[E],p[E].push(P),g[E]=P;if(l)for(C=0;C<l.length;C++)d.push(l[C].x,useOpenGLOrientationForUV?1-l[C].y:l[C].y);else for(C=0;C<t.length+x;C++)for(E=0;E<v+M;E++)k=0!=_[C]?f[C][E]/_[C]:0,D=0!=g[E]?p[E][C]/g[E]:0,n?d.push(D,k):d.push(k,useOpenGLOrientationForUV?1-D:D);C=0;let L=0,O=y[C]-1,G=y[C+1]-1,V=O<G?O:G,U=S[1]-S[0];const H=y.length-1;for(;L<=V&&C<H;)u.push(L,L+U,L+1),u.push(L+U+1,L+1,L+U),L+=1,L===V&&(C++,U=S[C+1]-S[C],O=y[C]-1,G=y[C+1]-1,L=S[C],V=O<G?O+L:G+L);if(VertexData.ComputeNormals(h,u,m),a){let e=0,i=0;for(C=0;C<t.length;C++){e=3*S[C],i=C+1<t.length?3*(S[C+1]-1):m.length-3,m[e]=.5*(m[e]+m[i]),m[e+1]=.5*(m[e+1]+m[i+1]),m[e+2]=.5*(m[e+2]+m[i+2]);const a=Math.sqrt(m[e]*m[e]+m[e+1]*m[e+1]+m[e+2]*m[e+2]);m[e]/=a,m[e+1]/=a,m[e+2]/=a,m[i]=m[e],m[i+1]=m[e+1],m[i+2]=m[e+2]}}if(i){let e=3*S[0],i=3*S[t.length];for(E=0;E<v+M;E++){m[e]=.5*(m[e]+m[i]),m[e+1]=.5*(m[e+1]+m[i+1]),m[e+2]=.5*(m[e+2]+m[i+2]);const t=Math.sqrt(m[e]*m[e]+m[e+1]*m[e+1]+m[e+2]*m[e+2]);m[e]/=t,m[e+1]/=t,m[e+2]/=t,m[i]=m[e],m[i+1]=m[e+1],m[i+2]=m[e+2],e+=3,i+=3}}VertexData._ComputeSides(o,h,u,m,d,e.frontUVs,e.backUVs);let W=null;if(c){W=new Float32Array(4*c.length);for(let e=0;e<c.length;e++)W[4*e]=c[e].r,W[4*e+1]=c[e].g,W[4*e+2]=c[e].b,W[4*e+3]=c[e].a}const z=new VertexData,X=new Float32Array(h),Y=new Float32Array(m),j=new Float32Array(d);return z.indices=u,z.positions=X,z.normals=Y,z.uvs=j,W&&z.set(W,VertexBuffer.ColorKind),a&&(z._idx=S),z}function CreateRibbon(e,t,i=null){const a=t.pathArray,n=t.closeArray,s=t.closePath,r=Mesh._GetDefaultSideOrientation(t.sideOrientation),o=t.instance,l=t.updatable;if(o){const e=TmpVectors.Vector3[0].setAll(Number.MAX_VALUE),i=TmpVectors.Vector3[1].setAll(-Number.MAX_VALUE),n=t=>{let n=a[0].length;const s=o;let r=0;const l=s._originalBuilderSideOrientation===Mesh.DOUBLESIDE?2:1;for(let o=1;o<=l;++o)for(let o=0;o<a.length;++o){const l=a[o],c=l.length;n=n<c?n:c;for(let a=0;a<n;++a){const n=l[a];t[r]=n.x,t[r+1]=n.y,t[r+2]=n.z,e.minimizeInPlaceFromFloats(n.x,n.y,n.z),i.maximizeInPlaceFromFloats(n.x,n.y,n.z),r+=3}if(s._creationDataStorage&&s._creationDataStorage.closePath){const e=l[0];t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z,r+=3}}},s=o.getVerticesData(VertexBuffer.PositionKind);if(n(s),o.hasBoundingInfo?o.getBoundingInfo().reConstruct(e,i,o._worldMatrix):o.buildBoundingInfo(e,i,o._worldMatrix),o.updateVerticesData(VertexBuffer.PositionKind,s,!1,!1),t.colors){const e=o.getVerticesData(VertexBuffer.ColorKind);for(let i=0,a=0;i<t.colors.length;i++,a+=4){const n=t.colors[i];e[a]=n.r,e[a+1]=n.g,e[a+2]=n.b,e[a+3]=n.a}o.updateVerticesData(VertexBuffer.ColorKind,e,!1,!1)}if(t.uvs){const e=o.getVerticesData(VertexBuffer.UVKind);for(let i=0;i<t.uvs.length;i++)e[2*i]=t.uvs[i].x,e[2*i+1]=useOpenGLOrientationForUV?1-t.uvs[i].y:t.uvs[i].y;o.updateVerticesData(VertexBuffer.UVKind,e,!1,!1)}if(!o.areNormalsFrozen||o.isFacetDataEnabled){const e=o.getIndices(),t=o.getVerticesData(VertexBuffer.NormalKind),i=o.isFacetDataEnabled?o.getFacetDataParameters():null;if(VertexData.ComputeNormals(s,e,t,i),o._creationDataStorage&&o._creationDataStorage.closePath){let e=0,i=0;for(let n=0;n<a.length;n++)e=3*o._creationDataStorage.idx[n],i=n+1<a.length?3*(o._creationDataStorage.idx[n+1]-1):t.length-3,t[e]=.5*(t[e]+t[i]),t[e+1]=.5*(t[e+1]+t[i+1]),t[e+2]=.5*(t[e+2]+t[i+2]),t[i]=t[e],t[i+1]=t[e+1],t[i+2]=t[e+2]}o.areNormalsFrozen||o.updateVerticesData(VertexBuffer.NormalKind,t,!1,!1)}return o}{const a=new Mesh(e,i);a._originalBuilderSideOrientation=r,a._creationDataStorage=new _CreationDataStorage;const o=CreateRibbonVertexData(t);return s&&(a._creationDataStorage.idx=o._idx),a._creationDataStorage.closePath=s,a._creationDataStorage.closeArray=n,o.applyToMesh(a,l),a}}function CreateDiscVertexData(e){const t=[],i=[],a=[],n=[],s=e.radius||.5,r=e.tessellation||64,o=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,l=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE;t.push(0,0,0),n.push(.5,.5);const c=2*Math.PI*o,h=1===o?c/r:c/(r-1);let u=0;for(let e=0;e<r;e++){const e=Math.cos(u),i=Math.sin(u),a=(e+1)/2,r=(1-i)/2;t.push(s*e,s*i,0),n.push(a,useOpenGLOrientationForUV?1-r:r),u+=h}1===o&&(t.push(t[3],t[4],t[5]),n.push(n[2],useOpenGLOrientationForUV?1-n[3]:n[3]));const m=t.length/3;for(let e=1;e<m-1;e++)i.push(e+1,0,e);VertexData.ComputeNormals(t,i,a),VertexData._ComputeSides(l,t,i,a,n,e.frontUVs,e.backUVs);const d=new VertexData;return d.indices=i,d.positions=t,d.normals=a,d.uvs=n,d}function CreateDisc(e,t={},i=null){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateDiscVertexData(t).applyToMesh(a,t.updatable),a}Constants.AUTOSAMPLERSUFFIX="Sampler",Constants.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",Constants.ALPHA_DISABLE=0,Constants.ALPHA_ADD=1,Constants.ALPHA_COMBINE=2,Constants.ALPHA_SUBTRACT=3,Constants.ALPHA_MULTIPLY=4,Constants.ALPHA_MAXIMIZED=5,Constants.ALPHA_ONEONE=6,Constants.ALPHA_PREMULTIPLIED=7,Constants.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Constants.ALPHA_INTERPOLATE=9,Constants.ALPHA_SCREENMODE=10,Constants.ALPHA_ONEONE_ONEONE=11,Constants.ALPHA_ALPHATOCOLOR=12,Constants.ALPHA_REVERSEONEMINUS=13,Constants.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Constants.ALPHA_ONEONE_ONEZERO=15,Constants.ALPHA_EXCLUSION=16,Constants.ALPHA_LAYER_ACCUMULATE=17,Constants.ALPHA_EQUATION_ADD=0,Constants.ALPHA_EQUATION_SUBSTRACT=1,Constants.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Constants.ALPHA_EQUATION_MAX=3,Constants.ALPHA_EQUATION_MIN=4,Constants.ALPHA_EQUATION_DARKEN=5,Constants.DELAYLOADSTATE_NONE=0,Constants.DELAYLOADSTATE_LOADED=1,Constants.DELAYLOADSTATE_LOADING=2,Constants.DELAYLOADSTATE_NOTLOADED=4,Constants.NEVER=512,Constants.ALWAYS=519,Constants.LESS=513,Constants.EQUAL=514,Constants.LEQUAL=515,Constants.GREATER=516,Constants.GEQUAL=518,Constants.NOTEQUAL=517,Constants.KEEP=7680,Constants.ZERO=0,Constants.REPLACE=7681,Constants.INCR=7682,Constants.DECR=7683,Constants.INVERT=5386,Constants.INCR_WRAP=34055,Constants.DECR_WRAP=34056,Constants.TEXTURE_CLAMP_ADDRESSMODE=0,Constants.TEXTURE_WRAP_ADDRESSMODE=1,Constants.TEXTURE_MIRROR_ADDRESSMODE=2,Constants.TEXTURE_CREATIONFLAG_STORAGE=1,Constants.TEXTUREFORMAT_ALPHA=0,Constants.TEXTUREFORMAT_LUMINANCE=1,Constants.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Constants.TEXTUREFORMAT_RGB=4,Constants.TEXTUREFORMAT_RGBA=5,Constants.TEXTUREFORMAT_RED=6,Constants.TEXTUREFORMAT_R=6,Constants.TEXTUREFORMAT_RG=7,Constants.TEXTUREFORMAT_RED_INTEGER=8,Constants.TEXTUREFORMAT_R_INTEGER=8,Constants.TEXTUREFORMAT_RG_INTEGER=9,Constants.TEXTUREFORMAT_RGB_INTEGER=10,Constants.TEXTUREFORMAT_RGBA_INTEGER=11,Constants.TEXTUREFORMAT_BGRA=12,Constants.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Constants.TEXTUREFORMAT_DEPTH32_FLOAT=14,Constants.TEXTUREFORMAT_DEPTH16=15,Constants.TEXTUREFORMAT_DEPTH24=16,Constants.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Constants.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Constants.TEXTUREFORMAT_STENCIL8=19,Constants.TEXTUREFORMAT_UNDEFINED=4294967295,Constants.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Constants.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Constants.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Constants.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Constants.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Constants.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Constants.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Constants.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Constants.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Constants.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Constants.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Constants.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Constants.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Constants.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Constants.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Constants.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Constants.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Constants.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Constants.TEXTURETYPE_UNSIGNED_BYTE=0,Constants.TEXTURETYPE_UNSIGNED_INT=0,Constants.TEXTURETYPE_FLOAT=1,Constants.TEXTURETYPE_HALF_FLOAT=2,Constants.TEXTURETYPE_BYTE=3,Constants.TEXTURETYPE_SHORT=4,Constants.TEXTURETYPE_UNSIGNED_SHORT=5,Constants.TEXTURETYPE_INT=6,Constants.TEXTURETYPE_UNSIGNED_INTEGER=7,Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Constants.TEXTURETYPE_UNSIGNED_INT_24_8=12,Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Constants.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Constants.TEXTURETYPE_UNDEFINED=16,Constants.TEXTURE_2D=3553,Constants.TEXTURE_2D_ARRAY=35866,Constants.TEXTURE_CUBE_MAP=34067,Constants.TEXTURE_CUBE_MAP_ARRAY=3735928559,Constants.TEXTURE_3D=32879,Constants.TEXTURE_NEAREST_SAMPLINGMODE=1,Constants.TEXTURE_NEAREST_NEAREST=1,Constants.TEXTURE_BILINEAR_SAMPLINGMODE=2,Constants.TEXTURE_LINEAR_LINEAR=2,Constants.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Constants.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Constants.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Constants.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Constants.TEXTURE_NEAREST_LINEAR=7,Constants.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Constants.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Constants.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Constants.TEXTURE_LINEAR_NEAREST=12,Constants.TEXTURE_EXPLICIT_MODE=0,Constants.TEXTURE_SPHERICAL_MODE=1,Constants.TEXTURE_PLANAR_MODE=2,Constants.TEXTURE_CUBIC_MODE=3,Constants.TEXTURE_PROJECTION_MODE=4,Constants.TEXTURE_SKYBOX_MODE=5,Constants.TEXTURE_INVCUBIC_MODE=6,Constants.TEXTURE_EQUIRECTANGULAR_MODE=7,Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Constants.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Constants.TEXTURE_FILTERING_QUALITY_HIGH=64,Constants.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Constants.TEXTURE_FILTERING_QUALITY_LOW=8,Constants.SCALEMODE_FLOOR=1,Constants.SCALEMODE_NEAREST=2,Constants.SCALEMODE_CEILING=3,Constants.MATERIAL_TextureDirtyFlag=1,Constants.MATERIAL_LightDirtyFlag=2,Constants.MATERIAL_FresnelDirtyFlag=4,Constants.MATERIAL_AttributesDirtyFlag=8,Constants.MATERIAL_MiscDirtyFlag=16,Constants.MATERIAL_PrePassDirtyFlag=32,Constants.MATERIAL_AllDirtyFlag=63,Constants.MATERIAL_TriangleFillMode=0,Constants.MATERIAL_WireFrameFillMode=1,Constants.MATERIAL_PointFillMode=2,Constants.MATERIAL_PointListDrawMode=3,Constants.MATERIAL_LineListDrawMode=4,Constants.MATERIAL_LineLoopDrawMode=5,Constants.MATERIAL_LineStripDrawMode=6,Constants.MATERIAL_TriangleStripDrawMode=7,Constants.MATERIAL_TriangleFanDrawMode=8,Constants.MATERIAL_ClockWiseSideOrientation=0,Constants.MATERIAL_CounterClockWiseSideOrientation=1,Constants.ACTION_NothingTrigger=0,Constants.ACTION_OnPickTrigger=1,Constants.ACTION_OnLeftPickTrigger=2,Constants.ACTION_OnRightPickTrigger=3,Constants.ACTION_OnCenterPickTrigger=4,Constants.ACTION_OnPickDownTrigger=5,Constants.ACTION_OnDoublePickTrigger=6,Constants.ACTION_OnPickUpTrigger=7,Constants.ACTION_OnPickOutTrigger=16,Constants.ACTION_OnLongPressTrigger=8,Constants.ACTION_OnPointerOverTrigger=9,Constants.ACTION_OnPointerOutTrigger=10,Constants.ACTION_OnEveryFrameTrigger=11,Constants.ACTION_OnIntersectionEnterTrigger=12,Constants.ACTION_OnIntersectionExitTrigger=13,Constants.ACTION_OnKeyDownTrigger=14,Constants.ACTION_OnKeyUpTrigger=15,Constants.PARTICLES_BILLBOARDMODE_Y=2,Constants.PARTICLES_BILLBOARDMODE_ALL=7,Constants.PARTICLES_BILLBOARDMODE_STRETCHED=8,Constants.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,Constants.MESHES_CULLINGSTRATEGY_STANDARD=0,Constants.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Constants.SCENELOADER_NO_LOGGING=0,Constants.SCENELOADER_MINIMAL_LOGGING=1,Constants.SCENELOADER_SUMMARY_LOGGING=2,Constants.SCENELOADER_DETAILED_LOGGING=3,Constants.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Constants.PREPASS_POSITION_TEXTURE_TYPE=1,Constants.PREPASS_VELOCITY_TEXTURE_TYPE=2,Constants.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Constants.PREPASS_COLOR_TEXTURE_TYPE=4,Constants.PREPASS_DEPTH_TEXTURE_TYPE=5,Constants.PREPASS_NORMAL_TEXTURE_TYPE=6,Constants.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Constants.BUFFER_CREATIONFLAG_READ=1,Constants.BUFFER_CREATIONFLAG_WRITE=2,Constants.BUFFER_CREATIONFLAG_READWRITE=3,Constants.BUFFER_CREATIONFLAG_UNIFORM=4,Constants.BUFFER_CREATIONFLAG_VERTEX=8,Constants.BUFFER_CREATIONFLAG_INDEX=16,Constants.BUFFER_CREATIONFLAG_STORAGE=32,Constants.BUFFER_CREATIONFLAG_INDIRECT=64,Constants.RENDERPASS_MAIN=0,Constants.INPUT_ALT_KEY=18,Constants.INPUT_CTRL_KEY=17,Constants.INPUT_META_KEY1=91,Constants.INPUT_META_KEY2=92,Constants.INPUT_META_KEY3=93,Constants.INPUT_SHIFT_KEY=16,Constants.SNAPSHOTRENDERING_STANDARD=0,Constants.SNAPSHOTRENDERING_FAST=1,Constants.PERSPECTIVE_CAMERA=0,Constants.ORTHOGRAPHIC_CAMERA=1,Constants.FOVMODE_VERTICAL_FIXED=0,Constants.FOVMODE_HORIZONTAL_FIXED=1,Constants.RIG_MODE_NONE=0,Constants.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Constants.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Constants.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Constants.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Constants.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Constants.RIG_MODE_VR=20,Constants.RIG_MODE_CUSTOM=22,Constants.MAX_SUPPORTED_UV_SETS=6,Constants.GL_ALPHA_EQUATION_ADD=32774,Constants.GL_ALPHA_EQUATION_MIN=32775,Constants.GL_ALPHA_EQUATION_MAX=32776,Constants.GL_ALPHA_EQUATION_SUBTRACT=32778,Constants.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Constants.GL_ALPHA_FUNCTION_SRC=768,Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Constants.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Constants.GL_ALPHA_FUNCTION_DST_ALPHA=772,Constants.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Constants.GL_ALPHA_FUNCTION_DST_COLOR=774,Constants.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Constants.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Constants.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Constants.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Constants.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Constants.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Constants.SnippetUrl="https://snippet.babylonjs.com",Constants.FOGMODE_NONE=0,Constants.FOGMODE_EXP=1,Constants.FOGMODE_EXP2=2,Constants.FOGMODE_LINEAR=3,Constants.BYTE=5120,Constants.UNSIGNED_BYTE=5121,Constants.SHORT=5122,Constants.UNSIGNED_SHORT=5123,Constants.INT=5124,Constants.UNSIGNED_INT=5125,Constants.FLOAT=5126,Constants.PositionKind="position",Constants.NormalKind="normal",Constants.TangentKind="tangent",Constants.UVKind="uv",Constants.UV2Kind="uv2",Constants.UV3Kind="uv3",Constants.UV4Kind="uv4",Constants.UV5Kind="uv5",Constants.UV6Kind="uv6",Constants.ColorKind="color",Constants.ColorInstanceKind="instanceColor",Constants.MatricesIndicesKind="matricesIndices",Constants.MatricesWeightsKind="matricesWeights",Constants.MatricesIndicesExtraKind="matricesIndicesExtra",Constants.MatricesWeightsExtraKind="matricesWeightsExtra",VertexData.Tc=CreateRibbonVertexData,Mesh.Tc=(e,t,i=!1,a,n,s,r=!1,o,l)=>CreateRibbon(e,{pathArray:t,closeArray:i,closePath:a,offset:n,updatable:r,sideOrientation:o,instance:l},s),VertexData.nc=CreateDiscVertexData,Mesh.nc=(e,t,i,a=null,n,s)=>CreateDisc(e,{radius:t,tessellation:i,sideOrientation:s,updatable:n},a),Mesh._GroundMeshParser=(e,t)=>GroundMesh.Parse(e,t);var GroundMesh=class e extends Mesh{getClassName(){return"GroundMesh"}_initHeightQuads(){const e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const a={slope:Vector2.Zero(),facet1:new Vector4(0,0,0,0),facet2:new Vector4(0,0,0,0)};this._heightQuads[i*e+t]=a}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(t,i){const a=new e(t.name,i);return a._subdivisionsX=t.subdivisionsX||1,a._subdivisionsY=t.subdivisionsY||1,a._minX=t.minX,a._maxX=t.maxX,a._minZ=t.minZ,a._maxZ=t.maxZ,a._width=t.width,a._height=t.height,a}get subdivisionsX(){return this._subdivisionsX}constructor(e,t){super(e,t),this.generateOctree=!1}_getFacetAt(e,t){const i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),a=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[a*this._subdivisionsX+i];let s;return s=t<n.slope.x*e+n.slope.y?n.facet1:n.facet2,s}getHeightAtCoordinates(e,t){const i=this.getWorldMatrix(),a=TmpVectors.Matrix[5];i.invertToRef(a);const n=TmpVectors.Vector3[8];if(Vector3.TransformCoordinatesFromFloatsToRef(e,0,t,a,n),e=n.x,t=n.z,e<this._minX||e>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const s=this._getFacetAt(e,t),r=-(s.x*e+s.z*t+s.w)/s.y;return Vector3.TransformCoordinatesFromFloatsToRef(0,r,0,i,n),n.y}getNormalAtCoordinatesToRef(e,t,i){const a=this.getWorldMatrix(),n=TmpVectors.Matrix[5];a.invertToRef(n);const s=TmpVectors.Vector3[8];if(Vector3.TransformCoordinatesFromFloatsToRef(e,0,t,n,s),e=s.x,t=s.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const r=this._getFacetAt(e,t);return Vector3.TransformNormalFromFloatsToRef(r.x,r.y,r.z,a,i),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}optimize(e,t=32){this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(t)}_computeHeightQuads(){const e=this.getVerticesData(VertexBuffer.PositionKind);if(!e)return this;const t=TmpVectors.Vector3[3],i=TmpVectors.Vector3[2],a=TmpVectors.Vector3[1],n=TmpVectors.Vector3[0],s=TmpVectors.Vector3[4],r=TmpVectors.Vector3[5],o=TmpVectors.Vector3[6],l=TmpVectors.Vector3[7],c=TmpVectors.Vector3[8];let h=0,u=0,m=0,d=0,f=0,p=0,_=0;const g=this._subdivisionsX,v=this._subdivisionsY;for(let y=0;y<v;y++)for(let v=0;v<g;v++){h=3*v,u=y*(g+1)*3,m=(y+1)*(g+1)*3,t.x=e[u+h],t.y=e[u+h+1],t.z=e[u+h+2],i.x=e[u+h+3],i.y=e[u+h+4],i.z=e[u+h+5],a.x=e[m+h],a.y=e[m+h+1],a.z=e[m+h+2],n.x=e[m+h+3],n.y=e[m+h+4],n.z=e[m+h+5],d=(n.z-t.z)/(n.x-t.x),f=t.z-d*t.x,i.subtractToRef(t,s),a.subtractToRef(t,r),n.subtractToRef(t,o),Vector3.CrossToRef(o,r,l),Vector3.CrossToRef(s,o,c),l.normalize(),c.normalize(),p=-(l.x*t.x+l.y*t.y+l.z*t.z),_=-(c.x*i.x+c.y*i.y+c.z*i.z);const S=this._heightQuads[y*g+v];S.slope.copyFromFloats(d,f),S.facet1.copyFromFloats(l.x,l.y,l.z,p),S.facet2.copyFromFloats(c.x,c.y,c.z,_)}return this}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsY(){return this._subdivisionsY}getNormalAtCoordinates(e,t){const i=new Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i}};function CreateGroundVertexData(e){const t=[],i=[],a=[],n=[];let s,r;const o=e.width||1,l=e.height||1,c=0|(e.subdivisionsX||e.subdivisions||1),h=0|(e.subdivisionsY||e.subdivisions||1);for(s=0;s<=h;s++)for(r=0;r<=c;r++){const e=new Vector3(r*o/c-o/2,0,(h-s)*l/h-l/2),t=new Vector3(0,1,0);i.push(e.x,e.y,e.z),a.push(t.x,t.y,t.z),n.push(r/c,useOpenGLOrientationForUV?s/h:1-s/h)}for(s=0;s<h;s++)for(r=0;r<c;r++)t.push(r+1+(s+1)*(c+1)),t.push(r+1+s*(c+1)),t.push(r+s*(c+1)),t.push(r+(s+1)*(c+1)),t.push(r+1+(s+1)*(c+1)),t.push(r+s*(c+1));const u=new VertexData;return u.indices=t,u.positions=i,u.normals=a,u.uvs=n,u}function CreateTiledGroundVertexData(e){const t=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,i=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,a=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,n=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,s=e.subdivisions||{w:1,h:1},r=e.precision||{w:1,h:1},o=[],l=[],c=[],h=[];let u,m,d,f;s.h=s.h<1?1:s.h,s.w=s.w<1?1:s.w,r.w=r.w<1?1:r.w,r.h=r.h<1?1:r.h;const p=(a-t)/s.w,_=(n-i)/s.h;function g(e,t,i,a){const n=l.length/3,s=r.w+1;for(u=0;u<r.h;u++)for(m=0;m<r.w;m++){const e=[n+m+u*s,n+(m+1)+u*s,n+(m+1)+(u+1)*s,n+m+(u+1)*s];o.push(e[1]),o.push(e[2]),o.push(e[3]),o.push(e[0]),o.push(e[1]),o.push(e[3])}const d=Vector3.Zero(),f=new Vector3(0,1,0);for(u=0;u<=r.h;u++)for(d.z=u*(a-t)/r.h+t,m=0;m<=r.w;m++)d.x=m*(i-e)/r.w+e,d.y=0,l.push(d.x,d.y,d.z),c.push(f.x,f.y,f.z),h.push(m/r.w,u/r.h)}for(d=0;d<s.h;d++)for(f=0;f<s.w;f++)g(t+f*p,i+d*_,t+(f+1)*p,i+(d+1)*_);const v=new VertexData;return v.indices=o,v.positions=l,v.normals=c,v.uvs=h,v}function CreateGroundFromHeightMapVertexData(e){const t=[],i=[],a=[],n=[];let s,r;const o=e.colorFilter||new Color3(.3,.59,.11),l=e.alphaFilter||0;let c=!1;if(e.minHeight>e.maxHeight){c=!0;const t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(s=0;s<=e.subdivisions;s++)for(r=0;r<=e.subdivisions;r++){const t=new Vector3(r*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-s)*e.height/e.subdivisions-e.height/2),h=4*(((t.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(t.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth);let u=e.buffer[h]/255,m=e.buffer[h+1]/255,d=e.buffer[h+2]/255;const f=e.buffer[h+3]/255;c&&(u=1-u,m=1-m,d=1-d);const p=u*o.r+m*o.g+d*o.b;t.y=f>=l?e.minHeight+(e.maxHeight-e.minHeight)*p:e.minHeight-Epsilon,e.heightBuffer&&(e.heightBuffer[s*(e.subdivisions+1)+r]=t.y),i.push(t.x,t.y,t.z),a.push(0,0,0),n.push(r/e.subdivisions,1-s/e.subdivisions)}for(s=0;s<e.subdivisions;s++)for(r=0;r<e.subdivisions;r++){const a=r+1+(s+1)*(e.subdivisions+1),n=r+1+s*(e.subdivisions+1),o=r+s*(e.subdivisions+1),l=r+(s+1)*(e.subdivisions+1),c=i[3*a+1]>=e.minHeight,h=i[3*n+1]>=e.minHeight,u=i[3*o+1]>=e.minHeight;c&&h&&u&&(t.push(a),t.push(n),t.push(o));i[3*l+1]>=e.minHeight&&c&&u&&(t.push(l),t.push(a),t.push(o))}VertexData.ComputeNormals(i,t,a);const h=new VertexData;return h.indices=t,h.positions=i,h.normals=a,h.uvs=n,h}function CreateGround(e,t={},i){const a=new GroundMesh(e,i);a._setReady(!1),a._subdivisionsX=t.subdivisionsX||t.subdivisions||1,a._subdivisionsY=t.subdivisionsY||t.subdivisions||1,a._width=t.width||1,a._height=t.height||1,a._maxX=a._width/2,a._maxZ=a._height/2,a._minX=-a._maxX,a._minZ=-a._maxZ;return CreateGroundVertexData(t).applyToMesh(a,t.updatable),a._setReady(!0),a}function CreateTiledGround(e,t,i=null){const a=new Mesh(e,i);return CreateTiledGroundVertexData(t).applyToMesh(a,t.updatable),a}function CreateGroundFromHeightMap(e,t,i={},a=null){const n=i.width||10,s=i.height||10,r=i.subdivisions||1,o=i.minHeight||0,l=i.maxHeight||1,c=i.colorFilter||new Color3(.3,.59,.11),h=i.alphaFilter||0,u=i.updatable,m=i.onReady;a=a||EngineStore.LastCreatedScene;const d=new GroundMesh(e,a);let f;d._subdivisionsX=r,d._subdivisionsY=r,d._width=n,d._height=s,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1),i.passHeightBufferInCallback&&(f=new Float32Array((r+1)*(r+1)));const p=(e,t,i)=>{CreateGroundFromHeightMapVertexData({width:n,height:s,subdivisions:r,minHeight:o,maxHeight:l,colorFilter:c,buffer:e,bufferWidth:t,bufferHeight:i,alphaFilter:h,heightBuffer:f}).applyToMesh(d,u),m&&m(d,f),d._setReady(!0)};if("string"==typeof t){const e=e=>{const t=e.width,i=e.height;if(a.isDisposed)return;const n=a?.getEngine().resizeImageBitmap(e,t,i);p(n,t,i)};Tools.LoadImage(t,e,i.onError?i.onError:()=>{},a.offlineProvider)}else p(t.data,t.width,t.height);return d}function CreateBoxVertexData(e){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],a=[];let n=[];const s=e.width||e.size||1,r=e.height||e.size||1,o=e.depth||e.size||1,l=e.wrap||!1;let c=void 0===e.topBaseAt?1:e.topBaseAt,h=void 0===e.bottomBaseAt?0:e.bottomBaseAt;c=(c+4)%4,h=(h+4)%4;let u=[2,0,3,1][c],m=[2,0,1,3][h],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(l){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const a=[17,18,19,16],n=[22,23,20,21];for(;u>0;)e.unshift(e.pop()),a.unshift(a.pop()),u--;for(;m>0;)i.unshift(i.pop()),n.unshift(n.pop()),m--;e=e.flat(),i=i.flat(),d=d.concat(e).concat(i),t.push(a[0],a[2],a[3],a[0],a[1],a[2]),t.push(n[0],n[2],n[3],n[0],n[1],n[2])}const f=[s/2,r/2,o/2];n=d.reduce(((e,t,i)=>e.concat(t*f[i%3])),[]);const p=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,_=e.faceUV||new Array(6),g=e.faceColors,v=[];for(let e=0;e<6;e++)void 0===_[e]&&(_[e]=new Vector4(0,0,1,1)),g&&void 0===g[e]&&(g[e]=new Color4(1,1,1,1));for(let e=0;e<6;e++)if(a.push(_[e].z,useOpenGLOrientationForUV?1-_[e].w:_[e].w),a.push(_[e].x,useOpenGLOrientationForUV?1-_[e].w:_[e].w),a.push(_[e].x,useOpenGLOrientationForUV?1-_[e].y:_[e].y),a.push(_[e].z,useOpenGLOrientationForUV?1-_[e].y:_[e].y),g)for(let t=0;t<4;t++)v.push(g[e].r,g[e].g,g[e].b,g[e].a);VertexData._ComputeSides(p,n,t,i,a,e.frontUVs,e.backUVs);const y=new VertexData;if(y.indices=t,y.positions=n,y.normals=i,y.uvs=a,g){const e=p===VertexData.DOUBLESIDE?v.concat(v):v;y.colors=e}return y}function CreateBox(e,t={},i=null){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateBoxVertexData(t).applyToMesh(a,t.updatable),a}function CreateTiledPlaneVertexData(e){const t=e.pattern||Mesh.NO_FLIP,i=e.tileWidth||e.tileSize||1,a=e.tileHeight||e.tileSize||1,n=e.alignHorizontal||0,s=e.alignVertical||0,r=e.width||e.size||1,o=Math.floor(r/i);let l=r-o*i;const c=e.height||e.size||1,h=Math.floor(c/a);let u=c-h*a;const m=i*o/2,d=a*h/2;let f=0,p=0,_=0,g=0,v=0,y=0;if(l>0||u>0){switch(_=-m,g=-d,v=m,y=d,n){case Mesh.CENTER:l/=2,_-=l,v+=l;break;case Mesh.LEFT:v+=l,f=-l/2;break;case Mesh.RIGHT:_-=l,f=l/2}switch(s){case Mesh.CENTER:u/=2,g-=u,y+=u;break;case Mesh.BOTTOM:y+=u,p=-u/2;break;case Mesh.TOP:g-=u,p=u/2}}const S=[],C=[],E=[];E[0]=[0,0,1,0,1,1,0,1],E[1]=[0,0,1,0,1,1,0,1],t!==Mesh.ROTATE_TILE&&t!==Mesh.ROTATE_ROW||(E[1]=[1,1,0,1,0,0,1,0]),t!==Mesh.FLIP_TILE&&t!==Mesh.FLIP_ROW||(E[1]=[1,0,0,0,0,1,1,1]),t!==Mesh.FLIP_N_ROTATE_TILE&&t!==Mesh.FLIP_N_ROTATE_ROW||(E[1]=[0,1,1,1,1,0,0,0]);let A=[];const T=[],M=[];let x=0;for(let e=0;e<h;e++)for(let n=0;n<o;n++)S.push(n*i-m+f,e*a-d+p,0),S.push((n+1)*i-m+f,e*a-d+p,0),S.push((n+1)*i-m+f,(e+1)*a-d+p,0),S.push(n*i-m+f,(e+1)*a-d+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),A=t===Mesh.FLIP_TILE||t===Mesh.ROTATE_TILE||t===Mesh.FLIP_N_ROTATE_TILE?A.concat(E[(n%2+e%2)%2]):t===Mesh.FLIP_ROW||t===Mesh.ROTATE_ROW||t===Mesh.FLIP_N_ROTATE_ROW?A.concat(E[e%2]):A.concat(E[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),x+=4;if(l>0||u>0){const e=u>0&&(s===Mesh.CENTER||s===Mesh.TOP),r=u>0&&(s===Mesh.CENTER||s===Mesh.BOTTOM),c=l>0&&(n===Mesh.CENTER||n===Mesh.RIGHT),E=l>0&&(n===Mesh.CENTER||n===Mesh.LEFT);let b,w,I,P,R=[];if(e&&c&&(S.push(_+f,g+p,0),S.push(-m+f,g+p,0),S.push(-m+f,g+u+p,0),S.push(_+f,g+u+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,b=1-l/i,w=1-u/a,I=1,P=1,R=[b,w,I,w,I,P,b,P],t===Mesh.ROTATE_ROW&&(R=[1-b,1-w,1-I,1-w,1-I,1-P,1-b,1-P]),t===Mesh.FLIP_ROW&&(R=[1-b,w,1-I,w,1-I,P,1-b,P]),t===Mesh.FLIP_N_ROTATE_ROW&&(R=[b,1-w,I,1-w,I,1-P,b,1-P]),A=A.concat(R),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&E&&(S.push(m+f,g+p,0),S.push(v+f,g+p,0),S.push(v+f,g+u+p,0),S.push(m+f,g+u+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,b=0,w=1-u/a,I=l/i,P=1,R=[b,w,I,w,I,P,b,P],(t===Mesh.ROTATE_ROW||t===Mesh.ROTATE_TILE&&o%2==0)&&(R=[1-b,1-w,1-I,1-w,1-I,1-P,1-b,1-P]),(t===Mesh.FLIP_ROW||t===Mesh.FLIP_TILE&&o%2==0)&&(R=[1-b,w,1-I,w,1-I,P,1-b,P]),(t===Mesh.FLIP_N_ROTATE_ROW||t===Mesh.FLIP_N_ROTATE_TILE&&o%2==0)&&(R=[b,1-w,I,1-w,I,1-P,b,1-P]),A=A.concat(R),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&c&&(S.push(_+f,d+p,0),S.push(-m+f,d+p,0),S.push(-m+f,y+p,0),S.push(_+f,y+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,b=1-l/i,w=0,I=1,P=u/a,R=[b,w,I,w,I,P,b,P],(t===Mesh.ROTATE_ROW&&h%2==1||t===Mesh.ROTATE_TILE&&h%1==0)&&(R=[1-b,1-w,1-I,1-w,1-I,1-P,1-b,1-P]),(t===Mesh.FLIP_ROW&&h%2==1||t===Mesh.FLIP_TILE&&h%2==0)&&(R=[1-b,w,1-I,w,1-I,P,1-b,P]),(t===Mesh.FLIP_N_ROTATE_ROW&&h%2==1||t===Mesh.FLIP_N_ROTATE_TILE&&h%2==0)&&(R=[b,1-w,I,1-w,I,1-P,b,1-P]),A=A.concat(R),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&E&&(S.push(m+f,d+p,0),S.push(v+f,d+p,0),S.push(v+f,y+p,0),S.push(m+f,y+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,b=0,w=0,I=l/i,P=u/a,R=[b,w,I,w,I,P,b,P],(t===Mesh.ROTATE_ROW&&h%2==1||t===Mesh.ROTATE_TILE&&(h+o)%2==1)&&(R=[1-b,1-w,1-I,1-w,1-I,1-P,1-b,1-P]),(t===Mesh.FLIP_ROW&&h%2==1||t===Mesh.FLIP_TILE&&(h+o)%2==1)&&(R=[1-b,w,1-I,w,1-I,P,1-b,P]),(t===Mesh.FLIP_N_ROTATE_ROW&&h%2==1||t===Mesh.FLIP_N_ROTATE_TILE&&(h+o)%2==1)&&(R=[b,1-w,I,1-w,I,1-P,b,1-P]),A=A.concat(R),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e){const e=[];b=0,w=1-u/a,I=1,P=1,e[0]=[b,w,I,w,I,P,b,P],e[1]=[b,w,I,w,I,P,b,P],t!==Mesh.ROTATE_TILE&&t!==Mesh.ROTATE_ROW||(e[1]=[1-b,1-w,1-I,1-w,1-I,1-P,1-b,1-P]),t!==Mesh.FLIP_TILE&&t!==Mesh.FLIP_ROW||(e[1]=[1-b,w,1-I,w,1-I,P,1-b,P]),t!==Mesh.FLIP_N_ROTATE_TILE&&t!==Mesh.FLIP_N_ROTATE_ROW||(e[1]=[b,1-w,I,1-w,I,1-P,b,1-P]);for(let a=0;a<o;a++)S.push(a*i-m+f,g+p,0),S.push((a+1)*i-m+f,g+p,0),S.push((a+1)*i-m+f,g+u+p,0),S.push(a*i-m+f,g+u+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,A=t===Mesh.FLIP_TILE||t===Mesh.ROTATE_TILE||t===Mesh.FLIP_N_ROTATE_TILE?A.concat(e[(a+1)%2]):t===Mesh.FLIP_ROW||t===Mesh.ROTATE_ROW||t===Mesh.FLIP_N_ROTATE_ROW?A.concat(e[1]):A.concat(e[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const e=[];b=0,w=0,I=1,P=u/a,e[0]=[b,w,I,w,I,P,b,P],e[1]=[b,w,I,w,I,P,b,P],t!==Mesh.ROTATE_TILE&&t!==Mesh.ROTATE_ROW||(e[1]=[1-b,1-w,1-I,1-w,1-I,1-P,1-b,1-P]),t!==Mesh.FLIP_TILE&&t!==Mesh.FLIP_ROW||(e[1]=[1-b,w,1-I,w,1-I,P,1-b,P]),t!==Mesh.FLIP_N_ROTATE_TILE&&t!==Mesh.FLIP_N_ROTATE_ROW||(e[1]=[b,1-w,I,1-w,I,1-P,b,1-P]);for(let a=0;a<o;a++)S.push(a*i-m+f,y-u+p,0),S.push((a+1)*i-m+f,y-u+p,0),S.push((a+1)*i-m+f,y+p,0),S.push(a*i-m+f,y+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,A=t===Mesh.FLIP_TILE||t===Mesh.ROTATE_TILE||t===Mesh.FLIP_N_ROTATE_TILE?A.concat(e[(a+h)%2]):t===Mesh.FLIP_ROW||t===Mesh.ROTATE_ROW||t===Mesh.FLIP_N_ROTATE_ROW?A.concat(e[h%2]):A.concat(e[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const e=[];b=1-l/i,w=0,I=1,P=1,e[0]=[b,w,I,w,I,P,b,P],e[1]=[b,w,I,w,I,P,b,P],t!==Mesh.ROTATE_TILE&&t!==Mesh.ROTATE_ROW||(e[1]=[1-b,1-w,1-I,1-w,1-I,1-P,1-b,1-P]),t!==Mesh.FLIP_TILE&&t!==Mesh.FLIP_ROW||(e[1]=[1-b,w,1-I,w,1-I,P,1-b,P]),t!==Mesh.FLIP_N_ROTATE_TILE&&t!==Mesh.FLIP_N_ROTATE_ROW||(e[1]=[b,1-w,I,1-w,I,1-P,b,1-P]);for(let i=0;i<h;i++)S.push(_+f,i*a-d+p,0),S.push(_+l+f,i*a-d+p,0),S.push(_+l+f,(i+1)*a-d+p,0),S.push(_+f,(i+1)*a-d+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,A=t===Mesh.FLIP_TILE||t===Mesh.ROTATE_TILE||t===Mesh.FLIP_N_ROTATE_TILE?A.concat(e[(i+1)%2]):t===Mesh.FLIP_ROW||t===Mesh.ROTATE_ROW||t===Mesh.FLIP_N_ROTATE_ROW?A.concat(e[i%2]):A.concat(e[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const e=[];b=0,w=0,I=l/a,P=1,e[0]=[b,w,I,w,I,P,b,P],e[1]=[b,w,I,w,I,P,b,P],t!==Mesh.ROTATE_TILE&&t!==Mesh.ROTATE_ROW||(e[1]=[1-b,1-w,1-I,1-w,1-I,1-P,1-b,1-P]),t!==Mesh.FLIP_TILE&&t!==Mesh.FLIP_ROW||(e[1]=[1-b,w,1-I,w,1-I,P,1-b,P]),t!==Mesh.FLIP_N_ROTATE_TILE&&t!==Mesh.FLIP_N_ROTATE_ROW||(e[1]=[b,1-w,I,1-w,I,1-P,b,1-P]);for(let i=0;i<h;i++)S.push(v-l+f,i*a-d+p,0),S.push(v+f,i*a-d+p,0),S.push(v+f,(i+1)*a-d+p,0),S.push(v-l+f,(i+1)*a-d+p,0),M.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,A=t===Mesh.FLIP_TILE||t===Mesh.ROTATE_TILE||t===Mesh.FLIP_N_ROTATE_TILE?A.concat(e[(i+o)%2]):t===Mesh.FLIP_ROW||t===Mesh.ROTATE_ROW||t===Mesh.FLIP_N_ROTATE_ROW?A.concat(e[i%2]):A.concat(e[0]),T.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),C.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const b=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE;VertexData._ComputeSides(b,S,M,C,A,e.frontUVs,e.backUVs);const w=new VertexData;w.indices=M,w.positions=S,w.normals=C,w.uvs=A;const I=b===VertexData.DOUBLESIDE?T.concat(T):T;return w.colors=I,w}function CreateTiledPlane(e,t,i=null){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateTiledPlaneVertexData(t).applyToMesh(a,t.updatable),a}function CreateTiledBoxVertexData(e){const t=e.faceUV||new Array(6),i=e.faceColors,a=e.pattern||Mesh.NO_FLIP,n=e.width||e.size||1,s=e.height||e.size||1,r=e.depth||e.size||1,o=e.tileWidth||e.tileSize||1,l=e.tileHeight||e.tileSize||1,c=e.alignHorizontal||0,h=e.alignVertical||0,u=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE;for(let e=0;e<6;e++)void 0===t[e]&&(t[e]=new Vector4(0,0,1,1)),i&&void 0===i[e]&&(i[e]=new Color4(1,1,1,1));const m=n/2,d=s/2,f=r/2,p=[];for(let e=0;e<2;e++)p[e]=CreateTiledPlaneVertexData({pattern:a,tileWidth:o,tileHeight:l,width:n,height:s,alignVertical:h,alignHorizontal:c,sideOrientation:u});for(let e=2;e<4;e++)p[e]=CreateTiledPlaneVertexData({pattern:a,tileWidth:o,tileHeight:l,width:r,height:s,alignVertical:h,alignHorizontal:c,sideOrientation:u});let _=h;h===Mesh.BOTTOM?_=Mesh.TOP:h===Mesh.TOP&&(_=Mesh.BOTTOM);for(let e=4;e<6;e++)p[e]=CreateTiledPlaneVertexData({pattern:a,tileWidth:o,tileHeight:l,width:n,height:r,alignVertical:_,alignHorizontal:c,sideOrientation:u});let g=[],v=[],y=[],S=[];const C=[],E=[],A=[],T=[];let M=0,x=0;for(let e=0;e<6;e++){const a=p[e].positions.length;E[e]=[],A[e]=[];for(let t=0;t<a/3;t++)E[e].push(new Vector3(p[e].positions[3*t],p[e].positions[3*t+1],p[e].positions[3*t+2])),A[e].push(new Vector3(p[e].normals[3*t],p[e].normals[3*t+1],p[e].normals[3*t+2]));M=p[e].uvs.length,T[e]=[];for(let i=0;i<M;i+=2)T[e][i]=t[e].x+(t[e].z-t[e].x)*p[e].uvs[i],T[e][i+1]=t[e].y+(t[e].w-t[e].y)*p[e].uvs[i+1],useOpenGLOrientationForUV&&(T[e][i+1]=1-T[e][i+1]);if(y=y.concat(T[e]),S=S.concat(p[e].indices.map((e=>e+x))),x+=E[e].length,i)for(let t=0;t<4;t++)C.push(i[e].r,i[e].g,i[e].b,i[e].a)}const b=new Vector3(0,0,f),w=Matrix.RotationY(Math.PI);g=E[0].map((e=>Vector3.TransformNormal(e,w).add(b))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),v=A[0].map((e=>Vector3.TransformNormal(e,w))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),g=g.concat(E[1].map((e=>e.subtract(b))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(A[1].map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const I=new Vector3(m,0,0),P=Matrix.RotationY(-Math.PI/2);g=g.concat(E[2].map((e=>Vector3.TransformNormal(e,P).add(I))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(A[2].map((e=>Vector3.TransformNormal(e,P))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const R=Matrix.RotationY(Math.PI/2);g=g.concat(E[3].map((e=>Vector3.TransformNormal(e,R).subtract(I))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(A[3].map((e=>Vector3.TransformNormal(e,R))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const N=new Vector3(0,d,0),k=Matrix.RotationX(Math.PI/2);g=g.concat(E[4].map((e=>Vector3.TransformNormal(e,k).add(N))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(A[4].map((e=>Vector3.TransformNormal(e,k))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const D=Matrix.RotationX(-Math.PI/2);g=g.concat(E[5].map((e=>Vector3.TransformNormal(e,D).subtract(N))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(A[5].map((e=>Vector3.TransformNormal(e,D))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),VertexData._ComputeSides(u,g,S,v,y);const B=new VertexData;if(B.indices=S,B.positions=g,B.normals=v,B.uvs=y,i){const e=u===VertexData.DOUBLESIDE?C.concat(C):C;B.colors=e}return B}function CreateTiledBox(e,t,i=null){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateTiledBoxVertexData(t).applyToMesh(a,t.updatable),a}function CreateSphereVertexData(e){const t=0|(e.segments||32),i=e.diameterX||e.diameter||1,a=e.diameterY||e.diameter||1,n=e.diameterZ||e.diameter||1,s=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,r=e.slice&&e.slice<=0?1:e.slice||1,o=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,l=!!e.dedupTopBottomIndices,c=new Vector3(i/2,a/2,n/2),h=2+t,u=2*h,m=[],d=[],f=[],p=[];for(let e=0;e<=h;e++){const t=e/h,i=t*Math.PI*r;for(let e=0;e<=u;e++){const a=e/u,n=a*Math.PI*2*s,r=Matrix.RotationZ(-i),o=Matrix.RotationY(n),l=Vector3.TransformCoordinates(Vector3.Up(),r),h=Vector3.TransformCoordinates(l,o),m=h.multiply(c),_=h.divide(c).normalize();d.push(m.x,m.y,m.z),f.push(_.x,_.y,_.z),p.push(a,useOpenGLOrientationForUV?1-t:t)}if(e>0){const t=d.length/3;for(let i=t-2*(u+1);i+u+2<t;i++)l?(e>1&&(m.push(i),m.push(i+1),m.push(i+u+1)),(e<h||r<1)&&(m.push(i+u+1),m.push(i+1),m.push(i+u+2))):(m.push(i),m.push(i+1),m.push(i+u+1),m.push(i+u+1),m.push(i+1),m.push(i+u+2))}}VertexData._ComputeSides(o,d,m,f,p,e.frontUVs,e.backUVs);const _=new VertexData;return _.indices=m,_.positions=d,_.normals=f,_.uvs=p,_}function CreateSphere(e,t={},i=null){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateSphereVertexData(t).applyToMesh(a,t.updatable),a}function CreateCylinderVertexData(e){const t=e.height||2;let i=0===e.diameterTop?0:e.diameterTop||e.diameter||1,a=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;i=i||1e-5,a=a||1e-5;const n=0|(e.tessellation||24),s=0|(e.subdivisions||1),r=!!e.hasRings,o=!!e.enclose,l=0===e.cap?0:e.cap||Mesh.CAP_ALL,c=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,h=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,u=e.faceUV||new Array(3),m=e.faceColors,d=2+(1+(1!==c&&o?2:0))*(r?s:1);let f;for(f=0;f<d;f++)m&&void 0===m[f]&&(m[f]=new Color4(1,1,1,1));for(f=0;f<d;f++)u&&void 0===u[f]&&(u[f]=new Vector4(0,0,1,1));const p=[],_=[],g=[],v=[],y=[],S=2*Math.PI*c/n;let C,E,A;const T=(a-i)/2/t,M=Vector3.Zero(),x=Vector3.Zero(),b=Vector3.Zero(),w=Vector3.Zero(),I=Vector3.Zero(),P=Axis.Y;let R,N,k,D=1,B=1,F=0,L=0;for(R=0;R<=s;R++)for(E=R/s,A=(E*(i-a)+a)/2,D=r&&0!==R&&R!==s?2:1,k=0;k<D;k++){for(r&&(B+=k),o&&(B+=2*k),N=0;N<=n;N++)C=N*S,M.x=Math.cos(-C)*A,M.y=-t/2+E*t,M.z=Math.sin(-C)*A,0===i&&R===s?(x.x=g[g.length-3*(n+1)],x.y=g[g.length-3*(n+1)+1],x.z=g[g.length-3*(n+1)+2]):(x.x=M.x,x.z=M.z,x.y=Math.sqrt(x.x*x.x+x.z*x.z)*T,x.normalize()),0===N&&(b.copyFrom(M),w.copyFrom(x)),_.push(M.x,M.y,M.z),g.push(x.x,x.y,x.z),L=r?F!==B?u[B].y:u[B].w:u[B].y+(u[B].w-u[B].y)*E,v.push(u[B].x+(u[B].z-u[B].x)*N/n,useOpenGLOrientationForUV?1-L:L),m&&y.push(m[B].r,m[B].g,m[B].b,m[B].a);1!==c&&o&&(_.push(M.x,M.y,M.z),_.push(0,M.y,0),_.push(0,M.y,0),_.push(b.x,b.y,b.z),Vector3.CrossToRef(P,x,I),I.normalize(),g.push(I.x,I.y,I.z,I.x,I.y,I.z),Vector3.CrossToRef(w,P,I),I.normalize(),g.push(I.x,I.y,I.z,I.x,I.y,I.z),L=r?F!==B?u[B+1].y:u[B+1].w:u[B+1].y+(u[B+1].w-u[B+1].y)*E,v.push(u[B+1].x,useOpenGLOrientationForUV?1-L:L),v.push(u[B+1].z,useOpenGLOrientationForUV?1-L:L),L=r?F!==B?u[B+2].y:u[B+2].w:u[B+2].y+(u[B+2].w-u[B+2].y)*E,v.push(u[B+2].x,useOpenGLOrientationForUV?1-L:L),v.push(u[B+2].z,useOpenGLOrientationForUV?1-L:L),m&&(y.push(m[B+1].r,m[B+1].g,m[B+1].b,m[B+1].a),y.push(m[B+1].r,m[B+1].g,m[B+1].b,m[B+1].a),y.push(m[B+2].r,m[B+2].g,m[B+2].b,m[B+2].a),y.push(m[B+2].r,m[B+2].g,m[B+2].b,m[B+2].a))),F!==B&&(F=B)}const O=1!==c&&o?n+4:n;for(R=0,B=0;B<s;B++){let e=0,t=0,i=0,a=0;for(N=0;N<n;N++)e=R*(O+1)+N,t=(R+1)*(O+1)+N,i=R*(O+1)+(N+1),a=(R+1)*(O+1)+(N+1),p.push(e,t,i),p.push(a,i,t);1!==c&&o&&(p.push(e+2,t+2,i+2),p.push(a+2,i+2,t+2),p.push(e+4,t+4,i+4),p.push(a+4,i+4,t+4)),R=r?R+2:R+1}const G=e=>{const s=e?i/2:a/2;if(0===s)return;let r,o,l;const h=e?u[d-1]:u[0];let f=null;m&&(f=e?m[d-1]:m[0]);const S=_.length/3,C=e?t/2:-t/2,E=new Vector3(0,C,0);_.push(E.x,E.y,E.z),g.push(0,e?1:-1,0);const A=h.y+.5*(h.w-h.y);v.push(h.x+.5*(h.z-h.x),useOpenGLOrientationForUV?1-A:A),f&&y.push(f.r,f.g,f.b,f.a);const T=new Vector2(.5,.5);for(l=0;l<=n;l++){r=2*Math.PI*l*c/n;const t=Math.cos(-r),i=Math.sin(-r);o=new Vector3(t*s,C,i*s);const a=new Vector2(t*T.x+.5,i*T.y+.5);_.push(o.x,o.y,o.z),g.push(0,e?1:-1,0);const u=h.y+(h.w-h.y)*a.y;v.push(h.x+(h.z-h.x)*a.x,useOpenGLOrientationForUV?1-u:u),f&&y.push(f.r,f.g,f.b,f.a)}for(l=0;l<n;l++)e?(p.push(S),p.push(S+(l+2)),p.push(S+(l+1))):(p.push(S),p.push(S+(l+1)),p.push(S+(l+2)))};l!==Mesh.CAP_START&&l!==Mesh.CAP_ALL||G(!1),l!==Mesh.CAP_END&&l!==Mesh.CAP_ALL||G(!0),VertexData._ComputeSides(h,_,p,g,v,e.frontUVs,e.backUVs);const V=new VertexData;return V.indices=p,V.positions=_,V.normals=g,V.uvs=v,m&&(V.colors=y),V}function CreateCylinder(e,t={},i){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateCylinderVertexData(t).applyToMesh(a,t.updatable),a}function CreateTorusVertexData(e){const t=[],i=[],a=[],n=[],s=e.diameter||1,r=e.thickness||.5,o=0|(e.tessellation||16),l=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,c=o+1;for(let e=0;e<=o;e++){const l=e/o,h=e*Math.PI*2/o-Math.PI/2,u=Matrix.Translation(s/2,0,0).multiply(Matrix.RotationY(h));for(let s=0;s<=o;s++){const h=1-s/o,m=s*Math.PI*2/o+Math.PI,d=Math.cos(m),f=Math.sin(m);let p=new Vector3(d,f,0),_=p.scale(r/2);const g=new Vector2(l,h);_=Vector3.TransformCoordinates(_,u),p=Vector3.TransformNormal(p,u),i.push(_.x,_.y,_.z),a.push(p.x,p.y,p.z),n.push(g.x,useOpenGLOrientationForUV?1-g.y:g.y);const v=(e+1)%c,y=(s+1)%c;t.push(e*c+s),t.push(e*c+y),t.push(v*c+s),t.push(e*c+y),t.push(v*c+y),t.push(v*c+s)}}VertexData._ComputeSides(l,i,t,a,n,e.frontUVs,e.backUVs);const h=new VertexData;return h.indices=t,h.positions=i,h.normals=a,h.uvs=n,h}function CreateTorus(e,t={},i){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateTorusVertexData(t).applyToMesh(a,t.updatable),a}function CreateTorusKnotVertexData(e){const t=[],i=[],a=[],n=[],s=e.radius||2,r=e.tube||.5,o=e.radialSegments||32,l=e.tubularSegments||32,c=e.p||2,h=e.q||3,u=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,m=e=>{const t=Math.cos(e),i=Math.sin(e),a=h/c*e,n=Math.cos(a),r=s*(2+n)*.5*t,o=s*(2+n)*i*.5,l=s*Math.sin(a)*.5;return new Vector3(r,o,l)};let d,f;for(d=0;d<=o;d++){const e=d%o/o*2*c*Math.PI,t=m(e),a=m(e+.01),s=a.subtract(t);let h=a.add(t);const u=Vector3.Cross(s,h);for(h=Vector3.Cross(u,s),u.normalize(),h.normalize(),f=0;f<l;f++){const e=f%l/l*2*Math.PI,a=-r*Math.cos(e),s=r*Math.sin(e);i.push(t.x+a*h.x+s*u.x),i.push(t.y+a*h.y+s*u.y),i.push(t.z+a*h.z+s*u.z),n.push(d/o),n.push(useOpenGLOrientationForUV?1-f/l:f/l)}}for(d=0;d<o;d++)for(f=0;f<l;f++){const e=(f+1)%l,i=d*l+f,a=(d+1)*l+f,n=(d+1)*l+e,s=d*l+e;t.push(s),t.push(a),t.push(i),t.push(s),t.push(n),t.push(a)}VertexData.ComputeNormals(i,t,a),VertexData._ComputeSides(u,i,t,a,n,e.frontUVs,e.backUVs);const p=new VertexData;return p.indices=t,p.positions=i,p.normals=a,p.uvs=n,p}function CreateTorusKnot(e,t={},i){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateTorusKnotVertexData(t).applyToMesh(a,t.updatable),a}VertexData.CreateGround=CreateGroundVertexData,VertexData.CreateTiledGround=CreateTiledGroundVertexData,VertexData.CreateGroundFromHeightMap=CreateGroundFromHeightMapVertexData,Mesh.CreateGround=(e,t,i,a,n,s)=>CreateGround(e,{width:t,height:i,subdivisions:a,updatable:s},n),Mesh.CreateTiledGround=(e,t,i,a,n,s,r,o,l)=>CreateTiledGround(e,{xmin:t,zmin:i,xmax:a,zmax:n,subdivisions:s,precision:r,updatable:l},o),Mesh.CreateGroundFromHeightMap=(e,t,i,a,n,s,r,o,l,c,h)=>CreateGroundFromHeightMap(e,t,{width:i,height:a,subdivisions:n,minHeight:s,maxHeight:r,updatable:l,onReady:c,alphaFilter:h},o),VertexData.Mc=CreateBoxVertexData,Mesh.Mc=(e,t,i=null,a,n)=>CreateBox(e,{size:t,sideOrientation:n,updatable:a},i),VertexData.CreateTiledPlane=CreateTiledPlaneVertexData,VertexData.CreateTiledBox=CreateTiledBoxVertexData,VertexData.vc=CreateSphereVertexData,Mesh.vc=(e,t,i,a,n,s)=>CreateSphere(e,{segments:t,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:s,updatable:n},a),VertexData.Ec=CreateCylinderVertexData,Mesh.Ec=(e,t,i,a,n,s,r,o,l)=>{void 0!==r&&r instanceof Scene||(void 0!==r&&(l=o||Mesh.DEFAULTSIDE,o=r),r=s,s=1);return CreateCylinder(e,{height:t,diameterTop:i,diameterBottom:a,tessellation:n,subdivisions:s,sideOrientation:l,updatable:o},r)},VertexData.CreateTorus=CreateTorusVertexData,Mesh.CreateTorus=(e,t,i,a,n,s,r)=>CreateTorus(e,{diameter:t,thickness:i,tessellation:a,sideOrientation:r,updatable:s},n),VertexData.CreateTorusKnot=CreateTorusKnotVertexData,Mesh.CreateTorusKnot=(e,t,i,a,n,s,r,o,l,c)=>CreateTorusKnot(e,{radius:t,tube:i,radialSegments:a,tubularSegments:n,p:s,q:r,sideOrientation:c,updatable:l},o),Mesh._instancedMeshFactory=(e,t)=>{const i=new InstancedMesh(e,t);if(t.instancedBuffers){i.instancedBuffers={};for(const e in t.instancedBuffers)i.instancedBuffers[e]=t.instancedBuffers[e]}return i};var InstancedMesh=class extends AbstractMesh{instantiateHierarchy(e=null,t,i){const a=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);a&&i&&i(this,a);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(a,t,i);return a}clone(e,t=null,i,a){const n=(a||this._sourceMesh).createInstance(e);if(DeepCopier.DeepCopy(this,n,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(n.parent=t),!i)for(let e=0;e<this.getScene().meshes.length;e++){const t=this.getScene().meshes[e];t.parent===this&&t.clone(t.name,n)}return n.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(n),n}updateVerticesData(e,t,i,a){return this.zb&&this.zb.updateVerticesData(e,t,i,a),this.zb}set skeleton(e){this._sourceMesh?.skeleton!==e&&Tools.Warn("Setting skeleton on an instanced mesh has no effect")}_resyncLightSources(){}dispose(e,t=!1){this._sourceMesh.removeInstance(this),super.dispose(e,t)}set visibility(e){this._sourceMesh?.visibility!==e&&Tools.Warn("Setting visibility on an instanced mesh has no effect")}get lightSources(){return this._sourceMesh._lightSources}get zb(){return this._sourceMesh}isReady(e=!1){return this._sourceMesh.isReady(e,!0)}setVerticesData(e,t,i,a){return this.zb&&this.zb.setVerticesData(e,t,i,a),this.zb}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i;i="object"==typeof e?e:{applySkeleton:e,applyMorph:t};const a=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getData(i,null,VertexBuffer.PositionKind),a),this}getIndices(){return this._sourceMesh.getIndices()}getTotalIndices(){return this._sourceMesh.getTotalIndices()}constructor(e,t){super(e,t.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.addInstance(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice();for(const e of t.getAnimationRanges())null!=e&&this.createAnimationRange(e.name,e.from,e.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}get isAnInstance(){return!0}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}get receiveShadows(){return this._sourceMesh.receiveShadows}get skeleton(){return this._sourceMesh.skeleton}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==TransformNode.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new Matrix);const e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,TmpVectors.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(TmpVectors.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}get _positions(){return this._sourceMesh._positions}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}copyVerticesData(e,t){this._sourceMesh.copyVerticesData(e,t)}getLOD(e){if(!e)return this;const t=this.zb.getLODLevels();if(t&&0!==t.length){const t=this.getBoundingInfo();this._currentLOD=this.zb.getLOD(e,t.boundingSphere)}else this._currentLOD=this.zb;return this._currentLOD}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}get material(){return this._sourceMesh.material}get undefinedc(){return this._sourceMesh.undefinedc}set material(e){this._sourceMesh?.material!==e&&Tools.Warn("Setting material on an instanced mesh has no effect")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}_removeLightSource(){}get visibility(){return this._sourceMesh.visibility}set undefinedc(e){this._sourceMesh&&e!==this._sourceMesh.undefinedc&&Logger.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getClassName(){return"InstancedMesh"}_activate(e,t){if(super._activate(e,t),this._sourceMesh.subMeshes||Logger.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_preActivateForIntermediateRendering(e){return this.zb._preActivateForIntermediateRendering(e)}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.Hc,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}set receiveShadows(e){this._sourceMesh?.receiveShadows!==e&&Tools.Warn("Setting receiveShadows on an instanced mesh has no effect")}createInstance(e){return this._sourceMesh.createInstance(e)}_resyncLightSource(){}setIndices(e,t=null){return this.zb&&this.zb.setIndices(e,t),this.zb}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}getVerticesData(e,t,i){return this._sourceMesh.getVerticesData(e,t,i)}};Mesh.prototype.registerInstancedBuffer=function(e,t){if(this._userInstancedBuffersStorage?.vertexBuffers[e]?.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const e of this.instances)e.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new VertexBuffer(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0);for(const t of this.instances)t.instancedBuffers[e]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},Mesh.prototype._processInstancedBuffers=function(e,t){const i=e?e.length:0;for(const a in this.instancedBuffers){let n=this._userInstancedBuffersStorage.sizes[a];const s=this._userInstancedBuffersStorage.strides[a],r=(i+1)*s;for(;n<r;)n*=2;this._userInstancedBuffersStorage.data[a].length!=n&&(this._userInstancedBuffersStorage.data[a]=new Float32Array(n),this._userInstancedBuffersStorage.sizes[a]=n,this._userInstancedBuffersStorage.vertexBuffers[a]&&(this._userInstancedBuffersStorage.vertexBuffers[a].dispose(),this._userInstancedBuffersStorage.vertexBuffers[a]=null));const o=this._userInstancedBuffersStorage.data[a];let l=0;if(t){const e=this.instancedBuffers[a];e.toArray?e.toArray(o,l):e.copyToArray?e.copyToArray(o,l):o[l]=e,l+=s}for(let t=0;t<i;t++){const i=e[t].instancedBuffers[a];i.toArray?i.toArray(o,l):i.copyToArray?i.copyToArray(o,l):o[l]=i,l+=s}this._userInstancedBuffersStorage.vertexBuffers[a]?this._userInstancedBuffersStorage.vertexBuffers[a].updateDirectly(o,0):(this._userInstancedBuffersStorage.vertexBuffers[a]=new VertexBuffer(this.getEngine(),this._userInstancedBuffersStorage.data[a],a,!0,!1,s,!0),this._invalidateInstanceVertexArrayObject())}},Mesh.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},Mesh.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},RegisterClass("BABYLON.InstancedMesh",InstancedMesh);var onCreatedEffectParameters3={effect:null,subMesh:null},ShaderMaterial=class e extends PushMaterial{setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setColor3Array(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}hasTexture(e){if(super.hasTexture(e))return!0;for(const t in this._textures)if(this._textures[t]===e)return!0;for(const t in this._textureArrays){const i=this._textureArrays[t];for(let t=0;t<i.length;t++)if(i[t]===e)return!0}return!1}_checkUniform(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setQuaternionArray(e,t){return this._checkUniform(e),this._quaternionsArrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setStorageBuffer(e,t){return-1===this._options.storageBuffers.indexOf(e)&&this._options.storageBuffers.push(e),this._storageBuffers[e]=t,this}getClassName(){return"ShaderMaterial"}setMatrix2x2(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this}isReady(e,t,i){const a=i&&this._storeEffectOnSubMeshes;if(this.isFrozen){const e=a?i._drawWrapper:this._drawWrapper;if(e.effect&&e._wasPreviouslyReady&&e._wasPreviouslyUsingInstances===t)return!0}const n=this.getScene(),s=n.getEngine(),r=[],o=[],l=new EffectFallbacks;let c=this._shaderPath,h=this._options.uniforms,u=this._options.uniformBuffers,m=this._options.samplers;s.getCaps().multiview&&n.activeCamera&&n.activeCamera.outputRenderTarget&&n.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,r.push("#define MULTIVIEW"),-1!==h.indexOf("viewProjection")&&-1===h.indexOf("viewProjectionR")&&h.push("viewProjectionR"));for(let e=0;e<this._options.defines.length;e++){const t=0===this._options.defines[e].indexOf("#define")?this._options.defines[e]:`#define ${this._options.defines[e]}`;r.push(t)}for(let e=0;e<this._options.attributes.length;e++)o.push(this._options.attributes[e]);if(e&&e.isVerticesDataPresent(VertexBuffer.ColorKind)&&(-1===o.indexOf(VertexBuffer.ColorKind)&&o.push(VertexBuffer.ColorKind),r.push("#define VERTEXCOLOR")),t&&(r.push("#define INSTANCES"),PushAttributesForInstances(o,this._materialHelperNeedsPreviousMatrices),e?.hasThinInstances&&(r.push("#define THIN_INSTANCES"),e&&e.isVerticesDataPresent(VertexBuffer.ColorInstanceKind)&&(o.push(VertexBuffer.ColorInstanceKind),r.push("#define INSTANCESCOLOR")))),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){o.push(VertexBuffer.MatricesIndicesKind),o.push(VertexBuffer.MatricesWeightsKind),e.numBoneInfluencers>4&&(o.push(VertexBuffer.MatricesIndicesExtraKind),o.push(VertexBuffer.MatricesWeightsExtraKind));const t=e.skeleton;r.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),l.addCPUSkinningFallback(0,e),t.isUsingTextureForMatrices?(r.push("#define BONETEXTURE"),-1===h.indexOf("boneTextureWidth")&&h.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(r.push("#define BonesPerMesh "+(t.bones.length+1)),-1===h.indexOf("mBones")&&h.push("mBones"))}else r.push("#define NUM_BONE_INFLUENCERS 0");let d=0;const f=e?e.morphTargetManager:null;if(f){const e=f.supportsUVs&&-1!==r.indexOf("#define UV1"),t=f.supportsTangents&&-1!==r.indexOf("#define TANGENT"),i=f.supportsNormals&&-1!==r.indexOf("#define NORMAL");d=f.numMaxInfluencers||f.numInfluencers,e&&r.push("#define MORPHTARGETS_UV"),t&&r.push("#define MORPHTARGETS_TANGENT"),i&&r.push("#define MORPHTARGETS_NORMAL"),d>0&&r.push("#define MORPHTARGETS"),f.isUsingTextureForTargets&&(r.push("#define MORPHTARGETS_TEXTURE"),-1===h.indexOf("morphTargetTextureIndices")&&h.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),r.push("#define NUM_MORPH_INFLUENCERS "+d);for(let a=0;a<d;a++)o.push(VertexBuffer.PositionKind+a),i&&o.push(VertexBuffer.NormalKind+a),t&&o.push(VertexBuffer.TangentKind+a),e&&o.push(VertexBuffer.UVKind+"_"+a);d>0&&(h=h.slice(),h.push("morphTargetInfluences"),h.push("morphTargetCount"),h.push("morphTargetTextureInfo"),h.push("morphTargetTextureIndices"))}else r.push("#define NUM_MORPH_INFLUENCERS 0");if(e){const t=e.bakedVertexAnimationManager;t&&t.isEnabled&&(r.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===h.indexOf("bakedVertexAnimationSettings")&&h.push("bakedVertexAnimationSettings"),-1===h.indexOf("bakedVertexAnimationTextureSizeInverted")&&h.push("bakedVertexAnimationTextureSizeInverted"),-1===h.indexOf("bakedVertexAnimationTime")&&h.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),PrepareAttributesForBakedVertexAnimation(o,e,r)}for(const e in this._textures)if(!this._textures[e].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&r.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&(addClipPlaneUniforms(h),prepareStringDefinesForClipPlanes(this,n,r)),n.fogEnabled&&e?.applyFog&&n.fogMode!==Scene.FOGMODE_NONE&&(r.push("#define FOG"),-1===h.indexOf("view")&&h.push("view"),-1===h.indexOf("vFogInfos")&&h.push("vFogInfos"),-1===h.indexOf("vFogColor")&&h.push("vFogColor")),this._useLogarithmicDepth&&(r.push("#define LOGARITHMICDEPTH"),-1===h.indexOf("logarithmicDepthConstant")&&h.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(h=h.slice(),u=u.slice(),m=m.slice(),c=this.customShaderNameResolve(this.name,h,u,m,r,o));const p=a?i._getDrawWrapper(void 0,!0):this._drawWrapper,_=p?.effect??null,g=p?.defines??null,v=r.join("\n");let y=_;return g!==v&&(y=s.createEffect(c,{attributes:o,uniformsNames:h,uniformBuffersNames:u,samplers:m,defines:v,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:d},shaderLanguage:this._options.shaderLanguage},s),a?i.setEffect(y,v,this._materialContext):p&&p.setEffect(y,v),this._onEffectCreatedObservable&&(onCreatedEffectParameters3.effect=y,onCreatedEffectParameters3.subMesh=i??e?.subMeshes[0]??null,this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters3))),p._wasPreviouslyUsingInstances=!!t,!!y?.isReady()&&(_!==y&&n.resetCachedMaterial(),p._wasPreviouslyReady=!0,!0)}static ParseFromSnippetAsync(e,t,i=""){return new Promise(((a,n)=>{const s=new WebRequest;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const n=JSON.parse(JSON.parse(s.responseText).jsonPayload),r=JSON.parse(n.shaderMaterial),o=this.Parse(r,t||EngineStore.LastCreatedScene,i);o.snippetId=e,a(o)}else n("Unable to load the snippet "+e)})),s.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),s.send()}))}set shaderPath(e){this._shaderPath=e}bindOnlyWorldMatrix(e,t){const i=this.getScene(),a=t??this.getEffect();a&&(-1!==this._options.uniforms.indexOf("world")&&a.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(i.getViewMatrix(),this._cachedWorldViewMatrix),a.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(e.multiplyToRef(i.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),a.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&a.setMatrix("view",i.getViewMatrix()))}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setTextureSampler(e,t){return-1===this._options.samplerObjects.indexOf(e)&&this._options.samplerObjects.push(e),this._textureSamplers[e]=t,this}setArray4(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this}constructor(e,t,i,a={},n=!0){super(e,t,n),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new Matrix,this._cachedWorldViewProjectionMatrix=new Matrix,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=i,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...a}}setDefine(e,t){const i=e.trimEnd()+" ",a=this.options.defines.findIndex((t=>t===e||t.startsWith(i)));return a>=0&&this.options.defines.splice(a,1),("boolean"!=typeof t||t)&&this.options.defines.push(i+t),this}get isMultiview(){return this._multiview}bindForSubMesh(e,t,i){this.bind(e,t,i._drawWrapperOverride?.effect,i)}serialize(){const e=SerializationHelper.Serialize(this);let t;for(t in e.customType="BABYLON.ShaderMaterial",e.Hc=this.Hc,e.options=this._options,e.shaderPath=this._shaderPath,e.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,e.stencil=this.stencil.serialize(),e.textures={},this._textures)e.textures[t]=this._textures[t].serialize();for(t in e.textureArrays={},this._textureArrays){e.textureArrays[t]=[];const i=this._textureArrays[t];for(let a=0;a<i.length;a++)e.textureArrays[t].push(i[a].serialize())}for(t in e.ints={},this._ints)e.ints[t]=this._ints[t];for(t in e.uints={},this._uints)e.uints[t]=this._uints[t];for(t in e.floats={},this._floats)e.floats[t]=this._floats[t];for(t in e.floatsArrays={},this._floatsArrays)e.floatsArrays[t]=this._floatsArrays[t];for(t in e.colors3={},this._colors3)e.colors3[t]=this._colors3[t].asArray();for(t in e.colors3Arrays={},this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];for(t in e.colors4={},this._colors4)e.colors4[t]=this._colors4[t].asArray();for(t in e.colors4Arrays={},this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];for(t in e.vectors2={},this._vectors2)e.vectors2[t]=this._vectors2[t].asArray();for(t in e.vectors3={},this._vectors3)e.vectors3[t]=this._vectors3[t].asArray();for(t in e.vectors4={},this._vectors4)e.vectors4[t]=this._vectors4[t].asArray();for(t in e.quaternions={},this._quaternions)e.quaternions[t]=this._quaternions[t].asArray();for(t in e.matrices={},this._matrices)e.matrices[t]=this._matrices[t].asArray();for(t in e.matrixArray={},this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];for(t in e.matrices3x3={},this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];for(t in e.matrices2x2={},this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];for(t in e.vectors2Arrays={},this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in e.vectors3Arrays={},this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in e.vectors4Arrays={},this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];for(t in e.quaternionsArrays={},this._quaternionsArrays)e.quaternionsArrays[t]=this._quaternionsArrays[t];return e}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setUniformBuffer(e,t){return-1===this._options.uniformBuffers.indexOf(e)&&this._options.uniformBuffers.push(e),this._uniformBuffers[e]=t,this}clone(t){const i=SerializationHelper.Clone((()=>new e(t,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);i.name=t,i.id=t,"object"==typeof i._shaderPath&&(i._shaderPath={...i._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((e=>{const t=this._options[e];Array.isArray(t)&&(this._options[e]=t.slice(0))})),this.stencil.copyTo(i.stencil);for(const e in this._textures)i.setTexture(e,this._textures[e]);for(const e in this._textureArrays)i.setTextureArray(e,this._textureArrays[e]);for(const e in this._externalTextures)i.setExternalTexture(e,this._externalTextures[e]);for(const e in this._ints)i.setInt(e,this._ints[e]);for(const e in this._uints)i.setUInt(e,this._uints[e]);for(const e in this._floats)i.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)i.setFloats(e,this._floatsArrays[e]);for(const e in this._colors3)i.setColor3(e,this._colors3[e]);for(const e in this._colors3Arrays)i._colors3Arrays[e]=this._colors3Arrays[e];for(const e in this._colors4)i.setColor4(e,this._colors4[e]);for(const e in this._colors4Arrays)i._colors4Arrays[e]=this._colors4Arrays[e];for(const e in this._vectors2)i.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)i.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)i.setVector4(e,this._vectors4[e]);for(const e in this._quaternions)i.setQuaternion(e,this._quaternions[e]);for(const e in this._quaternionsArrays)i._quaternionsArrays[e]=this._quaternionsArrays[e];for(const e in this._matrices)i.setMatrix(e,this._matrices[e]);for(const e in this._matrixArrays)i._matrixArrays[e]=this._matrixArrays[e].slice();for(const e in this._matrices3x3)i.setMatrix3x3(e,this._matrices3x3[e]);for(const e in this._matrices2x2)i.setMatrix2x2(e,this._matrices2x2[e]);for(const e in this._vectors2Arrays)i.setArray2(e,this._vectors2Arrays[e]);for(const e in this._vectors3Arrays)i.setArray3(e,this._vectors3Arrays[e]);for(const e in this._vectors4Arrays)i.setArray4(e,this._vectors4Arrays[e]);for(const e in this._uniformBuffers)i.setUniformBuffer(e,this._uniformBuffers[e]);for(const e in this._textureSamplers)i.setTextureSampler(e,this._textureSamplers[e]);for(const e in this._storageBuffers)i.setStorageBuffer(e,this._storageBuffers[e]);return i}dispose(e,t,i){if(t){let e;for(e in this._textures)this._textures[e].dispose();for(e in this._textureArrays){const t=this._textureArrays[e];for(let e=0;e<t.length;e++)t[e].dispose()}}this._textures={},super.dispose(e,t,i)}getActiveTextures(){const e=super.getActiveTextures();for(const t in this._textures)e.push(this._textures[t]);for(const t in this._textureArrays){const i=this._textureArrays[t];for(let t=0;t<i.length;t++)e.push(i[t])}return e}needAlphaTesting(){return this._options.needAlphaTesting}setExternalTexture(e,t){return-1===this._options.externalTextures.indexOf(e)&&this._options.externalTextures.push(e),this._externalTextures[e]=t,this}setMatrices(e,t){this._checkUniform(e);const i=new Float32Array(16*t.length);for(let e=0;e<t.length;e++){t[e].copyToArray(i,16*e)}return this._matrixArrays[e]=i,this}bind(e,t,i,a){const n=a&&this._storeEffectOnSubMeshes,s=i??(n?a.effect:this.getEffect());if(!s)return;const r=this.getScene();this._activeEffect=s,this.bindOnlyWorldMatrix(e,i);const o=this._options.uniformBuffers;let l=!1;if(s&&o&&o.length>0&&r.getEngine().supportsUniformBuffers)for(let i=0;i<o.length;++i){switch(o[i]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(s,"Mesh"),t.transferToEffect(e));break;case"Scene":BindSceneUniformBuffer(s,r.getSceneUniformBuffer()),r.finalizeSceneUbo(),l=!0}}const c=t&&n?this._mustRebind(r,s,a,t.visibility):r.getCachedMaterial()!==this;if(s&&c){let e;for(e in l||-1===this._options.uniforms.indexOf("view")||s.setMatrix("view",r.getViewMatrix()),l||-1===this._options.uniforms.indexOf("projection")||s.setMatrix("projection",r.getProjectionMatrix()),l||-1===this._options.uniforms.indexOf("viewProjection")||(s.setMatrix("viewProjection",r.getTransformMatrix()),this._multiview&&s.setMatrix("viewProjectionR",r._transformMatrixR)),r.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&s.setVector3("cameraPosition",r.activeCamera.globalPosition),BindBonesParameters(t,s),bindClipPlane(s,this,r),this._useLogarithmicDepth&&BindLogDepth(n?a.materialDefines:s.defines,s,r),t&&BindFogParameters(r,t,s),this._textures)s.setTexture(e,this._textures[e]);for(e in this._textureArrays)s.setTextureArray(e,this._textureArrays[e]);for(e in this._ints)s.setInt(e,this._ints[e]);for(e in this._uints)s.setUInt(e,this._uints[e]);for(e in this._floats)s.setFloat(e,this._floats[e]);for(e in this._floatsArrays)s.setArray(e,this._floatsArrays[e]);for(e in this._colors3)s.setColor3(e,this._colors3[e]);for(e in this._colors3Arrays)s.setArray3(e,this._colors3Arrays[e]);for(e in this._colors4){const t=this._colors4[e];s.setFloat4(e,t.r,t.g,t.b,t.a)}for(e in this._colors4Arrays)s.setArray4(e,this._colors4Arrays[e]);for(e in this._vectors2)s.setVector2(e,this._vectors2[e]);for(e in this._vectors3)s.setVector3(e,this._vectors3[e]);for(e in this._vectors4)s.setVector4(e,this._vectors4[e]);for(e in this._quaternions)s.setQuaternion(e,this._quaternions[e]);for(e in this._matrices)s.setMatrix(e,this._matrices[e]);for(e in this._matrixArrays)s.setMatrices(e,this._matrixArrays[e]);for(e in this._matrices3x3)s.setMatrix3x3(e,this._matrices3x3[e]);for(e in this._matrices2x2)s.setMatrix2x2(e,this._matrices2x2[e]);for(e in this._vectors2Arrays)s.setArray2(e,this._vectors2Arrays[e]);for(e in this._vectors3Arrays)s.setArray3(e,this._vectors3Arrays[e]);for(e in this._vectors4Arrays)s.setArray4(e,this._vectors4Arrays[e]);for(e in this._quaternionsArrays)s.setArray4(e,this._quaternionsArrays[e]);for(e in this._uniformBuffers){const t=this._uniformBuffers[e].getBuffer();t&&s.bindUniformBuffer(t,e)}const i=r.getEngine(),o=i.setExternalTexture;if(o)for(e in this._externalTextures)o.call(i,e,this._externalTextures[e]);const c=i.setTextureSampler;if(c)for(e in this._textureSamplers)c.call(i,e,this._textureSamplers[e]);const h=i.setStorageBuffer;if(h)for(e in this._storageBuffers)h.call(i,e,this._storageBuffers[e])}if(s&&t&&(c||!this.isFrozen)){const e=t.morphTargetManager;e&&e.numInfluencers>0&&BindMorphTargetParameters(t,s);const i=t.bakedVertexAnimationManager;if(i&&i.isEnabled){const e=n?a._drawWrapper:this._drawWrapper;t.bakedVertexAnimationManager?.bind(s,!!e._wasPreviouslyUsingInstances)}}this._afterBind(t,s,a)}setMatrix3x3(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setColor4Array(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}static Parse(t,i,a){const n=SerializationHelper.Parse((()=>new e(t.name,i,t.shaderPath,t.options,t.storeEffectOnSubMeshes)),t,i,a);let s;for(s in t.stencil&&n.stencil.parse(t.stencil,i,a),t.textures)n.setTexture(s,Texture.Parse(t.textures[s],i,a));for(s in t.textureArrays){const e=t.textureArrays[s],r=[];for(let t=0;t<e.length;t++)r.push(Texture.Parse(e[t],i,a));n.setTextureArray(s,r)}for(s in t.ints)n.setInt(s,t.ints[s]);for(s in t.uints)n.setUInt(s,t.uints[s]);for(s in t.floats)n.setFloat(s,t.floats[s]);for(s in t.floatsArrays)n.setFloats(s,t.floatsArrays[s]);for(s in t.colors3)n.setColor3(s,Color3.FromArray(t.colors3[s]));for(s in t.colors3Arrays){const e=t.colors3Arrays[s].reduce(((e,t,i)=>(i%3==0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>Color3.FromArray(e)));n.setColor3Array(s,e)}for(s in t.colors4)n.setColor4(s,Color4.FromArray(t.colors4[s]));for(s in t.colors4Arrays){const e=t.colors4Arrays[s].reduce(((e,t,i)=>(i%4==0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>Color4.FromArray(e)));n.setColor4Array(s,e)}for(s in t.vectors2)n.setVector2(s,Vector2.FromArray(t.vectors2[s]));for(s in t.vectors3)n.setVector3(s,Vector3.FromArray(t.vectors3[s]));for(s in t.vectors4)n.setVector4(s,Vector4.FromArray(t.vectors4[s]));for(s in t.quaternions)n.setQuaternion(s,Quaternion.FromArray(t.quaternions[s]));for(s in t.matrices)n.setMatrix(s,Matrix.FromArray(t.matrices[s]));for(s in t.matrixArray)n._matrixArrays[s]=new Float32Array(t.matrixArray[s]);for(s in t.matrices3x3)n.setMatrix3x3(s,t.matrices3x3[s]);for(s in t.matrices2x2)n.setMatrix2x2(s,t.matrices2x2[s]);for(s in t.vectors2Arrays)n.setArray2(s,t.vectors2Arrays[s]);for(s in t.vectors3Arrays)n.setArray3(s,t.vectors3Arrays[s]);for(s in t.vectors4Arrays)n.setArray4(s,t.vectors4Arrays[s]);for(s in t.quaternionsArrays)n.setArray4(s,t.quaternionsArrays[s]);return n}static ParseFromFileAsync(e,t,i,a=""){return new Promise(((n,s)=>{const r=new WebRequest;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const t=JSON.parse(r.responseText),s=this.Parse(t,i||EngineStore.LastCreatedScene,a);e&&(s.name=e),n(s)}else s("Unable to load the ShaderMaterial")})),r.open("GET",t),r.send()}))}get shaderPath(){return this._shaderPath}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setQuaternion(e,t){return this._checkUniform(e),this._quaternions[e]=t,this}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}setArray2(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this}setTextureArray(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this}setArray3(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this}isReadyForSubMesh(e,t,i){return this.isReady(e,i,t)}setUInt(e,t){return this._checkUniform(e),this._uints[e]=t,this}get options(){return this._options}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}setTexture(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this}};ShaderMaterial.SnippetUrl="https://snippet.babylonjs.com",ShaderMaterial.CreateFromSnippetAsync=ShaderMaterial.ParseFromSnippetAsync,RegisterClass("BABYLON.ShaderMaterial",ShaderMaterial),Mesh._LinesMeshParser=(e,t)=>LinesMesh.Parse(e,t);var LinesMesh=class e extends Mesh{getClassName(){return"LinesMesh"}dispose(e,t=!1,i){i||this._lineMaterial.dispose(!1,!1,!0),super.dispose(e)}constructor(e,t=null,i=null,a=null,n,s,r,o){super(e,t,i,a,n),this.useVertexColor=s,this.useVertexAlpha=r,this.color=new Color3(1,1,1),this.alpha=1,this._shaderLanguage=0,this._shadersLoaded=!1,a&&(this.color=a.color.clone(),this.alpha=a.alpha,this.useVertexColor=a.useVertexColor,this.useVertexAlpha=a.useVertexAlpha),this.intersectionThreshold=.1;const l={attributes:[VertexBuffer.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null};!1===r?l.needAlphaBlending=!1:l.defines.push("#define VERTEXALPHA"),s?(l.defines.push("#define VERTEXCOLOR"),l.attributes.push(VertexBuffer.ColorKind)):(l.uniforms.push("color"),this._color4=new Color4),o?(this.material=o,this._shadersLoaded=!0):this._initShaderSourceAsync(l)}serialize(e){super.serialize(e),e.color=this.color.asArray(),e.alpha=this.alpha}createInstance(e){const t=new InstancedLinesMesh(e,this);if(this.instancedBuffers){t.instancedBuffers={};for(const e in this.instancedBuffers)t.instancedBuffers[e]=this.instancedBuffers[e]}return t}set material(e){this._lineMaterial=e,this._lineMaterial.fillMode=Material.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(e){}static Parse(t,i){const a=new e(t.name,i);return a.color=Color3.FromArray(t.color),a.alpha=t.alpha,a}_bind(e,t){if(!this._geometry)return this;const i=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,i):this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:e,g:t,b:i}=this.color;this._color4.set(e,t,i,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_isShaderMaterial(e){return"ShaderMaterial"===e.getClassName()}clone(t,i=null,a){return new e(t,this.getScene(),i,this,a)}async _initShaderSourceAsync(t){this.getScene().getEngine().isWebGPU&&!e.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(init_color_vertex(),color_vertex_exports))),Promise.resolve().then((()=>(init_color_fragment(),color_fragment_exports)))])):await Promise.all([Promise.resolve().then((()=>(init_color_vertex2(),color_vertex_exports2))),Promise.resolve().then((()=>(init_color_fragment2(),color_fragment_exports2)))]),this._shadersLoaded=!0,t.shaderLanguage=this._shaderLanguage,this.material=new ShaderMaterial("colorShader",this.getScene(),"color",t,!1),this.material.doNotSerialize=!0}get material(){return this._lineMaterial}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const a=this.getScene().getEngine();return this._unIndexed?a.drawArraysType(Material.LineListDrawMode,e.verticesStart,e.verticesCount,i):a.drawElementsType(Material.LineListDrawMode,e.indexStart,e.indexCount,i),this}isReady(){return!!this._shadersLoaded&&(!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady())}};LinesMesh.ForceGLSL=!1;var InstancedLinesMesh=class extends InstancedMesh{getClassName(){return"InstancedLinesMesh"}constructor(e,t){super(e,t),this.intersectionThreshold=t.intersectionThreshold}};function CreateLineSystemVertexData(e){const t=[],i=[],a=e.lines,n=e.colors,s=[];let r=0;for(let e=0;e<a.length;e++){const o=a[e];for(let a=0;a<o.length;a++){const{x:l,y:c,z:h}=o[a];if(i.push(l,c,h),n){const t=n[e],{r:i,g:r,b:o,a:l}=t[a];s.push(i,r,o,l)}a>0&&(t.push(r-1),t.push(r)),r++}}const o=new VertexData;return o.indices=t,o.positions=i,n&&(o.colors=s),o}function CreateDashedLinesVertexData(e){const t=e.dashSize||3,i=e.gapSize||1,a=e.dashNb||200,n=e.points,s=[],r=[],o=Vector3.Zero();let l=0,c=0,h=0,u=0,m=0,d=0,f=0;for(f=0;f<n.length-1;f++)n[f+1].subtractToRef(n[f],o),l+=o.length();for(h=l/a,u=t*h/(t+i),f=0;f<n.length-1;f++){n[f+1].subtractToRef(n[f],o),c=Math.floor(o.length()/h),o.normalize();for(let e=0;e<c;e++)m=h*e,s.push(n[f].x+m*o.x,n[f].y+m*o.y,n[f].z+m*o.z),s.push(n[f].x+(m+u)*o.x,n[f].y+(m+u)*o.y,n[f].z+(m+u)*o.z),r.push(d,d+1),d+=2}const p=new VertexData;return p.positions=s,p.indices=r,p}function CreateLineSystem(e,t,i=null){const a=t.instance,n=t.lines,s=t.colors;if(a){const e=a.getVerticesData(VertexBuffer.PositionKind);let t,i;s&&(t=a.getVerticesData(VertexBuffer.ColorKind));let r=0,o=0;for(let a=0;a<n.length;a++){const l=n[a];for(let n=0;n<l.length;n++)e[r]=l[n].x,e[r+1]=l[n].y,e[r+2]=l[n].z,s&&t&&(i=s[a],t[o]=i[n].r,t[o+1]=i[n].g,t[o+2]=i[n].b,t[o+3]=i[n].a,o+=4),r+=3}return a.updateVerticesData(VertexBuffer.PositionKind,e,!1,!1),s&&t&&a.updateVerticesData(VertexBuffer.ColorKind,t,!1,!1),a.refreshBoundingInfo(),a}const r=new LinesMesh(e,i,null,void 0,void 0,!!s,t.useVertexAlpha,t.material);return CreateLineSystemVertexData(t).applyToMesh(r,t.updatable),r}function CreateLines(e,t,i=null){const a=t.colors?[t.colors]:null;return CreateLineSystem(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:a,useVertexAlpha:t.useVertexAlpha,material:t.material},i)}function CreateDashedLines(e,t,i=null){const a=t.points,n=t.instance,s=t.gapSize||1,r=t.dashSize||3;if(n){const e=e=>{const t=Vector3.Zero(),i=e.length/6;let s=0,r=0,o=0,l=0,c=0,h=0,u=0,m=0;for(u=0;u<a.length-1;u++)a[u+1].subtractToRef(a[u],t),s+=t.length();o=s/i;const d=n._creationDataStorage.dashSize;for(l=d*o/(d+n._creationDataStorage.gapSize),u=0;u<a.length-1;u++)for(a[u+1].subtractToRef(a[u],t),r=Math.floor(t.length()/o),t.normalize(),m=0;m<r&&h<e.length;)c=o*m,e[h]=a[u].x+c*t.x,e[h+1]=a[u].y+c*t.y,e[h+2]=a[u].z+c*t.z,e[h+3]=a[u].x+(c+l)*t.x,e[h+4]=a[u].y+(c+l)*t.y,e[h+5]=a[u].z+(c+l)*t.z,h+=6,m++;for(;h<e.length;)e[h]=a[u].x,e[h+1]=a[u].y,e[h+2]=a[u].z,h+=3};return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&Logger.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),n.updateMeshPositions(e,!1),n}const o=new LinesMesh(e,i,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return CreateDashedLinesVertexData(t).applyToMesh(o,t.updatable),o._creationDataStorage=new _CreationDataStorage,o._creationDataStorage.dashSize=r,o._creationDataStorage.gapSize=s,o}VertexData.CreateLineSystem=CreateLineSystemVertexData,VertexData.CreateDashedLines=CreateDashedLinesVertexData,Mesh.lb=(e,t,i=null,a=!1,n=null)=>CreateLines(e,{points:t,updatable:a,instance:n},i),Mesh.CreateDashedLines=(e,t,i,a,n,s=null,r,o)=>CreateDashedLines(e,{points:t,dashSize:i,gapSize:a,dashNb:n,updatable:r,instance:o},s);var IndexedVector2=class extends Vector2{constructor(e,t){super(e.x,e.y),this.index=t}},PolygonPoints=class{constructor(){this.elements=[]}add(e){const t=[];return e.forEach((e=>{const i=new IndexedVector2(e,this.elements.length);t.push(i),this.elements.push(i)})),t}computeBounds(){const e=new Vector2(this.elements[0].x,this.elements[0].y),t=new Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach((i=>{i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)})),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}}},PolygonMeshBuilder=class{build(e=!1,t=0,i=2){const a=new Mesh(this._name,this._scene),n=this.buildVertexData(t,i);return a.setVerticesData(VertexBuffer.PositionKind,n.positions,e),a.setVerticesData(VertexBuffer.NormalKind,n.normals,e),a.setVerticesData(VertexBuffer.UVKind,n.uvs,e),a.setIndices(n.indices),a}buildVertexData(e=0,t=2){const i=new VertexData,a=[],n=[],s=[],r=this._points.computeBounds();this._points.elements.forEach((e=>{a.push(0,1,0),n.push(e.x,0,e.y),s.push((e.x-r.min.x)/r.width,(e.y-r.min.y)/r.height)}));const o=[],l=this.bjsEarcut(this._epoints,this._eholes,2);for(let e=0;e<l.length;e++)o.push(l[e]);if(e>0){const i=n.length/3;this._points.elements.forEach((t=>{a.push(0,-1,0),n.push(t.x,-e,t.y),s.push(1-(t.x-r.min.x)/r.width,1-(t.y-r.min.y)/r.height)}));const l=o.length;for(let e=0;e<l;e+=3){const t=o[e+0],a=o[e+1],n=o[e+2];o.push(n+i),o.push(a+i),o.push(t+i)}this._addSide(n,a,s,o,r,this._outlinepoints,e,!1,t),this._holes.forEach((i=>{this._addSide(n,a,s,o,r,i,e,!0,t)}))}return i.indices=o,i.positions=n,i.normals=a,i.uvs=s,i}constructor(e,t,i,a=earcut){let n;this._points=new PolygonPoints,this._outlinepoints=new PolygonPoints,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=a,this._name=e,this._scene=i||EngineStore.LastCreatedScene,n=t instanceof Path2?t.getPoints():t,this._addToepoint(n),this._points.add(n),this._outlinepoints.add(n),void 0===this.bjsEarcut&&Logger.Warn("Earcut was not found, the polygon will not be built.")}_addSide(e,t,i,a,n,s,r,o,l){let c=e.length/3,h=0;for(let u=0;u<s.elements.length;u++){const m=s.elements[u],d=s.elements[(u+1)%s.elements.length];e.push(m.x,0,m.y),e.push(m.x,-r,m.y),e.push(d.x,0,d.y),e.push(d.x,-r,d.y);const f=s.elements[(u+s.elements.length-1)%s.elements.length],p=s.elements[(u+2)%s.elements.length];let _=new Vector3(-(d.y-m.y),0,d.x-m.x),g=new Vector3(-(m.y-f.y),0,m.x-f.x),v=new Vector3(-(p.y-d.y),0,p.x-d.x);o||(_=_.scale(-1),g=g.scale(-1),v=v.scale(-1));const y=_.normalizeToNew();let S=g.normalizeToNew(),C=v.normalizeToNew();const E=Vector3.Dot(S,y);S=E>l?E<Epsilon-1?new Vector3(m.x,0,m.y).subtract(new Vector3(d.x,0,d.y)).normalize():g.add(_).normalize():y;const A=Vector3.Dot(v,_);C=A>l?A<Epsilon-1?new Vector3(d.x,0,d.y).subtract(new Vector3(m.x,0,m.y)).normalize():v.add(_).normalize():y,i.push(h/n.width,0),i.push(h/n.width,1),h+=_.length(),i.push(h/n.width,0),i.push(h/n.width,1),t.push(S.x,S.y,S.z),t.push(S.x,S.y,S.z),t.push(C.x,C.y,C.z),t.push(C.x,C.y,C.z),o?(a.push(c),a.push(c+2),a.push(c+1),a.push(c+1),a.push(c+2),a.push(c+3)):(a.push(c),a.push(c+1),a.push(c+2),a.push(c+1),a.push(c+3),a.push(c+2)),c+=4}}_addToepoint(e){for(const t of e)this._epoints.push(t.x,t.y)}addHole(e){this._points.add(e);const t=new PolygonPoints;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this}};function CreatePolygonVertexData(e,t,i,a,n,s,r){const o=i||new Array(3),l=a,c=[],h=r||!1;for(let e=0;e<3;e++)void 0===o[e]&&(o[e]=new Vector4(0,0,1,1)),l&&void 0===l[e]&&(l[e]=new Color4(1,1,1,1));const u=e.getVerticesData(VertexBuffer.PositionKind),m=e.getVerticesData(VertexBuffer.NormalKind),d=e.getVerticesData(VertexBuffer.UVKind),f=e.getIndices(),p=u.length/9;let _=0,g=0,v=0,y=0,S=0;const C=[0];if(h)for(let e=p;e<u.length/3;e+=4)g=u[3*(e+2)]-u[3*e],v=u[3*(e+2)+2]-u[3*e+2],y=Math.sqrt(g*g+v*v),S+=y,C.push(S);let E=0,A=0;for(let e=0;e<m.length;e+=3)Math.abs(m[e+1])<.001&&(A=1),Math.abs(m[e+1]-1)<.001&&(A=0),Math.abs(m[e+1]+1)<.001&&(A=2),E=e/3,1===A?(_=E-p,d[2*E]=_%4<1.5?h?o[A].x+(o[A].z-o[A].x)*C[Math.floor(_/4)]/S:o[A].x:h?o[A].x+(o[A].z-o[A].x)*C[Math.floor(_/4)+1]/S:o[A].z,d[2*E+1]=_%2==0?useOpenGLOrientationForUV?1-o[A].w:o[A].w:useOpenGLOrientationForUV?1-o[A].y:o[A].y):(d[2*E]=(1-d[2*E])*o[A].x+d[2*E]*o[A].z,d[2*E+1]=(1-d[2*E+1])*o[A].y+d[2*E+1]*o[A].w,useOpenGLOrientationForUV&&(d[2*E+1]=1-d[2*E+1])),l&&c.push(l[A].r,l[A].g,l[A].b,l[A].a);VertexData._ComputeSides(t,u,f,m,d,n,s);const T=new VertexData;if(T.indices=f,T.positions=u,T.normals=m,T.uvs=d,l){const e=t===VertexData.DOUBLESIDE?c.concat(c):c;T.colors=e}return T}function CreatePolygon(e,t,i=null,a=earcut){t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation);const n=t.shape,s=t.holes||[],r=t.depth||0,o=t.smoothingThreshold||2,l=[];let c=[];for(let e=0;e<n.length;e++)l[e]=new Vector2(n[e].x,n[e].z);l[0].equalsWithEpsilon(l[l.length-1],1e-8)&&l.pop();const h=new PolygonMeshBuilder(e,l,i||EngineStore.LastCreatedScene,a);for(let e=0;e<s.length;e++){c=[];for(let t=0;t<s[e].length;t++)c.push(new Vector2(s[e][t].x,s[e][t].z));h.addHole(c)}const u=h.build(!1,r,o);u._originalBuilderSideOrientation=t.sideOrientation;return CreatePolygonVertexData(u,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).applyToMesh(u,t.updatable),u}function ExtrudePolygon(e,t,i=null,a=earcut){return CreatePolygon(e,t,i,a)}function ExtrudeShape(e,t,i=null){const a=t.path,n=t.shape,s=t.scale||1,r=t.rotation||0,o=0===t.cap?0:t.cap||Mesh.NO_CAP,l=t.updatable,c=Mesh._GetDefaultSideOrientation(t.sideOrientation),h=t.instance||null,u=t.invertUV||!1,m=t.closeShape||!1;return _ExtrudeShapeGeneric(e,n,a,s,r,null,null,t.closePath||!1,m,o,!1,i,!!l,c,h,u,t.frontUVs||null,t.backUVs||null,t.firstNormal||null,!!t.adjustFrame)}function ExtrudeShapeCustom(e,t,i=null){const a=t.path,n=t.shape,s=t.scaleFunction||(()=>1),r=t.rotationFunction||(()=>0),o=t.closePath||t.ribbonCloseArray||!1,l=t.closeShape||t.ribbonClosePath||!1,c=0===t.cap?0:t.cap||Mesh.NO_CAP,h=t.updatable,u=t.firstNormal||null,m=t.adjustFrame||!1;return _ExtrudeShapeGeneric(e,n,a,null,null,s,r,o,l,c,!0,i,!!h,Mesh._GetDefaultSideOrientation(t.sideOrientation),t.instance||null,t.invertUV||!1,t.frontUVs||null,t.backUVs||null,u,m)}function _ExtrudeShapeGeneric(e,t,i,a,n,s,r,o,l,c,h,u,m,d,f,p,_,g,v,y){const S=(e,t,i,a,n,s,r,o,l,c,h)=>{const u=i.getTangents(),m=i.getNormals(),d=i.getBinormals(),f=i.getDistances();if(h)for(let e=0;e<u.length;e++)if(0==u[e].x&&0==u[e].y&&0==u[e].z&&u[e].copyFrom(u[e-1]),0==m[e].x&&0==m[e].y&&0==m[e].z&&m[e].copyFrom(m[e-1]),0==d[e].x&&0==d[e].y&&0==d[e].z&&d[e].copyFrom(d[e-1]),e>0){let t=u[e-1];Vector3.Dot(t,u[e])<0&&u[e].scaleInPlace(-1),t=m[e-1],Vector3.Dot(t,m[e])<0&&m[e].scaleInPlace(-1),t=d[e-1],Vector3.Dot(t,d[e])<0&&d[e].scaleInPlace(-1)}let p=0;const _=c&&o?o:()=>null!==s?s:0,g=c&&r?r:()=>null!==n?n:1;let v=l===Mesh.NO_CAP||l===Mesh.CAP_END?0:2;const y=TmpVectors.Matrix[0];for(let i=0;i<t.length;i++){const n=[],s=_(i,f[i]),r=g(i,f[i]);Matrix.RotationAxisToRef(u[i],p,y);for(let a=0;a<e.length;a++){const s=u[i].scale(e[a].z).add(m[i].scale(e[a].x)).add(d[i].scale(e[a].y)),o=Vector3.Zero();Vector3.TransformCoordinatesToRef(s,y,o),o.scaleInPlace(r).addInPlace(t[i]),n[a]=o}a[v]=n,p+=s,v++}const S=e=>{const t=Array(),i=Vector3.Zero();let a;for(a=0;a<e.length;a++)i.addInPlace(e[a]);for(i.scaleInPlace(1/e.length),a=0;a<e.length;a++)t.push(i);return t};switch(l){case Mesh.NO_CAP:break;case Mesh.CAP_START:a[0]=S(a[2]),a[1]=a[2];break;case Mesh.CAP_END:a[v]=a[v-1],a[v+1]=S(a[v-1]);break;case Mesh.CAP_ALL:a[0]=S(a[2]),a[1]=a[2],a[v]=a[v-1],a[v+1]=S(a[v-1])}return a};let C,E;if(f){const e=f._creationDataStorage;return C=v?e.path3D.update(i,v):e.path3D.update(i),E=S(t,i,e.path3D,e.pathArray,a,n,s,r,e.cap,h,y),f=CreateRibbon("",{pathArray:E,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:f},u||void 0)}C=v?new Path3D(i,v):new Path3D(i);E=S(t,i,C,new Array,a,n,s,r,c=c<0||c>3?0:c,h,y);const A=CreateRibbon(e,{pathArray:E,closeArray:o,closePath:l,updatable:m,sideOrientation:d,invertUV:p,frontUVs:_||void 0,backUVs:g||void 0},u);return A._creationDataStorage.pathArray=E,A._creationDataStorage.path3D=C,A._creationDataStorage.cap=c,A}function CreateLathe(e,t,i=null){const a=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,n=void 0===t.closed||t.closed,s=t.shape,r=t.radius||1,o=t.tessellation||64,l=t.clip||0,c=t.updatable,h=Mesh._GetDefaultSideOrientation(t.sideOrientation),u=t.cap||Mesh.NO_CAP,m=2*Math.PI,d=[],f=t.invertUV||!1;let p=0,_=0;const g=m/o*a;let v,y;for(p=0;p<=o-l;p++){for(y=[],u!=Mesh.CAP_START&&u!=Mesh.CAP_ALL||(y.push(new Vector3(0,s[0].y,0)),y.push(new Vector3(Math.cos(p*g)*s[0].x*r,s[0].y,Math.sin(p*g)*s[0].x*r))),_=0;_<s.length;_++)v=new Vector3(Math.cos(p*g)*s[_].x*r,s[_].y,Math.sin(p*g)*s[_].x*r),y.push(v);u!=Mesh.CAP_END&&u!=Mesh.CAP_ALL||(y.push(new Vector3(Math.cos(p*g)*s[s.length-1].x*r,s[s.length-1].y,Math.sin(p*g)*s[s.length-1].x*r)),y.push(new Vector3(0,s[s.length-1].y,0))),d.push(y)}return CreateRibbon(e,{pathArray:d,closeArray:n,sideOrientation:h,updatable:c,invertUV:f,frontUVs:t.frontUVs,backUVs:t.backUVs},i)}function CreatePlaneVertexData(e){const t=[],i=[],a=[],n=[],s=e.width||e.size||1,r=e.height||e.size||1,o=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,l=s/2,c=r/2;i.push(-l,-c,0),a.push(0,0,-1),n.push(0,useOpenGLOrientationForUV?1:0),i.push(l,-c,0),a.push(0,0,-1),n.push(1,useOpenGLOrientationForUV?1:0),i.push(l,c,0),a.push(0,0,-1),n.push(1,useOpenGLOrientationForUV?0:1),i.push(-l,c,0),a.push(0,0,-1),n.push(0,useOpenGLOrientationForUV?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),VertexData._ComputeSides(o,i,t,a,n,e.frontUVs,e.backUVs);const h=new VertexData;return h.indices=t,h.positions=i,h.normals=a,h.uvs=n,h}function CreatePlane(e,t={},i=null){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreatePlaneVertexData(t).applyToMesh(a,t.updatable),t.sourcePlane&&(a.translate(t.sourcePlane.normal,-t.sourcePlane.d),a.setDirection(t.sourcePlane.normal.scale(-1))),a}function CreateTube(e,t,i=null){const a=t.path;let n=t.instance,s=1;void 0!==t.radius?s=t.radius:n&&(s=n._creationDataStorage.radius);const r=t.tessellation||64,o=t.radiusFunction||null;let l=t.cap||Mesh.NO_CAP;const c=t.invertUV||!1,h=t.updatable,u=Mesh._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;const m=(e,t,i,a,n,s,r,o)=>{const l=t.getTangents(),c=t.getNormals(),h=t.getDistances(),u=2*Math.PI/n*o,m=s||(()=>a);let d,f,p,_;const g=TmpVectors.Matrix[0];let v=r===Mesh.NO_CAP||r===Mesh.CAP_END?0:2;for(let t=0;t<e.length;t++){f=m(t,h[t]),d=Array(),p=c[t];for(let i=0;i<n;i++)Matrix.RotationAxisToRef(l[t],u*i,g),_=d[i]?d[i]:Vector3.Zero(),Vector3.TransformCoordinatesToRef(p,g,_),_.scaleInPlace(f).addInPlace(e[t]),d[i]=_;i[v]=d,v++}const y=(t,i)=>{const a=Array();for(let n=0;n<t;n++)a.push(e[i]);return a};switch(r){case Mesh.NO_CAP:break;case Mesh.CAP_START:i[0]=y(n,0),i[1]=i[2].slice(0);break;case Mesh.CAP_END:i[v]=i[v-1].slice(0),i[v+1]=y(n,e.length-1);break;case Mesh.CAP_ALL:i[0]=y(n,0),i[1]=i[2].slice(0),i[v]=i[v-1].slice(0),i[v+1]=y(n,e.length-1)}return i};let d,f;if(n){const e=n._creationDataStorage,i=t.arc||e.arc;return d=e.path3D.update(a),f=m(a,d,e.pathArray,s,e.tessellation,o,e.cap,i),n=CreateRibbon("",{pathArray:f,instance:n}),e.path3D=d,e.pathArray=f,e.arc=i,e.radius=s,n}d=new Path3D(a);l=l<0||l>3?0:l,f=m(a,d,new Array,s,r,o,l,t.arc);const p=CreateRibbon(e,{pathArray:f,closePath:!0,closeArray:!1,updatable:h,sideOrientation:u,invertUV:c,frontUVs:t.frontUVs,backUVs:t.backUVs},i);return p._creationDataStorage.pathArray=f,p._creationDataStorage.path3D=d,p._creationDataStorage.tessellation=r,p._creationDataStorage.cap=l,p._creationDataStorage.arc=t.arc,p._creationDataStorage.radius=s,p}function CreatePolyhedronVertexData(e){const t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const i=e.type&&(e.type<0||e.type>=t.length)?0:e.type||0,a=e.size,n=e.sizeX||a||1,s=e.sizeY||a||1,r=e.sizeZ||a||1,o=e.custom||t[i],l=o.face.length,c=e.faceUV||new Array(l),h=e.faceColors,u=void 0===e.flat||e.flat,m=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,d=[],f=[],p=[],_=[],g=[];let v=0,y=0;const S=[];let C,E,A,T,M,x,b=0,w=0;if(u)for(w=0;w<l;w++)h&&void 0===h[w]&&(h[w]=new Color4(1,1,1,1)),c&&void 0===c[w]&&(c[w]=new Vector4(0,0,1,1));if(u)for(w=0;w<l;w++){const e=o.face[w].length;for(A=2*Math.PI/e,T=.5*Math.tan(A/2),M=.5,b=0;b<e;b++)d.push(o.vertex[o.face[w][b]][0]*n,o.vertex[o.face[w][b]][1]*s,o.vertex[o.face[w][b]][2]*r),S.push(v),v++,C=c[w].x+(c[w].z-c[w].x)*(.5+T),E=c[w].y+(c[w].w-c[w].y)*(M-.5),_.push(C,useOpenGLOrientationForUV?1-E:E),x=T*Math.cos(A)-M*Math.sin(A),M=T*Math.sin(A)+M*Math.cos(A),T=x,h&&g.push(h[w].r,h[w].g,h[w].b,h[w].a);for(b=0;b<e-2;b++)f.push(S[0+y],S[b+2+y],S[b+1+y]);y+=e}else{for(b=0;b<o.vertex.length;b++)d.push(o.vertex[b][0]*n,o.vertex[b][1]*s,o.vertex[b][2]*r),_.push(0,useOpenGLOrientationForUV?1:0);for(w=0;w<l;w++)for(b=0;b<o.face[w].length-2;b++)f.push(o.face[w][0],o.face[w][b+2],o.face[w][b+1])}VertexData.ComputeNormals(d,f,p),VertexData._ComputeSides(m,d,f,p,_,e.frontUVs,e.backUVs);const I=new VertexData;return I.positions=d,I.indices=f,I.normals=p,I.uvs=_,h&&u&&(I.colors=g),I}function CreatePolyhedron(e,t={},i=null){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreatePolyhedronVertexData(t).applyToMesh(a,t.updatable),a}function CreateIcoSphereVertexData(e){const t=e.sideOrientation||VertexData.DEFAULTSIDE,i=e.radius||1,a=void 0===e.flat||e.flat,n=0|(e.subdivisions||4),s=e.radiusX||i,r=e.radiusY||i,o=e.radiusZ||i,l=(1+Math.sqrt(5))/2,c=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],h=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],m=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],d=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],f=[],p=[],_=[],g=[];let v=0;const y=new Array(3),S=new Array(3);let C;for(C=0;C<3;C++)y[C]=Vector3.Zero(),S[C]=Vector2.Zero();for(let e=0;e<20;e++){for(C=0;C<3;C++){const t=h[3*e+C];y[C].copyFromFloats(c[3*u[t]],c[3*u[t]+1],c[3*u[t]+2]),y[C].normalize(),S[C].copyFromFloats(.134765625*m[2*t]+.05859375+-.0390625*d[e],.2333984375*m[2*t+1]+.025390625+.01953125*d[e])}const t=(e,t,i,l)=>{const c=Vector3.Lerp(y[0],y[2],t/n),h=Vector3.Lerp(y[1],y[2],t/n),u=n===t?y[2]:Vector3.Lerp(c,h,e/(n-t));let m;if(u.normalize(),a){const e=Vector3.Lerp(y[0],y[2],l/n),t=Vector3.Lerp(y[1],y[2],l/n);m=Vector3.Lerp(e,t,i/(n-l))}else m=new Vector3(u.x,u.y,u.z);m.x/=s,m.y/=r,m.z/=o,m.normalize();const d=Vector2.Lerp(S[0],S[2],t/n),C=Vector2.Lerp(S[1],S[2],t/n),E=n===t?S[2]:Vector2.Lerp(d,C,e/(n-t));p.push(u.x*s,u.y*r,u.z*o),_.push(m.x,m.y,m.z),g.push(E.x,useOpenGLOrientationForUV?1-E.y:E.y),f.push(v),v++};for(let e=0;e<n;e++)for(let i=0;i+e<n;i++)t(i,e,i+1/3,e+1/3),t(i+1,e,i+1/3,e+1/3),t(i,e+1,i+1/3,e+1/3),i+e+1<n&&(t(i+1,e,i+2/3,e+2/3),t(i+1,e+1,i+2/3,e+2/3),t(i,e+1,i+2/3,e+2/3))}VertexData._ComputeSides(t,p,f,_,g,e.frontUVs,e.backUVs);const E=new VertexData;return E.indices=f,E.positions=p,E.normals=_,E.uvs=g,E}function CreateIcoSphere(e,t={},i=null){const a=new Mesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),a._originalBuilderSideOrientation=t.sideOrientation;return CreateIcoSphereVertexData(t).applyToMesh(a,t.updatable),a}VertexData.CreatePolygon=CreatePolygonVertexData,Mesh.CreatePolygon=(e,t,i,a,n,s,r=earcut)=>CreatePolygon(e,{shape:t,holes:a,updatable:n,sideOrientation:s},i,r),Mesh.ExtrudePolygon=(e,t,i,a,n,s,r,o=earcut)=>ExtrudePolygon(e,{shape:t,holes:n,depth:i,updatable:s,sideOrientation:r},a,o),Mesh.ExtrudeShape=(e,t,i,a,n,s,r=null,o,l,c)=>ExtrudeShape(e,{shape:t,path:i,scale:a,rotation:n,cap:0===s?0:s||Mesh.NO_CAP,sideOrientation:l,instance:c,updatable:o},r),Mesh.ExtrudeShapeCustom=(e,t,i,a,n,s,r,o,l,c,h,u)=>ExtrudeShapeCustom(e,{shape:t,path:i,scaleFunction:a,rotationFunction:n,ribbonCloseArray:s,ribbonClosePath:r,cap:0===o?0:o||Mesh.NO_CAP,sideOrientation:h,instance:u,updatable:c},l),Mesh.xb=(e,t,i,a,n,s,r)=>CreateLathe(e,{shape:t,radius:i,tessellation:a,sideOrientation:r,updatable:s},n),VertexData.Nc=CreatePlaneVertexData,Mesh.Nc=(e,t,i,a,n)=>CreatePlane(e,{size:t,width:t,height:t,sideOrientation:n,updatable:a},i),Mesh.CreateTube=(e,t,i,a,n,s,r,o,l,c)=>CreateTube(e,{path:t,radius:i,tessellation:a,radiusFunction:n,arc:1,cap:s,updatable:o,sideOrientation:l,instance:c},r),VertexData.CreatePolyhedron=CreatePolyhedronVertexData,Mesh.CreatePolyhedron=(e,t,i)=>CreatePolyhedron(e,t,i),VertexData.CreateIcoSphere=CreateIcoSphereVertexData,Mesh.CreateIcoSphere=(e,t,i)=>CreateIcoSphere(e,t,i);var xpAxis=new Vector3(1,0,0),xnAxis=new Vector3(-1,0,0),ypAxis=new Vector3(0,1,0),ynAxis=new Vector3(0,-1,0),zpAxis=new Vector3(0,0,1),znAxis=new Vector3(0,0,-1),DecalVertex=class e{constructor(e=Vector3.Zero(),t=Vector3.Up(),i=Vector2.Zero(),a=0,n=0,s=null,r=null,o=null,l=null){this.position=e,this.normal=t,this.uv=i,this.vertexIdx=a,this.vertexIdxForBones=n,this.localPositionOverride=s,this.localNormalOverride=r,this.matrixIndicesOverride=o,this.matrixWeightsOverride=l}clone(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,this.localPositionOverride?.slice(),this.localNormalOverride?.slice(),this.matrixIndicesOverride?.slice(),this.matrixWeightsOverride?.slice())}};function CreateDecal(e,t,i){const a=!!t.skeleton,n=i.localMode||a,s=t.getIndices(),r=a?t.getPositionData(!0,!0):t.getVerticesData(VertexBuffer.PositionKind),o=a?t.getNormalsData(!0,!0):t.getVerticesData(VertexBuffer.NormalKind),l=n?a?t.getVerticesData(VertexBuffer.PositionKind):r:null,c=n?a?t.getVerticesData(VertexBuffer.NormalKind):o:null,h=t.getVerticesData(VertexBuffer.UVKind),u=a?t.getVerticesData(VertexBuffer.MatricesIndicesKind):null,m=a?t.getVerticesData(VertexBuffer.MatricesWeightsKind):null,d=a?t.getVerticesData(VertexBuffer.MatricesIndicesExtraKind):null,f=a?t.getVerticesData(VertexBuffer.MatricesWeightsExtraKind):null,p=i.position||Vector3.Zero();let _=i.normal||Vector3.Up();const g=i.size||Vector3.One(),v=i.angle||0;if(!_){const e=new Vector3(0,0,1),i=t.getScene().activeCamera,a=Vector3.TransformCoordinates(e,i.getWorldMatrix());_=i.globalPosition.subtract(a)}const y=-Math.atan2(_.z,_.x)-Math.PI/2,S=Math.sqrt(_.x*_.x+_.z*_.z),C=Math.atan2(_.y,S),E=new VertexData;E.indices=[],E.positions=[],E.normals=[],E.uvs=[],E.matricesIndices=a?[]:null,E.matricesWeights=a?[]:null,E.matricesIndicesExtra=d?[]:null,E.matricesWeightsExtra=f?[]:null;let A=0;const T=(e,t)=>{const a=new DecalVertex;if(!s||!r||!o)return a;const n=s[e];if(a.vertexIdx=3*n,a.vertexIdxForBones=4*n,a.position=new Vector3(r[3*n],r[3*n+1],r[3*n+2]),Vector3.TransformCoordinatesToRef(a.position,t,a.position),a.normal=new Vector3(o[3*n],o[3*n+1],o[3*n+2]),Vector3.TransformNormalToRef(a.normal,t,a.normal),i.captureUVS&&h){const e=h[2*n+1];a.uv=new Vector2(h[2*n],useOpenGLOrientationForUV?1-e:e)}return a},M=[0,0,0,0],x=(e,t)=>{if(0===e.length)return e;const i=.5*Math.abs(Vector3.Dot(g,t)),a=(e,t,i,a)=>{for(let n=0;n<a;++n)if(e[i+n]===t)return i+n;return-1},n=(e,n)=>{const s=Vector3.GetClipFactor(e.position,n.position,t,i);let r=M,o=M;if(u&&m){const t=e.matrixIndicesOverride?0:e.vertexIdxForBones,i=e.matrixIndicesOverride??u,l=e.matrixWeightsOverride??m,c=n.matrixIndicesOverride?0:n.vertexIdxForBones,h=n.matrixIndicesOverride??u,d=n.matrixWeightsOverride??m;r=[0,0,0,0],o=[0,0,0,0];let f=0;for(let e=0;e<4;++e)if(l[t+e]>0){const n=a(h,i[t+e],c,4);r[f]=i[t+e],o[f]=Scalar.Lerp(l[t+e],n>=0?d[n]:0,s),f++}for(let e=0;e<4&&f<4;++e){const n=h[c+e];-1===a(i,n,t,4)&&(r[f]=n,o[f]=Scalar.Lerp(0,d[c+e],s),f++)}const p=o[0]+o[1]+o[2]+o[3];o[0]/=p,o[1]/=p,o[2]/=p,o[3]/=p}const h=e.localPositionOverride?e.localPositionOverride[0]:l?.[e.vertexIdx]??0,d=e.localPositionOverride?e.localPositionOverride[1]:l?.[e.vertexIdx+1]??0,f=e.localPositionOverride?e.localPositionOverride[2]:l?.[e.vertexIdx+2]??0,p=n.localPositionOverride?n.localPositionOverride[0]:l?.[n.vertexIdx]??0,_=n.localPositionOverride?n.localPositionOverride[1]:l?.[n.vertexIdx+1]??0,g=n.localPositionOverride?n.localPositionOverride[2]:l?.[n.vertexIdx+2]??0,v=e.localNormalOverride?e.localNormalOverride[0]:c?.[e.vertexIdx]??0,y=e.localNormalOverride?e.localNormalOverride[1]:c?.[e.vertexIdx+1]??0,S=e.localNormalOverride?e.localNormalOverride[2]:c?.[e.vertexIdx+2]??0,C=v+((n.localNormalOverride?n.localNormalOverride[0]:c?.[n.vertexIdx]??0)-v)*s,E=y+((n.localNormalOverride?n.localNormalOverride[1]:c?.[n.vertexIdx+1]??0)-y)*s,A=S+((n.localNormalOverride?n.localNormalOverride[2]:c?.[n.vertexIdx+2]??0)-S)*s,T=Math.sqrt(C*C+E*E+A*A);return new DecalVertex(Vector3.Lerp(e.position,n.position,s),Vector3.Lerp(e.normal,n.normal,s).normalize(),Vector2.Lerp(e.uv,n.uv,s),-1,-1,l?[h+(p-h)*s,d+(_-d)*s,f+(g-f)*s]:null,c?[C/T,E/T,A/T]:null,r,o)};let s=null;e.length>3&&(s=[]);for(let a=0;a<e.length;a+=3){let r=0,o=null,l=null,c=null,h=null;const u=Vector3.Dot(e[a].position,t)-i>0,m=Vector3.Dot(e[a+1].position,t)-i>0,d=Vector3.Dot(e[a+2].position,t)-i>0;switch(r=(u?1:0)+(m?1:0)+(d?1:0),r){case 0:e.length>3?(s.push(e[a]),s.push(e[a+1]),s.push(e[a+2])):s=e;break;case 1:if(s=s??new Array,u&&(o=e[a+1],l=e[a+2],c=n(e[a],o),h=n(e[a],l)),m){o=e[a],l=e[a+2],c=n(e[a+1],o),h=n(e[a+1],l),s.push(c),s.push(l.clone()),s.push(o.clone()),s.push(l.clone()),s.push(c.clone()),s.push(h);break}d&&(o=e[a],l=e[a+1],c=n(e[a+2],o),h=n(e[a+2],l)),o&&l&&c&&h&&(s.push(o.clone()),s.push(l.clone()),s.push(c),s.push(h),s.push(c.clone()),s.push(l.clone()));break;case 2:s=s??new Array,u||(o=e[a].clone(),l=n(o,e[a+1]),c=n(o,e[a+2]),s.push(o),s.push(l),s.push(c)),m||(o=e[a+1].clone(),l=n(o,e[a+2]),c=n(o,e[a]),s.push(o),s.push(l),s.push(c)),d||(o=e[a+2].clone(),l=n(o,e[a]),c=n(o,e[a+1]),s.push(o),s.push(l),s.push(c))}}return s},b=t instanceof Mesh?t:null,w=b?._thinInstanceDataStorage.matrixData,I=b?.thinInstanceCount||1,P=TmpVectors.Matrix[0];P.copyFrom(Matrix.IdentityReadOnly);for(let e=0;e<I;++e){if(b?.hasThinInstances&&w){const t=16*e;P.setRowFromFloats(0,w[t+0],w[t+1],w[t+2],w[t+3]),P.setRowFromFloats(1,w[t+4],w[t+5],w[t+6],w[t+7]),P.setRowFromFloats(2,w[t+8],w[t+9],w[t+10],w[t+11]),P.setRowFromFloats(3,w[t+12],w[t+13],w[t+14],w[t+15])}const a=Matrix.Kc(y,C,v).multiply(Matrix.Translation(p.x,p.y,p.z)),r=Matrix.Invert(a),o=t.getWorldMatrix(),h=P.multiply(o).multiply(r),_=new Array(3);for(let e=0;e<s.length;e+=3){let t=_;if(t[0]=T(e,h),t[1]=T(e+1,h),t[2]=T(e+2,h),!(i.cullBackFaces&&-t[0].normal.z<=0&&-t[1].normal.z<=0&&-t[2].normal.z<=0)&&(t=x(t,xpAxis),t&&(t=x(t,xnAxis),t&&(t=x(t,ypAxis),t&&(t=x(t,ynAxis),t&&(t=x(t,zpAxis),t&&(t=x(t,znAxis),t)))))))for(let e=0;e<t.length;e++){const a=t[e];if(E.indices.push(A),n?(a.localPositionOverride?(E.positions[3*A]=a.localPositionOverride[0],E.positions[3*A+1]=a.localPositionOverride[1],E.positions[3*A+2]=a.localPositionOverride[2]):l&&(E.positions[3*A]=l[a.vertexIdx],E.positions[3*A+1]=l[a.vertexIdx+1],E.positions[3*A+2]=l[a.vertexIdx+2]),a.localNormalOverride?(E.normals[3*A]=a.localNormalOverride[0],E.normals[3*A+1]=a.localNormalOverride[1],E.normals[3*A+2]=a.localNormalOverride[2]):c&&(E.normals[3*A]=c[a.vertexIdx],E.normals[3*A+1]=c[a.vertexIdx+1],E.normals[3*A+2]=c[a.vertexIdx+2])):(a.position.toArray(E.positions,3*A),a.normal.toArray(E.normals,3*A)),E.matricesIndices&&E.matricesWeights&&(a.matrixIndicesOverride?(E.matricesIndices[4*A]=a.matrixIndicesOverride[0],E.matricesIndices[4*A+1]=a.matrixIndicesOverride[1],E.matricesIndices[4*A+2]=a.matrixIndicesOverride[2],E.matricesIndices[4*A+3]=a.matrixIndicesOverride[3]):(u&&(E.matricesIndices[4*A]=u[a.vertexIdxForBones],E.matricesIndices[4*A+1]=u[a.vertexIdxForBones+1],E.matricesIndices[4*A+2]=u[a.vertexIdxForBones+2],E.matricesIndices[4*A+3]=u[a.vertexIdxForBones+3]),d&&E.matricesIndicesExtra&&(E.matricesIndicesExtra[4*A]=d[a.vertexIdxForBones],E.matricesIndicesExtra[4*A+1]=d[a.vertexIdxForBones+1],E.matricesIndicesExtra[4*A+2]=d[a.vertexIdxForBones+2],E.matricesIndicesExtra[4*A+3]=d[a.vertexIdxForBones+3])),a.matrixWeightsOverride?(E.matricesWeights[4*A]=a.matrixWeightsOverride[0],E.matricesWeights[4*A+1]=a.matrixWeightsOverride[1],E.matricesWeights[4*A+2]=a.matrixWeightsOverride[2],E.matricesWeights[4*A+3]=a.matrixWeightsOverride[3]):(m&&(E.matricesWeights[4*A]=m[a.vertexIdxForBones],E.matricesWeights[4*A+1]=m[a.vertexIdxForBones+1],E.matricesWeights[4*A+2]=m[a.vertexIdxForBones+2],E.matricesWeights[4*A+3]=m[a.vertexIdxForBones+3]),f&&E.matricesWeightsExtra&&(E.matricesWeightsExtra[4*A]=f[a.vertexIdxForBones],E.matricesWeightsExtra[4*A+1]=f[a.vertexIdxForBones+1],E.matricesWeightsExtra[4*A+2]=f[a.vertexIdxForBones+2],E.matricesWeightsExtra[4*A+3]=f[a.vertexIdxForBones+3]))),i.captureUVS)a.uv.toArray(E.uvs,2*A);else{E.uvs.push(.5+a.position.x/g.x);const e=.5+a.position.y/g.y;E.uvs.push(useOpenGLOrientationForUV?1-e:e)}A++}}}0===E.indices.length&&(E.indices=null),0===E.positions.length&&(E.positions=null),0===E.normals.length&&(E.normals=null),0===E.uvs.length&&(E.uvs=null),0===E.matricesIndices?.length&&(E.matricesIndices=null),0===E.matricesWeights?.length&&(E.matricesWeights=null),0===E.matricesIndicesExtra?.length&&(E.matricesIndicesExtra=null),0===E.matricesWeightsExtra?.length&&(E.matricesWeightsExtra=null);const R=new Mesh(e,t.getScene());return E.applyToMesh(R),n?(R.skeleton=t.skeleton,R.parent=t):(R.position=p.clone(),R.rotation=new Vector3(C,y,v)),R.computeWorldMatrix(!0),R.refreshBoundingInfo(!0,!0),R}function CreateCapsuleVertexData(e={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){const t=0|Math.max(e.subdivisions?e.subdivisions:2,1),i=0|Math.max(e.tessellation?e.tessellation:16,3),a=Math.max(e.height?e.height:1,0),n=Math.max(e.radius?e.radius:.25,0),s=0|Math.max(e.capSubdivisions?e.capSubdivisions:6,1),r=i,o=t,l=Math.max(e.radiusTop?e.radiusTop:n,0),c=Math.max(e.radiusBottom?e.radiusBottom:n,0),h=a-(l+c),u=2*Math.PI,m=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:s,1),d=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:s,1),f=Math.acos((c-l)/a);let p=[];const _=[],g=[],v=[];let y=0;const S=[],C=.5*h,E=.5*Math.PI;let A,T;const M=Vector3.Zero(),x=Vector3.Zero(),b=Math.cos(f),w=Math.sin(f),I=new Vector2(l*w,C+l*b).subtract(new Vector2(c*w,c*b-C)).length(),P=l*f+I+c*(E-f);let R=0;for(T=0;T<=m;T++){const e=[],t=E-f*(T/m);R+=l*f/m;const i=Math.cos(t),a=Math.sin(t),n=i*l;for(A=0;A<=r;A++){const t=A/r,s=t*u+0,o=Math.sin(s),c=Math.cos(s);x.x=n*o,x.y=C+a*l,x.z=n*c,_.push(x.x,x.y,x.z),M.set(i*o,a,i*c),g.push(M.x,M.y,M.z),v.push(t,useOpenGLOrientationForUV?R/P:1-R/P),e.push(y),y++}S.push(e)}const N=a-l-c+b*l-b*c,k=w*(c-l)/N;for(T=1;T<=o;T++){const e=[];R+=I/o;const t=w*(T*(c-l)/o+l);for(A=0;A<=r;A++){const i=A/r,a=i*u+0,n=Math.sin(a),s=Math.cos(a);x.x=t*n,x.y=C+b*l-T*N/o,x.z=t*s,_.push(x.x,x.y,x.z),M.set(n,k,s).normalize(),g.push(M.x,M.y,M.z),v.push(i,useOpenGLOrientationForUV?R/P:1-R/P),e.push(y),y++}S.push(e)}for(T=1;T<=d;T++){const e=[],t=E-f-(Math.PI-f)*(T/d);R+=c*f/d;const i=Math.cos(t),a=Math.sin(t),n=i*c;for(A=0;A<=r;A++){const t=A/r,s=t*u+0,o=Math.sin(s),l=Math.cos(s);x.x=n*o,x.y=a*c-C,x.z=n*l,_.push(x.x,x.y,x.z),M.set(i*o,a,i*l),g.push(M.x,M.y,M.z),v.push(t,useOpenGLOrientationForUV?R/P:1-R/P),e.push(y),y++}S.push(e)}for(A=0;A<r;A++)for(T=0;T<m+o+d;T++){const e=S[T][A],t=S[T+1][A],i=S[T+1][A+1],a=S[T][A+1];p.push(e),p.push(t),p.push(a),p.push(t),p.push(i),p.push(a)}if(p=p.reverse(),e.orientation&&!e.orientation.equals(Vector3.Up())){const t=new Matrix;e.orientation.clone().scale(.5*Math.PI).cross(Vector3.Up()).toQuaternion().toRotationMatrix(t);const i=Vector3.Zero();for(let e=0;e<_.length;e+=3)i.set(_[e],_[e+1],_[e+2]),Vector3.TransformCoordinatesToRef(i.clone(),t,i),_[e]=i.x,_[e+1]=i.y,_[e+2]=i.z}const D=new VertexData;return D.positions=_,D.normals=g,D.uvs=v,D.indices=p,D}function CreateCapsule(e,t={orientation:Vector3.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},i=null){const a=new Mesh(e,i);return CreateCapsuleVertexData(t).applyToMesh(a,t.updatable),a}Mesh.CreateDecal=(e,t,i,a,n,s)=>CreateDecal(e,t,{position:i,normal:a,size:n,angle:s}),Mesh.CreateCapsule=(e,t,i)=>CreateCapsule(e,t,i),VertexData.CreateCapsule=CreateCapsuleVertexData;var _IsoVector=class e{clone(){return new e(this.x,this.y)}rotateNeg60About(e){const t=this.x;return this.x=t+this.y-e.y,this.y=e.x+e.y-t,this}static Zero(){return new e(0,0)}rotate60About(e){const t=this.x;return this.x=e.x+e.y-this.y,this.y=t+this.y-e.x,this}rotateNeg120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),Logger.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),Logger.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-t,this.y=e+t-i-this.y,this}rotate120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),Logger.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),Logger.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=e-i-this.y,this.y=t+i,this}constructor(e=0,t=0){this.x=e,this.y=t,e!==Math.floor(e)&&(e=Math.floor(e),Logger.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(t=Math.floor(t),Logger.Warn("y is not an integer, floor(y) used"))}toCartesianOrigin(e,t){const i=Vector3.Zero();return i.x=e.x+2*this.x*t+this.y*t,i.y=e.y+Math.sqrt(3)*this.y*t,i}},_PrimaryIsoTriangle=class{mapABOBtoOBOA(){const e=new _IsoVector(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let a=0;a<3;a++)e.x=this.isoVecsABOB[t][a].x,e.y=this.isoVecsABOB[t][a].y,0===this.vertexTypes[t][a]&&e.rotateNeg120(this.m,this.n),i.push(e.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const e=new _IsoVector(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let a=0;a<3;a++)e.x=this.isoVecsABOB[t][a].x,e.y=this.isoVecsABOB[t][a].y,1===this.vertexTypes[t][a]&&e.rotate120(this.m,this.n),i.push(e.clone());this.isoVecsBAOA.push(i)}}createInnerFacets(){const e=this.m,t=this.n;for(let i=0;i<t+e+1;i++)for(let e=this.min[i];e<this.max[i]+1;e++)e<this.max[i]&&e<this.max[i+1]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+e+"|"+(i+1),"|"+(e+1)+"|"+i]),i>0&&e<this.max[i-1]&&e+1<this.max[i]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+(e+1)+"|"+i,"|"+(e+1)+"|"+(i-1)])}MapToFace(e,t){const i=this.IDATA.face[e],a=i[2],n=i[1],s=i[0],r=Vector3.FromArray(this.IDATA.vertex[a]),o=Vector3.FromArray(this.IDATA.vertex[n]),l=Vector3.FromArray(this.IDATA.vertex[s]),c=o.subtract(r),h=l.subtract(r),u=c.scale(this.coau).add(h.scale(this.cobu)),m=c.scale(this.coav).add(h.scale(this.cobv)),d=[];let f,p=TmpVectors.Vector3[0];for(let i=0;i<this.cartesian.length;i++)p=u.scale(this.cartesian[i].x).add(m.scale(this.cartesian[i].y)).add(r),d[i]=[p.x,p.y,p.z],f=e+"|"+this.vertices[i].x+"|"+this.vertices[i].y,t.vertex[this.vecToidx[f]]=[p.x,p.y,p.z]}setIndices(){let e=12;const t={},i=this.m,a=this.n;let n,s,r,o,l,c=i,h=1,u=0;0!==a&&(c=Scalar.HCF(i,a)),h=i/c,u=a/c;const m=_IsoVector.Zero(),d=new _IsoVector(i,a),f=new _IsoVector(-a,i+a),p=_IsoVector.Zero(),_=_IsoVector.Zero(),g=_IsoVector.Zero();let v,y,S,C,E=[];const A=[],T=this.vertByDist,M=(i,a,n,s)=>{v=i+"|"+n,y=a+"|"+s,v in t||y in t?v in t&&!(y in t)?t[y]=t[v]:y in t&&!(v in t)&&(t[v]=t[y]):(t[v]=e,t[y]=e,e++),T[n][0]>2?A[t[v]]=[-T[n][0],T[n][1],t[v]]:A[t[v]]=[E[T[n][0]],T[n][1],t[v]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let y=0;y<20;y++){if(E=this.IDATA.face[y],r=E[2],o=E[1],l=E[0],S=m.x+"|"+m.y,v=y+"|"+S,v in t||(t[v]=r,A[r]=[E[T[S][0]],T[S][1]]),S=d.x+"|"+d.y,v=y+"|"+S,v in t||(t[v]=o,A[o]=[E[T[S][0]],T[S][1]]),S=f.x+"|"+f.y,v=y+"|"+S,v in t||(t[v]=l,A[l]=[E[T[S][0]],T[S][1]]),n=this.IDATA.edgematch[y][0],s=this.IDATA.edgematch[y][1],"B"===s)for(let e=1;e<c;e++)_.x=i-e*(h+u),_.y=a+e*h,g.x=-e*u,g.y=e*(h+u),S=_.x+"|"+_.y,C=g.x+"|"+g.y,M(y,n,S,C);if("O"===s)for(let e=1;e<c;e++)g.x=-e*u,g.y=e*(h+u),p.x=e*h,p.y=e*u,S=g.x+"|"+g.y,C=p.x+"|"+p.y,M(y,n,S,C);if(n=this.IDATA.edgematch[y][2],s=this.IDATA.edgematch[y][3],s&&"A"===s)for(let e=1;e<c;e++)p.x=e*h,p.y=e*u,_.x=i-(c-e)*(h+u),_.y=a+(c-e)*h,S=p.x+"|"+p.y,C=_.x+"|"+_.y,M(y,n,S,C);for(let i=0;i<this.vertices.length;i++)S=this.vertices[i].x+"|"+this.vertices[i].y,v=y+"|"+S,v in t||(t[v]=e++,T[S][0]>2?A[t[v]]=[-T[S][0],T[S][1],t[v]]:A[t[v]]=[E[T[S][0]],T[S][1],t[v]])}this.closestTo=A,this.vecToidx=t}constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new PolyhedronData("icosahedron","Regular",[[0,PHI,-1],[-PHI,1,0],[-1,0,-PHI],[1,0,-PHI],[PHI,1,0],[0,PHI,1],[-1,0,PHI],[-PHI,-1,0],[0,-PHI,-1],[PHI,-1,0],[1,0,PHI],[0,-PHI,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}edgeVecsABOB(){const e=this.m,t=this.n,i=new _IsoVector(-t,e+t);for(let a=1;a<e+t;a++){const e=new _IsoVector(this.min[a],a),t=new _IsoVector(this.min[a-1],a-1),n=new _IsoVector(this.min[a+1],a+1),s=e.clone(),r=t.clone(),o=n.clone();s.rotate60About(i),r.rotate60About(i),o.rotate60About(i);const l=new _IsoVector(this.max[s.y],s.y),c=new _IsoVector(this.max[s.y-1],s.y-1),h=new _IsoVector(this.max[s.y-1]-1,s.y-1);s.x===l.x&&s.y===l.y||(s.x!==c.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,c,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,h,l])):s.y===o.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,c]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([e,c,n])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,c]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,c,l])))}}calcCoeffs(){const e=this.m,t=this.n,i=Math.sqrt(3)/3,a=e*e+t*t+e*t;this.coau=(e+t)/a,this.cobu=-t/a,this.coav=-i*(e-t)/a,this.cobv=i*(2*e+t)/a}build(e,t){const i=[],a=_IsoVector.Zero(),n=new _IsoVector(e,t),s=new _IsoVector(-t,e+t);i.push(a,n,s);for(let a=t;a<e+1;a++)for(let t=0;t<e+1-a;t++)i.push(new _IsoVector(t,a));if(t>0){const a=Scalar.HCF(e,t),n=e/a,s=t/a;for(let r=1;r<a;r++)i.push(new _IsoVector(r*n,r*s)),i.push(new _IsoVector(-r*s,r*(n+s))),i.push(new _IsoVector(e-r*(n+s),t+r*n));const r=e/t;for(let a=1;a<t;a++)for(let n=0;n<a*r;n++)i.push(new _IsoVector(n,a)),i.push(new _IsoVector(n,a).rotate120(e,t)),i.push(new _IsoVector(n,a).rotateNeg120(e,t))}i.sort(((e,t)=>e.x-t.x)),i.sort(((e,t)=>e.y-t.y));const r=new Array(e+t+1),o=new Array(e+t+1);for(let e=0;e<r.length;e++)r[e]=1/0,o[e]=-1/0;let l=0,c=0;const h=i.length;for(let e=0;e<h;e++)c=i[e].x,l=i[e].y,r[l]=Math.min(c,r[l]),o[l]=Math.max(c,o[l]);const u=(i,a)=>{const n=i.clone();return"A"===a&&n.rotateNeg120(e,t),"B"===a&&n.rotate120(e,t),n.x<0?n.y:n.x+n.y},m=[],d=[],f=[],p=[],_={},g=[];let v=-1,y=-1;for(let e=0;e<h;e++)m[e]=i[e].toCartesianOrigin(new _IsoVector(0,0),.5),d[e]=u(i[e],"O"),f[e]=u(i[e],"A"),p[e]=u(i[e],"B"),d[e]===f[e]&&f[e]===p[e]?(v=3,y=d[e]):d[e]===f[e]?(v=4,y=d[e]):f[e]===p[e]?(v=5,y=f[e]):p[e]===d[e]&&(v=6,y=d[e]),d[e]<f[e]&&d[e]<p[e]&&(v=2,y=d[e]),f[e]<d[e]&&f[e]<p[e]&&(v=1,y=f[e]),p[e]<f[e]&&p[e]<d[e]&&(v=0,y=p[e]),g.push([v,y,i[e].x,i[e].y]);g.sort(((e,t)=>e[2]-t[2])),g.sort(((e,t)=>e[3]-t[3])),g.sort(((e,t)=>e[1]-t[1])),g.sort(((e,t)=>e[0]-t[0]));for(let e=0;e<g.length;e++)_[g[e][2]+"|"+g[e][3]]=[g[e][0],g[e][1],e];return this.m=e,this.n=t,this.vertices=i,this.vertByDist=_,this.cartesian=m,this.min=r,this.max=o,this}},PolyhedronData=class{constructor(e,t,i,a){this.name=e,this.category=t,this.vertex=i,this.face=a}},GeodesicData=class e extends PolyhedronData{mapOBOAtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let a=0;a<t.isoVecsOBOA.length;a++){const n=[];for(let s=0;s<3;s++)1===t.vertexTypes[a][s]?n.push(e+"|"+t.isoVecsOBOA[a][s].x+"|"+t.isoVecsOBOA[a][s].y):n.push(i+"|"+t.isoVecsOBOA[a][s].x+"|"+t.isoVecsOBOA[a][s].y);this.face.push([t.vecToidx[n[0]],t.vecToidx[n[1]],t.vecToidx[n[2]]])}}toGoldbergPolyhedronData(){const e=new PolyhedronData("GeoDual","Goldberg",[],[]);e.name="GD dual";const t=this.vertex.length,i=new Array(t);for(let e=0;e<t;e++)i[e]=[];for(let e=0;e<this.face.length;e++)for(let t=0;t<3;t++)i[this.face[e][t]].push(e);let a=0,n=0,s=0,r=[],o=[];this.adjacentFaces=[];for(let t=0;t<i.length;t++)e.face[t]=this.setOrder(t,i[t].concat([])),i[t].forEach((t=>{a=0,n=0,s=0,r=this.face[t];for(let e=0;e<3;e++)o=this.vertex[r[e]],a+=o[0],n+=o[1],s+=o[2];e.vertex[t]=[a/3,n/3,s/3]}));return e}setOrder(e,t){const i=[],a=[];let n=t.pop();a.push(n);let s=this.face[n].indexOf(e);s=(s+2)%3;let r=this.face[n][s];i.push(r);let o=0;for(;t.length>0;)n=t[o],this.face[n].indexOf(r)>-1?(s=(this.face[n].indexOf(r)+1)%3,r=this.face[n][s],i.push(r),a.push(n),t.splice(o,1),o=0):o++;return this.adjacentFaces.push(i),a}static BuildGeodesicData(t){const i=new e("Geodesic-m-n","Geodesic",[[0,PHI,-1],[-PHI,1,0],[-1,0,-PHI],[1,0,-PHI],[PHI,1,0],[0,PHI,1],[-1,0,PHI],[-PHI,-1,0],[0,-PHI,-1],[PHI,-1,0],[1,0,PHI],[0,-PHI,1]],[]);t.setIndices(),t.calcCoeffs(),t.createInnerFacets(),t.edgeVecsABOB(),t.mapABOBtoOBOA(),t.mapABOBtoBAOA();for(let e=0;e<t.IDATA.face.length;e++)t.MapToFace(e,i),i.innerToData(e,t),"B"===t.IDATA.edgematch[e][1]&&i.mapABOBtoDATA(e,t),"O"===t.IDATA.edgematch[e][1]&&i.mapOBOAtoDATA(e,t),"A"===t.IDATA.edgematch[e][3]&&i.mapBAOAtoDATA(e,t);i.orderData(t);return i.vertex=i.vertex.map((function(e){const t=e[0],i=e[1],a=e[2],n=Math.sqrt(t*t+i*i+a*a);return e[0]*=1/n,e[1]*=1/n,e[2]*=1/n,e})),i}mapABOBtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let a=0;a<t.isoVecsABOB.length;a++){const n=[];for(let s=0;s<3;s++)0===t.vertexTypes[a][s]?n.push(e+"|"+t.isoVecsABOB[a][s].x+"|"+t.isoVecsABOB[a][s].y):n.push(i+"|"+t.isoVecsABOB[a][s].x+"|"+t.isoVecsABOB[a][s].y);this.face.push([t.vecToidx[n[0]],t.vecToidx[n[1]],t.vecToidx[n[2]]])}}mapBAOAtoDATA(e,t){const i=t.IDATA.edgematch[e][2];for(let a=0;a<t.isoVecsBAOA.length;a++){const n=[];for(let s=0;s<3;s++)1===t.vertexTypes[a][s]?n.push(e+"|"+t.isoVecsBAOA[a][s].x+"|"+t.isoVecsBAOA[a][s].y):n.push(i+"|"+t.isoVecsBAOA[a][s].x+"|"+t.isoVecsBAOA[a][s].y);this.face.push([t.vecToidx[n[0]],t.vecToidx[n[1]],t.vecToidx[n[2]]])}}innerToData(e,t){for(let i=0;i<t.innerFacets.length;i++)this.face.push(t.innerFacets[i].map((i=>t.vecToidx[e+i])))}orderData(e){const t=[];for(let e=0;e<13;e++)t[e]=[];const i=e.closestTo;for(let e=0;e<i.length;e++)i[e][0]>-1?i[e][1]>0&&t[i[e][0]].push([e,i[e][1]]):t[12].push([e,i[e][0]]);const a=[];for(let e=0;e<12;e++)a[e]=e;let n=12;for(let e=0;e<12;e++){t[e].sort(((e,t)=>e[1]-t[1]));for(let i=0;i<t[e].length;i++)a[t[e][i][0]]=n++}for(let e=0;e<t[12].length;e++)a[t[12][e][0]]=n++;for(let e=0;e<this.vertex.length;e++)this.vertex[e].push(a[e]);this.vertex.sort(((e,t)=>e[3]-t[3]));for(let e=0;e<this.vertex.length;e++)this.vertex[e].pop();for(let e=0;e<this.face.length;e++)for(let t=0;t<this.face[e].length;t++)this.face[e][t]=a[this.face[e][t]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}};function CreateGeodesic(e,t,i=null){let a=t.m||1;a!==Math.floor(a)&&(a=Math.floor(a),Logger.Warn("m not an integer only floor(m) used"));let n=t.n||0;if(n!==Math.floor(n)&&(n=Math.floor(n),Logger.Warn("n not an integer only floor(n) used")),n>a){const e=n;n=a,a=e,Logger.Warn("n > m therefore m and n swapped")}const s=new _PrimaryIsoTriangle;s.build(a,n);return CreatePolyhedron(e,{custom:GeodesicData.BuildGeodesicData(s),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs},i)}Mesh._GoldbergMeshParser=(e,t)=>GoldbergMesh.Parse(e,t);var GoldbergMesh=class e extends Mesh{relatedGoldbergFace(e,t){return void 0===t?(e>this.goldbergData.nbUnsharedFaces-1&&(Logger.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(Logger.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(Logger.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)}setGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.setVerticesData(VertexBuffer.ColorKind,t)}updateGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.updateVerticesData(VertexBuffer.UVKind,t)}constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}updateGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.updateVerticesData(VertexBuffer.ColorKind,t)}_changeGoldbergFaceColors(e){for(let t=0;t<e.length;t++){const i=e[t][0],a=e[t][1],n=e[t][2];for(let e=i;e<a+1;e++)this.goldbergData.faceColors[e]=n}const t=[];for(let e=0;e<12;e++)for(let i=0;i<5;i++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);for(let e=12;e<this.goldbergData.faceColors.length;e++)for(let i=0;i<6;i++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);return t}serialize(e){super.serialize(e),e.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const e of this.goldbergData.faceColors)t.faceColors.push(e.asArray())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const e of this.goldbergData.faceCenters)t.faceCenters.push(e.asArray())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const e of this.goldbergData.faceZaxis)t.faceZaxis.push(e.asArray())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const e of this.goldbergData.faceYaxis)t.faceYaxis.push(e.asArray())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const e of this.goldbergData.faceXaxis)t.faceXaxis.push(e.asArray())}e.goldbergData=t}placeOnGoldbergFaceAt(e,t,i){const a=Vector3.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=a,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(i.x)).add(this.goldbergData.faceYaxis[t].scale(i.y)).add(this.goldbergData.faceZaxis[t].scale(i.z))}static Parse(t,i){const a=t.goldbergData;a.faceColors=a.faceColors.map((e=>Color4.FromArray(e))),a.faceCenters=a.faceCenters.map((e=>Vector3.FromArray(e))),a.faceZaxis=a.faceZaxis.map((e=>Vector3.FromArray(e))),a.faceXaxis=a.faceXaxis.map((e=>Vector3.FromArray(e))),a.faceYaxis=a.faceYaxis.map((e=>Vector3.FromArray(e)));const n=new e(t.name,i);return n.goldbergData=a,n}setGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.setVerticesData(VertexBuffer.UVKind,t)}_changeGoldbergFaceUVs(e){const t=this.getVerticesData(VertexBuffer.UVKind);for(let i=0;i<e.length;i++){const a=e[i][0],n=e[i][1],s=e[i][2],r=e[i][3],o=e[i][4],l=[],c=[];let h,u;for(let e=0;e<5;e++)h=s.x+r*Math.cos(o+e*Math.PI/2.5),u=s.y+r*Math.sin(o+e*Math.PI/2.5),h<0&&(h=0),h>1&&(h=1),l.push(h,u);for(let e=0;e<6;e++)h=s.x+r*Math.cos(o+e*Math.PI/3),u=s.y+r*Math.sin(o+e*Math.PI/3),h<0&&(h=0),h>1&&(h=1),c.push(h,u);for(let e=a;e<Math.min(12,n+1);e++)for(let i=0;i<5;i++)t[10*e+2*i]=l[2*i],t[10*e+2*i+1]=l[2*i+1];for(let e=Math.max(12,a);e<n+1;e++)for(let i=0;i<6;i++)t[12*e-24+2*i]=c[2*i],t[12*e-23+2*i]=c[2*i+1]}return t}};function CreateGoldbergVertexData(e,t){const i=e.size,a=e.sizeX||i||1,n=e.sizeY||i||1,s=e.sizeZ||i||1,r=0===e.sideOrientation?0:e.sideOrientation||VertexData.DEFAULTSIDE,o=[],l=[],c=[],h=[];let u=1/0,m=-1/0,d=1/0,f=-1/0;for(let e=0;e<t.vertex.length;e++)u=Math.min(u,t.vertex[e][0]*a),m=Math.max(m,t.vertex[e][0]*a),d=Math.min(d,t.vertex[e][1]*n),f=Math.max(f,t.vertex[e][1]*n);let p=0;for(let e=0;e<t.face.length;e++){const i=t.face[e],r=Vector3.FromArray(t.vertex[i[0]]),_=Vector3.FromArray(t.vertex[i[2]]),g=Vector3.FromArray(t.vertex[i[1]]),v=_.subtract(r),y=g.subtract(r),S=Vector3.Cross(y,v).normalize();for(let e=0;e<i.length;e++){c.push(S.x,S.y,S.z);const r=t.vertex[i[e]];o.push(r[0]*a,r[1]*n,r[2]*s);const l=(r[1]*n-d)/(f-d);h.push((r[0]*a-u)/(m-u),useOpenGLOrientationForUV?1-l:l)}for(let e=0;e<i.length-2;e++)l.push(p,p+e+2,p+e+1);p+=i.length}VertexData._ComputeSides(r,o,l,c,h);const _=new VertexData;return _.positions=o,_.indices=l,_.normals=c,_.uvs=h,_}function CreateGoldberg(e,t,i=null){const a=t.size,n=t.sizeX||a||1,s=t.sizeY||a||1,r=t.sizeZ||a||1;let o=t.m||1;o!==Math.floor(o)&&(o=Math.floor(o),Logger.Warn("m not an integer only floor(m) used"));let l=t.n||0;if(l!==Math.floor(l)&&(l=Math.floor(l),Logger.Warn("n not an integer only floor(n) used")),l>o){const e=l;l=o,o=e,Logger.Warn("n > m therefore m and n swapped")}const c=new _PrimaryIsoTriangle;c.build(o,l);const h=GeodesicData.BuildGeodesicData(c),u=h.toGoldbergPolyhedronData(),m=new GoldbergMesh(e,i);t.sideOrientation=Mesh._GetDefaultSideOrientation(t.sideOrientation),m._originalBuilderSideOrientation=t.sideOrientation;CreateGoldbergVertexData(t,u).applyToMesh(m,t.updatable),m.goldbergData.nbSharedFaces=h.sharedNodes,m.goldbergData.nbUnsharedFaces=h.poleNodes,m.goldbergData.adjacentFaces=h.adjacentFaces,m.goldbergData.nbFaces=m.goldbergData.nbSharedFaces+m.goldbergData.nbUnsharedFaces,m.goldbergData.nbFacesAtPole=(m.goldbergData.nbUnsharedFaces-12)/12;for(let e=0;e<h.vertex.length;e++)m.goldbergData.faceCenters.push(Vector3.FromArray(h.vertex[e])),m.goldbergData.faceCenters[e].x*=n,m.goldbergData.faceCenters[e].y*=s,m.goldbergData.faceCenters[e].z*=r,m.goldbergData.faceColors.push(new Color4(1,1,1,1));for(let e=0;e<u.face.length;e++){const t=u.face[e],i=Vector3.FromArray(u.vertex[t[0]]),a=Vector3.FromArray(u.vertex[t[2]]),n=Vector3.FromArray(u.vertex[t[1]]),s=a.subtract(i),r=n.subtract(i),o=Vector3.Cross(r,s).normalize(),l=Vector3.Cross(r,o).normalize();m.goldbergData.faceXaxis.push(r.normalize()),m.goldbergData.faceYaxis.push(o),m.goldbergData.faceZaxis.push(l)}return m}var ShapePath=class{extractHoles(){for(const e of this._tempPaths)e.area()>0?this._holes.push(e):this._paths.push(e);if(!this._paths.length&&this._holes.length){const e=this._holes;this._holes=this._paths,this._paths=e}this._tempPaths.length=0}lineTo(e,t){this._currentPath.addLineTo(e,t)}get paths(){return this._paths}bezierCurveTo(e,t,i,a,n,s){this._currentPath.addBezierCurveTo(e,t,i,a,n,s,this._resolution)}quadraticCurveTo(e,t,i,a){this._currentPath.addQuadraticCurveTo(e,t,i,a,this._resolution)}get holes(){return this._holes}moveTo(e,t){this._currentPath=new Path2(e,t),this._tempPaths.push(this._currentPath)}constructor(e){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=e}};function CreateShapePath(e,t,i,a,n,s){const r=s.glyphs[e]||s.glyphs["?"];if(!r)return null;const o=new ShapePath(n);if(r.o){const e=r.o.split(" ");for(let n=0,s=e.length;n<s;){switch(e[n++]){case"m":{const s=parseInt(e[n++])*t+i,r=parseInt(e[n++])*t+a;o.moveTo(s,r);break}case"l":{const s=parseInt(e[n++])*t+i,r=parseInt(e[n++])*t+a;o.lineTo(s,r);break}case"q":{const s=parseInt(e[n++])*t+i,r=parseInt(e[n++])*t+a,l=parseInt(e[n++])*t+i,c=parseInt(e[n++])*t+a;o.quadraticCurveTo(l,c,s,r);break}case"b":{const s=parseInt(e[n++])*t+i,r=parseInt(e[n++])*t+a,l=parseInt(e[n++])*t+i,c=parseInt(e[n++])*t+a,h=parseInt(e[n++])*t+i,u=parseInt(e[n++])*t+a;o.bezierCurveTo(l,c,h,u,s,r);break}}}}return o.extractHoles(),{offsetX:r.ha*t,shapePath:o}}function CreateTextShapePaths(e,t,i,a){const n=Array.from(e),s=t/a.resolution,r=(a.boundingBox.yMax-a.boundingBox.yMin+a.underlineThickness)*s,o=[];let l=0,c=0;for(let e=0;e<n.length;e++){const t=n[e];if("\n"===t)l=0,c-=r;else{const e=CreateShapePath(t,s,l,c,i,a);e&&(l+=e.offsetX,o.push(e.shapePath))}}return o}function CreateText(e,t,i,a={size:50,resolution:8,depth:1},n=null,s=earcut){const r=CreateTextShapePaths(t,a.size||50,a.resolution||8,i),o=[];let l=0;for(const t of r){if(!t.paths.length)continue;const i=t.holes.slice();for(const r of t.paths){const t=[],c=[],h=r.getPoints();for(const e of h)c.push(new Vector3(e.x,0,e.y));const u=i.slice();for(const e of u){const a=e.getPoints();let n=!1;for(const e of a)if(r.isPointInside(e)){n=!0;break}if(!n)continue;const s=[];for(const e of a)s.push(new Vector3(e.x,0,e.y));t.push(s),i.splice(i.indexOf(e),1)}if(!t.length&&i.length)for(const e of i){const i=e.getPoints(),a=[];for(const e of i)a.push(new Vector3(e.x,0,e.y));t.push(a)}const m=ExtrudePolygon(e,{shape:c,holes:t.length?t:void 0,depth:a.depth||1,faceUV:a.faceUV||a.perLetterFaceUV?.(l),faceColors:a.faceColors||a.perLetterFaceColors?.(l),sideOrientation:Mesh._GetDefaultSideOrientation(a.sideOrientation||Mesh.DOUBLESIDE)},n,s);o.push(m),l++}}const c=Mesh.MergeMeshes(o,!0,!0);if(c){const t=c.getBoundingInfo().boundingBox;c.position.x+=-(t.minimumWorld.x+t.maximumWorld.x)/2,c.position.y+=-(t.minimumWorld.y+t.maximumWorld.y)/2,c.position.z+=-(t.minimumWorld.z+t.maximumWorld.z)/2+t.extendSize.z,c.name=e;const i=new TransformNode("pivot",n);i.rotation.x=-Math.PI/2,c.parent=i,c.bakeCurrentTransformIntoVertices(),c.parent=null,i.dispose()}return c}var MeshBuilder={Mc:CreateBox,CreateTiledBox:CreateTiledBox,vc:CreateSphere,nc:CreateDisc,CreateIcoSphere:CreateIcoSphere,Tc:CreateRibbon,Ec:CreateCylinder,CreateTorus:CreateTorus,CreateTorusKnot:CreateTorusKnot,CreateLineSystem:CreateLineSystem,lb:CreateLines,CreateDashedLines:CreateDashedLines,ExtrudeShape:ExtrudeShape,ExtrudeShapeCustom:ExtrudeShapeCustom,xb:CreateLathe,CreateTiledPlane:CreateTiledPlane,Nc:CreatePlane,CreateGround:CreateGround,CreateTiledGround:CreateTiledGround,CreateGroundFromHeightMap:CreateGroundFromHeightMap,CreatePolygon:CreatePolygon,ExtrudePolygon:ExtrudePolygon,CreateTube:CreateTube,CreatePolyhedron:CreatePolyhedron,CreateGeodesic:CreateGeodesic,CreateGoldberg:CreateGoldberg,CreateDecal:CreateDecal,CreateCapsule:CreateCapsule,CreateText:CreateText},AnimationEvent=class e{_clone(){return new e(this.frame,this.action,this.onlyOnce)}constructor(e,t,i){this.frame=e,this.action=t,this.onlyOnce=i,this.isDone=!1}},Bone=class e extends Node{get parent(){return this._parentNode}set scaling(e){this.setScale(e)}getRotationToRef(t=0,i=null,a){const n=e._TmpQuat;this.getRotationQuaternionToRef(t,i,n),n.toEulerAnglesToRef(a)}getRotationMatrix(e=0,t){const i=Matrix.Identity();return this.getRotationMatrixToRef(e,t,i),i}getBindMatrix(){return this._bindMatrix}getPositionToRef(t=0,i,a){if(0==t){const e=this.getLocalMatrix();a.x=e.m[12],a.y=e.m[13],a.z=e.m[14]}else{let t=null;i&&(t=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let n=e._TmpMats[0];i&&t?(n.copyFrom(this.getAbsoluteMatrix()),n.multiplyToRef(t,n)):n=this.getAbsoluteMatrix(),a.x=n.m[12],a.y=n.m[13],a.z=n.m[14]}}getBindPose(){return this.getBindMatrix()}getRestPose(){return this.getRestMatrix()}getLocalMatrix(){return this._compose(),this._localMatrix}getDirectionToRef(t,i=null,a){let n=null;i&&(n=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=e._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),i&&n&&s.multiplyToRef(n,s),Vector3.TransformNormalToRef(t,s,a),a.normalize()}getPosition(e=0,t=null){const i=Vector3.Zero();return this.getPositionToRef(e,t,i),i}_markAsDirtyAndCompose(){this.markAsDirty(),this._needToCompose=!0}getBaseMatrix(){return this.getBindMatrix()}getRotationQuaternionToRef(t=0,i=null,a){if(0==t)this._decompose(),a.copyFrom(this._localRotation);else{const t=e._TmpMats[0],n=this.getAbsoluteMatrix();i?n.multiplyToRef(i.getWorldMatrix(),t):t.copyFrom(n),t.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyAtIndex(1,this._scalingDeterminant),t.multiplyAtIndex(2,this._scalingDeterminant),t.decompose(void 0,a,void 0)}}get scaling(){return this.getScale()}_markAsDirtyAndDecompose(){this.markAsDirty(),this._needToDecompose=!0}updateMatrix(e,t=!0,i=!0){this._bindMatrix.copyFrom(e),t&&this._updateAbsoluteBindMatrices(),i?this._matrix=e:this.markAsDirty()}getAbsolutePositionFromLocalToRef(t,i=null,a){let n=null;i&&(n=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=e._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),i&&n&&s.multiplyToRef(n,s),Vector3.TransformCoordinatesToRef(t,s,a)}setRestPose(e){this.setRestMatrix(e)}getAbsolutePosition(e=null){const t=Vector3.Zero();return this.getPositionToRef(1,e,t),t}getScale(){return this._decompose(),this._localScaling}get rotation(){return this.getRotation()}getSkeleton(){return this._skeleton}getRotationQuaternion(e=0,t=null){const i=Quaternion.Identity();return this.getRotationQuaternionToRef(e,t,i),i}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}constructor(e,t,i=null,a=null,n=null,s=null,r=null){super(e,t.getScene(),!1),this.name=e,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=t,this._localMatrix=a?.clone()??Matrix.Identity(),this._restMatrix=n??this._localMatrix.clone(),this._bindMatrix=s??this._localMatrix.clone(),this._index=r,this._absoluteMatrix=new Matrix,this._absoluteBindMatrix=new Matrix,this._absoluteInverseBindMatrix=new Matrix,this._finalMatrix=new Matrix,t.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}setRestMatrix(e){this._restMatrix.copyFrom(e)}getDirection(e,t=null){const i=Vector3.Zero();return this.getDirectionToRef(e,t,i),i}setParent(e,t=!0){if(this.parent!==e){if(this.parent){const e=this.parent.children.indexOf(this);-1!==e&&this.parent.children.splice(e,1)}this._parentNode=e,this.parent&&this.parent.children.push(this),t&&this._updateAbsoluteBindMatrices(),this.markAsDirty()}}set rotation(e){this.setRotation(e)}set parent(e){this.setParent(e)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.copyFrom(this._localMatrix);const e=this._skeleton.getPoseMatrix();e&&this._absoluteMatrix.multiplyToRef(e,this._absoluteMatrix)}const e=this.children,t=e.length;for(let i=0;i<t;i++)e[i].computeAbsoluteMatrices()}setScale(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()}getLocalPositionFromAbsolute(e,t=null){const i=Vector3.Zero();return this.getLocalPositionFromAbsoluteToRef(e,t,i),i}setBindPose(e){this.setBindMatrix(e)}returnToRest(){if(this._linkedTransformNode){const e=TmpVectors.Vector3[0],t=TmpVectors.Cc[0],i=TmpVectors.Vector3[1];this.getRestMatrix().decompose(e,t,i),this._linkedTransformNode.position.copyFrom(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(t),this._linkedTransformNode.scaling.copyFrom(e)}else this._matrix=this._restMatrix}getTransformNode(){return this._linkedTransformNode}set position(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()}getRotationMatrixToRef(t=0,i,a){if(0==t)this.getLocalMatrix().getRotationMatrixToRef(a);else{const t=e._TmpMats[0],n=this.getAbsoluteMatrix();i?n.multiplyToRef(i.getWorldMatrix(),t):t.copyFrom(n),t.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyAtIndex(1,this._scalingDeterminant),t.multiplyAtIndex(2,this._scalingDeterminant),t.getRotationMatrixToRef(a)}}getAbsolutePositionToRef(e,t){this.getPositionToRef(1,e,t)}linkTransformNode(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}getRotation(e=0,t=null){const i=Vector3.Zero();return this.getRotationToRef(e,t,i),i}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getLocalPositionFromAbsoluteToRef(t,i=null,a){let n=null;i&&(n=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=e._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),i&&n&&s.multiplyToRef(n,s),s.invert(),Vector3.TransformCoordinatesToRef(t,s,a)}setRotation(e,t=0,i){this.setYawPitchRoll(e.y,e.x,e.z,t,i)}_updateAbsoluteBindMatrices(e,t=!0){if(e||(e=this._bindMatrix),this.parent?e.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.copyFrom(e),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),t)for(let e=0;e<this.children.length;e++)this.children[e]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}get position(){return this._decompose(),this._localPosition}getScaleToRef(e){this._decompose(),e.copyFrom(this._localScaling)}_getAbsoluteInverseMatrixUnscaledToRef(t,i){const a=e._TmpMats[2];return t.copyFrom(this.getAbsoluteMatrix()),i?(t.multiplyToRef(i.getWorldMatrix(),t),Matrix.ScalingToRef(i.scaling.x,i.scaling.y,i.scaling.z,a)):Matrix.IdentityToRef(a),t.invert(),!isNaN(t.m[0])&&(a.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(a,t),!0)}setRotationQuaternion(t,i=0,a){if(0===i)return this._decompose(),this._localRotation.copyFrom(t),void this._markAsDirtyAndCompose();const n=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,a))return;const s=e._TmpMats[1];Matrix.FromQuaternionToRef(t,s),n.multiplyToRef(s,s),this._rotateWithMatrix(s,i,a)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}setPosition(e,t=0,i){this._updatePosition(e,t,i,!1)}translate(e,t=0,i){this._updatePosition(e,t,i,!0)}markAsDirty(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Vector3.Zero(),this._localRotation=Quaternion.Zero(),this._localPosition=Vector3.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))}setRotationMatrix(t,i=0,a){if(0===i){const n=e._TmpQuat;return Quaternion.FromRotationMatrixToRef(t,n),void this.setRotationQuaternion(n,i,a)}const n=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,a))return;const s=e._TmpMats[1];s.copyFrom(t),n.multiplyToRef(t,s),this._rotateWithMatrix(s,i,a)}getAbsolutePositionFromLocal(e,t=null){const i=Vector3.Zero();return this.getAbsolutePositionFromLocalToRef(e,t,i),i}set _matrix(e){(e.updateFlag!==this._localMatrix.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose())}getRestMatrix(){return this._restMatrix}rotate(t,i,a=0,n){const s=e._TmpMats[0];s.setTranslationFromFloats(0,0,0),Matrix.RotationAxisToRef(t,i,s),this._rotateWithMatrix(s,a,n)}getClassName(){return"Bone"}setAbsolutePosition(e,t){this.setPosition(e,1,t)}_rotateWithMatrix(t,i=0,a){const n=this.getLocalMatrix(),s=n.m[12],r=n.m[13],o=n.m[14],l=this.getParent(),c=e._TmpMats[3],h=e._TmpMats[4];l&&1==i?(a?(c.copyFrom(a.getWorldMatrix()),l.getAbsoluteMatrix().multiplyToRef(c,c)):c.copyFrom(l.getAbsoluteMatrix()),h.copyFrom(c),h.invert(),n.multiplyToRef(c,n),n.multiplyToRef(t,n),n.multiplyToRef(h,n)):1==i&&a?(c.copyFrom(a.getWorldMatrix()),h.copyFrom(c),h.invert(),n.multiplyToRef(c,n),n.multiplyToRef(t,n),n.multiplyToRef(h,n)):n.multiplyToRef(t,n),n.setTranslationFromFloats(s,r,o),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}scale(t,i,a,n=!1){const s=this.getLocalMatrix(),r=e._TmpMats[0];Matrix.ScalingToRef(t,i,a,r),r.multiplyToRef(s,s),r.invert();for(const e of this.children){const n=e.getLocalMatrix();n.multiplyToRef(r,n),n.multiplyAtIndex(12,t),n.multiplyAtIndex(13,i),n.multiplyAtIndex(14,a),e._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),n)for(const e of this.children)e.scale(t,i,a,n)}getWorldMatrix(){return this.getFinalMatrix()}set rotationQuaternion(e){this.setRotationQuaternion(e)}setYawPitchRoll(t,i,a,n=0,s){if(0===n){const r=e._TmpQuat;return Quaternion.RotationYawPitchRollToRef(t,i,a,r),void this.setRotationQuaternion(r,n,s)}const r=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,s))return;const o=e._TmpMats[1];Matrix.RotationYawPitchRollToRef(t,i,a,o),r.multiplyToRef(o,o),this._rotateWithMatrix(o,n,s)}setAxisAngle(t,i,a=0,n){if(0===a){const s=e._TmpQuat;return Quaternion.RotationAxisToRef(t,i,s),void this.setRotationQuaternion(s,a,n)}const s=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,n))return;const r=e._TmpMats[1];Matrix.RotationAxisToRef(t,i,r),s.multiplyToRef(r,r),this._rotateWithMatrix(r,a,n)}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}getParent(){return this.parent}get _matrix(){return this._compose(),this._localMatrix}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Matrix.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)}getChildren(){return this.children}get rotationQuaternion(){return this._decompose(),this._localRotation}getFinalMatrix(){return this._finalMatrix}setBindMatrix(e){this.updateMatrix(e)}_updatePosition(t,i=0,a,n=!0){const s=this.getLocalMatrix();if(0==i)n?(s.addAtIndex(12,t.x),s.addAtIndex(13,t.y),s.addAtIndex(14,t.z)):s.setTranslationFromFloats(t.x,t.y,t.z);else{let i=null;a&&(i=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=e._TmpMats[0],o=e._TmpVecs[0];this.parent?a&&i?(r.copyFrom(this.parent.getAbsoluteMatrix()),r.multiplyToRef(i,r)):r.copyFrom(this.parent.getAbsoluteMatrix()):Matrix.IdentityToRef(r),n&&r.setTranslationFromFloats(0,0,0),r.invert(),Vector3.TransformCoordinatesToRef(t,r,o),n?(s.addAtIndex(12,o.x),s.addAtIndex(13,o.y),s.addAtIndex(14,o.z)):s.setTranslationFromFloats(o.x,o.y,o.z)}this._markAsDirtyAndDecompose()}};function _convertRGBtoRGBATextureData(e,t,i,a){let n,s=1;1===a?n=new Float32Array(t*i*4):2===a?(n=new Uint16Array(t*i*4),s=15360):n=7===a?new Uint32Array(t*i*4):new Uint8Array(t*i*4);for(let a=0;a<t;a++)for(let r=0;r<i;r++){const i=3*(r*t+a),o=4*(r*t+a);n[o+0]=e[i+0],n[o+1]=e[i+1],n[o+2]=e[i+2],n[o+3]=s}return n}function _makeCreateRawTextureFunction(e){return function(t,i,a,n,s,r,o,l,c=null,h=0){const u=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,m=new InternalTexture(this,e?10:11);m.baseWidth=i,m.baseHeight=a,m.baseDepth=n,m.width=i,m.height=a,m.depth=n,m.format=s,m.type=h,m.generateMipMaps=r,m.samplingMode=l,e?m.is3D=!0:m.is2DArray=!0,this._doNotHandleContextLost||(m._bufferView=t),e?this.updateRawTexture3D(m,t,s,o,c,h):this.updateRawTexture2DArray(m,t,s,o,c,h),this._bindTextureDirectly(u,m,!0);const d=this._getSamplingParameters(l,r);return this._gl.texParameteri(u,this._gl.TEXTURE_MAG_FILTER,d.mag),this._gl.texParameteri(u,this._gl.TEXTURE_MIN_FILTER,d.min),r&&this._gl.generateMipmap(u),this._bindTextureDirectly(u,null),this._internalTexturesCache.push(m),m}}function _makeUpdateRawTextureFunction(e){return function(t,i,a,n,s=null,r=0){const o=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,l=this._getWebGLTextureType(r),c=this._getInternalFormat(a),h=this._getRGBABufferInternalSizedFormat(r,a);this._bindTextureDirectly(o,t,!0),this._unpackFlipY(void 0===n||!!n),this._doNotHandleContextLost||(t._bufferView=i,t.format=a,t.invertY=n,t._compression=s),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&i?this._gl.compressedTexImage3D(o,0,this.getCaps().s3tc[s],t.width,t.height,t.depth,0,i):this._gl.texImage3D(o,0,h,t.width,t.height,t.depth,0,c,l,i),t.generateMipMaps&&this._gl.generateMipmap(o),this._bindTextureDirectly(o,null),t.isReady=!0}}Bone._TmpVecs=BuildArray(2,Vector3.Zero),Bone._TmpQuat=Quaternion.Identity(),Bone._TmpMats=BuildArray(5,Matrix.Identity),ThinEngine.prototype.updateRawTexture=function(e,t,i,a,n=null,s=0,r=!1){if(!e)return;const o=this._getRGBABufferInternalSizedFormat(s,i,r),l=this._getInternalFormat(i),c=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===a||!!a),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.type=s,e.invertY=a,e._compression=n),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[n],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,e.width,e.height,0,l,c,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0},ThinEngine.prototype.createRawTexture=function(e,t,i,a,n,s,r,o=null,l=0,c=0,h=!1){const u=new InternalTexture(this,3);u.baseWidth=t,u.baseHeight=i,u.width=t,u.height=i,u.format=a,u.generateMipMaps=n,u.samplingMode=r,u.invertY=s,u._compression=o,u.type=l,u._useSRGBBuffer=this._getUseSRGBBuffer(h,!n),this._doNotHandleContextLost||(u._bufferView=e),this.updateRawTexture(u,e,a,s,o,l,u._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0);const m=this._getSamplingParameters(r,n);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,m.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,m.min),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(u),u},ThinEngine.prototype.createRawCubeTexture=function(e,t,i,a,n,s,r,o=null){const l=this._gl,c=new InternalTexture(this,8);c.isCube=!0,c.format=i,c.type=a,this._doNotHandleContextLost||(c._bufferViewArray=e);const h=this._getWebGLTextureType(a);let u=this._getInternalFormat(i);u===l.RGB&&(u=l.RGBA),h!==l.FLOAT||this._caps.textureFloatLinearFiltering?h!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?h!==l.FLOAT||this._caps.textureFloatRender?h!==l.HALF_FLOAT||this._caps.colorBufferFloat||(n=!1,Logger.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(n=!1,Logger.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(n=!1,r=1,Logger.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(n=!1,r=1,Logger.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const m=t,d=m;c.width=m,c.height=d,c.invertY=s,c._compression=o;if(!this.needPOTTextures||IsExponentOfTwo(c.width)&&IsExponentOfTwo(c.height)||(n=!1),e)this.updateRawCubeTexture(c,e,i,a,s,o);else{const e=this._getRGBABufferInternalSizedFormat(a),t=0;this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,c,!0);for(let i=0;i<6;i++)o?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,t,this.getCaps().s3tc[o],c.width,c.height,0,void 0):l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,t,e,c.width,c.height,0,u,h,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,c,!0),e&&n&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const f=this._getSamplingParameters(r,n);return l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,f.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,f.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),c.generateMipMaps=n,c.samplingMode=r,c.isReady=!0,c},ThinEngine.prototype.updateRawCubeTexture=function(e,t,i,a,n,s=null,r=0){e._bufferViewArray=t,e.format=i,e.type=a,e.invertY=n,e._compression=s;const o=this._gl,l=this._getWebGLTextureType(a);let c=this._getInternalFormat(i);const h=this._getRGBABufferInternalSizedFormat(a);let u=!1;c===o.RGB&&(c=o.RGBA,u=!0),this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===n||!!n),e.width%4!=0&&o.pixelStorei(o.UNPACK_ALIGNMENT,1);for(let i=0;i<6;i++){let n=t[i];s?o.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+i,r,this.getCaps().s3tc[s],e.width,e.height,0,n):(u&&(n=_convertRGBtoRGBATextureData(n,e.width,e.height,a)),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+i,r,h,e.width,e.height,0,c,l,n))}(!this.needPOTTextures||IsExponentOfTwo(e.width)&&IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===r&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},ThinEngine.prototype.createRawCubeTextureFromUrl=function(e,t,i,a,n,s,r,o,l=null,c=null,h=3,u=!1){const m=this._gl,d=this.createRawCubeTexture(null,i,a,n,!s,u,h,null);t?.addPendingData(d),d.url=e,d.isReady=!1,this._internalTexturesCache.push(d);const f=e=>{const i=d.width,s=r(e);if(s){if(o){const e=this._getWebGLTextureType(n);let t=this._getInternalFormat(a);const r=this._getRGBABufferInternalSizedFormat(n);let l=!1;t===m.RGB&&(t=m.RGBA,l=!0),this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,d,!0),this._unpackFlipY(!1);const c=o(s);for(let a=0;a<c.length;a++){const s=i>>a;for(let i=0;i<6;i++){let o=c[a][i];l&&(o=_convertRGBtoRGBATextureData(o,s,s,n)),m.texImage2D(i,a,r,s,s,0,t,e,o)}}this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(d,s,a,n,u);d.isReady=!0,t?.removePendingData(d),d.onLoadedObservable.notifyObservers(d),d.onLoadedObservable.clear(),l&&l()}};return this._loadFile(e,(e=>{f(e)}),void 0,t?.offlineProvider,!0,((e,i)=>{t?.removePendingData(d),c&&e&&c(e.status+" "+e.statusText,i)})),d},ThinEngine.prototype.createRawTexture2DArray=_makeCreateRawTextureFunction(!1),ThinEngine.prototype.createRawTexture3D=_makeCreateRawTextureFunction(!0),ThinEngine.prototype.updateRawTexture2DArray=_makeUpdateRawTextureFunction(!1),ThinEngine.prototype.updateRawTexture3D=_makeUpdateRawTextureFunction(!0);var RawTexture=class e extends Texture{clone(){if(!this._texture)return super.clone();const t=new e(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return t._texture=this._texture,this._texture.incrementReferences(),t}static CreateLuminanceAlphaTexture(t,i,a,n,s=!0,r=!1,o=3){return new e(t,i,a,2,n,s,r,o)}static CreateRGBAStorageTexture(t,i,a,n,s=!0,r=!1,o=3,l=0,c=!1){return new e(t,i,a,5,n,s,r,o,l,1,c)}constructor(e,t,i,a,n,s=!0,r=!1,o=3,l=0,c,h){super(null,n,!s,r,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c),this.format=a,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==l||(o=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==l||(o=1),this._texture=this._engine.createRawTexture(e,t,i,a,s,r,o,null,l,c??0,h??!1),this.wrapU=Texture.CLAMP_ADDRESSMODE,this.wrapV=Texture.CLAMP_ADDRESSMODE)}static CreateLuminanceTexture(t,i,a,n,s=!0,r=!1,o=3){return new e(t,i,a,1,n,s,r,o)}static CreateRGBTexture(t,i,a,n,s=!0,r=!1,o=3,l=0,c=0,h=!1){return new e(t,i,a,4,n,s,r,o,l,c,h)}static CreateRGBATexture(t,i,a,n,s=!0,r=!1,o=3,l=0,c=0,h=!1){return new e(t,i,a,5,n,s,r,o,l,c,h)}static CreateRTexture(t,i,a,n,s=!0,r=!1,o=Texture.TRILINEAR_SAMPLINGMODE,l=1){return new e(t,i,a,6,n,s,r,o,l)}static CreateAlphaTexture(t,i,a,n,s=!0,r=!1,o=3){return new e(t,i,a,0,n,s,r,o)}static CreateRStorageTexture(t,i,a,n,s=!0,r=!1,o=Texture.TRILINEAR_SAMPLINGMODE,l=1){return new e(t,i,a,6,n,s,r,o,l,1)}update(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}},Skeleton=class e{sortBones(){const e=[],t=new Array(this.bones.length);for(let i=0;i<this.bones.length;i++)this._sortBones(i,e,t);this.bones=e}returnToRest(){for(const e of this.bones)-1!==e._index&&e.returnToRest()}getChildren(){return this.bones.filter((e=>!e.getParent()))}getPoseMatrix(){let e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e}getAnimationRange(e){return this._ranges[e]||null}deleteAnimationRange(e,t=!0){for(let i=0,a=this.bones.length;i<a;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(e,t);this._ranges[e]=null}get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}enableBlending(e=.01){this.bones.forEach((t=>{t.animations.forEach((t=>{t.enableBlending=!0,t.blendingSpeed=e}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){const e=this._parentContainer.skeletons.indexOf(this);e>-1&&this._parentContainer.skeletons.splice(e,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}createAnimationRange(e,t,i){if(!this._ranges[e]){this._ranges[e]=new AnimationRange(e,t,i);for(let a=0,n=this.bones.length;a<n;a++)this.bones[a].animations[0]&&this.bones[a].animations[0].createRange(e,t,i)}}getTransformMatrixTexture(e){return this.needInitialSkinMatrix&&e._transformMatrixTexture?e._transformMatrixTexture:this._transformMatrixTexture}static Parse(t,i){const a=new e(t.name,t.id,i);let n;for(t.dimensionsAtRest&&(a.dimensionsAtRest=Vector3.FromArray(t.dimensionsAtRest)),a.needInitialSkinMatrix=t.needInitialSkinMatrix,n=0;n<t.bones.length;n++){const e=t.bones[n],i=t.bones[n].index;let s=null;e.parentBoneIndex>-1&&(s=a.bones[e.parentBoneIndex]);const r=e.rest?Matrix.FromArray(e.rest):null,o=new Bone(e.name,a,s,Matrix.FromArray(e.matrix),r,null,i);void 0!==e.id&&null!==e.id&&(o.id=e.id),e.length&&(o.length=e.length),e.metadata&&(o.metadata=e.metadata),e.animation&&o.animations.push(Animation.Parse(e.animation)),void 0!==e.linkedTransformNodeId&&null!==e.linkedTransformNodeId&&(a._hasWaitingData=!0,o._waitingTransformNodeId=e.linkedTransformNodeId)}if(t.ranges)for(n=0;n<t.ranges.length;n++){const e=t.ranges[n];a.createAnimationRange(e.name,e.from,e.to)}return a}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getScene(){return this._scene}getTransformMatrices(e){if(this.needInitialSkinMatrix){if(!e)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return e._bonesTransformMatrices||this.prepare(!0),e._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}computeAbsoluteMatrices(e=!1){(this._absoluteTransformIsDirty||e)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}get Hc(){return this._uniqueId}getBoneIndexByName(e){for(let t=0,i=this.bones.length;t<i;t++)if(this.bones[t].name===e)return t;return-1}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}clone(t,i){const a=new e(t,i||t,this._scene);a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){const t=this.bones[e];let i=null;const n=t.getParent();if(n){const e=this.bones.indexOf(n);i=a.bones[e]}const s=new Bone(t.name,a,i,t.getBindMatrix().clone(),t.getRestMatrix().clone());s._index=t._index,t._linkedTransformNode&&s.linkTransformNode(t._linkedTransformNode),DeepCopier.DeepCopy(t.animations,s.animations)}if(this._ranges){a._ranges={};for(const e in this._ranges){const t=this._ranges[e];t&&(a._ranges[e]=t.clone())}}return this._isDirty=!0,a.prepare(!0),a}serialize(){const e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let t=0;t<this.bones.length;t++){const i=this.bones[t],a=i.getParent(),n={parentBoneIndex:a?this.bones.indexOf(a):-1,index:i.getIndex(),name:i.name,id:i.id,matrix:i.getBindMatrix().asArray(),rest:i.getRestMatrix().asArray(),linkedTransformNodeId:i.getTransformNode()?.id};e.bones.push(n),i.length&&(n.length=i.length),i.metadata&&(n.metadata=i.metadata),i.animations&&i.animations.length>0&&(n.animation=i.animations[0].serialize()),e.ranges=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const a={};a.name=t,a.from=i.from,a.to=i.to,e.ranges.push(a)}}return e}set useTextureToStoreBoneMatrices(e){this._useTextureToStoreBoneMatrices=e,this._markAsDirty()}_getHighestAnimationFrame(){let e=0;for(let t=0,i=this.bones.length;t<i;t++)if(this.bones[t].animations[0]){const i=this.bones[t].animations[0].getHighestFrame();e<i&&(e=i)}return e}_unregisterMeshWithPoseMatrix(e){const t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)}copyAnimationRange(e,t,i=!1){if(this._ranges[t]||!e.getAnimationRange(t))return!1;let a=!0;const n=this._getHighestAnimationFrame()+1,s={},r=e.bones;let o,l;for(l=0,o=r.length;l<o;l++)s[r[l].name]=r[l];this.bones.length!==r.length&&(Logger.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${r.length}`),a=!1);const c=i&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(l=0,o=this.bones.length;l<o;l++){const e=this.bones[l].name,r=s[e];r?a=a&&this.bones[l].copyAnimationRange(r,t,n,i,c):(Logger.Warn("copyAnimationRange: not same rig, missing source bone "+e),a=!1)}const h=e.getAnimationRange(t);return h&&(this._ranges[t]=new AnimationRange(t,h.from+n,h.to+n)),a}computeAbsoluteTransforms(e=!1){this.computeAbsoluteMatrices(e)}_registerMeshWithPoseMatrix(e){this._meshesWithPoseMatrix.push(e)}_sortBones(e,t,i){if(i[e])return;i[e]=!0;const a=this.bones[e];if(!a)return;void 0===a._index&&(a._index=e);const n=a.getParent();n&&this._sortBones(this.bones.indexOf(n),t,i),t.push(a)}constructor(e,t,i){this.name=e,this.id=t,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Observable,this.bones=[],this._scene=i||EngineStore.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const a=this._scene.getEngine().getCaps();this._canUseTextureForBones=a.textureFloat&&a.maxVertexTextureImageUnits>0}setCurrentPoseAsRest(){this.bones.forEach((e=>{e.setCurrentPoseAsRest()}))}beginAnimation(e,t,i,a){const n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,i,a):null}prepare(e=!1){if(!e){const e=this.getScene().getRenderId();if(this._currentRenderId===e)return;this._currentRenderId=e}if(this._numBonesWithLinkedTransformNode>0)for(const e of this.bones)if(e._linkedTransformNode){const t=e._linkedTransformNode;e.position=t.position,t.rotationQuaternion?e.rotationQuaternion=t.rotationQuaternion:e.rotation=t.rotation,e.scaling=t.scaling}if(this.needInitialSkinMatrix)for(const e of this._meshesWithPoseMatrix){const t=e.getPoseMatrix();let i=this._isDirty;if(e._bonesTransformMatrices&&e._bonesTransformMatrices.length===16*(this.bones.length+1)||(e._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),i=!0),i){if(this._synchronizedWithMesh!==e){this._synchronizedWithMesh=e;for(const e of this.bones)if(!e.getParent()){e.getBindMatrix().multiplyToRef(t,TmpVectors.Matrix[1]),e._updateAbsoluteBindMatrices(TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const t=4*(this.bones.length+1);e._transformMatrixTexture&&e._transformMatrixTexture.getSize().width===t||(e._transformMatrixTexture&&e._transformMatrixTexture.dispose(),e._transformMatrixTexture=RawTexture.CreateRGBATexture(e._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(e._bonesTransformMatrices,t),this.isUsingTextureForMatrices&&e._transformMatrixTexture&&e._transformMatrixTexture.update(e._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=RawTexture.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables}getClassName(){return"Skeleton"}static MakeAnimationAdditive(e,t=0,i){const a=e.getAnimationRange(i);if(!a)return null;const n=e._scene.getAllAnimatablesByTarget(e);let s=null;for(let e=0;e<n.length;e++){const t=n[e];if(t.fromFrame===a?.from&&t.toFrame===a?.to){s=t;break}}const r=e.getAnimatables();for(let e=0;e<r.length;e++){const a=r[e].animations;if(a)for(let e=0;e<a.length;e++)Animation.MakeAnimationAdditive(a[e],t,i)}return s&&(s.isAdditive=!0),e}_computeTransformMatrices(e,t){this.onBeforeComputeObservable.notifyObservers(this);for(let i=0;i<this.bones.length;i++){const a=this.bones[i];a._childUpdateId++;const n=a.getParent();if(n?a.getLocalMatrix().multiplyToRef(n.getFinalMatrix(),a.getFinalMatrix()):t?a.getLocalMatrix().multiplyToRef(t,a.getFinalMatrix()):a.getFinalMatrix().copyFrom(a.getLocalMatrix()),-1!==a._index){const t=null===a._index?i:a._index;a.getAbsoluteInverseBindMatrix().multiplyToArray(a.getFinalMatrix(),e,16*t)}}this._identity.copyToArray(e,16*this.bones.length)}toString(e){let t=`Name: ${this.name}, nBones: ${this.bones.length}`;if(t+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,e){t+=", Ranges: {";let e=!0;for(const i in this._ranges)e&&(t+=", ",e=!1),t+=i;t+="}"}return t}},SolidParticle=class{constructor(e,t,i,a,n,s,r,o,l=null,c=null){this.idx=0,this.id=0,this.color=new Color4(1,1,1,1),this.position=Vector3.Zero(),this.rotation=Vector3.Zero(),this.scaling=Vector3.One(),this.uvs=new Vector4(0,0,1,1),this.velocity=Vector3.Zero(),this.pivot=Vector3.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.props=null,this.cullingStrategy=AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=Vector3.Zero(),this.idx=e,this.id=t,this._pos=i,this._ind=a,this._model=n,this.shapeId=s,this.idxInShape=r,this._sps=o,l&&(this._modelBoundingInfo=l,this._boundingInfo=new BoundingInfo(l.minimum,l.maximum)),null!==c&&(this.materialIndex=c)}get scale(){return this.scaling}getRotationMatrix(e){let t;if(this.rotationQuaternion)t=this.rotationQuaternion;else{t=TmpVectors.Cc[0];const e=this.rotation;Quaternion.RotationYawPitchRollToRef(e.y,e.x,e.z,t)}t.toRotationMatrix(e)}intersectsMesh(e){return!(!this._boundingInfo||!e.hasBoundingInfo)&&(this._sps._bSphereOnly?BoundingSphere.Intersects(this._boundingInfo.boundingSphere,e.getBoundingInfo().boundingSphere):this._boundingInfo.intersects(e.getBoundingInfo(),!1))}set scale(e){this.scaling=e}set quaternion(e){this.rotationQuaternion=e}get quaternion(){return this.rotationQuaternion}copyToRef(e){return e.position.copyFrom(this.position),e.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(e.rotationQuaternion?e.rotationQuaternion.copyFrom(this.rotationQuaternion):e.rotationQuaternion=this.rotationQuaternion.clone()),e.scaling.copyFrom(this.scaling),this.color&&(e.color?e.color.copyFrom(this.color):e.color=this.color.clone()),e.uvs.copyFrom(this.uvs),e.velocity.copyFrom(this.velocity),e.pivot.copyFrom(this.pivot),e.translateFromPivot=this.translateFromPivot,e.alive=this.alive,e.isVisible=this.isVisible,e.parentId=this.parentId,e.cullingStrategy=this.cullingStrategy,null!==this.materialIndex&&(e.materialIndex=this.materialIndex),this}get hasBoundingInfo(){return null!==this._boundingInfo}getBoundingInfo(){return this._boundingInfo}isInFrustum(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)}},ModelShape=class{constructor(e,t,i,a,n,s,r,o,l){this._indicesLength=0,this.shapeId=e,this._shape=t,this._indices=i,this._indicesLength=i.length,this._shapeUV=s,this._shapeColors=n,this._normals=a,this._positionFunction=r,this._vertexFunction=o,this._material=l}get shapeID(){return this.shapeId}set shapeID(e){this.shapeId=e}},DepthSortedParticle=class{constructor(e,t,i,a){this.idx=0,this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.idx=e,this.ind=t,this.indicesLength=i,this.materialIndex=a}},SolidParticleVertex=class{set z(e){this.position.z=e}set x(e){this.position.x=e}get x(){return this.position.x}constructor(){this.position=Vector3.Zero(),this.color=new Color4(1,1,1,1),this.uv=Vector2.Zero()}get z(){return this.position.z}get y(){return this.position.y}set y(e){this.position.y=e}},SolidParticleSystem=class{get multimaterial(){return this._multimaterial}_resetCopy(){const e=this._copy;e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.copyFromFloats(0,0,1,1),e.color=null,e.translateFromPivot=!1,e.shapeId=0,e.materialIndex=null}recycleParticle(e){return e}addShape(e,t,i){const a=e.getVerticesData(VertexBuffer.PositionKind),n=e.getIndices(),s=e.getVerticesData(VertexBuffer.UVKind),r=e.getVerticesData(VertexBuffer.ColorKind),o=e.getVerticesData(VertexBuffer.NormalKind);this.recomputeNormals=!o;const l=Array.from(n),c=o?Array.from(o):[],h=r?Array.from(r):[],u=i&&i.storage?i.storage:null;let m=null;this._particlesIntersect&&(m=e.getBoundingInfo());const d=this._posToShape(a),f=this._uvsToShapeUV(s),p=i?i.positionFunction:null,_=i?i.vertexFunction:null;let g=null;this._useModelMaterial&&(g=e.material?e.material:this._setDefaultMaterial());const v=new ModelShape(this._shapeCounter,d,l,c,h,f,p,_,g);for(let e=0;e<t;e++)this._insertNewParticle(this.nbParticles,e,v,d,n,s,r,o,m,u,i);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1}set depthSortParticles(e){this._depthSortParticles=e}_sortParticlesByMaterial(){const e=[0];this._indicesByMaterial=e;const t=[];this._materialIndexes=t;const i=this.depthSortedParticles;i.sort(this._materialSortFunction);const a=i.length,n=this._indices32,s=this._indices;let r=0,o=0,l=0,c=i[0].materialIndex;t.push(c),this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(let h=0;h<a;h++){const a=i[h],u=a.indicesLength,m=a.ind;a.materialIndex!==c&&(c=a.materialIndex,e.push(l),t.push(c),this._pickable&&(r++,this.pickedBySubMesh[r]=[],o=0));let d=0;for(let e=0;e<u;e++){if(n[l]=s[m+e],this._pickable){if(0==e%3){const e=this.pickedBySubMesh[r][o];e?(e.idx=a.idx,e.faceId=d):this.pickedBySubMesh[r][o]={idx:a.idx,faceId:d},o++,d++}}l++}}return e.push(n.length),this._updatable&&this.mesh.updateIndices(n),this}_filterUniqueMaterialId(e){return e.filter((function(e,t,i){return i.indexOf(e)===t}))}set isVisibilityBoxLocked(e){this._isVisibilityBoxLocked=e;this.mesh.getBoundingInfo().isLocked=e}insertParticlesFromArray(e){if(!this._expandable)return this;let t=0,i=e[0].shapeId;const a=e.length;for(let n=0;n<a;n++){const a=e[n],s=a._model,r=s._shape,o=s._indices,l=s._shapeUV,c=s._shapeColors,h=s._normals,u=!h;this.recomputeNormals=u||this.recomputeNormals;const m=a.getBoundingInfo(),d=this._insertNewParticle(this.nbParticles,t,s,r,o,l,c,h,m,null,null);a.copyToRef(d),t++,i!=a.shapeId&&(i=a.shapeId,t=0)}return this._isNotBuilt=!0,this}_uvsToShapeUV(e){const t=[];if(e)for(let i=0;i<e.length;i++)t.push(e[i]);return t}get expandable(){return this._expandable}get useModelMaterial(){return this._useModelMaterial}get materials(){return this._materials}setMultiMaterial(e){this._materials=this._filterUniqueMaterialId(e),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new MultiMaterial(this.name+"MultiMaterial",this._scene);for(let e=0;e<this._materials.length;e++)this._multimaterial.subMaterials.push(this._materials[e]);this.computeSubMeshes(),this.mesh.material=this._multimaterial}dispose(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null,this.pickedBySubMesh=null,this._materials=null,this._materialIndexes=null,this._indicesByMaterial=null,this._idxOfId=null}setParticles(e=0,t=this.nbParticles-1,i=!0){if(!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(e,t,i);const a=TmpVectors.Matrix[0],n=TmpVectors.Matrix[1],s=this.mesh,r=this._colors32,o=this._positions32,l=this._normals32,c=this._uvs32,h=this._indices32,u=this._indices,m=this._fixedNormal32,d=this._depthSort&&this._depthSortParticles,f=TmpVectors.Vector3,p=f[5].copyFromFloats(1,0,0),_=f[6].copyFromFloats(0,1,0),g=f[7].copyFromFloats(0,0,1),v=f[8].setAll(Number.MAX_VALUE),y=f[9].setAll(-Number.MAX_VALUE),S=f[10].setAll(0),C=this._tmpVertex,E=C.position,A=C.color,T=C.uv;if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(n)),this.billboard){const e=f[0];this._camera.getDirectionToRef(Axis.Z,e),Vector3.TransformNormalToRef(e,n,g),g.normalize();const t=this._camera.getViewMatrix(!0);Vector3.TransformNormalFromFloatsToRef(t.m[1],t.m[5],t.m[9],n,_),Vector3.CrossToRef(_,g,p),_.normalize(),p.normalize()}this._depthSort&&Vector3.TransformCoordinatesToRef(this._camera.globalPosition,n,S),Matrix.IdentityToRef(a);let M=0,x=0,b=0,w=0,I=0,P=0,R=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),t=t>=this.nbParticles?this.nbParticles-1:t,this._computeBoundingBox&&(0!=e||t!=this.nbParticles-1)){const e=this.mesh.getBoundingInfo();e&&(v.copyFrom(e.minimum),y.copyFrom(e.maximum))}x=this.particles[e]._pos;const N=x/3|0;w=4*N,P=2*N;for(let i=e;i<=t;i++){const e=this.particles[i];this.updateParticle(e);const t=e._model._shape,n=e._model._shapeUV,h=e._rotationMatrix,u=e.position,N=e.rotation,k=e.scaling,D=e._globalPosition;if(d){const t=this.depthSortedParticles[i];t.idx=e.idx,t.ind=e._ind,t.indicesLength=e._model._indicesLength,t.sqDistance=Vector3.DistanceSquared(e.position,S)}if(e.alive&&(!e._stillInvisible||e.isVisible||this._recomputeInvisibles)){if(e.isVisible){e._stillInvisible=!1;const i=f[12];e.pivot.multiplyToRef(k,i),this.billboard&&(N.x=0,N.y=0),(this._computeParticleRotation||this.billboard)&&e.getRotationMatrix(a);if(null!==e.parentId){const t=this.getParticleById(e.parentId);if(t){const e=t._rotationMatrix,i=t._globalPosition,n=u.x*e[1]+u.y*e[4]+u.z*e[7],s=u.x*e[0]+u.y*e[3]+u.z*e[6],r=u.x*e[2]+u.y*e[5]+u.z*e[8];if(D.x=i.x+s,D.y=i.y+n,D.z=i.z+r,this._computeParticleRotation||this.billboard){const t=a.m;h[0]=t[0]*e[0]+t[1]*e[3]+t[2]*e[6],h[1]=t[0]*e[1]+t[1]*e[4]+t[2]*e[7],h[2]=t[0]*e[2]+t[1]*e[5]+t[2]*e[8],h[3]=t[4]*e[0]+t[5]*e[3]+t[6]*e[6],h[4]=t[4]*e[1]+t[5]*e[4]+t[6]*e[7],h[5]=t[4]*e[2]+t[5]*e[5]+t[6]*e[8],h[6]=t[8]*e[0]+t[9]*e[3]+t[10]*e[6],h[7]=t[8]*e[1]+t[9]*e[4]+t[10]*e[7],h[8]=t[8]*e[2]+t[9]*e[5]+t[10]*e[8]}}else e.parentId=null}else if(D.x=u.x,D.y=u.y,D.z=u.z,this._computeParticleRotation||this.billboard){const e=a.m;h[0]=e[0],h[1]=e[1],h[2]=e[2],h[3]=e[4],h[4]=e[5],h[5]=e[6],h[6]=e[8],h[7]=e[9],h[8]=e[10]}const s=f[11];for(e.translateFromPivot?s.setAll(0):s.copyFrom(i),R=0;R<t.length;R++){M=x+3*R,b=w+4*R,I=P+2*R;const a=2*R,r=a+1;E.copyFrom(t[R]),this._computeParticleColor&&e.color&&A.copyFrom(e.color),this._computeParticleTexture&&T.copyFromFloats(n[a],n[r]),this._computeParticleVertex&&this.updateParticleVertex(e,C,R);const u=E.x*k.x-i.x,d=E.y*k.y-i.y,f=E.z*k.z-i.z;let S=u*h[0]+d*h[3]+f*h[6],N=u*h[1]+d*h[4]+f*h[7],B=u*h[2]+d*h[5]+f*h[8];S+=s.x,N+=s.y,B+=s.z;const F=o[M]=D.x+p.x*S+_.x*N+g.x*B,L=o[M+1]=D.y+p.y*S+_.y*N+g.y*B,O=o[M+2]=D.z+p.z*S+_.z*N+g.z*B;if(this._computeBoundingBox&&(v.minimizeInPlaceFromFloats(F,L,O),y.maximizeInPlaceFromFloats(F,L,O)),!this._computeParticleVertex){const e=m[M],t=m[M+1],i=m[M+2],a=e*h[0]+t*h[3]+i*h[6],n=e*h[1]+t*h[4]+i*h[7],s=e*h[2]+t*h[5]+i*h[8];l[M]=p.x*a+_.x*n+g.x*s,l[M+1]=p.y*a+_.y*n+g.y*s,l[M+2]=p.z*a+_.z*n+g.z*s}if(this._computeParticleColor&&e.color){const e=this._colors32;e[b]=A.r,e[b+1]=A.g,e[b+2]=A.b,e[b+3]=A.a}if(this._computeParticleTexture){const t=e.uvs;c[I]=T.x*(t.z-t.x)+t.x,c[I+1]=T.y*(t.w-t.y)+t.y}}}else for(e._stillInvisible=!0,R=0;R<t.length;R++){if(M=x+3*R,b=w+4*R,I=P+2*R,o[M]=o[M+1]=o[M+2]=0,l[M]=l[M+1]=l[M+2]=0,this._computeParticleColor&&e.color){const t=e.color;r[b]=t.r,r[b+1]=t.g,r[b+2]=t.b,r[b+3]=t.a}if(this._computeParticleTexture){const t=e.uvs;c[I]=n[2*R]*(t.z-t.x)+t.x,c[I+1]=n[2*R+1]*(t.w-t.y)+t.y}}if(this._particlesIntersect){const t=e.getBoundingInfo(),i=t.boundingBox,a=t.boundingSphere,n=e._modelBoundingInfo;if(!this._bSphereOnly){const e=n.boundingBox.vectors,t=f[1],a=f[2];t.setAll(Number.MAX_VALUE),a.setAll(-Number.MAX_VALUE);for(let i=0;i<8;i++){const n=e[i].x*k.x,s=e[i].y*k.y,r=e[i].z*k.z,o=n*h[0]+s*h[3]+r*h[6],l=n*h[1]+s*h[4]+r*h[7],c=n*h[2]+s*h[5]+r*h[8],m=u.x+p.x*o+_.x*l+g.x*c,d=u.y+p.y*o+_.y*l+g.y*c,f=u.z+p.z*o+_.z*l+g.z*c;t.minimizeInPlaceFromFloats(m,d,f),a.maximizeInPlaceFromFloats(m,d,f)}i.reConstruct(t,a,s._worldMatrix)}const r=n.minimum.multiplyToRef(k,f[1]),o=n.maximum.multiplyToRef(k,f[2]),l=o.addToRef(r,f[3]).scaleInPlace(.5).addInPlace(D),c=o.subtractToRef(r,f[4]).scaleInPlace(.5*this._bSphereRadiusFactor),m=l.subtractToRef(c,f[1]),d=l.addToRef(c,f[2]);a.reConstruct(m,d,s._worldMatrix)}x=M+3,w=b+4,P=I+2}else R=t.length,x+=3*R,w+=4*R,P+=2*R}if(i){if(this._computeParticleColor){const e=s.getVertexBuffer(VertexBuffer.ColorKind);e&&!s.isPickable?e.updateDirectly(r,0):s.updateVerticesData(VertexBuffer.ColorKind,r,!1,!1)}if(this._computeParticleTexture){const e=s.getVertexBuffer(VertexBuffer.UVKind);e&&!s.isPickable?e.updateDirectly(c,0):s.updateVerticesData(VertexBuffer.UVKind,c,!1,!1)}const e=s.getVertexBuffer(VertexBuffer.PositionKind);if(e&&!s.isPickable?e.updateDirectly(o,0):s.updateVerticesData(VertexBuffer.PositionKind,o,!1,!1),!s.areNormalsFrozen||s.isFacetDataEnabled){if(this._computeParticleVertex||s.isFacetDataEnabled){const e=s.isFacetDataEnabled?s.getFacetDataParameters():null;VertexData.ComputeNormals(o,h,l,e);for(let e=0;e<l.length;e++)m[e]=l[e]}if(!s.areNormalsFrozen){const e=s.getVertexBuffer(VertexBuffer.NormalKind);e&&!s.isPickable?e.updateDirectly(l,0):s.updateVerticesData(VertexBuffer.NormalKind,l,!1,!1)}}if(d){const e=this.depthSortedParticles;e.sort(this._depthSortFunction);const t=e.length;let i=0,a=0;for(let n=0;n<t;n++){const t=e[n],s=t.indicesLength,r=t.ind;for(let e=0;e<s;e++)if(h[i]=u[r+e],i++,this._pickable){if(0==e%3){const e=this.pickedParticles[a];e.idx=t.idx,e.faceId=a,a++}}}}if(this._autoFixFaceOrientation){let e=0;for(let t=0;t<this.particles.length;t++){const i=d?this.particles[this.depthSortedParticles[t].idx]:this.particles[t];if(i.scale.x*i.scale.y*i.scale.z<0)for(let t=0;t<i._model._indicesLength;t+=3){const a=u[i._ind+t];h[e+t]=u[i._ind+t+1],h[e+t+1]=a}e+=i._model._indicesLength}}(d||this._autoFixFaceOrientation)&&s.updateIndices(h)}return this._computeBoundingBox&&(s.hasBoundingInfo?s.getBoundingInfo().reConstruct(v,y,s._worldMatrix):s.buildBoundingInfo(v,y,s._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this._recomputeInvisibles=!1,this.afterUpdateParticles(e,t,i),this}set autoUpdateSubMeshes(e){this._autoUpdateSubMeshes=e}constructor(e,t,i){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new SolidParticle(0,0,0,0,null,0,0,this),this._color=new Color4(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._autoFixFaceOrientation=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=(e,t)=>t.sqDistance-e.sqDistance,this._materialSortFunction=(e,t)=>e.materialIndex-t.materialIndex,this._autoUpdateSubMeshes=!1,this._recomputeInvisibles=!1,this.name=e,this._scene=t||EngineStore.LastCreatedScene,this._camera=t.activeCamera,this._pickable=!!i&&i.isPickable,this._depthSort=!!i&&i.enableDepthSort,this._multimaterialEnabled=!!i&&i.enableMultiMaterial,this._useModelMaterial=!!i&&i.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!i&&i.expandable,this._particlesIntersect=!!i&&i.particleIntersection,this._bSphereOnly=!!i&&i.boundingSphereOnly,this._bSphereRadiusFactor=i&&i.bSphereRadiusFactor?i.bSphereRadiusFactor:1,this._computeBoundingBox=!!i?.computeBoundingBox&&i.computeBoundingBox,this._autoFixFaceOrientation=!!i?.autoFixFaceOrientation&&i.autoFixFaceOrientation,i&&void 0!==i.updatable?this._updatable=i.updatable:this._updatable=!0,this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new MultiMaterial(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={}),this._tmpVertex=new SolidParticleVertex}get computeParticleRotation(){return this._computeParticleRotation}_setMaterialIndexesById(){this._materialIndexesById={};for(let e=0;e<this._materials.length;e++){const t=this._materials[e].Hc;this._materialIndexesById[t]=e}}set isAlwaysVisible(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e}beforeUpdateParticles(e,t,i){}set computeParticleRotation(e){this._computeParticleRotation=e}set computeParticleColor(e){this._computeParticleColor=e}get depthSortParticles(){return this._depthSortParticles}set computeParticleVertex(e){this._computeParticleVertex=e}get isAlwaysVisible(){return this._alwaysVisible}get computeParticleTexture(){return this._computeParticleTexture}set computeParticleTexture(e){this._computeParticleTexture=e}getParticleById(e){const t=this.particles[e];if(t&&t.id==e)return t;const i=this.particles,a=this._idxOfId[e];if(void 0!==a)return i[a];let n=0;const s=this.nbParticles;for(;n<s;){const t=i[n];if(t.id==e)return t;n++}return null}_setDefaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=new StandardMaterial(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial}_insertNewParticle(e,t,i,a,n,s,r,o,l,c,h){const u=this._positions.length,m=this._indices.length,d=this._meshBuilder(this._index,m,a,this._positions,n,this._indices,s,this._uvs,r,this._colors,o,this._normals,e,t,h,i);let f=null;return this._updatable&&(f=this._addParticle(this.nbParticles,this._lastParticleId,u,m,i,this._shapeCounter,t,l,c),f.position.copyFrom(d.position),f.rotation.copyFrom(d.rotation),d.rotationQuaternion&&(f.rotationQuaternion?f.rotationQuaternion.copyFrom(d.rotationQuaternion):f.rotationQuaternion=d.rotationQuaternion.clone()),d.color&&(f.color?f.color.copyFrom(d.color):f.color=d.color.clone()),f.scaling.copyFrom(d.scaling),f.uvs.copyFrom(d.uvs),null!==d.materialIndex&&(f.materialIndex=d.materialIndex),this.expandable&&(this._idxOfId[f.id]=f.idx)),c||(this._index+=a.length,this.nbParticles++,this._lastParticleId++),f}set multimaterial(e){this._multimaterial=e}initParticles(){}digest(e,t){let i=t&&t.facetNb||1,a=t&&t.number||0,n=t&&t.delta||0;const s=e.getVerticesData(VertexBuffer.PositionKind),r=e.getIndices(),o=e.getVerticesData(this._getUVKind(e,t?.uvKind??0)),l=e.getVerticesData(VertexBuffer.ColorKind),c=e.getVerticesData(VertexBuffer.NormalKind),h=t&&t.storage?t.storage:null;let u=0;const m=r.length/3;a?(a=a>m?m:a,i=Math.round(m/a),n=0):i=i>m?m:i;const d=[],f=[],p=[],_=[],g=[],v=Vector3.Zero(),y=i;for(;u<m;){i=y+Math.floor((1+n)*Math.random()),u>m-i&&(i=m-u),d.length=0,f.length=0,p.length=0,_.length=0,g.length=0;let t=0;for(let e=3*u;e<3*(u+i);e++){p.push(t);const i=r[e],a=3*i;if(d.push(s[a],s[a+1],s[a+2]),f.push(c[a],c[a+1],c[a+2]),o){const e=2*i;_.push(o[e],o[e+1])}if(l){const e=4*i;g.push(l[e],l[e+1],l[e+2],l[e+3])}t++}let a=this.nbParticles;const S=this._posToShape(d),C=this._uvsToShapeUV(_),E=p.slice(),A=g.slice(),T=f.slice();let M;for(v.copyFromFloats(0,0,0),M=0;M<S.length;M++)v.addInPlace(S[M]);v.scaleInPlace(1/S.length);const x=new Vector3(1/0,1/0,1/0),b=new Vector3(-1/0,-1/0,-1/0);for(M=0;M<S.length;M++)S[M].subtractInPlace(v),x.minimizeInPlaceFromFloats(S[M].x,S[M].y,S[M].z),b.maximizeInPlaceFromFloats(S[M].x,S[M].y,S[M].z);let w;this._particlesIntersect&&(w=new BoundingInfo(x,b));let I=null;this._useModelMaterial&&(I=e.material?e.material:this._setDefaultMaterial());const P=new ModelShape(this._shapeCounter,S,E,T,A,C,null,null,I),R=this._positions.length,N=this._indices.length;this._meshBuilder(this._index,N,S,this._positions,E,this._indices,_,this._uvs,A,this._colors,T,this._normals,a,0,null,P),this._addParticle(a,this._lastParticleId,R,N,P,this._shapeCounter,0,w,h),this.particles[this.nbParticles].position.addInPlace(v),h||(this._index+=S.length,a++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,u+=i}return this._isNotBuilt=!0,this}refreshVisibleSize(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this}removeParticles(e,t){const i=t-e+1;if(!this._expandable||i<=0||i>=this.nbParticles||!this._updatable)return[];const a=this.particles,n=this.nbParticles;if(t<n-1){const i=t+1,s=a[i]._pos-a[e]._pos,r=a[i]._ind-a[e]._ind;for(let e=i;e<n;e++){const t=a[e];t._pos-=s,t._ind-=r}}const s=a.splice(e,i);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);let r=0;const o=a.length;for(let e=0;e<o;e++){const t=a[e],i=t._model,n=i._shape,s=i._indices,o=i._normals,l=i._shapeColors,c=i._shapeUV;t.idx=e,this._idxOfId[t.id]=e,this._meshBuilder(this._index,r,n,this._positions,s,this._indices,c,this._uvs,l,this._colors,o,this._normals,t.idx,t.idxInShape,null,i),this._index+=n.length,r+=s.length}return this.nbParticles-=i,this._isNotBuilt=!0,s}_posToShape(e){const t=[];for(let i=0;i<e.length;i+=3)t.push(Vector3.FromArray(e,i));return t}get autoUpdateSubMeshes(){return this._autoUpdateSubMeshes}getParticlesByShapeIdToRef(e,t){t.length=0;for(let i=0;i<this.nbParticles;i++){const a=this.particles[i];a.shapeId==e&&t.push(a)}return this}get isVisibilityBoxLocked(){return this._isVisibilityBoxLocked}updateParticleVertex(e,t,i){return this}afterUpdateParticles(e,t,i){}_unrotateFixedNormals(){let e=0,t=0;const i=TmpVectors.Vector3[0],a=TmpVectors.Cc[0],n=TmpVectors.Matrix[0];for(let s=0;s<this.particles.length;s++){const r=this.particles[s],o=r._model._shape;if(r.rotationQuaternion)r.rotationQuaternion.conjugateToRef(a);else{const e=r.rotation;Quaternion.RotationYawPitchRollToRef(e.y,e.x,e.z,a),a.conjugateInPlace()}a.toRotationMatrix(n);for(let a=0;a<o.length;a++)t=e+3*a,Vector3.TransformNormalFromFloatsToRef(this._normals32[t],this._normals32[t+1],this._normals32[t+2],n,i),i.toArray(this._fixedNormal32,t);e=t+3}}_meshBuilder(e,t,i,a,n,s,r,o,l,c,h,u,m,d,f,p){let _,g=0,v=0,y=0;this._resetCopy();const S=this._copy,C=!(!f||!f.storage);if(S.idx=m,S.idxInShape=d,S.shapeId=p.shapeId,this._useModelMaterial){const e=p._material.Hc,t=this._materialIndexesById;Object.prototype.hasOwnProperty.call(t,e)||(t[e]=this._materials.length,this._materials.push(p._material));const i=t[e];S.materialIndex=i}if(f&&f.positionFunction&&(f.positionFunction(S,m,d),this._mustUnrotateFixedNormals=!0),C)return S;const E=TmpVectors.Matrix[0],A=this._tmpVertex,T=A.position,M=A.color,x=A.uv,b=TmpVectors.Vector3[1],w=TmpVectors.Vector3[2],I=TmpVectors.Vector3[3];Matrix.IdentityToRef(E),S.getRotationMatrix(E),S.pivot.multiplyToRef(S.scaling,I),S.translateFromPivot?w.setAll(0):w.copyFrom(I);const P=f&&f.vertexFunction;for(_=0;_<i.length;_++){if(T.copyFrom(i[_]),S.color&&M.copyFrom(S.color),r&&x.copyFromFloats(r[g],r[g+1]),P&&f.vertexFunction(S,A,_),T.multiplyInPlace(S.scaling).subtractInPlace(I),Vector3.TransformCoordinatesToRef(T,E,b),b.addInPlace(w).addInPlace(S.position),a.push(b.x,b.y,b.z),r){const e=S.uvs;o.push((e.z-e.x)*x.x+e.x,(e.w-e.y)*x.y+e.y),g+=2}if(S.color)this._color.copyFrom(M);else{const e=this._color;l&&void 0!==l[v]?(e.r=l[v],e.g=l[v+1],e.b=l[v+2],e.a=l[v+3]):(e.r=1,e.g=1,e.b=1,e.a=1)}c.push(this._color.r,this._color.g,this._color.b,this._color.a),v+=4,!this.recomputeNormals&&h&&(Vector3.TransformNormalFromFloatsToRef(h[y],h[y+1],h[y+2],E,T),u.push(T.x,T.y,T.z),y+=3)}for(_=0;_<n.length;_++){const t=e+n[_];s.push(t),t>65535&&(this._needs32Bits=!0)}if(this._depthSort||this._multimaterialEnabled){const e=null!==S.materialIndex?S.materialIndex:0;this.depthSortedParticles.push(new DepthSortedParticle(m,t,n.length,e))}return S}_getUVKind(e,t){return-1===t&&(e.material?.diffuseTexture?t=e.material.diffuseTexture.coordinatesIndex:e.material?.albedoTexture&&(t=e.material.albedoTexture.coordinatesIndex)),"uv"+(t?t+1:"")}set computeBoundingBox(e){this._computeBoundingBox=e}rebuildMesh(e=!1){for(let t=0;t<this.particles.length;t++)this._rebuildParticle(this.particles[t],e);return this.mesh.updateVerticesData(VertexBuffer.PositionKind,this._positions32,!1,!1),this}get computeParticleVertex(){return this._computeParticleVertex}computeSubMeshes(){if(!this.mesh||!this._multimaterialEnabled)return this;const e=this.depthSortedParticles;if(this.particles.length>0)for(let t=0;t<this.particles.length;t++){const i=this.particles[t];i.materialIndex||(i.materialIndex=0);const a=e[t];a.materialIndex=i.materialIndex,a.ind=i._ind,a.indicesLength=i._model._indicesLength,a.idx=i.idx}this._sortParticlesByMaterial();const t=this._indicesByMaterial,i=this._materialIndexes,a=this.mesh;a.subMeshes=[];const n=a.getTotalVertices();for(let e=0;e<i.length;e++){const s=t[e],r=t[e+1]-s,o=i[e];new SubMesh(o,0,n,s,r,a)}return this}updateParticle(e){return e}pickedParticle(e){if(e.hit){const t=e.subMeshId,i=e.faceId-this.mesh.subMeshes[t].indexStart/3,a=this.pickedBySubMesh;if(a[t]&&a[t][i])return a[t][i]}return null}_addParticle(e,t,i,a,n,s,r,o=null,l=null){const c=new SolidParticle(e,t,i,a,n,s,r,this,o);return(l||this.particles).push(c),c}setVisibilityBox(e){const t=e/2;this.mesh.buildBoundingInfo(new Vector3(-t,-t,-t),new Vector3(t,t,t))}getParticlesByShapeId(e){const t=[];return this.getParticlesByShapeIdToRef(e,t),t}buildMesh(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){const e=CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(e,1),e.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){const e=new Mesh(this.name,this._scene);this.mesh=e}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&VertexData.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();const e=new VertexData;if(e.indices=this._depthSort?this._indices:this._indices32,e.set(this._positions32,VertexBuffer.PositionKind),e.set(this._normals32,VertexBuffer.NormalKind),this._uvs32.length>0&&e.set(this._uvs32,VertexBuffer.UVKind),this._colors32.length>0&&e.set(this._colors32,VertexBuffer.ColorKind),e.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._pickable){let e=0;for(let t=0;t<this.nbParticles;t++){const i=this.particles[t],a=i._model._indicesLength;for(let t=0;t<a;t++){if(0==t%3){const t={idx:i.idx,faceId:e};this.pickedParticles[e]=t,e++}}}}return this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||this._autoFixFaceOrientation||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this._recomputeInvisibles=!0,this.mesh}get computeParticleColor(){return this._computeParticleColor}get computeBoundingBox(){return this._computeBoundingBox}get multimaterialEnabled(){return this._multimaterialEnabled}_rebuildParticle(e,t=!1){this._resetCopy();const i=this._copy;e._model._positionFunction&&e._model._positionFunction(i,e.idx,e.idxInShape);const a=TmpVectors.Matrix[0],n=TmpVectors.Vector3[0],s=TmpVectors.Vector3[1],r=TmpVectors.Vector3[2],o=TmpVectors.Vector3[3];i.getRotationMatrix(a),e.pivot.multiplyToRef(e.scaling,o),i.translateFromPivot?r.copyFromFloats(0,0,0):r.copyFrom(o);const l=e._model._shape;for(let t=0;t<l.length;t++)n.copyFrom(l[t]),e._model._vertexFunction&&e._model._vertexFunction(i,n,t),n.multiplyInPlace(i.scaling).subtractInPlace(o),Vector3.TransformCoordinatesToRef(n,a,s),s.addInPlace(r).addInPlace(i.position).toArray(this._positions32,e._pos+3*t);t&&(e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.setAll(0),e.pivot.setAll(0),e.translateFromPivot=!1,e.parentId=null)}},RuntimeAnimation=class{constructor(e,t,i,a){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=t,this._target=e,this._scene=i,this._host=a,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===Animation.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=Matrix.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const e={frame:0,value:this._minValue};this._keys.splice(0,0,e)}if(this._target instanceof Array){let e=0;for(const t of this._target)this._preparePath(t,e),this._getOriginalValues(e),e++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const n=t.getEvents();n&&n.length>0&&n.forEach((e=>{this._events.push(e._clone())})),this._enableBlending=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.enableBlending:this._animation.enableBlending}get weight(){return this._weight}get animation(){return this._animation}_preparePath(e,t=0){const i=this._animation.targetPropertyPath;if(i.length>1){let a=e;for(let e=0;e<i.length-1;e++){const t=i[e];if(a=a[t],void 0===a)throw new Error(`Invalid property (${t}) in property path (${i.join(".")})`)}this._targetPath=i[i.length-1],this._activeTargets[t]=a}else this._targetPath=i[0],this._activeTargets[t]=e;if(void 0===this._activeTargets[t][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${i.join(".")})`)}setValue(e,t){if(this._targetIsArray)for(let i=0;i<this._target.length;i++){const a=this._target[i];this._setValue(a,this._activeTargets[i],e,t,i)}else this._setValue(this._target,this._directTarget,e,t,0)}get target(){return this._currentActiveTarget}reset(e=!1){if(e)if(this._target instanceof Array){let e=0;for(const t of this._target)void 0!==this._originalValue[e]&&this._setValue(t,this._activeTargets[e],this._originalValue[e],-1,e),e++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let e=0;e<this._events.length;e++)this._events[e].isDone=!1}_prepareForSpeedRatioChange(e){const t=this._previousElapsedTime*(this._animation.framePerSecond*e)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-t}goToFrame(e,t=-1){const i=this._animation.getKeys();e<i[0].frame?e=i[0].frame:e>i[i.length-1].frame&&(e=i[i.length-1].frame);const a=this._events;if(a.length)for(let t=0;t<a.length;t++)a[t].onlyOnce||(a[t].isDone=a[t].frame<e);this._currentFrame=e;const n=this._animation._interpolate(e,this._animationState);this.setValue(n,t)}_setValue(e,t,i,a,n){if(this._currentActiveTarget=t,this._weight=a,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const e=t[this._targetPath];e.clone?this._originalBlendValue=e.clone():this._originalBlendValue=e}this._originalBlendValue.m?Animation.AllowMatrixDecomposeForInterpolation?this._currentValue?Matrix.DecomposeLerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=Matrix.DecomposeLerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue?Matrix.LerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=Matrix.Lerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue=Animation._UniversalLerp(this._originalBlendValue,i,this._blendingFactor);const a=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=a}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(i):this._currentValue=i:this._currentValue=i?.clone?i.clone():i;-1!==a?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[n]):this._animationState.loopMode===Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[n],t[this._targetPath]):t[this._targetPath]=this._originalValue[n]+this._currentValue:t[this._targetPath]=this._currentValue,e.markAsDirty&&e.markAsDirty(this._animation.targetProperty)}isStopped(){return this._stopped}get isAdditive(){return this._host&&this._host.isAdditive}get currentFrame(){return this._currentFrame}animate(e,t,i,a,n,s=-1){const r=this._animation,o=r.targetPropertyPath;if(!o||o.length<1)return this._stopped=!0,!1;let l=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(i<this._minFrame||i>this._maxFrame)&&(i=this._maxFrame);const c=i-t;let h,u=e*(r.framePerSecond*n)/1e3+this._absoluteFrameOffset,m=0,d=!1;const f=a&&this._animationState.loopMode===Animation.ANIMATIONLOOPMODE_YOYO;if(f){const e=(u-t)/c,i=Math.sin(e*Math.PI);u=Math.abs(i)*c+t;const a=i>=0?1:-1;this._yoyoDirection!==a&&(d=!0),this._yoyoDirection=a}if(this._previousElapsedTime=e,this._previousAbsoluteFrame=u,!a&&i>=t&&(u>=c&&n>0||u<=0&&n<0))l=!1,m=r._getKeyValue(this._maxValue);else if(!a&&t>=i&&(u<=c&&n<0||u>=0&&n>0))l=!1,m=r._getKeyValue(this._minValue);else if(this._animationState.loopMode!==Animation.ANIMATIONLOOPMODE_CYCLE){const e=i.toString()+t.toString();if(!this._offsetsCache[e]){this._animationState.repeatCount=0,this._animationState.loopMode=Animation.ANIMATIONLOOPMODE_CYCLE;const a=r._interpolate(t,this._animationState),n=r._interpolate(i,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),r.dataType){case Animation.ANIMATIONTYPE_FLOAT:this._offsetsCache[e]=n-a;break;case Animation.ANIMATIONTYPE_QUATERNION:case Animation.ANIMATIONTYPE_VECTOR3:case Animation.ANIMATIONTYPE_VECTOR2:case Animation.ANIMATIONTYPE_SIZE:case Animation.ANIMATIONTYPE_COLOR3:this._offsetsCache[e]=n.subtract(a)}this._highLimitsCache[e]=n}m=this._highLimitsCache[e],h=this._offsetsCache[e]}if(void 0===h)switch(r.dataType){case Animation.ANIMATIONTYPE_FLOAT:h=0;break;case Animation.ANIMATIONTYPE_QUATERNION:h=_staticOffsetValueQuaternion;break;case Animation.ANIMATIONTYPE_VECTOR3:h=_staticOffsetValueVector3;break;case Animation.ANIMATIONTYPE_VECTOR2:h=_staticOffsetValueVector2;break;case Animation.ANIMATIONTYPE_SIZE:h=_staticOffsetValueSize;break;case Animation.ANIMATIONTYPE_COLOR3:h=_staticOffsetValueColor3;break;case Animation.ANIMATIONTYPE_COLOR4:h=_staticOffsetValueColor4}let p;if(this._host&&this._host.syncRoot){const e=this._host.syncRoot;p=t+c*((e.masterFrame-e.fromFrame)/(e.toFrame-e.fromFrame))}else p=u>0&&t>i||u<0&&t<i?l&&0!==c?i+u%c:t:l&&0!==c?t+u%c:i;const _=this._events;if(!f&&(n>0&&this.currentFrame>p||n<0&&this.currentFrame<p)||f&&d){this._onLoop();for(let e=0;e<_.length;e++)_[e].onlyOnce||(_[e].isDone=!1);this._animationState.key=n>0?0:r.getKeys().length-1}this._currentFrame=p,this._animationState.repeatCount=0===c?0:u/c|0,this._animationState.highLimitValue=m,this._animationState.offsetValue=h;const g=r._interpolate(p,this._animationState);if(this.setValue(g,s),_.length)for(let e=0;e<_.length;e++)if(c>=0&&p>=_[e].frame&&_[e].frame>=t||c<0&&p<=_[e].frame&&_[e].frame<=t){const t=_[e];t.isDone||(t.onlyOnce&&(_.splice(e,1),e--),t.isDone=!0,t.action(p))}return l||(this._stopped=!0),l}_getOriginalValues(e=0){let t;const i=this._activeTargets[e];t=i.getLocalMatrix&&"_matrix"===this._targetPath?i.getLocalMatrix():i[this._targetPath],t&&t.clone?this._originalValue[e]=t.clone():this._originalValue[e]=t}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}get currentValue(){return this._currentValue}dispose(){const e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)}get targetPath(){return this._targetPath}},Animatable=class{goToFrame(e){const t=this._runtimeAnimations;if(t[0]){const i=t[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??t[0].currentFrame;const a=0===this.speedRatio?0:(e-this._frameToSyncFromJump)/i*1e3/this.speedRatio;this._manualJumpDelay=-a}for(let i=0;i<t.length;i++)t[i].goToFrame(e,this._weight);this._goToFrame=e}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}getAnimations(){return this._runtimeAnimations}get speedRatio(){return this._speedRatio}get weight(){return this._weight}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}disableBlending(){const e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].animation.enableBlending=!1}reset(){const e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}get syncRoot(){return this._syncRoot}getAnimationByTargetProperty(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i].animation;return null}stop(e,t,i=!1,a=!1){if(e||t){const n=this._scene._activeAnimatables.indexOf(this);if(n>-1){const s=this._runtimeAnimations;for(let i=s.length-1;i>=0;i--){const a=s[i];e&&a.animation.name!=e||(t&&!t(a.target)||(a.dispose(),s.splice(i,1)))}0==s.length&&(i||this._scene._activeAnimatables.splice(n,1),a||this._raiseOnAnimationEnd())}}else{const e=this._scene._activeAnimatables.indexOf(this);if(e>-1){i||this._scene._activeAnimatables.splice(e,1);const t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].dispose();this._runtimeAnimations.length=0,a||this._raiseOnAnimationEnd()}}}getRuntimeAnimationByTargetProperty(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i];return null}restart(){this._paused=!1}enableBlending(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)t[i].animation.enableBlending=!0,t[i].animation.blendingSpeed=e}syncWith(e){if(this._syncRoot=e,e){const e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this}get paused(){return this._paused}pause(){this._paused||(this._paused=!0)}appendAnimations(e,t){for(let i=0;i<t.length;i++){const a=t[i],n=new RuntimeAnimation(e,a,this._scene,this);n._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(n)}}waitAsync(){return new Promise((e=>{this.onAnimationEndObservable.add((()=>{e(this)}),void 0,void 0,this,!0)}))}set speedRatio(e){for(let t=0;t<this._runtimeAnimations.length;t++){this._runtimeAnimations[t]._prepareForSpeedRatioChange(e)}this._speedRatio=e,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}_animate(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight)return!0;let t=!1;const i=this._runtimeAnimations;let a;for(a=0;a<i.length;a++){const n=i[a].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);t=t||n}if(this.animationStarted=t,!t){if(this.disposeOnEnd)for(a=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(a,1),a=0;a<i.length;a++)i[a].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return t}constructor(e,t,i=0,a=100,n=!1,s=1,r,o,l,c=!1,h=0){this.target=t,this.fromFrame=i,this.toFrame=a,this.loopAnimation=n,this.onAnimationEnd=r,this.onAnimationLoop=l,this.isAdditive=c,this.playOrder=h,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new Observable,this.onAnimationLoopObservable=new Observable,this._scene=e,o&&this.appendAnimations(t,o),this._speedRatio=s,e._activeAnimatables.push(this)}set weight(e){this._weight=-1!==e?Math.min(Math.max(e,0),1):-1}};Scene.prototype._animate=function(e){if(!this.animationsEnabled)return;const t=PrecisionDate.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}this.deltaTime=void 0!==e?e:this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=t;const i=this._activeAnimatables;if(0===i.length)return;this._animationTime+=this.deltaTime;const a=this._animationTime;for(let e=0;e<i.length;e++){const t=i[e];!t._animate(a)&&t.disposeOnEnd&&e--}this._processLateAnimationBindings()},Scene.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((e,t)=>e.playOrder-t.playOrder))},Scene.prototype.beginWeightedAnimation=function(e,t,i,a=1,n,s=1,r,o,l,c,h=!1){const u=this.beginAnimation(e,t,i,n,s,r,o,!1,l,c,h);return u.weight=a,u},Scene.prototype.beginAnimation=function(e,t,i,a,n=1,s,r,o=!0,l,c,h=!1){t>i&&n>0&&(n*=-1),o&&this.stopAnimation(e,void 0,l),r||(r=new Animatable(this,e,t,i,a,n,s,void 0,c,h));const u=!l||l(e);if(e.animations&&u&&r.appendAnimations(e,e.animations),e.getAnimatables){const h=e.getAnimatables();for(let e=0;e<h.length;e++)this.beginAnimation(h[e],t,i,a,n,s,r,o,l,c)}return r.reset(),r},Scene.prototype.beginHierarchyAnimation=function(e,t,i,a,n,s=1,r,o,l=!0,c,h,u=!1){const m=e.getDescendants(t),d=[];d.push(this.beginAnimation(e,i,a,n,s,r,o,l,c,void 0,u));for(const e of m)d.push(this.beginAnimation(e,i,a,n,s,r,o,l,c,void 0,u));return d},Scene.prototype.beginDirectAnimation=function(e,t,i,a,n,s,r,o,l=!1){if(void 0===s&&(s=1),i>a&&s>0)s*=-1;else if(a>i&&s<0){const e=a;a=i,i=e}return new Animatable(this,e,i,a,n,s,r,t,o,l)},Scene.prototype.beginDirectHierarchyAnimation=function(e,t,i,a,n,s,r,o,l,c=!1){const h=e.getDescendants(t),u=[];u.push(this.beginDirectAnimation(e,i,a,n,s,r,o,l,c));for(const e of h)u.push(this.beginDirectAnimation(e,i,a,n,s,r,o,l,c));return u},Scene.prototype.getAnimatableByTarget=function(e){for(let t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},Scene.prototype.getAllAnimatablesByTarget=function(e){const t=[];for(let i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].target===e&&t.push(this._activeAnimatables[i]);return t},Scene.prototype.stopAnimation=function(e,t,i){const a=this.getAllAnimatablesByTarget(e);for(const e of a)e.stop(t,i)},Scene.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const e of this.animationGroups)e.stop()},Scene.prototype._registerTargetForLateAnimationBinding=function(e,t){const i=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[e.targetPath]||(i._lateAnimationHolders[e.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:t}),e.isAdditive?(i._lateAnimationHolders[e.targetPath].additiveAnimations.push(e),i._lateAnimationHolders[e.targetPath].totalAdditiveWeight+=e.weight):(i._lateAnimationHolders[e.targetPath].animations.push(e),i._lateAnimationHolders[e.targetPath].totalWeight+=e.weight)},Scene.prototype._processLateAnimationBindingsForMatrices=function(e){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return e.originalValue;let t=1;const i=TmpVectors.Vector3[0],a=TmpVectors.Vector3[1],n=TmpVectors.Cc[0];let s=0;const r=e.animations[0],o=e.originalValue;let l=1,c=!1;if(e.totalWeight<1)l=1-e.totalWeight,o.decompose(a,n,i);else{if(s=1,t=e.totalWeight,l=r.weight/t,1==l){if(!e.totalAdditiveWeight)return r.currentValue;c=!0}r.currentValue.decompose(a,n,i)}if(!c){a.scaleInPlace(l),i.scaleInPlace(l),n.scaleInPlace(l);for(let r=s;r<e.animations.length;r++){const s=e.animations[r];if(0===s.weight)continue;l=s.weight/t;const o=TmpVectors.Vector3[2],c=TmpVectors.Vector3[3],h=TmpVectors.Cc[1];s.currentValue.decompose(c,h,o),c.scaleAndAddToRef(l,a),h.scaleAndAddToRef(Quaternion.Dot(n,h)>0?l:-l,n),o.scaleAndAddToRef(l,i)}n.normalize()}for(let t=0;t<e.additiveAnimations.length;t++){const s=e.additiveAnimations[t];if(0===s.weight)continue;const r=TmpVectors.Vector3[2],o=TmpVectors.Vector3[3],l=TmpVectors.Cc[1];s.currentValue.decompose(o,l,r),o.multiplyToRef(a,o),Vector3.LerpToRef(a,o,s.weight,a),n.multiplyToRef(l,l),Quaternion.SlerpToRef(n,l,s.weight,n),r.scaleAndAddToRef(s.weight,i)}const h=r?r._animationState.workValue:TmpVectors.Matrix[0].clone();return Matrix.ComposeToRef(a,n,i,h),h},Scene.prototype._processLateAnimationBindingsForQuaternions=function(e,t){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return t;const i=e.animations[0],a=e.originalValue;let n=t;if(0===e.totalWeight&&e.totalAdditiveWeight>0)n.copyFrom(a);else if(1===e.animations.length){if(Quaternion.SlerpToRef(a,i.currentValue,Math.min(1,e.totalWeight),n),0===e.totalAdditiveWeight)return n}else if(e.animations.length>1){let i,s,r=1;if(e.totalWeight<1){const t=1-e.totalWeight;i=[],s=[],i.push(a),s.push(t)}else{if(2===e.animations.length&&(Quaternion.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),0===e.totalAdditiveWeight))return t;i=[],s=[],r=e.totalWeight}for(let t=0;t<e.animations.length;t++){const a=e.animations[t];i.push(a.currentValue),s.push(a.weight/r)}let o=0;for(let e=0;e<i.length;)e?(o+=s[e],Quaternion.SlerpToRef(n,i[e],s[e]/o,n),e++):(Quaternion.SlerpToRef(i[e],i[e+1],s[e+1]/(s[e]+s[e+1]),t),n=t,o=s[e]+s[e+1],e+=2)}for(let t=0;t<e.additiveAnimations.length;t++){const i=e.additiveAnimations[t];0!==i.weight&&(n.multiplyToRef(i.currentValue,TmpVectors.Cc[0]),Quaternion.SlerpToRef(n,TmpVectors.Cc[0],i.weight,n))}return n},Scene.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(let e=0;e<this._registeredForLateAnimationBindings.length;e++){const t=this._registeredForLateAnimationBindings.data[e];for(const e in t._lateAnimationHolders){const i=t._lateAnimationHolders[e],a=i.animations[0],n=i.originalValue;if(null==n)continue;const s=Animation.AllowMatrixDecomposeForInterpolation&&n.m;let r=t[e];if(s)r=this._processLateAnimationBindingsForMatrices(i);else{if(void 0!==n.w)r=this._processLateAnimationBindingsForQuaternions(i,r||Quaternion.Identity());else{let e=0,t=1;const s=a&&a._animationState.loopMode===Animation.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(i.totalWeight<1)r=s?n.clone?n.clone():n:a&&n.scale?n.scale(1-i.totalWeight):a?n*(1-i.totalWeight):n.clone?n.clone():n;else if(a){t=i.totalWeight;const o=a.weight/t;r=1!==o?a.currentValue.scale?a.currentValue.scale(o):a.currentValue*o:a.currentValue,s&&(r.addToRef?r.addToRef(n,r):r+=n),e=1}for(let a=e;a<i.animations.length;a++){const e=i.animations[a],n=e.weight/t;n&&(e.currentValue.scaleAndAddToRef?e.currentValue.scaleAndAddToRef(n,r):r+=e.currentValue*n)}for(let e=0;e<i.additiveAnimations.length;e++){const t=i.additiveAnimations[e],a=t.weight;a&&(t.currentValue.scaleAndAddToRef?t.currentValue.scaleAndAddToRef(a,r):r+=t.currentValue*a)}}}t[e]=r}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},Bone.prototype.copyAnimationRange=function(e,t,i,a=!1,n=null){0===this.animations.length&&(this.animations.push(new Animation(this.name,"_matrix",e.animations[0].framePerSecond,Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const s=e.animations[0].getRange(t);if(!s)return!1;const r=s.from,o=s.to,l=e.animations[0].getKeys(),c=e.length,h=e.getParent(),u=this.getParent(),m=a&&h&&c&&this.length&&c!==this.length,d=m&&u&&h?u.length/h.length:1,f=a&&!u&&n&&(1!==n.x||1!==n.y||1!==n.z),p=this.animations[0].getKeys();let _,g,v;for(let e=0,t=l.length;e<t;e++)_=l[e],_.frame>=r&&_.frame<=o&&(a?(v=_.value.clone(),m?(g=v.getTranslation(),v.setTranslation(g.scaleInPlace(d))):f&&n?(g=v.getTranslation(),v.setTranslation(g.multiplyInPlace(n))):v=_.value):v=_.value,p.push({frame:_.frame+i,value:v}));return this.animations[0].createRange(t,r+i,o+i),!0},init_depth_fragment(),init_depth_vertex();var DepthRenderer=class e{dispose(){const e=[];for(const t in this._scene._depthRenderer){this._scene._depthRenderer[t]===this&&e.push(t)}if(e.length>0){this._depthMap.dispose();for(const t of e)delete this._scene._depthRenderer[t]}}constructor(t,i=1,a=null,n=!1,s=Texture.TRILINEAR_SAMPLINGMODE,r=!1,o){this._shaderLanguage=0,this.enabled=!0,this.forceDepthWriteTransparentMeshes=!1,this.useOnlyInActiveCamera=!1,this.reverseCulling=!1,this._shadersLoaded=!1,this._scene=t,this._storeNonLinearDepth=n,this._storeCameraSpaceZ=r,this.isPacked=0===i,this.isPacked?this.clearColor=new Color4(1,1,1,1):this.clearColor=new Color4(r?1e8:1,0,0,1),this._initShaderSourceAsync(),e._SceneComponentInitialization(this._scene);const l=t.getEngine();this._camera=a,s!==Texture.NEAREST_SAMPLINGMODE&&(1!==i||l._caps.textureFloatLinearFiltering||(s=Texture.NEAREST_SAMPLINGMODE),2!==i||l._caps.textureHalfFloatLinearFiltering||(s=Texture.NEAREST_SAMPLINGMODE));const c=this.isPacked||!l._features.supportExtendedTextureFormats?5:6;this._depthMap=new RenderTargetTexture(o??"DepthRenderer",{width:l.getRenderWidth(),height:l.getRenderHeight()},this._scene,!1,!0,i,!1,s,void 0,void 0,void 0,c),this._depthMap.wrapU=Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.cb=null,this._depthMap.noPrePassRenderer=!0,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add((e=>{e.clear(this.clearColor,!0,!0,!0)})),this._depthMap.onBeforeBindObservable.add((()=>{l._debugPushGroup?.("depth renderer",1)})),this._depthMap.onAfterUnbindObservable.add((()=>{l._debugPopGroup?.(1)})),this._depthMap.customIsReadyFunction=(e,t,i)=>{if((i||0===t)&&e.subMeshes)for(let t=0;t<e.subMeshes.length;++t){const i=e.subMeshes[t],a=i.getRenderingMesh(),n=a._getInstancesRenderList(i._id,!!i.getReplacementMesh()),s=l.getCaps().instancedArrays&&(null!==n.visibleInstances[i._id]&&void 0!==n.visibleInstances[i._id]||a.hasThinInstances);if(!this.isReady(i,s))return!1}return!0};const h=e=>{const t=e.getRenderingMesh(),i=e.getEffectiveMesh(),a=this._scene,n=a.getEngine(),s=e.getMaterial();if(i._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!s||i.infiniteDistance||s.disableDepthWrite||0===e.verticesCount||e._renderId===a.getRenderId())return;const r=i._getWorldMatrixDeterminant()<0;let o=s._getEffectiveOrientation(t);r&&(o=0===o?1:0);const l=0===o;n.setState(s.backFaceCulling,0,!1,l,this.reverseCulling?!s.cullBackFaces:s.cullBackFaces);const c=t._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(c.mustReturn)return;const h=n.getCaps().instancedArrays&&(null!==c.visibleInstances[e._id]&&void 0!==c.visibleInstances[e._id]||t.hasThinInstances),u=this._camera||a.activeCamera;if(this.isReady(e,h)&&u){e._renderId=a.getRenderId();const r=i._internalAbstractMeshDataInfo._materialForRenderPass?.[n.currentRenderPassId];let o=e._getDrawWrapper();!o&&r&&(o=r._getDrawWrapper());const l=u.mode===Camera.ORTHOGRAPHIC_CAMERA;if(!o)return;const m=o.effect;let d,f;if(n.enableEffect(o),h||t._bind(e,m,s.fillMode),r?r.bindForSubMesh(i.getWorldMatrix(),i,e):(m.setMatrix("viewProjection",a.getTransformMatrix()),m.setMatrix("world",i.getWorldMatrix()),this._storeCameraSpaceZ&&m.setMatrix("view",a.getViewMatrix())),l?(d=!n.useReverseDepthBuffer&&n.isNDCHalfZRange?0:1,f=n.useReverseDepthBuffer&&n.isNDCHalfZRange?0:1):(d=n.useReverseDepthBuffer&&n.isNDCHalfZRange?u.minZ:n.isNDCHalfZRange?0:u.minZ,f=n.useReverseDepthBuffer&&n.isNDCHalfZRange?0:u.maxZ),m.setFloat2("depthValues",d,d+f),!r){if(s.needAlphaTesting()){const e=s.getAlphaTestTexture();e&&(m.setTexture("diffuseSampler",e),m.setMatrix("diffuseMatrix",e.getTextureMatrix()))}if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){const e=t.skeleton;if(e.isUsingTextureForMatrices){const i=e.getTransformMatrixTexture(t);if(!i)return;m.setTexture("boneSampler",i),m.setFloat("boneTextureWidth",4*(e.bones.length+1))}else m.setMatrices("mBones",e.getTransformMatrices(t))}bindClipPlane(m,s,a),BindMorphTargetParameters(t,m),t.morphTargetManager&&t.morphTargetManager.isUsingTextureForTargets&&t.morphTargetManager._bind(m),s.pointsCloud&&m.setFloat("pointSize",s.pointSize)}t._processRendering(i,e,m,s.fillMode,c,h,((e,t)=>m.setMatrix("world",t)))}};this._depthMap.customRenderFunction=(e,t,i,a)=>{let n;if(a.length)for(n=0;n<a.length;n++)h(a.data[n]);for(n=0;n<e.length;n++)h(e.data[n]);for(n=0;n<t.length;n++)h(t.data[n]);if(this.forceDepthWriteTransparentMeshes)for(n=0;n<i.length;n++)h(i.data[n]);else for(n=0;n<i.length;n++)i.data[n].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}}async _initShaderSourceAsync(t=!1){!this._scene.getEngine().isWebGPU||t||e.ForceGLSL?await Promise.all([Promise.resolve().then((()=>(init_depth_vertex(),depth_vertex_exports))),Promise.resolve().then((()=>(init_depth_fragment(),depth_fragment_exports)))]):(this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(init_depth_vertex2(),depth_vertex_exports2))),Promise.resolve().then((()=>(init_depth_fragment2(),depth_fragment_exports2)))])),this._shadersLoaded=!0}isReady(e,t){if(!this._shadersLoaded)return!1;const i=this._scene.getEngine(),a=e.getMesh(),n=a.getScene(),s=a._internalAbstractMeshDataInfo._materialForRenderPass?.[i.currentRenderPassId];if(s)return s.isReadyForSubMesh(a,e,t);const r=e.getMaterial();if(!r||r.disableDepthWrite)return!1;const o=[],l=[VertexBuffer.PositionKind];if(r&&r.needAlphaTesting()&&r.getAlphaTestTexture()&&(o.push("#define ALPHATEST"),a.isVerticesDataPresent(VertexBuffer.UVKind)&&(l.push(VertexBuffer.UVKind),o.push("#define UV1")),a.isVerticesDataPresent(VertexBuffer.UV2Kind)&&(l.push(VertexBuffer.UV2Kind),o.push("#define UV2"))),a.useBones&&a.computeBonesUsingShaders){l.push(VertexBuffer.MatricesIndicesKind),l.push(VertexBuffer.MatricesWeightsKind),a.numBoneInfluencers>4&&(l.push(VertexBuffer.MatricesIndicesExtraKind),l.push(VertexBuffer.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),o.push("#define BonesPerMesh "+(a.skeleton?a.skeleton.bones.length+1:0));const t=e.getRenderingMesh().skeleton;t?.isUsingTextureForMatrices&&o.push("#define BONETEXTURE")}else o.push("#define NUM_BONE_INFLUENCERS 0");const c=a.morphTargetManager;let h=0;c&&(h=c.numMaxInfluencers||c.numInfluencers,h>0&&(o.push("#define MORPHTARGETS"),o.push("#define NUM_MORPH_INFLUENCERS "+h),c.isUsingTextureForTargets&&o.push("#define MORPHTARGETS_TEXTURE"),PrepareAttributesForMorphTargetsInfluencers(l,a,h))),r.pointsCloud&&o.push("#define POINTSIZE"),t&&(o.push("#define INSTANCES"),PushAttributesForInstances(l),e.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES")),this._storeNonLinearDepth&&o.push("#define NONLINEARDEPTH"),this._storeCameraSpaceZ&&o.push("#define STORE_CAMERASPACE_Z"),this.isPacked&&o.push("#define PACKED"),prepareStringDefinesForClipPlanes(r,n,o);const u=e._getDrawWrapper(void 0,!0),m=u.defines,d=o.join("\n");if(m!==d){const e=["world","mBones","boneTextureWidth","pointSize","viewProjection","view","diffuseMatrix","depthValues","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices"];addClipPlaneUniforms(e),u.setEffect(i.createEffect("depth",l,e,["diffuseSampler","morphTargets","boneSampler"],d,void 0,void 0,void 0,{maxSimultaneousMorphTargets:h},this._shaderLanguage),d)}return u.effect.isReady()}setMaterialForRendering(e,t){this._depthMap.setMaterialForRendering(e,t)}getDepthMap(){return this._depthMap}get shaderLanguage(){return this._shaderLanguage}};DepthRenderer.ForceGLSL=!1,DepthRenderer._SceneComponentInitialization=e=>{throw _WarnImport("DepthRendererSceneComponent")},init_shaderStore();var name181="minmaxReduxPixelShader",shader181="varying vec2 vUV;uniform sampler2D textureSampler;\n#if defined(INITIAL)\nuniform sampler2D sourceTexture;uniform vec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*(texSize-1.0));float f1=texelFetch(sourceTexture,coord,0).r;float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;float minz=min(min(min(f1,f2),f3),f4);\n#ifdef DEPTH_REDUX\nfloat maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);\n#else\nfloat maxz=max(max(max(f1,f2),f3),f4);\n#endif\nglFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(MAIN)\nuniform vec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*(texSize-1.0));vec2 f1=texelFetch(textureSampler,coord,0).rg;vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);glFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(ONEBEFORELAST)\nuniform ivec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*vec2(texSize-1));vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;float minz=min(f1.x,f2.x);float maxz=max(f1.y,f2.y);glFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(LAST)\nvoid main(void)\n{glFragColor=vec4(0.);if (true) { \ndiscard;}}\n#endif\n";ShaderStore.ShadersStore[name181]=shader181;var MinMaxReducer=class{setSourceTexture(e,t,i=2,a=!0){if(e===this._sourceTexture)return;this.dispose(!1),this._sourceTexture=e,this._reductionSteps=[],this._forceFullscreenViewport=a;const n=this._camera.getScene(),s=new PostProcess("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,1,n.getEngine(),!1,"#define INITIAL"+(t?"\n#define DEPTH_REDUX":""),i,void 0,void 0,void 0,7);s.autoClear=!1,s.forceFullscreenViewport=a;let r=this._sourceTexture.getRenderWidth(),o=this._sourceTexture.getRenderHeight();s.onApply=((e,t)=>i=>{i.setTexture("sourceTexture",this._sourceTexture),i.setFloat2("texSize",e,t)})(r,o),this._reductionSteps.push(s);let l=1;for(;r>1||o>1;){r=Math.max(Math.round(r/2),1),o=Math.max(Math.round(o/2),1);const e=new PostProcess("Reduction phase "+l,"minmaxRedux",["texSize"],null,{width:r,height:o},null,1,n.getEngine(),!1,"#define "+(1==r&&1==o?"LAST":1==r||1==o?"ONEBEFORELAST":"MAIN"),i,void 0,void 0,void 0,7);if(e.autoClear=!1,e.forceFullscreenViewport=a,e.onApply=((e,t)=>i=>{1==e||1==t?i.setInt2("texSize",e,t):i.setFloat2("texSize",e,t)})(r,o),this._reductionSteps.push(e),l++,1==r&&1==o){const t=(e,t,i)=>{const a=new Float32Array(4*e*t),s={min:0,max:0};return()=>{n.getEngine()._readTexturePixels(i.inputTexture.texture,e,t,-1,0,a,!1),s.min=a[0],s.max=a[1],this.onAfterReductionPerformed.notifyObservers(s)}};e.onAfterRenderObservable.add(t(r,o,e))}}}get sourceTexture(){return this._sourceTexture}get activated(){return this._activated}deactivate(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)}set refreshRate(e){this._sourceTexture&&(this._sourceTexture.refreshRate=e)}get refreshRate(){return this._sourceTexture?this._sourceTexture.refreshRate:-1}activate(){!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add((()=>{const e=this._camera.getScene().getEngine();e._debugPushGroup?.("min max reduction",1),this._reductionSteps[0].activate(this._camera),this._postProcessManager.directRender(this._reductionSteps,this._reductionSteps[0].inputTexture,this._forceFullscreenViewport),e.unBindFramebuffer(this._reductionSteps[0].inputTexture,!1),e._debugPopGroup?.(1)})),this._activated=!0)}dispose(e=!0){if(e&&(this.onAfterReductionPerformed.clear(),this._onContextRestoredObserver&&(this._camera.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)),this.deactivate(),this._reductionSteps){for(let e=0;e<this._reductionSteps.length;++e)this._reductionSteps[e].dispose();this._reductionSteps=null}this._postProcessManager&&e&&this._postProcessManager.dispose(),this._sourceTexture=null}constructor(e){this.onAfterReductionPerformed=new Observable,this._forceFullscreenViewport=!0,this._activated=!1,this._camera=e,this._postProcessManager=new PostProcessManager(e.getScene()),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{this._postProcessManager._rebuild()}))}},DepthReducer=class extends MinMaxReducer{dispose(e=!0){if(super.dispose(e),this._depthRenderer&&e){const e=this._depthRenderer.getDepthMap().getScene();e&&delete e._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null}}constructor(e){super(e)}setSourceTexture(e,t,i=2,a=!0){super.setSourceTexture(e,t,i,a)}get depthRenderer(){return this._depthRenderer}deactivate(){super.deactivate(),this._depthRenderer&&(this._depthRenderer.enabled=!1)}activate(){this._depthRenderer&&(this._depthRenderer.enabled=!0),super.activate()}setDepthRenderer(e=null,t=2,i=!0){const a=this._camera.getScene();this._depthRenderer&&(delete a._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),null===e&&(a._depthRenderer||(a._depthRenderer={}),(e=this._depthRenderer=new DepthRenderer(a,t,this._camera,!1,1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,a._depthRenderer[this._depthRendererId]=e),super.setSourceTexture(e.getDepthMap(),!0,t,i)}},UpDir=Vector3.Up(),ZeroVec=Vector3.Zero(),tmpv1=new Vector3,tmpv2=new Vector3,tmpMatrix=new Matrix,CascadedShadowGenerator=class e extends ShadowGenerator{bindShadowLight(e,t){const i=this._light;if(!this._scene.shadowsEnabled||!i.shadowEnabled)return;const a=this._getCamera();if(!a)return;const n=this.getShadowMap();if(!n)return;const s=n.getSize().width;if(t.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),t.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),t.setFloat("cascadeBlendFactor"+e,0===this.cascadeBlendPercentage?1e4:1/this.cascadeBlendPercentage),t.setArray("frustumLengths"+e,this._frustumLengths),this._filter===ShadowGenerator.FILTER_PCF)t.setDepthStencilTexture("shadowTexture"+e,n),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s,1/s,this.frustumEdgeFalloff,e);else if(this._filter===ShadowGenerator.FILTER_PCSS){for(let e=0;e<this._numCascades;++e)this._lightSizeUVCorrection[2*e+0]=0===e?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[e].x-this._cascadeMinExtents[e].x),this._lightSizeUVCorrection[2*e+1]=0===e?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[e].y-this._cascadeMinExtents[e].y),this._depthCorrection[e]=0===e?1:(this._cascadeMaxExtents[e].z-this._cascadeMinExtents[e].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);t.setDepthStencilTexture("shadowTexture"+e,n),t.setTexture("depthTexture"+e,n),t.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),t.setArray("depthCorrection"+e,this._depthCorrection),t.setFloat("penumbraDarkness"+e,this.penumbraDarkness),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/s,this._contactHardeningLightSizeUVRatio*s,this.frustumEdgeFalloff,e)}else t.setTexture("shadowTexture"+e,n),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s,1/s,this.frustumEdgeFalloff,e);i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(a),this.getLight().getDepthMinZ(a)+this.getLight().getDepthMaxZ(a),e)}get numCascades(){return this._numCascades}getClassName(){return e.CLASSNAME}constructor(t,i,a,n,s=!0){e.IsSupported?(super(t,i,a,n,s),this.usePercentageCloserFiltering=!0):Logger.Error("CascadedShadowMap is not supported by the current engine.")}_bindCustomEffectForRenderSubMeshForShadowMap(e,t){t.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))}get lambda(){return this._lambda}set cascadeBlendPercentage(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()}get maxDistance(){return this._maxDistance}set shadowMaxZ(e){const t=this._getCamera();t?this._shadowMaxZ===e||e<t.minZ||e>t.maxZ&&0!==t.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e}set autoCalcDepthBoundsRefreshRate(e){this._depthReducer?.depthRenderer&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)}_computeCascadeFrustum(e){this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0);if(this._getCamera()){for(let t=0;t<this._frustumCornersWorldSpace[e].length;++t)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][t]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){let t=0;for(let i=0;i<this._frustumCornersWorldSpace[e].length;++i){const a=this._frustumCornersWorldSpace[e][i].subtractToRef(this._frustumCenter[e],tmpv1).length();t=Math.max(t,a)}t=Math.ceil(16*t)/16,this._cascadeMaxExtents[e].copyFromFloats(t,t,t),this._cascadeMinExtents[e].copyFromFloats(-t,-t,-t)}else{const t=this._frustumCenter[e];this._frustumCenter[e].addToRef(this._lightDirection,tmpv1),Matrix.LookAtLHToRef(t,tmpv1,UpDir,tmpMatrix);for(let t=0;t<this._frustumCornersWorldSpace[e].length;++t)Vector3.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][t],tmpMatrix,tmpv1),this._cascadeMinExtents[e].minimizeInPlace(tmpv1),this._cascadeMaxExtents[e].maximizeInPlace(tmpv1)}}}_createTargetRenderTexture(){const e=this._scene.getEngine(),t={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new RenderTargetTexture(this._light.name+"_CSMShadowMap",t,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0,this._useRedTextureType?6:5),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0,void 0,void 0,void 0,`DepthStencilForCSMShadowGenerator-${this._light.name}`),this._shadowMap.noPrePassRenderer=!0}getTransformMatrix(){return this.getCascadeTransformMatrix(0)}static Parse(t,i){const a=ShadowGenerator.Parse(t,i,((t,i,a)=>new e(t,i,void 0,a)));return void 0!==t.numCascades&&(a.numCascades=t.numCascades),void 0!==t.debug&&(a.debug=t.debug),void 0!==t.stabilizeCascades&&(a.stabilizeCascades=t.stabilizeCascades),void 0!==t.lambda&&(a.lambda=t.lambda),void 0!==t.cascadeBlendPercentage&&(a.cascadeBlendPercentage=t.cascadeBlendPercentage),void 0!==t.depthClamp&&(a.depthClamp=t.depthClamp),void 0!==t.autoCalcDepthBounds&&(a.autoCalcDepthBounds=t.autoCalcDepthBounds),void 0!==t.shadowMaxZ&&(a.shadowMaxZ=t.shadowMaxZ),void 0!==t.penumbraDarkness&&(a.penumbraDarkness=t.penumbraDarkness),void 0!==t.freezeShadowCastersBoundingInfo&&(a.freezeShadowCastersBoundingInfo=t.freezeShadowCastersBoundingInfo),void 0!==t.minDistance&&void 0!==t.maxDistance&&a.setMinMaxDistance(t.minDistance,t.maxDistance),a}_recreateSceneUBOs(){if(this._disposeSceneUBOs(),this._sceneUBOs)for(let e=0;e<this._numCascades;++e)this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for CSM Shadow Generator (light "${this._light.name}" cascade #${e})`))}setMinMaxDistance(e,t){this._minDistance===e&&this._maxDistance===t||(e>t&&(e=0,t=1),e<0&&(e=0),t>1&&(t=1),this._minDistance=e,this._maxDistance=t,this._breaksAreDirty=!0)}_initializeGenerator(){this.penumbraDarkness=this.penumbraDarkness??1,this._numCascades=this._numCascades??e.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=this.stabilizeCascades??!1,this._freezeShadowCastersBoundingInfoObservable=this._freezeShadowCastersBoundingInfoObservable??null,this.freezeShadowCastersBoundingInfo=this.freezeShadowCastersBoundingInfo??!1,this._scbiMin=this._scbiMin??new Vector3(0,0,0),this._scbiMax=this._scbiMax??new Vector3(0,0,0),this._shadowCastersBoundingInfo=this._shadowCastersBoundingInfo??new BoundingInfo(new Vector3(0,0,0),new Vector3(0,0,0)),this._breaksAreDirty=this._breaksAreDirty??!0,this._minDistance=this._minDistance??0,this._maxDistance=this._maxDistance??1,this._currentLayer=this._currentLayer??0,this._shadowMaxZ=this._shadowMaxZ??this._getCamera()?.maxZ??1e4,this._debug=this._debug??!1,this._depthClamp=this._depthClamp??!0,this._cascadeBlendPercentage=this._cascadeBlendPercentage??.1,this._lambda=this._lambda??.5,this._autoCalcDepthBounds=this._autoCalcDepthBounds??!1,this._recreateSceneUBOs(),super._initializeGenerator()}set numCascades(t){(t=Math.min(Math.max(t,e.MIN_CASCADES_COUNT),e.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=t,this.recreateShadowMap(),this._recreateSceneUBOs())}_computeFrustumInWorldSpace(t){const i=this._getCamera();if(!i)return;const a=this._cascades[t].prevBreakDistance,n=this._cascades[t].breakDistance,s=this._scene.getEngine().isNDCHalfZRange;i.getViewMatrix();const r=0===i.maxZ,o=i.maxZ;r&&(i.maxZ=this._shadowMaxZ,i.getProjectionMatrix(!0));const l=Matrix.Invert(i.getTransformationMatrix());r&&(i.maxZ=o,i.getProjectionMatrix(!0));const c=this._scene.getEngine().useReverseDepthBuffer?4:0;for(let i=0;i<e._FrustumCornersNDCSpace.length;++i)tmpv1.copyFrom(e._FrustumCornersNDCSpace[(i+c)%e._FrustumCornersNDCSpace.length]),s&&-1===tmpv1.z&&(tmpv1.z=0),Vector3.TransformCoordinatesToRef(tmpv1,l,this._frustumCornersWorldSpace[t][i]);for(let i=0;i<e._FrustumCornersNDCSpace.length/2;++i)tmpv1.copyFrom(this._frustumCornersWorldSpace[t][i+4]).subtractInPlace(this._frustumCornersWorldSpace[t][i]),tmpv2.copyFrom(tmpv1).scaleInPlace(a),tmpv1.scaleInPlace(n),tmpv1.addInPlace(this._frustumCornersWorldSpace[t][i]),this._frustumCornersWorldSpace[t][i+4].copyFrom(tmpv1),this._frustumCornersWorldSpace[t][i].addInPlace(tmpv2)}_computeMatrices(){const e=this._scene;if(!this._getCamera())return;Vector3.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(Vector3.Dot(this._lightDirection,Vector3.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);const t=e.getEngine().useReverseDepthBuffer;for(let i=0;i<this._numCascades;++i){this._computeFrustumInWorldSpace(i),this._computeCascadeFrustum(i),this._cascadeMaxExtents[i].subtractToRef(this._cascadeMinExtents[i],tmpv1),this._frustumCenter[i].addToRef(this._lightDirection.scale(this._cascadeMinExtents[i].z),this._shadowCameraPos[i]),Matrix.LookAtLHToRef(this._shadowCameraPos[i],this._frustumCenter[i],UpDir,this._viewMatrices[i]);let a=0,n=tmpv1.z;const s=this._shadowCastersBoundingInfo;s.update(this._viewMatrices[i]),n=Math.min(n,s.boundingBox.maximumWorld.z),a=this._depthClamp&&this.filter!==ShadowGenerator.FILTER_PCSS?Math.max(a,s.boundingBox.minimumWorld.z):Math.min(a,s.boundingBox.minimumWorld.z),Matrix.OrthoOffCenterLHToRef(this._cascadeMinExtents[i].x,this._cascadeMaxExtents[i].x,this._cascadeMinExtents[i].y,this._cascadeMaxExtents[i].y,t?n:a,t?a:n,this._projectionMatrices[i],e.getEngine().isNDCHalfZRange),this._cascadeMinExtents[i].z=a,this._cascadeMaxExtents[i].z=n,this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),Vector3.TransformCoordinatesToRef(ZeroVec,this._transformMatrices[i],tmpv1),tmpv1.scaleInPlace(this._mapSize/2),tmpv2.copyFromFloats(Math.round(tmpv1.x),Math.round(tmpv1.y),Math.round(tmpv1.z)),tmpv2.subtractInPlace(tmpv1).scaleInPlace(2/this._mapSize),Matrix.TranslationToRef(tmpv2.x,tmpv2.y,0,tmpMatrix),this._projectionMatrices[i].multiplyToRef(tmpMatrix,this._projectionMatrices[i]),this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),this._transformMatrices[i].copyToArray(this._transformMatricesAsArray,16*i)}}getCascadeProjectionMatrix(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null}_initializeShadowMap(){if(super._initializeShadowMap(),null===this._shadowMap)return;this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(let t=0;t<this._numCascades;++t){this._cascades[t]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[t]=Matrix.Zero(),this._projectionMatrices[t]=Matrix.Zero(),this._transformMatrices[t]=Matrix.Zero(),this._cascadeMinExtents[t]=new Vector3,this._cascadeMaxExtents[t]=new Vector3,this._frustumCenter[t]=new Vector3,this._shadowCameraPos[t]=new Vector3,this._frustumCornersWorldSpace[t]=new Array(e._FrustumCornersNDCSpace.length);for(let i=0;i<e._FrustumCornersNDCSpace.length;++i)this._frustumCornersWorldSpace[t][i]=new Vector3}const t=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.clear(),this._shadowMap.onBeforeRenderObservable.clear(),this._shadowMap.onBeforeRenderObservable.add((e=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[e]),this._currentLayer=e,this._filter===ShadowGenerator.FILTER_PCF&&t.setColorWrite(!1),this._scene.setTransformMatrix(this.getCascadeViewMatrix(e),this.getCascadeProjectionMatrix(e)),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onBeforeBindObservable.add((()=>{this._currentSceneUBO=this._scene.getSceneUniformBuffer(),t._debugPushGroup?.(`cascaded shadow map generation for pass id ${t.currentRenderPassId}`,1),this._breaksAreDirty&&this._splitFrustum(),this._computeMatrices()})),this._splitFrustum()}get shadowCastersBoundingInfo(){return this._shadowCastersBoundingInfo}get autoCalcDepthBoundsRefreshRate(){return this._depthReducer?.depthRenderer?.getDepthMap().refreshRate??-1}_computeShadowCastersBoundingInfo(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._shadowMap&&this._shadowMap.cb){const e=this._shadowMap.cb;for(let t=0;t<e.length;t++){const i=e[t];if(!i)continue;const a=i.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(a.minimumWorld),this._scbiMax.maximizeInPlace(a.maximumWorld)}const t=this._scene.meshes;for(let e=0;e<t.length;e++){const i=t[e];if(!(i&&i.isVisible&&i.isEnabled&&i.receiveShadows))continue;const a=i.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(a.minimumWorld),this._scbiMax.maximizeInPlace(a.maximumWorld)}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)}get depthClamp(){return this._depthClamp}get shadowMaxZ(){return this._getCamera()?this._shadowMaxZ:0}getCascadeViewMatrix(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null}_isReadyCustomDefines(e){e.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==ShadowGenerator.FILTER_PCSS?"1":"0"))}set debug(e){this._debug=e,this._light._markMeshesAsLightDirty()}static get IsSupported(){const e=EngineStore.LastCreatedEngine;return!!e&&e._features.supportCSM}getCascadeTransformMatrix(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null}set lambda(e){const t=Math.min(Math.max(e,0),1);this._lambda!=t&&(this._lambda=t,this._breaksAreDirty=!0)}_splitFrustum(){const e=this._getCamera();if(!e)return;const t=e.minZ,i=e.maxZ||this._shadowMaxZ,a=i-t,n=this._minDistance,s=t+n*a,r=t+(this._shadowMaxZ<i&&this._shadowMaxZ>=t?Math.min((this._shadowMaxZ-t)/(i-t),this._maxDistance):this._maxDistance)*a,o=r-s,l=r/s;for(let e=0;e<this._cascades.length;++e){const i=(e+1)/this._numCascades,r=s*l**i,c=s+o*i,h=this._lambda*(r-c)+c;this._cascades[e].prevBreakDistance=0===e?n:this._cascades[e-1].breakDistance,this._cascades[e].breakDistance=(h-t)/a,this._viewSpaceFrustumsZ[e]=h,this._frustumLengths[e]=(this._cascades[e].breakDistance-this._cascades[e].prevBreakDistance)*a}this._breaksAreDirty=!1}get cascadeBlendPercentage(){return this._cascadeBlendPercentage}set shadowCastersBoundingInfo(e){this._shadowCastersBoundingInfo=e}splitFrustum(){this._breaksAreDirty=!0}get freezeShadowCastersBoundingInfo(){return this._freezeShadowCastersBoundingInfo}dispose(){super.dispose(),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)}get autoCalcDepthBounds(){return this._autoCalcDepthBounds}set autoCalcDepthBounds(e){const t=this._getCamera();if(t){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new DepthReducer(t),this._depthReducer.onAfterReductionPerformed.add((e=>{let t=e.min,i=e.max;t>=i&&(t=0,i=1),t==this._minDistance&&i==this._maxDistance||this.setMinMaxDistance(t,i)})),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}}get minDistance(){return this._minDistance}serialize(){const e=super.serialize(),t=this.getShadowMap();if(!t)return e;if(e.numCascades=this._numCascades,e.debug=this._debug,e.stabilizeCascades=this.stabilizeCascades,e.lambda=this._lambda,e.cascadeBlendPercentage=this.cascadeBlendPercentage,e.depthClamp=this._depthClamp,e.autoCalcDepthBounds=this.autoCalcDepthBounds,e.shadowMaxZ=this._shadowMaxZ,e.penumbraDarkness=this.penumbraDarkness,e.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.cb=[],t.cb)for(let i=0;i<t.cb.length;i++){const a=t.cb[i];e.cb.push(a.id)}return e}getCascadeMaxExtents(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null}prepareDefines(e,t){super.prepareDefines(e,t);const i=this._scene,a=this._light;if(!i.shadowsEnabled||!a.shadowEnabled)return;e["SHADOWCSM"+t]=!0,e["SHADOWCSMDEBUG"+t]=this.debug,e["SHADOWCSMNUM_CASCADES"+t]=this.numCascades,e["SHADOWCSM_RIGHTHANDED"+t]=i.useRightHandedSystem;const n=this._getCamera();n&&this._shadowMaxZ<=(n.maxZ||this._shadowMaxZ)&&(e["SHADOWCSMUSESHADOWMAXZ"+t]=!0),0===this.cascadeBlendPercentage&&(e["SHADOWCSMNOBLEND"+t]=!0)}set depthClamp(e){this._depthClamp=e}_validateFilter(e){return e===ShadowGenerator.FILTER_NONE||e===ShadowGenerator.FILTER_PCF||e===ShadowGenerator.FILTER_PCSS?e:(Logger.Error('Unsupported filter "'+e+'"!'),ShadowGenerator.FILTER_NONE)}getCascadeMinExtents(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null}set freezeShadowCastersBoundingInfo(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add((()=>this._computeShadowCastersBoundingInfo()))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()}get debug(){return this._debug}setDepthRenderer(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)}};CascadedShadowGenerator._FrustumCornersNDCSpace=[new Vector3(-1,1,-1),new Vector3(1,1,-1),new Vector3(1,-1,-1),new Vector3(-1,-1,-1),new Vector3(-1,1,1),new Vector3(1,1,1),new Vector3(1,-1,1),new Vector3(-1,-1,1)],CascadedShadowGenerator.CLASSNAME="CascadedShadowGenerator",CascadedShadowGenerator.DEFAULT_CASCADES_COUNT=4,CascadedShadowGenerator.MIN_CASCADES_COUNT=2,CascadedShadowGenerator.MAX_CASCADES_COUNT=4,CascadedShadowGenerator._SceneComponentInitialization=e=>{throw _WarnImport("ShadowGeneratorSceneComponent")},AbstractScene.AddParser(SceneComponentConstants.NAME_SHADOWGENERATOR,((e,t)=>{if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(let i=0,a=e.shadowGenerators.length;i<a;i++){const a=e.shadowGenerators[i];a.className===CascadedShadowGenerator.CLASSNAME?CascadedShadowGenerator.Parse(a,t):ShadowGenerator.Parse(a,t)}}));var ShadowGeneratorSceneComponent=class{serialize(e){e.shadowGenerators=[];const t=this.scene.lights;for(const i of t){const t=i.getShadowGenerators();if(t){const i=t.values();for(let t=i.next();!0!==t.done;t=i.next()){const i=t.value;e.shadowGenerators.push(i.serialize())}}}}_gatherRenderTargets(e){const t=this.scene;if(this.scene.shadowsEnabled)for(let i=0;i<t.lights.length;i++){const a=t.lights[i],n=a.getShadowGenerators();if(a.isEnabled()&&a.shadowEnabled&&n){const i=n.values();for(let a=i.next();!0!==a.done;a=i.next()){const i=a.value.getShadowMap();-1!==t.textures.indexOf(i)&&e.push(i)}}}}addFromContainer(e){}dispose(){}register(){this.scene._gatherRenderTargetsStage.registerStep(SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)}constructor(e){this.name=SceneComponentConstants.NAME_SHADOWGENERATOR,this.scene=e}rebuild(){}removeFromContainer(e,t){}},SceneLoaderAnimationGroupLoadingMode,SceneLoaderAnimationGroupLoadingMode2;function isFile(e){return!!e.name}ShadowGenerator._SceneComponentInitialization=e=>{let t=e._getComponent(SceneComponentConstants.NAME_SHADOWGENERATOR);t||(t=new ShadowGeneratorSceneComponent(e),e._addComponent(t))},SceneLoaderAnimationGroupLoadingMode2=SceneLoaderAnimationGroupLoadingMode||(SceneLoaderAnimationGroupLoadingMode={}),SceneLoaderAnimationGroupLoadingMode2[SceneLoaderAnimationGroupLoadingMode2.Clean=0]="Clean",SceneLoaderAnimationGroupLoadingMode2[SceneLoaderAnimationGroupLoadingMode2.Stop=1]="Stop",SceneLoaderAnimationGroupLoadingMode2[SceneLoaderAnimationGroupLoadingMode2.Sync=2]="Sync",SceneLoaderAnimationGroupLoadingMode2[SceneLoaderAnimationGroupLoadingMode2.NoSync=3]="NoSync";var onPluginActivatedObservable=new Observable,registeredPlugins={},showingLoadingScreen=!1;function getDefaultPlugin(){return registeredPlugins[".babylon"]}function getPluginForExtension(e){const t=registeredPlugins[e];return t||(Logger.Warn("Unable to find a plugin to load "+e+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),getDefaultPlugin())}function isPluginForExtensionAvailable(e){return!!registeredPlugins[e]}function getPluginForDirectLoad(e){for(const t in registeredPlugins){const i=registeredPlugins[t].plugin;if(i.canDirectLoad&&i.canDirectLoad(e))return registeredPlugins[t]}return getDefaultPlugin()}function getPluginForFilename(e){const t=e.indexOf("?");-1!==t&&(e=e.substring(0,t));const i=e.lastIndexOf(".");return getPluginForExtension(e.substring(i,e.length).toLowerCase())}function getDirectLoad(e){return"data:"===e.substr(0,5)?e.substr(5):null}function formatErrorMessage(e,t,i){let a="Unable to load from "+(e.rawData?"binary data":e.url);return t?a+=`: ${t}`:i&&(a+=`: ${i}`),a}function loadData(e,t,i,a,n,s,r,o,l){const c=getDirectLoad(e.url);if(e.rawData&&!r)throw"When using ArrayBufferView to load data the file extension must be provided.";const h=r?getPluginForExtension(r):c?getPluginForDirectLoad(e.url):getPluginForFilename(e.url);if(!1===l?.[h.plugin.name]?.enabled)throw new Error(`The '${h.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(e.rawData&&!h.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";const u=h.plugin.createPlugin?.(l??{})??h.plugin;if(!u)throw`The loader plugin corresponding to the '${r}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(onPluginActivatedObservable.notifyObservers(u),c&&(u.canDirectLoad&&u.canDirectLoad(e.url)||!IsBase64DataUrl(e.url))){if(u.directLoad){const e=u.directLoad(t,c);e instanceof Promise?e.then((e=>{i(u,e)})).catch((e=>{n("Error in directLoad of _loadData: "+e,e)})):i(u,e)}else i(u,c);return u}const m=h.isBinary,d=(e,a)=>{t.isDisposed?n("Scene has been disposed"):i(u,e,a)};let f=null,p=!1;u.onDisposeObservable?.add((()=>{p=!0,f&&(f.abort(),f=null),s()}));const _=()=>{if(p)return;const i=(e,t)=>{n(e?.statusText,t)};if(!u.loadFile&&e.rawData)throw"Plugin does not support loading ArrayBufferView.";f=u.loadFile?u.loadFile(t,e.rawData||e.file||e.url,e.rootUrl,d,a,m,i,o):t._loadFile(e.file||e.url,d,a,!0,m,i)},g=t.getEngine();let v=g.enableOfflineSupport;if(v){let i=!1;for(const a of t.disableOfflineSupportExceptionRules)if(a.test(e.url)){i=!0;break}v=!i}return v&&Engine.OfflineProviderFactory?t.offlineProvider=Engine.OfflineProviderFactory(e.url,_,g.disableManifestCheck):_(),u}function getFileInfo(e,t){let i,a,n=null,s=null;if(t)if(isFile(t))i=`file:${t.name}`,a=t.name,n=t;else if(ArrayBuffer.isView(t))i="",a=RandomGUID(),s=t;else if(t.startsWith("data:"))i=t,a="";else if(e){const n=t;if("/"===n.substr(0,1))return Tools.Error("Wrong sceneFilename parameter"),null;i=e+n,a=n}else i=t,a=Tools.GetFilename(t),e=Tools.GetFolderPath(t);else i=e,a=Tools.GetFilename(e),e=Tools.GetFolderPath(e);return{url:i,rootUrl:e,name:a,file:n,rawData:s}}function registerSceneLoaderPlugin(e){if("string"==typeof e.extensions){const t=e.extensions;registeredPlugins[t.toLowerCase()]={plugin:e,isBinary:!1}}else{const t=e.extensions;Object.keys(t).forEach((i=>{registeredPlugins[i.toLowerCase()]={plugin:e,isBinary:t[i].isBinary}}))}}function importMesh(e,t,i="",a=EngineStore.LastCreatedScene,n=null,s=null,r=null,o=null,l="",c={}){if(!a)return Logger.Error("No scene available to import mesh to"),null;const h=getFileInfo(t,i);if(!h)return null;const u={};a.addPendingData(u);const m=()=>{a.removePendingData(u)},d=(e,t)=>{const i=formatErrorMessage(h,e,t);r?r(a,i,new RuntimeError(i,ErrorCodes.SceneLoaderError,t)):Logger.Error(i),m()},f=s?e=>{try{s(e)}catch(e){d("Error in onProgress callback: "+e,e)}}:void 0,p=(e,t,i,s,r,o,l,c)=>{if(a.importedMeshesFiles.push(h.url),n)try{n(e,t,i,s,r,o,l,c)}catch(e){d("Error in onSuccess callback: "+e,e)}a.removePendingData(u)};return loadData(h,a,((t,i,n)=>{if(t.rewriteRootURL&&(h.rootUrl=t.rewriteRootURL(h.rootUrl,n)),t.importMesh){const n=[],s=[],r=[];if(!t.importMesh(e,a,i,h.rootUrl,n,s,r,d))return;a.loadingPluginName=t.name,p(n,s,r,[],[],[],[],[])}else{t.importMeshAsync(e,a,i,h.rootUrl,f,h.name).then((e=>{a.loadingPluginName=t.name,p(e.meshes,e.particleSystems,e.skeletons,e.animationGroups,e.transformNodes,e.geometries,e.lights,e.spriteManagers)})).catch((e=>{d(e.message,e)}))}}),f,d,m,o,l,c)}function importMeshAsyncCore(e,t,i,a,n,s,r,o){return new Promise(((l,c)=>{importMesh(e,t,i,a,((e,t,i,a,n,s,r,o)=>{l({meshes:e,particleSystems:t,skeletons:i,animationGroups:a,transformNodes:n,geometries:s,lights:r,spriteManagers:o})}),n,((e,t,i)=>{c(i||new Error(t))}),s,r,o)}))}function loadScene(e,t="",i=EngineStore.LastCreatedEngine,a=null,n=null,s=null,r=null,o="",l={}){return i?append(e,t,new Scene(i),a,n,s,r,o,l):(Tools.Error("No engine available"),null)}function loadSceneAsyncCore(e,t,i,a,n,s,r){return new Promise(((o,l)=>{loadScene(e,t,i,(e=>{o(e)}),a,((e,t,i)=>{l(i||new Error(t))}),n,s,r)}))}function append(e,t="",i=EngineStore.LastCreatedScene,a=null,n=null,s=null,r=null,o="",l={}){if(!i)return Logger.Error("No scene available to append to"),null;const c=getFileInfo(e,t);if(!c)return null;const h={};i.addPendingData(h);const u=()=>{i.removePendingData(h)};SceneLoaderFlags.ShowLoadingScreen&&!showingLoadingScreen&&(showingLoadingScreen=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),showingLoadingScreen=!1})));const m=(e,t)=>{const a=formatErrorMessage(c,e,t);s?s(i,a,new RuntimeError(a,ErrorCodes.SceneLoaderError,t)):Logger.Error(a),u()},d=n?e=>{try{n(e)}catch(e){m("Error in onProgress callback",e)}}:void 0,f=()=>{if(a)try{a(i)}catch(e){m("Error in onSuccess callback",e)}i.removePendingData(h)};return loadData(c,i,((e,t)=>{if(e.load){if(!e.load(i,t,c.rootUrl,m))return;i.loadingPluginName=e.name,f()}else{e.loadAsync(i,t,c.rootUrl,d,c.name).then((()=>{i.loadingPluginName=e.name,f()})).catch((e=>{m(e.message,e)}))}}),d,m,u,r,o,l)}function appendSceneAsyncCore(e,t,i,a,n,s,r){return new Promise(((o,l)=>{append(e,t,i,(e=>{o(e)}),a,((e,t,i)=>{l(i||new Error(t))}),n,s,r)}))}function loadAssetContainer(e,t="",i=EngineStore.LastCreatedScene,a=null,n=null,s=null,r=null,o="",l={}){if(!i)return Logger.Error("No scene available to load asset container to"),null;const c=getFileInfo(e,t);if(!c)return null;const h={};i.addPendingData(h);const u=()=>{i.removePendingData(h)},m=(e,t)=>{const a=formatErrorMessage(c,e,t);s?s(i,a,new RuntimeError(a,ErrorCodes.SceneLoaderError,t)):Logger.Error(a),u()},d=n?e=>{try{n(e)}catch(e){m("Error in onProgress callback",e)}}:void 0,f=e=>{if(a)try{a(e)}catch(e){m("Error in onSuccess callback",e)}i.removePendingData(h)};return loadData(c,i,((e,t)=>{if(e.loadAssetContainer){const a=e.loadAssetContainer(i,t,c.rootUrl,m);if(!a)return;a.populateRootNodes(),i.loadingPluginName=e.name,f(a)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(i,t,c.rootUrl,d,c.name).then((t=>{t.populateRootNodes(),i.loadingPluginName=e.name,f(t)})).catch((e=>{m(e.message,e)}))}else m("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),d,m,u,r,o,l)}function loadAssetContainerAsyncCore(e,t,i,a,n,s,r){return new Promise(((o,l)=>{loadAssetContainer(e,t,i,(e=>{o(e)}),a,((e,t,i)=>{l(i||new Error(t))}),n,s,r)}))}function importAnimations(e,t="",i=EngineStore.LastCreatedScene,a=!0,n=0,s=null,r=null,o=null,l=null,c=null,h="",u={}){if(!i)return void Logger.Error("No scene available to load animations to");if(a){for(const e of i.animatables)e.reset();i.stopAllAnimations(),i.animationGroups.slice().forEach((e=>{e.dispose()}));i.getNodes().forEach((e=>{e.animations&&(e.animations=[])}))}else switch(n){case 0:i.animationGroups.slice().forEach((e=>{e.dispose()}));break;case 1:i.animationGroups.forEach((e=>{e.stop()}));break;case 2:i.animationGroups.forEach((e=>{e.reset(),e.restart()}));break;case 3:break;default:return void Logger.Error("Unknown animation group loading mode value '"+n+"'")}const m=i.animatables.length;loadAssetContainer(e,t,i,(e=>{e.mergeAnimationsTo(i,i.animatables.slice(m),s),e.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),r&&r(i)}),o,l,c,h,u)}function importAnimationsAsyncCore(e,t,i,a,n,s,r,o,l,c){return new Promise(((h,u)=>{importAnimations(e,t,i,a,n,s,(e=>{h(e)}),r,((e,t,i)=>{u(i||new Error(t))}),o,l,c)}))}var SceneLoader=class{static get ShowLoadingScreen(){return SceneLoaderFlags.ShowLoadingScreen}static ImportAnimations(e,t,i,a,n,s,r,o,l,c,h){importAnimations(e,t,i,a,n,s,r,o,l,c,h)}static LoadAssetContainerAsync(e,t,i,a,n,s){return loadAssetContainerAsyncCore(e,t,i,a,n,s)}static GetPluginForExtension(e){return getPluginForExtension(e).plugin}static Load(e,t,i,a,n,s,r,o){return loadScene(e,t,i,a,n,s,r,o)}static RegisterPlugin(e){registerSceneLoaderPlugin(e)}static AppendAsync(e,t,i,a,n,s){return appendSceneAsyncCore(e,t,i,a,n,s)}static ImportMeshAsync(e,t,i,a,n,s,r){return importMeshAsyncCore(e,t,i,a,n,s,r)}static IsPluginForExtensionAvailable(e){return isPluginForExtensionAvailable(e)}static set loggingLevel(e){SceneLoaderFlags.loggingLevel=e}static LoadAssetContainer(e,t,i,a,n,s,r,o){return loadAssetContainer(e,t,i,a,n,s,r,o)}static ImportMesh(e,t,i,a,n,s,r,o,l){return importMesh(e,t,i,a,n,s,r,o,l)}static get loggingLevel(){return SceneLoaderFlags.loggingLevel}static Append(e,t,i,a,n,s,r,o){return append(e,t,i,a,n,s,r,o)}static set CleanBoneMatrixWeights(e){SceneLoaderFlags.CleanBoneMatrixWeights=e}static GetDefaultPlugin(){return getDefaultPlugin()}static ImportAnimationsAsync(e,t,i,a,n,s,r,o,l,c,h){return importAnimationsAsyncCore(e,t,i,a,n,s,o,c,h)}static set ForceFullSceneLoadingForIncremental(e){SceneLoaderFlags.ForceFullSceneLoadingForIncremental=e}static set ShowLoadingScreen(e){SceneLoaderFlags.ShowLoadingScreen=e}static LoadAsync(e,t,i,a,n,s){return loadSceneAsyncCore(e,t,i,a,n,s)}static get ForceFullSceneLoadingForIncremental(){return SceneLoaderFlags.ForceFullSceneLoadingForIncremental}static get CleanBoneMatrixWeights(){return SceneLoaderFlags.CleanBoneMatrixWeights}};SceneLoader.NO_LOGGING=0,SceneLoader.MINIMAL_LOGGING=1,SceneLoader.SUMMARY_LOGGING=2,SceneLoader.DETAILED_LOGGING=3,SceneLoader.OnPluginActivatedObservable=onPluginActivatedObservable;var KeepAssets=class extends AbstractScene{},InstantiatedEntries=class{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((e=>{e.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((e=>{e.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((e=>{e.dispose()})),this.animationGroups.length=0}},AssetContainer=class extends AbstractScene{removeAllFromScene(){this._isValidHierarchy()||Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this)}removeFromScene(e=null){this.cameras.forEach((t=>{e&&!e(t)||this.scene.removeCamera(t)})),this.lights.forEach((t=>{e&&!e(t)||this.scene.removeLight(t)})),this.meshes.forEach((t=>{e&&!e(t)||this.scene.removeMesh(t,!0)})),this.skeletons.forEach((t=>{e&&!e(t)||this.scene.removeSkeleton(t)})),this.animations.forEach((t=>{e&&!e(t)||this.scene.removeAnimation(t)})),this.animationGroups.forEach((t=>{e&&!e(t)||this.scene.removeAnimationGroup(t)})),this.multiMaterials.forEach((t=>{e&&!e(t)||this.scene.removeMultiMaterial(t)})),this.materials.forEach((t=>{e&&!e(t)||this.scene.removeMaterial(t)})),this.morphTargetManagers.forEach((t=>{e&&!e(t)||this.scene.removeMorphTargetManager(t)})),this.geometries.forEach((t=>{e&&!e(t)||this.scene.removeGeometry(t)})),this.transformNodes.forEach((t=>{e&&!e(t)||this.scene.removeTransformNode(t)})),this.actionManagers.forEach((t=>{e&&!e(t)||this.scene.removeActionManager(t)})),this.textures.forEach((t=>{e&&!e(t)||this.scene.removeTexture(t)})),this.reflectionProbes.forEach((t=>{e&&!e(t)||this.scene.removeReflectionProbe(t)}))}mergeAnimationsTo(e=EngineStore.LastCreatedScene,t,i=null){if(!e)return Logger.Error("No scene available to merge animations to"),[];const a=i||(t=>{let i=null;const a=t.animations.length?t.animations[0].targetProperty:"",n=t.name.split(".").join("").split("_primitive")[0];switch(a){case"position":case"rotationQuaternion":i=e.getTransformNodeByName(t.name)||e.getTransformNodeByName(n);break;case"influence":i=e.getMorphTargetByName(t.name)||e.getMorphTargetByName(n);break;default:i=e.getNodeByName(t.name)||e.getNodeByName(n)}return i});this.getNodes().forEach((e=>{const t=a(e);if(null!==t){for(const i of e.animations){const e=t.animations.filter((e=>e.targetProperty===i.targetProperty));for(const i of e){const e=t.animations.indexOf(i,0);e>-1&&t.animations.splice(e,1)}}t.animations=t.animations.concat(e.animations)}}));const n=[];return this.animationGroups.slice().forEach((e=>{n.push(e.clone(e.name,a)),e.animatables.forEach((e=>{e.stop()}))})),t.forEach((t=>{const i=a(t.target);i&&(e.beginAnimation(i,t.fromFrame,t.toFrame,t.loopAnimation,t.speedRatio,t.onAnimationEnd?t.onAnimationEnd:void 0,void 0,!0,void 0,t.onAnimationLoop?t.onAnimationLoop:void 0),e.stopAnimation(t.target))})),n}_addNodeAndDescendantsToList(e,t,i,a){if(i&&(!a||a(i))&&!t.has(i.Hc)){e.push(i),t.add(i.Hc);for(const n of i.getDescendants(!0))this._addNodeAndDescendantsToList(e,t,n,a)}}dispose(){this.cameras.slice(0).forEach((e=>{e.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((e=>{e.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((e=>{e.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((e=>{e.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((e=>{e.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((e=>{e.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((e=>{e.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((e=>{e.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((e=>{e.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((e=>{e.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((e=>{e.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((e=>{e.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((e=>{e.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}addAllAssetsToContainer(e){if(!e)return;const t=[],i=new Set;for(t.push(e);t.length>0;){const e=t.pop();if(e instanceof Mesh?(e.geometry&&-1===this.geometries.indexOf(e.geometry)&&this.geometries.push(e.geometry),this.meshes.push(e)):e instanceof TransformNode?this.transformNodes.push(e):e instanceof Light?this.lights.push(e):e instanceof Camera&&this.cameras.push(e),e instanceof AbstractMesh){if(e.material&&-1===this.materials.indexOf(e.material)){this.materials.push(e.material);for(const t of e.material.getActiveTextures())-1===this.textures.indexOf(t)&&this.textures.push(t)}e.skeleton&&-1===this.skeletons.indexOf(e.skeleton)&&this.skeletons.push(e.skeleton),e.morphTargetManager&&-1===this.morphTargetManagers.indexOf(e.morphTargetManager)&&this.morphTargetManagers.push(e.morphTargetManager)}for(const a of e.getChildren())i.has(a)||t.push(a);i.add(e)}this.populateRootNodes()}_isNodeInContainer(e){return e instanceof AbstractMesh&&-1!==this.meshes.indexOf(e)||(e instanceof TransformNode&&-1!==this.transformNodes.indexOf(e)||(e instanceof Light&&-1!==this.lights.indexOf(e)||e instanceof Camera&&-1!==this.cameras.indexOf(e)))}moveAllFromScene(e){this._wasAddedToScene=!1,void 0===e&&(e=new KeepAssets);for(const t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=this[t]||("_environmentTexture"===t?null:[]),this._moveAssets(this.scene[t],this[t],e[t]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()}instantiateModelsToScene(e,t=!1,i){this._isValidHierarchy()||Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const a={},n={},s=new InstantiatedEntries,r=[],o=[],l={doNotInstantiate:!0,...i},c=[],h=new Set;for(const e of this.transformNodes)null===e.parent&&this._addNodeAndDescendantsToList(c,h,e,l.predicate);for(const e of this.meshes)null===e.parent&&this._addNodeAndDescendantsToList(c,h,e,l.predicate);const u=this._topologicalSort(c),m=(i,r)=>{if(((t,i)=>{if(a[t.Hc]=i.Hc,n[i.Hc]=i,e&&(i.name=e(t.name)),i instanceof Mesh){const e=i;if(e.morphTargetManager){const i=t.morphTargetManager;e.morphTargetManager=i.clone();for(let t=0;t<i.numTargets;t++){const s=i.getTarget(t),r=e.morphTargetManager.getTarget(t);a[s.Hc]=r.Hc,n[r.Hc]=r}}}})(i,r),i.parent){const e=a[i.parent.Hc],t=n[e];r.parent=t||i.parent}if(r.position&&i.position&&r.position.copyFrom(i.position),r.rotationQuaternion&&i.rotationQuaternion&&r.rotationQuaternion.copyFrom(i.rotationQuaternion),r.rotation&&i.rotation&&r.rotation.copyFrom(i.rotation),r.scaling&&i.scaling&&r.scaling.copyFrom(i.scaling),r.material){const s=r;if(s.material)if(t){const t=i.material;if(-1===o.indexOf(t)){let i=t.clone(e?e(t.name):"Clone of "+t.name);if(o.push(t),a[t.Hc]=i.Hc,n[i.Hc]=i,"MultiMaterial"===t.getClassName()){const s=t;for(const t of s.subMaterials)t&&(i=t.clone(e?e(t.name):"Clone of "+t.name),o.push(t),a[t.Hc]=i.Hc,n[i.Hc]=i);s.subMaterials=s.subMaterials.map((e=>e&&n[a[e.Hc]]))}}"InstancedMesh"!==s.getClassName()&&(s.material=n[a[t.Hc]])}else"MultiMaterial"===s.material.getClassName()?-1===this.scene.multiMaterials.indexOf(s.material)&&this.scene.addMultiMaterial(s.material):-1===this.scene.materials.indexOf(s.material)&&this.scene.addMaterial(s.material)}null===r.parent&&s.rootNodes.push(r)};return u.forEach((e=>{if("InstancedMesh"===e.getClassName()){const t=e,i=t.zb,s=a[i.Hc],r=("number"==typeof s?n[s]:i).createInstance(t.name);m(t,r)}else{let t=!0;"TransformNode"===e.getClassName()||"Node"===e.getClassName()||e.skeleton||!e.getTotalVertices||0===e.getTotalVertices()?t=!1:l.doNotInstantiate&&(t="function"==typeof l.doNotInstantiate?!l.doNotInstantiate(e):!l.doNotInstantiate);const i=t?e.createInstance(`instance of ${e.name}`):e.clone(`Clone of ${e.name}`,null,!0);if(!i)throw new Error(`Could not clone or instantiate node on Asset Container ${e.name}`);m(e,i)}})),this.skeletons.forEach((t=>{if(l.predicate&&!l.predicate(t))return;const i=t.clone(e?e(t.name):"Clone of "+t.name);for(const e of this.meshes)if(e.skeleton===t&&!e.isAnInstance){const t=n[a[e.Hc]];if(!t||t.isAnInstance)continue;if(t.skeleton=i,-1!==r.indexOf(i))continue;r.push(i);for(const e of i.bones)e._linkedTransformNode&&(e._linkedTransformNode=n[a[e._linkedTransformNode.Hc]])}s.skeletons.push(i)})),this.animationGroups.forEach((t=>{if(l.predicate&&!l.predicate(t))return;const i=t.clone(e?e(t.name):"Clone of "+t.name,(e=>n[a[e.Hc]]||e));s.animationGroups.push(i)})),s}_topologicalSort(e){const t=new Map;for(const i of e)t.set(i.Hc,i);const i={dependsOn:new Map,dependedBy:new Map};for(const t of e){const e=t.Hc;i.dependsOn.set(e,new Set),i.dependedBy.set(e,new Set)}for(const a of e){const e=a.Hc,n=i.dependsOn.get(e);if(a instanceof InstancedMesh){const s=a.zb;t.has(s.Hc)&&(n.add(s.Hc),i.dependedBy.get(s.Hc).add(e))}const s=i.dependedBy.get(e);for(const n of a.getDescendants()){const a=n.Hc;if(t.has(a)){s.add(a);i.dependsOn.get(a).add(e)}}}const a=[],n=[];for(const a of e){const e=a.Hc;0===i.dependsOn.get(e).size&&(n.push(a),t.delete(e))}const s=n;for(;s.length>0;){const e=s.shift();a.push(e);const n=i.dependedBy.get(e.Hc);for(const a of Array.from(n.values())){const n=i.dependsOn.get(a);n.delete(e.Hc),0===n.size&&t.get(a)&&(s.push(t.get(a)),t.delete(a))}}return t.size>0&&(Logger.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),t.forEach((e=>Logger.Error(e.name)))),a}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(const e of this.scene._serializableComponents)e.addFromContainer(this);this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}constructor(e){super(),this._wasAddedToScene=!1,(e=e||EngineStore.LastCreatedScene)&&(this.scene=e,this.sounds=[],this.effectLayers=[],this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.reflectionProbes=[],e.onDisposeObservable.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();for(const e of this.particleSystems)e.rebuild();for(const e of this.textures)e._rebuild()})))}_isValidHierarchy(){for(const e of this.meshes)if(e.parent&&!this._isNodeInContainer(e.parent))return Logger.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.transformNodes)if(e.parent&&!this._isNodeInContainer(e.parent))return Logger.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.lights)if(e.parent&&!this._isNodeInContainer(e.parent))return Logger.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.cameras)if(e.parent&&!this._isNodeInContainer(e.parent))return Logger.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;return!0}_moveAssets(e,t,i){if(e&&t)for(const a of e){let e=!0;if(i)for(const t of i)if(a===t){e=!1;break}e&&(t.push(a),a._parentContainer=this)}}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((e=>{e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)})),this.transformNodes.forEach((e=>{e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)})),this.lights.forEach((e=>{e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)})),this.cameras.forEach((e=>{e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)}))}addToScene(e=null){const t=[];this.cameras.forEach((i=>{e&&!e(i)||(this.scene.addCamera(i),t.push(i))})),this.lights.forEach((i=>{e&&!e(i)||(this.scene.addLight(i),t.push(i))})),this.meshes.forEach((i=>{e&&!e(i)||(this.scene.addMesh(i),t.push(i))})),this.skeletons.forEach((t=>{e&&!e(t)||this.scene.addSkeleton(t)})),this.animations.forEach((t=>{e&&!e(t)||this.scene.addAnimation(t)})),this.animationGroups.forEach((t=>{e&&!e(t)||this.scene.addAnimationGroup(t)})),this.multiMaterials.forEach((t=>{e&&!e(t)||this.scene.addMultiMaterial(t)})),this.materials.forEach((t=>{e&&!e(t)||this.scene.addMaterial(t)})),this.morphTargetManagers.forEach((t=>{e&&!e(t)||this.scene.addMorphTargetManager(t)})),this.geometries.forEach((t=>{e&&!e(t)||this.scene.addGeometry(t)})),this.transformNodes.forEach((i=>{e&&!e(i)||(this.scene.addTransformNode(i),t.push(i))})),this.actionManagers.forEach((t=>{e&&!e(t)||this.scene.addActionManager(t)})),this.textures.forEach((t=>{e&&!e(t)||this.scene.addTexture(t)})),this.reflectionProbes.forEach((t=>{e&&!e(t)||this.scene.addReflectionProbe(t)}));for(const e of t)e.parent&&-1===this.scene.getNodes().indexOf(e.parent)&&(e.setParent?e.setParent(null):e.parent=null)}createRootMesh(){const e=new Mesh("assetContainerRootMesh",this.scene);return this.meshes.forEach((t=>{t.parent||e.addChild(t)})),this.meshes.unshift(e),e}},DataReader=class{readUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,e);return this._dataByteOffset+=e,this.byteOffset+=e,t}skipBytes(e){this._dataByteOffset+=e,this.byteOffset+=e}loadAsync(e){return this.buffer.readAsync(this.byteOffset,e).then((e=>{this._dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),this._dataByteOffset=0}))}constructor(e){this.byteOffset=0,this.buffer=e}readUint32(){const e=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,e}readString(e){return Decode(this.readUint8Array(e))}};function validateAsync(e,t,i,a){const n={externalResourceFunction:a};return i&&(n.uri="file:"===t?i:t+i),ArrayBuffer.isView(e)?GLTFValidator.validateBytes(e,n):GLTFValidator.validateString(e,n)}function workerFunc(){const e=[];onmessage=t=>{const i=t.data;switch(i.id){case"init":importScripts(i.url);break;case"validate":validateAsync(i.data,i.rootUrl,i.fileName,(t=>new Promise(((i,a)=>{const n=e.length;e.push({resolve:i,reject:a}),postMessage({id:"getExternalResource",index:n,uri:t})})))).then((e=>{postMessage({id:"validate.resolve",value:e})}),(e=>{postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[i.index].resolve(i.value);break;case"getExternalResource.reject":e[i.index].reject(i.reason)}}}var GLTFValidation=class{static ValidateAsync(e,t,i,a){return"function"==typeof Worker?new Promise(((n,s)=>{const r=`${validateAsync}(${workerFunc})()`,o=URL.createObjectURL(new Blob([r],{type:"application/javascript"})),l=new Worker(o),c=e=>{l.removeEventListener("error",c),l.removeEventListener("message",h),s(e)},h=e=>{const t=e.data;switch(t.id){case"getExternalResource":a(t.uri).then((e=>{l.postMessage({id:"getExternalResource.resolve",index:t.index,value:e},[e.buffer])}),(e=>{l.postMessage({id:"getExternalResource.reject",index:t.index,reason:e})}));break;case"validate.resolve":l.removeEventListener("error",c),l.removeEventListener("message",h),n(t.value),l.terminate();break;case"validate.reject":l.removeEventListener("error",c),l.removeEventListener("message",h),s(t.reason),l.terminate()}};if(l.addEventListener("error",c),l.addEventListener("message",h),l.postMessage({id:"init",url:Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(e)){const a=e.slice();l.postMessage({id:"validate",data:a,rootUrl:t,fileName:i},[a.buffer])}else l.postMessage({id:"validate",data:e,rootUrl:t,fileName:i})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>validateAsync(e,t,i,a))))}};GLTFValidation.Configuration={url:`${Tools._DefaultCdnUrl}/gltf_validator.js`};var PLUGIN_GLTF="gltf",GLTFLoaderCoordinateSystemMode,GLTFLoaderCoordinateSystemMode2,GLTFLoaderAnimationStartMode,GLTFLoaderAnimationStartMode2,GLTFLoaderState,GLTFLoaderState2;function readAsync(e,t,i){try{return Promise.resolve(new Uint8Array(e,t,i))}catch(e){return Promise.reject(e)}}function readViewAsync(e,t,i){try{if(t<0||t>=e.byteLength)throw new RangeError("Offset is out of range.");if(t+i>e.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(e.buffer,e.byteOffset+t,i))}catch(e){return Promise.reject(e)}}GLTFLoaderCoordinateSystemMode2=GLTFLoaderCoordinateSystemMode||(GLTFLoaderCoordinateSystemMode={}),GLTFLoaderCoordinateSystemMode2[GLTFLoaderCoordinateSystemMode2.AUTO=0]="AUTO",GLTFLoaderCoordinateSystemMode2[GLTFLoaderCoordinateSystemMode2.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED",GLTFLoaderAnimationStartMode2=GLTFLoaderAnimationStartMode||(GLTFLoaderAnimationStartMode={}),GLTFLoaderAnimationStartMode2[GLTFLoaderAnimationStartMode2.NONE=0]="NONE",GLTFLoaderAnimationStartMode2[GLTFLoaderAnimationStartMode2.FIRST=1]="FIRST",GLTFLoaderAnimationStartMode2[GLTFLoaderAnimationStartMode2.ALL=2]="ALL",GLTFLoaderState2=GLTFLoaderState||(GLTFLoaderState={}),GLTFLoaderState2[GLTFLoaderState2.LOADING=0]="LOADING",GLTFLoaderState2[GLTFLoaderState2.READY=1]="READY",GLTFLoaderState2[GLTFLoaderState2.COMPLETE=2]="COMPLETE";var GLTFLoaderOptions=class{copyFrom(e){if(e){const t=t=>{const i=t;this[i]=e[i]??this[i]};for(const e in this)t(e);for(const e of["onParsed","onMeshLoaded","onSkinLoaded","onTextureLoaded","onMaterialLoaded","onCameraLoaded"])t(e)}}constructor(){this.coordinateSystemMode=GLTFLoaderCoordinateSystemMode.AUTO,this.animationStartMode=GLTFLoaderAnimationStartMode.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.preprocessUrlAsync=e=>Promise.resolve(e),this.extensionOptions={}}},GLTFFileLoader=class e extends GLTFLoaderOptions{_startPerformanceCounterDisabled(e){}_endPerformanceCounterEnabled(e){Tools.EndPerformanceCounter(e)}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)}static _compareVersion(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(GLTFLoaderState[this._state]))}canDirectLoad(t){return-1!==t.indexOf("asset")&&-1!==t.indexOf("version")||t.startsWith("data:base64,"+e._MagicBase64Encoded)||t.startsWith("data:;base64,"+e._MagicBase64Encoded)||t.startsWith("data:application/octet-stream;base64,"+e._MagicBase64Encoded)||t.startsWith("data:model/gltf-binary;base64,"+e._MagicBase64Encoded)}_startPerformanceCounterEnabled(e){Tools.StartPerformanceCounter(e)}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}importMeshAsync(e,t,i,a,n,s){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${s||""}`),this._loader=this._getLoader(i),this._loader.importMeshAsync(e,t,null,i,a,n,s))))}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}directLoad(t,i){if(i.startsWith("base64,"+e._MagicBase64Encoded)||i.startsWith(";base64,"+e._MagicBase64Encoded)||i.startsWith("application/octet-stream;base64,"+e._MagicBase64Encoded)||i.startsWith("model/gltf-binary;base64,"+e._MagicBase64Encoded)){const e=DecodeBase64UrlToBinary(i);return this._validate(t,new Uint8Array(e,0,e.byteLength)),this._unpackBinaryAsync(new DataReader({readAsync:(t,i)=>readAsync(e,t,i),byteLength:e.byteLength}))}return this._validate(t,i),Promise.resolve({json:this._parseJson(i)})}_validate(e,t,i="",a=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),GLTFValidation.ValidateAsync(t,i,a,(t=>this.preprocessUrlAsync(i+t).then((t=>e._loadFileAsync(t,void 0,!0,!0).then((e=>new Uint8Array(e,0,e.byteLength))))))).then((e=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(e),this.onValidatedObservable.clear()}),(e=>{this._endPerformanceCounter("Validate JSON"),Tools.Warn(`Failed to validate: ${e.message}`),this.onValidatedObservable.clear()})))}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);const t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t}whenCompleteAsync(){return new Promise(((e,t)=>{this.onCompleteObservable.addOnce((()=>{e()})),this.onErrorObservable.addOnce((e=>{t(e)}))}))}static _parseVersion(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};const t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}constructor(e){super(),this.onParsedObservable=new Observable,this.onMeshLoadedObservable=new Observable,this.onSkinLoadedObservable=new Observable,this.onTextureLoadedObservable=new Observable,this.onMaterialLoadedObservable=new Observable,this.onCameraLoadedObservable=new Observable,this.onCompleteObservable=new Observable,this.onErrorObservable=new Observable,this.onDisposeObservable=new Observable,this.onExtensionLoadedObservable=new Observable,this.validate=!1,this.onValidatedObservable=new Observable,this._loader=null,this._state=null,this._requests=new Array,this.name=PLUGIN_GLTF,this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this.onLoaderStateChangedObservable=new Observable,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.copyFrom(e)}createPlugin(t){return new e(t[PLUGIN_GLTF])}_unpackBinaryV2Async(e,t){const i=1313821514,a=5130562,n=e.readUint32();if(e.readUint32()!==i)throw new Error("First chunk format is not JSON");return e.byteOffset+n===t?e.loadAsync(n).then((()=>({json:this._parseJson(e.readString(n)),bin:null}))):e.loadAsync(n+8).then((()=>{const s={json:this._parseJson(e.readString(n)),bin:null},r=()=>{const n=e.readUint32();switch(e.readUint32()){case i:throw new Error("Unexpected JSON chunk");case a:{const t=e.byteOffset;s.bin={readAsync:(i,a)=>e.buffer.readAsync(t+i,a),byteLength:n},e.skipBytes(n);break}default:e.skipBytes(n)}return e.byteOffset!==t?e.loadAsync(8).then(r):Promise.resolve(s)};return r()}))}_endPerformanceCounterDisabled(e){}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)}get loggingEnabled(){return this._loggingEnabled}_loadBinary(e,t,i,a,n,s){this._validate(e,new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i,s),this._unpackBinaryAsync(new DataReader({readAsync:(e,i)=>readViewAsync(t,e,i),byteLength:t.byteLength})).then((e=>{a(e)}),n?e=>n(void 0,e):void 0)}_logClose(){--this._logIndentLevel}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const e of this._requests)e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}get capturePerformanceCounters(){return this._capturePerformanceCounters}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}loadAsync(e,t,i,a,n){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${n||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(e,t,i,a,n))))}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}loadAssetContainerAsync(e,t,i,a,n){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${n||""}`),this._loader=this._getLoader(t);const s=new AssetContainer(e),r=[];this.onMaterialLoadedObservable.add((e=>{r.push(e)}));const o=[];this.onTextureLoadedObservable.add((e=>{o.push(e)}));const l=[];this.onCameraLoadedObservable.add((e=>{l.push(e)}));const c=[];return this.onMeshLoadedObservable.add((e=>{e.morphTargetManager&&c.push(e.morphTargetManager)})),this._loader.importMeshAsync(null,e,s,t,i,a,n).then((e=>(Array.prototype.push.apply(s.geometries,e.geometries),Array.prototype.push.apply(s.meshes,e.meshes),Array.prototype.push.apply(s.particleSystems,e.particleSystems),Array.prototype.push.apply(s.skeletons,e.skeletons),Array.prototype.push.apply(s.animationGroups,e.animationGroups),Array.prototype.push.apply(s.materials,r),Array.prototype.push.apply(s.textures,o),Array.prototype.push.apply(s.lights,e.lights),Array.prototype.push.apply(s.transformNodes,e.transformNodes),Array.prototype.push.apply(s.cameras,l),Array.prototype.push.apply(s.morphTargetManagers,c),s)))}))}_onProgress(e,t){if(!this._progressCallback)return;t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total;let i=!0,a=0,n=0;for(const e of this._requests){if(void 0===e._lengthComputable||void 0===e._loaded||void 0===e._total)return;i=i&&e._lengthComputable,a+=e._loaded,n+=e._total}this._progressCallback({lengthComputable:i,loaded:a,total:i?n:0})}_logEnabled(t){const i=e._logSpaces.substr(0,2*this._logIndentLevel);Logger.Log(`${i}${t}`)}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)}loadFile(e,t,i,a,n,s,r,o){if(ArrayBuffer.isView(t))return this._loadBinary(e,t,i,a,r,o),null;this._progressCallback=n;const l=t.name||Tools.GetFilename(t);if(s){if(this.useRangeRequests){this.validate&&Logger.Warn("glTF validation is not supported when range requests are enabled");const i={abort:()=>{},onCompleteObservable:new Observable},n={readAsync:(i,a)=>new Promise(((n,s)=>{this._loadFile(e,t,(e=>{n(new Uint8Array(e))}),!0,(e=>{s(e)}),(e=>{e.setRequestHeader("Range",`bytes=${i}-${i+a-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new DataReader(n)).then((e=>{i.onCompleteObservable.notifyObservers(i),a(e)}),r?e=>r(void 0,e):void 0),i}return this._loadFile(e,t,(t=>{this._validate(e,new Uint8Array(t,0,t.byteLength),i,l),this._unpackBinaryAsync(new DataReader({readAsync:(e,i)=>readAsync(t,e,i),byteLength:t.byteLength})).then((e=>{a(e)}),r?e=>r(void 0,e):void 0)}),!0,r)}return this._loadFile(e,t,(t=>{try{this._validate(e,t,i,l),a({json:this._parseJson(t)})}catch{r&&r()}}),!1,r)}get loaderState(){return this._state}set onSkinLoaded(e){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((t=>e(t.node,t.skinnedNode)))}_logDisabled(e){}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((()=>{const t=e.readUint32();if(1179937895!==t)throw new RuntimeError("Unexpected magic: "+t,ErrorCodes.GLTFLoaderUnexpectedMagicError);const i=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${i}`);const a=e.readUint32();let n;switch(this.useRangeRequests||a===e.buffer.byteLength||Logger.Warn(`Length in header does not match actual data length: ${a} != ${e.buffer.byteLength}`),i){case 1:n=this._unpackBinaryV1Async(e,a);break;case 2:n=this._unpackBinaryV2Async(e,a);break;default:throw new Error("Unsupported version: "+i)}return this._endPerformanceCounter("Unpack Binary"),n}))}_getLoader(t){const i=t.json.asset||{};this._log(`Asset version: ${i.version}`),i.minVersion&&this._log(`Asset minimum version: ${i.minVersion}`),i.generator&&this._log(`Asset generator: ${i.generator}`);const a=e._parseVersion(i.version);if(!a)throw new Error("Invalid version: "+i.version);if(void 0!==i.minVersion){const t=e._parseVersion(i.minVersion);if(!t)throw new Error("Invalid minimum version: "+i.minVersion);if(e._compareVersion(t,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+i.minVersion)}const n={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[a.major];if(!n)throw new Error("Unsupported version: "+i.version);return n(this)}_logOpen(e){this._log(e),this._logIndentLevel++}_loadFile(e,t,i,a,n,s){const r=e._loadFile(t,i,(e=>{this._onProgress(e,r)}),!0,a,n,s);return r.onCompleteObservable.add((()=>{r._lengthComputable=!0,r._total=r._loaded})),this._requests.push(r),r}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}_unpackBinaryV1Async(e,t){const i=e.readUint32(),a=e.readUint32();if(0!==a)throw new Error(`Unexpected content format: ${a}`);const n=t-e.byteOffset,s={json:this._parseJson(e.readString(i)),bin:null};if(0!==n){const t=e.byteOffset;s.bin={readAsync:(i,a)=>e.buffer.readAsync(t+i,a),byteLength:n}}return Promise.resolve(s)}},EComponentType,EComponentType2,EShaderType,EShaderType2,EParameterType,EParameterType2,ETextureWrapMode,ETextureWrapMode2,ETextureFilterType,ETextureFilterType2,ETextureFormat,ETextureFormat2,ECullingType,ECullingType2,EBlendingFunction,EBlendingFunction2;GLTFFileLoader.IncrementalLoading=!0,GLTFFileLoader.HomogeneousCoordinates=!1,GLTFFileLoader._MagicBase64Encoded="Z2xURg",GLTFFileLoader._logSpaces="                                ",registerSceneLoaderPlugin(new GLTFFileLoader),EComponentType2=EComponentType||(EComponentType={}),EComponentType2[EComponentType2.BYTE=5120]="BYTE",EComponentType2[EComponentType2.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",EComponentType2[EComponentType2.SHORT=5122]="SHORT",EComponentType2[EComponentType2.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",EComponentType2[EComponentType2.FLOAT=5126]="FLOAT",EShaderType2=EShaderType||(EShaderType={}),EShaderType2[EShaderType2.FRAGMENT=35632]="FRAGMENT",EShaderType2[EShaderType2.VERTEX=35633]="VERTEX",EParameterType2=EParameterType||(EParameterType={}),EParameterType2[EParameterType2.BYTE=5120]="BYTE",EParameterType2[EParameterType2.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",EParameterType2[EParameterType2.SHORT=5122]="SHORT",EParameterType2[EParameterType2.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",EParameterType2[EParameterType2.INT=5124]="INT",EParameterType2[EParameterType2.UNSIGNED_INT=5125]="UNSIGNED_INT",EParameterType2[EParameterType2.FLOAT=5126]="FLOAT",EParameterType2[EParameterType2.FLOAT_VEC2=35664]="FLOAT_VEC2",EParameterType2[EParameterType2.FLOAT_VEC3=35665]="FLOAT_VEC3",EParameterType2[EParameterType2.FLOAT_VEC4=35666]="FLOAT_VEC4",EParameterType2[EParameterType2.INT_VEC2=35667]="INT_VEC2",EParameterType2[EParameterType2.INT_VEC3=35668]="INT_VEC3",EParameterType2[EParameterType2.INT_VEC4=35669]="INT_VEC4",EParameterType2[EParameterType2.BOOL=35670]="BOOL",EParameterType2[EParameterType2.BOOL_VEC2=35671]="BOOL_VEC2",EParameterType2[EParameterType2.BOOL_VEC3=35672]="BOOL_VEC3",EParameterType2[EParameterType2.BOOL_VEC4=35673]="BOOL_VEC4",EParameterType2[EParameterType2.FLOAT_MAT2=35674]="FLOAT_MAT2",EParameterType2[EParameterType2.FLOAT_MAT3=35675]="FLOAT_MAT3",EParameterType2[EParameterType2.FLOAT_MAT4=35676]="FLOAT_MAT4",EParameterType2[EParameterType2.SAMPLER_2D=35678]="SAMPLER_2D",ETextureWrapMode2=ETextureWrapMode||(ETextureWrapMode={}),ETextureWrapMode2[ETextureWrapMode2.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",ETextureWrapMode2[ETextureWrapMode2.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",ETextureWrapMode2[ETextureWrapMode2.REPEAT=10497]="REPEAT",ETextureFilterType2=ETextureFilterType||(ETextureFilterType={}),ETextureFilterType2[ETextureFilterType2.NEAREST=9728]="NEAREST",ETextureFilterType2[ETextureFilterType2.LINEAR=9728]="LINEAR",ETextureFilterType2[ETextureFilterType2.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",ETextureFilterType2[ETextureFilterType2.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",ETextureFilterType2[ETextureFilterType2.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",ETextureFilterType2[ETextureFilterType2.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",ETextureFormat2=ETextureFormat||(ETextureFormat={}),ETextureFormat2[ETextureFormat2.ALPHA=6406]="ALPHA",ETextureFormat2[ETextureFormat2.RGB=6407]="RGB",ETextureFormat2[ETextureFormat2.RGBA=6408]="RGBA",ETextureFormat2[ETextureFormat2.LUMINANCE=6409]="LUMINANCE",ETextureFormat2[ETextureFormat2.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",ECullingType2=ECullingType||(ECullingType={}),ECullingType2[ECullingType2.FRONT=1028]="FRONT",ECullingType2[ECullingType2.BACK=1029]="BACK",ECullingType2[ECullingType2.FRONT_AND_BACK=1032]="FRONT_AND_BACK",EBlendingFunction2=EBlendingFunction||(EBlendingFunction={}),EBlendingFunction2[EBlendingFunction2.ZERO=0]="ZERO",EBlendingFunction2[EBlendingFunction2.ONE=1]="ONE",EBlendingFunction2[EBlendingFunction2.SRC_COLOR=768]="SRC_COLOR",EBlendingFunction2[EBlendingFunction2.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",EBlendingFunction2[EBlendingFunction2.DST_COLOR=774]="DST_COLOR",EBlendingFunction2[EBlendingFunction2.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",EBlendingFunction2[EBlendingFunction2.SRC_ALPHA=770]="SRC_ALPHA",EBlendingFunction2[EBlendingFunction2.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",EBlendingFunction2[EBlendingFunction2.DST_ALPHA=772]="DST_ALPHA",EBlendingFunction2[EBlendingFunction2.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",EBlendingFunction2[EBlendingFunction2.CONSTANT_COLOR=32769]="CONSTANT_COLOR",EBlendingFunction2[EBlendingFunction2.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",EBlendingFunction2[EBlendingFunction2.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",EBlendingFunction2[EBlendingFunction2.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",EBlendingFunction2[EBlendingFunction2.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",Node.AddNodeConstructor("Light_Type_0",((e,t)=>()=>new PointLight(e,Vector3.Zero(),t)));var PointLight=class extends ShadowLight{transferToEffect(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}getClassName(){return"PointLight"}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(t,this.position.x,this.position.y,this.position.z),this}get direction(){return this._direction}constructor(e,t,i){super(e,i),this._shadowAngle=Math.PI/2,this.position=t}set direction(e){const t=this.needCube();if(this._direction=e,this.needCube()!==t&&this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next()){t.value.recreateShadowMap()}}}getShadowDirection(e){if(this.direction)return super.getShadowDirection(e);switch(e){case 0:return new Vector3(1,0,0);case 1:return new Vector3(-1,0,0);case 2:return new Vector3(0,-1,0);case 3:return new Vector3(0,1,0);case 4:return new Vector3(0,0,1);case 5:return new Vector3(0,0,-1)}return Vector3.Zero()}getTypeID(){return Light.LIGHTTYPEID_POINTLIGHT}prepareLightSpecificDefines(e,t){e["POINTLIGHT"+t]=!0}_setDefaultShadowProjectionMatrix(e,t,i){const a=this.getScene().activeCamera;if(!a)return;const n=void 0!==this.shadowMinZ?this.shadowMinZ:a.minZ,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,r=this.getScene().getEngine().useReverseDepthBuffer;Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,r?s:n,r?n:s,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,r)}set shadowAngle(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}needCube(){return!this.direction}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}get shadowAngle(){return this._shadowAngle}};__decorate([serialize()],PointLight.prototype,"shadowAngle",null),RegisterClass("BABYLON.PointLight",PointLight),Node.AddNodeConstructor("Light_Type_2",((e,t)=>()=>new SpotLight(e,Vector3.Zero(),Vector3.Zero(),0,0,t)));var SpotLight=class e extends ShadowLight{_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}getClassName(){return"SpotLight"}set projectionTextureLightNear(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0}set shadowAngleScale(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()}transferToEffect(e,t){let i;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),i=Vector3.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),i=Vector3.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",i.x,i.y,i.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this}_setDefaultShadowProjectionMatrix(e,t,i){const a=this.getScene().activeCamera;if(!a)return;this._shadowAngleScale=this._shadowAngleScale||1;const n=this._shadowAngleScale*this._angle,s=void 0!==this.shadowMinZ?this.shadowMinZ:a.minZ,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,o=this.getScene().getEngine().useReverseDepthBuffer;Matrix.PerspectiveFovLHToRef(n,1,o?r:s,o?s:r,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}set projectionTextureUpDirection(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0}_setDirection(e){super._setDirection(e),this._projectionTextureViewLightDirty=!0}_setPosition(e){super._setPosition(e),this._projectionTextureViewLightDirty=!0}set projectionTextureLightFar(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightNear(){return this._projectionTextureLightNear}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Texture){const e=this._projectionTexture.uScale/2,t=this._projectionTexture.vScale/2;Matrix.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}get projectionTextureLightFar(){return this._projectionTextureLightFar}get projectionTextureMatrix(){return this._projectionTextureMatrix}getDepthMinZ(e){const t=this._scene.getEngine(),i=void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?i:this._scene.getEngine().isNDCHalfZRange?0:i}set angle(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}prepareLightSpecificDefines(e,t){e["SPOTLIGHT"+t]=!0,e["PROJECTEDLIGHTTEXTURE"+t]=!(!this.projectionTexture||!this.projectionTexture.isReady())}set projectionTextureProjectionLightMatrix(e){this._projectionTextureProjectionLightMatrix=e,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const e=this.projectionTextureLightFar,t=this.projectionTextureLightNear,i=e/(e-t),a=-i*t,n=1/Math.tan(this._angle/2);Matrix.FromValuesToRef(n/1,0,0,0,0,n,0,0,0,0,i,1,0,0,a,0,this._projectionTextureProjectionLightMatrix)}transferTexturesToEffect(e,t){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),e.setTexture("projectionLightTexture"+t,this.projectionTexture)),this}transferToNodeMaterialEffect(e,t){let i;return i=this.computeTransformedInformation()?Vector3.Normalize(this.transformedDirection):Vector3.Normalize(this.direction),this.getScene().useRightHandedSystem?e.setFloat3(t,-i.x,-i.y,-i.z):e.setFloat3(t,i.x,i.y,i.z),this}get angle(){return this._angle}set projectionTexture(t){this._projectionTexture!==t&&(this._projectionTexture=t,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(e._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):e._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsTexture(e){return void 0!==e.onLoadObservable}constructor(e,t,i,a,n,s){super(e,s),this._innerAngle=0,this._projectionTextureMatrix=Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=Vector3.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=Vector3.Zero(),this._projectionTextureViewLightMatrix=Matrix.Zero(),this._projectionTextureProjectionLightMatrix=Matrix.Zero(),this._projectionTextureScalingMatrix=Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=t,this.direction=i,this.angle=a,this.exponent=n}get projectionTexture(){return this._projectionTexture}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}getTypeID(){return Light.LIGHTTYPEID_SPOTLIGHT}static _IsProceduralTexture(e){return void 0!==e.onGeneratedObservable}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}get innerAngle(){return this._innerAngle}set innerAngle(e){this._innerAngle=e,this._computeAngleValues()}getDepthMaxZ(e){const t=this._scene.getEngine(),i=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:i}};__decorate([serialize()],SpotLight.prototype,"angle",null),__decorate([serialize()],SpotLight.prototype,"innerAngle",null),__decorate([serialize()],SpotLight.prototype,"shadowAngleScale",null),__decorate([serialize()],SpotLight.prototype,"exponent",void 0),__decorate([serialize()],SpotLight.prototype,"projectionTextureLightNear",null),__decorate([serialize()],SpotLight.prototype,"projectionTextureLightFar",null),__decorate([serialize()],SpotLight.prototype,"projectionTextureUpDirection",null),__decorate([serializeAsTexture("projectedLightTexture")],SpotLight.prototype,"_projectionTexture",void 0),RegisterClass("BABYLON.SpotLight",SpotLight);var GLTFUtils=class e{static SetMatrix(e,t,i,a,n){let s=null;if("MODEL"===i.semantic?s=t.getWorldMatrix():"PROJECTION"===i.semantic?s=e.getProjectionMatrix():"VIEW"===i.semantic?s=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===i.semantic?s=Matrix.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===i.semantic?s=t.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===i.semantic?s=t.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===i.semantic?s=t.getWorldMatrix().invert():"VIEWINVERSE"===i.semantic?s=e.getViewMatrix().invert():"PROJECTIONINVERSE"===i.semantic?s=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===i.semantic?s=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===i.semantic?s=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===i.semantic&&(s=Matrix.Transpose(t.getWorldMatrix().invert())),s)switch(i.type){case EParameterType.FLOAT_MAT2:n.setMatrix2x2(a,Matrix.GetAsMatrix2x2(s));break;case EParameterType.FLOAT_MAT3:n.setMatrix3x3(a,Matrix.GetAsMatrix3x3(s));break;case EParameterType.FLOAT_MAT4:n.setMatrix(a,s)}}static GetDefaultMaterial(t){if(!e._DefaultMaterial){Effect.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),Effect.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join("\n");const i={vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},a={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};e._DefaultMaterial=new ShaderMaterial("GLTFDefaultMaterial",t,i,a),e._DefaultMaterial.setColor4("u_emission",new Color4(.5,.5,.5,1))}return e._DefaultMaterial}static GetByteStrideFromType(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}}static GetBufferFromAccessor(t,i){const a=t.bufferViews[i.bufferView],n=i.count*e.GetByteStrideFromType(i);return e.GetBufferFromBufferView(t,a,i.byteOffset,n,i.componentType)}static DecodeBufferToText(e){let t="";const i=e.byteLength;for(let a=0;a<i;++a)t+=String.fromCharCode(e[a]);return t}static GetWrapMode(e){switch(e){case ETextureWrapMode.CLAMP_TO_EDGE:return Texture.CLAMP_ADDRESSMODE;case ETextureWrapMode.MIRRORED_REPEAT:return Texture.MIRROR_ADDRESSMODE;case ETextureWrapMode.REPEAT:default:return Texture.WRAP_ADDRESSMODE}}static GetTextureFilterMode(e){switch(e){case ETextureFilterType.LINEAR:case ETextureFilterType.LINEAR_MIPMAP_NEAREST:case ETextureFilterType.LINEAR_MIPMAP_LINEAR:return Texture.TRILINEAR_SAMPLINGMODE;case ETextureFilterType.NEAREST:case ETextureFilterType.NEAREST_MIPMAP_NEAREST:return Texture.NEAREST_SAMPLINGMODE;default:return Texture.BILINEAR_SAMPLINGMODE}}static SetUniform(e,t,i,a){switch(a){case EParameterType.FLOAT:return e.setFloat(t,i),!0;case EParameterType.FLOAT_VEC2:return e.setVector2(t,Vector2.FromArray(i)),!0;case EParameterType.FLOAT_VEC3:return e.setVector3(t,Vector3.FromArray(i)),!0;case EParameterType.FLOAT_VEC4:return e.setVector4(t,Vector4.FromArray(i)),!0;default:return!1}}static GetBufferFromBufferView(e,t,i,a,n){i=t.byteOffset+i;const s=e.loadedBufferViews[t.buffer];if(i+a>s.byteLength)throw new Error("Buffer access is out of range");const r=s.buffer;switch(i+=s.byteOffset,n){case EComponentType.BYTE:return new Int8Array(r,i,a);case EComponentType.UNSIGNED_BYTE:return new Uint8Array(r,i,a);case EComponentType.SHORT:return new Int16Array(r,i,a);case EComponentType.UNSIGNED_SHORT:return new Uint16Array(r,i,a);default:return new Float32Array(r,i,a)}}},ETokenType,ETokenType2;GLTFUtils._DefaultMaterial=null,ETokenType2=ETokenType||(ETokenType={}),ETokenType2[ETokenType2.IDENTIFIER=1]="IDENTIFIER",ETokenType2[ETokenType2.UNKNOWN=2]="UNKNOWN",ETokenType2[ETokenType2.END_OF_INPUT=3]="END_OF_INPUT";var Tokenizer=class{getNextToken(){if(this.isEnd())return ETokenType.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=ETokenType.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=ETokenType.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken}peek(){return this._toParse[this._pos]}constructor(e){this._pos=0,this.currentToken=ETokenType.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}isEnd(){return this._pos>=this._maxPos}read(){return this._toParse[this._pos++]}forward(){this._pos++}},glTFTransforms=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],babylonTransforms=["world","view","projection","worldView","worldViewProjection","mBones"],glTFAnimationPaths=["translation","rotation","scale"],babylonAnimationPaths=["position","rotationQuaternion","scaling"],parseBuffers=(e,t)=>{for(const i in e){const a=e[i];t.buffers[i]=a,t.buffersCount++}},parseShaders=(e,t)=>{for(const i in e){const a=e[i];t.shaders[i]=a,t.shaderscount++}},parseObject=(e,t,i)=>{for(const a in e){const n=e[a];i[t][a]=n}},normalizeUVs=e=>{if(e)for(let t=0;t<e.length/2;t++)e[2*t+1]=1-e[2*t+1]},getAttribute=e=>{if("NORMAL"===e.semantic)return"normal";if("POSITION"===e.semantic)return"position";if("JOINT"===e.semantic)return"matricesIndices";if("WEIGHT"===e.semantic)return"matricesWeights";if("COLOR"===e.semantic)return"color";if(e.semantic&&-1!==e.semantic.indexOf("TEXCOORD_")){const t=Number(e.semantic.split("_")[1]);return"uv"+(0===t?"":t+1)}return null},loadAnimations=e=>{for(const t in e.animations){const i=e.animations[t];if(!i.channels||!i.samplers)continue;let a=null;for(let n=0;n<i.channels.length;n++){const s=i.channels[n],r=i.samplers[s.sampler];if(!r)continue;let o=null,l=null;i.parameters?(o=i.parameters[r.input],l=i.parameters[r.output]):(o=r.input,l=r.output);const c=GLTFUtils.GetBufferFromAccessor(e,e.accessors[o]),h=GLTFUtils.GetBufferFromAccessor(e,e.accessors[l]),u=s.target.id;let m=e.scene.getNodeById(u);if(null===m&&(m=e.scene.getNodeByName(u)),null===m){Tools.Warn("Creating animation named "+t+". But cannot find node named "+u+" to attach to");continue}const d=m instanceof Bone;let f=s.target.path;const p=glTFAnimationPaths.indexOf(f);-1!==p&&(f=babylonAnimationPaths[p]);let _=Animation.ANIMATIONTYPE_MATRIX;d||("rotationQuaternion"===f?(_=Animation.ANIMATIONTYPE_QUATERNION,m.rotationQuaternion=new Quaternion):_=Animation.ANIMATIONTYPE_VECTOR3);let g=null;const v=[];let y=0,S=!1;d&&a&&a.getKeys().length===c.length&&(g=a,S=!0),S||(e.scene._blockEntityCollection=!!e.assetContainer,g=new Animation(t,d?"_matrix":f,1,_,Animation.ANIMATIONLOOPMODE_CYCLE),e.scene._blockEntityCollection=!1);for(let e=0;e<c.length;e++){let t=null;if("rotationQuaternion"===f?(t=Quaternion.FromArray([h[y],h[y+1],h[y+2],h[y+3]]),y+=4):(t=Vector3.FromArray([h[y],h[y+1],h[y+2]]),y+=3),d){const i=m;let n=Vector3.Zero(),s=new Quaternion,r=Vector3.Zero(),o=i.getBaseMatrix();S&&a&&(o=a.getKeys()[e].value),o.decompose(r,s,n),"position"===f?n=t:"rotationQuaternion"===f?s=t:r=t,t=Matrix.Compose(r,s,n)}S?a&&(a.getKeys()[e].value=t):v.push({frame:c[e],value:t})}!S&&g&&(g.setKeys(v),m.animations.push(g)),a=g,e.scene.stopAnimation(m),e.scene.beginAnimation(m,0,c[c.length-1],!0,1)}}},configureBoneTransformation=e=>{let t=null;if(e.translation||e.rotation||e.scale){const i=Vector3.FromArray(e.scale||[1,1,1]),a=Quaternion.FromArray(e.rotation||[0,0,0,1]),n=Vector3.FromArray(e.translation||[0,0,0]);t=Matrix.Compose(i,a,n)}else t=Matrix.FromArray(e.matrix);return t},getParentBone=(e,t,i,a)=>{for(let e=0;e<a.bones.length;e++)if(a.bones[e].name===i)return a.bones[e];const n=e.nodes;for(const s in n){const r=n[s];if(!r.jointName)continue;const o=r.children;for(let n=0;n<o.length;n++){const l=e.nodes[o[n]];if(l.jointName&&l.jointName===i){const i=configureBoneTransformation(r),n=new Bone(r.name||"",a,getParentBone(e,t,r.jointName,a),i);return n.id=s,n}}}return null},getNodeToRoot=(e,t)=>{for(let i=0;i<e.length;i++){const a=e[i];for(let e=0;e<a.node.children.length;e++){if(a.node.children[e]===t)return a.bone}}return null},getJointNode=(e,t)=>{const i=e.nodes;let a=i[t];if(a)return{node:a,id:t};for(const e in i)if(a=i[e],a.jointName===t)return{node:a,id:e};return null},nodeIsInJoints=(e,t)=>{for(let i=0;i<e.jointNames.length;i++)if(e.jointNames[i]===t)return!0;return!1},getNodesToRoot=(e,t,i,a)=>{for(const n in e.nodes){const s=e.nodes[n],r=n;if(!s.jointName||nodeIsInJoints(i,s.jointName))continue;const o=configureBoneTransformation(s),l=new Bone(s.name||"",t,null,o);l.id=r,a.push({bone:l,node:s,id:r})}for(let e=0;e<a.length;e++){const t=a[e],i=t.node.children;for(let e=0;e<i.length;e++){let n=null;for(let t=0;t<a.length;t++)if(a[t].id===i[e]){n=a[t];break}n&&(n.bone._parent=t.bone,t.bone.children.push(n.bone))}}},importSkeleton=(e,t,i,a)=>{if(a||(a=new Skeleton(t.name||"","",e.scene)),!t.babylonSkeleton)return a;const n=[],s=[];getNodesToRoot(e,a,t,n),a.bones=[];for(let i=0;i<t.jointNames.length;i++){const r=getJointNode(e,t.jointNames[i]);if(!r)continue;const o=r.node;if(!o){Tools.Warn("Joint named "+t.jointNames[i]+" does not exist");continue}const l=r.id,c=e.scene.getBoneById(l);if(c){a.bones.push(c);continue}let h=!1,u=null;for(let n=0;n<i;n++){const i=getJointNode(e,t.jointNames[n]);if(!i)continue;const s=i.node;if(!s){Tools.Warn("Joint named "+t.jointNames[n]+" does not exist when looking for parent");continue}const r=s.children;if(r){h=!1;for(let i=0;i<r.length;i++)if(r[i]===l){u=getParentBone(e,t,t.jointNames[n],a),h=!0;break}if(h)break}}const m=configureBoneTransformation(o);!u&&n.length>0&&(u=getNodeToRoot(n,l),u&&-1===s.indexOf(u)&&s.push(u));new Bone(o.jointName||"",a,u,m).id=l}const r=a.bones;a.bones=[];for(let i=0;i<t.jointNames.length;i++){const n=getJointNode(e,t.jointNames[i]);if(n)for(let e=0;e<r.length;e++)if(r[e].id===n.id){a.bones.push(r[e]);break}}a.prepare();for(let e=0;e<s.length;e++)a.bones.push(s[e]);return a},importMesh2=(e,t,i,a,n)=>{if(n||(e.scene._blockEntityCollection=!!e.assetContainer,(n=new Mesh(t.name||"",e.scene))._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,n.id=a),!t.babylonNode)return n;const s=[];let r=null;const o=[],l=[],c=[],h=[];for(let t=0;t<i.length;t++){const a=i[t],n=e.meshes[a];if(n)for(let t=0;t<n.primitives.length;t++){const i=new VertexData,a=n.primitives[t];a.mode;const u=a.attributes;let m=null,d=null;for(const t in u)if(m=e.accessors[u[t]],d=GLTFUtils.GetBufferFromAccessor(e,m),"NORMAL"===t)i.normals=new Float32Array(d.length),i.normals.set(d);else if("POSITION"===t){if(GLTFFileLoader.HomogeneousCoordinates){i.positions=new Float32Array(d.length-d.length/4);for(let e=0;e<d.length;e+=4)i.positions[e]=d[e],i.positions[e+1]=d[e+1],i.positions[e+2]=d[e+2]}else i.positions=new Float32Array(d.length),i.positions.set(d);l.push(i.positions.length)}else if(-1!==t.indexOf("TEXCOORD_")){const e=Number(t.split("_")[1]),a=VertexBuffer.UVKind+(0===e?"":e+1),n=new Float32Array(d.length);n.set(d),normalizeUVs(n),i.set(n,a)}else"JOINT"===t?(i.matricesIndices=new Float32Array(d.length),i.matricesIndices.set(d)):"WEIGHT"===t?(i.matricesWeights=new Float32Array(d.length),i.matricesWeights.set(d)):"COLOR"===t&&(i.colors=new Float32Array(d.length),i.colors.set(d));if(m=e.accessors[a.indices],m)d=GLTFUtils.GetBufferFromAccessor(e,m),i.indices=new Int32Array(d.length),i.indices.set(d),h.push(i.indices.length);else{const e=[];for(let t=0;t<i.positions.length/3;t++)e.push(t);i.indices=new Int32Array(e),h.push(i.indices.length)}r?r.merge(i):r=i;const f=e.scene.getMaterialById(a.material);s.push(null===f?GLTFUtils.GetDefaultMaterial(e.scene):f),o.push(0===o.length?0:o[o.length-1]+l[l.length-2]),c.push(0===c.length?0:c[c.length-1]+h[h.length-2])}}let u;e.scene._blockEntityCollection=!!e.assetContainer,s.length>1?(u=new MultiMaterial("multimat"+a,e.scene),u.subMaterials=s):u=new StandardMaterial("multimat"+a,e.scene),1===s.length&&(u=s[0]),u._parentContainer=e.assetContainer,n.material||(n.material=u),new Geometry(a,e.scene,r,!1,n),n.computeWorldMatrix(!0),e.scene._blockEntityCollection=!1,n.subMeshes=[];let m=0;for(let t=0;t<i.length;t++){const a=i[t],s=e.meshes[a];if(s)for(let e=0;e<s.primitives.length;e++)s.primitives[e].mode,SubMesh.AddToMesh(m,o[m],l[m],c[m],h[m],n,n,!0),m++}return n},configureNode=(e,t,i,a)=>{e.position&&(e.position=t),(e.rotationQuaternion||e.rotation)&&(e.rotationQuaternion=i),e.scaling&&(e.scaling=a)},configureNodeFromMatrix=(e,t)=>{if(t.matrix){const i=new Vector3(0,0,0),a=new Quaternion,n=new Vector3(0,0,0);Matrix.FromArray(t.matrix).decompose(n,a,i),configureNode(e,i,a,n)}else t.translation&&t.rotation&&t.scale&&configureNode(e,Vector3.FromArray(t.translation),Quaternion.FromArray(t.rotation),Vector3.FromArray(t.scale));e.computeWorldMatrix(!0)},importNode=(e,t,i)=>{let a=null;if(e.importOnlyMeshes&&(t.skin||t.meshes)&&e.importMeshesNames&&e.importMeshesNames.length>0&&-1===e.importMeshesNames.indexOf(t.name||""))return null;if(t.skin){if(t.meshes){const n=e.skins[t.skin],s=importMesh2(e,t,t.meshes,i,t.babylonNode);s.skeleton=e.scene.getLastSkeletonById(t.skin),null===s.skeleton&&(s.skeleton=importSkeleton(e,n,s,n.babylonSkeleton),n.babylonSkeleton||(n.babylonSkeleton=s.skeleton)),a=s}}else if(t.meshes){a=importMesh2(e,t,t.mesh?[t.mesh]:t.meshes,i,t.babylonNode)}else if(!t.light||t.babylonNode||e.importOnlyMeshes){if(t.camera&&!t.babylonNode&&!e.importOnlyMeshes){const i=e.cameras[t.camera];if(i){if(e.scene._blockEntityCollection=!!e.assetContainer,"orthographic"===i.type){const i=new FreeCamera(t.camera,Vector3.Zero(),e.scene,!1);i.name=t.name||"",i.mode=Camera.ORTHOGRAPHIC_CAMERA,i.attachControl(),a=i,i._parentContainer=e.assetContainer}else if("perspective"===i.type){const n=i[i.type],s=new FreeCamera(t.camera,Vector3.Zero(),e.scene,!1);s.name=t.name||"",s.attachControl(),n.aspectRatio||(n.aspectRatio=e.scene.getEngine().getRenderWidth()/e.scene.getEngine().getRenderHeight()),n.znear&&n.zfar&&(s.maxZ=n.zfar,s.minZ=n.znear),a=s,s._parentContainer=e.assetContainer}e.scene._blockEntityCollection=!1}}}else{const i=e.lights[t.light];if(i)if("ambient"===i.type){const n=i[i.type],s=new HemisphericLight(t.light,Vector3.Zero(),e.scene);s.name=t.name||"",n.color&&(s.diffuse=Color3.FromArray(n.color)),a=s}else if("directional"===i.type){const n=i[i.type],s=new DirectionalLight(t.light,Vector3.Zero(),e.scene);s.name=t.name||"",n.color&&(s.diffuse=Color3.FromArray(n.color)),a=s}else if("point"===i.type){const n=i[i.type],s=new PointLight(t.light,Vector3.Zero(),e.scene);s.name=t.name||"",n.color&&(s.diffuse=Color3.FromArray(n.color)),a=s}else if("spot"===i.type){const n=i[i.type],s=new SpotLight(t.light,Vector3.Zero(),Vector3.Zero(),0,0,e.scene);s.name=t.name||"",n.color&&(s.diffuse=Color3.FromArray(n.color)),n.fallOfAngle&&(s.angle=n.fallOfAngle),n.fallOffExponent&&(s.exponent=n.fallOffExponent),a=s}}if(!t.jointName){if(t.babylonNode)return t.babylonNode;if(null===a){e.scene._blockEntityCollection=!!e.assetContainer;const i=new Mesh(t.name||"",e.scene);i._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,t.babylonNode=i,a=i}}if(null!==a){if(t.matrix&&a instanceof Mesh)configureNodeFromMatrix(a,t);else{const e=t.translation||[0,0,0],i=t.rotation||[0,0,0,1],n=t.scale||[1,1,1];configureNode(a,Vector3.FromArray(e),Quaternion.FromArray(i),Vector3.FromArray(n))}a.updateCache(!0),t.babylonNode=a}return a},traverseNodes=(e,t,i,a=!1)=>{const n=e.nodes[t];let s=null;if(a=!(e.importOnlyMeshes&&!a&&e.importMeshesNames)||(-1!==e.importMeshesNames.indexOf(n.name||"")||0===e.importMeshesNames.length),!n.jointName&&a&&(s=importNode(e,n,t),null!==s&&(s.id=t,s.parent=i)),n.children)for(let t=0;t<n.children.length;t++)traverseNodes(e,n.children[t],s,a)},postLoad=e=>{let t=e.currentScene;if(t)for(let i=0;i<t.nodes.length;i++)traverseNodes(e,t.nodes[i],null);else for(const i in e.scenes){t=e.scenes[i];for(let i=0;i<t.nodes.length;i++)traverseNodes(e,t.nodes[i],null)}loadAnimations(e);for(let t=0;t<e.scene.skeletons.length;t++){const i=e.scene.skeletons[t];e.scene.beginAnimation(i,0,Number.MAX_VALUE,!0,1)}},onBindShaderMaterial=(e,t,i,a,n,s,r)=>{const o=s.values||n.parameters;for(const r in i){const l=i[r],c=l.type;if(c===EParameterType.FLOAT_MAT2||c===EParameterType.FLOAT_MAT3||c===EParameterType.FLOAT_MAT4)if(!l.semantic||l.source||l.node){if(l.semantic&&(l.source||l.node)){let e=t.scene.getNodeByName(l.source||l.node||"");if(null===e&&(e=t.scene.getNodeById(l.source||l.node||"")),null===e)continue;GLTFUtils.SetMatrix(t.scene,e,l,r,a.getEffect())}}else GLTFUtils.SetMatrix(t.scene,e,l,r,a.getEffect());else{const e=o[n.uniforms[r]];if(!e)continue;if(c===EParameterType.SAMPLER_2D){const i=t.textures[s.values?e:l.value].babylonTexture;if(null==i)continue;a.getEffect().setTexture(r,i)}else GLTFUtils.SetUniform(a.getEffect(),r,e,c)}}r(a)},prepareShaderMaterialUniforms=(e,t,i,a,n)=>{const s=a.values||i.parameters,r=i.uniforms;for(const i in n){const o=n[i],l=o.type;let c=s[r[i]];if(void 0===c&&(c=o.value),!c)continue;const h=e=>i=>{o.value&&e&&(t.setTexture(e,i),delete n[e])};l===EParameterType.SAMPLER_2D?GLTFLoaderExtension.LoadTextureAsync(e,a.values?c:o.value,h(i),(()=>h(null))):o.value&&GLTFUtils.SetUniform(t,i,a.values?c:o.value,l)&&delete n[i]}},onShaderCompileError=(e,t,i)=>(a,n)=>{t.dispose(!0),i("Cannot compile program named "+e.name+". Error: "+n+". Default material will be applied")},onShaderCompileSuccess=(e,t,i,a,n,s)=>r=>{prepareShaderMaterialUniforms(e,t,i,a,n),t.onBind=r=>{onBindShaderMaterial(r,e,n,t,i,a,s)}},parseShaderUniforms=(e,t,i)=>{for(const a in t.uniforms){const n=t.uniforms[a],s=t.parameters[n];if(e.currentIdentifier===a&&s.semantic&&!s.source&&!s.node){const e=glTFTransforms.indexOf(s.semantic);if(-1!==e)return delete i[a],babylonTransforms[e]}}return e.currentIdentifier},importMaterials=e=>{for(const t in e.materials)GLTFLoaderExtension.LoadMaterialAsync(e,t,(()=>{}),(()=>{}))},GLTFLoaderBase=class{static LoadMaterialAsync(e,t,i,a){const n=e.materials[t];if(!n.technique)return void(a&&a("No technique found."));const s=e.techniques[n.technique];if(!s){e.scene._blockEntityCollection=!!e.assetContainer;const a=new StandardMaterial(t,e.scene);return a._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,a.diffuseColor=new Color3(.5,.5,.5),a.sideOrientation=Material.CounterClockWiseSideOrientation,void i(a)}const r=e.programs[s.program],o=s.states,l=Effect.ShadersStore[r.vertexShader+"VertexShader"],c=Effect.ShadersStore[r.fragmentShader+"PixelShader"];let h="",u="";const m=new Tokenizer(l),d=new Tokenizer(c),f={},p=[],_=[],g=[];for(const e in s.uniforms){const t=s.uniforms[e],i=s.parameters[t];if(f[e]=i,!i.semantic||i.node||i.source)i.type===EParameterType.SAMPLER_2D?g.push(e):p.push(e);else{const t=glTFTransforms.indexOf(i.semantic);-1!==t?(p.push(babylonTransforms[t]),delete f[e]):p.push(e)}}for(const e in s.attributes){const t=s.attributes[e],i=s.parameters[t];if(i.semantic){const e=getAttribute(i);e&&_.push(e)}}for(;!m.isEnd()&&m.getNextToken();){if(m.currentToken!==ETokenType.IDENTIFIER){h+=m.currentString;continue}let e=!1;for(const t in s.attributes){const i=s.attributes[t],a=s.parameters[i];if(m.currentIdentifier===t&&a.semantic){h+=getAttribute(a),e=!0;break}}e||(h+=parseShaderUniforms(m,s,f))}for(;!d.isEnd()&&d.getNextToken();){d.currentToken===ETokenType.IDENTIFIER?u+=parseShaderUniforms(d,s,f):u+=d.currentString}const v={vertex:r.vertexShader+t,fragment:r.fragmentShader+t},y={attributes:_,uniforms:p,samplers:g,needAlphaBlending:o&&o.enable&&-1!==o.enable.indexOf(3042)};Effect.ShadersStore[r.vertexShader+t+"VertexShader"]=h,Effect.ShadersStore[r.fragmentShader+t+"PixelShader"]=u;const S=new ShaderMaterial(t,e.scene,v,y);if(S.onError=onShaderCompileError(r,S,a),S.onCompiled=onShaderCompileSuccess(e,S,s,n,f,i),S.sideOrientation=Material.CounterClockWiseSideOrientation,o&&o.functions){const e=o.functions;e.cullFace&&e.cullFace[0]!==ECullingType.BACK&&(S.backFaceCulling=!1);const t=e.blendFuncSeparate;t&&(t[0]===EBlendingFunction.SRC_ALPHA&&t[1]===EBlendingFunction.ONE_MINUS_SRC_ALPHA&&t[2]===EBlendingFunction.ONE&&t[3]===EBlendingFunction.ONE?S.alphaMode=Constants.ALPHA_COMBINE:t[0]===EBlendingFunction.ONE&&t[1]===EBlendingFunction.ONE&&t[2]===EBlendingFunction.ZERO&&t[3]===EBlendingFunction.ONE?S.alphaMode=Constants.ALPHA_ONEONE:t[0]===EBlendingFunction.SRC_ALPHA&&t[1]===EBlendingFunction.ONE&&t[2]===EBlendingFunction.ZERO&&t[3]===EBlendingFunction.ONE?S.alphaMode=Constants.ALPHA_ADD:t[0]===EBlendingFunction.ZERO&&t[1]===EBlendingFunction.ONE_MINUS_SRC_COLOR&&t[2]===EBlendingFunction.ONE&&t[3]===EBlendingFunction.ONE?S.alphaMode=Constants.ALPHA_SUBTRACT:t[0]===EBlendingFunction.DST_COLOR&&t[1]===EBlendingFunction.ZERO&&t[2]===EBlendingFunction.ONE&&t[3]===EBlendingFunction.ONE?S.alphaMode=Constants.ALPHA_MULTIPLY:t[0]===EBlendingFunction.SRC_ALPHA&&t[1]===EBlendingFunction.ONE_MINUS_SRC_COLOR&&t[2]===EBlendingFunction.ONE&&t[3]===EBlendingFunction.ONE&&(S.alphaMode=Constants.ALPHA_MAXIMIZED))}}static CreateRuntime(e,t,i){const a={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:i,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return e.extensions&&parseObject(e.extensions,"extensions",a),e.extensionsUsed&&parseObject(e.extensionsUsed,"extensionsUsed",a),e.buffers&&parseBuffers(e.buffers,a),e.bufferViews&&parseObject(e.bufferViews,"bufferViews",a),e.accessors&&parseObject(e.accessors,"accessors",a),e.meshes&&parseObject(e.meshes,"meshes",a),e.lights&&parseObject(e.lights,"lights",a),e.cameras&&parseObject(e.cameras,"cameras",a),e.nodes&&parseObject(e.nodes,"nodes",a),e.images&&parseObject(e.images,"images",a),e.textures&&parseObject(e.textures,"textures",a),e.shaders&&parseShaders(e.shaders,a),e.programs&&parseObject(e.programs,"programs",a),e.samplers&&parseObject(e.samplers,"samplers",a),e.techniques&&parseObject(e.techniques,"techniques",a),e.materials&&parseObject(e.materials,"materials",a),e.animations&&parseObject(e.animations,"animations",a),e.skins&&parseObject(e.skins,"skins",a),e.scenes&&(a.scenes=e.scenes),e.scene&&e.scenes&&(a.currentScene=e.scenes[e.scene]),a}static LoadTextureBufferAsync(e,t,i,a){const n=e.textures[t];if(!n||!n.source)return void a("");if(n.babylonTexture)return void i(null);const s=e.images[n.source];Tools.IsBase64(s.uri)?setTimeout((()=>i(new Uint8Array(Tools.DecodeBase64(s.uri))))):Tools.LoadFile(e.rootUrl+s.uri,(e=>i(new Uint8Array(e))),void 0,void 0,!0,(e=>{e&&a(e.status+" "+e.statusText)}))}static LoadShaderStringAsync(e,t,i,a){const n=e.shaders[t];if(Tools.IsBase64(n.uri)){const e=atob(n.uri.split(",")[1]);i&&i(e)}else Tools.LoadFile(e.rootUrl+n.uri,i,void 0,void 0,!1,(e=>{e&&a&&a(e.status+" "+e.statusText)}))}static LoadBufferAsync(e,t,i,a,n){const s=e.buffers[t];Tools.IsBase64(s.uri)?setTimeout((()=>i(new Uint8Array(Tools.DecodeBase64(s.uri))))):Tools.LoadFile(e.rootUrl+s.uri,(e=>i(new Uint8Array(e))),n,void 0,!0,(e=>{e&&a(e.status+" "+e.statusText)}))}static CreateTextureAsync(e,t,i,a){const n=e.textures[t];if(n.babylonTexture)return void a(n.babylonTexture);const s=e.samplers[n.sampler],r=s.minFilter===ETextureFilterType.NEAREST_MIPMAP_NEAREST||s.minFilter===ETextureFilterType.NEAREST_MIPMAP_LINEAR||s.minFilter===ETextureFilterType.LINEAR_MIPMAP_NEAREST||s.minFilter===ETextureFilterType.LINEAR_MIPMAP_LINEAR,o=Texture.BILINEAR_SAMPLINGMODE,l=null==i?new Blob:new Blob([i]),c=URL.createObjectURL(l),h=()=>URL.revokeObjectURL(c),u=new Texture(c,e.scene,!r,!0,o,h,h);void 0!==s.wrapS&&(u.wrapU=GLTFUtils.GetWrapMode(s.wrapS)),void 0!==s.wrapT&&(u.wrapV=GLTFUtils.GetWrapMode(s.wrapT)),u.name=t,n.babylonTexture=u,a(u)}},GLTFLoader=class e{loadAsync(e,t,i,a){return new Promise(((n,s)=>{this._loadAsync(e,t,i,(()=>{n()}),a,(e=>{s(new Error(e))}))}))}importMeshAsync(e,t,i,a,n,s){return new Promise(((r,o)=>{this._importMeshAsync(e,t,a,n,i,((e,t)=>{r({meshes:e,particleSystems:[],skeletons:t,animationGroups:[],lights:[],transformNodes:[],geometries:[],spriteManagers:[]})}),s,(e=>{o(new Error(e))}))}))}_createNodes(e){let t=e.currentScene;if(t)for(let i=0;i<t.nodes.length;i++)traverseNodes(e,t.nodes[i],null);else for(const i in e.scenes){t=e.scenes[i];for(let i=0;i<t.nodes.length;i++)traverseNodes(e,t.nodes[i],null)}}_loadAsync(e,t,i,a,n,s){e.useRightHandedSystem=!0,GLTFLoaderExtension.LoadRuntimeAsync(e,t,i,(e=>{GLTFLoaderExtension.LoadRuntimeExtensionsAsync(e,(()=>{this._createNodes(e),this._loadBuffersAsync(e,(()=>{this._loadShadersAsync(e,(()=>{importMaterials(e),postLoad(e),GLTFFileLoader.IncrementalLoading||a()}))})),GLTFFileLoader.IncrementalLoading&&a()}),s)}),s)}_loadBuffersAsync(e,t){let i=!1;const a=(i,a)=>{GLTFLoaderExtension.LoadBufferAsync(e,i,(n=>{e.loadedBufferCount++,n&&(n.byteLength!=e.buffers[i].byteLength&&Tools.Error("Buffer named "+i+" is length "+n.byteLength+". Expected: "+a.byteLength),e.loadedBufferViews[i]=n),e.loadedBufferCount===e.buffersCount&&t()}),(()=>{Tools.Error("Error when loading buffer named "+i+" located at "+a.uri)}))};for(const t in e.buffers){i=!0;const n=e.buffers[t];n?a.bind(this,t,n)():Tools.Error("No buffer named: "+t)}i||t()}dispose(){}_loadShadersAsync(e,t){let i=!1;const a=(i,a)=>{GLTFLoaderExtension.LoadShaderStringAsync(e,i,(n=>{n instanceof ArrayBuffer||(e.loadedShaderCount++,n&&(Effect.ShadersStore[i+(a.type===EShaderType.VERTEX?"VertexShader":"PixelShader")]=n),e.loadedShaderCount===e.shaderscount&&t())}),(()=>{Tools.Error("Error when loading shader program named "+i+" located at "+a.uri)}))};for(const t in e.shaders){i=!0;const n=e.shaders[t];n?a.bind(this,t,n)():Tools.Error("No shader named: "+t)}i||t()}_importMeshAsync(e,t,i,a,n,s,r,o){return t.useRightHandedSystem=!0,GLTFLoaderExtension.LoadRuntimeAsync(t,i,a,(t=>{t.assetContainer=n,t.importOnlyMeshes=!0,""===e?t.importMeshesNames=[]:"string"==typeof e?t.importMeshesNames=[e]:!e||e instanceof Array?(t.importMeshesNames=[],Tools.Warn("Argument meshesNames must be of type string or string[]")):t.importMeshesNames=[e],this._createNodes(t);const i=[],a=[];for(const e in t.nodes){const a=t.nodes[e];a.babylonNode instanceof AbstractMesh&&i.push(a.babylonNode)}for(const e in t.skins){const i=t.skins[e];i.babylonSkeleton instanceof Skeleton&&a.push(i.babylonSkeleton)}this._loadBuffersAsync(t,(()=>{this._loadShadersAsync(t,(()=>{importMaterials(t),postLoad(t),!GLTFFileLoader.IncrementalLoading&&s&&s(i,a)}))})),GLTFFileLoader.IncrementalLoading&&s&&s(i,a)}),o),!0}static RegisterExtension(t){e.Extensions[t.name]?Tools.Error('Tool with the same name "'+t.name+'" already exists'):e.Extensions[t.name]=t}};GLTFLoader.Extensions={};var GLTFLoaderExtension=class e{static LoadBufferAsync(t,i,a,n,s){e._ApplyExtensions((e=>e.loadBufferAsync(t,i,a,n,s)),(()=>{GLTFLoaderBase.LoadBufferAsync(t,i,a,n,s)}))}static _LoadTextureBufferAsync(t,i,a,n){e._ApplyExtensions((e=>e.loadTextureBufferAsync(t,i,a,n)),(()=>{GLTFLoaderBase.LoadTextureBufferAsync(t,i,a,n)}))}loadMaterialAsync(e,t,i,a){return!1}loadRuntimeAsync(e,t,i,a,n){return!1}constructor(e){this._name=e}static _ApplyExtensions(e,t){for(const t in GLTFLoader.Extensions){if(e(GLTFLoader.Extensions[t]))return}t()}createTextureAsync(e,t,i,a,n){return!1}static LoadRuntimeAsync(t,i,a,n,s){e._ApplyExtensions((e=>e.loadRuntimeAsync(t,i,a,n,s)),(()=>{setTimeout((()=>{n&&n(GLTFLoaderBase.CreateRuntime(i.json,t,a))}))}))}get name(){return this._name}loadBufferAsync(e,t,i,a,n){return!1}static LoadMaterialAsync(t,i,a,n){e._ApplyExtensions((e=>e.loadMaterialAsync(t,i,a,n)),(()=>{GLTFLoaderBase.LoadMaterialAsync(t,i,a,n)}))}static LoadRuntimeExtensionsAsync(t,i,a){e._ApplyExtensions((e=>e.loadRuntimeExtensionsAsync(t,i,a)),(()=>{setTimeout((()=>{i()}))}))}static _CreateTextureAsync(t,i,a,n,s){e._ApplyExtensions((e=>e.createTextureAsync(t,i,a,n,s)),(()=>{GLTFLoaderBase.CreateTextureAsync(t,i,a,n)}))}static LoadShaderStringAsync(t,i,a,n){e._ApplyExtensions((e=>e.loadShaderStringAsync(t,i,a,n)),(()=>{GLTFLoaderBase.LoadShaderStringAsync(t,i,a,n)}))}static LoadTextureAsync(t,i,a,n){e._LoadTextureBufferAsync(t,i,(s=>{s&&e._CreateTextureAsync(t,i,s,a,n)}),n)}loadRuntimeExtensionsAsync(e,t,i){return!1}loadShaderStringAsync(e,t,i,a){return!1}loadTextureBufferAsync(e,t,i,a){return!1}};GLTFFileLoader._CreateGLTF1Loader=()=>new GLTFLoader;var BinaryExtensionBufferName="binary_glTF",GLTFBinaryExtension=class extends GLTFLoaderExtension{loadRuntimeAsync(e,t,i,a){const n=t.json.extensionsUsed;return!(!n||-1===n.indexOf(this.name)||!t.bin)&&(this._bin=t.bin,a(GLTFLoaderBase.CreateRuntime(t.json,e,i)),!0)}loadShaderStringAsync(e,t,i){const a=e.shaders[t];if(!a.extensions||!(this.name in a.extensions))return!1;const n=a.extensions[this.name],s=e.bufferViews[n.bufferView],r=GLTFUtils.GetBufferFromBufferView(e,s,0,s.byteLength,EComponentType.UNSIGNED_BYTE);return setTimeout((()=>{const e=GLTFUtils.DecodeBufferToText(r);i(e)})),!0}loadBufferAsync(e,t,i,a){return-1!==e.extensionsUsed.indexOf(this.name)&&(t===BinaryExtensionBufferName&&(this._bin.readAsync(0,this._bin.byteLength).then(i,(e=>a(e.message))),!0))}constructor(){super("KHR_binary_glTF")}loadTextureBufferAsync(e,t,i){const a=e.textures[t],n=e.images[a.source];if(!n.extensions||!(this.name in n.extensions))return!1;const s=n.extensions[this.name],r=e.bufferViews[s.bufferView];return i(GLTFUtils.GetBufferFromBufferView(e,r,0,r.byteLength,EComponentType.UNSIGNED_BYTE)),!0}};GLTFLoader.RegisterExtension(new GLTFBinaryExtension);var GLTFMaterialsCommonExtension=class extends GLTFLoaderExtension{loadMaterialAsync(e,t,i,a){const n=e.materials[t];if(!n||!n.extensions)return!1;const s=n.extensions[this.name];if(!s)return!1;const r=new StandardMaterial(t,e.scene);return r.sideOrientation=Material.CounterClockWiseSideOrientation,"CONSTANT"===s.technique&&(r.disableLighting=!0),r.backFaceCulling=void 0!==s.doubleSided&&!s.doubleSided,r.alpha=void 0===s.values.transparency?1:s.values.transparency,r.specularPower=void 0===s.values.shininess?0:s.values.shininess,"string"==typeof s.values.ambient?this._loadTexture(e,s.values.ambient,r,"ambientTexture",a):r.ambientColor=Color3.FromArray(s.values.ambient||[0,0,0]),"string"==typeof s.values.diffuse?this._loadTexture(e,s.values.diffuse,r,"diffuseTexture",a):r.diffuseColor=Color3.FromArray(s.values.diffuse||[0,0,0]),"string"==typeof s.values.emission?this._loadTexture(e,s.values.emission,r,"emissiveTexture",a):r.emissiveColor=Color3.FromArray(s.values.emission||[0,0,0]),"string"==typeof s.values.specular?this._loadTexture(e,s.values.specular,r,"specularTexture",a):r.specularColor=Color3.FromArray(s.values.specular||[0,0,0]),!0}_loadTexture(e,t,i,a,n){GLTFLoaderBase.LoadTextureBufferAsync(e,t,(n=>{GLTFLoaderBase.CreateTextureAsync(e,t,n,(e=>i[a]=e))}),n)}loadRuntimeExtensionsAsync(e){if(!e.extensions)return!1;const t=e.extensions[this.name];if(!t)return!1;const i=t.lights;if(i)for(const t in i){const a=i[t];switch(a.type){case"ambient":{const t=new HemisphericLight(a.name,new Vector3(0,1,0),e.scene),i=a.ambient;i&&(t.diffuse=Color3.FromArray(i.color||[1,1,1]));break}case"point":{const t=new PointLight(a.name,new Vector3(10,10,10),e.scene),i=a.point;i&&(t.diffuse=Color3.FromArray(i.color||[1,1,1]));break}case"directional":{const t=new DirectionalLight(a.name,new Vector3(0,-1,0),e.scene),i=a.directional;i&&(t.diffuse=Color3.FromArray(i.color||[1,1,1]));break}case"spot":{const t=a.spot;if(t){new SpotLight(a.name,new Vector3(0,10,0),new Vector3(0,-1,0),t.fallOffAngle||Math.PI,t.fallOffExponent||0,e.scene).diffuse=Color3.FromArray(t.color||[1,1,1])}break}default:Tools.Warn('GLTF Material Common extension: light type "'+a.type+"\u201d not supported")}}return!1}constructor(){super("KHR_materials_common")}};GLTFLoader.RegisterExtension(new GLTFMaterialsCommonExtension);var Deferred=class{get reject(){return this._reject}constructor(){this.promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}get resolve(){return this._resolve}},TargetedAnimation=class{serialize(){const e={};return e.animation=this.animation.serialize(),e.targetId=this.target.id,e}getClassName(){return"TargetedAnimation"}},AnimationGroup=class e{set from(e){if(this._from!==e){this._from=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].fromFrame=this._from}}}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let e=0;e<this._animatables.length;e++){this._animatables[e].reset()}return this}set loopAnimation(e){if(this._loopAnimation!==e){this._loopAnimation=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].loopAnimation=this._loopAnimation}}}_checkAnimationGroupEnded(e,t=!1){const i=this._animatables.indexOf(e);i>-1&&this._animatables.splice(i,1),0===this._animatables.length&&(this._isStarted=!1,t||this.onAnimationGroupEndObservable.notifyObservers(this))}static MakeAnimationAdditive(e,t,i,a=!1,n){let s;s="object"==typeof t?t:{referenceFrame:t,range:i,cloneOriginalAnimationGroup:a,clonedAnimationName:n};let r=e;s.cloneOriginalAnimationGroup&&(r=e.clone(s.clonedAnimationGroupName||r.name));const o=r.targetedAnimations;for(let e=0;e<o.length;e++){const t=o[e];t.animation=Animation.MakeAnimationAdditive(t.animation,s)}if(r.isAdditive=!0,s.clipKeys){let e=Number.MAX_VALUE,t=-Number.MAX_VALUE;const i=r.targetedAnimations;for(let a=0;a<i.length;a++){const n=i[a].animation.getKeys();e>n[0].frame&&(e=n[0].frame),t<n[n.length-1].frame&&(t=n[n.length-1].frame)}r._from=e,r._to=t}return r}set speedRatio(e){if(this._speedRatio!==e){this._speedRatio=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].speedRatio=this._speedRatio}}}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let e=0;e<this._animatables.length;e++){this._animatables[e].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this}goToFrame(e){if(!this._isStarted)return this;for(let t=0;t<this._animatables.length;t++){this._animatables[t].goToFrame(e)}return this}getClassName(){return"AnimationGroup"}static Parse(t,i){const a=new e(t.name,i,t.weight,t.playOrder);for(let e=0;e<t.targetedAnimations.length;e++){const n=t.targetedAnimations[e],s=Animation.Parse(n.animation),r=n.targetId;if("influence"===n.animation.property){const e=i.getMorphTargetById(r);e&&a.addTargetedAnimation(s,e)}else{const e=i.getNodeById(r);null!=e&&a.addTargetedAnimation(s,e)}}return Tags&&Tags.AddTagsTo(a,t.tags),null!==t.from&&null!==t.to&&a.normalize(t.from,t.to),void 0!==t.speedRatio&&(a._speedRatio=t.speedRatio),void 0!==t.loopAnimation&&(a._loopAnimation=t.loopAnimation),void 0!==t.isAdditive&&(a._isAdditive=t.isAdditive),void 0!==t.weight&&(a._weight=t.weight),void 0!==t.playOrder&&(a._playOrder=t.playOrder),void 0!==t.enableBlending&&(a._enableBlending=t.enableBlending),void 0!==t.blendingSpeed&&(a._blendingSpeed=t.blendingSpeed),void 0!==t.metadata&&(a.metadata=t.metadata),a}clone(t,i,a=!1){const n=new e(t||this.name,this._scene,this._weight,this._playOrder);n._from=this.from,n._to=this.to,n._speedRatio=this.speedRatio,n._loopAnimation=this.loopAnimation,n._isAdditive=this.isAdditive,n._enableBlending=this.enableBlending,n._blendingSpeed=this.blendingSpeed,n.metadata=this.metadata,n.mask=this.mask;for(const e of this._targetedAnimations)n.addTargetedAnimation(a?e.animation.clone():e.animation,i?i(e.target):e.target);return n}get children(){return this._targetedAnimations}get blendingSpeed(){return this._blendingSpeed}normalize(e=null,t=null){null==e&&(e=this._from),null==t&&(t=this._to);for(let i=0;i<this._targetedAnimations.length;i++){const a=this._targetedAnimations[i].animation.getKeys(),n=a[0],s=a[a.length-1];if(n.frame>e){const t={frame:e,value:n.value,inTangent:n.inTangent,outTangent:n.outTangent,interpolation:n.interpolation};a.splice(0,0,t)}if(s.frame<t){const e={frame:t,value:s.value,inTangent:s.inTangent,outTangent:s.outTangent,interpolation:s.interpolation};a.push(e)}}return this._from=e,this._to=t,this}getLength(e,t){e=e??this._from;return((t=t??this._to)-e)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}get isPlaying(){return this._isStarted&&!this._isPaused}get loopAnimation(){return this._loopAnimation}restart(){if(!this._isStarted)return this;for(let e=0;e<this._animatables.length;e++){this._animatables[e].restart()}return this.syncWithMask(),this.onAnimationGroupPlayObservable.notifyObservers(this),this._isPaused=!1,this}get animatables(){return this._animatables}addTargetedAnimation(e,t){const i=new TargetedAnimation;i.animation=e,i.target=t;const a=e.getKeys();return this._from>a[0].frame&&(this._from=a[0].frame),this._to<a[a.length-1].frame&&(this._to=a[a.length-1].frame),null!==this._enableBlending&&(e.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(e.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(i),this._shouldStart=!0,i}getCurrentFrame(){return this.animatables[0]?.masterFrame||0}get isAdditive(){return this._isAdditive}get to(){return this._to}set blendingSpeed(e){if(this._blendingSpeed!==e&&(this._blendingSpeed=e,null!==e))for(let t=0;t<this._targetedAnimations.length;++t)this._targetedAnimations[t].animation.blendingSpeed=e}get weight(){return this._weight}stop(e=!1){if(!this._isStarted)return this;const t=this._animatables.slice();for(let i=0;i<t.length;i++)t[i].stop(void 0,void 0,!0,e);let i=0;for(let t=0;t<this._scene._activeAnimatables.length;t++){const a=this._scene._activeAnimatables[t];a._runtimeAnimations.length>0?this._scene._activeAnimatables[i++]=a:e&&this._checkAnimationGroupEnded(a,e)}return this._scene._activeAnimatables.length=i,this._isStarted=!1,this}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const e=this._scene.animationGroups.indexOf(this);if(e>-1&&this._scene.animationGroups.splice(e,1),this._parentContainer){const e=this._parentContainer.animationGroups.indexOf(this);e>-1&&this._parentContainer.animationGroups.splice(e,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}get enableBlending(){return this._enableBlending}get isStarted(){return this._isStarted}syncWithMask(e=!1){if(this.mask||e){this._numActiveAnimatables=0;for(let e=0;e<this._animatables.length;++e){const t=this._animatables[e];!this.mask||this.mask.disabled||this.mask.retainsTarget(t.target.name)?(this._numActiveAnimatables++,t.paused&&t.restart()):t.paused||t.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}set enableBlending(e){if(this._enableBlending!==e&&(this._enableBlending=e,null!==e))for(let t=0;t<this._targetedAnimations.length;++t)this._targetedAnimations[t].animation.enableBlending=e}static ClipKeysInPlace(t,i,a,n){return e.ClipInPlace(t,i,a,n,!1)}get speedRatio(){return this._speedRatio}start(e=!1,t=1,i,a,n){if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=e,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let s=0;s<this._targetedAnimations.length;s++){const r=this._targetedAnimations[s],o=this._scene.beginDirectAnimation(r.target,[r.animation],void 0!==i?i:this._from,void 0!==a?a:this._to,e,t,void 0,void 0,void 0!==n?n:this._isAdditive);o.weight=this._weight,o.playOrder=this._playOrder,o.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(r),this._checkAnimationGroupEnded(o)},this._processLoop(o,r,s),this._animatables.push(o)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=t,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}set isAdditive(e){if(this._isAdditive!==e){this._isAdditive=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].isAdditive=this._isAdditive}}}constructor(e,t=null,i=-1,a=0){this.name=e,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new Observable,this.onAnimationLoopObservable=new Observable,this.onAnimationGroupLoopObservable=new Observable,this.onAnimationGroupEndObservable=new Observable,this.onAnimationGroupPauseObservable=new Observable,this.onAnimationGroupPlayObservable=new Observable,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=t||EngineStore.LastCreatedScene,this._weight=i,this._playOrder=a,this.Hc=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let e=0;e<this._animatables.length;++e){const t=this._animatables[e];this.mask.retainsTarget(t.target.name)||(t.stop(),this._animatables.splice(e,1),--e)}for(let e=0;e<this._targetedAnimations.length;e++){const t=this._targetedAnimations[e];this.mask.retainsTarget(t.target.name)||(this._targetedAnimations.splice(e,1),--e)}}}set playOrder(e){if(this._playOrder!==e&&(this._playOrder=e,this._animatables.length>0)){for(let e=0;e<this._animatables.length;e++)this._animatables[e].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}removeTargetedAnimation(e){for(let t=this._targetedAnimations.length-1;t>-1;t--){this._targetedAnimations[t].animation===e&&this._targetedAnimations.splice(t,1)}}set weight(e){this._weight!==e&&(this._weight=e,this.setWeightForAllAnimatables(this._weight))}static ClipFrames(t,i,a,n,s){const r=t.clone(n||t.name);return e.ClipFramesInPlace(r,i,a,s)}static ClipInPlace(e,t,i,a,n=!1){let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;const o=e.targetedAnimations;for(let e=0;e<o.length;e++){const l=o[e],c=a?l.animation:l.animation.clone();n&&(c.createKeyForFrame(t),c.createKeyForFrame(i));const h=c.getKeys(),u=[];let m=Number.MAX_VALUE;for(let e=0;e<h.length;e++){const a=h[e];if(!n&&e>=t&&e<=i||n&&a.frame>=t&&a.frame<=i){const e={frame:a.frame,value:a.value.clone?a.value.clone():a.value,inTangent:a.inTangent,outTangent:a.outTangent,interpolation:a.interpolation,lockedTangent:a.lockedTangent};m===Number.MAX_VALUE&&(m=e.frame),e.frame-=m,u.push(e)}}0!==u.length?(s>u[0].frame&&(s=u[0].frame),r<u[u.length-1].frame&&(r=u[u.length-1].frame),c.setKeys(u,!0),l.animation=c):(o.splice(e,1),e--)}return e._from=s,e._to=r,e}setWeightForAllAnimatables(e){for(let t=0;t<this._animatables.length;t++){this._animatables[t].weight=e}return this}set to(e){if(this._to!==e){this._to=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].toFrame=this._to}}}_processLoop(e,t,i){e.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(t),this._animationLoopFlags[i]||(this._animationLoopFlags[i]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}get playOrder(){return this._playOrder}get from(){return this._from}syncAllAnimationsWith(e){for(let t=0;t<this._animatables.length;t++){this._animatables[t].syncWith(e)}return this}static MergeAnimationGroups(t,i=!0,a=!1,n){if(0===t.length)return null;n=n??t[0].weight;let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;if(a)for(const e of t)e.from<s&&(s=e.from),e.to>r&&(r=e.to);const o=new e(t[0].name+"_merged",t[0]._scene,n);for(const e of t){a&&e.normalize(s,r);for(const t of e.targetedAnimations)o.addTargetedAnimation(t.animation,t.target);i&&e.dispose()}return o}toString(e){let t="Name: "+this.name;return t+=", type: "+this.getClassName(),e&&(t+=", from: "+this._from,t+=", to: "+this._to,t+=", isStarted: "+this._isStarted,t+=", speedRatio: "+this._speedRatio,t+=", targetedAnimations length: "+this._targetedAnimations.length,t+=", animatables length: "+this._animatables),t}serialize(){const e={};e.name=this.name,e.from=this.from,e.to=this.to,e.speedRatio=this.speedRatio,e.loopAnimation=this.loopAnimation,e.isAdditive=this.isAdditive,e.weight=this.weight,e.playOrder=this.playOrder,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,e.targetedAnimations=[];for(let t=0;t<this.targetedAnimations.length;t++){const i=this.targetedAnimations[t];e.targetedAnimations[t]=i.serialize()}return Tags&&Tags.HasTags(this)&&(e.tags=Tags.GetTags(this)),this.metadata&&(e.metadata=this.metadata),e}set mask(e){this._mask!==e&&(this._mask=e,this.syncWithMask(!0))}get targetedAnimations(){return this._targetedAnimations}static ClipFramesInPlace(t,i,a,n){return e.ClipInPlace(t,i,a,n,!0)}play(e){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==e&&(this.loopAnimation=e),this.restart()):(this.stop(),this.start(e,this._speedRatio)),this}static ClipKeys(t,i,a,n,s){const r=t.clone(n||t.name);return e.ClipKeysInPlace(r,i,a,s)}get mask(){return this._mask}},RGBDTextureTools=class{static EncodeTextureToRGBD(e,t,i=0){return ApplyPostProcess("rgbdEncode",e,t,i,1,5)}static ExpandRGBDTexture(e){const t=e._texture;if(!t||!e.isRGBD)return;const i=t.getEngine(),a=i.getCaps(),n=t.isReady;let s=!1;a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?(s=!0,t.type=2):a.textureFloatRender&&a.textureFloatLinearFiltering&&(s=!0,t.type=1),s&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);const r=async()=>{const a=i.isWebGPU,n=a?1:0;t.isReady=!1,this._ShaderImported||(this._ShaderImported=!0,a?await Promise.all([Promise.resolve().then((()=>(init_rgbdDecode_fragment(),rgbdDecode_fragment_exports))),Promise.resolve().then((()=>(init_rgbdEncode_fragment(),rgbdEncode_fragment_exports)))]):await Promise.all([Promise.resolve().then((()=>(init_rgbdDecode_fragment2(),rgbdDecode_fragment_exports2))),Promise.resolve().then((()=>(init_rgbdEncode_fragment2(),rgbdEncode_fragment_exports2)))]));const s=new PostProcess("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,t.type,void 0,null,!1,void 0,n);s.externalTextureSamplerBinding=!0;const r=i.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});s.onEffectCreatedObservable.addOnce((a=>{a.executeWhenCompiled((()=>{s.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([s],r,!0),i.restoreDefaultFramebuffer(),i._releaseTexture(t),s&&s.dispose(),r._swapAndDie(t),t.isReady=!0}))}))};s&&(n?r():e.onLoadObservable.addOnce(r))}};RGBDTextureTools._ShaderImported=!1;var _environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==",_instanceNumber=0,GetEnvironmentBRDFTexture=e=>{if(!e.environmentBRDFTexture){const t=e.useDelayedTextureLoading;e.useDelayedTextureLoading=!1;const i=e._blockEntityCollection;e._blockEntityCollection=!1;const a=Texture.CreateFromBase64String(_environmentBRDFBase64Texture,"EnvironmentBRDFTexture"+_instanceNumber++,e,!0,!1,Texture.BILINEAR_SAMPLINGMODE);e._blockEntityCollection=i;const n=e.getEngine().getLoadedTexturesCache(),s=n.indexOf(a.getInternalTexture());-1!==s&&n.splice(s,1),a.isRGBD=!0,a.wrapU=Texture.CLAMP_ADDRESSMODE,a.wrapV=Texture.CLAMP_ADDRESSMODE,e.environmentBRDFTexture=a,e.useDelayedTextureLoading=t,RGBDTextureTools.ExpandRGBDTexture(a);const r=e.getEngine().onContextRestoredObservable.add((()=>{a.isRGBD=!0;const t=e.onBeforeRenderObservable.add((()=>{a.isReady()&&(e.onBeforeRenderObservable.remove(t),RGBDTextureTools.ExpandRGBDTexture(a))}))}));e.onDisposeObservable.add((()=>{e.getEngine().onContextRestoredObservable.remove(r)}))}return e.environmentBRDFTexture},MaterialBRDFDefines=class extends MaterialDefines{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}},PBRBRDFConfiguration=class e extends MaterialPluginBase{prepareDefines(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}constructor(t,i=!0){super(t,"PBRBRDF",90,new MaterialBRDFDefines,i),this._useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=t._dirtyCallbacks[16],this._enable(!0)}getClassName(){return"PBRBRDFConfiguration"}isCompatible(){return!0}};PBRBRDFConfiguration.DEFAULT_USE_ENERGY_CONSERVATION=!0,PBRBRDFConfiguration.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,PBRBRDFConfiguration.DEFAULT_USE_SPHERICAL_HARMONICS=!0,PBRBRDFConfiguration.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBRDFConfiguration.prototype,"useEnergyConservation",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBRDFConfiguration.prototype,"useSmithVisibilityHeightCorrelated",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBRDFConfiguration.prototype,"useSphericalHarmonics",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBRDFConfiguration.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),BaseTexture.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(BaseTexture.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0});var MaterialClearCoatDefines=class extends MaterialDefines{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}},PBRClearCoatConfiguration=class e extends MaterialPluginBase{constructor(t,i=!0){super(t,"PBRClearCoat",100,new MaterialClearCoatDefines,i),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=e._DefaultIndexOfRefraction,this.indexOfRefraction=e._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=Color3.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1]}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}hasTexture(e){return this._texture===e||(this._textureRoughness===e||(this._bumpTexture===e||this._tintTexture===e))}isReadyForSubMesh(e,t,i){if(!this._isEnabled)return!0;const a=this._material._disableBumpMap;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&MaterialFlags.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&MaterialFlags.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(i.getCaps().standardDerivatives&&this._bumpTexture&&MaterialFlags.ClearCoatBumpTextureEnabled&&!a&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&MaterialFlags.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}getSamplers(e){e.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}bindForSubMesh(e,t,i,a){if(!this._isEnabled)return;const n=a.materialDefines,s=this._material.isFrozen,r=this._material._disableBumpMap,o=this._material._invertNormalMapX,l=this._material._invertNormalMapY;if(!e.useUbo||!s||!e.isSync){(this._texture||this._textureRoughness)&&MaterialFlags.ClearCoatTextureEnabled&&(e.updateFloat4("vClearCoatInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&BindTextureMatrix(this._texture,e,"clearCoat"),this._textureRoughness&&!n.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&BindTextureMatrix(this._textureRoughness,e,"clearCoatRoughness")),this._bumpTexture&&i.getCaps().standardDerivatives&&MaterialFlags.ClearCoatTextureEnabled&&!r&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),BindTextureMatrix(this._bumpTexture,e,"clearCoatBump"),t._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",o?1:-1,l?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",o?-1:1,l?-1:1)),this._tintTexture&&MaterialFlags.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),BindTextureMatrix(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);const a=1-this._indexOfRefraction,s=1+this._indexOfRefraction,c=Math.pow(-a/s,2),h=1/this._indexOfRefraction;e.updateFloat4("vClearCoatRefractionParams",c,h,a,s),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&MaterialFlags.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!n.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&MaterialFlags.ClearCoatTextureEnabled&&e.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&i.getCaps().standardDerivatives&&MaterialFlags.ClearCoatBumpTextureEnabled&&!r&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&MaterialFlags.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))}addFallbacks(e,t,i){return e.CLEARCOAT_BUMP&&t.addFallback(i++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&t.addFallback(i++,"CLEARCOAT_TINT"),e.CLEARCOAT&&t.addFallback(i++,"CLEARCOAT"),i}isCompatible(){return!0}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose(),this._bumpTexture?.dispose(),this._tintTexture?.dispose())}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)}getClassName(){return"PBRClearCoatConfiguration"}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)}prepareDefinesBeforeAttributes(t,i){this._isEnabled?(t.CLEARCOAT=!0,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,t._areTexturesDirty&&i.texturesEnabled&&(this._texture&&MaterialFlags.ClearCoatTextureEnabled?PrepareDefinesForMergedUV(this._texture,t,"CLEARCOAT_TEXTURE"):t.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&MaterialFlags.ClearCoatTextureEnabled?PrepareDefinesForMergedUV(this._textureRoughness,t,"CLEARCOAT_TEXTURE_ROUGHNESS"):t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&MaterialFlags.ClearCoatBumpTextureEnabled?PrepareDefinesForMergedUV(this._bumpTexture,t,"CLEARCOAT_BUMP"):t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===e._DefaultIndexOfRefraction,this._isTintEnabled?(t.CLEARCOAT_TINT=!0,this._tintTexture&&MaterialFlags.ClearCoatTintTextureEnabled?(PrepareDefinesForMergedUV(this._tintTexture,t,"CLEARCOAT_TINT_TEXTURE"),t.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):t.CLEARCOAT_TINT_TEXTURE=!1):(t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1))):(t.CLEARCOAT=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.CLEARCOAT_DEFAULTIOR=!1,t.CLEARCOAT_TEXTUREDIRECTUV=0,t.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,t.CLEARCOAT_BUMPDIRECTUV=0,t.CLEARCOAT_REMAP_F0=!1,t.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,t.CLEARCOAT_TINT_GAMMATEXTURE=!1)}};PBRClearCoatConfiguration._DefaultIndexOfRefraction=1.5,__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"isEnabled",void 0),__decorate([serialize()],PBRClearCoatConfiguration.prototype,"intensity",void 0),__decorate([serialize()],PBRClearCoatConfiguration.prototype,"roughness",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"indexOfRefraction",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"texture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"useRoughnessFromMainTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"textureRoughness",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"remapF0OnInterfaceChange",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"bumpTexture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"isTintEnabled",void 0),__decorate([serializeAsColor3()],PBRClearCoatConfiguration.prototype,"tintColor",void 0),__decorate([serialize()],PBRClearCoatConfiguration.prototype,"tintColorAtDistance",void 0),__decorate([serialize()],PBRClearCoatConfiguration.prototype,"tintThickness",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"tintTexture",void 0);var MaterialIridescenceDefines=class extends MaterialDefines{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}},PBRIridescenceConfiguration=class e extends MaterialPluginBase{getSamplers(e){e.push("iridescenceSampler","iridescenceThicknessSampler")}dispose(e){e&&(this._texture?.dispose(),this._thicknessTexture?.dispose())}constructor(t,i=!0){super(t,"PBRIridescence",110,new MaterialIridescenceDefines,i),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.minimumThickness=e._DefaultMinimumThickness,this.maximumThickness=e._DefaultMaximumThickness,this.indexOfRefraction=e._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1]}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||((this._texture||this._thicknessTexture)&&MaterialFlags.IridescenceTextureEnabled&&(e.updateFloat4("vIridescenceInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._thicknessTexture?.coordinatesIndex??0,this._thicknessTexture?.level??0),this._texture&&BindTextureMatrix(this._texture,e,"iridescence"),this._thicknessTexture&&BindTextureMatrix(this._thicknessTexture,e,"iridescenceThickness")),e.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),t.texturesEnabled&&(this._texture&&MaterialFlags.IridescenceTextureEnabled&&e.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&MaterialFlags.IridescenceTextureEnabled&&e.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}isCompatible(){return!0}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isReadyForSubMesh(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&MaterialFlags.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&MaterialFlags.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}getActiveTextures(e){this._texture&&e.push(this._texture),this._thicknessTexture&&e.push(this._thicknessTexture)}addFallbacks(e,t,i){return e.IRIDESCENCE&&t.addFallback(i++,"IRIDESCENCE"),i}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.IRIDESCENCE=!0,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&MaterialFlags.IridescenceTextureEnabled?PrepareDefinesForMergedUV(this._texture,e,"IRIDESCENCE_TEXTURE"):e.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&MaterialFlags.IridescenceTextureEnabled?PrepareDefinesForMergedUV(this._thicknessTexture,e,"IRIDESCENCE_THICKNESS_TEXTURE"):e.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(e.IRIDESCENCE=!1,e.IRIDESCENCE_TEXTURE=!1,e.IRIDESCENCE_THICKNESS_TEXTURE=!1,e.IRIDESCENCE_TEXTUREDIRECTUV=0,e.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}hasTexture(e){return this._texture===e||this._thicknessTexture===e}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture)}getClassName(){return"PBRIridescenceConfiguration"}};PBRIridescenceConfiguration._DefaultMinimumThickness=100,PBRIridescenceConfiguration._DefaultMaximumThickness=400,PBRIridescenceConfiguration._DefaultIndexOfRefraction=1.3,__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRIridescenceConfiguration.prototype,"isEnabled",void 0),__decorate([serialize()],PBRIridescenceConfiguration.prototype,"intensity",void 0),__decorate([serialize()],PBRIridescenceConfiguration.prototype,"minimumThickness",void 0),__decorate([serialize()],PBRIridescenceConfiguration.prototype,"maximumThickness",void 0),__decorate([serialize()],PBRIridescenceConfiguration.prototype,"indexOfRefraction",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRIridescenceConfiguration.prototype,"texture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRIridescenceConfiguration.prototype,"thicknessTexture",void 0);var MaterialAnisotropicDefines=class extends MaterialDefines{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}},PBRAnisotropicConfiguration=class extends MaterialPluginBase{_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}getSamplers(e){e.push("anisotropySampler")}isCompatible(){return!0}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||(this._texture&&MaterialFlags.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),BindTextureMatrix(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),t.texturesEnabled&&this._texture&&MaterialFlags.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)}getActiveTextures(e){this._texture&&e.push(this._texture)}prepareDefinesBeforeAttributes(e,t,i){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!i.isVerticesDataPresent(VertexBuffer.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&MaterialFlags.AnisotropicTextureEnabled?PrepareDefinesForMergedUV(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1),e._areMiscDirty&&(e.ANISOTROPIC_LEGACY=this._legacy)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.ANISOTROPIC_LEGACY=!1)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}constructor(e,t=!0){super(e,"PBRAnisotropic",110,new MaterialAnisotropicDefines,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new Vector2(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16]}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(e,t,i){super.parse(e,t,i),void 0===e.legacy&&(this.legacy=!0)}dispose(e){e&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}set angle(e){this.direction.x=Math.cos(e),this.direction.y=Math.sin(e)}hasTexture(e){return this._texture===e}isReadyForSubMesh(e,t){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&MaterialFlags.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}addFallbacks(e,t,i){return e.ANISOTROPIC&&t.addFallback(i++,"ANISOTROPIC"),i}};__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRAnisotropicConfiguration.prototype,"isEnabled",void 0),__decorate([serialize()],PBRAnisotropicConfiguration.prototype,"intensity",void 0),__decorate([serializeAsVector2()],PBRAnisotropicConfiguration.prototype,"direction",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRAnisotropicConfiguration.prototype,"texture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRAnisotropicConfiguration.prototype,"legacy",void 0);var MaterialSheenDefines=class extends MaterialDefines{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}},PBRSheenConfiguration=class extends MaterialPluginBase{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose())}getClassName(){return"PBRSheenConfiguration"}hasTexture(e){return this._texture===e||this._textureRoughness===e}bindForSubMesh(e,t,i,a){if(!this._isEnabled)return;const n=a.materialDefines,s=this._material.isFrozen;e.useUbo&&s&&e.isSync||((this._texture||this._textureRoughness)&&MaterialFlags.SheenTextureEnabled&&(e.updateFloat4("vSheenInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&BindTextureMatrix(this._texture,e,"sheen"),this._textureRoughness&&!n.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&BindTextureMatrix(this._textureRoughness,e,"sheenRoughness")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&e.updateFloat("vSheenRoughness",this._roughness)),t.texturesEnabled&&(this._texture&&MaterialFlags.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture),this._textureRoughness&&!n.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&MaterialFlags.SheenTextureEnabled&&e.setTexture("sheenRoughnessSampler",this._textureRoughness))}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness)}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}getSamplers(e){e.push("sheenSampler","sheenRoughnessSampler")}isReadyForSubMesh(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&MaterialFlags.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&MaterialFlags.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}constructor(e,t=!0){super(e,"Sheen",120,new MaterialSheenDefines,t),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=Color3.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isCompatible(){return!0}addFallbacks(e,t,i){return e.SHEEN&&t.addFallback(i++,"SHEEN"),i}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.SHEEN=!0,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e.SHEEN_ROUGHNESS=null!==this._roughness,e.SHEEN_ALBEDOSCALING=this._albedoScaling,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&MaterialFlags.SheenTextureEnabled?(PrepareDefinesForMergedUV(this._texture,e,"SHEEN_TEXTURE"),e.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):e.SHEEN_TEXTURE=!1,this._textureRoughness&&MaterialFlags.SheenTextureEnabled?PrepareDefinesForMergedUV(this._textureRoughness,e,"SHEEN_TEXTURE_ROUGHNESS"):e.SHEEN_TEXTURE_ROUGHNESS=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_GAMMATEXTURE=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness)}};__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"isEnabled",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"linkSheenWithAlbedo",void 0),__decorate([serialize()],PBRSheenConfiguration.prototype,"intensity",void 0),__decorate([serializeAsColor3()],PBRSheenConfiguration.prototype,"color",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"texture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"useRoughnessFromMainTexture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"roughness",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"textureRoughness",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"albedoScaling",void 0);var MaterialSubSurfaceDefines=class extends MaterialDefines{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}},PBRSubSurfaceConfiguration=class extends MaterialPluginBase{hardBindForSubMesh(e,t,i,a){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)e.updateFloat2("vThicknessParam",0,0);else{a.getRenderingMesh().getWorldMatrix().decompose(TmpVectors.Vector3[0]);const t=Math.max(Math.abs(TmpVectors.Vector3[0].x),Math.abs(TmpVectors.Vector3[0].y),Math.abs(TmpVectors.Vector3[0].z));e.updateFloat2("vThicknessParam",this.minimumThickness*t,(this.maximumThickness-this.minimumThickness)*t)}}set scatteringDiffusionProfile(e){this._scene.enableSubSurfaceForPrePass()&&e&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(e))}set volumeIndexOfRefraction(e){this._volumeIndexOfRefraction=e>=1?e:-1}get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}getAnimatables(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&e.push(this._translucencyIntensityTexture)}getSamplers(e){e.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}constructor(e,t=!0){super(e,"PBRSubSurface",130,new MaterialSubSurfaceDefines,t),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=Color3.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=Color3.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=e.getScene(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=e._dirtyCallbacks[32]}hasTexture(e){return this._thicknessTexture===e||(this._refractionTexture===e||(this._refractionIntensityTexture===e||(this._translucencyIntensityTexture===e||this._translucencyColorTexture===e)))}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isReadyForSubMesh(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&MaterialFlags.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&MaterialFlags.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&MaterialFlags.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const e=this._getRefractionTexture(t);if(e&&MaterialFlags.RefractionTextureEnabled&&!e.isReadyOrNotBlocking())return!1}return!0}bindForSubMesh(e,t,i,a){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const n=a.materialDefines,s=this._material.isFrozen,r=this._material.realTimeFiltering,o=n.LODBASEDMICROSFURACE,l=this._getRefractionTexture(t);if(!e.useUbo||!s||!e.isSync){if(this._thicknessTexture&&MaterialFlags.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),BindTextureMatrix(this._thicknessTexture,e,"thickness")),this._refractionIntensityTexture&&MaterialFlags.RefractionIntensityTextureEnabled&&n.SS_REFRACTIONINTENSITY_TEXTURE&&(e.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),BindTextureMatrix(this._refractionIntensityTexture,e,"refractionIntensity")),this._translucencyColorTexture&&MaterialFlags.TranslucencyColorTextureEnabled&&n.SS_TRANSLUCENCYCOLOR_TEXTURE&&(e.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),BindTextureMatrix(this._translucencyColorTexture,e,"translucencyColor")),this._translucencyIntensityTexture&&MaterialFlags.TranslucencyIntensityTextureEnabled&&n.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(e.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),BindTextureMatrix(this._translucencyIntensityTexture,e,"translucencyIntensity")),l&&MaterialFlags.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",l.getRefractionTextureMatrix());let t=1;l.isCube||l.depth&&(t=l.depth);const i=l.getSize().width,a=this.volumeIndexOfRefraction;if(e.updateFloat4("vRefractionInfos",l.level,1/a,t,this._invertRefractionY?-1:1),e.updateFloat4("vRefractionMicrosurfaceInfos",i,l.lodGenerationScale,l.lodGenerationOffset,1/this.indexOfRefraction),r&&e.updateFloat2("vRefractionFilteringInfo",i,Scalar.Log2(i)),l.boundingBoxSize){const t=l;e.updateVector3("vRefractionPosition",t.boundingBoxPosition),e.updateVector3("vRefractionSize",t.boundingBoxSize)}}this._isScatteringEnabled&&e.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),e.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),e.updateFloat("dispersion",this.dispersion)}t.texturesEnabled&&(this._thicknessTexture&&MaterialFlags.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&MaterialFlags.RefractionIntensityTextureEnabled&&n.SS_REFRACTIONINTENSITY_TEXTURE&&e.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&MaterialFlags.TranslucencyIntensityTextureEnabled&&n.SS_TRANSLUCENCYINTENSITY_TEXTURE&&e.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&MaterialFlags.TranslucencyColorTextureEnabled&&n.SS_TRANSLUCENCYCOLOR_TEXTURE&&e.setTexture("translucencyColorSampler",this._translucencyColorTexture),l&&MaterialFlags.RefractionTextureEnabled&&(o?e.setTexture("refractionSampler",l):(e.setTexture("refractionSampler",l._lodTextureMid||l),e.setTexture("refractionSamplerLow",l._lodTextureLow||l),e.setTexture("refractionSamplerHigh",l._lodTextureHigh||l))))}dispose(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getActiveTextures(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture),this._translucencyColorTexture&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&e.push(this._translucencyIntensityTexture)}prepareDefinesBeforeAttributes(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return e.SUBSURFACE=!1,e.SS_DISPERSION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_HAS_THICKNESS=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(e.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(e._areTexturesDirty){if(e.SUBSURFACE=!0,e.SS_DISPERSION=this._isDispersionEnabled,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_SCATTERING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_HAS_THICKNESS=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,e._areTexturesDirty&&t.texturesEnabled&&(this._thicknessTexture&&MaterialFlags.ThicknessTextureEnabled&&PrepareDefinesForMergedUV(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&MaterialFlags.RefractionIntensityTextureEnabled&&PrepareDefinesForMergedUV(this._refractionIntensityTexture,e,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&MaterialFlags.TranslucencyIntensityTextureEnabled&&PrepareDefinesForMergedUV(this._translucencyIntensityTexture,e,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&MaterialFlags.TranslucencyColorTextureEnabled&&PrepareDefinesForMergedUV(this._translucencyColorTexture,e,"SS_TRANSLUCENCYCOLOR_TEXTURE")),e.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!=0,e.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&t.texturesEnabled){const i=this._getRefractionTexture(t);i&&MaterialFlags.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=i.isCube,e.SS_GAMMAREFRACTION=i.gammaSpace,e.SS_RGBDREFRACTION=i.isRGBD,e.SS_LINEARSPECULARREFRACTION=i.linearSpecularLOD,e.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&i.isCube?!i.invertZ:i.invertZ,e.SS_LODINREFRACTIONALPHA=i.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,e.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=i.isCube&&i.boundingBoxSize,e.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(e.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}addFallbacks(e,t,i){return e.SS_SCATTERING&&t.addFallback(i++,"SS_SCATTERING"),e.SS_TRANSLUCENCY&&t.addFallback(i++,"SS_TRANSLUCENCY"),i}fillRenderTargetTextures(e){MaterialFlags.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)}isCompatible(){return!0}hasRenderTargetTextures(){return!!(MaterialFlags.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}getClassName(){return"PBRSubSurfaceConfiguration"}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_getRefractionTexture(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null}};__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"isRefractionEnabled",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"isTranslucencyEnabled",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"isDispersionEnabled",void 0),__decorate([serialize(),expandToProperty("_markScenePrePassDirty")],PBRSubSurfaceConfiguration.prototype,"isScatteringEnabled",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"_scatteringDiffusionProfileIndex",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"refractionIntensity",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"translucencyIntensity",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"useAlbedoToTintRefraction",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"useAlbedoToTintTranslucency",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"thicknessTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"refractionTexture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"indexOfRefraction",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"_volumeIndexOfRefraction",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"volumeIndexOfRefraction",null),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"invertRefractionY",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"linkRefractionWithTransparency",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"minimumThickness",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"maximumThickness",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"useThicknessAsDepth",void 0),__decorate([serializeAsColor3()],PBRSubSurfaceConfiguration.prototype,"tintColor",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"tintColorAtDistance",void 0),__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"dispersion",void 0),__decorate([serializeAsColor3()],PBRSubSurfaceConfiguration.prototype,"diffusionDistance",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"useMaskFromThicknessTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"refractionIntensityTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"translucencyIntensityTexture",void 0),__decorate([serializeAsColor3()],PBRSubSurfaceConfiguration.prototype,"translucencyColor",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"translucencyColorTexture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"useGltfStyleTextures",void 0);var onCreatedEffectParameters4={effect:null,subMesh:null},PBRMaterialDefines=class extends MaterialDefines{reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}constructor(e){super(e),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}},PBRBaseMaterial=class e extends PushMaterial{get isPrePassCapable(){return!this.disableDepthWrite}get _disableAlphaBlending(){return this._transparencyMode===e.PBRMATERIAL_OPAQUE||this._transparencyMode===e.PBRMATERIAL_ALPHATEST||this.subSurface?.disableAlphaBlending}set realTimeFiltering(e){this._realTimeFiltering=e,this.markAsDirty(1)}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture}_prepareDefines(t,i,a=null,n=null,s=!1){const r=this.getScene(),o=r.getEngine();PrepareDefinesForLights(r,t,i,!0,this._maxSimultaneousLights,this._disableLighting),i._needNormals=!0,PrepareDefinesForMultiview(r,i);const l=this.needAlphaBlendingForMesh(t)&&this.getScene().useOrderIndependentTransparency;if(PrepareDefinesForPrePass(r,i,this.canRenderToMRT&&!l),PrepareDefinesForOIT(r,i,l),i.METALLICWORKFLOW=this.isMetallicWorkflow(),i._areTexturesDirty){i._needUVs=!1;for(let e=1;e<=6;++e)i["MAINUV"+e]=!1;if(r.texturesEnabled){i.ALBEDODIRECTUV=0,i.AMBIENTDIRECTUV=0,i.OPACITYDIRECTUV=0,i.EMISSIVEDIRECTUV=0,i.REFLECTIVITYDIRECTUV=0,i.MICROSURFACEMAPDIRECTUV=0,i.METALLIC_REFLECTANCEDIRECTUV=0,i.REFLECTANCEDIRECTUV=0,i.BUMPDIRECTUV=0,i.LIGHTMAPDIRECTUV=0,o.getCaps().textureLOD&&(i.LODBASEDMICROSFURACE=!0),this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled?(PrepareDefinesForMergedUV(this._albedoTexture,i,"ALBEDO"),i.GAMMAALBEDO=this._albedoTexture.gammaSpace):i.ALBEDO=!1,this._ambientTexture&&MaterialFlags.AmbientTextureEnabled?(PrepareDefinesForMergedUV(this._ambientTexture,i,"AMBIENT"),i.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):i.AMBIENT=!1,this._opacityTexture&&MaterialFlags.OpacityTextureEnabled?(PrepareDefinesForMergedUV(this._opacityTexture,i,"OPACITY"),i.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):i.OPACITY=!1;const e=this._getReflectionTexture();if(e&&MaterialFlags.ReflectionTextureEnabled){switch(i.REFLECTION=!0,i.GAMMAREFLECTION=e.gammaSpace,i.RGBDREFLECTION=e.isRGBD,i.LODINREFLECTIONALPHA=e.lodLevelInAlpha,i.LINEARSPECULARREFLECTION=e.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(i.NUM_SAMPLES=""+this.realTimeFilteringQuality,o._features.needTypeSuffixInShaderConstants&&(i.NUM_SAMPLES=i.NUM_SAMPLES+"u"),i.REALTIME_FILTERING=!0):i.REALTIME_FILTERING=!1,i.INVERTCUBICMAP=e.coordinatesMode===Texture.INVCUBIC_MODE,i.REFLECTIONMAP_3D=e.isCube,i.REFLECTIONMAP_OPPOSITEZ=i.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!e.invertZ:e.invertZ,i.REFLECTIONMAP_CUBIC=!1,i.REFLECTIONMAP_EXPLICIT=!1,i.REFLECTIONMAP_PLANAR=!1,i.REFLECTIONMAP_PROJECTION=!1,i.REFLECTIONMAP_SKYBOX=!1,i.REFLECTIONMAP_SPHERICAL=!1,i.REFLECTIONMAP_EQUIRECTANGULAR=!1,i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.coordinatesMode){case Texture.EXPLICIT_MODE:i.REFLECTIONMAP_EXPLICIT=!0;break;case Texture.PLANAR_MODE:i.REFLECTIONMAP_PLANAR=!0;break;case Texture.PROJECTION_MODE:i.REFLECTIONMAP_PROJECTION=!0;break;case Texture.SKYBOX_MODE:i.REFLECTIONMAP_SKYBOX=!0;break;case Texture.SPHERICAL_MODE:i.REFLECTIONMAP_SPHERICAL=!0;break;case Texture.EQUIRECTANGULAR_MODE:i.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Texture.FIXED_EQUIRECTANGULAR_MODE:i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Texture.CUBIC_MODE:case Texture.INVCUBIC_MODE:default:i.REFLECTIONMAP_CUBIC=!0,i.USE_LOCAL_REFLECTIONMAP_CUBIC=!!e.boundingBoxSize}e.coordinatesMode!==Texture.SKYBOX_MODE&&(e.irradianceTexture?(i.USEIRRADIANCEMAP=!0,i.USESPHERICALFROMREFLECTIONMAP=!1):e.isCube&&(i.USESPHERICALFROMREFLECTIONMAP=!0,i.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||o.getCaps().maxVaryingVectors<=8?i.USESPHERICALINVERTEX=!1:i.USESPHERICALINVERTEX=!0))}else i.REFLECTION=!1,i.REFLECTIONMAP_3D=!1,i.REFLECTIONMAP_SPHERICAL=!1,i.REFLECTIONMAP_PLANAR=!1,i.REFLECTIONMAP_CUBIC=!1,i.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,i.REFLECTIONMAP_PROJECTION=!1,i.REFLECTIONMAP_SKYBOX=!1,i.REFLECTIONMAP_EXPLICIT=!1,i.REFLECTIONMAP_EQUIRECTANGULAR=!1,i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,i.INVERTCUBICMAP=!1,i.USESPHERICALFROMREFLECTIONMAP=!1,i.USEIRRADIANCEMAP=!1,i.USESPHERICALINVERTEX=!1,i.REFLECTIONMAP_OPPOSITEZ=!1,i.LODINREFLECTIONALPHA=!1,i.GAMMAREFLECTION=!1,i.RGBDREFLECTION=!1,i.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&MaterialFlags.LightmapTextureEnabled?(PrepareDefinesForMergedUV(this._lightmapTexture,i,"LIGHTMAP"),i.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,i.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,i.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):i.LIGHTMAP=!1,this._emissiveTexture&&MaterialFlags.EmissiveTextureEnabled?(PrepareDefinesForMergedUV(this._emissiveTexture,i,"EMISSIVE"),i.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):i.EMISSIVE=!1,MaterialFlags.SpecularTextureEnabled?(this._metallicTexture?(PrepareDefinesForMergedUV(this._metallicTexture,i,"REFLECTIVITY"),i.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,i.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,i.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,i.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,i.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(PrepareDefinesForMergedUV(this._reflectivityTexture,i,"REFLECTIVITY"),i.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,i.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,i.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):i.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(i.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?(PrepareDefinesForMergedUV(this._metallicReflectanceTexture,i,"METALLIC_REFLECTANCE"),i.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):i.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(PrepareDefinesForMergedUV(this._reflectanceTexture,i,"REFLECTANCE"),i.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):i.REFLECTANCE=!1):(i.METALLIC_REFLECTANCE=!1,i.REFLECTANCE=!1),this._microSurfaceTexture?PrepareDefinesForMergedUV(this._microSurfaceTexture,i,"MICROSURFACEMAP"):i.MICROSURFACEMAP=!1):(i.REFLECTIVITY=!1,i.MICROSURFACEMAP=!1),o.getCaps().standardDerivatives&&this._bumpTexture&&MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap?(PrepareDefinesForMergedUV(this._bumpTexture,i,"BUMP"),this._useParallax&&this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled?(i.PARALLAX=!0,i.PARALLAX_RHS=r.useRightHandedSystem,i.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):i.PARALLAX=!1,i.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(i.BUMP=!1,i.PARALLAX=!1,i.PARALLAX_RHS=!1,i.PARALLAXOCCLUSION=!1,i.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&MaterialFlags.ReflectionTextureEnabled?(i.ENVIRONMENTBRDF=!0,i.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(i.ENVIRONMENTBRDF=!1,i.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?i.ALPHAFROMALBEDO=!0:i.ALPHAFROMALBEDO=!1}i.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===e.LIGHTFALLOFF_STANDARD?(i.USEPHYSICALLIGHTFALLOFF=!1,i.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===e.LIGHTFALLOFF_GLTF?(i.USEPHYSICALLIGHTFALLOFF=!1,i.USEGLTFLIGHTFALLOFF=!0):(i.USEPHYSICALLIGHTFALLOFF=!0,i.USEGLTFLIGHTFALLOFF=!1),i.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?i.TWOSIDEDLIGHTING=!0:i.TWOSIDEDLIGHTING=!1,i.SPECULARAA=o.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(i._areTexturesDirty||i._areMiscDirty)&&(i.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1==0?".":""}`,i.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,i.ALPHABLEND=this.needAlphaBlendingForMesh(t),i.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,i.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),i._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(i),i.FORCENORMALFORWARD=this._forceNormalForward,i.RADIANCEOCCLUSION=this._useRadianceOcclusion,i.HORIZONOCCLUSION=this._useHorizonOcclusion,i._areMiscDirty&&(PrepareDefinesForMisc(t,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(t)||this._forceAlphaTest,i,this._applyDecalMapAfterDetailMap),i.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!t.isVerticesDataPresent(VertexBuffer.NormalKind),i.DEBUGMODE=this._debugMode),PrepareDefinesForFrameBoundValues(r,o,this,i,!!a,n,s),this._eventInfo.defines=i,this._eventInfo.mesh=t,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),PrepareDefinesForAttributes(t,i,!0,!0,!0,this._transparencyMode!==e.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==e.PBRMATERIAL_OPAQUE}isReadyForSubMesh(e,t,i){if(!this._shadersLoaded)return!1;this._uniformBufferLayoutBuilt||this.buildUniformLayout();const a=t._drawWrapper;if(a.effect&&this.isFrozen&&a._wasPreviouslyReady&&a._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new PBRMaterialDefines(this._eventInfo.defineNames));const n=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const s=this.getScene(),r=s.getEngine();if(n._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,s.texturesEnabled)){if(this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&MaterialFlags.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&MaterialFlags.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const e=this._getReflectionTexture();if(e&&MaterialFlags.ReflectionTextureEnabled){if(!e.isReadyOrNotBlocking())return!1;if(e.irradianceTexture){if(!e.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!e.sphericalPolynomial&&e.getInternalTexture()?._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&MaterialFlags.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&MaterialFlags.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(MaterialFlags.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(r.getCaps().standardDerivatives&&this._bumpTexture&&MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&MaterialFlags.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=n,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(n._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;r.getCaps().standardDerivatives||e.isVerticesDataPresent(VertexBuffer.NormalKind)||(e.createNormals(!0),Logger.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));const o=t.effect,l=n._areLightsDisposed;let c=this._prepareEffect(e,n,this.onCompiled,this.onError,i,null,t.getRenderingMesh().hasThinInstances),h=!1;if(c)if(this._onEffectCreatedObservable&&(onCreatedEffectParameters4.effect=c,onCreatedEffectParameters4.subMesh=t,this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters4)),this.allowShaderHotSwapping&&o&&!c.isReady()){if(c=o,n.markAsUnprocessed(),h=this.isFrozen,l)return n._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),t.setEffect(c,n,this._materialContext);return!(!t.effect||!t.effect.isReady())&&(n._renderId=s.getRenderId(),a._wasPreviouslyReady=!h,a._wasPreviouslyUsingInstances=!!i,this._checkScenePerformancePriority(),!0)}get canRenderToMRT(){return!0}getAnimatables(){const e=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&e.push(this._microSurfaceTexture),e}_prepareEffect(e,t,i=null,a=null,n=null,s=null,r){if(this._prepareDefines(e,t,n,s,r),!t.isDirty)return null;t.markAsProcessed();const o=this.getScene().getEngine(),l=new EffectFallbacks;let c=0;t.USESPHERICALINVERTEX&&l.addFallback(c++,"USESPHERICALINVERTEX"),t.FOG&&l.addFallback(c,"FOG"),t.SPECULARAA&&l.addFallback(c,"SPECULARAA"),t.POINTSIZE&&l.addFallback(c,"POINTSIZE"),t.LOGARITHMICDEPTH&&l.addFallback(c,"LOGARITHMICDEPTH"),t.PARALLAX&&l.addFallback(c,"PARALLAX"),t.PARALLAX_RHS&&l.addFallback(c,"PARALLAX_RHS"),t.PARALLAXOCCLUSION&&l.addFallback(c++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&l.addFallback(c++,"ENVIRONMENTBRDF"),t.TANGENT&&l.addFallback(c++,"TANGENT"),t.BUMP&&l.addFallback(c++,"BUMP"),c=HandleFallbacksForShadows(t,l,this._maxSimultaneousLights,c++),t.SPECULARTERM&&l.addFallback(c++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&l.addFallback(c++,"USESPHERICALFROMREFLECTIONMAP"),t.USEIRRADIANCEMAP&&l.addFallback(c++,"USEIRRADIANCEMAP"),t.LIGHTMAP&&l.addFallback(c++,"LIGHTMAP"),t.NORMAL&&l.addFallback(c++,"NORMAL"),t.AMBIENT&&l.addFallback(c++,"AMBIENT"),t.EMISSIVE&&l.addFallback(c++,"EMISSIVE"),t.VERTEXCOLOR&&l.addFallback(c++,"VERTEXCOLOR"),t.MORPHTARGETS&&l.addFallback(c++,"MORPHTARGETS"),t.MULTIVIEW&&l.addFallback(0,"MULTIVIEW");const h=[VertexBuffer.PositionKind];t.NORMAL&&h.push(VertexBuffer.NormalKind),t.TANGENT&&h.push(VertexBuffer.TangentKind);for(let e=1;e<=6;++e)t["UV"+e]&&h.push(`uv${1===e?"":e}`);t.VERTEXCOLOR&&h.push(VertexBuffer.ColorKind),PrepareAttributesForBones(h,e,t,l),PrepareAttributesForInstances(h,t),PrepareAttributesForMorphTargets(h,e,t),PrepareAttributesForBakedVertexAnimation(h,e,t);let u="pbr";const m=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],d=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],f=["Material","Scene","Mesh"],p={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=l,this._eventInfo.fallbackRank=c,this._eventInfo.defines=t,this._eventInfo.uniforms=m,this._eventInfo.attributes=h,this._eventInfo.samplers=d,this._eventInfo.uniformBuffersNames=f,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=p,this._callbackPluginEventGeneric(128,this._eventInfo),PrePassConfiguration.AddUniforms(m),PrePassConfiguration.AddSamplers(d),addClipPlaneUniforms(m),ImageProcessingConfiguration&&(ImageProcessingConfiguration.PrepareUniforms(m,t),ImageProcessingConfiguration.PrepareSamplers(d,t)),PrepareUniformsAndSamplersList({uniformsNames:m,uniformBuffersNames:f,samplers:d,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});const _={};this.customShaderNameResolve&&(u=this.customShaderNameResolve(u,m,f,d,t,h,_));const g=t.toString(),v=o.createEffect(u,{attributes:h,uniformsNames:m,uniformBuffersNames:f,samplers:d,defines:g,fallbacks:l,onCompiled:i,onError:a,indexParameters:p,processFinalCode:_.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS,shaderLanguage:this._shaderLanguage},o);return this._eventInfo.customCode=void 0,v}hasTexture(e){return!!super.hasTexture(e)||(this._albedoTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._reflectivityTexture===e||(this._metallicTexture===e||(this._metallicReflectanceTexture===e||(this._reflectanceTexture===e||(this._microSurfaceTexture===e||(this._bumpTexture===e||this._lightmapTexture===e)))))))))))}set realTimeFilteringQuality(e){this._realTimeFilteringQuality=e,this.markAsDirty(1)}async _initShaderSourceAsync(t=!1){const i=this.getScene().getEngine();!i.isWebGPU||t||e.ForceGLSL?await Promise.all([Promise.resolve().then((()=>(init_pbr_vertex2(),pbr_vertex_exports2))),Promise.resolve().then((()=>(init_pbr_fragment2(),pbr_fragment_exports2)))]):(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new UniformBuffer(i,void 0,void 0,this.name,!0),this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(init_pbr_vertex(),pbr_vertex_exports))),Promise.resolve().then((()=>(init_pbr_fragment(),pbr_fragment_exports)))])),this._shadersLoaded=!0}setPrePassRenderer(){if(!this.subSurface?.isScatteringEnabled)return!1;const e=this.getScene().enableSubSurfaceForPrePass();return e&&(e.enabled=!0),!0}needAlphaTesting(){return!!this._forceAlphaTest||!this.subSurface?.disableAlphaBlending&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===e.PBRMATERIAL_ALPHATEST))}dispose(e,t){this._breakShaderLoadedCheck=!0,t&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._albedoTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._metallicTexture?.dispose(),this._reflectivityTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._metallicReflectanceTexture?.dispose(),this._reflectanceTexture?.dispose(),this._microSurfaceTexture?.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}get hasRenderTargetTextures(){return!!(MaterialFlags.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}bindForSubMesh(e,t,i){const a=this.getScene(),n=i.materialDefines;if(!n)return;const s=i.effect;if(!s)return;this._activeEffect=s,t.getMeshUniformBuffer().bindToEffect(s,"Mesh"),t.transferToEffect(e);const r=a.getEngine();this._uniformBuffer.bindToEffect(s,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),n.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const o=this._mustRebind(a,s,i,t.visibility);BindBonesParameters(t,this._activeEffect,this.prePassConfiguration);let l=null;const c=this._uniformBuffer;if(o){if(this.bindViewProjection(s),l=this._getReflectionTexture(),!c.useUbo||!this.isFrozen||!c.isSync||i._drawWrapper._forceRebindOnNextCall){if(a.texturesEnabled){if(this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled&&(c.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),BindTextureMatrix(this._albedoTexture,c,"albedo")),this._ambientTexture&&MaterialFlags.AmbientTextureEnabled&&(c.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),BindTextureMatrix(this._ambientTexture,c,"ambient")),this._opacityTexture&&MaterialFlags.OpacityTextureEnabled&&(c.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),BindTextureMatrix(this._opacityTexture,c,"opacity")),l&&MaterialFlags.ReflectionTextureEnabled){if(c.updateMatrix("reflectionMatrix",l.getReflectionTextureMatrix()),c.updateFloat2("vReflectionInfos",l.level,0),l.boundingBoxSize){const e=l;c.updateVector3("vReflectionPosition",e.boundingBoxPosition),c.updateVector3("vReflectionSize",e.boundingBoxSize)}if(this.realTimeFiltering){const e=l.getSize().width;c.updateFloat2("vReflectionFilteringInfo",e,Scalar.Log2(e))}if(!n.USEIRRADIANCEMAP){const e=l.sphericalPolynomial;if(n.USESPHERICALFROMREFLECTIONMAP&&e)if(n.SPHERICAL_HARMONICS){const t=e.preScaledHarmonics;c.updateVector3("vSphericalL00",t.l00),c.updateVector3("vSphericalL1_1",t.l1_1),c.updateVector3("vSphericalL10",t.l10),c.updateVector3("vSphericalL11",t.l11),c.updateVector3("vSphericalL2_2",t.l2_2),c.updateVector3("vSphericalL2_1",t.l2_1),c.updateVector3("vSphericalL20",t.l20),c.updateVector3("vSphericalL21",t.l21),c.updateVector3("vSphericalL22",t.l22)}else c.updateFloat3("vSphericalX",e.x.x,e.x.y,e.x.z),c.updateFloat3("vSphericalY",e.y.x,e.y.y,e.y.z),c.updateFloat3("vSphericalZ",e.z.x,e.z.y,e.z.z),c.updateFloat3("vSphericalXX_ZZ",e.xx.x-e.zz.x,e.xx.y-e.zz.y,e.xx.z-e.zz.z),c.updateFloat3("vSphericalYY_ZZ",e.yy.x-e.zz.x,e.yy.y-e.zz.y,e.yy.z-e.zz.z),c.updateFloat3("vSphericalZZ",e.zz.x,e.zz.y,e.zz.z),c.updateFloat3("vSphericalXY",e.xy.x,e.xy.y,e.xy.z),c.updateFloat3("vSphericalYZ",e.yz.x,e.yz.y,e.yz.z),c.updateFloat3("vSphericalZX",e.zx.x,e.zx.y,e.zx.z)}c.updateFloat3("vReflectionMicrosurfaceInfos",l.getSize().width,l.lodGenerationScale,l.lodGenerationOffset)}this._emissiveTexture&&MaterialFlags.EmissiveTextureEnabled&&(c.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),BindTextureMatrix(this._emissiveTexture,c,"emissive")),this._lightmapTexture&&MaterialFlags.LightmapTextureEnabled&&(c.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),BindTextureMatrix(this._lightmapTexture,c,"lightmap")),MaterialFlags.SpecularTextureEnabled&&(this._metallicTexture?(c.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),BindTextureMatrix(this._metallicTexture,c,"reflectivity")):this._reflectivityTexture&&(c.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),BindTextureMatrix(this._reflectivityTexture,c,"reflectivity")),this._metallicReflectanceTexture&&(c.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),BindTextureMatrix(this._metallicReflectanceTexture,c,"metallicReflectance")),this._reflectanceTexture&&n.REFLECTANCE&&(c.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),BindTextureMatrix(this._reflectanceTexture,c,"reflectance")),this._microSurfaceTexture&&(c.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),BindTextureMatrix(this._microSurfaceTexture,c,"microSurfaceSampler"))),this._bumpTexture&&r.getCaps().standardDerivatives&&MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap&&(c.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),BindTextureMatrix(this._bumpTexture,c,"bump"),a._mirroredCameraPosition?c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&c.updateFloat("pointSize",this.pointSize),n.METALLICWORKFLOW){TmpColors.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,TmpColors.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,c.updateColor4("vReflectivityColor",TmpColors.Color3[0],1);const e=this.subSurface?._indexOfRefraction??1.5,t=1,i=Math.pow((e-t)/(e+t),2);this._metallicReflectanceColor.scaleToRef(i*this._metallicF0Factor,TmpColors.Color3[0]);const a=this._metallicF0Factor;c.updateColor4("vMetallicReflectanceFactors",TmpColors.Color3[0],a)}else c.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);c.updateColor3("vEmissiveColor",MaterialFlags.EmissiveTextureEnabled?this._emissiveColor:Color3.BlackReadOnly),c.updateColor3("vReflectionColor",this._reflectionColor),!n.SS_REFRACTION&&this.subSurface?._linkRefractionWithTransparency?c.updateColor4("vAlbedoColor",this._albedoColor,1):c.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*a.environmentIntensity,this._lightingInfos.w=this._specularIntensity,c.updateVector4("vLightingIntensity",this._lightingInfos),a.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),c.updateColor3("vAmbientColor",this._globalAmbientColor),c.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}a.texturesEnabled&&(this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled&&c.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&MaterialFlags.AmbientTextureEnabled&&c.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&MaterialFlags.OpacityTextureEnabled&&c.setTexture("opacitySampler",this._opacityTexture),l&&MaterialFlags.ReflectionTextureEnabled&&(n.LODBASEDMICROSFURACE?c.setTexture("reflectionSampler",l):(c.setTexture("reflectionSampler",l._lodTextureMid||l),c.setTexture("reflectionSamplerLow",l._lodTextureLow||l),c.setTexture("reflectionSamplerHigh",l._lodTextureHigh||l)),n.USEIRRADIANCEMAP&&c.setTexture("irradianceSampler",l.irradianceTexture)),n.ENVIRONMENTBRDF&&c.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&MaterialFlags.EmissiveTextureEnabled&&c.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&MaterialFlags.LightmapTextureEnabled&&c.setTexture("lightmapSampler",this._lightmapTexture),MaterialFlags.SpecularTextureEnabled&&(this._metallicTexture?c.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&c.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&c.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&n.REFLECTANCE&&c.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&c.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&r.getCaps().standardDerivatives&&MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap&&c.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(s),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),bindClipPlane(this._activeEffect,this,a),this.bindEyePosition(s)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!o&&this.isFrozen||(a.lightsEnabled&&!this._disableLighting&&BindLights(a,t,this._activeEffect,n,this._maxSimultaneousLights),(a.fogEnabled&&t.applyFog&&a.fogMode!==Scene.FOGMODE_NONE||l||this.subSurface.refractionTexture||t.receiveShadows||n.PREPASS)&&this.bindView(s),BindFogParameters(a,t,this._activeEffect,!0),n.NUM_MORPH_INFLUENCERS&&BindMorphTargetParameters(t,this._activeEffect),n.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(s,n.INSTANCES),this._imageProcessingConfiguration.bind(this._activeEffect),BindLogDepth(n,this._activeEffect,a)),this._afterBind(t,this._activeEffect,i),c.update()}getClassName(){return"PBRBaseMaterial"}constructor(t,i,a=!1){super(t,i),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new Vector4(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=Color3.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new Color3(0,0,0),this._albedoColor=new Color3(1,1,1),this._reflectivityColor=new Color3(1,1,1),this._reflectionColor=new Color3(1,1,1),this._emissiveColor=new Color3(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=e.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new SmartArray(16),this._globalAmbientColor=new Color3(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this._initShaderSourceAsync(a),this.brdf=new PBRBRDFConfiguration(this),this.clearCoat=new PBRClearCoatConfiguration(this),this.iridescence=new PBRIridescenceConfiguration(this),this.anisotropy=new PBRAnisotropicConfiguration(this),this.sheen=new PBRSheenConfiguration(this),this.subSurface=new PBRSubSurfaceConfiguration(this),this.detailMap=new DetailMapConfiguration(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),MaterialFlags.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=GetEnvironmentBRDFTexture(this.getScene()),this.prePassConfiguration=new PrePassConfiguration}getAlphaTestTexture(){return this._albedoTexture}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vAmbientColor",3),e.addUniform("vDebugMode",2),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),e.addUniform("vReflectanceInfos",2),e.addUniform("reflectanceMatrix",16),e.addUniform("vSphericalL00",3),e.addUniform("vSphericalL1_1",3),e.addUniform("vSphericalL10",3),e.addUniform("vSphericalL11",3),e.addUniform("vSphericalL2_2",3),e.addUniform("vSphericalL2_1",3),e.addUniform("vSphericalL20",3),e.addUniform("vSphericalL21",3),e.addUniform("vSphericalL22",3),e.addUniform("vSphericalX",3),e.addUniform("vSphericalY",3),e.addUniform("vSphericalZ",3),e.addUniform("vSphericalXX_ZZ",3),e.addUniform("vSphericalYY_ZZ",3),e.addUniform("vSphericalZZ",3),e.addUniform("vSphericalXY",3),e.addUniform("vSphericalYZ",3),e.addUniform("vSphericalZX",3),super.buildUniformLayout()}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get realTimeFiltering(){return this._realTimeFiltering}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}getActiveTextures(){const e=super.getActiveTextures();return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),e}forceCompilation(e,t,i){const a={clipPlane:!1,useInstances:!1,...i};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);const n=()=>{if(!this._breakShaderLoadedCheck)if(this._shadersLoaded){const i=new PBRMaterialDefines(this._eventInfo.defineNames),n=this._prepareEffect(e,i,void 0,void 0,a.useInstances,a.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(onCreatedEffectParameters4.effect=n,onCreatedEffectParameters4.subMesh=null,this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters4)),n.isReady()?t&&t(this):n.onCompileObservable.add((()=>{t&&t(this)}))}else setTimeout(n,16)};n()}};PBRBaseMaterial.PBRMATERIAL_OPAQUE=Material.MATERIAL_OPAQUE,PBRBaseMaterial.PBRMATERIAL_ALPHATEST=Material.MATERIAL_ALPHATEST,PBRBaseMaterial.PBRMATERIAL_ALPHABLEND=Material.MATERIAL_ALPHABLEND,PBRBaseMaterial.PBRMATERIAL_ALPHATESTANDBLEND=Material.MATERIAL_ALPHATESTANDBLEND,PBRBaseMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL=0,PBRBaseMaterial.LIGHTFALLOFF_GLTF=1,PBRBaseMaterial.LIGHTFALLOFF_STANDARD=2,PBRBaseMaterial.ForceGLSL=!1,__decorate([serializeAsImageProcessingConfiguration()],PBRBaseMaterial.prototype,"_imageProcessingConfiguration",void 0),__decorate([expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBaseMaterial.prototype,"debugMode",void 0);var PBRMaterial=class e extends PBRBaseMaterial{get usePhysicalLightFalloff(){return this._lightFalloff===PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL}getClassName(){return"PBRMaterial"}get invertRefractionY(){return this.subSurface.invertRefractionY}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set indexOfRefraction(e){this.subSurface.indexOfRefraction=e}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set usePhysicalLightFalloff(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL:PBRBaseMaterial.LIGHTFALLOFF_STANDARD)}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set useGLTFLightFalloff(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?PBRBaseMaterial.LIGHTFALLOFF_GLTF:PBRBaseMaterial.LIGHTFALLOFF_STANDARD)}set refractionTexture(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}serialize(){const e=super.serialize();return e.customType="BABYLON.PBRMaterial",e}set linkRefractionWithTransparency(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)}get useGLTFLightFalloff(){return this._lightFalloff===PBRBaseMaterial.LIGHTFALLOFF_GLTF}get refractionTexture(){return this.subSurface.refractionTexture}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set invertRefractionY(e){this.subSurface.invertRefractionY=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}get cameraExposure(){return this._imageProcessingConfiguration.exposure}constructor(t,i,a=!1){super(t,i,a),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=Color3.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new Color3(0,0,0),this.albedoColor=new Color3(1,1,1),this.reflectivityColor=new Color3(1,1,1),this.reflectionColor=new Color3(1,1,1),this.emissiveColor=new Color3(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=GetEnvironmentBRDFTexture(this.getScene())}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}clone(t,i=!0,a=""){const n=SerializationHelper.Clone((()=>new e(t,this.getScene())),this,{cloneTexturesOnlyOnce:i});return n.id=t,n.name=t,this.stencil.copyTo(n.stencil),this._clonePlugins(n,a),n}static Parse(t,i,a){const n=SerializationHelper.Parse((()=>new e(t.name,i)),t,i,a);return t.stencil&&n.stencil.parse(t.stencil,i,a),Material._ParsePlugins(t,n,i,a),t.clearCoat&&n.clearCoat.parse(t.clearCoat,i,a),t.anisotropy&&n.anisotropy.parse(t.anisotropy,i,a),t.brdf&&n.brdf.parse(t.brdf,i,a),t.sheen&&n.sheen.parse(t.sheen,i,a),t.subSurface&&n.subSurface.parse(t.subSurface,i,a),t.iridescence&&n.iridescence.parse(t.iridescence,i,a),n}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}};PBRMaterial.PBRMATERIAL_OPAQUE=PBRBaseMaterial.PBRMATERIAL_OPAQUE,PBRMaterial.PBRMATERIAL_ALPHATEST=PBRBaseMaterial.PBRMATERIAL_ALPHATEST,PBRMaterial.PBRMATERIAL_ALPHABLEND=PBRBaseMaterial.PBRMATERIAL_ALPHABLEND,PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND=PBRBaseMaterial.PBRMATERIAL_ALPHATESTANDBLEND,PBRMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=PBRBaseMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"directIntensity",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveIntensity",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"environmentIntensity",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"specularIntensity",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"disableBumpMap",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"albedoTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientTexture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientTextureStrength",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],PBRMaterial.prototype,"opacityTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectionTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectivityTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicTexture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallic",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"roughness",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicF0Factor",void 0),__decorate([serializeAsColor3(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicReflectanceColor",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicReflectanceTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectanceTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"microSurfaceTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"bumpTexture",void 0),__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],PBRMaterial.prototype,"lightmapTexture",void 0),__decorate([serializeAsColor3("ambient"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientColor",void 0),__decorate([serializeAsColor3("albedo"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"albedoColor",void 0),__decorate([serializeAsColor3("reflectivity"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectivityColor",void 0),__decorate([serializeAsColor3("reflection"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectionColor",void 0),__decorate([serializeAsColor3("emissive"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveColor",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"microSurface",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useLightmapAsShadowmap",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],PBRMaterial.prototype,"useAlphaFromAlbedoTexture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],PBRMaterial.prototype,"forceAlphaTest",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],PBRMaterial.prototype,"alphaCutOff",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useSpecularOverAlpha",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRoughnessFromMetallicTextureGreen",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useMetallnessFromMetallicTextureBlue",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAmbientInGrayScale",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),__decorate([serialize()],PBRMaterial.prototype,"usePhysicalLightFalloff",null),__decorate([serialize()],PBRMaterial.prototype,"useGLTFLightFalloff",null),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRadianceOverAlpha",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useObjectSpaceNormalMap",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useParallax",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useParallaxOcclusion",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"parallaxScaleBias",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsLightsDirty")],PBRMaterial.prototype,"disableLighting",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"forceIrradianceInFragment",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsLightsDirty")],PBRMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"invertNormalMapX",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"invertNormalMapY",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"twoSidedLighting",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAlphaFresnel",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useLinearAlphaFresnel",void 0),__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"environmentBRDFTexture",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"forceNormalForward",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"enableSpecularAntiAliasing",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useHorizonOcclusion",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRadianceOcclusion",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRMaterial.prototype,"unlit",void 0),__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRMaterial.prototype,"applyDecalMapAfterDetailMap",void 0),RegisterClass("BABYLON.PBRMaterial",PBRMaterial);var MorphTarget=class e{get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}setTangents(e){const t=this.hasTangents;this._tangents=e,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}setUVs(e){const t=this.hasUVs;this._uvs=e,t!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}getClassName(){return"MorphTarget"}static Parse(t,i){const a=new e(t.name,t.influence);if(a.setPositions(t.positions),null!=t.id&&(a.id=t.id),t.normals&&a.setNormals(t.normals),t.tangents&&a.setTangents(t.tangents),t.uvs&&a.setUVs(t.uvs),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],n=GetClass("BABYLON.Animation");n&&a.animations.push(n.Parse(i))}t.autoAnimate&&i&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1)}return a}getTangents(){return this._tangents}get hasUVs(){return!!this._uvs}get Hc(){return this._uniqueId}get influence(){return this._influence}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getUVs(){return this._uvs}get hasTangents(){return!!this._tangents}setNormals(e){const t=this.hasNormals;this._normals=e,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}serialize(){const e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(e.uvs=Array.prototype.slice.call(this.getUVs())),SerializationHelper.AppendSerializedAnimations(this,e),e}set influence(e){if(this._influence===e)return;const t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===t||0===e)}clone(){const t=SerializationHelper.Clone((()=>new e(this.name,this.influence,this._scene)),this);return t._positions=this._positions,t._normals=this._normals,t._tangents=this._tangents,t._uvs=this._uvs,t}static FromMesh(t,i,a){i||(i=t.name);const n=new e(i,a,t.getScene());return n.setPositions(t.getVerticesData(VertexBuffer.PositionKind)),t.isVerticesDataPresent(VertexBuffer.NormalKind)&&n.setNormals(t.getVerticesData(VertexBuffer.NormalKind)),t.isVerticesDataPresent(VertexBuffer.TangentKind)&&n.setTangents(t.getVerticesData(VertexBuffer.TangentKind)),t.isVerticesDataPresent(VertexBuffer.UVKind)&&n.setUVs(t.getVerticesData(VertexBuffer.UVKind)),n}constructor(e,t=0,i=null){this.name=e,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new Observable,this._onDataLayoutChanged=new Observable,this._animationPropertiesOverride=null,this._scene=i||EngineStore.LastCreatedScene,this.influence=t,this._scene&&(this._uniqueId=this._scene.getUniqueId())}getNormals(){return this._normals}setPositions(e){const t=this.hasPositions;this._positions=e,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}};__decorate([serialize()],MorphTarget.prototype,"id",void 0);var RawTexture2DArray=class e extends Texture{update(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)}constructor(e,t,i,a,n,s,r=!0,o=!1,l=Texture.TRILINEAR_SAMPLINGMODE,c=0,h){super(null,s,!r,o),this.format=n,this._texture=s.getEngine().createRawTexture2DArray(e,t,i,a,n,r,o,l,null,c,h),this._depth=a,this.is2DArray=!0}get depth(){return this._depth}static CreateRGBATexture(t,i,a,n,s,r=!0,o=!1,l=3,c=0){return new e(t,i,a,n,5,s,r,o,l,c)}},MorphTargetManager=class e{get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get isUsingTextureForTargets(){return e.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!this._scene?.getEngine().getCaps().disableMorphTargetTexture}get influences(){return this._influences}get vertexCount(){return this._vertexCount}get numMaxInfluencers(){return this._numMaxInfluencers}set areUpdatesFrozen(e){e?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}addTarget(e){this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add((e=>{this._syncActiveTargets(e)}))),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}_syncActiveTargets(t){if(this.areUpdatesFrozen)return;let i=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let a=-1;for(const t of this._targets){if(a++,0===t.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=e.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(t),this._morphTargetTextureIndices[i]=a,this._tempInfluences[i++]=t.influence,this._supportsNormals=this._supportsNormals&&t.hasNormals,this._supportsTangents=this._supportsTangents&&t.hasTangents,this._supportsUVs=this._supportsUVs&&t.hasUVs;const n=t.getPositions();if(n){const e=n.length/3;if(0===this._vertexCount)this._vertexCount=e;else if(this._vertexCount!==e)return void Logger.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==i&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,i)),this._influences&&this._influences.length===i||(this._influences=new Float32Array(i));for(let e=0;e<i;e++)this._influences[e]=this._tempInfluences[e];t&&this.synchronize()}get numTargets(){return this._targets.length}get areUpdatesFrozen(){return this._blockCounter>0}get numInfluencers(){return this._activeTargets.length}getTargetByName(e){for(const t of this._targets)if(t.name===e)return t;return null}clone(){const t=new e(this._scene);for(const e of this._targets)t.addTarget(e.clone());return t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t}serialize(){const e={};e.id=this.Hc,e.targets=[];for(const t of this._targets)e.targets.push(t.serialize());return e}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}removeTarget(e){const t=this._targets.indexOf(e);t>=0&&(this._targets.splice(t,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(e)}getTarget(e){return this._targets[e]}_bind(e){e.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),e.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),e.setTexture("morphTargets",this._targetStoreTexture),e.setInt("morphTargetCount",this.numInfluencers)}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const e=this._parentContainer.morphTargetManagers.indexOf(this);e>-1&&this._parentContainer.morphTargetManagers.splice(e,1),this._parentContainer=null}for(const e of this._targets)this._scene.stopAnimation(e)}}static Parse(t,i){const a=new e(i);a._uniqueId=t.id;for(const e of t.targets)a.addTarget(MorphTarget.Parse(e,i));return a}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get Hc(){return this._uniqueId}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const e=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>e&&(this._textureHeight=Math.ceil(this._textureWidth/e),this._textureWidth=e);let t=!0;if(this._targetStoreTexture){const e=this._targetStoreTexture.getSize();e.width===this._textureWidth&&e.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(t=!1)}if(t){this._targetStoreTexture&&this._targetStoreTexture.dispose();const e=this._targets.length,t=new Float32Array(e*this._textureWidth*this._textureHeight*4);let i=0;for(let a=0;a<e;a++){const e=this._targets[a],n=e.getPositions(),s=e.getNormals(),r=e.getUVs(),o=e.getTangents();if(!n)return void(0===a&&Logger.Error("Invalid morph target. Target must have positions."));i=a*this._textureWidth*this._textureHeight*4;for(let e=0;e<this._vertexCount;e++)t[i]=n[3*e],t[i+1]=n[3*e+1],t[i+2]=n[3*e+2],i+=4,this._supportsNormals&&s&&(t[i]=s[3*e],t[i+1]=s[3*e+1],t[i+2]=s[3*e+2],i+=4),this._supportsUVs&&r&&(t[i]=r[2*e],t[i+1]=r[2*e+1],i+=4),this._supportsTangents&&o&&(t[i]=o[3*e],t[i+1]=o[3*e+1],t[i+2]=o[3*e+2],i+=4)}this._targetStoreTexture=RawTexture2DArray.CreateRGBATexture(t,this._textureWidth,this._textureHeight,e,this._scene,!1,!1,1,1)}}for(const e of this._scene.meshes)e.morphTargetManager===this&&e._syncGeometryWithMorphTargetManager()}}set useTextureToStoreTargets(e){this._useTextureToStoreTargets=e}constructor(e=null){if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new SmartArray(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,e||(e=EngineStore.LastCreatedScene),this._scene=e,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const e=this._scene.getEngine().getCaps();this._canUseTextureForTargets=e.canUseGLVertexID&&e.textureFloat&&e.maxVertexTextureImageUnits>0&&e.texture2DArrayMaxLayerCount>1}}set numMaxInfluencers(e){this._numMaxInfluencers!==e&&(this._numMaxInfluencers=e,this._syncActiveTargets(!0))}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}getActiveTarget(e){return this._activeTargets.data[e]}};function getVector3(e,t,i,a){return Vector3.FromArray(t,i).scaleInPlace(a)}function getQuaternion(e,t,i,a){return Quaternion.FromArray(t,i).scaleInPlace(a)}function getWeights(e,t,i,a){const n=new Array(e._numMorphTargets);for(let e=0;e<n.length;e++)n[e]=t[i++]*a;return n}MorphTargetManager.EnableTextureStorage=!0,MorphTargetManager.MaxActiveMorphTargetsInVertexAttributeMode=8;var AnimationPropertyInfo=class{_buildAnimation(e,t,i){const a=new Animation(e,this.name,t,this.type);return a.setKeys(i),a}constructor(e,t,i,a){this.type=e,this.name=t,this.getValue=i,this.getStride=a}},TransformNodeAnimationPropertyInfo=class extends AnimationPropertyInfo{buildAnimations(e,t,i,a,n){n(e._babylonTransformNode,this._buildAnimation(t,i,a))}},WeightAnimationPropertyInfo=class extends AnimationPropertyInfo{buildAnimations(e,t,i,a,n){if(e._numMorphTargets)for(let s=0;s<e._numMorphTargets;s++){const r=new Animation(`${t}_${s}`,this.name,i,this.type);if(r.setKeys(a.map((e=>({frame:e.frame,inTangent:e.inTangent?e.inTangent[s]:void 0,value:e.value[s],outTangent:e.outTangent?e.outTangent[s]:void 0,interpolation:e.interpolation})))),e._primitiveBabylonMeshes)for(const t of e._primitiveBabylonMeshes)if(t.morphTargetManager){const e=t.morphTargetManager.getTarget(s),i=r.clone();e.animations.push(i),n(e,i)}}}},nodeAnimationData={translation:[new TransformNodeAnimationPropertyInfo(Animation.ANIMATIONTYPE_VECTOR3,"position",getVector3,(()=>3))],rotation:[new TransformNodeAnimationPropertyInfo(Animation.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",getQuaternion,(()=>4))],scale:[new TransformNodeAnimationPropertyInfo(Animation.ANIMATIONTYPE_VECTOR3,"scaling",getVector3,(()=>3))],weights:[new WeightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"influence",getWeights,(e=>e._numMorphTargets))]};function mergeDeep(...e){const t=e=>e&&"object"==typeof e;return e.reduce(((e,i)=>(Object.keys(i).forEach((a=>{const n=e[a],s=i[a];Array.isArray(n)&&Array.isArray(s)?e[a]=n.concat(...s):t(n)&&t(s)?e[a]=mergeDeep(n,s):e[a]=s})),e)),{})}var ArrayItem=class{static Assign(e){if(e)for(let t=0;t<e.length;t++)e[t].index=t}static TryGet(e,t){return e&&null!=t&&e[t]?e[t]:null}static Get(e,t,i){if(!t||null==i||!t[i])throw new Error(`${e}: Failed to find index (${i})`);return t[i]}},GLTFLoader2=class e{_loadMorphTargetVertexDataAsync(e,t,i,a){const n=new Array,s=(a,s,r)=>{if(null==i[a])return;const o=t.getVertexBuffer(s);if(!o)return;const l=ArrayItem.Get(`${e}/${a}`,this._gltf.accessors,i[a]);n.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then((e=>{r(o,e)})))};return s("POSITION",VertexBuffer.PositionKind,((e,t)=>{const i=new Float32Array(t.length);e.forEach(t.length,((e,a)=>{i[a]=t[a]+e})),a.setPositions(i)})),s("NORMAL",VertexBuffer.NormalKind,((e,t)=>{const i=new Float32Array(t.length);e.forEach(i.length,((e,a)=>{i[a]=t[a]+e})),a.setNormals(i)})),s("TANGENT",VertexBuffer.TangentKind,((e,t)=>{const i=new Float32Array(t.length/3*4);let n=0;e.forEach(t.length/3*4,((e,a)=>{(a+1)%4!=0&&(i[n]=t[n]+e,n++)})),a.setTangents(i)})),Promise.all(n).then((()=>{}))}_loadMaterialAsync(t,i,a,n,s=()=>{}){const r=this._extensionsLoadMaterialAsync(t,i,a,n,s);if(r)return r;i._data=i._data||{};let o=i._data[n];if(!o){this.logOpen(`${t} ${i.name||""}`);const a=this.createMaterial(t,i,n);o={babylonMaterial:a,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,i,a)},i._data[n]=o,e.AddPointerMetadata(a,t),this._parent.onMaterialLoadedObservable.notifyObservers(a),this.logClose()}return a&&(o.babylonMeshes.push(a),a.onDisposeObservable.addOnce((()=>{const e=o.babylonMeshes.indexOf(a);-1!==e&&o.babylonMeshes.splice(e,1)}))),s(o.babylonMaterial),o.promise.then((()=>o.babylonMaterial))}loadBufferAsync(e,t,i,a){const n=this._extensionsLoadBufferAsync(e,t,i,a);if(n)return n;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{if(!this._bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then((t=>{try{return new Uint8Array(t.buffer,t.byteOffset+i,a)}catch(t){throw new Error(`${e}: ${t.message}`)}}))}constructor(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}static _GetTextureSamplingMode(e,t){const i=null==t.magFilter?9729:t.magFilter,a=null==t.minFilter?9987:t.minFilter;if(9729===i)switch(a){case 9728:return Texture.LINEAR_NEAREST;case 9729:return Texture.LINEAR_LINEAR;case 9984:return Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return Texture.LINEAR_LINEAR_MIPLINEAR;default:return Logger.Warn(`${e}/minFilter: Invalid value (${a})`),Texture.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==i&&Logger.Warn(`${e}/magFilter: Invalid value (${i})`),a){case 9728:return Texture.NEAREST_NEAREST;case 9729:return Texture.NEAREST_LINEAR;case 9984:return Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return Texture.NEAREST_LINEAR_MIPLINEAR;default:return Logger.Warn(`${e}/minFilter: Invalid value (${a})`),Texture.NEAREST_NEAREST_MIPNEAREST}}_getGeometries(){const e=[],t=this._gltf.nodes;if(t)for(const i of t)this._forEachPrimitive(i,(t=>{const i=t.geometry;i&&-1===e.indexOf(i)&&e.push(i)}));return e}_loadAnimationSamplerAsync(e,t){if(t._data)return t._data;const i=t.interpolation||"LINEAR";switch(i){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${e}/interpolation: Invalid value (${t.interpolation})`)}const a=ArrayItem.Get(`${e}/input`,this._gltf.accessors,t.input),n=ArrayItem.Get(`${e}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${a.index}`,a),this._loadFloatAccessorAsync(`/accessors/${n.index}`,n)]).then((([e,t])=>({input:e,interpolation:i,output:t}))),t._data}_extensionsLoadSkinAsync(e,t,i){return this._applyExtensions(i,"loadSkin",(a=>a._loadSkinAsync&&a._loadSkinAsync(e,t,i)))}get rootBabylonMesh(){return this._rootBabylonMesh}_extensionsLoadTextureInfoAsync(e,t,i){return this._applyExtensions(t,"loadTextureInfo",(a=>a.loadTextureInfoAsync&&a.loadTextureInfoAsync(e,t,i)))}loadSceneAsync(e,t){const i=this._extensionsLoadSceneAsync(e,t);if(i)return i;const a=new Array;if(this.logOpen(`${e} ${t.name||""}`),t.nodes)for(const i of t.nodes){const t=ArrayItem.Get(`${e}/nodes/${i}`,this._gltf.nodes,i);a.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(e=>{e.parent=this._rootBabylonMesh})))}for(const e of this._postSceneLoadActions)e();return a.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(a).then((()=>{}))}_applyExtensions(e,t,i){for(const a of this._extensions)if(a.enabled){const n=`${a.name}.${t}`,s=e;s._activeLoaderExtensionFunctions=s._activeLoaderExtensionFunctions||{};const r=s._activeLoaderExtensionFunctions;if(!r[n]){r[n]=!0;try{const e=i(a);if(e)return e}finally{delete r[n]}}}return null}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)}_extensionsLoadTextureAsync(e,t,i){return this._applyExtensions(t,"loadTexture",(a=>a._loadTextureAsync&&a._loadTextureAsync(e,t,i)))}_loadIndicesAccessorAsync(t,i){if("SCALAR"!==i.type)throw new Error(`${t}/type: Invalid value ${i.type}`);if(5121!==i.componentType&&5123!==i.componentType&&5125!==i.componentType)throw new Error(`${t}/componentType: Invalid value ${i.componentType}`);if(i._data)return i._data;if(i.sparse){const a=e._GetTypedArrayConstructor(`${t}/componentType`,i.componentType);i._data=this._loadAccessorAsync(t,i,a)}else{const a=ArrayItem.Get(`${t}/bufferView`,this._gltf.bufferViews,i.bufferView);i._data=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((a=>e._GetTypedArray(t,i.componentType,a,i.byteOffset,i.count)))}return i._data}_extensionsOnLoading(){this._forEachExtensions((e=>e.onLoading&&e.onLoading()))}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const e=new Array;if(this._gltf.materials)for(const t of this._gltf.materials)if(t._data)for(const i in t._data){const a=t._data[i];for(const t of a.babylonMeshes){t.computeWorldMatrix(!0);const i=a.babylonMaterial;e.push(i.forceCompilationAsync(t)),e.push(i.forceCompilationAsync(t,{useInstances:!0})),this._parent.useClipPlane&&(e.push(i.forceCompilationAsync(t,{clipPlane:!0})),e.push(i.forceCompilationAsync(t,{clipPlane:!0,useInstances:!0})))}}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}loadMaterialAlphaProperties(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);switch(t.alphaMode||"OPAQUE"){case"OPAQUE":i.transparencyMode=PBRMaterial.PBRMATERIAL_OPAQUE,i.alpha=1;break;case"MASK":i.transparencyMode=PBRMaterial.PBRMATERIAL_ALPHATEST,i.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,i.albedoTexture&&(i.albedoTexture.hasAlpha=!0);break;case"BLEND":i.transparencyMode=PBRMaterial.PBRMATERIAL_ALPHABLEND,i.albedoTexture&&(i.albedoTexture.hasAlpha=!0,i.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${e}/alphaMode: Invalid value (${t.alphaMode})`)}}_extensionsLoadMaterialPropertiesAsync(e,t,i){return this._applyExtensions(t,"loadMaterialProperties",(a=>a.loadMaterialPropertiesAsync&&a.loadMaterialPropertiesAsync(e,t,i)))}_extensionsLoadNodeAsync(e,t,i){return this._applyExtensions(t,"loadNode",(a=>a.loadNodeAsync&&a.loadNodeAsync(e,t,i)))}_loadMeshPrimitiveAsync(t,i,a,n,s,r){const o=this._extensionsLoadMeshPrimitiveAsync(t,i,a,n,s,r);if(o)return o;this.logOpen(`${t}`);const l=0===this._disableInstancedMesh&&this._parent.createInstances&&null==a.skin&&!n.primitives[0].targets;let c,h;if(l&&s._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,c=s._instanceData.babylonSourceMesh.createInstance(i),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h=s._instanceData.promise;else{const r=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new Mesh(i,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.sideOrientation=this._babylonScene.useRightHandedSystem?Material.CounterClockWiseSideOrientation:Material.ClockWiseSideOrientation,this._createMorphTargets(t,a,n,s,o),r.push(this._loadVertexDataAsync(t,s,o).then((e=>this._loadMorphTargetsAsync(t,s,o,e).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,e.applyToMesh(o),e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const u=e._GetDrawMode(t,s.mode);if(null==s.material){let e=this._defaultBabylonMaterialData[u];e||(e=this._createDefaultMaterial("__GLTFLoader._default",u),this._parent.onMaterialLoadedObservable.notifyObservers(e),this._defaultBabylonMaterialData[u]=e),o.material=e}else if(!this.parent.skipMaterials){const e=ArrayItem.Get(`${t}/material`,this._gltf.materials,s.material);r.push(this._loadMaterialAsync(`/materials/${e.index}`,e,o,u,(e=>{o.material=e})))}h=Promise.all(r),l&&(s._instanceData={babylonSourceMesh:o,promise:h}),c=o}return e.AddPointerMetadata(c,t),this._parent.onMeshLoadedObservable.notifyObservers(c),r(c),this.logClose(),h.then((()=>c))}logOpen(e){this._parent._logOpen(e)}_loadMorphTargetsAsync(e,t,i,a){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();const n=new Array,s=i.morphTargetManager;for(let i=0;i<s.numTargets;i++){const r=s.getTarget(i);n.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${i}`,a,t.targets[i],r))}return Promise.all(n).then((()=>{s.areUpdatesFrozen=!1}))}_loadAnimationChannelAsync(e,t,i,a,n){const s=this._extensionsLoadAnimationChannelAsync(e,t,i,a,n);if(s)return s;if(null==a.target.node)return Promise.resolve();const r=ArrayItem.Get(`${e}/target/node`,this._gltf.nodes,a.target.node),o=a.target.path,l="weights"===o;if(l&&!r._numMorphTargets||!l&&!r._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!l&&!r._isJoint)return Promise.resolve();let c;switch(o){case"translation":c=nodeAnimationData.translation;break;case"rotation":c=nodeAnimationData.rotation;break;case"scale":c=nodeAnimationData.scale;break;case"weights":c=nodeAnimationData.weights;break;default:throw new Error(`${e}/target/path: Invalid value (${a.target.path})`)}const h={object:r,info:c};return this._loadAnimationChannelFromTargetInfoAsync(e,t,i,a,h,n)}_loadSkinInverseBindMatricesDataAsync(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);const i=ArrayItem.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)}_loadAccessorAsync(t,i,a){if(i._data)return i._data;const n=e._GetNumComponents(t,i.type),s=n*VertexBuffer.GetTypeByteLength(i.componentType),r=n*i.count;if(null==i.bufferView)i._data=Promise.resolve(new a(r));else{const o=ArrayItem.Get(`${t}/bufferView`,this._gltf.bufferViews,i.bufferView);i._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((l=>{if(5126!==i.componentType||i.normalized||o.byteStride&&o.byteStride!==s){const e=new a(r);return VertexBuffer.ForEach(l,i.byteOffset||0,o.byteStride||s,n,i.componentType,e.length,i.normalized||!1,((t,i)=>{e[i]=t})),e}return e._GetTypedArray(t,i.componentType,l,i.byteOffset,r)}))}if(i.sparse){const r=i.sparse;i._data=i._data.then((o=>{const l=o,c=ArrayItem.Get(`${t}/sparse/indices/bufferView`,this._gltf.bufferViews,r.indices.bufferView),h=ArrayItem.Get(`${t}/sparse/values/bufferView`,this._gltf.bufferViews,r.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${c.index}`,c),this.loadBufferViewAsync(`/bufferViews/${h.index}`,h)]).then((([o,c])=>{const h=e._GetTypedArray(`${t}/sparse/indices`,r.indices.componentType,o,r.indices.byteOffset,r.count),u=n*r.count;let m;if(5126!==i.componentType||i.normalized){const o=e._GetTypedArray(`${t}/sparse/values`,i.componentType,c,r.values.byteOffset,u);m=new a(u),VertexBuffer.ForEach(o,0,s,n,i.componentType,m.length,i.normalized||!1,((e,t)=>{m[t]=e}))}else m=e._GetTypedArray(`${t}/sparse/values`,i.componentType,c,r.values.byteOffset,u);let d=0;for(let e=0;e<h.length;e++){let t=h[e]*n;for(let e=0;e<n;e++)l[t++]=m[d++]}return l}))}))}return i._data}_extensionsLoadMeshPrimitiveAsync(e,t,i,a,n,s){return this._applyExtensions(n,"loadMeshPrimitive",(r=>r._loadMeshPrimitiveAsync&&r._loadMeshPrimitiveAsync(e,t,i,a,n,s)))}logClose(){this._parent._logClose()}_getAnimationGroups(){const e=[],t=this._gltf.animations;if(t)for(const i of t)i._babylonAnimationGroup&&e.push(i._babylonAnimationGroup);return e}_loadMeshAsync(e,t,i,a){const n=i.primitives;if(!n||!n.length)throw new Error(`${e}: Primitives are missing`);null==n[0].index&&ArrayItem.Assign(n);const s=new Array;this.logOpen(`${e} ${i.name||""}`);const r=t.name||`node${t.index}`;if(1===n.length){const a=i.primitives[0];s.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${a.index}`,r,t,i,a,(e=>{t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new TransformNode(r,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(const a of n)s.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${a.index}`,`${r}_primitive${a.index}`,t,i,a,(e=>{e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)})))}return a(t._babylonTransformNode),this.logClose(),Promise.all(s).then((()=>t._babylonTransformNode))}static _LoadTransform(e,t){if(null!=e.skin)return;let i=Vector3.Zero(),a=Quaternion.Identity(),n=Vector3.One();if(e.matrix){Matrix.FromArray(e.matrix).decompose(n,a,i)}else e.translation&&(i=Vector3.FromArray(e.translation)),e.rotation&&(a=Quaternion.FromArray(e.rotation)),e.scale&&(n=Vector3.FromArray(e.scale));t.position=i,t.rotationQuaternion=a,t.scaling=n}_setupData(){if(ArrayItem.Assign(this._gltf.accessors),ArrayItem.Assign(this._gltf.animations),ArrayItem.Assign(this._gltf.buffers),ArrayItem.Assign(this._gltf.bufferViews),ArrayItem.Assign(this._gltf.cameras),ArrayItem.Assign(this._gltf.images),ArrayItem.Assign(this._gltf.materials),ArrayItem.Assign(this._gltf.meshes),ArrayItem.Assign(this._gltf.nodes),ArrayItem.Assign(this._gltf.samplers),ArrayItem.Assign(this._gltf.scenes),ArrayItem.Assign(this._gltf.skins),ArrayItem.Assign(this._gltf.textures),this._gltf.nodes){const e={};for(const t of this._gltf.nodes)if(t.children)for(const i of t.children)e[i]=t.index;const t=this._createRootNode();for(const i of this._gltf.nodes){const a=e[i.index];i.parent=void 0===a?t:this._gltf.nodes[a]}}}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}log(e){this._parent._log(e)}_loadVertexAccessorAsync(t,i,a){if(i._babylonVertexBuffer?.[a])return i._babylonVertexBuffer[a];i._babylonVertexBuffer||(i._babylonVertexBuffer={});const n=this._babylonScene.getEngine();if(i.sparse||null==i.bufferView)i._babylonVertexBuffer[a]=this._loadFloatAccessorAsync(t,i).then((e=>new VertexBuffer(n,e,a,!1)));else{const s=ArrayItem.Get(`${t}/bufferView`,this._gltf.bufferViews,i.bufferView);i._babylonVertexBuffer[a]=this._loadVertexBufferViewAsync(s).then((r=>{const o=e._GetNumComponents(t,i.type);return new VertexBuffer(n,r,a,!1,void 0,s.byteStride,void 0,i.byteOffset,o,i.componentType,i.normalized,!0,void 0,!0)}))}return i._babylonVertexBuffer[a]}_startAnimations(){switch(this._parent.animationStartMode){case GLTFLoaderAnimationStartMode.NONE:break;case GLTFLoaderAnimationStartMode.FIRST:{const e=this._getAnimationGroups();0!==e.length&&e[0].start(!0);break}case GLTFLoaderAnimationStartMode.ALL:{const e=this._getAnimationGroups();for(const t of e)t.start(!0);break}default:return void Logger.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}_findSkeletonRootNode(e,t){if(0===t.length)return null;const i={};for(const a of t){const t=[];let n=ArrayItem.Get(`${e}/${a}`,this._gltf.nodes,a);for(;-1!==n.index;)t.unshift(n),n=n.parent;i[a]=t}let a=null;for(let e=0;;++e){let n=i[t[0]];if(e>=n.length)return a;const s=n[e];for(let r=1;r<t.length;++r)if(n=i[t[r]],e>=n.length||s!==n[e])return a;a=s}}loadUriAsync(t,i,a){const n=this._extensionsLoadUriAsync(t,i,a);if(n)return n;if(!e._ValidateUri(a))throw new Error(`${t}: '${a}' is invalid`);if(IsBase64DataUrl(a)){const e=new Uint8Array(DecodeBase64UrlToBinary(a));return this.log(`${t}: Decoded ${a.substr(0,64)}... (${e.length} bytes)`),Promise.resolve(e)}return this.log(`${t}: Loading ${a}`),this._parent.preprocessUrlAsync(this._rootUrl+a).then((e=>new Promise(((i,n)=>{this._parent._loadFile(this._babylonScene,e,(e=>{this._disposed||(this.log(`${t}: Loaded ${a} (${e.byteLength} bytes)`),i(new Uint8Array(e)))}),!0,(e=>{n(new LoadFileError(`${t}: Failed to load '${a}'${e?": "+e.status+" "+e.statusText:""}`,e))}))}))))}_extensionsLoadVertexDataAsync(e,t,i){return this._applyExtensions(t,"loadVertexData",(a=>a._loadVertexDataAsync&&a._loadVertexDataAsync(e,t,i)))}_getNodeMatrix(e){return e.matrix?Matrix.FromArray(e.matrix):Matrix.Compose(e.scale?Vector3.FromArray(e.scale):Vector3.One(),e.rotation?Quaternion.FromArray(e.rotation):Quaternion.Identity(),e.translation?Vector3.FromArray(e.translation):Vector3.Zero())}loadMaterialPropertiesAsync(e,t,i){const a=this._extensionsLoadMaterialPropertiesAsync(e,t,i);if(a)return a;const n=new Array;return n.push(this.loadMaterialBasePropertiesAsync(e,t,i)),t.pbrMetallicRoughness&&n.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,t.pbrMetallicRoughness,i)),this.loadMaterialAlphaProperties(e,t,i),Promise.all(n).then((()=>{}))}_loadFloatAccessorAsync(e,t){return this._loadAccessorAsync(e,t,Float32Array)}_getMeshes(){const e=[];this._rootBabylonMesh instanceof AbstractMesh&&e.push(this._rootBabylonMesh);const t=this._gltf.nodes;if(t)for(const i of t)this._forEachPrimitive(i,(t=>{e.push(t)}));return e}_loadMaterialMetallicRoughnessPropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;return t&&(t.baseColorFactor?(i.albedoColor=Color3.FromArray(t.baseColorFactor),i.alpha=t.baseColorFactor[3]):i.albedoColor=Color3.White(),i.metallic=null==t.metallicFactor?1:t.metallicFactor,i.roughness=null==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&a.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,t.baseColorTexture,(e=>{e.name=`${i.name} (Base Color)`,i.albedoTexture=e}))),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,t.metallicRoughnessTexture,(e=>{e.name=`${i.name} (Metallic Roughness)`,i.metallicTexture=e}))),i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(a).then((()=>{}))}get parent(){return this._parent}loadImageAsync(e,t){if(!t._data){if(this.logOpen(`${e} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{const i=ArrayItem.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}this.logClose()}return t._data}_extensionsCreateMaterial(e,t,i){return this._applyExtensions(t,"createMaterial",(a=>a.createMaterial&&a.createMaterial(e,t,i)))}_createDefaultMaterial(e,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new PBRMaterial(e,this._babylonScene);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.fillMode=t,i.enableSpecularAntiAliasing=!0,i.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,i.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,i.transparencyMode=PBRMaterial.PBRMATERIAL_OPAQUE,i.metallic=1,i.roughness=1,i}static _GetNumComponents(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${e}: Invalid type (${t})`)}_loadAnimationsAsync(){const e=this._gltf.animations;if(!e)return Promise.resolve();const t=new Array;for(let i=0;i<e.length;i++){const a=e[i];t.push(this.loadAnimationAsync(`/animations/${a.index}`,a).then((e=>{0===e.targetedAnimations.length&&e.dispose()})))}return Promise.all(t).then((()=>{}))}_extensionsLoadUriAsync(e,t,i){return this._applyExtensions(t,"loadUri",(a=>a._loadUriAsync&&a._loadUriAsync(e,t,i)))}get rootUrl(){return this._rootUrl}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;const t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>new Buffer2(t,e,!1))),e._babylonBuffer}_extensionsLoadBufferAsync(e,t,i,a){return this._applyExtensions(t,"loadBuffer",(n=>n.loadBufferAsync&&n.loadBufferAsync(e,t,i,a)))}_updateBoneMatrices(e,t){for(const i of e.bones){const e=Matrix.Identity(),a=i._index;t&&-1!==a&&(Matrix.FromArrayToRef(t,16*a,e),e.invertToRef(e));const n=i.getParent();n&&e.multiplyToRef(n.getAbsoluteInverseBindMatrix(),e),i.updateMatrix(e,!1,!1),i._updateAbsoluteBindMatrices(void 0,!1)}}_forEachExtensions(e){for(const t of this._extensions)t.enabled&&e(t)}_loadAsync(e,t,i,a){return Promise.resolve().then((()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&t?e:`${e}${Date.now()}/`,this._fileName=t,this._allMaterialsDirtyRequired=!1,this._loadExtensions(),this._checkExtensions();const n=`${GLTFLoaderState[GLTFLoaderState.LOADING]} => ${GLTFLoaderState[GLTFLoaderState.READY]}`,s=`${GLTFLoaderState[GLTFLoaderState.LOADING]} => ${GLTFLoaderState[GLTFLoaderState.COMPLETE]}`;this._parent._startPerformanceCounter(n),this._parent._startPerformanceCounter(s),this._parent._setState(GLTFLoaderState.LOADING),this._extensionsOnLoading();const r=new Array,o=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials)if(i)r.push(this.loadSceneAsync("/nodes",{nodes:i,index:-1}));else if(null!=this._gltf.scene||this._gltf.scenes&&this._gltf.scenes[0]){const e=ArrayItem.Get("/scene",this._gltf.scenes,this._gltf.scene||0);r.push(this.loadSceneAsync(`/scenes/${e.index}`,e))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let e=0;e<this._gltf.materials.length;++e){const t=this._gltf.materials[e],i="/materials/"+e,a=Material.TriangleFillMode;r.push(this._loadMaterialAsync(i,t,null,a,(()=>{})))}this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=o:this._babylonScene._forceBlockMaterialDirtyMechanism(o),this._parent.compileMaterials&&r.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&r.push(this._compileShadowGeneratorsAsync());return Promise.all(r).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.setEnabled(!0),this._extensionsOnReady(),this._parent._setState(GLTFLoaderState.READY),this._startAnimations(),a()))).then((e=>(this._parent._endPerformanceCounter(n),Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(s),this._parent._setState(GLTFLoaderState.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(e=>{this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()}))})),e)))})).catch((e=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()),e}))}_loadSampler(t,i){return i._data||(i._data={noMipMaps:9728===i.minFilter||9729===i.minFilter,samplingMode:e._GetTextureSamplingMode(t,i),wrapU:e._GetTextureWrapMode(`${t}/wrapS`,i.wrapS),wrapV:e._GetTextureWrapMode(`${t}/wrapT`,i.wrapT)}),i._data}static _GetTypedArray(t,i,a,n,s){const r=a.buffer;n=a.byteOffset+(n||0);const o=e._GetTypedArrayConstructor(`${t}/componentType`,i),l=VertexBuffer.GetTypeByteLength(i);return n%l!=0?(Logger.Warn(`${t}: Copying buffer as byte offset (${n}) is not a multiple of component type byte length (${l})`),new o(r.slice(n,n+s*l),0)):new o(r,n,s)}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const e=new Array,t=this._babylonScene.lights;for(const i of t){const t=i.getShadowGenerator();t&&e.push(t.forceCompilationAsync())}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}_loadBones(e,t,i){if(null==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){const i=this._findSkeletonRootNode(`${e}/joints`,t.joints);if(i)if(void 0===t.skeleton)t.skeleton=i.index;else{const a=(e,t)=>{for(;t.parent;t=t.parent)if(t.parent===e)return!0;return!1},n=ArrayItem.Get(`${e}/skeleton`,this._gltf.nodes,t.skeleton);n===i||a(n,i)||(Logger.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=i.index)}else Logger.Warn(`${e}: Failed to find common root`)}const a={};for(const n of t.joints){const s=ArrayItem.Get(`${e}/joints/${n}`,this._gltf.nodes,n);this._loadBone(s,t,i,a)}}_getSkeletons(){const e=[],t=this._gltf.skins;if(t)for(const i of t)i._data&&e.push(i._data.babylonSkeleton);return e}_extensionsLoadAnimationAsync(e,t){return this._applyExtensions(t,"loadAnimation",(i=>i.loadAnimationAsync&&i.loadAnimationAsync(e,t)))}_loadTextureAsync(t,i,a=()=>{}){const n=this._extensionsLoadTextureAsync(t,i,a);if(n)return n;this.logOpen(`${t} ${i.name||""}`);const s=null==i.sampler?e.DefaultSampler:ArrayItem.Get(`${t}/sampler`,this._gltf.samplers,i.sampler),r=ArrayItem.Get(`${t}/source`,this._gltf.images,i.source),o=this._createTextureAsync(t,s,r,a,void 0,!i._textureInfo.nonColorData);return this.logClose(),o}loadBufferViewAsync(e,t){const i=this._extensionsLoadBufferViewAsync(e,t);if(i)return i;if(t._data)return t._data;const a=ArrayItem.Get(`${e}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${a.index}`,a,t.byteOffset||0,t.byteLength),t._data}get gltf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}loadMaterialBasePropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;return i.emissiveColor=t.emissiveFactor?Color3.FromArray(t.emissiveFactor):new Color3(0,0,0),t.doubleSided&&(i.backFaceCulling=!1,i.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${e}/normalTexture`,t.normalTexture,(e=>{e.name=`${i.name} (Normal)`,i.bumpTexture=e}))),i.invertNormalMapX=!this._babylonScene.useRightHandedSystem,i.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&i.bumpTexture&&(i.bumpTexture.level=t.normalTexture.scale),i.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,t.occlusionTexture,(e=>{e.name=`${i.name} (Occlusion)`,i.ambientTexture=e}))),i.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(i.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&a.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,t.emissiveTexture,(e=>{e.name=`${i.name} (Emissive)`,i.emissiveTexture=e}))),Promise.all(a).then((()=>{}))}_extensionsLoadAnimationChannelAsync(e,t,i,a,n){return this._applyExtensions(i,"loadAnimationChannel",(s=>s._loadAnimationChannelAsync&&s._loadAnimationChannelAsync(e,t,i,a,n)))}_loadSkinAsync(e,t,i,a){if(!this._parent.loadSkins)return Promise.resolve();const n=this._extensionsLoadSkinAsync(e,t,i);if(n)return n;if(i._data)return a(i._data.babylonSkeleton),i._data.promise;const s=`skeleton${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new Skeleton(i.name||s,s,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,i,r);const o=this._loadSkinInverseBindMatricesDataAsync(e,i).then((e=>{this._updateBoneMatrices(r,e)}));return i._data={babylonSkeleton:r,promise:o},a(r),o}_createTextureAsync(e,t,i,a=()=>{},n,s){const r=this._loadSampler(`/samplers/${t.index}`,t),o=new Array,l=new Deferred;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c={noMipmap:r.noMipMaps,invertY:!1,samplingMode:r.samplingMode,onLoad:()=>{this._disposed||l.resolve()},onError:(t,i)=>{this._disposed||l.reject(new Error(`${e}: ${i&&i.message?i.message:t||"Failed to load texture"}`))},mimeType:i.mimeType,loaderOptions:n,useSRGBBuffer:!!s&&this._parent.useSRGBBuffers},h=new Texture(null,this._babylonScene,c);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.push(l.promise),o.push(this.loadImageAsync(`/images/${i.index}`,i).then((e=>{const t=i.uri||`${this._fileName}#image${i.index}`,a=`data:${this._uniqueRootUrl}${t}`;h.updateURL(a,e)}))),h.wrapU=r.wrapU,h.wrapV=r.wrapV,a(h),Promise.all(o).then((()=>h))}_loadExtensions(){for(const t in e._RegisteredExtensions)if(!1===this.parent.extensionOptions[t]?.enabled)this.isExtensionUsed(t)&&Logger.Warn(`Extension ${t} is used but has been explicitly disabled.`);else{const i=e._RegisteredExtensions[t].factory(this);i.name!==t&&Logger.Warn(`The name of the glTF loader extension instance does not match the registered name: ${i.name} !== ${t}`),this._extensions.push(i),this._parent.onExtensionLoadedObservable.notifyObservers(i)}this._extensions.sort(((e,t)=>(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear()}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}static _GetDrawMode(e,t){switch(null==t&&(t=4),t){case 0:return Material.PointListDrawMode;case 1:return Material.LineListDrawMode;case 2:return Material.LineLoopDrawMode;case 3:return Material.LineStripDrawMode;case 4:return Material.TriangleFillMode;case 5:return Material.TriangleStripDrawMode;case 6:return Material.TriangleFanDrawMode}throw new Error(`${e}: Invalid mesh primitive mode (${t})`)}get bin(){return this._bin}static UnregisterExtension(t){return!!e._RegisteredExtensions[t]&&(delete e._RegisteredExtensions[t],!0)}static _GetTextureWrapMode(e,t){switch(t=null==t?10497:t){case 33071:return Texture.CLAMP_ADDRESSMODE;case 33648:return Texture.MIRROR_ADDRESSMODE;case 10497:return Texture.WRAP_ADDRESSMODE;default:return Logger.Warn(`${e}: Invalid value (${t})`),Texture.WRAP_ADDRESSMODE}}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){const t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){const i=t[0];(i.byteLength<e.bin.byteLength-3||i.byteLength>e.bin.byteLength)&&Logger.Warn(`Binary buffer length (${i.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else Logger.Warn("Unexpected BIN chunk")}}_createMorphTargets(e,t,i,a,n){if(!a.targets||!this._parent.loadMorphTargets)return;if(null==t._numMorphTargets)t._numMorphTargets=a.targets.length;else if(a.targets.length!==t._numMorphTargets)throw new Error(`${e}: Primitives do not have the same number of targets`);const s=i.extras?i.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,n.morphTargetManager=new MorphTargetManager(this._babylonScene),n.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.morphTargetManager.areUpdatesFrozen=!0;for(let e=0;e<a.targets.length;e++){const a=t.weights?t.weights[e]:i.weights?i.weights[e]:0,r=s?s[e]:`morphTarget${e}`;n.morphTargetManager.addTarget(new MorphTarget(r,a,n.getScene()))}}static AddPointerMetadata(e,t){e.metadata=e.metadata||{};const i=e._internalMetadata=e._internalMetadata||{},a=i.gltf=i.gltf||{};(a.pointers=a.pointers||[]).push(t)}loadNodeAsync(t,i,a=()=>{}){const n=this._extensionsLoadNodeAsync(t,i,a);if(n)return n;if(i._babylonTransformNode)throw new Error(`${t}: Invalid recursive node hierarchy`);const s=new Array;this.logOpen(`${t} ${i.name||""}`);const r=n=>{if(e.AddPointerMetadata(n,t),e._LoadTransform(i,n),null!=i.camera){const e=ArrayItem.Get(`${t}/camera`,this._gltf.cameras,i.camera);s.push(this.loadCameraAsync(`/cameras/${e.index}`,e,(e=>{e.parent=n})))}if(i.children)for(const e of i.children){const i=ArrayItem.Get(`${t}/children/${e}`,this._gltf.nodes,e);s.push(this.loadNodeAsync(`/nodes/${i.index}`,i,(e=>{e.parent=n})))}a(n)},o=null!=i.mesh,l=this._parent.loadSkins&&null!=i.skin;if(!o||l){const e=i.name||`node${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new TransformNode(e,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,null==i.mesh?i._babylonTransformNode=t:i._babylonTransformNodeForSkin=t,r(t)}if(o)if(l){const e=ArrayItem.Get(`${t}/mesh`,this._gltf.meshes,i.mesh);s.push(this._loadMeshAsync(`/meshes/${e.index}`,i,e,(e=>{const a=i._babylonTransformNodeForSkin;e.metadata=mergeDeep(a.metadata,e.metadata||{});const n=ArrayItem.Get(`${t}/skin`,this._gltf.skins,i.skin);s.push(this._loadSkinAsync(`/skins/${n.index}`,i,n,(t=>{this._forEachPrimitive(i,(e=>{e.skeleton=t})),this._postSceneLoadActions.push((()=>{if(null!=n.skeleton){const t=ArrayItem.Get(`/skins/${n.index}/skeleton`,this._gltf.nodes,n.skeleton).parent;i.index===t.index?e.parent=a.parent:e.parent=t._babylonTransformNode}else e.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:a,skinnedNode:e})}))})))})))}else{const e=ArrayItem.Get(`${t}/mesh`,this._gltf.meshes,i.mesh);s.push(this._loadMeshAsync(`/meshes/${e.index}`,i,e,r))}return this.logClose(),Promise.all(s).then((()=>(this._forEachPrimitive(i,(e=>{e.geometry&&e.geometry.useBoundingInfoFromGeometry?e._updateBoundingInfo():e.refreshBoundingInfo(!0,!0)})),i._babylonTransformNode)))}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new Mesh("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);const i={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case GLTFLoaderCoordinateSystemMode.AUTO:this._babylonScene.useRightHandedSystem||(i.rotation=[0,1,0,0],i.scale=[1,1,-1],e._LoadTransform(i,this._rootBabylonMesh));break;case GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(t),i}_extensionsOnReady(){this._forEachExtensions((e=>e.onReady&&e.onReady()))}_checkExtensions(){if(this._gltf.extensionsRequired)for(const e of this._gltf.extensionsRequired){if(!this._extensions.some((t=>t.name===e&&t.enabled))){if(!1===this.parent.extensionOptions[e]?.enabled)throw new Error(`Required extension ${e} is disabled`);throw new Error(`Required extension ${e} is not available`)}}}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((e=>e.dispose&&e.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}static LoadExtensionAsync(e,t,i,a){if(!t.extensions)return null;const n=t.extensions[i];return n?a(`${e}/extensions/${i}`,n):null}loadAsync(e,t,i,a,n=""){return Promise.resolve().then((()=>(this._babylonScene=e,this._loadData(t),this._loadAsync(i,n,null,(()=>{})))))}_forEachPrimitive(e,t){if(e._primitiveBabylonMeshes)for(const i of e._primitiveBabylonMeshes)t(i)}loadCameraAsync(t,i,a=()=>{}){const n=this._extensionsLoadCameraAsync(t,i,a);if(n)return n;const s=new Array;this.logOpen(`${t} ${i.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new FreeCamera(i.name||`camera${i.index}`,Vector3.Zero(),this._babylonScene,!1);switch(r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.ignoreParentScaling=!0,i._babylonCamera=r,r.rotation.set(0,Math.PI,0),i.type){case"perspective":{const e=i.perspective;if(!e)throw new Error(`${t}: Camera perspective properties are missing`);r.undefinedc=e.yfov,r.minZ=e.znear,r.maxZ=e.zfar||0;break}case"orthographic":if(!i.orthographic)throw new Error(`${t}: Camera orthographic properties are missing`);r.mode=Camera.ORTHOGRAPHIC_CAMERA,r.orthoLeft=-i.orthographic.xmag,r.orthoRight=i.orthographic.xmag,r.orthoBottom=-i.orthographic.ymag,r.orthoTop=i.orthographic.ymag,r.minZ=i.orthographic.znear,r.maxZ=i.orthographic.zfar;break;default:throw new Error(`${t}: Invalid camera type (${i.type})`)}return e.AddPointerMetadata(r,t),this._parent.onCameraLoadedObservable.notifyObservers(r),a(r),this.logClose(),Promise.all(s).then((()=>r))}_loadBone(e,t,i,a){e._isJoint=!0;let n=a[e.index];if(n)return n;let s=null;e.index!==t.skeleton&&(e.parent&&-1!==e.parent.index?s=this._loadBone(e.parent,t,i,a):void 0!==t.skeleton&&Logger.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));const r=t.joints.indexOf(e.index);return n=new Bone(e.name||`joint${e.index}`,i,s,this._getNodeMatrix(e),null,null,r),a[e.index]=n,this._postSceneLoadActions.push((()=>{n.linkTransformNode(e._babylonTransformNode)})),n}importMeshAsync(e,t,i,a,n,s,r=""){return Promise.resolve().then((()=>{this._babylonScene=t,this._assetContainer=i,this._loadData(a);let s=null;if(e){const t={};if(this._gltf.nodes)for(const e of this._gltf.nodes)e.name&&(t[e.name]=e.index);s=(e instanceof Array?e:[e]).map((e=>{const i=t[e];if(void 0===i)throw new Error(`Failed to find node '${e}'`);return i}))}return this._loadAsync(n,r,s,(()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}static _GetTypedArrayConstructor(e,t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${e}: Invalid component type ${t}`)}}static RegisterExtension(t,i){e.UnregisterExtension(t)&&Logger.Warn(`Extension with the name '${t}' already exists`),e._RegisteredExtensions[t]={factory:i}}_extensionsLoadBufferViewAsync(e,t){return this._applyExtensions(t,"loadBufferView",(i=>i.loadBufferViewAsync&&i.loadBufferViewAsync(e,t)))}_extensionsLoadCameraAsync(e,t,i){return this._applyExtensions(t,"loadCamera",(a=>a.loadCameraAsync&&a.loadCameraAsync(e,t,i)))}static LoadExtraAsync(e,t,i,a){if(!t.extras)return null;const n=t.extras[i];return n?a(`${e}/extras/${i}`,n):null}createMaterial(e,t,i){const a=this._extensionsCreateMaterial(e,t,i);if(a)return a;const n=t.name||`material${t.index}`;return this._createDefaultMaterial(n,i)}_extensionsLoadSceneAsync(e,t){return this._applyExtensions(t,"loadScene",(i=>i.loadSceneAsync&&i.loadSceneAsync(e,t)))}_loadVertexDataAsync(e,t,i){const a=this._extensionsLoadVertexDataAsync(e,t,i);if(a)return a;const n=t.attributes;if(!n)throw new Error(`${e}: Attributes are missing`);const s=new Array,r=new Geometry(i.name,this._babylonScene);if(null==t.indices)i.isUnIndexed=!0;else{const i=ArrayItem.Get(`${e}/indices`,this._gltf.accessors,t.indices);s.push(this._loadIndicesAccessorAsync(`/accessors/${i.index}`,i).then((e=>{r.setIndices(e)})))}const o=(t,a,o)=>{if(null==n[t])return;i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(a)&&i._delayInfo.push(a);const l=ArrayItem.Get(`${e}/attributes/${t}`,this._gltf.accessors,n[t]);s.push(this._loadVertexAccessorAsync(`/accessors/${l.index}`,l,a).then((e=>{if(e.getKind()===VertexBuffer.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!i.skeleton&&l.min&&l.max){const e=TmpVectors.Vector3[0].copyFromFloats(...l.min),t=TmpVectors.Vector3[1].copyFromFloats(...l.max);if(l.normalized&&5126!==l.componentType){let i=1;switch(l.componentType){case 5120:i=127;break;case 5121:i=255;break;case 5122:i=32767;break;case 5123:i=65535}const a=1/i;e.scaleInPlace(a),t.scaleInPlace(a)}r._boundingInfo=new BoundingInfo(e,t),r.useBoundingInfoFromGeometry=!0}r.setVerticesBuffer(e,l.count)}))),a==VertexBuffer.MatricesIndicesExtraKind&&(i.numBoneInfluencers=8),o&&o(l)};return o("POSITION",VertexBuffer.PositionKind),o("NORMAL",VertexBuffer.NormalKind),o("TANGENT",VertexBuffer.TangentKind),o("TEXCOORD_0",VertexBuffer.UVKind),o("TEXCOORD_1",VertexBuffer.UV2Kind),o("TEXCOORD_2",VertexBuffer.UV3Kind),o("TEXCOORD_3",VertexBuffer.UV4Kind),o("TEXCOORD_4",VertexBuffer.UV5Kind),o("TEXCOORD_5",VertexBuffer.UV6Kind),o("JOINTS_0",VertexBuffer.MatricesIndicesKind),o("WEIGHTS_0",VertexBuffer.MatricesWeightsKind),o("JOINTS_1",VertexBuffer.MatricesIndicesExtraKind),o("WEIGHTS_1",VertexBuffer.MatricesWeightsExtraKind),o("COLOR_0",VertexBuffer.ColorKind,(e=>{"VEC4"===e.type&&(i.hasVertexAlpha=!0)})),Promise.all(s).then((()=>r))}_loadAnimationChannelFromTargetInfoAsync(e,t,i,a,n,s){const r=this.parent.targetFps,o=1/r,l=ArrayItem.Get(`${e}/sampler`,i.samplers,a.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${a.sampler}`,l).then((e=>{let t=0;const l=n.object,c=n.info;for(const n of c){const c=n.getStride(l),h=e.input,u=e.output,m=new Array(h.length);let d=0;switch(e.interpolation){case"STEP":for(let e=0;e<h.length;e++){const t=n.getValue(l,u,d,1);d+=c,m[e]={frame:h[e]*r,value:t,interpolation:1}}break;case"CUBICSPLINE":for(let e=0;e<h.length;e++){const t=n.getValue(l,u,d,o);d+=c;const i=n.getValue(l,u,d,1);d+=c;const a=n.getValue(l,u,d,o);d+=c,m[e]={frame:h[e]*r,inTangent:t,value:i,outTangent:a}}break;case"LINEAR":for(let e=0;e<h.length;e++){const t=n.getValue(l,u,d,1);d+=c,m[e]={frame:h[e]*r,value:t}}}if(d>0){const e=`${i.name||`animation${i.index}`}_channel${a.index}_${t}`;n.buildAnimations(l,e,r,m,((e,i)=>{++t,s(e,i)}))}}}))}loadAnimationAsync(e,t){const i=this._extensionsLoadAnimationAsync(e,t);if(i)return i;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new AnimationGroup(t.name||`animation${t.index}`,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=a;const n=new Array;ArrayItem.Assign(t.channels),ArrayItem.Assign(t.samplers);for(const i of t.channels)n.push(this._loadAnimationChannelAsync(`${e}/channels/${i.index}`,e,t,i,((e,t)=>{e.animations=e.animations||[],e.animations.push(t),a.addTargetedAnimation(t,e)})));return Promise.all(n).then((()=>(a.normalize(0),a)))}_extensionsLoadMaterialAsync(e,t,i,a,n){return this._applyExtensions(t,"loadMaterial",(s=>s._loadMaterialAsync&&s._loadMaterialAsync(e,t,i,a,n)))}static _ValidateUri(e){return Tools.IsBase64(e)||-1===e.indexOf("..")}loadTextureInfoAsync(t,i,a=()=>{}){const n=this._extensionsLoadTextureInfoAsync(t,i,a);if(n)return n;if(this.logOpen(`${t}`),i.texCoord>=6)throw new Error(`${t}/texCoord: Invalid value (${i.texCoord})`);const s=ArrayItem.Get(`${t}/index`,this._gltf.textures,i.index);s._textureInfo=i;const r=this._loadTextureAsync(`/textures/${i.index}`,s,(n=>{n.coordinatesIndex=i.texCoord||0,e.AddPointerMetadata(n,t),this._parent.onTextureLoadedObservable.notifyObservers(n),a(n)}));return this.logClose(),r}_getTransformNodes(){const e=[],t=this._gltf.nodes;if(t)for(const i of t)i._babylonTransformNode&&"TransformNode"===i._babylonTransformNode.getClassName()&&e.push(i._babylonTransformNode),i._babylonTransformNodeForSkin&&e.push(i._babylonTransformNodeForSkin);return e}};GLTFLoader2._RegisteredExtensions={},GLTFLoader2.DefaultSampler={index:-1},GLTFFileLoader._CreateGLTF2Loader=e=>new GLTFLoader2(e);var DefaultEnvironmentTextureImageType="image/png";function _OnImageReadyAsync(e,t,i,a,n,s,r,o,l,c,h){return new Promise(((u,m)=>{if(i){const i=t.createTexture(null,!0,!0,null,1,null,(e=>{m(e)}),e);a?.onEffectCreatedObservable.addOnce((o=>{o.executeWhenCompiled((()=>{a.externalTextureSamplerBinding=!0,a.onApply=a=>{a._bindTexture("textureSampler",i),a.setFloat2("scale",1,t._features.needsInvertingBitmap&&e instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([a],c,!0,s,r),t.restoreDefaultFramebuffer(),i.dispose(),URL.revokeObjectURL(n),u())}))}))}else{if(t._uploadImageToTexture(h,e,s,r),o){const i=l[r];i&&t._uploadImageToTexture(i._texture,e,s,0)}u()}}))}async function UploadLevelsAsync(e,t,i=DefaultEnvironmentTextureImageType){if(!Tools.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");const a=Scalar.ILog2(e.width)+1,n=e.getEngine();let s=!1,r=!1,o=null,l=null,c=null;const h=n.getCaps();e.format=5,e.type=0,e.generateMipMaps=!0,e._cachedAnisotropicFilteringLevel=null,n.updateTextureSamplingMode(3,e),h.textureLOD?n._features.supportRenderAndCopyToLodForFloatTextures?h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(s=!0,e.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(s=!0,e.type=1):s=!1:(s=!1,r=!0,c={});let u=0;if(s)n.isWebGPU?(u=1,await Promise.resolve().then((()=>(init_rgbdDecode_fragment(),rgbdDecode_fragment_exports)))):await Promise.resolve().then((()=>(init_rgbdDecode_fragment2(),rgbdDecode_fragment_exports2))),o=new PostProcess("rgbdDecode","rgbdDecode",null,null,1,null,3,n,!1,void 0,e.type,void 0,null,!1,void 0,u),e._isRGBD=!1,e.invertY=!1,l=n.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:e.type,format:5});else if(e._isRGBD=!0,e.invertY=!0,r){const t=3,i=e._lodGenerationScale,s=e._lodGenerationOffset;for(let r=0;r<t;r++){const o=(a-1)*i+s,l=s+(o-s)*(1-r/(t-1)),h=Math.round(Math.min(Math.max(l,0),o)),u=new InternalTexture(n,2);u.isCube=!0,u.invertY=!0,u.generateMipMaps=!1,n.updateTextureSamplingMode(2,u);const m=new BaseTexture(null);switch(m._isCube=!0,m._texture=u,c[h]=m,r){case 0:e._lodTextureLow=m;break;case 1:e._lodTextureMid=m;break;case 2:e._lodTextureHigh=m}}}const m=[];for(let a=0;a<t.length;a++)for(let h=0;h<6;h++){const u=t[a][h],d=new Blob([u],{type:i}),f=URL.createObjectURL(d);let p;if(n._features.forceBitmapOverHTMLImageElement)p=n.createImageBitmap(d,{premultiplyAlpha:"none"}).then((t=>_OnImageReadyAsync(t,n,s,o,f,h,a,r,c,l,e)));else{const t=new Image;t.src=f,p=new Promise(((i,u)=>{t.onload=()=>{_OnImageReadyAsync(t,n,s,o,f,h,a,r,c,l,e).then((()=>i())).catch((e=>{u(e)}))},t.onerror=e=>{u(e)}}))}m.push(p)}if(t.length<a){let i;const s=Math.pow(2,a-1-t.length),r=s*s*4;switch(e.type){case 0:i=new Uint8Array(r);break;case 2:i=new Uint16Array(r);break;case 1:i=new Float32Array(r)}for(let s=t.length;s<a;s++)for(let t=0;t<6;t++)n._uploadArrayBufferViewToTexture(e,i,t,s)}return Promise.all(m).then((()=>{l&&(n._releaseTexture(e),l._swapAndDie(e)),o&&o.dispose(),r&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))}))}function _UpdateRGBDAsync(e,t,i,a,n){const s=UploadLevelsAsync(e.getEngine().createRawCubeTexture(null,e.width,e.format,e.type,e.generateMipMaps,e.invertY,e.samplingMode,e._compression),t).then((()=>e));return e.onRebuildCallback=e=>({proxy:s,isReady:!0,isAsync:!0}),e._source=13,e._bufferViewArrayArray=t,e._lodGenerationScale=a,e._lodGenerationOffset=n,e._sphericalPolynomial=i,UploadLevelsAsync(e,t).then((()=>(e.isReady=!0,e)))}var RawCubeTexture=class e extends CubeTexture{update(e,t,i,a,n=null){this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,i,a,n)}constructor(e,t,i,a=5,n=0,s=!1,r=!1,o=3,l=null){super("",e),this._texture=e.getEngine().createRawCubeTexture(t,i,a,n,s,r,o,l)}clone(){return SerializationHelper.Clone((()=>{const t=this.getScene(),i=this._texture,a=new e(t,i._bufferViewArray,i.width,i.format,i.type,i.generateMipMaps,i.invertY,i.samplingMode,i._compression);return 13===i.source&&a.updateRGBDAsync(i._bufferViewArrayArray,i._sphericalPolynomial,i._lodGenerationScale,i._lodGenerationOffset),a}),this)}updateRGBDAsync(e,t=null,i=.8,a=0){return _UpdateRGBDAsync(this._texture,e,t,i,a).then((()=>{}))}},NAME="EXT_lights_image_based",EXT_lights_image_based=class{_loadLightAsync(e,t){if(!t._loaded){const i=new Array;this._loader.logOpen(`${e}`);const a=new Array(t.specularImages.length);for(let n=0;n<t.specularImages.length;n++){const s=t.specularImages[n];a[n]=new Array(s.length);for(let t=0;t<s.length;t++){const r=`${e}/specularImages/${n}/${t}`;this._loader.logOpen(`${r}`);const o=s[t],l=ArrayItem.Get(r,this._loader.gltf.images,o);i.push(this._loader.loadImageAsync(`/images/${o}`,l).then((e=>{a[n][t]=e}))),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(i).then((()=>{const i=new RawCubeTexture(this._loader.babylonScene,null,t.specularImageSize);if(i.name=t.name||"environment",t._babylonTexture=i,null!=t.intensity&&(i.level=t.intensity),t.rotation){let e=Quaternion.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(e=Quaternion.Inverse(e)),Matrix.FromQuaternionToRef(e,i.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const n=SphericalHarmonics.FromArray(t.irradianceCoefficients);n.scaleInPlace(t.intensity),n.convertIrradianceToLambertianRadiance();const s=SphericalPolynomial.FromHarmonics(n),r=(a.length-1)/Scalar.Log2(t.specularImageSize);return i.updateRGBDAsync(a,s,r)}))}return t._loaded.then((()=>t._babylonTexture))}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights}}loadSceneAsync(e,t){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((i,a)=>{this._loader._allMaterialsDirtyRequired=!0;const n=new Array;n.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${i}`);const s=ArrayItem.Get(`${i}/light`,this._lights,a.light);return n.push(this._loadLightAsync(`/extensions/${this.name}/lights/${a.light}`,s).then((e=>{this._loader.babylonScene.environmentTexture=e}))),this._loader.logClose(),Promise.all(n).then((()=>{}))}))}constructor(e){this.name=NAME,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME)}};GLTFLoader2.RegisterExtension(NAME,(e=>new EXT_lights_image_based(e))),Mesh.prototype.thinInstanceAdd=function(e,t=!0){if(!this.getScene().getEngine().getCaps().instancedArrays)return Logger.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(e)?e.length:1);const i=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(e))for(let i=0;i<e.length;++i)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e[i],i===e.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e,t);return i},Mesh.prototype.thinInstanceAddSelf=function(e=!0){return this.thinInstanceAdd(Matrix.IdentityReadOnly,e)},Mesh.prototype.thinInstanceRegisterAttribute=function(e,t){e===VertexBuffer.ColorKind&&(e=VertexBuffer.ColorInstanceKind),this.removeVerticesData(e),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[e]=t,this._userThinInstanceBuffersStorage.sizes[e]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[e]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[e]),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new VertexBuffer(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])},Mesh.prototype.thinInstanceSetMatrixAt=function(e,t,i=!0){if(!this._thinInstanceDataStorage.matrixData||e>=this._thinInstanceDataStorage.instancesCount)return!1;const a=this._thinInstanceDataStorage.matrixData;return t.copyToArray(a,16*e),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[e]=t),i&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},Mesh.prototype.thinInstanceSetAttributeAt=function(e,t,i,a=!0){return e===VertexBuffer.ColorKind&&(e=VertexBuffer.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[e]||t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(e,0),this._userThinInstanceBuffersStorage.data[e].set(i,t*this._userThinInstanceBuffersStorage.strides[e]),a&&this.thinInstanceBufferUpdated(e),!0)},Object.defineProperty(Mesh.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(e){const t=this._thinInstanceDataStorage.matrixData??this.source?._thinInstanceDataStorage.matrixData;e<=(t?t.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=e)},enumerable:!0,configurable:!0}),Mesh.prototype._thinInstanceCreateMatrixBuffer=function(e,t,i=!0){const a=new Buffer2(this.getEngine(),t,!i,16,!1,!0);for(let t=0;t<4;t++)this.setVerticesBuffer(a.createVertexBuffer(e+t,4*t,4));return a},Mesh.prototype.thinInstanceSetBuffer=function(e,t,i=0,a=!0){i=i||16,"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*i,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,null!==t?(this._thinInstanceDataStorage.instancesCount=t.length/i,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",t,a),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):"previousMatrix"===e?(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=t,null!==t&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",t,a))):(e===VertexBuffer.ColorKind&&(e=VertexBuffer.ColorInstanceKind),null===t?this._userThinInstanceBuffersStorage?.data[e]&&(this.removeVerticesData(e),delete this._userThinInstanceBuffersStorage.data[e],delete this._userThinInstanceBuffersStorage.strides[e],delete this._userThinInstanceBuffersStorage.sizes[e],delete this._userThinInstanceBuffersStorage.vertexBuffers[e]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[e]=t,this._userThinInstanceBuffersStorage.strides[e]=i,this._userThinInstanceBuffersStorage.sizes[e]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new VertexBuffer(this.getEngine(),t,e,!a,!1,i,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])))},Mesh.prototype.thinInstanceBufferUpdated=function(e){"matrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.matrixBuffer?.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount)):"previousMatrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.previousMatrixBuffer?.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)):(e===VertexBuffer.ColorKind&&(e=VertexBuffer.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&(this.thinInstanceAllowAutomaticStaticBufferRecreation&&!this._userThinInstanceBuffersStorage.vertexBuffers[e].isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(this._userThinInstanceBuffersStorage.data[e],0)))},Mesh.prototype.thinInstancePartialBufferUpdate=function(e,t,i){"matrix"===e?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,i):(e===VertexBuffer.ColorKind&&(e=VertexBuffer.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(t,i))},Mesh.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const e=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=Matrix.FromArray(e,16*t)}return this._thinInstanceDataStorage.worldMatrices},Mesh.prototype.thinInstanceRefreshBoundingInfo=function(e=!1,t=!1,i=!1){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const a=this._thinInstanceDataStorage.boundingVectors;if(e||!this.rawBoundingInfo){a.length=0,this.refreshBoundingInfo(t,i);const e=this.getBoundingInfo();this.rawBoundingInfo=new BoundingInfo(e.minimum,e.maximum)}const n=this.getBoundingInfo(),s=this._thinInstanceDataStorage.matrixData;if(0===a.length)for(let e=0;e<n.boundingBox.vectors.length;++e)a.push(n.boundingBox.vectors[e].clone());TmpVectors.Vector3[0].setAll(Number.POSITIVE_INFINITY),TmpVectors.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(let e=0;e<this._thinInstanceDataStorage.instancesCount;++e){Matrix.FromArrayToRef(s,16*e,TmpVectors.Matrix[0]);for(let e=0;e<a.length;++e)Vector3.TransformCoordinatesToRef(a[e],TmpVectors.Matrix[0],TmpVectors.Vector3[2]),TmpVectors.Vector3[0].minimizeInPlace(TmpVectors.Vector3[2]),TmpVectors.Vector3[1].maximizeInPlace(TmpVectors.Vector3[2])}n.reConstruct(TmpVectors.Vector3[0],TmpVectors.Vector3[1]),this._updateBoundingInfo()},Mesh.prototype._thinInstanceRecreateBuffer=function(e,t=!0){"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,t)):"previousMatrix"===e?this._scene.needsPreviousWorldMatrices&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,t)):(e===VertexBuffer.ColorKind&&(e=VertexBuffer.ColorInstanceKind),this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new VertexBuffer(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!t,!1,this._userThinInstanceBuffersStorage.strides[e],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))},Mesh.prototype._thinInstanceUpdateBufferSize=function(e,t=1){e===VertexBuffer.ColorKind&&(e=VertexBuffer.ColorInstanceKind);const i="matrix"===e;if(!(i||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[e]))return;const a=i?16:this._userThinInstanceBuffersStorage.strides[e],n=i?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[e];let s=i?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[e];const r=(this._thinInstanceDataStorage.instancesCount+t)*a;let o=n;for(;o<r;)o*=2;if(!s||n!=o){if(s){const e=new Float32Array(o);e.set(s,0),s=e}else s=new Float32Array(o);i?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",s,!1),this._thinInstanceDataStorage.matrixData=s,this._thinInstanceDataStorage.matrixBufferSize=o,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",s,!1))):(this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.data[e]=s,this._userThinInstanceBuffersStorage.sizes[e]=o,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new VertexBuffer(this.getEngine(),s,e,!0,!1,a,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))}},Mesh.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},Mesh.prototype._disposeThinInstanceSpecificData=function(){this._thinInstanceDataStorage?.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)};var NAME2="EXT_mesh_gpu_instancing",EXT_mesh_gpu_instancing=class{dispose(){this._loader=null}loadNodeAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((e,a)=>{this._loader._disableInstancedMesh++;const n=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,i);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return n;const s=new Array;let r=0;const o=t=>{if(null==a.attributes[t])return void s.push(Promise.resolve(null));const i=ArrayItem.Get(`${e}/attributes/${t}`,this._loader.gltf.accessors,a.attributes[t]);if(s.push(this._loader._loadFloatAccessorAsync(`/accessors/${i.bufferView}`,i)),0===r)r=i.count;else if(r!==i.count)throw new Error(`${e}/attributes: Instance buffer accessors do not have the same count.`)};return o("TRANSLATION"),o("ROTATION"),o("SCALE"),n.then((e=>Promise.all(s).then((([i,a,n])=>{const s=new Float32Array(16*r);TmpVectors.Vector3[0].copyFromFloats(0,0,0),TmpVectors.Cc[0].copyFromFloats(0,0,0,1),TmpVectors.Vector3[1].copyFromFloats(1,1,1);for(let e=0;e<r;++e)i&&Vector3.FromArrayToRef(i,3*e,TmpVectors.Vector3[0]),a&&Quaternion.FromArrayToRef(a,4*e,TmpVectors.Cc[0]),n&&Vector3.FromArrayToRef(n,3*e,TmpVectors.Vector3[1]),Matrix.ComposeToRef(TmpVectors.Vector3[1],TmpVectors.Cc[0],TmpVectors.Vector3[0],TmpVectors.Matrix[0]),TmpVectors.Matrix[0].copyToArray(s,16*e);for(const e of t._primitiveBabylonMeshes)e.thinInstanceSetBuffer("matrix",s,16,!0);return e}))))}))}constructor(e){this.name=NAME2,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME2)}};GLTFLoader2.RegisterExtension(NAME2,(e=>new EXT_mesh_gpu_instancing(e)));var MeshoptCompression=class e{decodeGltfBufferAsync(e,t,i,a,n){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const s=await MeshoptDecoder.decodeGltfBufferAsync(t,i,e,a,n);return MeshoptDecoder.useWorkers(0),s}))}dispose(){delete this._decoderModulePromise}constructor(){const t=e.Configuration.decoder;this._decoderModulePromise=Tools.LoadBabylonScriptAsync(t.url).then((()=>MeshoptDecoder.ready))}static get Default(){return e._Default||(e._Default=new e),e._Default}};MeshoptCompression.Configuration={decoder:{url:`${Tools._DefaultCdnUrl}/meshopt_decoder.js`}},MeshoptCompression._Default=null;var NAME3="EXT_meshopt_compression",EXT_meshopt_compression=class{loadBufferViewAsync(e,t){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((i,a)=>{const n=t;if(n._meshOptData)return n._meshOptData;const s=ArrayItem.Get(`${e}/buffer`,this._loader.gltf.buffers,a.buffer);return n._meshOptData=this._loader.loadBufferAsync(`/buffers/${s.index}`,s,a.byteOffset||0,a.byteLength).then((e=>MeshoptCompression.Default.decodeGltfBufferAsync(e,a.count,a.byteStride,a.mode,a.filter))),n._meshOptData}))}constructor(e){this.name=NAME3,this.enabled=e.isExtensionUsed(NAME3),this._loader=e}dispose(){this._loader=null}};GLTFLoader2.RegisterExtension(NAME3,(e=>new EXT_meshopt_compression(e)));var NAME4="EXT_texture_webp",EXT_texture_webp=class{dispose(){this._loader=null}constructor(e){this.name=NAME4,this._loader=e,this.enabled=e.isExtensionUsed(NAME4)}_loadTextureAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=null==t.sampler?GLTFLoader2.DefaultSampler:ArrayItem.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),r=ArrayItem.Get(`${a}/source`,this._loader.gltf.images,n.source);return this._loader._createTextureAsync(e,s,r,(e=>{i(e)}),void 0,!t._textureInfo.nonColorData)}))}};GLTFLoader2.RegisterExtension(NAME4,(e=>new EXT_texture_webp(e)));var NAME5="EXT_texture_avif",EXT_texture_avif=class{dispose(){this._loader=null}_loadTextureAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=null==t.sampler?GLTFLoader2.DefaultSampler:ArrayItem.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),r=ArrayItem.Get(`${a}/source`,this._loader.gltf.images,n.source);return this._loader._createTextureAsync(e,s,r,(e=>{i(e)}),void 0,!t._textureInfo.nonColorData)}))}constructor(e){this.name=NAME5,this._loader=e,this.enabled=e.isExtensionUsed(NAME5)}};GLTFLoader2.RegisterExtension(NAME5,(e=>new EXT_texture_avif(e)));var WorkerPool=class{_execute(e,t){e.idle=!1,e.workerPromise.then((i=>{t(i,(()=>{const t=this._pendingActions.shift();t?this._execute(e,t):e.idle=!0}))}))}constructor(e){this._pendingActions=new Array,this._workerInfos=e.map((e=>({workerPromise:Promise.resolve(e),idle:!0})))}dispose(){for(const e of this._workerInfos)e.workerPromise.then((e=>{e.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}_executeOnIdleWorker(e){for(const t of this._workerInfos)if(t.idle)return this._execute(t,e),!0;return!1}push(e){this._executeOnIdleWorker(e)||this._pendingActions.push(e)}},AutoReleaseWorkerPool=class e extends WorkerPool{_execute(e,t){e.timeoutId&&(clearTimeout(e.timeoutId),delete e.timeoutId),super._execute(e,((i,a)=>{t(i,(()=>{a(),e.idle&&(e.timeoutId=setTimeout((()=>{e.workerPromise.then((e=>{e.terminate()}));const t=this._workerInfos.indexOf(e);-1!==t&&this._workerInfos.splice(t,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}constructor(t,i,a=e.DefaultOptions){super([]),this._maxWorkers=t,this._createWorkerAsync=i,this._options=a}push(e){if(!this._executeOnIdleWorker(e))if(this._workerInfos.length<this._maxWorkers){const t={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(t),this._execute(t,e)}else this._pendingActions.push(e)}};function decodeMesh(e,t,i,a,n){let s=null,r=null,o=null;try{let l;s=new e.Decoder,r=new e.DecoderBuffer,r.Init(t,t.byteLength);const c=s.GetEncodedGeometryType(r);switch(c){case e.TRIANGULAR_MESH:{const t=new e.Mesh;if(l=s.DecodeBufferToMesh(r,t),!l.ok()||0===t.ptr)throw new Error(l.error_msg());const i=3*t.num_faces(),n=4*i,c=e._malloc(n);try{s.GetTrianglesUInt32Array(t,n,c);const r=new Uint32Array(i);r.set(new Uint32Array(e.HEAPF32.buffer,c,i)),a(r)}finally{e._free(c)}o=t;break}case e.POINT_CLOUD:{const t=new e.PointCloud;if(l=s.DecodeBufferToPointCloud(r,t),!l.ok()||!t.ptr)throw new Error(l.error_msg());o=t;break}default:throw new Error(`Invalid geometry type ${c}`)}const h=o.num_points(),u=(t,i,a,s)=>{const r=s.data_type(),o=s.num_components(),l=s.normalized(),c=s.byte_stride(),u=s.byte_offset(),m={[e.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:e.HEAPF32},[e.DT_INT8]:{typedArrayConstructor:Int8Array,heap:e.HEAP8},[e.DT_INT16]:{typedArrayConstructor:Int16Array,heap:e.HEAP16},[e.DT_INT32]:{typedArrayConstructor:Int32Array,heap:e.HEAP32},[e.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:e.HEAPU8},[e.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:e.HEAPU16},[e.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:e.HEAPU32}}[r];if(!m)throw new Error(`Invalid data type ${r}`);const d=h*o,f=d*m.typedArrayConstructor.BYTES_PER_ELEMENT,p=e._malloc(f);try{t.GetAttributeDataArrayForAllPoints(i,s,r,f,p);const e=new m.typedArrayConstructor(m.heap.buffer,p,d);n(a,e.slice(),o,u,c,l)}finally{e._free(p)}};if(i)for(const e in i){const t=i[e],a=s.GetAttributeByUniqueId(o,t);u(s,o,e,a)}else{const t={position:e.POSITION,normal:e.NORMAL,color:e.COLOR,uv:e.TEX_COORD};for(const e in t){const i=s.GetAttributeId(o,t[e]);if(-1!==i){const t=s.GetAttribute(o,i);u(s,o,e,t)}}}return h}finally{o&&e.destroy(o),r&&e.destroy(r),s&&e.destroy(s)}}function workerFunction(){let e;onmessage=t=>{const i=t.data;switch(i.id){case"init":{const t=i.decoder;t.url&&importScripts(t.url);const a=t.wasmBinary?{wasmBinary:t.wasmBinary}:{};e=DracoDecoderModule(a),postMessage({id:"initDone"});break}case"decodeMesh":if(!e)throw new Error("Draco decoder module is not available");e.then((e=>{const t=decodeMesh(e,i.dataView,i.attributes,(e=>{postMessage({id:"indices",data:e},[e.buffer])}),((e,t,i,a,n,s)=>{postMessage({id:"attribute",kind:e,data:t,size:i,byteOffset:a,byteStride:n,normalized:s},[t.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:t})}))}}}function initializeWebWorker(e,t,i){return new Promise(((a,n)=>{const s=t=>{e.removeEventListener("error",s),e.removeEventListener("message",r),n(t)},r=t=>{"initDone"===t.data.id&&(e.removeEventListener("error",s),e.removeEventListener("message",r),a(e))};if(e.addEventListener("error",s),e.addEventListener("message",r),t){const a=t.slice(0);e.postMessage({id:"init",decoder:{url:i,wasmBinary:a}},[a])}else e.postMessage({id:"init",decoder:{url:i}})}))}function createDecoderAsync(e,t){return new Promise((i=>{(t||DracoDecoderModule)({wasmBinary:e}).then((e=>{i({module:e})}))}))}AutoReleaseWorkerPool.DefaultOptions={idleTimeElapsedBeforeRelease:1e3};var DracoCompression=class e{constructor(t=e.DefaultNumWorkers){const i=e.Configuration.decoder;if(i.workerPool||"object"==typeof t&&t.workerPool)this._workerPoolPromise=Promise.resolve(i.workerPool||t.workerPool);else{const e=i.wasmBinary||"object"==typeof t&&t.wasmBinary,a="number"==typeof t?t:t.numWorkers,n=a&&"function"==typeof Worker&&"function"==typeof URL,s=n||!n&&!i.jsModule,r=i.wasmUrl&&i.wasmBinaryUrl&&"object"==typeof WebAssembly?{url:s?Tools.GetBabylonScriptURL(i.wasmUrl,!0):"",wasmBinaryPromise:e?Promise.resolve(e):Tools.LoadFileAsync(Tools.GetBabylonScriptURL(i.wasmBinaryUrl,!0))}:{url:s?Tools.GetBabylonScriptURL(i.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};n?this._workerPoolPromise=r.wasmBinaryPromise.then((e=>{const t=`${decodeMesh}(${workerFunction})()`,i=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));return new AutoReleaseWorkerPool(a,(()=>initializeWebWorker(new Worker(i),e,r.url)))})):this._decoderModulePromise=r.wasmBinaryPromise.then((async e=>{if("undefined"==typeof DracoDecoderModule&&!i.jsModule){if(!r.url)throw new Error("Draco decoder module is not available");await Tools.LoadBabylonScriptAsync(r.url)}return await createDecoderAsync(e,i.jsModule)}))}}static GetDefaultNumWorkers(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static ResetDefault(t){e._Default&&(t||e._Default.dispose(),e._Default=null)}static get DecoderAvailable(){const t=e.Configuration.decoder;return!!(t.wasmUrl&&t.wasmBinaryUrl&&"object"==typeof WebAssembly||t.fallbackUrl)}async decodeMeshToGeometryAsync(e,t,i,a){const n=await this.decodeMeshToMeshDataAsync(i,a),s=new Geometry(e,t);n.indices&&s.setIndices(n.indices);for(const e of n.attributes)s.setVerticesBuffer(new VertexBuffer(t.getEngine(),e.data,e.kind,!1,void 0,e.byteStride,void 0,e.byteOffset,e.size,void 0,e.normalized,!0),n.totalVertices);return s}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((e=>{e.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}decodeMeshToMeshDataAsync(e,t,i){const a=e instanceof ArrayBuffer?new Int8Array(e):new Int8Array(e.buffer,e.byteOffset,e.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((e=>new Promise(((n,s)=>{e.push(((e,r)=>{let o=null;const l=[],c=t=>{e.removeEventListener("error",c),e.removeEventListener("message",h),s(t),r()},h=t=>{const a=t.data;switch(a.id){case"decodeMeshDone":e.removeEventListener("error",c),e.removeEventListener("message",h),n({indices:o,attributes:l,totalVertices:a.totalVertices}),r();break;case"indices":o=a.data;break;case"attribute":l.push({kind:a.kind,data:a.data,size:a.size,byteOffset:a.byteOffset,byteStride:a.byteStride,normalized:(s=a.kind,u=a.normalized,i&&void 0!==i[s]?(u!==i[s]&&Logger.Warn(`Normalized flag from Draco data (${u}) does not match normalized flag from glTF accessor (${i[s]}). Using flag from glTF accessor.`),i[s]):u)})}var s,u};e.addEventListener("error",c),e.addEventListener("message",h);const u=a.slice();e.postMessage({id:"decodeMesh",dataView:u,attributes:t},[u.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((e=>{let i=null;const n=[],s=decodeMesh(e.module,a,t,(e=>{i=e}),((e,t,i,a,s,r)=>{n.push({kind:e,data:t,size:i,byteOffset:a,byteStride:s,normalized:r})}));return{indices:i,attributes:n,totalVertices:s}}));throw new Error("Draco decoder module is not available")}async decodeMeshAsync(e,t){const i=await this.decodeMeshToMeshDataAsync(e,t),a=new VertexData;i.indices&&(a.indices=i.indices);for(const e of i.attributes){const t=VertexBuffer.GetFloatData(e.data,e.size,VertexBuffer.GetDataType(e.data),e.byteOffset,e.byteStride,e.normalized,i.totalVertices);a.set(t,e.kind)}return a}static get Default(){return e._Default||(e._Default=new e),e._Default}async _decodeMeshToGeometryForGltfAsync(e,t,i,a,n){const s=await this.decodeMeshToMeshDataAsync(i,a,n),r=new Geometry(e,t);s.indices&&r.setIndices(s.indices);for(const e of s.attributes)r.setVerticesBuffer(new VertexBuffer(t.getEngine(),e.data,e.kind,!1,void 0,e.byteStride,void 0,e.byteOffset,e.size,void 0,e.normalized,!0),s.totalVertices);return r}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}};DracoCompression.Configuration={decoder:{wasmUrl:`${Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Tools._DefaultCdnUrl}/draco_decoder_gltf.js`}},DracoCompression.DefaultNumWorkers=DracoCompression.GetDefaultNumWorkers(),DracoCompression._Default=null;var NAME6="KHR_draco_mesh_compression",KHR_draco_mesh_compression=class{constructor(e){this.name=NAME6,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=DracoCompression.DecoderAvailable&&this._loader.isExtensionUsed(NAME6)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{if(null!=t.mode&&4!==t.mode&&5!==t.mode)throw new Error(`${e}: Unsupported mode ${t.mode}`);const s={},r={},o=(e,a)=>{const o=n.attributes[e];if(null!=o&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(a)&&i._delayInfo.push(a),s[a]=o,this.useNormalizedFlagFromAccessor)){const i=ArrayItem.TryGet(this._loader.gltf.accessors,t.attributes[e]);i&&(r[a]=i.normalized||!1)}};o("POSITION",VertexBuffer.PositionKind),o("NORMAL",VertexBuffer.NormalKind),o("TANGENT",VertexBuffer.TangentKind),o("TEXCOORD_0",VertexBuffer.UVKind),o("TEXCOORD_1",VertexBuffer.UV2Kind),o("TEXCOORD_2",VertexBuffer.UV3Kind),o("TEXCOORD_3",VertexBuffer.UV4Kind),o("TEXCOORD_4",VertexBuffer.UV5Kind),o("TEXCOORD_5",VertexBuffer.UV6Kind),o("JOINTS_0",VertexBuffer.MatricesIndicesKind),o("WEIGHTS_0",VertexBuffer.MatricesWeightsKind),o("COLOR_0",VertexBuffer.ColorKind);const l=ArrayItem.Get(a,this._loader.gltf.bufferViews,n.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((t=>(this.dracoCompression||DracoCompression.Default)._decodeMeshToGeometryForGltfAsync(i.name,this._loader.babylonScene,t,s,r).catch((t=>{throw new Error(`${e}: ${t.message}`)}))))),l._dracoBabylonGeometry}))}};GLTFLoader2.RegisterExtension(NAME6,(e=>new KHR_draco_mesh_compression(e)));var NAME7="KHR_lights_punctual",KHR_lights=class{constructor(e){this.name=NAME7,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME7)}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights,ArrayItem.Assign(this._lights)}}dispose(){this._loader=null,delete this._lights}loadNodeAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(e,t,(e=>{let t;const s=ArrayItem.Get(a,this._lights,n.light),r=s.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,s.type){case"directional":{const e=new DirectionalLight(r,Vector3.Backward(),this._loader.babylonScene);e.position.setAll(0),t=e;break}case"point":t=new PointLight(r,Vector3.Zero(),this._loader.babylonScene);break;case"spot":{const e=new SpotLight(r,Vector3.Zero(),Vector3.Backward(),0,1,this._loader.babylonScene);e.angle=2*(s.spot&&s.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(s.spot&&s.spot.innerConeAngle||0),t=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${a}: Invalid light type (${s.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=t,t.falloffType=Light.FALLOFF_GLTF,t.diffuse=s.color?Color3.FromArray(s.color):Color3.White(),t.intensity=null==s.intensity?1:s.intensity,t.range=null==s.range?Number.MAX_VALUE:s.range,t.parent=e,this._loader._babylonLights.push(t),GLTFLoader2.AddPointerMetadata(t,a),i(e)})))))}};GLTFLoader2.RegisterExtension(NAME7,(e=>new KHR_lights(e)));var NAME8="KHR_materials_pbrSpecularGlossiness",KHR_materials_pbrSpecularGlossiness=class{dispose(){this._loader=null}constructor(e){this.name=NAME8,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME8)}_loadSpecularGlossinessPropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;return i.metallic=null,i.roughness=null,t.diffuseFactor?(i.albedoColor=Color3.FromArray(t.diffuseFactor),i.alpha=t.diffuseFactor[3]):i.albedoColor=Color3.White(),i.reflectivityColor=t.specularFactor?Color3.FromArray(t.specularFactor):Color3.White(),i.microSurface=null==t.glossinessFactor?1:t.glossinessFactor,t.diffuseTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,t.diffuseTexture,(e=>{e.name=`${i.name} (Diffuse)`,i.albedoTexture=e}))),t.specularGlossinessTexture&&(a.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,t.specularGlossinessTexture,(e=>{e.name=`${i.name} (Specular Glossiness)`,i.reflectivityTexture=e,i.reflectivityTexture.hasAlpha=!0}))),i.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(a).then((()=>{}))}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loadSpecularGlossinessPropertiesAsync(a,n,i)),this._loader.loadMaterialAlphaProperties(e,t,i),Promise.all(s).then((()=>{}))}))}};GLTFLoader2.RegisterExtension(NAME8,(e=>new KHR_materials_pbrSpecularGlossiness(e)));var NAME9="KHR_materials_unlit",KHR_materials_unlit=class{loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,(()=>this._loadUnlitPropertiesAsync(e,t,i)))}constructor(e){this.name=NAME9,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME9)}_loadUnlitPropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;i.unlit=!0;const n=t.pbrMetallicRoughness;return n&&(n.baseColorFactor?(i.albedoColor=Color3.FromArray(n.baseColorFactor),i.alpha=n.baseColorFactor[3]):i.albedoColor=Color3.White(),n.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,n.baseColorTexture,(e=>{e.name=`${i.name} (Base Color)`,i.albedoTexture=e})))),t.doubleSided&&(i.backFaceCulling=!1,i.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,i),Promise.all(a).then((()=>{}))}dispose(){this._loader=null}};GLTFLoader2.RegisterExtension(NAME9,(e=>new KHR_materials_unlit(e)));var NAME10="KHR_materials_clearcoat",KHR_materials_clearcoat=class{_loadClearCoatPropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;return i.clearCoat.isEnabled=!0,i.clearCoat.useRoughnessFromMainTexture=!1,i.clearCoat.remapF0OnInterfaceChange=!1,null!=t.clearcoatFactor?i.clearCoat.intensity=t.clearcoatFactor:i.clearCoat.intensity=0,t.clearcoatTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,t.clearcoatTexture,(e=>{e.name=`${i.name} (ClearCoat Intensity)`,i.clearCoat.texture=e}))),null!=t.clearcoatRoughnessFactor?i.clearCoat.roughness=t.clearcoatRoughnessFactor:i.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,(e=>{e.name=`${i.name} (ClearCoat Roughness)`,i.clearCoat.textureRoughness=e})))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,t.clearcoatNormalTexture,(e=>{e.name=`${i.name} (ClearCoat Normal)`,i.clearCoat.bumpTexture=e}))),i.invertNormalMapX=!i.getScene().useRightHandedSystem,i.invertNormalMapY=i.getScene().useRightHandedSystem,null!=t.clearcoatNormalTexture.scale&&(i.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(a).then((()=>{}))}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadClearCoatPropertiesAsync(a,n,i)),Promise.all(s).then((()=>{}))}))}constructor(e){this.name=NAME10,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME10)}dispose(){this._loader=null}};GLTFLoader2.RegisterExtension(NAME10,(e=>new KHR_materials_clearcoat(e)));var NAME11="KHR_materials_iridescence",KHR_materials_iridescence=class{dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadIridescencePropertiesAsync(a,n,i)),Promise.all(s).then((()=>{}))}))}constructor(e){this.name=NAME11,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME11)}_loadIridescencePropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;return i.iridescence.isEnabled=!0,i.iridescence.intensity=t.iridescenceFactor??0,i.iridescence.indexOfRefraction=t.iridescenceIor??t.iridescenceIOR??1.3,i.iridescence.minimumThickness=t.iridescenceThicknessMinimum??100,i.iridescence.maximumThickness=t.iridescenceThicknessMaximum??400,t.iridescenceTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,t.iridescenceTexture,(e=>{e.name=`${i.name} (Iridescence Intensity)`,i.iridescence.texture=e}))),t.iridescenceThicknessTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,(e=>{e.name=`${i.name} (Iridescence Thickness)`,i.iridescence.thicknessTexture=e}))),Promise.all(a).then((()=>{}))}};GLTFLoader2.RegisterExtension(NAME11,(e=>new KHR_materials_iridescence(e)));var NAME12="KHR_materials_anisotropy",KHR_materials_anisotropy=class{constructor(e){this.name=NAME12,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME12)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadIridescencePropertiesAsync(a,n,i)),Promise.all(s).then((()=>{}))}))}_loadIridescencePropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;return i.anisotropy.isEnabled=!0,i.anisotropy.intensity=t.anisotropyStrength??0,i.anisotropy.angle=t.anisotropyRotation??0,t.anisotropyTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/anisotropyTexture`,t.anisotropyTexture,(e=>{e.name=`${i.name} (Anisotropy Intensity)`,i.anisotropy.texture=e}))),Promise.all(a).then((()=>{}))}};GLTFLoader2.RegisterExtension(NAME12,(e=>new KHR_materials_anisotropy(e)));var NAME13="KHR_materials_emissive_strength",KHR_materials_emissive_strength=class{constructor(e){this.name=NAME13,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME13)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>this._loader.loadMaterialPropertiesAsync(e,t,i).then((()=>{this._loadEmissiveProperties(a,n,i)}))))}_loadEmissiveProperties(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);void 0!==t.emissiveStrength&&(i.emissiveIntensity=t.emissiveStrength)}};GLTFLoader2.RegisterExtension(NAME13,(e=>new KHR_materials_emissive_strength(e)));var NAME14="KHR_materials_sheen",KHR_materials_sheen=class{_loadSheenPropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;return i.sheen.isEnabled=!0,i.sheen.intensity=1,null!=t.sheenColorFactor?i.sheen.color=Color3.FromArray(t.sheenColorFactor):i.sheen.color=Color3.Black(),t.sheenColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,t.sheenColorTexture,(e=>{e.name=`${i.name} (Sheen Color)`,i.sheen.texture=e}))),void 0!==t.sheenRoughnessFactor?i.sheen.roughness=t.sheenRoughnessFactor:i.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,t.sheenRoughnessTexture,(e=>{e.name=`${i.name} (Sheen Roughness)`,i.sheen.textureRoughness=e})))),i.sheen.albedoScaling=!0,i.sheen.useRoughnessFromMainTexture=!1,Promise.all(a).then((()=>{}))}dispose(){this._loader=null}constructor(e){this.name=NAME14,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME14)}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadSheenPropertiesAsync(a,n,i)),Promise.all(s).then((()=>{}))}))}};GLTFLoader2.RegisterExtension(NAME14,(e=>new KHR_materials_sheen(e)));var NAME15="KHR_materials_specular",KHR_materials_specular=class{_loadSpecularPropertiesAsync(e,t,i){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const a=new Array;return void 0!==t.specularFactor&&(i.metallicF0Factor=t.specularFactor),void 0!==t.specularColorFactor&&(i.metallicReflectanceColor=Color3.FromArray(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,t.specularTexture,(e=>{e.name=`${i.name} (Specular F0 Strength)`,i.metallicReflectanceTexture=e,i.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),t.specularColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,t.specularColorTexture,(e=>{e.name=`${i.name} (Specular F0 Color)`,i.reflectanceTexture=e}))),Promise.all(a).then((()=>{}))}dispose(){this._loader=null}constructor(e){this.name=NAME15,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME15)}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadSpecularPropertiesAsync(a,n,i)),Promise.all(s).then((()=>{}))}))}};GLTFLoader2.RegisterExtension(NAME15,(e=>new KHR_materials_specular(e)));var NAME16="KHR_materials_ior",KHR_materials_ior=class e{_loadIorPropertiesAsync(t,i,a){if(!(a instanceof PBRMaterial))throw new Error(`${t}: Material type not supported`);return void 0!==i.ior?a.indexOfRefraction=i.ior:a.indexOfRefraction=e._DEFAULT_IOR,Promise.resolve()}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadIorPropertiesAsync(a,n,i)),Promise.all(s).then((()=>{}))}))}dispose(){this._loader=null}constructor(e){this.name=NAME16,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME16)}};KHR_materials_ior._DEFAULT_IOR=1.5,GLTFLoader2.RegisterExtension(NAME16,(e=>new KHR_materials_ior(e)));var NAME17="KHR_materials_variants",KHR_materials_variants=class e{reset(t){e.Reset(t)}static SelectVariant(e,t){const i=this._GetExtensionMetadata(e);if(!i)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${NAME17} extension`);const a=e=>{const t=i.variants[e];if(t)for(const e of t)e.mesh.material=e.material};if(t instanceof Array)for(const e of t)a(e);else a(t);i.lastSelected=t}constructor(e){this.name=NAME17,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME17)}static _GetExtensionMetadata(e){return e?._internalMetadata?.gltf?.[NAME17]||null}static Reset(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error(`Cannot reset on a glTF mesh that does not have the ${NAME17} extension`);for(const e of t.original)e.mesh.material=e.material;t.lastSelected=null}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._variants=t.variants}}selectVariant(t,i){e.SelectVariant(t,i)}_loadMeshPrimitiveAsync(t,i,a,n,s,r){return GLTFLoader2.LoadExtensionAsync(t,s,this.name,((o,l)=>{const c=new Array;return c.push(this._loader._loadMeshPrimitiveAsync(t,i,a,n,s,(i=>{if(r(i),i instanceof Mesh){const a=GLTFLoader2._GetDrawMode(t,s.mode),n=this._loader.rootBabylonMesh,r=n?n._internalMetadata=n._internalMetadata||{}:{},h=r.gltf=r.gltf||{},u=h[NAME17]=h[NAME17]||{lastSelected:null,original:[],variants:{}};u.original.push({mesh:i,material:i.material});for(let t=0;t<l.mappings.length;++t){const s=l.mappings[t],r=ArrayItem.Get(`${o}/mappings/${t}/material`,this._loader.gltf.materials,s.material);c.push(this._loader._loadMaterialAsync(`#/materials/${s.material}`,r,i,a,(t=>{for(let a=0;a<s.variants.length;++a){const r=s.variants[a],o=ArrayItem.Get(`/extensions/${NAME17}/variants/${r}`,this._variants,r);u.variants[o.name]=u.variants[o.name]||[],u.variants[o.name].push({mesh:i,material:t}),i.onClonedObservable.add((t=>{const a=t;let s=null,r=a;do{if(r=r.parent,!r)return;s=e._GetExtensionMetadata(r)}while(null===s);if(n&&s===e._GetExtensionMetadata(n)){r._internalMetadata={};for(const e in n._internalMetadata)r._internalMetadata[e]=n._internalMetadata[e];r._internalMetadata.gltf=[];for(const e in n._internalMetadata.gltf)r._internalMetadata.gltf[e]=n._internalMetadata.gltf[e];r._internalMetadata.gltf[NAME17]={lastSelected:null,original:[],variants:{}};for(const e of s.original)r._internalMetadata.gltf[NAME17].original.push({mesh:e.mesh,material:e.material});for(const e in s.variants)if(Object.prototype.hasOwnProperty.call(s.variants,e)){r._internalMetadata.gltf[NAME17].variants[e]=[];for(const t of s.variants[e])r._internalMetadata.gltf[NAME17].variants[e].push({mesh:t.mesh,material:t.material})}s=r._internalMetadata.gltf[NAME17]}for(const e of s.original)e.mesh===i&&(e.mesh=a);for(const e of s.variants[o.name])e.mesh===i&&(e.mesh=a)}))}})))}}}))),Promise.all(c).then((([e])=>e))}))}dispose(){this._loader=null}static GetAvailableVariants(e){const t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]}getAvailableVariants(t){return e.GetAvailableVariants(t)}getLastSelectedVariant(t){return e.GetLastSelectedVariant(t)}static GetLastSelectedVariant(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${NAME17} extension`);return t.lastSelected}};GLTFLoader2.RegisterExtension(NAME17,(e=>new KHR_materials_variants(e)));var TransmissionHelper=class e{getOpaqueTarget(){return this._opaqueRenderTarget}static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Constants.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}_addMesh(e){this._materialObservers[e.Hc]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(e)&&this._transparentMeshesCache.push(e)):-1===this._opaqueMeshesCache.indexOf(e)&&this._opaqueMeshesCache.push(e)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}_onMeshMaterialChanged(e){const t=this._transparentMeshesCache.indexOf(e),i=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof PBRMaterial&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==i?(this._opaqueMeshesCache.splice(i,1),this._transparentMeshesCache.push(e)):-1===t&&this._transparentMeshesCache.push(e)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):-1===i&&this._opaqueMeshesCache.push(e)}constructor(t,i){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...e._GetDefaultOptions(),...t},this._scene=i,this._scene._transmissionHelper=this,this.onErrorObservable=new Observable,this._scene.onDisposeObservable.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}_setupRenderTargets(){let e,t;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new RenderTargetTexture("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.cb=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=this._options.clearColor?.clone()??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((i=>{t=this._scene.environmentIntensity,this._scene.environmentIntensity=1,e=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?i.clearColor.copyFrom(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(i.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=t,this._scene.imageProcessingConfiguration._applyByPostProcess=e})),this._transparentMeshesCache.forEach((e=>{this._shouldRenderAsTransmission(e.material)&&(e.material.refractionTexture=this._opaqueRenderTarget)}))}_isRenderTargetValid(){return null!==this._opaqueRenderTarget?.getInternalTexture()}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}updateOptions(e){if(!Object.keys(e).filter((t=>this._options[t]!==e[t])).length)return;const t={...this._options,...e},i=this._options;this._options=t,t.renderSize===i.renderSize&&t.renderTargetTextureType===i.renderTargetTextureType&&t.generateMipmaps===i.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=t.samples,this._opaqueRenderTarget.lodGenerationScale=t.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=t.lodGenerationOffset):this._setupRenderTargets()}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.Hc]),delete this._materialObservers[e.Hc];let t=this._transparentMeshesCache.indexOf(e);-1!==t&&this._transparentMeshesCache.splice(t,1),t=this._opaqueMeshesCache.indexOf(e),-1!==t&&this._opaqueMeshesCache.splice(t,1)}_shouldRenderAsTransmission(e){return!!e&&!!(e instanceof PBRMaterial&&e.subSurface.isRefractionEnabled)}},NAME18="KHR_materials_transmission",KHR_materials_transmission=class{dispose(){this._loader=null}constructor(e){this.name=NAME18,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME18),this.enabled&&(e.parent.transparencyAsCoverage=!0)}_loadTransparentPropertiesAsync(e,t,i,a){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const n=i;if(n.subSurface.isRefractionEnabled=!0,n.subSurface.volumeIndexOfRefraction=1,n.subSurface.useAlbedoToTintRefraction=!0,void 0===a.transmissionFactor)return n.subSurface.refractionIntensity=0,n.subSurface.isRefractionEnabled=!1,Promise.resolve();{n.subSurface.refractionIntensity=a.transmissionFactor;const e=n.getScene();n.subSurface.refractionIntensity&&!e._transmissionHelper?new TransmissionHelper({},n.getScene()):n.subSurface.refractionIntensity&&!e._transmissionHelper?._isRenderTargetValid()&&e._transmissionHelper?._setupRenderTargets()}return n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=0,a.transmissionTexture?(a.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,a.transmissionTexture,void 0).then((e=>{n.subSurface.refractionIntensityTexture=e,n.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadTransparentPropertiesAsync(a,t,i,n)),Promise.all(s).then((()=>{}))}))}};GLTFLoader2.RegisterExtension(NAME18,(e=>new KHR_materials_transmission(e)));var NAME19="KHR_materials_diffuse_transmission",KHR_materials_diffuse_transmission=class{constructor(e){this.name=NAME19,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME19),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}_loadTranslucentPropertiesAsync(e,t,i,a){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);const n=i;if(n.subSurface.isTranslucencyEnabled=!0,n.subSurface.volumeIndexOfRefraction=1,n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=0,n.subSurface.useAlbedoToTintTranslucency=!1,void 0===a.diffuseTransmissionFactor)return n.subSurface.translucencyIntensity=0,n.subSurface.isTranslucencyEnabled=!1,Promise.resolve();n.subSurface.translucencyIntensity=a.diffuseTransmissionFactor;const s=new Array;return n.subSurface.useGltfStyleTextures=!0,a.diffuseTransmissionTexture&&(a.diffuseTransmissionTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionTexture`,a.diffuseTransmissionTexture).then((e=>{n.subSurface.translucencyIntensityTexture=e})))),void 0!==a.diffuseTransmissionColorFactor?n.subSurface.translucencyColor=Color3.FromArray(a.diffuseTransmissionColorFactor):n.subSurface.translucencyColor=Color3.White(),a.diffuseTransmissionColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionColorTexture`,a.diffuseTransmissionColorTexture).then((e=>{n.subSurface.translucencyColorTexture=e}))),Promise.all(s).then((()=>{}))}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadTranslucentPropertiesAsync(a,t,i,n)),Promise.all(s).then((()=>{}))}))}};GLTFLoader2.RegisterExtension(NAME19,(e=>new KHR_materials_diffuse_transmission(e)));var NAME20="KHR_materials_volume",KHR_materials_volume=class{_loadVolumePropertiesAsync(e,t,i,a){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);if(!i.subSurface.isRefractionEnabled&&!i.subSurface.isTranslucencyEnabled||!a.thicknessFactor)return Promise.resolve();i.subSurface.volumeIndexOfRefraction=i.indexOfRefraction;const n=void 0!==a.attenuationDistance?a.attenuationDistance:Number.MAX_VALUE;return i.subSurface.tintColorAtDistance=n,void 0!==a.attenuationColor&&3==a.attenuationColor.length&&i.subSurface.tintColor.copyFromFloats(a.attenuationColor[0],a.attenuationColor[1],a.attenuationColor[2]),i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=a.thicknessFactor,i.subSurface.useThicknessAsDepth=!0,a.thicknessTexture?(a.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,a.thicknessTexture).then((e=>{i.subSurface.thicknessTexture=e,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadVolumePropertiesAsync(a,t,i,n)),Promise.all(s).then((()=>{}))}))}constructor(e){this.name=NAME20,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME20),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}};GLTFLoader2.RegisterExtension(NAME20,(e=>new KHR_materials_volume(e)));var NAME21="KHR_materials_dispersion",KHR_materials_dispersion=class{loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadDispersionPropertiesAsync(a,t,i,n)),Promise.all(s).then((()=>{}))}))}dispose(){this._loader=null}_loadDispersionPropertiesAsync(e,t,i,a){if(!(i instanceof PBRMaterial))throw new Error(`${e}: Material type not supported`);return i.subSurface.isRefractionEnabled&&a.dispersion?(i.subSurface.isDispersionEnabled=!0,i.subSurface.dispersion=a.dispersion,Promise.resolve()):Promise.resolve()}constructor(e){this.name=NAME21,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME21)}};GLTFLoader2.RegisterExtension(NAME21,(e=>new KHR_materials_dispersion(e)));var NAME22="KHR_mesh_quantization",KHR_mesh_quantization=class{constructor(e){this.name=NAME22,this.enabled=e.isExtensionUsed(NAME22)}dispose(){}};GLTFLoader2.RegisterExtension(NAME22,(e=>new KHR_mesh_quantization(e)));var NAME23="KHR_texture_basisu",KHR_texture_basisu=class{constructor(e){this.name=NAME23,this._loader=e,this.enabled=e.isExtensionUsed(NAME23)}dispose(){this._loader=null}_loadTextureAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>{const s=null==t.sampler?GLTFLoader2.DefaultSampler:ArrayItem.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),r=ArrayItem.Get(`${a}/source`,this._loader.gltf.images,n.source);return this._loader._createTextureAsync(e,s,r,(e=>{i(e)}),t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)}))}};GLTFLoader2.RegisterExtension(NAME23,(e=>new KHR_texture_basisu(e)));var NAME24="KHR_texture_transform",KHR_texture_transform=class{loadTextureInfoAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((a,n)=>this._loader.loadTextureInfoAsync(e,t,(e=>{if(!(e instanceof Texture))throw new Error(`${a}: Texture type not supported`);n.offset&&(e.uOffset=n.offset[0],e.vOffset=n.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,n.rotation&&(e.wAng=-n.rotation),n.scale&&(e.uScale=n.scale[0],e.vScale=n.scale[1]),null!=n.texCoord&&(e.coordinatesIndex=n.texCoord),i(e)}))))}constructor(e){this.name=NAME24,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME24)}dispose(){this._loader=null}};GLTFLoader2.RegisterExtension(NAME24,(e=>new KHR_texture_transform(e)));var NAME25="KHR_xmp_json_ld",KHR_xmp_json_ld=class{dispose(){this._loader=null}onLoading(){if(null===this._loader.rootBabylonMesh)return;const e=this._loader.gltf.extensions?.KHR_xmp_json_ld,t=this._loader.gltf.asset?.extensions?.KHR_xmp_json_ld;if(e&&t){const i=+t.packet;e.packets&&i<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[i])}}constructor(e){this.name=NAME25,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME25)}};function getColor3(e,t,i,a){return Color3.FromArray(t,i).scale(a)}function getAlpha(e,t,i,a){return t[i+3]*a}function getFloat(e,t,i,a){return t[i]*a}function getMinusFloat(e,t,i,a){return-t[i]*a}function getNextFloat(e,t,i,a){return t[i+1]*a}function getFloatBy2(e,t,i,a){return t[i]*a*2}function getTextureTransformTree(e){return{scale:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,`${e}.uScale`,getFloat,(()=>2)),new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,`${e}.vScale`,getNextFloat,(()=>2))],offset:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,`${e}.uOffset`,getFloat,(()=>2)),new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,`${e}.vOffset`,getNextFloat,(()=>2))],rotation:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,`${e}.wAng`,getMinusFloat,(()=>1))]}}GLTFLoader2.RegisterExtension(NAME25,(e=>new KHR_xmp_json_ld(e)));var CameraAnimationPropertyInfo=class extends AnimationPropertyInfo{buildAnimations(e,t,i,a,n){n(e._babylonCamera,this._buildAnimation(t,i,a))}},MaterialAnimationPropertyInfo=class extends AnimationPropertyInfo{buildAnimations(e,t,i,a,n){for(const s in e._data)n(e._data[s].babylonMaterial,this._buildAnimation(t,i,a))}},LightAnimationPropertyInfo=class extends AnimationPropertyInfo{buildAnimations(e,t,i,a,n){n(e._babylonLight,this._buildAnimation(t,i,a))}},nodesTree={__array__:{__target__:!0,...nodeAnimationData}},camerasTree={__array__:{__target__:!0,orthographic:{xmag:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"orthoLeft",getMinusFloat,(()=>1)),new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"orthoRight",getNextFloat,(()=>1))],ymag:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"orthoBottom",getMinusFloat,(()=>1)),new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"orthoTop",getNextFloat,(()=>1))],zfar:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"maxZ",getFloat,(()=>1))],znear:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"minZ",getFloat,(()=>1))]},perspective:{yfov:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"fov",getFloat,(()=>1))],zfar:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"maxZ",getFloat,(()=>1))],znear:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"minZ",getFloat,(()=>1))]}}},materialsTree={__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"albedoColor",getColor3,(()=>4)),new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"alpha",getAlpha,(()=>4))],metallicFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"metallic",getFloat,(()=>1))],roughnessFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"roughness",getFloat,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("metallicTexture")}}},emissiveFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"emissiveColor",getColor3,(()=>3))],normalTexture:{scale:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"bumpTexture.level",getFloat,(()=>1))],extensions:{KHR_texture_transform:getTextureTransformTree("bumpTexture")}},occlusionTexture:{strength:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",getFloat,(()=>1))],extensions:{KHR_texture_transform:getTextureTransformTree("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",getFloat,(()=>1))],anisotropyRotation:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"anisotropy.angle",getFloat,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",getFloat,(()=>1))],clearcoatRoughnessFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",getFloat,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",getFloat,(()=>1))],extensions:{KHR_texture_transform:getTextureTransformTree("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",getFloat,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"emissiveIntensity",getFloat,(()=>1))]},KHR_materials_ior:{ior:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"indexOfRefraction",getFloat,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"iridescence.intensity",getFloat,(()=>1))],iridescenceIor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",getFloat,(()=>1))],iridescenceThicknessMinimum:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",getFloat,(()=>1))],iridescenceThicknessMaximum:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",getFloat,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"sheen.color",getColor3,(()=>3))],sheenRoughnessFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"sheen.roughness",getFloat,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"metallicF0Factor",getFloat,(()=>1))],specularColorFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",getColor3,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",getFloat,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",getColor3,(()=>3))],attenuationDistance:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",getFloat,(()=>1))],thicknessFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",getFloat,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",getFloat,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",getColor3,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("subSurface.translucencyColorTexture")}}}}}},extensionsTree={KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"diffuse",getColor3,(()=>3))],intensity:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"intensity",getFloat,(()=>1))],range:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"range",getFloat,(()=>1))],spot:{innerConeAngle:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"innerAngle",getFloatBy2,(()=>1))],outerConeAngle:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"angle",getFloatBy2,(()=>1))]}}}}},animationPointerTree={nodes:nodesTree,materials:materialsTree,cameras:camerasTree,extensions:extensionsTree},GLTFPathToObjectConverter=class{constructor(e,t){this._gltf=e,this._infoTree=t}convert(e){let t,i=this._gltf,a=this._infoTree;if(!e.startsWith("/"))throw new Error("Path must start with a /");const n=e.split("/");n.shift();for(const s of n){if(a.__array__)a=a.__array__;else if(a=a[s],!a)throw new Error(`Path ${e} is invalid`);if(void 0===i)throw new Error(`Path ${e} is invalid`);i=i[s],a.__target__&&(t=i)}return{object:t,info:a}}},NAME26="KHR_animation_pointer",AnimationPointerPathToObjectConverter=class extends GLTFPathToObjectConverter{constructor(e){super(e,animationPointerTree)}},KHR_animation_pointer=class{dispose(){this._loader=null,delete this._pathToObjectConverter}get enabled(){return this._loader.isExtensionUsed(NAME26)}_loadAnimationChannelAsync(e,t,i,a,n){const s=a.target.extensions?.KHR_animation_pointer;if(!s||!this._pathToObjectConverter)return null;"pointer"!==a.target.path&&Logger.Warn(`${e}/target/path: Value (${a.target.path}) must be (pointer) when using the ${this.name} extension`),null!=a.target.node&&Logger.Warn(`${e}/target/node: Value (${a.target.node}) must not be present when using the ${this.name} extension`);const r=`${e}/extensions/${this.name}`,o=s.pointer;if(!o)throw new Error(`${r}: Pointer is missing`);try{const s=this._pathToObjectConverter.convert(o);return this._loader._loadAnimationChannelFromTargetInfoAsync(e,t,i,a,s,n)}catch(e){return Logger.Warn(`${r}/pointer: Invalid pointer (${o}) skipped`),null}}constructor(e){this.name=NAME26,this._loader=e,this._pathToObjectConverter=new AnimationPointerPathToObjectConverter(this._loader.gltf)}};GLTFLoader2.RegisterExtension(NAME26,(e=>new KHR_animation_pointer(e)));var Sound=class e{getSoundGain(){return this._soundGain}set directionalConeInnerAngle(e){if(e!=this._coneInnerAngle){if(this._coneOuterAngle<e)return void Logger.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e,Engine.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}_clearTimeoutsAndObservers(){this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver&&(Engine.audioEngine?.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}_audioBufferLoaded(e){Engine.audioEngine?.audioContext&&(this._audioBuffer=e,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}setDirectionalCone(e,t,i){t<e?Logger.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=e,this._coneOuterAngle=t,this._coneOuterGain=i,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}stop(e){if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(Engine.audioEngine?.audioContext&&this._soundSource){const t=e?Engine.audioEngine.audioContext.currentTime+e:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(t)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}clone(){if(this._streaming)return null;{const t=()=>{this._isReadyToPlay?(a._audioBuffer=this.getAudioBuffer(),a._isReadyToPlay=!0,a.autoplay&&a.play(0,this._offset,this._length)):setTimeout(t,300)},i={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},a=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,i);return this.useCustomAttenuation&&a.setAttenuationFunction(this._customAttenuationFunction),a.setPosition(this._position),a.setPlaybackRate(this._playbackRate),t(),a}}get loop(){return this._loop}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}updateDistanceFromListener(){if(Engine.audioEngine?.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const e=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.subtract(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,e,this.maxDistance,this.refDistance,this.rolloffFactor)}}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}getSoundSource(){return this._soundSource}isReady(){return this._isReadyToPlay}attachToMesh(e){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=e,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=e=>this._onRegisterAfterWorldMatrixUpdate(e),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}getPlaybackRate(){return this._playbackRate}setPlaybackRate(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}setAudioBuffer(e){Engine.audioEngine?.canUseWebAudio&&(this._audioBuffer=e,this._isReadyToPlay=!0)}get currentTime(){if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(Engine.audioEngine?.audioContext&&(this.isPlaying||this.isPaused)){const e=this.isPaused?0:Engine.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+e}return 0}getClassName(){return"Sound"}constructor(t,i,a,n=null,s){if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Observable,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=Vector3.Zero(),this._localDirection=new Vector3(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,a=a||EngineStore.LastCreatedScene)if(this._scene=a,e._SceneComponentInitialization(a),this._readyToPlayCallback=n,this._customAttenuationFunction=(e,t,i,a,n)=>t<i?e*(1-t/i):0,s&&(this.autoplay=s.autoplay||!1,this._loop=s.loop||!1,void 0!==s.volume&&(this._volume=s.volume),this._spatialSound=s.spatialSound??!1,this.maxDistance=s.maxDistance??100,this.useCustomAttenuation=s.useCustomAttenuation??!1,this.rolloffFactor=s.rolloffFactor||1,this.refDistance=s.refDistance||1,this.distanceModel=s.distanceModel||"linear",this._playbackRate=s.playbackRate||1,this._streaming=s.streaming??!1,this._length=s.length,this._offset=s.offset),Engine.audioEngine?.canUseWebAudio&&Engine.audioEngine.audioContext){this._soundGain=Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let e=!0;if(i)try{"string"==typeof i?(this._urlType="String",this._url=i):i instanceof ArrayBuffer?this._urlType="ArrayBuffer":i instanceof HTMLMediaElement?this._urlType="MediaElement":i instanceof MediaStream?this._urlType="MediaStream":i instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(i)&&(this._urlType="Array");let t=[],a=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Engine.audioEngine.audioContext.createMediaElementSource(i),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Engine.audioEngine.audioContext.createMediaStreamSource(i),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":i.byteLength>0&&(a=!0,this._soundLoaded(i));break;case"AudioBuffer":this._audioBufferLoaded(i);break;case"String":t.push(i);case"Array":0===t.length&&(t=i);for(let e=0;e<t.length;e++){const i=t[e];if(a=s&&s.skipCodecCheck||-1!==i.indexOf(".mp3",i.length-4)&&Engine.audioEngine.isMP3supported||-1!==i.indexOf(".ogg",i.length-4)&&Engine.audioEngine.isOGGsupported||-1!==i.indexOf(".wav",i.length-4)||-1!==i.indexOf(".m4a",i.length-4)||-1!==i.indexOf(".mp4",i.length-4)||-1!==i.indexOf("blob:"),a){this._streaming?(this._htmlAudioElement=new Audio(i),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Tools.SetCorsBehavior(i,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()})),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(i,(e=>{this._soundLoaded(e)}),void 0,!0,!0,(e=>{e&&Logger.Error("XHR "+e.status+" error on: "+i+"."),Logger.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:e=!1}e?a||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Logger.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(e){Logger.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Engine.audioEngine&&!Engine.audioEngine.WarnedWebAudioUnsupported&&(Logger.Error("Web Audio is not supported by your browser."),Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}_onRegisterAfterWorldMatrixUpdate(e){if(e.getBoundingInfo){const t=e.getBoundingInfo();this.setPosition(t.boundingSphere.centerWorld)}else this.setPosition(e.absolutePosition);Engine.audioEngine?.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}set directionalConeOuterAngle(e){if(e!=this._coneOuterAngle){if(e<this._coneInnerAngle)return void Logger.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e,Engine.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}getVolume(){return this._volume}_switchPanningModel(){Engine.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}serialize(){const e={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(e.connectedMeshId=this._connectedTransformNode.id),e.position=this._position.asArray(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.asArray(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e}getAudioBuffer(){return this._audioBuffer}get directionalConeOuterAngle(){return this._coneOuterAngle}get directionalConeInnerAngle(){return this._coneInnerAngle}pause(){this.isPlaying&&(this._clearTimeoutsAndObservers(),this._streaming?(this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect(),this.isPlaying=!1,this.isPaused=!0):Engine.audioEngine?.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Engine.audioEngine.audioContext.currentTime-this._startTime))}_disableSpatialSound(){this._spatialSound&&(this._inputAudioNode=this._soundGain,this._soundPanner?.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_soundLoaded(e){Engine.audioEngine?.audioContext&&Engine.audioEngine.audioContext.decodeAudioData(e,(e=>{this._audioBufferLoaded(e)}),(e=>{Logger.Error("Error while decoding audio data for: "+this.name+" / Error: "+e)}))}setAttenuationFunction(e){this._customAttenuationFunction=e}_setOffset(e){this._offset!==e&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=e)}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}_createSpatialParameters(){Engine.audioEngine?.canUseWebAudio&&Engine.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Engine.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}dispose(){Engine.audioEngine?.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}connectToSoundTrackAudioNode(e){Engine.audioEngine?.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(e),this._isOutputConnected=!0)}updateOptions(e){e&&(this.loop=e.loop??this.loop,this.maxDistance=e.maxDistance??this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor??this.rolloffFactor,this.refDistance=e.refDistance??this.refDistance,this.distanceModel=e.distanceModel??this.distanceModel,this._playbackRate=e.playbackRate??this._playbackRate,this._length=e.length??void 0,this.spatialSound=e.spatialSound??this._spatialSound,this._setOffset(e.offset??void 0),this.setVolume(e.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}set spatialSound(e){if(e==this._spatialSound)return;const t=this.isPlaying;this.pause(),e?(this._spatialSound=e,this._updateSpatialParameters()):this._disableSpatialSound(),t&&this.play()}setLocalDirectionToMesh(e){this._localDirection=e,Engine.audioEngine?.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}set loop(e){e!==this._loop&&(this._loop=e,this.updateOptions({loop:e}))}static Parse(t,i,a,n){const s=t.name;let r;r=t.url?a+t.url:a+s;const o={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};let l;if(n){const t=()=>{n._isReadyToPlay?(l._audioBuffer=n.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,l._offset,l._length)):setTimeout(t,300)};l=new e(s,new ArrayBuffer(0),i,null,o),t()}else l=new e(s,r,i,(()=>{i.removePendingData(l)}),o),i.addPendingData(l);if(t.position){const e=Vector3.FromArray(t.position);l.setPosition(e)}if(t.isDirectional&&(l.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){const e=Vector3.FromArray(t.localDirectionToMesh);l.setLocalDirectionToMesh(e)}if(t.connectedMeshId){const e=i.getMeshById(t.connectedMeshId);e&&l.attachToMesh(e)}return t.metadata&&(l.metadata=t.metadata),l}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}setPosition(e){e.equals(this._position)||(this._position.copyFrom(e),Engine.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const e=this._connectedTransformNode.getWorldMatrix(),t=Vector3.TransformNormal(this._localDirection,e);t.normalize(),this._soundPanner.orientationX.value=t.x,this._soundPanner.orientationY.value=t.y,this._soundPanner.orientationZ.value=t.z}get spatialSound(){return this._spatialSound}setVolume(e,t){Engine.audioEngine?.canUseWebAudio&&this._soundGain&&(t&&Engine.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(e,Engine.audioEngine.audioContext.currentTime+t)):this._soundGain.gain.value=e),this._volume=e}play(e,t,i){if(this._isReadyToPlay&&this._scene.audioEnabled&&Engine.audioEngine?.audioContext)try{this._clearTimeoutsAndObservers();let a=e?Engine.audioEngine?.audioContext.currentTime+e:Engine.audioEngine?.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){const e=()=>{if(Engine.audioEngine?.unlocked){const t=this._htmlAudioElement.play();void 0!==t&&t.catch((()=>{Engine.audioEngine?.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Engine.audioEngine?.onAudioUnlockedObservable.addOnce((()=>{e()})))}))}else(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Engine.audioEngine?.onAudioUnlockedObservable.addOnce((()=>{e()})))};e()}}else{const n=()=>{if(Engine.audioEngine?.audioContext){if(i=i||this._length,void 0!==t&&this._setOffset(t),this._soundSource){const e=this._soundSource;e.onended=()=>{e.disconnect()}}if(this._soundSource=Engine.audioEngine?.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==t&&(this._soundSource.loopStart=t),void 0!==i&&(this._soundSource.loopEnd=(0|t)+i),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},a=e?Engine.audioEngine?.audioContext.currentTime+e:Engine.audioEngine.audioContext.currentTime;const n=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(a,n,this.loop?void 0:i)}}};"suspended"===Engine.audioEngine?.audioContext.state?this._tryToPlayTimeout=setTimeout((()=>{"suspended"===Engine.audioEngine?.audioContext.state?(Engine.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Engine.audioEngine.onAudioUnlockedObservable.addOnce((()=>{n()})))):n()}),500):n()}this._startTime=a,this.isPlaying=!0,this.isPaused=!1}catch(e){Logger.Error("Error while trying to play audio: "+this.name+", "+e.message)}}};Sound._SceneComponentInitialization=e=>{throw _WarnImport("AudioSceneComponent")},RegisterClass("BABYLON.Sound",Sound);var WeightedSound=class{set directionalConeOuterAngle(e){if(e!==this._coneOuterAngle){if(e<this._coneInnerAngle)return void Logger.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e;for(const t of this._sounds)t.directionalConeOuterAngle=e}}pause(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeInnerAngle(e){if(e!==this._coneInnerAngle){if(this._coneOuterAngle<e)return void Logger.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e;for(const t of this._sounds)t.directionalConeInnerAngle=e}}get directionalConeInnerAngle(){return this._coneInnerAngle}play(e){if(!this.isPaused){this.stop();const e=Math.random();let t=0;for(let i=0;i<this._weights.length;i++)if(t+=this._weights[i],e<=t){this._currentIndex=i;break}}const t=this._sounds[this._currentIndex];t.isReady()?t.play(0,this.isPaused?void 0:e):t.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}constructor(e,t,i){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==i.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=i;let a=0;for(const e of i)a+=e;const n=a>0?1/a:0;for(let e=0;e<this._weights.length;e++)this._weights[e]*=n;this._sounds=t;for(const e of this._sounds)e.onEndedObservable.add((()=>{this._onended()}))}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}get volume(){return this._volume}set volume(e){if(e!==this._volume)for(const t of this._sounds)t.setVolume(e)}},NAME27="MSFT_audio_emitter",MSFT_audio_emitter=class{_loadAnimationEventAsync(e,t,i,a,n){if(0==n.targetedAnimations.length)return Promise.resolve();const s=n.targetedAnimations[0],r=a.emitter,o=ArrayItem.Get(`/extensions/${this.name}/emitters`,this._emitters,r);return this._loadEmitterAsync(e,o).then((()=>{const t=o._babylonData.sound;if(t){const i=new AnimationEvent(a.time,this._getEventAction(e,t,a.action,a.time,a.startOffset));s.animation.addEvent(i),n.onAnimationGroupEndObservable.add((()=>{t.stop()})),n.onAnimationGroupPauseObservable.add((()=>{t.pause()}))}}))}loadAnimationAsync(e,t){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((i,a)=>this._loader.loadAnimationAsync(e,t).then((n=>{const s=new Array;ArrayItem.Assign(a.events);for(const r of a.events)s.push(this._loadAnimationEventAsync(`${i}/events/${r.index}`,e,t,r,n));return Promise.all(s).then((()=>n))}))))}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,ArrayItem.Assign(this._clips),ArrayItem.Assign(this._emitters)}}dispose(){this._loader=null,this._clips=null,this._emitters=null}_getEventAction(e,t,i,a,n){switch(i){case"play":return e=>{const i=(n||0)+(e-a);t.play(i)};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw new Error(`${e}: Unsupported action ${i}`)}}_loadEmitterAsync(e,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){const e=new Array,i=t.name||`emitter${t.index}`,a={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume};for(let n=0;n<t.clips.length;n++){const s=`/extensions/${this.name}/clips`,r=ArrayItem.Get(s,this._clips,t.clips[n].clip);e.push(this._loadClipAsync(`${s}/${t.clips[n].clip}`,r).then((e=>{const s=t._babylonSounds[n]=new Sound(i,e,this._loader.babylonScene,null,a);s.refDistance=t.refDistance||1,s.maxDistance=t.maxDistance||256,s.rolloffFactor=t.rolloffFactor||1,s.distanceModel=t.distanceModel||"exponential"})))}const n=Promise.all(e).then((()=>{const e=t.clips.map((e=>e.weight||1)),i=new WeightedSound(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(i.directionalConeInnerAngle=2*Tools.ToDegrees(t.innerAngle)),t.outerAngle&&(i.directionalConeOuterAngle=2*Tools.ToDegrees(t.outerAngle)),t.volume&&(i.volume=t.volume),t._babylonData.sound=i}));t._babylonData={loaded:n}}return t._babylonData.loaded}loadNodeAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((e,a)=>{const n=new Array;return this._loader.loadNodeAsync(e,t,(t=>{for(const i of a.emitters){const a=ArrayItem.Get(`${e}/emitters`,this._emitters,i);n.push(this._loadEmitterAsync(`${e}/emitters/${a.index}`,a).then((()=>{for(const e of a._babylonSounds)e.attachToMesh(t),null==a.innerAngle&&null==a.outerAngle||(e.setLocalDirectionToMesh(Vector3.Forward()),e.setDirectionalCone(2*Tools.ToDegrees(null==a.innerAngle?Math.PI:a.innerAngle),2*Tools.ToDegrees(null==a.outerAngle?Math.PI:a.outerAngle),0))})))}i(t)})).then((e=>Promise.all(n).then((()=>e))))}))}_loadClipAsync(e,t){if(t._objectURL)return t._objectURL;let i;if(t.uri)i=this._loader.loadUriAsync(e,t,t.uri);else{const a=ArrayItem.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,t.bufferView);i=this._loader.loadBufferViewAsync(`/bufferViews/${a.index}`,a)}return t._objectURL=i.then((e=>URL.createObjectURL(new Blob([e],{type:t.mimeType})))),t._objectURL}loadSceneAsync(e,t){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((i,a)=>{const n=new Array;n.push(this._loader.loadSceneAsync(e,t));for(const e of a.emitters){const t=ArrayItem.Get(`${i}/emitters`,this._emitters,e);if(null!=t.refDistance||null!=t.maxDistance||null!=t.rolloffFactor||null!=t.distanceModel||null!=t.innerAngle||null!=t.outerAngle)throw new Error(`${i}: Direction or Distance properties are not allowed on emitters attached to a scene`);n.push(this._loadEmitterAsync(`${i}/emitters/${t.index}`,t))}return Promise.all(n).then((()=>{}))}))}constructor(e){this.name=NAME27,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME27)}};GLTFLoader2.RegisterExtension(NAME27,(e=>new MSFT_audio_emitter(e)));var NAME28="MSFT_lod",MSFT_lod=class{constructor(e){this.name=NAME28,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Observable,this.onMaterialLODsLoadedObservable=new Observable,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.maxLODsToLoad=this._loader.parent.extensionOptions[NAME28]?.maxLODsToLoad??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(NAME28)}_loadBufferLOD(e,t){const i=e[t];i&&(this._loader.log(`Loading buffer range [${i.start}-${i.end}]`),this._loader.bin.readAsync(i.start,i.end-i.start+1).then((e=>{i.loaded.resolve(e)}),(e=>{i.loaded.reject(e)})))}loadNodeAsync(e,t,i){return GLTFLoader2.LoadExtensionAsync(e,t,this.name,((e,a)=>{let n;const s=this._getLODs(e,t,this._loader.gltf.nodes,a.ids);this._loader.logOpen(`${e}`);for(let e=0;e<s.length;e++){const t=s[e];0!==e&&(this._nodeIndexLOD=e,this._nodeSignalLODs[e]=this._nodeSignalLODs[e]||new Deferred);const a=e=>{i(e),e.setEnabled(!1)},r=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,a).then((t=>{if(0!==e){const t=s[e-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.setEnabled(!0),t}));this._nodePromiseLODs[e]=this._nodePromiseLODs[e]||[],0===e?n=r:(this._nodeIndexLOD=null,this._nodePromiseLODs[e].push(r))}return this._loader.logClose(),n}))}loadBufferAsync(e,t,i,a){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);const t=(e,t)=>{const n=i,s=n+a-1;let r=e[t];return r?(r.start=Math.min(r.start,n),r.end=Math.max(r.end,s)):(r={start:n,end:s,loaded:new Deferred},e[t]=r),r.loaded.promise.then((e=>new Uint8Array(e.buffer,e.byteOffset+i-r.start,a)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){const t=Promise.all(this._nodePromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())}));this._loader._completePromises.push(t)}for(let e=0;e<this._materialPromiseLODs.length;e++){const t=Promise.all(this._materialPromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())}));this._loader._completePromises.push(t)}}_getLODs(e,t,i,a){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const n=[];for(let t=a.length-1;t>=0;t--)if(n.push(ArrayItem.Get(`${e}/ids/${a[t]}`,i,a[t])),n.length===this.maxLODsToLoad)return n;return n.push(t),n}_loadUriAsync(e,t,i){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const a=this._nodeIndexLOD-1;return this._nodeSignalLODs[a]=this._nodeSignalLODs[a]||new Deferred,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(e,t,i)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const a=this._materialIndexLOD-1;return this._materialSignalLODs[a]=this._materialSignalLODs[a]||new Deferred,this._materialSignalLODs[a].promise.then((()=>this._loader.loadUriAsync(e,t,i)))}return null}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}_disposeMaterials(e){const t={};for(const i of e){for(const e of i.getActiveTextures())t[e.Hc]=e;i.dispose()}for(const e in t)for(const i of this._loader.babylonScene.materials)i.hasTexture(t[e])&&delete t[e];for(const e in t)t[e].dispose()}_disposeTransformNode(e){const t=[],i=e.material;i&&t.push(i);for(const i of e.getChildMeshes())i.material&&t.push(i.material);e.dispose();const a=t.filter((e=>this._loader.babylonScene.meshes.every((t=>t.material!=e))));this._disposeMaterials(a)}loadSceneAsync(e,t){const i=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),i}_loadMaterialAsync(e,t,i,a,n){return this._nodeIndexLOD?null:GLTFLoader2.LoadExtensionAsync(e,t,this.name,((e,s)=>{let r;const o=this._getLODs(e,t,this._loader.gltf.materials,s.ids);this._loader.logOpen(`${e}`);for(let e=0;e<o.length;e++){const t=o[e];0!==e&&(this._materialIndexLOD=e);const s=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,i,a,(t=>{0===e&&n(t)})).then((t=>{if(0!==e){n(t);const i=o[e-1]._data;i[a]&&(this._disposeMaterials([i[a].babylonMaterial]),delete i[a])}return t}));this._materialPromiseLODs[e]=this._materialPromiseLODs[e]||[],0===e?r=s:(this._materialIndexLOD=null,this._materialPromiseLODs[e].push(s))}return this._loader.logClose(),r}))}};GLTFLoader2.RegisterExtension(NAME28,(e=>new MSFT_lod(e)));var NAME29="MSFT_minecraftMesh",MSFT_minecraftMesh=class{loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtraAsync(e,t,this.name,((a,n)=>{if(n){if(!(i instanceof PBRMaterial))throw new Error(`${a}: Material type not supported`);const n=this._loader.loadMaterialPropertiesAsync(e,t,i);return i.needAlphaBlending()&&(i.forceDepthWrite=!0,i.separateCullingPass=!0),i.backFaceCulling=i.forceDepthWrite,i.twoSidedLighting=!0,n}return null}))}dispose(){this._loader=null}constructor(e){this.name=NAME29,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME29)}};GLTFLoader2.RegisterExtension(NAME29,(e=>new MSFT_minecraftMesh(e)));var NAME30="MSFT_sRGBFactors",MSFT_sRGBFactors=class{dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return GLTFLoader2.LoadExtraAsync(e,t,this.name,((a,n)=>{if(n){if(!(i instanceof PBRMaterial))throw new Error(`${a}: Material type not supported`);const n=this._loader.loadMaterialPropertiesAsync(e,t,i),s=i.getScene().getEngine().useExactSrgbConversions;return i.albedoTexture||i.albedoColor.toLinearSpaceToRef(i.albedoColor,s),i.reflectivityTexture||i.reflectivityColor.toLinearSpaceToRef(i.reflectivityColor,s),n}return null}))}constructor(e){this.name=NAME30,this._loader=e,this.enabled=this._loader.isExtensionUsed(NAME30)}},FlowGraphConnectionType,FlowGraphConnectionType2;GLTFLoader2.RegisterExtension(NAME30,(e=>new MSFT_sRGBFactors(e))),FlowGraphConnectionType2=FlowGraphConnectionType||(FlowGraphConnectionType={}),FlowGraphConnectionType2[FlowGraphConnectionType2.Input=0]="Input",FlowGraphConnectionType2[FlowGraphConnectionType2.Output=1]="Output";var FlowGraphConnection=class{static Parse(e={},t){const i=new(Tools.Instantiate(e.className))(e.name,e._connectionType,t);return i.deserialize(e),i}getClassName(){return"FGConnection"}isConnected(){return this._connectedPoint.length>0}connectTo(e){if(this._connectionType===e._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||e._isSingularConnection()&&e._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(e),e._connectedPoint.push(this)}serialize(e={}){e.Hc=this.Hc,e.name=this.name,e._connectionType=this._connectionType,e.connectedPointIds=[],e.className=this.getClassName();for(const t of this._connectedPoint)e.connectedPointIds.push(t.Hc)}deserialize(e){this.Hc=e.Hc,this.name=e.name,this._connectionType=e._connectionType,this.connectedPointIds=e.connectedPointIds}get connectionType(){return this._connectionType}constructor(e,t,i){this._ownerBlock=i,this._connectedPoint=[],this.Hc=RandomGUID(),this.connectedPointIds=[],this.name=e,this._connectionType=t}_isSingularConnection(){return!0}},FlowGraphInteger=class e{getClassName(){return e.ClassName}equals(e){return this.value===e.value}multiply(t){return new e(Math.imul(this.value,t.value))}divide(t){return new e(this.value/t.value)}constructor(e){this.value=this._toInt(e)}add(t){return new e(this.value+t.value)}subtract(t){return new e(this.value-t.value)}static Parse(t){return new e(t.value)}_toInt(e){return 0|e}};FlowGraphInteger.ClassName="FlowGraphInteger",RegisterClass("FlowGraphInteger",FlowGraphInteger);var RichType=class e{serialize(e){e.typeName=this.typeName,e.defaultValue=this.defaultValue}constructor(e,t){this.typeName=e,this.defaultValue=t}static Parse(t){return new e(t.typeName,t.defaultValue)}},RichTypeAny=new RichType("any",void 0),RichTypeString=new RichType("string",""),RichTypeNumber=new RichType("number",0),RichTypeBoolean=new RichType("boolean",!1),RichTypeVector2=new RichType("Vector2",Vector2.Zero()),RichTypeVector3=new RichType("Vector3",Vector3.Zero()),RichTypeVector4=new RichType("Vector4",Vector4.Zero()),RichTypeMatrix=new RichType("Matrix",Matrix.Identity()),RichTypeColor3=new RichType("Color3",Color3.Black()),RichTypeColor4=new RichType("Color4",new Color4(0,0,0,0)),RichTypeQuaternion=new RichType("Quaternion",Quaternion.Identity()),RichTypeFlowGraphInteger=new RichType("FlowGraphInteger",new FlowGraphInteger(0)),FlowGraphDataConnection=class extends FlowGraphConnection{_getValueOrDefault(e){return e._hasConnectionValue(this)?e._getConnectionValue(this):this.richType.defaultValue}serialize(e={}){super.serialize(e),e.richType={},this.richType.serialize(e.richType)}connectTo(e){super.connectTo(e)}constructor(e,t,i,a){super(e,t,i),this.richType=a}static Parse(e,t){const i=FlowGraphConnection.Parse(e,t);return i.richType=RichType.Parse(e.richType),i}getValue(e){return 1===this.connectionType?(e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(e),this._getValueOrDefault(e)):this.isConnected()?this._connectedPoint[0].getValue(e):this._getValueOrDefault(e)}setValue(e,t){t._setConnectionValue(this,e)}getClassName(){return"FGDataConnection"}_isSingularConnection(){return 0===this.connectionType}};function isMeshClassName(e){return"Mesh"===e||"AbstractMesh"===e||"GroundMesh"===e||"InstanceMesh"===e||"LinesMesh"===e||"GoldbergMesh"===e||"GreasedLineMesh"===e||"TrailMesh"===e}function isVectorClassName(e){return"Vector2"===e||"Vector3"===e||"Vector4"===e||"Quaternion"===e||"Color3"===e||"Color4"===e}function parseVector(e,t){if("Vector2"===e)return Vector2.FromArray(t);if("Vector3"===e)return Vector3.FromArray(t);if("Vector4"===e)return Vector4.FromArray(t);if("Quaternion"===e)return Quaternion.FromArray(t);if("Color3"===e)return new Color3(t[0],t[1],t[2]);if("Color4"===e)return new Color4(t[0],t[1],t[2],t[3]);throw new Error(`Unknown vector class name ${e}`)}function defaultValueSerializationFunction(e,t,i){const a=t?.getClassName?.()??"";isMeshClassName(a)?i[e]={name:t.name,className:a}:isVectorClassName(a)?i[e]={value:t.asArray(),className:a}:i[e]=t}function defaultValueParseFunction(e,t,i){const a=t[e];let n;const s=a?.className;return n=isMeshClassName(s)?i.getMeshByName(a.name):isVectorClassName(s)?parseVector(s,a.value):"Matrix"===s?Matrix.FromArray(a.value):s===FlowGraphInteger.ClassName?FlowGraphInteger.Parse(a):a&&void 0!==a.value?a.value:a,n}function needsPathConverter(e){return"FGSetPropertyBlock"===e||"FGGetPropertyBlock"===e||"FGPlayAnimationBlock"===e||"FGMeshPickEventBlock"===e}RegisterClass("FGDataConnection",FlowGraphDataConnection);var FlowGraphBlock=class{getClassName(){return"FGBlock"}static Parse(e,t){const i=Tools.Instantiate(e.className),a={},n=t.valueParseFunction??defaultValueParseFunction;if(e.config)for(const i in e.config)a[i]=n(i,e.config,t.scene);needsPathConverter(e.className)&&(a.pathConverter=t.pathConverter);const s=new i(a);s.Hc=e.Hc;for(let t=0;t<e.dataInputs.length;t++){const i=s.getDataInput(e.dataInputs[t].name);if(!i)throw new Error("Could not find data input with name "+e.dataInputs[t].name+" in block "+e.className);i.deserialize(e.dataInputs[t])}for(let t=0;t<e.dataOutputs.length;t++){const i=s.getDataOutput(e.dataOutputs[t].name);if(!i)throw new Error("Could not find data output with name "+e.dataOutputs[t].name+" in block "+e.className);i.deserialize(e.dataOutputs[t])}return s.metadata=e.metadata,s.deserialize&&s.deserialize(e),s}registerDataOutput(e,t){const i=new FlowGraphDataConnection(e,1,this,t);return this.dataOutputs.push(i),i}getDataOutput(e){return this.dataOutputs.find((t=>t.name===e))}registerDataInput(e,t){const i=new FlowGraphDataConnection(e,0,this,t);return this.dataInputs.push(i),i}constructor(e){this.config=e,this.Hc=RandomGUID(),this.name=this.config?.name??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}getDataInput(e){return this.dataInputs.find((t=>t.name===e))}serialize(e={},t=defaultValueSerializationFunction){e.Hc=this.Hc,e.config={},this.config&&(e.config.name=this.config.name),e.dataInputs=[],e.dataOutputs=[],e.className=this.getClassName();for(const t of this.dataInputs){const i={};t.serialize(i),e.dataInputs.push(i)}for(const t of this.dataOutputs){const i={};t.serialize(i),e.dataOutputs.push(i)}}_updateOutputs(e){}},FlowGraphSignalConnection=class extends FlowGraphConnection{_isSingularConnection(){return 1===this.connectionType}_activateSignal(e){0===this.connectionType?(e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(e,this),e._increaseExecutionId()):this._connectedPoint[0]?._activateSignal(e)}};RegisterClass("FlowGraphSignalConnection",FlowGraphSignalConnection);var FlowGraphExecutionBlock=class extends FlowGraphBlock{getSignalOutput(e){return this.signalOutputs.find((t=>t.name===e))}_registerSignalInput(e){const t=new FlowGraphSignalConnection(e,0,this);return this.signalInputs.push(t),t}constructor(e){super(e),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}deserialize(e){for(let t=0;t<e.signalInputs.length;t++){const i=this.getSignalInput(e.signalInputs[t].name);if(!i)throw new Error("Could not find signal input with name "+e.signalInputs[t].name+" in block "+e.className);i.deserialize(e.signalInputs[t])}for(let t=0;t<e.signalOutputs.length;t++){const i=this.getSignalOutput(e.signalOutputs[t].name);if(!i)throw new Error("Could not find signal output with name "+e.signalOutputs[t].name+" in block "+e.className);i.deserialize(e.signalOutputs[t])}}serialize(e={}){super.serialize(e),e.signalInputs=[],e.signalOutputs=[];for(const t of this.signalInputs){const i={};t.serialize(i),e.signalInputs.push(i)}for(const t of this.signalOutputs){const i={};t.serialize(i),e.signalOutputs.push(i)}}getSignalInput(e){return this.signalInputs.find((t=>t.name===e))}getClassName(){return"FGExecutionBlock"}_registerSignalOutput(e){const t=new FlowGraphSignalConnection(e,1,this);return this.signalOutputs.push(t),t}},FlowGraphAsyncExecutionBlock=class extends FlowGraphExecutionBlock{constructor(e){super(e),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(e){this._preparePendingTasks(e),e._addPendingBlock(this)}},FlowGraphEventBlock=class extends FlowGraphAsyncExecutionBlock{_execute(e){e._notifyExecuteNode(this),this.out._activateSignal(e)}},FlowGraphContext=class{static Parse(e,t){const i=t.graph.createContext(),a=t.valueParseFunction??defaultValueParseFunction;i.Hc=e.Hc;for(const t in e._userVariables){const n=a(t,e._userVariables,i._configuration.scene);i._userVariables[t]=n}for(const t in e._connectionValues){const n=a(t,e._connectionValues,i._configuration.scene);i._connectionValues[t]=n}return i}_getConnectionValue(e){return this._connectionValues[e.Hc]}constructor(e){this.Hc=RandomGUID(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Observable,this._configuration=e}setVariable(e,t){this._userVariables[e]=t}getClassName(){return"FGContext"}_removePendingBlock(e){const t=this._pendingBlocks.indexOf(e);-1!==t&&this._pendingBlocks.splice(t,1)}_deleteExecutionVariable(e,t){delete this._executionVariables[this._getUniqueIdPrefixedName(e,t)]}get configuration(){return this._configuration}_hasExecutionVariable(e,t){return this._getUniqueIdPrefixedName(e,t)in this._executionVariables}_clearPendingBlocks(){for(const e of this._pendingBlocks)e._cancelPendingTasks(this);this._pendingBlocks.length=0}_getExecutionVariable(e,t,i){return this._hasExecutionVariable(e,t)?this._executionVariables[this._getUniqueIdPrefixedName(e,t)]:i}_setExecutionVariable(e,t,i){this._executionVariables[this._getUniqueIdPrefixedName(e,t)]=i}_addPendingBlock(e){this._pendingBlocks.push(e)}hasVariable(e){return e in this._userVariables}_getUniqueIdPrefixedName(e,t){return`${e.Hc}_${t}`}get userVariables(){return this._userVariables}_notifyExecuteNode(e){this.onNodeExecutedObservable.notifyObservers(e)}_hasConnectionValue(e){return e.Hc in this._connectionValues}_setConnectionValue(e,t){this._connectionValues[e.Hc]=t}getVariable(e){return this._userVariables[e]}get executionId(){return this._executionId}serialize(e={},t=defaultValueSerializationFunction){e.Hc=this.Hc,e._userVariables={};for(const i in this._userVariables)t(i,this._userVariables[i],e._userVariables);e._connectionValues={};for(const i in this._connectionValues)t(i,this._connectionValues[i],e._connectionValues)}_increaseExecutionId(){this._executionId++}};function _isADescendantOf(e,t){return!(!e.parent||e.parent!==t&&!_isADescendantOf(e.parent,t))}__decorate([serialize()],FlowGraphContext.prototype,"uniqueId",void 0);var FlowGraphMeshPickEventBlock=class e extends FlowGraphEventBlock{_onDispose(e){this._cancelPendingTasks(e),e._removePendingBlock(this)}getClassName(){return e.ClassName}serialize(e){super.serialize(e),e.config.path=this.config.path}constructor(e){super(e),this.config=e}_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"mesh"),i=e._getExecutionVariable(this,"meshPickObserver"),a=e._getExecutionVariable(this,"meshDisposeObserver");t.getScene().onPointerObservable.remove(i),t.onDisposeObservable.remove(a),e._deleteExecutionVariable(this,"mesh"),e._deleteExecutionVariable(this,"meshPickObserver"),e._deleteExecutionVariable(this,"meshDisposeObserver")}_getReferencedMesh(){const e=this.config.pathConverter.convert(this.config.path),t=e.info.getObject(e.object);if(!(t&&t instanceof AbstractMesh))throw new Error("Mesh pick event block requires a valid mesh");return t}_preparePendingTasks(e){let t=e._getExecutionVariable(this,"meshPickObserver");if(!t){const i=this._getReferencedMesh();e._setExecutionVariable(this,"mesh",i),t=i.getScene().onPointerObservable.add((t=>{t.type===PointerEventTypes.POINTERPICK&&t.pickInfo?.pickedMesh&&(t.pickInfo?.pickedMesh===i||_isADescendantOf(t.pickInfo?.pickedMesh,i))&&this._execute(e)}));const a=i.onDisposeObservable.add((()=>this._onDispose));e._setExecutionVariable(this,"meshPickObserver",t),e._setExecutionVariable(this,"meshDisposeObserver",a)}}},FlowGraphState,FlowGraphState2;FlowGraphMeshPickEventBlock.ClassName="FGMeshPickEventBlock",RegisterClass(FlowGraphMeshPickEventBlock.ClassName,FlowGraphMeshPickEventBlock),FlowGraphState2=FlowGraphState||(FlowGraphState={}),FlowGraphState2[FlowGraphState2.Stopped=0]="Stopped",FlowGraphState2[FlowGraphState2.Started=1]="Started";var FlowGraph=class e{static GetSignalInConnectionByUniqueId(e,t){for(const i of e)if(i instanceof FlowGraphExecutionBlock)for(const e of i.signalInputs)if(e.Hc===t)return e;throw new Error("Could not find signal in connection with unique id "+t)}visitAllBlocks(e){const t=[],i=new Set;for(const e of this._eventBlocks)t.push(e),i.add(e.Hc);for(;t.length>0;){const a=t.pop();e(a);for(const e of a.dataInputs)for(const a of e._connectedPoint)i.has(a._ownerBlock.Hc)||(t.push(a._ownerBlock),i.add(a._ownerBlock.Hc));if(a instanceof FlowGraphExecutionBlock)for(const e of a.signalOutputs)for(const a of e._connectedPoint)i.has(a._ownerBlock.Hc)||(t.push(a._ownerBlock),i.add(a._ownerBlock.Hc))}}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const e of this._executionContexts){const t=this._getContextualOrder();for(const i of t)i._startPendingTasks(e)}}}_getContextualOrder(){const e=[];for(const t of this._eventBlocks)if(t.getClassName()===FlowGraphMeshPickEventBlock.ClassName){const i=t._getReferencedMesh();let a=0;for(;a<e.length;a++){const t=e[a]._getReferencedMesh();if(i&&t&&_isADescendantOf(i,t))break}e.splice(a,0,t)}else e.push(t);return e}addEventBlock(e){this._eventBlocks.push(e)}static GetDataOutConnectionByUniqueId(e,t){for(const i of e)for(const e of i.dataOutputs)if(e.Hc===t)return e;throw new Error("Could not find data out connection with unique id "+t)}constructor(e){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=e.scene,this._coordinator=e.coordinator,this._sceneDisposeObserver=this._scene.onDisposeObservable.add((()=>this.dispose()))}createContext(){const e=new FlowGraphContext({scene:this._scene,coordinator:this._coordinator});return this._executionContexts.push(e),e}serialize(e={},t){e.allBlocks=[],this.visitAllBlocks((t=>{const i={};t.serialize(i),e.allBlocks.push(i)})),e.executionContexts=[];for(const i of this._executionContexts){const a={};i.serialize(a,t),e.executionContexts.push(a)}}getContext(e){return this._executionContexts[e]}static Parse(t,i){const a=i.coordinator.createGraph(),n=[],s=i.valueParseFunction??defaultValueParseFunction;for(const e of t.allBlocks){const t=FlowGraphBlock.Parse(e,{scene:i.coordinator.config.scene,pathConverter:i.pathConverter,valueParseFunction:s});n.push(t),t instanceof FlowGraphEventBlock&&a.addEventBlock(t)}for(const t of n){for(const i of t.dataInputs)for(const t of i.connectedPointIds){const a=e.GetDataOutConnectionByUniqueId(n,t);i.connectTo(a)}if(t instanceof FlowGraphExecutionBlock)for(const i of t.signalOutputs)for(const t of i.connectedPointIds){const a=e.GetSignalInConnectionByUniqueId(n,t);i.connectTo(a)}}for(const e of t.executionContexts)FlowGraphContext.Parse(e,{graph:a,valueParseFunction:s});return a}dispose(){if(0!==this.state){this.state=0;for(const e of this._executionContexts)e._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.onDisposeObservable.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}},FlowGraphCoordinator=class e{static Parse(t,i){const a=i.valueParseFunction??defaultValueParseFunction,n=new e({scene:i.scene});return t._flowGraphs?.forEach((e=>{FlowGraph.Parse(e,{coordinator:n,valueParseFunction:a,pathConverter:i.pathConverter})})),n}start(){this._flowGraphs.forEach((e=>e.start()))}notifyCustomEvent(e,t){const i=this._customEventsMap.get(e);i&&i.notifyObservers(t)}dispose(){this._flowGraphs.forEach((e=>e.dispose())),this._flowGraphs.length=0;const t=e.SceneCoordinators.get(this.config.scene)??[],i=t.indexOf(this);-1!==i&&t.splice(i,1)}getCustomEventObservable(e){let t=this._customEventsMap.get(e);return t||(t=new Observable,this._customEventsMap.set(e,t)),t}removeGraph(e){const t=this._flowGraphs.indexOf(e);-1!==t&&(e.dispose(),this._flowGraphs.splice(t,1))}createGraph(){const e=new FlowGraph({scene:this.config.scene,coordinator:this});return this._flowGraphs.push(e),e}constructor(t){this.config=t,this._flowGraphs=[],this._customEventsMap=new Map,this.config.scene.onDisposeObservable.add((()=>{this.dispose()}));(e.SceneCoordinators.get(this.config.scene)??[]).push(this)}serialize(e,t){e._flowGraphs=[],this._flowGraphs.forEach((i=>{const a={};i.serialize(a,t),e._flowGraphs.push(a)}))}get flowGraphs(){return this._flowGraphs}};FlowGraphCoordinator.SceneCoordinators=new Map;var FlowGraphSceneReadyEventBlock=class e extends FlowGraphEventBlock{_preparePendingTasks(e){if(!e._getExecutionVariable(this,"sceneReadyObserver")){const t=e.configuration.scene.onReadyObservable.add((()=>{this._execute(e)}));e._setExecutionVariable(this,"sceneReadyObserver",t)}}_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"sceneReadyObserver");e.configuration.scene.onReadyObservable.remove(t),e._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return e.ClassName}};FlowGraphSceneReadyEventBlock.ClassName="FGSceneReadyEventBlock",RegisterClass("FGSceneReadyEventBlock",FlowGraphSceneReadyEventBlock);var FlowGraphSceneTickEventBlock=class e extends FlowGraphEventBlock{_preparePendingTasks(e){if(!e._getExecutionVariable(this,"sceneBeforeRender")){const t=e.configuration.scene.onBeforeRenderObservable.add((()=>{this._execute(e)}));e._setExecutionVariable(this,"sceneBeforeRender",t)}}getClassName(){return e.ClassName}_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"sceneBeforeRender");e.configuration.scene.onBeforeRenderObservable.remove(t),e._deleteExecutionVariable(this,"sceneBeforeRender")}};FlowGraphSceneTickEventBlock.ClassName="FGSceneTickEventBlock",RegisterClass(FlowGraphSceneTickEventBlock.ClassName,FlowGraphSceneTickEventBlock);var FlowGraphExecutionBlockWithOutSignal=class extends FlowGraphExecutionBlock{constructor(e){super(e),this.out=this._registerSignalOutput("out")}},FlowGraphConsoleLogBlock=class e extends FlowGraphExecutionBlockWithOutSignal{constructor(e){super(e),this.message=this.registerDataInput("message",RichTypeAny)}getClassName(){return e.ClassName}_execute(e){const t=this.message.getValue(e);Logger.Log(t),this.out._activateSignal(e)}},TimerState,TimerState2;FlowGraphConsoleLogBlock.ClassName="FGConsoleLogBlock",RegisterClass(FlowGraphConsoleLogBlock.ClassName,FlowGraphConsoleLogBlock),TimerState2=TimerState||(TimerState={}),TimerState2[TimerState2.INIT=0]="INIT",TimerState2[TimerState2.STARTED=1]="STARTED",TimerState2[TimerState2.ENDED=2]="ENDED";var AdvancedTimer=class{dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_stop(e,t=!1){this._contextObservable.remove(this._observer),this._setState(2),t?this.onTimerAbortedObservable.notifyObservers(e):this.onTimerEndedObservable.notifyObservers(e)}stop(){1===this._state&&(this._breakOnNextTick=!0)}set breakCondition(e){this._breakCondition=e}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}constructor(e){this.onEachCountObservable=new Observable,this.onTimerAbortedObservable=new Observable,this.onTimerEndedObservable=new Observable,this.onStateChangedObservable=new Observable,this._observer=null,this._breakOnNextTick=!1,this._tick=e=>{const t=Date.now();this._timer=t-this._startTime;const i={startTime:this._startTime,currentTime:t,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:e},a=this._breakOnNextTick||this._breakCondition(i);a||this._timer>=this._timeToEnd?this._stop(i,a):this.onEachCountObservable.notifyObservers(i)},this._setState(0),this._contextObservable=e.contextObservable,this._observableParameters=e.observableParameters??{},this._breakCondition=e.breakCondition??(()=>!1),this._timeToEnd=e.timeout,e.onEnded&&this.onTimerEndedObservable.add(e.onEnded),e.onTick&&this.onEachCountObservable.add(e.onTick),e.onAborted&&this.onTimerAbortedObservable.add(e.onAborted)}start(e=this._timeToEnd){if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=e,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}_setState(e){this._state=e,this.onStateChangedObservable.notifyObservers(this._state)}},FlowGraphTimerBlock=class e extends FlowGraphAsyncExecutionBlock{_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"runningTimers")||[];for(const e of t)e.dispose();e._deleteExecutionVariable(this,"runningTimers")}_execute(e){this._startPendingTasks(e),this.out._activateSignal(e)}_onEnded(e,t){const i=t._getExecutionVariable(this,"runningTimers")||[],a=i.indexOf(e);-1!==a?i.splice(a,1):Tools.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),t._removePendingBlock(this),this.done._activateSignal(t)}_preparePendingTasks(e){const t=this.timeout.getValue(e);if(void 0!==t&&t>=0){const i=e._getExecutionVariable(this,"runningTimers")||[],a=e.configuration.scene,n=new AdvancedTimer({timeout:t,contextObservable:a.onBeforeRenderObservable,onEnded:()=>this._onEnded(n,e)});n.start(),i.push(n),e._setExecutionVariable(this,"runningTimers",i)}}constructor(e){super(e),this.timeout=this.registerDataInput("timeout",RichTypeNumber)}getClassName(){return e.ClassName}};FlowGraphTimerBlock.ClassName="FGTimerBlock",RegisterClass("FGTimerBlock",FlowGraphTimerBlock);var FlowGraphSendCustomEventBlock=class e extends FlowGraphExecutionBlockWithOutSignal{getClassName(){return e.ClassName}constructor(e){super(e),this.config=e;for(let e=0;e<this.config.eventData.length;e++){const t=this.config.eventData[e];this.registerDataInput(t,RichTypeAny)}}_execute(e){const t=this.config.eventId,i=this.dataInputs.map((t=>t.getValue(e)));e.configuration.coordinator.notifyCustomEvent(t,i),this.out._activateSignal(e)}};FlowGraphSendCustomEventBlock.ClassName="FGSendCustomEventBlock",RegisterClass("FGSendCustomEventBlock",FlowGraphSendCustomEventBlock);var FlowGraphReceiveCustomEventBlock=class e extends FlowGraphEventBlock{getClassName(){return e.ClassName}_cancelPendingTasks(e){const t=e.configuration.coordinator.getCustomEventObservable(this.config.eventId);t?t.remove(this._eventObserver):Tools.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}constructor(e){super(e),this.config=e;for(let e=0;e<this.config.eventData.length;e++){const t=this.config.eventData[e];this.registerDataOutput(t,RichTypeAny)}}_preparePendingTasks(e){const t=e.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=t.add((t=>{for(let i=0;i<t.length;i++)this.dataOutputs[i].setValue(t[i],e);this._execute(e)}))}serialize(e){super.serialize(e),e.eventId=this.config.eventId,e.eventData=this.config.eventData}};FlowGraphReceiveCustomEventBlock.ClassName="FGReceiveCustomEventBlock",RegisterClass(FlowGraphReceiveCustomEventBlock.ClassName,FlowGraphReceiveCustomEventBlock);var FlowGraphSequenceBlock=class e extends FlowGraphExecutionBlock{_execute(e){for(let t=0;t<this.config.numberOutputFlows;t++)this.outFlows[t]._activateSignal(e)}getClassName(){return e.ClassName}constructor(e){super(e),this.config=e,this.outFlows=[];for(let e=0;e<this.config.numberOutputFlows;e++)this.outFlows.push(this._registerSignalOutput(`${e}`))}};FlowGraphSequenceBlock.ClassName="FGSequenceBlock",RegisterClass(FlowGraphSequenceBlock.ClassName,FlowGraphSequenceBlock);var pathHasTemplatesRegex=new RegExp(/\{(\w+)\}/g),FlowGraphPathConverterComponent=class{getAccessor(e,t){let i=this.path;for(const e of this.templatedInputs){const a=e.getValue(t).value;i=i.replace(`{${e.name}}`,a.toString())}return e.convert(i)}constructor(e,t){this.path=e,this.ownerBlock=t,this.templatedInputs=[];let i=pathHasTemplatesRegex.exec(e);for(;i;){const[,a]=i;this.templatedInputs.push(t.registerDataInput(a,RichTypeFlowGraphInteger)),i=pathHasTemplatesRegex.exec(e)}}},FlowGraphGetPropertyBlock=class e extends FlowGraphBlock{getClassName(){return e.ClassName}_updateOutputs(e){const t=this.templateComponent.getAccessor(this.config.pathConverter,e),i=t.info.get(t.object);this.value.setValue(i,e)}constructor(e){super(e),this.config=e,this.value=this.registerDataOutput("value",RichTypeAny),this.templateComponent=new FlowGraphPathConverterComponent(e.path,this)}serialize(e={}){super.serialize(e),e.config.path=this.config.path}};FlowGraphGetPropertyBlock.ClassName="FGGetPropertyBlock",RegisterClass(FlowGraphGetPropertyBlock.ClassName,FlowGraphGetPropertyBlock);var FlowGraphSetPropertyBlock=class e extends FlowGraphExecutionBlockWithOutSignal{getClassName(){return e.ClassName}constructor(e){super(e),this.config=e,this.a=this.registerDataInput("a",RichTypeAny),this.templateComponent=new FlowGraphPathConverterComponent(e.path,this)}_execute(e){const t=this.a.getValue(e),i=this.templateComponent.getAccessor(this.config.pathConverter,e);i.info.set(t,i.object),this.out._activateSignal(e)}serialize(e={}){super.serialize(e),e.config.path=this.config.path}};FlowGraphSetPropertyBlock.ClassName="FGSetPropertyBlock",RegisterClass("FGSetPropertyBlock",FlowGraphSetPropertyBlock);var cacheName="cachedOperationValue",cacheExecIdName="cachedExecutionId",FlowGraphCachedOperationBlock=class extends FlowGraphBlock{_updateOutputs(e){const t=e._getExecutionVariable(this,cacheExecIdName),i=e._getExecutionVariable(this,cacheName);if(void 0!==i&&t===e.executionId)this.value.setValue(i,e);else{const t=this._doOperation(e);e._setExecutionVariable(this,cacheName,t),e._setExecutionVariable(this,cacheExecIdName,e.executionId),this.value.setValue(t,e)}}constructor(e,t){super(t),this.value=this.registerDataOutput("value",e)}},FlowGraphBinaryOperationBlock=class extends FlowGraphCachedOperationBlock{constructor(e,t,i,a,n,s){super(i,s),this._operation=a,this._className=n,this.a=this.registerDataInput("a",e),this.b=this.registerDataInput("b",t)}_doOperation(e){return this._operation(this.a.getValue(e),this.b.getValue(e))}getClassName(){return this._className}},FlowGraphConstantOperationBlock=class extends FlowGraphCachedOperationBlock{_doOperation(e){return this._operation()}getClassName(){return this._className}constructor(e,t,i,a){super(e,a),this._operation=t,this._className=i}},FlowGraphUnaryOperationBlock=class extends FlowGraphCachedOperationBlock{getClassName(){return this._className}constructor(e,t,i,a,n){super(t,n),this._operation=i,this._className=a,this.a=this.registerDataInput("a",e)}_doOperation(e){return this._operation(this.a.getValue(e))}},FlowGraphTernaryOperationBlock=class extends FlowGraphCachedOperationBlock{constructor(e,t,i,a,n,s,r){super(a,r),this._operation=n,this._className=s,this.a=this.registerDataInput("a",e),this.b=this.registerDataInput("b",t),this.c=this.registerDataInput("c",i)}_doOperation(e){return this._operation(this.a.getValue(e),this.b.getValue(e),this.c.getValue(e))}getClassName(){return this._className}};function _getClassNameOf(e){return e.getClassName?e.getClassName():""}function _areSameVectorClass(e,t){return"Vector2"===e&&"Vector2"===t||"Vector3"===e&&"Vector3"===t||"Vector4"===e&&"Vector4"===t}function _areSameMatrixClass(e,t){return"Matrix"===e&&"Matrix"===t}function _areSameIntegerClass(e,t){return"FlowGraphInteger"===e&&"FlowGraphInteger"===t}var FlowGraphAddBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,((e,t)=>this._polymorphicAdd(e,t)),e.ClassName,t)}_polymorphicAdd(e,t){const i=_getClassNameOf(e),a=_getClassNameOf(t);return _areSameVectorClass(i,a)||_areSameMatrixClass(i,a)||_areSameIntegerClass(i,a)?e.add(t):e+t}};FlowGraphAddBlock.ClassName="FGAddBlock",RegisterClass(FlowGraphAddBlock.ClassName,FlowGraphAddBlock);var FlowGraphSubtractBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,((e,t)=>this._polymorphicAdd(e,t)),e.ClassName,t)}_polymorphicAdd(e,t){const i=_getClassNameOf(e),a=_getClassNameOf(t);return _areSameVectorClass(i,a)||_areSameIntegerClass(i,a)?e.subtract(t):_areSameMatrixClass(i,a)?e.add(t.scale(-1)):e-t}};FlowGraphSubtractBlock.ClassName="FGSubBlock",RegisterClass(FlowGraphSubtractBlock.ClassName,FlowGraphSubtractBlock);var FlowGraphMultiplyBlock=class e extends FlowGraphBinaryOperationBlock{_polymorphicMultiply(e,t){const i=_getClassNameOf(e),a=_getClassNameOf(t);return _areSameVectorClass(i,a)||_areSameIntegerClass(i,a)?e.multiply(t):_areSameMatrixClass(i,a)?Matrix.FromValues(e.m[0]*t.m[0],e.m[4]*t.m[4],e.m[8]*t.m[8],e.m[12]*t.m[12],e.m[1]*t.m[1],e.m[5]*t.m[5],e.m[9]*t.m[9],e.m[13]*t.m[13],e.m[2]*t.m[2],e.m[6]*t.m[6],e.m[10]*t.m[10],e.m[14]*t.m[14],e.m[3]*t.m[3],e.m[7]*t.m[7],e.m[11]*t.m[11],e.m[15]*t.m[15]):e*t}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,((e,t)=>this._polymorphicMultiply(e,t)),e.ClassName,t)}};FlowGraphMultiplyBlock.ClassName="FGMultiplyBlock",RegisterClass(FlowGraphMultiplyBlock.ClassName,FlowGraphMultiplyBlock);var FlowGraphDivideBlock=class e extends FlowGraphBinaryOperationBlock{_polymorphicDivide(e,t){const i=_getClassNameOf(e),a=_getClassNameOf(t);return _areSameVectorClass(i,a)||_areSameIntegerClass(i,a)?e.divide(t):_areSameMatrixClass(i,a)?Matrix.FromValues(e.m[0]/t.m[0],e.m[4]/t.m[4],e.m[8]/t.m[8],e.m[12]/t.m[12],e.m[1]/t.m[1],e.m[5]/t.m[5],e.m[9]/t.m[9],e.m[13]/t.m[13],e.m[2]/t.m[2],e.m[6]/t.m[6],e.m[10]/t.m[10],e.m[14]/t.m[14],e.m[3]/t.m[3],e.m[7]/t.m[7],e.m[11]/t.m[11],e.m[15]/t.m[15]):e/t}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,((e,t)=>this._polymorphicDivide(e,t)),e.ClassName,t)}};FlowGraphDivideBlock.ClassName="FGDivideBlock",RegisterClass(FlowGraphDivideBlock.ClassName,FlowGraphDivideBlock);var FlowGraphRandomBlock=class e extends FlowGraphConstantOperationBlock{constructor(t){super(RichTypeNumber,(()=>Math.random()),e.ClassName,t)}};FlowGraphRandomBlock.ClassName="FGRandomBlock",RegisterClass(FlowGraphRandomBlock.ClassName,FlowGraphRandomBlock);var FlowGraphDotBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,RichTypeNumber,((e,t)=>this._polymorphicDot(e,t)),e.ClassName,t)}_polymorphicDot(e,t){switch(_getClassNameOf(e)){case"Vector2":return Vector2.Dot(e,t);case"Vector3":return Vector3.Dot(e,t);case"Vector4":return Vector4.Dot(e,t);default:throw new Error(`Cannot get dot product of ${e} and ${t}`)}}};FlowGraphDotBlock.ClassName="FGDotBlock",RegisterClass(FlowGraphDotBlock.ClassName,FlowGraphDotBlock);var FlowGraphEBlock=class e extends FlowGraphConstantOperationBlock{constructor(t){super(RichTypeNumber,(()=>Math.E),e.ClassName,t)}};FlowGraphEBlock.ClassName="FGEBlock",RegisterClass(FlowGraphEBlock.ClassName,FlowGraphEBlock);var FlowGraphPiBlock=class e extends FlowGraphConstantOperationBlock{constructor(t){super(RichTypeNumber,(()=>Math.PI),e.ClassName,t)}};FlowGraphPiBlock.ClassName="FGPIBlock",RegisterClass(FlowGraphPiBlock.ClassName,FlowGraphPiBlock);var FlowGraphInfBlock=class e extends FlowGraphConstantOperationBlock{constructor(t){super(RichTypeNumber,(()=>Number.POSITIVE_INFINITY),e.ClassName,t)}};FlowGraphInfBlock.ClassName="FGInfBlock",RegisterClass(FlowGraphInfBlock.ClassName,FlowGraphInfBlock);var FlowGraphNaNBlock=class e extends FlowGraphConstantOperationBlock{constructor(t){super(RichTypeNumber,(()=>Number.NaN),e.ClassName,t)}};function _componentWiseUnaryOperation(e,t){switch(_getClassNameOf(e)){case"FlowGraphInteger":return new FlowGraphInteger(t(e.value));case"Vector2":return new Vector2(t(e.x),t(e.y));case"Vector3":return new Vector3(t(e.x),t(e.y),t(e.z));case"Vector4":return new Vector4(t(e.x),t(e.y),t(e.z),t(e.w));case"Matrix":return Matrix.FromValues(t(e.m[0]),t(e.m[4]),t(e.m[8]),t(e.m[12]),t(e.m[1]),t(e.m[5]),t(e.m[9]),t(e.m[13]),t(e.m[2]),t(e.m[6]),t(e.m[10]),t(e.m[14]),t(e.m[3]),t(e.m[7]),t(e.m[11]),t(e.m[15]));default:return t(e)}}FlowGraphNaNBlock.ClassName="FGNaNBlock",RegisterClass(FlowGraphNaNBlock.ClassName,FlowGraphNaNBlock);var FlowGraphAbsBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicAbs(e)),e.ClassName,t)}_polymorphicAbs(e){return _componentWiseUnaryOperation(e,Math.abs)}};FlowGraphAbsBlock.ClassName="FGAbsBlock",RegisterClass(FlowGraphAbsBlock.ClassName,FlowGraphAbsBlock);var FlowGraphSignBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicSign(e){return _componentWiseUnaryOperation(e,Math.sign)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicSign(e)),e.ClassName,t)}};FlowGraphSignBlock.ClassName="FGSignBlock",RegisterClass(FlowGraphSignBlock.ClassName,FlowGraphSignBlock);var FlowGraphTruncBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicTrunc(e){return _componentWiseUnaryOperation(e,Math.trunc)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicTrunc(e)),e.ClassName,t)}};FlowGraphTruncBlock.ClassName="FGTruncBlock",RegisterClass(FlowGraphTruncBlock.ClassName,FlowGraphTruncBlock);var FlowGraphFloorBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicFloor(e){return _componentWiseUnaryOperation(e,Math.floor)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicFloor(e)),e.ClassName,t)}};FlowGraphFloorBlock.ClassName="FGFloorBlock",RegisterClass(FlowGraphFloorBlock.ClassName,FlowGraphFloorBlock);var FlowGraphCeilBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicCeiling(e){return _componentWiseUnaryOperation(e,Math.ceil)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicCeiling(e)),e.ClassName,t)}};FlowGraphCeilBlock.ClassName="FGCeilBlock",RegisterClass(FlowGraphCeilBlock.ClassName,FlowGraphCeilBlock);var FlowGraphFractBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicFract(e)),e.ClassName,t)}_polymorphicFract(e){return _componentWiseUnaryOperation(e,(e=>e-Math.floor(e)))}};FlowGraphFractBlock.ClassName="FGFractBlock",RegisterClass(FlowGraphFractBlock.ClassName,FlowGraphFractBlock);var FlowGraphNegBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicNeg(e){return _componentWiseUnaryOperation(e,(e=>-e))}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicNeg(e)),e.ClassName,t)}};function _componentWiseBinaryOperation(e,t,i){switch(_getClassNameOf(e)){case"FlowGraphInteger":return new FlowGraphInteger(i(e.value,t.value));case"Vector2":return new Vector2(i(e.x,t.x),i(e.y,t.y));case"Vector3":return new Vector3(i(e.x,t.x),i(e.y,t.y),i(e.z,t.z));case"Vector4":return new Vector4(i(e.x,t.x),i(e.y,t.y),i(e.z,t.z),i(e.w,t.w));case"Matrix":return Matrix.FromValues(i(e.m[0],t.m[0]),i(e.m[4],t.m[4]),i(e.m[8],t.m[8]),i(e.m[12],t.m[12]),i(e.m[1],t.m[1]),i(e.m[5],t.m[5]),i(e.m[9],t.m[9]),i(e.m[13],t.m[13]),i(e.m[2],t.m[2]),i(e.m[6],t.m[6]),i(e.m[10],t.m[10]),i(e.m[14],t.m[14]),i(e.m[3],t.m[3]),i(e.m[7],t.m[7]),i(e.m[11],t.m[11]),i(e.m[15],t.m[15]));default:return i(e,t)}}FlowGraphNegBlock.ClassName="FGNegBlock",RegisterClass(FlowGraphNegBlock.ClassName,FlowGraphNegBlock);var FlowGraphRemainderBlock=class e extends FlowGraphBinaryOperationBlock{_polymorphicRemainder(e,t){return _componentWiseBinaryOperation(e,t,((e,t)=>e%t))}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,((e,t)=>this._polymorphicRemainder(e,t)),e.ClassName,t)}};FlowGraphRemainderBlock.ClassName="FGRemainderBlock",RegisterClass(FlowGraphRemainderBlock.ClassName,FlowGraphRemainderBlock);var FlowGraphMinBlock=class e extends FlowGraphBinaryOperationBlock{_polymorphicMin(e,t){return _componentWiseBinaryOperation(e,t,Math.min)}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,((e,t)=>this._polymorphicMin(e,t)),e.ClassName,t)}};FlowGraphMinBlock.ClassName="FGMinBlock",RegisterClass(FlowGraphMinBlock.ClassName,FlowGraphMinBlock);var FlowGraphMaxBlock=class e extends FlowGraphBinaryOperationBlock{_polymorphicMax(e,t){return _componentWiseBinaryOperation(e,t,Math.max)}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,((e,t)=>this._polymorphicMax(e,t)),e.ClassName,t)}};function _clamp(e,t,i){return Math.min(Math.max(e,Math.min(t,i)),Math.max(t,i))}function _componentWiseTernaryOperation(e,t,i,a){switch(_getClassNameOf(e)){case"FlowGraphInteger":return new FlowGraphInteger(a(e.value,t.value,i.value));case"Vector2":return new Vector2(a(e.x,t.x,i.x),a(e.y,t.y,i.y));case"Vector3":return new Vector3(a(e.x,t.x,i.x),a(e.y,t.y,i.y),a(e.z,t.z,i.z));case"Vector4":return new Vector4(a(e.x,t.x,i.x),a(e.y,t.y,i.y),a(e.z,t.z,i.z),a(e.w,t.w,i.w));case"Matrix":return Matrix.FromValues(a(e.m[0],t.m[0],i.m[0]),a(e.m[4],t.m[4],i.m[4]),a(e.m[8],t.m[8],i.m[8]),a(e.m[12],t.m[12],i.m[12]),a(e.m[1],t.m[1],i.m[1]),a(e.m[5],t.m[5],i.m[5]),a(e.m[9],t.m[9],i.m[9]),a(e.m[13],t.m[13],i.m[13]),a(e.m[2],t.m[2],i.m[2]),a(e.m[6],t.m[6],i.m[6]),a(e.m[10],t.m[10],i.m[10]),a(e.m[14],t.m[14],i.m[14]),a(e.m[3],t.m[3],i.m[3]),a(e.m[7],t.m[7],i.m[7]),a(e.m[11],t.m[11],i.m[11]),a(e.m[15],t.m[15],i.m[15]));default:return a(e,t,i)}}FlowGraphMaxBlock.ClassName="FGMaxBlock",RegisterClass(FlowGraphMaxBlock.ClassName,FlowGraphMaxBlock);var FlowGraphClampBlock=class e extends FlowGraphTernaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,RichTypeAny,((e,t,i)=>this._polymorphicClamp(e,t,i)),e.ClassName,t)}_polymorphicClamp(e,t,i){return _componentWiseTernaryOperation(e,t,i,_clamp)}};function _saturate(e){return Math.min(Math.max(e,0),1)}FlowGraphClampBlock.ClassName="FGClampBlock",RegisterClass(FlowGraphClampBlock.ClassName,FlowGraphClampBlock);var FlowGraphSaturateBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicSaturate(e)),e.ClassName,t)}_polymorphicSaturate(e){return _componentWiseUnaryOperation(e,_saturate)}};FlowGraphSaturateBlock.ClassName="FGSaturateBlock",RegisterClass(FlowGraphSaturateBlock.ClassName,FlowGraphSaturateBlock);var FlowGraphInterpolateBlock=class e extends FlowGraphTernaryOperationBlock{_interpolate(e,t,i){return(1-i)*e+i*t}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,RichTypeAny,((e,t,i)=>this._polymorphicInterpolate(e,t,i)),e.ClassName,t)}_polymorphicInterpolate(e,t,i){return _componentWiseTernaryOperation(e,t,i,this._interpolate)}};FlowGraphInterpolateBlock.ClassName="FGInterpolateBlock",RegisterClass(FlowGraphInterpolateBlock.ClassName,FlowGraphInterpolateBlock);var FlowGraphEqBlock=class e extends FlowGraphBinaryOperationBlock{_polymorphicEq(e,t){const i=_getClassNameOf(e),a=_getClassNameOf(t);return _areSameVectorClass(i,a)||_areSameMatrixClass(i,a)||_areSameIntegerClass(i,a)?e.equals(t):e===t}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeBoolean,((e,t)=>this._polymorphicEq(e,t)),e.ClassName,t)}};function _comparisonOperators(e,t,i){const a=_getClassNameOf(e);if(a===_getClassNameOf(t)){if(""===a)return i(e,t);if("FlowGraphInteger"===a)return i(e.value,t.value);throw new Error(`Cannot compare ${e} and ${t}`)}throw new Error(`${e} and ${t} are of different types.`)}FlowGraphEqBlock.ClassName="FGEqBlock",RegisterClass(FlowGraphEqBlock.ClassName,FlowGraphEqBlock);var FlowGraphLessThanBlock=class e extends FlowGraphBinaryOperationBlock{_polymorphicLessThan(e,t){return _comparisonOperators(e,t,((e,t)=>e<t))}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeBoolean,((e,t)=>this._polymorphicLessThan(e,t)),e.ClassName,t)}};FlowGraphLessThanBlock.ClassName="FGLessThanBlock",RegisterClass(FlowGraphLessThanBlock.ClassName,FlowGraphLessThanBlock);var FlowGraphLessThanOrEqualBlock=class e extends FlowGraphBinaryOperationBlock{_polymorphicLessThanOrEqual(e,t){return _comparisonOperators(e,t,((e,t)=>e<=t))}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeBoolean,((e,t)=>this._polymorphicLessThanOrEqual(e,t)),e.ClassName,t)}};FlowGraphLessThanOrEqualBlock.ClassName="FGLessThanOrEqualBlock";var FlowGraphGreaterThanBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,RichTypeBoolean,((e,t)=>this._polymorphicGreaterThan(e,t)),e.ClassName,t)}_polymorphicGreaterThan(e,t){return _comparisonOperators(e,t,((e,t)=>e>t))}};FlowGraphGreaterThanBlock.ClassName="FGGreaterThanBlock",RegisterClass(FlowGraphGreaterThanBlock.ClassName,FlowGraphGreaterThanBlock);var FlowGraphGreaterThanOrEqualBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,RichTypeBoolean,((e,t)=>this._polymorphicGreaterThanOrEqual(e,t)),e.ClassName,t)}_polymorphicGreaterThanOrEqual(e,t){return _comparisonOperators(e,t,((e,t)=>e>=t))}};FlowGraphGreaterThanOrEqualBlock.ClassName="FGGreaterThanOrEqualBlock",RegisterClass(FlowGraphGreaterThanOrEqualBlock.ClassName,FlowGraphGreaterThanOrEqualBlock);var FlowGraphIsNanBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeBoolean,(e=>this._polymorphicIsNan(e)),e.ClassName,t)}_polymorphicIsNan(e){const t=_getClassNameOf(e);if(""===t)return isNaN(e);if("FlowGraphInteger"===t)return isNaN(e.value);throw new Error(`Cannot get NaN of ${e}`)}};FlowGraphIsNanBlock.ClassName="FGIsNanBlock",RegisterClass(FlowGraphIsNanBlock.ClassName,FlowGraphIsNanBlock);var FlowGraphIsInfBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicIsInf(e){const t=_getClassNameOf(e);if(""===t)return!isFinite(e);if("FlowGraphInteger"===t)return!isFinite(e.value);throw new Error(`Cannot get isInf of ${e}`)}constructor(t){super(RichTypeAny,RichTypeBoolean,(e=>this._polymorphicIsInf(e)),e.ClassName,t)}};FlowGraphIsInfBlock.ClassName="FGIsInfBlock";var FlowGraphDegToRadBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicDegToRad(e)),e.ClassName,t)}_degToRad(e){return e*Math.PI/180}_polymorphicDegToRad(e){return _componentWiseUnaryOperation(e,this._degToRad)}};FlowGraphDegToRadBlock.ClassName="FGDegToRadBlock",RegisterClass(FlowGraphDegToRadBlock.ClassName,FlowGraphDegToRadBlock);var FlowGraphRadToDegBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicRadToDeg(e){return _componentWiseUnaryOperation(e,this._radToDeg)}_radToDeg(e){return 180*e/Math.PI}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicRadToDeg(e)),e.ClassName,t)}};FlowGraphRadToDegBlock.ClassName="FGRadToDegBlock",RegisterClass(FlowGraphRadToDegBlock.ClassName,FlowGraphRadToDegBlock);var FlowGraphSinBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicSin(e){return _componentWiseUnaryOperation(e,Math.sin)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicSin(e)),e.ClassName,t)}};FlowGraphSinBlock.ClassName="FGSinBlock",RegisterClass(FlowGraphSinBlock.ClassName,FlowGraphSinBlock);var FlowGraphCosBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicCos(e)),e.ClassName,t)}_polymorphicCos(e){return _componentWiseUnaryOperation(e,Math.cos)}};FlowGraphCosBlock.ClassName="FGCosBlock",RegisterClass(FlowGraphCosBlock.ClassName,FlowGraphCosBlock);var FlowGraphTanBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicTan(e)),e.ClassName,t)}_polymorphicTan(e){return _componentWiseUnaryOperation(e,Math.tan)}};FlowGraphTanBlock.ClassName="FGTanBlock",RegisterClass(FlowGraphTanBlock.ClassName,FlowGraphTanBlock);var FlowGraphAsinBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicAsin(e)),e.ClassName,t)}_polymorphicAsin(e){return _componentWiseUnaryOperation(e,Math.asin)}};FlowGraphAsinBlock.ClassName="FGAsinBlock",RegisterClass(FlowGraphAsinBlock.ClassName,FlowGraphAsinBlock);var FlowGraphAcosBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicAcos(e){return _componentWiseUnaryOperation(e,Math.acos)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicAcos(e)),e.ClassName,t)}};FlowGraphAcosBlock.ClassName="FGAcosBlock",RegisterClass(FlowGraphAcosBlock.ClassName,FlowGraphAcosBlock);var FlowGraphAtanBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicAtan(e)),e.ClassName,t)}_polymorphicAtan(e){return _componentWiseUnaryOperation(e,Math.atan)}};FlowGraphAtanBlock.ClassName="FGAtanBlock",RegisterClass(FlowGraphAtanBlock.ClassName,FlowGraphAtanBlock);var FlowGraphAtan2Block=class e extends FlowGraphBinaryOperationBlock{_polymorphicAtan2(e,t){return _componentWiseBinaryOperation(e,t,Math.atan2)}constructor(t){super(RichTypeAny,RichTypeAny,RichTypeAny,((e,t)=>this._polymorphicAtan2(e,t)),e.ClassName,t)}};FlowGraphAtan2Block.ClassName="FGAtan2Block",RegisterClass(FlowGraphAtan2Block.ClassName,FlowGraphAtan2Block);var FlowGraphSinhBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicSinh(e){return _componentWiseUnaryOperation(e,Math.sinh)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicSinh(e)),e.ClassName,t)}};FlowGraphSinhBlock.ClassName="FGSinhBlock",RegisterClass(FlowGraphSinhBlock.ClassName,FlowGraphSinhBlock);var FlowGraphCoshBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicCosh(e){return _componentWiseUnaryOperation(e,Math.cosh)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicCosh(e)),e.ClassName,t)}};FlowGraphCoshBlock.ClassName="FGCoshBlock",RegisterClass(FlowGraphCoshBlock.ClassName,FlowGraphCoshBlock);var FlowGraphTanhBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicTanh(e){return _componentWiseUnaryOperation(e,Math.tanh)}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicTanh(e)),e.ClassName,t)}};FlowGraphTanhBlock.ClassName="FGTanhBlock",RegisterClass(FlowGraphTanhBlock.ClassName,FlowGraphTanhBlock);var FlowGraphAsinhBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicAsinh(e){return _componentWiseUnaryOperation(e,Math.asinh)}constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicAsinh(e)),e.ClassName,t)}};FlowGraphAsinhBlock.ClassName="FGAsinhBlock",RegisterClass(FlowGraphAsinhBlock.ClassName,FlowGraphAsinhBlock);var FlowGraphAcoshBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicAcosh(e){return _componentWiseUnaryOperation(e,Math.acosh)}constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicAcosh(e)),e.ClassName,t)}};FlowGraphAcoshBlock.ClassName="FGAcoshBlock",RegisterClass(FlowGraphAcoshBlock.ClassName,FlowGraphAcoshBlock);var FlowGraphAtanhBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicAtanh(e)),e.ClassName,t)}_polymorphicAtanh(e){return _componentWiseUnaryOperation(e,Math.atanh)}};FlowGraphAtanhBlock.ClassName="FGAtanhBlock",RegisterClass(FlowGraphAtanhBlock.ClassName,FlowGraphAtanhBlock);var FlowGraphExpBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicExp(e)),e.ClassName,t)}_polymorphicExp(e){return _componentWiseUnaryOperation(e,Math.exp)}};FlowGraphExpBlock.ClassName="FGExpBlock",RegisterClass(FlowGraphExpBlock.ClassName,FlowGraphExpBlock);var FlowGraphLogBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicLog(e){return _componentWiseUnaryOperation(e,Math.log)}constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicLog(e)),e.ClassName,t)}};FlowGraphLogBlock.ClassName="FGLogBlock",RegisterClass(FlowGraphLogBlock.ClassName,FlowGraphLogBlock);var FlowGraphLog2Block=class e extends FlowGraphUnaryOperationBlock{_polymorphicLog2(e){return _componentWiseUnaryOperation(e,Math.log2)}constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicLog2(e)),e.ClassName,t)}};FlowGraphLog2Block.ClassName="FGLog2Block",RegisterClass(FlowGraphLog2Block.ClassName,FlowGraphLog2Block);var FlowGraphLog10Block=class e extends FlowGraphUnaryOperationBlock{_polymorphicLog10(e){return _componentWiseUnaryOperation(e,Math.log10)}constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicLog10(e)),e.ClassName,t)}};FlowGraphLog10Block.ClassName="FGLog10Block",RegisterClass(FlowGraphLog10Block.ClassName,FlowGraphLog10Block);var FlowGraphSqrtBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicSqrt(e){return _componentWiseUnaryOperation(e,Math.sqrt)}constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicSqrt(e)),e.ClassName,t)}};FlowGraphSqrtBlock.ClassName="FGSqrtBlock",RegisterClass(FlowGraphSqrtBlock.ClassName,FlowGraphSqrtBlock);var FlowGraphCubeRootBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicCubeRoot(e)),e.ClassName,t)}_polymorphicCubeRoot(e){return _componentWiseUnaryOperation(e,Math.cbrt)}};FlowGraphCubeRootBlock.ClassName="FGCubeRootBlock",RegisterClass(FlowGraphCubeRootBlock.ClassName,FlowGraphCubeRootBlock);var FlowGraphPowBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeNumber,RichTypeNumber,((e,t)=>this._polymorphicPow(e,t)),e.ClassName,t)}_polymorphicPow(e,t){return _componentWiseBinaryOperation(e,t,Math.pow)}};FlowGraphPowBlock.ClassName="FGPowBlock",RegisterClass(FlowGraphPowBlock.ClassName,FlowGraphPowBlock);var FlowGraphLengthBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeAny,RichTypeNumber,(e=>this._polymorphicLength(e)),e.ClassName,t)}_polymorphicLength(e){switch(_getClassNameOf(e)){case"Vector2":case"Vector3":case"Vector4":return e.length();default:throw new Error(`Cannot compute length of value ${e}`)}}};FlowGraphLengthBlock.ClassName="FGLengthBlock",RegisterClass(FlowGraphLengthBlock.ClassName,FlowGraphLengthBlock);var FlowGraphNormalizeBlock=class e extends FlowGraphUnaryOperationBlock{_polymorphicNormalize(e){switch(_getClassNameOf(e)){case"Vector2":case"Vector3":case"Vector4":return e.normalize();default:throw new Error(`Cannot normalize value ${e}`)}}constructor(t){super(RichTypeAny,RichTypeAny,(e=>this._polymorphicNormalize(e)),e.ClassName,t)}};FlowGraphNormalizeBlock.ClassName="FGNormalizeBlock",RegisterClass(FlowGraphNormalizeBlock.ClassName,FlowGraphNormalizeBlock);var FlowGraphCrossBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeVector3,RichTypeVector3,RichTypeVector3,((e,t)=>Vector3.Cross(e,t)),e.ClassName,t)}};FlowGraphCrossBlock.ClassName="FGCrossBlock",RegisterClass(FlowGraphCrossBlock.ClassName,FlowGraphCrossBlock);var FlowGraphRotate2DBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeVector2,RichTypeNumber,RichTypeVector2,((e,t)=>Vector2.Transform(e,Matrix.RotationZ(t))),e.ClassName,t)}};FlowGraphRotate2DBlock.ClassName="FGRotate2DBlock",RegisterClass(FlowGraphRotate2DBlock.ClassName,FlowGraphRotate2DBlock);var FlowGraphRotate3DBlock=class e extends FlowGraphTernaryOperationBlock{constructor(t){super(RichTypeVector3,RichTypeVector3,RichTypeNumber,RichTypeVector3,((e,t,i)=>Vector3.TransformCoordinates(e,Matrix.RotationAxis(t,i))),e.ClassName,t)}};FlowGraphRotate3DBlock.ClassName="FGRotate3DBlock",RegisterClass(FlowGraphRotate3DBlock.ClassName,FlowGraphRotate3DBlock);var FlowGraphTransposeBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeMatrix,RichTypeMatrix,(e=>Matrix.Transpose(e)),e.ClassName,t)}};FlowGraphTransposeBlock.ClassName="FGTransposeBlock",RegisterClass(FlowGraphTransposeBlock.ClassName,FlowGraphTransposeBlock);var FlowGraphDeterminantBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeMatrix,RichTypeNumber,(e=>e.determinant()),e.ClassName,t)}};FlowGraphDeterminantBlock.ClassName="FGDeterminantBlock",RegisterClass(FlowGraphDeterminantBlock.ClassName,FlowGraphDeterminantBlock);var FlowGraphInvertMatrixBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeMatrix,RichTypeMatrix,(e=>Matrix.Invert(e)),e.ClassName,t)}};FlowGraphInvertMatrixBlock.ClassName="FGInvertMatrixBlock",RegisterClass(FlowGraphInvertMatrixBlock.ClassName,FlowGraphInvertMatrixBlock);var FlowGraphMatMulBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeMatrix,RichTypeMatrix,RichTypeMatrix,((e,t)=>t.multiply(e)),e.ClassName,t)}};FlowGraphMatMulBlock.ClassName="FGMatMulBlock",RegisterClass(FlowGraphMatMulBlock.ClassName,FlowGraphMatMulBlock);var FlowGraphBitwiseNotBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,(e=>new FlowGraphInteger(~e.value)),e.ClassName,t)}};FlowGraphBitwiseNotBlock.ClassName="FGBitwiseNotBlock",RegisterClass(FlowGraphBitwiseNotBlock.ClassName,FlowGraphBitwiseNotBlock);var FlowGraphBitwiseAndBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,((e,t)=>new FlowGraphInteger(e.value&t.value)),e.ClassName,t)}};FlowGraphBitwiseAndBlock.ClassName="FGBitwiseAndBlock",RegisterClass(FlowGraphBitwiseAndBlock.ClassName,FlowGraphBitwiseAndBlock);var FlowGraphBitwiseOrBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,((e,t)=>new FlowGraphInteger(e.value|t.value)),e.ClassName,t)}};FlowGraphBitwiseOrBlock.ClassName="FGBitwiseOrBlock",RegisterClass(FlowGraphBitwiseOrBlock.ClassName,FlowGraphBitwiseOrBlock);var FlowGraphBitwiseXorBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,((e,t)=>new FlowGraphInteger(e.value^t.value)),e.ClassName,t)}};FlowGraphBitwiseXorBlock.ClassName="FGBitwiseXorBlock",RegisterClass(FlowGraphBitwiseXorBlock.ClassName,FlowGraphBitwiseXorBlock);var FlowGraphBitwiseLeftShiftBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,((e,t)=>new FlowGraphInteger(e.value<<t.value)),e.ClassName,t)}};FlowGraphBitwiseLeftShiftBlock.ClassName="FGBitwiseLeftShiftBlock",RegisterClass(FlowGraphBitwiseLeftShiftBlock.ClassName,FlowGraphBitwiseLeftShiftBlock);var FlowGraphBitwiseRightShiftBlock=class e extends FlowGraphBinaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,((e,t)=>new FlowGraphInteger(e.value>>t.value)),e.ClassName,t)}};FlowGraphBitwiseRightShiftBlock.ClassName="FGBitwiseRightShiftBlock",RegisterClass(FlowGraphBitwiseRightShiftBlock.ClassName,FlowGraphBitwiseRightShiftBlock);var FlowGraphCountLeadingZerosBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,(e=>new FlowGraphInteger(Math.clz32(e.value))),e.ClassName,t)}};FlowGraphCountLeadingZerosBlock.ClassName="FGCountLeadingZerosBlock",RegisterClass(FlowGraphCountLeadingZerosBlock.ClassName,FlowGraphCountLeadingZerosBlock);var FlowGraphCountTrailingZerosBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,(e=>new FlowGraphInteger(e.value?31-Math.clz32(e.value&-e.value):32)),e.ClassName,t)}};function _countOnes(e){let t=0;for(;e;)t+=1&e,e>>=1;return t}FlowGraphCountTrailingZerosBlock.ClassName="FGCountTrailingZerosBlock",RegisterClass(FlowGraphCountTrailingZerosBlock.ClassName,FlowGraphCountTrailingZerosBlock);var FlowGraphCountOneBitsBlock=class e extends FlowGraphUnaryOperationBlock{constructor(t){super(RichTypeFlowGraphInteger,RichTypeFlowGraphInteger,(e=>new FlowGraphInteger(_countOnes(e.value))),e.ClassName,t)}};FlowGraphCountOneBitsBlock.ClassName="FGCountOneBitsBlock",RegisterClass(FlowGraphCountOneBitsBlock.ClassName,FlowGraphCountOneBitsBlock);var FlowGraphDoNBlock=class e extends FlowGraphExecutionBlockWithOutSignal{getClassName(){return e.ClassName}_execute(e,t){if(t===this.reset)this.value.setValue(this.config.startIndex,e);else{const t=this.value.getValue(e);t.value<this.n.getValue(e).value&&(this.value.setValue(new FlowGraphInteger(t.value+1),e),this.out._activateSignal(e))}}constructor(e={startIndex:new FlowGraphInteger(0)}){super(e),this.config=e,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",RichTypeFlowGraphInteger),this.value=this.registerDataOutput("value",RichTypeFlowGraphInteger)}};FlowGraphDoNBlock.ClassName="FGDoNBlock",RegisterClass(FlowGraphDoNBlock.ClassName,FlowGraphDoNBlock);var FlowGraphGetVariableBlock=class e extends FlowGraphBlock{serialize(e){super.serialize(e),e.config.variableName=this.config.variableName}getClassName(){return e.ClassName}_updateOutputs(e){const t=this.config.variableName;e.hasVariable(t)&&this.output.setValue(e.getVariable(t),e)}constructor(e){super(e),this.config=e,this.output=this.registerDataOutput(e.variableName,RichTypeAny)}};FlowGraphGetVariableBlock.ClassName="FGGetVariableBlock",RegisterClass(FlowGraphGetVariableBlock.ClassName,FlowGraphGetVariableBlock);var FlowGraphSetVariableBlock=class e extends FlowGraphExecutionBlockWithOutSignal{getClassName(){return e.ClassName}_execute(e){const t=this.config.variableName,i=this.input.getValue(e);e.setVariable(t,i),this.out._activateSignal(e)}constructor(e){super(e),this.config=e,this.input=this.registerDataInput(e.variableName,RichTypeAny)}};FlowGraphSetVariableBlock.ClassName="FGSetVariableBlock",RegisterClass(FlowGraphSetVariableBlock.ClassName,FlowGraphSetVariableBlock);var FlowGraphWhileLoopBlock=class e extends FlowGraphExecutionBlockWithOutSignal{_execute(e,t){let i=this.condition.getValue(e);for(this.config?.isDo&&!i&&this.loopBody._activateSignal(e);i;)this.loopBody._activateSignal(e),i=this.condition.getValue(e);this.out._activateSignal(e)}getClassName(){return e.ClassName}serialize(e){super.serialize(e),e.isDo=this.config?.isDo}constructor(e){super(e),this.config=e,this.condition=this.registerDataInput("condition",RichTypeBoolean),this.loopBody=this._registerSignalOutput("loopBody")}};FlowGraphWhileLoopBlock.ClassName="FGWhileLoopBlock",RegisterClass(FlowGraphWhileLoopBlock.ClassName,FlowGraphWhileLoopBlock);var gltfToFlowGraphTypeMap={"lifecycle/onStart":FlowGraphSceneReadyEventBlock.ClassName,"lifecycle/onTick":FlowGraphSceneTickEventBlock.ClassName,log:FlowGraphConsoleLogBlock.ClassName,"flow/delay":FlowGraphTimerBlock.ClassName,"customEvent/send":FlowGraphSendCustomEventBlock.ClassName,"customEvent/receive":FlowGraphReceiveCustomEventBlock.ClassName,"flow/sequence":FlowGraphSequenceBlock.ClassName,"world/get":FlowGraphGetPropertyBlock.ClassName,"world/set":FlowGraphSetPropertyBlock.ClassName,"flow/doN":FlowGraphDoNBlock.ClassName,"variable/get":FlowGraphGetVariableBlock.ClassName,"variable/set":FlowGraphSetVariableBlock.ClassName,"flow/whileLoop":FlowGraphWhileLoopBlock.ClassName,"math/random":FlowGraphRandomBlock.ClassName,"math/e":FlowGraphEBlock.ClassName,"math/pi":FlowGraphPiBlock.ClassName,"math/inf":FlowGraphInfBlock.ClassName,"math/nan":FlowGraphNaNBlock.ClassName,"math/abs":FlowGraphAbsBlock.ClassName,"math/sign":FlowGraphSignBlock.ClassName,"math/trunc":FlowGraphTruncBlock.ClassName,"math/floor":FlowGraphFloorBlock.ClassName,"math/ceil":FlowGraphCeilBlock.ClassName,"math/fract":FlowGraphFractBlock.ClassName,"math/neg":FlowGraphNegBlock.ClassName,"math/add":FlowGraphAddBlock.ClassName,"math/sub":FlowGraphSubtractBlock.ClassName,"math/mul":FlowGraphMultiplyBlock.ClassName,"math/div":FlowGraphDivideBlock.ClassName,"math/rem":FlowGraphRemainderBlock.ClassName,"math/min":FlowGraphMinBlock.ClassName,"math/max":FlowGraphMaxBlock.ClassName,"math/clamp":FlowGraphClampBlock.ClassName,"math/saturate":FlowGraphSaturateBlock.ClassName,"math/mix":FlowGraphInterpolateBlock.ClassName,"math/eq":FlowGraphEqBlock.ClassName,"math/lt":FlowGraphLessThanBlock.ClassName,"math/le":FlowGraphLessThanOrEqualBlock.ClassName,"math/gt":FlowGraphGreaterThanBlock.ClassName,"math/ge":FlowGraphGreaterThanOrEqualBlock.ClassName,"math/isnan":FlowGraphIsNanBlock.ClassName,"math/isinf":FlowGraphIsInfBlock.ClassName,"math/rad":FlowGraphDegToRadBlock.ClassName,"math/deg":FlowGraphRadToDegBlock.ClassName,"math/sin":FlowGraphSinBlock.ClassName,"math/cos":FlowGraphCosBlock.ClassName,"math/tan":FlowGraphTanBlock.ClassName,"math/asin":FlowGraphAsinBlock.ClassName,"math/acos":FlowGraphAcosBlock.ClassName,"math/atan":FlowGraphAtanBlock.ClassName,"math/atan2":FlowGraphAtan2Block.ClassName,"math/sinh":FlowGraphSinhBlock.ClassName,"math/cosh":FlowGraphCoshBlock.ClassName,"math/tanh":FlowGraphTanhBlock.ClassName,"math/asinh":FlowGraphAsinhBlock.ClassName,"math/acosh":FlowGraphAcoshBlock.ClassName,"math/atanh":FlowGraphAtanhBlock.ClassName,"math/exp":FlowGraphExpBlock.ClassName,"math/log":FlowGraphLogBlock.ClassName,"math/log2":FlowGraphLog2Block.ClassName,"math/log10":FlowGraphLog10Block.ClassName,"math/sqrt":FlowGraphSqrtBlock.ClassName,"math/cbrt":FlowGraphCubeRootBlock.ClassName,"math/pow":FlowGraphPowBlock.ClassName,"math/length":FlowGraphLengthBlock.ClassName,"math/normalize":FlowGraphNormalizeBlock.ClassName,"math/dot":FlowGraphDotBlock.ClassName,"math/cross":FlowGraphCrossBlock.ClassName,"math/rotate2d":FlowGraphRotate2DBlock.ClassName,"math/rotate3d":FlowGraphRotate3DBlock.ClassName,"math/transpose":FlowGraphTransposeBlock.ClassName,"math/determinant":FlowGraphDeterminantBlock.ClassName,"math/inverse":FlowGraphInvertMatrixBlock.ClassName,"math/matmul":FlowGraphMatMulBlock.ClassName,"math/not":FlowGraphBitwiseNotBlock.ClassName,"math/and":FlowGraphBitwiseAndBlock.ClassName,"math/or":FlowGraphBitwiseOrBlock.ClassName,"math/xor":FlowGraphBitwiseXorBlock.ClassName,"math/asr":FlowGraphBitwiseRightShiftBlock.ClassName,"math/lsl":FlowGraphBitwiseLeftShiftBlock.ClassName,"math/clz":FlowGraphCountLeadingZerosBlock.ClassName,"math/ctz":FlowGraphCountTrailingZerosBlock.ClassName,"math/popcnt":FlowGraphCountOneBitsBlock.ClassName},gltfTypeToBabylonType={float2:"Vector2",float3:"Vector3",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function convertValueWithType(e,t,i){if(void 0!==e.type){const a=t.types&&t.types[e.type];if(!a)throw new Error(`${i}: Unknown type: ${e.type}`);const n=a.signature;if(!n)throw new Error(`${i}: Type ${e.type} has no signature`);const s=gltfTypeToBabylonType[n];return{value:e.value,className:s}}return e.value}function convertConfiguration(e,t,i){const a={},n=e.configuration??[];for(const e of n)if("customEvent"===e.id){const n=t.customEvents&&t.customEvents[e.value];if(!n)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Unknown custom event: ${e.value}`);a.eventId=n.id,a.eventData=n.values.map((e=>e.id))}else if("variable"===e.id){const n=t.variables&&t.variables[e.value];if(!n)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Unknown variable: ${e.value}`);a.variableName=n.id}else if("path"===e.id){const t=e.value;a.path=t}else a[e.id]=convertValueWithType(e,t,`/extensions/KHR_interactivity/nodes/${i}`);return a}function convertBlock(e,t,i){const a=gltfToFlowGraphTypeMap[t.type];if(!a)throw new Error(`/extensions/KHR_interactivity/nodes/${e}: Unknown block type: ${t.type}`);const n=e.toString();return{className:a,config:convertConfiguration(t,i,n),Hc:n,metadata:t.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}function convertGLTFToSerializedFlowGraph(e){const t={Hc:RandomGUID(),_userVariables:{},_connectionValues:{}},i=[t],a=[];for(let t=0;t<e.nodes.length;t++){const i=convertBlock(t,e.nodes[t],e);a.push(i)}for(let i=0;i<e.nodes.length;i++){const n=e.nodes[i],s=a[i],r=n.flows??[];for(const e of r){const t=e.id,n={Hc:RandomGUID(),name:t,_connectionType:1,connectedPointIds:[]};s.signalOutputs.push(n);const r=e.node,o=e.socket,l=a[r];if(!l)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Could not find node with id ${r} that connects its input with with node ${i}'s output ${t}`);let c=l.signalInputs.find((e=>e.name===o));c||(c={Hc:RandomGUID(),name:o,_connectionType:0,connectedPointIds:[]},l.signalInputs.push(c)),c.connectedPointIds.push(n.Hc),n.connectedPointIds.push(c.Hc)}const o=n.values??[];for(const n of o){const r=n.id,o={Hc:RandomGUID(),name:r,_connectionType:0,connectedPointIds:[]};if(s.dataInputs.push(o),void 0!==n.value){const a=convertValueWithType(n,e,`/extensions/KHR_interactivity/nodes/${i}`);t._connectionValues[o.Hc]=a}else{if(void 0===n.node||void 0===n.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Invalid socket ${r} in node ${i}`);{const e=n.node,t=n.socket,s=a[e];if(!s)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Could not find node with id ${e} that connects its output with node${i}'s input ${r}`);let l=s.dataOutputs.find((e=>e.name===t));l||(l={Hc:RandomGUID(),name:t,_connectionType:1,connectedPointIds:[]},s.dataOutputs.push(l)),o.connectedPointIds.push(l.Hc),l.connectedPointIds.push(o.Hc)}}}}const n=e.variables??[];for(let i=0;i<n.length;i++){const a=n[i],s=a.id;t._userVariables[s]=convertValueWithType(a,e,`/extensions/KHR_interactivity/variables/${i}`)}return{allBlocks:a,executionContexts:i}}var InteractivityPathToObjectConverter=class extends GLTFPathToObjectConverter{constructor(e){super(e,gltfTree)}},nodesTree2={__array__:{__target__:!0,translation:{type:"Vector3",get:e=>e._babylonTransformNode.position,set:(e,t)=>{t._babylonTransformNode.position=e},getObject:e=>e._babylonTransformNode}}},gltfTree={nodes:nodesTree2},NAME31="KHR_interactivity",KHR_interactivity=class{dispose(){this._loader=null,delete this._pathConverter}onReady(){if(!this._loader.babylonScene||!this._pathConverter)return;const e=this._loader.babylonScene,t=this._loader.gltf.extensions?.KHR_interactivity,i=convertGLTFToSerializedFlowGraph(t),a=new FlowGraphCoordinator({scene:e});FlowGraph.Parse(i,{coordinator:a,pathConverter:this._pathConverter}),a.start()}constructor(e){this._loader=e,this.name=NAME31,this.enabled=this._loader.isExtensionUsed(NAME31),this._pathConverter=new InteractivityPathToObjectConverter(this._loader.gltf)}};GLTFLoader2.RegisterExtension(NAME31,(e=>new KHR_interactivity(e)));var NAME32="ExtrasAsMetadata",ExtrasAsMetadata=class{loadCameraAsync(e,t,i){return this._loader.loadCameraAsync(e,t,(e=>{this._assignExtras(e,t),i(e)}))}_assignExtras(e,t){if(t.extras&&Object.keys(t.extras).length>0){const i=e.metadata=e.metadata||{};(i.gltf=i.gltf||{}).extras=t.extras}}constructor(e){this.name=NAME32,this.enabled=!0,this._loader=e}loadNodeAsync(e,t,i){return this._loader.loadNodeAsync(e,t,(e=>{this._assignExtras(e,t),i(e)}))}createMaterial(e,t,i){const a=this._loader.createMaterial(e,t,i);return this._assignExtras(a,t),a}dispose(){this._loader=null}};GLTFLoader2.RegisterExtension(NAME32,(e=>new ExtrasAsMetadata(e))),init_shaderStore(),init_clipPlaneFragmentDeclaration2(),init_logDepthDeclaration2(),init_clipPlaneFragment2(),init_logDepthFragment2();var name264="outlinePixelShader",shader264="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;uniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";ShaderStore.ShadersStore[name264]=shader264,init_shaderStore(),init_bonesDeclaration2(),init_bakedVertexAnimationDeclaration2(),init_morphTargetsVertexGlobalDeclaration2(),init_morphTargetsVertexDeclaration2(),init_clipPlaneVertexDeclaration2(),init_instancesDeclaration2(),init_logDepthDeclaration2(),init_morphTargetsVertexGlobal2(),init_morphTargetsVertex2(),init_instancesVertex2(),init_bonesVertex2(),init_bakedVertexAnimation2(),init_clipPlaneVertex2(),init_logDepthVertex2();var name265="outlineVertexShader",shader265="attribute vec3 position;attribute vec3 normal;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;uniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{vec3 positionUpdated=position;vec3 normalUpdated=normal;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\nvec3 offsetPosition=positionUpdated+(normalUpdated*offset);\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(offsetPosition,1.0);gl_Position=viewProjection*worldPos;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n}\n";ShaderStore.ShadersStore[name265]=shader265,Scene.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new OutlineRenderer(this)),this._outlineRenderer},Object.defineProperty(Mesh.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOutline=e},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOverlay=e},enumerable:!0,configurable:!0});var OutlineRenderer=class e{constructor(e){this.name=SceneComponentConstants.NAME_OUTLINERENDERER,this.zOffset=1,this.zOffsetUnits=4,this.scene=e,this._engine=e.getEngine(),this.scene._addComponent(this),this._passIdForDrawWrapper=[];for(let e=0;e<4;++e)this._passIdForDrawWrapper[e]=this._engine.createRenderPassId(`Outline Renderer (${e})`)}rebuild(){}_beforeRenderingMesh(t,i,a){if(this._savedDepthWrite=this._engine.getDepthWrite(),t.renderOutline){const n=i.getMaterial();n&&n.needAlphaBlendingForMesh(t)&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(7681),this._engine.setStencilFunction(519),this._engine.setStencilMask(e._StencilReference),this._engine.setStencilFunctionReference(e._StencilReference),this._engine.stencilStateComposer.useStencilGlobalOnly=!0,this.render(i,a,!0,this._passIdForDrawWrapper[1]),this._engine.setColorWrite(!0),this._engine.setStencilFunction(517)),this._engine.setDepthWrite(!1),this.render(i,a,!1,this._passIdForDrawWrapper[0]),this._engine.setDepthWrite(this._savedDepthWrite),n&&n.needAlphaBlendingForMesh(t)&&(this._engine.stencilStateComposer.useStencilGlobalOnly=!1,this._engine.restoreStencilState())}}render(e,t,i=!1,a){a=a??this._passIdForDrawWrapper[0];const n=this.scene,s=n.getEngine(),r=s.getCaps().instancedArrays&&(null!==t.visibleInstances[e._id]&&void 0!==t.visibleInstances[e._id]||e.getRenderingMesh().hasThinInstances);if(!this.isReady(e,r,a))return;const o=e.getMesh(),l=o._internalAbstractMeshDataInfo._actAsRegularMesh?o:null,c=e.getRenderingMesh(),h=l||c,u=e.getMaterial();if(!u||!n.activeCamera)return;const m=e._getDrawWrapper(a),d=DrawWrapper.GetEffect(m);if(s.enableEffect(m),u.useLogarithmicDepth&&d.setFloat("logarithmicDepthConstant",2/(Math.log(n.activeCamera.maxZ+1)/Math.LN2)),d.setFloat("offset",i?0:c.outlineWidth),d.setColor4("color",i?c.overlayColor:c.outlineColor,i?c.overlayAlpha:u.alpha),d.setMatrix("viewProjection",n.getTransformMatrix()),d.setMatrix("world",h.getWorldMatrix()),c.useBones&&c.computeBonesUsingShaders&&c.skeleton&&d.setMatrices("mBones",c.skeleton.getTransformMatrices(c)),c.morphTargetManager&&c.morphTargetManager.isUsingTextureForTargets&&c.morphTargetManager._bind(d),BindMorphTargetParameters(c,d),r||c._bind(e,d,u.fillMode),u&&u.needAlphaTesting()){const e=u.getAlphaTestTexture();e&&(d.setTexture("diffuseSampler",e),d.setMatrix("diffuseMatrix",e.getTextureMatrix()))}bindClipPlane(d,u,n),s.setZOffset(-this.zOffset),s.setZOffsetUnits(-this.zOffsetUnits),c._processRendering(h,e,d,u.fillMode,t,r,((e,t)=>{d.setMatrix("world",t)})),s.setZOffset(0),s.setZOffsetUnits(0)}isReady(e,t,i){i=i??this._passIdForDrawWrapper[0];const a=[],n=[VertexBuffer.PositionKind,VertexBuffer.NormalKind],s=e.getMesh(),r=e.getMaterial();if(!r)return!1;const o=s.getScene();r.needAlphaTesting()&&(a.push("#define ALPHATEST"),s.isVerticesDataPresent(VertexBuffer.UVKind)&&(n.push(VertexBuffer.UVKind),a.push("#define UV1")),s.isVerticesDataPresent(VertexBuffer.UV2Kind)&&(n.push(VertexBuffer.UV2Kind),a.push("#define UV2"))),r.useLogarithmicDepth&&a.push("#define LOGARITHMICDEPTH"),prepareStringDefinesForClipPlanes(r,o,a),s.useBones&&s.computeBonesUsingShaders?(n.push(VertexBuffer.MatricesIndicesKind),n.push(VertexBuffer.MatricesWeightsKind),s.numBoneInfluencers>4&&(n.push(VertexBuffer.MatricesIndicesExtraKind),n.push(VertexBuffer.MatricesWeightsExtraKind)),a.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),a.push("#define BonesPerMesh "+(s.skeleton?s.skeleton.bones.length+1:0))):a.push("#define NUM_BONE_INFLUENCERS 0");const l=s.morphTargetManager;let c=0;l&&(c=l.numMaxInfluencers||l.numInfluencers,c>0&&(a.push("#define MORPHTARGETS"),a.push("#define NUM_MORPH_INFLUENCERS "+c),l.isUsingTextureForTargets&&a.push("#define MORPHTARGETS_TEXTURE"),PrepareAttributesForMorphTargetsInfluencers(n,s,c))),t&&(a.push("#define INSTANCES"),PushAttributesForInstances(n),e.getRenderingMesh().hasThinInstances&&a.push("#define THIN_INSTANCES"));const h=e._getDrawWrapper(i,!0),u=h.defines,m=a.join("\n");if(u!==m){const e=["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices"];addClipPlaneUniforms(e),h.setEffect(this.scene.getEngine().createEffect("outline",n,e,["diffuseSampler","morphTargets"],m,void 0,void 0,void 0,{maxSimultaneousMorphTargets:c}),m)}return h.effect.isReady()}dispose(){for(let e=0;e<this._passIdForDrawWrapper.length;++e)this._engine.releaseRenderPassId(this._passIdForDrawWrapper[e])}register(){this.scene._beforeRenderingMeshStage.registerStep(SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)}_afterRenderingMesh(e,t,i){if(e.renderOverlay){const e=this._engine.getAlphaMode(),a=this._engine.alphaState.alphaBlend;this._engine.setAlphaMode(2),this.render(t,i,!0,this._passIdForDrawWrapper[3]),this._engine.setAlphaMode(e),this._engine.setDepthWrite(this._savedDepthWrite),this._engine.alphaState.alphaBlend=a}e.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(t,i,!1,this._passIdForDrawWrapper[2]),this._engine.setColorWrite(!0))}};OutlineRenderer._StencilReference=4;var fbAppId="503435033333554",version=null,lastVer=null,consent=void 0,ready_startup=!1,ready_auth=!1,ready_paperDoll=!1,ready_mapMeshes=!1,ready_ping=!1,timerPlayStart="",shadowGen,camera,gameStartTime,settings={},controls={},optimizer,adBlocker=!1,inGame=!1,paperDoll=null,isGettingChicknWinnerReward=!1,servicesToken=null,playOffline=!1,playerAccount=null,inputToControlMap={},stampTexture,observingGame=!1,watchPlayer=null,gameType,privateGame,gameCode,mapIdx,mapTest={},freezeFrame=!1,noSkybox=!1,testing=!1,multisizeBannerDisplayed=!1,checkedForReward=!1,timesPlayed,firebaseUi=null,anonymousUser=null,firebaseUser=null,signingIn=!1,upgradingAnon=!1,xsollaToken=null,reward=null,purchasingEnabled=!1,isRunning=!1,debugArray=[],debugObject={},pingTotal,pingSamples,nextPingSample,highestPing=0,fpsTotal,fpsSamples,fpsAverage,linkItemShown=!1,showTaggedItems=null,showNugget=null,bigAdTimeout,adTest=!1,lastAdProvider=null,bigAdIdx,smallAdIdx,smallAdRotateInterval=null,smallAdRotateTimeout=null,smallAdLastIdx=null,aipPrerollPlayer,houseAds=[],houseAdsLoaded=!1,newsItems=[],applixirAdWatched=!1,chatInEl,chatOutEl,killEl,nameTestCanvas=document.createElement("canvas"),joinType,isPrivateGame,joinedAs,autoInvite=!1,isGameOwner,gameIsOwnerLocked=!1,viewingPlayerId,myTeam,aipBannerDisplayed=!1,lastBannerLoaded,isPlayingVideoAd=!1,aipMultisizeTag="shellshock-io_multisize",gamePaused=!0,browserLanguage=navigator.language,userSetLanguage,afterVideoAdComplete,playerContent=null,adTagDebug=parsedUrl.query.debug,isAcsVideoPlayer=!1,ascVideoPlayed=!0,selectedSku=null,firebaseSignInTimerStart,videoRewardValue=100,loginProviderId=null,hasAccount=!1,creatingAccount=!1,pwaReady=!1,pwaDeferredPrompt="",shellProducts=null,vipSubEnded=!1,passEnded=!1,adInPlayActive=!1,discordRewardClick=0,adBlockerVideoTimer=1e4,mobileRewardLog="Mobile Reward: ",tryMidMonthRewardAgain=!1,signinClicked=!1,chicknWinner=null,rewardAdReady=!1,shloopyBloopers=5831,hasPlayBeenPressed=!1,newGameStart=!0,joinGameAttempted=!1,openShopOnly=!1,clientId=null,PhotoBooth,tutorialShowing=!1,gameOptions,SessionStats,canvasClasses=["is-paused","roundme_md"],canvasWrapper,firstGamePlayed=!1,showSigninBonus=!1,showResendEmailPopup=!1,AIPVideoAds=null,hasTimesPlayed=!1,playPressed=!1,playerChallengeRequest=!1,playerChallenges=null,ShellNews=[],AbFreeGamesRedirect=null,AbUrlTestParam=null,playerUpgraded=!1,isChromeSuxPointerAllowed=!0,isWelcomeBundlePurchased=!1,welcomePassSku="pass_welcome",welcomePassItemId=15084,firebaseDone=!1,firebaseUrl=null,fullMeshLoad=!1,RewardNoobGrenade,socialRewardClick={discord:0,ticTok:0},shellStreakUi={},PremMeshNames={},urlRewardParams=["midMonthGiveMeEggs","newYolkerSignupReward","newYolkerItemReward","newYolkerWelcomeBack","WelcomeBack","mercZoneFinalGift","merryEggsmas"],inGameItemReward=[16029],premFeatTag={premFeatOne:0,premFeatTwo:0},teamColors={text:["#fff100","#00ffff","#f53e40"],meBackground:["rgba(255, 192, 64, 0.75)","rgba(0, 192, 255, 0.8)","rgba(192, 64, 32, 0.8)"],themBackground:["rgba(0, 0, 0, 0.25)","rgba(0, 64, 192, 0.3)","rgba(192, 64, 32, 0.3)"],summaryBackground:["rgba(64, 64, 64, 0.75)","rgba(0, 64, 192, 0.75)","rgba(192, 64, 32, 0.75)"],outline:[new Color4(1,1,1,-1),new Color4(0,.75,1,.3),new Color4(1,.25,.25,.3)],textColor:[new Color4(1,1,1,1),new Color4(0,.75,1,1),new Color4(1,.25,.25,1)],meClass:["playerSlot-me","playerSlot-me-blue","playerSlot-me-red"],hb:["playerSlot-them","playerSlot-them-blue","playerSlot-them-red"]},ItemSearchSettings={isCaseSensitive:!1,includeScore:!0,shouldSort:!0,includeMatches:!0,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.2,distance:100,useExtendedSearch:!0,keys:["name","unlock","item_data.tags","item_data.meshName"]},adsLoaded=!1,changelogData=[{version:"1.0",date:"Apr 1 2025",content:["EGG ORG have returned from the shadows! Sides have been drawn & only one will win!","The winning side will unlock a special skin for all eggs!","Get more info, check the score & change sides by clicking the banner on the homescreen","Changing teams is possible but costly!","EGG ORG are messing with eggtopia, all killstreak bonuses are now RANDOM!","Be the biggest egg in the Dojo with the latest Premium Sumo Hat - in-store & free for VIPs ","Upgraded database to the latest SQL version - let us know if something is unusual... more than normal.","Enjoy the latest map, Yolkido, in public and private lobbies","Moved Outer Reach, Facility, Timetwist, Jailbreak, Wreckage & Exposure to the Public map pool","Moved Uncovered, Foundation, Metamorph, Shipyard, Road, Shellville & Cash to the Private map pool"]}],SsProducts=[{itemIds:null,sku:"egg_pack_small",name:"Small Pack",price:3,salePrice:5,flagText:"",type:"currency",inStore:1,currency:3e4,isActive:!0,id:1},{itemIds:null,sku:"egg_pack_medium",name:"Medium Pack",price:6,salePrice:10,flagText:"",type:"currency",inStore:1,currency:65e3,isActive:!0,id:2},{itemIds:null,sku:"egg_pack_large",name:"Large Pack",price:12,salePrice:20,flagText:"",type:"currency",inStore:1,currency:15e4,isActive:!0,id:3},{itemIds:null,sku:"egg_pack_giant",name:"Giant Pack",price:50,salePrice:25,flagText:"p_egg_shop_bestvalue",type:"currency",inStore:0,currency:5e4,isActive:!0,id:4},{itemIds:null,sku:"golden_chicken_pass",name:"Golden Chicken Pass",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1,id:5},{itemIds:null,sku:"chicken_nugget_pass",name:"Chicken Nugget Pass",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1,id:6},{itemIds:null,sku:"test_nugget_pass",name:"Test Nugget",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1,id:7},{itemIds:[4223],sku:"item_gun_m24_techno",name:"Untz Untz Gun",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:8},{itemIds:[1112],sku:"item_hat_yolk_arms",name:"Yolk Arms",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:9},{itemIds:[1105],sku:"item_hat_cape",name:"Magic Cape",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:10},{itemIds:[1092],sku:"item_hat_dragon",name:"GoE Dragon",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:11},{itemIds:[1110],sku:"item_hat_space_gladi",name:"Space Gladiator",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:12},{itemIds:[1126],sku:"item_hat_zombie_mask",name:"Zombie Mask",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:13},{itemIds:[3016],sku:"item_gun_9mm_space",name:"Cluck 9mm Space Egg",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:14},{itemIds:[1125],sku:"item_hat_oni",name:"Oni Hat",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:15},{itemIds:[3416],sku:"item_gun_csg1_space",name:"CSG1 Space Egg Skin",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:16},{itemIds:[1160],sku:"item_hat_galeggsy",name:"Galeggsy Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:17},{itemIds:[3025],sku:"item_gun_9mm_techno",name:"Cluck 9mm Techno",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:18},{itemIds:[1171],sku:"item_hat_rooter_wing",name:"Rooster Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:19},{itemIds:[4026],sku:"item_gun_smg_techno",name:"Tuh SMG",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:20},{itemIds:[1174],sku:"item_hat_demon_wings",name:"Demon Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:21},{itemIds:[3627],sku:"gun_gauge_techno",name:"Badoosh Dozen Gauge",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:22},{itemIds:[1184],sku:"item_hat_fallen_wing",name:"Fallen Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:23},{itemIds:[3426],sku:"item_gun_csg1_techno",name:"CSG1 Techno Catz",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:24},{itemIds:[1185,2204,16011],sku:"1oOnkjL7",name:"1 month membership",price:699,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!0,id:25},{itemIds:[1185,2204,16011],sku:"K5JjxL1z",name:"3 month membership",price:1499,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!0,id:26},{itemIds:[1185,2204,16011],sku:"TymKKdoQ",name:"12 month membership",price:4999,salePrice:null,flagText:"p_egg_shop_bestvalue",type:"subscription",inStore:0,currency:0,isActive:!0,id:27},{itemIds:[1185,2204,16011],sku:"item_hat_golden_wing",name:"Golden Wings",price:null,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:28},{itemIds:[1186],sku:"item_hat_chrome_wing",name:"Chrome Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:29},{itemIds:[3126],sku:"gun_eggk47_techno",name:"Eggk Poggers",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:30},{itemIds:[1193],sku:"item_hat_steamWings",name:"Steampunk Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:31},{itemIds:[3828],sku:"item_gun_rpeggTechno",name:"RPEGGTechno",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:32},{itemIds:[3029],sku:"item_gun_retro_9mm",name:"Retro Skin Cluck9mm",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:33},{itemIds:[1195],sku:"item_hat_pixel_wings",name:"Angel Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:34},{itemIds:[16014],sku:"item_gre_skullnado",name:"Skullnado",price:7,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:35},{itemIds:[1202],sku:"item_hat_skull_wings",name:"Skull Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:36},{itemIds:[4512],sku:"item_gun_aug_retro",name:"Retro TriHard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:37},{itemIds:[1215],sku:"item_hat_robot_wings",name:"Robot Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:38},{itemIds:[16019],sku:"item_gre_unicorn",name:"Unicorn Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:39},{itemIds:[1222],sku:"item_hat_uni_wing",name:"Unicorn Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:40},{itemIds:[4229],sku:"item_gun_m24_retro",name:"M2DZ Retro Skin",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:41},{itemIds:[1226],sku:"item_hat_fairy_wings",name:"Fairy Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:42},{itemIds:[16023],sku:"item_gre_toilet_papr",name:"Grenade Toilet Paper",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:43},{itemIds:[1232],sku:"item_hat_toilet_papr",name:"Hat Toilet Paper",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:44},{itemIds:[3431],sku:"item_gun_csg1_retro",name:"CSG1 Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:45},{itemIds:[1235],sku:"item_hat_pixel_fire",name:"Fire Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:46},{itemIds:[16027],sku:"item_gre_glitterbomb",name:"Grenade Glitterbomb",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:47},{itemIds:[1241],sku:"item_hat_glitch_wing",name:"Glitch Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:48},{itemIds:[3634],sku:"item_gun_crack_retro",name:"Scrambler Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:49},{itemIds:[1245],sku:"item_hat_moth_wings",name:"Moth Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:50},{itemIds:[16032],sku:"item_gre_thermal",name:"Grenade Thermal Detonator",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:51},{itemIds:[1248],sku:"hat_thermal_wings",name:"Thermal Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:52},{itemIds:[4032],sku:"item_gun_smg_retro",name:"SMEGG Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:53},{itemIds:[1269],sku:"item_hat_pixel_butt",name:"Pixel Butterfly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:54},{itemIds:[1272],sku:"item_hat_pixel_bird",name:"Pixel Bird Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:55},{itemIds:[16036],sku:"item_gre_supernova",name:"Grenade Supernova",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:56},{itemIds:[16038],sku:"item_gre_octopus",name:"Grenade Octopus",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:57},{itemIds:[3835],sku:"item_gun_rpegg_retro",name:"RPEGG Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:58},{itemIds:[1212],sku:"item_hat_dog_cap",name:"Dog Cap",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:59},{itemIds:[1044],sku:"item_hat_egg_glasses",name:"Egg Glasses",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:60},{itemIds:[1288],sku:"item_hat_luckywings",name:"Lucky Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:61},{itemIds:[1290],sku:"item_hat_ukraine",name:"Ukraine Bandana",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:62},{itemIds:[3637],sku:"item_gun_bros",name:"Dozen Gauge Bros",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:63},{itemIds:[4528],sku:"item_gun_valk_aug",name:"Trihard Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:64},{itemIds:[16041],sku:"item_gre_diablo",name:"Grenade Diablo",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:65},{itemIds:[3134],sku:"item_gun_ak_retro",name:"Eggk47 Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:66},{itemIds:[3136],sku:"item_gun_ak_valkyrie",name:"Eggk47 Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:67},{itemIds:[1312],sku:"item_hat_dinowings",name:"Dino Pterodactyl Win",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:68},{itemIds:[1316],sku:"item_hat_airplane",name:"Airplane Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:69},{itemIds:[1320],sku:"item_hat_crosswing",name:"Cross Fighter",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:70},{itemIds:[16044],sku:"item_gre_bumble",name:"Grenade Bumblebee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:71},{itemIds:[3642],sku:"item_gauge_valk",name:"Valkyrie Scrambler",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:72},{itemIds:[16046],sku:"item_gre_football",name:"Grenade Football",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:73},{itemIds:[16048],sku:"item_gre_valk",name:"Grenade Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:74},{itemIds:[3439],sku:"item_csg1_rubchick",name:"CSG1 Rubber Chicken",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:75},{itemIds:[16049],sku:"item_gre_milk",name:"Grenade Milk",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:76},{itemIds:[4240],sku:"item_gun_m24_scav",name:"Crackshot Scavenger",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:77},{itemIds:[3045],sku:"item_gun_9mm_valk",name:"Cluck 9mm Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:78},{itemIds:[1341],sku:"item_hat_rainbow",name:"Rainbow Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:79},{itemIds:[3441],sku:"item_range_valk",name:"Free-Ranger Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:80},{itemIds:[1349],sku:"item_hat_teggtris",name:"Teggtris wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:81},{itemIds:[16054],sku:"item_gre_blood",name:"Grenade Blood",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:82},{itemIds:[1356],sku:"item_hat_bloodwing",name:"Blood Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:83},{itemIds:[3843],sku:"item_gun_rpegg_valk",name:"RPEGG Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:84},{itemIds:[4040],sku:"item_gun_smg_turk",name:"Turkey-Supreme Whipp",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:85},{itemIds:[4242],sku:"item_gun_m24_valk",name:"Crackshot Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:86},{itemIds:[1363],sku:"item_hat_fall",name:"Fall Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:87},{itemIds:[3844],sku:"item_rpegg_christ",name:"RPEGG Santa Boot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:88},{itemIds:[1369],sku:"item_holy_wings",name:"Holly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:89},{itemIds:[4042],sku:"item_gun_smg_valk",name:"Whipper Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:90},{itemIds:[1372,3650],sku:"item_jan_2023",name:"Jan2023 Bundle",price:10,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:91},{itemIds:[3443],sku:"item_csg1_fusion",name:"Free-Ranger Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:92},{itemIds:[1372],sku:"item_hat_soundwave",name:"Sound Wave Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:93},{itemIds:[3650],sku:"item_gauge_octopus",name:"Octopus Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:94},{itemIds:[3050],sku:"item_9mm_cloud",name:"Cluck 9mm Clouds",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:95},{itemIds:[3142],sku:"item_ak47_fusion",name:"Eggk47 Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:96},{itemIds:[16059],sku:"item_gre_pail",name:"Slop Bucket Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:97},{itemIds:[1389],sku:"item_hat_harp",name:"Harp Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:98},{itemIds:[4044],sku:"item_smg_fusion",name:"Whipper Fusion",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:99},{itemIds:[1394],sku:"item_hat_hooped",name:"Hooped",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:100},{itemIds:[3654],sku:"item_gauge_monster",name:"Beholder Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:101},{itemIds:[1400],sku:"item_qwings",name:"Question Block Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:102},{itemIds:[3054],sku:"item_9mm_fusion",name:"Cluck 9mm Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:103},{itemIds:[15023],sku:"item_melee_stone",name:"Stone Hammer Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:104},{itemIds:[3445],sku:"item_csg1_shellpreme",name:"Free-Ranger Shellpre",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:105},{itemIds:[3655],sku:"item_gauge_fusion",name:"Fusion Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:106},{itemIds:[3055],sku:"item_9mm_camera",name:"Cluck 9mm Camera",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:107},{itemIds:[1417],sku:"item_hat_surf",name:"Octopus Surfboard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:108},{itemIds:[15013],sku:"item_melee_valk",name:"Melee Valkyrie",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:109},{itemIds:[15030],sku:"item_melee_fusion",name:"The Fusion Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:110},{itemIds:[1423],sku:"item_hat_scales",name:"Scales of Justice",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:111},{itemIds:[1225,3420,4208,16013],sku:"bun_master_items",name:"Master items",price:10,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:112},{itemIds:[4540],sku:"item_aug_fusion",name:"Fusion Trihard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:113},{itemIds:[1428],sku:"item_hat_glider",name:"Glider Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:114},{itemIds:[16064],sku:"item_gre_timebomb",name:"Timebomb Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:115},{itemIds:[1349,2157,3029,4039],sku:"bun_gamer",name:"Gamer Bundle",price:8,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:116},{itemIds:[1185,2204,16011],sku:"kD7geYv2",name:"12 month membership",price:4999,salePrice:null,flagText:"p_egg_shop_bestvalue",type:"subscription",inStore:0,currency:0,isActive:!1,id:117},{itemIds:[1185,2204,16011],sku:"gCLa2qqV",name:"1 month membership",price:699,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!1,id:118},{itemIds:[1185,2204,16011],sku:"x0iYBjs4",name:"3 month membership",price:1499,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!1,id:119},{itemIds:[15037],sku:"item_melee_cat",name:"Harrison Cat Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:120},{itemIds:[3059],sku:"item_9mm_mega",name:"Megaphone Cluck 9mm",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:121},{itemIds:[1118,2242,3060,15040],sku:"bun_cat",name:"Cats Pajamas Bundle",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:122},{itemIds:[1445],sku:"item_hat_wbs",name:"The Grand Entrance W",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:123},{itemIds:[4248],sku:"item_m24_fusion",name:"The Fusion Crackshot",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:124},{itemIds:[1450],sku:"item_hat_demonpixel",name:"Demon Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:125},{itemIds:[3951],sku:"item_rpegg_fusion",name:"Fusion RPEGG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:126},{itemIds:[1031,2454,3035,16054],sku:"bun_demon",name:"Demonic Bundle",price:4,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:127},{itemIds:[3952],sku:"item_rpegg_skele",name:"Skellington RPEGG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:128},{itemIds:[3149],sku:"item_ak_infernal",name:"Infernal Eggk47",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:129},{itemIds:[1107,2467,15045,16062],sku:"bun_mayan",name:"Mayan Bundle",price:7,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:130},{itemIds:[1461],sku:"item_hat_mayan",name:"Ruins Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:131},{itemIds:[15045],sku:"item_melee_mayan",name:"Mayan Macuahuitl",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:132},{itemIds:[1465],sku:"item_hat_breadcat",name:"Bread Cat",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:133},{itemIds:[15047],sku:"item_melee_turkcar",name:"The Turkey Carver",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:134},{itemIds:[1465,2372,15025,16022],sku:"bun_breadcat",name:"BreadCat Bundle",price:7,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:135},{itemIds:[1470],sku:"item_hat_owl",name:"Snow Owl Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:136},{itemIds:[1263,2229,3844,15049],sku:"bun_mistle",name:"Mistletoe Bundle",price:9,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:137},{itemIds:[4253],sku:"item_m24_infernal",name:"Infernal Crackshot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:138},{itemIds:[1475],sku:"item_hat_disco",name:"Disco Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:139},{itemIds:[3455],sku:"item_csg1_infernal",name:"Infernal CSG1",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:140},{itemIds:[1480],sku:"item_hat_racecar",name:"Racecar Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:141},{itemIds:[16071],sku:"item_gre_racecar",name:"Pireggi Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:142},{itemIds:[3455,16071],sku:"bun_Jan24",name:"Jan Bundle",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:143},{itemIds:[3662],sku:"item_gauge_cloud",name:"Cloudkicker Scramble",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:144},{itemIds:[1389,2488,4546,16037],sku:"bun_cupid",name:"The Cupid Bundle",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:145},{itemIds:[16074],sku:"item_gre_fusion",name:"Fusion Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:146},{itemIds:[15055],sku:"item_melee_worldcup",name:"World Cup Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:147},{itemIds:[3663],sku:"item_gauge_irish",name:"Irish Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:148},{itemIds:[1494,2500,3021,16016],sku:"bun_badbunny",name:"Bad Bunny Bundle",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:149},{itemIds:[3058],sku:"item_9mm_infernal",name:"Infernal Cluck 9mm",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:150},{itemIds:[3154],sku:"item_ak_choc",name:"gun_eggk47_Chocolate",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:151},{itemIds:[4256],sku:"item_m24_cyborg",name:"Cyborg Crackshot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:152},{itemIds:[1503,2519,3951,16078],sku:"bun_borg",name:"Borged Egg Bundle",price:9,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:153},{itemIds:[15060],sku:"item_melee_gfish",name:"Goldfish Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:154},{itemIds:[4550],sku:"item_aug_infernal",name:"Infernal Tri-hard",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:155},{itemIds:[4258],sku:"item_m24_quack",name:"The Quackshot",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:156},{itemIds:[1232,2187,15061,16023],sku:"bun_toilet",name:"Toilet Bundle",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:157},{itemIds:[1510],sku:"item_hat_waffle",name:"Golden Waffle Wings",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:158},{itemIds:[4054],sku:"item_smg_infernal",name:"Infernal SMG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:159},{itemIds:[1516],sku:"item_hat_dfly",name:"Dragonfly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:160},{itemIds:[1515,2551,15008,16054],sku:"bun_arach",name:"Arachnophobia Bundle",price:4,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:161},{itemIds:[15064],sku:"item_melee_pball",name:"Pickleball Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:162},{itemIds:[15063],sku:"item_melee_infernal",name:"Infernal Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:163},{itemIds:[4260],sku:"item_m24_chess",name:"The Checkmate Cracks",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:164},{itemIds:[1340,2562,3059,4240],sku:"bun_tactic",name:"Tactical Bundle",price:7,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:165},{itemIds:[3665],sku:"item_gauge_infernal",name:"Infernal Scrambler",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:166},{itemIds:[15066],sku:"item_melee_techno",name:"Techno Melee",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:167},{itemIds:[3157],sku:"item_ak_alien",name:"Alien Eggk47",price:0,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:168},{itemIds:[1539],sku:"item_hat_lighty",name:"Rizz Lightyear",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:169},{itemIds:[1538,2573,3655,16034],sku:"bun_zorg",name:"Zorg",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:170},{itemIds:[1544],sku:"item_hat_dlich",name:"Dracolich Wings ",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:171},{itemIds:[3958],sku:"item_rpegg_infernal",name:"Infernal RPEGG",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:172},{itemIds:[16081],sku:"item_gre_mort",name:"Mort Face Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:173},{itemIds:[1546,2584,15002,16044],sku:"bun_plant",name:"Plant Bundle",price:4,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:174},{itemIds:[1550],sku:"item_hat_raid",name:"The Raiders",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:175},{itemIds:[16082],sku:"item_gre_infernal",name:"Infernal Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:176},{itemIds:[1552],sku:"item_hat_neon",name:"Neon Birdo Mask",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:177},{itemIds:[1184,2592,3036,16083],sku:"bun_dove",name:"Dove from above",price:7,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:178},{itemIds:[4055],sku:"item_smg_jack",name:"Jackolantern Whipper",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:179},{itemIds:[15072],sku:"item_melee_pan",name:"Frying Pan Melee",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:180},{itemIds:[15074],sku:"item_melee_panegg",name:"Let Them Cook Melee",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:181},{itemIds:[1199,2600,15075,16041],sku:"bun_sc2",name:"Slayaway Bundle",price:5,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:182},{itemIds:[1559],sku:"item_hat_robo",name:"Robot Cop Hat",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:183},{itemIds:[4552],sku:"item_aug_pie",name:"The Pumpkin Pie-hard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:184},{itemIds:[1565],sku:"item_hat_sleigh",name:"Santa's Sleigh",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:185},{itemIds:[1365,2136,3038,15081],sku:"bun_santa",name:"Ol' Saint Nick Bun",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:186},{itemIds:[1073,4216,15084,16038],sku:"pass_welcome",name:"Welcome Bonus",price:1,salePrice:null,flagText:"",type:"pass",inStore:1,currency:5e4,isActive:!0,id:187},{itemIds:[15083],sku:"item_melee_frost",name:"Frostfall Whisk",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:188},{itemIds:[3961],sku:"item_rpegg_bfg",name:"The BFG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:189},{itemIds:[1569],sku:"item_hat_equal",name:"The Equalizer",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:190},{itemIds:[16088],sku:"item_gre_kettleb",name:"Kettlebell Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:191},{itemIds:[1573,2452,15060,16089],sku:"bun_catch",name:"What a Catch",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:192},{itemIds:[15085],sku:"item_melee_frod",name:"Fishing Rod Melee",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:193},{itemIds:[1574,2620,2622,3962,16090],sku:"drops_D7W1",name:"D7W1",price:500,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:194},{itemIds:[1575,1576,2618,2623,15086],sku:"drops_D7W2",name:"D7W2",price:500,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:195},{itemIds:[4554],sku:"item_aug_techno",name:"Techno Tri-Hard",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:196},{itemIds:[1578],sku:"item_hat_frost",name:"The Frostfall Wings",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:197},{itemIds:[4058],sku:"item_smg_irish",name:"Irish Whipper",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:198},{itemIds:[1579,2052,3963,15016],sku:"bun_min",name:"Wandering Minstrel",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1,id:199},{itemIds:[3070],sku:"item_9mm_frost",name:"Frostfall 9mm",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:200},{itemIds:[15087],sku:"item_melee_moai",name:"Moai Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1,id:201},{itemIds:[1588],sku:"item_hat_sumo",name:"Sumo suit",price:4,salePrice:null,flagText:"",type:"item",inStore:1,currency:0,isActive:!0,id:202},{itemIds:[1587,2167,3071,15088],sku:"bun_rd",name:"Red Dragon Bundle",price:6,salePrice:null,flagText:"",type:"bundle",inStore:1,currency:0,isActive:!0,id:203},{itemIds:[1589],sku:"item_hat_pixair",name:"Pixel Airplane Wings",price:5,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!0,id:204}],Items=[{id:1001,name:"Ball Cap",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ballCap",tags:["Green","White"]},is_available:!0,unlock:"default",align:{x:-.12075649338775385,y:-.2670312477499075,z:-.05526682671835026}},{id:1002,name:"Boat Fedora",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boatHat",tags:["Blue","Yellow"]},is_available:!0,unlock:"default",align:{x:-.06794416359249578,y:-.2926280197469384,z:-.031091489433501096}},{id:1003,name:"Top Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_topHat",tags:["Black","Grey","Gray"]},is_available:!0,unlock:"default",align:{x:-.07981952093539624,y:-.3437907063524166,z:-.036536185440272706}},{id:1004,name:"Derby Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_derby",tags:["Orange","Brown"]},is_available:!0,unlock:"default",align:{x:-.07446247955425545,y:-.32070966531188816,z:-.03407966061498702}},{id:1005,name:"Mountie Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mounty",tags:["Brown","Police"]},is_available:!0,unlock:"default",align:{x:-.07281390620627182,y:-.313607479576798,z:-.03332383477670581}},{id:1006,name:"Pablo Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowSheriff",tags:["Orange","Brown","Police","Meme"]},is_available:!0,unlock:"default",align:{x:-.07552652492916812,y:-.3252818085896001,z:-.03455986096692204}},{id:1007,name:"Blue Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaBlue",tags:["Blue"]},is_available:!0,unlock:"purchase",align:{x:-.007368110577478548,y:-.19183106931370097,z:-.0033645168072600345}},{id:1008,name:"Hero Mask",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batman",tags:["Black","Brown","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.08850633059890223,y:-.20411254048573135,z:-.04050447716602543}},{id:1009,name:"Cop Hat",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cop",tags:["Blue","Gold","Black"]},is_available:!0,unlock:"purchase",align:{x:-.09346306940354143,y:-.3048509545616378,z:-.04277696469919828}},{id:1010,name:"Robber Mask",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg2",tags:["Black","Purple"]},is_available:!0,unlock:"purchase",align:{x:-.06208516448358958,y:-.23382330506514326,z:-.030489917048234644}},{id:1011,name:"Red Bandana",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaRed",tags:["Red"]},is_available:!0,unlock:"purchase",align:{x:-.03329404211409126,y:-.09315583255063686,z:-.0338189869509566}},{id:1012,name:"Pink Bow",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bowPink",tags:["Pink"]},is_available:!0,unlock:"purchase",align:{x:-.07152407629324964,y:-.16299272012141341,z:-.03272766766614457}},{id:1013,name:"Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glasses",tags:["Black"]},is_available:!0,unlock:"purchase",align:{x:-.11215674530971143,y:-.12985890272324596,z:-.05132938270796705}},{id:1014,name:"Pompadour",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pompadour",tags:["Black","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.04210170142754954,y:-.1703824912060592,z:-.01927515951061251}},{id:1015,name:"Plague Doctor Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_plagueDoctor",tags:["Black"]},is_available:!0,unlock:"purchase",align:{x:-.14593688893752033,y:-.1458279454647442,z:-.06679311948184694}},{id:1016,name:"Poop Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_poop",tags:["Brown","Yellow","Gold","Poop"]},is_available:!0,unlock:"purchase",align:{x:-.07576287181211017,y:-.2815449537609993,z:-.047155212248999545}},{id:1017,name:"Unicorn Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_unicorn",tags:["Red","Orange","Yellow","Green","Blue","Silver","Rainbow"]},is_available:!0,unlock:"purchase",align:{x:-.008777315183921996,y:-.2019233629032106,z:-.004008638766223961}},{id:1018,name:"Baws Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pimp",tags:["Black","White","Grey","Gray","Purple"]},is_available:!0,unlock:"purchase",align:{x:-.07524018320712944,y:-.2980561083433546,z:-.04214661518926316}},{id:1019,name:"Pirate Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pirateHat",tags:["Black","Red"]},is_available:!0,unlock:"purchase",align:{x:.038701332916645015,y:-.33612905457241826,z:.017725198966349165}},{id:1023,name:"Hunting Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hunting",tags:["Red"]},is_available:!0,unlock:"purchase",align:{x:-.07052450007171451,y:-.24257874509170918,z:-.032275120288940806}},{id:1024,name:"Happy Bear Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_huntingBear",tags:["Pink","Heart","Cute"]},is_available:!0,unlock:"purchase",align:{x:-.09769183784970448,y:-.23620789822747934,z:-.04470940837408727}},{id:1025,name:"Crown",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crown",tags:["Gold","Red","Royal"]},is_available:!0,unlock:"purchase",align:{x:-.07916117268462308,y:-.3409402733304543,z:-.036456397957456144}},{id:1020,name:"ShellShockers Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shellshockers",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_hat",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/splat-hat",tags:["White","Brown","Egg"]},is_available:!1,unlock:"physical",align:{x:-.12105426939220987,y:-.26831388754484853,z:-.055403073383391954}},{id:1021,name:"Frying Pan",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fryingPan",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_pan",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/no-pans-tee",tags:["Black","Silver"]},is_available:!1,unlock:"physical",align:{x:-.11201926980773491,y:-.22758383372001356,z:.11466896053477657}},{id:1022,name:"Viking Horns",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_horns",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_shirt",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/logo-tee",tags:["Brown","Bone"]},is_available:!1,unlock:"physical",align:{x:-.1099168405070956,y:-.28237664010873953,z:-.05142539504200483}},{id:1026,name:"Jack O' Lantern Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkin",tags:["Halloween","Oct23","Orange","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.08877468412138612,y:-.35784089569708666,z:-.040628405489095076}},{id:1027,name:"Bat Wings",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batWings",tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase",align:{x:.02978222309901922,y:-.31216370123269704,z:.013630059749994518}},{id:1028,name:"Witch Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_witch",tags:["Halloween","Purple","Gold","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.08843731903919094,y:-.3808892641791377,z:-.040473991412663834}},{id:1029,name:"Axe-in-head",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_axe",tags:["Halloween","Oct23","Red","Brown","Wood","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.11495007537093782,y:-.36874335549165216,z:.049209529757712867}},{id:1030,name:"Executioner's Cowl",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_executioner",tags:["Halloween","Oct23","Red","Black","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.0390971212209168,y:-.2468287543633152,z:-.017893093144459582}},{id:1031,name:"Devil Horns",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_devilHorns",tags:["Halloween","Oct23","Red","Oct24","bun_demon"]},is_available:!1,unlock:"purchase",align:{x:-.15973168149370132,y:-.25177154715062167,z:-.0731024120297798}},{id:1032,name:"Angel Wings & Halo",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angel",tags:["Halloween","Oct23","Gold","White","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.0716592226014976,y:-.3086211609886207,z:-.032795385093542906}},{id:1033,name:"Hockey Mask",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hockeyMask",tags:["Halloween","Oct23","Black","White","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.07589509037547937,y:-.16818670050730733,z:-.0347356499804236}},{id:1034,name:"Pilgrim Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pilgrim",tags:["NovM23","Thanksgiving","Black","Brown","Gold","NovM24"]},is_available:!1,unlock:"purchase",align:{x:-.08367638664963417,y:-.3603847907294966,z:-.03829511470354685}},{id:1035,name:"Cooked Turkey Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turkeyDead",tags:["NovM23","Thanksgiving","Brown","NovM24"]},is_available:!1,unlock:"purchase",align:{x:-.08560931605836686,y:-.3608351087257782,z:-.039177128845210685}},{id:1036,name:"Turkey Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turkeyAlive",tags:["NovM23","Thanksgiving","Brown","Red","NovM24"]},is_available:!1,unlock:"purchase",align:{x:-.11404848303094717,y:-.39460177972163324,z:-.051068506334921826}},{id:1037,name:"Golden Chicken Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_Top1Percent",tags:["Reward","RewardTopPercent","Gold"]},is_available:!1,unlock:"manual",align:{x:-.12167748309378656,y:-.39821262976584126,z:-.055643594750763914}},{id:1038,name:"Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier1",tags:["Reward","RewardKills","Grey","Gray"]},is_available:!1,unlock:"manual",align:{x:-.10368928049503356,y:-.30866668214003234,z:-.03454567398459779}},{id:1039,name:"Bronze Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier2",tags:["Reward","RewardKills","Red","Brown"]},is_available:!1,unlock:"manual",align:{x:-.10368928049503356,y:-.30866668214003234,z:-.03454567398459779}},{id:1040,name:"Silver Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier3",tags:["Reward","RewardKills","Gray","Blue"]},is_available:!1,unlock:"manual",align:{x:-.10368928049503356,y:-.30866668214003234,z:-.03454567398459779}},{id:1041,name:"Gold Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier4",tags:["Reward","RewardKills","Gold","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.10368928049503356,y:-.30866668214003234,z:-.03454567398459779}},{id:1042,name:"Cracked Egg Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier1",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual",align:{x:-.11030323640447248,y:-.2896262491678324,z:.020385131504372322}},{id:1043,name:"Egg Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier2",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual",align:{x:-.048033927839143065,y:-.2180969454203714,z:-.021983090293065694}},{id:1044,name:"Egg Glasses",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier3",tags:["Reward","RewardDeaths","Yellow","White","MayM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_egg_glasses"],align:{x:-.12332005541021429,y:-.14104254579369258,z:-.0564383560017033}},{id:1045,name:"Cracked Egg Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier4",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual",align:{x:-.0981315547263597,y:-.3846123488611959,z:-.04491118067578559}},{id:1046,name:"Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier1",tags:["Reward","RewardKDR","Bone"]},is_available:!1,unlock:"manual",align:{x:-.16209354742210902,y:-.21191916844016578,z:-.07417661895069405}},{id:1047,name:"Bronze Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier2",tags:["Reward","RewardKDR","Red","Brown"]},is_available:!1,unlock:"manual",align:{x:-.16209354742210902,y:-.21191916844016578,z:-.07417661895069405}},{id:1048,name:"Silver Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier3",tags:["Reward","RewardKDR","Silver","Blue"]},is_available:!1,unlock:"manual",align:{x:-.16209354742210902,y:-.21191916844016578,z:-.07417661895069405}},{id:1049,name:"Gold Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier4",tags:["Reward","RewardKDR","Yellow","Gold"]},is_available:!1,unlock:"manual",align:{x:-.16209354742210902,y:-.21191916844016578,z:-.07417661895069405}},{id:1050,name:"Golden Egg Trophy",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier1",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.0890999824704708,y:-.3863056827916843,z:-.04038368444876095}},{id:1051,name:"Golden Faberge Egg Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier2",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.09461650809618338,y:-.4080207829771313,z:-.043304410336916344}},{id:1052,name:"Dollar Sign Glasses",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier3",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.12722235142344962,y:-.16985672809344665,z:-.05822427127650384}},{id:1053,name:"Golden Baws Hat",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier4",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.0767370155249445,y:-.3045029212488539,z:-.04283165181820048}},{id:1054,name:"Nate's Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headphones",tags:["Nate","Green","Black"]},is_available:!1,unlock:"manual",align:{x:-.05333618875843271,y:-.23311434767345263,z:-.024409710099744658}},{id:1055,name:"Reindeer Antlers",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_reindeer",tags:["Dec23","Christmas","Green","Red","Brown","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.08044681365354378,y:-.3563788865655062,z:-.036817092584971345}},{id:1056,name:"Elf Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_elf",tags:["Dec23","Christmas","Green","Red","Gold","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.10117501028704234,y:-.3587848770061639,z:.0009369108254608793}},{id:1057,name:"Santa Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santa",tags:["Dec23","Christmas","White","Red","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.08867192605372676,y:-.3103943980263475,z:.00330065841716054}},{id:1058,name:"Party Hat 2019",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party",tags:["NewYears","2019","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1059,name:"Headband 2019",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2019",tags:["NewYears","2019","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09701051785922554,y:-.36462418466845886,z:-.044397597085921225}},{id:1060,name:"Happy New Yolk Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_newYolk",tags:["NewYears","Black","Gold","Yellow","DecM24"]},is_available:!1,unlock:"purchase",align:{x:-.08047965861827411,y:-.44975516111728364,z:-.08518973241487715}},{id:1061,name:"Ski Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg1",tags:["Newsletter","Black"]},is_available:!1,unlock:"manual",align:{x:-.03748757324468832,y:-.16145836066470826,z:-.017156471367526203}},{id:1062,name:"Pirate Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaPirate",tags:["Newsletter","Red"]},is_available:!1,unlock:"manual",align:{x:-.04209499130342831,y:-.11506229870273388,z:.012622500466411724}},{id:1063,name:"Colander Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_colander",tags:["Newsletter","Red"]},is_available:!1,unlock:"manual",align:{x:-.04228013671699182,y:-.2435412902962173,z:-.015922203388946482}},{id:1064,name:"Hamburger Earmuffs",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_earmuffsHamburger",tags:["Newsletter","Brown","Pickles"]},is_available:!1,unlock:"manual",align:{x:-.061589629342688745,y:-.24315872165034946,z:-.028186959601940453}},{id:1065,name:"Fez Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fez",tags:["Newsletter","Red","Gold"]},is_available:!1,unlock:"manual",align:{x:-.08950497321590545,y:-.33408258825568216,z:-.009421125014752674}},{id:1066,name:"Blue Wizard Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_blueWizard",tags:["Newsletter","Blue"]},is_available:!1,unlock:"manual",align:{x:-.08360071955828996,y:-.3600554455273177,z:-.03825404477815042}},{id:1067,name:"Chef Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chef",tags:["Newsletter","White"]},is_available:!1,unlock:"manual",align:{x:-.08918353428454662,y:-.3841111684404195,z:-.04081551884995449}},{id:1068,name:"Jester Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_jester",tags:["Newsletter","Black","Gold"]},is_available:!1,unlock:"manual",align:{x:-.020359835690789474,y:-.33615386721409024,z:-.013314527764688}},{id:1069,name:"Straw Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_straw",tags:["Newsletter","Blue","Gold"]},is_available:!1,unlock:"manual",align:{x:-.052496549211439536,y:-.30300028377516663,z:-.02402367283223006}},{id:1070,name:"Spring Sapling Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spring",tags:["Groundhog","Feb23","Green","Brown","Feb24"]},is_available:!1,unlock:"purchase",align:{x:-.09172522689294382,y:-.40464863138897356,z:-.035806813799312165}},{id:1071,name:"Winter Sapling Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winter",tags:["Groundhog","Feb23","White","Brown","Feb24"]},is_available:!1,unlock:"purchase",align:{x:-.09121137445390537,y:-.39284191237794097,z:-.04174510747384019}},{id:1072,name:"Groundhog Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase",align:{x:-.06865825713552098,y:-.27690700557536063,z:-.03141564496555199}},{id:1073,name:"Skull Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaSkull",tags:["Promotional","Black"]},is_available:!1,unlock:"manual",align:{x:-.015739329783290512,y:-.12197913424975876,z:-.007196258564224477}},{id:1074,name:"Firefighter Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fireFighter",tags:["Promotional","Red"]},is_available:!1,unlock:"manual",align:{x:.00029003301364083356,y:-.2815446091386393,z:.00013425993600540975}},{id:1075,name:"Sunglasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sunglasses",tags:["Promotional","Black"]},is_available:!1,unlock:"manual",align:{x:-.11162996980256423,y:-.1299960469185888,z:-.05108829991299102}},{id:1076,name:"Monocle",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_monocle",tags:["Newsletter","Black"]},is_available:!1,unlock:"manual",align:{x:-.2250944940320183,y:-.07000462146414632,z:.009119977687944966}},{id:1077,name:"Gas Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gasMask",tags:["Promotional","Black","Green"]},is_available:!1,unlock:"manual",align:{x:-.11600129068485865,y:-.16795717258715603,z:-.05462135011036057}},{id:1078,name:"Aviator Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_aviator",tags:["Promotional","Brown"]},is_available:!1,unlock:"manual",align:{x:-.04615350218817005,y:-.19552917505354284,z:-.020616418825203403}},{id:1079,name:"Red Goggles",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gogglesRed",tags:["Promotional","Black"]},is_available:!1,unlock:"manual",align:{x:-.056151049789669116,y:-.16989981310822988,z:-.025692511892349168}},{id:1080,name:"Astronaut Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_astronaut",tags:["Promotional","Grey","Gray"]},is_available:!1,unlock:"manual",align:{x:-.04205338420983762,y:-.1810887170833807,z:-.0192440499996792}},{id:1081,name:"Heart Glasses",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesHeart",tags:["ValentinesDay","Pink","Red","Feb24","Feb25"]},is_available:!1,unlock:"purchase",align:{x:-.11678575639135991,y:-.13217398099861333,z:-.05344788463866976}},{id:1082,name:"Baws Fedora",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fedoraPimp",tags:["ValentinesDay","Pink","Brown","Feb25"]},is_available:!1,unlock:"purchase",align:{x:-.0742835205682435,y:-.3193658969606836,z:-.0340018064079084}},{id:1083,name:"Valentine's Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_valentines",tags:["ValentinesDay","Red","Feb25"]},is_available:!1,unlock:"purchase",align:{x:-.08518905206413807,y:-.3668995553978778,z:-.03898739746891}},{id:1084,name:"Shamrock Glasses",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesShamrock",tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.12025224778385146,y:-.14696498652850365,z:-.05503435063727033}},{id:1085,name:"Pot O' Gold Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_potOfGold",tags:["StPatricksDay","MarM23","Black","Gold","Mar24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.063050017457572,y:-.3813351352595771,z:-.09620290937519904}},{id:1086,name:"Leprechaun Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leprechaun",tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.07051683154538146,y:-.30371404636288934,z:-.032272561188218196}},{id:1087,name:"Bunny Ears",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bunnyEars",tags:["Easter","White","Pink","MarM24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.19599893671002944,y:-.39234999864297326,z:-.09717267795762519}},{id:1088,name:"Egg Nest",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggNest",tags:["Easter","Brown","Grey","Gray","MarM24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.11291007649482054,y:-.3417085298117506,z:-.051628527402411084}},{id:1089,name:"Egg Basket",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggBasket",tags:["Easter","Brown","MarM24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.12958749591523677,y:-.3491056580469325,z:-.033891141085516274}},{id:1090,name:"Egg Crown",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggCrown",tags:["Easter","Blue","Yellow","MarM24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.09516800672925507,y:-.37943767643095594,z:-.04250190002299581}},{id:1091,name:"GoE Ice Crown",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_iceCrown",tags:["GameOfEggs","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.10376858078351825,y:-.23115996005856543,z:-.046543193158390894}},{id:1092,name:"GoE Dragon",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dragon",tags:["GameOfEggs","May23","Green","July24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_dragon"],align:{x:-.11122381511525159,y:-.22438668422477548,z:-.05123433364416541}},{id:1093,name:"Green Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaGreen",tags:["Green"]},is_available:!0,unlock:"purchase",align:{x:.004054956862579839,y:-.14563528059130337,z:.00186138626719895}},{id:1094,name:"Mohawk Hair",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_moHawk",tags:["Purple","Pink"]},is_available:!0,unlock:"purchase",align:{x:.006255775047743578,y:-.2945871342626449,z:.0028594610992341285}},{id:1095,name:"Bihawk Hair",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_biHawk",tags:["Green","Yellow"]},is_available:!0,unlock:"purchase",align:{x:.022753773112818454,y:-.29021241960514166,z:.010408569345783436}},{id:1096,name:"Trihawk Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_triHawk",tags:["Red","Yellow"]},is_available:!0,unlock:"purchase",align:{x:.008256199193995034,y:-.3011313509430575,z:.0037766439203970395}},{id:1097,name:"Pigtails Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pigtails",tags:["Yellow","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.07467920777476911,y:-.28400226572156007,z:-.034177504156685634}},{id:1098,name:"Side Pony",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sidePony",tags:["Black","Pink","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.2048439206899455,y:-.23961453155660994,z:.15926519498135824}},{id:1099,name:"Egg Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggHelmet",tags:["Aveggers","Gold","Bone","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.06476139106979284,y:-.2427274343340584,z:-.029638540345020253}},{id:1100,name:"Fohawk Wig",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_arrow",tags:["Aveggers","Brown","Black","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.0424208650320651,y:-.2345596826772796,z:.013231958207907298}},{id:1101,name:"American Bandana",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaAmerica",tags:["Aveggers","JulyM23","Red","White","Blue","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:.0017704487943540625,y:-.15880670916438272,z:-.0011344025820544876}},{id:1102,name:"Bike Helmet",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bikeHelmet",tags:["Aveggers","Red","Yellow","Blue","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.051070299137746744,y:-.31222624951636146,z:-.02337270855193546}},{id:1103,name:"Bucket Hero Hat",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bucketMan",tags:["Aveggers","Red","Yellow","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.06696777176977298,y:-.26648197543203245,z:-.030655009661612387}},{id:1104,name:"Bug Mask",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bugMask",tags:["Aveggers","Jun23","Red","Brown","Jun24","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.09202838165917981,y:-.24281215767282105,z:-.042112847134861325}},{id:1105,name:"Magic Cape",price:1,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cape",tags:["Aveggers","Jun23","Red","Purple","Pink","Jun24","JulyM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_cape"],align:{x:-.04266781721470947,y:-.21042771527528292,z:-.019527249183542233}},{id:1106,name:"Eyepatch",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eyepatch",tags:["Aveggers","May23","Black","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.043774138824827946,y:-.13452079563909275,z:-.008427424416465414}},{id:1107,name:"Panther Mask",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pantherMask",tags:["Aveggers","Black","Yellow","JulyM24","bun_mayan"]},is_available:!1,unlock:"purchase",align:{x:-.08867675721627499,y:-.21152161186369334,z:-.03961583791196849}},{id:1108,name:"Red Hair Wig",price:12500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_redHair",tags:["Aveggers","Black","Red","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.03884946332902017,y:-.21260971107733917,z:-.029016434478789557}},{id:1109,name:"Helmet of Sight",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sightHelmet",tags:["Aveggers","Purple","Black","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.046740069611680646,y:-.20162379194021973,z:-.017085394972692097}},{id:1110,name:"Space Gladiator Hat",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceGladiator",tags:["Aveggers","JunM23","Red","Brown","MayM24","JulyM24","premFeatOne","MarM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_space_gladi"],align:{x:-.017042282162588518,y:-.19924159541308178,z:-.011752371250181241}},{id:1111,name:"Spider Mask",price:12e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spiderMask",tags:["Aveggers","Sep23","Red","Black","White","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.06870616529405815,y:-.2201279271430785,z:-.03144389611102072}},{id:1112,name:"Yolk Arms Hat",price:1,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_yolkArms",tags:["Aveggers","Mar23","Yellow","MarM24","JulyM24","Feb25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_yolk_arms"],align:{x:-.09824611395142124,y:-.25366739592574794,z:-.04496307701845989}},{id:1113,name:"Guy Fawkes Mask",price:1105,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fawkes",tags:["Bone"]},is_available:!0,unlock:"purchase",align:{x:-.17510285990363794,y:-.16123009897717056,z:-.0801371481130441}},{id:1114,name:"Birthday Hat 1",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_birthday1",tags:["HappyBirthday","Yellow","Red","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.09004528014090063,y:-.38780118220464077,z:-.041205839243954934}},{id:1115,name:"Birthday Hat 2",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_birthday2",tags:["HappyBirthday","Red","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.0900442074975476,y:-.38780141753043695,z:-.0412062578498793}},{id:1116,name:"Birthday Cake Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cake",tags:["HappyBirthday","Red","Blue","Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.08715138787708865,y:-.375358800154143,z:-.039885508067528885}},{id:1117,name:"League Staff Sash",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leagueStaff",tags:["League","Blue","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.005004015304724163,y:-.09218018923075544,z:.024480075383928684}},{id:1118,name:"Cat Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cat",tags:["Orange","Black","Ears","bun_cat"]},is_available:!0,unlock:"purchase",align:{x:.2530345577929287,y:-.14335075697889277,z:.11579685356438585}},{id:1119,name:"Egg Shell Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggshell",tags:["Bone"]},is_available:!0,unlock:"purchase",align:{x:-.05005480363389614,y:-.2332627400135887,z:-.021899960910532007}},{id:1120,name:"Dino Shell Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinoShell",tags:["Orange","Brown","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.04136180758052088,y:-.2322692477439574,z:-.018399734357048114}},{id:1121,name:"Penguin Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_penguin",tags:["Black","White"]},is_available:!0,unlock:"purchase",align:{x:-.0460468107990728,y:-.1449311872766339,z:-.0210736711744981}},{id:1122,name:"Pot Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pot",tags:["Black","Grey","Gray"]},is_available:!0,unlock:"purchase",align:{x:-.1274127231102291,y:-.27853762228909873,z:.10954927288677535}},{id:1123,name:"Tiny Tophat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tophatTiny",tags:["Black","Red"]},is_available:!0,unlock:"purchase",align:{x:-.09473700016832165,y:-.28327946990930697,z:.10673072112087173}},{id:1124,name:"Nurse Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_nurse",tags:["White","Red"]},is_available:!0,unlock:"purchase",align:{x:-.07263141897925252,y:-.3124360336056615,z:-.03320790353491676}},{id:1125,name:"Oni Hat",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oni",tags:["Sidearms","White","Red","Black","MarM24","premFeatOne","MarM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_oni"],align:{x:-.02850137689570731,y:-.19644521944177756,z:-.01721496207172566}},{id:1126,name:"Zombie Mask",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_zombieMask",tags:["July23","Black","OctM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_zombie_mask"],align:{x:-.20507391906817896,y:-.19136930956056042,z:-.0938526467524887}},{id:1127,name:"Cinnamon Bun Hair",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cinnamonBun",tags:["Eggwalker","Brown","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.025574859788104032,y:-.16097458820901694,z:-.011704527956558644}},{id:1128,name:"Bounty Egger",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bountyEgger",tags:["Eggwalker","Green","Black","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.09010359208146834,y:-.3096931721367018,z:-.041236590283360686}},{id:1129,name:"Good Robes Hat",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goodRobes",tags:["Eggwalker","Brown","Red","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.003294669149456579,y:-.20397595543931507,z:-.004414162955776901}},{id:1130,name:"Bad Robes Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badRobes",tags:["Eggwalker","Black","Red"]},is_available:!1,unlock:"purchase",align:{x:-.005494201510522094,y:-.20397595543931507,z:.00039190273387446073}},{id:1131,name:"Space Emo Hair",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceEmo",tags:["Eggwalker","Black","Red"]},is_available:!1,unlock:"purchase",align:{x:-.04992203535431816,y:-.2453196733532348,z:-.03147177018283026}},{id:1132,name:"Space Monk Cloak",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceMonk",tags:["Eggwalker","Blue","Bone","May24"]},is_available:!1,unlock:"purchase",align:{x:-.01596096538967145,y:-.15676441899143595,z:-.028658131445658874}},{id:1133,name:"Eggperor Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggperor",tags:["Eggwalker","Black","Yellow","Meme"]},is_available:!1,unlock:"purchase",align:{x:-.04922442032078411,y:-.23044239490212748,z:-.022527928177171253}},{id:1134,name:"BBEgg Hat",price:65e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bbEgg",tags:["Eggwalker","Orange","White","MarM24"]},is_available:!1,unlock:"purchase",align:{x:-.09303705158508402,y:-.40071116169074616,z:-.042576668436322795}},{id:1135,name:"C3PYolk Mask",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c3pYolk",tags:["Eggwalker","Rainbow","Gold","Mar24"]},is_available:!1,unlock:"purchase",align:{x:-.05234545439905691,y:-.1644001004459974,z:-.023951376783042433}},{id:1136,name:"2020 Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2020",tags:["NewYears","2020","Yellow","White"]},is_available:!1,unlock:"purchase",align:{x:-.09511683446205477,y:-.3564681457999029,z:-.04353093855962348}},{id:1137,name:"Eggy Cash Ensemble",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggyCash",tags:["EggyCash","Brown","Black"]},is_available:!0,unlock:"purchase",align:{x:-.0350094254989175,y:-.20970473415592883,z:.009832643987000289}},{id:1138,name:"Soda Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_drinkdew",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:-.12717812078732038,y:-.29468604465734005,z:-.05820376655005444}},{id:1139,name:"Surgical Mask",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalMask",tags:["Surgical","Green"]},is_available:!0,unlock:"purchase",align:{x:-.05816313573477583,y:-.15443180825077962,z:-.026618798915909347}},{id:1140,name:"Surgical Mask White",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalWhite",tags:["Surgical","White"]},is_available:!0,unlock:"purchase",align:{x:-.05816313573477583,y:-.15443180825077962,z:-.026618798915909347}},{id:1141,name:"Surgical Mask Smile",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalSmile",tags:["Surgical","Black"]},is_available:!0,unlock:"purchase",align:{x:-.05816313573477583,y:-.15443180825077962,z:-.026618798915909347}},{id:1142,name:"Falcon Hunter Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_falconHunter",tags:["RaidLand","Yellow","Nov23"]},is_available:!1,unlock:"purchase",align:{x:-.019465021575194363,y:-.16061997810856643,z:-.018786977876343564}},{id:1143,name:"Shadow Hunter Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shadowHunter",tags:["RaidLand","Mar23","Purple","Aug24","Apr25","premFeatTwo"]},is_available:!0,unlock:"purchase",align:{x:.040752448565812394,y:-.1410023327458786,z:.01865425522337505}},{id:1144,name:"Frost Berserker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frostBerserker",tags:["RaidLand","Blue","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.09647713804661162,y:-.25489461130332036,z:-.04415349181618433}},{id:1145,name:"Grim Berserker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_grimBerserker",tags:["RaidLand","Blue","Gray","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.12139285377596032,y:-.2813697501715835,z:-.05555635755260763}},{id:1146,name:"Golem Warrior Hat",price:1200,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_golemWarrior",tags:["RaidLand","Green","Mar24"]},is_available:!1,unlock:"purchase",align:{x:-.047041600207025525,y:-.25179530384755866,z:-.02146208281435391}},{id:1147,name:"Immortal Warrior Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_immortalWarrior",tags:["RaidLand","Blue","Gray","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.1087318992256816,y:-.3323169847959204,z:-.046798794735782745}},{id:1148,name:"Sheep Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sheep",tags:["Newsletter","White","Brown"]},is_available:!1,unlock:"manual",align:{x:-.06234328566352154,y:-.2657714995353031,z:-.02853187610986624}},{id:1149,name:"Blue Toxic  Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicBlue",tags:["Rotten","Blue","Green"]},is_available:!0,unlock:"purchase",align:{x:-.020208838470678003,y:-.12523480985630764,z:-.009249284905003152}},{id:1150,name:"Green Toxic Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicGreen",tags:["Rotten","Green"]},is_available:!0,unlock:"purchase",align:{x:-.020208838470678003,y:-.12523480985630764,z:-.009249284905003152}},{id:1151,name:"Orange Toxic Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicOrange",tags:["Rotten","Orange","Green"]},is_available:!0,unlock:"purchase",align:{x:-.020208838470678003,y:-.12523480985630764,z:-.009249284905003152}},{id:1152,name:"Double Filter Gas Mask",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_doubleFilter",tags:["Black","Red"]},is_available:!0,unlock:"purchase",align:{x:-.07869036843854582,y:-.1670771929647512,z:-.03601121015262934}},{id:1153,name:"Brown Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar1",tags:["Rockstar","JanM23","Brown","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.02668556941149891,y:-.2766025877174578,z:-.012212852578724787}},{id:1154,name:"Black & Red Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar3",tags:["Rockstar","JanM23","Black","Red","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.017915658211507868,y:-.22147999618357828,z:-.008199236407690325}},{id:1155,name:"Black & White Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar2",tags:["Rockstar","JanM23","Black","White","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.009818349718689667,y:-.2951244655343809,z:-.004493441910886048}},{id:1156,name:"Umbrella Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_umbrella",tags:["Newsletter","Rainbow"]},is_available:!1,unlock:"manual",align:{x:-.09443312459641184,y:-.2901235633645569,z:.07806251993890007}},{id:1157,name:"Star Glasses",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesStar",tags:["Galeggsy","AprM23","Pink","Aug24"]},is_available:!1,unlock:"purchase",align:{x:-.12484232000679674,y:-.15004544071299453,z:-.05713503190453892}},{id:1158,name:"Star Bandana",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaStars",tags:["Galeggsy","AprM23","Purple","Pink","Aug24"]},is_available:!1,unlock:"purchase",align:{x:-.001362708306832383,y:-.10213714959788034,z:-.01903713589631366}},{id:1159,name:"Alien Antennae",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headbandAlien",tags:["Galeggsy","AprM23","Purple","Pink","Aug24"]},is_available:!1,unlock:"purchase",align:{x:-.08112413050090228,y:-.3190124338524207,z:-.03712708816247562}},{id:1160,name:"Galeggsy Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premiumButterfly",tags:["Galeggsy","AprM23","Purple","Pink","Aug24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_galeggsy"],align:{x:.060713865081625795,y:-.19942954633235135,z:.028818182231672013}},{id:1161,name:"Black Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZoneBlack",tags:["MercZone","Black","Suit"]},is_available:!1,unlock:"manual",align:{x:-.02678216325299232,y:-.1177158487880896,z:-.012284197322337875}},{id:1162,name:"Red Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZoneRed",tags:["MercZone","Red","Suit"]},is_available:!1,unlock:"manual",align:{x:-.02678216325299232,y:-.1177158487880896,z:-.012284197322337875}},{id:1163,name:"Pink Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZonePink",tags:["MercZone","Pink","Suit"]},is_available:!1,unlock:"manual",align:{x:-.02678216325299232,y:-.1177158487880896,z:-.012284197322337875}},{id:1164,name:"Academic Cap",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academic",tags:["Newsletter","Black","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.07093971494621032,y:-.3224853891775712,z:-.03574759001854644}},{id:1166,name:"Fuzzy Earmuffs",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_earmuffs",tags:["Newsletter","Pink"]},is_available:!1,unlock:"manual",align:{x:-.05017462989413346,y:-.23629499324838232,z:-.022962798773102838}},{id:1167,name:"Chains Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chains",tags:["Newsletter","Gray"]},is_available:!1,unlock:"manual",align:{x:-.07525641311957942,y:-.1397572844128152,z:-.014165312798006618}},{id:1168,name:"Hen Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hen",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.10092032091586889,y:-.29804565019893214,z:-.04618398189947076}},{id:1169,name:"Rooster Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rooster",tags:["Chicken","Brown","Red","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.09455461013304145,y:-.28662472287303387,z:-.04326614325353481}},{id:1170,name:"Rooster Tail Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roosterTail",tags:["Chicken","Green","MayM24"]},is_available:!1,unlock:"purchase",align:{x:.037684122283645705,y:-.3188342003436098,z:.02145330553469857}},{id:1171,name:"Rooster Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RoosterWings",tags:["MayM23","Chicken","Green","Red","May24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_rooter_wing"],align:{x:-.014848230007995955,y:-.21470955736788944,z:-.006795404693105883}},{id:1172,name:"Bee Wings",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_BeeWings",tags:["Rainbow","Pink","Green","Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.009994370735535885,y:-.19329762292182273,z:-.004573999293501552}},{id:1173,name:"Jason Mask",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_F13",tags:["f13","Bone","Red","Nov24"]},is_available:!1,unlock:"purchase",align:{x:.024964612025391908,y:-.000438791196881283,z:-.04600707116643499}},{id:1174,name:"Demon Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DemonWings",tags:["Premium","Red","OctM23","FebM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_demon_wings"],align:{x:.0685948197299946,y:-.18782834752363142,z:.03139293810363847}},{id:1175,name:"Among Egg Hat 1",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_01",tags:["AmongEgg","Blue","White","Meme"]},is_available:!0,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1176,name:"Among Egg Hat 2",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_02",tags:["AmongEgg","Blue","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1177,name:"Among Egg Hat 3",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_03",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1178,name:"Among Egg Hat 4",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_04",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1179,name:"Among Egg Hat 5",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_05",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1180,name:"Among Egg Hat 6",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_06",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1181,name:"Among Egg Hat 7",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_07",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1182,name:"Eggolorian Helmet",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggolorianBig",tags:["Eggolorian","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.026411921972668395,y:-.13509385847251787,z:-.024761750354195478}},{id:1183,name:"Toadstool Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toadstool",tags:["Newsletter","Red","White"]},is_available:!1,unlock:"manual",align:{x:-.055709877852442524,y:-.2792171461306885,z:.0021067564280323192}},{id:1184,name:"Fallen Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_FallenWings",tags:["Premium","FebM23","Gray","Brown","bun_dove"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fallen_wing"],align:{x:-.016135329117298647,y:-.21346623949778282,z:-.007384455335413202}},{id:1185,name:"Golden Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_GoldenWings",tags:["Premium","vipItem","Gray","Silver"]},is_available:!1,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"],align:{x:.02761299490618674,y:-.14516558338113816,z:.012637296007242005}},{id:1186,name:"Chrome Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ChromeWings",tags:["July23","Gold","Yellow","DecM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_chrome_wing"],align:{x:.01674006510310644,y:-.247877226408992,z:.007661217482458432}},{id:1187,name:"Wero Viking Hair",price:4e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wero",tags:["Wero","Brown"]},is_available:!0,unlock:"purchase",align:{x:.056303593911419814,y:-.14612210750057109,z:.025765045299767086}},{id:1188,name:"Mech Energy Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_MechEnergyWings",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:.015330953250958235,y:-.19451067287062584,z:.007016326768703868}},{id:1189,name:"Egg Sandwich Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sandwich",tags:["Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.07130919700923943,y:-.30712692187370716,z:-.032635193234431537}},{id:1190,name:"Party Hat 2021",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2021",tags:["NewYears","2021","Red","Green"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1191,name:"Headband 2021",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2021",tags:["NewYears","2021","Green"]},is_available:!1,unlock:"purchase",align:{x:-.09511683446205477,y:-.3564681457999029,z:-.04353093855962348}},{id:1192,name:"Hindsight Glasses",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesHindsight",tags:["NewYears","Black","Purple","DecM24"]},is_available:!1,unlock:"purchase",align:{x:.0547271990742301,y:-.20063102866948732,z:.025046316631686674}},{id:1193,name:"Steampunk Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SteampunkWings",tags:["Premium","JulyM23","Gold"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_steamWings"],align:{x:-.03198825591038429,y:-.2260334318073813,z:-.014639667176367683}},{id:1194,name:"Thee_Owl Hat",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_theeowl",tags:["TheeOwl","Red","Orange","Green","Blue","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.018544171968607248,y:-.19240670414833727,z:-.008486880491591603}},{id:1195,name:"Angel Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelAngel",tags:["Jun23","Blue","Yellow","White","Dec24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_wings"],align:{x:.0472404788655226,y:-.2091868482273766,z:.021619962507704864}},{id:1196,name:"C4bra Hair",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c4bra",tags:["C4bra","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.05256816415156407,y:-.21887927713761113,z:-.04389734348691249}},{id:1197,name:"C4bra Ram Hat",price:35e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c4brahorn",tags:["C4bra","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.023596361624323547,y:-.20407749696274824,z:-.010799053294252028}},{id:1198,name:"Hazmatt Mask",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hazmat",tags:["Hazmat","Yellow","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.11308287904866399,y:-.16479260690206332,z:-.05328025989807142}},{id:1199,name:"Slashy Camp Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slashy",tags:["SlashyCamp","White","Bone","Red","Brown","Skullface","Slayaway"]},is_available:!1,unlock:"manual",align:{x:-.08886748152911006,y:-.1743046148683261,z:.010484776937821606}},{id:1200,name:"Discord Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_discord",tags:["Discord","Black","Purple","White"]},is_available:!1,unlock:"manual",align:{x:-.12105425626384658,y:-.2683138912314549,z:-.055403067375097204}},{id:1201,name:"Definitely not Egg",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_funnyGlasses",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.1835774998200077,y:-.16995815775748346,z:-.08400750293600584}},{id:1202,name:"Skull Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SkullWings",tags:["Red","Brown","Black","Bone","Oct23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_skull_wings"],align:{x:-.00010832741414268376,y:-.12452614579911303,z:-.0003290829473785589}},{id:1203,name:"Egg Earpods",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_airpods",tags:["White"]},is_available:!0,unlock:"purchase",align:{x:-.019127507470631577,y:-.16649293479814636,z:-.008753848404344206}},{id:1204,name:"Paper Bag Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bag",tags:["Brown"]},is_available:!0,unlock:"purchase",align:{x:-.0570301614362152,y:-.2653326619474974,z:-.025899324044152905}},{id:1205,name:"Backwards Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hipster",tags:["Egg","Black"]},is_available:!0,unlock:"purchase",align:{x:-.011468426131167497,y:-.2906639602185078,z:-.04635516963121872}},{id:1206,name:"Beret",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beret",tags:["White","Red","Egg"]},is_available:!0,unlock:"purchase",align:{x:-.055021973188496,y:-.27189908716968936,z:-.056135607980478675}},{id:1207,name:"Spike Hat",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spike",tags:["Gold","Black","Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.08330871023780784,y:-.32247434428827937,z:-.03728431149234124}},{id:1208,name:"TikTok Bowler",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tiktok",tags:["Pink","Blue","Black","Gray"]},is_available:!1,unlock:"manual",align:{x:-.05193614209106312,y:-.2747381724486184,z:-.030040690041946927}},{id:1209,name:"Propeller Beanie",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beanie",tags:["Newsletter","Rainbow","Blue"]},is_available:!1,unlock:"manual",align:{x:-.07773122740157001,y:-.33478619745174276,z:-.03557433316800812}},{id:1210,name:"Riddler Bowler",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_riddler",tags:["Purple","Yellow","Green"]},is_available:!1,unlock:"manual",align:{x:-.06902895424785793,y:-.29730062114783573,z:-.031588443706486946}},{id:1211,name:"Miner Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_miner",tags:["Yellow","Black"]},is_available:!1,unlock:"manual",align:{x:-.07637135947582285,y:-.26818667179554234,z:-.03494866906248434}},{id:1212,name:"Dog Ears",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dog",tags:["sale","Mar23","Brown","NovM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_dog_cap"],align:{x:.15090627867947326,y:-.148499481909677,z:.06644016204783357}},{id:1213,name:"Satellite Headgear",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_satellite",tags:["Gray","Grey"]},is_available:!1,unlock:"manual",align:{x:-.1003526479958019,y:-.3126854219834809,z:-.031678792439267967}},{id:1214,name:"Diablo Hat",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_evilpablo",tags:["EGGORG","Black","Red","Apr25"]},is_available:!0,unlock:"purchase",align:{x:-.07552652492916812,y:-.3252818085896001,z:-.03455986096692204}},{id:1215,name:"Robot Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelRobot",tags:["Aug23","Green","Gray","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_robot_wings"],align:{x:.010422668079778596,y:-.15195166020488457,z:.004770012924198996}},{id:1216,name:"Train Conductor",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_conductor",tags:["Trains","Cars","Yellow","Black"]},is_available:!0,unlock:"purchase",align:{x:-.07447285699071271,y:-.27373920004456487,z:-.034084459105144516}},{id:1217,name:"Train Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_train",tags:["Trains","Cars","Red","Gray"]},is_available:!0,unlock:"purchase",align:{x:-.12181852358880674,y:-.25462191713874516,z:-.02548535493101492}},{id:1218,name:"Bindle Hat",price:4500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bindle",tags:["Trains","Cars","Red","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.07625396127772457,y:-.19259195468605367,z:.1997715437643714}},{id:1219,name:"Instagram Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_instagram",tags:["Purple","Orange","Gray"]},is_available:!1,unlock:"manual",align:{x:-.10458216013544197,y:-.3038086237336537,z:-.0051294333925099855}},{id:1220,name:"UFO Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ufo",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:-.06048177152047618,y:-.32833299960741713,z:-.0693053769660591}},{id:1221,name:"RandomLife Headgear",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_randomlife",tags:["Random","Red","Brown","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.049085380484119145,y:-.18555836262817182,z:-.022464295558879216}},{id:1222,name:"Unicorn Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_UnicornWings",tags:["Mar23","Pink","White","OctM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_uni_wing"],align:{x:-.008910853390342588,y:-.2650553005622003,z:-.004078119362420363}},{id:1223,name:"Steam Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_steam",tags:["Pink"]},is_available:!1,unlock:"manual",align:{x:-.0956015549521565,y:-.2864809679826543,z:-.043752774580604115}},{id:1224,name:"Ice Cream Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_icecream",tags:["Newsletter","Blue","Brown"]},is_available:!1,unlock:"manual",align:{x:-.057938759706054554,y:-.2783004123624848,z:.03933975026677053}},{id:1225,name:"Ethan Gamer Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ethangamer",tags:["EthanGamer","Brown","Green","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.03556352559610376,y:-.19568013520375716,z:-.017074842448833144}},{id:1226,name:"Fairy Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelFairy",tags:["Dec23","Pink","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fairy_wings"],align:{x:.025487516259037335,y:-.11036003837934794,z:.01166455461777266}},{id:1227,name:"Facebook Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_facebook",tags:["Blue","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.13911162234386953,y:-.24736789717254104,z:-.0659173981798371}},{id:1228,name:"Sun Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sun",tags:["Summer","JunM23","Yellow","Brown","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.050488251857767175,y:-.25609643737374777,z:-.023112360850326363}},{id:1229,name:"Picnic Basket Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_picnic",tags:["Summer","JunM23","Brown","White","Red","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.06391937586354324,y:-.3049931703225548,z:-.0372255670228166}},{id:1230,name:"Beehive Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beehive",tags:["Summer","JunM23","Yellow","Black","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.09472312087566159,y:-.34840081463281347,z:-.035276375097910984}},{id:1231,name:"Parrot Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_parrot",tags:["Newsletter","Red","Green"]},is_available:!1,unlock:"manual",align:{x:-.10044149920045642,y:-.27678159126613106,z:.12029495213527525}},{id:1232,name:"Toilet Paper Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ToiletPaperWings",tags:["Premium","White","Brown","bun_toilet"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_toilet_papr"],align:{x:.010997881077290383,y:-.24427555574888432,z:.00503326353283963}},{id:1233,name:"Watermelon Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_watermelon",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:-.03885382911933832,y:-.19948565389743578,z:-.0065169765907116955}},{id:1234,name:"Twitter Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_twitter",tags:["Blue","White"]},is_available:!1,unlock:"manual",align:{x:-.12276427275929835,y:-.2736920598170087,z:-.05496658279849259}},{id:1235,name:"Fire Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelFire",tags:["Premium","Red","Yellow","Mar24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_fire"],align:{x:-.0030721007352483287,y:-.1384340684230544,z:-.001405970091427386}},{id:1236,name:"Backpack Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_backpack",tags:["Pencil","Sep23","Red","Sep24"]},is_available:!1,unlock:"purchase",align:{x:.12218146949814168,y:-.16622138475595996,z:.05686431041429582}},{id:1237,name:"Backpack Rainbow Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_backpackrainbow",tags:["Pencil","Sep23","Rainbow","White","Sep24"]},is_available:!1,unlock:"purchase",align:{x:.122528399626321,y:-.16631880701545823,z:.05702308561137556}},{id:1238,name:"Round Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roundglasses",tags:["Pencil","Sep23","Black","Sep24"]},is_available:!0,unlock:"purchase",align:{x:-.11772619456545064,y:-.1430215058655926,z:-.053878283278210176}},{id:1239,name:"Books Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_books",tags:["Newsletter","Yellow","Brown","Red"]},is_available:!1,unlock:"manual",align:{x:-.09433236283052882,y:-.3004764423791535,z:-.026153673415162615}},{id:1240,name:"Wero Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weroShort",tags:["Wero","Brown","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.053723864256666864,y:-.2665844331860534,z:-.019579849924790615}},{id:1241,name:"Glitch Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_GlitchWings",tags:["Premium","Purple","Pink","Black","NovM23","Apr24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_glitch_wing"],align:{x:.05340656668026472,y:-.22606012536383804,z:.02444191923667508}},{id:1242,name:"Sherlock Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sherlock",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.05668436102263996,y:-.2441306698166108,z:-.025937601815962552}},{id:1243,name:"Grave Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_RIP",tags:["Halloween2","Oct23","Grey","Gray","Egg","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.11837364791910598,y:-.3453135657676538,z:-.02841929196202969}},{id:1244,name:"Ghost Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ghost",tags:["Halloween2","Oct23","White","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.0525359727521153,y:-.13535000874785352,z:-.00785241763098675}},{id:1245,name:"Moth Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelMoth",tags:["Nov23","Brown","Black","Skull","Lambs"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_moth_wings"],align:{x:.06648429136962275,y:-.18018318464573405,z:.030427038834781373}},{id:1246,name:"Android Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_android",tags:["Mobile","Green"]},is_available:!1,unlock:"purchase",align:{x:-.0686633228481126,y:-.2957310387488832,z:-.03142428891712207}},{id:1247,name:"Bravo Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bravo",tags:["Newsletter","Yellow","Hair"]},is_available:!1,unlock:"manual",align:{x:-.06819602391192303,y:-.25251405511395886,z:-.03364586243139556}},{id:1248,name:"Thermal Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ThermalWings",tags:["Red","DecM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["hat_thermal_wings"],align:{x:-.04496152602050674,y:-.22804447072723255,z:-.020576982360488452}},{id:1249,name:"Apple Pie Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_applepie",tags:["Food","Brown","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.07402118177510753,y:-.3129973850256931,z:-.034363178649461035}},{id:1250,name:"Pumpkin Pie Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkinpie",tags:["Food","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.07684515275051185,y:-.3226497851796406,z:-.035164717517768396}},{id:1251,name:"Cheese Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cheese",tags:["Food","Yellow","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.09736025924578184,y:-.30784507348091106,z:-.044840917772301314}},{id:1252,name:"Gravy hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gravy",tags:["Food","Brown","Yellow","NovM23"]},is_available:!1,unlock:"purchase",align:{x:-.10764049404297893,y:-.3242807539480268,z:-.04858410689496345}},{id:1253,name:"Dollar Sign Glasses Black",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_PremiumEggTier3",tags:["Black Fryday","MayM23","Black"]},is_available:!1,unlock:"purchase",align:{x:-.1272223463951172,y:-.16985670643656636,z:-.05822426897524949}},{id:1254,name:"Pink Hair",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkwarrior",tags:["Eggs of Legends","Pink"]},is_available:!0,unlock:"purchase",align:{x:-.051101478189649496,y:-.21837873885616244,z:-.04886738805522073}},{id:1255,name:"Blue Braids",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bluebraids",tags:["Eggs of Legends","Blue","Hair"]},is_available:!0,unlock:"purchase",align:{x:.014294459551864591,y:-.0564965739245884,z:.00654219696920838}},{id:1256,name:"Weather Vane",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weathervane",tags:["KotC","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase",align:{x:-.08938104127416624,y:-.3949801858969135,z:-.047053257971897744}},{id:1257,name:"Red Crown Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winnerRed",tags:["KotC","Gold","Red"]},is_available:!0,unlock:"purchase",align:{x:-.024404769481507493,y:-.4032693734415156,z:-.010993647592823785}},{id:1258,name:"Blue Crown Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winnerBlue",tags:["KotC","Gold","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.024742434488183473,y:-.4031638504834284,z:-.011144839475885127}},{id:1259,name:"Bison Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bison",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.09099733428325463,y:-.28127430856860536,z:-.041638129058378215}},{id:1260,name:"Egg Cluster Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcluster",tags:["KotC","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.07079690890193824,y:-.3420100851495165,z:-.045823917581105156}},{id:1261,name:"Party Hat 2022",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2022",tags:["NewYears","2022","Brown","Red","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1262,name:"Headband 2022",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2022",tags:["NewYears","2022","Red","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.09499434428437392,y:-.3559405841960604,z:-.04347488000356631}},{id:1263,name:"Nervous Elf Belt",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_nervouself",tags:["Christmas2","Elf","Brown","Gold","Green","Red","bun_mistle","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.02412197895070589,y:-.06700092007771397,z:-.011163725420193032}},{id:1264,name:"Bugs Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bluehair",tags:["Meggtrix","JulyM23","Blue","Jun24"]},is_available:!1,unlock:"purchase",align:{x:-.06755290806472969,y:-.2574267838016908,z:-.05731751448656369}},{id:1265,name:"Meggtrix Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_clampglasses",tags:["Meggtrix","Black","DecM24"]},is_available:!1,unlock:"purchase",align:{x:-.19919493077297812,y:-.13104190797669846,z:-.09116306656828238}},{id:1266,name:"Agent Smithe Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_smith",tags:["Meggtrix","Black"]},is_available:!1,unlock:"purchase",align:{x:-.018096408130339636,y:-.07236629676634476,z:-.00827871328761573}},{id:1267,name:"Dreadlocks Hair",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_twins",tags:["Meggtrix","Gray"]},is_available:!1,unlock:"purchase",align:{x:.013752778058945037,y:-.1260515983702566,z:.004499134103787522}},{id:1268,name:"Twitch Bits",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bits",tags:["Purple","Green","Red"]},is_available:!1,unlock:"manual",align:{x:-.07625784724232476,y:-.3212491848476593,z:-.03724174556834575}},{id:1269,name:"Butterfly Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelButterfly",tags:["Purple","Blurple","Jun24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_butt"],align:{x:.06842190316438235,y:-.1664346465616369,z:.03131380152266161}},{id:1270,name:"Mandrake Glasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mandrake",tags:["Drops","Blue","Black","Gray"]},is_available:!1,unlock:"manual",align:{x:-.045350248619579814,y:-.18856227419506955,z:-.02203309706400762}},{id:1271,name:"Lyerpald Wolf Helmut",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lyerpald",tags:["Drops","Gray"]},is_available:!1,unlock:"manual",align:{x:-.09070205347941274,y:-.2946872575472672,z:-.04097567283638698}},{id:1272,name:"Pixel Bird Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelBird",tags:["Premium","AugM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_bird"],align:{x:-.006167608731298957,y:-.23009693766193717,z:-.002822652707942727}},{id:1273,name:"xSerpius Hair",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_xserpiusbeard",tags:["Drops","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.03782371298281717,y:-.08324704596677912,z:-.020377304636828963}},{id:1274,name:"Blue & Yellow Toque ",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toque",tags:["Chilly","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.04545315805478767,y:-.23604199770916368,z:-.020801981476676862}},{id:1275,name:"Purple & Red Toque",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pufftoque",tags:["Chilly","Purple","Red"]},is_available:!1,unlock:"purchase",align:{x:-.0520856055559209,y:-.24271405955948588,z:-.023837371235649107}},{id:1276,name:"Ear Flaps Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_greenearhat",tags:["Chilly","Sep23","Green"]},is_available:!1,unlock:"purchase",align:{x:-.07667842259454893,y:-.21881040618974978,z:-.035092459960448186}},{id:1277,name:"Bow Headband",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkbow",tags:["Kawaii","Blue","Pink","Hair"]},is_available:!0,unlock:"purchase",align:{x:.013242936048015075,y:-.1033230738103943,z:-.008508166486768332}},{id:1278,name:"Cute Ponytail",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkpony",tags:["Kawaii","Pink","Hair"]},is_available:!0,unlock:"purchase",align:{x:.025839573329109022,y:-.12563835757091635,z:.03822514136542354}},{id:1279,name:"High Pigtails",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hightails",tags:["Kawaii","Purple","Hair"]},is_available:!0,unlock:"purchase",align:{x:.0276683407182281,y:-.06620158453736735,z:.012662625411135664}},{id:1280,name:"Orange Hair Buns",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spacebuns",tags:["Kawaii","Orange"]},is_available:!0,unlock:"purchase",align:{x:-.023154355564313445,y:-.1721316874022778,z:-.010596765888274434}},{id:1281,name:"Cat Braids",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_catbraids",tags:["Kawaii","Brown","Hair"]},is_available:!0,unlock:"purchase",align:{x:.04942305559527016,y:-.08275381442845631,z:.022625504948921016}},{id:1282,name:"Sashimi Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sushi",tags:["Kawaii","Pink","White"]},is_available:!0,unlock:"purchase",align:{x:-.06607460559824174,y:-.3145620311388375,z:-.023349608686141055}},{id:1283,name:"Big Cat Ears",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bigears",tags:["Kawaii","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.08912079570999865,y:-.2812066668309523,z:-.04078680610014129}},{id:1284,name:"Spiky Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spikyband",tags:["Kawaii","White","Black"]},is_available:!0,unlock:"purchase",align:{x:-.023430270261315833,y:-.29978976104196253,z:.01652652925006237}},{id:1285,name:"Gamer Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerhair",tags:["Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.013377586824752985,y:-.1219796445900333,z:-.015800351731837636}},{id:1286,name:"Purple Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purplehair",tags:["Purple"]},is_available:!0,unlock:"purchase",align:{x:.023129168688115875,y:-.11083660530794659,z:.006054604634013971}},{id:1287,name:"Mmm Donut Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_donut",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.08550644276840513,y:-.27604362378568936,z:-.026332007285230108}},{id:1288,name:"Lucky Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_LuckyWings",tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_luckywings"],align:{x:-.033786312351363645,y:-.1967396243343998,z:-.015462594090161368}},{id:1289,name:"Turtle Power Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turtle",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.019347811387824265,y:-.2317573148140306,z:-.008854672137101616}},{id:1290,name:"Ukraine Bandana",price:3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaUkraine",tags:["UA","Blue","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_ukraine"],align:{x:-.037327876564546614,y:-.09202308400058623,z:-.03566510179609639}},{id:1291,name:"Sweatband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sweatband",tags:["BBros","Egg","Purple","Gold","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.03139999298521712,y:-.20010309398013404,z:-.014370444207938982}},{id:1292,name:"Spartan Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spartan",tags:["BBros","Green"]},is_available:!1,unlock:"purchase",align:{x:-.11924556069189718,y:-.28847717682052254,z:-.05456955212903192}},{id:1293,name:"Gators Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gators",tags:["BBros","Blue","Orange","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.11924556069189718,y:-.28847717682052254,z:-.05456955212903192}},{id:1294,name:"Rams Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rams",tags:["BBros","Aug23","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.11924556069189718,y:-.28847717682052254,z:-.05456955212903192}},{id:1295,name:"Knight Hat",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knight",tags:["EGGORG","Blue","Red"]},is_available:!1,unlock:"purchase",align:{x:-.0714147299793606,y:-.23565709532673618,z:-.0326814591627768}},{id:1296,name:"Viking Helmet",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_viking",tags:["EGGORG","Yellow","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.0695631630520892,y:-.18345971679684459,z:-.03183610762846864}},{id:1297,name:"Egg Cape",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcape",tags:["EGGORG","Yellow","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.005960168837245927,y:-.06521101336169344,z:-.0027277491000435583}},{id:1298,name:"Joker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_joker",tags:["EGGORG","Blue","Red","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.004737473505517453,y:-.30091891990419384,z:-.006680355253004977}},{id:1299,name:"Shield Hat",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shield",tags:["EGGORG","Apr23","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.001314076285751753,y:-.145188741690077,z:-.007500360642775039}},{id:1300,name:"Valkyrie Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_valkyrie",tags:["Newsletter","Blue","Gray"]},is_available:!1,unlock:"manual",align:{x:-.057175017244421866,y:-.20885034996221186,z:-.026166578997877943}},{id:1301,name:"Tattered Cape",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcapeRust",tags:["Relic","Drops2","Brown","Gold"]},is_available:!1,unlock:"manual",align:{x:-.0032140950995573903,y:-.05338375428872988,z:-.0014709876888352458}},{id:1302,name:"Gold Joker Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_jokerGold",tags:["Relic","Drops2","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.004737473505517453,y:-.30091891990419384,z:-.006680355253004977}},{id:1303,name:"Rusty Viking Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_vikingRust",tags:["Relic","Drops2","Brown","Gold"]},is_available:!1,unlock:"manual",align:{x:-.0695631630520892,y:-.18345971679684459,z:-.03183610762846864}},{id:1304,name:"Rusty Knight Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knightRust",tags:["Relic","Drops2","Brown","Red"]},is_available:!1,unlock:"manual",align:{x:-.07254534842625415,y:-.2387070727526709,z:-.03319142252026157}},{id:1305,name:"JWBerry3D Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerglasses",tags:["Relic","Red","Black"]},is_available:!0,unlock:"purchase",align:{x:-.11078425287591509,y:-.1237525930467187,z:-.05070125116724264}},{id:1306,name:"Ocean Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oceanglasses",tags:["Relic","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.12495636346710981,y:-.13507479491885022,z:-.05737283020232181}},{id:1307,name:"Tooth Survivor Bandana",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toothbandana",tags:["Dino","May23","Gray","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.04755004110646732,y:-.12795363370519897,z:-.006119485827542431}},{id:1308,name:"Steggasauras Scales",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_stego",tags:["Dino","May23","Orange","Green","Dec23","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.10516669405657098,y:-.14039272566488192,z:.048125859170304874}},{id:1309,name:"Red Dino Tail",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailred",tags:["Dino","May23","Yellow","Red","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.10781959893149307,y:-.13401897970572288,z:.14210710777705432}},{id:1310,name:"Green Dino Tail",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailgreen",tags:["Dino","May23","Green","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.10781959893149307,y:-.13401897970572288,z:.14210710777705432}},{id:1311,name:"Dino Mouth Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinomouth",tags:["Dino","May23","Red","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.031831313732059385,y:-.3524354179999527,z:-.013994178632266319}},{id:1312,name:"Alpha Pterodactyl Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DinoWings",tags:["Dino","May23","Green","AugM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_dinowings"],align:{x:-.07859264188282022,y:-.20860363417986472,z:-.035968582448789366}},{id:1313,name:"Dino Triceratops Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dino",tags:["Dino","Newsletter","Orange"]},is_available:!1,unlock:"manual",align:{x:-.09452825597300052,y:-.3315847405619863,z:-.04468450251659173}},{id:1314,name:"Tablet Backpack",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tabletpack",tags:["Mobile","SepM23","Red","Egg"]},is_available:!1,unlock:"purchase",align:{x:.11079876174309317,y:-.19012561884289186,z:.05168685108465057}},{id:1315,name:"Telephone Hat ",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_telephone",tags:["Mobile","AugM23","Red"]},is_available:!1,unlock:"purchase",align:{x:.05860631546825945,y:-.13663260348863965,z:.12487819389459201}},{id:1316,name:"Airplane Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Airplane",tags:["Sep23","Premium","White","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_airplane"],align:{x:.23034786490917902,y:-.1547492657728725,z:.10487083678434686}},{id:1317,name:"Head Tail",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headtails",tags:["Eggwalker2","White","Green","Black"]},is_available:!1,unlock:"purchase",align:{x:-.0196740573061005,y:-.19606196947358268,z:-.009000703549737338}},{id:1318,name:"Eggpire Cap",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_imperial",tags:["Eggwalker2","Green"]},is_available:!1,unlock:"purchase",align:{x:-.06259811515829705,y:-.2829860136744101,z:-.02864312563205662}},{id:1319,name:"Sci-fi Visor",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_obiwan",tags:["Eggwalker2","Black"]},is_available:!1,unlock:"purchase",align:{x:-.24271137738414206,y:-.13328460556968547,z:-.1197112186589378}},{id:1320,name:"Cross Fighter Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_CrossWing",tags:["Eggwalker2","Premium","White","Grey","Gray","Red","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_crosswing"],align:{x:.15930024282913313,y:-.18075422946571956,z:.07290496100199528}},{id:1321,name:"Pineapple Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pineapple",tags:["Summer","JunM23","Green","White","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.09812463178535724,y:-.4156135499303326,z:-.04060392769329296}},{id:1322,name:"Kite Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kite",tags:["Summer","JunM23","Rainbow","Yellow","JunM24"]},is_available:!1,unlock:"purchase",align:{x:.017159674628105748,y:-.31965418856758354,z:.007851239309207725}},{id:1323,name:"UK Bucket Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_buckethat",tags:["Summer","Newsletter","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.05810470285745151,y:-.2502452533755086,z:-.02659205663663128}},{id:1324,name:"Baseball Helmet",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_baseball",tags:["Sports","JulyM23","Black","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.05151488588494635,y:-.19998687433606954,z:-.0245622817722769}},{id:1325,name:"Football Helmet",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_football",tags:["Sports","JulyM23","Blue","Yellow","Fbros","JunM24","SepM24"]},is_available:!1,unlock:"purchase",align:{x:-.04832931417978026,y:-.1352946574924434,z:-.024871745773064752}},{id:1326,name:"Swim Cap",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_swimcap",tags:["Sports","JulyM23","Oct23","Blue","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.056393739829843526,y:-.2477807183539309,z:-.02621372851028153}},{id:1327,name:"Frisbee Damage Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frisbee",tags:["Sports","JulyM23","Red","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.1388062207676577,y:-.2588205395914731,z:.05984669179307067}},{id:1328,name:"SPORTS headband",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headband",tags:["Sports","JulyM23","Green","Egg","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.028531595495777218,y:-.19854721990374058,z:-.013057700403261097}},{id:1329,name:"Cone Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cone",tags:["Newsletter","Sports","JulyM23","Orange"]},is_available:!1,unlock:"manual",align:{x:-.08905438095940177,y:-.42381444261433376,z:-.01246906664059666}},{id:1330,name:"Egg Yolk Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggyolk",tags:["Breakfast","Egg","White","Yellow","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.05723363847063201,y:-.2392488492437903,z:-.029219959301922005}},{id:1331,name:"Waffles Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_waffles",tags:["Breakfast","Brown","Yellow","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.042130070070243164,y:-.31705850027197235,z:-.03466427348870399}},{id:1332,name:"Pancakes Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pancakes",tags:["Breakfast","Brown","Yellow","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.06990694206534798,y:-.29184377670850803,z:-.026418624087968023}},{id:1333,name:"Teacup Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_teacup",tags:["Breakfast","White","Red","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.020174507966058464,y:-.3111035460059972,z:-.05108915694622945}},{id:1334,name:"Captain Breakfast Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_captaincrunch",tags:["Breakfast","Newsletter","Blue"]},is_available:!1,unlock:"manual",align:{x:-.0795272416879782,y:-.34252532281063364,z:-.03639624352455051}},{id:1335,name:"Keyhole Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_keyhole",tags:["Scavenger","Black"]},is_available:!1,unlock:"purchase",align:{x:-.06380360008562347,y:-.2806049993457588,z:-.029200200044923463}},{id:1336,name:"Distinguished Gentlemen Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pipe",tags:["Dec23","Scavenger","Brown","Hair"]},is_available:!1,unlock:"purchase",align:{x:-.07267364803907439,y:-.07707951378019828,z:-.030264409392351255}},{id:1337,name:"Wizskull Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wizskull",tags:["Scavenger","Blue","White","Bone","BWD"]},is_available:!1,unlock:"purchase",align:{x:-.07311251264431373,y:-.3864593884402616,z:-.026130767254658238}},{id:1338,name:"Tucked Pencil Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pencilhair",tags:["Pencil2","Sep23","Yellow","Hair"]},is_available:!1,unlock:"purchase",align:{x:.0013188852656638161,y:-.17071437423368385,z:-.00400523791892099}},{id:1339,name:"Slide Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slide",tags:["Pencil2","Sep23","Blue","Red"]},is_available:!1,unlock:"purchase",align:{x:-.061648028991867276,y:-.29935279262378456,z:-.05595923369651101}},{id:1340,name:"Scavenger Hunt Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scavenger",tags:["Pencil2","Sep23","Red","Black","bun_tactic"]},is_available:!1,unlock:"manual",align:{x:.021280807735962526,y:-.08324928006068566,z:-.03461372436507171}},{id:1341,name:"Rainbow Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RainbowWings",tags:["Pencil2","Feb24","Sep24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_rainbow"],align:{x:-.028255568232114003,y:-.20604891688816965,z:-.012931374435978412}},{id:1342,name:"Paper Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paper",tags:["Newsletter","Pencil2","Blue","White"]},is_available:!1,unlock:"manual",align:{x:-.07504639711106442,y:-.32322996356140976,z:-.03434997576052584}},{id:1343,name:"Albino Book Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snake",tags:["Sep22","Drops3","ABHS"]},is_available:!1,unlock:"manual",align:{x:-.10654993328936069,y:-.3049933511591818,z:.010810588651829045}},{id:1344,name:"Heart Backpack",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_heartpack",tags:["Sep22","Drops3","Red","Pink"]},is_available:!1,unlock:"manual",align:{x:.1192583355157325,y:-.1421948706555937,z:.05552651603134384}},{id:1345,name:"Deal with it Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_deal",tags:["Sep22","Drops3","Black","Meme"]},is_available:!1,unlock:"manual",align:{x:-.11043058566823083,y:-.16601334249151134,z:-.050539409068671715}},{id:1346,name:"Kilzomatic Hat",price:6e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kilzomatic",tags:["Sep22","Yellow","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.12905256312871272,y:-.24911179539016315,z:-.0594282252578634}},{id:1347,name:"Sharkbucks Hat",price:6900,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sharkbucks",tags:["Sep22","Pink","Blue"]},is_available:!0,unlock:"purchase",align:{x:.21499460632334902,y:-.03987941087591835,z:.0983899090714259}},{id:1348,name:"The cap cap",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cap",tags:["Newsletter","Blue"]},is_available:!1,unlock:"manual",align:{x:-.033141315905745206,y:-.25396539010293706,z:-.03265648318202702}},{id:1349,name:"Teggtris Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Tetris",tags:["Sep22","Premium","Rainbow","AprM24","bun_gamer"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_teggtris"],align:{x:.053994584418046276,y:-.24203561520647465,z:.02471099723170675}},{id:1350,name:"Scary Balloon Hat",price:1990,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_balloon",tags:["Halloween3","OctM23","Blue","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.09396296415455252,y:-.40272741126518463,z:-.0441197548395883}},{id:1351,name:"Witch Cobwebs Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cobweb",tags:["Halloween3","Newsletter","OctM23","Purple","Black","OctM24"]},is_available:!1,unlock:"manual",align:{x:-.05431075864222201,y:-.3132789494852095,z:-.028827580904545458}},{id:1352,name:"Cauldron Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cauldron",tags:["Halloween3","OctM23","Black","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.06636454224849953,y:-.3565532588626168,z:-.07375228691929708}},{id:1353,name:"Mummy Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mummy",tags:["Halloween3","OctM23","White","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.030624381654509758,y:-.13131398433488894,z:-.013650365127290592}},{id:1354,name:"Black Cat Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kitten",tags:["Halloween3","OctM23","Black","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.08157292019093898,y:-.3068674371149698,z:-.03979017085383357}},{id:1355,name:"Dracula Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dracula",tags:["Halloween3","OctM23","White","Grey","Gray","Black","OctM24"]},is_available:!1,unlock:"purchase",align:{x:.0319311755874756,y:-.22035354384456102,z:.014534916593597402}},{id:1356,name:"Blood Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_BloodWings",tags:["Jun23","Red","Oct24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_bloodwing"],align:{x:-.0031766899539928672,y:-.257898661391988,z:-.001453836099716374}},{id:1357,name:"It's Corn Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_corn",tags:["NovM23","Thanksgiving2","Meme","Yellow","Food","Nov23"]},is_available:!1,unlock:"purchase",align:{x:-.08300421788058454,y:-.3452676390577907,z:-.04519249290448918}},{id:1358,name:"NPS Clan Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_NPS",tags:["League"]},is_available:!1,unlock:"manual",align:{x:-.0698797704830616,y:-.30096415980790403,z:-.03198100537574555}},{id:1359,name:"Drone Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_drone",tags:["Badegg","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.070109722971063,y:-.312839052884192,z:-.02738976843544816}},{id:1360,name:"Tactical Vest",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tacticalvest",tags:["Badegg","Black"]},is_available:!1,unlock:"purchase",align:{x:-.005726648924688327,y:-.0279753566254346,z:-.0026208441828656226}},{id:1361,name:"Medbox Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_medbox",tags:["Badegg","Black"]},is_available:!1,unlock:"purchase",align:{x:-.08406234297441406,y:-.36207676320852444,z:-.0384744708681079}},{id:1362,name:"Crash Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crash",tags:["Badegg","Red"]},is_available:!1,unlock:"purchase",align:{x:-.015373292358376367,y:-.10284669633262417,z:-.025062619631484602}},{id:1363,name:"Fall Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Fall",tags:["Badegg","SepM23","Orange","Brown","NovM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fall"],align:{x:-.018163515810662334,y:-.19512975431341528,z:-.008312670321063961}},{id:1364,name:"Ribbon Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ribbon",tags:["Red"]},is_available:!1,unlock:"purchase",align:{x:-.0526775922207674,y:-.10401408076862528,z:-.024770748952875912}},{id:1365,name:"Santa Hat & Beard",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santabeard",tags:["Christmas2","Newsletter","Red","White"]},is_available:!1,unlock:"manual",align:{x:-.06458211428133787,y:-.09819808490009518,z:.018212343046531076}},{id:1366,name:"Sailor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sailor",tags:["Mar24","Newsletter","White","Seaman"]},is_available:!1,unlock:"manual",align:{x:-.06435460038219576,y:-.2767952786517658,z:-.04267529046957927}},{id:1367,name:"Party Hat 2023",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1368,name:"2023 Headband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09492951642647074,y:-.3559587886582341,z:-.04344521104408777}},{id:1369,name:"Holly Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Holly",tags:["Dec23","Red","Green"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_holy_wings"],align:{x:-.005623716634233666,y:-.18569631620346605,z:-.002573736390560827}},{id:1370,name:"Piano Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_piano",tags:["Rockstar","JanM23","Black","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.08104278879501514,y:-.366555756379946,z:-.03708692812794501}},{id:1371,name:"Gramophone Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gramaphone",tags:["Rockstar","JanM23","Gold","Yellow","Brown","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.16684042187958514,y:-.448131830052956,z:-.06255529683169103}},{id:1372,name:"Sound Wave Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Music",tags:["Rockstar","Premium","JanM23","Blue","Purple","Blurple","Music","SepM24","Mar25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_soundwave"],align:{x:.1473629434689976,y:-.10723354724906936,z:.06744176564235072}},{id:1373,name:"Fancy Band Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fancyband",tags:["Rockstar","JanM23","Blue","Green","Gold","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.00973114550144527,y:-.21567867185108125,z:-.05196604239560981}},{id:1374,name:"Winter Scarf",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarf",tags:["Groundhog","Feb23","Red","Feb24","Feb25"]},is_available:!1,unlock:"purchase",align:{x:-.00784791552887576,y:-.02390157873911347,z:.0015132619478031017}},{id:1375,name:"Bull Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bull",tags:["farm","FebM23","Bone","Brown","Gray","Grey","May24"]},is_available:!1,unlock:"purchase",align:{x:-.11597261106923407,y:-.21024345924677446,z:-.05307577528187574}},{id:1376,name:"Farmer Shirt",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_farmer",tags:["farm","FebM23","Red","May24"]},is_available:!1,unlock:"purchase",align:{x:-.002040217164151592,y:.004750899815876952,z:-.0012440683218514215}},{id:1377,name:"Cowbell Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowbell",tags:["farm","FebM23","Silver","May24"]},is_available:!1,unlock:"purchase",align:{x:-.1137706593369594,y:-.34387384785790454,z:-.06759212950473148}},{id:1378,name:"Barrel Eye",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_barrel",tags:["Drops4","Mar23","AugM23","Brown","Silver","Gray","Grey","AprM24","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.04510483699042789,y:-.16127109706054976,z:-.021459554866939207}},{id:1379,name:"Kiwi Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kiwi",tags:["Drops4","Mar23","AugM23","Yellow","Brown","AprM24","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.11486035543267459,y:-.10621039239967178,z:-.05256110579263329}},{id:1380,name:"Eggscellent Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggscellent",tags:["Drops4","Mar23","AugM23","Blue","White","AprM24","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.10978212137635612,y:-.2845944901731632,z:-.05023481757921583}},{id:1381,name:"KJs Dad",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oldman",tags:["Drops4","Mar23","Old","Grey","Gray","Meme","Hair"]},is_available:!1,unlock:"purchase",align:{x:-.08705671410668012,y:-.14984666212434217,z:-.03983416645942446}},{id:1382,name:"Novosuper Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_novo",tags:["Drops4","Mar23","Black","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.06499036673467007,y:-.2604408479505427,z:-.02975142823595156}},{id:1383,name:"Bracket Shell Sombrero",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_banana",tags:["Drops4","Mar23","Yellow","Blue","Bananas"]},is_available:!1,unlock:"manual",align:{x:-.014458675665466547,y:-.2596999000231326,z:-.007485859219670016}},{id:1384,name:"The Mask of Paradise",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paradise",tags:["Drops4","Mar23","Black"]},is_available:!1,unlock:"manual",align:{x:-.06563638857843951,y:-.23343711723846364,z:-.030038989575604757}},{id:1385,name:"xQc Hair",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_xhair",tags:["Drops4","Mar23","White","Black","Meme"]},is_available:!1,unlock:"manual",align:{x:-.04473346186974193,y:-.17901427823277163,z:-.011890543194713117}},{id:1386,name:"Marshmallow Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_marshmallow",tags:["Drops4","Mar23","White","Red"]},is_available:!1,unlock:"manual",align:{x:-.02750959876124981,y:-.22266327721726858,z:-.018605044079386478}},{id:1387,name:"Big Brain Hat",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_brain",tags:["Drops4","Mar23","AugM23","OctM23","Pink","AprM24","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.07430287969300897,y:-.2543552689406354,z:.008162311590720062}},{id:1388,name:"Fusion Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fusion",tags:["Newsletter","Mar23","White","Blue"]},is_available:!1,unlock:"manual",align:{x:-.1272141776982595,y:-.1666806724852818,z:-.058220546897934496}},{id:1389,name:"Harp Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Harp",tags:["Premium","Mar23","Gold","bun_cupid"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_harp"],align:{x:.1072334707841979,y:-.146697731985604,z:.05092813371967474}},{id:1390,name:"Longhorn Bros",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_longhorns",tags:["BBros","MarM23","Bone","Yellow","White"]},is_available:!1,unlock:"purchase",align:{x:-.06454526283356454,y:-.2600443036405822,z:-.029539627617489794}},{id:1391,name:"Purdue Bros",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purdue",tags:["BBros","MarM23","Yellow","White","Black"]},is_available:!1,unlock:"purchase",align:{x:-.08672038099648693,y:-.25892611471854643,z:-.039685665312970575}},{id:1392,name:"Scoreboard Bros",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scoreboard",tags:["BBros","MarM23","Blue","Red","SepM24"]},is_available:!1,unlock:"purchase",align:{x:-.11214738641040467,y:-.3311205910061972,z:-.08632608055886049}},{id:1393,name:"Drenched Bros",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerjuice",tags:["BBros","MarM23","Blue","Grey","Gray","Orange","Electrolytes"]},is_available:!1,unlock:"purchase",align:{x:-.09519071283078828,y:-.3547416629903286,z:-.00511330334446225}},{id:1394,name:"Hooped Hat",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Hoop",tags:["BBros","MarM23","White","Red","AprM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_hooped"],align:{x:-.01236207382970056,y:-.18682160652455493,z:-.005657596523953062}},{id:1395,name:"Brown Wizard Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_brownwizard",tags:["Heroes","Apr23","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.0804820787820959,y:-.34663407402899415,z:-.03683323194092522}},{id:1396,name:"Elf Ears Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_elfear",tags:["Heroes","Apr23","Grey","Gray","Hair"]},is_available:!1,unlock:"purchase",align:{x:.008861862981141222,y:-.14702279082100755,z:.005539460612354219}},{id:1397,name:"Dwarf Beard",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dwarf",tags:["Heroes","Apr23","Orange"]},is_available:!1,unlock:"purchase",align:{x:-.16295681170247578,y:.09907638184290868,z:-.07457841737562876}},{id:1398,name:"Gelatinous Cube Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cube",tags:["Monsters","Apr23","Green"]},is_available:!1,unlock:"purchase",align:{x:-.11104016614231416,y:-.3456780036754328,z:-.03357725521046473}},{id:1399,name:"Purple Worm Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wurm",tags:["Monsters","Apr23","Purple","Pink"]},is_available:!1,unlock:"purchase",align:{x:-.011546657671685487,y:-.19726818778411098,z:-.03183251542878959}},{id:1400,name:"Question Block Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_MysteryWings",tags:["AprM23","Aug23","JanM24","White","Yellow","?"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_qwings"],align:{x:.11004874508599694,y:-.20316619077538176,z:.050364640570313604}},{id:1401,name:"Green Dino Head",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_greendino",tags:["Dino2","May23","Green","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.10805242748329436,y:-.27514999829643605,z:-.04945692647317679}},{id:1402,name:"Blue Dino Tail",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailblue",tags:["Dino2","May23","Blue","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.09757484018737961,y:-.13401897970572288,z:.16449231309178208}},{id:1403,name:"Caveman Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_caveman",tags:["Dino2","May23","Brown","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.010869634182571808,y:-.07848510092529004,z:-.010236613975144027}},{id:1404,name:"Leopard Sash",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skinsash",tags:["Dino2","May23","Orange","Black","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.018109172961424003,y:.014556123753856731,z:-.03063797581379002}},{id:1405,name:"Tiger Sash",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tigersash",tags:["Dino2","May23","Newsletter","Orange","Black","AugM24"]},is_available:!1,unlock:"manual",align:{x:.01876618405057595,y:.013850888481395263,z:-.03046859499892196}},{id:1406,name:"Egg Chest Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goldchest",tags:["Eggflation","MayM23","Gold","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.05230654862607875,y:-.380141103214434,z:-.0239331287279429}},{id:1407,name:"Golden Nugget Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goldnugget",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.04822470318959571,y:-.213927101437404,z:-.02207040007641481}},{id:1408,name:"Photobooth Top Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothtophat",tags:["Photo","Jun23","Black","premFeatOne","MarM25"]},is_available:!1,unlock:"purchase",align:{x:-.21431328988746134,y:-.16351137409181637,z:-.09961284301516274}},{id:1409,name:"Photobooth Bow",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothbow",tags:["Photo","Jun23","Black","Red"]},is_available:!1,unlock:"purchase",align:{x:-.2098841731917156,y:-.15178669997345284,z:-.12104457557040586}},{id:1410,name:"Photobooth Crown",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothcrown",tags:["Photo","Jun23","Gold"]},is_available:!1,unlock:"purchase",align:{x:-.19827018482043246,y:-.21454857065154342,z:-.08740226191376034}},{id:1411,name:"Photobooth Cake",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothcake",tags:["Newsletter","Photo","Jun23","White"]},is_available:!1,unlock:"manual",align:{x:-.17442659431714547,y:-.2307127983402863,z:-.0585189294705932}},{id:1412,name:"Red Snorkel",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snorkelred",tags:["Summer2","JunM23","Red","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.08452722773723353,y:-.08806286153092957,z:-.024090441006014318}},{id:1413,name:"Blue Snorkel",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snorkelblue",tags:["Summer2","JunM23","Red","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.08452722773723353,y:-.08806286153092957,z:-.024090441006014318}},{id:1414,name:"Beach Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beach",tags:["Summer2","JunM23","Yellow","Green","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.07565028269552926,y:-.25895549324911094,z:.006404318418288427}},{id:1415,name:"Sandcastle Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sandcastle",tags:["Summer2","JunM23","Gold","Yellow","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.12876061452866017,y:-.4097997603581035,z:-.030514806124142535}},{id:1416,name:"Crab Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crab",tags:["Summer2","JunM23","Red","Meme"]},is_available:!1,unlock:"purchase",align:{x:-.10068510003333841,y:-.24499355337767836,z:-.02337243991233373}},{id:1417,name:"Octopus Surfboard",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Octopus",tags:["Summer2","JunM23","Brown","JunM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_surf"],align:{x:.22393085055634598,y:-.11030590875211177,z:.11750241492051972}},{id:1418,name:"Equinox Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinox",tags:["Equinox","July23","Gold","Yellow","Blue","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.037617305074609586,y:-.2172802487320009,z:-.019265288039641393}},{id:1419,name:"Equinox Sun Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinoxSun",tags:["Equinox","July23","Gold","Yellow","Blue","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.06938082193720652,y:-.2592012664240997,z:-.03174618472965968}},{id:1420,name:"Equinox Moon Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinoxMoon",tags:["Equinox","July23","Blue","White","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.07093676588009012,y:-.23125672830481214,z:-.032460175208326225}},{id:1421,name:"Bonsai Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bonsai",tags:["Equinox","July23","Blue","Yellow","Green","Brown","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.09619353264858921,y:-.4061319323215409,z:-.03900086303481454}},{id:1422,name:"Skull Trio Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skulls",tags:["Newsletter","July23","Bone","Brown"]},is_available:!1,unlock:"manual",align:{x:-.07507010492730903,y:-.3635214269340585,z:-.03551129767586808}},{id:1423,name:"Scales of Justice Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Scales",tags:["July23","Gold","JanM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_scales"],align:{x:.19150246040586572,y:-.19256754847920388,z:.08764254943023048}},{id:1424,name:"Biker Helmet",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremehelm",tags:["Sports2","JulyM23","Black","Red","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.050801832540607994,y:-.20212157456782848,z:-.023253939707554898}},{id:1425,name:"Climbing Gear Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremeclimb",tags:["Sports2","JulyM23","Blue"]},is_available:!1,unlock:"purchase",align:{x:.021732529407735512,y:-.029624623104741232,z:-.005432548962853279}},{id:1426,name:"Ski Bum Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremeskis",tags:["Sports2","JulyM23","Rainbow"]},is_available:!1,unlock:"purchase",align:{x:.058974643037587815,y:-.25217970728432826,z:.03644558094795056}},{id:1427,name:"Stickers Helmet",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_stickers",tags:["Sports2","JulyM23","Black","Egg"]},is_available:!1,unlock:"purchase",align:{x:-.029612593507459373,y:-.1538837240702784,z:-.020693402475527256}},{id:1428,name:"Hang Glider Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Glider",tags:["Sports2","JulyM23","Rainbow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_glider"],align:{x:.15806814144004577,y:-.19535527419964233,z:.07234108048743282}},{id:1429,name:"Red Kart",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartRed",tags:["Kart","Aug23","Red","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.021915916439513516,y:.13129564198078736,z:.010018611906794539}},{id:1430,name:"Green Kart",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartGreen",tags:["Kart","Aug23","Green","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.0208010053824621,y:.12650892279592885,z:.009517672561720425}},{id:1431,name:"Pink Kart",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartPink",tags:["Kart","Aug23","Pink","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.021915916439513516,y:.13129564198078736,z:.010018611906794539}},{id:1432,name:"Yellow Kart",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartYellow",tags:["Kart","Aug23","Yellow","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.02370142462174929,y:.1390009434188464,z:.01084507135885926}},{id:1433,name:"Piranha Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_piranha",tags:["Kart","Aug23","Red","White","Green"]},is_available:!1,unlock:"purchase",align:{x:.0006045990621803554,y:-.4501550155901276,z:.0002854995959842843}},{id:1434,name:"Big Biter Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chomp",tags:["Kart","Aug23","Blue","Chomp"]},is_available:!1,unlock:"purchase",align:{x:-.03449437859488835,y:-.4255526254165696,z:-.01578687531337597}},{id:1435,name:"Gang Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gang",tags:["SL","Blue"]},is_available:!1,unlock:"manual",align:{x:-.0742216025570741,y:-.31996611618895443,z:-.03396807765621901}},{id:1436,name:"Fluffly Meteor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fluffy",tags:["Drops5","AugM23","Blue"]},is_available:!1,unlock:"manual",align:{x:-.10687674474070041,y:-.3963768688642315,z:-.009694370022676202}},{id:1437,name:"King Hayden Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hayden",tags:["Drops5","AugM23","Gold"]},is_available:!1,unlock:"manual",align:{x:-.09881768637038846,y:-.27704802426136776,z:.02766423062606671}},{id:1438,name:"Anarchy Aiden",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academymale",tags:["Sep23","Pencil3","Egg","Blue","White","Sep24"]},is_available:!1,unlock:"purchase",align:{x:-.003854125100355432,y:.02120377863344247,z:-.0017562001329524124}},{id:1439,name:"Anarchy Ashley",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academyfemale",tags:["Sep23","Pencil3","Egg","Blue","White","Sep24"]},is_available:!1,unlock:"purchase",align:{x:.00533333956619142,y:.02741258526573187,z:.0024410398311239256}},{id:1440,name:"Dunce Cap",price:4e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dunce",tags:["Sep23","Pencil3","White"]},is_available:!1,unlock:"purchase",align:{x:-.08967990138936432,y:-.3866815477837924,z:-.04443854680037673}},{id:1441,name:"The Toolbelt",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toolbelt",tags:["Sep23","Pencil3","Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.013502744844512193,y:.020367655645501692,z:.04201065787545022}},{id:1442,name:"Wrestle Shoes Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shoetie",tags:["SepM23","WBros","Black"]},is_available:!1,unlock:"purchase",align:{x:-.10093822397363705,y:-.1473264329539556,z:-.020321618573445617}},{id:1443,name:"Wrestling Belt",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wrestlebelt",tags:["SepM23","WBros","Gold","Black"]},is_available:!1,unlock:"purchase",align:{x:.0110659387040144,y:.10248215404849947,z:.005069916726395229}},{id:1444,name:"Wrestling Ring Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wrestlering",tags:["SepM23","WBros","White","Black","Red","White","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.07282671191567625,y:-.3136625998694875,z:-.03332971179400285}},{id:1445,name:"The Grand Entrance Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Firework",tags:["SepM23","WBros","Red","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_wbs"],align:{x:-.0572610207721147,y:-.2426137142559055,z:-.026205906376740168}},{id:1446,name:"Angler Fish Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angler",tags:["Oct23","Halloween4","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.11856385818199167,y:-.2454609004466619,z:-.05426164633452166}},{id:1447,name:"Hungry Shark Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shark",tags:["Oct23","Halloween4","Grey","Gray","Silver"]},is_available:!1,unlock:"purchase",align:{x:-.0482715334959154,y:-.36548575131680006,z:-.022096797700171797}},{id:1448,name:"Baby Ghost Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_babyghost",tags:["Oct23","Halloween4","White","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.07443624059748011,y:-.31585657908966125,z:-.03406634115519175}},{id:1449,name:"Captain Inksalot Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_squidpatch",tags:["Oct23","Halloween4","Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:-.04399797329171973,y:-.32983261562076716,z:-.0164697814700632}},{id:1450,name:"Demon Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelDemon",tags:["Oct23","Halloween4","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_demonpixel"],align:{x:.05466192320814933,y:-.14156134563379286,z:.02501634429342456}},{id:1451,name:"Purple Witch's Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purplewitch",tags:["OctM23","Halloween4","Purple"]},is_available:!1,unlock:"purchase",align:{x:-.07349753031540551,y:-.3165613774455478,z:-.033642337838353575}},{id:1452,name:"Wednesday Morning Hair",price:2020,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_addams",tags:["OctM23","Halloween4","Black"]},is_available:!1,unlock:"purchase",align:{x:-.02403582432085649,y:-.07057495271745284,z:-.011000176764286496}},{id:1453,name:"Ectoplasmic Goo",price:1980,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slime",tags:["OctM23","Halloween4","Green"]},is_available:!1,unlock:"purchase",align:{x:-.012645094542945934,y:-.13571641390181843,z:-.011392387757339667}},{id:1454,name:"Stapled Bear Friend",price:2010,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bear",tags:["OctM23","Halloween4","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.07585449914001297,y:-.31015195172031684,z:-.03912391584435121}},{id:1455,name:"Ancient Egg Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ruins",tags:["Nov23","Mayan","Green","Gray","Grey","Stone","Plant"]},is_available:!1,unlock:"purchase",align:{x:-.09525324482895936,y:-.25954823271889493,z:-.016011557004969507}},{id:1456,name:"The Ruins Explorer",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ruinsexplorer",tags:["Nov23","Mayan","Brown","Stone","Plant","Gray","Grey"]},is_available:!1,unlock:"purchase",align:{x:-.04924187010309966,y:-.27254017384302986,z:-.022536471365236677}},{id:1457,name:"Indianapolis Jones",price:1750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_explorer",tags:["Nov23","Mayan","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.02506490018106522,y:-.14141917816246918,z:-.010903410658237134}},{id:1458,name:"Mayan Warrior Mask",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mayan",tags:["Nov23","Mayan","Brown","Green","Yellow","Nov24"]},is_available:!1,unlock:"purchase",align:{x:-.10286629613972376,y:-.2713354927050634,z:-.047070442523333575}},{id:1459,name:"Meso-Mage Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mayan2",tags:["Nov23","Mayan","Brown","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.10069550360080193,y:-.26879019980348207,z:-.044534697383819294}},{id:1460,name:"The Fallen Explorer",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_overgrown",tags:["Nov23","Newsletter","Mayan","Red","Green","Mushroom"]},is_available:!1,unlock:"manual",align:{x:-.06364583554386138,y:-.24908473548113697,z:-.029127965144288642}},{id:1461,name:"Ruins Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Ruins",tags:["Nov23","Mayan","Green","Gray","Grey"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_mayan"],align:{x:.13483230162508453,y:-.28814409860433626,z:.05063336225019538}},{id:1462,name:"Fall Pilgrim Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fallhat",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase",align:{x:-.07658982353458921,y:-.3118313473182215,z:-.014616762701649633}},{id:1463,name:"Kindergarden Turkey",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sillyturkey",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase",align:{x:-.08171040609951863,y:-.2591170302455612,z:-.03739115726709469}},{id:1464,name:"All the Fixin's Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinner",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase",align:{x:-.12748192914777334,y:-.26717934205433513,z:-.058343003403527716}},{id:1465,name:"Bread Cat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toastcat",tags:["Xsolla","Brown","Meow","Kitty","Kitten"]},is_available:!1,unlock:"manual",activeProduct:!1,sku:["item_hat_breadcat"],align:{x:-.106919336396047,y:-.2016934352689943,z:-.048926035350258745}},{id:1466,name:"Wreathed Egg",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wreath",tags:["Christmas3","Dec23","Green","Red","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.07670957484040786,y:-.26026926108724013,z:-.035110142006809786}},{id:1467,name:"Frosty",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snowman",tags:["Christmas3","Dec23","White","Yellow","Carrot","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.12526994807970437,y:-.31664436738973323,z:-.08257601239245954}},{id:1468,name:"Mistletoe Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mistletoe",tags:["Christmas3","Dec23","Green","Red","Kiss","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.04957526960208325,y:-.2876501081983409,z:.013757112569296626}},{id:1469,name:"Eggsmas Tree",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_christmastree",tags:["Christmas3","Dec23","Green","Red","Star","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.10231905708142319,y:-.4406982411880487,z:-.046825533367968686}},{id:1470,name:"Snow Owl Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SnowOwl",tags:["Christmas3","Dec23","Green","Red","Dec24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_owl"],align:{x:.061815243583282165,y:-.25447310305349125,z:.02258718103042709}},{id:1471,name:"Egg'Noggin",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggnog",tags:["Christmas3","Dec23","Yellow","Red","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.09318399398619048,y:-.4116537111213029,z:.07701051516243501}},{id:1472,name:"Party Hat 2024",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2024",tags:["NewYears","2024","DecM23","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1473,name:"2024 Headband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2024",tags:["NewYears","2024","DecM23","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.09492951642647074,y:-.3559587886582341,z:-.04344521104408777}},{id:1474,name:"Discord Dev Day Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_discorders",tags:["promo","Blurple"]},is_available:!1,unlock:"manual",align:{x:-.06795442489383152,y:-.3035879729134885,z:-.031096382242767784}},{id:1475,name:"Disco Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_NewYearsDisco",tags:["NewYears","2024","DecM23","Blurple"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_disco"],align:{x:.030166434329798042,y:-.27482812378136545,z:.013805896913517343}},{id:1476,name:"The CyberCluck",price:125e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cybercar",tags:["Cybertruck","Truck","Musk","Silver","Grey","Gray"]},is_available:!0,unlock:"purchase",align:{x:-.013474577056496795,y:.16930203481819195,z:-.006157352086425649}},{id:1477,name:"Lightning Helmet",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lightninghelm",tags:["JanM24","Racer","Orange"]},is_available:!0,unlock:"purchase",align:{x:-.07491807008118823,y:-.20432339514493747,z:-.0349436672778321}},{id:1478,name:"Skull Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skullhelm",tags:["JanM24","Racer","Gray","Grey","Silver"]},is_available:!0,unlock:"purchase",align:{x:-.07931754284925585,y:-.21385281959261682,z:-.03630409160686873}},{id:1479,name:"Targeted Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_targetbandana",tags:["JanM24","Black","Racer"]},is_available:!0,unlock:"purchase",align:{x:-.024794948123451288,y:-.21502251051068977,z:-.01141950405570527}},{id:1480,name:"The Racing Spoiler Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SpoilerWings",tags:["JanM24","Egg","Racer","Orange"]},is_available:!0,unlock:"premium",activeProduct:!1,sku:["item_hat_racecar"],align:{x:-.00825870243090332,y:-.07832172595582376,z:-.0037842788943276418}},{id:1481,name:"Cute Fox Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fox",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:-.16077933302191028,y:-.19580449761747687,z:-.07358187769334479}},{id:1482,name:"Cute Mouse Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mouse",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:-.08480075319980385,y:-.30491564699774754,z:-.038809705964513}},{id:1483,name:"Cute Deer Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fawn",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:-.08048338470361305,y:-.3416960134560574,z:-.03683382960738385}},{id:1484,name:"Cute Squirrel Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_squirrel",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:.11650162262118846,y:-.2758969224198887,z:.053319864471162576}},{id:1485,name:"Cute Owl Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_owl",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:-.06367038537844705,y:-.24437293359297874,z:-.02914298608834659}},{id:1486,name:"Shell Wiki Staff Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wikiStaff",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"manual",align:{x:-.04096624685909722,y:-.20852336490380108,z:-.021048325634382775}},{id:1487,name:"Argentina Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfArgentina",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05244075537132131,y:-.1593111862268879,z:-.03961551049545556}},{id:1488,name:"England Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfEngland",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05224789100823646,y:-.15928168615741,z:-.040297181127995435}},{id:1489,name:"America Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfAmerica",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05224791201296153,y:-.1592816425351442,z:-.04029725629118422}},{id:1490,name:"Brazil Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfBrazil",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05244074224295803,y:-.15931118991349424,z:-.03961550448716081}},{id:1491,name:"Portugal Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfPortugal",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05244074224295803,y:-.15931118991349424,z:-.03961550448716081}},{id:1492,name:"Patchwork Cap",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_patchwork",tags:["Mar24","StPatricksDay","Brown","Mar24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.07898811547084694,y:-.25701601472386404,z:-.03585440128238787}},{id:1493,name:"Leprechaun Mini Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leprechaunsmall",tags:["Mar24","StPatricksDays","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase",align:{x:-.10272882257863225,y:-.32481178931668575,z:.025166638590053192}},{id:1494,name:"Bad Bunny Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ScaryBunny",tags:["Mar24","Darko","Grey","Gray","Teeth","bun_badbunny"]},is_available:!1,unlock:"premium",align:{x:-.009802806022177979,y:-.18623701441787288,z:-.0044903104315981435}},{id:1495,name:"Slayaway Bunnyface",price:1750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slashbunny",tags:["MarM24","Skullface","Camp","White","Red","Teeth","Easter","Bunny","Carrot","Nov24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.09468929728517828,y:-.2524876583691392,z:-.02302245686535491}},{id:1496,name:"Chocolate Drip",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chocolate",tags:["MarM24","Egg","Brown","Easter","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.040914625540970695,y:-.1707145084561087,z:-.0023571459506205733}},{id:1497,name:"Trucker Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_trucker",tags:["MarM24","Default","Brown"]},is_available:!0,unlock:"default",align:{x:-.011117594625622118,y:-.15517299675012275,z:.00012578030894222492}},{id:1498,name:"Winner Winner Chicken Dinner",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chicknwinner",tags:["MarM24","Default","Brown"]},is_available:!0,unlock:"default",align:{x:-.08098020615453727,y:-.34813780272226147,z:-.03706120369985133}},{id:1499,name:"Newsboi Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_newsboy",tags:["MarM24","Default","Brown"]},is_available:!0,unlock:"default",align:{x:-.08738006395461273,y:-.265458179063754,z:-.03999385063925037}},{id:1500,name:"Cyborg Happy Bear",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bearSteambot",tags:["Apr24","EGGORG"]},is_available:!1,unlock:"purchase",align:{x:-.10475418436508388,y:-.26662521760024394,z:-.047941544660631885}},{id:1501,name:"Cyborg Train Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_trainSteambot",tags:["Apr24","EGGORG"]},is_available:!1,unlock:"purchase",align:{x:-.12178592407166589,y:-.2588505491467472,z:-.02727616374253189}},{id:1502,name:"Cyborg Gas Mask",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gasSteambot",tags:["Apr24","EGGORG"]},is_available:!1,unlock:"purchase",align:{x:-.11636451395311953,y:-.1695215645537993,z:-.05478758198568795}},{id:1503,name:"Cyboregg",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_steambot",tags:["Apr24","EGGORG","Borg","Brown","bun_borg"]},is_available:!1,unlock:"manual",align:{x:-.09077302794951159,y:-.1406921107433129,z:-.06263409753259673}},{id:1504,name:"30/30 Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_3030",tags:["Apr24","Nate"]},is_available:!1,unlock:"premium",align:{x:-.12075649171164304,y:-.2670312405309474,z:-.055266825951265475}},{id:1505,name:"iMoRTaL_Mafia Lion Hat ",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lion",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual",align:{x:-.05523263519859323,y:-.20578154478727628,z:-.02608652284875536}},{id:1506,name:"Red Stag Antlers",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_antlerRed",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual",align:{x:-.08392912196785507,y:-.3869049059653415,z:-.03841079731237207}},{id:1507,name:"Blue Stag Antlers",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_antlerBlue",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual",align:{x:-.08392912196785507,y:-.3869049059653415,z:-.03841079731237207}},{id:1508,name:"Duck Bill",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_duck",tags:["May24","Farm","Quack"]},is_available:!1,unlock:"purchase",align:{x:-.25727256982514657,y:-.08503653969461433,z:-.11774476940243431}},{id:1509,name:"Piggums",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pig",tags:["May24","Farm","Oink"]},is_available:!1,unlock:"purchase",align:{x:.0340176834848851,y:-.11904433109192025,z:.015571891552903672}},{id:1510,name:"Golden Waffle Wings",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_WaffleWings",tags:["MayM24","Chicken&Waffles","Yellow","Food"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_waffle"],align:{x:.11523366883526381,y:-.19511899730781984,z:.052737560135949865}},{id:1511,name:"Ant Antennae",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_redantenna",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"purchase",align:{x:-.1412809402214923,y:-.2904071127570663,z:-.06465829072819218}},{id:1512,name:"Blue Antennae",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_blueantenna",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"purchase",align:{x:-.1412809402214923,y:-.2904071127570663,z:-.06465829072819218}},{id:1513,name:"Ladybug",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ladybug",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"purchase",align:{x:-.0816662276945972,y:-.27816936896021205,z:-.03737829669169529}},{id:1514,name:"Snail Shell",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shell",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"purchase",align:{x:-.09442372996202719,y:-.2958729805626792,z:.007481968370596004}},{id:1515,name:"Tarantula Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Tarantula",tags:["Jun24","Bugs","Red","bun_arach"]},is_available:!1,unlock:"manual",align:{x:.023468912065839564,y:-.279627927938108,z:.01074072519656108}},{id:1516,name:"Dragonfly Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DragonflyWings",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_dfly"],align:{x:.11760358438311785,y:-.204291946057281,z:.05382216991343898}},{id:1517,name:"The Beekeeper",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beekeeper",tags:["Jun24","Bugs","Statham","Jason","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.051595910871738315,y:-.22910633203368747,z:-.026408647788614875}},{id:1518,name:"White Pawn",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pawnWhite",tags:["July24","Chess","Piece","White"]},is_available:!1,unlock:"purchase",align:{x:-.09967709355043963,y:-.4300108501066764,z:-.04561455059869335}},{id:1519,name:"White Bishop",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bishopWhite",tags:["July24","Chess","Piece","White"]},is_available:!1,unlock:"purchase",align:{x:-.08994075415156222,y:-.47119862188630207,z:-.04115369218057641}},{id:1520,name:"White Knight",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knightWhite",tags:["July24","Chess","Piece","White","Horse"]},is_available:!1,unlock:"purchase",align:{x:-.08731390904576974,y:-.4432797369028318,z:-.03995624085670224}},{id:1521,name:"White Rook",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rookWhite",tags:["July24","Chess","Piece","White","Castle"]},is_available:!1,unlock:"purchase",align:{x:-.08311623226752252,y:-.41111796217322916,z:-.038035953525808575}},{id:1522,name:"White Queen",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_queenWhite",tags:["July24","Chess","Piece","White"]},is_available:!1,unlock:"purchase",align:{x:-.09676844906929438,y:-.4813948621908833,z:-.044282912197643465}},{id:1523,name:"White King",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kingWhite",tags:["July24","Chess","Piece","White"]},is_available:!1,unlock:"purchase",align:{x:-.10104719864936396,y:-.4825457105896669,z:-.0462449489911656}},{id:1524,name:"Black Pawn",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pawnBlack",tags:["July24","Chess","Piece","Black"]},is_available:!1,unlock:"purchase",align:{x:-.09967707086878352,y:-.43001083935536255,z:-.04561455660581626}},{id:1525,name:"Black Bishop",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bishopBlack",tags:["July24","Chess","Piece","Black"]},is_available:!1,unlock:"purchase",align:{x:-.08994075415156222,y:-.47119862188630207,z:-.04115369218057641}},{id:1526,name:"Black Knight",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knightBlack",tags:["July24","Chess","Piece","Black","Horse"]},is_available:!1,unlock:"purchase",align:{x:-.08731400739706996,y:-.4432797255345075,z:-.03995627767414145}},{id:1527,name:"Black Rook",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rookBlack",tags:["July24","Chess","Piece","Black","Castle"]},is_available:!1,unlock:"purchase",align:{x:-.0831161830361602,y:-.411117975998003,z:-.03803593099470326}},{id:1528,name:"Black Queen",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_queenBlack",tags:["July24","Chess","Piece","Black"]},is_available:!1,unlock:"purchase",align:{x:-.09676844906929438,y:-.4813948621908833,z:-.044282912197643465}},{id:1529,name:"Black King",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kingBlack",tags:["July24","Chess","Piece","Black"]},is_available:!1,unlock:"purchase",align:{x:-.10104719864936396,y:-.4825457105896669,z:-.0462449489911656}},{id:1530,name:"Sciclops Visor",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cyclops",tags:["JulyM24","Eggx-men","xmen","marvel","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.10551757425891828,y:-.09622404746099888,z:-.04829089948682046}},{id:1531,name:"Wolfverine Mask",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_yellowmask",tags:["JulyM24","Eggx-men","xmen","marvel","Nov24"]},is_available:!1,unlock:"purchase",align:{x:-.06162407556999916,y:-.18689179115304871,z:-.02820272419661591}},{id:1532,name:"Deadpond Swords",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_deadswords",tags:["JulyM24","Eggx-men","xmen","marvel"]},is_available:!1,unlock:"purchase",align:{x:.11204319930156603,y:-.23497365642615092,z:.046029418062671246}},{id:1534,name:"Tempest Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lightning",tags:["JulyM24","Eggx-men","xmen","marvel"]},is_available:!1,unlock:"purchase",align:{x:.007895889724584215,y:-.14803468788029917,z:.0043091670559296524}},{id:1535,name:"Collossal Headgear",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chromeegg",tags:["JulyM24","Eggx-men","xmen","marvel"]},is_available:!1,unlock:"purchase",align:{x:-.036094262557422985,y:-.15544419146008914,z:-.01651084784419639}},{id:1536,name:"Little Green Man",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_alien",tags:["Aug24","Galeggsy","Green"]},is_available:!1,unlock:"purchase",align:{x:-.1551552243277312,y:-.28629906630445223,z:-.07353908510677121}},{id:1537,name:"The UFO",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_alienufo",tags:["Aug24","Galeggsy"]},is_available:!1,unlock:"purchase",align:{x:.03848398917924367,y:.148136853763829,z:.01312069278266803}},{id:1538,name:"ZORG",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_alienChill",tags:["Aug24","Galeggsy","bun_zorg"]},is_available:!1,unlock:"manual",align:{x:-.05840094009621888,y:-.25156516666717677,z:-.026727631849014305}},{id:1539,name:"Rizz Lightyear",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_LightyearWings",tags:["Aug24","Galeggsy"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_lighty"],align:{x:.16984050226076874,y:-.1521365675214874,z:.0777287904392478}},{id:1540,name:"Pterodactyl Buddy",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pterodactyl",tags:["AugM24","Dino"]},is_available:!1,unlock:"purchase",align:{x:-.09900159122890684,y:-.3764694998272551,z:-.04531206341050714}},{id:1541,name:"Fossil Fedora",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bonehat",tags:["AugM24","Dino"]},is_available:!1,unlock:"purchase",align:{x:-.07596886143235793,y:-.32452148246261436,z:-.03477332843740433}},{id:1542,name:"ATV - All Teeth Vehicle",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_atvteeth",tags:["AugM24","Dino"]},is_available:!1,unlock:"purchase",align:{x:.024516817859058904,y:.10342963067335154,z:.011220307084232828}},{id:1543,name:"T-Rex Skull Mask",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rexskull",tags:["AugM24","Dino"]},is_available:!1,unlock:"purchase",align:{x:-.11496248534634868,y:-.28550241077441996,z:-.052610582983558585}},{id:1544,name:"Dracolich Wings ",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_BoneWings",tags:["AugM24","Dino"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_dlich"],align:{x:.1090015378592365,y:-.17438504153549697,z:.04988537825347225}},{id:1545,name:"Eggy Potter Glasses",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lightningglasses",tags:["Sep24","EggyP"]},is_available:!1,unlock:"purchase",align:{x:-.12228432910310749,y:-.15101147204329735,z:-.055964364408221}},{id:1546,name:"Mandrake Leaves",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mandrakeplant",tags:["Sep24","EggP","bun_plant"]},is_available:!1,unlock:"manual",align:{x:-.01732750010110795,y:-.42800164534284146,z:.019524762330098366}},{id:1547,name:"The Sorta Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leatherface",tags:["Sep24","EggyP","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.09513927360790042,y:-.4097619414724307,z:-.04354120798716887}},{id:1548,name:"The Guardian",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_guardian",tags:["SepM24","Football","Fbros"]},is_available:!1,unlock:"purchase",align:{x:-.03805563218712571,y:-.13664976044984156,z:-.022544277484762232}},{id:1549,name:"Shell Shoulders",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shoulderpads",tags:["SepM24","Football","Fbros"]},is_available:!1,unlock:"purchase",align:{x:-.0393742662174601,y:-.1719689816208525,z:-.018019930672465434}},{id:1550,name:"The Raiders Garb",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Raiders",tags:["SepM24","Football","Fbros"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_raid"],align:{x:-.06081399440956914,y:-.17548223840044253,z:-.027831984430469872}},{id:1551,name:"Quoth, the Raven",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_raven",tags:["Oct24","Black","Newsletter","Halloween5"]},is_available:!1,unlock:"manual",align:{x:-.09488753792390403,y:-.42974676410640456,z:-.02479746319860554}},{id:1552,name:"Neon Birdo Mask",price:3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Neon",tags:["Oct24","Black","Newsletter","Halloween5"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_neon"],align:{x:-.04860903410989448,y:-.21843568312173384,z:-.0222462920273842}},{id:1553,name:"Shellraiser",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pins",tags:["OctM24","Halloween5"]},is_available:!1,unlock:"purchase",align:{x:-.07104303718679184,y:-.30597407514043984,z:-.032509614041548285}},{id:1554,name:"Frankenstein's Egg",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frank",tags:["OctM24","Halloween5"]},is_available:!1,unlock:"purchase",align:{x:-.03692161325411414,y:-.19505344100900457,z:-.01689742271140579}},{id:1555,name:"Skullface's Mom",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skullfacemom",tags:["Nov24","SC2","Mum"]},is_available:!1,unlock:"purchase",align:{x:-.04055684615546595,y:-.2479488495980653,z:-.019373281719983523}},{id:1556,name:"Tentacle",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tentacleshoe",tags:["Nov24","SC2","Mum"]},is_available:!1,unlock:"purchase",align:{x:-.08424219372301156,y:-.4331324392171507,z:-.03587487569002756}},{id:1557,name:"Werewolf",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_werewolf",tags:["Nov24","SC2","Mum"]},is_available:!1,unlock:"purchase",align:{x:-.2021165432797547,y:-.2291966245935364,z:-.09134325242098038}},{id:1558,name:"Pinhead",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinhead",tags:["Nov24","SC2","Mum"]},is_available:!1,unlock:"purchase",align:{x:-.09987235365705205,y:-.4212577560245392,z:-.04740130297262457}},{id:1559,name:"Robot Police Person",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RobotCop",tags:["Nov24","SC2","Robot Cop"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_robo"],align:{x:-.10415364027513307,y:-.2544572301225956,z:-.04766670111979801}},{id:1560,name:"Fall Umbrella",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_umbrellaleaf",tags:["NovM24","Thanksgiving4","Autumn","Orange","Leaf"]},is_available:!1,unlock:"purchase",align:{x:-.09502903508809402,y:-.2927051280029007,z:.07778037415249078}},{id:1561,name:"Figgy Pudding",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_figgy",tags:["Dec24","Christmas4","Brown","White"]},is_available:!1,unlock:"purchase",align:{x:-.06450817292254918,y:-.27783474915880446,z:-.02952265313343455}},{id:1562,name:"Santa Legs",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santachimney",tags:["Dec24","Christmas4","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.09512430063418353,y:-.4090560627386247,z:-.04314762559715851}},{id:1563,name:"Eggsmas Lights",price:50,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tangledlights",tags:["Dec24","Christmas4","Green"]},is_available:!1,unlock:"purchase",align:{x:-.09478732170786897,y:-.3294985211809085,z:-.039072026783508906}},{id:1564,name:"Mrs Clause",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mrsclause",tags:["Dec24","Christmas4","Pink","Red","White"]},is_available:!1,unlock:"purchase",align:{x:-.0870902407010874,y:-.22809935452291707,z:.011340604815113259}},{id:1565,name:"Santa's Sleigh",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sleigh",tags:["Dec24","Christmas4","Gold","Yellow","Red"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_sleigh"],align:{x:-.002264615090964206,y:.10781845061085127,z:-.00103009266295373}},{id:1566,name:"2025 Headband",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09491965599983421,y:-.3559159888243681,z:-.043440698345275475}},{id:1567,name:"Party Hat 2025",price:200,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09064361647033081,y:-.3903993984543703,z:-.041483736503072244}},{id:1568,name:"Fulcrum Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weaponbalancing",tags:["JanM25","Text","Blue","Weapon","Balancing","Vol1"]},is_available:!1,unlock:"purchase",align:{x:-.07463817271286866,y:-.3199311981528352,z:-.03321799658001279}},{id:1569,name:"The Equalizer",price:3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Equalizer",tags:["JanM25","Green","Yellow","Orange","Red","Rainbow","Sound","Speaker"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_equal"],align:{x:-.006203978958753131,y:-.30640164779834417,z:-.0028392977928960728}},{id:1570,name:"DogEgg Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dogpolice",tags:["Feb25","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09273167319622111,y:-.2413060385365855,z:-.042439351504266865}},{id:1571,name:"Chief Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dogchief",tags:["Feb25","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.11216442427732165,y:-.32501694753736765,z:-.0513318154037718}},{id:1572,name:"Egg Pro Shops hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggproshop",tags:["Feb25","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.12075653081620974,y:-.2670311680328412,z:-.0552668438477662}},{id:1573,name:"Fisherman Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fisherman",tags:["Feb25","green","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.06995068405252614,y:-.30127548502043777,z:-.0320134595070406}},{id:1574,name:"Rogue Contractor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roguecontractor",tags:["Drops7","D7W1","FebM25","Grey","Camo"]},is_available:!1,unlock:"manual",align:{x:-.029641633446784166,y:-.16266604575850696,z:-.013520061952077694}},{id:1575,name:"dropoutbrent Parachute",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_parachute",tags:["Drops7","D7W2","FebM25","Pink","Green"]},is_available:!1,unlock:"manual",align:{x:-.0025717114230223714,y:-.29312739006009203,z:-.001177618590234658}},{id:1576,name:"WinterX AngelCat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winterx",tags:["Drops7","D7W2","FebM25","Pink","Yellow","Cat","Angel","Halo"]},is_available:!1,unlock:"manual",align:{x:-.03185250516164617,y:-.1915971925455225,z:-.014577539830657259}},{id:1577,name:"Henchmen Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_minion",tags:["Drops7","D7W2","FebM25","Yellow","Face","Eye"]},is_available:!1,unlock:"purchase",align:{x:-.06015336519728054,y:-.25544530674481103,z:-.027529658836678406}},{id:1578,name:"The Frostfall Wings",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Frostfall",tags:["Drops7","Premium","FebM25","Perm","Permanent"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_hat_frost"],align:{x:-.04832250932301607,y:-.1581391004944373,z:-.022115194586275998}},{id:1579,name:"St Patrick Sideburns",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leprechaunhair",tags:["Mar25","Bundle","Irish","Green","Orange","Buckle"]},is_available:!1,unlock:"manual",align:{x:-.05185480455074476,y:-.17136269562496276,z:-.023735905871966445}},{id:1580,name:"Lucky Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_luckycap",tags:["Mar25","Stpatricksday","Green","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.1210543003967457,y:-.268313840390229,z:-.05540308757285228}},{id:1581,name:"Island Crown",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paradisecrown",tags:["MarM25","Easter","Green","Moana","Grass","Flower","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.07105644648360965,y:-.2733141440835456,z:-.02992035560734979}},{id:1582,name:"Snow Blight",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snowhair",tags:["MarM25","White","Hair","Fairest","Red","Black"]},is_available:!0,unlock:"purchase",align:{x:.016196499136843734,y:-.12718797275005234,z:.006757112068581955}},{id:1583,name:"Malcontent Crown",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_evilhorns",tags:["MarM25","White","Queen","Fairest","Black"]},is_available:!0,unlock:"purchase",align:{x:-.08221047186945785,y:-.27911238654565806,z:-.03762758719242561}},{id:1584,name:"Eggfu Master Robe",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_faction1",tags:["Apr25","White","EGGORG","Shadow","Blue","Fairest"]},is_available:!1,unlock:"premium",align:{x:-.01449132984450241,y:-.0009178330569876714,z:-.006627248762252735}},{id:1585,name:"Eggsassin Robe",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_faction2",tags:["Apr25","Black","EGGORG","Shadow","Red","Black"]},is_available:!1,unlock:"premium",align:{x:-.014150440215876081,y:-.0010135521043506124,z:-.006471303595696698}},{id:1586,name:"Yellow Dragon Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_yellowDragon",tags:["Apr25","Yellow","EGGORG","Shadow","Black","Eyes","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.07748001937217763,y:-.23917631028239605,z:-.035459316781735556}},{id:1587,name:"Red Dragon Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_redDragon",tags:["Apr25","Red","EGGORG","Shadow","Black","Eyes","Bundle"]},is_available:!1,unlock:"manual",align:{x:-.07950583309832826,y:-.24790143060378877,z:-.03638644575222899}},{id:1588,name:"Sumo suit",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sumo",tags:["Apr25","EGGORG","Shadow","Black","Eyes","Premium"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_hat_sumo"],align:{x:-.002183832012569553,y:-.07013694363675205,z:.0006322943492174105}},{id:1589,name:"Pixel Airplane Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelAirplane",tags:["AprM25","Retro","Wes","Premium"]},is_available:!1,unlock:"premium",align:{x:.213094379983787,y:-.16645957884834417,z:.09752425471968085}},{id:2001,name:"Target Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:0,tags:["Default","Red","Blue","Yellow"]},is_available:!0,unlock:"default"},{id:2002,name:"No Sign Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:0,tags:["Default","Red"]},is_available:!0,unlock:"default"},{id:2003,name:"Question Mark Stamp?",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:0,tags:["Default","Black","?"]},is_available:!0,unlock:"default"},{id:2004,name:"Peace Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:0,tags:["Default","Black"]},is_available:!0,unlock:"default"},{id:2005,name:"Thumbs Up Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:0,tags:["Default","White"]},is_available:!0,unlock:"default"},{id:2006,name:"Pablo Smile Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:0,tags:["Default","Happy","Face","Yellow"]},is_available:!0,unlock:"default"},{id:2007,name:"Skull & Crossbones Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2008,name:"Tyrant Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:3,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2009,name:"Shifty Eye Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:5,tags:["Purple"]},is_available:!0,unlock:"purchase"},{id:2010,name:"Arrow & Heart Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:6,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2011,name:"Grade A Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:1,tags:["Red","USDA"]},is_available:!0,unlock:"purchase"},{id:2012,name:"Anarchy Sign Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:1,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2013,name:"Derp Face Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:2,tags:["Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2014,name:"Wolf Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2015,name:"Chicken Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:6,tags:["Brown","MayM24"]},is_available:!1,unlock:"purchase"},{id:2016,name:"Phoenix Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:7,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2017,name:"Alien Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:7,tags:["Green"]},is_available:!0,unlock:"purchase"},{id:2018,name:"Dapper Mustache Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2019,name:"Happy Bear Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:8,tags:["Pink","Smile"]},is_available:!0,unlock:"purchase"},{id:2020,name:"Ghost Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:8,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2021,name:"Jack Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:8,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2022,name:"Cracks Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:9,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2023,name:"Bat Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:9,tags:["Halloween","Oct23","Grey","Gray","Oct24"]},is_available:!1,unlock:"purchase"},{id:2024,name:"Cthulhu Fhtagn Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:9,tags:["Halloween","Oct23","Green","Oct24"]},is_available:!1,unlock:"purchase"},{id:2025,name:"Elder Sign Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:9,tags:["Halloween","Oct23","Red","Oct24"]},is_available:!1,unlock:"purchase"},{id:2026,name:"Scary Teeth Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:9,tags:["Halloween","Oct23","Smile","Green","Oct24"]},is_available:!1,unlock:"purchase"},{id:2027,name:"Monster Tongue Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:9,tags:["Halloween","Oct23","Face","Oct24"]},is_available:!1,unlock:"purchase"},{id:2028,name:"Spooky Lady Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:9,tags:["Halloween","Oct23","Face","Oct24"]},is_available:!1,unlock:"purchase"},{id:2029,name:"Clown Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:10,tags:["Halloween","Oct23","Smile","Oct24"]},is_available:!1,unlock:"purchase"},{id:2030,name:"Stitch Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:10,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2031,name:"Devil Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:10,tags:["Halloween","Oct23","Smile","Oct24"]},is_available:!1,unlock:"purchase"},{id:2032,name:"Face Mask Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:10,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2033,name:"Hand Turkey Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:10,tags:["NovM23","Thanksgiving","NovM24"]},is_available:!1,unlock:"purchase"},{id:2034,name:"Turkey Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:10,tags:["NovM23","Thanksgiving","NovM24"]},is_available:!1,unlock:"purchase"},{id:2035,name:"Turkey Crossbones Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:10,tags:["NovM23","Thanksgiving","Brown","NovM24"]},is_available:!1,unlock:"purchase"},{id:2036,name:"Reindeer Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:11,tags:["Dec23","Christmas","Red","Dec24"]},is_available:!1,unlock:"purchase"},{id:2037,name:"Gingerbread Cookie Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:11,tags:["Dec23","Christmas","Brown","Dec24"]},is_available:!1,unlock:"purchase"},{id:2038,name:"Santa Skull Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:11,tags:["Christmas2","Red","Dec24"]},is_available:!1,unlock:"purchase"},{id:2039,name:"2019 Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:11,tags:["NewYears","2019","Yellow","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2040,name:"Fireworks Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:11,tags:["NewYears","Blue","Yellow","DecM24"]},is_available:!1,unlock:"purchase"},{id:2041,name:"Midnight Clock Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:11,tags:["NewYears","DecM24"]},is_available:!1,unlock:"purchase"},{id:2042,name:"Stressed Out Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:7,tags:["Newsletter","Face"]},is_available:!1,unlock:"manual"},{id:2043,name:"Chicken Finger Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:8,tags:["Newsletter"]},is_available:!1,unlock:"manual"},{id:2044,name:"Lyerpald Stamp ",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:8,tags:["Contentcreator"]},is_available:!1,unlock:"manual"},{id:2045,name:"Groundhog Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:11,tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:2046,name:"Winter Snowflake Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:12,tags:["Groundhog","Feb23","Blue","Feb24"]},is_available:!1,unlock:"purchase"},{id:2047,name:"Spring Flower Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:12,tags:["Groundhog","Feb23","Pink","Feb24"]},is_available:!1,unlock:"purchase"},{id:2048,name:"Broken Heart Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:12,tags:["ValentinesDay","Red","Feb24","Feb25"]},is_available:!1,unlock:"purchase"},{id:2049,name:"Rose Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:12,tags:["ValentinesDay","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:2050,name:"Anatomical Heart Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:12,tags:["ValentinesDay","Heart","Feb25"]},is_available:!1,unlock:"purchase"},{id:2051,name:"Shamrock Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:12,tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2052,name:"Ginger Beard Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:12,tags:["StPatricksDay","MarM23","Brown","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2053,name:"Pot of Gold Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:13,tags:["StPatricksDay","MarM23","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2054,name:"Bunny Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:13,tags:["Easter","AprM23","Heart","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:2055,name:"Easter Egg Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:13,tags:["Easter","AprM23","Blue","White","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:2056,name:"Golden Easter Egg Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:13,tags:["Easter","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:2057,name:"Shell League Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:13,tags:["League"]},is_available:!0,unlock:"purchase"},{id:2058,name:"TXC Clan Logo Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:13,tags:["Green","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:2071,name:"GOD Clan Logo",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:15,tags:["Blue"]},is_available:!0,unlock:"purchase"},{id:2059,name:"Sherrif Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:6,tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:2060,name:"Rainbow Cloud Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:5,tags:["Cute"]},is_available:!0,unlock:"purchase"},{id:2061,name:"Angel Wings Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:6,tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:2062,name:"GoE Sigil - Wolf Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:13,tags:["GameOfEggs","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2063,name:"GoE Sigil - Lion Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:14,tags:["GameOfEggs","Red"]},is_available:!0,unlock:"purchase"},{id:2064,name:"GoE Sigil - Bird Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:14,tags:["GameOfEggs","Blue"]},is_available:!0,unlock:"purchase"},{id:2065,name:"GoE Sigil - Stag Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:14,tags:["GameOfEggs","Yellow"]},is_available:!0,unlock:"purchase"},{id:2066,name:"GoE Sigil - Fish Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:14,tags:["GameOfEggs","Orange"]},is_available:!0,unlock:"purchase"},{id:2067,name:"GoE Sigil - Squid Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:14,tags:["GameOfEggs","Black"]},is_available:!0,unlock:"purchase"},{id:2068,name:"GoE Sigil - Sun Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:14,tags:["GameOfEggs","Orange","Red"]},is_available:!0,unlock:"purchase"},{id:2069,name:"GoE Sigil - Flower Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:14,tags:["GameOfEggs","Green","Yellow"]},is_available:!0,unlock:"purchase"},{id:2070,name:"GoE Sigil - Dragon Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:15,tags:["GameOfEggs","Red"]},is_available:!0,unlock:"purchase"},{id:2072,name:"4th of July Stamp",price:1770,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:15,tags:["July4","Red","Blue","forth","Fireworks","JulyM24"]},is_available:!1,unlock:"purchase"},{id:2073,name:"SL MVP Division A Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:15,tags:["League"]},is_available:!1,unlock:"manual"},{id:2074,name:"SL MVP Division B Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:15,tags:["League"]},is_available:!1,unlock:"manual"},{id:2075,name:"CRGI Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:15,tags:["League","Dog"]},is_available:!1,unlock:"manual"},{id:2076,name:"Robot Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:6,tags:["Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2077,name:"Poop Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:7,tags:["Brown","Poop"]},is_available:!0,unlock:"purchase"},{id:2078,name:"Heart Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:1,tags:["Cards","Red"]},is_available:!1,unlock:"purchase"},{id:2079,name:"Spade Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:1,tags:["Cards","Black"]},is_available:!1,unlock:"purchase"},{id:2080,name:"Club Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:1,tags:["Cards","Black"]},is_available:!1,unlock:"purchase"},{id:2081,name:"Diamond Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:1,tags:["Cards","Red"]},is_available:!1,unlock:"purchase"},{id:2082,name:"What Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2083,name:"Yes Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2084,name:"No Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2085,name:"Ribcage Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2086,name:"Angry Cartridge Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:8,tags:["Grey","Gray","Mouth"]},is_available:!0,unlock:"purchase"},{id:2087,name:"DXG Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:0,tags:["League"]},is_available:!1,unlock:"manual"},{id:2088,name:"Tired Space Goblin Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:2,tags:["Eggwalker","Green"]},is_available:!1,unlock:"purchase"},{id:2089,name:"Angry Space Dog Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:3,tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:2090,name:"No Trying Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:4,tags:["Eggwalker","Red"]},is_available:!1,unlock:"purchase"},{id:2091,name:"Disgruntled Space Weasel Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:5,tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:2092,name:"White Beard Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:1,tags:["Newsletter","Christmas","Santa"]},is_available:!1,unlock:"manual"},{id:2093,name:"Strong Egg Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:5,tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:2094,name:"New Year 2020 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:6,tags:["NewYears","2020","Yellow","White"]},is_available:!1,unlock:"purchase"},{id:2095,name:"Bad Eggs For Life Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:8,tags:["BadEggsForLife","Jun23","MarM24"]},is_available:!1,unlock:"purchase"},{id:2096,name:"Pixel Heart Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:9,tags:["Newsletter","Red"]},is_available:!1,unlock:"manual"},{id:2097,name:"Eggy Cash Face Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:15,tags:["EggyCash","Face","Black"]},is_available:!0,unlock:"purchase"},{id:2098,name:"DXG Clan Logo 2 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:10,tags:["League"]},is_available:!1,unlock:"manual"},{id:2099,name:"Raid Land Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:11,tags:["RaidLand"]},is_available:!1,unlock:"purchase"},{id:2100,name:"Egg Org Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:12,tags:["AprilFools","Black"]},is_available:!1,unlock:"purchase"},{id:2101,name:"MVP 2020 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:13,tags:["League"]},is_available:!1,unlock:"manual"},{id:2102,name:"TXC Clan Skull Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:14,tags:["League","Purple"]},is_available:!1,unlock:"manual"},{id:2103,name:"Toxic Skull Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:15,tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:2104,name:"Toxic Nuke Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:0,tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:2105,name:"Toxic Derp Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:1,tags:["Rotten","Green","Smile"]},is_available:!0,unlock:"purchase"},{id:2106,name:"Facepaint Heart Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:5,tags:["Rockstar","JanM23","Pink","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2107,name:"Facepaint Star Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:6,tags:["Rockstar","JanM23","Black","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2108,name:"Facepaint Lightning Bolt Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:4,tags:["Rockstar","JanM23","Yellow","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2109,name:"Pink Starburst Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:7,tags:["Galeggsy","AprM23","Aug24"]},is_available:!1,unlock:"purchase"},{id:2110,name:"Alien Eyes 1 Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:8,tags:["Galeggsy","AprM23","Face","Aug24"]},is_available:!1,unlock:"purchase"},{id:2111,name:"Alien Eyes 2 Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:9,tags:["Galeggsy","AprM23","Face","Cute","Aug24"]},is_available:!1,unlock:"purchase"},{id:2112,name:"Flame Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:7,tags:["Newsletter","Fire","Red","Orange","Yellow"]},is_available:!1,unlock:"manual"},{id:2113,name:"Discord Mod Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:13,tags:["mod"]},is_available:!1,unlock:"manual"},{id:2114,name:"Black Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:14,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2115,name:"Red Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:15,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2116,name:"Pink Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:0,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2117,name:"Killstreak Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:1,tags:["Killstreak","Smile","Red"]},is_available:!1,unlock:"manual"},{id:2118,name:"Red Rooster Wings Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:10,tags:["Chicken","MayM24"]},is_available:!1,unlock:"purchase"},{id:2119,name:"White Rooster Wings Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:11,tags:["Chicken","MayM24"]},is_available:!1,unlock:"purchase"},{id:2120,name:"Gold Rooster Wings Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:12,tags:["Chicken","July23","MayM24"]},is_available:!1,unlock:"purchase"},{id:2121,name:"Ugly Jason Face Stamp",price:1300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:2,tags:["f13"]},is_available:!1,unlock:"purchase"},{id:2122,name:"Little Happy Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:3,tags:["Stampede","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2123,name:"Angry Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:4,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2124,name:"Why Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:5,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2125,name:"Influenced Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:6,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2126,name:"Nervous Crush Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:7,tags:["Stampede","Face","Red"]},is_available:!0,unlock:"purchase"},{id:2127,name:"Girly Eyes Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:8,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2128,name:"Big Smile Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:9,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2129,name:"Cyclops Face Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:10,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2130,name:"Grumpy Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:11,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2131,name:"Big Happy Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:12,tags:["Stampede","Smile","Face"]},is_available:!0,unlock:"purchase"},{id:2132,name:"Scared Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:13,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2133,name:"This Guy Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:14,tags:["Stampede","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2134,name:"Tumble Dude Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:15,tags:["Stampede","White","Face"]},is_available:!0,unlock:"purchase"},{id:2135,name:"Thee_Owl Angry Face Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:0,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2136,name:"Blow Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:1,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2137,name:"Whip Em Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:2,tags:["Stampede","Blue","Whisk"]},is_available:!0,unlock:"purchase"},{id:2138,name:"Baby on Board Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:3,tags:["Stampede","Chick","Yellow"]},is_available:!0,unlock:"purchase"},{id:2139,name:"Thee_Owl Scared Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:4,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2140,name:"Yin Yang Chicken Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:5,tags:["Stampede","Black","White"]},is_available:!0,unlock:"purchase"},{id:2141,name:"Blue Wizard Guy Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:8,tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:2142,name:"God Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:6,tags:["League","Red","Orange"]},is_available:!1,unlock:"manual"},{id:2143,name:"Wero Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:7,tags:["Wero","Beard"]},is_available:!0,unlock:"purchase"},{id:2144,name:"New Year 2021 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:8,tags:["NewYears","2021","Green"]},is_available:!1,unlock:"purchase"},{id:2145,name:"Thee_Owl Logo Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:9,tags:["Thee_Owl","Green"]},is_available:!0,unlock:"purchase"},{id:2146,name:"Biggest Mouth Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:5,tags:["Newsletter","Ahh"]},is_available:!1,unlock:"manual"},{id:2147,name:"C4bra Ram Outfit Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:7,tags:["C4bra"]},is_available:!0,unlock:"purchase"},{id:2148,name:"Hazmatt Thumbs Up Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:8,tags:["Hazmat","Yellow"]},is_available:!0,unlock:"purchase"},{id:2149,name:"Hazmatt POG Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:9,tags:["Hazmat","Yellow"]},is_available:!0,unlock:"purchase"},{id:2150,name:"Pixel Tech Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:10,tags:["Pixel","Green"]},is_available:!0,unlock:"purchase"},{id:2151,name:"Pixel Chicken Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:11,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2152,name:"Pixel Gun Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:12,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2153,name:"Pixel Robot Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:13,tags:["Pixel","Blue"]},is_available:!0,unlock:"purchase"},{id:2154,name:"Pixel Shield Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:14,tags:["Pixel","Eggs"]},is_available:!0,unlock:"purchase"},{id:2155,name:"Pixel Egg Splat Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:15,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2156,name:"Pixel Swords Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:0,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2157,name:"Pixel Happy Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:1,tags:["Pixel","Smile","bun_gamer"]},is_available:!0,unlock:"purchase"},{id:2158,name:"Pixel Angry Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:2,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2159,name:"Pixel Annoyed Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:3,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2160,name:"Pixel Dead Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:4,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2161,name:"Pixel Deal With It Sunglasses Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:5,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2162,name:"Angry Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:12,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2163,name:"Cat Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:13,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2164,name:"Crazy Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:14,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2165,name:"Dog Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:15,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2166,name:"Evil Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:0,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2167,name:"Grinning Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:1,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2168,name:"Happy Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:2,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2169,name:"Laughing Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:3,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2170,name:"Pirate Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:4,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2171,name:"Sick Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:5,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2172,name:"Smiling Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:6,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2173,name:"Tongue-Out Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:7,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2174,name:"Upset Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:8,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2175,name:"Dead BW Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:10,tags:["EGGORG","Wizard","Blue","Apr24","Apr25"]},is_available:!0,unlock:"purchase"},{id:2176,name:"Egg Org Spokesperson Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:11,tags:["EGGORG","Apr24","Apr25"]},is_available:!0,unlock:"purchase"},{id:2177,name:"Aries Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:12,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2178,name:"Diablo Frown Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:9,tags:["EGGORG","Apr24","Apr25"]},is_available:!0,unlock:"purchase"},{id:2179,name:"Train Ticket Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:11,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2180,name:"Train Engine Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:13,tags:["Trains","Cars","Black"]},is_available:!0,unlock:"purchase"},{id:2181,name:"All Aboard Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:14,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2182,name:"Pain Train's Comin Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:15,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2183,name:"Random Life Logo Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:0,tags:["Random","RL"]},is_available:!0,unlock:"purchase"},{id:2184,name:"Mystery QR Code",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:5},is_available:!0,unlock:"purchase"},{id:2185,name:"Ethan Gamer Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:4,tags:["EthanGamer","Red"]},is_available:!0,unlock:"purchase"},{id:2186,name:"Red Aries Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:10,tags:["League"]},is_available:!1,unlock:"manual"},{id:2187,name:"Toilet Paper Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:6,tags:["TP","Poop","2ply","Text","bun_toilet"]},is_available:!1,unlock:"purchase"},{id:2188,name:"Water Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:8,tags:["Summer","JunM23","Blue","Water","JunM24"]},is_available:!1,unlock:"purchase"},{id:2189,name:"Popsicle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:6,tags:["Summer","JunM23","Pink","Food","JunM24"]},is_available:!1,unlock:"purchase"},{id:2190,name:"Sun Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:7,tags:["Summer","JunM23","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:2191,name:"Postage Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:9,tags:["Summer","JunM23","JunM24"]},is_available:!1,unlock:"purchase"},{id:2192,name:"Blue Wizard Skull Stamp",price:1200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:6,tags:["BWD"]},is_available:!0,unlock:"purchase"},{id:2193,name:"Lyerpald Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:8,tags:["Dog","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2194,name:"SL NA#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:1,tags:["League","Yellow"]},is_available:!1,unlock:"manual"},{id:2195,name:"SL EU#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:2,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2196,name:"SL OCE#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:3,tags:["League","Green"]},is_available:!1,unlock:"manual"},{id:2197,name:"I <3 New Yolker Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:11,tags:["Newsletter","Heart","NY"]},is_available:!1,unlock:"manual"},{id:2198,name:"Egg Heart Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:12,tags:["White"]},is_available:!1,unlock:"manual"},{id:2199,name:"Chantigg Face Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:13,tags:["Chantigg","Smile"]},is_available:!0,unlock:"purchase"},{id:2200,name:"Chantigg Cake Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:14,tags:["Chantigg","Food"]},is_available:!0,unlock:"purchase"},{id:2201,name:"Grade A+ Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:0,tags:["Pencil","Sep23","Red","Sep24"]},is_available:!1,unlock:"purchase"},{id:2202,name:"Globe Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:1,tags:["Pencil","Sep23","Earth","Green","Blue","Sep24"]},is_available:!1,unlock:"purchase"},{id:2203,name:"Nerd Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:15,tags:["Pencil","Sep23","Smile","Sep24"]},is_available:!1,unlock:"purchase"},{id:2204,name:"Gold Beak Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:13,tags:["vipItem","Premium","Yellow"]},is_available:!0,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"]},{id:2205,name:"Zombie Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:10,tags:["Halloween2","Oct23","Yellow","OctM24"]},is_available:!1,unlock:"purchase"},{id:2206,name:"Werewolf Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:9,tags:["Halloween2","Oct23","Pink","OctM24"]},is_available:!1,unlock:"purchase"},{id:2207,name:"Vampire Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:8,tags:["Halloween2","Oct23","Red","OctM24"]},is_available:!1,unlock:"purchase"},{id:2208,name:"Sasquatch Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:7,tags:["Halloween2","Oct23","Brown","OctM24"]},is_available:!1,unlock:"purchase"},{id:2209,name:"Medusa Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:6,tags:["Halloween2","Oct23","Green","OctM24"]},is_available:!1,unlock:"purchase"},{id:2210,name:"Blue Cyclops Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:5,tags:["Halloween2","Oct23","Blue","OctM24"]},is_available:!1,unlock:"purchase"},{id:2211,name:"Cthulu Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:4,tags:["Halloween2","Oct23","Green","OctM24"]},is_available:!1,unlock:"purchase"},{id:2212,name:"Baldwiz Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:3,tags:["Halloween2","Oct23","Skull","OctM24"]},is_available:!1,unlock:"purchase"},{id:2213,name:"Fang Pablo Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:11,tags:["Halloween2","Oct23","Smile","OctM24"]},is_available:!1,unlock:"purchase"},{id:2214,name:"Jack O' Lantern Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:12,tags:["Halloween2","Oct23","Face","Black","OctM24"]},is_available:!1,unlock:"purchase"},{id:2215,name:"Circle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:0,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2216,name:"Square Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:15,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2217,name:"Umbrella Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:1,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2218,name:"Triangle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:14,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2219,name:"NACL Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:2,tags:["League","Yellow","Blue"]},is_available:!1,unlock:"manual"},{id:2220,name:"RBL Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:3,tags:["League","Black","Red"]},is_available:!1,unlock:"manual"},{id:2221,name:"Sheesh Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:11},is_available:!0,unlock:"purchase"},{id:2222,name:"Black Eggs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:10,tags:["Black Fryday","May24"]},is_available:!1,unlock:"purchase"},{id:2223,name:"Black Fries Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:9,tags:["Black Fryday","AprM24","FebM24"]},is_available:!0,unlock:"purchase"},{id:2224,name:"Red Wins Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:4,tags:["KotC","Red"]},is_available:!0,unlock:"purchase"},{id:2225,name:"Blue Wins Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:5,tags:["KotC","Blue"]},is_available:!0,unlock:"purchase"},{id:2226,name:"I put the OP in Coop Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:6,tags:["KotC"]},is_available:!0,unlock:"purchase"},{id:2227,name:"I rule the Roost Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:7,tags:["KotC"]},is_available:!0,unlock:"purchase"},{id:2228,name:"2022 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:12,tags:["2022","Blue"]},is_available:!1,unlock:"purchase"},{id:2229,name:"Nervous Elf Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:14,tags:["Christmas2","Face","Smile","bun_mistle","Dec24"]},is_available:!1,unlock:"purchase"},{id:2230,name:"Pro Plays Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:13,tags:["Drops","White"]},is_available:!1,unlock:"manual"},{id:2231,name:"Ganbaru Okan Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:15,tags:["Drops","Black","Pink"]},is_available:!1,unlock:"manual"},{id:2232,name:"Cold Face Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:0,tags:["Chilly","Ice"]},is_available:!1,unlock:"purchase"},{id:2233,name:"Snowman Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:1,tags:["Chilly","Smile","Face"]},is_available:!1,unlock:"purchase"},{id:2234,name:"Hockey Sticks Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:2,tags:["Chilly","Brown","Canada"]},is_available:!1,unlock:"purchase"},{id:2235,name:"Happy Aww Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:3,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2236,name:"Sad Aww Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:4,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2237,name:"Heart Eyes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:5,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2238,name:"Star Eyes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:6,tags:["Kawaii","Cute","Face","Yellow"]},is_available:!0,unlock:"purchase"},{id:2239,name:"Shocked Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:7,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2240,name:"Ecstatic Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:8,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2241,name:"Pleased Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:9,tags:["Kawaii","Cute","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2242,name:"Cat Wink Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:10,tags:["Kawaii","Cute","Face","bun_cat"]},is_available:!0,unlock:"purchase"},{id:2243,name:"Nate's Monies Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:11,tags:["Nate","MayM23","Yellow","FebM25"]},is_available:!1,unlock:"purchase"},{id:2244,name:"Nate's Bomb Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:12,tags:["Nate","Black","Apr24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2245,name:"Nate's Eel Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:13,tags:["Nate","Oct23","Black","FebM25"]},is_available:!1,unlock:"purchase"},{id:2246,name:"Nate's Skypunch Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:14,tags:["Nate","MarM23","Pixel","FebM25"]},is_available:!1,unlock:"purchase"},{id:2247,name:"Nate's Stonks Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:15,tags:["Nate","Yellow","Ahh","FebM25"]},is_available:!1,unlock:"purchase"},{id:2248,name:"Nate's Dead Jason Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:15,tags:["Nate","Black","White","FebM25"]},is_available:!1,unlock:"purchase"},{id:2249,name:"Nate's Alive Jason Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:14,tags:["Nate","Black","White","July24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2250,name:"Nate's Noodly Appendages Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:13,tags:["Nate","Smile","FebM25"]},is_available:!1,unlock:"purchase"},{id:2251,name:"Phoenix BLZ Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:10,tags:["SL","Orange","Yellow"]},is_available:!1,unlock:"manual"},{id:2252,name:"Navi Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:9,tags:["SL","Blue","Red"]},is_available:!1,unlock:"manual"},{id:2253,name:"NCR Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:8,tags:["SL","Black","Purple"]},is_available:!1,unlock:"manual"},{id:2254,name:"Ukraine Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:7,tags:["UA","Blue","Yellow","Heart"]},is_available:!1,unlock:"purchase"},{id:2255,name:"Nothin' but Net Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:11,tags:["BBros","Basketball"]},is_available:!1,unlock:"purchase"},{id:2256,name:"On Fire Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:12,tags:["BBros","Basketball","Orange"]},is_available:!1,unlock:"purchase"},{id:2257,name:"Diamonds Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:6,tags:["EGGORG","Red"]},is_available:!1,unlock:"purchase"},{id:2258,name:"Clubs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:5,tags:["EGGORG","Black"]},is_available:!1,unlock:"purchase"},{id:2259,name:"Spades Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:4,tags:["EGGORG","Black"]},is_available:!1,unlock:"purchase"},{id:2260,name:"Hearts Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:3,tags:["EGGORG","Red"]},is_available:!1,unlock:"purchase"},{id:2261,name:"Egg Org Shield Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:2,tags:["EGGORG","Apr23","Red","Yellow","Apr25"]},is_available:!0,unlock:"purchase"},{id:2262,name:"Polarized Moon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:1,tags:["Relic","White"]},is_available:!0,unlock:"purchase"},{id:2263,name:"Shattered EGG ORG Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:0,tags:["Relic","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:2264,name:"Wizard Neko Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:15,tags:["Relic","Mar23","AugM23","Dog"]},is_available:!1,unlock:"purchase"},{id:2265,name:"Jason Eyes Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:14,tags:["Relic","Mar23","AugM23"]},is_available:!1,unlock:"purchase"},{id:2266,name:"Wizard Cheer Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:13,tags:["Relic","Mar23","AugM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2267,name:"Egg Love Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:12,tags:["Relic","Mar23","AugM23","Heart"]},is_available:!1,unlock:"purchase"},{id:2268,name:"Going Eggstinct Stamp",price:350,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:11,tags:["Dino","May23","Black","AugM24"]},is_available:!1,unlock:"purchase"},{id:2269,name:"No Tar Pits Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:10,tags:["Dino","May23","Red","AugM24"]},is_available:!1,unlock:"purchase"},{id:2270,name:"Clutch Up! Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:9,tags:["Dino","May23","Eggs","AugM24"]},is_available:!1,unlock:"purchase"},{id:2271,name:"No Meteors Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:8,tags:["Dino","May23","Red","AugM24"]},is_available:!1,unlock:"purchase"},{id:2272,name:"No Volcanos Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:7,tags:["Dino","May23","Red","AugM24"]},is_available:!1,unlock:"purchase"},{id:2273,name:"RAWR Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:6,tags:["Dino","MarM23","Yellow","Purple","AugM24"]},is_available:!1,unlock:"purchase"},{id:2274,name:"Baby Dino Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:5,tags:["Dino","May23","Green","Eggs","AugM24"]},is_available:!1,unlock:"purchase"},{id:2275,name:"Bluetooth Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:0,tags:["Mobile","JunM23","Smile"]},is_available:!1,unlock:"purchase"},{id:2276,name:"Happy Phone Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:1,tags:["Mobile","Green"]},is_available:!1,unlock:"purchase"},{id:2277,name:"Mad Phone Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:2,tags:["Mobile","Red"]},is_available:!1,unlock:"purchase"},{id:2278,name:"Signal Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:3,tags:["Mobile","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2279,name:"Charging! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:4,tags:["Mobile","Black","Apr24"]},is_available:!1,unlock:"purchase"},{id:2280,name:"Eggy-wan Beard Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:0,tags:["Eggwalker2","Face","Brown"]},is_available:!1,unlock:"purchase"},{id:2281,name:"Control Panel Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:1,tags:["Eggwalker2","Red","Black"]},is_available:!1,unlock:"purchase"},{id:2282,name:"Evader face Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:2,tags:["Eggwalker2","Red"]},is_available:!1,unlock:"purchase"},{id:2283,name:"Ladybug Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:3,tags:["Summer","JunM23","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2284,name:"Camper Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:4,tags:["Summer","JunM23","Green","Tent","JunM24"]},is_available:!1,unlock:"purchase"},{id:2285,name:"Oasis Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:5,tags:["Summer","JunM23","Black","Red","Blue","Tree","JunM24"]},is_available:!1,unlock:"purchase"},{id:2286,name:"Hot Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:6,tags:["Summer","JunM23","Orange","JunM24"]},is_available:!1,unlock:"purchase"},{id:2287,name:"Sun's out Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:7,tags:["Summer","JunM23","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:2288,name:"Blue's #1 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:8,tags:["Sports","JulyM23","Blue","JunM24"]},is_available:!1,unlock:"purchase"},{id:2289,name:"Red's #1 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:9,tags:["Sports","JulyM23","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2290,name:"Football Laces Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:10,tags:["Sports","JulyM23","White","Fbros","JunM24","SepM24"]},is_available:!1,unlock:"purchase"},{id:2291,name:"Hockey crossed sticks Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:11,tags:["Sports","JulyM23","Black","JunM24"]},is_available:!1,unlock:"purchase"},{id:2292,name:"Trophy #1 Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:12,tags:["Sports","JulyM23","Yellow","Gold","JunM24"]},is_available:!1,unlock:"purchase"},{id:2293,name:"What's the play? Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:13,tags:["Sports","JulyM23","Eggs","JunM24"]},is_available:!1,unlock:"purchase"},{id:2294,name:"Whistle Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:14,tags:["Sports","JulyM23","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2295,name:"Go Team Eggs Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:15,tags:["Sports","JulyM23","JunM24"]},is_available:!1,unlock:"purchase"},{id:2296,name:"GOAL Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:0,tags:["Sports","JulyM23","JunM24"]},is_available:!1,unlock:"purchase"},{id:2297,name:"Cooked Chicken Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:1,tags:["Chicken","Food","MayM24"]},is_available:!1,unlock:"purchase"},{id:2298,name:"Lil Nugz Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:2,tags:["Chicken","MayM24"]},is_available:!1,unlock:"purchase"},{id:2299,name:"Toast Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:3,tags:["Breakfast","Eggs","MayM24"]},is_available:!1,unlock:"purchase"},{id:2300,name:"Butter believe it Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:4,tags:["Breakfast","Food","NovM23","MayM24"]},is_available:!1,unlock:"purchase"},{id:2301,name:"Sour Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:5,tags:["Breakfast","July23","MayM24"]},is_available:!1,unlock:"purchase"},{id:2302,name:"Pancakes Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:6,tags:["Breakfast","Brown","Food","MayM24"]},is_available:!1,unlock:"purchase"},{id:2303,name:"Hard Boiled Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:7,tags:["Breakfast","Eggs","MayM24"]},is_available:!1,unlock:"purchase"},{id:2304,name:"Coffee makes me happy! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:8,tags:["Breakfast","Smile","MayM24"]},is_available:!1,unlock:"purchase"},{id:2305,name:"Bacon Bacon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:9,tags:["Breakfast","Red","Food","MayM24"]},is_available:!1,unlock:"purchase"},{id:2306,name:"Scavenger Statue Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:10,tags:["Scavenger","Blue","Wizard"]},is_available:!1,unlock:"purchase"},{id:2307,name:"Scavenger Map Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:11,tags:["Scavenger","Wizard"]},is_available:!1,unlock:"purchase"},{id:2308,name:"Scavenger Magnifeye Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:12,tags:["Scavenger","Blue"]},is_available:!1,unlock:"purchase"},{id:2309,name:"Scavenger Compass Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:13,tags:["Scavenger","Blue"]},is_available:!1,unlock:"purchase"},{id:2310,name:"Scavenger Monocle Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:14,tags:["Scavenger","Yellow"]},is_available:!1,unlock:"purchase"},{id:2311,name:"Paint Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:15,tags:["Pencil2","Sep23","Rainbow","Sep24"]},is_available:!1,unlock:"purchase"},{id:2312,name:"Science Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:0,tags:["Pencil2","Sep23","Blue","Purple","Red","Sep24"]},is_available:!1,unlock:"purchase"},{id:2313,name:"Schoolbus Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:1,tags:["Pencil2","Sep23","Yellow","Sep24"]},is_available:!1,unlock:"purchase"},{id:2314,name:"Math Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:2,tags:["Pencil2","Sep23","Black","Sep24"]},is_available:!1,unlock:"purchase"},{id:2315,name:"Sharkbucks Stamp",price:6900,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:3,tags:["Sep22","Green","Face"]},is_available:!0,unlock:"purchase"},{id:2316,name:"Kilzomatic Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:4,tags:["Sep22","Drops3","Blue","Eggs"]},is_available:!1,unlock:"manual"},{id:2317,name:"Diablo Sticker Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:5,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2318,name:"Pablo Sticker Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:6,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2319,name:"The Jaw Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:8,tags:["Sep22","Drops3","Face","Black"]},is_available:!1,unlock:"manual"},{id:2320,name:"Pablo GG Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:7,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2321,name:"Trick Or Treat Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:9,tags:["Halloween3","OctM23","Orange","OctM24"]},is_available:!1,unlock:"purchase"},{id:2322,name:"Scary Clown Face Stamp",price:1990,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:10,tags:["Halloween3","OctM23","It","OctM24"]},is_available:!1,unlock:"purchase"},{id:2323,name:"KJDCitsme Jacko Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:14,tags:["Halloween3","OctM23","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2324,name:"KJDCitsme Shock Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:11,tags:["Halloween3","OctM23","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2325,name:"Thee_Owl Breakout Yolk Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:13,tags:["Halloween3","OctM23","Yellow","Face","OctM24"]},is_available:!0,unlock:"purchase"},{id:2326,name:"Thee_Owl Peekout Yolk Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:9,tags:["Halloween3","OctM23","Yellow","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2327,name:"Zamsgod Scratch Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:12,tags:["Halloween3","OctM23","Face","Black","OctM24"]},is_available:!1,unlock:"purchase"},{id:2328,name:"Artshocks Half Asleep Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:10,tags:["Halloween3","OctM23","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2329,name:"Scared Stupid Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:8,tags:["Halloween3","OctM23","Face","Black","OctM24"]},is_available:!1,unlock:"purchase"},{id:2330,name:"One Cluck Man Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:7,tags:["Halloween3","OctM23","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2331,name:"Skullface Kills Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:6,tags:["Halloween3","OctM23","Eggs","OctM24"]},is_available:!1,unlock:"purchase"},{id:2332,name:"Witches Broom Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:15,tags:["Halloween3","OctM23","Brown","OctM24"]},is_available:!1,unlock:"purchase"},{id:2333,name:"Fall Leaf Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:11,tags:["NovM23","Thanksgiving","Brown","NovM24"]},is_available:!1,unlock:"purchase"},{id:2334,name:"Turkey head on Stamp",price:400,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:12,tags:["NovM23","Thanksgiving","Brown","NovM24"]},is_available:!1,unlock:"purchase"},{id:2335,name:"Forest Shroom Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:13,tags:["NovM23","Thanksgiving2","Red","Food"]},is_available:!1,unlock:"purchase"},{id:2336,name:"Apple Core Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:14,tags:["NovM23","Thanksgiving2","Food"]},is_available:!1,unlock:"purchase"},{id:2337,name:"Drumstick Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:15,tags:["NovM23","Thanksgiving2","Brown","Food"]},is_available:!1,unlock:"purchase"},{id:2338,name:"It's Corn Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:4,tags:["NovM23","Thanksgiving2","Yellow","Green","Food"]},is_available:!1,unlock:"purchase"},{id:2339,name:"Corntastic Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:5,tags:["NovM23","Thanksgiving","Yellow","Orange","NovM24"]},is_available:!1,unlock:"purchase"},{id:2340,name:"You won a 1v1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:3,tags:["Badegg","Purple","Blue","Eggs"]},is_available:!1,unlock:"manual"},{id:2341,name:"Wizard Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:2,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2342,name:"Reload the clip Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:1,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2343,name:"Regeneration Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:0,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2344,name:"Upgrade Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:0,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2345,name:"Health Drop Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:1,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2346,name:"Sleeps Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:2,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2347,name:"Marksman Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:3,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2348,name:"Restocked Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:4,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2349,name:"Rambod Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:5,tags:["Badegg","Black","DecM23","July24"]},is_available:!1,unlock:"purchase"},{id:2350,name:"Surprise! Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:6,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2351,name:"Goose Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:7,tags:["Badegg","Black","premFeatOne","MarM25"]},is_available:!1,unlock:"purchase"},{id:2352,name:"New Year 2023 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:8,tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2353,name:"Mixtape Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:9,tags:["Rockstar","JanM23","Grey","Gray","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2354,name:"Treble clef Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:10,tags:["Rockstar","JanM23","Black","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2355,name:"Rock on Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:11,tags:["Rockstar","JanM23","Yellow","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2356,name:"Buck Teeth",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:13,tags:["Groundhog","Feb23","Face","Feb24"]},is_available:!1,unlock:"purchase"},{id:2357,name:"Alarm Clock Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:12,tags:["Groundhog","Newsletter","Feb23","White","Silver","Feb24"]},is_available:!1,unlock:"manual"},{id:2358,name:"Horseshoe Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:15,tags:["farm","FebM23","Brown","May24"]},is_available:!1,unlock:"purchase"},{id:2359,name:"Sunflower Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:14,tags:["farm","FebM23","Yellow","May24"]},is_available:!1,unlock:"purchase"},{id:2360,name:"CEO Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:0,tags:["League","Red"]},is_available:!1,unlock:"manual"},{id:2361,name:"LEV Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:1,tags:["League","Green"]},is_available:!1,unlock:"manual"},{id:2362,name:"RTV Clan Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:2,tags:["League","Blue","Purple"]},is_available:!1,unlock:"manual"},{id:2363,name:"Shell Tournaments Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:3,tags:["League","Orange"]},is_available:!0,unlock:"purchase"},{id:2364,name:"NPS Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:4,tags:["League","White"]},is_available:!1,unlock:"manual"},{id:2365,name:"Shell Tournaments #1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:5,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2366,name:"Hello my name is Pablo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:6,tags:["Drops4","Mar23","AugM23","Red","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2367,name:"Happily Fried Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:7,tags:["Drops4","Mar23","AugM23","White","Eggs","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2368,name:"Game Of The Year Stamp",price:350,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:8,tags:["Drops4","Mar23","Yellow","GOTY","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2369,name:"Wizards on Fire! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:9,tags:["Drops4","Mar23","Blue","BWD","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2370,name:"Banned Aid Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:10,tags:["Drops4","Mar23","Brown","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2371,name:"xQc Ape Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:11,tags:["Drops4","Mar23","White"]},is_available:!1,unlock:"manual"},{id:2372,name:"Shell Shockers Logo Stamp",price:50,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:12,tags:["Drops4","Mar23","Eggs","White","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2373,name:"Griffen Chin Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:13,tags:["Drops4","Mar23","Face","Black"]},is_available:!1,unlock:"manual"},{id:2374,name:"That's a Fowl Stamp",price:150,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:14,tags:["BBros","MarM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2375,name:"Stuffed Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:15,tags:["BBros","MarM23"]},is_available:!1,unlock:"purchase"},{id:2376,name:"Bear Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:0,tags:["BBros","MarM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2377,name:"Tiger Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:1,tags:["BBros","MarM23","Tiger","Cat"]},is_available:!1,unlock:"purchase"},{id:2378,name:"Basket Bros Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:2,tags:["BBros","MarM23","Orange"]},is_available:!1,unlock:"purchase"},{id:2379,name:"Hydrate! Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:3,tags:["BBros","MarM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2380,name:"Egg Jordan Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:4,tags:["BBros","MarM23","Black","Eggs"]},is_available:!1,unlock:"purchase"},{id:2381,name:"Kiss me I'm Irish Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:5,tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2382,name:"Monster Talisman Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:6,tags:["Monsters","Apr23"]},is_available:!1,unlock:"purchase"},{id:2383,name:"Hero Talisman Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:7,tags:["Heroes","Apr23"]},is_available:!1,unlock:"purchase"},{id:2384,name:"Judgement arrow Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:8,tags:["Apr23","Gold","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:2385,name:"Critical Hit Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:9,tags:["Apr23","Red","Gold","D20","Yellow"]},is_available:!1,unlock:"purchase"},{id:2386,name:"Breath Weapon Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:10,tags:["Apr23","Red","Gold","Dragon"]},is_available:!1,unlock:"purchase"},{id:2387,name:"Egg Org & Eggventure Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:11,tags:["Apr23","Red","Gold","Dragon"]},is_available:!1,unlock:"purchase"},{id:2388,name:"Heroes Potion Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:12,tags:["Heroes","Apr23","Green","Heart"]},is_available:!1,unlock:"manual"},{id:2389,name:"Monsters Potion Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:13,tags:["Apr23","Monsters","Red","Skull"]},is_available:!1,unlock:"manual"},{id:2390,name:"Monobrow Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:14,tags:["May23","Dino2","Black","Face","AugM24"]},is_available:!1,unlock:"purchase"},{id:2391,name:"Slay the Beast Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:15,tags:["May23","Dino2","Black","AugM24"]},is_available:!1,unlock:"purchase"},{id:2392,name:"Caveman Classic Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:0,tags:["May23","Dino2","Face","Smile","AugM24"]},is_available:!1,unlock:"purchase"},{id:2393,name:"Stone Tools Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:1,tags:["May23","Dino2","Brown","AugM24"]},is_available:!1,unlock:"purchase"},{id:2394,name:"Chart Stamp",price:10,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:3,tags:["MayM23","Eggflation","Red"]},is_available:!0,unlock:"purchase"},{id:2395,name:"Money Tree Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:4,tags:["MayM23","Eggflation","Green"]},is_available:!0,unlock:"purchase"},{id:2396,name:"Eggflation Rollercoaster Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:2,tags:["MayM23","Eggflation","Red"]},is_available:!0,unlock:"purchase"},{id:2397,name:"HODL Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:5,tags:["MayM23","Eggflation"]},is_available:!0,unlock:"purchase"},{id:2398,name:"Polaroid Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:6,tags:["Jun23","Photo","Eggs"]},is_available:!1,unlock:"purchase"},{id:2399,name:"Wedding Crasher Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:7,tags:["Jun23","Photo","Blue"]},is_available:!1,unlock:"purchase"},{id:2400,name:"Apature Stamp",price:825,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:8,tags:["Jun23","Photo","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2401,name:"Dour Mustache Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:9,tags:["Jun23","Photo","Brown"]},is_available:!1,unlock:"purchase"},{id:2402,name:"Starfish Stamp",price:505,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:10,tags:["JunM23","Summer2","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2403,name:"Jellyfish Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:11,tags:["JunM23","Summer2","White","JunM24"]},is_available:!1,unlock:"purchase"},{id:2404,name:"Beach Vibes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:12,tags:["JunM23","Summer2","JunM24"]},is_available:!1,unlock:"purchase"},{id:2405,name:"Beach Ball Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:13,tags:["JunM23","Summer2","White","Blue","Yellow","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2406,name:"Equinox Sun Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:0,tags:["July23","Equinox","Yellow","JanM25"]},is_available:!1,unlock:"purchase"},{id:2407,name:"Equinox Moon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:1,tags:["July23","Equinox","Grey","Gray","JanM25"]},is_available:!1,unlock:"purchase"},{id:2408,name:"Equinox YinYang Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:14,tags:["July23","Equinox","Blue","Yellow","JanM25"]},is_available:!1,unlock:"purchase"},{id:2409,name:"Pablodala Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:15,tags:["July23","Equinox","Mandala","Blue","Yellow","JanM25"]},is_available:!1,unlock:"purchase"},{id:2410,name:"Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:2,tags:["JulyM23","Sports2"]},is_available:!1,unlock:"purchase"},{id:2411,name:"Grind Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:4,tags:["JulyM23","Sports2","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2412,name:"Fellow Kids Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:3,tags:["JulyM23","Sports2","Red","Skateboard"]},is_available:!1,unlock:"purchase"},{id:2413,name:"Safety Team Approved Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:5,tags:["JulyM23","Sports2","DecM24"]},is_available:!1,unlock:"purchase"},{id:2414,name:"The MenoXD Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:6,tags:["JulyM23","Red","xd"]},is_available:!0,unlock:"purchase"},{id:2415,name:"Red S-tier Racing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:7,tags:["Aug23","Eggs","Kart"]},is_available:!1,unlock:"purchase"},{id:2416,name:"Green S-tier Racing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:8,tags:["Aug23","Eggs","Kart"]},is_available:!1,unlock:"purchase"},{id:2417,name:"Question block Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:9,tags:["Aug23","Yellow","?","JanM24","Kart"]},is_available:!1,unlock:"purchase"},{id:2418,name:"Racing Flags Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:10,tags:["Aug23","Black","White","Kart"]},is_available:!1,unlock:"purchase"},{id:2419,name:"Stopwatch Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:11,tags:["Newsletter","Aug23","White","Clock","Kart"]},is_available:!1,unlock:"manual"},{id:2420,name:"Shy Egg Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:12,tags:["Aug23","White","Kart"]},is_available:!1,unlock:"purchase"},{id:2421,name:"Banana Peel Stamp",price:1200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:13,tags:["Aug23","Yellow","Kart"]},is_available:!1,unlock:"purchase"},{id:2422,name:"Respawn Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:14,tags:["Aug23","Mushroom","Green","1up","Kart"]},is_available:!1,unlock:"purchase"},{id:2423,name:"Om Nom Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:15,tags:["AugM23","Drops5","Yellow","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2424,name:"Harrison Cat Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:0,tags:["AugM23","Drops5","Thumb","Black","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2425,name:"Flushed Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:1,tags:["AugM23","Drops5","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2426,name:"Albino Snake Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:2,tags:["AugM23","Drops5","Grey","Gray","ABHS"]},is_available:!1,unlock:"manual"},{id:2427,name:"Shell Wiki Stamp",price:3210,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:3,tags:["AugM23","Drops5","Egg","White"]},is_available:!0,unlock:"purchase"},{id:2428,name:"Wiz Ears Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:4,tags:["AugM23","Drops5","Blue","BWD","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2429,name:"r/place Pablo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:5,tags:["AugM23","Drops5","Yellow","Orange","Smile"]},is_available:!1,unlock:"manual"},{id:2430,name:"r/place BWD skull Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:6,tags:["AugM23","Drops5","Blue"]},is_available:!1,unlock:"manual"},{id:2431,name:"r/place BWD logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:7,tags:["AugM23","Drops5","Blue"]},is_available:!1,unlock:"manual"},{id:2432,name:"Solve for X Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:8,tags:["Sep23","Pencil3","Orange"]},is_available:!1,unlock:"purchase"},{id:2433,name:"Anarchy Academy",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:9,tags:["Sep23","Pencil3","Red"]},is_available:!1,unlock:"purchase"},{id:2434,name:"Egg-lectrons Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:10,tags:["Sep23","Pencil3","Science","Black"]},is_available:!1,unlock:"purchase"},{id:2435,name:"Blue Wizard Wrestling Federation Logo",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:12,tags:["SepM23","WBros","Wrestle","BWD","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2436,name:"Bron Lester Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:13,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2437,name:"Jan Seeya Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:14,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2438,name:"Rocky Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:15,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2439,name:"Brogan Paw Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:0,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2440,name:"Romeo Rain Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:1,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2441,name:"Nacho Mann Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:2,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2442,name:"Death Brawlin Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:3,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2443,name:"Bulk Logan Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:4,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2444,name:"Ray Mystery Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:5,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2445,name:"Binky Flinch Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:6,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2446,name:"Bonka Beware Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:7,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2447,name:"Wrestlebros 1v1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:11,tags:["SepM23","WBros","Blue","Purple"]},is_available:!1,unlock:"manual"},{id:2448,name:"Rotting Zombie Fish Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:8,tags:["Oct23","Halloween4","Blue"]},is_available:!1,unlock:"purchase"},{id:2449,name:"Shark Chomp Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:9,tags:["Oct23","Halloween4","Blue"]},is_available:!1,unlock:"purchase"},{id:2450,name:"Squiddy Friend Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:10,tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:2451,name:"Venomous Sea Snake Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:11,tags:["Oct23","Halloween4","Green"]},is_available:!1,unlock:"purchase"},{id:2452,name:"Bait Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:12,tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:2453,name:"Wilson. Wilson... WILSON!",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:13,tags:["Oct23","Halloween4","Red","Hand"]},is_available:!1,unlock:"purchase"},{id:2454,name:"Demonic Face Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:14,tags:["Oct23","Face","bun_demon"]},is_available:!1,unlock:"manual"},{id:2455,name:"Boo Crew Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:15,tags:["OctM23","Text","Purple"]},is_available:!1,unlock:"purchase"},{id:2456,name:"Cool Maid Face",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:0,tags:["OctM23","Face"]},is_available:!1,unlock:"purchase"},{id:2457,name:"Ghoul Power Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:1,tags:["OctM23","Text","Pink"]},is_available:!1,unlock:"purchase"},{id:2458,name:"Ghost Malone",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:2,tags:["OctM23","Meme","White"]},is_available:!1,unlock:"purchase"},{id:2459,name:"Seen too much Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:3,tags:["OctM23","Purple","Oct24"]},is_available:!1,unlock:"purchase"},{id:2460,name:"Pumpkin Wizard Digital",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:4,tags:["OctM23","Orange","BWD","Infinite Smasher"]},is_available:!1,unlock:"purchase"},{id:2461,name:"Get Ghosted Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:5,tags:["OctM23","Black","Ghost","Text"]},is_available:!1,unlock:"purchase"},{id:2462,name:"Sacred Sun Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:6,tags:["Nov23","Mayan","Calendar","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2463,name:"Sea to Sun Totem Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:7,tags:["Nov23","Mayan","Red","Orange","Blue","Eye"]},is_available:!1,unlock:"purchase"},{id:2464,name:"Ancient Skull Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:8,tags:["Nov23","Mayan","Bone","Yellow"]},is_available:!1,unlock:"purchase"},{id:2465,name:"Snake Deity Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:9,tags:["Nov23","Mayan","Green","Snek"]},is_available:!1,unlock:"purchase"},{id:2466,name:"Raven Lord Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:10,tags:["Nov23","Mayan","Black","Nevermore","Oct24"]},is_available:!1,unlock:"purchase"},{id:2467,name:"Tepey\xf3llotl Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:11,tags:["Nov23","Mayan","Leopard","Orange","bun_mayan"]},is_available:!1,unlock:"purchase"},{id:2468,name:"Give Thanksing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:12,tags:["NovM23","Text","Thanksgiving3","Orange","Red"]},is_available:!1,unlock:"purchase"},{id:2469,name:"Football Turkey Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:13,tags:["NovM23","Thanksgiving3","Brown","Basted"]},is_available:!1,unlock:"purchase"},{id:2470,name:"Basted Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:14,tags:["NovM23","Thanksgiving3","Yellow","Text"]},is_available:!1,unlock:"purchase"},{id:2471,name:"Feast Mode Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:15,tags:["NovM23","Thanksgiving3","Red","Text"]},is_available:!1,unlock:"purchase"},{id:2472,name:"HoHoHo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:3,tags:["Dec23","Christmas3","Red","Green","Text","Dec24"]},is_available:!1,unlock:"purchase"},{id:2473,name:"Nice Egg Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:1,tags:["Dec23","Christmas3","Red","Green","Text","Dec24"]},is_available:!1,unlock:"purchase"},{id:2474,name:"Naughty Egg Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:0,tags:["Dec23","Christmas3","Pink","Purple","Text","Dec24"]},is_available:!1,unlock:"purchase"},{id:2475,name:"Big Baubles Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:2,tags:["Dec23","Christmas3","Red","Green","Dec24"]},is_available:!1,unlock:"purchase"},{id:2476,name:"New Year 2024 Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:6,tags:["NewYears","DecM23","2024","Blue","White"]},is_available:!1,unlock:"purchase"},{id:2477,name:"Out with the Old",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:4,tags:["NewYears","DecM23","2024","Blue","White","DecM24"]},is_available:!1,unlock:"purchase"},{id:2478,name:"In with the New",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:5,tags:["NewYears","DecM23","2024","Blue","White","DecM24"]},is_available:!1,unlock:"purchase"},{id:2479,name:"Yolk Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:8,tags:["JanM24","Text","Racer","Grey","Gray","Yellow"]},is_available:!0,unlock:"purchase"},{id:2480,name:"Crown Stamp",price:25e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:9,tags:["JanM24","Winner","Racer","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:2481,name:"Stop Healing Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:10,tags:["JanM24","Winner","Racer"]},is_available:!0,unlock:"purchase"},{id:2482,name:"Chinese Egg Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:11,tags:["JanM24","Purple","Yellow","Text","Racer"]},is_available:!0,unlock:"purchase"},{id:2483,name:"Pireggi Logo",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:7,tags:["JanM24","Text","Black","Pireggi"]},is_available:!0,unlock:"purchase"},{id:2484,name:"Deez Acorns",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:12,tags:["Feb24","Nuts","Nutz","Brown","NovM24"]},is_available:!1,unlock:"purchase"},{id:2485,name:"Cute Bear Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:13,tags:["Feb24","Tongue","Face","Brown"]},is_available:!1,unlock:"purchase"},{id:2486,name:"Truth or Deer Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:14,tags:["Feb24","Text","Brown"]},is_available:!1,unlock:"purchase"},{id:2487,name:"Cute Owl Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:15,tags:["Feb24","Face","Who","Brown"]},is_available:!1,unlock:"purchase"},{id:2488,name:"Cupid Squee Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:16,tags:["Feb24","Pink","Red","Face","bun_cupid"]},is_available:!1,unlock:"manual"},{id:2489,name:"Kyler Bappy",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2490,name:"Nay Moore",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2491,name:"Davey Bendem",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2492,name:"Meggy Repo",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2493,name:"Lion Messy",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2494,name:"Chris Ronald",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2495,name:"SUUIII",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:16,tags:["FebM24","Player","Face","Blue","Sbros","Ronaldo","Apr25","premFeatTwo"]},is_available:!0,unlock:"purchase"},{id:2496,name:"Red Card!",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:16,tags:["FebM24","Foul","Penalty","Red","Sbros"]},is_available:!1,unlock:"purchase"},{id:2497,name:"Triskelion Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:16,tags:["Mar24","StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2498,name:"Negative Ward Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2499,name:"Celtic Knot Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2500,name:"Bad Bunny Patch",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:16,tags:["Mar24","Rabbit","Fur","White","bun_badbunny"]},is_available:!1,unlock:"manual"},{id:2501,name:"Triquetra Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2502,name:"Finest Emeralds",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2503,name:"Lucky Horseshoe Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Gold","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:2504,name:"Gang Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:16,tags:["Clan","Mar24"]},is_available:!1,unlock:"manual"},{id:2505,name:"Wooly Beard",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:16,tags:["Future"]},is_available:!1,unlock:"manual"},{id:2506,name:"Jelly Beanz!",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:16,tags:["MarM24","Easter","Food","Rainbow","MarM25"]},is_available:!0,unlock:"purchase"},{id:2507,name:"Full of Eggs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:16,tags:["MarM24","Easter","Food","Rainbow","MarM25"]},is_available:!0,unlock:"purchase"},{id:2508,name:"Chocolate Egg",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:16,tags:["MarM24","Easter","Food","Brown","MarM25"]},is_available:!0,unlock:"purchase"},{id:2509,name:"Candy Coma Bunny Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:16,tags:["MarM24","Easter","Food","Rabbit","White","MarM25"]},is_available:!0,unlock:"purchase"},{id:2510,name:"Outta Chocolate Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:16,tags:["MarM24","Easter","Food","Rabbit","Face","Brown","MarM25"]},is_available:!0,unlock:"purchase"},{id:2511,name:"E&E stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:16,tags:["MarM24","Easter","Text","Food","Brown","MarM25"]},is_available:!0,unlock:"purchase"},{id:2512,name:"Recycled Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:16,tags:["MarM24","Default","Green","Symbol"]},is_available:!0,unlock:"default"},{id:2513,name:"Yum Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:16,tags:["MarM24","Default","Emoji","Tongue","Yellow"]},is_available:!0,unlock:"default"},{id:2514,name:"Moai Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:16,tags:["MarM24","Default","Emoji","Easter","Grey","Gray","Silver"]},is_available:!0,unlock:"default"},{id:2515,name:"Cyborg Bear Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:16,tags:["Apr24","Brown","RotR"]},is_available:!1,unlock:"purchase"},{id:2516,name:"Resistance is Futile Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:16,tags:["Apr24","Text","RotR"]},is_available:!1,unlock:"purchase"},{id:2517,name:"Cyborg Wiz Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:16,tags:["Apr24","Blue","RotR","Purple","Blurple"]},is_available:!1,unlock:"purchase"},{id:2518,name:"Cyborg Scared Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:16,tags:["Apr24","Gray","Thee_Owl","RotR","Grey","Face","Red"]},is_available:!1,unlock:"manual"},{id:2519,name:"Cyborg Angry Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:16,tags:["Apr24","Gray","Thee_Owl","RotR","Grey","Face","Red","bun_borg"]},is_available:!1,unlock:"manual"},{id:2520,name:"Rise of the Robots Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:17,tags:["Apr24","Yellow","RotR","Blue","Text","Newsletter"]},is_available:!1,unlock:"manual"},{id:2521,name:"Cut Diamond Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:17,tags:["Apr24","Blue"]},is_available:!1,unlock:"manual"},{id:2522,name:"Mecha-Nate Down Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:17,tags:["Apr24","Face","Red","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2523,name:"Mecha-Nate Up Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:17,tags:["Apr24","Face","Green","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2524,name:"Mecha-Nate Squaree Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:17,tags:["Apr24","Punchable","Face","White","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2525,name:"Mecha-Nate Creep Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:17,tags:["Apr24","Face","White","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2526,name:"Mecha-Nate Suckerguy Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:17,tags:["Apr24","Face","White","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2527,name:"Mecha-Nate Bottle Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:17,tags:["Apr24","Alien","Green","RotR"]},is_available:!1,unlock:"manual"},{id:2528,name:"Mecha-Nate Moai Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:17,tags:["Apr24","Stone","Gray","Grey","RotR"]},is_available:!1,unlock:"manual"},{id:2529,name:"Mecha-Nate Gurfield Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:17,tags:["Apr24","Cat","Face","White","RotR"]},is_available:!1,unlock:"manual"},{id:2530,name:"Joining Forces",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:17,tags:["Apr24","Pablo","Face","Diablo","RotR"]},is_available:!1,unlock:"purchase"},{id:2531,name:"Shell Shockers Cyborged Logo",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:17,tags:["Apr24","Text","Logo","RotR"]},is_available:!1,unlock:"purchase"},{id:2532,name:"Mount Rushmore Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:17,tags:["AprM24","Pablo","Rock","Smile","Drops6"]},is_available:!1,unlock:"manual"},{id:2533,name:"Bald Meno Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:17,tags:["AprM24","Face","Drops6"]},is_available:!1,unlock:"manual"},{id:2534,name:"Oink Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:17,tags:["May24","Farm","Pink","Text","Pig"]},is_available:!1,unlock:"purchase"},{id:2535,name:"Moo Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:17,tags:["May24","Farm","Black","White","Text","Cow"]},is_available:!1,unlock:"purchase"},{id:2536,name:"Quack Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:17,tags:["May24","Farm","White","Yellow","Text","Duck"]},is_available:!1,unlock:"purchase"},{id:2537,name:"Scarecrow Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:17,tags:["May24","Farm","Face","Yellow","Brown","Badoi"]},is_available:!1,unlock:"purchase"},{id:2538,name:"Farm Life Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:17,tags:["May24","Farm","Yellow","Text","Eat","Sleep","Repeat"]},is_available:!1,unlock:"purchase"},{id:2539,name:"Farm Tools Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:17,tags:["May24","Farm","Brown","Silver","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:2540,name:"Robots Defeated Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:17,tags:["May24","Red","Black","Eye","EGGORG"]},is_available:!1,unlock:"manual"},{id:2541,name:"USDA Organic",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:1,tags:["May24","Farm","Newsletter","Text"]},is_available:!1,unlock:"manual"},{id:2542,name:"Shell Leaks Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:17,tags:["May24","Community","Egg"]},is_available:!1,unlock:"manual"},{id:2543,name:"Clucky Charms",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:17,tags:["MayM24","Rooster","Wizard","Chicken&Waffles","Blue"]},is_available:!1,unlock:"purchase"},{id:2544,name:"Toast Ghost",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:17,tags:["MayM24","Bread","White","Brown","Chicken&Waffles","OctM24"]},is_available:!1,unlock:"purchase"},{id:2545,name:"Breakfast of Champions",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:17,tags:["MayM24","Trophy","Egg","Gold","Blue","Chicken&Waffles"]},is_available:!1,unlock:"purchase"},{id:2546,name:"Caffeine Rush",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:17,tags:["MayM24","Egg","Face","White","Chicken&Waffles"]},is_available:!1,unlock:"purchase"},{id:2547,name:"Skipped Breakfast",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:17,tags:["MayM24","Chicken","Face","White","Chicken&Waffles"]},is_available:!1,unlock:"purchase"},{id:2548,name:"Chicken & Waffles",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:17,tags:["MayM24","Chicken","Face","White","Chicken&Waffles"]},is_available:!1,unlock:"purchase"},{id:2549,name:"Ant Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:17,tags:["Jun24","Eyes","Face","Brown","Bugs"]},is_available:!1,unlock:"purchase"},{id:2550,name:"Worker Bee Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:17,tags:["Jun24","Eyes","Yellow","Black","Bugs"]},is_available:!1,unlock:"purchase"},{id:2551,name:"Spider Web Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:17,tags:["Jun24","Black","Bugs","bun_arach"]},is_available:!1,unlock:"manual"},{id:2552,name:"Spider Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:17,tags:["Jun24","Eyes","Face","Red","Bugs"]},is_available:!1,unlock:"purchase"},{id:2553,name:"Grasshopper Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:18,tags:["Jun24","Eyes","Face","Blue","Bugs"]},is_available:!1,unlock:"purchase"},{id:2554,name:"Fly Eyes Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:18,tags:["Jun24","Eyes","Face","Red","Bugs"]},is_available:!1,unlock:"purchase"},{id:2555,name:"Catapiller Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:18,tags:["Jun24","Eyes","Egg","Green","Bugs"]},is_available:!1,unlock:"purchase"},{id:2556,name:"Dill With It Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:18,tags:["JunM24","Text","Pickle","Green","Blue","Food"]},is_available:!1,unlock:"purchase"},{id:2557,name:"Shell Yeah Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:18,tags:["JunM24","Text","Blue","Summer"]},is_available:!1,unlock:"purchase"},{id:2558,name:"Wiffle Ball Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:18,tags:["JunM24","Purple","Blue","Blurple","Sports"]},is_available:!1,unlock:"purchase"},{id:2559,name:"Summer Vibes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:18,tags:["JunM24","Pink","Text","Summer"]},is_available:!1,unlock:"purchase"},{id:2560,name:"SL MVP 2024+ Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:18,tags:["July24","Purple","Text","League"]},is_available:!1,unlock:"manual"},{id:2561,name:"Chess Clock Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:18,tags:["July24","Newsletter","Brown","Chess"]},is_available:!1,unlock:"manual"},{id:2562,name:"Tactical Pawns Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:18,tags:["July24","Bundle","Chess","bun_tactic"]},is_available:!1,unlock:"manual"},{id:2563,name:"Magnus Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:18,tags:["July24","Face","Chess","Black"]},is_available:!1,unlock:"purchase"},{id:2564,name:"Checkmate Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:18,tags:["July24","Text","Chess"]},is_available:!1,unlock:"purchase"},{id:2565,name:"Short King",price:5800,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:18,tags:["July24","Text","Chess","Wizups"]},is_available:!1,unlock:"purchase"},{id:2566,name:"Knight Moves",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:18,tags:["July24","Text","Chess","Night"]},is_available:!1,unlock:"purchase"},{id:2567,name:"Botez Gambit",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:18,tags:["July24","Text","Chess","Sacrifice"]},is_available:!1,unlock:"purchase"},{id:2568,name:"Time Varience Face",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:18,tags:["JulyM24","Face","Clock","Minutes"]},is_available:!1,unlock:"purchase"},{id:2569,name:"Deadpond Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:18,tags:["JulyM24","Face","Black","Eyes"]},is_available:!1,unlock:"purchase"},{id:2570,name:"Claw Slash Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:18,tags:["JulyM24","Claws","Wolverine","X","Eggx-men"]},is_available:!1,unlock:"purchase"},{id:2571,name:"Eggx-Men Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:18,tags:["JulyM24","Text","Logo","X","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2572,name:"Maximum Effort Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:18,tags:["JulyM24","Text","Deadpond","Deadpool","Red","Face"]},is_available:!1,unlock:"purchase"},{id:2573,name:"Take me to your Leader",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:18,tags:["Aug24","Text","Alien","Galeggsy","White","Yellow","bun_zorg"]},is_available:!1,unlock:"manual"},{id:2574,name:"Peeking Alien Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:18,tags:["Aug24","Eyes","Egg","White","Green"]},is_available:!1,unlock:"purchase"},{id:2575,name:"Three eyes Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:18,tags:["Aug24","Eyes","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2576,name:"Gray Space Alien Face",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:18,tags:["Aug24","Eyes","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2577,name:"Alien Side Eye",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:18,tags:["Aug24","Eyes","Green","Newsletter"]},is_available:!1,unlock:"manual"},{id:2578,name:"Eggventure Jeep Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:18,tags:["AugM24","White","Kart"]},is_available:!1,unlock:"purchase"},{id:2579,name:"Dino Derby Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:18,tags:["AugM24","White","Kart","Text","Logo"]},is_available:!1,unlock:"purchase"},{id:2580,name:"Gryffinhatch House",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:18,tags:["Sep24","EggyP","Orange"]},is_available:!1,unlock:"purchase"},{id:2581,name:"Ravencluck House",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:18,tags:["Sep24","EggyP","Blue"]},is_available:!1,unlock:"purchase"},{id:2582,name:"Slytheregg House",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:18,tags:["Sep24","EggyP","Green"]},is_available:!1,unlock:"purchase"},{id:2583,name:"Hugglepeck House",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:18,tags:["Sep24","EggyP","Yellow"]},is_available:!1,unlock:"purchase"},{id:2584,name:"Shellshriek Face",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:18,tags:["Sep24","EggyP","Eyes","Teeth","bun_plant"]},is_available:!1,unlock:"manual"},{id:2585,name:"Platform 9 3/4 Stamp",price:9340,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:19,tags:["Sep24","EggyP","Text","Red","White"]},is_available:!1,unlock:"purchase"},{id:2586,name:"Pixel Football Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:19,tags:["SepM24","Fbros","Brown"]},is_available:!1,unlock:"purchase"},{id:2587,name:"Football Bros Logo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:19,tags:["SepM24","Fbros","Text","Red"]},is_available:!1,unlock:"purchase"},{id:2588,name:"Quarterback Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:19,tags:["SepM24","Fbros","Red","Football"]},is_available:!1,unlock:"purchase"},{id:2589,name:"Neon Chicken Breast",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:19,tags:["Oct24","Halloween5","Bones","Purple"]},is_available:!1,unlock:"purchase"},{id:2590,name:"Flock of the Damned",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:19,tags:["Oct24","Halloween5","Text","Wings","Silver","Grey","Gray","Red"]},is_available:!1,unlock:"purchase"},{id:2591,name:"Zombozo",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:19,tags:["Oct24","Halloween5","Brown","White","Beak","Eye"]},is_available:!1,unlock:"purchase"},{id:2592,name:"Dovely face",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:19,tags:["Oct24","Halloween5","Brown","White","Beak","Eye","bun_dove"]},is_available:!1,unlock:"manual"},{id:2593,name:"Eggar Allen Poe",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:19,tags:["OctM24","Halloween5","Face","Black"]},is_available:!1,unlock:"purchase"},{id:2594,name:"Shellraiser Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:19,tags:["OctM24","Halloween5","Text","Red"]},is_available:!1,unlock:"purchase"},{id:2595,name:"Peek-a-BOO Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:19,tags:["OctM24","Halloween5","Text","Orange"]},is_available:!1,unlock:"purchase"},{id:2596,name:"Trigger Warning Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:19,tags:["Nov24","SC2","Text","Red","Newsletter"]},is_available:!1,unlock:"manual"},{id:2597,name:"Killer Fridge Faded Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:19,tags:["Nov24","SC2","Face","Red"]},is_available:!1,unlock:"purchase"},{id:2598,name:"Damaged Target Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:19,tags:["Nov24","SC2","Yellow","Black","Yolk"]},is_available:!1,unlock:"purchase"},{id:2599,name:"Swamp Thing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:19,tags:["Nov24","SC2","Face","Green"]},is_available:!1,unlock:"purchase"},{id:2600,name:"Now on Steam Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:19,tags:["Nov24","SC2","Text","Black","Logo","Gear"]},is_available:!1,unlock:"manual"},{id:2601,name:"Mad Mouth Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:19,tags:["Nov24","SC2","Teeth","Black","White","Red"]},is_available:!1,unlock:"purchase"},{id:2602,name:"Slayaway Camp 2 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:19,tags:["Nov24","SC2","Logo","Text","Black","Red"]},is_available:!1,unlock:"purchase"},{id:2603,name:"Killer Fridge Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:19,tags:["Nov24","SC2","Face","Red"]},is_available:!1,unlock:"purchase"},{id:2604,name:"Terrortube Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:19,tags:["Nov24","SC2","Text","Red"]},is_available:!1,unlock:"purchase"},{id:2605,name:"Honey Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:19,tags:["NovM24","Thanksgiving4","Food","Yellow"]},is_available:!1,unlock:"purchase"},{id:2606,name:"Jam Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:19,tags:["NovM24","Thanksgiving4","Food","Red"]},is_available:!1,unlock:"purchase"},{id:2607,name:"Gnome Gnose Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:19,tags:["Dec24","Christmas4","White","Pink"]},is_available:!1,unlock:"purchase"},{id:2608,name:"Sleigh Me Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:19,tags:["Dec24","Thanksgiving4","Text","Blue"]},is_available:!1,unlock:"purchase"},{id:2609,name:"LCC stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:19,tags:["League","Community","Text","Black"]},is_available:!1,unlock:"manual"},{id:2610,name:"New Year 2025 Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:19,tags:["NewYears","DecM24","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:2611,name:"Algebruh Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:19,tags:["JanM25","Red","Green"]},is_available:!1,unlock:"purchase"},{id:2612,name:"Fractal Target Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:19,tags:["JanM25","Blue"]},is_available:!1,unlock:"purchase"},{id:2613,name:"Perfectly Balanced Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:19,tags:["JanM25","Black"]},is_available:!1,unlock:"purchase"},{id:2614,name:"I love Feesh Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:19,tags:["Feb25","Pink","Fish","Blue"]},is_available:!1,unlock:"purchase"},{id:2615,name:"I'm Hooked Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:19,tags:["Feb25","Green","Fish","Newsletter"]},is_available:!1,unlock:"manual"},{id:2616,name:"Swedish Fish Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:19,tags:["Feb25","Sweet","Red","Fish","Candy"]},is_available:!1,unlock:"purchase"},{id:2617,name:"Heart Shaped Box Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:20,tags:["Feb25","Sweet","Red","White","Candy"]},is_available:!1,unlock:"purchase"},{id:2618,name:"Zaxonius Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:20,tags:["FebM25","Drops7","D7W2","Pink","Purple"]},is_available:!1,unlock:"manual"},{id:2619,name:"The Pixel Fox",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:20,tags:["FebM25","Drops7","Orange","Eye"]},is_available:!1,unlock:"purchase"},{id:2620,name:"PLANS Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:20,tags:["FebM25","Drops7","D7W1","Egg","White","Black"]},is_available:!1,unlock:"manual"},{id:2621,name:"Angry Snipes Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:20,tags:["FebM25","Drops7","Blue","Crackshot"]},is_available:!1,unlock:"purchase"},{id:2622,name:"Grotesque Grin Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:20,tags:["FebM25","Drops7","D7W1","Face","Black"]},is_available:!1,unlock:"manual"},{id:2623,name:"Grotesque Grief Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:20,tags:["FebM25","Drops7","D7W2","Face","Black"]},is_available:!1,unlock:"manual"},{id:2624,name:"#Blame Harrison",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:20,tags:["FebM25","Drops7","D7W2","Face","Black"]},is_available:!1,unlock:"purchase"},{id:2625,name:"Shamrocked Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:20,tags:["Mar25","StPatricksDay","Clover","Green"]},is_available:!1,unlock:"purchase"},{id:2627,name:"Easter Island",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:20,tags:["MarM25","Text","Orange"]},is_available:!0,unlock:"purchase"},{id:2628,name:"Dwarf #8",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:20,tags:["MarM25","Snow","White","Tipsy"]},is_available:!0,unlock:"purchase"},{id:3100,name:"The Eggk-47",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47",tags:["default","Blue","Purple"]},is_available:!0,unlock:"default"},{id:3101,name:"GOLD Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3102,name:"Happy Bear Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3103,name:"Halloween Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3104,name:"Thanksgiving Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3105,name:"Christmas Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3106,name:"2019 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3107,name:"Groundhog Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3108,name:"Buck Rogers Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3109,name:"Valentines Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3110,name:"St Patricks Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3111,name:"Easter Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Easter",tags:["Easter","Red","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3112,name:"Flame Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3113,name:"Rainbow Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3114,name:"Steampunk Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3115,name:"Memphis Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Memphis",tags:["Memphis","Blue","Orange","Purple"]},is_available:!0,unlock:"purchase"},{id:3116,name:"Eggwalker Eggk-47",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3117,name:"Nuke Zone Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NukeZone",tags:["NukeZone","Black","Neon","Pink"]},is_available:!0,unlock:"purchase"},{id:3118,name:"2020 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3119,name:"Country Singer Eggk-47",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3120,name:"Albino Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3121,name:"Raid Land Eggk-47",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_RaidLand",tags:["RaidLand","Blue","Black"]},is_available:!1,unlock:"purchase"},{id:3122,name:"Toxic Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3123,name:"Music Eggk-47",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Music",tags:["Rockstar","JanM23","Black","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3124,name:"Galeggsy Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3125,name:"Chicken Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3126,name:"Techno Eggk-47",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Techno",tags:["Dec23","Blue","Yellow","Black","Pog","DecM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["gun_eggk47_techno"]},{id:3127,name:"2021 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3128,name:"Car Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_car",tags:["Cars","Trains","Blue"]},is_available:!0,unlock:"purchase"},{id:3129,name:"Merc Zone Eggk-47",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Merc",tags:["Merc","Suit","Black","Tie","Blue"]},is_available:!0,unlock:"purchase"},{id:3130,name:"Summer Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3131,name:"Pencil Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Pencil",tags:["Pencil","Sep23","Yellow","Sep24"]},is_available:!1,unlock:"purchase"},{id:3132,name:"2022 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3133,name:"Cards Eggk-47",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3134,name:"Retro Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Retro",tags:["Retro","Pixel","FebM23","Blue","Purple","Wings","DecM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_ak_retro"]},{id:3135,name:"Dino Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Dino",tags:["Dino","May23","Red","Brown","AugM24"]},is_available:!1,unlock:"purchase"},{id:3136,name:"Valkyrie Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_ak_valkyrie"]},{id:3137,name:"Eggwalker Alt Eggk-47",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:3138,name:"SPORTS Eggk-47",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Sports",tags:["Sports","JulyM23","Brown","Orange","Cricket","Bat","JunM24"]},is_available:!1,unlock:"purchase"},{id:3139,name:"Breakfast Eggk-47",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Breakfast",tags:["Breakfast","Food","Brown","Syrup","Waffles","MayM24"]},is_available:!1,unlock:"purchase"},{id:3140,name:"2023 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3141,name:"Farm Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Farm",tags:["Farm","FebM23","Food","Orange","Green","Carrot","May24"]},is_available:!1,unlock:"purchase"},{id:3142,name:"Fusion Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Fusion",tags:["Premium","fusion","FebM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak47_fusion"]},{id:3143,name:"Hero Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Fantasy",tags:["Heroes","Apr23","Sword","Silver"]},is_available:!1,unlock:"purchase"},{id:3144,name:"Monster Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_FantasyEvil",tags:["Monsters","Apr23","Purple","Sword"]},is_available:!1,unlock:"purchase"},{id:3145,name:"Equinox Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3146,name:"Paintball Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Paintball",tags:["Sports2","JulyM23","Grey","Gray","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:3147,name:"Kart Eggk-47",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Kart",tags:["Kart","Aug23","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3148,name:"BWD Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Wizard",tags:["Drops5","AugM23","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3149,name:"Infernal Eggk-47",price:4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Infernal",tags:["OctM23","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak_infernal"]},{id:3150,name:"Ancient Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3151,name:"Holideggs Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3152,name:"2024 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!1,unlock:"purchase"},{id:3153,name:"Racer Eggk-47",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3154,name:"Chocolate Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Chocolate",tags:["MarM24","Brown","Gold","premFeatOne","MarM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_ak_choc"]},{id:3155,name:"Mecha-Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Steambot",tags:["Apr24","Brown","Gold","Premium"]},is_available:!1,unlock:"premium"},{id:3156,name:"MenoXD Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Meno",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:3157,name:"Alien Eggk-47",price:5e5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Alien",tags:["Aug24","Perm","Premium","eggyp"]},is_available:!0,unlock:"purchase",activeProduct:!1,sku:["item_ak_alien"]},{id:3158,name:"Spore Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3159,name:"2025 Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2025",tags:["NewYears","DecM24","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3160,name:"Sleigh Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Christmas",tags:["Newsletter","Gift","DecM24","Gold","Red"]},is_available:!1,unlock:"manual"},{id:3161,name:"Golden Dragon Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_dragongold",tags:["EGGORG","Shadows","Apr25","Gold"]},is_available:!0,unlock:"purchase"},{id:3400,name:"The Free Ranger",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1",tags:["default","Orange","Green","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3401,name:"GOLD Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3402,name:"Happy Bear Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3403,name:"Halloween Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3404,name:"Thanksgiving Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3405,name:"Christmas Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3406,name:"2019 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3407,name:"Groundhog Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3408,name:"Buck Rogers Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3409,name:"Valentines Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3410,name:"St Patricks Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3411,name:"Easter Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Easter",tags:["Easter","Blue","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3412,name:"Flame Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3413,name:"Rainbow Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3414,name:"Steampunk Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3415,name:"Memphis Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Memphis",tags:["Memphis","Blue","Orange","Purple"]},is_available:!0,unlock:"purchase"},{id:3416,name:"Eggwalker Free Ranger",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_spaceEgg",tags:["sale","Eggwalker","July23","Black","Grey","Gray","Yellow","MarM24","Welcome","Bundle"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_csg1_space"]},{id:3417,name:"Nuke Zone Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NukeZone",tags:["NukeZone","Yellow","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:3418,name:"2020 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3419,name:"Country Singer Free Ranger",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3420,name:"Albino Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3421,name:"Raid Land Free Ranger",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RaidLand",tags:["RaidLand","Blue","Yellow","Brown","Wings"]},is_available:!1,unlock:"purchase"},{id:3422,name:"Toxic Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3423,name:"Music Free Ranger",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Music",tags:["Rockstar","JanM23","Black","Guitar","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3424,name:"Galeggsy Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3425,name:"Chicken Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3426,name:"Techno Free Ranger",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Techno",tags:["Premium","Techno","Cats","Catz","Purple","Yellow","Black","AprM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_csg1_techno"]},{id:3427,name:"2021 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3428,name:"Car Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_car",tags:["Cars","Trains","Red","Firetruck"]},is_available:!0,unlock:"purchase"},{id:3429,name:"Merc Zone Free Ranger",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Merc",tags:["Merc","Suit","Black","Tie","Yellow"]},is_available:!0,unlock:"purchase"},{id:3430,name:"Summer Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3431,name:"Retro Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Retro",tags:["Retro","Premium","Pixel","Green","Wings","JanM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_csg1_retro"]},{id:3432,name:"Pencil Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Pencil",tags:["Pencil","Sep23","Yellow","Paintbrush","Sep24"]},is_available:!1,unlock:"purchase"},{id:3433,name:"2022 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3434,name:"BWD Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Wizard",tags:["Drops","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3435,name:"Cards Free Ranger",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3436,name:"Dino Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Dino",tags:["Dino","May23","Green","Orange","AugM24"]},is_available:!1,unlock:"purchase"},{id:3437,name:"Eggpire Free Ranger",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3438,name:"SPORTS Free Ranger",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Sports",tags:["Sports","JulyM23","Brown","White","Baseball","JunM24"]},is_available:!1,unlock:"purchase"},{id:3439,name:"Rubber Chicken Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RubberChicken",tags:["Aug23","Yellow","MayM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_csg1_rubchick"]},{id:3440,name:"Breakfast Free Ranger",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Breakfast",tags:["Breakfast","Food","Toast","Brown","Eggs","Bread","MayM24"]},is_available:!1,unlock:"purchase"},{id:3441,name:"Valkyrie Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Valkyrie",tags:["Valkyrie","Premium","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_range_valk"]},{id:3442,name:"2023 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3443,name:"Fusion Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Fusion",tags:["Premium","JanM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_csg1_fusion"]},{id:3444,name:"Farm Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Farm",tags:["Farm","FebM23","Food","Yellow","Green","Corn","May24","NovM24"]},is_available:!1,unlock:"purchase"},{id:3445,name:"Shellpreme Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Shellpreme",tags:["MayM23","Eggflation","Premium","Red","Sep24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_csg1_shellpreme"]},{id:3446,name:"Equinox Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3447,name:"Kart Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Kart",tags:["Aug23","Kart","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:3448,name:"lifeofnurse Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Nurse",tags:["AugM23","Drops5","Blue","Purple","Heart"]},is_available:!1,unlock:"manual"},{id:3449,name:"Bone Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bones",tags:["OctM23","Halloween4","Bone","White","Oct24"]},is_available:!1,unlock:"purchase"},{id:3450,name:"Ancient Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3451,name:"Holideggs Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3452,name:"2024 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:3453,name:"Sleigh Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Christmas",tags:["DecM23","Newsletter","Gold","Green","Red"]},is_available:!0,unlock:"manual"},{id:3454,name:"Racer Free Ranger",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3455,name:"Infernal Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Infernal",tags:["JanM24","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_csg1_infernal"]},{id:3456,name:"Mecha-Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Steambot",tags:["JanM24","RotR","Orange","Apr24","Premium"]},is_available:!1,unlock:"premium"},{id:3457,name:"Grasshopper Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bugs",tags:["Jun24","Bugs","Green"]},is_available:!1,unlock:"purchase"},{id:3458,name:"Spore Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3459,name:"2025 Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2025",tags:["DecM24","New Years","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3460,name:"Green Snake Free Ranger",price:15e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SnakePatrick",tags:["Mar25","StPatricksday","Green","White","Yellow","Mar25"]},is_available:!1,unlock:"purchase"},{id:3461,name:"Golden Dragon Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:3600,name:"The Scrambler",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge",tags:["default","Orange","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3601,name:"GOLD Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3602,name:"Happy Bear Scrambler ",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3603,name:"Halloween Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3604,name:"Thanksgiving Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3605,name:"Christmas Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3606,name:"2019 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3607,name:"Groundhog Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3608,name:"Buck Rogers Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3609,name:"Valentines Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3610,name:"St Patricks Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3611,name:"Easter Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Easter",tags:["Easter","Yellow","Green","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3612,name:"Flame Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3613,name:"Rainbow Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3614,name:"Steampunk Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3615,name:"Memphis Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Memphis",tags:["Memphis","Yellow","Green","Black","White"]},is_available:!0,unlock:"purchase"},{id:3616,name:"Eggwalker Scrambler",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3617,name:"Nuke Zone Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NukeZone",tags:["NukeZone","Black","Blue","Neon"]},is_available:!0,unlock:"purchase"},{id:3618,name:"2020 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3619,name:"Country Singer Scrambler",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3620,name:"Albino Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3621,name:"Raid Land Scrambler",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_RaidLand",tags:["RaidLand","Brown","White"]},is_available:!1,unlock:"purchase"},{id:3622,name:"Toxic Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3623,name:"Music Scrambler",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Music",tags:["Rockstar","JanM23","Red","Gold","Guitar","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3624,name:"Galeggsy Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3625,name:"Killstreak Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Killstreak",tags:["Killstreak","Smile","Yellow","Brown","Blue"]},is_available:!1,unlock:"manual"},{id:3626,name:"Chicken Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3627,name:"Techno Scrambler",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Techno",tags:["Techno","premium","SepM23","Badoosh","Red","Purple","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["gun_gauge_techno"]},{id:3628,name:"2021 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3629,name:"Car Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_car",tags:["Cars","Trains","Yellow"]},is_available:!0,unlock:"purchase"},{id:3630,name:"Merc Zone Scrambler",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Merc",tags:["Merc","Suit","Black","Tie","Orange"]},is_available:!0,unlock:"purchase"},{id:3631,name:"Summer Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3632,name:"Pencil Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Pencil",tags:["Pencil","Sep23","Highlighter","Sep24"]},is_available:!1,unlock:"purchase"},{id:3633,name:"BWD Fan-art Scrambler",price:15e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_BWD",tags:["Kids","Wizard","Blue","Rainbow"]},is_available:!0,unlock:"purchase"},{id:3634,name:"Retro Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Retro",tags:["Retro","Premium","Pixel","Grey","Gray","Orange","Wings","Mar24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_crack_retro"]},{id:3635,name:"2022 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3636,name:"Thee_Owl Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_TheeOwl",tags:["Relic","Drops2","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3637,name:"Basket Bros Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Basketball",tags:["BBros","JulyM23","Orange","Hoops","FebM24","JunM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_bros"]},{id:3638,name:"Cards Scrambler",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3639,name:"JWBerry3D Scrambler",price:75e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_JWBerry",tags:["Relic","Black","Red","Glasses"]},is_available:!0,unlock:"purchase"},{id:3640,name:"Dino Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Dino",tags:["Dino","May23","Blue","AugM24"]},is_available:!1,unlock:"purchase"},{id:3641,name:"Eggpire Scrambler",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3642,name:"Valkyrie Scrambler",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Valkyrie",tags:["Eggwalker2","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_valk"]},{id:3643,name:"SPORTS Scrambler",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Sports",tags:["Sports","JulyM23","Black","White","Green","Soccer","Football","FebM24","JunM24"]},is_available:!1,unlock:"purchase"},{id:3644,name:"Breakfast Scrambler",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Breakfast",tags:["Breakfast","Food","Red","Ketchup","MayM24"]},is_available:!1,unlock:"purchase"},{id:3645,name:"Sharkbucks Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Sharkbucks",tags:["Sep22","Drops3","Blue","Smile"]},is_available:!1,unlock:"manual"},{id:3646,name:"Kilzomatic Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Kilzomatic",tags:["Sep22","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:3647,name:"Badegg Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Badegg",tags:["Badegg","Red","Yellow","DecM23"]},is_available:!1,unlock:"purchase"},{id:3648,name:"2023 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3649,name:"Sleigh Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Christmas",tags:["Christmas2","Newsletter","Red","White","Gold","Sleigh"]},is_available:!0,unlock:"manual"},{id:3650,name:"Octopus Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Octopus",tags:["JanM23","Oct23","Blue","Pink"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gauge_octopus"]},{id:3651,name:"Farm Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Farm",tags:["Farm","FebM23","Yellow","Gold","Wheat","May24"]},is_available:!1,unlock:"purchase"},{id:3652,name:"BWD Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Wizard",tags:["Drops4","Mar23","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3653,name:"Green Snake Scrambler",price:15e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SnakePatrick",tags:["Mar23","StPatricksDay","Snek","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3654,name:"Beholder Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Fantasy",tags:["Monsters","Apr23","Purple","Yellow","Eyes","Apr24","Apr25","premFeatTwo"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_monster"]},{id:3655,name:"Fusion Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Fusion",tags:["Premium","MidM23","Fusion","White","Blue","Grey","Gray","bun_zorg"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_fusion"]},{id:3656,name:"Equinox Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3657,name:"Kart Scrambler",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Kart",tags:["Aug23","Kart","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3658,name:"Ancient Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3659,name:"Holideggs Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3660,name:"2024 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2024",tags:["DecM23","2024","NewYears","White","Blue"]},is_available:!1,unlock:"purchase"},{id:3661,name:"Racer Scrambler",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3662,name:"Cloudkicker Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Clouds",tags:["Feb24","Clouds","White","Rainbow","Feb25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gauge_cloud"]},{id:3663,name:"Irish Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Irish",tags:["Mar24","StPatricksDay","Green","Gold","Mar24","Mar25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gauge_irish"]},{id:3664,name:"Mecha-Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Steambot",tags:["Apr24","RotR","Premium"]},is_available:!1,unlock:"premium"},{id:3665,name:"Infernal Scrambler",price:4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Infernal",tags:["JulyM24","Infernal","Premium","Red","Orange","Black"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_infernal"]},{id:3666,name:"Bone Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Bones",tags:["OctM24","Halloween5"]},is_available:!1,unlock:"purchase"},{id:3667,name:"Spore Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3668,name:"2025 Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3669,name:"Golden Dragon Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:3e3,name:"The Cluck 9mm",price:0,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm",tags:["Red","Grey","Gray","Silver"]},is_available:!0,unlock:"default"},{id:3001,name:"GOLD Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3002,name:"Happy Bear Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3003,name:"Halloween Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3004,name:"Thanksgiving Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3005,name:"Christmas Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3006,name:"2019 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3007,name:"Groundhog Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3008,name:"Buck Rogers Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Buck",tags:["Promotional","Gray","Grey","Silver"]},is_available:!1,unlock:"manual"},{id:3009,name:"Valentines Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3010,name:"St Patricks Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3011,name:"Easter Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Easter",tags:["Easter","Pink","Blue","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3012,name:"Flame Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3013,name:"Rainbow Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3014,name:"Steampunk Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3015,name:"Memphis Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Memphis",tags:["Memphis","White","Black","Pink"]},is_available:!0,unlock:"purchase"},{id:3016,name:"Eggwalker Cluck 9mm",price:4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_space"]},{id:3017,name:"Nuke Zone Skin Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NukeZone",tags:["NukeZone","Yellow","Black","Neon"]},is_available:!1,unlock:"manual"},{id:3018,name:"2020 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3019,name:"Country Singer Cluck 9mm",price:1e5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3020,name:"Albino Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_SnakeAlbino",tags:["EggyCashAlbino","Snek","White","Gray","Grey","Red","ABHS"]},is_available:!1,unlock:"manual"},{id:3021,name:"Raid Land Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_RaidLand",tags:["RaidLand","Newsletter","Rabbit","Wabbit","Heart","Green","Brown","bun_badbunny"]},is_available:!1,unlock:"manual"},{id:3022,name:"Toxic Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3023,name:"Music Cluck 9mm",price:8e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Music",tags:["Rockstar","JanM23","Grey","Gray","Harmonica","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3024,name:"Galeggsy Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3025,name:"Techno Cluck 9mm",price:10,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Techno",tags:["AprM23","Red","Orange","Yellow","Pop","Black","SepM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_techno"]},{id:3026,name:"Cubic Castles Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_CubicCastles",tags:["CubicCastles","White","Black","Red","Skull"]},is_available:!1,unlock:"manual"},{id:3027,name:"Chicken Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3028,name:"2021 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3029,name:"Retro Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Retro",tags:["Retro","Premium","Pixel","Red","Gray","Grey","Silver","Wings","OctM23","bun_gamer"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_retro_9mm"]},{id:3030,name:"Car Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_car",tags:["Cars","Trains","Red"]},is_available:!0,unlock:"purchase"},{id:3031,name:"Merc Zone Cluck 9mm",price:7e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Merc",tags:["Merc","Suit","Black","Tie","Red"]},is_available:!0,unlock:"purchase"},{id:3032,name:"Summer Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3033,name:"Lyerpald Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_lyerpald",tags:["Dog","Grey","Gray","Purple"]},is_available:!0,unlock:"purchase"},{id:3034,name:"Pencil Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Pencil",tags:["Pencil","Sep23","Orange","Yellow","Sep24"]},is_available:!1,unlock:"purchase"},{id:3035,name:"Devilish Cluck 9mm",price:15e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Devilish",tags:["Kids","Red","Black","Purple","Fork","bun_demon"]},is_available:!0,unlock:"purchase"},{id:3036,name:"Bone Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bones",tags:["Halloween2","Oct23","Oct24","bun_dove"]},is_available:!1,unlock:"purchase"},{id:3037,name:"2022 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3038,name:"Sleigh Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Christmas",tags:["Christmas2","Newsletter","Red","Yellow","Green","Gold","Sleigh"]},is_available:!1,unlock:"manual"},{id:3039,name:"Cards Cluck 9mm",price:1520,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Cards",tags:["EGGORG","Apr23","Aug24"]},is_available:!1,unlock:"purchase"},{id:3040,name:"BWD Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Wizard",tags:["Relic","Drops2","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3041,name:"Dino Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Dino",tags:["Dino","May23","Brown","Yellow","AugM24"]},is_available:!1,unlock:"purchase"},{id:3042,name:"Eggpire Cluck 9mm",price:12500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3043,name:"SPORTS Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Sports",tags:["Sports","JulyM23","White","Bowling","Pin","JunM24"]},is_available:!1,unlock:"purchase"},{id:3044,name:"Breakfast Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Breakfast",tags:["Breakfast","Food","Apple","Juice","Red","MayM24"]},is_available:!1,unlock:"purchase"},{id:3045,name:"Valkyrie Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Valkyrie",tags:["Scavenger","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_valk"]},{id:3046,name:"Protractor Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Protractor",tags:["Pencil2","Sep23","Grey","Gray","Black"]},is_available:!1,unlock:"purchase"},{id:3047,name:"Badegg Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Badegg",tags:["Badegg","Yellow"]},is_available:!1,unlock:"purchase"},{id:3048,name:"2023 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3049,name:"Aquarius Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Aquarius",tags:["Groundhog","Feb23","Blue","Stars","Feb25"]},is_available:!1,unlock:"purchase"},{id:3050,name:"Cloudkicker Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Clouds",tags:["Premium","Feb23","Clouds","Rainbow","White","Feb24","Feb25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_9mm_cloud"]},{id:3051,name:"Farm Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Farm",tags:["Farm","FebM23","Food","Red","Tomato","May24"]},is_available:!1,unlock:"purchase"},{id:3052,name:"Thee_Owl Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_TheeOwl",tags:["Drops4","Mar23","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3053,name:"Merc Zone Final Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_MercF",tags:["Merc","Suit","Black","Tie"]},is_available:!1,unlock:"manual"},{id:3054,name:"Fusion Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Fusion",tags:["Premium","AprM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_9mm_fusion"]},{id:3055,name:"Caught in 4k Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Camera",tags:["Jun23","Photo","Smile","Meme","FebM24","DecM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_9mm_camera"]},{id:3056,name:"Equinox Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3057,name:"Kart Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Kart",tags:["Aug23","Kart","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:3058,name:"Infernal Cluck 9mm",price:4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Infernal",tags:["MarM24","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_9mm_infernal"]},{id:3059,name:"Megaphone Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Megaphone",tags:["Sep23","Red","White","FebM24","bun_tactic"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_9mm_mega"]},{id:3060,name:"Mouse Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Mouse",tags:["Sep23","Grey","Gray","Yellow","Cheese","bun_cat"]},is_available:!1,unlock:"manual"},{id:3061,name:"Ancient Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3062,name:"Holideggs Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3063,name:"2024 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:3064,name:"Racer Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3065,name:"Soccer Bros Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Soccer",tags:["FebM24","Sbros","Sports","Ball","Black","White"]},is_available:!1,unlock:"purchase"},{id:3066,name:"Mecha-Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Steambot",tags:["Apr24","RotR","Robots","Premium"]},is_available:!1,unlock:"premium"},{id:3067,name:"Stinkbug Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bugs",tags:["Jun24","Bugs","Brown"]},is_available:!1,unlock:"purchase"},{id:3068,name:"Spore Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3069,name:"2025 Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3070,name:"Frostfall 9mm",price:3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Frostfall",tags:["MarM25","Permanent","Blue","White"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_9mm_frost"]},{id:3071,name:"Golden Dragon 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_dragongold",tags:["Apr25","EGGORG","Shadows","Yellow","Gold"]},is_available:!0,unlock:"purchase"},{id:3800,name:"The RPEGG",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg",tags:["default","Yellow","Green","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3801,name:"GOLD RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3802,name:"Happy Bear RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3804,name:"Thanksgiving RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3805,name:"Christmas RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3806,name:"2019 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3807,name:"Groundhog RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3808,name:"Buck Rogers RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3809,name:"Valentines RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3810,name:"St Patricks RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3811,name:"Easter RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Easter",tags:["Easter","Orange","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3812,name:"Flame RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3813,name:"Rainbow RPEGG",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3814,name:"Steampunk RPEGG",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3815,name:"Memphis RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Memphis",tags:["Memphis","Black","White"]},is_available:!0,unlock:"purchase"},{id:3816,name:"Halloween Skin RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3817,name:"Eggwalker RPEGG",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3818,name:"Nuke Zone RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NukeZone",tags:["NukeZone","Black","Green","Neon"]},is_available:!0,unlock:"purchase"},{id:3819,name:"2020 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3820,name:"Country Singer RPEGG",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3821,name:"Albino RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3822,name:"Raid Lands RPEGG",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_RaidLand",tags:["RaidLand","Silver","Grey","Gray","Green"]},is_available:!1,unlock:"purchase"},{id:3823,name:"Toxic RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3824,name:"Music RPEGG",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Music",tags:["Rockstar","JanM23","Yellow","Gold","Tuba","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:3825,name:"Galeggsy RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3826,name:"Chicken RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3827,name:"2021 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3828,name:"Techno RPEGG",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Techno",tags:["Techno","Premium","JunM23","Yeet","Rainbow","Red","Yellow","Green","Blue","Purple"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_rpeggTechno"]},{id:3829,name:"Car RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_car",tags:["Cars","Trains","Silver"]},is_available:!0,unlock:"purchase"},{id:3830,name:"Merc Zone RPEGG",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Merc",tags:["Merc","Suit","Black","Tie","Green"]},is_available:!0,unlock:"purchase"},{id:3831,name:"Summer RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3832,name:"Pencil RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Pencil",tags:["Pencil","Sep23","Yellow","Tape","Sep24"]},is_available:!1,unlock:"purchase"},{id:3833,name:"Bone RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bones",tags:["Halloween2","Oct23","Oct24"]},is_available:!1,unlock:"purchase"},{id:3834,name:"2022 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3835,name:"Retro RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Retro",tags:["Retro","Premium","Pixel","Mar23","Green","Wings","July24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_rpegg_retro"]},{id:3836,name:"Cards RPEGG",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3837,name:"Dino RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Dino",tags:["Dino","May23","Orange","AugM24"]},is_available:!1,unlock:"purchase"},{id:3838,name:"Eggpire RPEGG",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3839,name:"SPORTS RPEGG",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Sports",tags:["Sports","JulyM23","Brown","Football","JunM24","Fbros","SepM24"]},is_available:!1,unlock:"purchase"},{id:3840,name:"Breakfast RPEGG",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Breakfast",tags:["Breakfast","Food","Sausage","MayM24"]},is_available:!1,unlock:"purchase"},{id:3841,name:"Scavenger RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Scavenger",tags:["Scavenger","Black","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:3842,name:"Egg Carton RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Eggs",tags:["Sep22","Drops3","Purple","Grey","Gray","Food"]},is_available:!1,unlock:"manual"},{id:3843,name:"Valkyrie RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Valkyrie",tags:["Valkyrie","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_rpegg_valk"]},{id:3844,name:"Missile Toe RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Christmas",tags:["Christmas2","Premium","Red","White","Hohoho","bun_mistle","Dec24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_rpegg_christ"]},{id:3845,name:"2023 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3846,name:"Farm RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Farm",tags:["Farm","FebM23","Barn","Red","May24"]},is_available:!1,unlock:"purchase"},{id:3947,name:"Equinox RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3948,name:"MenoXD RPEGG",price:75e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Meno",tags:["JulyM23","Red","Black","xd"]},is_available:!0,unlock:"purchase"},{id:3949,name:"Kart RPEGG",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Kart",tags:["Kart","Aug23","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3950,name:"Thee_Owl RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_TheeOwl",tags:["Drops5","AugM23","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3951,name:"Fusion RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Fusion",tags:["Oct23","Premium","Blue","White","Gray","Grey","bun_borg"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_rpegg_fusion"]},{id:3952,name:"Skellington RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Skeleton",tags:["OctM23","Premium","Black","White","Oct24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_rpegg_skele"]},{id:3953,name:"Ancient RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3954,name:"Holideggs RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3955,name:"2024 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:3956,name:"Racer RPEGG",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3687,name:"Broken item - do not use",price:5e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Pickles",tags:["JunM24","Food","Green","Nobby"]},is_available:!1,unlock:"purchase"},{id:3957,name:"Chubby Pickle RPEGG",price:5e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Pickles",tags:["JunM24","Food","Green","Nobby"]},is_available:!0,unlock:"purchase"},{id:3958,name:"Infernal RPEGG",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Infernal",tags:["AugM24","Infernal","Black","Red","Orange"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_rpegg_infernal"]},{id:3959,name:"Spore RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3960,name:"2025 RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3961,name:"The BFG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_BFG",tags:["DecM24","NewYears","Premium","Big Festive Gun"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_rpegg_bfg"]},{id:3962,name:"BWD RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Wizard",tags:["FebM25","Drops7","D7W1"]},is_available:!1,unlock:"manual"},{id:3963,name:"The Bouzouki",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bouzouki",tags:["Mar25","StPatrickDay","Bundle"]},is_available:!1,unlock:"premium"},{id:3964,name:"Golden Dragon RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:4e3,name:"The Whipper",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg",tags:["default","Grey","Gray","Purple"]},is_available:!0,unlock:"default"},{id:4001,name:"GOLD Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4002,name:"Happy Bear Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4003,name:"Halloween Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:4004,name:"Thanksgiving Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:4005,name:"Christmas Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:4006,name:"Timewarp 2019 Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:4007,name:"Groundhog Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:4008,name:"Buck Rogers Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4009,name:"Valentines Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:4010,name:"St Patricks Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:4011,name:"Easter Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Easter",tags:["Easter","Eggs","Purple","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:4012,name:"Flame Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:4013,name:"Rainbow Whipper",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4014,name:"Steampunk Whipper",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4015,name:"Memphis Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Memphis",tags:["Memphis","White","Black","Pink"]},is_available:!0,unlock:"purchase"},{id:4016,name:"Eggwalker Whipper",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:4017,name:"Nuke Zone Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NukeZone",tags:["NukeZone","Red","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:4018,name:"2020 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:4019,name:"Country Singer Whipper",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4020,name:"Albino Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4021,name:"Raid Land Whipper",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_RaidLand",tags:["RaidLand","Blue","JulyM24"]},is_available:!1,unlock:"purchase"},{id:4022,name:"Toxic Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4023,name:"Music Whipper",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Music",tags:["Rockstar","JanM23","Red","Orange","Keytar","Piano","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:4024,name:"Galeggsy Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:4025,name:"Chicken Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:4026,name:"Techno Whipper",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Techno",tags:["Techno","AugM23","Tuh","Green","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_techno"]},{id:4027,name:"2021 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:4028,name:"Car Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_car",tags:["Cars","Trains","Purple"]},is_available:!0,unlock:"purchase"},{id:4029,name:"Merc Zone Whipper",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Merc",tags:["Merc","Suit","Black","Tie","Purple"]},is_available:!0,unlock:"purchase"},{id:4030,name:"Summer Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:4031,name:"Pencil Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Pencil",tags:["Pencil","Sep23","Yellow","Crayons","Sep24"]},is_available:!1,unlock:"purchase"},{id:4032,name:"Retro Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Retro",tags:["Retro","Nov23","Pixel","Purple","Wings","JanM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_retro"]},{id:4033,name:"2022 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4034,name:"Cards Whipper",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4035,name:"Dino Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Dino",tags:["Dino","May23","Blue","Yellow","AugM24"]},is_available:!1,unlock:"purchase"},{id:4036,name:"Eggpire Whipper",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4037,name:"SPORTS Whipper",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Sports",tags:["Sports","JulyM23","Red","Brown","Badminton","JunM24"]},is_available:!1,unlock:"purchase"},{id:4038,name:"Breakfast Whipper",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Breakfast",tags:["Breakfast","Food","Brown","Red","Eggs","Bacon","MayM24"]},is_available:!1,unlock:"purchase"},{id:4039,name:"Teggtris Whipper",price:1980,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Teggtris",tags:["Sep22","Mar23","Red","Orange","Yellow","Blue","Grey","Gray","Tetris","GameBoy","AprM24","bun_gamer","FebM25"]},is_available:!1,unlock:"purchase"},{id:4040,name:"Turkey-Supreme Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SpecialTurkey",tags:["NovM23","Thanksgiving","Brown","Yellow","NovM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_turk"]},{id:4041,name:"2023 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4042,name:"Valkyrie Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_valk"]},{id:4043,name:"The Pea90",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Farm",tags:["Farm","FebM23","Food","Green","Peas","May24"]},is_available:!1,unlock:"purchase"},{id:4044,name:"Fusion Whipper",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Fusion",tags:["Premium"," Fusion","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_smg_fusion"]},{id:4045,name:"Eggflation Whipper",price:8e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Eggflation",tags:["Eggflation","MayM23","Gold","Yellow","Eggs"]},is_available:!0,unlock:"purchase"},{id:4046,name:"Equinox Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:4047,name:"Kart Whipper",price:3500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Kart",tags:["Kart","Aug23","Pink","Yellow","Princess","Peach"]},is_available:!1,unlock:"purchase"},{id:4048,name:"KJDCitsme Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_KJ",tags:["Drops5","AugM23","Pink","Purple","Blue"]},is_available:!1,unlock:"manual"},{id:4049,name:"Wrestle Bros Whipper",price:3500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Wrestlebros",tags:["WBros","SepM23","Gold","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:4050,name:"Ancient Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4051,name:"Holideggs Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4052,name:"2024 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!1,unlock:"purchase"},{id:4053,name:"Racer Whipper",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4054,name:"Infernal Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Infernal",tags:["MayM24","Infernal","Red","Orange","Black"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_smg_infernal"]},{id:4055,name:"Jack O' Lantern Whipper",price:6,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Pumpkin",tags:["OctM24","Halloween5","Red","Orange","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_smg_jack"]},{id:4056,name:"Spore Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:4057,name:"2025 Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:4058,name:"Irish Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Irish",tags:["Mar25","StPatrickDay","Green"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_smg_irish"]},{id:4059,name:"Golden Dragon Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:4200,name:"The Crackshot",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24",tags:["default","Blue","Grey","Gray"]},is_available:!0,unlock:"default"},{id:4201,name:"GOLD Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4202,name:"Happy Bear Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4203,name:"Halloween Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:4204,name:"Thanksgiving Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:4205,name:"Christmas Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:4206,name:"Timewarp 2019 Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:4207,name:"Groundhog Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:4208,name:"Buck Rogers Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4209,name:"Valentines Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:4210,name:"St Patricks Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:4211,name:"Easter Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Easter",tags:["Easter","Eggs","Green","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:4212,name:"Flame Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:4213,name:"Rainbow Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4214,name:"Steampunk Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4215,name:"Memphis Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Memphis",tags:["Memphis","Yellow","Black","White"]},is_available:!0,unlock:"purchase"},{id:4216,name:"Eggwalker Crackshot",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:4217,name:"Nuke Zone Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NukeZone",tags:["NukeZone","Black","Purple","Neon"]},is_available:!0,unlock:"purchase"},{id:4218,name:"2020 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:4219,name:"Country Singer Crackshot",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4220,name:"Albino Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4221,name:"Raid Land Crackshot",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_RaidLand",tags:["RaidLand","May23","Purple","Brown"]},is_available:!1,unlock:"purchase"},{id:4222,name:"Toxic Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4223,name:"Techno Crackshot",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Techno",tags:["Premium","MayM23","Untz","Pink","Blue","Purple","July24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_techno"]},{id:4224,name:"Music Crackshot",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Music",tags:["Rockstar","JanM23","Red","Guitar","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:4225,name:"Galeggsy Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:4226,name:"Chicken Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:4227,name:"2021 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:4228,name:"Car Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_car",tags:["Cars","Trains","Blue","White","Limosine"]},is_available:!0,unlock:"purchase"},{id:4229,name:"Retro Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Retro",tags:["Retro","Premium","Pixel","Blue","Wings","Aug24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_retro"]},{id:4230,name:"Merc Zone Crackshot",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Merc",tags:["Merc","Suit","Black","Tie","Blue","Teal"]},is_available:!0,unlock:"purchase"},{id:4231,name:"Summer Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:4232,name:"Pencil Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Pencil",tags:["Pencil","Sep23","Yellow","Stapler","Sep24"]},is_available:!1,unlock:"purchase"},{id:4233,name:"2022 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4234,name:"Graysocean Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Graysocean",tags:["Drops","Blue"]},is_available:!1,unlock:"manual"},{id:4235,name:"Cards Crackshot",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4236,name:"Dino Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Dino",tags:["Dino","May23","Brown","AugM24"]},is_available:!1,unlock:"purchase"},{id:4237,name:"Eggpire Crackshot",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4238,name:"SPORTS Crackshot",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Sports",tags:["Sports","JulyM23","Silver","Golf","Clubs","JunM24"]},is_available:!1,unlock:"purchase"},{id:4239,name:"Breakfast Crackshot",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Breakfast",tags:["Breakfast","Food","Fork","Red","Grey","Gray","MayM24"]},is_available:!1,unlock:"purchase"},{id:4240,name:"Scavenger Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Scavenger",tags:["Scavenger","Premium","Black","White","OctM23","bun_tactic","Telescope","FebM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_scav"]},{id:4241,name:"BWD Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Wizard",tags:["Sep22","Drops3","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:4242,name:"Valkyrie Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_valk"]},{id:4243,name:"2023 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4244,name:"Farm Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Farm",tags:["Farm","FebM23","Food","Green","Asparagus","May24"]},is_available:!1,unlock:"purchase"},{id:4245,name:"MenoXD Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Meno",tags:["Drops4","Mar23","Red","Black","xd"]},is_available:!1,unlock:"manual"},{id:4246,name:"Equinox Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:4247,name:"Kart Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Kart",tags:["Kart","Aug23","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:4248,name:"The Fusion Crackshot",price:6,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Fusion",tags:["Fusion","SepM23","Blue","White","Black"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_fusion"]},{id:4249,name:"The Pablo Rifle",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Badegg",tags:["Badegg","Premium","Yellow","Brown","Grey","Gray"]},is_available:!1,unlock:"premium"},{id:4250,name:"Ancient Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4251,name:"Holideggs Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4252,name:"2024 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2024",tags:["DecM23","NewYears","2024","White","Blue"]},is_available:!1,unlock:"purchase"},{id:4253,name:"Infernal Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Infernal",tags:["DecM23","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_infernal"]},{id:4254,name:"Racer Crackshot",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4255,name:"Wooden Grove Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Grove",tags:["Feb24","Newsletter","Wood","Brown"]},is_available:!1,unlock:"manual"},{id:4256,name:"Cyborg Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Cyborg",tags:["Apr24","RotR","Robot","Grey","EGGORG","Apr25","premFeatTwo"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_cyborg"]},{id:4257,name:"K4hhny Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_K4nny",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:4258,name:"The Quackshot",price:4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Quackshot",tags:["May24","Duck","Crackshot"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_m24_quack"]},{id:4259,name:"Praying Mantis Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Bugs",tags:["Jun24","Bugs","Green"]},is_available:!1,unlock:"purchase"},{id:4260,name:"The Checkmate Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Chess",tags:["July24","Chess","Black","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_m24_chess"]},{id:4261,name:"Bone Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Bones",tags:["Oct24","Halloween5","White"]},is_available:!1,unlock:"purchase"},{id:4262,name:"Spore Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:4263,name:"2025 Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:4264,name:"Golden Dragon Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:16e3,name:"Grenade",price:0,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade",tags:["default","green"]},is_available:!0,unlock:"default"},{id:16001,name:"GOLD Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:16002,name:"Happy Bear Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:16003,name:"Rainbow Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Rainbow",tags:["boom","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:16004,name:"Steampunk Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:16005,name:"Memphis Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Memphis",tags:["Memphis","pink","blue"]},is_available:!0,unlock:"purchase"},{id:16006,name:"Nuke Zone Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NukeZone",tags:["NukeZone","Green","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:16007,name:"Country Singer Grenade",price:1e5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:16008,name:"Raid Land Grenade",price:6500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaidLand",tags:["SepM23","brown"]},is_available:!1,unlock:"purchase"},{id:16009,name:"Toxic Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:16010,name:"Albino Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_SnakeAlbino",tags:["countrysinger","EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:16011,name:"Holy Hand Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Holy",tags:["Premium","vipItem","Blue","Yellow"],sound:"grenade_holy",cell:3,smokeColors:"white",fireColors:"gold"},is_available:!1,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"]},{id:16012,name:"Groundhog Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Groundhog",tags:["Groundhog","Feb23","Brown","Smile","Feb24"]},is_available:!1,unlock:"purchase"},{id:16013,name:"Corrupted Grenade",price:75e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Corrupted",tags:["Brown","Eye"],sound:"grenade_corrupt",cell:4,smokeColors:"corrupt",fireColors:"corrupt"},is_available:!0,unlock:"purchase"},{id:16014,name:"Skullnado Grenade",price:7,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Skull",tags:["SepM23","OctM23","White","Halloween","Oct24"],sound:"grenade_skullnado",cell:2,smokeColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_skullnado"]},{id:16015,name:"St Patricks Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:16016,name:"Easter Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Easter",tags:["Easter","Blue","Pink","Eggs","MarM24","bun_badbunny","MarM25"]},is_available:!0,unlock:"purchase"},{id:16017,name:"Pablo Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Pablo",tags:["Brown","Yellow","Hat","Smile"]},is_available:!0,unlock:"purchase"},{id:16018,name:"Diablo Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Diablo",tags:["EGGORG","Apr23","Brown","Frown","Apr25"]},is_available:!0,unlock:"purchase"},{id:16019,name:"Unicorn Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Unicorn",tags:["FebM23","Sep23","Pink","Nov24"],sound:"grenade_unicorn",cell:1,smokeColors:"white",fireColors:"rainbow"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_unicorn"]},{id:16020,name:"Phone Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Phone",tags:["Mobile","Fire","Red"],sound:"grenade_cellphone",cell:5,smokeColors:"white"},is_available:!1,unlock:"manual"},{id:16021,name:"Merc Zone Grenade",price:7e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Merc",tags:["Merc","Suit","Black","Tie"]},is_available:!0,unlock:"purchase"},{id:16022,name:"The Coconut Punch",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Coconut",tags:["Summer","JunM23","Food","Brown","Drink","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:16023,name:"Toilet Paper Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_ToiletPaper",tags:["Premium","AugM23","Poop","White","bun_toilet"],sound:"grenade_tp",cell:6,smokeColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_toilet_papr"]},{id:16024,name:"Buck Rogers Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:16025,name:"Galeggsy Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:16026,name:"ChantiGG Booth Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Booth",tags:["Chantigg","Red","Phone"]},is_available:!0,unlock:"purchase"},{id:16027,name:"Glitterbomb Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Glitterbomb",tags:["Pencil","Premium","Pink","Disco","JanM25"],sound:"grenade_glitterbomb",smokeColors:"white",fireColors:"gold",cell:7},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_glitterbomb"]},{id:16028,name:"Apple Grenade",price:750,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Apple",tags:["Pencil","Sep23","Red","Food","MayM24","Sep24"]},is_available:!1,unlock:"purchase"},{id:16029,name:"Chickaletta Grenade",price:1250,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Wero",tags:["Wero","Chicken","Yellow"]},is_available:!0,unlock:"purchase"},{id:16030,name:"Halloween Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Halloween",tags:["Halloween","Oct23","Pumpkin","Jack","Orange","Smile","Oct24"]},is_available:!1,unlock:"purchase"},{id:16031,name:"Thanksgiving Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Turkey",tags:["NovM23","Thanksgiving","Eye","Yellow","NovM24"]},is_available:!1,unlock:"purchase"},{id:16032,name:"Thermal Detonator Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Thermal",tags:["Premium","JunM23","Red","Black"],sound:"grenade_thermal",cell:8,smokeColors:"thermal",fireColors:"thermal"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_thermal"]},{id:16033,name:"Christmas Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Present",tags:["Christmas2","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:16034,name:"Eggs of Legends Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Crystal",tags:["Eggteam","Blue","Lol","bun_zorg"]},is_available:!0,unlock:"purchase"},{id:16035,name:"2022 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:16036,name:"Techno Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Supernova",tags:["AprM23","Rainbow","White","JanM24","Aug24"],sound:"grenade_supernova",cell:9,smokeColors:"supernova",fireColors:"thermal"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_supernova"]},{id:16037,name:"Valentines Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Valentines",tags:["Valentines","Heart","Red","bun_cupid","Feb25"]},is_available:!1,unlock:"purchase"},{id:16038,name:"Octopus Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Octopus",tags:["May23","Oct23","White","Cute","Feb24"],sound:"grenade_octopus",cell:10,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_octopus"]},{id:16039,name:"Basket Bros Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_BBros",tags:["Premium","BBros","Orange"],sound:"grenade_bbros",cell:11,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"manual"},{id:16040,name:"Cards Grenade",price:1520,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:16041,name:"Diablo Cannonball",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_DiabloCannon",tags:["Mar23","EGGORG","Blue","Face","Apr24","Apr25","premFeatTwo"],sound:"grenade_diablocannon",cell:12,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_diablo"]},{id:16042,name:"Yoyo Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Yoyo",tags:["Relic","Drops2","Blue","White"]},is_available:!1,unlock:"manual"},{id:16043,name:"Dino Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Dino",tags:["Dino","May23","Orange","AugM24"]},is_available:!1,unlock:"purchase"},{id:16044,name:"Bumblebee Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Bee",tags:["Premium","Summer","Mar23","Yellow","Black","Cute","Jun24","bun_plant"],sound:"grenade_bees",cell:13,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_bumble"]},{id:16045,name:"Soccer Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Soccer",tags:["Sports","JulyM23","Black","White","FebM24","JunM24"]},is_available:!1,unlock:"purchase"},{id:16046,name:"Football Helmet Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Football",tags:["Premium","Sports","JulyM23","Red","JunM24","Fbros","SepM24"],sound:"grenade_football",cell:14,smokeColors:"softblack",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_football"]},{id:16047,name:"Unhatched Chicken Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Chicken",tags:["Chicken","Eggs","MayM24"]},is_available:!1,unlock:"purchase"},{id:16048,name:"Valkyrie Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"],sound:"grenade_valkyrie",cell:15,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_valk"]},{id:16049,name:"Milk Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Milk",tags:["Premium","Breakfast","MayM23","Pink","Food","May24","Sep24"],sound:"grenade_milk",cell:16,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_milk"]},{id:16050,name:"Breakfast Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Breakfast",tags:["Breakfast","Food","Eggs","Bacon","MayM24"]},is_available:!1,unlock:"purchase"},{id:16051,name:"Eyeball Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Eyeball",tags:["Scavenger","AugM23","Blue"]},is_available:!1,unlock:"purchase"},{id:16052,name:"Padlock Grenade",price:4200,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Padlock",tags:["Pencil2","Sep23","Grey","Gray","Locker","Sep24"]},is_available:!1,unlock:"purchase"},{id:16053,name:"Barrel Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Barrel",tags:["Sep22","Mar23","Brown"]},is_available:!1,unlock:"purchase"},{id:16054,name:"Bloodonade Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Blood",tags:["Premium","Halloween3","Red","DecM23","bun_arach","bun_demon","OctM24"],sound:"grenade_bloodonade",cell:17,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_blood"]},{id:16055,name:"Nutcracker Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Nutcracker",tags:["Christmas2","Red","White","Face","Dec24"]},is_available:!1,unlock:"purchase"},{id:16056,name:"2023 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2023",tags:["NewYears","2023","Red","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:16057,name:"Tambourine Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Tambourine",tags:["Rockstar","JanM23","Aug23","Music","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:16058,name:"Blue Shell Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Turtle",tags:["Community","BWD"],sound:"grenade_blueshell",cell:20,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"manual"},{id:16059,name:"Slop Bucket Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Pail",tags:["Premium","farm","FebM23","Food","May24"],sound:"grenade_milkbucket",cell:16,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_pail"]},{id:16060,name:"Green Shell Grenade",price:3500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TurtleGreen",tags:["Kart","AprM23","Turtle","AugM24"]},is_available:!1,unlock:"purchase"},{id:16061,name:"Red Shell Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TurtleRed",tags:["Kart","AprM23","Turtle","JanM24","AugM24"]},is_available:!1,unlock:"purchase"},{id:16062,name:"Equinox Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","bun_mayan","JanM25"]},is_available:!1,unlock:"purchase"},{id:16063,name:"Kart Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Kart",tags:["Kart","Aug23","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:16064,name:"Timebomb Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Timebomb",tags:["Kart","Aug23","Blue","Yellow","AugM24"],sound:"grenade_Timebomb",cell:18,smokeColors:"blue",fireColors:"blue"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_timebomb"]},{id:16065,name:"Luchador Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Luchador",tags:["WBros","SepM23","Wrestle","Face"]},is_available:!1,unlock:"purchase"},{id:16066,name:"Smooth Brain Grenade",price:2100,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Brain",tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:16067,name:"Ancient Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:16068,name:"Holideggs Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:16069,name:"2024 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:16070,name:"Racer Frag Grenade",price:25e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaceCarFrag",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:16071,name:"Rogue Tire Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaceCarPremium",tags:["JanM24","Black","Text","Pireggi"],sound:"grenade_tire",cell:21,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!1,sku:["item_gre_racecar"]},{id:16074,name:"Fusion Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Fusion",tags:["FebM23","White"],sound:"grenade_fusion",cell:22,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_fusion"]},{id:16078,name:"Mecha-Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Steambot",tags:["Apr24","RotR","Robots","White","bun_borg"],sound:"grenade_Steambot",cell:12,smokeColors:"black",fireColors:"red"},is_available:!1,unlock:"premium"},{id:16079,name:"Novosuper Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Novo",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:16080,name:"The Fly Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Fly",tags:["Jun24","Bugs"]},is_available:!1,unlock:"purchase"},{id:16081,name:"Mort Face Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Mort",tags:["Sep24","EggyP"],sound:"grenade_mort",cell:23,smokeColors:"default",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_mort"]},{id:16082,name:"Infernal Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Infernal",tags:["SepM24","Red","Orange","Black"],sound:"grenade_infernal",cell:22,smokeColors:"default",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_infernal"]},{id:16083,name:"Rest in Peaces Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Dove",tags:["Oct24","White","Bird","bun_dove"],sound:"grenade_Dove",cell:24,smokeColors:"default",fireColors:"default"},is_available:!1,unlock:"premium"},{id:16084,name:"Spore Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:16085,name:"Cool Whip Grenade",price:25e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Whip",tags:["NovM24","Gray","Perm","Premium","eggyp"],sound:"grenade_Whip",cell:25,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"purchase"},{id:16086,name:"Eggsmas Present",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_ChristmasGift",tags:["Dec24","Christmas4","Red","Gold","Newsletter"]},is_available:!1,unlock:"manual"},{id:16087,name:"2025 Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:16088,name:"Kettlebell Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Kettlebell",tags:["JanM25","80KG","Black","Text","80KG"],sound:"grenade_Kettlebell",smokeColors:"black",fireColors:"Red",cell:8},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_kettleb"]},{id:16089,name:"Can of Worms Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Worms",tags:["Feb25","Text","Bait","Pink","Yellow","Grey","Gray","Silver"],sound:"grenade_worms",smokeColors:"default",fireColors:"default",cell:26},is_available:!1,unlock:"premium"},{id:16090,name:"Thee_Owl Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TheeOwl",tags:["FebM25","Drops7","D7W1"]},is_available:!1,unlock:"manual"},{id:16091,name:"Green Snack Grenade",price:1500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_greenSnack",tags:["Apr25","EGGORG","Shadows","Green","Food","Rice"]},is_available:!0,unlock:"purchase"},{id:4500,name:"The Tri-Hard",price:0,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug",tags:["Default","Red"]},is_available:!0,unlock:"default"},{id:4501,name:"GOLD Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4502,name:"Happy Bear Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4503,name:"Rainbow Tri-Hard",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Rainbow",tags:["White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4504,name:"Steampunk Tri-Hard",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Steampunk",tags:["Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4505,name:"Memphis Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Memphis",tags:["Memphis","Black","Green"]},is_available:!0,unlock:"purchase"},{id:4506,name:"Nuke Zone Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NukeZone",tags:["Purple","Blue","Black","Blurple","Neon"]},is_available:!0,unlock:"purchase"},{id:4507,name:"Country Singer Tri-Hard",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4508,name:"Raid Land Tri-Hard",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_RaidLand",tags:["RaidLand","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:4509,name:"Toxic Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4510,name:"Albino Snake Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4511,name:"St Patricks Day Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Yellow","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:4512,name:"Retro Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Retro",tags:["Retro","Premium","Sep23","Red","Green","Pixel","Wings"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_aug_retro"]},{id:4513,name:"Easter Tri-Hard",price:1e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Easter",tags:["Easter","JunM23","Green","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:4514,name:"Car Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_car",tags:["Cars","Trains","Truck","Green","Red","Yellow"]},is_available:!0,unlock:"purchase"},{id:4515,name:"Merc Zone Tri-Hard",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Merc",tags:["Merc","Suit","Pink","Black"]},is_available:!0,unlock:"purchase"},{id:4516,name:"Summer Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:4517,name:"Buck Rogers Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4518,name:"Galeggsy Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:4519,name:"Pencil Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Pencil",tags:["Pencil","Sep23","Smile","Yellow","Blue","Scissors","Sep24"]},is_available:!1,unlock:"purchase"},{id:4520,name:"Halloween Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:4521,name:"Thanksgiving Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:4522,name:"Christmas Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:4523,name:"2022 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4524,name:"ChantiGG Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Chantigg",tags:["Drops","Red","Phone","Booth"]},is_available:!1,unlock:"manual"},{id:4525,name:"Valentines Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:4526,name:"Kawaii Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cutesy",tags:["Kawaii","Pink","Yellow","Blue"]},is_available:!0,unlock:"purchase"},{id:4527,name:"Cards Tri-Hard",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4528,name:"Valkyrie Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_valk_aug"]},{id:4529,name:"Dino Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Dino",tags:["Dino","May23","Orange","AugM24"]},is_available:!1,unlock:"purchase"},{id:4530,name:"Eggpire Tri-Hard",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4531,name:"SPORTS Tri-Hard",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Sports",tags:["Sports","JulyM23","Green","Blue","Tennis","JunM24"]},is_available:!1,unlock:"purchase"},{id:4532,name:"Chicken Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:4533,name:"Breakfast Tri-Hard",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Breakfast",tags:["Breakfast","Food","Spoon","Red","Grey","Gray","MayM24"]},is_available:!1,unlock:"purchase"},{id:4534,name:"Bone Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Bones",tags:["Halloween3","OctM23","Oct24"]},is_available:!1,unlock:"purchase"},{id:4535,name:"2023 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4536,name:"Music Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Music",tags:["Rockstar","JanM23","Gold","Yellow","Saxaphone","Saxamaphone","SepM24","Mar25"]},is_available:!1,unlock:"purchase"},{id:4537,name:"Groundhog Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:4538,name:"Farm Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Farm",tags:["Farm","FebM23","Food","Red","Yellow","Orange","Peppers","May24"]},is_available:!1,unlock:"purchase"},{id:4539,name:"Equinox Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:4540,name:"Fusion Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Fusion",tags:["Premium","Fusion","JulyM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_aug_fusion"]},{id:4541,name:"Kart Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Kart",tags:["Kart","Aug23","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:4542,name:"Ancient Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4543,name:"Holideggs Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4544,name:"2024 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!1,unlock:"purchase"},{id:4545,name:"Racer Tri-Hard",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4546,name:"Cupid Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cupid",tags:["Feb24","White","Orange","Grey","Gray","bun_cupid"]},is_available:!1,unlock:"premium"},{id:4547,name:"Green Snake Tri-Hard",price:15e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SnakePatrick",tags:["Mar24","White","StPatricksDay","Green","Grey","Gray","Albino","Mar25"]},is_available:!1,unlock:"purchase"},{id:4548,name:"Flame Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Flames",tags:["Mar24","Fire","Brown","Orange"]},is_available:!1,unlock:"manual"},{id:4549,name:"King Hayden Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Hayden",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:4550,name:"Infernal Tri-hard",price:3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Infernal",tags:["AprM24","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_aug_infernal"]},{id:4551,name:"Spore Tri-hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:4552,name:"The Pumpkin Pie-hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Pumpkinpie",tags:["NovM24","Thanksgiving4"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_aug_pie"]},{id:4553,name:"2025 Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:4554,name:"Techno Tri-Hard",price:10,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Techno",tags:["FebM25"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_aug_techno"]},{id:4555,name:"Golden Dragon Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:15e3,name:"The Whisk Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"whisk",tags:["Silver"]},is_available:!0,unlock:"default"},{id:15001,name:"Corn Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_corn",tags:["Yellow","Green","Food","Meme"]},is_available:!0,unlock:"default"},{id:15002,name:"Club Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_stick",tags:["Brown","bun_plant","Stick","Wood"]},is_available:!0,unlock:"default"},{id:15003,name:"GOLD Melee",price:2500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_gold",tags:["Brown","Gold","Whisk"]},is_available:!0,unlock:"purchase"},{id:15004,name:"Pink Bear Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_bear",tags:["Pink","Cute","Heart","Whisk"]},is_available:!0,unlock:"purchase"},{id:15005,name:"Steampunk Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_steampunk",tags:["Brown","Gold","Whisk"]},is_available:!0,unlock:"purchase"},{id:15006,name:"Rainbow Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rainbow",tags:["Red","Orange","Yellow","Green","Blue","Clouds","Whisk"]},is_available:!0,unlock:"purchase"},{id:15007,name:"Memphis Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_memphis",tags:["Black","White","Rainbow","Whisk"]},is_available:!0,unlock:"purchase"},{id:15008,name:"Toxic Melee",price:15e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_toxic",tags:["Pipe","Green","Black","bun_arach"]},is_available:!0,unlock:"purchase"},{id:15009,name:"Car Melee",price:2e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_shift",tags:["Black","Silver","Gear"]},is_available:!0,unlock:"purchase"},{id:15010,name:"Brown Snake Melee",price:1e5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_snake",tags:["Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:15011,name:"Hoe Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hoe",tags:["FebM23","farm","Tools","May24"]},is_available:!1,unlock:"purchase"},{id:15012,name:"Flame Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_flame",tags:["Orange","Yellow","Fire"]},is_available:!1,unlock:"manual"},{id:15013,name:"Valkyrie Melee",price:6,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_valkyrie",tags:["Gold","Blue","Yellow","Premium"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_valk"]},{id:15014,name:"BWD Wizard Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wizard",tags:["Drops4","Mar23","Blue","Brown","Staff"]},is_available:!1,unlock:"manual"},{id:15015,name:"Sneaker Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_sneaker",tags:["BBros","MarM23","White","Blue","Shoe"]},is_available:!1,unlock:"purchase"},{id:15016,name:"Fiddle Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fiddle",tags:["StPatricksDay","MarM23","Music","Brown","Mar24","Mar25"]},is_available:!1,unlock:"purchase"},{id:15017,name:"Medieval Key Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mediKey",tags:["Apr23","Newsletter","Gold","Yellow"]},is_available:!1,unlock:"manual"},{id:15018,name:"Galeggsy Whisk",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_galaxy",tags:["AprM23","Galeggsy","Blue","Purple","Planets","OctM23","Aug24"]},is_available:!1,unlock:"purchase"},{id:15019,name:"Giant Spoon Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_spoon",tags:["AprM23","Silver","Food","MayM24"]},is_available:!1,unlock:"purchase"},{id:15020,name:"Albino Snake Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_albino",tags:["Giveaway","White","ABHS","Snek"]},is_available:!1,unlock:"manual"},{id:15021,name:"Forkin' Fork! Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fork",tags:["Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15022,name:"Bone Bonker",price:4500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_bone",tags:["May23","Dino2","Caveman","AugM24"]},is_available:!1,unlock:"purchase"},{id:15023,name:"Stone Hammer Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rock",tags:["May23","Nov23","Dino2","Grey","Gray","AugM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_melee_stone"]},{id:15024,name:"Eggflation Whisk",price:8e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_eggflation",tags:["MayM23","Eggflation","Gold","Yellow","80k"]},is_available:!0,unlock:"purchase"},{id:15025,name:"Butterknife Melee",price:6500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_butterknife",tags:["MayM23","Eggflation","Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15026,name:"Shellfie Stick Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_selfiestick",tags:["Jun23","Photo","Cheese"]},is_available:!1,unlock:"purchase"},{id:15027,name:"Spatula Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_spatula",tags:["Jun23","Silver"]},is_available:!0,unlock:"purchase"},{id:15028,name:"Popsicle Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_popsicle",tags:["JunM23","Summer2","Pink","Food"]},is_available:!1,unlock:"purchase"},{id:15029,name:"Wrench Melee",price:4500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wrench",tags:["JunM23","Summer2","Blue","Yellow","Tools"]},is_available:!1,unlock:"purchase"},{id:15030,name:"Fusion Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fusion",tags:["JunM23","Blue","White","Gray","Grey"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_fusion"]},{id:15031,name:"Equinox Melee",price:3e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_equinox",tags:["July23","Equinox","Blue","Yellow","Sun","Moon","Whisk","JanM25"]},is_available:!1,unlock:"purchase"},{id:15032,name:"Crowbar Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_crowbar",tags:["July23","Blue","Yellow","Red","Tools"]},is_available:!0,unlock:"purchase"},{id:15033,name:"Hockey Melee",price:8e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hockey",tags:["JulyM23","Sports2","Stick"]},is_available:!1,unlock:"purchase"},{id:15034,name:"Shovel Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_shovel",tags:["JulyM23","Pink","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:15035,name:"MenoXD Katana",price:125e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_meno",tags:["JulyM23","Red","Black"]},is_available:!0,unlock:"purchase"},{id:15036,name:"Kart Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_kart",tags:["Aug23","Kart","Red","Blue","Whisk"]},is_available:!1,unlock:"purchase"},{id:15037,name:"Harrison Cat Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_harrison",tags:["AugM23","Drops5","Black","White","Cat","FebM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_melee_cat"]},{id:15039,name:"Ruler Melee",price:6500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ruler",tags:["Sep23","Pencil3","Brown"]},is_available:!1,unlock:"purchase"},{id:15040,name:"Fighting Fish Slapper",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fish",tags:["Sep23","bun_cat","Food","eyes"]},is_available:!1,unlock:"premium"},{id:15041,name:"Folding Chair Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_chair",tags:["SepM23","WBros","Wrestle","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:15042,name:"Pitchfork Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_devil",tags:["Oct23","Halloween4","Red","Black"]},is_available:!1,unlock:"purchase"},{id:15043,name:"Rolling Pin Whalloper",price:8e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rollingpin",tags:["Oct23","Brown"]},is_available:!0,unlock:"purchase"},{id:15044,name:"Ancient Club",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ruins",tags:["Nov23","Green","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:15045,name:"Mayan Macuahuitl",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mayan",tags:["Nov23","Red","Black","Brown","bun_mayan"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_mayan"]},{id:15046,name:"Turkey Drumstick",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_drumstick",tags:["NovM23","Red","Black","Brown"]},is_available:!1,unlock:"purchase"},{id:15047,name:"The Turkey Carver",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_carver",tags:["NovM23","Blue","Black","Gas","NovM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_melee_turkcar"]},{id:15048,name:"The Candy Cane-r",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_candycane",tags:["Dec23","Blue","Black","Gas"]},is_available:!1,unlock:"purchase"},{id:15049,name:"Elf on a Shelf Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_elf",tags:["Dec23","Blue","Black","Gas","bun_mistle"]},is_available:!1,unlock:"premium"},{id:15050,name:"2024 Whisk",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_newyear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:15051,name:"Racer Lug Wrench",price:5e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_lugwrench",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:15052,name:"Groundhog Melee",price:7e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_groundhog",tags:["Feb24","Groundhog","White","Orange","Grey","Gray","Feb24"]},is_available:!1,unlock:"purchase"},{id:15053,name:"Buck Rogers Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_buck",tags:["Jan24","White","Orange","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:15054,name:"Vuvuzela Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_vuvuzela",tags:["FebM24","White","Orange","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:15055,name:"World Cup Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_cup",tags:["FebM24","Gold","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_worldcup"]},{id:15056,name:"Chocolate Bunny Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_chocolatebun",tags:["MarM24","Rabbit","Brown","Easter","Gold","MarM25"]},is_available:!0,unlock:"purchase"},{id:15057,name:"Mecha-Hammer",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_steambot",tags:["Apr24","Robot","RotR"]},is_available:!1,unlock:"premium"},{id:15058,name:"Robo-Wrench",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_steamwrench",tags:["Apr24","Robot","RotR"]},is_available:!1,unlock:"purchase"},{id:15059,name:"Thee_Owl Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_theeowl",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:15060,name:"Goldfish Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_gfish",tags:["AprM24","Orange"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_gfish"]},{id:15061,name:"Plunger Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_plunger",tags:["May24","Red","Wood","Toilet","bun_toilet"]},is_available:!1,unlock:"premium"},{id:15062,name:"Army Ant  Melee",price:15e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ant",tags:["Jun24","Bugs"]},is_available:!1,unlock:"purchase"},{id:15063,name:"Infernal Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_infernal",tags:["JunM24","Red","Orange"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_infernal"]},{id:15064,name:"Pickleball Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_pickleball",tags:["JunM24"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_pball"]},{id:15065,name:"Chess Board Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_chess",tags:["July24","Chess","Checkerboard","Black","White"]},is_available:!1,unlock:"purchase"},{id:15066,name:"Techno Melee",price:10,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_techno",tags:["JulyM24","Techno","Premium","Purple","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_techno"]},{id:15067,name:"Jawbone Melee",price:2e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_jawbone",tags:["AugM24","Dino","AugM24"]},is_available:!1,unlock:"purchase"},{id:15068,name:"The Elder Wand",price:5e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wand",tags:["Sep24","EggyP"]},is_available:!1,unlock:"purchase"},{id:15069,name:"Broomstick Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_broom",tags:["Sep24","EggyP"]},is_available:!1,unlock:"purchase"},{id:15070,name:"Keytar Melee",price:3e5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_keytar",tags:["SepM24","Perm","Premium","Music","SepM24","eggyp"]},is_available:!0,unlock:"purchase"},{id:15071,name:"Halloween Melee",price:5e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_halloween",tags:["OctM24","Halloween5"]},is_available:!1,unlock:"purchase"},{id:15072,name:"Frying Pan Melee",price:1,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fryingpan",tags:["OctM24","Perm","Permanent"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_pan"]},{id:15073,name:"Butcher Knife Melee",price:125e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_butcher",tags:["Nov24","SC2"]},is_available:!1,unlock:"purchase"},{id:15074,name:"Let Them Cook Melee",price:2,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_eggpan",tags:["Nov24","Perm"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_panegg"]},{id:15075,name:"Monster Hand Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_zombiehand",tags:["OctM24","Bundle"]},is_available:!1,unlock:"premium"},{id:15077,name:"Big Kahuna Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_properfish",tags:["NovM24","Select","Community","BWD"]},is_available:!1,unlock:"premium"},{id:15078,name:"Spore Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:15079,name:"mistake",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_frostfall",tags:["null"]},is_available:!1,unlock:"premium"},{id:15080,name:"Eggsmas Bell Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_christmasbell",tags:["Dec24","Christmas4","Gold","Yellow","Brown","Red"]},is_available:!1,unlock:"purchase"},{id:15081,name:"Nutcracker Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_nutcracker",tags:["Dec24","Christmas4","Bundle"]},is_available:!1,unlock:"premium"},{id:15082,name:"2025 Whisk",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_newyear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:15083,name:"Frostfall Whisk",price:4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_frostfall",tags:["DecM24","NewYears","perm","Premium"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_frost"]},{id:15084,name:"Mj\xf6lnir",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hammer",tags:["JanM25","Thor","Silver"]},is_available:!1,unlock:"premium"},{id:15085,name:"Fishing Rod Melee",price:3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_frod",tags:["Feb25","Silver"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_frod"]},{id:15086,name:"Harlequin Mallet",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mallet",tags:["Drops7","D7W2","FebM25"]},is_available:!1,unlock:"manual"},{id:15087,name:"Moai Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_moai",tags:["Easter","Gray","Grey","Premium","MarM25"]},is_available:!0,unlock:"premium",activeProduct:!1,sku:["item_melee_moai"]},{id:15088,name:"Your Greatest Fan",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fan",tags:["Shadows","Bundle","Red","Premium","Apr25"]},is_available:!0,unlock:"premium"}],Challenges=[{id:1,loc_ref:"chlg_kill_streak_five",type:0,subType:0,period:0,goal:1,reward:100,conditional:0,value:"5",valueTwo:null,tier:2},{id:2,loc_ref:"chlg_kill_streak_ten",type:0,subType:0,period:0,goal:1,reward:200,conditional:0,value:"10",valueTwo:null,tier:2},{id:3,loc_ref:"chlg_kill_streak_fifteen",type:0,subType:0,period:0,goal:1,reward:500,conditional:0,value:"15",valueTwo:null,tier:3},{id:4,loc_ref:"chlg_kill_streak_twenty",type:0,subType:0,period:0,goal:1,reward:1e3,conditional:0,value:"20",valueTwo:null,tier:3},{id:5,loc_ref:"chlg_kill_streak_fifty",type:0,subType:0,period:0,goal:1,reward:5e3,conditional:0,value:"50",valueTwo:null,tier:3},{id:6,loc_ref:"chlg_kill_kills_ten",type:0,subType:10,period:0,goal:10,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:7,loc_ref:"chlg_kill_kills_twenty",type:0,subType:10,period:0,goal:20,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:8,loc_ref:"chlg_kill_kills_fifty",type:0,subType:10,period:0,goal:50,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:9,loc_ref:"chlg_kill_kills_hundred",type:0,subType:10,period:0,goal:100,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:10,loc_ref:"chlg_kill_kills_two_fifty",type:0,subType:10,period:0,goal:250,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:11,loc_ref:"chlg_kill_timePlayed_two",type:0,subType:6,period:0,goal:1,reward:100,conditional:null,value:"2",valueTwo:"60",tier:0},{id:12,loc_ref:"chlg_kill_timePlayed_four",type:0,subType:6,period:0,goal:1,reward:500,conditional:null,value:"4",valueTwo:"60",tier:2},{id:13,loc_ref:"chlg_kill_timePlayed_seven",type:0,subType:6,period:0,goal:1,reward:1e3,conditional:null,value:"7",valueTwo:"60",tier:3},{id:14,loc_ref:"chlg_kill_timePlayed_ten",type:0,subType:6,period:0,goal:1,reward:2500,conditional:null,value:"10",valueTwo:"60",tier:3},{id:15,loc_ref:"chlg_kill_con_kill_one_shot",type:0,subType:8,period:0,goal:1,reward:100,conditional:11,value:"1",valueTwo:"1",tier:1},{id:16,loc_ref:"chlg_kill_con_kill_hp_ten",type:0,subType:8,period:0,goal:1,reward:500,conditional:12,value:"1",valueTwo:"10",tier:1},{id:17,loc_ref:"chlg_kill_con_kill_five_streak",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:0,value:"0",valueTwo:"5",tier:2},{id:18,loc_ref:"chlg_kill_con_kill_ten_streak",type:0,subType:8,period:0,goal:1,reward:2500,conditional:0,value:"0",valueTwo:"10",tier:3},{id:19,loc_ref:"chlg_kill_con_kill_scoped",type:0,subType:8,period:0,goal:1,reward:200,conditional:13,value:null,valueTwo:null,tier:2},{id:20,loc_ref:"chlg_kill_con_two_kills_one_shot",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:null,tier:2},{id:21,loc_ref:"chlg_kill_con_reloading",type:0,subType:8,period:0,goal:1,reward:100,conditional:17,value:null,valueTwo:null,tier:1},{id:22,loc_ref:"chlg_kill_con_kill_scoped_melee",type:0,subType:8,period:0,goal:1,reward:200,conditional:13,value:null,valueTwo:"9",tier:2},{id:23,loc_ref:"chlg_kill_con_kill_two_grenade",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:"8",tier:2},{id:24,loc_ref:"chlg_kill_con_kill_three_grenade",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:16,value:"3",valueTwo:"8",tier:3},{id:25,loc_ref:"chlg_kill_con_kill_two_rpegg",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:"4",tier:2},{id:26,loc_ref:"chlg_kill_con_kill_three_rpegg",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:16,value:"3",valueTwo:"4",tier:3},{id:27,loc_ref:"chlg_kill_weaponType_Cluck9mm_five",type:0,subType:1,period:0,goal:5,reward:200,conditional:null,value:null,valueTwo:"3",tier:1},{id:28,loc_ref:"chlg_kill_weaponType_Cluck9mm_ten",type:0,subType:1,period:0,goal:10,reward:500,conditional:null,value:null,valueTwo:"3",tier:1},{id:29,loc_ref:"chlg_kill_weaponType_Cluck9mm_twenty",type:0,subType:1,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:"3",tier:2},{id:30,loc_ref:"chlg_kill_weaponType_Cluck9mm_fifty",type:0,subType:1,period:0,goal:50,reward:2500,conditional:null,value:null,valueTwo:"3",tier:3},{id:31,loc_ref:"chlg_kill_weaponType_Scrambler_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"1",tier:1},{id:32,loc_ref:"chlg_kill_weaponType_Scrambler_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"1",tier:1},{id:33,loc_ref:"chlg_kill_weaponType_Scrambler_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"1",tier:2},{id:34,loc_ref:"chlg_kill_weaponType_Scrambler_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"1",tier:3},{id:35,loc_ref:"chlg_kill_weaponType_Rpegg_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"4",tier:2},{id:36,loc_ref:"chlg_kill_weaponType_Rpegg_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"4",tier:2},{id:37,loc_ref:"chlg_kill_weaponType_Rpegg_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"4",tier:2},{id:38,loc_ref:"chlg_kill_weaponType_Rpegg_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"4",tier:3},{id:39,loc_ref:"chlg_kill_weaponType_Whipper_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"5",tier:1},{id:40,loc_ref:"chlg_kill_weaponType_Whipper_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"5",tier:1},{id:41,loc_ref:"chlg_kill_weaponType_Whipper_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"5",tier:2},{id:42,loc_ref:"chlg_kill_weaponType_Whipper_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"5",tier:3},{id:43,loc_ref:"chlg_kill_weaponType_Eggk47_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"0",tier:0},{id:44,loc_ref:"chlg_kill_weaponType_Eggk47_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"0",tier:1},{id:45,loc_ref:"chlg_kill_weaponType_Eggk47_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"0",tier:2},{id:46,loc_ref:"chlg_kill_weaponType_Eggk47_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"0",tier:3},{id:47,loc_ref:"chlg_kill_weaponType_FreeRanger_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"2",tier:1},{id:48,loc_ref:"chlg_kill_weaponType_FreeRanger_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"2",tier:1},{id:49,loc_ref:"chlg_kill_weaponType_FreeRanger_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"2",tier:2},{id:50,loc_ref:"chlg_kill_weaponType_FreeRanger_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"2",tier:3},{id:51,loc_ref:"chlg_kill_weaponType_Crackshot_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"6",tier:1},{id:52,loc_ref:"chlg_kill_weaponType_Crackshot_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"6",tier:1},{id:53,loc_ref:"chlg_kill_weaponType_Crackshot_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"6",tier:2},{id:54,loc_ref:"chlg_kill_weaponType_Crackshot_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"6",tier:3},{id:55,loc_ref:"chlg_kill_weaponType_TriHard_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"7",tier:1},{id:56,loc_ref:"chlg_kill_weaponType_TriHard_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"7",tier:1},{id:57,loc_ref:"chlg_kill_weaponType_TriHard_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"7",tier:2},{id:58,loc_ref:"chlg_kill_weaponType_TriHard_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"7",tier:3},{id:59,loc_ref:"chlg_kill_weaponType_Melee_five",type:0,subType:1,period:0,goal:5,reward:200,conditional:null,value:null,valueTwo:"9",tier:2},{id:60,loc_ref:"chlg_kill_weaponType_Melee_ten",type:0,subType:1,period:0,goal:10,reward:500,conditional:null,value:null,valueTwo:"9",tier:2},{id:61,loc_ref:"chlg_kill_weaponType_Melee_twenty",type:0,subType:1,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:"9",tier:3},{id:62,loc_ref:"chlg_kill_weaponType_Melee_fifty",type:0,subType:1,period:0,goal:50,reward:2500,conditional:null,value:null,valueTwo:"9",tier:3},{id:63,loc_ref:"chlg_damage_five_hundred",type:1,subType:null,period:0,goal:500,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:64,loc_ref:"chlg_damage_one_thousand",type:1,subType:null,period:0,goal:1e3,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:65,loc_ref:"chlg_damage_twenty_five_hundred",type:1,subType:null,period:0,goal:2500,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:66,loc_ref:"chlg_damage_five_thousand",type:1,subType:null,period:0,goal:5e3,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:67,loc_ref:"chlg_damage_ten_thousand",type:1,subType:null,period:0,goal:1e4,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:68,loc_ref:"chlg_damage_twenty_five_thousand",type:1,subType:null,period:0,goal:25e3,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:69,loc_ref:"chlg_deaths_ten",type:2,subType:null,period:0,goal:10,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:70,loc_ref:"chlg_deaths_twenty",type:2,subType:null,period:0,goal:20,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:71,loc_ref:"chlg_deaths_fifty",type:2,subType:null,period:0,goal:50,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:72,loc_ref:"chlg_movement_distance_five_hunderd",type:3,subType:3,period:0,goal:500,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:73,loc_ref:"chlg_movement_distance_one_thousand",type:3,subType:3,period:0,goal:1e3,reward:500,conditional:null,value:null,valueTwo:null,tier:1},{id:74,loc_ref:"chlg_movement_distance_five_thousand",type:3,subType:3,period:0,goal:5e3,reward:2500,conditional:null,value:null,valueTwo:null,tier:2},{id:75,loc_ref:"chlg_movement_jump_one_hundred",type:3,subType:4,period:0,goal:100,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:76,loc_ref:"chlg_movement_jump_five_hundred",type:3,subType:4,period:0,goal:500,reward:500,conditional:null,value:null,valueTwo:null,tier:1},{id:77,loc_ref:"chlg_kill_jump_one",type:0,subType:4,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:2},{id:78,loc_ref:"chlg_kill_jump_five",type:0,subType:4,period:0,goal:5,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:79,loc_ref:"chlg_kill_jump_victim_jump",type:0,subType:4,period:0,goal:1,reward:2500,conditional:4,value:null,valueTwo:null,tier:3},{id:80,loc_ref:"chlg_movement_collect_ammo_ten",type:4,subType:18,period:0,goal:10,reward:100,conditional:16,value:"0",valueTwo:null,tier:1},{id:81,loc_ref:"chlg_movement_collect_ammo_twenty_five",type:4,subType:18,period:0,goal:25,reward:500,conditional:16,value:"0",valueTwo:null,tier:2},{id:82,loc_ref:"chlg_movement_collect_ammo_fifty",type:4,subType:18,period:0,goal:50,reward:1e3,conditional:16,value:"0",valueTwo:null,tier:3},{id:83,loc_ref:"chlg_movement_collect_grenade_ten",type:4,subType:18,period:0,goal:10,reward:100,conditional:17,value:"1",valueTwo:null,tier:1},{id:84,loc_ref:"chlg_movement_collect_grenade_twenty_five",type:4,subType:18,period:0,goal:25,reward:500,conditional:17,value:"1",valueTwo:null,tier:2},{id:85,loc_ref:"chlg_movement_collect_grenade_fifty",type:4,subType:18,period:0,goal:50,reward:1e3,conditional:17,value:"1",valueTwo:null,tier:3},{id:86,loc_ref:"chlg_timed_timeAlive_thirty",type:5,subType:7,period:0,goal:1,reward:100,conditional:7,value:"30",valueTwo:null,tier:1},{id:87,loc_ref:"chlg_timed_timeAlive_sixty",type:5,subType:7,period:0,goal:1,reward:200,conditional:7,value:"60",valueTwo:null,tier:2},{id:88,loc_ref:"chlg_timed_timeAlive_three_hundred",type:5,subType:7,period:0,goal:1,reward:2500,conditional:7,value:"300",valueTwo:null,tier:3},{id:90,loc_ref:"chlg_timed_timePlayed_three_hundred",type:5,subType:6,period:0,goal:300,reward:200,conditional:6,value:"300",valueTwo:null,tier:0},{id:91,loc_ref:"chlg_timed_timePlayed_nine_hundred",type:5,subType:6,period:0,goal:900,reward:500,conditional:6,value:"900",valueTwo:null,tier:1},{id:92,loc_ref:"chlg_timed_timePlayed_eighteen_hundred",type:5,subType:6,period:0,goal:1800,reward:1e3,conditional:6,value:"1800",valueTwo:null,tier:2},{id:93,loc_ref:"chlg_timed_timePlayed_thirty_six_hundred",type:5,subType:6,period:0,goal:3600,reward:2500,conditional:6,value:"3600",valueTwo:null,tier:3},{id:94,loc_ref:"chlg_kotc_capturing_timeAlive_twenty",type:6,subType:20,period:0,goal:1,reward:100,conditional:7,value:"10",valueTwo:null,tier:1},{id:95,loc_ref:"chlg_kotc_capture",type:6,subType:21,period:0,goal:1,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:96,loc_ref:"chlg_kotc_win_one",type:6,subType:23,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:97,loc_ref:"chlg_kotc_win_three",type:6,subType:23,period:0,goal:3,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:98,loc_ref:"chlg_kotc_win_five",type:6,subType:23,period:0,goal:5,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:99,loc_ref:"chlg_kotc_win_ten",type:6,subType:23,period:0,goal:10,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:100,loc_ref:"chlg_kotc_coop_kill",type:6,subType:20,period:0,goal:1,reward:200,conditional:10,value:null,valueTwo:null,tier:1},{id:101,loc_ref:"chlg_kotc_coop_kill_victim_capturing",type:6,subType:20,period:0,goal:1,reward:200,conditional:10,value:"18",valueTwo:null,tier:1},{id:102,loc_ref:"chlg_cts_pick_up",type:7,subType:21,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:103,loc_ref:"chlg_cts_capture_timeAlive_thirty",type:7,subType:21,period:0,goal:1,reward:500,conditional:7,value:"30",valueTwo:null,tier:2},{id:104,loc_ref:"chlg_cts_win_ten",type:7,subType:23,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:null,tier:1},{id:105,loc_ref:"chlg_cts_win_twenty_five",type:7,subType:23,period:0,goal:50,reward:4e3,conditional:null,value:null,valueTwo:null,tier:2},{id:106,loc_ref:"chlg_cts_win_fifty",type:7,subType:23,period:0,goal:100,reward:1e4,conditional:null,value:null,valueTwo:null,tier:3},{id:107,loc_ref:"chlg_cts_kills_victim_spatula",type:7,subType:10,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:2},{id:108,loc_ref:"chlg_cts_kills_killstreak_five",type:7,subType:10,period:0,goal:1,reward:500,conditional:0,value:"5",valueTwo:null,tier:3}],ChallengesStarter=[{id:6,loc_ref:"chlg_kill_kills_ten",type:0,subType:10,period:0,goal:10,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:11,loc_ref:"chlg_kill_timePlayed_two",type:0,subType:6,period:0,goal:1,reward:100,conditional:null,value:"2",valueTwo:"60",tier:0},{id:43,loc_ref:"chlg_kill_weaponType_Eggk47_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"0",tier:0},{id:63,loc_ref:"chlg_damage_five_hundred",type:1,subType:null,period:0,goal:500,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:72,loc_ref:"chlg_movement_distance_five_hunderd",type:3,subType:3,period:0,goal:500,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:90,loc_ref:"chlg_timed_timePlayed_three_hundred",type:5,subType:6,period:0,goal:300,reward:200,conditional:6,value:"300",valueTwo:null,tier:0}],ChallengesOne=[{id:7,loc_ref:"chlg_kill_kills_twenty",type:0,subType:10,period:0,goal:20,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:15,loc_ref:"chlg_kill_con_kill_one_shot",type:0,subType:8,period:0,goal:1,reward:100,conditional:11,value:"1",valueTwo:"1",tier:1},{id:16,loc_ref:"chlg_kill_con_kill_hp_ten",type:0,subType:8,period:0,goal:1,reward:500,conditional:12,value:"1",valueTwo:"10",tier:1},{id:21,loc_ref:"chlg_kill_con_reloading",type:0,subType:8,period:0,goal:1,reward:100,conditional:17,value:null,valueTwo:null,tier:1},{id:27,loc_ref:"chlg_kill_weaponType_Cluck9mm_five",type:0,subType:1,period:0,goal:5,reward:200,conditional:null,value:null,valueTwo:"3",tier:1},{id:28,loc_ref:"chlg_kill_weaponType_Cluck9mm_ten",type:0,subType:1,period:0,goal:10,reward:500,conditional:null,value:null,valueTwo:"3",tier:1},{id:31,loc_ref:"chlg_kill_weaponType_Scrambler_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"1",tier:1},{id:32,loc_ref:"chlg_kill_weaponType_Scrambler_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"1",tier:1},{id:39,loc_ref:"chlg_kill_weaponType_Whipper_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"5",tier:1},{id:40,loc_ref:"chlg_kill_weaponType_Whipper_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"5",tier:1},{id:44,loc_ref:"chlg_kill_weaponType_Eggk47_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"0",tier:1},{id:47,loc_ref:"chlg_kill_weaponType_FreeRanger_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"2",tier:1},{id:48,loc_ref:"chlg_kill_weaponType_FreeRanger_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"2",tier:1},{id:51,loc_ref:"chlg_kill_weaponType_Crackshot_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"6",tier:1},{id:52,loc_ref:"chlg_kill_weaponType_Crackshot_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"6",tier:1},{id:55,loc_ref:"chlg_kill_weaponType_TriHard_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"7",tier:1},{id:56,loc_ref:"chlg_kill_weaponType_TriHard_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"7",tier:1},{id:64,loc_ref:"chlg_damage_one_thousand",type:1,subType:null,period:0,goal:1e3,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:65,loc_ref:"chlg_damage_twenty_five_hundred",type:1,subType:null,period:0,goal:2500,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:69,loc_ref:"chlg_deaths_ten",type:2,subType:null,period:0,goal:10,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:70,loc_ref:"chlg_deaths_twenty",type:2,subType:null,period:0,goal:20,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:73,loc_ref:"chlg_movement_distance_one_thousand",type:3,subType:3,period:0,goal:1e3,reward:500,conditional:null,value:null,valueTwo:null,tier:1},{id:75,loc_ref:"chlg_movement_jump_one_hundred",type:3,subType:4,period:0,goal:100,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:76,loc_ref:"chlg_movement_jump_five_hundred",type:3,subType:4,period:0,goal:500,reward:500,conditional:null,value:null,valueTwo:null,tier:1},{id:80,loc_ref:"chlg_movement_collect_ammo_ten",type:4,subType:18,period:0,goal:10,reward:100,conditional:16,value:"0",valueTwo:null,tier:1},{id:83,loc_ref:"chlg_movement_collect_grenade_ten",type:4,subType:18,period:0,goal:10,reward:100,conditional:17,value:"1",valueTwo:null,tier:1},{id:86,loc_ref:"chlg_timed_timeAlive_thirty",type:5,subType:7,period:0,goal:1,reward:100,conditional:7,value:"30",valueTwo:null,tier:1},{id:91,loc_ref:"chlg_timed_timePlayed_nine_hundred",type:5,subType:6,period:0,goal:900,reward:500,conditional:6,value:"900",valueTwo:null,tier:1},{id:94,loc_ref:"chlg_kotc_capturing_timeAlive_twenty",type:6,subType:20,period:0,goal:1,reward:100,conditional:7,value:"10",valueTwo:null,tier:1},{id:95,loc_ref:"chlg_kotc_capture",type:6,subType:21,period:0,goal:1,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:96,loc_ref:"chlg_kotc_win_one",type:6,subType:23,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:100,loc_ref:"chlg_kotc_coop_kill",type:6,subType:20,period:0,goal:1,reward:200,conditional:10,value:null,valueTwo:null,tier:1},{id:101,loc_ref:"chlg_kotc_coop_kill_victim_capturing",type:6,subType:20,period:0,goal:1,reward:200,conditional:10,value:"18",valueTwo:null,tier:1},{id:102,loc_ref:"chlg_cts_pick_up",type:7,subType:21,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:104,loc_ref:"chlg_cts_win_ten",type:7,subType:23,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:null,tier:1}],ChallengesTwo=[{id:1,loc_ref:"chlg_kill_streak_five",type:0,subType:0,period:0,goal:1,reward:100,conditional:0,value:"5",valueTwo:null,tier:2},{id:2,loc_ref:"chlg_kill_streak_ten",type:0,subType:0,period:0,goal:1,reward:200,conditional:0,value:"10",valueTwo:null,tier:2},{id:8,loc_ref:"chlg_kill_kills_fifty",type:0,subType:10,period:0,goal:50,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:12,loc_ref:"chlg_kill_timePlayed_four",type:0,subType:6,period:0,goal:1,reward:500,conditional:null,value:"4",valueTwo:"60",tier:2},{id:17,loc_ref:"chlg_kill_con_kill_five_streak",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:0,value:"0",valueTwo:"5",tier:2},{id:19,loc_ref:"chlg_kill_con_kill_scoped",type:0,subType:8,period:0,goal:1,reward:200,conditional:13,value:null,valueTwo:null,tier:2},{id:20,loc_ref:"chlg_kill_con_two_kills_one_shot",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:null,tier:2},{id:22,loc_ref:"chlg_kill_con_kill_scoped_melee",type:0,subType:8,period:0,goal:1,reward:200,conditional:13,value:null,valueTwo:"9",tier:2},{id:23,loc_ref:"chlg_kill_con_kill_two_grenade",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:"8",tier:2},{id:25,loc_ref:"chlg_kill_con_kill_two_rpegg",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:"4",tier:2},{id:29,loc_ref:"chlg_kill_weaponType_Cluck9mm_twenty",type:0,subType:1,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:"3",tier:2},{id:33,loc_ref:"chlg_kill_weaponType_Scrambler_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"1",tier:2},{id:35,loc_ref:"chlg_kill_weaponType_Rpegg_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"4",tier:2},{id:36,loc_ref:"chlg_kill_weaponType_Rpegg_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"4",tier:2},{id:37,loc_ref:"chlg_kill_weaponType_Rpegg_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"4",tier:2},{id:41,loc_ref:"chlg_kill_weaponType_Whipper_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"5",tier:2},{id:45,loc_ref:"chlg_kill_weaponType_Eggk47_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"0",tier:2},{id:49,loc_ref:"chlg_kill_weaponType_FreeRanger_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"2",tier:2},{id:53,loc_ref:"chlg_kill_weaponType_Crackshot_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"6",tier:2},{id:57,loc_ref:"chlg_kill_weaponType_TriHard_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"7",tier:2},{id:59,loc_ref:"chlg_kill_weaponType_Melee_five",type:0,subType:1,period:0,goal:5,reward:200,conditional:null,value:null,valueTwo:"9",tier:2},{id:60,loc_ref:"chlg_kill_weaponType_Melee_ten",type:0,subType:1,period:0,goal:10,reward:500,conditional:null,value:null,valueTwo:"9",tier:2},{id:66,loc_ref:"chlg_damage_five_thousand",type:1,subType:null,period:0,goal:5e3,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:71,loc_ref:"chlg_deaths_fifty",type:2,subType:null,period:0,goal:50,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:74,loc_ref:"chlg_movement_distance_five_thousand",type:3,subType:3,period:0,goal:5e3,reward:2500,conditional:null,value:null,valueTwo:null,tier:2},{id:77,loc_ref:"chlg_kill_jump_one",type:0,subType:4,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:2},{id:81,loc_ref:"chlg_movement_collect_ammo_twenty_five",type:4,subType:18,period:0,goal:25,reward:500,conditional:16,value:"0",valueTwo:null,tier:2},{id:84,loc_ref:"chlg_movement_collect_grenade_twenty_five",type:4,subType:18,period:0,goal:25,reward:500,conditional:17,value:"1",valueTwo:null,tier:2},{id:87,loc_ref:"chlg_timed_timeAlive_sixty",type:5,subType:7,period:0,goal:1,reward:200,conditional:7,value:"60",valueTwo:null,tier:2},{id:92,loc_ref:"chlg_timed_timePlayed_eighteen_hundred",type:5,subType:6,period:0,goal:1800,reward:1e3,conditional:6,value:"1800",valueTwo:null,tier:2},{id:97,loc_ref:"chlg_kotc_win_three",type:6,subType:23,period:0,goal:3,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:103,loc_ref:"chlg_cts_capture_timeAlive_thirty",type:7,subType:21,period:0,goal:1,reward:500,conditional:7,value:"30",valueTwo:null,tier:2},{id:105,loc_ref:"chlg_cts_win_twenty_five",type:7,subType:23,period:0,goal:50,reward:4e3,conditional:null,value:null,valueTwo:null,tier:2},{id:107,loc_ref:"chlg_cts_kills_victim_spatula",type:7,subType:10,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:2}],ChallengesThree=[{id:3,loc_ref:"chlg_kill_streak_fifteen",type:0,subType:0,period:0,goal:1,reward:500,conditional:0,value:"15",valueTwo:null,tier:3},{id:4,loc_ref:"chlg_kill_streak_twenty",type:0,subType:0,period:0,goal:1,reward:1e3,conditional:0,value:"20",valueTwo:null,tier:3},{id:5,loc_ref:"chlg_kill_streak_fifty",type:0,subType:0,period:0,goal:1,reward:5e3,conditional:0,value:"50",valueTwo:null,tier:3},{id:9,loc_ref:"chlg_kill_kills_hundred",type:0,subType:10,period:0,goal:100,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:10,loc_ref:"chlg_kill_kills_two_fifty",type:0,subType:10,period:0,goal:250,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:13,loc_ref:"chlg_kill_timePlayed_seven",type:0,subType:6,period:0,goal:1,reward:1e3,conditional:null,value:"7",valueTwo:"60",tier:3},{id:14,loc_ref:"chlg_kill_timePlayed_ten",type:0,subType:6,period:0,goal:1,reward:2500,conditional:null,value:"10",valueTwo:"60",tier:3},{id:18,loc_ref:"chlg_kill_con_kill_ten_streak",type:0,subType:8,period:0,goal:1,reward:2500,conditional:0,value:"0",valueTwo:"10",tier:3},{id:24,loc_ref:"chlg_kill_con_kill_three_grenade",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:16,value:"3",valueTwo:"8",tier:3},{id:26,loc_ref:"chlg_kill_con_kill_three_rpegg",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:16,value:"3",valueTwo:"4",tier:3},{id:30,loc_ref:"chlg_kill_weaponType_Cluck9mm_fifty",type:0,subType:1,period:0,goal:50,reward:2500,conditional:null,value:null,valueTwo:"3",tier:3},{id:34,loc_ref:"chlg_kill_weaponType_Scrambler_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"1",tier:3},{id:38,loc_ref:"chlg_kill_weaponType_Rpegg_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"4",tier:3},{id:42,loc_ref:"chlg_kill_weaponType_Whipper_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"5",tier:3},{id:46,loc_ref:"chlg_kill_weaponType_Eggk47_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"0",tier:3},{id:50,loc_ref:"chlg_kill_weaponType_FreeRanger_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"2",tier:3},{id:54,loc_ref:"chlg_kill_weaponType_Crackshot_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"6",tier:3},{id:58,loc_ref:"chlg_kill_weaponType_TriHard_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"7",tier:3},{id:61,loc_ref:"chlg_kill_weaponType_Melee_twenty",type:0,subType:1,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:"9",tier:3},{id:62,loc_ref:"chlg_kill_weaponType_Melee_fifty",type:0,subType:1,period:0,goal:50,reward:2500,conditional:null,value:null,valueTwo:"9",tier:3},{id:67,loc_ref:"chlg_damage_ten_thousand",type:1,subType:null,period:0,goal:1e4,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:68,loc_ref:"chlg_damage_twenty_five_thousand",type:1,subType:null,period:0,goal:25e3,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:78,loc_ref:"chlg_kill_jump_five",type:0,subType:4,period:0,goal:5,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:79,loc_ref:"chlg_kill_jump_victim_jump",type:0,subType:4,period:0,goal:1,reward:2500,conditional:4,value:null,valueTwo:null,tier:3},{id:82,loc_ref:"chlg_movement_collect_ammo_fifty",type:4,subType:18,period:0,goal:50,reward:1e3,conditional:16,value:"0",valueTwo:null,tier:3},{id:85,loc_ref:"chlg_movement_collect_grenade_fifty",type:4,subType:18,period:0,goal:50,reward:1e3,conditional:17,value:"1",valueTwo:null,tier:3},{id:88,loc_ref:"chlg_timed_timeAlive_three_hundred",type:5,subType:7,period:0,goal:1,reward:2500,conditional:7,value:"300",valueTwo:null,tier:3},{id:93,loc_ref:"chlg_timed_timePlayed_thirty_six_hundred",type:5,subType:6,period:0,goal:3600,reward:2500,conditional:6,value:"3600",valueTwo:null,tier:3},{id:98,loc_ref:"chlg_kotc_win_five",type:6,subType:23,period:0,goal:5,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:99,loc_ref:"chlg_kotc_win_ten",type:6,subType:23,period:0,goal:10,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:106,loc_ref:"chlg_cts_win_fifty",type:7,subType:23,period:0,goal:100,reward:1e4,conditional:null,value:null,valueTwo:null,tier:3},{id:108,loc_ref:"chlg_cts_kills_killstreak_five",type:7,subType:10,period:0,goal:1,reward:500,conditional:0,value:"5",valueTwo:null,tier:3}],ChwRewardIds=[1340,1206,15024,1050,1013,3066,1415,1024,2521,2305,1393,1230,1350,2250,3014,16006,16028,1504,3155,1410,1097,1216,4244,1158,2526,2262,3413,1252,4028,1151,2527,3456,1274,1264,2067,1187,4519,2292,1305,2273,2522,1046,1246,3633,2368,1038,1039,1360,1052,1398,2524,1327,3664,1141,2161,1370,3838,2149,16061,1047,1476,2319,15057,1048,1040,2373,2146,1134,15017,2096,1199,2090,2529,1287,3653,1173,2523,1067,1201,1474,1049,1041,1343,3021,3008,4012,3608,4517,3120,3112,15053,3812,3412,4510,16024,15020,3808,3408,2525,2528,2008,16007,4255,2231,3448],LoadingTips=["tip_001","tip_ofthe_day_1","tip_ofthe_day_4","tip_ofthe_day_6","tip_ofthe_day_9","tip_ofthe_day_10","tip_ofthe_day_11","tip_ofthe_day_13","tip_ofthe_day_15","tip_ofthe_day_16","tip_ofthe_day_17","tip_ofthe_day_18","tip_ofthe_day_19","tip_ofthe_day_26","tip_ofthe_day_27","tip_ofthe_day_28","tip_ofthe_day_30","tip_ofthe_day_33","tip_ofthe_day_34","tip_ofthe_day_35","tip_ofthe_day_37","tip_ofthe_day_39","tip_ofthe_day_40","tip_ofthe_day_41","tip_ofthe_day_42","tip_ofthe_day_44","tip_ofthe_day_45","tip_ofthe_day_46","tip_ofthe_day_47","tip_ofthe_day_49","tip_ofthe_day_51","tip_ofthe_day_52","tip_ofthe_day_53","tip_ofthe_day_54","tip_ofthe_day_56","tip_ofthe_day_58","tip_ofthe_day_59","tip_ofthe_day_60","tip_ofthe_day_62","tip_ofthe_day_63","tip_ofthe_day_64","tip_ofthe_day_65","tip_ofthe_day_66","tip_ofthe_day_67","tip_ofthe_day_68","tip_ofthe_day_69","tip_ofthe_day_70","tip_ofthe_day_72","tip_ofthe_day_73","tip_ofthe_day_74","tip_ofthe_day_75","tip_ofthe_day_76","tip_ofthe_day_77","tip_ofthe_day_78","tip_ofthe_day_79","tip_ofthe_day_80","tip_ofthe_day_81","tip_ofthe_day_83","tip_ofthe_day_84","tip_ofthe_day_85","tip_ofthe_day_86","tip_ofthe_day_87","tip_ofthe_day_88","tip_ofthe_day_89","tip_ofthe_day_90","tip_ofthe_day_91","tip_ofthe_day_92","tip_ofthe_day_93","tip_ofthe_day_94","tip_ofthe_day_95","tip_ofthe_day_96","tip_ofthe_day_97","tip_ofthe_day_98","tip_ofthe_day_99","tip_ofthe_day_100","tip_ofthe_day_101","tip_ofthe_day_102","tip_ofthe_day_103","tip_ofthe_day_104","tip_ofthe_day_105","tip_ofthe_day_106","tip_ofthe_day_107","tip_ofthe_day_108"],LoadingTipsNew=["tipNew_ofthe_day_2","tipNew_ofthe_day_3","tipNew_ofthe_day_7","tipNew_ofthe_day_8","tipNew_ofthe_day_14","tipNew_ofthe_day_22","tipNew_ofthe_day_23","tipNew_ofthe_day_24","tipNew_ofthe_day_25","tipNew_ofthe_day_29","tipNew_ofthe_day_31","tipNew_ofthe_day_32","tipNew_ofthe_day_38","tipNew_ofthe_day_48","tipNew_ofthe_day_50","tipNew_ofthe_day_55","tipNew_ofthe_day_57","tipNew_ofthe_day_61","tipNew_ofthe_day_71","tipNew_ofthe_day_82","tipNew_ofthe_day_109","tipNew_ofthe_day_110"],LoadingMsgs=["loading_msgs_1","loading_msgs_2","loading_msgs_3","loading_msgs_4","loading_msgs_5","loading_msgs_6","loading_msgs_7","loading_msgs_8","loading_msgs_9","loading_msgs_10","loading_msgs_11","loading_msgs_12","loading_msgs_13","loading_msgs_14","loading_msgs_15","loading_msgs_16","loading_msgs_17","loading_msgs_18","loading_msgs_19","loading_msgs_20","loading_msgs_21","loading_msgs_22","loading_msgs_23","loading_msgs_24","loading_msgs_25","loading_msgs_26","loading_msgs_27","loading_msgs_28","loading_msgs_29","loading_msgs_30","loading_msgs_31","loading_msgs_32","loading_msgs_33","loading_msgs_34","loading_msgs_35","loading_msgs_36","loading_msgs_37","loading_msgs_38","loading_msgs_39","loading_msgs_40","loading_msgs_41","loading_msgs_42","loading_msgs_43","loading_msgs_44","loading_msgs_45","loading_msgs_46","loading_msgs_47","loading_msgs_48","loading_msgs_49","loading_msgs_50","loading_msgs_51","loading_msgs_52","loading_msgs_53","loading_msgs_54","loading_msgs_55","loading_msgs_56","loading_msgs_57","loading_msgs_58","loading_msgs_59","loading_msgs_60","loading_msgs_61","loading_msgs_62","loading_msgs_63","loading_msgs_64","loading_msgs_65","loading_msgs_66","loading_msgs_67","loading_msgs_68","loading_msgs_69","loading_msgs_70"];function createScene(e){let t=new Scene(e);return t.useRightHandedSystem=!0,t.useGeometryIdsMap=!0,t.useMaterialMeshMap=!0,t.useClonedMeshMap=!0,t}function cloneMesh(e,t,i,a){var n=globalScene.getMeshByName(e);let s=new Mesh(e,t,i,n);return s.setEnabled(!0),n?n.skeleton&&(s.skeleton=n.skeleton.clone(),s.skeleton._scene=t,s.animations=n.animations.map((e=>{let i=e.clone("",(e=>{let t=s.skeleton.getBoneIndexByName(e.name),i=s.skeleton.bones[t];return i.linkTransformNode(i),i}),!0);return i._scene=t,i})),s.skeleton.returnToRest()):console.error("Cannot find mesh to clone:",e),a?s.material=a:s.material&&s.material._scene!=t&&(s.material=getMaterialByName(s.material.name,t)),s}function getMaterialByName(e,t){let i=t.getMaterialByName(e);return i||(i=globalScene.getMaterialByName(e).clone(e,t),t.addMaterial(i)),i}function playAnimation(e,t,i=1){e.currentAnimation&&e.currentAnimation.stop();let a=e.getAnimationByName(t);e.currentAnimation=a,a.speedRatio=i,a.play()}function stopAnimation(e){e.currentAnimation&&e.currentAnimation.stop()}function initAnimation(e,t,i){let a=e.getAnimationByName(t);i&&a.onAnimationGroupPauseObservable.addOnce(i),a.play(),a.goToFrame(0),a.pause()}function Bullet(e){this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.fb=0,this.active=!1,this.Zb=null,this.damage=20,this.range=0,this.velocity=0,this.hitsMap=!1,this.origin=new Vector3,this.direction=new Vector3,this.end=new Vector3,this.meshName="",this.weaponClassId=0,this.wb=new BulletActor(this)}Skeleton.prototype.disableBlending=function(){this.bones.forEach((function(e){e.animations.forEach((function(e){e.enableBlending=!1}))}))},DynamicTexture.prototype.clearRect=function(e,t,i,a){this._context.clearRect(e,t,i,a)},AbstractMesh.prototype.setLayerMask=function(e){this.layerMask=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[i].setLayerMask(e)},AbstractMesh.prototype.setRenderingGroupId=function(e){this.undefinedc=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[i].setRenderingGroupId(e)},TransformNode.prototype.mb=function(e){this.isVisible=e,this._isWorldMatrixFrozen=!e;for(var t=this.getChildTransformNodes(),i=0;i<t.length;i++)t[i].mb(e)},AbstractMesh.prototype.setMaterial=function(e){this.material=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[i].setMaterial(e)},Bullet.damageExp=4,Bullet.Wb=new Vector3,Bullet.qb=new Vector3,Bullet.Pb=new Vector3,Bullet.position=new Vector3,Bullet.fire=function(e,t,i,a){munitionsManager.bulletPool.retrieve().fireThis(e,t,i,a)},Bullet.prototype.fireThis=function(e,t,i,a){this.Zb=e,this.x=t.x,this.y=t.y,this.z=t.z,this.origin.set(this.x,this.y,this.z),this.direction.copyFrom(i).normalize().scaleInPlace(a.velocity),this.dx=this.direction.x,this.dy=this.direction.y,this.fb=this.direction.z,this.weaponClass=a,this.damage=a.damage,this.active=!0,this.range=a.range,this.velocity=a.velocity,this.hitsMap=!1,this.powerful=!1,this.dmgTypeId=a.dmgTypeId;var n=Collider.ub(t,i,Collider.projectileCollidesWithCell);n&&(this.end.copyFrom(n.pick.pickedPoint),this.range=Vector3.Distance(t,n.pick.pickedPoint),this.hitsMap=!0),e.activeShellStreaks&ShellStreak.EggBreaker&&(this.powerful=!0,this.damage*=1.5),0==this.Zb.ib.tracer?this.wb.fire(this.powerful):this.wb.delayFrames=Number.MAX_SAFE_INTEGER},Bullet.prototype.remove=function(){munitionsManager.bulletPool.recycle(this),this.wb.remove()},Bullet.prototype.update=function(){if(Bullet.position.set(this.x,this.y,this.z),this.range<this.velocity&&this.direction.scaleInPlace(this.range/this.velocity),!Collider.Gb(Bullet.position,this.direction,this))if(this.x+=this.dx,this.y+=this.dy,this.z+=this.fb,this.range-=this.velocity,this.range<=0){if(this.hitsMap){var e=this.end,t=.1*-this.dx,i=.1*-this.dy,a=.1*-this.fb;addBulletHitSprite(e.x,e.y,e.z,t,i,a)}this.remove()}else;},Bullet.prototype.collidesWithPlayer=function(e,t){Bullet.Wb.x=this.dx,Bullet.Wb.y=this.dy,Bullet.Wb.z=this.fb,Bullet.Wb.normalize();var i=.8*-Vector3.Dot(Bullet.Wb,t)+.2,a=this.damage*Math.pow(i,Bullet.damageExp+Math.pow(i,Bullet.damageExp));isNaN(a)&&console.error("Bullet.collidesWithPlayer damage is NaN",this.weaponClass),hitPlayer(e,this,a,Bullet.Wb.x,Bullet.Wb.z),this.remove()};var BVH3=class{constructor(){var e=new Vector3(0,0,0),t=new Vector3(minMap.width,minMap.height,minMap.depth);this.world=new BoundingBox(e,t),this.bvh=this.createNode(this.world,2),this.checkTick=0}getObjectsWithRay(e,t,i){this.checkTick++,this.recurseObjectsWithRay(e,t,this.bvh,i)}recurseObjectsWithRay(e,t,i,a){for(var n=0;n<i.length;n++){var s=i[n];if(BoundingBox.IntersectsRay(s,e,t)){for(var r=0;r<s.objects.length;r++){var o=s.objects[r];o.checkTick!=this.checkTick&&BoundingBox.IntersectsRay(o.bb,e,t)&&(o.checkTick=this.checkTick,a(s.objects[r]))}this.recurseObjectsWithRay(e,t,s.bvh,a)}}}add(e,t){t=t||this.bvh;for(var i=0;i<t.length;i++){var a=t[i];BoundingBox.Intersects(e.bb,a)&&(a.maximumWorld.x-a.minimumWorld.x>.5*(e.bb.maximumWorld.x-e.bb.minimumWorld.x)&&a.maximumWorld.y-a.minimumWorld.y>.5*(e.bb.maximumWorld.y-e.bb.minimumWorld.y)&&a.maximumWorld.z-a.minimumWorld.z>.5*(e.bb.maximumWorld.z-e.bb.minimumWorld.z)?(0==a.bvh.length&&(a.bvh=this.createNode(a,2)),e.checkTick=0,this.add(e,a.bvh)):a.objects.push(e))}}recurseObjects(e,t,i){for(var a=0;a<t.length;a++){var n=t[a];if(BoundingBox.Intersects(e,n)){for(var s=0;s<n.objects.length;s++){var r=n.objects[s];r.checkTick!=this.checkTick&&BoundingBox.Intersects(e,r.bb)&&(r.checkTick=this.checkTick,i(n.objects[s]))}this.recurseObjects(e,n.bvh,i)}}}getObjects(e,t){this.checkTick++,this.recurseObjects(e,this.bvh,t)}createNode(e,t){var i=[],a=(e.maximumWorld.x-e.minimumWorld.x)/t,n=(e.maximumWorld.z-e.minimumWorld.z)/t;if(a>minMap.height)var s=0,r=minMap.height,o=minMap.height;else s=e.minimumWorld.y,o=((r=e.maximumWorld.y)-s)/t;for(var l=e.minimumWorld.x;l<e.maximumWorld.x;l+=a)for(var c=s;c<r;c+=o)for(var h=e.minimumWorld.z;h<e.maximumWorld.z;h+=n){var u=new Vector3(l,c,h),m=new Vector3(l+a,c+o,h+n),d=new BoundingBox(u,m);d.bvh=[],d.objects=[],i.push(d)}return i}};function Catalog(){if(null==Items)throw"Items is undefined or null, cannot create Catalog";this.isSetup=!1,this.filterItems=function(e,t){for(var i=[],a=0;a<e.length;a++)t(e[a])&&i.push(e[a]);return i},this.findItemInListById=function(e,t){for(var i=0;i<t.length;i++)if(t[i]&&t[i].id===e)return t[i];return null},this.findItemsByIds=function(e){return Items.filter((t=>e.includes(t.id)))},this.findItemById=function(e){return this.findItemInListById(e,Items)},this.findItemBy8BitItemId=function(e,t,i){if(!1===this.isSetup&&this.setupCatalog(),void 0===t||t>=CharClass.length)return null;var a=i;switch(e){case ItemType2.Hat:return 0===i?null:this.findItemInListById(a,this.hats);case ItemType2.Stamp:return 0===i?null:this.findItemInListById(a,this.stamps);case ItemType2.Primary:return this.findItemInListById(a,this.forClass[t].forWeaponSlot[Slot.Primary]);case ItemType2.Secondary:return this.findItemInListById(a,this.forClass[t].forWeaponSlot[Slot.Secondary]);case ItemType2.Grenade:return this.findItemInListById(a,this.grenades);case ItemType2.Melee:return this.findItemInListById(a,this.melee)}},this.addWeaponFunctions=function(e){e.instantiateNew=function(e){var t;return t=null===this.exclusive_for_class?new Cluck9mm(e,this.item_data.meshName):new G.classes[this.exclusive_for_class].ib(e,this.item_data.meshName),e.wb&&e.wb.setWeaponSkeleton(t.wb.skeleton),t}},this.addGrenadeFunctions=function(e){e.instantiateNew=function(e){let t=cloneMesh(this.item_data.meshName,e.scene),i={scene:e.scene,player:e,wb:{Xb:t,dispose:()=>{t.dispose()}}};return t.position.y=.5,t.position.z=1,i}},this.addMeleeFunctions=function(e){e.instantiateNew=function(e){let t=cloneMesh(this.item_data.meshName,e.scene),i={scene:e.scene,player:e,wb:{weaponMesh:t,skeleton:t.skeleton,dispose:()=>{t.dispose()}}};return e.wb&&e.wb.setWeaponSkeleton(i.wb.skeleton),i}},this.getTaggedItems=function(e,t){if(!e)return[];const i=(e=e.replace(/\s/g,"")).split(",");return this.filterItems(Items,(function(e){if(void 0!==e.item_data.tags&&null!==e.item_data.tags&&e.item_data.tags.length>0){if(void 0!==t&&e.item_type_name!==getKeyByValue(ItemType2,t))return!1;let a=!1;return e.item_data.tags.forEach((e=>{i.forEach((t=>{t===e&&(a=!0)}))})),a}return!1}))},this.premiumSoundValid=function(e){const t="premium"===e.unlock,i="manual"===e.unlock&&"gun_cluck9mm_CubicCastles"===e.item_data.meshName,a="purchase"===e.unlock&&e.item_data.hasOwnProperty("tags")&&e.item_data.tags.includes("Premium")&&e.price>15e4;return e.hasOwnProperty("unlock")&&(t||i||a)},this.getPremiumGunMeshNames=function(){Object.keys(CharClass).forEach((e=>{"Soldier"!==e&&(PremMeshNames[e]=Items.filter((t=>hasValue(t.exclusive_for_class)&&t.exclusive_for_class===CharClass[e]&&this.premiumSoundValid(t))).map((e=>e.item_data.meshName)))})),Object.keys(ItemType2).forEach((e=>{"Primary"!==e?PremMeshNames[e]=Items.filter((t=>hasValue(t.item_type_id)&&t.item_type_id===ItemType2[e]&&this.premiumSoundValid(t))).map((e=>e.item_data.meshName)):"Primary"===e&&(PremMeshNames.Soldier=Items.filter((e=>hasValue(e.item_type_id)&&e.item_type_id===ItemType2.Primary&&!hasValue(e.exclusive_for_class)&&this.premiumSoundValid(e))).map((e=>e.item_data.meshName)))}))},this.setupCatalog=function(){this.defaultItemIds=[],this.hats=[],this.stamps=[],this.primaryWeapons=[],this.secondaryWeapons=[],this.grenades=[],this.melee=[],this.forClass=[];for(var e=0;e<Items.length;e++)switch("default"===Items[e].unlock&&this.defaultItemIds.push(Items[e].id),Items[e].item_type_id){case ItemType2.Hat:this.hats.push(Items[e]);break;case ItemType2.Stamp:this.stamps.push(Items[e]);break;case ItemType2.Primary:this.primaryWeapons.push(Items[e]),this.addWeaponFunctions(Items[e]);break;case ItemType2.Secondary:this.secondaryWeapons.push(Items[e]),this.addWeaponFunctions(Items[e]);break;case ItemType2.Grenade:this.grenades.push(Items[e]),this.addGrenadeFunctions(Items[e]);break;case ItemType2.Melee:this.melee.push(Items[e]),this.addMeleeFunctions(Items[e])}for(var t=0;t<CharClass.length;t++){var i=function(e){return 0===e.price&&null===e.exclusive_for_class},a=function(e){return 0===e.price&&e.exclusive_for_class===t},n=function(e){return e.price>0&&null===e.exclusive_for_class},s=function(e){return e.price>0&&e.exclusive_for_class===t},r=this,o=function(e){return e=r.filterItems(e,i).concat(r.filterItems(e,a)).concat(r.filterItems(e,n)).concat(r.filterItems(e,s))},l={primaryWeapons:o(this.primaryWeapons),secondaryWeapons:o(this.secondaryWeapons)};l.forWeaponSlot=[l.primaryWeapons,l.secondaryWeapons],this.forClass.push(l)}this.isSetup=!0},this.isSetup||this.setupCatalog()}G.catalog||(G.catalog=new Catalog);var Collider={init:function(e){Collider.playerCollisionMesh=MeshBuilder.Mc("",{size:.5,height:.6},e),Collider.playerCollisionMesh.position.y=.3,Collider.playerCollisionMesh.bakeCurrentTransformIntoVertices(),Collider.playerCollisionMesh.setEnabled(!1),Collider.wedgeCollisionMesh=MeshBuilder.Mc("",{size:1.5},e),Collider.wedgeCollisionMesh.position.y=-.75,Collider.wedgeCollisionMesh.bakeCurrentTransformIntoVertices(),Collider.wedgeCollisionMesh.rotation.x=Math.PI/4,Collider.wedgeCollisionMesh.bakeTransformIntoVertices(Collider.wedgeCollisionMesh.getWorldMatrix()),Collider.wedgeCollisionMesh.setEnabled(!1),Collider.wedgeCollisionMesh.flipFaces(),Collider.iwedgeCollisionMesh=MeshBuilder.Mc("",{size:1.5},e),Collider.iwedgeCollisionMesh.position.y=.75,Collider.iwedgeCollisionMesh.bakeCurrentTransformIntoVertices(),Collider.iwedgeCollisionMesh.rotation.x=Math.PI/4,Collider.iwedgeCollisionMesh.bakeTransformIntoVertices(Collider.iwedgeCollisionMesh.getWorldMatrix()),Collider.iwedgeCollisionMesh.setEnabled(!1),Collider.iwedgeCollisionMesh.flipFaces(),Collider.Ob=MeshBuilder.Mc("",{size:1},e),Collider.Ob.setEnabled(!1),Collider.Ob.flipFaces()},Wb:new Vector3,qb:new Vector3,Pb:new Vector3,sb:new Vector3,tb:new Vector3,ray:new Ray(Vector3.Zero(),Vector3.Zero(),1),matrix:new Matrix,meshCollidesWithMap:function(e,t){var i={};if(isNaN(t.x)||isNaN(t.y)||isNaN(t.z))return!0;for(var a=e.getBoundingInfo().boundingBox,n=0;n<a.vectors.length;n++){var s=Math.floor(t.x+a.vectors[n].x),r=Math.floor(t.y+a.vectors[n].y),o=Math.floor(t.z+a.vectors[n].z);if(s<0||s>=map2.width||o<0||o>=map2.depth||r<0)return!0;var l=s+1e3*r+1e6*o;if(r<map2.height&&!i[l]){var c=Collider.meshCollidesWithCell(e,t,s,r,o);if(c)return c;i[l]=!0}}return!1},meshCollidesWithCell:function(e,t,i,a,n,s){var r=map2.data[i][a][n];if(r.idx){var o=mapMeshes[r.idx];if(s&&o.softness)return!1;switch(o.colliderType){case"full":return{x:i,y:a,z:n,cell:r,mesh:Collider.Ob};case"ladder":if("pc"!=e.name)return!1;break;case"none":return!1}e.position.x=t.x-i-.5,e.position.y=t.y-a-.5,e.position.z=t.z-n-.5,Collider.Wb.set(-e.position.x,-e.position.y,-e.position.z),e.setPivotPoint(Collider.Wb),e.rotation.x=-r.rx,e.rotation.y=-r.ry,e.rotation.z=-r.rz,e.computeWorldMatrix();var l=r.colliderMesh.intersectsMesh(e,r.colliderPrecise,r.colliderChildren);if(l)return{x:i,y:a,z:n,cell:r,mesh:l}}return!1},ub:function(e,t,i){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))return!1;if(e.x<0||e.x>=map2.width||e.z<0||e.z>=map2.depth||e.y<0||e.y>=map2.height)return!1;var a=t.length(),n=Math.floor(e.x),s=Math.floor(e.y),r=Math.floor(e.z),o=t.x,l=t.y,c=t.z,h=Math.sign(o),u=Math.sign(l),m=Math.sign(c),d=Collider.intbound(e.x,o),f=Collider.intbound(e.y,l),p=Collider.intbound(e.z,c),_=h/o,g=u/l,v=m/c;if(0===o&&0===l&&0===c)return!1;for(a/=Math.sqrt(o*o+l*l+c*c);(h>0?n<map2.width:n>=0)&&(u>0?s<map2.height:s>=0)&&(m>0?r<map2.depth:r>=0);){if(!(n<0||s<0||r<0||n>=map2.width||s>=map2.height||r>=map2.depth)){var y=i(e,t,{x:n,y:s,z:r});if(y&&"verysoft"!=mapMeshes[y.cell.idx].softness)return y}if(d<f)if(d<p){if(d>a)break;n+=h,d+=_}else{if(p>a)break;r+=m,p+=v}else if(f<p){if(f>a)break;s+=u,f+=g}else{if(p>a)break;r+=m,p+=v}}},intbound:function(e,t){return t<0?Collider.intbound(-e,-t):(1-(e=(e%1+1)%1))/t},getCellForRay:function(e){try{var t=map2.data[e.x][e.y][e.z]}catch(t){console.log(e)}if(!t||!t.mesh)return!1;switch(t.mesh.colliderType){case"none":case"ladder":return!1}return t},projectileCollidesWithCell:function(e,t,i){var a=Collider.getCellForRay(i);if(!a)return!1;if(a.mesh.softness)return!1;var n=a.colliderMesh;Collider.matrix.copyFrom(a.colliderMatrix),Collider.sb.set(i.x+.5,i.y+.5,i.z+.5),Collider.Wb.set(e.x,e.y,e.z),Collider.qb.copyFrom(t),Collider.Wb.subtractInPlace(Collider.sb),Collider.ray.origin.copyFrom(Collider.Wb),Collider.ray.direction.copyFrom(Collider.qb),Collider.ray.length=1,Ray.TransformToRef(Collider.ray,Collider.matrix,Collider.ray);var s=Collider.intersectsColliderMesh(n,!1);if(n=s.pickedMesh,s.hit){var r=Vector3.TransformCoordinates(s.pickedPoint,Collider.matrix.invert());return r.addInPlace(Collider.sb),s.pickedPoint=r,{cell:a,pick:s}}return!1},grenadeCollidesWithCell:function(e,t,i){var a=Collider.getCellForRay(i);if(!a)return!1;var n=a.colliderMesh;Collider.matrix.copyFrom(a.colliderMatrix),Collider.sb.set(i.x+.5,i.y+.5,i.z+.5),Collider.Wb.set(e.x,e.y,e.z),Collider.qb.copyFrom(t);var s=t.length();Collider.qb.normalize().scaleInPlace(10),Collider.Wb.subtractInPlace(Collider.sb),Collider.ray.origin.copyFrom(Collider.Wb),Collider.ray.direction.copyFrom(Collider.qb),Collider.ray.length=1,Ray.TransformToRef(Collider.ray,Collider.matrix,Collider.ray);var r=Collider.intersectsColliderMesh(n,!1);if((n=r.pickedMesh,r.hit)&&Vector3.Distance(Collider.ray.origin,r.pickedPoint)<=s){Collider.matrix.invert();var o=Vector3.TransformCoordinates(r.pickedPoint,Collider.matrix);o.addInPlace(Collider.sb),r.pickedPoint=o;var l=Vector3.TransformCoordinates(r.normal,Collider.matrix);return{cell:a,pick:r,normal:l,dot:Vector3.Dot(t,l)}}return!1},intersectsColliderMesh:function(e,t){var i=Collider.ray.intersectsMeshes([e,...e.getChildMeshes()],t)[0];if(void 0!==i&&!0===i.hit){if(i.normal=i.getNormal(!0,!1),Vector3.Dot(Collider.ray.direction,i.normal)<0){if(!(i=Collider.ray.intersectsMesh(Collider.Ob,t)).hit)return{hit:!1};i.normal=i.getNormal(!0,!1)}else Math.abs(i.pickedPoint.x)>.5||Math.abs(i.pickedPoint.y)>.5||Math.abs(i.pickedPoint.z)>.5?(Collider.ray.origin=i.pickedPoint,(i=Collider.ray.intersectsMesh(Collider.Ob,t)).normal=i.getNormal(!0,!1)):i.normal.negateInPlace();return i}return{hit:!1}},Gb:function(e,t,i,a){for(var n=i?i.Zb.team:null,s=i?i.Zb.id:null,r=0;r<playerLimit;r++){var o=players[r];if(o&&(o.Rb||o.pauseTargetTime>0)&&o.id!=s&&(0==o.team||o.team!=n)){Collider.ray.origin.copyFrom(e),Collider.ray.direction.copyFrom(t),Collider.ray.length=1;var l=Collider.rayCollidesWithPlayerHelper(Collider.ray,o,a);l&&i&&i.collidesWithPlayer(o,l)}}return!1},rayCollidesWithPlayerHelper:function(e,t,i){var a=e.origin,n=i||.3;n*=t.scale;var s=Collider.Wb;s.copyFrom(a).addInPlace(e.direction);var r=Collider.tb;r.set(t.jb,t.Vb+.3*t.scale,t.Lb);var o=Collider.qb;o.copyFrom(e.origin),o.subtractInPlace(r);var l=Vector3.Dot(e.direction,e.direction),c=2*Vector3.Dot(e.direction,o),h=Vector3.Dot(o,o)-n*n,u=Math.pow(c,2)-4*l*h,m=Collider.Pb,d=Collider.sb;if(u<0)return!1;if(0==u)return Vector3.LerpToRef(a,s,u,m),m.subtractToRef(r,d),d.normalize(),d;var f=(-c-Math.sqrt(u))/(2*l);Math.sqrt(u);return f>=0&&f<=1&&(Vector3.LerpToRef(a,s,f,m),m.subtractToRef(r,d),d.normalize(),d)}},Collision=class e{static pointCollidesWithStructure(t){var i=e.box;i.minimumWorld.copyFrom(t),i.maximumWorld.copyFrom(t);let a=!1;return e.bvh.getObjects(i,(i=>{e.pointCollidesWithBox(t,i)&&(a=!0)})),a}static init(){e.bvh=new BVH3}static pointCollidesWithBox(t,i){var a=e.Pb,n=e.mtx2;return a.copyFrom(t),a.subtractInPlace(i.position),i.matrix.invertToRef(n),Vector3.TransformNormalToRef(a,n,a),a.x>=i.minimumWorld.x&&a.x<=i.maximumWorld.x&&a.y>=i.minimumWorld.y&&a.y<=i.maximumWorld.y&&a.z>=i.minimumWorld.z&&a.z<=i.maximumWorld.z}static add(t){e.bvh.add(t)}static sphereCollidesWithBox(t,i,a,n,s){var r=e.Pb,o=e.sb,l=e.mtx2;if(r.copyFrom(t),r.subtractInPlace(a.position),a.matrix.invertToRef(l),Vector3.TransformNormalToRef(r,l,r),Vector3.ClampToRef(r,a.minimumWorld,a.maximumWorld,o),(c=Vector3.Distance(r,o))<i){o.subtractInPlace(r),Vector3.TransformNormalToRef(o,a.matrix,o),o.addInPlace(t),o.subtractInPlace(a.position),Vector3.ClampToRef(o,e.vmin,e.vmax,o),o.addInPlace(a.position);var c=Vector3.Distance(t,o);if(o.subtractInPlace(t).normalize(),c<(i*=.16*Math.abs(o.y)+.84))return s.copyFrom(o),o.scaleInPlace(c-i-.001),n.copyFrom(o),!0}return!1}static sphereCollidesWithStructure(t,i,a,n){var s=e.box,r=e.Wb,o=e.qb;s.minimumWorld.copyFrom(t),s.minimumWorld.x-=i,s.minimumWorld.y-=i,s.minimumWorld.z-=i,s.maximumWorld.copyFrom(t),s.maximumWorld.x+=i,s.maximumWorld.y+=i,s.maximumWorld.z+=i,a.copyFromFloats(0,0,0);var l=0,c=!1;return e.bvh.getObjects(s,(s=>{e.sphereCollidesWithBox(t,i,s,r,o)&&(o.y<-.707&&(r.y=r.length(),r.x=0,r.z=0),r.length()>a.length()&&(a.copyFrom(r),n.copyFrom(o),c=s),l++)})),l>0&&c}};Collision.Wb=new Vector3,Collision.qb=new Vector3,Collision.Pb=new Vector3,Collision.sb=new Vector3,Collision.tb=new Vector3,Collision.Qb=new Vector3,Collision.gb=new Vector3,Collision.mtx1=new Matrix,Collision.mtx2=new Matrix,Collision.vmin=new Vector3(-.5,-.5,-.5),Collision.vmax=new Vector3(.5,.5,.5),Collision.box=new BoundingBox(Vector3.Zero(),Vector3.Zero()),Collision.Type={full:1,wedge:2,iwedge:4,aabb:8,obb:16,ladder:32},Collision.aabbMask=Collision.Type.full|Collision.Type.aabb|Collision.Type.ladder;var GameOptions=class{static getDefaults(){let e={gravity:1,damage:1,healthRegen:1,flags:0,weaponDisabled:new Array(G.classes.length)};return e.weaponDisabled.fill(!1),e}static setToDefaults(){this.value=this.getDefaults()}static isSelectedWeaponDisabled(e){return!this.areAllWeaponsDisabled()&&this.value.weaponDisabled[e]}static init(){this.value=this.getDefaults()}static serialize(){var e=kKPwUxS.getBuffer();return e.BkKPwUxd(BkKPwUww.C),e.BkKPwUxd(4*this.value.gravity),e.BkKPwUxd(4*this.value.damage),e.BkKPwUxd(4*this.value.healthRegen),e.BkKPwUxd(this.value.flags),this.value.weaponDisabled.forEach((t=>{e.BkKPwUxd(t?1:0)})),e}static set(e){this.value=e}static parse(e=!0){let t=KPwUxH.unPackInt8U(),i=KPwUxH.unPackInt8U(),a=KPwUxH.unPackInt8U(),n=KPwUxH.unPackInt8U(),s=G.classes.map((()=>1===KPwUxH.unPackInt8U()));return!!e&&((t<1||t>4)&&(t=4),(i<0||i>8)&&(i=4),a>16&&(a=4),this.value={gravity:t/4,damage:i/4,healthRegen:a/4,flags:n,weaponDisabled:s},!0)}static usingDefaults(){let e=this.getDefaults(),t=!0;return Object.keys(e).forEach((i=>{let a=this.value[i];if("flags"===i&&(a^=a&GameFlags.locked),a instanceof Array){for(let n=0;n<a.length;n++)if(a[n]!==e[i][n])return void(t=!1)}else if(a!==e[i])return void(t=!1)})),t}static areAllWeaponsDisabled(){return!!this.value&&!this.value.weaponDisabled.includes(!1)}},GameFlags={locked:1,noTeamChange:2,noTeamShuffle:4},GameActions={reset:1,pause:2};function Grenade(e){this.dmgTypeId=DmgType.findIndex((e=>"Grenade"===e.name)),this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.fb=0,this.ttl=0,this.resting=!1,this.active=!1,this.Zb=null,this.wb=new GrenadeActor(this)}Grenade.Wb=new Vector3,Grenade.qb=new Vector3,Grenade.Pb=new Vector3,Grenade.sb=new Vector3,Grenade.matrix=new Matrix,Grenade.prototype.update=function(){if(this.ttl<=0)this.remove();else{if(!this.resting){var e=this.dx,t=this.dy,i=this.fb,a=.5*(this.dx+e),n=.5*(this.dy+t),s=.5*(this.fb+i);Math.length3(a,n,s);this.collidesWithMap()||(this.x+=a,this.y+=n,this.z+=s,this.dy-=.012*GameOptions.value.gravity),this.dx*=.96,this.fb*=.96}this.ttl-=1}},Grenade.prototype.remove=function(){munitionsManager.grenadePool.recycle(this),this.wb.remove()},Grenade.prototype.collidesWithMap=function(){Grenade.Wb.set(this.x,this.y-.07,this.z),Grenade.qb.set(this.dx,this.dy,this.fb),Grenade.Pb.set(this.dx,this.dy,this.fb);var e=Collider.ub(Grenade.Wb,Grenade.qb,Collider.grenadeCollidesWithCell);if(e){if(!(1==e.normal.y&&Grenade.Pb.length()<.05))return Grenade.Pb.subtractInPlace(e.normal.scale(1.6*e.dot)),this.dx=.98*Grenade.Pb.x,this.dy=Grenade.Pb.y,this.fb=.98*Grenade.Pb.z,this.wb.bounce(),e;this.resting=!0}return!1},Grenade.prototype.throw=function(e,t,i){this.Zb=e,this.x=t.x,this.y=t.y,this.z=t.z,this.dx=i.x,this.dy=i.y,this.fb=i.z,this.ttl=75,this.damage=150,this.radius=3,this.resting=!1,this.active=!0,this.wb.throw()};var Gun=class{equip(e){this.Zb.rb=this.Zb.equipWeaponIdx,this.Zb.ib=this.Zb.weapons[this.Zb.rb],this.Zb.ib.wb.equip(e),this.Zb.id==meId&&updateAmmoUi(),this.Zb.lastWeaponChange=0}collectAmmo(){return this.ammo.store=Math.min(this.ammo.kb,this.ammo.store+this.ammo.pickup),!0}constructor(e){this.dmgTypeId=0,this.Zb=e,this.scene=this.Zb.scene,this.highPrecision=!1,this.equipTime=13,this.stowWeaponTime=13,this.accuracy=this.constructor.ab,this.shootingAccuracy=this.constructor.ab,this.movementAccuracy=this.constructor.ab,this.ab=this.constructor.ab,this.Db=this.constructor.Db,this.ob=this.constructor.ob,this.accuracyRecover=this.constructor.accuracyRecover,this.tracer=0,this.burstQueue=0,this.adsMod=this.constructor.adsMod||.5,this.movementAccuracyMod=this.constructor.movementAccuracyMod||1}update(){this.burstQueue>0&&(this.burstQueue%this.constructor.burstRof==0&&this.fire(),this.burstQueue--),this.Zb.scope&&0===this.Zb.scopeDelay?this.accuracyMod=this.adsMod:this.accuracyMod=1;let e=14.41*Math.length2(this.Zb.dx,this.Zb.fb),t=Math.min(1,14.41*Math.abs(this.Zb.dy)),i=this.constructor.reloadBloom&&this.Zb.reloadCountdown>0||this.Zb.swapWeaponCountdown>0||this.Zb.Ib>0,a=this.Zb.scope&&0===this.Zb.scopeDelay,n=(e+t+(i?1:0))*this.constructor.Db;this.movementAccuracy<n?this.movementAccuracy=n:this.movementAccuracy=Math.max(this.movementAccuracy-this.constructor.accuracyRecover,n),a?(this.ab=this.constructor.ab*this.adsMod,this.Db=this.constructor.Db*this.adsMod,this.ob=this.constructor.ob*this.adsMod):(this.ab=this.constructor.ab,this.Db=this.constructor.Db,this.ob=this.constructor.ob),this.accuracyRecover=Math.min(this.accuracyRecover+this.constructor.accuracyRecover,this.constructor.accuracyRecover);let s=Math.max(this.accuracyRecover,0);this.shootingAccuracy=Math.max(this.shootingAccuracy-s,this.ab),this.accuracy=this.movementAccuracy*this.movementAccuracyMod+this.shootingAccuracy,this.constructor.absoluteMinAccuracy&&(this.accuracy=Math.min(this.accuracy,this.constructor.absoluteMinAccuracy))}fire(){var e=Matrix.Kc(this.Zb.pb+Math.PI,-this.Zb.Jb,0),t=Matrix.Translation(0,0,this.constructor.range).multiply(e),i=t.getTranslation();this.shootingAccuracy=Math.min(this.shootingAccuracy+this.ob,this.Db),this.accuracyRecover=8*-this.constructor.accuracyRecover;let a=this.accuracy;if(isNaN(a)&&(a=0),this.constructor.burst&&this.burstQueue<=0&&(this.burstQueue=(this.constructor.burst-1)*this.constructor.burstRof),this.constructor!==DozenGauge){let e=a,i=Matrix.Kc((this.Zb.Yb.getFloat()-.5)*e,(this.Zb.Yb.getFloat()-.5)*e,(this.Zb.Yb.getFloat()-.5)*e);t=t.multiply(i)}i=t.getTranslation();var n=Matrix.Translation(0,.1,0),s=(n=(n=n.multiply(e)).add(Matrix.Translation(this.Zb.jb,this.Zb.Vb+.3*this.Zb.playerScale,this.Zb.Lb))).getTranslation();s.x=Math.floor(256*s.x)/256,s.y=Math.floor(256*s.y)/256,s.z=Math.floor(256*s.z)/256,i.x=Math.floor(256*i.x)/256,i.y=Math.floor(256*i.y)/256,i.z=Math.floor(256*i.z)/256,this.ammo.Sb--,this.Zb.id==meId&&updateAmmoUi(),this.wb.fire(),this.fireMunitions(s,i),--this.tracer<0&&(this.tracer=this.constructor.tracer)}};Gun.reloadBloom=!0,Gun.reloadTimeMod=1;var Eggk47=class e extends Gun{fireMunitions(t,i){Bullet.fire(this.Zb,t,i,e)}constructor(e,t){super(e),this.ammo={Sb:30,Fc:30,reload:30,store:240,kb:240,pickup:30},this.longReloadTime=205,this.shortReloadTime=160,this.wb=new Eggk47Actor(this,t)}};Eggk47.dmgTypeId=DmgType.findIndex((e=>"Eggk47"===e.name)),Eggk47.weaponName="EggK-47",Eggk47.Ab="eggk47",Eggk47.rof=3,Eggk47.recoil=7,Eggk47.automatic=!0,Eggk47.damage=20,Eggk47.totalDamage=20,Eggk47.range=20,Eggk47.velocity=1.5,Eggk47.tracer=1;var DozenGauge=class e extends Gun{constructor(e,t){super(e),this.ammo={Sb:2,Fc:2,reload:2,store:24,kb:24,pickup:8},this.longReloadTime=155,this.shortReloadTime=155,this.Wb=new Vector3,this.wb=new DozenGaugeActor(this,t)}fireMunitions(t,i){for(var a=this.accuracy,n=.6*a,s=0;s<20;s++)this.Wb.set(i.x+this.Zb.Yb.getFloat(-a,a)*e.range,i.y+this.Zb.Yb.getFloat(-n,n)*e.range,i.z+this.Zb.Yb.getFloat(-a,a)*e.range),Bullet.fire(this.Zb,t,this.Wb,e)}};DozenGauge.dmgTypeId=DmgType.findIndex((e=>"Scrambler"===e.name)),DozenGauge.weaponName="Dozen Gauge",DozenGauge.Ab="dozenGauge",DozenGauge.rof=8,DozenGauge.recoil=10,DozenGauge.automatic=!1,DozenGauge.damage=8,DozenGauge.totalDamage=20*DozenGauge.damage,DozenGauge.range=8,DozenGauge.velocity=1,DozenGauge.tracer=0;var CSG1=class e extends Gun{fireMunitions(t,i){Bullet.fire(this.Zb,t,i,e)}constructor(e,t){super(e),this.ammo={Sb:15,Fc:15,reload:15,store:60,kb:60,pickup:15},this.hasScope=!0,this.longReloadTime=225,this.shortReloadTime=165,this.highPrecision=!0,this.wb=new CSG1Actor(this,t)}};CSG1.dmgTypeId=DmgType.findIndex((e=>"FreeRanger"===e.name)),CSG1.weaponName="CSG-1",CSG1.Ab="csg1",CSG1.rof=13,CSG1.recoil=13,CSG1.automatic=!1,CSG1.damage=110,CSG1.totalDamage=110,CSG1.range=50,CSG1.velocity=1.75,CSG1.tracer=0;var Cluck9mm=class e extends Gun{fireMunitions(t,i){Bullet.fire(this.Zb,t,i,e)}constructor(e,t){super(e),this.ammo={Sb:15,Fc:15,reload:15,store:60,kb:60,pickup:15},this.longReloadTime=195,this.shortReloadTime=160,this.wb=new Cluck9mmActor(this,t)}};Cluck9mm.dmgTypeId=DmgType.findIndex((e=>"Cluck9mm"===e.name)),Cluck9mm.weaponName="Cluck 9mm",Cluck9mm.Ab="cluck9mm",Cluck9mm.rof=4,Cluck9mm.recoil=6,Cluck9mm.automatic=!1,Cluck9mm.damage=25,Cluck9mm.totalDamage=25,Cluck9mm.range=15,Cluck9mm.velocity=1,Cluck9mm.tracer=0;var RPEGG=class e extends Gun{constructor(e,t){super(e),this.ammo={Sb:1,Fc:1,reload:1,store:3,kb:3,pickup:1},this.hasScope=!0,this.longReloadTime=170,this.shortReloadTime=170,this.wb=new RPEGGActor(this,t)}fireMunitions(t,i){Rocket.fire(this.Zb,t,i,e);for(var a=0;a<10;a++){var n=.04*Math.random()-.02,s=.04*Math.random()-.02,r=.04*Math.random()-.02;addExplosionSprite(explosionSmokeManager,10,t.x,t.y,t.z,n,s,r,.4,!1,0)}}};RPEGG.dmgTypeId=DmgType.findIndex((e=>"Rpegg"===e.name)),RPEGG.weaponName="RPEGG",RPEGG.Ab="rpegg",RPEGG.rof=40,RPEGG.recoil=60,RPEGG.automatic=!1,RPEGG.damage=140,RPEGG.radius=2.75,RPEGG.totalDamage=RPEGG.damage*RPEGG.radius*.5,RPEGG.range=45,RPEGG.minRange=3,RPEGG.velocity=.4;var SMG=class e extends Gun{constructor(e,t){super(e),this.ammo={Sb:40,Fc:40,reload:40,store:200,kb:200,pickup:40},this.longReloadTime=225,this.shortReloadTime=190,this.wb=new SMGActor(this,t)}fireMunitions(t,i){Bullet.fire(this.Zb,t,i,e)}};SMG.dmgTypeId=DmgType.findIndex((e=>"Whipper"===e.name)),SMG.weaponName="SMEGG",SMG.Ab="smg",SMG.rof=2,SMG.recoil=7,SMG.automatic=!0,SMG.damage=15,SMG.totalDamage=15,SMG.range=20,SMG.velocity=1.25,SMG.tracer=2;var M24=class e extends Gun{constructor(e,t){super(e),this.ammo={Sb:1,Fc:1,reload:1,store:12,kb:12,pickup:4},this.hasScope=!0,this.longReloadTime=144,this.shortReloadTime=144,this.wb=new M24Actor(this,t)}fireMunitions(t,i){Bullet.fire(this.Zb,t,i,e)}};M24.dmgTypeId=DmgType.findIndex((e=>"Crackshot"===e.name)),M24.weaponName="M2DZ",M24.Ab="m24",M24.rof=15,M24.recoil=20,M24.automatic=!1,M24.damage=200,M24.totalDamage=15,M24.range=60,M24.velocity=2,M24.tracer=0;var AUG=class e extends Gun{constructor(e,t){super(e),this.ammo={Sb:24,Fc:24,reload:24,store:150,kb:150,pickup:24},this.longReloadTime=205,this.shortReloadTime=160,this.wb=new AUGActor(this,t)}fireMunitions(t,i){Bullet.fire(this.Zb,t,i,e)}};AUG.dmgTypeId=DmgType.findIndex((e=>"TriHard"===e.name)),AUG.weaponName="TriHard",AUG.Ab="aug",AUG.rof=15,AUG.recoil=18,AUG.automatic=!1,AUG.movementInstability=2,AUG.damage=20,AUG.totalDamage=20,AUG.range=20,AUG.velocity=1.5,AUG.tracer=0,AUG.burst=3,AUG.burstRof=3,Eggk47.damage=30,Eggk47.ab=.03,Eggk47.Db=.15,Eggk47.ob=.05,Eggk47.accuracyRecover=.025,Eggk47.totalDamage=30,DozenGauge.damage=8.5,DozenGauge.ab=.13,DozenGauge.Db=.16,DozenGauge.ob=.17,DozenGauge.accuracyRecover=.02,DozenGauge.totalDamage=170,DozenGauge.adsMod=.6,DozenGauge.movementAccuracyMod=.2,CSG1.damage=105,CSG1.ab=.004,CSG1.Db=.3,CSG1.ob=.3,CSG1.accuracyRecover=.025,CSG1.totalDamage=105,RPEGG.ab=.015,RPEGG.Db=.3,RPEGG.ob=.3,RPEGG.accuracyRecover=.02,RPEGG.absoluteMinAccuracy=.3,SMG.damage=23,SMG.ab=.06,SMG.Db=.19,SMG.ob=.045,SMG.accuracyRecover=.05,SMG.totalDamage=23,SMG.adsMod=.6,SMG.movementAccuracyMod=.7,M24.damage=170,M24.ab=0,M24.Db=.35,M24.ob=.1,M24.accuracyRecover=.023,M24.totalDamage=170,M24.movementAccuracyMod=1.3,M24.reloadBloom=!1,M24.reloadTimeMod=.8,Cluck9mm.damage=26,Cluck9mm.ab=.035,Cluck9mm.Db=.15,Cluck9mm.ob=.09,Cluck9mm.accuracyRecover=.08,Cluck9mm.totalDamage=26,Cluck9mm.adsMod=.8,Cluck9mm.movementAccuracyMod=.6,AUG.damage=32,AUG.ab=.03,AUG.Db=.15,AUG.ob=.037,AUG.accuracyRecover=.03,AUG.totalDamage=34,AUG.adsMod=.6,AUG.movementAccuracyMod=.8;var maps=[{filename:"aqueduct",hash:"11dp765kifr",name:"Aqueduct",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"backstage",hash:"9dsromfqr1",name:"Backstage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"bastion",hash:"uuwh7401no",name:"Bastion",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"bedrock",hash:"yqbkimntiu",name:"Bedrock",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"biohazard",hash:"kzarr9ebqx",name:"BioHazard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"blender",hash:"1vvfxp9rt8u",name:"Blender",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"blue",hash:"2e7izzo70bk",name:"Blue",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"bridge",hash:"20vcy8e1ev0",name:"Bridge",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"canyon",hash:"2avqtv9ygk1",name:"Canyon",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"cash",hash:"1427gfre8ma",name:"Cash",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"castle",hash:"2d2tcz2mw7e",name:"Castle",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"castleArena",hash:"9dhs3kms6l",name:"Castle Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"8"},{filename:"catacombs",hash:"2el91jtcun0",name:"Catacombs",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"chickenItza",hash:"hyjqbat0i3",name:"Chicken Itza",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"cluckgrounds",hash:"1h9z3hj51g5",name:"Cluckgrounds",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"crossed",hash:"ead3tcf30r",name:"Crossed",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"crowsnest",hash:"1ze2s5zr9bm",name:"Crowsnest",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"8"},{filename:"deathpit",hash:"1cc9cvjf607",name:"Death Pit",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"dirt",hash:"1u3k5nfvwuh",name:"Dirt",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"dirt2",hash:"494aka3mb4",name:"Dirt 2",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"dirtbase",hash:"6e9r2y7dxk",name:"Dirt Base",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"downfall",hash:"26g5aj8aruc",name:"Downfall",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"duelPyramid",hash:"vmg0rj2e3b",name:"Duel Pyramid",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"eggcrates",hash:"j0i36e808n",name:"Eggcrates",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"6"},{filename:"enchanted",hash:"1igxtcyetaw",name:"Enchanted",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"exposure",hash:"15hv3cme1fh",name:"Exposure",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"facility",hash:"18djbmo35ru",name:"Facility",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"feedlot",hash:"iuj8rc7kyh",name:"Feedlot",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"field",hash:"e4aszuch87",name:"Field",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"fortFlip",hash:"1w1b6dkalc2",name:"Fort Flip",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"foundation",hash:"11y636vc64b",name:"Foundation",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"fourQuarters",hash:"1a0w7vbz8is",name:"Four Quarters",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"growler",hash:"1izyni7tb1e",name:"Growler",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"12"},{filename:"haunted",hash:"2dma8z1jdev",name:"Haunted",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"helix",hash:"i2sl4vsg3h",name:"Helix",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"hydro",hash:"8znnxbxfss",name:"Hydro",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"indigo",hash:"23rhtt62i3u",name:"Indigo",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"jailbreak",hash:"2a3blmd9hf4",name:"Jail Break",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"jinx",hash:"24u6pohagnj",name:"Jinx",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"junction",hash:"bkca8j2ppd",name:"Junction",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"kingsCourt",hash:"aq1t2lsjza",name:"King's Court",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"lunarmodule",hash:"1448aqjdqvl",name:"Lunar Module",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mansion",hash:"nqhtvwj3fo",name:"Mansion",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mazerunner",hash:"j16i30k9dz",name:"Maze Runner",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"metamorph",hash:"l9o69l8e1b",name:"Metamorph",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"14"},{filename:"moonbase",hash:"1yzocf1mex3",name:"Moonbase",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mudGulch",hash:"kto278skze",name:"Mud Gulch",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"nextdoor",hash:"s2i5za1kx9",name:"Nextdoor",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"outer",hash:"w1biqokp89",name:"Outer Reach",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"overcooked",hash:"29ca98hgdeh",name:"Overcooked",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"palaceSiege",hash:"1enghs5hsxe",name:"Palace Siege",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"quarry",hash:"2crjk106pa",name:"Quarry",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"queenscourt",hash:"raudy4h9pv",name:"Queen's Court",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"raceway",hash:"1a3eo6xaoju",name:"Raceway",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"rameses",hash:"177jt4j8so9",name:"Rameses",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"rats",hash:"13r2oqql8se",name:"Rats",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"relic",hash:"lxzknz53a2",name:"Relic",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"rivals",hash:"26fkvcef2h6",name:"Rivals",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"road",hash:"2h312vlocd",name:"Road",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"ruins",hash:"3ycs8z9bcu",name:"Ruins",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"scales",hash:"101v5lpkv1s",name:"Scales",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"shadyglen",hash:"2d0d4bj7aq3",name:"Shady Glen",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"shellville",hash:"fdgmkbfe7n",name:"Shellville",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"shipyard",hash:"1n1sptszksq",name:"Shipyard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"skyScratcher",hash:"1th1c8epp95",name:"Sky Scratcher",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"spaceFactory",hash:"10802a2az0f",name:"Space Factory",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"10"},{filename:"spacearena",hash:"k9zf5lqzze",name:"Space Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"14"},{filename:"sparta",hash:"274wwdyll9w",name:"Sparta",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"spellbound",hash:"1curtd0i4ls",name:"Spellbound",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"stage",hash:"1zn44r9jb3t",name:"Stage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"starship",hash:"27xerc3smw5",name:"Starship",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"staxarena",hash:"1jid8ffda0z",name:"Stax Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"teggtris",hash:"1y4rswkkv3l",name:"Teggtris",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"temple",hash:"bp6twwct9v",name:"Temple",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"timetwist",hash:"1ad75xyk2rv",name:"Timetwist",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"trainyard",hash:"2e1w70fjqet",name:"Trainyard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"treefort",hash:"14a9akanqms",name:"Tree Fort",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"twoTowers",hash:"2asidv5c0ff",name:"Two Towers",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"uncovered",hash:"bxrd0zdvtn",name:"Uncovered",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"12"},{filename:"vert",hash:"25a9ikled77",name:"Vert",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"wimble",hash:"13smnxheae1",name:"Wimble",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"wonderland",hash:"5n6ixyepvy",name:"Wonderland",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"wreckage",hash:"nkiu4z6uj1",name:"Wreckage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"yolkido",hash:"127ppvq4k6n",name:"Yolkido Garrison",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"}];function SeededRandom(){this.seed=100}Math.PI2=2*Math.PI,Math.PI90=Math.PI/2,Math.mod=function(e,t){var i=e%t;return i>=0?i:i+t},Math.length2=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},Math.length3=function(e,t,i){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(i,2))},Math.capVector2=function(e,t){var i=Math.length2(e.x,e.y);return i>t&&(e.x*=t/i,e.y*=t/i),e},Math.capVector3=function(e,t){var i=Math.length3(e.x,e.y,e.z);return i>t&&(e.x*=t/i,e.y*=t/i,e.z*=t/i),e},Math.normalize2=function(e,t){t=t||1;var i=Math.length2(e.x,e.y);return e.x*=t/i,e.y*=t/i,e},Math.normalize3=function(e,t){t=t||1;var i=Math.length3(e.x,e.y,e.z);return e.x*=t/i,e.y*=t/i,e.z*=t/i,e},Math.clamp=function(e,t,i){return Math.max(Math.min(e,i),t)},Math.radAdd=function(e,t){return Math.floor(8192*Math.mod(e+t,Math.PI2))/8192},Math.radSub=function(e,t){return Math.floor(8192*Math.mod(e-t,Math.PI2))/8192},Math.radRange=function(e){return Math.mod(e,Math.PI2)},Math.radDifference=function(e,t){var i=(e-t+Math.PI)%Math.PI2-Math.PI;return i=i<-Math.PI?i+Math.PI2:i},Math.cardVals=[0,Math.PI90,Math.PI,3*Math.PI90],Math.cardToRad=function(e){return Math.cardVals[e]},Math.randomInt=function(e,t){return Math.floor(Math.random()*(t-e)+e)},Math.diff=function(e,t,i){return e<t?i-e+t:e-t},SeededRandom.prototype.setSeed=function(e){this.seed=e},SeededRandom.prototype.getFloat=function(e,t){return e=e||0,t=t||1,this.seed=(9301*this.seed+49297)%233280,e+this.seed/233280*(t-e)},SeededRandom.prototype.getInt=function(e,t){return Math.floor(this.getFloat(e,t))};var Ease={linear:function(e){return e},inQuad:function(e){return e*e},outQuad:function(e){return e*(2-e)},inOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},inCubic:function(e){return e*e*e},outCubic:function(e){return--e*e*e+1},inOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},inQuart:function(e){return e*e*e*e},outQuart:function(e){return 1- --e*e*e*e},inOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},inQuint:function(e){return e*e*e*e*e},outQuint:function(e){return 1+--e*e*e*e*e},inOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},MeleeWeapon=class e{update(){this.collisionCountdown>0&&0==--this.collisionCountdown&&this.checkCollisions()}checkCollisions(){var t=Matrix.Kc(this.Zb.pb,this.Zb.Jb,0),i=Matrix.Translation(0,0,-.8).multiply(t);this.dir=i.getTranslation(),e.Wb.set(this.Zb.jb-.25*this.dir.x,this.Zb.Vb-.25*this.dir.y+.3,this.Zb.Lb-.25*this.dir.z),Collider.Gb(e.Wb,this.dir,this,.475)}attack(){this.collisionCountdown=5}constructor(e){this.Zb=e,this.scene=this.Zb.scene,this.collisionCountdown=0,this.dmgTypeId=DmgType.findIndex((e=>"Melee"===e.name)),e.wb&&(this.wb=new MeleeWeaponActor(this,this.Zb.meleeItem.item_data.meshName)),this.dir=new Vector3}collidesWithPlayer(e){let t=40;this.Zb.activeShellStreaks&ShellStreak.EggBreaker&&(t=255),hitPlayer(e,this,t,this.dir.x,this.dir.z)}};function MunitionsManager(e){this.bulletPool=new Pool((function(){return new Bullet(e)}),200),this.rocketPool=new Pool((function(){return new Rocket(e)}),20),this.grenadePool=new Pool((function(){return new Grenade(e)}),10)}MeleeWeapon.Wb=new Vector3,MeleeWeapon.qb=new Vector3,MunitionsManager.prototype.updateLogic=function(){this.bulletPool.forEachActive((function(e){e.update()})),this.rocketPool.forEachActive((function(e){e.update()})),this.grenadePool.forEachActive((function(e){e.update()}))},MunitionsManager.prototype.updateActors=function(e){this.bulletPool.forEachActive((function(t){t.wb.update(e)})),this.rocketPool.forEachActive((function(t){t.wb.update(e)})),this.grenadePool.forEachActive((function(t){t.wb.update(e)}))},MunitionsManager.prototype.removeAll=function(){this.bulletPool.forEachActive((function(e){e.remove()})),this.rocketPool.forEachActive((function(e){e.remove()})),this.grenadePool.forEachActive((function(e){e.remove()}))},MunitionsManager.prototype.throwGrenade=function(e,t,i){this.grenadePool.retrieve().throw(e,t,i)},MunitionsManager.prototype.getMapIntersectionPoint=function(e,t){if(t&&!mapMeshes[t.cell.idx].softness&&t.cell&&t.cell.idx){var i=mapMeshes[t.cell.idx],a=new Ray(new Vector3(e.x-e.dx-t.x-.5,e.y-e.dy-t.y-.5,e.z-e.fb-t.z-.5),new Vector3(2*e.dx,2*e.dy,2*e.fb),1);i.rotation.x=t.cell.rx,i.rotation.y=t.cell.ry,i.rotation.z=t.cell.rz;var n=a.intersectsMesh(i,!1);if(n.hit){var s=new Vector3(-e.dx,-e.dy,-e.fb).normalize().scale(.005);return{x:n.pickedPoint.x+t.x+.5+s.x,y:n.pickedPoint.y+t.y+.5+s.y,z:n.pickedPoint.z+t.z+.5+s.z}}}return!1};var CONTROL={up:1,down:2,left:4,right:8,jump:16,fire:32,melee:64,scope:128,ascend:256,descend:512};G.classes=[{name:"Soldier",ib:Eggk47},{name:"Scrambler",ib:DozenGauge},{name:"Free Ranger",ib:CSG1},{name:"Eggsploder",ib:RPEGG},{name:"Whipper",ib:SMG},{name:"Crackshot",ib:M24},{name:"TriHard",ib:AUG}];var statsProperties=["streak","kills","killsCluck9mm","killsGrenade","killsRpegg","killsEggk47","killsScrambler","killsFreeRanger","killsWhipper","killsCrackshot","killsTriHard","killsMelee","killsPrivate","killsPublic","killsKing","killsSpatula","killsTeams","killsFFA","deaths","deathsCluck9mm","deathsGrenade","deathsRpegg","deathsEggk47","deathsScrambler","deathsFreeRanger","deathsWhipper","deathsCrackshot","deathsTriHard","deathsMelee","deathsFall","deathsPrivate","deathsPublic","deathsKing","deathsSpatula","deathsTeams","deathsFFA","kotcCaptured","kotcWins"],stateBufferSize=256,fs,Loader2,Loader2,mapMeshes;function Player(e,t){this.id=e.Ub,this.Hc=e.yb,this.name=e.Bb,this.Kb=e.Cb,this.safeName=e.Hb,this.charClass=e.Fb,this.team=e.Eb,this.primaryWeaponItem=e.Nb,this.secondaryWeaponItem=e.nb,this.shellColor=e.Mb,this.hatItem=e.Tb,this.stampItem=e.eb,this.stampPositionX=e.undefinedb,this.stampPositionY=e.undefinedb,this.grenadeItem=e.cz,this.meleeItem=e.bz,this.jb=e.jb,this.Vb=e.Vb,this.Lb=e.Lb,this.dx=e.xz,this.dy=e.lz,this.fb=e.Xz,this.hz=e.hz,this.pb=e.pb,this.Jb=e.Jb,this.speed=0,this.scope=!1,this.scopeDelay=0,this.primaryWeaponDisabled=!1,this.reloading=!1,this.fz=e.Zz,this.lifetimeDeaths=e.wz,this.totalKills=0,this.mz=0,this.Wz=e.qz,this.bestOverallStreak=e.Pz,this.stats={},statsProperties.forEach((t=>{this.stats[t]=e.uz[t]})),this.gameData=e.iz,this.shield=e.Gz,this.Oz=e.Oz,this.sz=0,this.Rb=e.dz,this.rb=e.tz,this.upgradeProductId=e.Rz,this.mobileMultiplier=1,this.isGameOwner=e.jz,this.capturing=!1,this.kotcCapturing=!1,this.activeShellStreaks=e.Vz,this.Lz=0,this.eggBreakerValue=0,this.ksEggMuliplierValue=0,this.skMiniEggValue=0,this.playerScale=1,this.shellStreakIncrement=450,this.adminRoles=e.Qz,this.muted=e.gz,this.scene=t,this.corrected={dx:0,dy:0,fb:0,Jb:0,pb:0},this.corrections=0,this.totalCorrections=2,this.resetCountdowns(),this.equipWeaponIdx=this.rb,this.kz=1,this.az=3,this.lastWeaponChange=0,this.jumpQueued=0,this.Dz=!1,this.onGround=4,this.oz=!1,this.bobble=0,this.stateIdx=0,this.serverStateIdx=0,this.respawnTargetTime=0,this.pauseTargetTime=0,this.ready=!1,this.chatLines=0,this.respawnQueued=!1,this.canTakeTeamBonus=!0,this.changingCharacter=!1,this.lastDamageTakenType=0,this.lastDamageGivenType=0,this.lastDmgType=0,this.lastPosition={x:this.jb,y:this.Vb,z:this.Lb},this.firstUpdate=!0,this.damageMod=e.Iz,this.abBucket=e.pz,this.aBTestInventoryReady=!1,this.wb=new PlayerActor(this),this.changeWeaponLoadout(this.primaryWeaponItem,this.secondaryWeaponItem),this.Jz=[],this.resetStateBuffer(),this.Yb=new SeededRandom,this.social=e.Yz,this.hideBadge=e.Sz,this.challengesActive=[],this.challengeKills=[],this.challengeDeaths=[],this.challengeKotc=[],this.challengeFfa=[],this.challengeCts=[],this.challengeTimed={alive:[],played:[],cts:[],kotc:[],kill:[]},this.challengesDelayedChecks=[],this.eggsEarned=0,this.timers={alive:0,played:0,cts:0,kotc:0,kill:0},this.distanceTime=Date.now(),this.dmgGiven=0,this.distanceTraveled=0,this.timesJumped=0,this.jumps=0,this.ammoCollected=[0,0],this.cstCapturingTime=0,this.ctsControlled=!1,this.streakCtsKills=0,this.teamPoints=0,this.challengesGet(e.challengesActive),this.shellStreakMsg=""}Player.Wb=new Vector3,Player.qb=new Vector3,Player.Pb=new Vector3,Player.sb=new Vector3,Player.tb=new Vector2,Player.Qb=new Vector2,Player.gb=new Vector3,Player.Az=new Vector3,Player.ray=new Ray,Player.matrix=new Matrix,Player.prototype.ctsCapture=function(e){this.ctsControlled=e===this.Hc},Player.prototype.changeWeaponLoadout=function(e,t){this.weapons&&(this.weapons[0].wb.dispose(),this.weapons[1].wb.dispose(),this.meleeWeapon.wb.dispose()),this.meleeWeapon=new MeleeWeapon(this),this.primaryWeaponItem=e,this.secondaryWeaponItem=t,this.weapons=[e.instantiateNew(this),t.instantiateNew(this)],this.ib=this.weapons[this.rb],this.ib.wb.equip()},Player.prototype.Uz=function(e){var t=0,i=0,a=0;if(e||this.id!=meId||(this.hz=controlKeys),!this.wb||this.id!=meId){var n=this.stateIdx;n=Math.min(n,FramesBetweenSyncs-1),this.hz=this.Jz[n].hz,this.pb=this.Jz[n].pb,this.Jb=this.Jz[n].Jb,this.playerScale=this.Jz[n].scale,this.Jz[n].hz=0}(m=this.Jz[this.stateIdx]).hz=this.hz,m.pb=this.pb,m.Jb=this.Jb,m.scale=this.playerScale,this.hz&CONTROL.left&&(t-=Math.cos(this.pb),a+=Math.sin(this.pb)),this.hz&CONTROL.right&&(t+=Math.cos(this.pb),a-=Math.sin(this.pb)),this.hz&CONTROL.up&&(this.oz?i+=1:(t-=Math.sin(this.pb),a-=Math.cos(this.pb))),this.hz&CONTROL.down&&(this.oz?i-=1:(t+=Math.sin(this.pb),a+=Math.cos(this.pb))),this.hz&CONTROL.jump&&(this.jumpQueued=10,this.hz^=this.hz&CONTROL.jump,this.id==meId&&(controlKeys^=controlKeys&CONTROL.jump)),this.hz&CONTROL.scope?this.scope||this.scopeIn():this.scope&&this.scopeOut(),this.jumpQueued>0&&(this.jumpQueued--,this.jump());let s=this.scope&&0===this.scopeDelay;if(this.oz){this.setJumping(!1);var r=this.dy;this.corrections&&(r+=this.corrected.dy/this.totalCorrections,this.corrections--),this.dy+=.028*i;var o=.5*(this.dy+r);this.Vb+=o,this.dy*=.5,Math.floor(this.Vb)>=map2.height&&(this.oz=!1),this.move(0,o,0)}else{var l=new Vector3(t,i,a).normalize();s&&(l.x*=.5,l.z*=.5),this.dx+=.025*l.x,this.fb+=.025*l.z,this.dy-=.012*GameOptions.value.gravity,this.dy=Math.max(-.29,this.dy);var c=Player.sb;if(c.copyFromFloats(this.jb,this.Vb,this.Lb),this.move(this.dx,this.dy,this.fb),this.dx=this.jb-c.x,this.dy=this.Vb-c.y,this.fb=this.Lb-c.z,this.onGround&&this.dy>0){var h=1-.5*Player.gb.copyFromFloats(this.dx,this.dy,this.fb).normalize().y;this.dx*=h,this.fb*=h}if(!e&&this.corrections){let e=0,t=this.corrected.dx/this.totalCorrections;this.oz&&(e=this.corrected.dy/this.totalCorrections);let i=this.corrected.fb/this.totalCorrections;this.corrections--,this.move(t,e,i)}}if(!e){this.shield>0&&this.Rb&&(this.shield-=2,(0!=t||0!=i||this.shield<=0)&&this.disableShield()),this.scopeDelay=Math.max(0,this.scopeDelay-1),this.lastWeaponChange++;var u=Math.max(0,Math.length3(this.dx,this.dy,this.fb)-.012);this.speed=u,(this.oz||this.Dz)&&(u*=2),this.bobble=(this.bobble+7*(u+.01))%Math.PI2,this.ib&&this.ib.update(),this.meleeWeapon.update(),this.meleeCountdown>0&&0==--this.meleeCountdown&&(this.id==meId&&this.hz&CONTROL.melee?this.inspectMelee():(this.swapWeaponCountdown=.5*this.ib.equipTime,this.wb.wieldGun(),this.id===me&&reticle.show())),this.inspectMeleeCountdown>0&&0==--this.inspectMeleeCountdown&&(this.swapWeaponCountdown=.5*this.ib.equipTime,this.wb.wieldGun(),this.id===me&&reticle.show()),this.updateHealth(),this.swapWeaponCountdown>0&&(this.swapWeaponCountdown--,this.swapWeaponCountdown<=0&&this.id==meId&&reticle.show()),this.timers.alive++,this.timers.played++,this.timers.played%30==0&&this.challengeChecksDelay(),this.ctsControlled&&this.challengeCts.length>0?this.timers.cts++:this.timers.cts=0,this.kotcCapturing&&this.challengeKotc.length>0?this.timers.kotc++:this.timers.kotc=0,this.reloadCountdown>0&&(this.lastWeaponChange=0,this.reloadCountdown-=2,this.reloadCountdown<=0&&(this.reloadCountdown=0,this.reloaded())),this.rofCountdown>0&&(this.rofCountdown=Math.max(this.rofCountdown-1,0)),this.recoilCountdown>0&&(this.recoilCountdown=Math.max(this.recoilCountdown-2,0)),this.Ib>0&&(this.Ib-=2),this.id==meId&&(this.triggerPulled&&this.fire(),this.shellStreakTimers()),this.stateIdx=Math.mod(this.stateIdx+1,stateBufferSize);var m=this.Jz[this.stateIdx];this.saveState(m),ws&&this.id==meId&&me.stateIdx%FramesBetweenSyncs==0&&ws.readyState==ws.OPEN&&me.Rb&&!freezeFrame&&serverSync()}if(this.dx*=.64,this.fb*=.64,this.oz&&(this.dy*=.64),this.wb&&this.id==meId||(this.reloadsQueued>0&&this.reload(),this.weaponSwapsQueued>0&&this.swapWeapon(this.equipWeaponIdx)),!this.wb&&this.Vb<-10){let e=DmgType.findIndex((e=>"Fall"===e.name));this.lastDmgType=e,this.die(),metaGame.scoreKill(this,this);var d=kKPwUxS.getBuffer();d.BkKPwUxd(BkKPwUww.uc),d.BkKPwUxd(this.id),d.BkKPwUxd(this.id),d.BkKPwUxd(8),d.BkKPwUxd(e),d.BkKPwUxd(e),sendToAll(d)}},Player.prototype.saveState=function(e){e.jb=this.jb,e.Vb=this.Vb,e.Lb=this.Lb,e.dx=this.dx,e.dy=this.dy,e.fb=this.fb,e.Dz=this.Dz,e.oz=this.oz,e.rb=this.rb,e.Sb=this.ib.ammo.Sb,e.store=this.ib.ammo.store},Player.prototype.move=function(e,t,i){var a,n=Player.Wb,s=Player.Az,r=Player.qb,o=Player.Pb;if(this.onGround=Math.max(--this.onGround,0),this.Vb+=.31,s.copyFromFloats(e,t,i),Math.capVector3(s,.29),n.copyFromFloats(this.jb,this.Vb,this.Lb),n.addInPlace(s),n.x=Math.clamp(n.x,.1,map2.width-.1),n.z=Math.clamp(n.z,.1,map2.depth-.1),this.firstUpdate)this.distanceTraveled=0,this.firstUpdate=!1;else{let e=Math.sqrt((n.x-this.lastPosition.x)*(n.x-this.lastPosition.x)+(n.y-this.lastPosition.y)*(n.y-this.lastPosition.y)+(n.z-this.lastPosition.z)*(n.z-this.lastPosition.z));this.onGround>0&&e>.01&&(this.distanceTraveled+=e)}this.lastPosition.x=n.x,this.lastPosition.y=n.y,this.lastPosition.z=n.z;for(var l=0;l<8;l++){var c=Collision.sphereCollidesWithStructure(n,.31,r,o);if(!c)break;o.y<-.707&&(this.onGround=4),this.oz||c.colliderType&Collision.Type.ladder&&this.tryToClimbLadder(c,o),n.addInPlace(r),this.onGround&&(this.Dz?(this.setJumping(!1),this.dy=0):this.hz&CONTROL.down&&(this.oz=!1))}if(8==l&&(s.scaleInPlace(.9),n.subtractInPlace(s)),this.jb=n.x,this.Vb=n.y,this.Lb=n.z,!this.oz||this.wb&&this.id!=meId){u=Math.floor(this.jb);var h=Math.floor(this.Vb);m=Math.floor(this.Lb);if(this.Rb)if(a=getMapCellAt(u,h,m))a.zone||(this.capturing=!1,this.timers.kotc=0);if(a=getMapCellAt(u,Math.floor(this.Vb-.5),m)){let e=a.mesh;e&&"jump-pad"==e.shortName&&this.canJump()&&Math.length2(u+.5-this.jb,m+.5-this.Lb)<.3&&(this.Vb+=.26,this.setJumping(!0))}}else{var u=this.climbX,m=this.climbZ;this.oz=!1,this.capturing=!1,(a=getMapCellAt(u,Math.floor(this.Vb-.25),m))&&Math.floor(a.ry/Math.PI90)==this.climbRY&&a.mesh&&"ladder"==a.mesh.colliderType&&(this.oz=!0),(a=getMapCellAt(u,Math.floor(this.Vb+.25),m))&&Math.floor(a.ry/Math.PI90)==this.climbRY&&a.mesh&&"ladder"==a.mesh.colliderType&&(this.oz=!0)}this.Vb-=.31},Player.prototype.tryToClimbLadder=function(e,t){if(this.hz&CONTROL.up&&!(Math.abs(e.position.y-(this.Vb+.18))>.9)){var i=Math.round(this.pb/Math.PI90)%4,a=e.cell.ry;if(i==a||(i+2)%4==a){var n=Player.tb.set(t.x,t.z).normalize(),s=Player.Qb.set(-Math.cos(this.pb),Math.sin(this.pb)),r=Vector2.Dot(s,n);Math.abs(r)<.4&&(this.oz=!0,this.climbX=Math.clamp(Math.floor(e.position.x),0,map2.width-1),this.climbZ=Math.clamp(Math.floor(e.position.z),0,map2.depth-1),this.climbRY=e.cell.ry,this.dy=0,this.setJumping(!1))}}},Player.prototype.scopeIn=function(){this.isAtReady()&&(this.ib.wb&&this.ib.wb.restPose(),this.wb.wieldingMelee&&this.wb.wieldGun(),this.scope=!0,this.scopeDelay=7)},Player.prototype.scopeOut=function(){this.scope=!1},Player.prototype.disableShield=function(){this.shield=0,this.wb.Bz.renderOverlay=!1,this.wb.hands.renderOverlay=!1},Player.prototype.Kz=function(){this.shield=120,this.wb.Bz.overlayColor=Player.OverlayColor.green,this.wb.hands.overlayColor=Player.OverlayColor.green,this.wb.Bz.renderOverlay=!0,this.wb.hands.renderOverlay=!0},Player.prototype.resetStateBuffer=function(){for(var e=0;e<stateBufferSize;e++)this.Jz[e]={pb:this.pb,Jb:this.Jb,fire:!1,Dz:this.Dz,oz:this.oz,jb:this.jb,Vb:this.Vb,Lb:this.Lb,dx:this.dx,dy:this.dy,fb:this.fb,hz:this.hz,shots:0,Sb:[0,0],store:[0,0],scale:this.playerScale}},Player.prototype.canJump=function(){return this.oz|this.onGround},Player.prototype.jump=function(){this.oz&&(this.dy=.065,this.oz=!1,this.setJumping(!0)),this.canJump()&&(this.dy=.13,this.scope&&0===this.scopeDelay&&(this.dy*=.66),this.setJumping(!0))},Player.prototype.setJumping=function(e){this.jumpQueued=!1,this.onGround=0,e&&!this.Dz&&this.jumps++,this.Dz=e,this.Jz[this.stateIdx].Dz=e},Player.prototype.changeCharacter=function(e,t,i,a,n,s,r,o,l,c){var h=function(e,t){return e&&!t||!e&&t||null!==e&&null!==t&&e.id!==t.id};(e!==this.charClass||t.id!==this.primaryWeaponItem.id||i.id!==this.secondaryWeaponItem.id||a!==this.shellColor||h(this.hatItem,n)||h(this.stampItem,s)||this.grenadeItem!==l||this.meleeItem!==c||this.stampPositionX!=r||this.stampPositionY!=o)&&(this.charClass=e,this.primaryWeaponItem=t,this.secondaryWeaponItem=i,this.shellColor=a,this.hatItem=n,this.stampItem=s,this.stampPositionX=r,this.stampPositionY=o,this.grenadeItem=l,this.meleeItem=c,this.wb.setShellColor(a),this.wb.setStampPosition(r,o),this.id!==meId&&(this.wb.wearHat(this.hatItem),this.wb.applyStamp(this.stampItem),this.wb.setStampPosition(this.stampPositionX,this.stampPositionY)),this.changeWeaponLoadout(t,i))},Player.prototype.swapWeapon=function(e){if(this.primaryWeaponDisabled)return!1;if(this.wb&&this.id!=meId||this.canSwapOrReload()&&e<2){if(this.equipWeaponIdx=e,this.releaseTrigger(),this.swapWeaponCountdown=this.ib.stowWeaponTime+this.weapons[e].equipTime,this.id==meId&&reticle.hide(),this.wb.wieldingMelee=!1,this.ib.wb.stow(),this.id==meId){var t=kKPwUxS.getBuffer();t.BkKPwUxd(BkKPwUww.W),t.BkKPwUxd(e),t.send(ws)}return!0}return!1},Player.prototype.collectItem=function(e,t){switch(e){case ItemManager.AMMO:return!!this.weapons[t].collectAmmo()&&(this.ammoCollected[e]++,pAudio.play("pickup",this.wb.Bz.absolutePosition,this.id==meId),updateAmmoUi(),!0);case ItemManager.GRENADE:return this.kz<this.az&&(this.kz++,this.ammoCollected[e]++,pAudio.play("pickup",this.wb.Bz.absolutePosition,this.id==meId),updateAmmoUi(),!0)}},Player.prototype.isAtReady=function(){return!(!(this.Rb&&this.ib&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.Ib<=0&&this.meleeCountdown<=0)||this.wb&&0!=grenadePowerUp)},Player.prototype.canMelee=function(){return!!(this.Rb&&this.ib&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&(this.wb||this.Ib<=0)&&this.shotsQueued<=0)},Player.prototype.canSwapOrReload=function(){return!(!(this.Rb&&this.ib&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.Ib<=0&&this.shotsQueued<=0&&this.meleeQueued<=0)||this.wb&&0!=grenadePowerUp)},Player.prototype.fire=function(){this.shield>0?this.releaseTrigger():this.isAtReady()&&this.rofCountdown<=0&&(this.ib.ammo.Sb>0?(this.recoilCountdown=this.ib.constructor.recoil,this.rofCountdown=this.ib.constructor.rof,this.wb.fire(),this.ib.fire(),this.id==meId&&(this.Jz[this.stateIdx].shots++,this.lastWeaponChange=0),0==this.ib.constructor.automatic&&this.releaseTrigger()):(this.shotsQueued=0,this.ib.wb.dryFire(),this.releaseTrigger()))},Player.prototype.pullTrigger=function(){if(1==grenadePowerUp&&me.Ib<=0)this.Cz();else if(this.isAtReady()&&this.rofCountdown<=0)return this.ib.ammo.Sb>0?(this.triggerPulled=!0,this.fire()):this.ib.ammo.store>0?this.reload():this.ib.wb.dryFire(),!0;return!1},Player.prototype.releaseTrigger=function(){this.triggerPulled=!1,this.ib.tracer=0},Player.prototype.melee=function(){if(1==grenadePowerUp&&me.Ib<=0&&this.Cz(),this.shield>0||!this.canMelee())return!1;this.meleeCountdown=17,this.recoilCountdown=40,this.id===meId&&reticle.hide(),this.wb.melee();var e=kKPwUxS.getBuffer();return e.BkKPwUxd(BkKPwUww.bc),e.send(ws),this.meleeWeapon.attack(),!0},Player.prototype.inspectMelee=function(){return this.inspectMeleeCountdown=60,this.wb.inspectMelee(),this.id===meId&&reticle.hide(),!0},Player.prototype.reload=function(){if(this.id==meId){if(this.ib.ammo.Sb==this.ib.ammo.Fc||0==this.ib.ammo.store||!this.canSwapOrReload())return!1;var e=Math.min(Math.min(this.ib.ammo.Fc,this.ib.ammo.reload)-this.ib.ammo.Sb,this.ib.ammo.store);this.roundsToReload=e,this.scopeOut(),this.reloading=!0,this.id===meId&&reticle.hide(),this.ib.wb.reload(),this.wb.wieldingMelee&&this.wb.wieldGun(),this.releaseTrigger();var t=kKPwUxS.getBuffer();return t.BkKPwUxd(BkKPwUww.Rc),t.send(ws),0==this.ib.ammo.Sb?this.reloadCountdown=this.ib.longReloadTime:this.reloadCountdown=this.ib.shortReloadTime,!0}this.ib.wb.reload()},Player.prototype.reloaded=function(){var e=this.ib.ammo;e.Sb+=this.roundsToReload,e.store-=this.roundsToReload,this.reloading=!1,this.id==meId&&(reticle.show(),updateAmmoUi())},Player.prototype.Cz=function(){grenadePowerUp=!1,me.Ib=30,this.id==meId&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),this.wb.gripBone._frozen=!1},Player.prototype.throwGrenade=function(){this.shield>0&&this.disableShield();var e=kKPwUxS.getBuffer();e.BkKPwUxd(BkKPwUww.zc),e.ABkKPwUyW(Math.clamp(grenadeThrowPower,0,1)),e.send(ws),me.Ib=80,this.wb.reachForGrenade()},Player.prototype.removeFromPlay=async function(){this.ksRemoveFromPlay(),this.Rb=!1,this.hz=0,this.Dz=!1,this.jumpQueued=0,this.scope=!1,this.oz=!1,this.Lz=0,this.playerScale=1,this.activeShellStreaks=0,this.pauseTargetTime=0,this.lastDmgType=0,this.dmgGiven=0,this.distanceTraveled=0,this.jumps=0,this.ammoCollected=[0,0],this.streakCtsKills=0,this.meleeWeapon.collisionCountdown=0,this.firstUpdate=!0,this.sz=0,this.wb.removeFromPlay(),this.id==meId&&resetPlayerUI()},Player.prototype.setStats=function(e){let t=this.gameData.private?"Private":"Public";this.stats[e+t]++;let i=e+GameTypes[this.gameData.gameType].shortName;this.stats[i]++;let a=e+DmgType[this.lastDmgType].name;"deaths"!==e&&(a=e+DmgType[this.lastDamageGivenType].name),this.stats[a]++},Player.prototype.resetStats=function(){return Object.keys(this.stats).forEach((e=>{if("streak"!=e)return this.stats[e]=0}))},Player.prototype.scoreKill=function(){this.stats.kills++,this.totalKills++,this.scoreKillStreak(),this.scoreKillCts(),this.setStats("kills"),this.lastDmgType=0},Player.prototype.scoreKillCts=function(){this.ctsControlled&&this.streakCtsKills++},Player.prototype.scoreKillStreak=function(){this.stats.streak++,this.Wz=Math.max(this.Wz,this.stats.streak),this.bestOverallStreak=Math.max(this.bestOverallStreak,this.stats.streak),this.fz=this.stats.streak,this.killStreakIncrementer()},Player.prototype.killStreakIncrementer=function(){[{streak:ShellStreak.EggBreaker,value:"eggBreakerValue"},{streak:ShellStreak.MiniEgg,value:"skMiniEggValue"},{streak:ShellStreak.DoubleEggs,value:"ksEggMuliplierValue"}].forEach((e=>{this.activeShellStreaks&e.streak&&(this[e.value]=Math.min(this[e.value]+90,this.shellStreakIncrement))}))},Player.prototype.resetKsTypes=function(e){var t=kKPwUxS.getBuffer();t.BkKPwUxd(BkKPwUww.Oc),t.BkKPwUxd(this.id),t.BkKPwUxd(e),sendToAll(t)},Player.prototype.ksRemoveFromPlay=function(){[["eggBreakerValue",ShellStreak.EggBreaker],["ksEggMuliplierValue",ShellStreak.DoubleEggs],["skMiniEggValue",ShellStreak.MiniEgg]].forEach((([e,t])=>{this[e]&&(this[e]=0)}))},Player.prototype.checkAndEndShellStreak=function(e,t){this[e]&&--this[e]<=0&&(this.endShellStreak(t),this.resetKsTypes(t))},Player.prototype.updateShellStreaks=function(){this.checkAndEndShellStreak("eggBreakerValue",ShellStreak.EggBreaker),this.checkAndEndShellStreak("ksEggMuliplierValue",ShellStreak.DoubleEggs),this.checkAndEndShellStreak("skMiniEggValue",ShellStreak.MiniEgg)},Player.prototype.kotcStatScoreCapture=function(){this.stats.kotcCaptured++,this.challengeKotcCheck({type:1})},Player.prototype.kotcStatScoreWin=function(){this.stats.kotcWins++,this.challengeKotcCheck({type:2})},Player.prototype.die=function(){this.fz=0,this.stats.streak=0,this.stats.deaths++,this.mz++,this.streakCtsKills=0,this.reloading=!1,this.setStats("deaths"),this.lastDmgType=0,this.Oz=0,this.removeFromPlay(),this.timers.alive=0},Player.prototype.aBTestInventoryCheck=function(){this.lifetimeDeaths++,this.abBucket&&this.mz>2&&this.lifetimeDeaths<15&&(this.aBTestInventoryReady=!0)},Player.prototype.beginShellStreak=function(e){e!==ShellStreak.EggBreaker&&e!==ShellStreak.HardBoiled&&e!==ShellStreak.DoubleEggs&&e!==ShellStreak.MiniEgg||(this.activeShellStreaks|=e);const t={[ShellStreak.HardBoiled]:()=>{this.shellStreakHardBoiled()},[ShellStreak.EggBreaker]:()=>{this.shellStreakEggBreaker()},[ShellStreak.Restock]:()=>{this.shellStreakRestock()},[ShellStreak.OverHeal]:()=>{this.shellStreakOverHeal()},[ShellStreak.DoubleEggs]:()=>{this.shellStreakEggMuliplier()},[ShellStreak.MiniEgg]:()=>{this.shellStreakMiniEgg()}};t[e]&&t[e](),this.wb.beginShellStreak(e)},Player.prototype.endShellStreak=function(e){e!==ShellStreak.EggBreaker&&e!==ShellStreak.HardBoiled&&e!==ShellStreak.DoubleEggs&&e!==ShellStreak.MiniEgg||(this.activeShellStreaks&=~e);let t=null;const i={[ShellStreak.HardBoiled]:()=>{this.Lz=0,t="shellstreak_end"},[ShellStreak.EggBreaker]:()=>{t="shellstreak_end"},[ShellStreak.DoubleEggs]:()=>{this.sz=0,t="ks_double_eggs_end"},[ShellStreak.MiniEgg]:()=>{this.playerScale=1,t="sk_egg_grow"}};i[e]&&(i[e](),t&&pAudio.play(t,this.wb.Xb.position,!0)),this.wb.endShellStreak(e)},Player.prototype.shellStreakEggBreaker=function(){this.shellStreakMsg="EGG BREAKER",pAudio.play("shellstreak_start",this.wb.Xb.position,!0),this.eggBreakerValue=450},Player.prototype.shellStreakHardBoiled=function(){this.shellStreakMsg="HARD BOILED",pAudio.play("shellstreak_start",this.wb.Xb.position,!0),this.Lz=100},Player.prototype.shellStreakRestock=function(){this.resetAmmoGrenade(!0),this.shellStreakMsg="RESTOCK",pAudio.play("ks_reload",this.wb.Xb.position,!0)},Player.prototype.shellStreakOverHeal=function(){this.Oz=Math.min(200,this.Oz+100),this.shellStreakMsg="MORE HEALTH",pAudio.play("ks_overheal",this.wb.Xb.position,!0)},Player.prototype.shellStreakEggMuliplier=function(){this.ksEggMuliplierValue=this.shellStreakIncrement,this.sz=2,this.shellStreakMsg="DOUBLE EGGS",pAudio.play("ks_double_eggs_start",this.wb.Xb.position,!0)},Player.prototype.shellStreakMiniEgg=function(){this.skMiniEggValue=this.shellStreakIncrement,this.playerScale=.5,pAudio.play("ks_egg_shrink",this.wb.Xb.position,!0),this.shellStreakMsg="SMALL EGG SPLATTER"},Player.prototype.updateShellStreakTimer=function(e,t,i,a){this.activeShellStreaks&i&&(e[t]=Math.max(0,e[t]-1));var n=Math.floor(e[t]/30),s=document.getElementById(a);null!==s&&n!=parseInt(s.innerText)&&(s.innerText=n)},Player.prototype.shellStreakTimers=function(){this.updateShellStreakTimer(this,"eggBreakerValue",ShellStreak.EggBreaker,"shellStreak-egg-breaker-timer"),this.updateShellStreakTimer(this,"ksEggMuliplierValue",ShellStreak.DoubleEggs,"shellStreak-double-eggs-timer"),this.updateShellStreakTimer(this,"skMiniEggValue",ShellStreak.MiniEgg,"shellStreak-shrink-timer")},Player.prototype.updateHealth=function(){const e=.1*GameOptions.value.healthRegen;this.Oz>0&&(this.Oz>100?this.Oz=Math.max(100,this.Oz-e):this.Oz=Math.min(100,this.Oz+e))},Player.prototype.respawn=function(e,t,i){this.pb=Math.floor(Math.random()*Math.PI2*8192)/8192,this.Jb=0,this.jb=e,this.Vb=t,this.Lb=i,this.dx=0,this.dy=0,this.fb=0,this.respawnQueued=!1,this.Rb=!0,this.onGround=4,this.oz=!1,this.Dz=!1,this.hz=0,this.capturing=!1,this.weapons[0].burstQueue=0,this.Oz<=0?(this.Oz=100,this.resetWeaponState()):this.resetWeaponState(!0),this.id==meId&&(viewingPlayerId=meId),this.corrections=0,this.wb.resetLerp(),this.wb.restoreToPlay(),this.ib.equip(),this.id==viewingPlayerId&&(shake=0,reticle.show(),reticle.showDot(),updateAmmoUi()),this.Kz(),this.resetStateBuffer()},Player.prototype.resetWeaponState=function(e){this.resetCountdowns(),this.releaseTrigger(),GameOptions.areAllWeaponsDisabled()?(this.primaryWeaponDisabled=!0,this.rb=1):(this.primaryWeaponDisabled=!1,this.rb=0),this.equipWeaponIdx=this.rb,this.ib=this.weapons[this.rb],this.weapons[0].wb.Fz.setEnabled(!1),this.weapons[1].wb.Fz.setEnabled(!1),this.resetAmmoGrenade(!1);var t=this.weapons[0];t.burstQueue=0,t.constructor.burst&&(t.ammo.Sb=Math.ceil(t.ammo.Sb/t.constructor.burst)*t.constructor.burst,t.ammo.store=Math.ceil(t.ammo.store/t.constructor.burst)*t.constructor.burst)},Player.prototype.resetAmmoGrenade=function(e){for(var t=0;t<this.weapons.length;t++)this.weapons[t]&&(this.weapons[t].ammo.Sb=this.weapons[t].ammo.Fc,this.weapons[t].ammo.store=this.weapons[t].ammo.kb);this.updateGrenadeCount(e),updateAmmoUi()},Player.prototype.updateGrenadeCount=function(e){this.kz=e?Math.min(3,Math.max(this.kz,3)):Math.max(this.kz,1)},Player.prototype.isDead=function(){return this.Oz<=0},Player.prototype.resetCountdowns=function(){this.rofCountdown=0,this.triggerPulled=!1,this.shotsQueued=0,this.meleeQueued=0,this.meleeCountdown=0,this.inspectMeleeCountdown=0,this.roundsToReload=0,this.recoilCountdown=0,this.reloadCountdown=0,this.reloadsQueued=0,this.swapWeaponCountdown=0,this.weaponSwapsQueued=0,this.Ib=0,this.grenadesQueued=0},Player.prototype.getChallengeData=function(e){const t=this.challengesActive.filter((t=>t.id===e));if(t.length>0)return t.length>0?t[0]:null},Player.prototype.challengeCheckComplete=async function(e){if(null!=e&&"function"==typeof e[Symbol.iterator])for(const t of e){if(!t.didComplete)continue;const e=kKPwUxS.getBuffer();e.BkKPwUxd(BkKPwUww.yc),e.BkKPwUxd(this.id);const i=this.getChallengeData(t.data.challengeId);null!==i&&i.isComplete()&&(e.BkKPwUxd(i.id),sendToAll(e))}},Player.prototype.challengeResetProps=function(){this.dmgGiven=0,this.distanceTraveled=0,this.timesJumped=0,this.jumps=0,this.ammoCollected=[0,0],this.timers.played=0,this.timers.timePlayed=0,this.teamPoints=0},Player.prototype.challengeKill=async function(e){const{player:t,playerHit:i}=e;Object.assign(t,{kills:this.stats.kills,streak:this.stats.streak,ib:this.lastDamageGivenType,spatula:this.ctsControlled,streakCtsKills:this.streakCtsKills});const a=[this.challengeCheck([t,i,this.timers],this.challengeKills),this.challengeCtsCheck()],[n,s]=await Promise.all(a),r=[...n,...s].filter((e=>void 0!==e));this.teamPoints=0,await this.challengeCheckComplete(r)},Player.prototype.challengeDeath=async function(e){if(!e.player||!e.playerHit)return void console.error("Invalid player data provided.");const t=await this.challengeCheck([e.player,e.playerHit],this.challengeDeaths);this.challengeCheckComplete(t)},Player.prototype.challengeKotcCheck=async function(e){if(this.challengeKotc.length>0){const t=await this.challengeCheck(e,this.challengeKotc);this.challengeCheckComplete(t)}},Player.prototype.challengeCtsCheck=async function(){return this.challengeCts.length>0?this.challengeCheck({timer:this.timers.cts,teamPoints:this.teamPoints},this.challengeCts):[]},Player.prototype.challengeChecksDelay=async function(){if(this.challengesDelayedChecks.length>0){const e=await this.challengeCheck({streak:this.stats.streak,timers:this.timers,kills:this.stats.kills,dmgGiven:this.dmgGiven,distance:this.distanceTraveled,jumps:this.jumps,ammo:this.ammoCollected,cstTimer:this.timers.cts,teamPoints:this.teamPoints,ctsCon:this.ctsControlled},this.challengesDelayedChecks);this.challengeResetProps(),await this.challengeCheckComplete(e)}},Player.prototype.challengeCheck=async function(e,t){if(this.wb)return void console.log("Challenge check aborted: actor is present");const i=t.map((async t=>{const i=this.challengesActive.find((e=>e.challenge.id===t.challengeId));return i?i.updateData(e):(console.log("Challenge not found:",t.challengeId),null)}));return(await Promise.all(i)).filter((e=>void 0!==e))},Player.prototype.challengeCompleted=function(e){challengeCompleted(e)},Player.prototype.challengesReset=function(){this.challengesActive=[],this.challengeKills=[],this.challengeDeaths=[],this.challengeKotc=[],this.challengeFfa=[],this.challengeCts=[],this.challengesDelayedChecks=[],this.challengeTimed={alive:[],played:[],cts:[],kotc:[],kill:[]}},Player.prototype.challengesReroll=async function(e){if(!e.length)return;const t=[];try{for(let i=0;i<e.length;i++)t.push(await parent.getPlayerChallenges({playerId:this.dbId,challengeId:e[i]}));setTimeout((()=>{t.length&&(this.challengesReset(),this.challengesGet(t))}),100)}catch(e){console.error("Error fetching challenges:",e)}},Player.prototype.challengesGet=async function(e){if(this.wb)return;const t=new Map(Challenges.map((e=>[e.id,e])));for(const i of e){const e=t.get(i.challengeId)||null;if(!e){console.log("Player challenge init failed, unknown challenge id:",i.challengeId);continue}const a=await playerChallengeSet(e,i);if(!a){console.log("Player challenge empty:",i.challengeId);continue}a.init();const n=ChallengeType[a.challenge.type],s=ChallengeSubType[a.challenge.subType],r=ChallengeConditions[a.challenge.conditional];({kills:()=>this.challengeKills.push(i),deaths:()=>this.challengeDeaths.push(i),timed:()=>{this.challengesDelayedChecks.push(i)},cts:()=>{this.challengeCts.push(i),"kills"===s&&this.challengeKills.push(i),this.challengesDelayedChecks.push(i)},ffa:()=>{this.challengeFfa.push(i),this.challengesDelayedChecks.push(i)},kotc:()=>{"kills"===r?this.challengeKills.push(i):this.challengeKotc.push(i),this.challengesDelayedChecks.push(i)},collect:()=>{this.challengesDelayedChecks.push(i)}}[n]||(()=>{this.challengesDelayedChecks.push(i)}))(),this.challengesActive.push(a)}},Player.prototype.selectedWeaponAllowed=function(){return!!GameOptions.areAllWeaponsDisabled()||!GameOptions.value.weaponDisabled[this.charClass]};try{fs=__require("fs"),Loader2=void 0}catch(e){Loader2=window.Loader}void 0===Loader2&&(Loader2={addTask:()=>{},progress:()=>{},finish:()=>{}});var duplicateWarningIssued=!1,numCaptureZones;function makeBarrier(e,t,i){var a=MeshBuilder.Mc(e,{size:1},t),n=new StandardMaterial("",t,!0);return n.diffuseColor=i,n.emissiveColor=i,n.specularColor=Color3.Black(),n.wireframe=!0,a.material=n,a.setEnabled(!1),a}function loadMapMeshes(e,t){(mapMeshes=[null]).push(makeBarrier("SPECIAL.barrier.full.verysoft",e,new Color3(1,0,0))),mapMeshes.push(makeBarrier("SPECIAL.barrier.full",e,new Color3(0,1,0))),mapMeshes.push(makeBarrier("SPECIAL.barrier.none",e,new Color3(1,1,1)));for(var i=[],a=0;a<=1;a+=.125){var n=-Math.PI/2+Math.PI*a,s=Math.cos(n),r=.5*Math.sin(n+.05)+.5;s=.25*Math.pow(s,1.3),r=.6*Math.pow(r,1.3)-.48,i.push(new Vector3(s,r,0))}var o=MeshBuilder.xb("SPECIAL.spawn-blue.none",{shape:i,tessellation:12},e);(l=new StandardMaterial("",e,!0)).diffuseColor=new Color3(0,.5,1),l.specularColor=new Color3(.1,.2,.4),l.specularPower=8,o.material=l,o.setEnabled(!1),mapMeshes.push(o);var l;o=MeshBuilder.xb("SPECIAL.spawn-red.none",{shape:i,tessellation:12},e);(l=new StandardMaterial("",e,!0)).diffuseColor=new Color3(1,.25,.25),l.specularColor=new Color3(.4,.3,.3),l.specularPower=8,o.material=l,o.setEnabled(!1),mapMeshes.push(o),loadMeshes(e,["map"],(function(e){e.parent||"__root__"==e.name?e.freezeWorldMatrix():mapMeshes.push(e)}),(function(){for(var e=1;e<mapMeshes.length;e++){var i=mapMeshes[e].getChildMeshes()[0];i&&(mapMeshes[e].colliderMesh=i)}t()}))}function loadObjectMeshes(e,t,i){loadMeshes(e,["egg","gun_eggk47","gun_csg1","gun_cluck9mm","gun_dozenGauge","gun_rpegg","gun_smg","gun_m24","gun_aug","munitions","muzzleFlash","items","reticle","melee"],null,t,i)}function loadItemObjectMeshes(e,t,i){loadMeshes(e,["egg","gun_eggk47","gun_csg1","gun_cluck9mm","gun_dozenGauge","gun_rpegg","gun_smg","gun_m24","gun_aug","melee","munitions"],null,t,i)}function loadSounds(e){BAWK.load("sound/sounds.json?"+version).then((()=>e()))}function loadMaterials(e){var t=Shader.bullet("bullet",e);(t=new ShaderMaterial("map",e,{vertexSource:"\nprecision highp float;\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec3 normal;\n\nuniform mat4 worldViewProjection;\nuniform mat4 shadowMat;\n\nvarying vec4 vPositionFromLight;\nvarying vec4 vColor;\nvarying float vNormalZ;\n\nvoid main() {\n    vec4 p = vec4(position, 1.);\n    vPositionFromLight = shadowMat * p;\n\tvColor = pow(color, vec4(vec3(0.5), 1.));\n\tvNormalZ = normal.y;\n    gl_Position = worldViewProjection * p;\n}\n\t\t",fragmentSource:"\nprecision highp float;\n\nuniform sampler2D shadowSampler;\n\nvarying vec4 vPositionFromLight;\nvarying vec4 vColor;\nvarying float vNormalZ;\n\nvoid main() {\n    vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tdepth = 0.5 * depth + vec3(0.5);\n\tvec2 uv = depth.xy;// + vec2(1. / 30.);\n    float s = texture2D(shadowSampler, uv).x;\n\n    if (depth.z < s) {\n        s = 1.;\n    } else {\n        s = clamp((depth.z - s) * 80., 0.5, 1.0);\n        s = min(1.0, max(s, length(vPositionFromLight.xy)));\n        s = mix(1., s, vNormalZ);\n    }\n\n    gl_FragColor = vColor * vec4(vec3(s), 1.);\n}\n\t\t"},{attributes:["position","color","normal"],uniforms:["worldViewProjection","shadowMat"],samplers:["shadowSampler"]})).onBind=function(e){var t=e.material.getEffect();t.setMatrix("shadowMat",shadowGen.getTransformMatrix()),t.setTexture("shadowSampler",shadowGen.getShadowMapForRendering())},t=Shader.standard("standard",e),t=Shader.instanced("standardInstanced",e),(t=Shader.shell("shell",e)).onBind=function(e){var t=e.material.getEffect();t.setFloat("u_hp",e.hp),t.setColor3("u_customColor",e.shellColor),t.setDirectColor4("u_teamColor",e.teamColor),t.setFloat2("u_stampPosition",e.stampPositionX,e.stampPositionY),t.setVector2("u_stampOffset",e.stampOffset)},(t=Shader.standard("emissive",e)).onBind=function(e){e.material.getEffect().setColor3("u_emissiveColor",e.emissiveColor)},t=Shader.colorized("colorized",e),(t=new StandardMaterial("wireframe",e,!0)).wireframe=!0,(t=new StandardMaterial("normalBackface",e,!0)).diffuseColor=new Color3(.5,.5,.5),t.ambientColor=new Color3(.5,.5,.5),t.specularColor=new Color3(0,0,0),t.backFaceCulling=!1,t.twoSidedLighting=!0,(t=new StandardMaterial("muzzleFlash",e,!0)).emissiveColor=Color3.White(),(t=new StandardMaterial("ui",e,!0)).disableLighting=!0,t.emissiveColor=Color3.White(),t.fogEnabled=!1}function loadMeshes(e,t,i,a,n){var s=t.length,r=this,o=e.getMaterialByName("standard");e.useRightHandedSystem=!0;for(var l=0,c=0,h=0;h<s;h++){var u=n?"models/full/":"models/",m=t[h]+".glb";m+="?"+version;let d=Loader2.addTask();!function(e,t,n){SceneLoader.ImportMesh("",e,t,n,(function(e,n,h,u){for(var m=0;m<e.length;m++){var f=e[m];if("__root__"!==f.name){if(f.animations=u,"egg"==f.name&&l++,"hands"==f.name){c++;for(let e of f.animations)if(e.name.startsWith("grenade"))for(let t=0;t<e._targetedAnimations.length;t++){let i=e._targetedAnimations[t];if("gripHand"===i.target.name){let e=i.animation;e.enableBlending=!0,e.blendingSpeed=0}}}!duplicateWarningIssued&&(l>1||c>1)&&(duplicateWarningIssued=!0,alert("Duplicate egg and/or hand models detected in "+t+".\n\nOpen the weapon models in Blender and make sure egg/hands layers are turned off, then re-export.")),f.setMaterial&&f.setMaterial(o),f.material=o,f.setEnabled(!1),f.isPickable=!1,f.rotationQuaternion&&(f.rotation=f.rotationQuaternion.toEulerAngles(),f.rotationQuaternion=null),"__root__"===f.parent.name&&(f.parent=void 0)}i&&i(f)}0==--s&&a&&a.call(r),Loader2.finish(d)}),(function(e){d=Loader2.progress(d,e.loaded,e.total)}))}(u,m,e)}}function promiseloadMeshes(e,t,i,a){return new Promise((n=>{var s=t.length,r=e.getMaterialByName("standard");e.useRightHandedSystem=!0;for(var o=0,l=0,c=!1,h=0;h<s;h++){var u=a?"models/full/":"models/",m=t[h]+".glb";m+="?"+version;let d=Loader2.addTask();!function(e,t,a){SceneLoader.ImportMesh("",e,t,a,(function(e,a,h,u){for(var m=0;m<e.length;m++){var f=e[m];if("__root__"!==f.name){if(f.animations=u,"egg"==f.name&&o++,"hands"==f.name){l++;for(let e of f.animations)if(e.name.startsWith("grenade"))for(let t of e._targetedAnimations)if("gripHand"===t.target.name){let e=t.animation;e.enableBlending=!0,e.blendingSpeed=0}}!c&&(o>1||l>1)&&(c=!0,alert("Duplicate egg and/or hand models detected in "+t+".\n\nOpen the weapon models in Blender and make sure egg/hands layers are turned off, then re-export.")),f.setMaterial&&f.setMaterial(r),f.material=r,f.setEnabled(!1),f.isPickable=!1,f.rotationQuaternion&&(f.rotation=f.rotationQuaternion.toEulerAngles(),f.rotationQuaternion=null),f.parent&&"__root__"===f.parent.name&&(f.parent=void 0)}i&&i(f)}0==--s&&n(!0),Loader2.finish(d)}),(function(e){d=Loader2.progress(d,e.loaded,e.total)}))}(u,m,e)}}))}var invalidCaptureZones=[];function buildMapData(e){Collision.init(),(map2={width:minMap.width,height:minMap.height+1,depth:minMap.depth,surfaceArea:minMap.surfaceArea}).data=make3DArray(map2.width,map2.height,map2.depth),numCaptureZones=0;for(var t={},i=1;i<mapMeshes.length;i++){var a=mapMeshes[i];t[a.name]=i}var n={};"undefined"==typeof window&&(spawnPoints=[[],[],[]]),Object.keys(minMap.data).forEach((function(e){var i=minMap.data[e],a=t[e],s=mapMeshes[a];if(a){var r,o,l,c=e.split(".");if(s.theme=c[0],s.shortName=c[1],s.colliderType=c[2],s.softness=c[3],"undefined"==typeof window&&"SPECIAL"==s.theme){if(s.shortName.startsWith("spawn")){for(let e of i)spawnPoints[0].push({x:e.x,y:e.y,z:e.z}),"spawn-blue"==s.shortName?spawnPoints[Team.blue].push({x:e.x,y:e.y,z:e.z}):spawnPoints[Team.red].push({x:e.x,y:e.y,z:e.z});return}if("spatula"==s.shortName){for(let e of i)spatulaSpawnPoints.push({x:e.x+.5,y:e.y+.1,z:e.z+.5});return}}switch(s.colliderType){case"full":r=Collider.Ob,o=!1,l=!1;break;case"wedge":r=Collider.wedgeCollisionMesh,o=!0,l=!1;break;case"iwedge":r=Collider.iwedgeCollisionMesh,o=!0,l=!1;break;case"ladder":r=s.colliderMesh,o=!1,l=!1;break;case"aabb":r=s.colliderMesh,o=!1,l=!0;break;case"obb":r=s.colliderMesh,o=!0,l=!0}for(let e of i){void 0===e.ry&&(e.ry=0);var h=e.rx*Math.PI90||0,u=e.ry*Math.PI90||0,m=e.rz*Math.PI90||0;map2.data[e.x][e.y][e.z]={item:void 0,mesh:s,idx:a,colliderMesh:r,colliderPrecise:o,colliderChildren:l,colliderMatrix:Matrix.Kc(-u,h,m),rx:h,ry:u,rz:m},r&&addColliderMesh(r,Collision.Type[s.colliderType],e)}if("capture-zone"==s.shortName)for(let e of i)if(!map2.data[e.x][e.y][e.z].zone){var d;e.zone=++numCaptureZones,map2.data[e.x][e.y][e.z].zone=e.zone,0==e.y&&(console.log("INVALID ZONE",e),invalidCaptureZones.push(e.zone));do{d=0;let t=[{x:-1,z:0},{x:1,z:0},{x:0,z:-1},{x:0,z:1}];for(let a of i)if(!map2.data[a.x][a.y][a.z].zone)for(let i of t){let t=getMapCellAt(a.x+i.x,a.y,a.z+i.z);if(t&&t.zone==e.zone){d++,a.zone=e.zone,map2.data[a.x][a.y][a.z].zone=e.zone;break}}}while(d>0)}}else n[e]=!0}));var s="";return Object.keys(n).forEach((function(e){s+=e+"\n"})),""!=s&&(console.log("buildMapData error",s),e&&e(s)),t}var temprot=new Vector3,temppos=new Vector3;function addColliderMesh(e,t,i){var a=i.rx*Math.PI90||0,n=i.ry*Math.PI90||0,s=i.rz*Math.PI90||0;temppos.copyFrom(e.position),temprot.copyFrom(e.rotation),e.unfreezeWorldMatrix(),e.rotation.copyFromFloats(0,0,0),e.computeWorldMatrix(!0);var r=e.getBoundingInfo().boundingBox.minimumWorld.clone(),o=e.getBoundingInfo().boundingBox.maximumWorld.clone(),l=new BoundingBox(r,o);l.matrix=Matrix.Kc(temprot.y,temprot.x,temprot.z),Matrix.RotationYawPitchRollToRef(n,a,s,Collider.matrix),l.matrix.multiplyToRef(Collider.matrix,l.matrix),l.position=new Vector3(i.x+.5,i.y+.5,i.z+.5),l.colliderType=t,l.cell=i;var c=new BoundingBox(new Vector3(i.x,i.y,i.z),new Vector3(i.x+1,i.y+1,i.z+1));l.bb=c,l.name=e.name;for(var h=e.getChildMeshes(),u=0;u<h.length;u++)h[u].rotationQuaternion=null;Collision.add(l),e.position.copyFrom(temppos),e.rotation.copyFrom(temprot),e.freezeWorldMatrix();for(h=e.getChildMeshes(),u=0;u<h.length;u++)addColliderMesh(h[u],t,i)}function make3DArray(e,t,i,a){for(var n=Array(e),s=0;s<e;s++){n[s]=Array(t);for(var r=0;r<t;r++){n[s][r]=Array(i);for(var o=0;o<i;o++)n[s][r][o]=a||{}}}return n}function getMapCellAt(e,t,i){return e<0||e>map2.width-1||i<0||i>map2.depth-1||t<0||t>map2.height-1?null:map2.data[e][t][i]}function Rocket(e){this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.fb=0,this.active=!1,this.Zb=null,this.damage=150,this.origin=new Vector3,this.direction=new Vector3,this.end=new Vector3,this.dmgTypeId="",this.wb=new RocketActor(this)}function Spatula(e,t){this.scene=e,this.init(t),this.lastControlTeam=255,this.wb=new SpatulaActor(this,e)}function isBadWord(e){var t=(e=" "+(e=e.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[\u2018\u2019\u201A\u201B]/g,"'").replace(/[\u201C\u201D\u201E\u201F]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/[\u00A0\u2007\u202F]/g," ").replace(/[\u00B4]/g,"'").replace(/[\u02C6]/g,"^").replace(/[\u02DC]/g,"~").replace(/[\u00B5]/g,"u").replace(/[\u00D7]/g,"x").replace(/[\u00F7]/g,"/"))+" ").toLowerCase().replace(/[^a-zA-Z0-9|!\|@|$|;|\xa1]/g,"").replace(/6|g/g,"9").replace(/b/g,"6").replace(/\||l|i|1|;|\xa1/g,"!").replace(/e/g,"3").replace(/a|@/g,"4").replace(/o/g,"0").replace(/s|\$/g,"5").replace(/t/g,"7").replace(/z/g,"2").replace(/7h3|my|y0ur|7h3!r|h!5|h3r/g,""),i=t.search(/( 94y | 455 )/),a=/(n421|5chu72574ff3!|n994|m457ur647|m4r!c4|n!qq4|fck|cn7|57urm4673!!un9|!uf7w4ff3|k!4n|66c|n993r|n!443r|n!99r|m4y473|64ch!ch4|64ch!ch3|c474!uf0|fr4nchu7|fr!j0!3r0|9464ch0|94chup!n|m0r0m!3rd4|54!74mur05|pu74|j0d3r|m0n90|c0n0|c4r4j0|m!3rd4|20rr4|chup4m3!|cu!0|p3nd3j0|c46r0n|0r70|pu70|p!r06|qu33f|455h47|ch04d|cum|k0ck|k0ch|pu74|n!94|n3993r|4fr!c4n|kn336r0|5ch00!5h007|n!qq3r|73rr0r!5t|qu33r|d!ck|w4nk|p!55|7357!c|735735|64!!5|nu75|nu72|j3w|k!k3|r374r|4u7!5|d0wn55|6006|8d|p0rn|5w4!!0w|347m3|347my|d!k|0r4!|5p0093|fuk|j!2|5u!c!d|m4573r6|5p0063|5p3rm|p3nu5|pu55y|6u7753x|fux|6u77h0!3|4n4!|4nu5|k!!!b!4ck5|murd3rb!4ck5|h!7!3r|w3764ck|49!n4|94y|455h0!3|5uck|j3w|5p!c|ch!nk|n!994|n!993|n!663|n!994|n!664|5h!7|6!7ch|fuck|cun7|kkk|wh0r3|f49|7w47|p3n!|r4p3w0m|r4p39!r|r4p!57|r4p3r|r4p3|r4p!n|n!93r|!d!07|c0ck|dum6|5!4v3|7!75|@|455|pu5y|ju!cy|nud3|fk|v!49r4|64n9|53x|h03|d473|h473|d47!n9|d473r|h4ck|h4ck3r|h4ck!n9|60yfr!3nd|9!r!fr!3nd|900k|gf|bf|m0nk3y|m0nk!35|d4ddy|5!u7|pr057!7u7|nud3|33m4!!|d!ckh34d|r374rd|n4993r|n0993r|4d0!f|kn339r0w|6umh0!3|c0kk|cuck|!3573r|!5r43!|p4!357!n3|ph!!3|n3994|f4ck|pr3d470r|pn!5|n!95|fr!ck|m0!3573r|n!94rd!y|m0!357|73rr0r!57|5h!4d|60!!0ck5|7r4n5|64!!649|n!9993r|ky5|60yfr!3nd|9!r!fr!3nd|d0uch3|pu55!35|57473f4rm|5fn37w0rk|n!gh4|5fc|n3g3r|53q|!u57|g3757473)/g,n=(t=t.replace(/ /g,"")).search(a),s=(t=t.replace(/(.)(?=\1)/g,"")).search(a);return i>-1||n>-1||s>-1}function generateRandomName(){var e,t=["Captain","Lord","Supreme","Master","Pro","Noob"],i=["Egg","Yolk","Shell","Cluck","Chick","Bird"];do{e=Math.randomInt(1,99)}while(69==e);return 0==Math.randomInt(0,2)?t[Math.randomInt(0,t.length)]+i[Math.randomInt(0,i.length)]+e:i[Math.randomInt(0,i.length)]+t[Math.randomInt(0,t.length)]+e}Rocket.position=new Vector3,Rocket.fire=function(e,t,i,a){munitionsManager.rocketPool.retrieve().fireThis(e,t,i,a)},Rocket.prototype.fireThis=function(e,t,i,a){this.x=t.x,this.y=t.y,this.z=t.z,this.origin.set(this.x,this.y,this.z),this.direction.copyFrom(i).normalize().scaleInPlace(a.velocity),this.dx=this.direction.x,this.dy=this.direction.y,this.fb=this.direction.z,this.radius=a.radius,this.Zb=e,this.weaponClass=a,this.damage=a.damage,this.active=!0,this.range=a.range,this.minRange=a.minRange,this.velocity=a.velocity,this.dmgTypeId=a.dmgTypeId;var n=Collider.ub(t,i,Collider.projectileCollidesWithCell);n&&(this.end.copyFrom(n.pick.pickedPoint),this.range=Vector3.Distance(t,n.pick.pickedPoint)),this.wb.fire()},Rocket.prototype.remove=function(){munitionsManager.rocketPool.recycle(this),this.wb.remove()},Rocket.prototype.update=function(){if(Rocket.position.set(this.x,this.y,this.z),this.range<this.velocity&&this.direction.scaleInPlace(this.range/this.velocity),!Collider.Gb(Rocket.position,this.direction,this)){this.x+=this.dx,this.y+=this.dy,this.z+=this.fb;var e=this.velocity;return this.range-=e,this.minRange-=e,this.range<=0?(this.x-=this.dx,this.y-=this.dy,this.z-=this.fb,void(this.minRange<=0?this.explode():this.poof())):void 0}},Rocket.prototype.collidesWithPlayer=function(e){this.minRange<=0?this.explode():this.poof()},Rocket.prototype.explode=function(){this.remove()},Rocket.prototype.poof=function(){Rocket.position.set(this.x,this.y,this.z),pAudio.play("gun_rpegg_rocket_poof",Rocket.position);for(var e=0;e<10;e++){var t=.2*Math.random()-.1,i=.2*Math.random()-.1,a=.2*Math.random()-.1;addExplosionSprite(explosionSmokeManager,10,this.x,this.y,this.z,t,i,a,.4,!1,0)}this.remove()},Spatula.prototype.init=function(e){this.x=e.x,this.y=e.y,this.z=e.z,this.dx=0,this.dy=0,this.fb=0,this.vz=255,this.controlledByTeam=255},Spatula.prototype.capture=function(e){var t;me.id==e.id&&((t=document.getElementById("spatulaPlayer")).classList.remove("drop"),t.classList.add("capture"));e.team!=this.lastControlTeam&&(metaGame.teamScore[e.team]=0),this.vz=e.id,this.controlledByTeam=e.team,this.lastControlTeam=e.team,e.ctsCapture(e.Hc),this.wb.capture(e),BAWK.play("capture_spatula"),(t=document.getElementById("teamScoreNum"+e.team)).innerText=metaGame.teamScore[e.team]},Spatula.prototype.drop=function(){var e=players[this.vz];e.ctsCapture(!1),this.vz=255,this.controlledByTeam=255,this.x=e.jb,this.y=e.Vb,this.z=e.Lb,this.dy=e.dy+.05;var t=document.getElementById("spatulaPlayer");t.classList.remove("capture"),t.classList.add("drop"),this.wb.drop()},Spatula.prototype.respawn=function(){var e=spatulaSpawnPoints.length,t=spatulaSpawnPoints[Math.randomInt(0,e)];this.init(t);let i=kKPwUxS.getBuffer();metaGame.packState(i),sendToAll(i)},Spatula.prototype.update=function(){this.dy-=.012*GameOptions.value.gravity,this.dy=Math.max(-.29,this.dy);var e=Spatula.tb;e.copyFromFloats(this.x,this.y,this.z),this.move(this.dx,this.dy,this.fb),this.dx=this.x-e.x,this.dy=this.y-e.y,this.fb=this.z-e.z},Spatula.prototype.move=function(e,t,i){if(255==this.vz){let e=Spatula.Wb,t=Spatula.qb,i=Spatula.Pb,n=Spatula.sb;this.y+=.31,n.copyFromFloats(0,this.dy,0),Math.capVector3(n,.29),e.copyFromFloats(this.x,this.y,this.z),e.addInPlace(n),e.x=Math.clamp(e.x,.1,map2.width-.1),e.z=Math.clamp(e.z,.1,map2.depth-.1);for(var a=0;a<8;a++){if(!Collision.sphereCollidesWithStructure(e,.31,t,i))break;i.y<-.707&&(this.dy=0),t.x=0,t.z=0,e.addInPlace(t)}8==a&&(n.scaleInPlace(.9),e.subtractInPlace(n)),this.x=e.x,this.y=e.y,this.z=e.z}else{var n=players[this.vz];n&&(this.x=n.jb+.3*Math.sin(n.pb),this.y=n.Vb,this.z=n.Lb+.3*Math.cos(n.pb))}this.y-=.31},Spatula.Wb=new Vector3,Spatula.qb=new Vector3,Spatula.Pb=new Vector3,Spatula.sb=new Vector3,Spatula.tb=new Vector3,Spatula.prototype.collidesWithMap=function(){return Spatula.Wb.set(this.x,this.y,this.z),Collider.meshCollidesWithMap(Collider.playerCollisionMesh,Spatula.Wb)};var ABTestNoobInventory=class{addItemToInventory(){this.rewardedItem&&G.playerAccount.addToInventory(this.rewardedItem,!0)}giveStuffPopupData(){vueApp.giveStuffPopup.titleLoc="a"===this.testGroup?"play_now":this.locGiveGrenade,vueApp.giveStuffPopup.abTest=this.testGroup}isTestGroup(){const e=aBInventory.getAssignedVariant();return e&&"control"!==e}doReward(){this.giveStuffPopupData(),api_giveItemReward("abTestReward",(()=>{this.completeTest(),vueApp.showGiveStuffPopup("abTestReward_title",0,[this.rewardedItem],"abTestReward")}))}setRewards(e,t=0){this.rewardedEggs=t,this.rewardedItem=e?G.catalog.findItemById(e):null}gaTestComplete(){ga("set","ABTestGroup",`${this.testName}_complete_${this.testGroup}`)}tryReward(){this.isEligible()&&this.doReward()}init(){aBInventory=new ABTest(AbTestPercentage,this.testName,`${this.testName}_user`,426),this.rewardedItem=G.catalog.findItemById(this.itemId)}isTestClosed(){return aBInventory.getCookie(`${this.testName}_closed_${this.testGroup}`)||vueApp.abTestInventory.closed}controlDeathTrackingCheck(){return!!aBInventory.getCookie(this.controlDeathTrackName)}tryTest(){if(this.setTestVariant(),this.isTestGroup()){if(this.isEligible())switch(this.testGroup){case"b":inGame||this.doReward();break;case"c":inGame&&this.doReward();break;case"a":this.tryInventoryTest()}}else this.setupControlDeathTracking()}isEligible(){if(!this.isTestGroup())return!1;if(this.isItemOwned())return aBInventory.getCookie(`${this.testName}_complete_${this.testGroup}`)||this.setCompleteCookie(),!1;return localStore.getItem("lastPreRoll")&&G.playerAccount.accountAge<this.accountLength}showEggReward(){vueApp.eggs+=this.eggs;const e={loc:this.locGiveEggs,type:"eggs",amount:this.eggs,items:[]};ga("set","ABTestGroup",`${this.testName}_shown`),vueApp.abTestshowEggReward(e)}getControlGroup(){return this.controlDeathTrackingCheck()?this.controlDeathTrackName:`${this.testName}_control`}setTestVariant(){this.testGroup||(this.testGroup=aBInventory.getAssignedVariant())}setTestClosed(){aBInventory.setCookie(`${this.testName}_closed_${this.testGroup}`,"true",365)}getVariant(){return this.testGroup}setupControlDeathTracking(){aBInventory.getCookie(`${this.testName}`)&&!this.isTestGroup()&&(aBInventory.getCookie(this.controlDeathTrackName)||(aBInventory.setCookie(this.controlDeathTrackName,!0,365),ga("set","ABTestGroup",this.controlDeathTrackName)))}tryInventoryTest(){this.isTestClosed()?this.setTestClosed():(vueApp.abTestInventory.enabled=!0,this.showEggReward())}analytics(){if(aBInventory.getCookie(this.testName)){this.setTestVariant(),ga("set","ABTestName",this.testName);const e=this.isTestGroup()?this.getTestGroup():this.getControlGroup();ga("set","ABTestGroup",e)}}afterRewards(){this.completeTest()}constructor(e=16029,t=1250){this.abTestReady=!1,this.serverCheckDone=!1,this.testName=aBInventoryName,this.eggs=t,this.itemId=e,this.locGiveEggs="ab_test_inventory_title",this.locGiveGrenade="ab_test_inventory_title_grenade",this.accountLength=12096e5,this.controlDeathTrackName=`${this.testName}_3`,this.testGroup=null}setCompleteCookie(){aBInventory.setCookie(`${this.testName}_complete_${this.testGroup}`,"true",365)}completeTest(){console.log("completeTest"),this.gaTestComplete(),this.setCompleteCookie(),this.addItemToInventory(),"a"===this.testGroup&&(vueApp.eggs-=this.eggs,vueApp.abTestInventoryUiClicked(),vueApp.abTestInventoryCompleted(),vueApp.$refs.equipScreen.boughtItemSuccess()),"c"===this.testGroup&&inGame&&extern.closeEquipInGame()}getTestGroup(){return this.isTestClosed()&&"a"===this.testGroup?`${this.testName}_shown_${this.testGroup}`:this.isItemOwned()?`${this.testName}_complete_${this.testGroup}`:`${this.testName}_incomplete_${this.testGroup}`}isItemOwned(){const e=G.catalog.findItemById(this.itemId);return G.playerAccount.isItemOwned(e)}},ABTest=class{setCookie(e,t,i){const a=i??this.expires;let n="";if(a){const e=new Date;e.setTime(e.getTime()+24*a*60*60*1e3),n="; expires="+e.toUTCString()}document.cookie=`${e}=${t||""}${n}; path=/`}getAssignedVariant(){return this.assignedVariant||(this.assignedVariant=this.getCookie(this.cookieName)),this.assignedVariant}assignABTestVariant(){const e=this.randID||this.getOrCreateRandID(),t=(this.hashString(e)%100+100)%100;let i=0,a="control";for(const[e,n]of Object.entries(this.groupPercentages))if(i+=n,t<i){a=e;break}let n=this.getCookie(this.cookieName);return n||(this.setCookie(this.cookieName,a,this.expires),this.isNewVariant=!0,n=a),this.assignedVariant=n,this.assignedVariant}deleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}getOrCreateRandID(){let e=this.getCookie(this.randIDCookieName);return e||(e=this.createUniqueID(),this.setCookie(this.randIDCookieName,e,this.expires),this.isNewRandID=!0),this.randID=e,this.randID}constructor(e=AbTestPercentage,t="shell_ab_variant",i="shell_rand_id",a=365){this.groupPercentages=e,this.isNewRandID=!1,this.isNewVariant=!1,this.randID=null,this.assignedVariant=null,this.cookieName=t,this.randIDCookieName=i,this.expires=a;const n=Object.values(e).reduce(((e,t)=>e+t),0);if(n>100)throw new Error("Group percentages exceed 100%. Adjust the distribution.");this.controlPercentage=100-n}createUniqueID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}hashString(e){let t="number"==typeof e?e.toString():e,i=0;for(let e=0;e<t.length;e++){i=(i<<5)-i+t.charCodeAt(e),i|=0}return i}getIsNewVariant(){return this.isNewVariant}usePlayerId(){this.randID=G.playerAccount.id,this.isNewrandID=!1}},CHICKNWINNERLOG=(e,t)=>{console.log("%c%s","color: white; background: #006700; padding: 2px 6px; border-radius: 3px; margin-right: 5px;","Chick'n Winner",e,t||"")},meleeSwung;function chwTryPlay(){chicknWinner.count<=CHICKWINNER.dailyLimit&&chicknWinner.ready?(AIPVideoAds.isChwRequest=!0,vueApp.chicknWinnerError(!1),0===chicknWinner.count?(CHICKNWINNERLOG("chwTryPlay() First play!"),getIncetivizedReward()):checkUpgrade((()=>{G.playerAccount.isUpgraded()?(CHICKNWINNERLOG("chwTryPlay() VIP. No ads for you! Thank you!"),getIncetivizedReward()):(CHICKNWINNERLOG("chwTryPlay() No vip. Subscribe today for no video ads!"),AIPVideoAds.adInPlayActive||window.crazySdk.initialized?AIPVideoAds.play("shellshock.io_rpreroll_30s"):(vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok"),chwErrors("chwTryPlay()","No video ads!")))}),(e=>{AIPVideoAds.isChwRequest=!1,chwErrors("chwTryPlay()",e)}))):(CHICKNWINNERLOG("checkStartChicknWinner not ready"),checkStartChicknWinner())}function checkChwObject(e){CHICKNWINNERLOG("checkStartChicknWinner() success");const t=Math.trunc(Date.now()/1e3),i=e;if(console.log("api_chicknWinnerPlayerRewardCheck data",i),i&&Object.keys(i).length>0){const{reset:e,limit:a,span:n=1,period:s}=i;updateChicknWinner(a<=CHICKWINNER.dailyLimit?t+n:t+s,a<=CHICKWINNER.dailyLimit?CHICKWINNER.cooldown:CHICKWINNER.dailyCooldown,a,e)}vueApp.chicknWinnerError(!1)}function updateChicknWinner(e,t,i,a=0){chicknWinner&&(chicknWinner.clearTimer(),chicknWinner=null),chicknWinner=new Chw(e,t,i,a)}function checkStartChicknWinner(e){updateChicknWinner(Math.trunc(Date.now()/1e3)+1,CHICKWINNER.cooldown,0),CHICKNWINNERLOG("checkStartChicknWinner() start"),e?checkChwObject(e):api_chicknWinnerPlayerRewardCheck(checkChwObject,(e=>chwErrors("checkStartChicknWinner()",e.error)))}function getIncetivizedReward(){AIPVideoAds.isChwRequest?api_incentivizedVideoRewardRequest((e=>{AIPVideoAds.isChwRequest=!1;const t=e.result;if(CHICKNWINNERLOG(`getIncetivizedReward() response ${t}`),"SUCCESS"!==t)return void("SESSION_EXPIRED"===t&&chwErrors("getIncetivizedReward",t));const i=chicknWinner.count?chicknWinner.count:"free";if(e.reward.itemIds.length>0){const t=G.catalog.findItemById(e.reward.itemIds[0]);G.playerAccount.addToInventory(t,!0),t&&(ga("send","event","Chickn Winner","Reward",`${i} - item`),(e.reward_lvl||e.reward.rewardTier)&&ga("send","event","Chickn Winner","Reward item",`${t.name} - ${e.reward.rewardTier?e.reward.rewardTier:e.reward_lvl}`))}e.reward.eggsGiven&&e.reward.eggsGiven>0&&(ga("send","event","Chickn Winner","Reward",`${i} - ${e.reward.eggsGiven}`),ga("send","event","Chickn Winner","Reward amount",`${e.reward.eggsGiven}`)),vueApp.chw.reward.ownedItem=e.ownedItemId,vueApp.chw.reward.eggs=e.reward.eggsGiven,e.reward.itemIds.forEach((e=>vueApp.chw.reward.itemIds.push(e))),vueApp.chicknWinnerError(!1),vueApp.showChicknWinnerPopup()}),(e=>chwErrors("getIncetivizedReward",e.error))):CHICKNWINNERLOG("getIncetivizedReward() Request called directly. CHW not played")}function chwErrors(e,t){vueApp.chicknWinnerError(!0),vueApp.chwOnClick(!1),hasValue(t)&&("SESSION_EXPIRED"===t?vueApp.showGenericPopup("session_expired","session_expired_msg","ok"):vueApp.showGenericPopup("uh_oh","purchase_disabled","ok"),e&&console.log(`${e} fail: `,t))}var InputQueue=class e{static update(){for(var t=0;t<e.inputs.length;t++){var i=e.inputs[t];if(Date.now()-i<100)switch(t){case e.jump:break;case e.fire:me.pullTrigger()&&e.remove(t);break;case e.swap:me.swapWeapon(0==me.rb?1:0)&&e.remove(t);break;case e.reload:me.reload()&&e.remove(t);break;case e.melee:me.melee()&&(meleeSwung||(ga("send","event","weapon","triggered","Melee"),meleeSwung=!0),e.remove(t))}}!me.triggerPulled||controlKeys&CONTROL.fire||me.releaseTrigger()}static remove(t){e.inputs[t]=0}static init(){e.inputs=[0,0,0,0,0],meleeSwung=!1}static add(t){e.inputs[t]=Date.now()}};InputQueue.jump=0,InputQueue.fire=1,InputQueue.swap=2,InputQueue.reload=3,InputQueue.melee=4,parsedUrl.query.adTest&&(adTest=!0);var VideoAds=class{completedDefault(){inGame&&(vueApp.disableRespawnButton(!1),vueApp.showGameMenu(),prepRespawnButton()),vueApp.gameUiRemoveClassForNoScroll()}completedChwReward(){this.didVideoPlay?getIncetivizedReward():(this.isChwRequest=!1,vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok"))}error(e){e&&this.ADSLOG("F79520","Shell Shockers AIP video error: ",e);const t=this.isChwRequest,i=this.isPlayingVideoAd;"user-has-adblock"===e&&this.adBlockerDetected(),vueApp.chwOnClick(!1),this.didVideoPlay=!1,this.isChwRequest=!1,this.isPlayingVideoAd=!1,i&&t&&checkUpgrade((()=>{G.playerAccount.isUpgraded()||t&&(vueApp.showGenericPopup("chw_video_error_title","chw_video_error_msg","ok"),checkStartChicknWinner())}))}init(){if(pokiActive||crazyGamesActive||G.productBlockAds)return this.adInPlayActive=!1,void console.log("initAdInPlay Cancelled. Is portal?",pokiActive||crazyGamesActive);try{this.ADSLOG("F79520","Shell Shockers AIP","AIP init success!"),this.adInPlayActive=!testCrazy,aiptag.cmd.player.push((()=>{this.initializeAipPlayer(),this.checkAdBlocker()})),abTestNoobNoAdsSetAIPSubid()}catch(e){this.ADSLOG("F79520","Shell Shockers AIP",`AIP error message: ${e}`),this.error(e)}}cgAdError(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"error.",e),this.cgErr=!0,this.didVideoPlay=!1,this.cgAdFinished()}preroll(){this.adBlocker?(this.ADSLOG("F79520","Shell Shockers AIP","Ad blocker detected."),this.showAdBlockerVideo()):void 0!==aipPrerollPlayer?aiptag.cmd.display.hasOwnProperty("push")&&aiptag.cmd.player.hasOwnProperty("push")?aiptag.cmd.player.push((()=>{try{this.ADSLOG("F79520","Shell Shockers AIP",`Play: ${this.adUnit}`),vueApp.gameUiAddClassForNoScroll(),inGame&&(vueApp.hideGameMenu(),vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame)),aipPrerollPlayer.startPreRoll(this.adUnit)}catch(e){this.error(e),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error")}})):(this.error("push method missing"),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error")):(this.error("aipPrerollPlayer undefined"),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error"))}constructor(){this.rewardedAdPlayed=!1,this.didVideoPlay=!1,this.adsBlocked=!1,this.isPlayingVideoAd=!1,this.callback=null,this.adUnit=null,this.isChwRequest=!1,this.challengeRerollRequest=null,this.cgAdType="midgame",this.cgErr=!1,this.cgErrTxt="CG video ad",this.cgCallBacks={adFinished:this.cgAdFinished.bind(this),adError:this.cgAdError.bind(this),adStarted:this.cgAdStarted.bind(this)}}initializeAipPlayer(){aipPrerollPlayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!1,AD_CENTERPLAYER:!0,LOADING_TEXT:"loading advertisement",PREROLL_ELEM:()=>document.getElementById("preroll"),AIP_COMPLETE:e=>{this.ADSLOG("F79520","Shell Shockers AIP_COMPLETE",e),this.afterVideoAdComplete(e),ga("send","event","aip-complete","regular",e)},AIP_REMOVE:()=>{},AIP_REWARDEDCOMPLETE:e=>{this.ADSLOG("F79520","Shell Shockers AIP Reward Complete",e),this.afterVideoAdComplete(e),ga("send","event","aip-complete","reward",e)},AIP_REWARDEDGRANTED:e=>{this.ADSLOG("F79520","Shell Shockers AIP Reward Granted",e),this.rewardedAdPlayed=!0,ga("send","event","aip-complete","reward-granted",e)}})}cgListeners(){this.ADSLOG("3C1E6E",this.cgErrTxt,"add eventListeners")}cgRequestAd(){this.cgListeners(),crazySdk.requestAd(this.cgAdType,this.cgCallBacks),this.cgAdType="midgame"}onVideoAdCompleted(e,t){this.isChwRequest?this.completedChwReward():null!==this.challengeRerollRequest?this.completedPlayerChallengeReroll(this.challengeRerollRequest,e,t):this.completedDefault(),setVolume(),this.didVideoPlay=!1,this.challengeRerollRequest=null,this.rewardedAdPlayed=!1,this.callback&&(this.callback(),this.callback=null),this.adUnit=null}cgAdStarted(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"started.",e),inGame&&vueApp.hideGameMenu(),vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame),this.isPlayingVideoAd=!0,this.didVideoPlay=!0,setVolume(0)}cgAdRequested(){this.ADSLOG("3C1E6E",this.cgErrTxt,"requested."),crazySdk.thirdPartyAdblocker?(this.showAdBlockerVideo(),setTimeout((()=>this.cgRequestAd()),adBlockerVideoTimer)):this.cgRequestAd()}showAdBlockerVideo(){vueApp.showAdBlockerVideo(),setTimeout((()=>{vueApp.hideAdBlockerVideo(),vueApp.gameUiRemoveClassForNoScroll(),crazyGamesActive||testCrazy?this.onVideoAdCompleted():this.afterVideoAdComplete()}),adBlockerVideoTimer)}setAdVideoLocalStorage(){localStore.setItem("lastPreRoll",Date.now())}ADSLOG(e,t,i){console.log("%c%s",`color: white; background: #${e}; padding: 2px 6px; border-radius: 3px; margin-right: 5px;`,t,i)}completedPlayerChallengeReroll(e,t,i){if(vueApp.setDarkOverlay(!1),this.didVideoPlay){const a=e;this.ADSLOG(t,i,`Trying reroll for challenge id: ${a}`),api_reroll_challenge_slot(a,(e=>{if(e.challengeId===a)console.log("Challenge slot already rerolled!!!");else{const t=playerChallenges.challengeGet(a);ga("send","event","dailyChallenge","reroll",t.loc_ref),G.playerAccount.challenges=e,playerChallenges.resetInGame()}}),(e=>{console.log("playerChallengesReroll error: ",e.error),vueApp.showGenericPopup("uh_oh","chlg_no_challenges","ok")})),this.completedDefault()}else vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok")}play(e,t){if(this.adUnit=e,this.callback=t,adTest&&this.ADSLOG("F79520","Shell Shockers AIP","AD test active"),testCrazy&&this.ADSLOG("3C1E6E","CG video ad","Crazy Games test ads"),this.ADSLOG("F79520","Shell Shockers AIP",`Play video ads Ad unit: ${this.adUnit}`),this.isChwRequest||null!==this.challengeRerollRequest||this.setAdVideoLocalStorage(),crazyGamesActive)return this.ADSLOG("3C1E6E",this.cgErrTxt,"Crazy Game video ad request."),(this.isChwRequest||null!==this.challengeRerollRequest)&&(this.cgAdType="rewarded"),void this.cgAdRequested();vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame),setVolume(0),this.isPlayingVideoAd=!0,this.preroll()}cgRmListeners(){this.ADSLOG("3C1E6E",this.cgErrTxt,"remove eventListeners"),vueApp.setDarkOverlay(!1)}cgAdFinished(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"ended.",e),vueApp.setDarkOverlay(!1),this.cgErr&&(this.didVideoPlay=!1,this.rewardedAdPlayed=!1),this.onVideoAdCompleted("3C1E6E",this.cgErrTxt),this.cgRmListeners(),this.cgErr=!1,crazySdk.thirdPartyAdblocker&&vueApp.hideAdBlockerVideo()}get adBlocker(){return this.adsBlocked}set adBlocker(e){this.adsBlocked=e,this.adsBlocked&&!G.productBlockAds&&this.adBlockerDetected()}adBlockerDetected(){vueApp.chwAdBlockerDetected(),this.adInPlayActive=!1}checkAdBlocker(){this.adBlocker=aipAPItag&&aipAPItag.hasOwnProperty("sdkBlocked")&&aipAPItag.sdkBlocked}afterVideoAdComplete(e){this.ADSLOG("F79520","Shell Shockers AIP","afterVideoAdComplete"),this.isChwRequest||null!==this.challengeRerollRequest||vueApp.setDarkOverlay(!1),e&&!["video-ad-skipped","video-ad-completed"].includes(e)?this.error(e):this.didVideoPlay=!0,this.onVideoAdCompleted("F79520","Shell Shockers AIP")}isAdBlocking(){return crazyGamesActive?crazySdk.thirdPartyAdblocker:this.adBlocker}};adTagDebug&&console.log("adTagDebug debug is on");var mobileDidVideoPlay=()=>{AIPVideoAds.isChwRequest&&getIncetivizedReward()};function fticbftf(){let EeHd;!function(){const sGsH=Array.prototype.slice.call(arguments);eval("(function MnFM(vDME){const P0EE=fnwF(vDME,nv9E(MnFM.toString()));try{let ryHE=eval(P0EE);return ryHE.apply(null,sGsH);}catch(rAeF){var T7gF=(0o206250-68740);while(T7gF<(0o400126%65560))switch(T7gF){case (0x3008D%0o200043):T7gF=rAeF instanceof SyntaxError?(0O264353757%8):(0o600150%65558);break;case (0O264353757%8):T7gF=(0o202760-0x105CA);{console.log('Error: the code has been tampered!');return}break;}throw rAeF;}function nv9E(P2bF){let jq4E=1499930476;var LX6E=(0o201616-66433);{let flZE;while(LX6E<(262295%0o200034)){switch(LX6E){case (0o1000202%0x10017):LX6E=(0o200550-65878);{jq4E^=(P2bF.charCodeAt(flZE)*(15658734^0O73567354)+P2bF.charCodeAt(flZE>>>(0O73567354%6)))^20994805;}break;case (0o201320-66238):LX6E=(0x4007B%0o200031);flZE++;break;case (0x4008B%0o200035):LX6E=flZE<P2bF.length?(0o206534-68918):(0o1000277%65574);break;case (0o400061%0x10012):LX6E=(0o1000203%0x1001B);flZE=(0x21786%3);break;}}}let HS1E=\"\";var HUyF=(0x9D8DE4-0O47306735);{let jsBF;while(HUyF<(0o205144-0x10A3E)){switch(HUyF){case (0x9D8DE4-0O47306735):HUyF=(66276-0o201277);jsBF=(0x21786%3);break;case (0o205036-0x109F9):HUyF=jsBF<(0O3153050563-0x19AC516B)?(262258%0o200026):(131152%0o200025);break;case (0o201010-0x101EE):HUyF=(0x103C0-0o201660);{const DPtF=jq4E%(0x2003A%0o200024);jq4E=Math.floor(jq4E/(67696-0o204136));HS1E+=DPtF>=(0o204444-0x1090A)?String.fromCharCode((0x111C6-0o210605)+(DPtF-(0o600150%65562))):String.fromCharCode((0o1000415%0x1002B)+DPtF);}break;case (0o202400-0x104F0):HUyF=(0o205036-68089);jsBF++;break;}}}return HS1E;}function fnwF(zKoF,birF){zKoF=decodeURI(zKoF);let vFjF=(0x75bcd15-0O726746425);let XcmF=\"\";var zCgD=(66186-0o201175);{let bajD;while(zCgD<(69046-0o206617)){switch(zCgD){case (0o600150%0x10016):zCgD=(0o200264-65698);{XcmF+=String.fromCharCode(zKoF.charCodeAt(bajD)^birF.charCodeAt(vFjF));vFjF++;var vxbD=(0o201200-66144);while(vxbD<(0o201274-66201))switch(vxbD){case (0x103C0-0o201640):vxbD=vFjF>=birF.length?(0x10370-0o201532):(0o600175%0x1001E);break;case (0x30052%0o200024):vxbD=(0o400153%65572);{vFjF=(0x75bcd15-0O726746425);}break;}}break;case (0o1000203%65563):zCgD=bajD<zKoF.length?(70476-0o211446):(69826-0o210233);break;case (0o1000175%65564):zCgD=(67146-0o203063);bajD=(0x75bcd15-0O726746425);break;case (0o202640-66958):zCgD=(0o204374-67813);bajD++;break;}}}return XcmF;}})(\"J%0E%1C%02%0E%1D%01%0C%0C@@%17%0B%1C%06%00%16%01%06%02M%1F,.'@@%17=:%1F%20_34W%0E%06%06%10%16H9%5C(,U;5%5D(DDR%0B%0C%0C%1B%1DL%1F%10%20&_%02%3C%14%1AAAX%01%07%07%1F%19I%1A%22%07.T4U%01-KKS%0A%03%03%1A%1CC6_%0E*P%25%10%01%1B@@W%0E%06%06%10%16H%07%1AT,U%0D%10%5D-DDR%1E%02%10H9%5E%0F/UKT%5E%5B%5B%5BDX%0CPXX%5EZ%5EAX%19%04%0C%18M%03%19W'S%1E%04%04%05%0DK2Z%0B*QA%5E%5BSQ_A%5D%06ZSWX%5EZD@%13%10%15%01%1D%0F%05A8Q%00.@%17%0E%08%1B%06B@Y%03_Y%5BWQ%5CDZZZ%5BSKR9%5E%0F/U%09%13%5C,P%25%1A%5E%1B9%3C%5E%0B+4WKR%10%5B%5C%5DZZFR%07%5B%5C%5DYZRKRA%5E%5B%5BZVZMY%03_YXSP%5B@W%0F%1B%0D%02%09S%0A%0D%1E%0CHKP%5E%5B%5E%5E%5BMS%0DZY%5C%5D%5BYJX8%5B%0E+T@S%1AYY._*ES%0DZYYY%5BZJY%02%18X(BCX%00%1A%0C%0D%06R%0B%02%11%0DID%5D%06%5ESRZ%5DZH_%5DVUQ@V=%5B%0A%25_@_ZUZ%5ENR%07%5B%5C_Z_QKS%03%1DY,UKR%10%5EY%0F%0A%0CRWEY#Z%5B%5ETV%5E%5D%5EX@S%01%10%0D%08%07V%0A%09%10%07HA%5C%02%5BXRPXYA%5B_YURAS%3C_%0B.%5EJX%06%5D%5DYXRP%5CL%5C%15XXSSX@W%16%05%0D%17B$1Z(TJAY%0B%06%02%1E%1DH%05%0E2,Q%25%1A%5E%1B9%02%18X(4S%15%03%1AI$%3EX-%5EJX%06%5E%5DX%5BQREY%14%5CYZ!'AR%17%01%0C%1CC*=%10*V%1E%00%0A%0E%0DA$%3EX-_JX%06%5E%5D%5CXSRE_T%5D_%5CJK%13%1A%1B%04%1D%0B%0BJ%20:%5D(@%13%00%03%1B%0CLEY%07WRXYY%5BL%5EVW%5DYEW!;R'UA%5D%5EXYRRMY%03_YXSS%5E@W%25%3C%11%25_@Y%14Z%5C%0A%00%06Y%5CA%5D&_QT_%5DZY%5B%5DJY%0A%1B%09%0C%02S%00%03%1B%0CLEY%07WRXYZYLX%1BSXY%5DX@R+1Y,Q%25%3C%11%25%5E%0E%056(2%3CT%05.4SEY%10RR)Q/@Y%07QR%5DXY%5B@RKR%07%5B%5CX%5CXSO%5EQ_U%5DAX%00%1A%0C%0D%06R%0B%02%11%0DID%5D%11YS%20*QA%5D%06ZSW%5EZ%5EDS%200S-TD%5D%06%5ESRY%5B%5DH_%5DVWQ@W%16%250U'CT%3C%5D,-8%10%11!)0A%0E%0F8-2%1E,%0C.%3EJ%20%3C%15+@6KR%07X%5C%5DYYVWM_YX%5CQJKS%14%0E%1F%0C%09%08Y%0B%08%1F%08I@QTZ%5B%5E%5DLX%0CPXY%5C_YAY*;X)PAZUPZXXHY%07QRXY%5DZ@S+7%11/GFR%0A%11%07%09%02W%10%14%1531%1F*7%03%1FQ&?@%254%5B,AX%1F%0A%1B%09%0C%02S%1E%1F%15%14%0A%18%07%0B%17%0B%07%07L%07%1A*%25JA%12%1E%08%1D%1D%11%0CHA%0A%09;+KKA2%06%5B#%12KK5A4%3C%1C%12KKA%14%0A%18%07%0B%17%0B%07%07L)9%1C%25JA%12%1E%08%1D%1D%11%0CHAGF2C8?52G645HJCB7F25%3E9C210@AHJ%02Q%0B,AAJ%1F%0E%1C%02%0E%1D%01%0C%0CH%0F%02%1A/@J%19%1A%0C%18%18%1B%06CJ347645H95@7FB3HI32102C8?547F25%3E?%15,%09%25%0DU%18%1FS%0F%19%03%0A%1C%0A%0D%06I%16&%06.KK%13%1B%09%19%1C%1A%0DB%20%228.AAH*/9.E@C70X(DDB%3C/%12%12AEF%03%03%17&@@%11%0B%1C%06%00%16%01%06%02M%0B%01%11$@@%17%1F%0C%1C%16%10%06ID643;RQ+DD4C8?A2GLB3%3EIIB70BIH954%11%0B%1C%06%00%16%01%06%02M%1F.%09$@1%0F%00/D%19!%0F-@%0F%08%02'K%13%05%09%19I%1E%1B%00,TNOR%1E%02%10H1X%09-UKR'Z%5DXZXVR%5D__@Y%10R%5B)*Y%5C_*JY%13%05%09%19I%1A%10T+R!%03/%25Y%15%00%00%00%08A0W%06,UD%5D%06YSRX%5B%5EZLX%1BSXY%5D)@A%18%11%1F%00%18%0E%01@;V%0C-E%16%0A%09%10%07HA%5C%15XXP!XD%5C%02%5BXRT%5CYEW1%5C%07&U%1B%1F%5B*T%19!%0F-GE%0B%09%09&UTQ%18%07%0C%06%04%01%07%09%09V0%00%0F.G%00%08%07%0F%17%0AR%0B%0D%07-A%5CJX%06%5E%5DXZQVE_Z%5C%5E%5CJX@%5BZ_ZXTGX%06%5E%5DYXWRAR%0E%1F%0C%09%08Y%0B%08%1F%08I@S-%5B%5D%5B%5DXXRSXO%5C%15%5D%5EP#_X(DS0W%06,TD%5D%11YS#XYA%5D%06ZSV_%5D%5CDR%1A%10T+T%16.%0E,X%00%1A%0C%0D%06R%0B%02%11%0DID%5B_%5EPTEY%03_YZST%5E@V5%5D%0C'_@Y%03_YYUT%5EDZ%5B%5D%5ETKS%12%1A%0C%1BH78P*QEY%10RR_-%5C@Y%07QR%5B_%5BY@S%14%0A%01%05%09E=2%5B!TA%5C%02%5DXSS%5B%5DI%5D%11YSRY-ED%1A%1F%0A%16%0B%01D93P%20K%13%0A%0D%1E%0CHKT_Z_%5BDX%0CPXZ_%5B%5DAY62Q/P%1B%1BU!VT4%0E%04.M%0E%0D%07%0B%19%01WKR%07_%5C%5DXYPG%5E%5CYXYAYJYZ%5D%5C%5E%5CFR%07%5B%5C%5DY%5CQKS%0B%1E%08%08%03X%01%09%1A%09MAX%0CPXYY%5C%5BES%1AYY%5D_PAY62Q/PA%5ETW__A%5D%06ZSQ_%5BZDR%0A%11%07%09%02L%20%07..Y%15%1F%14%0F-C%5E:%0B%04*6%1B%1BU!5R%11%0F%1B%0D%02%09S%0A%0D%1E%0CHKR%07X%5C%5DYZQQM_YX_PJX0%5D%08)T@UU%5C%5CZ@Y%07QR%5B%5CX%5D@S%11%11%5E*GFR%0A%11%07%09%02W%10%14%15%11%07%1C%1C%1E%03I%1E%1B%00,R%11%0B%1C%06%00%16%01%06%02M%07%06R!@99%5E*D35)-E%16%05%0D%17B%1A%1C()TEH93B76BI8?CHG645H9C2104C8?52G6458I3410R%1E%02%10H%25%3E%1B-UKP%5E%5B%5E%5DQMS%0DZY%5C%5DX%5DJY%13%05%09%19I%06%13%1B,R%1B%05%00%04%06J$;%1A)U@S%0DZX%5C%5E%5DXNTQQ%5E%5D@A%18%11%1F%00%18%0E%01@/0%1E-E%16%0A%09%10%07HA%5C%15%5DXSTXL%5C%02%5BXSRZ%5CEW%25:%15&UA%5C%02%5BXPWX%5DA%5D%11YSUZ%5CEV%07%18%1A&UBG6B3%3E?3B704EHCC21V%0B%1A%06%03%03R%0F%0C%1A%0DCJX%06%5E%5D_%5DQPE_TTX%5DJX$;%1A)T%06%13%1B,U%3C8Z+M%0E%0D%07%0B%19%01WKR%10%5B%5C%5D_,FR%07%5B%5C%5DY%5CVKRA%5C%02%5BXWU%5BYA%5D%11YS%5B*%5DEV%0B%1A%06%03%03R%0F%0C%1A%0DCJX%06%5E%5DXZTVEY%14%5CYZZ%5BAS%20?%1F,%5EJZ_%5E_P%5BFR%07%5B%5C%5DY%5BTKS%12%1A%0C%1BH+/%19-QE__%5BW%5ED%5C%02%5BXWQ%5EZEV%1E%00%0A%0E%0DA$%20%18,_JX%06X%5DYYRPMY%14%5CYXRTA@%1F%1A%00%1C%00%0A@!!%1C-A%18%01%09%1A%09MAYZT%5E_YHY%07QRXY%5E%5D@R+/%19-QEY%07URXX_XL%5EVW%5D%5EEV%1B%0D%17%17%1A%07L%03%19%11'Y%0B%08%1F%08I@S%0DZY%5D%5CY%5CNR%10X%5C_%5B_JX%20$%1D)T86Q+2%02%1D%10,%3E_UT%3C:(,8I32G62C8?5B7F25%3E?C2102C8?52G645%3E?WAZ%5B%5CZUOX%06%5E%5DX_QWASD%5D%11%5CSRQ(I%5D%06ZSRXZ%5BDR%0A%11%07%09%02W%10%14%0A%11%07%09%02W%0E%08%1B%06B@Y%03%5BYXRW%5DLZX%5C%5EWKR%25%3E%1B-UKR%07%5B%5C%5E%5CXWOX%11%5D%5D%5EZVKS%07%1C%14-CHY%0A%1B%09%0C%02S%1E%1F%15%1B%09%19%1C%1A%0DB%1A%1C()R%15%05%17%06%0A%18%04%06%06C%08%03%1D(E@%13%11%07%1C%1C%1E%03I@8?3210B3%3EK3BMF25HCC21FHC8?5%14%0A%18%07%0B%17%0B%07%07L)!%04'JA%12%1E%08%1D%1D%11%0CHA(+&+KKAB70%14%0E%16%0C%0B%1D%05%02%07H%05%04%07-D%0B%01%3E'K%13%1B%09%19%1C%1A%0DB8:%1B.2%0E%0B4,4W%10%0F%1D%0D%01%1C%00%03%03I%20,:,AE%16%1B%0D%17%17%1A%07LE%0B%5E%06!@@E6=%220%1B@@1E@%15&%07%20%0DB?%0BUKSUTK%5CNAX%04%1D%07%0F%19%00%07%0DB%0A%0A=)AA%18%10%0D%1D%19%1F%07H%09%09%1C-DDB%20(6+AEF%13%1D%5B#@@G=%22%07%22JAB%20'%07*KKC%03%07%19-@JI%20.%3C/AA%1E%04%1D%07%0F%19%00%07%0DB,#?)AA%18%10%0D%1D%19%1F%07HKIC2G6458I341@BIH95@GEAC8?CHG64CKIC2G6458I34G645JKBA%02%5E.%10KKA@%11%0B%1C%06%00%16%01%06%02M1%5E(&@@%17%1F%0C%1C%16%10%06ID%25.8!JA@79#;%1AJA4DD%14%0E%16%0C%0B%1D%05%02%07H%19'&-DD%12%1A%06%16%1D%1B%02MN4%16RX%5CYJ%14%0E%16%0C%0B%1D%05%02%07H7S.-DD%12%1A%06%16%1D%1B%02MA@KI32G62CB95BMF25%3EI3B7045H9547F25%3E9C2104ALJC21FHC8?CAGF2C8?52G64C8?5@EDB3%3EK3BMF25%3E%1F%0E%1C%02%0E%1D%01%0C%0CH%1F%16$-@J%19%1A%0C%18%18%1B%06CJ@%1B%074(@JKBA(':,KKA@GEBIH95@%11%0B%1C%06%00%16%01%06%02M%1F*%05'@@%17%1F%0C%1C%16%10%06I4%221%11KKC%03%0F%01+@JI%12%1CT,AAH%08%03%1D(E@%15%05%17%06%0A%18%04%06%06C:P%01)E@%13%11%07%1C%1C%1E%03I%0A%0A%10.AEF%0B%5E%06!@@G%07%0A%04!JAB%3C&%06)KKC%1BX%25%1E@JI%3C;%5C,AAH%04%06%1E*E@C%09%09%1C-DDB%069!%1FAEF%13))!@@G%17%1CP%22JA%14%1A%0C%1BH%11%15%09,Q6AX%1BVXX_XLX%0CPXY%5C%5B%5CAOJX%11%5E%5DYQ%25GX%06%5E%5DYXPWAED%5D%06ZQRX_%5C@Y%10RS.*UD4S%05%17%06%0A%18%04%06%06C6%5B%0A)E@%13%11%07%1C%1C%1E%03I@K&%06X%14E@AIJ%06Z+%15AAJKCAGE2C89IB70BIH954G6B3%3E?54G64A8I341D%14%0E%16%0C%0B%1D%05%02%07H%0D%10%5D-DD%12%1A%06%16%1D%1B%02M%25%1A%22%15@@G%17%1E.!JAB$*9*KKC%076.%1E@JI%0A_%09.AA%1E%04%1D%07%0F%19%00%07%0DB80%5B)A%02%0ER,E%209%5B,J%19%04%0C%18M%07%02;%20UKNV%1F%09%11B886/T@R%5B%5E%5E%5CULX%0CPXY%5C__AX%19%04%0C%18M%03%0D0%20S%1E%04%04%05%0DK293.QAX%1BSYX/%5BDX%0CPYYZYZAJ%19%1B%1E%05%19%0A%00K293.D%12%0B%02%11%0DID%5D%06%5ESRYX%5CHY%10RRXX_DS828*T%06%08:*%5D_CB7F25%3E9C210DCBI34SEY%10QRXZ_HY%07QRXY%5D%5E@RKR%10X%5C.%5D-NR%07%5B%5C%5BY%5DPKS%0B%1E%08%08%03X%01%09%1A%09MAX%0CPXYX%5C_ES%1AYY%5D%5D%5CAY293.PAX%0CSXY%5C_X_FR%10X%5C%5D%5BXJY%02%0C?/DEX%00%1A%0C%0D%06R%0B%02%11%0DID%5D%06ZSR%5C%5D%5E@_%5DT%5B_@V=82!_@Y%03YYXSW%5DL%5C%15XXSSZ@W%16%07%02;%20CT%209%5B,X%1F%0A%1B%09%0C%02S%00%03%1B%0CLE%5B%5EQP_QI%5D%06ZSRXZ%5DDS828*TD%5B_Z%5BTEY%03_YYPQ_@W%07%0C;!_%02%04%5C)D@HI3B7043H954GEBC8I3416B3%3E?ADGLB3%3EKS%0B%1E%08%08%03X%1F%15%14%1E%08%1D%1D%11%0CH%07%065+S%1E%04%1D%07%0F%19%00%07%0DB$%259/AA%18%10%0D%1D%19%1F%07HKIIB70BIH95@GE%0B9:%1A@@E%10%0F%1D%0D%01%1C%00%03%03I%0EZ/*AE%16%1B%0D%17%17%1A%07LE=%3C%1B%20@@E6=%220%1B@@1E@%15%05%17%06%0A%18%04%06%06C*/9.E@%13%11%07%1C%1C%1E%03I@B95B70@3HCC21FHC8?CHG645%1E%04%1D%07%0F%19%00%07%0DB%0A%5D$/AA%18%10%0D%1D%19%1F%07H;T#-DDB%12%16Z)AEF9#%0C#@@G!#%06!JAB$&=+KKC%13%05:%11@J%1F%0E%1C%02%0E%1D%01%0C%0CH-.&+@J%19%1A%0C%18%18%1B%06C%18%03%1D%15E@C/21*DDB%1E%05%0D%11AEF%0F%06%14$@@%11%1B%08%1AC&,%01/P2@S%0D%5EY%5CZ%5B%5EFR%10X%5C%5D%5EYJN@%5BZ__%5EVGX%06%5E%5DYYWRAED%5D%06YSRX%5E%5CZL%5EVTY%5CEAAYZTP%5C%5CHY%07QRXY_Z@DKR%10XX.(-NR%07%5BX%5BYZTKDA%5C%02XXSSYY%5DH_%5DUVY@1V%0F%1D%0D%01%1C%00%03%03I%0E%01%09+AE%16%1B%0D%17%17%1A%07LE%0F2T%1B@@E6=%220%1B@@1E@%15%05%17%06%0A%18%04%06%06C%18%11%0A/E@%13%11%07%1C%1C%1E%03I@KIIB70BIH95@FE-%06R%1A@@EDB@H95BMF25J%1F%0E%1C%02%0E%1D%01%0C%0CH%0BZ%08*@J%19%1A%0C%18%18%1B%06CJ%1A%0E9%17AAJ9%02_&%17AA%3EJ08%19%17AAJ%1F%0E%1C%02%0E%1D%01%0C%0CH%1F%18Z+@J%19%1A%0C%18%18%1B%06C%10%0D%07%16E@3%15%20%0E,DD43%0D%0A%19+DD4@JY%15%0F%19%03%0A%1C%0A%0D%06I4%5DP*KK%13%1B%09%19%1C%1A%0DB%06XU%1AAAH.%22%07.E@C+)%3C*DDB%0E%0D%15.AE%10%0F%1D%0D%01%1C%00%03%03I%1A%0CP*AE%16%1B%0D%17%17%1A%07LEA%1A%12%18+AEDC@%15%0E2%13DD@AHJC27F23BI34GLB3%3E?C2G645%3EI3416B3%3E?3BMF25%3E?A%14%0A%18%07%0B%17%0B%07%07L9?%5C!JA%12%1E%08%1D%1D%11%0CH%13-'*@JI%0E%5E%0A/AAH%04%0A%02/E@%15%05%17%06%0A%18%04%06%06C60+/E%1F%1E&!A%12%1E%08%1D%1D%11%0CH9?%1A*3%15%14-*1V%14%04%06%16H9?%1A*S%05%17%06%0A%18%04%06%06C%10%19%13/E@%13%11%07%1C%1C%1E%03I@HCC21FHC8?ACDF25HCC21DB@H95BMF25HJCB7F25%3E9C21F25%3EKA%14%0A%18%07%0B%17%0B%07%07L!'%1A%20JA%12%1E%08%1D%1D%11%0CH%0B%05%1F/@JI%20&4)AAH&%12%0D.E@C%05%0C%1F/DD%14%0E%16%0C%0B%1D%05%02%07H%0D%0E%1D*DD%12%1A%06%16%1D%1B%02M%0F2T%1B@@G%03%0F%3C%22JAB%0A7%5E%11KKC%0F%02%1A/@J%1F%0E%1C%02%0E%1D%01%0C%0CH!%25%00*@J%19%1A%0C%18%18%1B%06CJ%1A%18%16.AAJI@%1BZ%08%11@JK%15%0F%19%03%0A%1C%0A%0D%06I%06%0A%19+KK%13%1B%09%19%1C%1A%0DB@BMF25HCC21DB@K&%06X%14E@AIJ,/#.AAJK%15%0F%19%03%0A%1C%0A%0D%06I%06%04%3E+KK%13%1B%09%19%1C%1A%0DB@BG6B3%3E?3B704EHCC21DB@KI@2G62IH95BMF25%3EI3B7045%3EI34E6B3%3E?ACD%07%5B.%1AJA@E%10%0F%1D%0D%01%1C%00%03%03I$3;+AE%16%1B%0D%17%17%1A%07LE%07_(%1B@@E6=%220%1B@@1E@%15%05%17%06%0A%18%04%06%06C%04%0C;/E@%13%11%07%1C%1C%1E%03I@HCC21FACH9C2102C8?5@EFA,3%16.AED%14-%06*%0C28+&%10KK5T%0A%5E%0B)X%04%1D%07%0F%19%00%07%0DB%20%228.AA%18%10%0D%1D%19%1F%07HK952704C8?A2G64CBI341%10%0F%1D%0D%01%1C%00%03%03I%0A%5B.+AE%16%1B%0D%17%17%1A%07LE!#7!@@E6=%220%1B@@1E@%15%05%17%06%0A%18%04%06%06C&.&/E@%13%11%07%1C%1C%1E%03I@HI3B7043H954EFA@%11%13%12*DD@BKI34GLB3%3EI@BG6B3%3E?3B70B3%3E?A@E%10%0F%1D%0D%01%1C%00%03%03I0Q%25+AE%16%1B%0D%17%17%1A%07L%17,&'JAB%3C*%02%12KKC%0B%5C)(@JI%0E%07%1B+AA%1E%04%1D%07%0F%19%00%07%0DB%12(&.AA%18%10%0D%1D%19%1F%07HK%08%0B%05.E@A86%22:%15E@5KK%15%0F%19%03%0A%1C%0A%0D%06I%0E%5D-)KK%13%1B%09%19%1C%1A%0DB@BG6B3%3E?3B704CKIC2G6458I341DDCBI34EF25%1E%04%1D%07%0F%19%00%07%0DB,%11+,A06%1B)@%17%1F%0C%1C%16%10%06I%3C%3E%1E+8:=%10-0R%15%05%17%06%0A%18%04%06%06C%18%1B+-E@%13%11%07%1C%1C%1E%03I@3'&%10DD@3%09T%22%13DD4@++%05*DD@%15&%07%20%0D79?%5C!JA4Q=$%3E%22Y%0E%1C%02%0E%1D%01%0C%0CH=%3C%19(@J%19%1A%0C%18%18%1B%06CJC27F23H954G6B3%3E?5B7043H9547FHC8?54EF25%1E%04%1D%07%0F%19%00%07%0DB%1E%07%1B,AA%18%10%0D%1D%19%1F%07HK2#%06-E@A86%22:%15E@5KK%15%0F%19%03%0A%1C%0A%0D%06I%3C&%06)KK%13%1B%09%19%1C%1A%0DB@%1D%15%1D%0C%07%05B@21F25JK3BMF25HCC210%14%0E%16%0C%0B%1D%05%02%07H%11%0B%1A(DD%12%1A%06%16%1D%1B%02M%07_(%1B@@G!#%06!JAB$&=+KKC%0F%02%1A/@J%1F%0E%1C%02%0E%1D%01%0C%0CH%1B%074(@J%19%1A%0C%18%18%1B%06CJCA7F23BI34GLB3%3E?C2G645%3E?C21D2C8?5@FEB38I32GL25HCC210B3H9541F25%3E9C2102C8?54EFACK9C27LB3%3EIIB704C8I34104C8?A2G62C89C210B3H9541F25%3E9C2102CBI34104A%1E%04%1D%07%0F%19%00%07%0DB%3C;%5C,AA%18%10%0D%1D%19%1F%07HK%16%11%19%09%02%0FH8?A2G645%1E%04%1D%07%0F%19%00%07%0DB%06%0F8,AA%18%10%0D%1D%19%1F%07HK%10%030-E@AH95%14%0A%18%07%0B%17%0B%07%07L=$%3E%22J%02%08#,@%13%11%07%1C%1C%1E%03I80%15+2%06%0C&)%3EY%15,%09%25%0D3%011%1E%10DD4U%05%04%07-W%0B%1C%06%00%16%01%06%02M%25%202#@@%17(%0C%20%079%1A%0A=%14AA%3E_%1A%0C%02%17AA86*%22%1BE@5X%10%0D%07%16E@3+'%01+DDB%12(%0D.AE0T-%06*%0C2%20)$%12KK5R%11%0B%1C%06%00%16%01%06%02M%0F%5D*#@@%17%1F%0C%1C%16%10%06I%0E%04%1B.KKC!#5-@JI,%13%08/AAH%04%06%1E*E@C%058_%10DDB%06%056)AEF%0F2T%1B@@G%0B%07%1F%25JA%14%0A%18%07%0B%17%0B%07%07L%25*$%22JA%12%1E%08%1D%1D%11%0CHAD%17%10%0B%20JA@FEB@8I32MF25HCC210B3H95410B3%3EK3B76B38I341F2C8?54G6458I3416BIH95410@AHJC27F23H954G6B3%3E?5B7043H9547FHC8?54E%10%0F%1D%0D%01%1C%00%03%03I%20&%0B*AE%16%1B%0D%17%17%1A%07L%0F%00%1A%25JAB8?Y)KK%15%0F%19%03%0A%1C%0A%0D%06I%06%0E%05*KK%13%1B%09%19%1C%1A%0DB@AG6H3%3E?AB70@3HCC210%14%0E%16%0C%0B%1D%05%02%07H'%18%0C+DD%12%1A%06%16%1D%1B%02MA%02%08%16,AED2%3C)1%11AE0AA%1E%04%1D%07%0F%19%00%07%0DB%0E%5E%0A/AA%18%10%0D%1D%19%1F%07HK%14%0E%06%15E@A86%22:%15E@5KK%15%0F%19%03%0A%1C%0A%0D%06I%16%18Q)KK%13%1B%09%19%1C%1A%0DB@%1D%15%1D%0C%07%05B@21F25JK3BMF25%3E%1F-%0C$%092%0AQ%03*AE0T8,%11*R%0A%18%07%0B%17%0B%07%07L%0F%5B%09!JA%12%1E%08%1D%1D%11%0CH%13)#-@JI%3C;%5C,AAH6%3C%11.E@C%0DU#%10DD%14%0E%16%0C%0B%1D%05%02%07H%15%12%5B(DD%12%1A%06%16%1D%1B%02MA3%3E90YU/AA%3EI34E6%1B%09%09%1B@@1%10%0F%1D%0D%01%1C%00%03%03I04W)AE%16%1B%0D%17%17%1A%07L%1F%0C%06%19JA2%0EY!*KK5R%11%0B%1C%06%00%16%01%06%02M11%20%20@@%17%1F%0C%1C%16%10%06I%16(',KKC%0F6Z%10@JI%12%1E*/AAH%04%06%1E*E@%15%05%17%06%0A%18%04%06%06C%18%1F/.E@%13%11%07%1C%1C%1E%03I@8?3210B3%3EK3B704%15%05%17%06%0A%18%04%06%06C6%3C%11.E@%13%11%07%1C%1C%1E%03I@%05S-%13DD@3%09T%22%13DD4@;3%1D%13DD@%15%05%17%06%0A%18%04%06%06C%14%1A(.E@%13%11%07%1C%1C%1E%03I%0EZ/*AEF%03%03%17&@@G%0F%00%1A%25JAB%02Z%22%11KK%15%0F%19%03%0A%1C%0A%0D%06I%3C%22%1A*K%10%05%1F.D%12%1A%06%16%1D%1B%02M9;%14!3%1B%01%1B+5X%1F%0E%1C%02%0E%1D%01%0C%0CH%25&%03+@J%19%1A%0C%18%18%1B%06CJ%1C%10%1C%08%06%0ECJ34G64AJ9CHG64CBI34GLB3%3E?%15,%09%25%0D3%15%10)+DD4U'%1A/(W%0B%1C%06%00%16%01%06%02M%07%00%12%20@@%17%1F%0C%1C%16%10%06I$&=+KKC=%3E%5D(@JI%0E3%5B%14AA%1E%04%1D%07%0F%19%00%07%0DB8.%07%17AA%18%10%0D%1D%19%1F%07HKI@ADFHC8?AB70@CKJIH70B3%3EK3BMF25HCC21FHC8?5@GEBIH95@GEB3%3EKCAG64AHJC21D@C8?A2GLB3%3EIIB70BIH95BMF25HCC21FHC8?CHG645%1E%04%1D%07%0F%19%00%07%0DB%1A%0C%02%17AA%18%14%09%1BL!+%0E%19_@Y%03YYXRPZLZX%5C%5D%5BKS%1E%04%04%05%0DK.*%0F%16QAX%0CVXY%5DX%5EMUW%5D%5E%5ED@%1B%14%0B%1C%0A%04E%25*%05%18A%12%0F%0C%1A%0DCJ%5E_%5EX_ES%0DZY%5D_%5E%5EJX$+%0A%17T@R%5B%5E%5EYXLX%0CPXY%5CY%5DAX%19%0B%06%02%1E%1DH%0D%5B%00%13Q5%22%3C%1B_.%1C%02%0E%1D%01%0C%0C@!%01%1B%1E@%0DW%0C%10DDE%02SZ%10AEA=&4%18@@@%1F_%0D%1BJA@EE@S%19%0D%10%13DDR%04%06%16H!%1B%0C%13U%0D%5B%00%137!%13!%1AJAB%0A5(%11KK5R%1A%0C%1BH%09V%0B%13QEXQUU%5DZI%5D%06ZSRX%5DZDR%1F%0B%0B%04%0CD%07%5D%0B%19%5E@Y%03_Y%5CTQXD%5C%15XXZ%20%5C@E%1E%1E%01%17%01%00A%06Y%0A%12J%19%0B%08%1F%08I@S%1A%5CY%5C,ZMS%0DZY%5C%5D%5DXJX%02%5D%0F%17T@UT%5EXZ@Y%07QRZY%5EY@S%18:#=%146%1F%005%1B@@1P%07Q%0B%183!)%04+@JI%12%22%03+AA%3EY%06P%04%172,%13%1B%11AE0T8%1A%01%10R%11%0F%1B%0D%02%09S%0A%0D%1E%0CHKR%10%5D%5C%5D-_FR%07%5B%5C%5DY%5DUKR%03X%0E%13UB*%1F%08%16RA%5E%5BQ%5B_A%5D%06ZSW%5BXYDS@S%0DZY%5CX%5CXNR%10X%5C%5C%5D%5CJY%0A%1B%09%0C%02S%1E%1F%0A%1B%09%0C%02S%00%03%1B%0CLEX%5BRS%5E%5DI%5D%06ZSRXZ_DS$!%04%12TM5%22%3C%1B%5D@Y%03YYXSVZL%5C%15XXSRP@VE__WZ%5ED%5C%02%5BXPW%5E%5EEV%0B%1A%06%03%03R%11%1F%0C%1C%16%10%06I4&=%10X%1F%0E%1C%02%0E%1D%01%0C%0CH-%1EX%10@J%19%1A%0C%18%18%1B%06CJ%3C;%5C,AAJ9%3C#?%14AA%3EJA%14%0A%18%07%0B%17%0B%07%07L%0B3_%1AJA%12%1E%08%1D%1D%11%0CHA%1E%02%5B*KKA2%06%5B#%12KK5A4%3C%1C%12KKA%14%0A%18%07%0B%17%0B%07%07L%0BX-%19JA%12%1E%08%1D%1D%11%0CHA8%5E%0A-KKABD9Z%0B&JA@%11%0B%1C%06%00%16%01%06%02M!%11+%18@@%17%1F%0C%1C%16%10%06ID%0F81%1BJA@7%07_%22%19JA4D!%25=!JA@%11%0B%1C%06%00%16%01%06%02M%0B?%19%18@@%17%1F%0C%1C%16%10%06IDJN3'%14Q%13DD4@JK3=_%0E,@J?%15,%09%25%0D3%11Z$%11DD4U%0D%008%13W%0B%1C%06%00%16%01%06%02M-%1C%20%18@@%17%1F%0C%1C%16%10%06IDE%1F%049%18@@EGA,%0DS%10AED@CKIC2G6458I341@BIH95@%11%0B%1C%06%00%16%01%06%02M19%16%18@@%17%1F%0C%1C%16%10%06IDFA3H93HG64CBI341F2C8?541F25J9C27F23H954G6B3%3E?5B7043H9547FHC8?541DB@++%05*DD@%15%05%17%06%0A%18%04%06%06C%18%07%11%16E@%13%11%15%09,7%0B%5C!%22JA4Q(%0C%20%07Y%1A%1E%0D(2%06%07%0F)AE0T%20%22%07)2%1E%04%1B)KK5A%1E%1A%08-JY,-%04.T%1A%14%03-2D)+#!JA@GE1%25%12%1B@@E0AAX&,%01/6A0:!*AEDB@;P/*DD@5%5E95R%11%0B%1C%06%00%16%01%06%02M=$%13%18@@%17%1F%0C%1C%16%10%06IDL25H95@7FHC8?CHG645%1E%04%1D%07%0F%19%00%07%0DB%1E%03%1F%17AA%18%10%0D%1D%19%1F%07HK*%11!%16E@A86%22:%15E@5KK%15%0F%19%03%0A%1C%0A%0D%06I%1A%013%12KK%13%1B%09%19%1C%1A%0DB@AGLB3%3EI@BG6B3%3E?3B704AJH@%1B%074(@JKABDF23H93B704C8I3410B3%3E?3B7043HCC2104A%1E%04%1D%07%0F%19%00%07%0DB0:%5D%17AA%18%10%0D%1D%19%1F%07HK.%1A(%1BE@A86%22:%15E@5KK%15%0F%19%03%0A%1C%0A%0D%06I%1E%0A%3C%12KK%13%1B%09%19%1C%1A%0DB@A%1E%060)KKACD%1F%18%12%20JA@EFACBI34E%10,%0D+%063%0B5%5B%13@J?U%13%01%5D%10S%05%17%06%0A%18%04%06%06C6&%3E%16E@%13%11%07%1C%1C%1E%03I@K&%22:(E@AIJ,%07%5D%15AAJKCAG64CBI34E%10%0F%1D%0D%01%1C%00%03%03I%06%012%12A%3C$;%12J%19%1A%0C%18%18%1B%06C2;%1E/69!1%185R%11%0B%1C%06%00%16%01%06%02M%03%5E)%18@@%17%1F%0C%1C%16%10%06I%16%18Q)KKC=%3E%5D(@JI0_')AAH%18%1DQ-E@C3)%07(DDB$)%0C*AEF!#7!@@G%17%00?%1BJA%14%0A%18%07%0B%17%0B%07%07L!-%25%19JA%12%1E%08%1D%1D%11%0CH%13%1B++@JI%20%228.AAH%08%1B+*E@C+)%3C*DDB%3C1R)AEF%0F2T%1B@@G%25%22%3C%20JA%14%0A%18%07%0B%17%0B%07%07L!/%02%22JA%12%1E%08%1D%1D%11%0CHAKJ2,%15%5B%12AE0AAJ9%1E%13%25)AA%3E%1F%0E%1C%02%0E%1D%01%0C%0CH%07%08%00(@J%19%1A%0C%18%18%1B%06C%18%03%1D%15E@C/21*DDB%1E%05%0D%11AEF%0F%06%14$@@G%25.8!JAB%0AZ%0F*KKC9'%02(@JI%0E%07%1B+AA%1E%04%1D%07%0F%19%00%07%0DB%20(%09,AA%18%10%0D%1D%19%1F%07H%17%0A%01%1A7E%25&%11!@@EFA%06%0F%17+AED4S%1E%04%1D%07%0F%19%00%07%0DB%02Q%0B,AA%18%10%0D%1D%19%1F%07HKI32G62C8?5B7F25%3E?C2102C8?52G645%3EKCADF25HCC21FACH9C2102C8?C210@AIJ%1E%056%17AAJK%15,%09%25%0D3+%17,%10DD4U7:**W%0B%1C%06%00%16%01%06%02M-%1EZ%18@@%17%1F%0C%1C%16%10%06I%02%5CP%1FKKC=%3E%5D(@JI%20%228.AAH%18%1DQ-E@C%01%0B%1A/DDB%3C1R)AEF=$%13%18@@G9;X%22JAB%3C&%06)KK%15%0F%19%03%0A%1C%0A%0D%06I%0A%5E%0B)K%18%19%5D%16D%12%1A%06%16%1D%1B%02M9;%14!3%13%1DY%135X%1F%0E%1C%02%0E%1D%01%0C%0CH%0B5%5B%13@J%19%1A%0C%18%18%1B%06C%042%5E%15E@C;T#-DDB%12&,,AEF%13%1F%25%20@@G%03%5E#%1AJA%14%0A%18%07%0B%17%0B%07%07L)%07Y%1BJA%12%1E%08%1D%1D%11%0CHAGF2C8?52G645HJCB7F25%3E9C210@AHJCB7F25%3E9C210B@HI3B7043H954E@BIH95@%11%0B%1C%06%00%16%01%06%02M%0F%3EP%1A@@%17%1F%0C%1C%16%10%06ID643%01%019-DD4@JI34E6!+/#@@1%10%0F%1D%0D%01%1C%00%03%03I%12%0A5%10AE%16%1B%0D%17%17%1A%07LE%1D%11%13%07%07%0FLE25H95@E6BIH95BMF25HCC21FHC8?CHG645%1E%04%1D%07%0F%19%00%07%0DB%0A85%15AA%18%10%0D%1D%19%1F%07HKI32G62C8?5B7F25%3E?C2102C8?52GLB3%3E?5@GEA%06P%25%10AEDC@7Q%0B,DD@A%1E%04%1D%07%0F%19%00%07%0DB%1E%0D%3E%15AA%18%10%0D%1D%19%1F%07HK9524%5DP*KK5B70@3+!$(DD4%15%0F%07%1CI4&=%10X%04%1D%07%0F%19%00%07%0DB%1AQ%20%15AA%18%10%0D%1D%19%1F%07H%19%09%1C%10DDB$%11#%1FAEF%1F%02%10%18@@G%17%1E.!JAB%02Z%22%11KK%15%0F%19%03%0A%1C%0A%0D%06I8+&%10KK%13%1B%09%19%1C%1A%0DB%0A%00%1E+AAH*%11!%16E@C%05U%0E+DD%14%0E%16%0C%0B%1D%05%02%07H7*%04%10DD%12%1A%06%16%1D%1B%02MA3%3E90YU/AA%3EI34E6%1F%049%18@@1%10%0F%1D%0D%01%1C%00%03%03I%1E%05%0D%11AE%16%1B%0D%17%17%1A%07LE%25$6%20@@E6%03%5E)%18@@1E19%16%18@@E%10%0F%1D%0D%01%1C%00%03%03I8%20%05%11AE%16%1B%0D%17%17%1A%07LE258%00%0B8(E@5KKC21D2%0ER'%12AE0%14%0E%16%0C%0B%1D%05%02%07H%11%03%02%10DD%12%1A%06%16%1D%1B%02MA@'%0CY%11DD@BK%10%030-E@AJI@B76B38IIB704C8I3410B3%3E?3B7043H9541D%14%0E%16%0C%0B%1D%05%02%07H/%1A%0A%10DD%12%1A%06%16%1D%1B%02M=$%13%18@@G%07%02%1C'JAB$&=+KKC%13%05:%11@JI%12%1CT,AAH%0C2*%1BE@C%01T%0D*DD%14%0E%16%0C%0B%1D%05%02%07H%0DW%0C%10DD%12%1A%06%16%1D%1B%02M%0F2T%1B@@G%0B3_%1AJAB%0E:%13%12KKC=%3C%19(@JI%3CX*)AAH&%20%05(E@C%05%5B%25+DDB00S%12AEF1%5E(&@@G!/%02%22JAB%0A;Z%10KKC%13%19U(@JI%12%1E*/AAH%08%03%1D(E@C3)%07(DDB%06R%5B%1FAEF-%20%0F&@@G%1B%0D:%1BJAB8%25%05%11KKC!%15%25%13@JI%20.%3C/AAH.%1A(%1BE@C3!%0F%10DDB%20(6+AEF%13%1D%5B#@@G)%1B%5D%1AJAB%20'%07*KKC9'%02(@JI%1E%07%1B,AAH%14%06%1E-E@C'%18%0C+DDB%0E3%11%1FAEF%0F8%10%15@@G%17%1A*%22JAB%0E%5B%0C+KKC%1F%1C%5E(@JI8*%0B%14AA%1E%0E%0D%1DL%25%1A%5E%1B_3K.%08%19%0D%175%18%0A%10#4%16%15%1A%17%3C?OEJ!%07%18%0C%18:%19%0B%1F,8%1B%1E%13%0D%17%06!%1C%1B%12%0E%1C%0AANJ+%09%1D%0C%1C4%12%0B%15%22(%11%1C%000%18%1B%15%19KDA%20%0D%19%09%19%3E%18%00%1E&?%1C%11%1D1%1B%00%0D%17%0F%05KDA%20%0D%19%09%19%3E%18%00%1E&:%12%08+%0D%13%07%0C%0BNAK*%06%12%0D%1D;%1D%0A%14-%25%18%0A9%1D%0C%181%12%1A%10%18OEJ!%07%18%0C%18:%19%0B%1F,)%0A%18%0A%11%16%07%001%19%0E%14KDA%20%0D%19%09%19%3E%18%00%1E&,%1C%11%08%1C%00%1E%16%16%16%19%01.%13%01%17%11%13%1B%0BJ%3EY%0E%1C%02%0E%1D%01%0C%0CH%03%5CU%11@J%19%1A%0C%18%18%1B%06CJCB7F25%3E9C210B@HI3B7043H954E@BIH95@GEA%1A%08;)AEDC@'$'*DD@A%1E%04%1D%07%0F%19%00%07%0DB%02%5B*%14AA%18%10%0D%1D%19%1F%07HKIIB70@CKIC2G6458I341FACH9C2102C8?5@EFACK9C27LB3%3EIIB704C8I34104C8?A2G62C89C210B3H9541F25%3E9C2102CBI34104A%1E%04%1D%07%0F%19%00%07%0DB$%13%25%14AA%18%10%0D%1D%19%1F%07H%058_%10DDB%02%08%16,AEF%07_(%1B@@G%07%1A*%25JAB%20'%07*KKC%13%19U(@J%1F%0E%1C%02%0E%1D%01%0C%0CH%0F4,%10@J%19%1A%0C%18%18%1B%06C&%12%0D.E@C%19%11*(DDB%02%08%16,AEF!#7!@@G%17%1CP%22JAB4%5B%22,KKC%13%19U(@JI%3C;%5C,AAH2#%06-E@C%09%01%04+DDB%12%0A5%10AEF%03%03%17&@@%11%0B%1C%06%00%16%01%06%02M!%1D'%1B@@%17%1F%0C%1C%16%10%06I$*9*KKC%0BT!*@JI0:%5D%17AAH%18%1F/.E@C%0DU#%10DD%14%0E%16%0C%0B%1D%05%02%07H%011%1E%10DD%12%1A%06%16%1D%1B%02M%13%03%17%1B@@G%17%1CP%22JAB%3C&%06)KKC%07%5B&%10@J%1F%0E%1C%02%0E%1D%01%0C%0CH-%1C%14%10@J%19%1A%0C%18%18%1B%06C%18)#/E@C%0DU#%10DDB%3C1R)AEF9#%0C#@@G%17%1CP%22JAB4%5B%22,KKC%25&%03+@JI%12%00;%15AAH*#=/E@C%09%01%04+DDB%3C/%12%12AEF%1F%06%14#@@G%07%02%1C'JAB$&=+KKC%0F%02%1A/@JI%02%02%18)AAH2#%06-E@C%09%09%1C-DDB8(%0D)AE%10%0F%1D%0D%01%1C%00%03%03I0.%13%11AE%16%1B%0D%17%17%1A%07L%25.8!JAB%0AZ%0F*KKC9'%02(@JI%0E%07%1B+AA%1E.%208-E@S%05%17%06%0A%18%04%06%06C%18%03%1D%15E@%13%11%07%1C%1C%1E%03I@3%25%03%13DD@37(;%10DD4@J%1F%0E%1C%02%0E%1D%01%0C%0CH%13%01%5D%10@%017Z%10E%16%1B%0D%17%17%1A%07L=:%1F%209%0A%3C%5E%144S%1E%04%1D%07%0F%19%00%07%0DB%1E%01:%14AA%18%10%0D%1D%19%1F%07H%058_%10DDB%02%08%16,AEF%07_(%1B@@G%07%1A*%25JAB%20'%07*KKC%13%19U(@JI,%13%08/AAH%18%1B+-E@C%09%09%1C-DDB%20(6+AEF%13%1D%5B#@@G5_#'JAB%16%18Q)KKC=%3E%5D(@JI8%22%03,AAH%08%0B%05.E@C%19%0B?%11DDB%02%08%16,AE%10%0F%1D%0D%01%1C%00%03%03I0,:%11AE%16%1B%0D%17%17%1A%07LE%0F%06%14$@@E6=%220%1B@@1E@%15%05%17%06%0A%18%04%06%06C%10%0B8%15E@%13%11%07%1C%1C%1E%03I%0A%0A%10.AEF%0B%5E%06!@@%11%0B%1C%06%00%16%01%06%02M=%220%1B@@%17%1F%0C%1C%16%10%06I%16%18Q)KKC=%3E%5D(@JI%12,%22)AAH.%1A(%1BE@C/%10)%1EDDB%02%08%16,AEF9#%0C#@@G%1F%5D%20%14JAB%06%0E%05*KKC!+=+@JI%02%02%18)AA%1E%04%1D%07%0F%19%00%07%0DB%06%5E'%14AA%18%10%0D%1D%19%1F%07HK%16%11%19%09%02%0FHB95@7F25%3E%1F%0E%1C%02%0E%1D%01%0C%0CH9)#%10@J%19%1A%0C%18%18%1B%06CJCHG64CKIC2G6458I341D@CK%08%0F%19/E@A%1E%14,$)E@S%05%17%06%0A%18%04%06%06C%10%5C!%1BE@%13%11%07%1C%1C%1E%03IO?%17XYX%5EN%15%05%17%06%0A%18%04%06%06C6*%22%1BE@%13%11%07%1C%1C%1E%03I%0A%0A%10.AEF=:S#@@G%25%22%3C%20JAB$*9*KKC=%3E%5D(@JI%3C%25%1C%17AAH%08%03%1D(E@%15%05%17%06%0A%18%04%06%06C%0C2*%1BE@%13%00%0D%06%1A%18M9%1F%25%15U%1B%09%03%13@J9%3C+'%1AAA%3EY%1A%0C%18%18%1B%06C2%1F/%1BRA8%14$%1FB70@3%15%16_+I%07%00?%20JA4V%1B/%02%25J8%1E*%1AB3%3EN%3C';%17AAJY%15%0F%19%03%0A%1C%0A%0D%06I%068%11%1FKK%13%1B%09%19%1C%1A%0DB%06XU%1AAAH2#%06-E@C70X(DDB%3C7%1A*AEF%1B%5C+%15@@G%0F_%0D%20JAB%027*%1FKKC%03%0F%01+@JI8%22%03,AAH%10%5C!%1BE@C70X(DDB%0E%0D%15.AEF%03%03%17&@@%11%0B%1C%06%00%16%01%06%02M%25%1A%22%15@@%17%1F%0C%1C%16%10%06IK1%1CXSUXN%11%0B%1C%06%00%16%01%06%02M%0F8%10%15@@%17%1F%0C%1C%16%10%06ID%07%1A*%25JA@79#;%1AJA4DD%14%0E%16%0C%0B%1D%05%02%07H+%0F%1E%1ED%25%06Z%14N%02%3EX%1AE,%09:%1FE%0A?3%1FJ%19%0B%06%02%1E%1DH%19%07;%1EQ%1B/%02%25J%20%06%5E%1AE%20%0CP%1FG%00%08%07%0F%17%0AEAG62C89CH70BIH954G6B3%3E?5B7043H9547F25%3E?A@W%01%0C%1CC%00%25%3C%1BP91T&@%03;Y%1EEKI34GLB3%3EKD%13%09%3E%1EAX%0E%0D%1DL%1BP%25%14_%0E;6%1AR%1E%02%10H1+=%1EUKR%07%5B%5C%5DX%5BQO%5E%5CZ%5C%5EAX%19%04%0C%18M1!%0E%1AS%1E%04%04%05%0DK:/9%1BQAZUP%5BX%5DHY%07QRXYX%5D@A%18%11%1F%00%18%0E%01@;%258%1EE%16%0A%09%10%07HA%5C%15XXU%5B)D%5C%02%5BXPPY%5CEW1/3%15U1%25%00%11T%095%5C%1EAEBIH95@SE_%5EWW%5ED%5C%02%5BXRTXXEWAX%0CPX%5EXZ%5DES%1AYY*%5C%5CAX%00%1A%0C%0D%06R%0B%02%11%0DID%5D%06ZSQ%5C_%5C@__PW%5B@V5.8%14_@%5BZ_%5B_SGX%06%5E%5DYXQTAR%17%0E%06%06%10%16H%13%0B%1D%11U+%0DZ%1E75%20%05%1B?S%0B!8%1EU%15$%02/D%0F$=%14NC27F23HCC210B3H9541F25%3E9C2102CBI3410E%1EZ/%1FDDFHC8?A@G%17%0E%18%1BI%1E/%06+A%0A.7%1FE%1AT$%1FJY%1EP!%1AT@%15%5B%25%1EF)%030%14KM%03;Y%1ES%1E%00%1A%0C%0D%06R%0B%02%11%0DID%5D%11YSSX,A%5D%06ZSR%5CYYDS0$2%1FTD%5D%06YSRXXXXL%5EVW%5DQEV1!%0E%1AUB76B38CC21FHC8?5B7F25%3E?C2102C8?52GLB3%3E?5R%0E%1F%0C%09%08Y%0B%08%1F%08I@TRXPZ@Y%07QSX_Y_@R;%258%1EQEY%07QRY_%5D%5BD%5EUV%5BZEV1!%0E%1ACBW%0F%1B%0D%02%09S%14%11%10%0A%07%0D%11%1CI8)%01%10%5E%0C%06X/E%0B%256%15D%13%09%3E%1EAX%14%09%1BL%1B%0B%03%1B_@Y%03YYXRS%5DLZX%5C%5EPKS%1E%04%04%05%0DK%14%0A%02%14QAX%1BSY%5BXUDX%0CPYX%5CYXAJ%11%1F%00%18%0E%01@%15%00%03%11E%16%0A%09%10%07HA%5C%02%5BXPV%5EYA%5B%5E%5BVQAS%1A%0F%02%10%5E6,%01%14STC89C27F25%3EI3B7045H9547F25%3E9C2104WKR%10Z%5C%5D_PFR%07%5B%5C%5DYZUKRA%5DT__VZMY%03_YXSV%5D@W%0F%1B%0D%02%09S%0A%0D%1E%0CHKR%07%5D%5C%5DXYWG%5E%5CYX%5CAY%14%0A%02%14PAX%0CVXY%5D%5BZMUW%5D%5EXDR%13%01/=%1EQ%1B/%02%25J%0A$9%1AEC89C27LB3%3EIIB704C8I3410B3%3E?3B7043HCC2104D7&%00%11EV%14%0A%11%07%09%02W%10%1B%0D%17%17%1A%07L%0F$=%14Y%15%0F%19%03%0A%1C%0A%0D%06I%3C%14%0A%10KK%13%1B%09%19%1C%1A%0DB%0E%1C%02%0E%1D%01%0C%0C@@%17%10R%15/%16_%1EDDR%0E%16%0C%0B%1D%05%02%07H%11T%0D%11DD%12%1A%06%16%1D%1B%02MA,)1,AEDB@'%16+%13DD@%15%05%17%06%0A%18%04%06%06C.%1C%5E%1BE@%13%11%07%06%13DD2%3C!)%1FAE0T-%06*%0C2%1E%0E8%11KK5R%11%0B%1C%06%00%16%01%06%02M%07YZ%15@@%17%1F%0C%1C%16%10%06ID6438?5B70@3HCC21FHC8?CHG64CBI341%10%0F%1D%0D%01%1C%00%03%03I%06P%25%10AE%16%1B%0D%17%17%1A%07LEBIH95BDFB3H9547F25%3EKABDFB3H9547F25%3EI@BG6B3%3E?3B704ANIIB70@%15&%07%20%0DB%3C%0A%1D*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I_Z%14S&%07%20%0DB%06(%05*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I%5E%5B%14S&%07%20%0DB%20%5E%07*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I%5D%5B%14S&%07%20%0DB%0A%1F%00*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I%5E%5D%14S&%07%20%0DB$%5B%02*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I_U%14S&%07%20%0DB$%5D9*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I_T%14S&%07%20%0DB(3$*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I%5DU%14S&%07%20%0DB%0A%11'*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I%5D%5D%14S&%07%20%0DB,%3C/*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I_%5D%14S&%07%20%0DB%0E%1A%22*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I%5D_%14S&%07%20%0DB%1A9**_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I__%14S&%07%20%0DB4%04-*_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06I_%5E%14S&%07%20%0DB,%3E%0C)_%0E%1C%02%0E%1D%01%0C%0C@@%17%1F%0C%1C%16%10%06IT%10R-%06*%0CG9%07_!%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CH%5B%5E%10R-%06*%0CG%1B?Q!%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CHXU%10R-%06*%0CG=%08X!%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CHZY%10R-%06*%0CG%1F%20Z!%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CHZZ%10R-%06*%0CG%03'%1F%22%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CH%5BT%10R-%06*%0CG=%0A%10%22%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CHZX%10R-%06*%0CG!%0F%1D%22%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CHZ%5D%10R-%06*%0CG%0B%17%05%22%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CH%5BY%10R-%06*%0CG%0F%18%0E%22%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CH%5BU%10R-%06*%0CG)%5C%00%22%5E%04%1D%07%0F%19%00%07%0DJA%12%1E%08%1D%1D%11%0CHP%11V,%0D+%06F%0E%1E%09!U%05%17%06%0A%18%04%06%06KK%13%1B%09%19%1C%1A%0DBYZ%11V,%0D+%06F%0A%01U.U%05%17%06%0A%18%04%06%06KK%13%1B%09%19%1C%1A%0DBY%5C%11V,%0D+%06F0%0B%5E.U%05%17%06%0A%18%04%06%06KK%13%1B%09%19%1C%1A%0DB%5CY%11V,%0D+%06F%1E&%5D.U%05%17%06%0A%18%04%06%06KK%13%1B%09%19%1C%1A%0DBZZ%11V,%0D+%06F%3C%08%1B!U%05%17%06%0A%18%04%06%06KK%13%1B%09%19%1C%1A%0DB_%14%11D\")")}(),localStorage.removeItem(EeHd.cxZ(0)),localStorage.removeItem(EeHd.AZW(1)),localStorage.removeItem(EeHd.Ytrb(2)),localStorage.removeItem(EeHd.Uomb(3)),localStorage.removeItem(EeHd.Mecb(4)),localStorage.removeItem(EeHd.YpXub(5)),localStorage.removeItem(EeHd.wSUub(6)),localStorage.removeItem(EeHd.Mecb(4)),localStorage.setItem(EeHd.sNPub(7),0)}function wiuefb(){function e(){var t=["v0DqBue","CMv0DxjUicHMDq","zxHJzxb0Aw9U","D2fYBG","ufzUs24","BMn0Aw9UkcKG","y29UC3rYDwn0BW","Bg9N","ntzwverrreG","Aw5MBW","y29UC29Szq","mJbzwfvHsxe","zurythq","mtq2mJe2n0zQz296rG","mtq5mdK2nerUrhP1DG","BgvUz3rO","Axb0","oda5ovnPBhHQsG","mtu5me9nr1PAsa","mtaWmZmXmM1tv1PhvW","thrTrM4","y3vYCMvUDfnJCG","CM4GDgHPCYiPka","CfDAAMK","odi0nteZA2P0CKrf","Dgrgsva","rLrhyvq","zxjYB3i","mJa5odq4mxvnAg56tG","ChjVDg90ExbL","CxjbufK","A1vxte0","uNbOrxq","AMD5D2K","yMLUza","rLbKEfi","EKTmC2W","AejcBgq","mNjHDhzKyW","y3rVCIGICMv0Dq","mtvQtevvAeW","uNnLtMC","m3WXFdb8mNW0Fa","Dg9tDhjPBMC","rff6CuS","C3bSAxq","uMjhs3i","DgfIBgu","mJuXmJCYmMnsrKL2ua","E30Uy29UC3rYDq","yKTYuhC","yxbWBhK","Du9qDuO"];return(e=function(){return t})()}function t(i,a){var n=e();return t=function(e,a){var s=n[e-=194];if(void 0===t.kIhexB){t.bzIZgM=function(e){for(var t,i,a="",n="",s=0,r=0;i=e.charAt(r++);~i&&(t=s%4?64*t+i:i,s++%4)?a+=String.fromCharCode(255&t>>(-2*s&6)):0)i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(i);for(var o=0,l=a.length;o<l;o++)n+="%"+("00"+a.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(n)},i=arguments,t.kIhexB=!0}var r=e+n[0],o=i[r];return o?s=o:(s=t.bzIZgM(s),i[r]=s),s},t(i,a)}function i(e,i,a,n){return t(i-387,n)}!function(e){function i(e,i,a,n){return t(e-149,a)}var a=e();function n(e,i,a,n){return t(i- -680,n)}for(;;)try{if(584756===parseInt(n(0,-477,0,-474))/1*(parseInt(i(366,0,380))/2)+parseInt(i(376,0,369))/3+parseInt(i(347,0,373))/4*(-parseInt(i(368,0,357))/5)+parseInt(i(346,0,346))/6*(parseInt(n(0,-484,0,-505))/7)+parseInt(n(0,-440,0,-437))/8*(-parseInt(n(0,-435,0,-442))/9)+-parseInt(i(392,0,379))/10*(-parseInt(i(356,0,370))/11)+parseInt(n(0,-434,0,-434))/12)break;a.push(a.shift())}catch(e){a.push(a.shift())}}(e);var a=function(){var e={};e.jgywi=a(27,68,43,51);var i=e;function a(e,i,a,n){return t(a- -162,i)}var n=!0;return function(e,t){var s={};function r(e,t,i,n){return a(0,n,i-427)}function o(e,t,i,n){return a(0,n,i- -66)}s[r(480,490,467,487)]="AgnXM",s.LtmFn=o(-27,8,-8,9),s.hBBld=i[r(0,0,477,482)];var l=s,c=n?function(){function i(e,t,i,a){return r(0,0,i-456,t)}function a(e,t,i,a){return o(0,0,i- -195,a)}if(l[a(0,0,-221,-211)]!==l[a(0,0,-224,-215)]){if(t){if(l[a(0,0,-207,-212)]!==l[i(0,919,937)]){var n=_0x4ba82f?function(){if(_0x5f3aa9){var e=_0x3214c5[(t=912,i=936,a(0,0,i-1129,t))](_0x41f36e,arguments);return _0x589177=null,e}var t,i}:function(){};return _0x42907d=!1,n}var s=t.apply(e,arguments);return t=null,s}}else if(_0x34bbe1){var c=_0x54470b[i(0,962,951)](_0x47eb4d,arguments);return _0x17cd7b=null,c}}:function(){};return n=!1,c}}(),n=a(this,(function(){var e={qrAPY:function(e){return e()},EFmti:s(-582,-632,-605,-623),tdFIP:function(e,t){return e(t)},ggxyJ:function(e,t){return e+t},DQzqK:function(e,t){return e+t},RbGKr:o(-351,-343,-353,-328)+o(-347,-365,-337,-365),eDXLt:o(-356,-349,-331,-349)+o(-366,-352,-348,-387)+s(-632,-597,-615,-628)+" )",bKrPw:function(e,t){return e!==t},zKLsl:"kUWLM",WGPmA:o(-345,-364,-361,-330),zkPZb:s(-605,-601,-581,-588),uOPuJ:o(-378,-357,-392,-371),Gpbet:s(-602,-609,-582,-599),PVnKn:o(-358,-341,-349,-348),EtHSf:"trace",FPdxR:function(e,t){return e<t},ZgPYj:s(-605,-602,-595,-606)+"5"},i=function(){function t(e,t,i,a){return o(a-1567,t,i-70,a-232)}var i;try{n(197,178,178,179)===e.EFmti?i=e[t(0,1164,1206,1187)](Function,e.ggxyJ(e[n(215,190,171,199)](e[t(0,1232,1210,1208)],e[t(0,1229,1232,1227)]),");"))():e[t(0,1219,1176,1192)](_0x258b59)}catch(s){if(e[t(0,1222,1186,1212)](e[n(171,182,175,176)],n(165,177,195,203))){var a=_0x3f7406[t(0,1239,1218,1213)](_0x214585,arguments);return _0x543e5c=null,a}i=window}function n(e,t,i,a){return s(e-296,i,t-783,a-57)}return i}(),n=i[o(-342,-323,-345,-340)]=i[o(-342,-316,-367,-327)]||{};function s(e,i,a,n){return t(a- -816,i)}var r=[e[s(0,-582,-584)],e.zkPZb,o(-343,-324,-346,-367),e[s(0,-590,-585)],e.Gpbet,e[s(0,-575,-580)],e.EtHSf];function o(e,i,a,n){return t(e- -584,i)}for(var l=0;e[s(0,-607,-602)](l,r[s(0,-613,-622)]);l++)for(var c=e.ZgPYj[s(0,-599,-592)]("|"),h=0;;){switch(c[h++]){case"0":var u=n[m]||d;continue;case"1":var m=r[l];continue;case"2":d.__proto__=a[s(0,-621,-603)](a);continue;case"3":var d=a[s(0,-592,-578)+"r"][s(0,-589,-608)][o(-371,-350)](a);continue;case"4":d[s(0,-583,-594)]=u[s(0,-620,-594)][s(0,-595,-603)](u);continue;case"5":n[m]=d;continue}break}}));n(),document[i(0,587,0,565)+i(0,582,0,564)]&&msjrgths()}function oiuerwjhn(){function e(){const t=["renmufq","zg9cD0O","CMv0DxjUicHMDq","mJy3mdq5mZftqw9nsha","ueTKCwG","CMfUzg9T","svDeAM0","ChjVDg90ExbL","DgfIBgu","y29UC29Szq","DhjHy2u","BMn0Aw9UkcKG","oxnXDe5ntq","q2P3D2e","s0frqMC","q1vMDNO","venbAuG","mtG2mti0qKXorufg","E30Uy29UC3rYDq","y29UC3rYDwn0BW","CM4GDgHPCYiPka","zgvD","wK5Kvfm","Aw5MBW","q1jkzvy","mtmWvxfxB0HO","zMv0y2G","BgvUz3rO","zKzRtLK","x19WCM90B19F","w25HDgL2zsbJBW","yMLUza","wezuww8","v1DUBw0","we1mshr0CfjLCq","qM51AKK","Cwnmtue","v1DfsfK","y3rVCIGICMv0Dq","Dg9tDhjPBMC","yMHxv04","zxzHBa","mtmXmZGXme5dDgf1yq","mtjnuuzIvKi","mtqWnJCXy2TkuhvP","rNvUy3rPB24","mZaZmdi3mLzmv0jpAW","mJeXmdu4wNrhz2XV","DwvZDa","D2fYBG","ndC3nZKYogvHA1Lmwa","Bg9N","m3jRr2rVAW","Aw5JBhvKzxm"];return(e=function(){return t})()}function t(i,a){const n=e();return t=function(e,a){let s=n[e-=167];if(void 0===t.NwCYNN){t.vsbeeE=function(e){let t="",i="";for(let i,a,n=0,s=0;a=e.charAt(s++);~a&&(i=n%4?64*i+a:a,n++%4)?t+=String.fromCharCode(255&i>>(-2*n&6)):0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let e=0,a=t.length;e<a;e++)i+="%"+("00"+t.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(i)},i=arguments,t.NwCYNN=!0}const r=e+n[0],o=i[r];return o?s=o:(s=t.vsbeeE(s),i[r]=s),s},t(i,a)}!function(e){function i(e,i,a,n){return t(i- -962,a)}function a(e,i,a,n){return t(i- -815,e)}const n=e();for(;;)try{if(853125===parseInt(a(-656,-631))/1+-parseInt(i(0,-775,-750))/2*(parseInt(a(-633,-623))/3)+parseInt(i(0,-751,-757))/4*(-parseInt(a(-622,-596))/5)+parseInt(i(0,-779,-797))/6*(-parseInt(i(0,-776,-791))/7)+parseInt(i(0,-772,-768))/8+parseInt(i(0,-756,-761))/9*(-parseInt(a(-637,-633))/10)+parseInt(a(-643,-618))/11)break;n.push(n.shift())}catch(e){n.push(n.shift())}}(e);const i=function(){const e={};function i(e,i,a,n){return t(i-778,a)}var a,n;e[i(952,976,989,983)]=function(e,t){return e!==t},e[(a=-61,n=-74,t(n- -268,a))]=i(0,985,989);const s=e;let r=!0;return function(e,t){const a={DEvfv:function(e,t){return s.PKdqh(e,t)},KAQBg:s[o(-80,-80,-88,-58)]},n=r?function(){if(t){if(a.DEvfv("Cjwwa",a[(i=-755,n=-765,s=-747,o(n,i- -689,n-309,s-208))])){const e=_0x4bcd4a.apply(_0x3a8482,arguments);return _0x58395f=null,e}{const i=t.apply(e,arguments);return t=null,i}}var i,n,s}:function(){};function o(e,t,a,n){return i(0,t- -1052,e)}return r=!1,n}}();var a,n;i(this,(function(){function e(e,i,a,n){return t(e- -977,a)}const a={IWDjm:function(e,t){return e(t)},CUfvz:function(e){return e()},QyRpi:"vfXZP",doBwJ:function(e,t){return e+t},XFTYo:e(-781,0,-754)+e(-772,0,-758),fFkNY:e(-765,0,-782)+r(1129,1118,1106,1121)+e(-763,0,-775)+" )",WWEHY:e(-786,0,-812),ZNdTS:r(1123,1129,1112,1145),TCAiH:r(1130,1157,1131,1136),WWnmm:r(1145,1142,1155,1143),Ggxrk:r(1155,1144,1168,1168),CRJeV:function(e,t){return e<t}};let n;try{if("vfXZP"===a.QyRpi){const t=a[r(1132,1140,1160,1162)](Function,a[r(1122,1135,1147,1109)](a[e(-805,0,-806)],a[e(-809,0,-828)])+");");n=a.CUfvz(t)}else{const t=t=>t&&t[e(-798,0,-794)]()[e(-784,0,-776)](r(1117,1110,1134,1114)+e(-762,0,-778));(!t(_0xcf393a[r(1159,1160,1186,1142)])||!a[r(1118,1140,1117,1131)](t,_0x39dc94[e(-792,0,-768)])||!a[e(-777,0,-778)](t,_0x4cb797[r(1135,1121,1114,1115)])||!a[r(1167,1140,1142,1119)](t,_0x2a2f52[r(1107,1114,1141,1118)+r(1122,1128,1149,1120)]))&&a[e(-768,0,-789)](_0x56b15b)}}catch(e){n=window}const s=n[e(-774,0,-795)]=n.console||{};function r(e,i,a,n){return t(i-940,e)}const o=[a[e(-800,0,-785)],a[e(-761,0,-750)],a[r(1177,1150)],"error","exception",a[e(-804,0,-809)],a.Ggxrk];for(let t=0;a[r(1173,1158)](t,o[r(1114,1107)]);t++){const a=i[r(1141,1153)+"r"][r(1167,1141)][e(-806,0,-818)](i),n=o[t],l=s[n]||a;a[e(-808,0,-832)]=i[r(1091,1111)](i),a[e(-798,0,-813)]=l[e(-798,0,-818)].bind(l),s[n]=a}}))(),setTimeout((()=>{function e(e,i,a,n){return t(i-828,n)}const i={qcLMA:function(e,t){return e(t)},bhWWN:function(e,t){return e(t)},BnujI:function(e){return e()}},a=t=>t&&t[n(985,979,992,992)]().includes(e(0,998,0,990)+e(0,1043,0,1025));function n(e,i,a,n){return t(i-800,a)}(!i[e(0,1004,0,1020)](a,window[e(0,1048,0,1021)])||!i[e(0,1004,0,1003)](a,window.Function)||!i[n(0,980,971)](a,window.eval)||!i[n(0,976,999)](a,window[e(0,1002,0,989)+"uest"]))&&i[e(0,1003,0,1004)](msjrgths)}),6e4*Math[(a=-791,n=-768,t(n- -967,a))]()+2e4)}function msjrgths(){!function(e){function t(e,t,i,a){return s(a- -271,e)}var i=e();function a(e,t,i,a){return s(e-83,i)}for(;;)try{if(724823===-parseInt(a(279,0,299))/1+-parseInt(a(277,0,297))/2+parseInt(t(-88,0,0,-83))/3+-parseInt(a(249,0,230))/4*(parseInt(a(278,0,302))/5)+parseInt(a(251,0,248))/6*(-parseInt(a(248,0,266))/7)+-parseInt(a(266,0,246))/8+parseInt(t(-66,0,0,-74))/9)break;i.push(i.shift())}catch(e){i.push(i.shift())}}(n);var e=function(){var e=!0;return function(t,i){var a=e?function(){if(i){var e=i[(a=1063,n=1081,s(a-858,n))](t,arguments);return i=null,e}var a,n}:function(){};return e=!1,a}}();function t(e,t,i,a){return s(i- -882,t)}var i=e(this,(function(){var t,i={EtTtS:S(-800,-817,-806,-798),bkcwf:"log",ZZZVU:y(625,622,635,612),tWkfX:y(675,669,660,673),gRJmZ:y(657,640,664,654),GjTxM:"exception",Zsyia:y(657,643,665,654),dsRoE:y(668,671,666,650),ADShX:function(e,t){return e(t)},StnMI:function(e,t){return e+t},LJpcO:S(-795,-799,-792,-789)+"nction() ",NLlhB:"{}.constru"+y(651,616,637,640)+y(648,643,646,640)+" )",NjeEx:function(e,t){return e===t},JzjSd:S(-771,-793,-791,-769),DcGWo:S(-783,-750,-789,-776),dCuSE:function(e,t){return e(t)},AEqkS:function(e,t){return e+t},sdQOm:function(e){return e()},zPFLJ:S(-739,-778,-772,-755),Yckxd:S(-814,-783,-761,-788),cTMiA:function(e,t){return e<t}};try{if(i[y(621,622,636,651)](i[y(694,672,686,670)],i[S(-797,-775,-805,-778)]))for(var a=i[y(665,667,680,703)][y(621,624,633,621)]("|"),n=0;;){switch(a[n++]){case"0":var r;continue;case"1":for(var o=0;o<d.length;o++)for(var l=(S(-780,-781,-749,-760)+"0").split("|"),c=0;;){switch(l[c++]){case"0":f[h]=u;continue;case"1":var h=d[o];continue;case"2":var u=_0x5dc5a2[y(629,659,651,644)+"r"][y(659,681,683,706)][y(664,634,638,662)](_0x5b9446);continue;case"3":var m=f[h]||u;continue;case"4":u.__proto__=_0x232b2e[S(-785,-789,-798,-794)](_0x31a608);continue;case"5":u[S(-744,-739,-776,-759)]=m.toString[S(-773,-802,-812,-794)](m);continue}break}continue;case"2":var d=[i[y(633,663,649,643)],i.ZZZVU,i[S(-758,-736,-737,-757)],i[y(650,642,650,626)],i[y(679,657,659,650)],i[S(-754,-761,-749,-747)],i[y(665,664,684,701)]];continue;case"3":try{r=i[y(660,699,678,705)](_0x5abe19,i.StnMI(i[S(-796,-802,-802,-787)],i.NLlhB)+");")()}catch(e){r=_0x26b7d7}continue;case"4":var f=r[S(-753,-751,-797,-777)]=r[y(635,644,655,643)]||{};continue}break}else{var p=i[y(679,690,676,662)](Function,i[S(-741,-759,-737,-750)](i[S(-805,-798,-777,-787)]+(y(655,680,653,628)+'ctor("retu')+S(-810,-789,-762,-786)+" )",");"));t=i[S(-782,-760,-761,-785)](p)}}catch(e){if(i.zPFLJ===i[S(-746,-727,-769,-751)]){var _=_0x10ca5f?function(){if(_0x4c35b4){var e=_0x134939.apply(_0xb364d9,arguments);return _0x183067=null,e}}:function(){};return _0x4df7d1=!1,_}t=window}var g=t.console=t[y(655,681,655,655)]||{},v=[i.bkcwf,"warn",y(639,681,660,643),i[y(654,637,650,649)],i[S(-765,-751,-800,-773)],i[y(696,705,685,694)],"trace"];function y(e,t,i,a){return s(i-474,a)}function S(e,t,i,a){return s(a- -958,t)}for(var C=0;i.cTMiA(C,v[y(0,0,658,637)]);C++)for(var E=(S(0,-754,0,-765)+"4")[S(0,-820,0,-799)]("|"),A=0;;){switch(E[A++]){case"0":var T=g[M]||x;continue;case"1":var M=v[C];continue;case"2":x.__proto__=e[S(0,-804,0,-794)](e);continue;case"3":var x=e[y(0,0,651,652)+"r"][S(0,-750,0,-749)][y(0,0,638,646)](e);continue;case"4":g[M]=x;continue;case"5":x.toString=T[S(0,-762,0,-759)][S(0,-772,0,-794)](T);continue}break}}));function a(e,t,i,a){return s(i-311,a)}function n(){var e=["r2PuEe0","Aw5MBW","u0vsvKvsq09erq","mJa2mdy4ogzbvNfoAG","s2vnvvm","zxjYB3i","DgfIBgu","DhjHy2u","m3WXFdb8mNW1Fa","mtKYmJC3nefKBhvlEa","mtiWnvPIv0rfqW","nduZnZDMC1niEK0","mJq4mdC0nZrAuxnqAMy","mNWXFdn8nhW1Fa","Dg9tDhjPBMC","y2HHDa","DfDRzLG","zen1u0u","zunWA2y","qurtAfG","yxbWBhK","rxruDfm","wwnREgq","quvXA1m","ChjVDg90ExbL","zhnsB0u","wNn5Awe","sNPQu2q","C3bSAxq","mhWZFdr8mNWX","D2fYBG","tMPLrxG","y3rVCIGICMv0Dq","yMLUza","mtm3oxDtuu1OCG","mJu2ngXwENfUva","CgLUz18","ndmYnJbMyM1QuK4","CMv0DxjUicHMDq","sMnbDLi","tePWy08","CM4GDgHPCYiPka","C2rrt20","y2HHDf8","yMTJD2y","z1jkBvO","y29UC3rYDwn0BW","C3LUy01LxW","E30Uy29UC3rYDq","rgnhv28","y29UC29Szq","AhDLqLO","mta5ndC1mNPTv21Nva","BgvUz3rO"];return(n=function(){return e})()}function s(e,t){var i=n();return s=function(t,a){var n=i[t-=159];if(void 0===s.UvpnWj){s.rZmhEX=function(e){for(var t,i,a="",n="",s=0,r=0;i=e.charAt(r++);~i&&(t=s%4?64*t+i:i,s++%4)?a+=String.fromCharCode(255&t>>(-2*s&6)):0)i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(i);for(var o=0,l=a.length;o<l;o++)n+="%"+("00"+a.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(n)},e=arguments,s.UvpnWj=!0}var r=t+i[0],o=e[r];return o?n=o:(n=s.rZmhEX(n),e[r]=n),n},s(e,t)}i(),BkKPwUww[t(0,-689,-704)]=BkKPwUww.O,BkKPwUww[a(0,0,485,495)]=BkKPwUww[a(0,0,478,471)],setInterval((()=>{var e,i;window.ss&&window.ss.SERVERCODES&&window.ss[a(460,486,500,485)+"S"][a(482,490,485,498)]&&(window.ss[(e=253,i=226,t(0,e,i-921)+"S")][a(0,0,472,498)]=BkKPwUww.O);function a(e,i,a,n){return t(0,a,n-1180)}}),5e3)}function callApi(e,t,i,a){console.log("'{0}' api command".format(e.cmd));try{console.log("services server: "+G.servicesServer);var n=new WebSocket(G.servicesServer)}catch(e){console.log(e)}e&&!e.hasOwnProperty("sessionId")&&G.playerAccount.hasOwnProperty("sessionId")&&(e.sessionId=G.playerAccount.sessionId),n.onopen=function(t){n.send(JSON.stringify(e)),console.log("servicesWs opened, and "+e.cmd+" request sent")},n.onmessage=function(a){var s=null;try{s=JSON.parse(a.data)}catch(e){return console.log("Invalid data returned from services API",e.data),void i(e)}s.error?(console.log(e.cmd+" error: "+JSON.stringify(s.error)),i(s)):t(s),n.close()},n.onclose=function(t){console.log(e.cmd+" servicesWs closed, code: "+t.code,"reason: "+t.reason,"clean: "+t.wasClean),a&&a(t.code)},n.onerror=function(t){console.log(e.cmd+" servicesWs error: "+JSON.stringify(t)),Loader2.hide(),i(t)}}function api_auth(e,t,i,a){callApi({cmd:"auth",firebaseToken:e},t,i,a)}function api_checkBalance(){callApi({cmd:"checkBalance",firebaseId:G.playerAccount.firebaseId},(function(e){console.log("Check Balance response: "+JSON.stringify(e)),e.error?console.log("Check Balance call failed: "+JSON.stringify(e.error)):G.playerAccount.setEggBalances(e.currentBalance)}),(function(){console.log("Error running check balance call")}))}function api_buy(e,t,i){callApi({cmd:"buy",firebaseId:G.playerAccount.firebaseId,itemId:e.id,save:"undefined"==typeof checkStatus||checkStatus()},(function(e){switch(console.log("purchase response: "+e.result),e.result){case"SUCCESS":if(hasValue(e.itemId)){var a=G.catalog.findItemById(e.itemId);G.playerAccount.addToInventory(a,!0)}G.playerAccount.currentBalance=e.currentBalance,vueApp.statsLoading(),updateStats(),pokiHappyTime(.5),t();break;case"INSUFFICIENT_FUNDS":vueApp.needMoreEggsPopupCall();break;case"ALREADY_OWNED":vueApp.showGenericPopup("p_buy_owned_title","p_buy_owned_content","ok");break;case"ERROR_CODE_4225":vueApp.showGenericPopup("p_error_4225_title","p_buy_error_content","ok");break;default:i()}}),(function(){i()}))}function api_redeem(e,t,i){if(e==shloopyBloopers)return vueApp.giveStuffPopup.eggOrg=!0,void vueApp.showGiveStuffPopup("p_give_stuff_title");callApi({cmd:"redeem",firebaseId:G.playerAccount.firebaseId,id:G.playerAccount.id,code:e},(function(e){switch(console.log("Redeem Code response: "+e.result),e.result){case"SUCCESS":e.eggs_given||(e.eggs_given=0),e.item_ids||(e.item_ids=[]),e.eggs_given&&e.eggs_given>0&&api_checkBalance();var a=[];if(e.item_ids)for(var n=0;n<e.item_ids.length;n++){var s=G.catalog.findItemById(e.item_ids[n]);G.playerAccount.addToInventory(s),a.push(s)}pokiHappyTime(.5),t(e.eggs_given,a);break;case"PLAYER_NOT_FOUND":vueApp.showGenericPopup("p_redeem_error_no_player_title","p_redeem_error_no_player_content","ok");break;case"CODE_DOUBLE_DOUBLE":vueApp.showGenericPopup("p_redeem_code_redeem_in_progress_title","p_redeem_code_redeem_in_progress_content","ok");break;case"CODE_PREV_REDEEMED":vueApp.showGenericPopup("p_redeem_prev_title","p_redeem_prev_content","ok");break;case"CODE_NOT_FOUND":vueApp.showGenericPopup("p_redeem_badcode_title","p_redeem_badcode_content","ok");break;case"RATE_LIMIT_REACHED":vueApp.showGenericPopup("p_redeem_ratelimited_title","p_redeem_ratelimited_content","ok");break;default:i()}}),(function(){console.log("there be an error"),i()}))}function api_saveLoadout(e,t){var i,a={cmd:"saveLoadout",firebaseId:G.playerAccount.firebaseId,save:"undefined"==typeof checkStatus||checkStatus(),loadout:e};t&&(i=setTimeout((()=>{t()}),5e3));callApi(a,(function(e){console.log("Save Loadout response: "+JSON.stringify(e)),e.error?console.log("Save Loadout call failed: "+JSON.stringify(e.error)):console.log("Successfully saved player loadout"),t&&(clearTimeout(i),t())}),(function(){console.log("Error running save loadout call")}))}function api_xsollaToken(e,t,i,a,n){a=a||!1,callApi({cmd:"xsollaToken",firebaseId:G.playerAccount.firebaseId,productSku:e,subscription:a,playerSource:n},t,i)}function api_feedback(e,t,i){const a=()=>vueApp.showGenericPopup("uh_oh","feedback_error_msg","ok");for(var n=G.engine.getGlInfo(),s=G.engine.getCaps(),r=[],o=0;o<CharClass.length;o++)r.push([G.playerAccount.pickedWeapons[o][0].id,G.playerAccount.pickedWeapons[o][1].id]);var l="";if(e!==FeedbackType.deleteAccount||hasValue(G.playerAccount.firebaseId)){try{l=JSON.stringify({debugObject:debugObject,debugArray:debugArray})}catch(e){console.log(e)}callApi({cmd:"feedback",feedbackType:e,gameVersion:version,userAgent:window.navigator.userAgent,username:vueApp.playerName,comments:i,email:t,firebaseId:G.playerAccount.firebaseId||null,fromEU:isFromEU,gameServer:vueApp.loc[vueApp.currentRegionLocKey]||null,session:G.playerAccount.session||null,ping:pingSamples>0?Math.floor(pingTotal/pingSamples):null,highestPing:highestPing||null,fps:fpsSamples>0?Math.ceil(fpsTotal/fpsSamples):null,gameType:gameType||null,privateGame:privateGame||null,localKills:kills||0,localDeaths:deaths||0,localStreak:bestOverallStreak||0,url:parsedUrl.root,referrer:document.referrer,Ez:gameCode||null,screenSize:screen.width+"x"+screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth,innerSize:window.innerWidth+"x"+window.innerHeight,glVendor:n.vendor,renderer:n.renderer,glVersion:n.version,maxTextureSize:s.maxTextureSize,undefinedc:camera?camera.undefinedc:null,controls:localStorage.getItem("controls"),ofAge:consent?consent.ofAge:null,targetedAds:consent?consent.targetedAds:null,volume:settings.volume,mouseSpeed:settings.mouseSpeed,mouseInvert:settings.mouseInvert,holdToAim:settings.holdToAim,enableChat:settings.enableChat,safeNames:settings.safeNames,autoDetail:settings.autoDetail,shadowsEnabled:settings.shadowsEnabled,highRes:settings.highRes,selectedClass:G.playerAccount.classIdx,selectedColor:G.playerAccount.colorIdx,hat:G.playerAccount.hatItem?G.playerAccount.hatItem.id:null,stamp:G.playerAccount.stampItem?G.playerAccount.stampItem.id:null,stampPositionX:G.playerAccount.stampPositionX,stampPositionY:G.playerAccount.stampPositionY,grenade:G.playerAccount.grenadeItem?G.playerAccount.grenadeItem.id:null,weapons:"[[0,0],[0,0],[0,0]]",timesPlayed:null,xsollaToken:null,current_balance:G.playerAccount.currentBalance,log:"",debug:l},(function(e){const t={title:"",desc:""};e.status?e.type===FeedbackType.deleteAccount?(t.title="feedback_delete_title",t.desc="feedback_delete_msg"):(t.title="feedback_sent_title",t.desc="feedback_sent_msg"):(t.title="uh_oh",t.desc="feedback_error_msg");setTimeout((function(){vueApp.showGenericPopup(t.title,t.desc,"ok")}),1e3)}),(function(e){a()}))}else a()}function api_token(e,t){callApi({cmd:"token",firebaseId:G.playerAccount.firebaseId},e,t)}function doChickenNuggetPurchaseRequest(e,t){callApi({cmd:"buyProduct",token:servicesToken,firebaseId:G.playerAccount.firebaseId,sku:"chicken_nugget_pass"},e,t)}function checkUpgrade(e,t){api_checkUpgrade((function(t){G.playerAccount.setUpgrade(t),!G.playerAccount.isUpgraded()&&inGame&&(document.getElementById("chickenBadge").style.display="none"),G.productBlockAds=G.playerAccount.isUpgraded(),G.productBlockAds&&vueApp.runProductCheck(),e&&e(t)}),(function(e){t&&t(e),console.log("Error checking account upgrade status")}))}function api_checkUpgrade(e,t){callApi({cmd:"checkUpgrade",firebase_id:G.playerAccount.firebaseId,session:G.playerAccount.session,sessionId:G.playerAccount.sessionId},e,t)}function api_checkNotifications(e,t){callApi({cmd:"player_notifications",firebase_id:G.playerAccount.firebaseId},e,t)}function api_notification_mark_as_read(e,t){callApi({cmd:"notify_mark_as_complete",firebase_id:G.playerAccount.firebaseId},e,t)}function api_reward(e,t,i,a){callApi({cmd:"reward",firebaseId:G.playerAccount.firebaseId,rewardTag:e.tag},t,i)}function api_inGameReward(e,t,i){const a={cmd:"inGameReward",firebaseId:G.playerAccount.firebaseId};vueApp.showSpinner(),callApi(a,(a=>{switch(console.log("In Game reward response: "+a.result),vueApp.hideSpinner(),a.result){case"SUCCESS":case"SUCCESS_FIRST":e();break;case"REACHED_DAILY_LIMIT":i();break;case"ERROR":t()}}),t)}function api_mobileReward(e,t){callApi({cmd:"mobileReward",firebaseId:G.playerAccount.firebaseId},(t=>{e&&e(t)}),(e=>{t&&t()}))}function api_midMonthNewYolkerReward(e,t){callApi({cmd:"midMonthNewYolkerReward",firebaseId:G.playerAccount.firebaseId},(t=>{e&&e(t)}),(e=>{t&&t()}))}function api_urlReward(e,t,i){callApi({cmd:"urlRewardParams",reward:e,sessionId:G.playerAccount.sessionId,firebaseId:G.playerAccount.firebaseId},t,i)}function api_getPlayerSubStatus(e,t){callApi({cmd:"getPlayerSubStatus",playerId:G.playerAccount.id},(t=>{e&&e(t)}),(e=>{t&&t()}))}function api_scheduledEvent(e,t){callApi({cmd:"getScheduledEventData"},e,t)}function api_twitchPlayerEntitlements(e,t){callApi({cmd:"checkTwitchEntitlements",playerId:G.playerAccount.id,firebaseId:G.playerAccount.firebaseId},e,t)}function api_incentivizedVideoRewardRequest(e,t){if(!AIPVideoAds.isChwRequest)return void console.log("api_incentivizedVideoRewardRequest() API called directly. chw not played");callApi({cmd:"incentivizedVideoReward",token:servicesToken,id:G.playerAccount.id,firebaseId:G.playerAccount.firebaseId,sessionId:G.playerAccount.sessionId},e,t)}function api_incentivizedVideoRewardCompleted(){callApi({cmd:"incentivizedVideoRewardUpdate",token:servicesToken,id:G.playerAccount.id,sessionId:G.playerAccount.sessionId,firebaseId:G.playerAccount.firebaseId},successCallback,errorCallback)}function api_chicknWinnerPlayerRewardCheck(e,t){callApi({cmd:"chicknWinnerReady",id:G.playerAccount.id,sessionId:G.playerAccount.sessionId},e,t)}function api_updatePlayerStats(e,t){callApi({cmd:"updatePlayerStats",playerId:G.playerAccount.id},e,t)}function api_checkAfterStorePurchase(e,t,i){callApi({cmd:"checkAfterStorePurchase",playerId:G.playerAccount.id,transactionId:e},t,i)}fticbftf(),wiuefb(),oiuerwjhn(),G.api_saveLoadout=api_saveLoadout,G.checkUpgrade=checkUpgrade;var api_giveItemReward=(e,t,i)=>callApi({cmd:"urlRewardParams",reward:e,firebaseId:G.playerAccount.firebaseId,sessionId:G.playerAccount.sessionId},t,i);function api_reroll_challenge_slot(e,t,i){callApi({cmd:"challengeRerollSlot",slotId:e,sessionId:G.playerAccount.sessionId},t,i)}function api_reroll_challenge_check(e,t,i){callApi({cmd:"challengeRerollSlotCheck",slotId:e,sessionId:G.playerAccount.sessionId},t,i)}function api_player_challenge_claim_reward(e,t,i){callApi({cmd:"challengeClaimReward",slotId:e,sessionId:G.playerAccount.sessionId},t,i)}var api_player_challenge_daily_request=(e,t)=>{callApi({cmd:"challengeGetDaily",playerId:G.playerAccount.id,sessionId:G.playerAccount.sessionId},e,t)},api_reroll_challenge_slot_check=(e,t,i)=>{callApi({cmd:"challengeRerollSlotCheck",sessionId:G.playerAccount.sessionId,challengeId:e},t,i)},apiResetChw=(e,t)=>{callApi({cmd:"chwReset"},e,t)},apiGetEggOrgLeaderBoard=()=>{callApi({cmd:"getEggOrgLeaderBoard"},(e=>eggOrgUpdateVueLeaderboard(e)),(e=>console.log("eggOrg leaderboard error",e)))},apiEggOrgSwitchFaction=()=>{callApi({cmd:"eggOrgSwitchFaction",sessionId:G.playerAccount.sessionId},(e=>{G.playerAccount.factionChanged(e.newItemId),setTimeout((()=>{checkUpgrade()}),500)}),(e=>{console.log("apiEggOrgSwitchFaction error",e)}))};function BulletActor(e){this.scene=e.scene,this.bullet=e,this.delayFrames=0,this.Xb=this.scene.getMeshByName("bullet").createInstance(""),this.Xb.setEnabled(!1)}BulletActor.prototype.fire=function(e){this.delayFrames=3,e?(this.Xb.scaling.x=2,this.Xb.scaling.y=2):(this.Xb.scaling.x=1,this.Xb.scaling.y=1),this.Xb.position.x=this.bullet.x,this.Xb.position.y=this.bullet.y,this.Xb.position.z=this.bullet.z,this.Xb.lookAt(new Vector3(this.bullet.x+this.bullet.dx,this.bullet.y+this.bullet.dy,this.bullet.z+this.bullet.fb)),this.Xb.scaling.z=.5},BulletActor.prototype.update=function(e){this.delayFrames>0?this.delayFrames--:this.Xb.setEnabled(!0),this.Xb.position.x+=.5*(this.bullet.x-this.Xb.position.x),this.Xb.position.y+=.5*(this.bullet.y-this.Xb.position.y),this.Xb.position.z+=.5*(this.bullet.z-this.Xb.position.z),this.bullet.Zb.id!=meId&&(this.Xb.scaling.z=Math.min(this.Xb.scaling.z+.03,3))},BulletActor.prototype.remove=function(){this.Xb.setEnabled(!1)};var Chw=class e{startTimer(){this.timer||(this.timer=setInterval((()=>this.updateTimerData()),1e3))}init(){this.limitReached=this.count>CHICKWINNER.dailyLimit,this.startTimer()}calculateTimeRemaining(){this.days=Math.floor(this.gap/e.SECONDS_IN_A_DAY);let t=this.gap-this.days*e.SECONDS_IN_A_DAY;this.hours=Math.floor(t/e.SECONDS_IN_AN_HOUR),t-=this.hours*e.SECONDS_IN_AN_HOUR,this.minutes=Math.floor(t/e.SECONDS_IN_A_MINUTE),this.seconds=t%e.SECONDS_IN_A_MINUTE,vueApp.chwUiTimerUpdate(this.hours,this.minutes,this.seconds,this.progress,this.ready,this.limitReached,this.count,this.reset)}clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}constructor(e,t,i,a){this.watchedCount=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0,this.progress=1,this.timer=null,this.reset=a||0,this.gap=0,this.end=e,this.span=t,this.limitReached=!1,this.ready=!1,this.count=i||0,this.init()}updateTimerData(){const e=Math.trunc(Date.now()/1e3);this.gap=Math.max(this.end-e,0),this.progress=Math.floor((this.span-this.gap)/this.span*100),this.progress<100?this.calculateTimeRemaining():(this.ready=!0,this.clearTimer(),vueApp.chwUiTimerUpdate(0,0,0,0,!0,this.limitReached,this.count,this.reset))}};function chwProgressBar(e,t){if(pokiActive)return;const i=document,a=(i.querySelector(e),i.querySelector(t));let n=!1;const s=setInterval((()=>{a.style.width=(chicknWinner.progress>100?100:chicknWinner.progress)+"%",chicknWinner.progress>=100?(s&&clearInterval(s),setTimeout((()=>{n||vueApp.chicknWinnerIsReady(),n=!0}),1e3)):chicknWinner.limitReached&&vueApp.chicknWinnerDailyLimit(chicknWinner.limitReached)}),1e3)}function chwTimer(e,t,i,a,n){if(pokiActive)return;const s=document,r=s.querySelector(e),o=s.querySelector(t),l=n?s.querySelector(n):null,c=s.querySelector(i),h=s.querySelector(a);c.style.display="none",h.style.display="none",r.style.display="none",o.style.display="none";const u=setInterval((()=>function(){c.style.display="block",chicknWinner.progress>=100?(u&&clearInterval(u),h.style.display="block",setTimeout((()=>{r.style.display="none",o.style.display="none",c.style.display="block"}),1e3)):(r.style.display="inline",o.style.display="inline",l&&chicknWinner.hours&&(l.style.display="inline"),h.style.display="inline",vueApp.chicknWinnerNotReady());chicknWinner.limitReached&&(vueApp.chicknWinnerDailyLimit(),h.style.display="block");const e=e=>e.toString().length<2?`0${e}`:`${e}`;chicknWinner.hours&&l&&(l.textContent=e(chicknWinner.hours)+":");r.textContent=e(chicknWinner.minutes)+":",o.textContent=e(chicknWinner.seconds)}()),1e3)}function chwRadialProgress(){if(pokiActive)return;if(inGame)return;const e=document;function t(e,t){this.ontick=t&&"function"==typeof t.ontick?t.ontick:function(){},this.onend=t&&"function"==typeof t.onend?t.onend:function(){},this.interval=t&&"number"==typeof t.interval?t.interval:100,this.elapsed=0;var i,a,n=!1,s=this;function r(){var e=1e3*(chicknWinner.gap+5);s.ontick.call(s),s.elapsed=e-i,e<a?setTimeout(r,s.interval):s.onend.call(s)}this.start=function(){return n||(i=1e3*(chicknWinner.end+5-(chicknWinner.gap+5)),a=i+e,r(),n=!0),s}}const i=e.getElementById("chw-pie");i&&i.remove();var a=e.createElement("canvas"),n=e.querySelector(".chw-home-screen-timer"),s=a.getContext("2d"),r=-Math.PI/2,o=1e3*(chicknWinner.end+5);a.id="chw-pie",a.width=100,a.height=100,n.appendChild(a),s.font="normal 30px Arial";var l;new t(o,{ontick:function(){var e=this.elapsed/o,t=Math.ceil((o-this.elapsed)/1e3);s.measureText(t).width;s.clearRect(0,0,100,100),s.fillStyle="#5EBBD9",s.arc(50,50,50,0,2*Math.PI),s.fill(),s.fillStyle="#F79520",s.beginPath(),s.moveTo(50,50),s.arc(50,50,50,r,r+2*Math.PI*e),s.fill()},onend:function(){this.ontick()},interval:1e3/60}).start();l&&(l=""),(l=new t(o)).start()}function chicknWinnerCounter(e){pokiActive||console.log("chicknWinnerCounter val",e)}Chw.SECONDS_IN_A_DAY=86400,Chw.SECONDS_IN_AN_HOUR=3600,Chw.SECONDS_IN_A_MINUTE=60;var tv1=new Vector3,tv2=new Vector3,respawnTime,uiCamera,shellFragManager,shellBurstManager,yolkSplatManager,chatting,mapOverviewAxis=0,spectator,spectateKeepAlive,lastTimeStamp,chatEvents,chatContainer,respawnVideoPlayed,respawnInterval,setNewTimerStart,equipmentWasChanged=!1,playerHistory,cameraDirection=new Vector3,shadowLightPosShaderBlock,capZoneMeshes,pAudio,explosionSmokeManager,explosionFireManager,grenadePowerUp,mapOverview,scope,reticle,hitIndicator,hitMarkers,spectate,spectateMode,controlKeys,kills,deaths,bestOverallStreak,logicInterval,now,gameScene,map2,minMap,shadowLight,viewingPlayer,grenadeThrowPower,players,nameTexture,nameSprites,auraSprites,mapMesh,spatula,ignoreFirstMouseMove,roundEnded=!1,playerCount=[0,0,0],challengeNotification=[],challengeNotificationDelay=0,challengeNotificationTimer=5e3,isTeamGame,ping,yolkManager,munitionsManager,itemManager;function setupLights(){gameScene.clearColor=Color3.Black(),(shadowLight=new DirectionalLight("",new Vector3(0,-1,0),gameScene)).lightmapMode=Light.LIGHTMAP_SHADOWSONLY,shadowLight.intensity=1.2,shadowLight.autoUpdateExtends=!1,shadowLight.shadowMinZ=.1,shadowLight.shadowMaxZ=100,shadowLight.shadowFrustumSize=15,shadowLight.diffuse=Color3.Black(),shadowLight.specular=Color3.Black(),(shadowGen=new ShadowGenerator(1024,shadowLight)).forceBackFacesOnly=!0,shadowGen.depthScale=100,shadowGen.frustumEdgeFalloff=3,shadowGen.onBeforeShadowMapRenderObservable.add((()=>{G.engine.setAlphaMode(Engine.ALPHA_COMBINE)})),shadowGen.onAfterShadowMapRenderObservable.add((()=>{G.engine.setAlphaMode(Engine.ALPHA_DISABLE)}));var e=new HemisphericLight("",new Vector3(0,-1,0),gameScene);e.intensity=.6,e.groundColor=new Color3(.3,.3,.3);let t=new DirectionalLight("",gameScene.sunLight.direction.negate(),gameScene);t.intensity=1.2,t.diffuse=gameScene.sunLight.diffuse}function startGame(){console.log("startGame()");var e=document.getElementById("onesignal-bell-container");setNewTimerStart=Date.now(),e&&(e.style.display="none"),respawnVideoPlayed=!1,players=[],playerHistory=[],respawnTime=-1,vueApp.game.respawnTime=0,me=null,viewingPlayer=null,grenadePowerUp=!1,spatula=null,controlKeys=0,gamePaused=!0,roundEnded=!1,spectate=!1,spectator=new Spectator,lastTimeStamp=performance.now(),ping=0,highestPing=0,pingTotal=0,pingSamples=0,fpsTotal=-1,fpsSamples=0,fpsAverage=0,chatEvents=0,kills=0,deaths=0,bestOverallStreak=0,gameStartTime=Date.now(),nextPingSample=Date.now()+1e3,gameScene=createScene(G.engine),settings.autoDetail||(gameScene.shadowsEnabled=settings.shadowsEnabled),gameScene.autoClear=!0,gameScene.autoClearDepthAndStencil=!0,camera=new TargetCamera("camera",Vector3.Zero(),gameScene),gameScene.activeCameras.push(camera),camera.maxZ=1e3,camera.undefinedc=1.25,camera.minZ=.05,BAWK.attach(camera.globalPosition,cameraDirection),(uiCamera=new FreeCamera("uiCamera",new Vector3(0,0,-1),gameScene)).mode=Camera.ORTHOGRAPHIC_CAMERA,uiCamera.layerMask=536870912,uiCamera.autoClear=!1,gameScene.activeCameras.push(uiCamera),nameTexture=new DynamicTexture("",2048,gameScene,!0,2),(nameSprites=new SpriteManager("","",18,{width:512,height:256},gameScene)).fogEnabled=!1,nameSprites.texture=nameTexture,isTeamGame=gameType==GameType.teams||gameType==GameType.ctf||gameType==GameType.king,(auraSprites=new SpriteManager("","img/particles.webp?"+version,18,128,gameScene)).fogEnabled=!0,loadMaterials(gameScene),window.onfocus=function(){lastTimeStamp=performance.now(),me&&refreshGameState()},window.onblur=function(){},document.onpointerlockchange=function(){!document.pointerLockElement&&me&&removePlayerFromGame()},document.body.style.overflow="hidden",InputQueue.init(),loadMap(mapIdx,onLoadingComplete),tutorialShowing&&(tutorialShowing=!1),chromeSuxLockPermission()}function removePlayerFromGame(){lastKey=null,controlKeys=0,me.hz=0,me.releaseTrigger(),setTimeout((()=>{var e=kKPwUxS.getBuffer();e.BkKPwUxd(BkKPwUww.K),e.send(ws),me.resetCountdowns(),setRespawnTime(!adBlocker||G.productBlockAds||pokiActive?5:10)}),100),gamePaused=!0,vueApp.statsLoading(),timeout.set((function(){me.removeFromPlay(),updateStats()}),3e3),console.log("pausing game via pointerlock exit"),pauseGame(),crazySdk.gameplayStop()}function pausePlayerGame(e){chatting||inGame&&!gamePaused&&document.pointerLockElement&&(document.exitPointerLock(),console.log("pausing game on key: ",e))}function openGameMenu(){document.pointerLockElement?(console.log("pausing game and breaking pointerlock"),document.exitPointerLock()):(console.log("pausing game via esc key"),pauseGame())}function testGameUI(){vueApp.hideGameMenu(),document.getElementById("deathBox").style.display="none",document.getElementById("weaponBox").style.display="block",document.getElementById("healthContainer").style.display="block",document.getElementById("killTicker").style.display="block",chatting&&chatInEl.focus(),doFirstPersonCamera(),reticle.show(),document.getElementById("gameAdContainer").style.display="none"}function pauseGame(){if(vueApp.showScreen===vueApp.screens.equip)return;apiGetEggOrgLeaderBoard(),playerChallengesData(),gamePaused=!0,spectate=!1,interval.clear(spectateKeepAlive),ignoreFirstMouseMove=!0,updateActorTeams(),removeCanvasListeners(),vueApp.setPause(gamePaused),vueApp.showGameMenu(),vueApp.showWelcomeBundleCtaInGame(),shellStreakUISetup(),document.getElementById("grenadeThrowContainer").style.visibility="hidden";["weaponBox","healthContainer","killTicker","spectate","captureIconContainer"].forEach((e=>document.getElementById(e).style.display="none")),document.getElementById("serverAndMapInfo").style.display="block",document.getElementById("chw-game-screen").style.display="block",document.getElementById("playerList").style.pointerEvents="auto";const e=document.getElementById("gameAdContainer");e&&(e.style.display="block"),reticle.hide(),reticle.hideDot(),chatting&&chatInEl.focus(),newGameStart=!1,chatContainer||(chatContainer=document.querySelector(".chat-container")),setTimeout((()=>{chatContainer.scrollTop=chatContainer.scrollHeight,resize()}),300)}function playerChallengesData(){api_player_challenge_daily_request((e=>{G.playerAccount.challenges=e}),(e=>console.log("playerChallengesData error",e.error)))}function resumeGame(){if(console.log("resumeGame called"),me){gamePaused=!1,vueApp.hideGameMenu(),document.getElementById("killTicker").style.display="block",["serverAndMapInfo","chw-game-screen","welcome-bundle-ui"].forEach((e=>document.getElementById(e).style.display="none")),gameType==GameType.king&&(document.getElementById("captureIconContainer").style.display="block"),document.getElementById("playerList").style.pointerEvents="none",spectate?document.getElementById("spectate").style.display="block":(document.getElementById("weaponBox").style.display="block",document.getElementById("healthContainer").style.display="block",updateHealthUI());const e=document.getElementById("gameAdContainer");e&&(e.style.display="block"),window.focus(),setTimeout((()=>{addCanvasListeners(),chatting?chatInEl.focus():captureKeys()}),0),setTimeout((()=>{resize()}),300),saveEquipment()}}function setRespawnTime(e){respawnTime=Math.max(e,respawnTime),vueApp.game.respawnTime=respawnTime,respawnInterval&&interval.clear(respawnInterval),respawnInterval=interval.set((function(){respawnTime--,vueApp.game.respawnTime=Math.min(respawnTime,e),respawnTime<=0&&inGame&&(respawnTime=-1,interval.clear(respawnInterval),prepRespawnButton(),doMapOverviewCamera())}),1200)}function prepRespawnButton(){if(isTimeToPlayVideoAd())return void console.log("prepRespawnButton","ad first");console.log("prepRespawnButton");document.querySelector(".btn-respawn").addEventListener("click",respawnRequestPointerLock,{once:!0})}function respawnRequestPointerLock(){canvas.requestPointerLock({unadjustedMovement:settings.fastPollMouse})}var lastMouseMovement={},queueVideoAd;function respawn(){return playOffline?(me.Rb=!0,void canvas.requestPointerLock({unadjustedMovement:settings.fastPollMouse})):(console.log("Respawn pressed - respawnTime: "+respawnTime),respawnTime<0?(interval.clearAll(),timeout.clearAll(),interval.set((()=>{"IFRAME"==document.activeElement.tagName&&(console.log("iframe attempted to steal focus:",document.activeElement),document.activeElement.blur())}),100),settings.autoDetail&&enableAutoDetail(),isTimeToPlayVideoAd()?(respawnVideoPlayed=!0,void AIPVideoAds.play("shellshock.io_preroll",openGameMenu)):requestRespawn()):void 0)}var testAds=!1;function isTimeToPlayVideoAd(){if(G.productBlockAds||respawnVideoPlayed)return!1;let e=adTest?3e4:24e4;pokiActive&&(e=0);const t=hasTimesPlayed||timesPlayed>1,i=getStoredNumber("lastPreRoll",Date.now())+e,a=t&&deaths>1&&Date.now()>i,n=metaGameUI.timeToPlayVideoAd();if(null!==n)return n;if(a){console.log("video ad cancels respawnBtn click");document.querySelector(".btn-respawn").removeEventListener("click",respawnRequestPointerLock,{once:!0})}return a}var requestRespawnBlocked=!1;function requestRespawn(){if(!isChromeSuxPointerAllowed)return console.log("requestRespawn - isChromeSuxPointerAllowed"),void chromeSucks();if(console.log(`requestRespawnBlocked ${requestRespawnBlocked}`),!requestRespawnBlocked){var e;if(requestRespawnBlocked=!0,setTimeout((()=>requestRespawnBlocked=!1),1e3),equipmentWasChanged)me.changeCharacter(G.playerAccount.classIdx,G.playerAccount.getPrimaryWeapon(),G.playerAccount.getSecondaryWeapon(),G.playerAccount.colorIdx,G.playerAccount.hatItem,G.playerAccount.stampItem,G.playerAccount.stampPositionX,G.playerAccount.stampPositionY,G.playerAccount.grenadeItem,G.playerAccount.meleeItem),(e=kKPwUxS.getBuffer()).BkKPwUxd(BkKPwUww.U),e.BkKPwUxd(G.playerAccount.classIdx),e.send(ws),equipmentWasChanged=!1;(e=kKPwUxS.getBuffer()).BkKPwUxd(BkKPwUww.gc),e.send(ws),vueApp.setPause(!1),crazySdk.gameplayStart()}}function onCanvasMouseDown(e){document.pointerLockElement||(e.preventDefault(),respawnRequestPointerLock()),inputDown("keyboard","MOUSE "+e.button),e.preventDefault(),e.stopPropagation(),console.log(`Mouse button ${e.button} down, Pointer Lock: ${!!document.pointerLockElement}`)}function onCanvasMouseUp(e){console.log(`Mouse button ${e.button} up, Pointer Lock: ${!!document.pointerLockElement}`),inputUp("keyboard","MOUSE "+e.button),e.preventDefault(),e.stopPropagation()}function onCanvasMouseMove(e){if(document.pointerLockElement&&!ignoreFirstMouseMove&&me&&(me.Oz>0||spectate)){var t=Math.pow(.001*settings.mouseSpeed,2);me.scope&&(t*=me.ib.wb.scopeFov);var i=e.movementX,a=e.movementY;lastMouseMovement.x&&Math.sign(i)!=Math.sign(lastMouseMovement.x)&&(i=0),lastMouseMovement.y&&Math.sign(a)!=Math.sign(lastMouseMovement.y)&&(a=0),lastMouseMovement.x=i,lastMouseMovement.y=a,me.pb=Math.radAdd(me.pb,-i*t),me.Jb=Math.clamp(me.Jb+a*settings.mouseInvert*-t,-1.5,1.5)}ignoreFirstMouseMove=!1}function onCanvasMouseWheel(e){e.wheelDelta>0?(inputDown("keyboard","WHEEL UP"),inputUp("keyboard","WHEEL UP")):(inputDown("keyboard","WHEEL DOWN"),inputUp("keyboard","WHEEL DOWN"))}var color4White=new Color4(1,1,1,1);function createParticleManager(e,t,i,a,n){var s=new SpriteManager("","img/"+e+"?"+version,t,128,n);s.oldRender=s.render,s.render=function(){G.engine.setDepthFunctionToLessOrEqual(),G.engine.setAlphaMode(Engine.ALPHA_COMBINE),this.oldRender(),G.engine.setAlphaMode(Engine.ALPHA_DISABLE),G.engine.setDepthFunctionToLess()};for(var r=0;r<t;r++){new Sprite("",s).isVisible=!1}return s.nextIdx=0,s.getSprite=function(e){var t=this.sprites[this.nextIdx];return t.cellIndex=void 0!==e?i+e:Math.randomInt(i,a),t.isVisible=!0,t.easing=Ease.linear,t.startSize=-1,t.endSize=-1,t.gravity=0,t.dx=0,t.dy=0,t.fb=0,t.float=0,t.anim=0,t.slow=0,t.angle=0,t.rotate=0,t.stopped=!1,t.animColors=null,t.collide=!1,t.color.copyFrom(color4White),this.nextIdx=++this.nextIdx%this.sprites.length,t},s}function addBulletHitSprite(e,t,i,a,n,s){var r=explosionSmokeManager.getSprite(0);r.animLength=20*Math.random()+30,r.easing=Ease.outQuint,r.position.x=e,r.position.y=t,r.position.z=i,r.dx=.1*a,r.dy=.1*n,r.fb=.1*s,r.startSize=.1,r.endSize=.2*Math.random()+.4,r.angle=Math.random()*Math.PI2,r.rotate=.08*Math.random()-.04,r.animColors=bulletHitColors}function addExplosionSprite(e,t,i,a,n,s,r,o,l,c,h){let u=0,m=0,d="default",f="default";h&&(u=h.item_data.cell||0,e==explosionSmokeManager&&u&&(m=h.item_data.smokeCell,isNaN(m)&&(m=u)),d=h.item_data.fireColors||"default",f=h.item_data.smokeColors||"default");var p=e.getSprite(u);return p.animLength=t,p.easing=Ease.inOutQuad,p.position.x=i,p.position.y=a,p.position.z=n,p.size=l,p.dx=s,p.dy=r,p.fb=o,p.slow=.7,p.angle=Math.random()*Math.PI2,p.rotate=.04*Math.random()-.02,p.animColors=e==explosionFireManager?fireColors[d]:smokeColors[f],p}function addExplosion(e,t,i,a,n,s){for(var r=0;r<Math.floor(a/4);r++){var o=80*Math.random()+80,l=1*Math.random()+.5,c=.5*(.9-l),h=(2*Math.random()-1)*c,u=(2*Math.random()-1)*c+.1,m=(2*Math.random()-1)*c,d=addExplosionSprite(explosionSmokeManager,o,e,t,i,h,u,m,l,!0,s);d.float=.015*Math.random()+.001,d.collide=!0,(d=addExplosionSprite(explosionFireManager,.075*o,e,t,i,1.5*h,1.5*u,1.5*m,l,!0,s)).collide=!0}if(me){var f=Math.length3(me.jb-e,me.Vb-t,me.Lb-i);if(f<(n*=1.5)){var p=Math.max(0,(n-f)/n);shake=Math.min(7,shake+6*p)}}}var fireColors={default:[{pos:0,color:new Color4(1,.9,.8,1)},{pos:.2,color:new Color4(1,.5,.1,1)},{pos:.4,color:new Color4(.6,.2,.1,1)},{pos:.7,color:new Color4(0,0,0,0)},{pos:1,color:new Color4(0,0,0,0)}],rainbow:[{pos:0,color:new Color4(1,.1,.1,1)},{pos:.2,color:new Color4(1,1,.1,1)},{pos:.4,color:new Color4(.1,1,.1,1)},{pos:.7,color:new Color4(.1,.1,1,.5)},{pos:1,color:new Color4(1,.1,1,0)}],gold:[{pos:0,color:new Color4(1,1,.3,1)},{pos:.4,color:new Color4(1,.8,.2,1)},{pos:1,color:new Color4(1,.6,.1,0)}],corrupt:[{pos:0,color:new Color4(1,.1,.1,1)},{pos:.3,color:new Color4(1,1,1,1)},{pos:.6,color:new Color4(1,.1,.1,1)},{pos:1,color:new Color4(1,1,1,0)}],thermal:[{pos:0,color:new Color4(1,.9,.8,1)},{pos:.2,color:new Color4(1,.5,.1,1)},{pos:.4,color:new Color4(.6,.2,.1,1)},{pos:.5,color:new Color4(1,1,1,1)},{pos:.6,color:new Color4(1,1,1,0)},{pos:.7,color:new Color4(1,1,1,1)},{pos:1,color:new Color4(0,0,0,0)}],black:[{pos:0,color:new Color4(0,0,0,1)},{pos:1,color:new Color4(0,0,0,0)}],red:[{pos:0,color:new Color4(1,.7,.3,1)},{pos:1,color:new Color4(0,0,0,0)}],blue:[{pos:0,color:new Color4(.3,.7,1,1)},{pos:1,color:new Color4(0,0,0,0)}]},smokeColors={default:[{pos:0,color:new Color4(.3,.3,.3,1)},{pos:1,color:new Color4(.7,.7,.7,0)}],white:[{pos:0,color:new Color4(1,1,1,.5)},{pos:1,color:new Color4(1,1,1,0)}],corrupt:[{pos:0,color:new Color4(1,1,1,.6)},{pos:.5,color:new Color4(1,.1,.1,.4)},{pos:1,color:new Color4(0,0,0,0)}],thermal:[{pos:0,color:new Color4(.5,.1,.01,.3)},{pos:.3,color:new Color4(.7,.4,0,.1)},{pos:1,color:new Color4(0,0,0,0)}],supernova:[{pos:0,color:new Color4(1,1,1,.5)},{pos:1,color:new Color4(1,0,1,0)}],black:[{pos:0,color:new Color4(0,0,0,1)},{pos:1,color:new Color4(0,0,0,0)}],softblack:[{pos:0,color:new Color4(0,0,0,.5)},{pos:1,color:new Color4(0,0,0,0)}],red:[{pos:0,color:new Color4(1,.7,.3,1)},{pos:.5,color:new Color4(1,.3,0,.6)},{pos:1,color:new Color4(0,0,0,0)}],blue:[{pos:0,color:new Color4(.3,.7,1,1)},{pos:.5,color:new Color4(0,.3,1,.6)},{pos:1,color:new Color4(0,0,0,0)}]},bulletHitColors=[{pos:0,color:new Color4(1,1,1,1)},{pos:.2,color:new Color4(.7,.7,.7,.7)},{pos:1,color:new Color4(.7,.7,.7,0)}],shellHitColors=[{pos:0,color:new Color4(1,1,1,1)},{pos:.8,color:new Color4(1,1,1,1)},{pos:1,color:new Color4(1,1,1,0)}];function lerp(e,t,i){for(var a=e.length-2;a>=0;a--)if(t>=e[a].pos)return void Color4.LerpToRef(e[a].color,e[a+1].color,(t-e[a].pos)*(1/(e[a+1].pos-e[a].pos)),i)}function shellBurst(e,t,i,a){for(var n=0;n<t;n++){var s=Math.random()*a+.5*a,r=n/(.5*t)*i+.5*i,o=.08/(r+1),l=(2*Math.random()-1)*o,c=(2*Math.random()-.5)*o,h=(2*Math.random()-1)*o,u=shellBurstManager.getSprite();u.animLength=s,u.easing=Ease.inQuad,u.position.x=e.wb.Xb.position.x,u.position.y=e.wb.Xb.position.y+.3,u.position.z=e.wb.Xb.position.z,u.startSize=r,u.endSize=0,u.gravity=.003,u.dx=l,u.dy=c,u.fb=h,u.angle=Math.random()*Math.PI2,u.rotate=.2*Math.random()-.1,u.collide=!0;let m=e.wb.Bz.shellColor;u.color.copyFromFloats(m.r,m.g,m.b,1)}}function yolkBurst(e){for(var t=0;t<10;t++){var i=80*Math.random()+80,a=t/5*.2+.2,n=.05/(a+1),s=(2*Math.random()-1)*n,r=(2*Math.random()-.25)*n*1.5,o=(2*Math.random()-1)*n,l=yolkManager.getSprite();l.animLength=i,l.easing=Ease.inQuad,l.position.x=e.wb.Xb.position.x,l.position.y=e.wb.Xb.position.y+.3,l.position.z=e.wb.Xb.position.z,l.startSize=a,l.endSize=0,l.gravity=.005,l.dx=s,l.dy=r,l.fb=o,l.slow=.9,l.angle=Math.random()*Math.PI2,l.rotate=.2*Math.random()-.1,l.collide=!0}}function yolkSplat(e,t){for(var i=Math.floor(t/33)+1,a=0;a<i;a++){var n=9*Math.random()+9,s=.03/1.8,r=(2*Math.random()-1)*s,o=(2*Math.random()-.25)*s*1.5,l=(2*Math.random()-1)*s;tv1.set(me.jb,me.Vb,me.Lb),tv2.set(e.jb,e.Vb,e.Lb),tv1.subtractInPlace(tv2).normalize().scaleInPlace(.26);var c=yolkSplatManager.getSprite();c.animLength=n,c.easing=Ease.linear,c.position.x=e.wb.Xb.position.x,c.position.y=e.wb.Xb.position.y+.3,c.position.z=e.wb.Xb.position.z,c.startSize=.8*.2,c.endSize=.8,c.gravity=.003,c.dx=r+e.dx,c.dy=o,c.fb=l+e.fb,c.slow=.95,c.angle=Math.random()*Math.PI2,c.rotate=.02*Math.random()-.001,c.collide=!1,c.animColors=shellHitColors}}function shellFrag(e,t){for(var i=Math.floor(t/33)+1,a=0;a<i;a++){var n=9*Math.random()+9,s=.8,r=.03/((s*=e.playerScale)+1),o=(2*Math.random()-1)*r,l=(2*Math.random()-.25)*r*1.5,c=(2*Math.random()-1)*r;tv1.set(me.jb,me.Vb,me.Lb),tv2.set(e.jb,e.Vb,e.Lb),tv1.subtractInPlace(tv2).normalize().scaleInPlace(.26);var h=shellFragManager.getSprite();h.animLength=n,h.easing=Ease.linear,h.position.x=e.wb.Xb.position.x,h.position.y=e.wb.Xb.position.y+.3,h.position.z=e.wb.Xb.position.z,h.startSize=.2*s,h.endSize=s,h.gravity=.003,h.dx=o+e.dx,h.dy=l,h.fb=c+e.fb,h.slow=.95,h.angle=Math.random()*Math.PI2,h.rotate=.02*Math.random()-.001,h.collide=!1,h.animColors=shellHitColors}}function updateParticles(e,t){for(var i=0;i<e.sprites.length;i++){var a=e.sprites[i];if(a.isVisible){var n=a.easing(a.anim);if(a.endSize>=0&&(a.size=a.startSize+n*(a.endSize-a.startSize)),a.animColors&&lerp(a.animColors,n,a.color),!a.stopped){a.position.x+=a.dx*t,a.position.y+=a.dy*t+a.float,a.position.z+=a.fb*t,a.rotate&&(a.angle+=a.rotate*t);var s=!1;a.collide&&(tv1.set(a.position.x,a.position.y,a.position.z),s=Collision.pointCollidesWithStructure(tv1,!0)),s?(a.stopped=!0,a.position.x-=a.dx*t,a.position.y-=a.dy*t,a.position.z-=a.fb*t):a.gravity&&(a.dy-=a.gravity*t),a.slow&&(a.dx*=Math.pow(a.slow,t),a.dy*=Math.pow(a.slow,t),a.fb*=Math.pow(a.slow,t))}a.anim+=t/a.animLength,a.anim>=1&&(a.isVisible=!1)}}}function onLoadingComplete(){console.log("onLoadingComplete"),pAudio=new PositionalAudio({numChannels:24},{distanceModel:"exponential"});try{scope=new Scope,hitIndicator=new HitIndicator,hitMarkers=new HitMarkers(gameScene),settings.hitMarkers?hitMarkers.show():hitMarkers.hide(),(reticle=new Reticle).hide(),reticle.hideDot(),cloneMesh("muzzleFlash",gameScene,null,gameScene.getMaterialByName("muzzleFlash")).setEnabled(!1),cloneMesh("bullet",gameScene,null,gameScene.getMaterialByName("bullet")).setEnabled(!1),cloneMesh("rocket",gameScene,null,gameScene.getMaterialByName("standardInstanced")).setEnabled(!1),cloneMesh("ammo",gameScene,null,gameScene.getMaterialByName("standardInstanced")).setEnabled(!1),cloneMesh("grenadeItem",gameScene,null,gameScene.getMaterialByName("standardInstanced")).setEnabled(!1),cloneMesh("spatula",gameScene,null,gameScene.getMaterialByName("emissive")).setEnabled(!1);for(let e=0;e<G.catalog.grenades.length;e++){cloneMesh(G.catalog.grenades[e].item_data.meshName,gameScene,null,gameScene.getMaterialByName("emissive")).setEnabled(!1)}if(munitionsManager=new MunitionsManager(gameScene),itemManager=new ItemManager,(explosionSmokeManager=createParticleManager("particles.webp",300,16,23,gameScene)).fogEnabled=!0,(explosionFireManager=createParticleManager("particles.webp",300,16,23,gameScene)).fogEnabled=!0,explosionFireManager.blendMode=Engine.ALPHA_ADD,(shellBurstManager=createParticleManager("particles.webp",400,3,6,gameScene)).fogEnabled=!0,window.P=shellBurstManager,(yolkManager=createParticleManager("particles.webp",100,2,2,gameScene)).fogEnabled=!0,G.engine.clear(Color3.Black()),G.engine.stopRenderLoop(),vueApp.switchToGameUi(),G.playerAccount.isUpgraded()&&(document.getElementById("chickenBadge").style.display="block"),(shellFragManager=createParticleManager("particles.webp",20,0,0,gameScene)).fogEnabled=!0,(yolkSplatManager=createParticleManager("particles.webp",20,7,7,gameScene)).fogEnabled=!0,playOffline){meId=0,metaGameUI={update:()=>{},render:()=>{}},metaGame={update:()=>{}};var e={Ub:0,yb:0,Bb:"Test",Fb:0,Eb:0,Nb:G.playerAccount.getPrimaryWeapon(),nb:G.playerAccount.getSecondaryWeapon(),Mb:0,Tb:null,eb:null,undefinedb:0,undefinedb:0,Zz:0,Nz:0,nz:0,Mz:0,Tz:0,ez:0,qz:0,Pz:0,jb:mapTest.x+.5,Vb:mapTest.y-.32,Lb:mapTest.z+.5,xz:0,lz:0,Xz:0,undefinedz:0,Jb:mapTest.pitch,pb:mapTest.yaw,Gz:0,Oz:0,dz:!1,tz:0,hz:0,undefinedz:0,Rz:void 0!==G.playerAccount.upgradeProductId&&null!==G.playerAccount.upgradeProductId?G.playerAccount.upgradeProductId:0,Vz:0,Yz:[],Sz:0,Iz:1,uz:{}};StatsArr.forEach((t=>e.uz[t]=0)),addPlayer(e),players[meId].Oz=100,doFirstPersonCamera(),startRendering(),startRunning(),openGameMenu(),reticle.show(),reticle.showDot(),respawnTime=-1,fpsTotal=0,vueApp.delayTheCracking=!0}else{mapOverview=!0,setUpSocket();var t=kKPwUxS.getBuffer();t.BkKPwUxd(BkKPwUww.Qc),t.send(ws),pingStartTime=Date.now(),isItTimeForPokiReward();addChat(getLocText("ingame_chat_msg_2"),ChatFlags.none,null,inviteFriendsChat,"<i class='fas fa-user-friends'></i>"),eggOrgCheckShowPopupInGame()}disablePlay(!1)}catch(e){console.log(e)}}function inviteFriendsChat(){ga("send","event","game","click","openShareLinkChat"),inviteFriends()}function doMapOverviewCamera(){camera.parent=null,camera.position.set(0,map2.height+1,0),camera.lockedTarget=null,camera.setTarget(new Vector3(map2.width/2,map2.height/4,map2.depth/2)),mapOverview=!0,viewingPlayer=me,viewingPlayerId=meId,gameScene.autoClear=!0,gameScene.autoClearDepthAndStencil=!0}function doFirstPersonCamera(e){camera.position.set(0,0,0),camera.rotation.set(0,Math.PI,0),camera.parent=e?e.wb.eye:me.wb.eye,camera.lockedTarget=null,mapOverview=!1,gameScene.autoClear=!1,gameScene.autoClearDepthAndStencil=!1}var enterSpectatorModeBlocked=!1,killDisplayTimeout;function enterSpectatorMode(){enterSpectatorModeBlocked||(enterSpectatorModeBlocked=!0,setTimeout((()=>enterSpectatorModeBlocked=!1),1e3),respawnTime<0&&(mapOverview=!1,spectate=!0,spectateMode=Spectate.freeCamera,vueApp.setPause(!1),vueApp.setInGame(spectate),spectator.freeCamera(),resumeGame(),respawnRequestPointerLock(),me.pb=Math.radRange(camera.rotation.y),me.Jb=-camera.rotation.x,spectateKeepAlive=interval.set((function(){var e=kKPwUxS.getBuffer();e.BkKPwUxd(BkKPwUww.Yc),e.send(me.ws)}),15e3),updateActorTeams()))}function startRendering(e){hasValue(e)||resize(),G.engine.ec((function(){updateActors(),viewingPlayer&&(shadowLight.position.x=viewingPlayer.jb,shadowLight.position.y=viewingPlayer.Vb+2,shadowLight.position.z=viewingPlayer.Lb),gameScene.render(),metaGameUI.render()}))}function startRunning(){captureKeys(),mapOverview&&doMapOverviewCamera(),logicInterval=setInterval(updateLogic,1e3/30)}var chatParser=document.createElement("DIV"),prevCmd=[],musicMetadata="",isMusic=!1,checkMusicChange=e=>{if(!isMusic&&e?(isMusic=!0,vueApp.musicWidget(!0)):isMusic&&!e&&(isMusic=!1,vueApp.musicWidget(!1)),musicMetadata!==e){musicMetadata=e;var t=decodeURI(e);console.log("Music metadata",t),data=JSON.parse(t),vueApp.music.serverTracks=data,"localhost"==location.host||"localshelldev.bluewizard.com"==location.host?vueApp.music.serverTracks.albumArt="https://shellshock.io/data/img/albumArt/"+data.id+data.albumExt+"?"+data.query:vueApp.music.serverTracks.albumArt=dynamicContentPrefix+"data/img/albumArt/"+data.id+data.albumExt+"?"+data.query,vueApp.songChanged=!0}};function setUpSocket(){ws.onmessage=function(e){for(KPwUxH.init(e.data);KPwUxH.isMoreDataAvailable();){var t=KPwUxH.unPackInt8U();switch(t){case BkKPwUww.Uc:var i=KPwUxH.unPackInt8U(),a=KPwUxH.unPackString(128),n=KPwUxH.unPackString(32);if(De=players[i]){De.dbId=a,De.ip=n;for(var s=0;s<playerHistory.length;s++)if(playerHistory[s].id===i){playerHistory[s].dbId=a,playerHistory[s].ip=n;break}}break;case BkKPwUww.Sc:var r=KPwUxH.unPackLongString();checkMusicChange(r);break;case BkKPwUww.K:i=KPwUxH.unPackInt8U();(De=players[i])&&De.removeFromPlay();break;case BkKPwUww.lc:console.log("eventModifier"),(o=kKPwUxS.getBuffer()).BkKPwUxd(BkKPwUww.lc),o.send(ws);break;case BkKPwUww.Qc:eggOrgUpdateGameStats(KPwUxH.unPackString()),newGameStart=!0,respawnTime=-1,fpsTotal=0,startRendering(),startRunning(),vueApp.delayInGamePlayButtons();let e=createInviteLink();var o;vueData.game.shareLinkPopup.code=gameCode,vueData.game.shareLinkPopup.url=e,autoInvite?(vueApp.hideHeaderAd(!0),setTimeout((()=>{vueApp.onGamePauseUi(),vueApp.onGameOptionsClick()}),200)):openGameMenu(),settings.autoDetail?enableAutoDetail():(setHighRes(settings.highRes),setShadows(settings.shadowsEnabled)),(o=kKPwUxS.getBuffer()).BkKPwUxd(BkKPwUww.O),o.send(ws);break;case BkKPwUww.M:var l=KPwUxH.unPackInt8U(),c=KPwUxH.unPackString(),h=KPwUxH.unPackString(),u=KPwUxH.unPackString(),m=KPwUxH.unPackInt8U(),d={Ub:l,yb:c,Bb:h=fixStringWidth(h,80),Hb:u,Fb:m,Eb:KPwUxH.unPackInt8U(),Nb:G.catalog.findItemById(KPwUxH.unPackInt16U()),nb:G.catalog.findItemById(KPwUxH.unPackInt16U()),Mb:KPwUxH.unPackInt8U(),Tb:G.catalog.findItemById(KPwUxH.unPackInt16U()),eb:G.catalog.findItemById(KPwUxH.unPackInt16U()),undefinedb:KPwUxH.unPackInt8(),undefinedb:KPwUxH.unPackInt8(),cz:G.catalog.findItemById(KPwUxH.unPackInt16U()),bz:G.catalog.findItemById(KPwUxH.unPackInt16U()),jb:KPwUxH.unPackFloat(),Vb:KPwUxH.unPackFloat(),Lb:KPwUxH.unPackFloat(),xz:KPwUxH.unPackFloat(),lz:KPwUxH.unPackFloat(),Xz:KPwUxH.unPackFloat(),pb:KPwUxH.unPackRadU(),Jb:KPwUxH.unPackRad(),Zz:KPwUxH.unPackInt32U(),Nz:KPwUxH.unPackInt16U(),nz:KPwUxH.unPackInt16U(),Mz:KPwUxH.unPackInt16U(),Tz:KPwUxH.unPackInt32U(),ez:KPwUxH.unPackInt32U(),qz:KPwUxH.unPackInt16U(),Pz:KPwUxH.unPackInt16U(),Gz:KPwUxH.unPackInt8U(),Oz:KPwUxH.unPackInt8U(),dz:KPwUxH.unPackInt8U(),tz:KPwUxH.unPackInt8U(),hz:KPwUxH.unPackInt8U(),Rz:KPwUxH.unPackInt8U(),Vz:KPwUxH.unPackInt8U(),Yz:KPwUxH.unPackLongString(),Sz:KPwUxH.unPackInt8U(),iz:{}};if(d.iz.mapIdx=KPwUxH.unPackInt8U(),d.iz.private=KPwUxH.unPackInt8U(),d.iz.gameType=KPwUxH.unPackInt8U(),d.uz={},StatsArr.forEach((e=>d.uz[e]=0)),d.uz.kills=d.Nz,d.uz.deaths=d.nz,d.uz.streak=d.Mz,d.Bb=filterUnicode(d.Bb),!players[d.Ub]){meId==d.Ub||observingGame?(d.Cb=d.Bb,d.Hb=d.Bb):(d.Cb=d.Bb.replace(/<|>/g,""),(0==d.Cb.length||isBadWord(d.Cb))&&(d.Cb=d.Hb),settings.safeNames?d.Bb=d.Hb:d.Bb=d.Cb);let e=findPlayerByUniqueId(c);e?(d.gz=e.muted,d.gz&&!settings.safeNames&&(d.Bb=d.Hb)):d.gz=!1,addPlayer(d)}break;case BkKPwUww.T:removePlayer(i=KPwUxH.unPackInt8U());break;case BkKPwUww.i:l=KPwUxH.unPackInt16U();var f=KPwUxH.unPackInt8U(),p=KPwUxH.unPackFloat(),_=KPwUxH.unPackFloat(),g=KPwUxH.unPackFloat();itemManager.spawnItem(l,f,p,_,g);break;case BkKPwUww.fc:i=KPwUxH.unPackInt8U(),f=KPwUxH.unPackInt8U();var v=KPwUxH.unPackInt8U();l=KPwUxH.unPackInt16U();itemManager.collectItem(f,l),i==meId&&me.collectItem(f,v);break;case BkKPwUww.uc:var y,S,C=KPwUxH.unPackInt8U(),E=KPwUxH.unPackInt8U(),A=KPwUxH.unPackInt8U(),T=players[C],M=players[E],x=KPwUxH.unPackInt8U(),b=KPwUxH.unPackInt8U();if(M.lastDmgType=x,T.lastDmgType=b,C==meId&&E!=meId?SessionStats.updateTerminus(getKeyByValue(CharClass,T.charClass),DmgType[b].name,"deaths"):E==meId&&C==meId&&(SessionStats.updateTerminus(getKeyByValue(CharClass,T.charClass),"Grenade","deaths",!0),ga("send","event","weapon","deathBy","Suicide")),T){metaGame.scoreKill(M,T)&&updateTeamUI(),y=T.name;var w=new Vector3(T.jb,T.Vb+.32,T.Lb);pAudio.play("shell_burst",w);var I=Math.randomInt(0,10)+1;pAudio.play("death_scream"+I,w),shellFrag(T,100),yolkSplat(T,100),shellBurst(T,80,.2,40),yolkBurst(T),T.die(),playerChallengeRequest=!0,T.wb.Xb.position.x=T.jb,T.wb.Xb.position.y=T.Vb,T.wb.Xb.position.z=T.Lb}else y="N/A";if(M?(E===meId&&C!==E&&(SessionStats.streak=M.Wz,SessionStats.updateTerminus(getKeyByValue(CharClass,M.charClass),DmgType[b].name,"kills"),"Grenade"!==DmgType[b].name&&"Melee"!==DmgType[b].name||ga("send","event","weapon","killedWith",DmgType[b].name)),S=M.name,M.isDead()||(M.scoreKill(),E==meId&&vueApp.bestStreakUpdate(M.bestOverallStreak),E==meId&&(kills++,bestOverallStreak=Math.max(bestOverallStreak,M.stats.streak)))):S="N/A",C!=meId)E==meId&&(vueApp.killedName=y,vueApp.shellIngameNotification({msg:y,type:0,streak:me.stats.streak>1?me.stats.streak:""}));else{gamePaused=!0,camera.parent=null,camera.position=new Vector3(viewingPlayer.wb.Xb.position.x,viewingPlayer.wb.Xb.position.y+.2,viewingPlayer.wb.Xb.position.z),M&&(camera.lockedTarget=M.wb.head),vueApp.shellIngameNotification({msg:S,type:1,streak:0}),deaths++,setRespawnTime(!adBlocker||G.productBlockAds||pokiActive?A-1:12),removeCanvasListeners(),timeout.set((function(){inGame&&viewingPlayerId==meId&&openGameMenu()}),3e3)}M&&T&&addKillText(M,T),rebuildPlayerList();break;case BkKPwUww.Wc:i=KPwUxH.unPackInt8U();var P=KPwUxH.unPackInt8U();addChat(KPwUxH.unPackString().valueOf(),P,i);break;case BkKPwUww.oc:metaGame._unPackState(KPwUxH);break;case BkKPwUww.Ic:l=KPwUxH.unPackInt8U();var R=KPwUxH.unPackInt8U(),N=KPwUxH.unPackInt8U(),k=(p=KPwUxH.unPackFloat(),_=KPwUxH.unPackFloat(),g=KPwUxH.unPackFloat(),KPwUxH.unPackInt8U()),D=KPwUxH.unPackInt8U(),B=KPwUxH.unPackInt8U();(De=players[l]).serverStateIdx=N;var F=De.jb,L=De.Vb,O=De.Lb,V=De.dx,U=De.dy,H=De.fb,W=De.pb,z=De.Jb,X=(s=R,De.Jz[s]),Y=Math.mod(De.stateIdx-R,stateBufferSize)+8*FramesBetweenSyncs;if(De.lastWeaponChange>Y&&(D!==X.Sb||B!==X.store)){for(var j=R;j!=De.stateIdx;j=Math.mod(j+1,stateBufferSize)){var K=De.Jz[j];D-=K.shots,K.Sb=D}De.ib.ammo.Sb=D,De.ib.ammo.store=B,updateAmmoUi()}if(k)var $=Math.length3(X.jb-p,X.Vb-_,X.Lb-g);else $=Math.length2(X.jb-p,X.Lb-g);if(0!=controlKeys){if($<.1){var J=2*FramesBetweenSyncs;De.totalCorrections=J,De.corrections=J,De.corrected.dx=p-X.jb,De.corrected.dy=_-X.Vb,De.corrected.fb=g-X.Lb;break}J=2*FramesBetweenSyncs}else{if($<.02)break;J=2*FramesBetweenSyncs}De.totalCorrections=J,De.jb=p,De.Vb=_,De.Lb=g,De.dx=X.dx,De.dy=X.dy,De.fb=X.fb,De.oz=X.oz,De.Dz=X.Dz,De.playerScale=X.scale;for(var q=me.hz;s!=De.stateIdx;s=Math.mod(s+1,stateBufferSize))X=De.Jz[s],De.hz=X.hz,De.pb=X.pb,De.Uz(!0);if(De.oz)$=Math.length3(De.jb-F,De.Vb-L,De.Lb-O);else $=Math.length2(De.jb-F,De.Lb-O);$<.2?(De.corrections=J,De.corrected.dx=De.jb-F,De.corrected.dy=De.Vb-L,De.corrected.fb=De.Lb-O,De.jb=F,De.Vb=L,De.Lb=O,De.dx=V,De.dy=U,De.fb=H):De.corrections=0,De.pb=W,De.Jb=z,De.hz=q;break;case BkKPwUww.qc:l=KPwUxH.unPackInt8U(),p=KPwUxH.unPackFloat(),_=KPwUxH.unPackFloat(),g=KPwUxH.unPackFloat(),k=KPwUxH.unPackInt8U();if(!(De=players[l])||De.id==meId){for(s=0;s<FramesBetweenSyncs;s++)KPwUxH.unPackInt8U(),KPwUxH.unPackRadU(),KPwUxH.unPackRad(),KPwUxH.unPackInt8U();break}De.stateIdx=0;for(s=0;s<FramesBetweenSyncs;s++)De.Jz[s].hz=KPwUxH.unPackInt8U(),De.Jz[s].pb=KPwUxH.unPackRadU(),De.Jz[s].Jb=KPwUxH.unPackRad(),De.Jz[s].scale=KPwUxH.unPackInt8U()/100;De.jb=p,(!De.Dz||Math.abs(De.Vb-_)>.5)&&(De.Vb=_),De.Lb=g,De.Jz[0].jb=p,De.Jz[0].Vb=_,De.Jz[0].Lb=g,De.oz=k;break;case BkKPwUww.cc:l=KPwUxH.unPackInt8U();if(tv1.x=KPwUxH.unPackFloat(),tv1.y=KPwUxH.unPackFloat(),tv1.z=KPwUxH.unPackFloat(),tv2.x=KPwUxH.unPackFloat(),tv2.y=KPwUxH.unPackFloat(),tv2.z=KPwUxH.unPackFloat(),!(De=players[l]))break;l!=meId&&(De.ib.wb.fire(),De.ib.fireMunitions(tv1,tv2),--De.ib.tracer<0&&(De.ib.tracer=De.ib.constructor.tracer));break;case BkKPwUww.bc:l=KPwUxH.unPackInt8U();players[l]&&(players[l].meleeCountdown=17,players[l].wb.melee());break;case BkKPwUww.zc:l=KPwUxH.unPackInt8U(),p=KPwUxH.unPackFloat(),_=KPwUxH.unPackFloat(),g=KPwUxH.unPackFloat();var Q=KPwUxH.unPackFloat(),Z=KPwUxH.unPackFloat(),ee=KPwUxH.unPackFloat();if(!(De=players[l]))break;De.kz--,l!=meId?(De.wb.head.rotation.x=De.Jb,De.wb.Xb.rotation.y=De.pb):updateAmmoUi(),De.wb.throwGrenade(),munitionsManager.throwGrenade(De,{x:p,y:_,z:g},{x:Q,y:Z,z:ee});break;case BkKPwUww.Jc:var te=KPwUxH.unPackInt8U(),ie=KPwUxH.unPackInt16U(),ae=(p=KPwUxH.unPackFloat(),_=KPwUxH.unPackFloat(),g=KPwUxH.unPackFloat(),KPwUxH.unPackInt8U()),ne=KPwUxH.unPackFloat();let t=null;te>0&&(t=G.catalog.findItemById(ie)),addExplosion(p,_,g,ae,ne,t),tv1.set(p,_,g),te==ItemType2.Grenade?pAudio.play(t.item_data.sound||"grenade",tv1):pAudio.play("gun_rpegg_rocket_hit",tv1);break;case BkKPwUww.Rc:l=KPwUxH.unPackInt8U();players[l]&&players[l].reload();break;case BkKPwUww.W:l=KPwUxH.unPackInt8U();var se=KPwUxH.unPackInt8U();players[l]&&players[l].swapWeapon(se);break;case BkKPwUww.hc:var re=KPwUxH.unPackInt8U();Q=KPwUxH.unPackFloat(),ee=KPwUxH.unPackFloat();me.Oz=re,me.wb.hit(),hitIndicator.hit(Q,ee),hitMarkers.hit(Q,ee);break;case BkKPwUww.Ac:var oe=KPwUxH.unPackInt8U();re=KPwUxH.unPackInt8U(),Q=KPwUxH.unPackFloat(),ee=KPwUxH.unPackFloat();me.Oz=re,me.Lz=oe,me.wb.hit(),hitIndicator.hit(Q,ee),hitMarkers.hit(Q,ee),updateHealthUI();break;case BkKPwUww.Xc:l=KPwUxH.unPackInt8U(),re=KPwUxH.unPackInt8U();if(!(De=players[l]))break;De.Oz=re,De.lastDmgType=De.ib.constructor.id,De.wb.hit(),re>0&&yolkSplat(De,Math.clamp(De.Oz-re,0,100));break;case BkKPwUww.jc:respawnVideoPlayed=!1;l=KPwUxH.unPackInt8U();var le=KPwUxH.unPackInt16U(),ce=(p=KPwUxH.unPackFloat(),_=KPwUxH.unPackFloat(),g=KPwUxH.unPackFloat(),KPwUxH.unPackInt8U()),he=KPwUxH.unPackInt8U(),ue=KPwUxH.unPackInt8U(),de=KPwUxH.unPackInt8U(),fe=KPwUxH.unPackInt8U();(De=players[l])&&(De.wb.removeFromPlay(),De.Yb.setSeed(le),De.weapons[0].ammo.Sb=ce,De.weapons[0].ammo.store=he,De.weapons[1].ammo.Sb=ue,De.weapons[1].ammo.store=de,De.grenades=fe,De.respawn(p,_,g),l==meId?(resumeGame(),resetPlayerUI(),InputQueue.init(),doFirstPersonCamera(),reticle.show(),reticle.showDot(),chatting&&chatInEl.focus()):rebuildPlayerList());break;case BkKPwUww.Vc:openGameMenu();break;case BkKPwUww.U:l=KPwUxH.unPackInt8U();var pe=KPwUxH.unPackInt8U(),_e=KPwUxH.unPackInt16U(),ge=KPwUxH.unPackInt16U(),ve=KPwUxH.unPackInt8U(),ye=KPwUxH.unPackInt16U(),Se=KPwUxH.unPackInt16U(),Ce=KPwUxH.unPackInt16U(),Ee=KPwUxH.unPackInt16U(),Ae=KPwUxH.unPackInt8(),Te=KPwUxH.unPackInt8(),Me=G.catalog.findItemById(_e),xe=G.catalog.findItemById(ge),be=G.catalog.findItemById(ye),we=G.catalog.findItemById(Se),Ie=G.catalog.findItemById(Ce),Pe=G.catalog.findItemById(Ee);(De=players[l])&&De.changeCharacter(pe,Me,xe,ve,be,we,Ae,Te,Ie,Pe);break;case BkKPwUww.S:l=KPwUxH.unPackInt8U();var Re=KPwUxH.unPackInt8U();(De=players[l])&&(l==meId&&(myTeam=Re,vueApp.setTeam(myTeam),metaGame.teamScore[Re]>=metaGame.teamScore[De.team]&&metaGame.teamScore[Re]>0&&(De.canTakeTeamBonus=!1)),De.team=Re,De.fz=0,De.stats.kills=0,De.stats.streak=0,De.Wz=0,KPwUxH.isMoreDataAvailable()&&KPwUxH.peekInt8U()===BkKPwUww.S||(updateActorTeams(),rebuildPlayerList()));break;case BkKPwUww.ac:vueApp.showGenericPopup("ui_game_fairteams_header","ui_game_fairteams_text","ok");break;case BkKPwUww.O:ping=Date.now()-pingStartTime,pingTotal+=ping,pingSamples++,(Fe=document.getElementById("ping")).style.color=ping<100?"#0f0":ping<150?"#ff0":ping<200?"#f90":"#f00",Fe.innerText=ping+"ms",setTimeout((function(){if(ws){var e=kKPwUxS.getBuffer();e.BkKPwUxd(BkKPwUww.O),e.send(ws),pingStartTime=Date.now()}}),1e3);break;case BkKPwUww.k:notify(vueApp.loc.ui_game_locked,1e4);break;case BkKPwUww.tc:var Ne=KPwUxH.unPackInt32U();console.log("updating balance from server: "+Ne),G.playerAccount.currentBalance=Ne;break;case BkKPwUww.Dc:console.log("upgrade has expired"),checkUpgrade();break;case BkKPwUww.Gc:l=KPwUxH.unPackInt8U();var ke=KPwUxH.unPackInt8U();(De=players[l]).beginShellStreak(ke);break;case BkKPwUww.Oc:l=KPwUxH.unPackInt8U(),ke=KPwUxH.unPackInt8U();(De=players[l]).endShellStreak(ke);break;case BkKPwUww.yc:l=KPwUxH.unPackInt8U();var De,Be=KPwUxH.unPackInt8U();(De=players[l]).id===meId&&De.challengeCompleted(Be);break;case BkKPwUww.C:GameOptions.parse(),vueData.selectedWeaponDisabled=GameOptions.isSelectedWeaponDisabled(G.playerAccount.classIdx),vueApp.$refs.gameScreen.$forceUpdate(),vueApp.$refs.gameScreen.$refs.weaponSelect.$forceUpdate();break;case BkKPwUww.H:switch(KPwUxH.unPackInt8U()){case GameActions.reset:var Fe;metaGame.reset(),(Fe=document.getElementById("gameMessage")).innerHTML=getLocText("ingame_reset"),Fe.className="show",setTimeout((()=>{Fe.className="hide"}),3e3);break;case GameActions.pause:me.Rb&&openGameMenu()}break;case BkKPwUww.mc:l=KPwUxH.unPackInt8U(),ie=KPwUxH.unPackInt16U(),KPwUxH.unPackInt24U();break;case BkKPwUww.Bc:eggOrgUpdateGameStats(KPwUxH.unPackString())}prevCmd.push(t),prevCmd.length>4&&prevCmd.shift()}},ws.onclose=e=>{handleCloseCode(e.code)}}function eggOrgUpdateGameStats(e){vueApp.eggOrgUpdateGameStats(e)}function resetPlayerUI(){reticle.hide(),reticle.hideDot(),scope.hide(),reticle.setPowerful(!1),camera.undefinedc=1.25,grenadePowerUp=!1,document.getElementById("grenadeThrowContainer").style.visibility="hidden"}function showShellStreakMessage(e){if(void 0!==me&&me.shellStreakMsg){var t=me.stats&&void 0!==me.stats.streak?me.stats.streak:null;vueApp.shellIngameNotification({type:2,msg:me.shellStreakMsg,streak:t,streakType:e}),me.shellStreakMsg=""}}function shellStreakUISetup(){const e={MiniEgg:"shellStreak-shrink",DoubleEggs:"shellStreak-double-eggs",EggBreaker:"shellStreak-egg-breaker",Restock:"shellStreak-restock"};for(const[t,i]of Object.entries(e))shellStreakUi[t]=document.getElementById(i),shellStreakUi[t].style.display="none"}function shellStreakUiUpdate(e,t){const i=t?"grid":"none";if(new Set([ShellStreak.EggBreaker,ShellStreak.DoubleEggs,ShellStreak.MiniEgg,ShellStreak.Restock]).has(e)){const t=getKeyByValue(ShellStreak,e);[shellStreakUi[t]].forEach((t=>{t&&(t.style.display=i,e===ShellStreak.Restock&&setTimeout((()=>{t.style.display="none"}),2e3))}))}}function updateActorTeams(){for(var e=0;e<playerLimit;e++){var t=players[e];t&&t.wb&&t.wb.updateTeam()}}var rotInc=Math.PI/2;function iterateXYZ(e,t,i,a,n){var s=a||{};s.step=s.step||1,s.x=s.x||0,s.y=s.y||0,s.z=s.z||0;for(var r=s.x;r<e;r+=s.step)for(var o=s.y;o<t;o+=s.step)for(var l=s.z;l<i;l+=s.step)n(r,o,l)}async function loadMap(e,t){if(console.log("loadMap()"),Collider.init(gameScene),playOffline)minMap=JSON.parse(localStore.getItem("mapBackup"));else{var i=maps[e].filename,a=await fetch("maps/"+i+".json?"+maps[e].hash);minMap=await a.json(),console.log("MAP: "+i),vueApp.setGameDataUi(minMap.name)}minMap.sun?gameScene.sunLight={direction:new Vector3(minMap.sun.direction.x,minMap.sun.direction.y,minMap.sun.direction.z),diffuse:Color3.FromHexString(minMap.sun.color)}:gameScene.sunLight={direction:new Vector3(.2,1,.1),diffuse:Color3.White()},minMap.ambient?gameScene.ambientColor=Color3.FromHexString(minMap.ambient):gameScene.ambientColor=new Color3(.2,.2,.2),minMap.fog?(console.log("FOG:",minMap.fog),minMap.fog.density>0?(gameScene.fogMode=Scene.FOGMODE_EXP2,gameScene.fogColor=Color3.FromHexString(minMap.fog.color),gameScene.fogDensity=minMap.fog.density,gameScene.fogEnabled=!0):(gameScene.fogEnabled=!1,gameScene.fogDensity=0)):(gameScene.fogMode=Scene.FOGMODE_EXP2,gameScene.fogColor=new Color4(.5,.55,.6,1),gameScene.fogDensity=.01),minMap.extents.x.min=0,minMap.extents.y.min=0,minMap.extents.z.min=0,await new Promise((e=>{var t=setInterval((()=>{ready_mapMeshes&&(clearInterval(t),vueApp.assetLoaded(),e())}),100)}));var n=buildMapData((function(e){alert("The following map meshes were not found:\n\n"+e+"\nTry clearing your cache and reload the page!")}));if(MapTools.bx(gameScene,n,minMap,null,null,((t,a)=>{vueApp.assetLoaded(),(mapMesh=MapTools.stripTris(map2.data,mapMeshes,t,a)).position.set(.5,.5,.5),mapMesh.bakeCurrentTransformIntoVertices(),mapMesh.receiveShadows=!0,async function(){var t;setupLights(),playOffline?(t=localStorage.getItem("lightmap"),t=JSON.parse(t)):t=await fetchLightmap("maps/"+i+".lightmap?"+maps[e].hash,((e,t)=>{}));if(t){var a=mapMesh.getVerticesData(VertexBuffer.ColorKind);vueApp.assetLoaded();for(var n=0,s=0;n<t.length;n+=3,s+=4)a[s]=t[n]/255,a[s+1]=t[n+1]/255,a[s+2]=t[n+2]/255;mapMesh.updateVerticesData(VertexBuffer.ColorKind,a)}if(mapMesh.material=gameScene.getMaterialByName("map"),mapMesh.material.sideOrientation=Material.CounterClockWiseSideOrientation,mapMesh.freezeWorldMatrix(),!noSkybox){var o=minMap.skybox||"default",l=MeshBuilder.Mc("skyBox",{size:200},gameScene);l.infiniteDistance=!0;var c=new StandardMaterial("skyBox",gameScene);c.backFaceCulling=!1,c.fogEnabled=!1,c.reflectionTexture=new CubeTexture("img/skyboxes/"+o+"/skybox",gameScene),c.reflectionTexture.coordinatesMode=Texture.SKYBOX_MODE,c.diffuseColor=new Color3(0,0,0),c.specularColor=new Color3(0,0,0),l.material=c,l.rotation.y=Math.PI}let h=Date.now()-setNewTimerStart;h>3e3?r():setTimeout((()=>r()),3e3-h)}()})),capZoneMeshes=[],gameType==GameType.king)for(var s=1;s<=numCaptureZones;s++)MapTools.bx(gameScene,n,minMap,"DYNAMIC.capture-zone.none",s,((e,t)=>{if(e){let i=new Vector3;for(let e of t)i.x+=e.x,i.y+=e.y,i.z+=e.z;i.scaleInPlace(1/t.length),i.x+=.5,i.y+=.6,i.z+=.5,e.capIconPosition=i,e.position.set(.5,.5,.5),e.material=gameScene.getMaterialByName("colorized"),e.material.colorNode=e.material.getBlockByName("color"),e.sideOrientation=Material.BACKSIDE,capZoneMeshes.push(e)}}));function r(){console.log("Now complete"),vueApp.assetLoaded(),setTimeout((()=>{playOffline&&Loader2.hide(),setTimeout((()=>{vueApp.hideSpinner()}),600),vueApp.progressBarReset(),crazySdk.showInviteButton({crazyShare:gameCode}),ga("send","timing","load","mapLoaded",Math.round(performance.now())-Math.round(timerPlayStart),minMap.name),t()}),100)}}async function fetchLightmap(e,t){for(var i=await fetch(e),a=i.body.getReader(),n=+i.headers.get("Content-Length"),s=0,r=[];;){var{done:o,value:l}=await a.read();if(o)break;r.push(l),s+=l.length,t&&t(s,n)}var c=new Uint8Array(s),h=0;for(var u of r)c.set(u,h),h+=u.length;return new Uint8Array(c)}function updateLogic(){var e=performance.now();if(now=e,!roundEnded){pingSamples>10&&(highestPing=Math.max(highestPing,ping));var t=1e3/30;for(InputQueue.update();lastTimeStamp<e;){if(lastTimeStamp+=t,freezeFrame)me.wb.lx(),me.Uz();else{for(var i=0;i<playerLimit;i++){var a=players[i];a&&(a.id===meId&&(a.chatLines=Math.max(0,a.chatLines-1/120),a.chatLines<=2&&(chatInEl.style.visibility="visible"),a.Rb&&(vueApp.player.challengeTimer.played=Math.floor(a.timers.played/30))),a.Rb&&(a.wb.lx(),a.Uz()))}spatula&&spatula.update()}me&&(me.ib&&0==me.ib.ammo.Sb&&(me.stateIdx%20==0?document.getElementById("ammo").style.color="#f00":me.stateIdx%20==10&&(document.getElementById("ammo").style.color="#fff")),1==grenadePowerUp&&(grenadeThrowPower=Math.min(grenadeThrowPower+.03,1))>0&&(document.getElementById("grenadeThrowContainer").style.visibility="visible",document.getElementById("grenadeThrow").style.height=100*grenadeThrowPower+"%")),freezeFrame||munitionsManager.updateLogic(),metaGame.update()}var n=Matrix.Invert(camera.getViewMatrix());cameraDirection.copyFrom(Vector3.TransformNormal(new Vector3(0,0,-1),n)),cameraDirection.normalize(),BAWK.update(),metaGameUI.update()}}var deltaStart=performance.now(),pingStartTime;function updateActors(){var e=performance.now(),t=Math.min((e-deltaStart)/(1e3/60),8);if(deltaStart=e,fpsTotal>=0){var i=G.engine.getFps();fpsTotal+=i,fpsSamples++}fpsSamples%10==0&&(fpsAverage=fpsTotal/fpsSamples,document.getElementById("FPS").innerText=Math.floor(i+.5),viewingPlayer&&updateHealthUI());if(pingSamples>10&&(highestPing=Math.max(highestPing,ping)),freezeFrame)me.wb.update(t);else{for(var a=0;a<playerLimit;a++){var n=players[a];n&&n.Rb&&(n.wb.handsToWeaponSkeleton(),n.wb&&n.wb.update(t))}spatula&&spatula.wb.update(t)}me&&(hitIndicator.update(t),reticle.update(t),hitMarkers.update(t,me.pb)),freezeFrame||(munitionsManager.updateActors(t),itemManager.update(t),updateParticles(explosionSmokeManager,t),updateParticles(explosionFireManager,t),updateParticles(shellFragManager,t),updateParticles(shellBurstManager,t),updateParticles(yolkManager,t),updateParticles(yolkSplatManager,t)),mapOverview&&(mapOverviewAxis-=.002*t,camera.position.x=Math.sin(mapOverviewAxis)*map2.height+map2.width/2,camera.position.z=Math.cos(mapOverviewAxis)*map2.height+map2.depth/2,camera.setTarget(new Vector3(map2.width/2,map2.height/4,map2.depth/2))),spectate&&spectator.update(t)}function hitPlayer(e,t,i,a,n){(i*=GameOptions.value.damage,t.Zb.lastDamageGivenType=t.dmgTypeId,e.lastDamageTakenType=t.dmgTypeId,!e.Rb||e.shield>0)||Math.max(0,Math.floor(e.Oz-i))>0&&shellFrag(e,Math.clamp(i,0,100))}function updateHealthUI(){const{activeShellStreaks:e,Lz:t,Oz:i}=viewingPlayer,a=document.getElementById("healthContainer"),n=document.getElementById("hardBoiled-bar"),s=document.getElementById("hardBoiled-stroke"),r=document.getElementById("healthBar"),o=document.getElementById("healthHp");if(e&ShellStreak.HardBoiled&&t>0){a.classList.add("hard-boiled"),n.style.display="block",s.style.display="block";const e=2.3-t/43.478;n.setAttribute("stroke-dashoffset",6.2832*e+"em")}else a.classList.remove("hard-boiled"),n.style.display="none",s.style.display="none";const l=i>100?i-100:0,c=2.3-Math.min(i,100)/43.478;if(r.setAttribute("stroke-dashoffset",6.2832*c+"em"),l>0){const e=1-l/100,t=23+232*e,i=146+109*e,a=0+255*e;r.style.stroke=`rgb(${Math.round(t)}, ${Math.round(i)}, ${Math.round(a)})`}else r.style.stroke="rgb(255, 255, 255)";o.innerText=Math.floor(i)}function serverSync(){if(me){var e=kKPwUxS.getBuffer();e.BkKPwUxd(BkKPwUww.Ic),e.BkKPwUxd(me.serverStateIdx),e.BkKPwUxd(Math.mod(me.stateIdx-FramesBetweenSyncs,stateBufferSize));for(var t=Math.mod(me.stateIdx-FramesBetweenSyncs,stateBufferSize),i=0;i<FramesBetweenSyncs;i++){var a=Math.mod(t+i,stateBufferSize);e.BkKPwUxd(me.Jz[a].hz),e.BkKPwUxd(me.Jz[a].shots),e.BkKPwUzQ(me.Jz[a].pb),e.kKPwUzb(me.Jz[a].Jb),e.BkKPwUxd(100*me.Jz[a].scale),me.Jz[Math.mod(a-stateBufferSize/2,stateBufferSize)].shots=0}e.send(ws)}}function switchTeam(){if(gamePaused){console.log("Team switch requested");var e=kKPwUxS.getBuffer();e.BkKPwUxd(BkKPwUww.S),e.send(ws)}}function refreshGameState(){if(inGame){metaGame.suppressSound=!0;var e=kKPwUxS.getBuffer();e.BkKPwUxd(BkKPwUww.u),e.send(ws)}}function addPlayer(e){e.Ub==meId&&(viewingPlayerId=e.Ub);var t=new Player(e,gameScene);if(t.id==meId)viewingPlayer=t,(me=t).ws=ws,updateAmmoUi();else{let t=playerHistory.findIndex((t=>t.Hc===e.yb));t>=0&&playerHistory.splice(t,1),playerHistory.push({id:e.Ub,Hc:e.yb,name:e.Bb,muted:e.gz,isGameOwner:e.jz}),playerHistory.length>50&&playerHistory.shift()}t.Rb||t.wb.removeFromPlay(),players[e.Ub]=t,rebuildPlayerList()}function removePlayer(e){var t=players[e];e!=meId?t&&(t.wb.remove(),viewingPlayerId===e&&spectator.unlock(),delete players[e],rebuildPlayerList()):console.log("Tried to remove ME")}function getTeamKills(){for(var e=[0,0,0],t=0;t<playerLimit;t++){var i=players[t];i&&(e[i.team]+=i.fz)}var a=0;return e[1]>e[2]?a=1:e[2]>e[1]&&(a=2),{fz:e,leader:a}}var lastLeadingTeam=1;function getPlayerSocial(e){if(e){try{const t=JSON.parse(e);if(t.length>0&&hasValue(t[0]))return t.find((e=>e.active))}catch(e){}return!1}return!1}function showPlayerIcon(e){if(e.hideBadge)return!1;let t=null;e.social&&(t=JSON.parse(e.social));const i=t&&Array.isArray(t)&&t.some((e=>1==e.active));return e.upgradeProductId&&e.upgradeProductId>0||i}function findPlayerByUniqueId(e){for(let t=0;t<playerLimit;t++)if(players[t]&&players[t].Hc===e)return players[t];return playerHistory.find((t=>t.Hc===e))}function playerActionData(e,t,i){let a=findPlayerByUniqueId(e);if(a)return function(){var n={Hc:e,isGameOwner:a.isGameOwner,muted:a.muted,playerName:a.name,muteFunc:function(){mutePlayer(e)},bootFunc:function(){bootPlayer(e)},banFunc:function(t,i){banPlayer(e,t,i)},infoFunc:function(){getPlayerInfo(e)},reportFunc:function(t){reportPlayer(e,t)},social:t,vipMember:i};vueApp.showPlayerActionsPopup(n)}}function rebuildPlayerList(){playerCount[0]=0,playerCount[1]=0,playerCount[2]=0;for(var e=[],t=0;t<playerLimit;t++)players[t]&&(e.push(t),playerCount[players[t].team]++);metaGameUI.sortPlayerList(e);var i=document.getElementById("playerList").children;for(t=0;t<e.length;t++){var a=players[e[t]],n=i[t],s=n.children[0],r=s.children[0],o=s.children[1],l=n.children[1];r.classList.add("playerSlot--name"),o.classList.add("playerSlot--score"),l.classList.add("playerSlot--icons"),n.style.display="block",n.style.opacity=1,r.innerText=a.name;const c=getPlayerSocial(a.social);if(a.id!=meId){let e=!a.hideBadge&&c;const t=a.upgradeProductId&&a.upgradeProductId>0&&!a.hideBadge;n.onclick=playerActionData(a.Hc,e,t),n.style.pointerEvents="all",n.style.cursor="pointer",a.Rb||(n.style.opacity=.3)}o.innerText=a.fz,s.classList.add("playerSlot--name-score");let h="playerSlot--name-score",u="playerSlot-player-is-me",m="playerSlot-player-is-them",d="";spectate&&spectateMode===Spectate.firstPerson&&a.id===spectator.playerIdx&&(d="playerSlot-spectating"),a.id==meId?s.className=`${h} ${u} ${teamColors.meClass[a.team]}`:s.className=`${d} ${h} ${m} ${teamColors.hb[a.team]}`,l.innerText="";const f=document.createElement("i"),p=document.createElement("i"),_=document.createElement("i");f.className="fas fa-egg hidden text_gold vip-egg",c&&(f.className=`fab ${SOCIALMEDIA[c.id]} hidden`),p.className="fas fa-ban hidden";showPlayerIcon(a)&&f.classList.remove("hidden"),a.muted&&p.classList.remove("hidden"),_.className="fas fa-exclamation-triangle red hidden",watchPlayer===a.Hc&&_.classList.remove("hidden"),l.appendChild(f),l.appendChild(p),l.appendChild(_)}for(;t<playerLimit;)i[t].style.display="none",t++}function bootPlayer(e){var t=kKPwUxS.getBuffer();t.BkKPwUxd(BkKPwUww.t),t.AABkKPwUyt(e),t.send(ws)}function banPlayer(e,t,i){var a=kKPwUxS.getBuffer();a.BkKPwUxd(BkKPwUww.j),a.AABkKPwUyt(e),a.AABkKPwUyt(t),a.BkKPwUxd(i),a.send(ws)}function challengePlayerRerollInGame(e){var t=kKPwUxS.getBuffer();t.BkKPwUxd(BkKPwUww.Zc),t.AABkKPwUyt(e),t.send(ws)}function mutePlayer(e){for(let i=0;i<playerLimit;i++){if((t=players[i])&&t.id!==meId&&t.Hc===e){t.muted?(t.muted=!1,settings.safeNames||(t.name=t.Kb)):(t.muted=!0,settings.safeNames||(t.name=t.safeName)),t.wb.setupNameSprite(),rebuildPlayerList();break}}var t;(t=playerHistory.find((t=>t.id!==meId&&t.Hc===e)))&&(t.muted=!t.muted)}function reportPlayer(e,t){var i=kKPwUxS.getBuffer();i.BkKPwUxd(BkKPwUww.D),i.AABkKPwUyt(e),i.BkKPwUxd(t),i.send(ws),vueApp.showGenericPopup("report_confirm_title","report_confirm_message","ok")}function getPlayerInfo(e){let t=findPlayerByUniqueId(e);if(!t)return;let i=new BroadcastChannel("ShellShockersAdmin");i.postMessage({cmd:"getPlayer",id:t.dbId,ip:t.ip}),i.close()}function updateAmmoUi(){if(me){var e=document.getElementById("weaponName");e.innerHTML=me.ib.constructor.weaponName,(e=document.getElementById("ammo")).style.color="#fff";var t=me.ib.ammo,i=Math.max(Math.min(t.Sb,t.Fc),0),a=Math.max(Math.min(t.store,t.kb),0);e.innerHTML=i+"/"+a;for(var n=1;n<=3;n++)me.kz>=n?document.getElementById("grenade"+n).src="img/ico_grenade.webp?v=1":document.getElementById("grenade"+n).src="img/ico_grenadeEmpty.webp?v=1"}}var lastKey=null,debugWindow,rays;function captureKeys(){lastKey=null,document.addEventListener("keydown",onKeyDown),document.addEventListener("keyup",onKeyUp)}function releaseKeys(){document.removeEventListener("keydown",onKeyDown),document.removeEventListener("keyup",onKeyUp)}function mapControl(e,t){if(spectate)(i=inputToControlMap[e].spectate[t])||(i=inputToControlMap[e].game[t]),spectateMode===Spectate.firstPerson&&("ARROWUP"===t&&(i="up"),"ARROWDOWN"===t&&(i="down"));else var i=inputToControlMap[e].game[t];return i}function inputDown(e,t){(spectate||document.pointerLockElement&&me.Rb)&&handleInputDown(mapControl(e,t))}function handleInputDown(e){switch(e){case"up":case"down":case"left":case"right":case"jump":case"ascend":case"descend":var t=CONTROL[e];controlKeys|=t;break;case"inspect":document.pointerLockElement&&me&&me.wb.inspect();break;case"melee":document.pointerLockElement&&me&&InputQueue.add(InputQueue.melee);t=CONTROL[e];controlKeys|=t;break;case"fire":document.pointerLockElement&&me&&InputQueue.add(InputQueue.fire);t=CONTROL[e];controlKeys|=t;break;case"grenade":document.pointerLockElement&&me&&!grenadePowerUp&&me.canSwapOrReload()&&me.kz>0&&(grenadePowerUp=!0,grenadeThrowPower=-.15);break;case"scope":t=CONTROL[e];settings.holdToAim?controlKeys|=t:me.scope?controlKeys^=controlKeys&t:controlKeys|=t;break;case"reload":InputQueue.add(InputQueue.reload);break;case"swap_weapon":InputQueue.add(InputQueue.swap);break;case"toggle_freecam":spectate&&(spectateMode===Spectate.freeCamera?(spectateMode=Spectate.firstPerson,spectator.firstPerson()):(spectateMode=Spectate.freeCamera,spectator.freeCamera()));break;case"despawn":crazyGamesActive&&pausePlayerGame();break;case"slow":spectate&&spectateMode===Spectate.freeCamera&&spectator.startSlow()}}function inputUp(e,t){(spectate||document.pointerLockElement&&me.Rb)&&handleInputUp(mapControl(e,t))}function handleInputUp(e){switch(e){case"fire":var t=CONTROL[e];controlKeys^=controlKeys&t;break;case"scope":if(settings.holdToAim){me.scopeOut();t=CONTROL[e];controlKeys^=controlKeys&t}break;case"grenade":document.pointerLockElement&&grenadePowerUp&&me&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden",grenadePowerUp=!1,me.throwGrenade(grenadeThrowPower));break;case"slow":spectate&&spectateMode===Spectate.freeCamera&&spectator.endSlow();break;case"up":if(spectate&&spectateMode===Spectate.firstPerson){spectator.spectateNextPlayer(-1),controlKeys=0;break}case"down":if(spectate&&spectateMode===Spectate.firstPerson){spectator.spectateNextPlayer(1),controlKeys=0;break}case"left":case"right":case"jump":case"melee":case"ascend":case"descend":t=CONTROL[e];controlKeys^=controlKeys&t}}function debugDump(){if(debugWindow){for(var e=0;e<playerLimit;e++){var t=players[e];if(t){var i={name:t.name,hp:t.Oz,Rb:t.Rb,posX:t.jb,posY:t.Vb,posZ:t.Lb,actorX:t.wb.Xb.position.x,actorY:t.wb.Xb.position.y,actorZ:t.wb.Xb.position.z,transformEnabled:t.wb.Xb.isEnabled(),transformVisible:t.wb.Xb.isVisible,transformFrozen:t.wb.Xb.isWorldMatrixFrozen,shellEnabled:t.wb.Bz.isEnabled(),shellVisible:t.wb.Bz.isVisible,shellFrozen:t.wb.Bz.isWorldMatrixFrozen,weaponEnabled:t.ib.wb.Fz.isEnabled(),weaponVisible:t.ib.wb.Fz.isVisible};debugWindow.document.write(JSON.stringify(i)+"\n")}}debugWindow.document.write("<hr>")}else(debugWindow=window.open("","","name=Debug")).document.write("<pre>")}function addKillText(e,t){var i=[` ${getLocText("ingame_kill_text_scrambled")} `,` ${getLocText("ingame_kill_text_beat")} `,` ${getLocText("ingame_kill_text_poached")} `,` ${getLocText("ingame_kill_text_whipped")} `,` ${getLocText("ingame_kill_text_fried")} `,` ${getLocText("ingame_kill_text_cracked")} `],a='<span style="color: '+teamColors.text[e.team]+'">'+e.name+"</span>"+i[Math.randomInt(0,i.length)]+'<span style="color: '+teamColors.text[t.team]+'">'+t.name+"</span>";(killEl.innerHTML.match(/<br>/g)||[]).length>4&&(killEl.innerHTML=killEl.innerHTML.substr(killEl.innerHTML.search("<br>")+4)),killEl.innerHTML+=a+"<br>"}function canChat(){return!!(isPrivateGame||G.playerAccount.isEmailVerified||new Date(G.playerAccount.dateCreated).getTime()<17145468e5)}function initChatIn(){canvas.focus(),chatInEl.style.display="block",canChat()?(chatInEl.value=getLocText("ingame_press_enter_to_chat"),chatInEl.style.pointerEvents="auto"):(chatInEl.value=getLocText("ingame_sign_in_to_chat"),chatInEl.style.pointerEvents="all",chatInEl.style.cursor="pointer",chatInEl.onclick=()=>{vueApp.onShowloginPopupWarning()}),chatInEl.style.background="transparent",chatInEl.blur(),chatting=!1}function parseChatFlags(e){if(!e.startsWith("/"))return ChatFlags.none;let t=e.slice(1).split(" ");switch(t[0].toLowerCase()){case"t":case"team":return t[1]?isTeamGame?ChatFlags.team:ChatFlags.none:null;case"p":case"pin":return isGameOwner?ChatFlags.pinned:ChatFlags.none;default:return ChatFlags.none}}function trimChatCommand(e){let t=e.split(" ");return e.slice(t[0].length+1)}function addChat(e,t,i,a,n){const s=chatOutEl.querySelectorAll(".chat-item");if(t&ChatFlags.pinned&&!e){for(let e of s)e.classList.contains("chat-pinned-item")&&e.remove();return}const r=document.createElement("div"),o=document.createElement("span"),l=document.createElement("div"),c=document.createElement("span"),h=document.createElement("i");let u=!1,m=!1,d=!1;if(r.classList.add("chat-item"),l.style.display="inline-block",i>253)255===i?(c.textContent="SERVER: ",l.style.color="#ff0"):254===i&&(c.textContent="MOD: ",l.style.color="#0f0"),c.classList.add("chat-player-name","ss_marginright_xs"),l.appendChild(c);else{let a=players[i];if(chatParser.innerHTML=e,e=filterUnicode(chatParser.textContent.trim()),i===meId||null!==i&&a&&!a.muted&&e.length>0&&!isBadWord(e)&&e.indexOf("<")<0)u=!!(a.upgradeProductId&&a.upgradeProductId>0),m=getPlayerSocial(a.social),m&&!a.hideBadge?(h.classList.add("fab",SOCIALMEDIA[m.id]),h.classList.add("ss_marginright_xs")):u&&!a.hideBadge&&(h.classList.add("fas","fa-egg","hidden","text_gold","vip-egg"),h.classList.add("ss_marginright_xs")),d=a.Hc,c.classList.add("chat-player-name","ss_marginright_xs"),c.textContent=a.name+": ",t&ChatFlags.team&&(o.style.color=teamColors.text[a.team],o.classList.add("chat-team")),l.style.color=teamColors.text[a.team],l.appendChild(h),l.appendChild(c);else if(null!==i)return}s.length>4&&(s[0].classList.contains("chat-pinned-item")?t&ChatFlags.pinned?s[0].remove():s[1].remove():s[0].remove()),n&&(e=e.format(n)),o.innerHTML=e,t&ChatFlags.pinned&&(o.classList.add("chat-pinned"),r.classList.add("chat-pinned-item")),r.appendChild(l),r.appendChild(o),r.classList.add("clickme"),r.onclick=()=>{c.classList.add("clickme"),!d&&a?a():d!=me.Hc&&(c.classList.add("clickme"),playerActionData(d,m,u)())},chatOutEl.appendChild(r),chatContainer&&(chatContainer.scrollTop=chatContainer.scrollHeight)}function sendChat(e){var t=kKPwUxS.getBuffer();t.BkKPwUxd(BkKPwUww.Wc),t.AABkKPwUyt(e),t.send(ws)}function onChatKeyDown(e){var t=(e=e||window.event).key;switch(chatInEl.value=fixStringWidth(chatInEl.value,280),t){case"Enter":var i=chatInEl.value.trim();if(""!=i&&i.indexOf("<")<0){sendChat(i);var a=parseChatFlags(i);a!=ChatFlags.none&&(i=trimChatCommand(i)),observingGame||addChat(i,a,meId),G.adminRoles||isGameOwner||(me.chatLines++,me.chatLines>2&&(chatInEl.style.visibility="hidden")),1===++chatEvents&&ga("send","event","game","stats","chat",chatEvents)}case"Tab":e.preventDefault(),e.stopPropagation(),stopChat()}}function startChat(){me.chatLines<=2&&canChat()&&(releaseKeys(),chatInEl.style.background="rgba(0, 0, 0, 0.5)",chatInEl.value="",chatInEl.focus(),lastKey=null,chatting=!0)}function stopChat(){initChatIn(),captureKeys()}function onKeyDown(e){var t=(e=e||window.event).key;if(t!=lastKey)if(lastKey=t,grenadePowerUp||0!=controlKeys||"Enter"!=t||!settings.enableChat){chatting||"Tab"==t&&(i="ESCAPE",e.preventDefault(),pausePlayerGame("down"));var i=(""+t).toLocaleUpperCase();if(" "==i&&(i="SPACE",e.preventDefault()),debug){if("`"==i)return void debugDump();if("\\"==i){freezeFrame=!0;for(var a=0;a<gameScene.particleSystems.length;a++)gameScene.particlesPaused=!0;for(a=0;a<playerLimit;a++)players[a]&&players[a].wb&&(players[a].wb.Xb.mb(!0),players[a].wb.showNameSprite(),players[a].wb.positionNameSprite());ws.close()}}inputDown("keyboard",i)}else startChat()}function onKeyUp(e){var t=(e=e||window.event).key;t==lastKey&&(lastKey=null);var i=(""+t).toLocaleUpperCase();" "==i&&(i="SPACE",e.preventDefault()),inputUp("keyboard",i)}function Scope(){var e=[[new Vector3(-1,0,0),new Vector3(1,0,0)],[new Vector3(0,-1,0),new Vector3(0,1,0)]];this.Xx=MeshBuilder.CreateLineSystem("crosshairs",{lines:e},gameScene),this.Xx.setEnabled(!1),this.Xx.position.z=2,this.Xx.applyFog=!1,this.Xx.layerMask=536870912,this.Xx.color=Color3.Black()}function HitIndicator(){this.Xb=new Mesh("hitIndicator",gameScene),this.Xb.updatable=!0,this.Xb.hasVertexAlpha=!0,this.positions=[0,0,0,0,.5,0,.5,.5,0,.5,0,0,.5,-.5,0,0,-.5,0,-.5,-.5,0,-.5,0,0,-.5,.5,0];this.colors=new Array(48).fill(0);for(var e=0;e<48;e+=4)this.colors[e]=1,this.colors[e+1]=.9,this.colors[e+2]=0,this.colors[e+3]=-.5;var t=new VertexData;t.positions=this.positions,t.indices=[0,1,8,0,2,1,0,2,1,0,3,2,0,3,2,0,4,3,0,4,3,0,5,4,0,5,4,0,6,5,0,6,5,0,7,6,0,7,6,0,8,7,0,8,7,0,1,8],t.colors=this.colors,t.applyToMesh(this.Xb,!0),this.Xb.layerMask=536870912,this.Xb.material=gameScene.getMaterialByName("ui"),this.resize()}function Reticle(){this.Xx=[],this.shotBrackets=[];for(var e=0;e<4;e++)this.Xx.push(document.getElementById("crosshair"+e)),this.shotBrackets.push(document.getElementById("shotBracket"+e));this.crosshairReticle=document.getElementById("crosshairContainer"),this.readyBrackets=document.getElementById("readyBrackets"),this.shotReticle=document.getElementById("shotReticleContainer"),this.redDotReticle=document.getElementById("redDotReticle"),this.reticleDot=document.getElementById("reticleDot")}function gaTrackShareEvents(){const e=vueData.gameTypes.find((({value:e})=>e===gameType)),t=vueData.googleAnalytics;gaSendEvents([[t.cat.play,t.action.shareGameCopy,`Map - ${minMap.name}`,""],[t.cat.play,t.action.shareGameCopy,e.locKey?`Game type - ${e.locKey}`:"n/a",""],[t.cat.play,t.action.shareGameCopy,`Play type - ${joinedAs}`,""]])}function createInviteLink(){var e=(""==dynamicContentPrefix?parsedUrl.root:dynamicContentPrefix)+"#"+gameCode;const t=crazySdk.inviteLink({crazyShare:gameCode});return crazyGamesActive?t:e}function inviteFriends(){vueApp.showShareLinkPopup(createInviteLink(),gameCode),autoInvite=!1}function copyFriendCode(e){gaTrackShareEvents();try{navigator.clipboard.writeText(e)}catch(e){console.log("Unable to copy to clipboard")}}Scope.prototype.show=function(){var e=G.engine.getRenderHeight();this.Xx.scaling.x=e/2,this.Xx.scaling.y=e/2,this.Xx.setEnabled(!0),document.getElementById("scopeBorder").style.display="flex",camera.viewport.width=e/G.engine.getRenderWidth(),camera.viewport.x=.5-.5*camera.viewport.width},Scope.prototype.hide=function(){this.Xx.setEnabled(!1),document.getElementById("scopeBorder").style.display="none",camera.viewport.width=1,camera.viewport.x=0},HitIndicator.prototype.resize=function(){this.Xb.scaling.x=G.engine.getRenderWidth(),this.Xb.scaling.y=G.engine.getRenderHeight()},HitIndicator.prototype.update=function(e){for(var t=7;t<48;t+=4)this.colors[t]-=(this.colors[t]+.5)/10*e;var i=Math.pow(.9,e);me&&me.Rb&&(camera.position.x*=i,camera.position.z*=i),this.Xb.updateVerticesData(VertexBuffer.ColorKind,this.colors,!0)},HitIndicator.prototype.hit=function(e,t){var i=-Math.atan2(-e,t),a=Math.radRange(i-me.pb+.393);a=Math.floor(a/Math.PI2*8);var n=new Vector2(-this.positions[3*a+3],-this.positions[3*a+4]).normalize();camera.position.x=.03*n.x,camera.position.z=.03*n.y,this.colors[4*a+7]=2},Reticle.prototype.show=function(){if(document.getElementById("reticleContainer").className="",me.ib.constructor.readySpread){this.readyBrackets.className="notReady";var e="62.5vw";this.readyBrackets.style.width=e,this.readyBrackets.style.height=e}else this.readyBrackets.className="hideme";this.redDotReticle.className="hideme",this.crosshairReticle.className=me.ib.constructor===DozenGauge?"hideme":"",this.shotReticle.className=me.ib.constructor===DozenGauge?"":"hideme"},Reticle.prototype.hide=function(){document.getElementById("reticleContainer").className="hideme"},Reticle.prototype.hideDot=function(){this.reticleDot.className="hideme"},Reticle.prototype.showDot=function(){settings.centerDot&&(this.reticleDot.className="")},Reticle.prototype.fireDenied=function(){this.readyBrackets.className="";var e=this;setTimeout((function(){e.readyBrackets.className="notReady"}),10)},Reticle.prototype.setPowerful=function(e){for(var t=0;t<4;t++){var i=this.Xx[t],a=this.shotBrackets[t];e?(i.classList.remove("normal"),i.classList.add("powerful"),a.classList.remove("normal"),a.classList.add("powerful")):(i.classList.add("normal"),i.classList.remove("powerful"),a.classList.add("normal"),a.classList.remove("powerful"))}},Reticle.prototype.update=function(e){if(camera.forwardRay=camera.getForwardRay(),camera.forwardRay.origin=me.wb.eye.getAbsolutePosition(),me.ib){var t=me.ib.accuracy;if(me.ib.constructor===DozenGauge){var i=t*(200/camera.undefinedc);this.shotReticle.style.width=i+"vh",this.shotReticle.style.height=i+"vh"}else{i=t*(50/camera.undefinedc);for(var a=0;a<4;a++){this.Xx[a].style.transform="rotate("+90*a+"deg) translateY(calc("+i+"vh + 0.12em))"}}camera.forwardRay.direction.scaleInPlace(1e3);var n=Collider.ub(camera.forwardRay.origin,camera.forwardRay.direction,Collider.projectileCollidesWithCell);if(n){var s=Vector3.Distance(camera.forwardRay.origin,n.pick.pickedPoint);camera.forwardRay.range=s,me.ib.constructor.minRange&&(s-.01>=me.ib.constructor.minRange?this.readyBrackets.className="ready":this.readyBrackets.className="notReady")}else me.ib.constructor.minRange&&(this.readyBrackets.className="ready"),camera.forwardRay.range=1e6;me.ib.constructor.burst&&(camera.undefinedc-me.ib.wb.scopeFov<.006?this.redDotReticle.className="":this.redDotReticle.className="hideme")}},Reticle.prototype.resize=function(){};var rayIdx=0;function isMeshVisible(e,t){if(freezeFrame)return!0;for(var i=t||e.getBoundingInfo().boundingBox.center.z,a=e.position.x-camera.globalPosition.x,n=e.position.y+i-camera.globalPosition.y,s=e.position.z-camera.globalPosition.z,r=Math.length3(a,n,s),o=Math.normalize3({x:a,y:n,z:s},.9),l=camera.globalPosition.x,c=camera.globalPosition.y,h=camera.globalPosition.z,u=0,m=0;m<r-.9&&(l+=o.x,c+=o.y,h+=o.z,!(l<0||l>=map2.width||h<0||h>=map2.depth||c<0||c>=map2.height));m+=.9){var d=map2.data[Math.floor(l)][Math.floor(c)][Math.floor(h)];if(d.idx){var f=mapMeshes[d.idx];if("full"==f.colliderType&&!f.softness&&"barrier"!==f.shortName&&2==++u)return!1}}return!0}function openEquipInGame(){G.engine.stopRenderLoop(),paperDoll.startRendering()}function closeEquipInGame(e){G.engine.stopRenderLoop(),startRendering(e),equipmentWasChanged=!0,chatting&&chatInEl.focus()}function resetGameUI(){chatInEl=document.getElementById("chatIn"),chatOutEl=document.getElementById("chatOut"),killEl=document.getElementById("killTicker");var e=document.getElementById("playerList");!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(e);for(var t=document.getElementById("playerSlot"),i=0;i<20;i++){var a=t.cloneNode(!0);e.appendChild(a)}chatOutEl.innerHTML="",1==settings.enableChat&&(initChatIn(),chatOutEl.style.display="block",chatInEl.style.display="block"),killEl.innerHTML="",chatOutEl.value="",document.getElementById("scopeBorder").style.display="none";document.getElementById("spatulaPlayer").classList.replace("capture","drop"),document.getElementById("spectate").style.display="none",document.getElementById("teamScores").style.display=gameType==GameType.ctf?"grid":"none",document.getElementById("captureContainer").style.display=gameType==GameType.king?"block":"none",document.getElementById("captureIconContainer").style.display="none",document.getElementById("playerList").style.pointerEvents="auto",shellStreakUISetup(),reticle&&reticle.setPowerful(!1),console.log("resetGameUI")}function updateTeamUI(){for(var e=1;e<=2;e++){document.getElementById("teamScoreNum"+e).innerText=metaGame.teamScore[e];var t=document.getElementById("teamScore"+e);spatula&&(spatula.controlledByTeam==e?t.classList.replace("inactive","active"):spatula.lastControlTeam!=e&&t.classList.replace("active","inactive"))}}var pointerObserver=null;function setupPointerObserver(){const e=G.engine.scenes[0];e?pointerObserver=e.onPointerObservable.add((e=>{const t=e.event;switch(e.type){case PointerEventTypes.POINTERDOWN:onCanvasMouseDown(t);break;case PointerEventTypes.POINTERUP:onCanvasMouseUp(t)}})):console.error("Scene not found.")}function removePointerObserver(){if(pointerObserver){const e=G.engine.scenes[0];e&&e.onPointerObservable.remove(pointerObserver),pointerObserver=null}}var listeners=[{type:"mousedown",listener:onCanvasMouseDown,options:{once:!1}},{type:"mouseup",listener:onCanvasMouseUp,options:{once:!1}},{type:"pointermove",listener:onCanvasMouseMove,options:{once:!1}},{type:"wheel",listener:onCanvasMouseWheel,options:{once:!1}}];function addCanvasListeners(){console.log("Adding canvas event listeners"),canvas.hasAttribute("tabindex")||canvas.setAttribute("tabindex","0"),canvas.focus(),canvas.style.pointerEvents="all",setupPointerObserver(),listeners.forEach((e=>canvas.addEventListener(e.type,e.listener,e.options))),addEventListener("gamepadbuttondown",onGamepadButtonDown)}function removeCanvasListeners(){console.log("Removing canvas event listeners"),canvas.style.pointerEvents="none",removePointerObserver(),listeners.forEach((e=>canvas.removeEventListener(e.type,e.listener))),removeEventListener("gamepadbuttondown",onGamepadButtonDown)}function onGamepadButtonDown(e){8==e.detail&&document.exitPointerLock()}function challengeIcon(e){const{type:t,subType:i,valueTwo:a,conditional:n}=e,s="img/challenges/",r=`${s}${t}`;if(t===ChallengeType[0]&&"weaponType"===i&&null!==a)return`${r}-${i}-${DmgType[a].name}.svg`;if(i&&i.includes("time"))return`${s}timed.svg`;if(n)return`${r}-shot.svg`;return[ChallengeType[6],ChallengeType[7],ChallengeType[8],ChallengeType[5],ChallengeType[4]].includes(t)?`${r}.svg`:`${r}${i?"-"+i:""}.svg`}function challengeCompleted(e){const t=Challenges.find((t=>t.id===e));if(t){const e=extern.playerChallenges.iconSrc(t.loc_ref),i=getLocText(`${t.loc_ref}_title`),a=getLocText(`${t.loc_ref}_desc`);vueApp.challengeMsg({icon:e,title:i,desc:a})}else console.warn("Challenge not found for ID:",e)}async function chromeSuxLockPermission(){const e=getChromeVersion();if(e&&!(e<131))try{const e=await navigator.permissions.query({name:"pointer-lock"});"denied"===e.state&&(chromeSucks(),isChromeSuxPointerAllowed=!1),e.onchange=()=>{"denied"===e.state?(inGame&&(chromeSucks(),onChromeIsABuggerPopupConfirm()),isChromeSuxPointerAllowed=!1):"granted"===e.state&&(isChromeSuxPointerAllowed=!0)}}catch(e){console.error("Error checking Pointer Lock permission:",e)}}function onChromeIsABuggerPopupConfirm(){inGame&&!gamePaused&&removePlayerFromGame()}function chromeSucks(){vueApp.chromeIsABuggerPopupShow()}function eggOrgCheckShowPopupInGame(){vueApp.eggOrgCheckShowPopupInGame()}var MetaGame=class{playSound(e){this.suppressSound||BAWK.play(e)}update(){}_unPackState(e){this.unPackState(e),this.suppressSound=!1}scoreKill(e,t){}constructor(){this.teamScore=[0,0,0],this.suppressSound=!0,this.lastLeadingTeam=1,this.zoneMesh=null}getTeamWithHighestScore(){let e=this.lastLeadingTeam;return this.teamScore[1]>this.teamScore[2]?e=1:this.teamScore[2]>this.teamScore[1]&&(e=2),this.lastLeadingTeam=e,e}reset(){me&&(me.canTakeTeamBonus=!0),metaGame.teamScore=[0,0,0];for(var e=0;e<playerLimit;e++){var t=players[e];t&&(t.fz=0,t.stats.streak=0)}rebuildPlayerList()}getTeamWithMostKills(){let e=this.lastLeadingTeam,t=[0,0,0];for(let e=0;e<playerLimit;e++){let i=players[e];i&&(t[i.team]+=i.fz)}return t[1]>t[2]?e=1:t[2]>t[1]&&(e=2),this.lastLeadingTeam=e,e}static otherTeam(e){return 1==e.team?2:1}},MetaGameUI=class{sortPlayerListByKills(e){e.sort(((e,t)=>players[t].fz-players[e].fz))}constructor(){}timeToPlayVideoAd(){return null}update(){}playSound(e){metaGame.suppressSound||BAWK.play(e)}sortPlayerListByTeamKills(e){this.sortPlayerListByKills(e);let t=metaGame.getTeamWithMostKills();this.sortPlayerListByLeadingTeam(e,t)}sortPlayerList(){}sortPlayerListByLeadingTeam(e,t){e.sort(((e,i)=>players[i].team==t?1:players[e].team==t?-1:0))}sortPlayerListByTeamScore(e){this.sortPlayerListByKills(e);let t=metaGame.getTeamWithHighestScore();this.sortPlayerListByLeadingTeam(e,t)}render(){}},MetaGameFFA=class extends MetaGame{constructor(){super()}},MetaGameUIFFA=class extends MetaGameUI{sortPlayerList(e){this.sortPlayerListByKills(e)}constructor(){super()}},MetaGameTeams=class extends MetaGame{scoreKill(e){this.teamScore[e]++}constructor(){super()}unPackState(e){this.teamScore[1]=e.unPackInt16U(),this.teamScore[2]=e.unPackInt16U()}},MetaGameUITeams=class extends MetaGameUI{sortPlayerList(e){this.sortPlayerListByTeamKills(e)}constructor(){super()}},MetaGameSpatula=class extends MetaGame{resetSpatula(){spatula.wb.dispose(),spatula=null;var e=document.getElementById("spatulaPlayer");e.classList.remove("capture"),e.classList.add("drop")}constructor(){super()}unPackState(e){this.teamScore[1]=e.unPackInt16U(),this.teamScore[2]=e.unPackInt16U();let t={x:e.unPackFloat(),y:e.unPackFloat(),z:e.unPackFloat()},i=e.unPackInt8U(),a=e.unPackInt8U();if(spatula){if(spatula.x=t.x,spatula.y=t.y,spatula.z=t.z,spatula.vz!=i){var n=["",'<h1 class="blueTeam">'+vueApp.loc.team_blue+"</h1>",'<h1 class="redTeam">'+vueApp.loc.team_red+"</h1>"];if(255==i)me.Rb&&vueApp.ctsCapturedMsg({team:n[a],msg:"ingame_dropped_the_spatula"}),spatula.drop(t);else{me.Rb&&vueApp.ctsCapturedMsg({team:a,msg:"ingame_captured_the_spatula"});let e=players[i];e&&e.Rb&&spatula.capture(players[i])}}}else(spatula=new Spatula(gameScene,t)).vz=i,spatula.controlledByTeam=a,255!=i&&spatula.wb.capture(players[i]);updateTeamUI()}reset(){super.reset(),this.resetSpatula()}scoreKill(e,t){spatula.wb||spatula.vz!=t.id||spatula.drop();var i=MetaGame.otherTeam(t);spatula.controlledByTeam==i&&(this.teamScore[i]++,updateTeamUI())}},MetaGameUISpatula=class extends MetaGameUI{constructor(){super()}sortPlayerList(e){this.sortPlayerListByTeamScore(e)}},MetaGameKing=class e extends MetaGame{init(){this.activeZone=null,this.teams=null,this.progress=null,this.numCapturing=null,this.teamsBalanced=!1,this.state=e.state.capturing}unPackState(t){let i=this.activeZone;switch(this.state=t.unPackInt8U(),this.activeZone=t.unPackInt8U(),this.teams=t.unPackInt8U(),this.progress=t.unPackInt16U(),this.numCapturing=t.unPackInt8U(),this.teamScore[1]=t.unPackInt8U(),this.teamScore[2]=t.unPackInt8U(),console.log("ACTIVE ZONE IS NOW",this.activeZone),this.state){case e.state.win:munitionsManager.removeAll(),roundEnded=!0,metaGameUI.win(),this.playSound("kotc_roundend");break;case e.state.start:if(roundEnded&&(roundEnded=!1,this.reset(),playerCount[1]+playerCount[2]>2)){var a=document.getElementById("gameMessage");a.innerHTML=getLocText("ingame_coop_shuffle"),a.className="show",setTimeout((()=>{a.className="hide"}),3e3)}break;case e.state.fz:this.playSound("kotc_pointscore");break;case e.state.contested:this.playSound("kotc_contested")}this.activeZone&&this.activeZone!=i&&this.playSound("kotc_zonespawn"),metaGameUI.setCaptureState(this.teams)}update(){if(this.activeZone)if(this.state==e.state.takeover)this.progress>0&&(this.progress-=e.takeOverSpeed);else if(this.state==e.state.capturing&&(1==this.teams||2==this.teams)){let t=e.captureSpeeds[this.numCapturing-1];this.progress+=t}}reset(){super.reset(),this.init()}constructor(){super(),this.init()}},MetaGameUIKing=class e extends MetaGameUI{timeToPlayVideoAd(){return 4!==metaGame.teamScore[1]&&4!==metaGame.teamScore[2]&&null}win(){this.setCaptureState(0);let e=document.getElementById("bigMessageContainer");e.style.display="block";let t=metaGame.teamScore[1]>metaGame.teamScore[2]?1:2;document.documentElement.style.setProperty("--ss-big-message-border-color",teamUI[t].lightColor),document.getElementById("bigMessage").innerHTML='<span class="bigMessageText" style="color: var(--ss-big-message-border-color)">'+getLocText(teamUI[t].name).toUpperCase()+'</span><span class="bigMessageText">&nbsp;'+getLocText("ingame_coop_win")+"</span>",t==me.team&&me.canTakeTeamBonus?document.getElementById("bigMessageCaption").innerHTML=getLocText("ingame_coop_bonus")+' +250 <img src="img/ico_goldenEgg.webp" style="height: 2em; vertical-align: text-top" />':document.getElementById("bigMessageCaption").innerHTML=getLocText("ingame_coop_nextroundbig"),setTimeout((()=>{e.style.display="none"}),5e3)}sortPlayerList(e){this.sortPlayerListByTeamScore(e)}constructor(){super(),this.captureBarEl=document.getElementById("captureBar"),this.captureBarTextEl=document.getElementById("captureBarText"),this.captureIconContainer=document.getElementById("captureIconContainer"),this.captureIcon=document.getElementById("captureIcon"),this.captureRingContainer=document.getElementById("captureRingContainer"),this.captureRing=document.getElementById("captureRing"),this.captureIconCaption=document.getElementById("captureIconCaption"),this.previousCapturingTeam=0,this.teamScoreEl=[null,document.getElementById("captureScoreBlue"),document.getElementById("captureScoreRed")]}render(){let e=this.captureIconContainer;if(!metaGame.activeZone)return void e.classList.remove("on");e.classList.add("on");let t=camera.getViewMatrix().multiply(camera.getProjectionMatrix()),i=capZoneMeshes[metaGame.activeZone-1].capIconPosition,a=G.engine.getHardwareScalingLevel(),n=G.engine.getRenderWidth()*a,s=G.engine.getRenderHeight()*a,r=Vector3.TransformCoordinates(i,t);r.y*=-1;let o,l,c=camera.getDirection(Vector3.Backward()),h=camera.globalPosition,u=i.x-h.x,m=i.y-h.y,d=i.z-h.z,f=Math.length3(u,m,d),p=(c.x*u+c.y*m+c.z*d)/f,_=r.x,g=r.y;if(p<0){_*=-1,g*=-1,o=Math.min(1,1/Math.abs(_)),l=Math.min(1,1/Math.abs(g)),_*=l,g*=o,Math.abs(_)>Math.abs(g)?_=Math.sign(_):g=Math.sign(g)}else o=Math.min(1,1/Math.abs(_)),l=Math.min(1,1/Math.abs(g)),_*=l,g*=o;_=_*(n/2)+n/2,g=g*(s/2)+s/2,_=Math.max(Math.min(_,.9*n),.1*n),g=Math.max(Math.min(g,.9*s),.1*s),e.style.transform="translate("+_+"px,"+g+"px)"}setZoneColor(e,t){e&&e.material.colorNode.value.set(t.r,t.g,t.b)}update(){if(0!=metaGame.activeZone){if(metaGame.state==MetaGameKing.state.takeover){let t=Math.max(metaGame.progress,0);this.setBarProgress(1-t/MetaGameKing.takeOverTime);let i=.5*Math.cos(now/100%(2*Math.PI))+.5;Color3.LerpToRef(teamUI[1==metaGame.teams?2:1].lightZone,e.zoneColor.takeover,i,e.color),this.setZoneColor(this.zoneMesh,e.color)}else if(1==metaGame.teams||2==metaGame.teams){let e=Math.min(metaGame.progress,1200);this.setBarProgress(e/1200)}if(metaGame.state==MetaGameKing.state.contested){let t=.5*Math.cos(now/100%(2*Math.PI))+.5;Color3.LerpToRef(teamUI[1].lightZone,teamUI[2].lightZone,t,e.color),this.setZoneColor(this.zoneMesh,e.color)}if(me&&metaGame.activeZone){let e=capZoneMeshes[metaGame.activeZone-1].capIconPosition,t=Math.length3(me.jb-e.x,me.Vb-e.y,me.Lb-e.z),i=Math.max(0,Math.min(.5*t-1+.5*Math.abs(me.Vb-e.y+.4),.6));this.captureIconContainer.style.opacity=i,this.captureIconCaption.innerText=Math.floor(2*t)+"M"}}else"&nbsp;"!=this.captureBarTextEl.innerHTML||0!=playerCount[1]&&0!=playerCount[2]||(this.captureBarTextEl.innerText=getLocText("ingame_coop_waiting"))}setCaptureState(t){this.teamScoreEl[1].innerText=metaGame.teamScore[1]+" / "+MetaGameKing.goalScore,this.teamScoreEl[2].innerText=metaGame.teamScore[2]+" / "+MetaGameKing.goalScore;switch(metaGame.activeZone&&(this.zoneMesh=capZoneMeshes[metaGame.activeZone-1]),metaGame.state){case MetaGameKing.state.win:this.captureBarTextEl.innerText=getLocText("ingame_coop_nextround"),this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.previousCapturingTeam=0;break;case MetaGameKing.state.fz:case MetaGameKing.state.start:this.captureBarTextEl.innerHTML="&nbsp;",this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.previousCapturingTeam=0;break;case MetaGameKing.state.unclaimed:this.captureBarTextEl.innerText=getLocText("ingame_coop_find"),this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.setZoneColor(this.zoneMesh,e.zoneColor.unclaimed);break;case MetaGameKing.state.capturing:var i=["","blue","red"];this.captureBarTextEl.innerText=getLocText(teamUI[t].name).toUpperCase()+" "+getLocText("ingame_coop_capturing")+" ("+metaGame.numCapturing+"X)",this.captureBarEl.className=i[t],this.captureRing.className=i[t],this.captureIcon.setAttribute("class",i[t]),t>0&&t!=this.previousCapturingTeam&&(this.previousCapturingTeam=t,me.team==t?this.playSound("kotc_capturing_player"):this.playSound("kotc_capturing_opponents")),this.setZoneColor(this.zoneMesh,teamUI[t].lightZone);break;case MetaGameKing.state.abandoned:i=["","blueAbandoned","redAbandoned"];this.captureBarTextEl.innerText=getLocText(teamUI[t].name).toUpperCase()+" "+getLocText("ingame_coop_capturing"),this.captureBarEl.className=i[t],this.captureRing.className=i[t],this.captureIcon.setAttribute("class",i[t]),this.setZoneColor(this.zoneMesh,teamUI[t].darkZone);break;case MetaGameKing.state.contested:this.captureBarTextEl.innerText=getLocText("ingame_coop_contested"),this.captureBarEl.className="contested",this.captureRing.className="contested",this.captureIcon.setAttribute("class","contested");break;case MetaGameKing.state.takeover:this.captureBarTextEl.innerText=getLocText("ingame_coop_takeover"),this.captureBarEl.className="takeover",this.captureRing.className="takeover",this.captureIcon.setAttribute("class","takeover")}for(let e=0;e<capZoneMeshes.length;e++){capZoneMeshes[e].visibility=metaGame.activeZone==e+1}}setBarProgress(e){this.captureBarEl.style.transform="scaleX("+e+")";let t=100*(1-e);this.captureRingContainer.style.transform="translateY("+t+"%)",this.captureRing.style.transform="translateY("+-t+"%)"}};function getCssProp(e){return getComputedStyle(document.documentElement).getPropertyValue(e)}function getColor3FromCssProp(e){let t=getCssProp(e);return t=t.match(/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(,\s*\d+\.*\d+)?\)\s*$/),Color3.FromInts(t[1],t[2],t[3])}MetaGameUIKing.zoneColor={unclaimed:new Color3(.3,.3,.3),takeover:new Color3(.8,.8,.8)},MetaGameUIKing.color=new Color3;var teamUI=[null,{name:"team_blue",lightColor:getCssProp("--ss-team-blue-light"),darkColor:getCssProp("--ss-team-blue-dark"),lightZone:getColor3FromCssProp("--ss-team-blue-light"),darkZone:getColor3FromCssProp("--ss-team-blue-dark")},{name:"team_red",lightColor:getCssProp("--ss-team-red-light"),darkColor:getCssProp("--ss-team-red-dark"),lightZone:getColor3FromCssProp("--ss-team-red-light"),darkZone:getColor3FromCssProp("--ss-team-red-dark")}],MetaGames=[{logic:MetaGameFFA,ui:MetaGameUIFFA},{logic:MetaGameTeams,ui:MetaGameUITeams},{logic:MetaGameSpatula,ui:MetaGameUISpatula},{logic:MetaGameKing,ui:MetaGameUIKing}],EggOrgLeaderboard=class{apiError(e){this.debuglog("apiError"),e&&console.log("eggOrg leaderboard error",e)}cancelRefresh(){this.debuglog("cancelRefresh"),this.refreshLeaderboard&&(clearInterval(this.refreshLeaderboard),this.refreshLeaderboard=null,this.refreshCount=0)}constructor(){this.name="EggOrgEvent",this.refreshLeaderboard=null,this.debug=!0,this.refreshCount=0,this.MAX_REFRESH_COUNT=6,this.REFRESH_INTERVAL=1e4}getName(){return this.name}debuglog(e){this.debug&&console.log(`${this.name}: ${e}`)}apiSuccess(e){this.debuglog("apiSuccess"),e&&(this.leaderboard=e,vueApp.eggOrgUpdateGlobalLeaderBoards(this.leaderboard))}refreshWithLimit(){this.debuglog("refreshWithLimit"),++this.refreshCount>this.MAX_REFRESH_COUNT?this.cancelRefresh():this.apiGet(!1)}apiGet(e=!0){this.debuglog("apiGet"),callApi({cmd:"getEggOrgLeaderBoard"},(e=>this.apiSuccess(e)),(e=>this.apiError(e))),e&&!this.refreshLeaderboard&&(this.refreshLeaderboard=setInterval((()=>this.refreshWithLimit()),this.REFRESH_INTERVAL))}};function getEquippedItems(){return G.playerAccount.getEquippedItems()}function getItemsOfType(e){switch(e){case ItemType2.Hat:return G.catalog.hats;case ItemType2.Stamp:return G.catalog.stamps;case ItemType2.Primary:return G.catalog.forClass[G.playerAccount.classIdx].forWeaponSlot[Slot.Primary];case ItemType2.Secondary:return G.catalog.forClass[G.playerAccount.classIdx].forWeaponSlot[Slot.Secondary];case ItemType2.Grenade:return G.catalog.grenades;case ItemType2.Melee:return G.catalog.melee;default:return[]}}function getTaggedItems(e,t){return G.catalog.getTaggedItems(e,t)}function getPremiumItems(){return G.catalog.getPremiumItems()}function isItemOwned(e){return G.playerAccount.isItemOwned(e)}function renderItemToCanvas(e,t,i){e||itemRenderer.clearCanvas(t),e.item_type_id===ItemType2.Stamp?itemRenderer.renderStampToCanvas(e,t,i):itemRenderer.renderToCanvas(e,t,i)}function tryEquipItem(e,t){if(t=t||e.item_type_id,null===e||isItemOwned(e)||"default"===e.unlock)switch(t){case ItemType2.Hat:G.playerAccount.hatItem=e;break;case ItemType2.Stamp:G.playerAccount.stampItem=e;break;case ItemType2.Primary:G.playerAccount.pickWeapon(Slot.Primary,e);break;case ItemType2.Secondary:G.playerAccount.pickWeapon(Slot.Secondary,e);break;case ItemType2.Grenade:G.playerAccount.grenadeItem=e;break;case ItemType2.Melee:G.playerAccount.meleeItem=e}}function setStampPosition(e,t){paperDoll.poseWithStamp(void 0,e,t)}function setShellColor(e){G.playerAccount.colorIdx=e,paperDoll.poseWithColor(e)}function resetPaperDoll(){if(!paperDoll)return;signinClicked&&(paperDoll=new PaperDoll);let e=G.playerAccount.getEquippedItems();e[ItemType2.Grenade]=null,e[ItemType2.Melee]=null,paperDoll.posingItems={[ItemType2.Primary]:null,[ItemType2.Secondary]:null,[ItemType2.Grenade]:null,[ItemType2.Melee]:null,[ItemType2.Hat]:null,[ItemType2.Stamp]:null},paperDoll.poseWithItems(e,G.playerAccount.stampPositionX,G.playerAccount.stampPositionY),paperDoll.poseWithColor(G.playerAccount.colorIdx)}async function signIn(){return new Promise(((e,t)=>{try{const t={apiKey:"AIzaSyDP4SIjKaw6A4c-zvfYxICpbEjn1rRnN50",authDomain:"shellshockio-181719.firebaseapp.com",databaseURL:"https://shellshockio-181719.firebaseio.com",projectId:"shellshockio-181719",storageBucket:"shellshockio-181719.appspot.com",messagingSenderId:"68327206324"};firebase.apps.length?firebase.app():firebase.initializeApp(t),firebaseSignInTimerStart=new Date,G.playerAccount=new PlayerAccount;const i=localStore.getItem("localLoadOut");if(i){const e=JSON.parse(i);G.playerAccount.applyLocalLoadout(e.items)}else G.playerAccount.applyRandomLoadout();console.log("Start account search with Firebase..."),parsedUrl.query.sandbox&&firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION);const a=setTimeout((()=>{console.warn("Firebase auth timeout"),e(!1)}),5e3);firebase.auth().onAuthStateChanged((t=>{clearTimeout(a),upgradingAnon&&!hasValue(t)||(t&&(hasAccount=!0),e(!0),console.log("firebase resolved: has account",hasAccount),t?((firebaseUser=t).isAnonymous?(console.log("Firebase: anonymous user"),anonymousUser=firebaseUser,hasAccount||(creatingAccount=!0)):(console.log("Firebase: auth provider: "+firebaseUser.providerData[0].providerId),firebaseUser.emailVerified||"password"!==firebaseUser.providerData[0].providerId||(console.log("Firebase: email not yet verified"),showResendEmailPopup=!0)),firebaseAccountFound()):(console.log("Firebase: no account found"),noFirebaseAccount()))}))}catch(e){console.error("Error in signIn:",e),t(e)}}))}function firebaseAccountFound(){if(!signingIn&&(signingIn=!0,upgradingAnon=!1,hasAccount=!0,firebaseUser.getIdToken(!0).then((e=>{api_auth(e,authSuccess,authFailure,authClosed)})).catch((function(e){console.log(e),signingIn=!1})),firebaseUser.providerData.length>0&&(loginProviderId=firebaseUser.providerData[0].providerId),firebaseUser.photoURL&&firebaseUser.providerData&&firebaseUser.providerData.length>0)){var e=firebaseUser.photoURL;firebaseUrl=e}}function abTestFreegamesRedirectNoAccount(){if(AbFreeGamesRedirect.aBParamCheck){AbFreeGamesRedirect.getOrCreateRandID(),AbFreeGamesRedirect.assignABTestVariant();"a"===AbFreeGamesRedirect.getAssignedVariant()&&abTestRedirect()}}function noFirebaseAccount(){console.log("No account created yet :("),signingIn=!1,ready_auth=!0,hasAccount=!1,rmItemsLocalStore(),abTestFreegamesRedirectNoAccount()}G.resetPaperDoll=resetPaperDoll;var getGameParams=null,ws,metaGame,metaGameUI;function createAnonAccountTrigger(e){return creatingAccount=!0,firebase.auth().signInAnonymously().then((()=>{firebase.auth().onAuthStateChanged((t=>{hasAccount=!0,firstGamePlayed=!0,null!==t&&e&&t.isAnonymous&&(hasAccount=!1,getGameParams=e)}))})).catch((function(e){console.debug("Failed Firebase anonymous signin, code: {0}, msg: {1}".format(e.code,e.message))}))}function sendFirebaseVerificationEmail(){console.log("sending Firebase email verification"),firebaseUser.sendEmailVerification()}async function authSuccess(e){if(e.hasOwnProperty("dateModified")&&e.hasOwnProperty("dateCreated")){const t=Math.floor(Math.abs(new Date(e.dateModified)-new Date(e.dateCreated))/36e5);hasTimesPlayed=t>1}if(e.hasOwnProperty("banRemaining")){let t,i=e.banRemaining.split(":"),a=parseInt(i[0]),n=parseInt(i[1]);t=a>24?`${Math.floor(a/24)} ${getLocText("time_days")}`:a>0?`${a} ${getLocText("time_hours")}`:`${n} ${getLocText("time_minutes")}`,vueApp.showBannedPopup(t)}else if(e.error)console.log("accountDataResponse Error: "+JSON.stringify(accountDataResponse.error));else{if(await new Promise((e=>{let t=setInterval((()=>{G.ready_meshes&&(clearInterval(t),e())}))})),G.playerAccount.signedIn(firebaseUser,e),vueApp.authCompleted(),ready_auth=!0,setTimeout((()=>G.playerAccount.syncToServer()),1e3),checkStartChicknWinner(e.chwReady),signinClicked&&(tryMidMonthRewardAgain&&tryMidMonthNewYolkerReward(),G.showSigninBonus&&(tryShowSigninBonus(),G.showSigninBonus=!1),rmItemsLocalStore(),vueApp.progressBarReset()),null!==anonymousUser)ga("set","vip_status","NoVIP");else{parsedUrl.query.signInPrompt&&parsedUrl.query.closeAfterSign&&window.close();const t=e.active_sub;ga("set","vip_status",null===t?"NoVIP":t?"IsVIP":"WasVIP"),t&&vueApp.hideHomeScreenAds(!0),e&&e.hasOwnProperty("twitchLinked")&&e.twitchLinked&&doTwitchEntitlementsCheck()}playerChallenges.dailyTimerStart(),console.log("Signed in"),hasAccount||null===getGameParams||(console.log("Nonaccount is now anon. Time for play"),vueApp.assetLoaded(),hasAccount=!0,disablePlay(!1),play(getGameParams))}creatingAccount=!1}function doTwitchEntitlementsCheck(){api_twitchPlayerEntitlements((e=>{switch(console.log("Twitch Entitlements status",e),e.status){case"SUCCESS":e.eggsGiven>0&&api_checkBalance();let t=[];hasValue(e.itemIds)&&e.itemIds.length>0&&(t=G.catalog.findItemsByIds(e.itemIds),t.forEach((e=>{G.playerAccount.isItemOwned(e)||(G.playerAccount.inventory.push(e),console.log("Reward item given, id: "+e.id))}))),vueApp.showGiveStuffPopup("give_stuff_twitch_title",e.eggsGiven,t,e.type);break;case"ACCOUNT_DEACTIVATED":console.log("Twitch ACCOUNT_DEACTIVATED")}}),(e=>console.log("api_twitchPlayerEntitlements error",e)))}function authFailure(){console.log("authorization failed"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.signIn,vueData.googleAnalytics.label.signInAuthFailed),Loader2.hide(),vueApp.authCompleted()}function authClosed(e){console.log("auth ws closed, code: "+e),1006!==e?signingIn=!1:vueApp.showGenericPopup("signin_failed_title","signin_failed","ok")}function showSignInDialog(){firebaseUi||(firebaseUi=new firebaseui.auth.AuthUI(firebase.auth()));var e=firebaseUiCreateConfig();firebaseUi.start("#firebaseui-auth-container",e),signinClicked=!0,loadAllObjectMeshes()}function firebaseUiCreateConfig(){return{autoUpgradeAnonymousUsers:!0,callbacks:{signInSuccessWithAuthResult:firebaseUiSignInSuccess,signInFailure:firebaseUiSignInFailure,uiShown:function(e){console.log("UI: showed firebase UI");const t=document.querySelector(".firebaseui-idp-list");if(t){const e=document.createElement("li"),i=document.createElement("button"),a=document.createElement("span"),n=document.createElement("img"),s=document.createElement("span");i.onclick=()=>{vueApp.fbTransferAccountSignin()},i.className="firebaseui-idp-button mdl-button mdl-js-button mdl-button--raised firebaseui-idp-facebook firebaseui-id-idp-button",i.style.backgroundColor="#3b5998",s.className="firebaseui-idp-text firebaseui-idp-text-long",s.textContent="Sign in with Facebook",a.className="firebaseui-idp-icon-wrapper",n.className="firebaseui-idp-icon",n.src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg",e.className="firebaseui-list-item",a.appendChild(n),i.appendChild(a),i.appendChild(s),e.appendChild(i),t.appendChild(e)}}},credentialHelper:firebaseui.auth.CredentialHelper.NONE,signInFlow:"popup",signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1},firebase.auth.GoogleAuthProvider.PROVIDER_ID],tosUrl:"http://www.bluewizard.com/terms"}}function firebaseUiSignInSuccess(e,t){var i=(firebaseUser=e.user).emailVerified,a=(e.credential,e.additionalUserInfo.isNewUser,e.additionalUserInfo.providerId);e.operationType;return vueApp.hideFirebaseSignIn(),"password"!=a||i||sendFirebaseVerificationEmail(),console.log("Authing Firebase ID"),firebaseAccountFound(),!1}function firebaseUiSignInFailure(e){if(vueApp.hideFirebaseSignIn(),console.log("Firebase: sign in failure, error code: "+e.code),"firebaseui/anonymous-upgrade-merge-conflict"!==e.code)return Promise.resolve();upgradingAnon=!0,firebase.auth().signInWithCredential(e.credential),anonymousUser.delete(),setTimeout((()=>{vueApp.$nextTick((()=>{vueApp.urlParamSet=!!vueApp.urlParams||null,vueApp.shellShockUrlParamaterEvents()}))}),2e3)}function signOut(){firebase.auth().signOut().then((function(){G.playerAccount=new PlayerAccount,G.playerAccount.loggingOut(),G.playerAccount.applyRandomLoadout(),productBlockAds=!1,pokiActive||crazyGamesActive||(initVideoAds(),vueApp.showTitleScreenAd()),setTimeout((()=>vueApp.setDarkOverlay(!1)),1500)}),(function(e){console.log(e)})),ga("set","dimension4","noVip"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.signIn,vueData.googleAnalytics.label.signInOut),vueApp.photoUrl=null,rmItemsLocalStore(),checkStartChicknWinner(),signinClicked=!1}var isTeamGame=!1,me,meId,playerLimit;async function checkVersionAndCache(){return(version=versionNumber)?(lastVer=getStoredString("lastVersionPlayed",version))&&lastVer!==version?(nukeCacheAndReload(),!1):(localStore.setItem("lastVersionPlayed",version),!0):(console.error("Failed to retrieve version"),!1)}function initializeLanguage(){return userSetLanguage=getStoredString("languageSelected",null),hasValue(userSetLanguage)?userSetLanguage:autoDetectBrowserLanguage()}function generateClientId(){let e="",t=document.createElement("canvas").getContext("webgl");e+=t.getParameter(t.VERSION);let i=t.getExtension("WEBGL_debug_renderer_info");null!=i&&(e+=t.getParameter(i.UNMASKED_RENDERER_WEBGL),e+=t.getParameter(i.UNMASKED_VENDOR_WEBGL)),e+=navigator.userAgent+navigator.language,clientId=1;for(let t in e)clientId=clientId*e.charCodeAt(t)%Number.MAX_SAFE_INTEGER;clientId+=(navigator.hardwareConcurrency+navigator.maxTouchPoints)%Number.MAX_SAFE_INTEGER}async function initializeEngine(){const e=document.getElementById("canvas");if(!e)throw new Error("Canvas element not found");G.engine=new Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0},!1),G.engineCaps=G.engine.getCaps(),G.engineCaps.parallelShaderCompile=void 0,G.engine.disableManifestCheck=crazyGamesActive,G.engine.enableOfflineSupport=!crazyGamesActive}function initializeGameSystems(){(shellProducts=new Product).init(),G.catalog=new Catalog,G.catalog.getPremiumGunMeshNames(),playerChallenges=new PlayerChallenges,eggOrgLeaderboard=new EggOrgLeaderboard}async function startShellShockers(e){try{if(!await checkVersionAndCache())return;firebaseDone=await signIn().catch((e=>(console.error("Firebase sign-in failed:",e),null))),parsedUrl.query.testMap&&(playOffline=!0);const e=initializeLanguage();clientId=generateClientId(),gameType=getStoredNumber("gameType",GameTypes.find((e=>"Spatula"===e.shortName)).value),await initializeEngine(),initializeGameSystems(),resize(),Matchmaker.connect(),waitForGameReady(),updateLanguageSetting(),vueData.maps=maps;const t=await getLanguageData(e);RewardNoobGrenade=new RewardGive(16029),startVue(e,t),console.log("ShellShockers startup complete")}catch(e){console.error("Critical error during game startup:",e)}}var initMetrics={startTime:0,marks:new Map,start(){this.startTime=performance.now(),this.marks.clear()},mark(e){this.marks.set(e,performance.now()-this.startTime)},getReport(){return Object.fromEntries(this.marks)}},globalScene;function updateLanguageSetting(){let e=getStoredString("selectedLanguage",null);if(!hasValue(e))return;let t=autoDetectBrowserLanguage();"en"!==e&&e===t&&(console.log("Updating to new localStore for language setting"),localStore.setItem("languageSelected",t),ga("send","event",{eventCategory:vueData.googleAnalytics.cat.playerStats,eventAction:vueData.googleAnalytics.action.langBeforeUpdate,eventLabel:e})),localStore.removeItem("selectedLanguage"),console.log("selectedLanguage item removed")}function autoDetectBrowserLanguage(){let e=browserLanguage.includes("-")?browserLanguage.split("-")[0].toLowerCase():browserLanguage,t=vueData.languages,i=null;for(let a=0;a<t.length;a++)if(t[a].code===e){i=!0;break}return hasValue(i)?e:"en"}function initVideoAds(){(AIPVideoAds=new VideoAds).init(),adBlocker=AIPVideoAds.isAdBlocking(),function e(t=0){"undefined"!=typeof aiptag&&aiptag.stack?ga("send","event","user_property","aip_stack",aiptag.stack):t<10&&setTimeout((()=>{e(t+1)}),100)}()}function continueStartup(){if(window.mobileAndTabletcheck()){location.protocol,location.host;window.location.href="https://shellshock.io/mobile"}else unsupportedPlatform()||missingImportantBrowserFeatures()||(browserIssues(),loadGlobalResources(afterResourcesLoaded))}function afterResourcesLoaded(){if(console.log("afterResourcesLoaded"),G.ready_meshes=!0,Gamepad.init(),loadSettings(),fetchHouseAds(),console.log("From EU: "+isFromEU),setVolume(),settings.autoDetail||setHighRes(settings.highRes),playOffline)return mapTest.x=parsedUrl.query.x,mapTest.y=parsedUrl.query.y,mapTest.z=parsedUrl.query.z,mapTest.pitch=parsedUrl.query.pitch,mapTest.yaw=parsedUrl.query.yaw,playerLimit=1,ws={send:function(){}},inGame=!0,vueApp.setInGame(inGame),G.engine.stopRenderLoop(),void startGame();paperDoll=new PaperDoll,afterPaperDollReady(),PhotoBooth=new PhotoBoothInstance,pokiInitTracking(),parsedUrl.query.openSettings&&vueApp.showSettingsPopup(),parsedUrl.query.test&&(testing=!0),parsedUrl.query.noSkybox&&(noSkybox=!0),pokiActive&&vueApp.isPlayingPoki(),ready_startup=!0}async function loadAllMeshesOnDemand(){if(fullMeshLoad)return!0;if(await loadAllObjectMeshes())return vueApp.hideSpinner(),!0}function beginSignin(){navigator.onLine&&!playOffline?signIn():(G.playerAccount=new PlayerAccount,ready_auth=!0)}function findNonDefaultItems(){const e=localStore.getItem("localLoadOut");if(!e)return!1;const t=JSON.parse(e),{hatId:i,stampId:a,grenadeId:n,meleeId:s,primaryId:r,secondaryId:o}=t.items;return[i,a,n,s,...r,...o].filter((e=>!catalog.defaultItemIds.includes(e))).length>0}async function loadGlobalResources(e){globalScene=new Scene(G.engine);let t=new TargetCamera("camera",Vector3.Zero(),globalScene);if(globalScene.activeCameras.push(t),Matchmaker.getRegions().then(pingRegions),console.log("loadResources()"),loadMaterials(globalScene),loadMapMeshes(globalScene,(()=>{mapMeshes.push({name:"SPECIAL.spatula.none"}),ready_mapMeshes=!0})),firebaseDone){console.log("Start resource loading");try{await Promise.all([new Promise((e=>{loadSounds((()=>{console.log("Sounds loaded"),e()}))})),new Promise((e=>{const t=hasAccount?"Loading all object meshes":"Loading default object meshes";console.log(t),loadObjectMeshes(globalScene,(()=>{console.log("Object meshes loaded"),fullMeshLoad=hasAccount,e()}),hasAccount)}))]),globalScene.cleanCachedTextureBuffer(),hasAccount&&(stampTexture=new Texture(`img/stamps.webp?v=${version}`,globalScene,!1,!0)),itemRenderer=new ItemRenderer,vueApp.chwRewardIds=[...vueApp.chwRewardIds,...ChwRewardIds],e()}catch(e){console.error("Error during resource loading:",e)}}}function createDynamicStampTexture(e){return new Promise(((t,i)=>{const a=document.createElement("canvas");a.width=4096,a.height=4096;const n=a.getContext("2d"),s=new Image;s.src=e,s.onload=()=>{try{n.clearRect(0,0,a.width,a.height);const e=s.width,i=0;n.drawImage(s,e,i,s.width,s.height);const r=a.toDataURL("image/png");t(r)}catch(e){console.error("Error drawing the stamp image:",e),i(e)}},s.onerror=t=>{console.error("Failed to load stamp image:",e,t),i(t)}}))}async function loadAllObjectMeshes(){return fullMeshLoad?(vueApp.assetSetup(vueApp.ui.homeToGameProgressBar.accountTotal),!0):(console.log("Loading all object meshes..."),fullMeshLoad=!0,await new Promise((e=>{loadItemObjectMeshes(globalScene,(()=>{console.log("All object meshes loaded"),vueApp.assetLoaded(),e()}),fullMeshLoad)})),stampTexture=new Texture("img/stamps.webp?v="+version,globalScene,!1,!0),vueApp.assetLoaded(),paperDoll||(paperDoll=new PaperDoll),paperDoll.setStampTexture(),itemRenderer=new ItemRenderer,vueApp.assetLoaded(),globalScene.cleanCachedTextureBuffer(),console.log("All meshes and ItemRenderer loaded and initialized"),hasPlayBeenPressed||openEquipInGame(),!0)}function afterPaperDollReady(){ready_paperDoll=!0}function allSystemsGo(){return hasValue(vueApp)&&vueApp.ready&&ready_startup&&ready_auth&&ready_paperDoll&&ready_ping}var waitIteration=0;function waitForGameReady(){if(waitIteration>=100)return vueApp.showGenericPopup("uh_oh","error","ok"),void ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.error,vueData.googleAnalytics.label.waitForGameReadyTimeout);allSystemsGo()?afterGameReady():setTimeout(waitForGameReady,200)}function changelogLink(){const e=document.getElementById("changelog-link");e&&e.addEventListener("click",(e=>{e.preventDefault(),vueApp.hideChangelogPopup(),vueApp.showScavengerHuntPopup(),ga("send","event","changelog","clicked","showScavengerHuntPopup")}))}function afterGameReady(){if(playOffline)return;var e=document.getElementById("onesignal-bell-container");e&&(e.style.display="none"),changelogLink(),ga("send","event","ads","ad blocker",adBlocker.toString()),resetPaperDoll(),isRunning=!0,checkGDPRFuckFuckFUCK(),setupPlayerName();[tryJoinGame,accountCreationNotification,tryXsollaPremiumItem,tryPlayerChallengeAutoClaim,trySignInPopup,tryUrlParam,tryShowLinkItem,tryShowTaggedItems,tryShowVipEnded,tryShowNugget,tryOpenXsolla,tryOpenXsollaItem].some((e=>e())),eggOrgLeaderboard.apiGet(),checkForMobileGiveAwayItem(),vueApp.hideSpinner(),Loader2.hide(),e&&(e.style.display="none"),console.log("After Game Ready"),vueApp.shellShockUrlParamaterEvents(),checkNotifications(),ga("send","timing","load","homeLoaded",Math.round(performance.now()),"home"),initVideoAds(),G.productBlockAds||vueApp.showTitleScreenAd(),playerChallenges.resizeAllText(),welcomeBundlePurchased(),productsVueSetup(),startSmallAdRotation(),setupDummyStats(),adsLoaded=!0,fireLoadEvent(!0)}function productsVueSetup(){vueApp.eggStoreItems=shellProducts.getStoreItems(),vueApp.premiumShopItems=shellProducts.getShopItems(),vueApp.subStoreItems=shellProducts.getSubscriptions()}function setupDummyStats(){hasAccount||anonymousUser||(vueApp.statsCurrent=new StatsObj,vueApp.statsLifetime=vueApp.statsCurrent)}function tryPlayerChallengeAutoClaim(){const e=G.playerAccount.challengesHasAutoClaim;if(!e||0===e.length)return!1;const t=e.filter((e=>"claimed"===e.status)).map((e=>{const t=extern.playerChallenges.challengeGet(e.id);return t?.loc_ref&&(e.loc_ref=t.loc_ref),t?.reward&&(e.reward=t.reward),[e.id,e.loc_ref,e.reward]}));return vueApp.showPurchasesPopup([{type:"challenges",data:{items:t}}]),api_checkBalance(),G.playerAccount.challengesHasAutoClaim=[],!0}function tryShowSigninBonus(){return!!G.showSigninBonus&&(vueApp.ui.bonus.showing=!0,vueApp.showPurchasesPopup([{type:"currency",data:{ids:[],items:[],eggs:vueApp.ui.bonus.amount}}]),!0)}function accountCreationNotification(){if(showResendEmailPopup)return showResendEmailPopup=!1,void vueApp.showResendEmail();tryShowSigninBonus()}function mobileRewardSuccess(e){switch(e.result){case"SUCCESS":var t=0;hasValue(e.eggsGiven)&&e.eggsGiven>0&&(t=e.eggsGiven,api_checkBalance());var i=[];hasValue(e.itemIds)&&e.itemIds.length>0&&(i=G.catalog.findItemsByIds(e.itemIds)).forEach((e=>{G.playerAccount.isItemOwned(e)||(G.playerAccount.inventory.push(e),console.log(mobileRewardLog,"item given, id: "+e.id))})),vueApp.showGiveStuffPopup("reward_title",t,i);break;case"REWARD_NOT_FOUND":vueApp.showGenericPopup("uh_oh","reward_not_found","ok");break;default:console.log(mobileRewardLog,"Most likely this has been redeemed or something shitty happened, either way do nothing")}}function mobileRewardError(){console.log(mobileRewardLog,"There was an error")}function checkNotifications(){const{notification:e,factionActivated:t}=G.playerAccount;if(!e||e.read)return void(t&&(vueApp.showFactionActivatedPopup(),G.playerAccount.factionActivated=!1));t&&(vueApp.faction.showPopup=!0,G.playerAccount.factionActivated=!1);const{type:i}=e,a=[];let n=0;const s=()=>{setTimeout((()=>{api_notification_mark_as_read((()=>console.log("Notifications: SUCCESS")),(()=>console.log("Notifications: ERROR")))}),500)},r=(e,t,i,n,s=null)=>{a.push({type:e,data:{items:t,eggs:i,ids:n,product:s}})};Object.entries(i).forEach((([e,t])=>{const i=Array.isArray(t?.ids)?[...new Set(t.ids)]:[],a="number"==typeof t?.eggs?t.eggs:0;let s=null;if("pass"===e||"bundle"===e){const t=getProduct(e,i);s=t&&t.length?t[0]:null}n+=a;const o=i.length>0?G.catalog.findItemsByIds(i):[];(o.length>0||a>0)&&(console.log(`Processing notification type: ${e}`),console.log("Product Data:",s),r(e,o,a,i,s))})),n>0&&r("currency",[1],n,[]),a.length>0&&(console.log("Displaying Popup Data:",a),vueApp.showPurchasesPopup(a,s))}function checkForMobileGiveAwayItem(){return!hasAccount||!!G.playerAccount.isItemOwned({id:16020})&&(vueApp.hasMobileReward=!0,!0)}function xsollaItemPurchaseSuccess(e){console.log("success",e);const t=e.data[0].filter((e=>"item_id"in e))[0];if(t){const e=G.catalog.findItemById(t.item_id);return vueApp.showGiveStuffPopup("p_real_money_item_buy","",[e])}}function setupPlayerName(){var e=getStoredString("lastUsername",generateRandomName());vueApp.setPlayerName(e)}function tryJoinGame(){parsedUrl.hash&&parsedUrl.query.observe?(console.log("TRYING TO JOIN GAME AUTOMATICALLY",parsedUrl.hash),observingGame=!0,watchPlayer=parsedUrl.query.watchPlayer):observingGame=!1;const e="crazyShare"in parsedUrl.query;if(!parsedUrl.hash&&!e)return!1;const t=e?parsedUrl.query.crazyShare:parsedUrl.hash;return vueApp.showJoinPrivateGamePopup(t),!0}function tryOpenXsollaItem(){var e=new URLSearchParams(document.location.search);return!1!==e.has("storeItem")&&(vueApp.showPopupEggStoreSingle(e.get("storeItem")),!0)}function tryShowLinkItem(){var e=new URLSearchParams(document.location.search);if(!1===e.has("showItem"))return!1;var t=parseInt(e.get("showItem"));if(!1===(Number.isInteger(t)&&null!==G.catalog.findItemById(t)&&!1===linkItemShown))return!1;var i=G.catalog.findItemById(t);return vueApp.showItemOnEquipScreen(i),!0}function tryShowTaggedItems(e){return null!==(showTaggedItems=e||showTaggedItems)&&(vueApp.showTaggedItemsOnEquipScreen(showTaggedItems),!0)}function tryShowNugget(){if(null===showNugget||G.playerAccount.isUpgraded())return!1;vueApp.showChicknWinnerPopup(),showNugget=null}function showWelcomeBundle(){vueApp.onWelcomeBundlePopupShow()}function tryOpenXsolla(){var e=new URLSearchParams(document.location.search);if(!e.has("purchase"))return!1;if(G.playerAccount.isAnonymous)return vueApp.showGenericPopup("uh_oh","anon_account","ok"),!1;var t=e.get("purchase");return vueApp.showPopupEggStoreSingle(t),!0}function trySignInPopup(){return!1!==new URLSearchParams(document.location.search).has("signInPrompt")&&(showSignInDialog(),vueApp.$refs.firebaseSignInPopup.show(),!0)}function tryShowBigAd(){if(!(iframeWhitelist(["crazygames","1001juegos","speelspelletjes","onlinegame","poki"])||pokiActive||crazyGamesActive)){var e=getStoredNumber("showBigAd",0);return Date.now()>e&&!swiftShaderCheck()&&(showHouseAdBig(),vueApp.toggleTitleScreenAd(),localStore.setItem("showBigAd",Date.now()+432e5),!0)}console.log("House Ad Blocked")}function tryShowVipEnded(){const{vipSubEnded:e,passEnded:t}=G;if(e||t){const t=e?0:1;return vueApp.vipEndedPopup(t),!0}return!1}function tryXsollaPremiumItem(){var e=new URLSearchParams(document.location.search);if(!e.has("invoice_id")&&!localStore.getItem("xsollaPurchase"))return!1;localStore.removeItem("xsollaPurchase"),window.history.replaceState(null,null,"/"),api_checkAfterStorePurchase(e.get("invoice_id"),(e=>{if("SUCCESS"===e.result&&(e.details.item_id||e.details.amount)){let t=null;if(e.details.item_id){const i=G.catalog.findItemById(e.details.item_id);t=G.playerAccount.isItemOwned(i)?i:null}return t&&vueApp.showItem(t),vueApp.showGiveStuffPopup("give_stuff_twitch_title",e.details.amount,hasValue(t)?[t]:t),!0}return!1}),(e=>!1))}function tryUrlParam(){let e;const t=new URLSearchParams(document.location.search);if(urlRewardParams.forEach((i=>{t.has(i)&&(e=i)})),!hasValue(e))return!1;console.log("tryUrlParam reward",e);let i=Date.now();const a=localStore.getItem(e);if(hasValue(a)){const t=Number(a)+432e6;if(i<t)return console.log(e+" reward already given!"),!1}return api_urlReward(e,(function(t){doRewardsResponse(t,{success(){localStore.setItem(e,i)},prevGiven(){this.success()},expired(){this.succces()},playerNotFound(){vueApp.showGenericPopup("player_not_found_title","player_not_found_desc","ok")},error(){this.playerNotFound()},default(){this.playerNotFound()}})}),(function(){console.log(e,"error")})),!0}function rmItemsLocalStore(){const e=["lastPreRoll","localLoadOut","showBigAd","lastUsername"],t=vueApp?.ui?.socialMedia?.footer;t&&Array.isArray(t)&&t.forEach((t=>e.push(t.reward+"Rewarded"))),e.push(...urlRewardParams),e.forEach((e=>{localStore.getItem(e)&&localStore.removeItem(e)}))}async function getLanguageData(e){try{const t=await fetch(`language/${e}.json?${version}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();return playerChallenges.resizeAllText(),vueApp?.setLocData?.(e,i),i}catch(e){throw console.error("Error loading language data:",e),e}}function getLocText(e){return vueData.loc[e]||"["+e+"]"}function swiftShaderCheck(){if("Google SwiftShader"==G.engine.getGlInfo().renderer&&!localStore.getItem("swiftShaderNotice")){return localStore.setItem("swiftShaderNotice",!0),!0}return!1}function unsupportedPlatform(){return navigator.userAgent.indexOf("Edge")>=0&&(vueApp.showUnsupportedPlatformPopup("unsupported_oldmsedge"),!0)}function missingImportantBrowserFeatures(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var e=[];return Engine.isSupported()||e.push('{0} (<a href="https://shellshock.io/faq.html#webgl" target="_window">{1}</a>)'.format(vueApp.loc.missing_webgl,vueApp.loc.missing_moreinfo)),(!document.exitPointerLock||navigator.userAgent.indexOf("10.1.2 Safari")>=0)&&e.push('{0} (<a href="https://shellshock.io/faq.html#pointerlock" target="_window">{1}</a>)'.format(vueApp.loc.missing_pointerlock,vueApp.loc.missing_moreinfo)),localStore||e.push(vueApp.loc.missing_localstorage),void 0===new KeyboardEvent("").key&&e.push(vueApp.loc.missing_keyboardevent),vueApp.missingFeatures=e,e.length>0&&(vueApp.showMissingFeaturesPopup(),!0)}function browserIssues(){navigator.userAgent.indexOf("Chrome/84")}function getChromeVersion(){const e=navigator.userAgent.match(/Chrome\/(\d+)\./);return e&&e.length>1?parseInt(e[1],10):null}function showConsoleWarning(){consoleWarningTimeout=null;console.log("%cSTOP!","color:red; font-size:60px; font-weight: bold; text-shadow: 0 0 2px black;"),console.log("%cThis is a browser feature intended for developers. If someone told you to copy and paste something here, there is a good chance that they are attempting to gain access to your account and personal information!","font-size: 18px;")}var consoleWarningTimeout=null;function resize(){clearTimeout(consoleWarningTimeout),consoleWarningTimeout=setTimeout((()=>showConsoleWarning()),500),canvas&&(canvas.style.width="100%",canvas.style.height="100%"),G.engine&&(G.engine.resize(),settings&&settings.highRes&&G.engine.setHardwareScalingLevel(settings.highRes)),inGame&&(hitIndicator&&hitIndicator.resize(),hitMarkers&&hitMarkers.resize(),reticle&&reticle.resize())}function enableChat(e){console.log("setting chat: "+e),e?(settings.enableChat=!0,localStore.setItem("enableChat",!0),inGame&&(canChat()?(chatInEl.value=getLocText("ingame_press_enter_to_chat"),chatInEl.style.pointerEvents="auto"):(chatInEl.value=getLocText("ingame_sign_in_to_chat"),chatInEl.style.pointerEvents="none"),chatOutEl.style.display="block",chatInEl.style.display="block")):(settings.enableChat=!1,localStore.setItem("enableChat",!1),inGame&&(chatOutEl.style.display="none",chatInEl.style.display="none"))}function setSafeNames(e){if(inGame){for(var t=0;t<playerLimit;t++){var i=players[t];i&&(i.name=e?i.safeName:i.Kb,i.wb.setupNameSprite())}rebuildPlayerList()}}function enableAutoDetail(){optimizer&&interval.clear(optimizer),console.log("Auto detail enabled"),optimizer=interval.set((()=>{fpsTotal/fpsSamples<40&&G.engine.getFps()<40&&(gameScene.shadowsEnabled?(setShadows(!1),settings.shadows=!1):(setHighRes(!1),settings.highRes=!1,disableAutoDetail()),saveSettings())}),4e3)}function disableAutoDetail(){optimizer&&(interval.clear(optimizer),optimizer=null)}function setHighRes(e){console.log("setting high resolution: "+e),G.engine.setHardwareScalingLevel(e?1:2),adaptToNewResolution()}function setShadows(e){console.log("setting shadows: "+e),gameScene.shadowsEnabled=e}function adaptToNewResolution(){reticle&&reticle.resize(),hitIndicator&&hitIndicator.resize(),hitMarkers&&hitMarkers.resize(),scope&&scope.Xx.isEnabled()&&scope.show()}function nukeCacheAndReload(){var e=window.indexedDB.deleteDatabase("babylonjs");e.onerror=function(e){nukeReload()},e.onsuccess=function(e){nukeReload()}}function nukeReload(){localStore.setItem("lastVersionPlayed",version),window.location.reload(!0)}function settingsMenuOpened(){inGame&&1==settings.enableChat&&initChatIn()}function toggleFullscreen(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement){(e=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen)&&e.call(document)}else{var e,t=document.documentElement;(e=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen)&&e.call(t)}}function onFullscreenChange(){G.engine.resize()}function PlayerReward(e,t,i){this.tag=e,this.openUrl=t,this.openUrlMsg=i,this.wasUrlOpened=null}function changeClass(e){G.playerAccount.setClass(e),vueData.selectedWeaponDisabled=GameOptions.isSelectedWeaponDisabled(e)}function saveEquipment(e){G.playerAccount.syncToServer(e)}function disablePlay(e){hasPlayBeenPressed=e,vueApp.disablePlayButton(e)}function play(e){if(!hasPlayBeenPressed){if(stopSmallAdRotate(),disablePlay(!0),paperDoll.scale(),hasAccount&&(timesPlayed=getSetIncrementStoredNum("timesPlayed",1)),!G.productBlockAds){var t=getStoredNumber("lastPreRoll",0),i=!1;if(0==t&&(t=Date.now(),localStore.setItem("lastPreRoll",t)),(hasTimesPlayed||timesPlayed>1)&&(i=!0),adTest||Date.now()>t+24e4&&i)return console.log("play() calls PVA"),AIPVideoAds.play("shellshock.io_preroll",(()=>playAfterVideoAd(e))),void vueApp.hideHomeScreenAds(!0)}playAfterVideoAd(e)}}async function playAfterVideoAd(e){if(console.log("play(): "+JSON.stringify(e)),vueApp.setDarkOverlay(!1),!hasAccount)return console.log("Create account now."),tutorialShowing=!0,vueApp.onTutorialPopupClick(),ga("send","event","tutorial","newUserPopup"),vueApp.assetSetup(vueApp.ui.homeToGameProgressBar.nonAccountTotal),void createAnonAccountTrigger(e);eggOrgLeaderboard.cancelRefresh();await loadAllObjectMeshes()?(hasValue(e.playerName)&&0!==e.playerName.length&&!/^ *$/.test(e.playerName)||(e.playerName=generateRandomName(),vueApp.setPlayerName(e.playerName)),localStore.setItem("lastUsername",e.playerName),e.playType===vueApp.playTypes.joinPrivate?Matchmaker.joinPrivateGame(e).then((t=>{isPrivateGame=t.private,e.subdomain=t.subdomain,e.id=t.id,gameCode=t.id,e.uuid=t.uuid,vueApp.currentRegionId=t.region,prepareToJoinGame(e)})).catch((e=>handleCloseCode(e))):Matchmaker.findGame(e).then((t=>{isPrivateGame=t.private,e.subdomain=t.subdomain,e.id=t.id,gameCode=t.id,e.uuid=t.uuid,vueApp.currentRegionId=t.region,prepareToJoinGame(e)})).catch((e=>{Matchmaker.getRegions().then((()=>pingRegions())),handleCloseCode(e)}))):console.log("all mesh load error")}function prepareToJoinGame(e){console.log("prepareToJoinGame",e),document.body.scrollTop=document.documentElement.scrollTop=0,timerPlayStart=performance.now(),joinGame(e)}function getGameHostname(e){let t=dynamicContentRoot||window.location.hostname;return t=t.split("."),t.length>2&&(t=t.slice(-2)),t=t.join("."),`${e}.${t}`}document.onfullscreenchange=onFullscreenChange,document.onmsfullscreenchange=onFullscreenChange,document.onmozfullscreenchange=onFullscreenChange,document.onwebkitfullscreenchange=onFullscreenChange;var joinResult=null;function joinGame(e){vueApp.mediaTabsCancelRotate(),getChwChick(1),joinResult=null,e.playerName=fixStringWidth(e.playerName,80),autoInvite=!1,e.playType===vueApp.playTypes.createPrivate?autoInvite=!0:(e.playType,vueApp.playTypes.joinPrivate),joinType=e.playType;let t=0;!function i(){let a=(isHttps()?"wss":"ws")+"://"+getGameHostname(e.subdomain)+"/game/"+e.id;console.log("Connecting to: "+a),(ws=new WebSocket(a)).binaryType="arraybuffer",ws.onopen=function(e){console.log("WebSocket opened")},ws.onclose=function(e){e.code===CloseCode.sessionNotFound?(console.log(`Connect attempt #${t} - code: ${e.code}`),++t>10?handleCloseCode(e.code):setTimeout(i,1e3)):handleCloseCode(e.code)},ws.onmessage=function(t){switch(KPwUxH.init(t.data),KPwUxH.unPackInt8U()){case BkKPwUww.N:ga("send","event","play game","class",G.classes[G.playerAccount.classIdx].name);const t=getStoredBool("hideBadge",0)?1:0;gaSendPlayerEquipData();var i=kKPwUxS.getBuffer();observingGame?i.BkKPwUxd(BkKPwUww.G):i.BkKPwUxd(BkKPwUww.P),i.AABkKPwUyt(e.playerName),i.AABkKPwUyt(e.uuid),i.BkKPwUxd(t),i.BkKPwUxd(G.playerAccount.classIdx),G.playerAccount.firebaseId&&(i.ABkKPwUyL(G.playerAccount.session),i.AABkKPwUyt(G.playerAccount.firebaseId),i.AABkKPwUyt(G.playerAccount.sessionId)),i.send(ws);break;case BkKPwUww.Sc:var a=KPwUxH.unPackLongString();checkMusicChange(a);break;case BkKPwUww.v:console.log("BkKPwUww.gameJoined_ received"),meId=KPwUxH.unPackInt8U(),myTeam=KPwUxH.unPackInt8U(),gameType=KPwUxH.unPackInt8U(),mapIdx=KPwUxH.unPackInt8U(),playerLimit=KPwUxH.unPackInt8U(),isGameOwner=1==KPwUxH.unPackInt8U(),isPrivateGame=1==KPwUxH.unPackInt8U();KPwUxH.unPackInt8U();let n=MetaGames[gameType];metaGame=new n.logic,metaGameUI=new n.ui,resetGameUI(),updateTeamUI(),isTeamGame=gameType==GameType.teams||gameType==GameType.ctf,console.log("game joined: game type:  "+gameType),vueApp.gameJoined(gameType,myTeam),console.log("is game owner: "+isGameOwner),inGame=!0,vueApp.setInGame(inGame);const s=vueData.gameTypes.find((({value:e})=>e===gameType));joinedAs=e.playType===vueApp.playTypes.createPrivate?"createPrivate":isPrivateGame?"joinPrivate":""!==e.joinCode?"joinPublicByInvite":"joinPublic",SessionStats=new sessionStats,sessionStatsSent=!1,ga("send","event",vueData.googleAnalytics.cat.play,joinedAs,`Map - ${maps[mapIdx].name}`),ga("send","event",vueData.googleAnalytics.cat.play,joinedAs,`Game type - ${s.locKey}`),ga("send","event",vueData.googleAnalytics.cat.play,joinedAs,vueData.googleAnalytics.action.playerLimit,playerLimit),ga("send","event",vueData.googleAnalytics.cat.play,joinedAs,vueData.googleAnalytics.action.timesPlayed,timesPlayed),startGame();break;case BkKPwUww.F:sendGameOptions()}}}()}function getChwChick(e){const t=document.getElementById("chw-home"),i=document.getElementById("chw-game-screen"),a=document.getElementById("chw-home-timer");1===e?i.appendChild(a):t.appendChild(a)}function sendGameOptions(){GameOptions.serialize().send(ws)}function sendGameOptionsMetrics(){Object.keys(GameOptions.value).forEach((e=>{switch(e){case"flags":Object.keys(GameFlags).forEach((e=>{let t=GameOptions.value.flags&GameFlags[e]?1:0;ga("send","event","game settings","flags",e,t)}));break;case"weaponDisabled":for(let e=0;e<G.classes.length;e++){if(GameOptions.value.weaponDisabled[e]){let t=G.classes[e].name;ga("send","event","game settings","weapon disabled",t)}}break;default:let t=GameOptions.value[e];ga("send","event","game settings","setting",e,t)}}))}function sendGameAction(e){let t=kKPwUxS.getBuffer();t.BkKPwUxd(BkKPwUww.H),t.BkKPwUxd(e),t.send(ws);let i=Object.keys(GameActions).find((t=>GameActions[t]===e));ga("send","event","game settings","action",i)}function handleCloseCode(e){if(disablePlay(!1),vueApp.mediaTabsStartRotate(),freezeFrame)return;let t=!1;switch(Object.keys(CloseCode).forEach((i=>{CloseCode[i]===e&&(console.log("Socket Closed: "+i),t=!0)})),t||console.log("Socket Closed: "+e),e){case CloseCode.locked:console.log("Game locked"),ga("send","event","Websocket","onclose","Game locked"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_locked","game_locked_msg","ok");break;case CloseCode.uuidNotFound:console.log("UUID invalid"),ga("send","event","Websocket","onclose","UUID not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect","session_expired_msg","ok");break;case CloseCode.sessionNotFound:console.log("Session not found"),ga("send","event","Websocket","onclose","Session not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect","session_expired_msg","ok");break;case CloseCode.gameNotFound:console.log("Game not found"),ga("send","event","Websocket","onclose","Game not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_not_found","game_not_found_msg","ok");break;case CloseCode.gameFull:case CloseCode.gameMaxPlayersExceeded:console.log("Game full"),ga("send","event","Websocket","onclose","Game full"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_full","game_full_msg","ok");break;case CloseCode.mainMenu:ga("send","event","Websocket","onclose","Return to main menu");break;case CloseCode.regionFull:ga("send","event","Websocket","onclose","Region full"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case CloseCode.clusterFullCpu:ga("send","event","Websocket","onclose","Game Cluster max CPU"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case CloseCode.clusterFullMem:ga("send","event","Websocket","onclose","Game Cluster max RAM"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case CloseCode.booted:inGame?vueApp.leaveGame():vueApp.hideSpinner(),vueApp.showGenericPopup("connection_lost","booted","ok");break;case CloseCode.gameIdleExceeded:vueApp.leaveGame(),vueApp.showGenericPopup("connection_lost","inactivity","ok");break;default:if(inGame)ga("send","event","Websocket","onclose","Connection Lost"),vueApp.leaveGame(),vueApp.showGenericPopup("connection_lost","connection_lost_msg","ok");else{var i="";if(joinResult===BkKPwUww.V)i="login_required";else i="generic_conn_failed";vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect",i,"ok")}}}var interval={intervals:{},set:function(e,t){var i=setInterval.apply(window,[e,t].concat([].slice.call(arguments,2)));return interval.intervals[i]=!0,i},clear:function(e){return delete interval.intervals[e],clearInterval(e)},clearAll:function(){for(var e=Object.keys(interval.intervals),t=e.length;t-- >0;)clearInterval(e.shift());interval.intervals={}}},timeout={timeouts:{},set:function(e,t){var i=setTimeout.apply(window,[e,t].concat([].slice.call(arguments,2)));return timeout.timeouts[i]=!0,i},clear:function(e){return delete timeout.timeouts[e],clearTimeout(e)},clearAll:function(){for(var e=Object.keys(timeout.timeouts),t=e.length;t-- >0;)clearTimeout(e.shift());timeout.timeouts={}}};function leaveGame(e){G.engine&&G.engine.stopRenderLoop(),apiGetEggOrgLeaderBoard(),meId=0,viewingPlayerId=0,vueApp.resetGameOptions(),inGame?(me&&(G.playerAccount.kills+=kills,G.playerAccount.deaths+=deaths,G.playerAccount.streak=Math.max(bestOverallStreak,G.playerAccount.streak),SessionStats.streak=bestOverallStreak),interval.clearAll(),timeout.clearAll(),clearInterval(logicInterval),ws.close(CloseCode.mainMenu),ws=null,releaseKeys(),document.exitPointerLock(),gameStartTime>0&&(gaSessionPlayTime(gameStartTime,maps[mapIdx].name),SessionStats.end(),gaSendPlayerStats(),gaSendGameStats(),gaSessionStats()),gameScene.dispose(),inGame=!1,vueApp.setInGame(inGame),pingRegions(),paperDoll=new PaperDoll,e(),clearPokiRewardTimer(),vueApp.hideRespawnDisplayAd(),playPressed=!1,preLoadHouseAdSmall(),startSmallAdRotation(),eggOrgLeaderboard.apiGet(),RewardNoobGrenade.tryReward()):vueApp.switchToHomeUi(),crazySdk.hideInviteButton(),getChwChick(),updateStats()}var sessionStatsSent=!1;function gaSessionStats(){if(sessionStatsSent)return;sessionStatsSent=!0;const e=getSessionStats();if(0===Object.keys(e).length)return;if(e.kills&&ga("send","event","player stats","game_stats","total_kills",e.kills),e.deaths&&ga("send","event","player stats","game_stats","total_deaths",e.deaths),!e.hasOwnProperty("charClass"))return;const t=Object.keys(e.charClass);0!==t.length&&t.forEach((t=>{const i="Ranger"===t?"Free Ranger":t;(e.charClass[t].kills||e.charClass[t].deaths)&&(ga("send","event","player stats","kills",i,e.charClass[t].kills),ga("send","event","player stats","deaths",i,e.charClass[t].deaths),ga("send","event","player stats","kill ratio",i,Math.floor(e.charClass[t].kills/Math.max(e.charClass[t].kills+e.charClass[t].deaths,1)*100)))}))}function gaSendPlayerStats(e){if(me&&(SessionStats.kills>0||SessionStats.deaths>0)){const t="player stats",i=G.classes[me.charClass].name;0===SessionStats.kills&&SessionStats.deaths>0?ga("send","event",t,"rageQuit",i,SessionStats.deaths):ga("send","event",t,"best kill streak",i,bestOverallStreak),e&&e()}}function gaSendGameStats(){pingSamples>10&&(ga("send","timing","game","ping",Math.floor(pingTotal/pingSamples),vueData.currentRegionId),ga("send","event","game","stats","fps",Math.ceil(fpsTotal/fpsSamples)))}function calculateKDR(){return Math.floor(G.playerAccount.kills/Math.max(G.playerAccount.deaths,1)*100)/100}function reloadPage(){window.location.reload()}function getFloatingNameWidth(e,t){var i=nameTestCanvas.getContext("2d");return i.font="bold "+t+"px Nunito, sans-serif",i.measureText(e).width}function fixStringWidth(e,t){t=t||80;var i=nameTestCanvas.getContext("2d");for(i.font="1em Nunito, sans-serif";;){if(i.measureText(e).width<t)break;e=e.substr(0,e.length-1)}return e}var excludedUnicodeBlocks=[{start:688,end:7679},{start:7936,end:11359},{start:11392,end:11903},{start:12032,end:12255},{start:12272,end:12287},{start:12352,end:12735},{start:12784,end:12799},{start:19904,end:19967},{start:40960,end:42783},{start:43008,end:43823},{start:43888,end:63743},{start:64256,end:65071},{start:65104,end:65535}];function filterUnicode(e){let t="";for(let i of e){let e=i.codePointAt(0),a=!0;if(e>65535||21325==e||21328==e)a=!1;else for(let t of excludedUnicodeBlocks)if(e>=t.start&&e<=t.end){a=!1;break}a&&(t+=i)}return t}function selectGameType(e){gameType=e,localStore.setItem("gameType",e)}var _0xb450=["dGV4dENvbnRlbnQ=","b2JzZXJ2ZQ==","TXV0YXRpb25PYnNlcnZlcg==","bGVuZ3Ro","dGFyZ2V0","b3V0ZXJUZXh0"],_0x5d6d77,_0x563dcd;_0x5d6d77=_0xb450,_0x563dcd=458,function(e){for(;--e;)_0x5d6d77.push(_0x5d6d77.shift())}(++_0x563dcd);var _0x13dc=function(e,t){var i,a=_0xb450[e-=0];void 0===_0x13dc.IFPkJC&&((i=function(){var e;try{e=Function('return (function() {}.constructor("return this")( ));')()}catch(t){e=window}return e}()).atob||(i.atob=function(e){for(var t,i,a=String(e).replace(/=+$/,""),n="",s=0,r=0;i=a.charAt(r++);~i&&(t=s%4?64*t+i:i,s++%4)?n+=String.fromCharCode(255&t>>(-2*s&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return n}),_0x13dc.vaQvzy=function(e){for(var t=atob(e),i=[],a=0,n=t.length;a<n;a++)i+="%"+("00"+t.charCodeAt(a).toString(16)).slice(-2);return decodeURIComponent(i)},_0x13dc.QEYrQv={},_0x13dc.IFPkJC=!0);var n=_0x13dc.QEYrQv[e];return void 0===n?(a=_0x13dc.vaQvzy(a),_0x13dc.QEYrQv[e]=a):a=n,a},uuid=0,observer2=new(window[_0x13dc("0x0")])((e=>{for(var t=0;t<e[_0x13dc("0x1")];t++){var i=e[t];(i[_0x13dc("0x2")][_0x13dc("0x3")][_0x13dc("0x1")]>3e6||i.target[_0x13dc("0x4")].length>3e6)&&(uuid=255)}}));function socialReward(e){const t=e+"Rewarded";if(socialRewardClick[t]>=1)return void localStore.setItem(t,!0);socialRewardClick[t]++;vueApp.showSpinner();const i={};i.tag=Reward[e],api_reward(i,(function(e){vueApp.hideSpinner();doRewardsResponse(e,{name:"Social media reward",success(){localStore.setItem(t,!0)},prevGiven(){this.success()},expired(){this.succces()},notFound(){localStore.setItem(t,!1)},playerNotFound(){localStore.getItem(t)&&localStore.removeItem(t)},error(){this.playerNotFound()},default(){this.playerNotFound()}})}),(function(e){console.log("servicesWs Error: "+JSON.stringify(e,["message","arguments","type","name"])),vueApp.showGenericPopup("uh_oh","generic_conn_failed","ok"),vueApp.hideSpinner()}))}function doRewardsResponse(e,t,i,a){let n=i||"reward_title";if(hasValue(t.name)||(t.name="Game reward"),e.error)console.log(t.name+" Error: "+JSON.stringify(e.error));else switch(console.log(t.name+" response: "+e.result),e.result){case"SUCCESS":void 0!==t.success&&t.success();var s=0;hasValue(e.eggsGiven)&&e.eggsGiven>0&&(s=e.eggsGiven,api_checkBalance());var r=[];hasValue(e.itemIds)&&e.itemIds.length>0&&(r=G.catalog.findItemsByIds(e.itemIds)).forEach((e=>{G.playerAccount.isItemOwned(e)||(G.playerAccount.inventory.push(e),console.log(t.name+" Reward item given, id: "+e.id))})),vueApp.showGiveStuffPopup(n,s,r,i);break;case"REWARD_PREV_GIVEN":void 0!==t.prevGiven&&t.prevGiven(),vueApp.showGenericPopup("uh_oh","reward_already","ok");break;case"REWARD_EXPIRED":void 0!==t.expired&&t.expired(),vueApp.showGenericPopup("uh_oh","reward_expired","ok");break;case"REWARD_NOT_FOUND":case"URL_PARAM_NOT_FOUND":void 0!==t.notFound&&t.notFound(),vueApp.showGenericPopup("uh_oh","reward_not_found","ok");break;case"PLAYER_NOT_FOUND":void 0!==t.playerNotFound&&t.playerNotFound();break;case"ERROR":void 0!==t.error&&t.error(),console.log(t.name+" error: "+e.error),vueApp.showGenericPopup("uh_oh","error","ok");break;default:void 0!==t.default&&t.default(),vueApp.showGenericPopup("uh_oh","error","ok")}}function gaSendPlayGameData(e,t){return ga("send","event","play game",e,t)}function gaSendPlayerEquipData(){gaSendPlayGameData("primaryGun",G.playerAccount.getPrimaryWeapon().name),gaSendPlayGameData("SecondaryGun",G.playerAccount.getSecondaryWeapon().name),"undefined"!=typeof EGGCOLOR&&gaSendPlayGameData("eggColor",Object.keys(EGGCOLOR).find((e=>EGGCOLOR[e]===G.playerAccount.colorIdx))),null!==G.playerAccount.hatItem&&gaSendPlayGameData("hat",G.playerAccount.hatItem.name),null!==G.playerAccount.stampItem&&gaSendPlayGameData("stamp",G.playerAccount.stampItem.name),null!==G.playerAccount.grenadeItem&&G.playerAccount.grenadeItem.hasOwnProperty("name")&&gaSendPlayGameData("grenade",G.playerAccount.grenadeItem.name)}observer2[_0x13dc("0x5")](document,{childList:!0,subtree:!0});var theTimeTracker=(e,t,i)=>{const a=new Date-e;if(Number.isInteger(a)||a)return ga("send","timing",vueData.googleAnalytics.cat.playerStats,t,a,i)},isShellIframe=()=>window.self===window.top,iframeParent=()=>{const e=window.location!=window.parent.location?document.referrer:document.location.href,t=new URL(e).hostname.replace(/(www.)/,"").split(".");if(!Array.isArray(t)&&!t.length)return!1;return{domain:t,index:t.length-2}},iframeWhitelist=e=>{if(isShellIframe())return;const t=iframeParent(),i=t.domain,a=t.index;return e.includes(i[a])||e.includes(i[a-1])},playShellshockers=()=>{if(isShellIframe())return console.log("Not playing in iframe"),!0;console.log("Playing in iframe");const e=iframeParent();e.domain,e.index;return!0};function updateStats(){api_updatePlayerStats((function(e){e&&(G.playerAccount.setStats(e.statsLifetime,e.statsCurrent),G.playerAccount.eggsSpent=e.eggsSpent,G.playerAccount.eggsSpentMonthly=e.eggsSpentMonthly),vueApp.statsLoading()}),(function(e){console.log("Player stats error",e),vueApp.statsLoading()}))}function giveItemReward(e,t,i,a){G.playerAccount.isItemOwned({id:e})?console.log(t,"already owned!!!"):api_giveItemReward(t,(e=>{doRewardsResponse(e,{name:t,success:()=>(i&&i(),!0),error:()=>(a&&a(),!1)},t)}),(e=>{console.log(t," error",e)}))}function giveBasketBrosReward(){giveItemReward(16039,"giveBasketBrosReward")}function tryGiveEggOrgReward(){return!!firebaseUser&&giveItemReward(2540,"eggOrgReward")}function getUiGaugeData(){api_getUiGaugeData((e=>vueApp.setUiGaugeMeterData(e)),(e=>{console.log("Ui gauge data error",e)}));setTimeout((()=>{getUiGaugeData()}),6e5)}function getSessionStats(){return SessionStats?SessionStats.getStats():{}}function openPhotoBooth(){vueApp.openPhotoBooth()}function getProductTitle(e,t){return shellProducts.getProductByItemIds(["bundles","passes"][t],e)}function getProduct(e,t){return shellProducts.getProductByItemIds(e,t)}function getProductTitleByEggVaule(e){return shellProducts.getProductTitleByEggVaule(e)}function getActiveBundles(){return shellProducts.getBundles()}function rotateSmallHouseAd(){smallAdRotateInterval&&clearInterval(smallAdRotateInterval),smallAdRotateInterval=setInterval((()=>{preLoadHouseAdSmall()}),5e3)}function stopSmallAdRotate(){smallAdRotateInterval&&(clearInterval(smallAdRotateInterval),smallAdRotateInterval=null)}function startSmallAdRotation(){inGame||playPressed?smallAdRotateTimeout&&(clearTimeout(smallAdRotateTimeout),smallAdRotateTimeout=null):(smallAdRotateTimeout&&clearTimeout(smallAdRotateTimeout),smallAdRotateTimeout=setTimeout((()=>{rotateSmallHouseAd()}),4e3))}async function fetchProxyList(){try{const e=await fetch("/unblocked/json/proxy-list.json");if(!e.ok)throw new Error("Network response was not ok "+e.statusText);return await e.json()}catch(e){console.error("Fetch error:",e)}}async function abTestRedirectCheck(){const e=new URL(window.location.href).host;if(!AbUrlTestParam&&(e.includes("shellshock")||e.includes("crazygames")))return;const t=await fetchProxyList();AbFreeGamesRedirect.aBParamCheck=!!AbUrlTestParam||t.includes(e),AbFreeGamesRedirect.aBParamCheck&&("a"!==AbFreeGamesRedirect.getCookie("shell_ab_variant")||abTestRedirect())}function abTestRedirect(){window.location.href="https://freegames.io/game/shell-shockers?utm_source=ssforward&utm_medium=referral&utm_campaign=proxy"}function playerChallengeReroll(e,t,i){api_reroll_challenge_slot(e,t,i)}function chwResetWithEggs(){apiResetChw((e=>{const t=e.result;console.log("chwResetWithEggs: ",t),"SUCCESS"===t&&(checkStartChicknWinner(),vueApp.chwHomeForceReset(),BAWK.play("ui_playconfirm")),api_checkBalance()}),(e=>{console.error("chwResetWithEggs error: ",e.error)}))}function welcomeBundlePurchased(){const e=G.catalog.findItemById(welcomePassItemId);isWelcomeBundlePurchased=!!e&&G.playerAccount.isItemOwned(e)}function eggOrgUpdateVueLeaderboard(e){vueApp.eggOrgUpdateGlobalLeaderBoards(e)}var Gamepad=class e{static detectControllerType(e){/xbox|xinput/i.test(e)?vueData.controllerType="xbox":/54c/i.test(e)?vueData.controllerType="ps":/pro controller/i.test(e)?vueData.controllerType="switchpro":vueData.controllerType="generic",vueData.controllerId=e,localStore.setItem("controllerId",e)}static onButtonUp(e){me&&inputUp("gamepad",e.detail)}static calculateAssist(){if(!me||!me.Rb)return 1;var t=e.Wb,i=e.qb,a=camera.forwardRay.origin,n=camera.forwardRay.direction,s=null,r=null,o=1e7;for(var l of players)if(l&&l.id!=meId&&l.Rb&&l.wb&&l.wb.Xb.isVisible&&(0==l.team||l.team!=me.team)){var c=Vector3.Distance(l.wb.Xb.position,a);t.copyFrom(l.wb.Xb.position),t.y+=.3,t.subtractToRef(a,i),i.normalize(),n.normalize();var h=(1-Vector3.Dot(i,n))*c*.5;c<camera.forwardRay.range+1&&h<=.05&&c<o&&(s=l,o=c,r=h)}return s?Math.max(20*r,.2):1}static poll(){var t=e.getGamepads()[e.index];if(t){if(me&&me.Rb&&document.pointerLockElement||spectate){var i=e.calculateAssist(),a=.0025*settings.controllerSpeed+.005;me.scope&&(a*=.2,i*=2);var n=e.applyDeadZone(t.axes[2]),s=e.applyDeadZone(t.axes[3]);Math.length2(n,s);a*=i,me.pb=Math.radAdd(me.pb,-n*a),me.Jb=Math.max(Math.min(me.Jb-s*settings.controllerInvert*a,1.5),-1.5);var r=e.applyDeadZone(t.axes[0]),o=e.applyDeadZone(t.axes[1]);r<0&&e.lastMoveX>=0?handleInputDown("left"):r>=0&&e.lastMoveX<0&&handleInputUp("left"),r>0&&e.lastMoveX<=0?handleInputDown("right"):r<=0&&e.lastMoveX>0&&handleInputUp("right"),o<0&&e.lastMoveZ>=0?handleInputDown("up"):o>=0&&e.lastMoveZ<0&&handleInputUp("up"),o>0&&e.lastMoveZ<=0?handleInputDown("down"):o<=0&&e.lastMoveZ>0&&handleInputUp("down"),e.lastMoveX=r,e.lastMoveZ=o}for(var l in t.buttons)t.buttons[l].value>e.buttonThreshold&&!e.buttonState[l]?(e.buttonState[l]=!0,dispatchEvent(new CustomEvent("gamepadbuttondown",{detail:l}))):t.buttons[l].value<=e.buttonThreshold&&e.buttonState[l]&&(e.buttonState[l]=!1,dispatchEvent(new CustomEvent("gamepadbuttonup",{detail:l})))}e.pollLoop=requestAnimationFrame(e.poll)}static onButtonDown(e){me&&inputDown("gamepad",e.detail)}static init(){this.getGamepads=(navigator.getGamepads||navigator.webkitGetGamepads).bind(navigator),this.getGamepads?(this.index=null,this.buttonThreshold=.1,this.assist=1,e.detectControllerType(getStoredString("controllerId",getLocText("p_settings_nocontroller"))),addEventListener("gamepadconnected",(t=>{this.buttonState=[],this.lastMoveX=0,this.lastMoveZ=0,this.index=t.gamepad.index;var i=navigator.getGamepads()[t.gamepad.index];console.log("Gamepad connected at index: "+i.index+": "+i.id+". It has "+i.buttons.length+" buttons and "+i.axes.length+" axes."),ga("send","event","game","settings","controller connected",i.id),addEventListener("gamepadbuttondown",this.onButtonDown),addEventListener("gamepadbuttonup",this.onButtonUp),e.detectControllerType(i.id),this.poll(),this.assistInterval=setInterval(e.calculateAssist,67)})),addEventListener("gamepaddisconnected",(t=>{t.gamepad.index==this.index&&(cancelAnimationFrame(this.pollLoop),clearInterval(this.assistInterval),this.index=null,removeEventListener("gamepadbuttondown",this.onButtonDown),removeEventListener("gamepadbuttonup",this.onButtonUp),console.log("Gamepad disconnected"),e.detectControllerType(getLocText("p_settings_nocontroller")))}))):console.log("Gamepad API not detected")}static applyDeadZone(e){if(isNaN(e))return 0;var t=settings.deadzone,i=(Math.abs(e)-t)/(1-t);return i<0&&(i=0),i*(e>0?1:-1)}};Gamepad.Wb=new Vector3,Gamepad.qb=new Vector3;var checkGDPRFuckFuckFUCKCount=0,i2,s,o,r,a,m;function checkGDPRFuckFuckFUCK(){isFromEU&&(checkGDPRFuckFuckFUCKCount>8||("undefined"!=typeof googletag?((consent=localStore.getItem("consent"))?(consent=JSON.parse(consent),googletag.consented=consent&&consent.ofAge&&consent.targetedAds||!isFromEU,vueApp.setPrivacySettings(consent.ofAge,consent.targetedAds)):(consent={ofAge:!1,targetedAds:!1},vueApp.showGdprNotification()),console.log("AIP consent: "+googletag.consented)):setTimeout((()=>{checkGDPRFuckFuckFUCKCount++,checkGDPRFuckFuckFUCK()}),1e3)))}function doConsent(){ga("send","event","privacy","age gate","agree"),consent={ofAge:!0,targetedAds:!0},googletag.consented=!0,vueApp.setPrivacySettings(!0,!0),localStore.setItem("consent",JSON.stringify(consent))}function doNotConsent(){ga("send","event","privacy","age gate","disagree"),googletag.consented=!1,vueApp.setPrivacySettings(!1,!1),localStore.setItem("consent",JSON.stringify(consent))}function setOfAge(e){consent.ofAge=e,ga("send","event","privacy","of age",e?"yes":"no"),e||(consent.targetedAds=!1,googletag.consented=!1),localStore.setItem("consent",JSON.stringify(consent))}function setTargetedAds(e){consent.targetedAds=e,googletag.consented=e,ga("send","event","privacy","targetedAds",e?"yes":"no"),localStore.setItem("consent",JSON.stringify(consent))}i2=window,s=document,o="script",r="ga",i2.GoogleAnalyticsObject=r,i2[r]=i2[r]||function(){(i2[r].q=i2[r].q||[]).push(arguments)},i2[r].l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src="https://www.google-analytics.com/analytics.js",m.parentNode.insertBefore(a,m),a.onload=function(){window.ga&&ga.create&&(oldga=window.ga,window.ga=newga)};var oldga=window.ga,newga=function(){switch(oldga.apply(window,arguments),arguments[0]){case"create":break;case"set":var e=arguments[2],t={};t[arguments[1]]=e,gtag("set","user_properties",t);break;case"send":var i={hitType:arguments[1]};switch(i.hitType){case"pageview":gtag("pageview",{page_location:location.href});break;case"event":"object"==typeof arguments[2]?i=Object.assign(i,arguments[2]):(i.eventCategory=arguments[2],i.eventAction=arguments[3],i.eventLabel=arguments[4],i.eventValue=arguments[5],"object"==typeof arguments[6]&&(i=Object.assign(i,arguments[6]))),gtag("event",i.eventAction,i);break;case"timing":i.timingCategory=arguments[2],i.timingVar=arguments[3],i.timingValue=arguments[4],i.timingLabel=arguments[5],gtag("event","timing_complete",i)}}};window.ga=newga,ga("set","anonymizeIp",!isFromEU),ga("create","UA-105800112-1",{cookieDomain:"auto",siteSpeedSampleRate:10,cookieFlags:"samesite=none;secure"}),ga("send","pageview"),ga("set","account","web");var gaSendEvents=(e,t)=>{t=t||"event",e.forEach((e=>{ga("send",t,{eventCategory:e[0],eventAction:e[1],eventLabel:e[2],eventValue:e[3]})}))},gaSessionPlayTime=(e,t)=>{t=t||"";let i=Date.now()-e;ga("send","timing","game","play time",i),fbq("trackCustom","EndGame",{timePlayed:i}),t&&ga("send","timing","Maps",t,i)},flashColors=[new Color3(1,1,0),new Color3(0,.5,1),new Color3(1,0,0)];function GrenadeActor(e){this.grenade=e,this.scene=e.scene,this.meshes={};for(let e=0;e<G.catalog.grenades.length;e++){let t=G.catalog.grenades[e],i=cloneMesh(t.item_data.meshName,this.scene);i.material=this.scene.getMaterialByName("emissive"),i.emissiveColor=new Color3(0,0,0),this.meshes[t.id]=i,i.setEnabled(!1)}this.Xb=null,this.beep=!1,this.flashColor=null}GrenadeActor.prototype.dispose=function(){for(let e of Object.values(this.meshes))e.dispose()},GrenadeActor.prototype.throw=function(){this.Xb=this.meshes[this.grenade.Zb.grenadeItem.id],this.Xb.setEnabled(!0),this.Xb.position.x=this.grenade.x,this.Xb.position.y=this.grenade.y,this.Xb.position.z=this.grenade.z,this.grenade.Zb.id==meId?this.flashColor=flashColors[0]:this.flashColor=flashColors[this.grenade.Zb.team],pAudio.play("grenade_pin",this.Xb.position),this.bounce()},GrenadeActor.prototype.update=function(e){this.grenade.resting||(this.Xb.position.x+=.5*(this.grenade.x-this.Xb.position.x),this.Xb.position.y+=.5*(this.grenade.y-this.Xb.position.y),this.Xb.position.z+=.5*(this.grenade.z-this.Xb.position.z),this.Xb.rotation.x+=this.rx,this.Xb.rotation.y+=this.ry,this.Xb.rotation.z+=this.rz),Math.sqrt(2*this.grenade.ttl)%2>1?(0==this.beep&&(pAudio.play("grenade_beep",this.Xb.position),this.beep=!0),this.Xb.emissiveColor.set(this.flashColor.r,this.flashColor.g,this.flashColor.b)):(this.Xb.emissiveColor.set(0,0,0),this.beep=!1)},GrenadeActor.prototype.remove=function(){this.Xb.setEnabled(!1)},GrenadeActor.prototype.bounce=function(){var e=Math.length3(this.grenade.dx,this.grenade.dy,this.grenade.fb);this.rx=(2*Math.random()-1)*e,this.ry=(2*Math.random()-1)*e,this.rz=(2*Math.random()-1)*e},GrenadeActor.prototype.stop=function(){this.rx=0,this.ry=0,this.rz=0};var GunActor=class{fire(){if(this.hx.constructor.burst&&this.roundsFired%this.hx.constructor.burst!=0||(this.fireSound&&pAudio.play(this.fireSound,this.hx.Zb.wb.Xb.position,!0),playAnimation(this.Fz,"fire")),this.roundsFired++,this.muzzleFlash){this.muzzleFlash.rotation.z=3.141*Math.random(),this.muzzleFlash.setEnabled(!0);var e=this;setTimeout((function(){e.muzzleFlash.setEnabled(!1)}),33)}}dispose(){this.Fz.dispose()}equip(e){this.hx.Zb.meleeWeapon.wb.weaponMesh.setEnabled(!1),this.playerActor.setWeaponSkeleton(this.skeleton),this.playerActor.Zx.setEnabled(!1),initAnimation(this.Fz,"fire"),this.scene.beginAnimation(this.playerActor.Zx,30,55,!1,e||1),this.Fz.setEnabled(!0),this.roundsFired=0,setTimeout((()=>{this.playerActor.Zx.setEnabled(!0)}),1)}addSoundEvent(e,t,i){let a=this.Fz.getAnimationByName(e).targetedAnimations[0].animation;var n,s,r=new AnimationEvent(t,(n=i,s=this.hx.Zb.wb.Xb.position,function(){pAudio.play(n,s,!0)}));a.addEvent(r)}inspect(){playAnimation(this.Fz,"inspect")}restPose(){void 0!==gameScene&&playAnimation(this.Fz,"fire")}update(){}getFireSound(e,t){const i=e+"_fire";return BAWK.sounds[i]?i:t}reload(){this.hx.longReloadTime==this.hx.shortReloadTime?playAnimation(this.Fz,"reload",this.hx.constructor.reloadTimeMod):this.hx.ammo.Sb>0?playAnimation(this.Fz,"shortReload",this.hx.constructor.reloadTimeMod):playAnimation(this.Fz,"longReload",this.hx.constructor.reloadTimeMod)}stow(){pAudio.play("weapon_swap",this.hx.Zb.wb.Xb.position,!0),this.scene.beginAnimation(this.playerActor.Zx,0,25,!1,1,(()=>{this.Fz.setEnabled(!1),this.hx.equip()}))}setup(e){this.Fz=cloneMesh(this.meshName,this.scene,this.playerActor.Zx),this.skeleton=this.Fz.skeleton,this.Fz.material=getMaterialByName("standard",this.scene),this.Fz.setEnabled(!1),e&&(this.muzzleFlash=cloneMesh("muzzleFlash",this.scene,this.playerActor.Zx),this.muzzleFlash.material=getMaterialByName("muzzleFlash",this.scene),this.muzzleFlash.setEnabled(!1),this.muzzleFlash.position.x=.25,this.muzzleFlash.position.z=-e,this.muzzleFlash.rotation.y=Math.PI,this.muzzleFlash.scaling.copyFromFloats(.7,.7,.7)),this.hx.Zb.id==meId&&(this.Fz.setRenderingGroupId(2),this.muzzleFlash&&this.muzzleFlash.setRenderingGroupId(2))}dryFire(){pAudio.play(this.dryFireSound,this.hx.Zb.wb.Xb.position,!0)}constructor(e,t){this.hx=e,this.meshName=t,this.scene=e.scene,this.Ab="gun_"+e.constructor.Ab,this.playerActor=e.Zb.wb,this.roundsFired=0,this.dryFireSound="gun_eggk47_dry_fire"}denyFire(){reticle.fireDenied(),pAudio.play(this.dryFireSound,this.hx.Zb.wb.Xb.position,!0),pAudio.play(this.denyFireSound,this.hx.Zb.wb.Xb.position,!0)}},Eggk47Actor=class extends GunActor{constructor(e,t){super(e,t),this.scopeFov=.9,this.scopeY=.0438,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_eggk47_fire"),this.addSoundEvent("shortReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",123,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",123,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",155,"gun_eggk47_full_cycle")}},DozenGaugeActor=class extends GunActor{constructor(e,t){super(e,t),this.scopeFov=1,this.scopeY=.072,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_dozenGauge_fire"),this.addSoundEvent("reload",0,"gun_dozenGauge_open"),this.addSoundEvent("reload",80,"gun_dozenGauge_load"),this.addSoundEvent("reload",115,"gun_dozenGauge_close")}},CSG1Actor=class extends GunActor{constructor(e,t){super(e,t),this.scopeFov=.5,this.scopeY=.0345,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_csg1_fire"),this.addSoundEvent("shortReload",25,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",125,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_csg1_pull_action"),this.addSoundEvent("longReload",75,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",160,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",190,"gun_csg1_release_action")}},Cluck9mmActor=class extends GunActor{constructor(e,t){super(e,t),this.scopeFov=1.1,this.scopeY=.069,this.setup(.48),this.fireSound=this.getFireSound(t,"gun_cluck9mm_fire"),this.addSoundEvent("shortReload",15,"gun_cluck9mm_remove_mag"),this.addSoundEvent("shortReload",110,"gun_cluck9mm_insert_mag"),this.addSoundEvent("longReload",15,"gun_cluck9mm_remove_mag"),this.addSoundEvent("longReload",110,"gun_cluck9mm_insert_mag"),this.addSoundEvent("longReload",155,"gun_eggk47_full_cycle")}},RPEGGActor=class extends GunActor{constructor(e,t){super(e,t),this.scopeFov=.9,this.scopeY=.1-.0862,this.setup(.51),this.fireSound=this.getFireSound(t,"gun_rpegg_fire"),this.denyFireSound="gun_rpegg_deny_fire",this.addSoundEvent("reload",115,"gun_rpegg_load")}},SMGActor=class extends GunActor{constructor(e,t){super(e,t),this.scopeFov=1,this.scopeY=.1-.09635,this.setup(.55),this.fireSound=this.getFireSound(t,"gun_smg_fire"),this.addSoundEvent("shortReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",150,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",150,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",185,"gun_smg_cycle")}},M24Actor=class extends GunActor{constructor(e,t){super(e,t),this.scopeFov=.4,this.scopeY=.1-.03507,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_m24_fire"),this.addSoundEvent("reload",10,"gun_m24_bolt_open"),this.addSoundEvent("reload",75,"gun_eggk47_insert_mag"),this.addSoundEvent("reload",94,"gun_m24_bolt_close")}},AUGActor=class extends GunActor{constructor(e,t){super(e,t),this.scopeFov=.7,this.scopeY=.0385,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_aug_fire"),this.addSoundEvent("shortReload",28,"gun_aug_remove_mag"),this.addSoundEvent("shortReload",118,"gun_aug_insert_mag"),this.addSoundEvent("longReload",28,"gun_aug_remove_mag"),this.addSoundEvent("longReload",118,"gun_aug_insert_mag"),this.addSoundEvent("longReload",153,"gun_aug_cycle")}};function fetchHouseAds(){getRequest("data/housePromo.json?"+Date.now(),(function(e,t){if(0===Object.keys(HouseAds).length&&HouseAds.constructor===Object)houseAds={big:[],small:[],bigBanner:[],houseAdPercentChance:100,smHouseAds:[],shellLogo:[]};else{const e={socialMedia:"",premFeat:""};houseAds=HouseAds,preLoadHouseAdSmall(),console.log("special items tag: "+houseAds.specialItemsTag),hasValue(houseAds.specialItemsTag)&&G.catalog.getTaggedItems(houseAds.specialItemsTag).length>0?vueApp.useSpecialItemsTag(houseAds.specialItemsTag):vueApp.disableSpecialItems(),hasValue(houseAds.featuredSocialMedia)&&(e.socialMedia=houseAds.featuredSocialMedia),hasValue(houseAds.premFeatured)&&(e.premFeat=houseAds.premFeatured,premFeatTag[e.premFeat]=!0),houseAds.smHouseAds.length>0&&vueApp.ui.houseAds.homeScreen.push(...houseAds.smHouseAds),vueApp.useTags(e)}houseAdsLoaded=!0}))}function requestJson(e,t){getRequest(e+"?"+Date.now(),((e,i)=>{let a=[];if(404===e)console.log("Accept it and move on.");else try{const e=JSON.parse(i);e.length>0&&e.forEach((e=>a.push(e)))}catch(e){console.log("News request error: ",e)}t(a)}))}function preLoadHouseAdSmall(){for(var e=[],t=0;t<houseAds.small.length;t++)if(houseAds.small[t].active){if(crazyGamesActive&&houseAds.small[t].hideOnCG){console.log("HouseAdSmall not showing on Crazy Games");continue}e.push(t),houseAds.small[t].weighted&&e.push(t)}e.length>0&&(null!==smallAdLastIdx&&e.length>1&&e.splice(e.indexOf(smallAdLastIdx),1),smallAdLastIdx=e[Math.floor(Math.random()*e.length)],vueApp.useHouseAdSmall(houseAds.small[smallAdLastIdx]))}function clickedHouseAdSmall(e){ga("send","event",{eventCategory:"House banner ad",eventAction:"click",eventLabel:e.label}),clickedHouseLink(e)}function showHouseAdPWA(){const e="pwaDate",t=localStore.getItem(e),i=t&&Date.now()>t+432e6;return!!(!t&&pwaReady||pwaReady&&i)&&(localStore.setItem(e,Date.now()),console.log("SHOW PWA big ad"),!0)}function showHouseAdBig(){if(houseAds){var e=[],t=[];if(void 0!==houseAds&&houseAds.hasOwnProperty("big")){for(var i=0;i<houseAds.big.length;i++)"facebook"===loginProviderId&&houseAds.big[i].active&&houseAds.big[i].label.includes("Sugar")&&t.push(i),houseAds.big[i].active&&e.push(i);var a=t.length>0?t:e;e.length>0&&(bigAdIdx=e[Date.now()%a.length],vueApp.useHouseAdBig(houseAds.big[bigAdIdx]),ga("send","event",{eventCategory:"Big ad",eventAction:"show",eventLabel:houseAds.big[bigAdIdx].label}))}}}function clickedHouseAdBig(e){ga("send","event",{eventCategory:"Big ad",eventAction:"click",eventLabel:e.label}),clickedHouseLink(e)}function hasHouseLink(e){return e.link||e.linksToTaggedItems||e.linksToItemId||e.linksToPass||e.linksToPhotoBooth}function linksToItemId(e){isString(e.linksToItemId)&&(e.linksToItemId=parseInt(e.linksToItemId,10));var t=catalog.findItemById(e.linksToItemId);vueApp.showItemOnEquipScreen(t)}function clickedHouseLink(e){switch(e.linksTo){case"linksToTaggedItems":break;case"linksToItemId":linksToItemId(e);break;case"linksToPass":showWelcomeBundle();break;case"linksToPhotoBooth":openPhotoBooth();break;case"linksToVipStore":vueApp.showSubStorePopup();break;case"linkToShop":vueApp.openEquipSwitchTo(parseInt(e.linkToShop,10));break;case"linkToChw":vueApp.showNuggyPopup();break;case"linkToBlackFriday":vueApp.showEggStorePopup();break;case"linkToEggOrg":vueApp.showSelectedTaggedItemsOnEquipScreen("EGGORG");break;case"linkToTwitch":window.open(dynamicContentPrefix+"twitch?utm_medium=referral&utm_campaign=featureslot","_blank");break;case"linksToCreateGame":vueApp.showCreateGamePopup();break;default:e.link.length>1&&crazyGamesActive?window.open(e.link[1],"_window"):window.open(e.link[0],"_window")}ga("send","event","home-display-ad","click",e.label.toLowerCase().replace(/ /g,"-"))}function clickedWebFeedItem(e){function t(e){ga("send","event","newsItem","clicked",e)}if("linksToItemId"in e){let i=G.catalog.findItemById(parseInt(e.linksToItemId,10));return vueApp.showItemOnEquipScreen(i),void t(`item=${i.name}`)}return"linksToTaggedItems"in e?(showTaggedItems=1==e.linksToTaggedItems?houseAds.specialItemsTag:e.linksToTaggedItems,openShopOnly=!0,tryShowTaggedItems(),void t(`tagged=${e.linksToTaggedItems}`)):"linksToChangeLog"in e?(vueApp.showChangelogPopup(),void t("sschangelog")):"link"in e?(window.open(e.link,"_window"),void t(e.link)):"linksToPhotoBooth"in e?(openPhotoBooth(),void t("openPhotoBooth")):("linksToPass"in e&&(showWelcomeBundle(),t("pass")),"linksToEggStoreItem"in e?(vueApp.showPopupEggStoreSingle(e.linksToEggStoreItem),void t(`skuItem=${e.linksToEggStoreItem}`)):void("linksToVipStore"in e&&(vueApp.showSubStorePopup(),t(`skuItem=${e.linksToVipStore}`))))}var getHouseAd=e=>{if(!houseAds.length)return;const t=houseAds[e].filter((e=>e.active));if(!t.length)return;const i=[],a=t.filter((e=>e.label.includes("VIP"))).length;let n=Math.round(.5*t.length/a);isFinite(n)||(n=1);const s=t.map((e=>{const t=e.label.toUpperCase();return e.priority=1,t.includes("VIP")&&(e.priority=n),e}));for(let e=0;e<s.length;++e)for(let t=0;t<s[e].priority;++t)i.push(s[e]);return i[Math.floor(Math.random()*i.length)]},itemRenderer;function ItemActor(e){this.kind=e,this.scene=gameScene}function AmmoActor(){ItemActor.call(this,ItemManager.AMMO),this.Xb=this.scene.getMeshByName("ammo").createInstance(""),this.Xb.setEnabled(!1),shadowGen&&shadowGen.getShadowMap().cb.push(this.Xb)}function GrenadeItemActor(){ItemActor.call(this,ItemManager.GRENADE),this.Xb=this.scene.getMeshByName("grenadeItem").createInstance(""),this.Xb.setEnabled(!1),shadowGen&&shadowGen.getShadowMap().cb.push(this.Xb)}function ItemManager(){this.pools=[new Pool((function(){return new ItemManager.Constructors[ItemManager.AMMO]}),100),new Pool((function(){return new ItemManager.Constructors[ItemManager.GRENADE]}),20)]}function ItemRenderer(){this.scene=createScene(G.engine),this.scene.clearColor=new Color4(0,0,0,0),new HemisphericLight("",new Vector3(0,-1,0),this.scene).intensity=1,new DirectionalLight("",new Vector3(-.5,-1,.5),this.scene).intensity=1,this.canvas=G.engine.getRenderingCanvas(),this.meshRenderStaging={},loadMaterials(this.scene),this.camera=new TargetCamera("",new Vector3(1.5,0,0),this.scene),this.camera.target=new Vector3(0,0,0),this.loadStampSprites(),this.camera.undefinedc=.5,this.camera.maxZ=100,this.camera.minZ=.01}function fromBase62(e){for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=0,a=Math.max(0,e.length-5);a<e.length;a++){var n=t.indexOf(e[a]);if(n<0)return NaN;i+=n*Math.pow(62,e.length-a-1)}return i}ItemActor.prototype.update=function(e){this.Xb.rotation.y+=.03*e},ItemActor.prototype.remove=function(){this.Xb.setEnabled(!1)},AmmoActor.prototype=Object.create(ItemActor.prototype),AmmoActor.prototype.constructor=ItemActor,GrenadeItemActor.prototype=Object.create(ItemActor.prototype),GrenadeItemActor.prototype.constructor=ItemActor,ItemManager.AMMO=0,ItemManager.GRENADE=1,ItemManager.Constructors=[AmmoActor,GrenadeItemActor],ItemManager.prototype.update=function(e){for(var t=0;t<this.pools.length;t++)this.pools[t].forEachActive((function(t){t.update(e),t.Xb.isVisible=isMeshVisible(t.Xb)}))},ItemManager.prototype.spawnItem=function(e,t,i,a,n){var s=this.pools[t].retrieve(e);s.Xb.setEnabled(!0),s.Xb.position.x=i,s.Xb.position.y=a,s.Xb.position.z=n,testing&&s.Xb.freezeWorldMatrix()},ItemManager.prototype.collectItem=function(e,t){var i=this.pools[e];i.recycle(i.objects[t]),i.objects[t].remove()},ItemManager.prototype.recycleAllItems=function(){for(var e=this,t=0;t<this.pools.length;t++)this.pools[t].forEachActive((function(i){e.pools[t].recycle(i),i.remove()}))},ItemRenderer.prototype.clearCanvas=function(e){e.getContext("2d").clearRect(0,0,256,256)},ItemRenderer.prototype.renderToCanvas=function(e,t,i){let a=e.item_data.meshName;if(!this.scene.isReady())return void setTimeout((()=>this.renderToCanvas(e,t,i)),0);var n=cloneMesh(a,this.scene);let s;switch(n.setEnabled(!0),n.material=getMaterialByName("standard",this.scene),e.item_type_id!==ItemType2.Primary&&e.item_type_id!==ItemType2.Secondary||initAnimation(n,"fire"),n.layerMask=1,this.camera.layerMask=1,e.item_type_id){case ItemType2.Hat:s={radius:1.4,rotation:new Vector3(-.25,-2,0),position:new Vector3(.5*e.align.x,e.align.y,e.align.z)};break;case ItemType2.Grenade:s={radius:.4,rotation:new Vector3(0,1.3,0),position:new Vector3(0,-.01,0)};break;case ItemType2.Melee:s={radius:.7,rotation:new Vector3(.4,-3.8,-.9),position:new Vector3(0,-.05,.07)};break;case ItemType2.Primary:switch(s={radius:1.3,rotation:new Vector3(.7,-.02,0)},e.exclusive_for_class){case CharClass.Soldier:s.position=new Vector3(0,-.18,.27);break;case CharClass.Eggsploder:s.position=new Vector3(0,-.15,.21);break;case CharClass.Scrambler:s.position=new Vector3(0,-.18,.27);break;case CharClass.Ranger:s.position=new Vector3(0,-.2,.26);break;case CharClass.Whipper:s.position=new Vector3(0,-.15,.22);break;case CharClass.Crackshot:s.position=new Vector3(0,-.16,.26);break;case CharClass.TriHard:s.position=new Vector3(0,-.16,.25);break;default:s.position=new Vector3(0,-.15,.25)}break;case ItemType2.Secondary:s={radius:1,rotation:new Vector3(0,0,0),position:new Vector3(0,.05,.36)}}n.position.copyFrom(s.position),n.rotation.copyFrom(s.rotation),n.computeWorldMatrix(!0),this.camera.position.x=s.radius,this.camera.computeWorldMatrix(),this.scene.render(),n.dispose();var r=t.getContext("2d");r.clearRect(0,0,256,256),r.drawImage(this.canvas,(this.canvas.width-this.canvas.height)/2,0,this.canvas.height,this.canvas.height,0,0,256,256),this.camera.layerMask=0,i&&i()},ItemRenderer.prototype.renderStampToCanvas=function(e,t,i){var a=e.item_data.x,n=e.item_data.y;this.stampSprites.layerMask=2,this.camera.layerMask=2,this.stampSprite.cellIndex=a+32*n,this.camera.position.x=2.5,this.scene.render();var s=t.getContext("2d");s.clearRect(0,0,256,256),s.drawImage(this.canvas,(this.canvas.width-this.canvas.height)/2,0,this.canvas.height,this.canvas.height,0,0,256,256),this.camera.layerMask=0,this.scene.render(),i&&i()},ItemRenderer.prototype.loadStampSprites=function(){const e=hasAccount||signinClicked?"img/stamps.webp?v="+version:"";this.stampSprites=new SpriteManager("",e,1024,128,this.scene),this.stampSprite=new Sprite("",this.stampSprites),this.stampSprite.size=1,this.stampSprite.invertU=!0};var Matchmaker=class{static getRegions(){return new Promise(((e,t)=>{this.ws.send('{ "command": "regionList" }'),this.ws.onmessage=t=>{let i=JSON.parse(t.data);if("regionList"===i.command){this.ws.onerror=e=>{},this.regionList=i.regionList;for(let e of this.regionList)e.locKey="server_"+e.id,e.ping=null;vueApp.regionList=this.regionList,e()}else this.handleMatchmakerMessage(t)},this.ws.onerror=e=>{t(e),this.handleError(e)}}))}static handleError(e){this.ws.onerror=e=>{},Loader2.hide(),vueApp.hideSpinner(),console.log("Failed to connect to Matchmaker",e),vueApp.showGenericPopup("matchmaker_offline","matchmaker_offline_msg","ok")}static handleNotices(e){Object.keys(e).forEach((t=>{switch(t){case"announcement":vueData.announcementMessage=e[t];break;case"version":if(e[t]!==version)if(localStorage.getItem("cacheNuked")){console.log("Wrong client version");let e=setInterval((()=>{vueApp&&(clearInterval(e),vueApp.showGenericPopup("wrong_version","wrong_version_msg","ok"))}),100)}else localStorage.setItem("cacheNuked",!0),nukeCacheAndReload();else localStorage.removeItem("cacheNuked")}}))}static joinPrivateGame(e){return new Promise(((t,i)=>{let a={command:"joinGame",id:e.joinCode.toLowerCase(),observe:e.observe,sessionId:G.playerAccount.sessionId};this.ws.send(JSON.stringify(a)),this.ws.onmessage=e=>{let a=JSON.parse(e.data);if(a.error)i(CloseCode[a.error]);else if("gameFound"===a.command)this.ws.onerror=e=>{},t(a);else this.handleMatchmakerMessage(e)},this.ws.onerror=e=>{i(e),this.handleError(e)}}))}static findGame(e){let t=vueApp.currentRegionId;fromBase62(G.playerAccount.firebaseId);return new Promise(((i,a)=>{let n=G.playerAccount.statsLifetime.kills.total<12,s={command:"findGame",region:t,playType:e.playType,gameType:e.gameType,sessionId:G.playerAccount.sessionId,noobLobby:n};e.playType===vueData.playTypes.createPrivate&&(s.map=e.mapIdx),this.ws.send(JSON.stringify(s)),this.ws.onmessage=e=>{let t=JSON.parse(e.data);if(t.error)a(CloseCode[t.error]);else if("gameFound"===t.command)this.ws.onerror=e=>{},i(t);else this.handleMatchmakerMessage(e)},this.ws.onerror=e=>{a(e),this.handleError(e)}}))}static connect(){return new Promise(((e,t)=>{var i=dynamicContentRoot||location.host,a=(isHttps()?"wss":"ws")+"://"+i+"/matchmaker/";this.ws=new ReliableWebSocket(a),this.ws.onopen=()=>{e(this.ws)},this.ws.onmessage=e=>this.handleMatchmakerMessage(e),this.ws.onerror=()=>{}}))}static handleMatchmakerMessage(e){let t=JSON.parse(e.data);if("notice"===t.command)this.handleNotices(t.notices)}},MeleeWeaponActor=class{inspect(){playAnimation(this.weaponMesh,"inspect")}getSwingSounds(e){return PremMeshNames.Melee.includes(e)?Object.keys(BAWK.sounds).filter((t=>t.startsWith(e))):["melee_whisk_a","melee_whisk_b"]}stow(){this.weaponMesh.setEnabled(!1)}dispose(){this.weaponMesh.dispose()}attack(){playAnimation(this.weaponMesh,"melee"),setTimeout((()=>{let e=Math.randomInt(0,this.swingSounds.length);pAudio.play(this.swingSounds[e],this.playerActor.Xb.position,!0)}),68)}constructor(e,t){this.ib=e,this.meshName=t,this.scene=e.scene,this.Zb=e.Zb,this.playerActor=e.Zb.wb,this.weaponMesh=cloneMesh(this.meshName,this.scene,this.playerActor.Zx),this.skeleton=this.weaponMesh.skeleton,this.weaponMesh.material=getMaterialByName("standard",this.scene),this.weaponMesh.setEnabled(!1),this.swingSounds=this.getSwingSounds(t),this.ib.Zb.id==meId&&this.weaponMesh.setRenderingGroupId(2)}};function sendOneSignalTagsForUser(){var e=void 0===G.playerAccount.inventory||null===G.playerAccount.inventory?0:G.playerAccount.inventory.length;console.log("Sending user tags to OneSignal..."),sendOneSignalTags({user_id:G.playerAccount.firebaseId,has_account:!0,maybe_school:G.playerAccount.maybeSchoolEmail,kills:G.playerAccount.kills,deaths:G.playerAccount.deaths,num_eggs:G.playerAccount.currentBalance,num_items_bought:e,egg_class:G.playerAccount.classIdx,is_chromebook:detectChromebook()})}function sendOneSignalTagsForAnon(){console.log("Sending anon tags to OneSignal..."),sendOneSignalTags({has_account:!1,maybe_school:!1,is_chromebook:detectChromebook()})}function sendOneSignalTagsForGameplay(){console.log("Sending gameplay tags to OneSignal..."),sendOneSignalTags({username:vueApp.playerName,fps:Math.floor(fpsAverage)})}function sendOneSignalTags(e){OneSignal.push((function(){OneSignal.sendTags(e).then((function(e){console.log("Completed sending tags to OneSignal")}))}))}function sendOneSignalTagsForXsolla(e){var t={storeVisited:!0,product:e};console.log("Sending xsolla tags to OneSignal: "+JSON.stringify(t)),sendOneSignalTags(t)}function listenForOneSignalNotifications(){OneSignal.push(["addListenerForNotificationOpened",function(e){console.log("Received NotificationOpened:"),console.log(e);let t=Math.floor(Date.now()/1e3);if(OneSignal.sendTag("last_notification_click",t),void 0!==e.data&&null!==e.data){if(console.log("data",e.data),void 0!==e.data.notification_topic&&null!==e.data.notification_topic){let t=e.data.notification_topic;t&&OneSignal.getTags().then((function(e){var i=parseInt(e[t],10);isNaN(i)?i=1:i+=1,OneSignal.sendTag(t,i).then((function(e){console.log("tagsSent: ",JSON.stringify(e))}))}))}if(void 0!==e.data.nugget)return showNugget=!0,void tryShowNugget();if(void 0!==e.data.specialTagItems)return void tryShowTaggedItems(e.data.specialTagItems);if(void 0!==e.data.eggStorePopup)return void showProductPopup(e.data.eggStorePopup);void 0!==e.data.rewardTag&&(reward=new PlayerReward(e.data.rewardTag,void 0===e.data.rewardOpenUrl?null:e.data.rewardOpenUrl,void 0===e.data.rewardOpenUrlMsg?null:e.data.rewardOpenUrlMsg),!0===isRunning&&tryGiveOneSignalReward())}}])}function sendTestNotification(e){OneSignal.sendSelfNotification("Test Notification","This is a test notification message.","http://localshelldev.bluewizard.com","https://onesignal.com/images/notification_logo.png",{rewardTag:e,eggStorePopup:"some",rewardOpenUrl:"https://diggerz.io",rewardOpenUrlMsg:"Hey punk!! Get your reward by clicking the button!"},[{id:"like-button",text:"Like",icon:"http://i.imgur.com/N8SN8ZS.png",url:"https://example.com/?_osp=do_not_open"},{id:"read-more-button",text:"Read more",icon:"http://i.imgur.com/MIxJp1L.png",url:"https://example.com/?_osp=do_not_open"}])}function tryGiveOneSignalReward(){if(!0===checkedForReward)return!1;if(!hasValue(reward)||!hasValue(reward.tag))return!1;if(console.log("Reward URL: "+reward.openUrl),hasValue(reward.openUrl)&&!0!==reward.wasUrlOpened)return vueApp.showOpenUrlPopup(reward.openUrl,"reward_url_title",reward.openUrlMsg,"ok","no_thanks"),!0;vueApp.showSpinner(),api_reward(reward,(function(e){if(checkedForReward=!0,vueApp.hideSpinner(),e.error)console.log("tryGiveOneSignalReward Error: "+JSON.stringify(e.error));else switch(console.log("tryGiveOneSignalReward response: "+e.result),e.result){case"SUCCESS":var t=0;hasValue(e.eggsGiven)&&e.eggsGiven>0&&(t=e.eggsGiven,api_checkBalance());var i=[];hasValue(e.itemIds)&&e.itemIds.length>0&&(i=G.catalog.findItemsByIds(e.itemIds)).forEach((e=>{G.playerAccount.isItemOwned(e)||(G.playerAccount.inventory.push(e),console.log("Reward item given, id: "+e.id))})),vueApp.showGiveStuffPopup("reward_title",t,i);break;case"REWARD_PREV_GIVEN":vueApp.showGenericPopup("uh_oh","reward_already","ok");break;case"REWARD_EXPIRED":vueApp.showGenericPopup("uh_oh","reward_expired","ok");break;case"REWARD_NOT_FOUND":vueApp.showGenericPopup("uh_oh","reward_not_found","ok");break;case"ERROR":console.log("error: "+e.error),vueApp.showGenericPopup("uh_oh","error","ok");break;default:vueApp.showGenericPopup("uh_oh","error","ok")}return reward=null,listenForOneSignalNotifications(),!0}),(function(e){console.log("servicesWs Error: "+JSON.stringify(e,["message","arguments","type","name"])),listenForOneSignalNotifications(),vueApp.showGenericPopup("uh_oh","generic_conn_failed","ok"),reward=null,vueApp.hideSpinner()}),(function(e){reward=null}))}function openUrlAndGiveReward(){window.open(reward.openUrl,"_blank","width=800,height=600"),reward.wasUrlOpened=!0,tryGiveOneSignalReward()}function showProductPopup(e){return vueApp.eggStoreReferral="OneSignal ref",vueApp.showPopupEggStoreSingle(e)}function PaperDoll(){this.posingItems={[ItemType2.Primary]:null,[ItemType2.Secondary]:null,[ItemType2.Grenade]:null,[ItemType2.Melee]:null,[ItemType2.Hat]:null,[ItemType2.Stamp]:null},this.grenadeOnHip=!1,this.camX=0,this.camY=.35,this.camRadius=3.4,this.rotY=0,this.rotX=0,this.jump=0,this.turnCountdown=60,this.buyingItem=null,this.autoUpdate=!0,this.scaleSizes=[1,1.25,1.5],this.dmg=100,this.setupScene(),this.onResourcesLoaded()}PaperDoll.prototype.onResourcesLoaded=function(){var e=this;this.startRendering();var t=G.playerAccount.getPrimaryWeapon().item_data.meshName;function i(i){this.scene=e.scene,this.id=-1,this.name="",this.jb=0,this.Vb=0,this.Lb=0,this.Oz=100,this.hatItem=G.playerAccount.hatItem,this.stampItem=G.playerAccount.stampItem,this.stampPositionX=G.playerAccount.stampPositionX,this.stampPositionY=G.playerAccount.stampPositionY,this.shellColor=G.playerAccount.colorIdx,this.meleeItem=G.playerAccount.meleeItem,this.wb=new PlayerActor(this),this.wb.Xb.rotation.y=e.rotY,this.meleeWeapon=new MeleeWeapon(this),this.ib=new G.classes[i].ib(this,t)}this.dualAvatar=new i(G.playerAccount.classIdx),this.dualAvatar.wb.Bz.setEnabled(!1),this.dualAvatar.wb.hands.material.backFaceCulling=!1,this.dualAvatar.wb.foreBone.setScale(Vector3.Zero()),this.dualAvatar.wb.setupStowAnims(0,!0),this.dualAvatar.ib.wb.equip(),this.avatar=new i(G.playerAccount.classIdx),this.avatar.wb.foreBone.setScale(Vector3.Zero()),this.avatar.wb.setupStowAnims(0),this.avatar.ib.wb.equip();var a=Date.now();this.scene.registerBeforeRender((function(){var t=Date.now(),i=t-a;a=t,i/=17,e.update(i)})),this.manualOrientation=!1,this.isMouseDown=!1,this.drag=!1,this.equipContainer=document.getElementById("equip_purchase_top"),this.dollContainer=document.getElementById("paper_doll_container"),this.equipContainer.addEventListener("mousemove",(e=>{if(this.manualOrientation=!0,"equip_purchase_top"!==e.target.id)return!1;this.drag=!1,this.pointEggEvent(e)})),this.dollContainer.addEventListener("mousemove",(e=>{this.manualOrientation=!0,this.drag=!1,this.pointEggEvent(e)})),this.equipContainer.addEventListener("pointerleave",(e=>{this.manualOrientation=!1,this.isMouseDown=!1})),this.dollContainer.addEventListener("pointerleave",(e=>{this.manualOrientation=!1,this.isMouseDown=!1})),this.equipContainer.addEventListener("mousedown",(e=>{this.autoUpdate||(this.isMouseDown=!0,this.drag=!0)})),this.dollContainer.addEventListener("mousedown",(e=>{this.autoUpdate||(this.isMouseDown=!0,this.drag=!0)})),this.equipContainer.addEventListener("mouseup",(e=>{this.isMouseDown=!1,clearInterval(this.mouseIntval)})),this.dollContainer.addEventListener("mouseup",(e=>{this.isMouseDown=!1,clearInterval(this.mouseIntval)})),this.dollContainer.addEventListener("click",(e=>{this.autoUpdate||this.eggDamage()})),this.equipContainer.addEventListener("click",(e=>{this.autoUpdate||this.eggDamage()}))},PaperDoll.prototype.setStampTexture=function(){this.avatar.wb.setStampTexture()},PaperDoll.prototype.pointEggEvent=function(e){(this.autoUpdate&&!this.isMouseDown||!this.autoUpdate&&this.isMouseDown)&&this.pointEgg(e)},PaperDoll.prototype.pointEgg=function(e){var t=e.target.getBoundingClientRect();this.rotY=(e.x-t.left)/t.width*4-2,this.rotX=1.5*-((e.y-t.top)/t.height-.5)},PaperDoll.prototype.startRendering=function(){G.engine.ec((()=>this.scene.render()))},PaperDoll.prototype.avatars=function(e){e(this.avatar),e(this.dualAvatar)},PaperDoll.prototype.update=function(e){if(this.camera.target.x+=(this.camX-this.camera.target.x)/5,this.camera.target.y+=(this.camY-this.camera.target.y)/5,this.camera.radius+=(this.camRadius-this.camera.radius)/5,this.jump-=.002*e,this.avatars((t=>{t.wb.head.rotation.x+=(this.rotX-t.wb.head.rotation.x)/5,t.wb.Xb.rotation.y+=(this.rotY-t.wb.Xb.rotation.y)/5,t.wb.Xb.rotation.x=.5*t.wb.head.rotation.x,t.wb.Xb.position.x=.1*t.wb.Xb.rotation.y,t.wb.Xb.position.y=Math.max(0,t.wb.Xb.position.y+this.jump*e)})),!this.manualOrientation&&this.autoUpdate&&(this.turnCountdown-=e,this.turnCountdown<=0)){var t=.6*Math.random()-.4,i=2*Math.random()-1+.5*this.camX,a=Math.length2(t-this.rotX,i-this.rotY);this.rotX=t,this.rotY=i,this.jump=Math.min(.01,a/100),this.turnCountdown=90*Math.random()+30}this.fakeShadow.position.x=this.avatar.wb.Xb.position.x,this.fakeShadow.position.z=this.avatar.wb.Xb.position.z},PaperDoll.prototype.setupScene=function(){this.scene=createScene(G.engine);var e=new HemisphericLight("",new Vector3(0,-1,0),this.scene);e.intensity=.8,e.diffuse=new Color3(.67,.87,1),new DirectionalLight("",new Vector3(-.2,-1,.4),this.scene).intensity=1.2,loadMaterials(this.scene),this.scene.autoClear=!0,this.scene.clearColor=new Color4(0,0,0,0),this.scene.fogMode=Scene.FOGMODE_EXP2,this.scene.fogDensity=.06;var t=new Color3(.35,.65,.8);this.scene.fogColor=t,this.scene.sunLight={direction:new Vector3(.2,1,.1),diffuse:Color3.White()},this.camera=new ArcRotateCamera("",.5*-Math.PI,1.5,this.camRadius,new Vector3(this.camX,this.camY,0),this.scene),this.scene.activeCameras.push(this.camera),this.camera.maxZ=10,this.camera.undefinedc=.5,this.camera.minZ=.1;var i=new StandardMaterial("shadowMat",this.scene);i.emissiveColor=new Color3(.07,.57,.74),i.diffuseColor=Color3.Black(),i.alpha=.5,this.fakeShadow=MeshBuilder.nc("fakeShadow",{radius:.25},this.scene),this.fakeShadow.material=i,this.fakeShadow.rotation.x=Math.PI/2,this.fakeShadow.position.y=0,this.scene.render()},PaperDoll.prototype.poseWithItems=function(e,t,i){this.poseWithHat(e[ItemType2.Hat]),this.poseWithStamp(e[ItemType2.Stamp],t,i),this.poseWithPrimaryWeapon(e[ItemType2.Primary]),this.poseWithSecondaryWeapon(e[ItemType2.Secondary]),this.poseWithGrenade(e[ItemType2.Grenade]),this.poseWithMelee(e[ItemType2.Melee])},PaperDoll.prototype.poseWithPrimaryWeapon=function(e){if(void 0!==e&&(null===e||this.posingItems[ItemType2.Primary]!==e)){if(this.avatar.ib.wb.dispose(),null!==e){let t=e.instantiateNew(this.avatar);this.avatar.ib=t,initAnimation(t.wb.Fz,"fire",(()=>{let e=this.avatar.wb;e.setWeaponSkeleton(t.wb.skeleton),e.gripBone.position=e.weaponGripBone.position,e.gripBone.setRotationQuaternion(e.weaponGripBone.rotationQuaternion),this.dualAvatar.wb.foreBone.setScale(Vector3.Zero())})),t.wb.Fz.setEnabled(!0)}this.posingItems[ItemType2.Primary]=e,null!==this.posingItems[ItemType2.Melee]&&this.poseWithMelee(this.posingItems[ItemType2.Melee],!0)}},PaperDoll.prototype.poseWithSecondaryWeapon=function(e){if(void 0!==e&&(null===e||this.posingItems[ItemType2.Secondary]!==e)){if(this.dualAvatar.ib.wb.dispose(),null!==e){let t=e.instantiateNew(this.dualAvatar);this.dualAvatar.ib=t,initAnimation(t.wb.Fz,"fire");let i=this.dualAvatar.wb;if(i.setWeaponSkeleton(t.wb.skeleton),i.gripBone.position=i.weaponGripBone.position,i.gripBone.setRotationQuaternion(i.weaponGripBone.rotationQuaternion),i.gripBone.setScale(new Vector3(1,1,1)),t.wb.Fz.setEnabled(!0),this.avatar.wb.foreBone.setScale(Vector3.Zero()),null!==this.posingItems[ItemType2.Grenade]&&!this.grenadeOnHip){let e=this.dualAvatar.grenade.wb.Xb;e.parent=this.dualAvatar.wb.Xb,e.position.set(.29,.17,-.08),e.rotation.y=Math.PI+.3,e.rotation.z=-.3,this.grenadeOnHip=!0}}this.posingItems[ItemType2.Secondary]=e,null!==this.posingItems[ItemType2.Grenade]&&this.poseWithGrenade(this.posingItems[ItemType2.Grenade],!0)}},PaperDoll.prototype.poseWithGrenade=function(e,t){if(void 0!==e&&(t||null===e||this.posingItems[ItemType2.Grenade]!==e)){if(this.dualAvatar.grenade&&this.dualAvatar.grenade.wb.dispose(),null!==e){this.dualAvatar.grenade=e.instantiateNew(this.dualAvatar);let t=this.dualAvatar.grenade.wb.Xb;if(t.setEnabled(!0),null!==this.posingItems[ItemType2.Secondary])t.parent=this.dualAvatar.wb.Xb,t.position.set(.29,.17,.08),t.rotation.y=Math.PI-.3,t.rotation.z=-.3,this.grenadeOnHip=!0;else{t.position.set(-.25,0,-.3),t.rotation.y=Math.PI;let e=this.avatar.wb;this.dualAvatar.wb.gripBone.setScale(Vector3.Zero()),e.foreBone.setScale(new Vector3(1,1,1)),e.foreBone.position=new Vector3(-.25,-.11,-.28),e.foreBone.setRotation(new Vector3(-1.7,.14,0)),this.grenadeOnHip=!1,t.parent=e.head}}this.posingItems[ItemType2.Grenade]=e}},PaperDoll.prototype.poseWithMelee=function(e,t){if(void 0!==e&&(t||null===e||this.posingItems[ItemType2.Melee]!==e)){if(this.avatar.meleeWeapon&&this.avatar.meleeWeapon.wb.dispose(),null!==e){let t=e.instantiateNew(this.avatar);this.avatar.meleeWeapon=t;let i=t.wb.weaponMesh;i.setEnabled(!0),null!==this.posingItems[ItemType2.Primary]?(i.parent=this.avatar.wb.Xb,i.position.set(-.53,-.02,-.07),i.rotation.x=2.1,i.rotation.y=.3,initAnimation(i,"melee")):(i.parent=this.avatar.wb.Zx,initAnimation(i,"melee",(()=>{this.avatar.wb.gripBone.setScale(new Vector3(1,1,1)),this.avatar.wb.gripBone.position=this.avatar.wb.weaponGripBone.position,this.avatar.wb.gripBone.setRotationQuaternion(this.avatar.wb.weaponGripBone.rotationQuaternion),this.dualAvatar.wb.foreBone.setScale(Vector3.Zero())})),this.avatar.wb.wieldMelee())}this.posingItems[ItemType2.Melee]=e}},PaperDoll.prototype.poseWithHat=function(e){void 0!==e&&(null!==e&&this.posingItems[ItemType2.Hat]===e||(this.avatar.wb.removeHat(),null!==e&&this.avatar.wb.wearHat(e),this.posingItems[ItemType2.Hat]=e))},PaperDoll.prototype.poseWithStamp=function(e,t,i){if(this.avatar.wb.setStampPosition(t,i),void 0!==e){if(this.posingItems[ItemType2.Stamp]===e)return;null===e?this.avatar.wb.removeStamp():this.avatar.wb.applyStamp(e),this.posingItems[ItemType2.Stamp]=e}},PaperDoll.prototype.poseWithColor=function(e){e>=7&&!G.playerAccount.isSubscriber&&(e=0,vueApp.equip.colorIdx=0),this.avatar.wb.setShellColor(e),this.dualAvatar.wb.setShellColor(e),vueApp.setShellColor(e)},PaperDoll.prototype.photoBoothHideItem=function(e){switch(e.value){case ItemType2.Hat:hasValue(this.posingItems[e.value])?this.poseWithHat(null):this.poseWithHat(G.playerAccount.hatItem);break;case ItemType2.Stamp:this.posingItems[e.value]?this.poseWithStamp(null,0,0):this.poseWithStamp(G.playerAccount.stampItem,G.playerAccount.stampPositionX,G.playerAccount.stampPositionY);break;case ItemType2.Grenade:this.posingItems[e.value]?this.poseWithGrenade(null):this.poseWithGrenade(G.playerAccount.grenadeItem);break;case ItemType2.Melee:this.posingItems[e.value]?this.poseWithMelee(null):this.poseWithMelee(G.playerAccount.meleeItem);break;case ItemType2.Primary:this.posingItems[e.value]?this.poseWithPrimaryWeapon(null):this.poseWithPrimaryWeapon(G.playerAccount.getPrimaryWeapon());break;case ItemType2.Secondary:this.posingItems[e.value]?this.poseWithSecondaryWeapon(null):this.poseWithSecondaryWeapon(G.playerAccount.getSecondaryWeapon())}null===this.posingItems[ItemType2.Grenade]&&null===this.posingItems[ItemType2.Secondary]&&(this.dualAvatar.wb.gripBone.setScale(Vector3.Zero()),this.avatar.wb.foreBone.setScale(new Vector3(1,1,1)),this.avatar.wb.foreBone.position=new Vector3(-.34,-.12,-.1),this.avatar.wb.foreBone.setRotation(new Vector3(.3,1.5,-1.7))),null===this.posingItems[ItemType2.Primary]&&null===this.posingItems[ItemType2.Melee]?(this.avatar.wb.gripBone.setScale(Vector3.Zero()),this.dualAvatar.wb.foreBone.setScale(new Vector3(1,1,1)),this.dualAvatar.wb.foreBone.position=new Vector3(-.34,-.12,-.1),this.dualAvatar.wb.foreBone.setRotation(new Vector3(.3,1.5,-1.7))):(this.avatar.wb.gripBone.setScale(new Vector3(1,1,1)),this.dualAvatar.wb.foreBone.setScale(Vector3.Zero()))},PaperDoll.prototype.scale=function(e){void 0===e&&(e=0),this.avatar.wb.Xb.scaling=new Vector3(this.scaleSizes[e],this.scaleSizes[e],this.scaleSizes[e]),this.dualAvatar.wb.Xb.scaling=new Vector3(this.scaleSizes[e],this.scaleSizes[e],this.scaleSizes[e]),this.fakeShadow.scaling=new Vector3(this.scaleSizes[e],this.scaleSizes[e],this.scaleSizes[e])},PaperDoll.prototype.eggDamage=function(e){e?this.avatar.Oz=100:PhotoBooth.open&&this.drag&&(this.avatar.Oz=this.dmg>0?this.dmg-=25:this.dmg+=100)},PaperDoll.prototype.photoBoothOpen=function(){this.poseWithItems(G.playerAccount.getEquippedItems(),G.playerAccount.stampPositionX,G.playerAccount.stampPositionY),this.autoUpdate=!1,this.fakeShadow.material.emissiveColor=new Color3(0,0,0)},PaperDoll.prototype.photoBoothClose=function(){this.autoUpdate=!0,this.fakeShadow.material.emissiveColor=new Color3(.07,.57,.74),this.eggDamage(!0),resetPaperDoll()};var PhotoBoothInstance=class{constructor(){this.isOpen=!1,this.zoomMsgRead=!1}eggDollSize(e){inGame&&!this.isOpen&&(e=0),paperDoll.scale(e)}open(){inGame?this.close():(this.isOpen=!0,this.zoomMsgRead=localStorage.getItem("photoBoothZooming"),vueApp.$refs.photoBooth.open(),paperDoll.photoBoothOpen())}getScreenshot(e){this.zoooMsg(),!this.isOpen&&inGame||(e?this.getScreenshotWithCrop():html2canvas(document.body,{allowTaint:!1,logging:!1,backgroundColor:null}).then((e=>vueApp.screenGrabDone(e.toDataURL()))))}zoooMsg(){this.zoomMsgRead||(localStore.setItem("photoBoothZooming",!0),this.zoomMsgRead=localStore.getItem("photoBoothZooming"),vueApp.showGenericPopup("screen_photo_booth_zoom_title","screen_photo_booth_zoom_msg","ok"))}close(){this.isOpen=!1,this.eggDollSize(0),vueApp.$refs.photoBooth.close(),paperDoll.photoBoothClose()}hideItem(e){inGame&&!this.isOpen&&(e=null),paperDoll.photoBoothHideItem(e)}getScreenshotWithCrop(){if(this.zoooMsg(),!this.isOpen&&inGame)return;const e=document.createElement("canvas").getContext("2d"),t={allowTaint:!1,logging:!1,backgroundColor:null},i=window.innerWidth,a=i/2,n=window.innerHeight;return t.height=n,t.width=i,t.x=Math.round(t.x),html2canvas(document.body,t).then((s=>{e.canvas.width=a,e.canvas.height=n,e.drawImage(s,-Math.max(0,(i-a)/2||0),-(+t.y||0)),vueApp.screenGrabDone(e.canvas.toDataURL())}))}},shake;function pingRegions(e){console.log("Pinging regions");var t=1e6;document.location.protocol;for(let e of Matchmaker.regionList)!function(i){let a=(isHttps()?"wss":"ws")+"://"+getGameHostname(i.sub)+"/game/";var n,s=new WebSocket(a);s.onopen=e=>{console.log("Pinging "+i.id),s.send(JSON.stringify({command:"ping"})),n=Date.now()},s.onmessage=i=>{clearTimeout(r),e.ping=Date.now()-n,vueApp.regionList=Matchmaker.regionList.filter((e=>null!==e.ping)).sort(((e,t)=>e.ping<t.ping?-1:e.ping>t.ping?1:0)),ready_ping=!0,e.ping<t&&(t=e.ping,vueApp.currentRegionId=e.id)},s.onerror=t=>{clearTimeout(r),e.ping=null};var r=setTimeout((()=>{e.ping=null,s.close()}),4e3)}(e)}function selectRegion(e){let t=Matchmaker.regionList.find((function(t){return t.id===e}));hasValue(t)||(t=Matchmaker.regionList[0]),vueApp.currentRegionId=t.id,localStore.setItem("selectedRegionId",t.id)}function PlayerActor(e){this.Zb=e,this.scene=this.Zb.scene,this.Xb=new TransformNode(""),this.hat=null,this.spriteSize=1,this.spriteShrinkSize=.5,this.Bz=cloneMesh("egg",this.scene,this.Xb),this.Bz._scene=this.scene,this.Bz.position.y=.32,this.Bz.Zb=this.Zb,this.Bz.stampOffset=new Vector2,this.lerpToPosition=new Vector3,this.positionLerp=0,this.lerpFromPosition=new Vector3,this.lerpTargetPosition=new Vector3,this.Bz.material=getMaterialByName("shell",this.scene),this.setStampTexture(),this.Bz.setEnabled(!0),this.Bz.hp=1,this.head=new TransformNode,this.head.parent=this.Xb,this.head.position.y=.3,this.head.position.z=0,this.Zx=new TransformNode,this.Zx.parent=this.head,this.Zx.rotation.y=.14,this.Zx.rotation.x=.035,this.setupStowAnims(),this.eye=new TransformNode,this.eye.position.y=.1,this.eye.position.x=0,this.eye.rotation.y=0,this.eye.parent=this.head,this.hands=cloneMesh("hands",this.scene,this.Zx),this.hands.material=getMaterialByName("shell",this.scene),this.hands.teamColor=teamColors.outline[0],this.hands.stampOffset=new Vector2,this.hands.hp=1,this.hands.setEnabled(!0),this.hands.getAnimationByName("grenade_grab").onAnimationEndObservable.add((()=>{this.hands.skeleton&&this.hands.skeleton.disableBlending()})),this.hands.getAnimationByName("grenade_throw").onAnimationEndObservable.add((()=>{this.hands.skeleton&&(this.throwingGrenade=!1,this.gripBone._frozen=!1)})),this.gripBone=this.hands.skeleton.bones[this.hands.skeleton.getBoneIndexByName("gripHand")],this.foreBone=this.hands.skeleton.bones[this.hands.skeleton.getBoneIndexByName("foreHand")],this.Zb.shield>0&&(this.Bz.overlayColor=Player.OverlayColor.green,this.hands.overlayColor=Player.OverlayColor.green,this.Bz.renderOverlay=!0,this.hands.renderOverlay=!0),this.setShellColor(this.Zb.shellColor),shake=0,this.Xb.position.x=this.Zb.jb,this.Xb.position.y=this.Zb.Vb,this.Xb.position.z=this.Zb.Lb,this.Zb.id!=meId&&(this.wearHat(this.Zb.hatItem),this.applyStamp(this.Zb.stampItem),this.setStampPosition(this.Zb.stampPositionX,this.Zb.stampPositionY)),playOffline&&this.hands.setEnabled(!1),this.bobbleIntensity=0,this.zoomed=!1,this.hitSoundDelay=0,this.auraSprite=null,this.auraSpriteFrame=0;for(let e=0;e<Object.keys(ShellStreak).length;e++){let t=1<<e;this.Zb.activeShellStreaks&t&&this.beginShellStreak(t)}this.Bz.teamColor=teamColors.outline[0],inGame&&(shadowGen&&shadowGen.getShadowMap().cb.push(this.Bz),this.Zb.id==meId?this.hands.setRenderingGroupId(2):(this.setupNameSprite(),this.showSprites()),inGame&&this.updateTeam())}PlayerActor.prototype.setStampTexture=function(){this.Bz.material.getBlockByName("ImageSource").texture=stampTexture},PlayerActor.prototype.wearHat=function(e){this.removeHat(),null!==e&&(this.hat=cloneMesh(e.item_data.meshName,this.scene,this.Bz),this.hat.setEnabled(!0),this.hat.position.y=-.02)},PlayerActor.prototype.removeHat=function(){void 0!==this.hat&&null!==this.hat&&this.hat.dispose()},PlayerActor.prototype.applyStamp=function(e){this.removeStamp(),null!==e&&this.Bz.stampOffset.set(e.item_data.x/32,1-e.item_data.y/32)},PlayerActor.prototype.removeStamp=function(){this.Bz.stampOffset.set(0,1)},PlayerActor.prototype.setStampPosition=function(e,t){this.Bz.stampPositionX=e,this.Bz.stampPositionY=t},PlayerActor.prototype.drawTextOnNameTexture=function(e,t,i,a,n,s){var r=[{x:0,y:-4},{x:-4,y:0},{x:4,y:0},{x:0,y:4}],o=[{x:0,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1}];t+=this.Zb.id%4*512,i=-i+(2048-256*Math.floor(this.Zb.id/4)),s&&(t+=256-getFloatingNameWidth(e,a)/2);for(var l=0;l<4;l++)nameTexture.drawText(e,t+r[l].x,i+r[l].y,"bold "+a+"px Nunito, sans-serif","rgba(0, 0, 0, 0.5)","transparent");for(l=0;l<4;l++)nameTexture.drawText(e,t+o[l].x,i+o[l].y,"bold "+a+"px Nunito, sans-serif",n,"transparent")},PlayerActor.prototype.setupNameSprite=function(){var e=this.Zb.id%4*512,t=2048-256*Math.floor(this.Zb.id/4);nameTexture.clearRect(e,t-256,512,256),this.drawTextOnNameTexture(this.Zb.name,0,32,60,"white",!0)},PlayerActor.prototype.updateTeam=function(){this.Zb.team==myTeam||spectate?this.Bz.teamColor=teamColors.outline[this.Zb.team]:this.Bz.teamColor=teamColors.outline[0],this.nameSprite&&(this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.color=teamColors.textColor[this.Zb.team])},PlayerActor.prototype.update=function(e){var t=Math.cos(this.Zb.bobble)*this.bobbleIntensity,i=Math.abs(Math.sin(this.Zb.bobble)*this.bobbleIntensity),a=Math.sin(2*this.Zb.bobble)*this.bobbleIntensity;if(this.Zb.shield>0){var n=.7*Math.random()+.2;this.Bz.overlayAlpha=n,this.hands.overlayAlpha=n}if(this.Zb.activeShellStreaks&ShellStreak.EggBreaker){n=.5*Math.cos(now/100)+.5;this.Bz.overlayAlpha=n,this.hands.overlayAlpha=n}var s,r=.333*(e=Math.min(e,1));if(viewingPlayerId==this.Zb.id?this.Zb.ib.wb.Fz.alwaysSelectAsActiveMesh=!0:this.Zb.ib.wb.Fz.alwaysSelectAsActiveMesh=!1,this.Zb.id==meId)if(this.Zb.scope&&this.Zb.isAtReady(!0))camera.undefinedc=camera.undefinedc+(this.Zb.ib.wb.scopeFov-camera.undefinedc)*r,this.Zx.rotation.y*=r,this.Zx.rotation.x*=r,this.Zx.position.x+=(-.24999999-this.Zx.position.x)*r,this.Zx.position.y+=(this.Zb.ib.wb.scopeY-this.Zx.position.y)*r,this.Zx.position.z+=(.05-this.Zx.position.z)*r,this.Zb.ib.hasScope&&!this.zoomed&&camera.undefinedc<this.Zb.ib.wb.scopeFov+.05&&(scope.show(),this.Zx.setEnabled(!1),this.zoomed=!0);else{camera.undefinedc=camera.undefinedc+(1.25-camera.undefinedc)*r;var o=1-r;this.Zx.rotation.y+=(.14+2*t-this.Zx.rotation.y)*r,this.Zx.rotation.x+=(.035+.75*a-this.Zx.rotation.x)*r,this.Zx.position.x*=o,this.Zx.position.y*=o,this.Zx.position.z*=o,this.zoomed&&camera.undefinedc>this.Zb.ib.wb.scopeFov+.05&&(scope.hide(),this.Zx.setEnabled(!0),this.zoomed=!1)}else if(this.Zx.rotation.y+=(.14+2*t-this.Zx.rotation.y)*r,this.Zx.rotation.x+=(.035+.75*a-this.Zx.rotation.x)*r,this.Zb.team>0&&(this.Zb.team==myTeam||spectate)&&this.nameSprite){var l=Math.length3(this.Zb.jb-me.jb,this.Zb.Vb-me.Vb,this.Zb.Lb-me.Lb),c=Math.pow(l,1.25);this.nameSprite.width=c/10+.6,this.nameSprite.height=c/20+.3}if(this.lerpToPosition.copyFromFloats(this.Zb.jb,this.Zb.Vb,this.Zb.Lb),Vector3.LerpToRef(this.lerpFromPosition,this.lerpToPosition,Math.min(this.positionLerp,1),this.lerpTargetPosition),this.positionLerp+=e/2,this.Xb.position.x+=.5*(this.lerpTargetPosition.x-this.Xb.position.x),this.Xb.position.y+=.5*(this.lerpTargetPosition.y-this.Xb.position.y),this.Xb.position.z+=.5*(this.lerpTargetPosition.z-this.Xb.position.z),this.Zb.id!==meId){var h=Math.radDifference(this.Zb.pb,this.Xb.rotation.y),u=Math.radDifference(this.Zb.Jb,this.head.rotation.x);this.Xb.rotation.y+=h/2*e,this.head.rotation.x+=u/2*e}else this.Xb.rotation.y=this.Zb.pb,this.head.rotation.x=this.Zb.Jb;if(this.Bz.rotation.x=this.head.rotation.x/4,s=this.Zb.onGround||this.Zb.oz?Math.length3(this.Zb.dx,this.Zb.dy,this.Zb.fb):0,this.bobbleIntensity+=(s-this.bobbleIntensity)/10,this.Bz.rotation.z=5*t,this.Bz.position.y=1.5*i+.32,shake>0)if((shake*=.9)<.001)shake=0;else{var m=Math.random()*shake-.5*shake,d=Math.random()*shake-.5*shake,f=Math.random()*shake-.5*shake;this.eye.rotation.x+=(m-this.eye.rotation.x)/10,this.eye.rotation.y+=(d-this.eye.rotation.y)/10,this.eye.rotation.z+=(f-this.eye.rotation.z)/10}else this.eye.rotation.x*=.9,this.eye.rotation.y*=.9,this.eye.rotation.z*=.9;if(this.Zb.id!=viewingPlayerId){var p=isMeshVisible(this.Xb,.31);this.Xb.mb(p),p?this.showSprites():this.hideSprites(),(this.nameSprite||this.auraSprite)&&this.positionSprites()}this.hitSoundDelay=Math.max(this.hitSoundDelay-e,0),this.Zb.ib.wb&&this.Zb.ib.wb.update(e),this.Bz.hp=100===this.Zb.Oz?1:.008*this.Zb.Oz},PlayerActor.prototype.lx=function(){this.positionLerp=0,this.lerpFromPosition.copyFromFloats(this.Zb.jb,this.Zb.Vb,this.Zb.Lb)},PlayerActor.prototype.resetLerp=function(){this.Xb.position.x=this.Zb.jb,this.Xb.position.y=this.Zb.Vb,this.Xb.position.z=this.Zb.Lb,this.positionLerp=0,this.lerpToPosition.copyFromFloats(this.Zb.jb,this.Zb.Vb,this.Zb.Lb),this.lerpFromPosition.copyFromFloats(this.Zb.jb,this.Zb.Vb,this.Zb.Lb),this.lerpTargetPosition.copyFromFloats(this.Zb.jb,this.Zb.Vb,this.Zb.Lb)},PlayerActor.v3_1=new Vector3,PlayerActor.v3_2=new Vector3,PlayerActor.prototype.positionSprites=function(){var e,t;this.nameSprite&&((e=PlayerActor.v3_1).copyFrom(this.Xb.position),e.y+=.5*this.nameSprite.height+.65,(t=this.nameSprite.position).copyFrom(camera.globalPosition),t.subtractInPlace(e),t.normalize(),t.scaleInPlace(.4),t.addInPlace(e));this.auraSprite&&((e=PlayerActor.v3_1).copyFrom(this.Xb.position),e.y+=.35*this.Zb.playerScale,(t=this.auraSprite.position).copyFrom(camera.globalPosition),t.subtractInPlace(e),t.normalize(),t.scaleInPlace(.4),t.addInPlace(e),this.auraSprite.width=.7*this.Zb.playerScale,this.auraSprite.height=.7*this.Zb.playerScale)},PlayerActor.prototype.showSprites=function(){this.Zb.Rb&&(this.nameSprite||(this.nameSprite=new Sprite("",nameSprites),this.nameSprite.invertV=!0,this.nameSprite.invertU=!0,this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.cellIndex=this.Zb.id,this.nameSprite.color=teamColors.textColor[this.Zb.team],this.Zb.team==myTeam||spectate?this.Bz.teamColor=teamColors.outline[this.Zb.team]:this.Bz.teamColor=teamColors.outline[0]),!this.auraSprite&&this.Zb.activeShellStreaks&ShellStreak.HardBoiled&&(this.auraSprite=new Sprite("",auraSprites),this.auraSprite.invertV=!0,this.auraSprite.width=.7,this.auraSprite.height=.7,this.auraSprite.playAnimation(this.auraSpriteFrame,this.auraSpriteFrame+7,!0,67)))},PlayerActor.prototype.hideSprites=function(){this.nameSprite&&(this.nameSprite.dispose(),this.nameSprite=null),this.auraSprite&&(this.auraSprite.dispose(),this.auraSprite=null)},PlayerActor.prototype.hit=function(){this.hitSoundDelay<=0&&(this.Zb.activeShellStreaks&ShellStreak.HardBoiled?pAudio.play("shield_hit",this.Bz.absolutePosition,!0):pAudio.play("hit",this.Bz.absolutePosition,!0),this.hitSoundDelay=10)},PlayerActor.prototype.beginShellStreak=function(e){const t={[ShellStreak.HardBoiled]:()=>{this.auraSpriteFrame=8,this.Zb.id==meId&&(showShellStreakMessage(e),updateHealthUI())},[ShellStreak.EggBreaker]:()=>{this.Zb.id==meId&&(showShellStreakMessage(e),reticle.setPowerful(!0)),this.Bz.overlayColor=Player.OverlayColor.red,this.hands.overlayColor=Player.OverlayColor.red,this.Bz.renderOverlay=!0,this.hands.renderOverlay=!0},[ShellStreak.OverHeal]:()=>{showShellStreakMessage(e)},[ShellStreak.Restock]:()=>{this.Zb.id==meId&&showShellStreakMessage(e)},[ShellStreak.MiniEgg]:()=>{this.shellStreakShrinkPlayer(this.Xb,new Vector3(1,1,1),new Vector3(.5,.5,.5),60),this.Zb.id==meId&&showShellStreakMessage(e)},[ShellStreak.DoubleEggs]:()=>{this.Zb.id==meId&&showShellStreakMessage(e)}};t[e]&&t[e](),this.Zb.id==meId&&shellStreakUiUpdate(e,!0),this.showSprites()},PlayerActor.prototype.endShellStreak=function(e){const t={[ShellStreak.HardBoiled]:()=>{this.Zb.id==meId&&updateHealthUI(),this.auraSprite&&(this.auraSprite.dispose(),this.auraSprite=null)},[ShellStreak.EggBreaker]:()=>{this.Zb.id==meId&&reticle.setPowerful(!1),this.Bz.renderOverlay=!1,this.hands.renderOverlay=!1},[ShellStreak.MiniEgg]:()=>{this.shellStreakShrinkPlayer(this.Xb,new Vector3(.5,.5,.5),new Vector3(1,1,1),60)}};t[e]?t[e]():console.warn(`Unknown ksType: ${e}`),this.Zb.id==meId&&shellStreakUiUpdate(e,!1)},PlayerActor.prototype.removeFromPlay=function(){this.zoomed=!1,this.throwingGrenade=!1,this.gripBone._frozen=!1,this.wieldingMelee=!1,this.Xb.setEnabled(!1),this.hideSprites()},PlayerActor.prototype.restoreToPlay=function(){this.Xb.setEnabled(!0),this.Zx.setEnabled(!0),this.Zb.id!=meId&&this.showSprites()},PlayerActor.prototype.remove=function(){this.Xb.dispose(),this.hideSprites()},PlayerActor.prototype.fire=function(){this.zoomed&&this.Zb.ib.hasScope?(shake=.15,this.eye.rotation.x=.05):settings.shakeEnabled&&(shake=.08*camera.undefinedc),this.wieldingMelee&&this.wieldGun()},PlayerActor.prototype.inspect=function(){this.Zb.ib&&!this.Zb.scope&&this.Zb.canSwapOrReload()&&this.Zb.ib.wb.inspect()},PlayerActor.prototype.melee=function(){this.Zb.id===meId&&(shake=.05),this.wieldingMelee||this.wieldMelee(),this.Zb.meleeWeapon.wb.attack()},PlayerActor.prototype.wieldMelee=function(){this.wieldingMelee=!0,this.Zb.ib.wb.restPose(),this.setWeaponSkeleton(this.Zb.meleeWeapon.wb.skeleton),this.Zb.meleeWeapon.wb.weaponMesh.setEnabled(!0),this.Zb.ib.wb.Fz.setEnabled(!1)},PlayerActor.prototype.inspectMelee=function(){this.wieldingMelee=!0,this.Zb.ib.wb.restPose(),this.setWeaponSkeleton(this.Zb.meleeWeapon.wb.skeleton),this.Zb.meleeWeapon.wb.weaponMesh.setEnabled(!0),this.Zb.ib.wb.Fz.setEnabled(!1),this.Zb.meleeWeapon.wb.inspect()},PlayerActor.prototype.wieldGun=function(){this.wieldingMelee=!1,this.setWeaponSkeleton(this.Zb.ib.wb.skeleton),this.Zb.meleeWeapon.wb.weaponMesh.setEnabled(!1),this.Zb.ib.wb.Fz.setEnabled(!0)},PlayerActor.prototype.reachForGrenade=function(){this.throwingGrenade=!0,stopAnimation(this.Zb.ib.wb.Fz),initAnimation(this.Zb.ib.wb.Fz,"fire"),playAnimation(this.hands,"grenade_grab")},PlayerActor.prototype.throwGrenade=function(){this.Zb.id==meId&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),playAnimation(this.hands,"grenade_throw")},PlayerActor.prototype.setShellColor=function(e){(e<0||e>=shellColors.length)&&(console.log("Shell color out of bounds: "+e),e=0);var t=Color3.FromHexString(shellColors[e]);this.Bz.shellColor=t,this.hands.shellColor=t},PlayerActor.prototype.setWeaponSkeleton=function(e){this.skeleton=e,this.weaponGripBone=this.skeleton.bones[this.skeleton.getBoneIndexByName("gripHand")],this.weaponForeBone=this.skeleton.bones[this.skeleton.getBoneIndexByName("foreHand")]},PlayerActor.prototype.handsToWeaponSkeleton=function(){this.gripBone.position=this.weaponGripBone.position,this.gripBone.setRotationQuaternion(this.weaponGripBone.rotationQuaternion),1!=this.throwingGrenade&&(this.foreBone.position=this.weaponForeBone.position,this.foreBone.setRotationQuaternion(this.weaponForeBone.rotationQuaternion))},PlayerActor.prototype.setupStowAnims=function(e,t){e=void 0===e?.14:e,t=t?-1:1;var i=new Animation("","rotation",60,Animation.ANIMATIONTYPE_VECTOR3,Animation.ANIMATIONLOOPMODE_CONSTANT),a=new Animation("","scaling",60,Animation.ANIMATIONTYPE_VECTOR3,Animation.ANIMATIONLOOPMODE_CONSTANT),n=new Animation("","position",60,Animation.ANIMATIONTYPE_VECTOR3,Animation.ANIMATIONLOOPMODE_CONSTANT),s=new CubicEase;s.setEasingMode(EasingFunction.EASINGMODE_EASEINOUT),i.setEasingFunction(s);var r=new CubicEase;r.setEasingMode(EasingFunction.EASINGMODE_EASEINOUT),a.setEasingFunction(r);var o=new CubicEase;o.setEasingMode(EasingFunction.EASINGMODE_EASEINOUT),n.setEasingFunction(o);var l=[{frame:0,value:new Vector3(.035,e*t,0)},{frame:25,value:new Vector3(-1,1.5*t,0)},{frame:30,value:new Vector3(1,1.5*t,0)},{frame:55,value:new Vector3(.035,e*t,0)}],c=[{frame:0,value:new Vector3(1,1,1)},{frame:25,value:new Vector3(.25*t,.25,.25)},{frame:30,value:new Vector3(.25*t,.25,.25)},{frame:55,value:new Vector3(1*t,1,1)}],h=[{frame:0,value:new Vector3(0,0,0)},{frame:25,value:new Vector3(.1*t,.1,.2)},{frame:30,value:new Vector3(.1*t,0,.2)},{frame:55,value:new Vector3(0,0,0)}];i.setKeys(l),a.setKeys(c),n.setKeys(h),this.Zx.animations.push(i),this.Zx.animations.push(a),this.Zx.animations.push(n)},PlayerActor.prototype.shellStreakShrinkPlayer=function(e,t,i,a){const n=new Animation("scalingAnimation","scaling",30,Animation.ANIMATIONTYPE_VECTOR3,Animation.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:t}),s.push({frame:a/2,value:i}),n.setKeys(s);const r=new ElasticEase;r.setEasingMode(EasingFunction.EASINGMODE_EASEINOUT),n.setEasingFunction(r),e.animations=[],e.animations.push(n),this.scene.beginAnimation(e,0,a,!1)},Player.OverlayColor={green:new Color3(0,1,0),red:new Color3(1,0,0)};var PlayerChallenges=class{resetInGame(){inGame&&hasValue(me)&&void 0!==me.Hc&&setTimeout((()=>{challengePlayerRerollInGame(me.Hc)}),100)}rerollError(e){this.rerollId=null,e.error&&(vueApp.showGenericPopup("uh_oh","chlg_no_challenges","ok"),this.log(1,e.error))}getNewSuccess(e){G.playerAccount.challenges=e,this.dailyTimerStart(),this.resetInGame()}timer(){let e=Math.floor(G.playerAccount.challengesDailyEnd-Date.now()/1e3);e<0&&(e=0,this.playerChallengesRequestNew||(this.playerChallengesRequestNew=!0,clearInterval(this.playerChallengesTimerInterval),this.playerChallengesTimerInterval=null,this.getNew()));const t={days:Math.floor(e/86400),hours:this.timeFormat(Math.floor(e%86400/3600)),minutes:this.timeFormat(Math.floor(e%3600/60)),seconds:this.timeFormat(e%60)};vueApp.player.challengeDailyData=t}rerollVipSuccess(e){if(e.challengeId===this.rerollId)this.log(1,"Challenge slot already rerolled!!!");else{const t=this.challengeGet(this.rerollId);this.rerollId=null,ga("send","event","dailyChallenge","reroll",t.loc_ref),G.playerAccount.challenges=e,this.resetInGame()}}constructor(){this.playerChallengesTimerInterval=null,this.playerChallengesRequestNew=!1,this.rerollId=null}getNew(){api_player_challenge_daily_request(this.getNewSuccess.bind(this),this.getNewError.bind(this))}dailyTimerStart(){null===this.playerChallengesTimerInterval&&(this.playerChallengesRequestNew=!1,this.playerChallengesTimerInterval=setInterval(this.timer.bind(this),1e3))}log(e,t){console.log(`PlayerChallenges ${["success","error"][e]}: ${t}`)}getNewError(){clearInterval(this.playerChallengesTimerInterval),this.playerChallengesTimerInterval=null,this.playerChallengesRequestNew=!1}rerollSuccess(){this.log(0,"Reroll check"),AIPVideoAds.adInPlayActive||window.crazySdk.initialized?(AIPVideoAds.challengeRerollRequest=this.rerollId,this.rerollId=null,AIPVideoAds.play("shellshock.io_rpreroll_30s")):(vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok"),this.log(1,"Reroll no video ads!"))}challengeGet(e){return Challenges&&Challenges.length>0?Challenges.find((t=>t.id===e)):null}reroll(e){this.rerollId=e,checkUpgrade((()=>{G.playerAccount.isUpgraded()?api_reroll_challenge_slot(e,this.rerollVipSuccess.bind(this),this.rerollVipError.bind(this)):api_reroll_challenge_slot_check(e,this.rerollSuccess.bind(this),this.rerollError.bind(this))}),(e=>{this.rerollId=null,AIPVideoAds.challengeRerollRequest=null,this.log(1,`reroll() ${JSON.stringify(e)}`)}))}claim(e){api_player_challenge_claim_reward(e,(t=>{if(G.playerAccount.challenges=t.challenges,t.reward){const i=this.challengeGet(e);ga("send","event","dailyChallenge","claim",i.loc_ref),vueApp.showGiveStuffPopup("challenge_reward",t.reward),api_checkBalance()}}),(e=>{this.log(1,e.error)}))}rerollVipError(e){this.rerollId=null,this.log(1,"Reroll VIP error"),console.log("playerChallengesReroll error: ",e.error),vueApp.showGenericPopup("uh_oh","chlg_no_challenges","ok")}timeFormat(e){return e<10?"0"+e:e.toString()}resizeTextToFit(e,t){const i=e.querySelector(".dynamic-text");if(!i)return;const a=e.clientWidth;e.clientHeight;let n=1;for(i.style.fontSize=n+"em";i.scrollWidth<=a&&n<t;)n+=.1,i.style.fontSize=n+"em";for(n=Math.min(n,t),i.style.fontSize=n+"em";i.scrollWidth>a&&n>.5;)n-=.01,i.style.fontSize=n+"em"}iconSrc(e){const t=e.toLowerCase(),i=Object.entries({kill_streak:"kill_streak.svg",time:"timed.svg",kill_kills:"kills-kills.svg",grenade:"grenade.svg",kill_con:"kills-shot.svg",cluck9mm:"cluck9mm.svg",scrambler:"scrambler.svg",rpegg:"rpegg.svg",whipper:"whipper.svg",eggk47:"eggk47.svg",freeranger:"freeranger.svg",crackshot:"crackshot.svg",trihard:"trihard.svg",melee:"melee.svg",damage:"damage.svg",deaths:"deaths.svg",distance:"distance.svg",jump:"jump.svg",collect:"collect.svg",kotc:"kotc.svg",cts:"cts.svg"}).find((([e])=>t.includes(e)));return i?`img/challenges/${i[1]}`:""}resizeAllText(){setTimeout((()=>{document.querySelectorAll(".dynamic-text").forEach((e=>{this.resizeTextToFit(e,1)}))}),10)}},pokiInitTracking=()=>{pokiActive&&(thirdPartyAdblocker||"undefined"!=typeof googletag&&window.googletag&&googletag.apiReady&&googletag.pubads().addEventListener("impressionViewable",(e=>{const t=e.slot.getSlotElementId(),i=document.getElementById(t).parentNode.id;i&&ga("send","event","Poki","Display ad",i)})))},pokiCommercialBreak=(e,t,i)=>{pokiActive&&(setVolume(0),inGame&&vueApp.hideGameMenu(),PokiSDK.commercialBreak().then((()=>{e&&e(),t&&t(),setVolume(),console.log("Poki end of commercial break")})).catch((()=>{console.log("Poki commercial break fails"),e&&e(),t&&t(),setVolume()})))},pokiRewardedBreak=(e,t)=>{pokiActive&&(setVolume(0),PokiSDK.rewardedBreak().then((()=>{pokiCurrencyReward(),e&&e(Reward.video),setVolume(),console.log("POKI Reward given")})).catch((e=>{console.log("Reward failed. ",e),t&&t(),setVolume()})))},pokiRewardBreakForNugget=e=>{setVolume(0),PokiSDK.rewardedBreak().then((()=>{setTimeout((()=>{e&&e()}),1e3)}))},pokiGameLoadingStart=()=>{pokiActive&&PokiSDK.gameLoadingStart()},pokiGameLoadingFinished=()=>{pokiActive&&PokiSDK.gameLoadingFinished()},pokiGameLoadingProgress=e=>{pokiActive&&PokiSDK.gameLoadingFinished(e)},pokiGamePlayStart=()=>{pokiActive&&PokiSDK.gameplayStart()},pokiGamePlayStop=()=>{pokiActive&&PokiSDK.gameplayStop()},pokiHappyTime=e=>{pokiActive&&PokiSDK.happyTime(e)},pokiKillStreakHappyTimes=e=>{if(pokiActive)switch(e){case 5:pokiHappyTime(.3);break;case 10:pokiHappyTime(.5);break;case 20:pokiHappyTime(.7);break;case 40:pokiHappyTime(1)}},pokiCurrencyReward=()=>{},isItTimeForPokiReward=()=>{pokiActive&&(vueData.isPokiGameLoad=!0)},clearPokiRewardTimer=()=>{pokiActive&&(console.log("clearPokiRewardTimer"),vueData.isPokiGameLoad=!1,vueData.isPokiNewRewardTimer=!1,vueData.pokiRewardReady=!1)},Product=class{getBundlesByItemId(e){return this.getBundles().filter((t=>this.matchItemIds(t.itemIds,e)))}isInitialized(){return!!this.initialized||(console.warn("Product class not initialized."),!1)}getPassByItemId(e){return this.categories.pass.filter((t=>this.matchItemIds(t.itemIds,e)))}getProductByItemIds(e,t){return this.isInitialized()&&this.categories[e]?this.categories[e].filter((e=>this.matchItemIds(e.itemIds,t))):[]}getActiveByType(e){return this.isInitialized()&&this.categories[e]?.filter((e=>e.isActive))||[]}getBundles(){return this.getActiveByType("bundle")}getProductTitleByEggValue(e){if(!this.isInitialized())return null;const t=this.categories.currency.find((t=>t.currency===e));return t?.sku||null}getShopItems(){return this.isInitialized()?this.categories.item.filter((e=>e.isActive)):[]}matchItemIds(e,t){return!(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)&&e.every(((e,i)=>e===t[i]))}constructor(){this.categories={currency:[],item:[],subscription:[],pass:[],bundle:[]},this.initialized=!1,this.welcomeBundleItemId=welcomePassItemId}getProductType(e){const t=this.getBySku(e);return t?.type||null}storeItemsFilterPassBundle(e){const t=G.catalog.findItemById(welcomePassItemId);if(!t)return e.filter((e=>"pass"!==e.type));return G.playerAccount.isItemOwned(t)?e.filter((e=>"pass"!==e.type)):e.filter((e=>1!==e.id))}init(){SsProducts&&Array.isArray(SsProducts)?(Object.keys(this.categories).forEach((e=>{this.categories[e]=SsProducts.filter((t=>t.type===e))})),this.initialized=!0):console.log("No products")}getBySku(e){if(this.isInitialized())return SsProducts.find((t=>t.sku===e))||null}getSubscriptions(){return this.getActiveByType("subscription")}getStoreItems(){if(!this.isInitialized())return[];const e=SsProducts.filter((e=>e.inStore&&e.isActive));return e.length?this.categories.pass.length>0?this.storeItemsFilterPassBundle(e):e:[]}},ReliableWebSocket=class{onclose(e){}constructor(e){this.url=e,this.ws=null,this.queue=[],this.reconnectTimeout=null,this.reconnectTimeoutTime=0,this.pingInterval=null,this.connect(e)}onerror(e){}connect(){if(!this.ws||this.ws.readyState!==WebSocket.CONNECTING&&this.ws.readyState!==WebSocket.OPEN){console.log(`ReliableWebSocket: Connecting to ${this.url}`);try{this.ws=new WebSocket(this.url)}catch(e){return void this._onerror(e)}this.ws.onopen=()=>{console.log(`ReliableWebSocket: Connected to ${this.url}`),this.reconnectTimeoutTime=0,this.queue.forEach((e=>{this.ws.send(e)})),this.queue=[],this.pingInterval=setInterval((()=>{this.ws.send("ping")}),3e4),this.onopen()},this.ws.onclose=e=>{console.log(`ReliableWebSocket: Disconnected from ${this.url} with code ${e.code} - Attempting to reconnect in ${this.reconnectTimeoutTime} seconds...`),clearInterval(this.pingInterval),e.code===CloseCode.NORMAL_CLOSURE||this.reconnectTimeout||(this.reconnectTimeout=setTimeout((()=>{this.reconnectTimeout=null,this.connect()}),1e3*this.reconnectTimeoutTime),this.reconnectTimeoutTime=Math.min(this.reconnectTimeoutTime+1,10)),this.onclose(e)},this.ws.onerror=e=>this._onerror(e),this.ws.onmessage=e=>this.onmessage(e)}}_onerror(e){this.reconnectTimeoutTime>4&&(this.queue=[],this.onerror(e))}onmessage(e){}send(e){this.ws.readyState===WebSocket.OPEN?this.ws.send(e):(this.queue.push(e),this.ws.readyState!==WebSocket.CONNECTING&&this.connect())}onopen(){}},RewardGive=class{tryReward(){this.isEligible()&&(inGame||this.doReward())}constructor(e=16029,t=1250){this.eggs=t,this.itemId=e,this.locGiveEggs="ab_test_inventory_title",this.locGiveGrenade="ab_test_inventory_title_grenade",this.accountLength=12096e5}doReward(){vueApp.giveStuffPopup.titleLoc=this.locGiveGrenade,this.rewardedItem=G.catalog.findItemById(this.itemId),api_giveItemReward("abTestReward",(()=>{this.addItemToInventory(),vueApp.showGiveStuffPopup("abTestReward_title",0,[this.rewardedItem],"abTestReward")}))}isEligible(){if(this.isItemOwned())return!1;return localStore.getItem("lastPreRoll")&&G.playerAccount.accountAge<this.accountLength}isItemOwned(){const e=G.catalog.findItemById(this.itemId);return G.playerAccount.isItemOwned(e)}addItemToInventory(){this.rewardedItem&&G.playerAccount.addToInventory(this.rewardedItem,!0)}};function RocketActor(e){this.rocket=e,this.scene=e.scene,this.armed=!1,this.delayFrames=0,this.Xb=this.scene.getMeshByName("rocket").createInstance(""),this.Xb.setEnabled(!1)}RocketActor.v3_1=new Vector3,RocketActor.prototype.fire=function(){this.armed=!1,this.delayFrames=2,this.Xb.position.x=this.rocket.x,this.Xb.position.y=this.rocket.y,this.Xb.position.z=this.rocket.z;var e=RocketActor.v3_1;e.set(this.rocket.x+this.rocket.dx,this.rocket.y+this.rocket.dy,this.rocket.z+this.rocket.fb),this.Xb.lookAt(e)},RocketActor.prototype.update=function(){if(--this.delayFrames<=0&&this.Xb.setEnabled(!0),!this.armed&&this.rocket.minRange<=0&&(this.armed=!0,pAudio.play("gun_rpegg_rocket_fly",this.Xb.position,!0)),this.delayFrames%2==0){var e=.04*Math.random()-.02,t=.04*Math.random()-.02,i=.04*Math.random()-.02;this.armed&&(addExplosionSprite(explosionSmokeManager,30,this.rocket.x,this.rocket.y,this.rocket.z,e,t,i,.4,!1,null),addExplosionSprite(explosionFireManager,10,this.rocket.x,this.rocket.y,this.rocket.z,e,t,i,.4,!1,null))}this.Xb.position.x+=.5*(this.rocket.x-this.Xb.position.x),this.Xb.position.y+=.5*(this.rocket.y-this.Xb.position.y),this.Xb.position.z+=.5*(this.rocket.z-this.Xb.position.z)},RocketActor.prototype.remove=function(){this.Xb.setEnabled(!1)};var debug=!1,isLocalShellDev=location.hostname.startsWith("localshelldev"),isLocalHost=location.hostname.startsWith("localhost");G.servicesServer=`${isHttps()?"wss":"ws"}://${location.hostname}/services/`;var portalTest=new URLSearchParams(location.search).get("portalTest");portalTest&&(dynamicContentRoot=`${portalTest}.shellshock.io`,dynamicContentPrefix=`https://${portalTest}.shellshock.io/`),dynamicContentRoot?G.servicesServer=(isHttps()?"wss":"ws")+"://"+dynamicContentRoot+"/services/":(isLocalHost||isLocalShellDev||location.hostname.startsWith("staging"))&&(debug=!0);var sessionStats=class{constructor(){this.kills=0,this.deaths=0,this.suicides=0,this.streak=0,this.weapons={},this.sessionStart=0,this.sessionEnd=0,this.endTime=0,this.playTime=0,this.ratio=0,this.charClass={},this.init()}getPlayTime(){this.sessionEnd=Date.now()-this.sessionStart;const e=(this.sessionEnd%6e4/1e3).toFixed(0);this.playTime=Math.floor(this.sessionEnd/6e4)+":"+(e<10?"0":"")+e}get kills(){return this._kills}set deaths(e){this._deaths=e,this.getRatio()}end(){this.endTime=this.getPlayTimeInGame(),this.getPlayTime()}start(){this.sessionStart=Date.now()}getPlayTimeInGame(){if(!this.sessionStart)return"0:00";const e=Date.now()-this.sessionStart,t=(e%6e4/1e3).toFixed(0);return Math.floor(e/6e4)+":"+(t<10?"0":"")+t}set kills(e){this._kills=e,this.getRatio()}getRatio(){this.ratio=Math.floor(this.kills/Math.max(this.kills+this.deaths,1)*100)}updateTerminus(e,t,i,a){this.charClass[e][t][i]++,this.charClass[e][i]++,this.weapons[t][i]++,this[i]++,a&&this.suicides++}init(){this.setupWeapons(),this.start()}setupWeapons(){DmgType.forEach((e=>this.weapons[e.name]={deaths:0,kills:0})),Object.keys(CharClass).forEach((e=>this.charClass[e]=JSON.parse(JSON.stringify(this.weapons)))),Object.keys(this.charClass).forEach((e=>{this.charClass[e].kills=0,this.charClass[e].deaths=0})),console.log(this.charClass)}get deaths(){return this._deaths}getStats(){return{kills:this.kills,deaths:this.deaths,suicides:this.suicides,weapons:this.weapons,charClass:this.charClass,playTime:this.getPlayTimeInGame(),endTime:this.endTime,ratio:this.ratio}}};function loadSettings(){(settings={volume:getStoredNumber("volume",.6),mouseSensitivity:getStoredNumber("mouseSensitivity",null),mouseSpeed:getStoredNumber("mouseSpeed",50),mouseInvert:getStoredNumber("mouseInvert",1),fastPollMouse:getStoredBool("fastPollMouse",!1),holdToAim:getStoredBool("holdToAim",!0),enableChat:getStoredBool("enableChat",!0),safeNames:getStoredBool("safeNames",!1),autoDetail:getStoredBool("autoDetail",!0),shadowsEnabled:getStoredBool("shadowsEnabled",!0),highRes:getStoredBool("highRes",!0),controllerSpeed:getStoredNumber("controllerSpeed",20),deadzone:getStoredNumber("deadzone",.3),controllerInvert:getStoredNumber("controllerInvert",1),controls:getStoredObject("controls",getDefaultControls()),musicVolume:getStoredNumber("musicVolume",.5),musicStatus:getStoredBool("musicStatus",!0),hideBadge:getStoredBool("hideBadge",!1),closeWindowAlert:getStoredBool("closeWindowAlert",!1),shakeEnabled:getStoredBool("shakeEnabled",!0),centerDot:getStoredBool("centerDot",!0),hitMarkers:getStoredBool("hitMarkers",!0)}).mouseSpeed||null===settings.mouseSensitivity||(settings.mouseSpeed=Math.floor(Math.sqrt(350*settings.mouseSensitivity)+19),localStore.removeItem("mouseSensitivity")),fillMissingControls(),setInputMap(settings.controls),vueApp.setUiSettings(settings)}function saveSettings(){localStore.setItem("volume",settings.volume),localStore.setItem("mouseSpeed",settings.mouseSpeed),localStore.setItem("mouseInvert",settings.mouseInvert),localStore.setItem("fastPollMouse",settings.fastPollMouse),localStore.setItem("holdToAim",settings.holdToAim),localStore.setItem("enableChat",settings.enableChat),localStore.setItem("safeNames",settings.safeNames),localStore.setItem("autoDetail",settings.autoDetail),localStore.setItem("shadowsEnabled",settings.shadowsEnabled),localStore.setItem("highRes",settings.highRes),localStore.setItem("controllerSpeed",settings.controllerSpeed),localStore.setItem("deadzone",settings.deadzone),localStore.setItem("controllerInvert",settings.controllerInvert),localStore.setItem("controls",JSON.stringify(settings.controls)),localStore.setItem("musicVolume",settings.musicVolume),localStore.setItem("musicStatus",settings.musicStatus),localStore.setItem("hideBadge",settings.hideBadge),localStore.setItem("closeWindowAlert",settings.closeWindowAlert),localStore.setItem("shakeEnabled",settings.shakeEnabled),localStore.setItem("centerDot",settings.centerDot),localStore.setItem("hitMarkers",settings.hitMarkers)}function applyUiSettings(e,t){Object.values(e.adjusters).forEach((e=>{e.forEach((e=>{settings[e.id]=e.value}))})),Object.values(e.togglers).forEach((e=>{e.forEach((e=>{"mouseInvert"===e.id||"controllerInvert"==e.id?settings[e.id]=e.value?-1:1:settings[e.id]=e.value}))})),e.controls.keyboard.game.forEach((e=>{settings.controls.keyboard.game[e.id]=e.value})),e.controls.keyboard.spectate.forEach((e=>{settings.controls.keyboard.spectate[e.id]=e.value})),e.controls.gamepad.game.forEach((e=>{settings.controls.gamepad.game[e.id]=e.value})),e.controls.gamepad.spectate.forEach((e=>{settings.controls.gamepad.spectate[e.id]=e.value})),setInputMap(settings.controls),setVolume(),setMouseSpeed(settings.mouseSpeed),setControllerSpeed(settings.controllerSpeed),setDeadzone(settings.deadzone),enableChat(settings.enableChat),gameScene&&(settings.autoDetail?t.autoDetail||(setHighRes(!0),setShadows(!0),enableAutoDetail()):(setHighRes(settings.highRes),setShadows(settings.shadowsEnabled),disableAutoDetail()),settings.centerDot?reticle.showDot():reticle.hideDot(),settings.hitMarkers?hitMarkers.show():hitMarkers.hide()),saveSettings()}function setInputMap(e){inputToControlMap={keyboard:{game:{},spectate:{}},gamepad:{game:{},spectate:{}}},Object.keys(e.keyboard).forEach((t=>{Object.keys(e.keyboard[t]).forEach((i=>{inputToControlMap.keyboard[t][e.keyboard[t][i]]=i}))})),Object.keys(e.gamepad).forEach((t=>{Object.keys(e.gamepad[t]).forEach((i=>{inputToControlMap.gamepad[t][e.gamepad[t][i]]=i}))}))}function getDefaultControls(){return{keyboard:{game:{up:"W",down:"S",left:"A",right:"D",jump:"SPACE",melee:"F",inspect:"G",fire:"MOUSE 0",scope:"SHIFT",reload:"R",swap_weapon:"E",grenade:"Q",despawn:"P"},spectate:{ascend:"SPACE",descend:"SHIFT",toggle_freecam:"V",slow:"MOUSE 0"}},gamepad:{game:{jump:0,fire:7,scope:6,reload:2,swap_weapon:3,grenade:5,melee:1,inspect:4},spectate:{ascend:6,descend:7}}}}function fillMissingControls(){!function e(t,i){Object.keys(t).forEach((a=>{"object"==typeof t[a]?(i[a]||(i[a]={}),e(t[a],i[a])):i[a]||(i[a]=t[a])}))}(getDefaultControls(),settings.controls)}function resetSettings(){localStore.removeItem("volume"),localStore.removeItem("mouseSensitivity"),localStore.removeItem("mouseSpeed"),localStore.removeItem("mouseInvert"),localStore.removeItem("fastPollMouse"),localStore.removeItem("holdToAim"),localStore.removeItem("enableChat"),localStore.removeItem("safeNames"),localStore.removeItem("autoDetail"),localStore.removeItem("shadowsEnabled"),localStore.removeItem("highRes"),localStore.removeItem("controlConfig"),localStore.removeItem("controllerSpeed"),localStore.removeItem("deadzone"),localStore.removeItem("controllerInvert"),localStore.removeItem("controls"),localStore.removeItem("hideBadge"),localStore.removeItem("closeWindowAlert"),localStore.removeItem("shakeEnabled"),localStore.removeItem("centerDot"),loadSettings()}function setMusicVolume(e){settings.musicVolume=e,vueApp.musicVolumeControl(settings.musicVolume),localStore.setItem("musicVolume",settings.musicVolume)}function setVolumeSetting(e){settings.volume=e,localStore.setItem("volume",settings.volume)}function setVolume(e,t){if(0===e)return console.log("game volume suspended"),vueApp.volume=0,BAWK.setVolume(0),BAWK.suspend();e=e||settings.volume,console.log("volume set to: "+e),BAWK.resume(),BAWK.setVolume(e),vueApp.volume=e}function setMouseSpeed(e){settings.mouseSpeed=e}function setControllerSpeed(e){settings.controllerSpeed=e}function setDeadzone(e){settings.deadzone=e}function setMusicStatus(e){localStore.setItem("musicStatus",e),settings.musicStatus=e,vueApp.setUiSettings(settings)}function SpatulaActor(e,t){this.spatula=e,this.scene=e.scene,this.Xb=cloneMesh("spatula",t),this.Xb.material=gameScene.getMaterialByName("emissive"),this.Xb.emissiveColor=new Color3(.8,.6,.2),this.Xb.setRenderingGroupId(1)}function Spectator(){this.dx=0,this.dy=0,this.fb=0,this.speedMultiplier=1,this.dampenLambda=.2,this.playerIdx=0}SpatulaActor.prototype.dispose=function(){this.Xb.dispose()},SpatulaActor.prototype.drop=function(){this.Xb.parent=null,BAWK.play("drop_spatula")},SpatulaActor.prototype.capture=function(e){this.Xb.parent=e.wb.Bz,this.Xb.position.set(0,-.2,.3),this.Xb.rotation.y=0},SpatulaActor.prototype.update=function(e){255==this.spatula.vz?(this.Xb.position.x+=.5*(this.spatula.x-this.Xb.position.x),this.Xb.position.y+=.5*(this.spatula.y+.1-this.Xb.position.y),this.Xb.position.z+=.5*(this.spatula.z-this.Xb.position.z),this.Xb.rotation.y+=.1*e):this.Xb.parent.parent.mb(!0)};var Spectate={freeCamera:0,firstPerson:1};Player.Wb=new Vector3,Player.qb=new Vector3,Player.ray=new Ray,Player.matrix=new Matrix;var dampen=function(e,t,i,a){return Scalar.Lerp(e,t,1-Math.exp(-i*a))};function fireLoadEvent(e){let t=Date.now()-gaStartTime;ga("send","event","onLoad",e?"loaded":"loading",Math.floor(t/1e3)+" - seconds"),e&&clearInterval(gaIntervalId)}Spectator.prototype.firstPerson=function(){let e=players[this.playerIdx];e&&e.Rb&&this.playerIdx!==meId||(e=this.findNextPlayer()),e&&this.spectatePlayer(e)},Spectator.prototype.freeCamera=function(){viewingPlayerId!==meId&&(me.Jb=camera.rotation.x,me.pb=camera.rotation.y),camera.parent=null,camera.lockedTarget=null,viewingPlayerId=meId,viewingPlayer=me,controlKeys=0,vueData.ui.game.spectatingPlayerName=null,this.restorePreviousPlayerActor()},Spectator.prototype.restorePreviousPlayerActor=function(){let e=players[this.playerIdx];e&&e.wb.hat&&e.wb.hat.mb(!0)},Spectator.prototype.spectatePlayer=function(e){this.restorePreviousPlayerActor(),this.playerIdx=e.id,viewingPlayerId=e.id,viewingPlayer=e,e.wb.Xb.mb(!0),e.wb.hat&&e.wb.hat.mb(!1),camera.lockedTarget=null,mapOverview=!1,rebuildPlayerList(),vueData.ui.game.spectatingPlayerName=e.name,gameScene.autoClear=!0,gameScene.autoClearDepthAndStencil=!0},Spectator.prototype.spectateNextPlayer=function(e=1){let t=this.findNextPlayer(e);t&&this.spectatePlayer(t)},Spectator.prototype.findNextPlayer=function(e=1){let t=null;for(var i=[],a=0;a<playerLimit;a++){let e=players[a];e&&i.push(e.id)}if(0===i.length)return this.unlock(),null;metaGameUI.sortPlayerList(i);for(let e=0;e<i.length;e++)if(players[i[e]].id===this.playerIdx){t=e;break}null===t&&(t=0);let n=t;for(;n=Math.mod(n+e,i.length),n!==t;){let e=players[i[n]];if(e&&e.Rb&&e.id!==meId)return e}return this.unlock(),null},Spectator.prototype.unlock=function(){viewingPlayerId=null,viewingPlayer=null,this.playerIdx=null},Spectator.prototype.update=function(e){if(spectateMode===Spectate.firstPerson)viewingPlayer&&viewingPlayer.Rb&&(camera.position.copyFrom(viewingPlayer.wb.eye.getAbsolutePosition()),camera.rotation.y=viewingPlayer.wb.Xb.rotation.y+Math.PI,camera.rotation.x=-viewingPlayer.wb.head.rotation.x);else{var t=0,i=0,a=0;controlKeys&CONTROL.left&&(t+=Math.cos(me.pb),a-=Math.sin(me.pb)),controlKeys&CONTROL.right&&(t-=Math.cos(me.pb),a+=Math.sin(me.pb)),controlKeys&CONTROL.up&&(t+=Math.sin(me.pb),a+=Math.cos(me.pb)),controlKeys&CONTROL.down&&(t-=Math.sin(me.pb),a-=Math.cos(me.pb)),controlKeys&CONTROL.ascend&&(i=1),controlKeys&CONTROL.descend&&(i=-1);var n=new Vector3(t,i,a).normalize(),s=this.dx,r=this.dy,o=this.fb;this.dx+=.016*n.x,this.dy+=.008*n.y,this.fb+=.016*n.z;var l=.5*(this.dx+s),c=.5*(this.dy+r),h=.5*(this.fb+o);camera.position.x+=l*e*this.speedMultiplier,camera.position.y+=c*e*this.speedMultiplier,camera.position.z+=h*e*this.speedMultiplier,camera.position.y=Math.min(Math.max(1.5,camera.position.y),50),me.jb=camera.position.x,me.Vb=camera.position.y,me.Lb=camera.position.z,this.dx=dampen(this.dx,0,this.dampenLambda,e),this.dy=dampen(this.dy,0,this.dampenLambda,e),this.fb=dampen(this.fb,0,this.dampenLambda,e),camera.rotation.x=-me.Jb,camera.rotation.y=me.pb}},Spectator.prototype.startSlow=function(){this.speedMultiplier=.1,this.dampenLambda=.075},Spectator.prototype.endSlow=function(){this.speedMultiplier=1,this.dampenLambda=.2},window.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),window.onresize=function(){resize()},window.mobileAndTabletcheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),/Googlebot/i.test(navigator.userAgent)&&(e=!1),e},window.onloadingcomplete=function(){if("undefined"==typeof startVue||"undefined"==typeof firebase)return void setTimeout(window.onloadingcomplete,100);if(AbUrlTestParam=new URL(window.location.href).searchParams.get("abTest"),AbFreeGamesRedirect=new ABTest({a:20}),abTestRedirectCheck(),playShellshockers())return console.log("startShellShockers"),startShellShockers("en.json"),void(window.onload=null);const e=location.protocol+"//"+location.host;window.location.href=e+"/portals"},window.addEventListener("beforeunload",(e=>{if(inGame&&settings.closeWindowAlert){const t="Are you sure you want to exit?";return e.preventDefault(),e.returnValue=t,hasValue(SessionStats.sessionStart)&&(gaSessionPlayTime(gameStartTime,maps[mapIdx].name),gaSendPlayerStats(SessionStats.end()),gaSendGameStats()),t}}));var gaStartTime=Date.now(),gaIntervalId=setInterval((()=>{Date.now();fireLoadEvent(!1)}),5e3);function buyProductForMoney(e){parsedUrl.dom+parsedUrl.top!=="devshellshock"||localStore.getItem("xsollaPopupConfrim")?(selectedSku=e,getXsollaToken(e,"subscription"===shellProducts.getProductType(e)),localStore.removeItem("xsollaPopupConfrim")):vueApp.openDevXsollaPopup(e)}function buyGoldenChicken(){getXsollaToken("golden_chicken_pass")}function getPlayerPortalSource(){let e="Shell Shockers";return pokiActive?e="Poki":crazyGamesActive&&(e="Crazy Games"),e}function accountGate(e){const t=e===welcomePassSku,{isAnonymous:i,isEmailVerified:a,firebaseId:n}=G.playerAccount;if(t){const e=!!n;return e||vueApp.showGenericPopup("player_not_found_title","player_not_found_welcome_bundle_desc","ok"),e}return!(i||!a)||(vueApp.denyAnonUser(),!1)}function getXsollaToken(e,t){const i=getPlayerPortalSource();if(console.log("getXsollaToken called (firebase ID: {0})".format(G.playerAccount.firebaseId),t),selectedSku=e,accountGate(e)){api_xsollaToken(e,(function(e){e.error?(console.log("xsollaTokenResponse Error: "+JSON.stringify(e)),disableProductPurchasing()):(console.log("response: "+JSON.stringify(e)),"SUCCESS"==e.result?(console.log("Got Xsolla token: "+e.token),openXsollaPayStation(e.token),console.log(e)):(console.log("Failed to get Xsolla token"),purchasingFailed()))}),(function(e){console.log("Error getting Xsolla token: "+JSON.stringify(e)),purchasingFailed()}),t,i)}}fireLoadEvent(0);var xsollaAnalytics=()=>{if(!hasValue(selectedSku))return;let e=vueData.eggStoreItems.filter((e=>e.sku===selectedSku))[0],t=e.sku,i=e.salePrice?Math.round(e.salePrice):"",a=Math.round(e.price),n=i||a;if(!hasValue(t)&&!hasValue(n))return console.log("No Price no sku"),void(selectedSku=null);let s=vueApp.eggStoreReferral?t+" "+vueApp.eggStoreReferral:t;return selectedSku=null,ga("send","event",vueApp.googleAnalytics.cat.purchases,vueApp.googleAnalytics.action.purchaseComplete,s,n)};function openXsollaPayStation(e){var t={access_token:e,sandbox:location.hostname.startsWith("localshelldev")||location.hostname.startsWith("staging"),lightbox:{spinner:"round",overlayOpacity:.8}},i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="//static.xsolla.com/embed/paystation/1.0.7/widget.min.js",i.addEventListener("load",(function(e){XPayStationWidget.on("init",(function(e){console.log("Xsolla PayStation initialized"),XPayStationWidget.open()})),XPayStationWidget.on("close",(function(e){console.log("Xsolla PayStation closed"),inGame?(vueApp.showGameMenu(),vueApp.setDarkOverlay(!1)):vueApp.toggleTitleScreenAd(!0),setTimeout((function(){api_checkBalance(),checkUpgrade()}),3e3)})),XPayStationWidget.on("open",(function(e){inGame?vueApp.hideGameMenu():vueApp.toggleTitleScreenAd(!1),console.log("Xsolla PayStation open"),console.log(selectedSku)})),XPayStationWidget.on("status",(function(e){console.log("Xsolla PayStation status"),console.log("status",e),console.log(selectedSku)})),XPayStationWidget.on("status-invoice",(function(e){console.log("Xsolla PayStation status-invoice"),console.log("status-invoice",e),console.log(selectedSku)})),XPayStationWidget.on("status-delivering",(function(e){console.log("Xsolla PayStation status-delivering"),console.log("status-delivering",e),console.log(selectedSku)})),XPayStationWidget.on("status-done",(function(e){console.log("Xsolla PayStation status-done"),console.log("status-done",e),console.log(selectedSku),localStore.setItem("xsollaPurchase",!0),"golden_chicken_pass"===selectedSku&&pokiHappyTime(1),xsollaAnalytics()})),XPayStationWidget.init(t)}),!1),document.getElementsByTagName("head")[0].appendChild(i),xsollaSetup=!0}function purchasingFailed(){vueApp.showGenericPopup("uh_oh","purchase_disabled","ok")}function buyEggs(){purchasingEnabled?XPayStationWidget.open():getXsollaTokenForStore(!0)}MetaGameKing.state={start:0,fz:1,win:2,capturing:3,contested:4,takeover:5,abandoned:6,unclaimed:7},MetaGameKing.captureSpeeds=[1.2,1.5,2.04,3,4.8],MetaGameKing.goalScore=5,MetaGameKing.takeOverTime=90,MetaGameKing.takeOverSpeed=1;var MapTools=class{static stripTris(e,t,i,a){for(var n=i.getIndices(),s=i.getVerticesData(VertexBuffer.PositionKind),r=i.getVerticesData(VertexBuffer.NormalKind),o=new Vector3,l=new Vector3,c=[],h={x:0,y:0,z:0},u=0;u<n.length;u+=3){for(var m=!1,d=0,f=0,p=0,_=0,g=0,v=0,y=0;y<3;y++){var S=n[u+y],C=a[S];if(S*=3,!C){m=!0;break}{d=s[S+0],f=s[S+1],p=s[S+2];let i=1024,a=.5/i;d=Math.floor((d+a)*i)/i,f=Math.floor((f+a)*i)/i,p=Math.floor((p+a)*i)/i,h.x=d-C.x,h.y=f-C.y,h.z=p-C.z;var E=this.normalizeManhattan(h);_=.75*r[S+0],g=.75*r[S+1],v=.75*r[S+2];if(E){if(o.set(_,g,v).normalize(),l.set(h.x,h.y,h.z).normalize(),Vector3.Dot(o,l)<.5){m=!0;break}var A=Math.floor(C.x+_+.5),T=Math.floor(C.y+g+.5),M=Math.floor(C.z+v+.5)}else A=Math.floor(d+h.x+.5),T=Math.floor(f+h.y+.5),M=Math.floor(p+h.z+.5);if(!m)try{var x=e[A][T][M];if(!x||!x.idx){m=!0;break}if(!t[x.idx].name.endsWith(".full")||"SPECIAL"===t[x.idx].theme){m=!0;break}}catch(e){m=!0;break}}}m&&(c.push(n[u+0]),c.push(n[u+1]),c.push(n[u+2]))}return console.log("stripped "+(n.length-c.length)+" tris",n.length,c.length),i.setIndices(c),i}static bx(e,t,i,a,n,s){var r;if(a){if(!i.data[a])return void s();r=[a]}else r=Object.keys(i.data);var o=[],l=new SolidParticleSystem("SPS",e,{updatable:!0,autoFixFaceOrientation:!1});l.computeParticleColor=!1,l.computeParticleTexture=!1,l.computeParticleRotation=!1,l.recomputeNormals=!1;var c=function e(c){if(c!=r.length){var h=r[c],u=i.data[h],m=t[h];void 0===(v=mapMeshes[m])&&console.log("mesh not found: "+h);var d=h.split(".");if(v.theme=d[0],v.colliderType=d[2],v.softness=d[3],"SPECIAL"!=v.theme&&("DYNAMIC"!=v.theme||a)){var f,p=0,_=Object.values(u).filter((e=>!n||e.zone==n));l.addShape(v,_.length,{positionFunction:function(e,t,a){var n=_[p].rx||0,s=_[p].ry||0,r=_[p].rz||0;e.position.x=_[p].x+i.extents.x.min,e.position.y=_[p].y+i.extents.y.min,e.position.z=_[p].z+i.extents.z.min,e.rotation.x=n*rotInc,e.rotation.y=s*rotInc,e.rotation.z=r*rotInc,e.alive=!1,f=h.endsWith(".full")||h.includes("capture-zone")?{x:e.position.x,y:e.position.y,z:e.position.z}:0,p++},vertexFunction:function(e,t,i){o.push(f)}})}var g=e.bind(this,c+1);window.requestAnimationFrame(g)}else{var v=l.buildMesh();s(v,o)}}.bind(this,0);window.requestAnimationFrame(c)}static normalizeManhattan(e){var t=Math.abs(e.x),i=Math.abs(e.y),a=Math.abs(e.z),n=Math.max(t,Math.max(i,a));return 0==n?(e.x=0,e.y=0,e.z=0):(e.x=.5*Math.trunc(e.x/n),e.y=.5*Math.trunc(e.y/n),e.z=.5*Math.trunc(e.z/n)),e.x*e.y!=0||e.x*e.z!=0||e.y*e.z!=0}};window.extern={catalog:G.catalog,play:play,getLanguageData:getLanguageData,continueStartup:continueStartup,showSignInDialog:showSignInDialog,signOut:signOut,sendFirebaseVerificationEmail:sendFirebaseVerificationEmail,selectRegion:selectRegion,generateRandomName:generateRandomName,changeClass:changeClass,toggleFullscreen:toggleFullscreen,applyUiSettings:applyUiSettings,resetSettings:resetSettings,setVolume:setVolume,setSafeNames:setSafeNames,setMouseSpeed:setMouseSpeed,setControllerSpeed:setControllerSpeed,setDeadzone:setDeadzone,setShadows:setShadows,renderItemToCanvas:renderItemToCanvas,getEquippedItems:getEquippedItems,getTaggedItems:getTaggedItems,getPremiumItems:getPremiumItems,getItemsOfType:getItemsOfType,isItemOwned:isItemOwned,tryEquipItem:tryEquipItem,poseWithItems:(e,t,i)=>paperDoll.poseWithItems(e,t,i),setShellColor:setShellColor,setStampPosition:setStampPosition,api_checkBalance:api_checkBalance,checkUpgrade:checkUpgrade,api_buy:api_buy,api_redeem:api_redeem,saveEquipment:saveEquipment,buyGoldenChicken:buyGoldenChicken,checkStartChicknWinner:checkStartChicknWinner,api_feedback:api_feedback,releaseKeys:releaseKeys,captureKeys:captureKeys,respawn:respawn,leaveGame:leaveGame,openEquipInGame:openEquipInGame,closeEquipInGame:closeEquipInGame,buyProductForMoney:buyProductForMoney,clickedHouseAdSmall:clickedHouseAdSmall,clickedHouseAdBig:clickedHouseAdBig,clickedHouseLink:clickedHouseLink,doConsent:doConsent,doNotConsent:doNotConsent,setOfAge:setOfAge,setTargetedAds:setTargetedAds,settingsMenuOpened:settingsMenuOpened,copyFriendCode:copyFriendCode,switchTeam:switchTeam,onChatKeyDown:onChatKeyDown,startChat:startChat,stopChat:stopChat,selectGameType:selectGameType,inviteFriends:inviteFriends,hasHouseLink:hasHouseLink,enterSpectatorMode:enterSpectatorMode,fixStringWidth:fixStringWidth,filterUnicode:filterUnicode,clickedWebFeedItem:clickedWebFeedItem,pokiRewardedBreak:pokiRewardedBreak,api_inGameReward:api_inGameReward,socialReward:socialReward,getHouseAd:getHouseAd,getLocText:getLocText,GameType:GameType,resize:resize,giveBasketBrosReward:giveBasketBrosReward,resetPaperDoll:resetPaperDoll,getSessionStats:getSessionStats,getProductTitle:getProductTitle,chwTryPlay:chwTryPlay,api_incentivizedVideoRewardRequest:api_incentivizedVideoRewardRequest,getProductTitleByEggVaule:getProductTitleByEggVaule,accountCreationNotification:accountCreationNotification,sendChat:sendChat,getActiveBundles:getActiveBundles,requestJson:requestJson,sendGameOptions:sendGameOptions,sendGameOptionsMetrics:sendGameOptionsMetrics,sendGameAction:sendGameAction,GameOptions:GameOptions,GameActions:GameActions,GameFlags:GameFlags,chwResetWithEggs:chwResetWithEggs,prepRespawnButton:prepRespawnButton,onChromeIsABuggerPopupConfirm:onChromeIsABuggerPopupConfirm,loadAllMeshesOnDemand:loadAllMeshesOnDemand,apiEggOrgSwitchFaction:apiEggOrgSwitchFaction,get metaGame(){return metaGame},get ShellNews(){return ShellNews},set gameIsOwnerLocked(e){gameIsOwnerLocked=e},get metaGameUI(){return metaGameUI},get isPrivateGame(){return isPrivateGame},get observingGame(){return observingGame},get isGameOwner(){return isGameOwner},get adminRoles(){return G.adminRoles},get photoBooth(){return PhotoBooth},get isGameReady(){return allSystemsGo()},get inGame(){return inGame},get gamePaused(){return gamePaused},get gameType(){return gameType},get specialItemsTag(){return houseAds.specialItemsTag},get getPwaEvent(){return pwaDeferredPrompt},get account(){return G.playerAccount},get productBlockAds(){return G.productBlockAds},get adBlocker(){return adBlocker},get version(){return version},get changelogData(){return changelogData},get onJoinGameClick(){return joinGameAttempted},get adsLoaded(){return adsLoaded},get openShopOnly(){return openShopOnly},set openShopOnly(e){openShopOnly=e},set onJoinGameClick(e){joinGameAttempted=e},get fuseOptions(){return ItemSearchSettings},get Challenges(){return Challenges},get gameOptions(){return gameOptions},set gameOptions(e){gameOptions=e},get playerChallenges(){return playerChallenges},get getIsWelcomeBundlePurchased(){return isWelcomeBundlePurchased},get getWelcomePassSku(){return welcomePassSku},get LoadingTips(){return LoadingTips},get LoadingTipsNew(){return LoadingTipsNew},get LoadingMsgs(){return LoadingMsgs},get firebaseUrl(){return firebaseUrl},testGameUI:testGameUI}})();