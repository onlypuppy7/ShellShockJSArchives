(()=>{var e,t,i,n,a=Object.defineProperty,s=Object.getOwnPropertyNames,r=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)((function(e){if("undefined"!=typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')})),o=(e,t)=>function(){return e&&(t=(0,e[s(e)[0]])(e=0)),t},l=(e,t)=>{for(var i in t)a(e,i,{get:t[i],enumerable:!0})},c=o({"../node_modules/@babylonjs/core/Engines/shaderStore.js"(){(e=class e{static GetShadersRepository(t=0){return 0===t?e.ShadersRepository:e.ShadersRepositoryWGSL}static GetShadersStore(t=0){return 0===t?e.ShadersStore:e.ShadersStoreWGSL}static GetIncludesShadersStore(t=0){return 0===t?e.IncludesShadersStore:e.IncludesShadersStoreWGSL}}).ShadersRepository="src/Shaders/",e.ShadersStore={},e.IncludesShadersStore={},e.ShadersRepositoryWGSL="src/ShadersWGSL/",e.ShadersStoreWGSL={},e.IncludesShadersStoreWGSL={}}}),h={};l(h,{postprocessVertexShader:()=>n});var f,u,d,m=o({"../node_modules/@babylonjs/core/Shaders/postprocess.vertex.js"(){c(),t="postprocessVertexShader",i="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStore[t]=i,n={name:t,shader:i}}}),p={};l(p,{postprocessVertexShaderWGSL:()=>d});var _,v,g,S=o({"../node_modules/@babylonjs/core/ShadersWGSL/postprocess.vertex.js"(){c(),f="postprocessVertexShader",u="attribute position: vec2<f32>;uniform scale: vec2<f32>;varying vUV: vec2<f32>;const madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvertexOutputs.vUV=(vertexInputs.position*madd+madd)*uniforms.scale;vertexOutputs.position=vec4(vertexInputs.position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}\n",e.ShadersStoreWGSL[f]=u,d={name:f,shader:u}}}),y={};l(y,{passPixelShader:()=>g});var E,A,C,R=o({"../node_modules/@babylonjs/core/Shaders/pass.fragment.js"(){c(),_="passPixelShader",v="varying vec2 vUV;uniform sampler2D textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=texture2D(textureSampler,vUV);}",e.ShadersStore[_]=v,g={name:_,shader:v}}}),T={};l(T,{bonesDeclarationWGSL:()=>C});var N,M,I,x=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bonesDeclaration.js"(){c(),E="bonesDeclaration",A="#if NUM_BONE_INFLUENCERS>0\nattribute matricesIndices : vec4<f32>;attribute matricesWeights : vec4<f32>;\n#if NUM_BONE_INFLUENCERS>4\nattribute matricesIndicesExtra : vec4<f32>;attribute matricesWeightsExtra : vec4<f32>;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nvar boneSampler : texture_2d<f32>;uniform boneTextureWidth : f32;\n#else\nuniform mBones : array<mat4x4,BonesPerMesh>;\n#ifdef BONES_VELOCITY_ENABLED\nuniform mPreviousBones : array<mat4x4,BonesPerMesh>;\n#endif\n#endif\n#ifdef BONETEXTURE\nfn readMatrixFromRawSampler(smp : texture_2d<f32>,index : f32)->mat4x4<f32>\n{let offset=i32(index) *4; \nlet m0=textureLoad(smp,vec2<i32>(offset+0,0),0);let m1=textureLoad(smp,vec2<i32>(offset+1,0),0);let m2=textureLoad(smp,vec2<i32>(offset+2,0),0);let m3=textureLoad(smp,vec2<i32>(offset+3,0),0);return mat4x4<f32>(m0,m1,m2,m3);}\n#endif\n#endif\n#endif\n",e.IncludesShadersStoreWGSL[E]=A,C={name:E,shader:A}}}),b={};l(b,{bonesVertexWGSL:()=>I});var P,w,O,D=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bonesVertex.js"(){c(),N="bonesVertex",M="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nvar influence : mat4x4<f32>;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[0])*vertexInputs.matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[1])*vertexInputs.matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[2])*vertexInputs.matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndices[3])*vertexInputs.matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[0])*vertexInputs.matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[1])*vertexInputs.matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[2])*vertexInputs.matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence=influence+readMatrixFromRawSampler(boneSampler,vertexInputs.matricesIndicesExtra[3])*vertexInputs.matricesWeightsExtra[3];\n#endif \n#else \ninfluence=uniforms.mBones[int(vertexInputs.matricesIndices[0])]*vertexInputs.matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndices[1])]*vertexInputs.matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndices[2])]*vertexInputs.matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndices[3])]*vertexInputs.matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndicesExtra[0])]*vertexInputs.matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndicesExtra[1])]*vertexInputs.matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndicesExtra[2])]*vertexInputs.matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence=influence+uniforms.mBones[int(vertexInputs.matricesIndicesExtra[3])]*vertexInputs.matricesWeightsExtra[3];\n#endif \n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL[N]=M,I={name:N,shader:M}}}),L={};l(L,{bonesDeclaration:()=>O});var F,k,B,G=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bonesDeclaration.js"(){c(),P="bonesDeclaration",w="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;attribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;attribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform highp sampler2D boneSampler;uniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{float offset=index *4.0;float dx=1.0/boneTextureWidth;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));return mat4(m0,m1,m2,m3);}\n#endif\n#endif\n#endif\n",e.IncludesShadersStore[P]=w,O={name:P,shader:w}}}),U={};l(U,{bonesVertex:()=>B});var H,V,W,z=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bonesVertex.js"(){c(),F="bonesVertex",k="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n",e.IncludesShadersStore[F]=k,B={name:F,shader:k}}}),X={};l(X,{lightFragmentWGSL:()=>W});var Y,j,K,$=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightFragment.js"(){c(),H="lightFragment",V="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,input.vPositionW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,input.vPositionW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);info.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightTexture{X},projectionLightTexture{X}Sampler,uniforms.textureProjectionMatrix{X},input.vPositionW);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSMDEBUG{X} \nvar shadowDebug{X}: vec3f;\n#endif\n#ifdef SHADOWCSM{X}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nvar index{X}: i32=-1;\n#else\nvar index{X}: i32=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nvar diff{X}: f32=0.;vPositionFromLight{X}[0]=fragmentInputs.vPositionFromLight{X}_0;vPositionFromLight{X}[1]=fragmentInputs.vPositionFromLight{X}_1;vPositionFromLight{X}[2]=fragmentInputs.vPositionFromLight{X}_2;vPositionFromLight{X}[3]=fragmentInputs.vPositionFromLight{X}_3;vDepthMetric{X}[0]=fragmentInputs.vDepthMetric{X}_0;vDepthMetric{X}[1]=fragmentInputs.vDepthMetric{X}_1;vDepthMetric{X}[2]=fragmentInputs.vDepthMetric{X}_2;vDepthMetric{X}[3]=fragmentInputs.vDepthMetric{X}_3;for (var i:i32=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=uniforms.viewFrustumZ{X}[i]+fragmentInputs.vPositionFromCamera{X}.z;\n#else\ndiff{X}=uniforms.viewFrustumZ{X}[i]-fragmentInputs.vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {index{X}=i;break;}}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3f(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nvar frustumLength:f32=uniforms.frustumLengths{X}[index{X}];var diffRatio:f32=clamp(diff{X}/frustumLength,0.,1.)*uniforms.cascadeBlendFactor{X};if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{index{X}+=1;var nextShadow: f32=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],,shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,uniforms.lightSizeUVCorrection{X}[index{X}],uniforms.depthCorrection{X}[index{X}],uniforms.penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(index{X},vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(input.vPositionW,light{X}.vLightData.xyz,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(input.vPositionW,light{X}.vLightData.xyz,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(input.vPositionW,light{X}.vLightData.xyz,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},depthTexture{X},depthTexture{X}Sampler,shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(input.vPositionW,light{X}.vLightData.xyz,shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(fragmentInputs.vPositionFromLight{X},fragmentInputs.vDepthMetric{X},shadowTexture{X},shadowTexture{X}Sampler,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;shadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\naggShadow+=shadow;numLights+=1.0;\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n",e.IncludesShadersStoreWGSL[H]=V,W={name:H,shader:V}}}),q={};l(q,{lightUboDeclarationWGSL:()=>K});var J,Q,Z,ee=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightUboDeclaration.js"(){c(),Y="lightUboDeclaration",j="#ifdef LIGHT{X}\nstruct Light{X}\n{vLightData: vec4f,\nvLightDiffuse: vec4f,\nvLightSpecular: vec4f,\n#ifdef SPOTLIGHT{X}\nvLightDirection: vec4f,\nvLightFalloff: vec4f,\n#elif defined(POINTLIGHT{X})\nvLightFalloff: vec4f,\n#elif defined(HEMILIGHT{X})\nvLightGround: vec3f,\n#endif\nshadowsInfo: vec4f,\ndepthValues: vec2f} ;var<uniform> light{X} : Light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform textureProjectionMatrix{X}: mat4x4f;var projectionLightTexture{X}Sampler: sampler;var projectionLightTexture{X}: texture_2d<f32>;\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform lightMatrix{X}: array<mat4x4f,SHADOWCSMNUM_CASCADES{X}>;uniform viewFrustumZ{X}: array<f32,SHADOWCSMNUM_CASCADES{X}>;uniform frustumLengths{X}: array<f32,SHADOWCSMNUM_CASCADES{X}>;uniform cascadeBlendFactor{X}: f32;varying vPositionFromLight{X}_0: vec4f;varying vDepthMetric{X}_0: f32;varying vPositionFromLight{X}_1: vec4f;varying vDepthMetric{X}_1: f32;varying vPositionFromLight{X}_2: vec4f;varying vDepthMetric{X}_2: f32;varying vPositionFromLight{X}_3: vec4f;varying vDepthMetric{X}_3: f32;varying vPositionFromCamera{X}: vec4f;var<private> vPositionFromLight{X}: array<vec4f,4>;var<private> vDepthMetric{X} : array<f32,4>;\n#if defined(SHADOWPCSS{X})\nvar shadowTexture{X}Sampler: sampler_comparison; \nvar shadowTexture{X}: texture_depth_2d_array;var depthTexture{X}Sampler: sampler;var depthTexture{X}: texture_2d_array<f32>;uniform lightSizeUVCorrection{X}: array<vec2f,SHADOWCSMNUM_CASCADES{X}>;uniform depthCorrection{X}: array<f32,SHADOWCSMNUM_CASCADES{X}>;uniform penumbraDarkness{X}: f32;\n#elif defined(SHADOWPCF{X})\nvar shadowTexture{X}Sampler: sampler_comparison;var shadowTexture{X}: texture_depth_2d_array;\n#else \nvar shadowTexture{X}Sampler: sampler; \nvar shadowTexture{X}: texture_2d_array<f32>;\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vCascadeColorsMultiplier{X}: array<vec3f,8>=array<vec3f,8>\n(\nvec3f ( 1.5,0.0,0.0 ),\nvec3f ( 0.0,1.5,0.0 ),\nvec3f ( 0.0,0.0,5.5 ),\nvec3f ( 1.5,0.0,5.5 ),\nvec3f ( 1.5,1.5,0.0 ),\nvec3f ( 1.0,1.0,1.0 ),\nvec3f ( 0.0,1.0,5.5 ),\nvec3f ( 0.5,3.5,0.75 )\n);\n#endif\n#elif defined(SHADOWCUBE{X})\nvar shadowTexture{X}Sampler: sampler;var shadowTexture{X}: texture_cube<f32>;\n#else\nvarying vPositionFromLight{X}: vec4f;varying vDepthMetric{X}: f32;\n#if defined(SHADOWPCSS{X})\nvar shadowTexture{X}Sampler: sampler_comparison; \nvar shadowTexture{X}: texture_depth_2d;var depthTexture{X}Sampler: sampler; \nvar depthTexture{X}: texture_2d<f32>;\n#elif defined(SHADOWPCF{X})\nvar shadowTexture{X}Sampler: sampler_comparison;var shadowTexture{X}: texture_depth_2d;\n#else\nvar shadowTexture{X}Sampler: sampler; \nvar shadowTexture{X}: texture_2d<f32>;\n#endif\nuniform lightMatrix{X}: mat4x4f;\n#endif\n#endif\n#endif\n",e.IncludesShadersStoreWGSL[Y]=j,K={name:Y,shader:j}}}),te={};l(te,{lightVxUboDeclarationWGSL:()=>Z});var ie,ne,ae,se=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightVxUboDeclaration.js"(){c(),J="lightVxUboDeclaration",Q="#ifdef LIGHT{X}\nstruct Light{X}\n{vLightData: vec4f,\nvLightDiffuse: vec4f,\nvLightSpecular: vec4f,\n#ifdef SPOTLIGHT{X}\nvLightDirection: vec4f,\nvLightFalloff: vec4f,\n#elif defined(POINTLIGHT{X})\nvLightFalloff: vec4f,\n#elif defined(HEMILIGHT{X})\nvLightGround: vec3f,\n#endif\nshadowsInfo: vec4f,\ndepthValues: vec2f} ;var<uniform> light{X} : Light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform lightMatrix{X}: array<mat4x4f,SHADOWCSMNUM_CASCADES{X}>;varying vPositionFromLight{X}_0: vec4f;varying vDepthMetric{X}_0: f32;varying vPositionFromLight{X}_1: vec4f;varying vDepthMetric{X}_1: f32;varying vPositionFromLight{X}_2: vec4f;varying vDepthMetric{X}_2: f32;varying vPositionFromLight{X}_3: vec4f;varying vDepthMetric{X}_3: f32;varying vPositionFromCamera{X}: vec4f;\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vPositionFromLight{X}: vec4f;varying vDepthMetric{X}: f32;uniform lightMatrix{X}: mat4x4f;\n#endif\n#endif\n#endif\n",e.IncludesShadersStoreWGSL[J]=Q,Z={name:J,shader:Q}}}),re={};l(re,{helperFunctionsWGSL:()=>ae});var oe,le,ce,he=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/helperFunctions.js"(){c(),ie="helperFunctions",ne="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n",e.IncludesShadersStoreWGSL[ie]=ne,ae={name:ie,shader:ne}}}),fe={};l(fe,{lightsFragmentFunctionsWGSL:()=>ce});var ue,de,me,pe=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightsFragmentFunctions.js"(){c(),oe="lightsFragmentFunctions",le="struct lightingInfo\n{diffuse: vec3f,\n#ifdef SPECULARTERM\nspecular: vec3f,\n#endif\n#ifdef NDOTL\nndl: f32,\n#endif\n};fn computeLighting(viewDirectionW: vec3f,vNormal: vec3f,lightData: vec4f,diffuseColor: vec3f,specularColor: vec3f,range: f32,glossiness: f32)->lightingInfo {var result: lightingInfo;var lightVectorW: vec3f;var attenuation: f32=1.0;if (lightData.w==0.)\n{var direction: vec3f=lightData.xyz-fragmentInputs.vPositionW;var attenuation: f32=max(0.,1.0-length(direction)/range);lightVectorW=normalize(direction);}\nelse\n{lightVectorW=normalize(-lightData.xyz);}\nvar ndl: f32=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvar angleW: vec3f=normalize(viewDirectionW+lightVectorW);var specComp: f32=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nfn computeSpotLighting(viewDirectionW: vec3f,vNormal: vec3f ,lightData: vec4f,lightDirection: vec4f,diffuseColor: vec3f,specularColor: vec3f,range: f32,glossiness: f32)->lightingInfo {var result: lightingInfo;var direction: vec3f=lightData.xyz-fragmentInputs.vPositionW;var lightVectorW: vec3f=normalize(direction);var attenuation: f32=max(0.,1.0-length(direction)/range);var cosAngle: f32=max(0.,dot(lightDirection.xyz,-lightVectorW));if (cosAngle>=lightDirection.w)\n{cosAngle=max(0.,pow(cosAngle,lightData.w));attenuation*=cosAngle;var ndl: f32=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvar angleW: vec3f=normalize(viewDirectionW+lightVectorW);var specComp: f32=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nresult.diffuse=vec3f(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3f(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;}\nfn computeHemisphericLighting(viewDirectionW: vec3f,vNormal: vec3f,lightData: vec4f,diffuseColor: vec3f,specularColor: vec3f,groundColor: vec3f,glossiness: f32)->lightingInfo {var result: lightingInfo;var ndl: f32=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvar angleW: vec3f=normalize(viewDirectionW+lightData.xyz);var specComp: f32=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor;\n#endif\nreturn result;}\nfn computeProjectionTextureDiffuseLighting(projectionLightTexture: texture_2d<f32>,projectionLightSampler: sampler,textureProjectionMatrix: mat4x4f,posW: vec3f)->vec3f {var strq: vec4f=textureProjectionMatrix*vec4f(posW,1.0);strq/=strq.w;var textureColor: vec3f=textureSample(projectionLightTexture,projectionLightSampler,strq.xy).rgb;return textureColor;}",e.IncludesShadersStoreWGSL[oe]=le,ce={name:oe,shader:le}}}),_e={};l(_e,{shadowsFragmentFunctionsWGSL:()=>me});var ve,ge,Se,ye=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowsFragmentFunctions.js"(){c(),ue="shadowsFragmentFunctions",de="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfn unpack(color: vec4f)->f32\n{const bit_shift: vec4f= vec4f(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}\n#endif\nfn computeFallOff(value: f32,clipSpace: vec2f,frustumEdgeFalloff: f32)->f32\n{var mask: f32=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));return mix(value,1.0,mask);}\nfn computeShadowCube(worldPos: vec3f,lightPosition: vec3f,shadowTexture: texture_cube<f32>,shadowSampler: sampler,darkness: f32,depthValues: vec2f)->f32\n{var directionToLight: vec3f=worldPos-lightPosition;var depth: f32=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nvar shadow: f32=unpack(textureSample(shadowTexture,shadowSampler,directionToLight));\n#else\nvar shadow: f32=textureSample(shadowTexture,shadowSampler,directionToLight).x;\n#endif\nreturn select(darkness,1.0,depth>shadow);}\nfn computeShadowWithPoissonSamplingCube(worldPos: vec3f,lightPosition: vec3f,shadowTexture: texture_cube<f32>,shadowSampler: sampler,mapSize: f32,darkness: f32,depthValues: vec2f)->f32\n{var directionToLight: vec3f=worldPos-lightPosition;var depth: f32=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;var visibility: f32=1.;var poissonDisk: array<vec3f,4>;poissonDisk[0]= vec3f(-1.0,1.0,-1.0);poissonDisk[1]= vec3f(1.0,-1.0,-1.0);poissonDisk[2]= vec3f(-1.0,-1.0,-1.0);poissonDisk[3]= vec3f(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) {visibility-=0.25;};if (unpack(textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) {visibility-=0.25;};if (unpack(textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) {visibility-=0.25;};if (unpack(textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) {visibility-=0.25;};\n#else\nif (textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) {visibility-=0.25;};if (textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) {visibility-=0.25;};if (textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) {visibility-=0.25;};if (textureSample(shadowTexture,shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) {visibility-=0.25;};\n#endif\nreturn min(1.0,visibility+darkness);}\nfn computeShadowWithESMCube(worldPos: vec3f,lightPosition: vec3f,shadowTexture: texture_cube<f32>,shadowSampler: sampler,darkness: f32,depthScale: f32,depthValues: vec2f)->f32\n{var directionToLight: vec3f=worldPos-lightPosition;var depth: f32=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);var shadowPixelDepth: f32=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nvar shadowMapSample: f32=unpack(textureSample(shadowTexture,shadowSampler,directionToLight));\n#else\nvar shadowMapSample: f32=textureSample(shadowTexture,shadowSampler,directionToLight).x;\n#endif\nvar esm: f32=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return esm;}\nfn computeShadowWithCloseESMCube(worldPos: vec3f,lightPosition: vec3f,shadowTexture: texture_cube<f32>,shadowSampler: sampler,darkness: f32,depthScale: f32,depthValues: vec2f)->f32\n{var directionToLight: vec3f=worldPos-lightPosition;var depth: f32=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);var shadowPixelDepth: f32=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nvar shadowMapSample: f32=unpack(textureSample(shadowTexture,shadowSampler,directionToLight));\n#else\nvar shadowMapSample: f32=textureSample(shadowTexture,shadowSampler,directionToLight).x;\n#endif\nvar esm: f32=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return esm;}\nfn computeShadowCSM(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d_array<f32>,shadowSampler: sampler,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nvar shadow: f32=unpack(textureSample(shadowTexture,shadowSampler,uv,layer));\n#else\nvar shadow: f32=textureSample(shadowTexture,shadowSampler,uv,layer).x;\n#endif\nreturn select(1.,computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff),shadowPixelDepth>shadow );}\nfn computeShadow(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d<f32>,shadowSampler: sampler,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nvar shadow: f32=unpack(textureSampleLevel(shadowTexture,shadowSampler,uv,0.));\n#else\nvar shadow: f32=textureSampleLevel(shadowTexture,shadowSampler,uv,0.).x;\n#endif\nreturn select(1.,computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff),shadowPixelDepth>shadow );}}\nfn computeShadowWithPoissonSampling(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d<f32>,shadowSampler: sampler,mapSize: f32,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0);var visibility: f32=1.;var poissonDisk: array<vec2f,4>;poissonDisk[0]= vec2f(-0.94201624,-0.39906216);poissonDisk[1]= vec2f(0.94558609,-0.76890725);poissonDisk[2]= vec2f(-0.094184101,-0.92938870);poissonDisk[3]= vec2f(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[0]*mapSize,0.))<shadowPixelDepth) {visibility-=0.25;}\nif (unpack(textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[1]*mapSize,0.))<shadowPixelDepth) {visibility-=0.25;}\nif (unpack(textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[2]*mapSize,0.))<shadowPixelDepth) {visibility-=0.25;}\nif (unpack(textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[3]*mapSize,0.))<shadowPixelDepth) {visibility-=0.25;}\n#else\nif (textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[0]*mapSize,0.).x<shadowPixelDepth) {visibility-=0.25;}\nif (textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[1]*mapSize,0.).x<shadowPixelDepth) {visibility-=0.25;}\nif (textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[2]*mapSize,0.).x<shadowPixelDepth) {visibility-=0.25;}\nif (textureSampleLevel(shadowTexture,shadowSampler,uv+poissonDisk[3]*mapSize,0.).x<shadowPixelDepth) {visibility-=0.25;}\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);}}\nfn computeShadowWithESM(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d<f32>,shadowSampler: sampler,darkness: f32,depthScale: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nvar shadowMapSample: f32=unpack(textureSampleLevel(shadowTexture,shadowSampler,uv,0.));\n#else\nvar shadowMapSample: f32=textureSampleLevel(shadowTexture,shadowSampler,uv,0.).x;\n#endif\nvar esm: f32=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\nfn computeShadowWithCloseESM(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_2d<f32>,shadowSampler: sampler,darkness: f32,depthScale: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uv: vec2f=0.5*clipSpace.xy+ vec2f(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{var shadowPixelDepth: f32=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nvar shadowMapSample: f32=unpack(textureSampleLevel(shadowTexture,shadowSampler,uv,0.));\n#else\nvar shadowMapSample: f32=textureSampleLevel(shadowTexture,shadowSampler,uv,0.).x;\n#endif\nvar esm: f32=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\nfn getZInClip(clipSpace: vec3f,uvDepth: vec3f)->f32\n{\n#ifdef IS_NDC_HALF_ZRANGE\nreturn clipSpace.z;\n#else\nreturn uvDepth.z;\n#endif\n}\nconst GREATEST_LESS_THAN_ONE: f32=0.99999994;\n#define DISABLE_UNIFORMITY_ANALYSIS\nfn computeShadowWithCSMPCF1(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=clamp(getZInClip(clipSpace,uvDepth),0.,GREATEST_LESS_THAN_ONE);var shadow: f32=textureSampleCompare(shadowTexture,shadowSampler,uvDepth.xy,layer,uvDepth.z);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\nfn computeShadowWithCSMPCF3(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeAndInverse: vec2f,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=clamp(getZInClip(clipSpace,uvDepth),0.,GREATEST_LESS_THAN_ONE);var uv: vec2f=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvar st: vec2f=fract(uv); \nvar base_uv: vec2f=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvar uvw0: vec2f=3.-2.*st;var uvw1: vec2f=1.+2.*st;var u: vec2f= vec2f((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;var v: vec2f= vec2f((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;var shadow: f32=0.;shadow+=uvw0.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[0]),layer,uvDepth.z);shadow+=uvw1.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[0]),layer,uvDepth.z);shadow+=uvw0.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[1]),layer,uvDepth.z);shadow+=uvw1.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[1]),layer,uvDepth.z);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\nfn computeShadowWithCSMPCF5(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeAndInverse: vec2f,darkness: f32,frustumEdgeFalloff: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=clamp(getZInClip(clipSpace,uvDepth),0.,GREATEST_LESS_THAN_ONE);var uv: vec2f=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvar st: vec2f=fract(uv); \nvar base_uv: vec2f=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvar uvw0: vec2f=4.-3.*st;var uvw1: vec2f= vec2f(7.);var uvw2: vec2f=1.+3.*st;var u: vec3f= vec3f((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;var v: vec3f= vec3f((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;var shadow: f32=0.;shadow+=uvw0.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[0]),layer,uvDepth.z);shadow+=uvw1.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[0]),layer,uvDepth.z);shadow+=uvw2.x*uvw0.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[0]),layer,uvDepth.z);shadow+=uvw0.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[1]),layer,uvDepth.z);shadow+=uvw1.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[1]),layer,uvDepth.z);shadow+=uvw2.x*uvw1.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[1]),layer,uvDepth.z);shadow+=uvw0.x*uvw2.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[2]),layer,uvDepth.z);shadow+=uvw1.x*uvw2.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[2]),layer,uvDepth.z);shadow+=uvw2.x*uvw2.y*textureSampleCompare(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[2]),layer,uvDepth.z);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\nfn computeShadowWithPCF1(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,darkness: f32,frustumEdgeFalloff: f32)->f32\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=getZInClip(clipSpace,uvDepth);var shadow: f32=textureSampleCompareLevel(shadowTexture,shadowSampler,uvDepth.xy,uvDepth.z);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nfn computeShadowWithPCF3(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeAndInverse: vec2f,darkness: f32,frustumEdgeFalloff: f32)->f32\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=getZInClip(clipSpace,uvDepth);var uv: vec2f=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvar st: vec2f=fract(uv); \nvar base_uv: vec2f=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvar uvw0: vec2f=3.-2.*st;var uvw1: vec2f=1.+2.*st;var u: vec2f= vec2f((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;var v: vec2f= vec2f((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;var shadow: f32=0.;shadow+=uvw0.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[0]),uvDepth.z);shadow+=uvw1.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[0]),uvDepth.z);shadow+=uvw0.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[1]),uvDepth.z);shadow+=uvw1.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[1]),uvDepth.z);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nfn computeShadowWithPCF5(vPositionFromLight: vec4f,depthMetric: f32,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeAndInverse: vec2f,darkness: f32,frustumEdgeFalloff: f32)->f32\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=getZInClip(clipSpace,uvDepth);var uv: vec2f=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvar st: vec2f=fract(uv); \nvar base_uv: vec2f=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvar uvw0: vec2f=4.-3.*st;var uvw1: vec2f= vec2f(7.);var uvw2: vec2f=1.+3.*st;var u: vec3f= vec3f((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;var v: vec3f= vec3f((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;var shadow: f32=0.;shadow+=uvw0.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[0]),uvDepth.z);shadow+=uvw1.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[0]),uvDepth.z);shadow+=uvw2.x*uvw0.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[0]),uvDepth.z);shadow+=uvw0.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[1]),uvDepth.z);shadow+=uvw1.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[1]),uvDepth.z);shadow+=uvw2.x*uvw1.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[1]),uvDepth.z);shadow+=uvw0.x*uvw2.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[0],v[2]),uvDepth.z);shadow+=uvw1.x*uvw2.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[1],v[2]),uvDepth.z);shadow+=uvw2.x*uvw2.y*textureSampleCompareLevel(shadowTexture,shadowSampler, base_uv.xy+ vec2f(u[2],v[2]),uvDepth.z);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nconst PoissonSamplers32: array<vec3f,64>=array<vec3f,64> (\nvec3f(0.06407013,0.05409927,0.),\nvec3f(0.7366577,0.5789394,0.),\nvec3f(-0.6270542,-0.5320278,0.),\nvec3f(-0.4096107,0.8411095,0.),\nvec3f(0.6849564,-0.4990818,0.),\nvec3f(-0.874181,-0.04579735,0.),\nvec3f(0.9989998,0.0009880066,0.),\nvec3f(-0.004920578,-0.9151649,0.),\nvec3f(0.1805763,0.9747483,0.),\nvec3f(-0.2138451,0.2635818,0.),\nvec3f(0.109845,0.3884785,0.),\nvec3f(0.06876755,-0.3581074,0.),\nvec3f(0.374073,-0.7661266,0.),\nvec3f(0.3079132,-0.1216763,0.),\nvec3f(-0.3794335,-0.8271583,0.),\nvec3f(-0.203878,-0.07715034,0.),\nvec3f(0.5912697,0.1469799,0.),\nvec3f(-0.88069,0.3031784,0.),\nvec3f(0.5040108,0.8283722,0.),\nvec3f(-0.5844124,0.5494877,0.),\nvec3f(0.6017799,-0.1726654,0.),\nvec3f(-0.5554981,0.1559997,0.),\nvec3f(-0.3016369,-0.3900928,0.),\nvec3f(-0.5550632,-0.1723762,0.),\nvec3f(0.925029,0.2995041,0.),\nvec3f(-0.2473137,0.5538505,0.),\nvec3f(0.9183037,-0.2862392,0.),\nvec3f(0.2469421,0.6718712,0.),\nvec3f(0.3916397,-0.4328209,0.),\nvec3f(-0.03576927,-0.6220032,0.),\nvec3f(-0.04661255,0.7995201,0.),\nvec3f(0.4402924,0.3640312,0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.),\nvec3f(0.)\n);const PoissonSamplers64: array<vec3f,64>=array<vec3f,64> (\nvec3f(-0.613392,0.617481,0.),\nvec3f(0.170019,-0.040254,0.),\nvec3f(-0.299417,0.791925,0.),\nvec3f(0.645680,0.493210,0.),\nvec3f(-0.651784,0.717887,0.),\nvec3f(0.421003,0.027070,0.),\nvec3f(-0.817194,-0.271096,0.),\nvec3f(-0.705374,-0.668203,0.),\nvec3f(0.977050,-0.108615,0.),\nvec3f(0.063326,0.142369,0.),\nvec3f(0.203528,0.214331,0.),\nvec3f(-0.667531,0.326090,0.),\nvec3f(-0.098422,-0.295755,0.),\nvec3f(-0.885922,0.215369,0.),\nvec3f(0.566637,0.605213,0.),\nvec3f(0.039766,-0.396100,0.),\nvec3f(0.751946,0.453352,0.),\nvec3f(0.078707,-0.715323,0.),\nvec3f(-0.075838,-0.529344,0.),\nvec3f(0.724479,-0.580798,0.),\nvec3f(0.222999,-0.215125,0.),\nvec3f(-0.467574,-0.405438,0.),\nvec3f(-0.248268,-0.814753,0.),\nvec3f(0.354411,-0.887570,0.),\nvec3f(0.175817,0.382366,0.),\nvec3f(0.487472,-0.063082,0.),\nvec3f(-0.084078,0.898312,0.),\nvec3f(0.488876,-0.783441,0.),\nvec3f(0.470016,0.217933,0.),\nvec3f(-0.696890,-0.549791,0.),\nvec3f(-0.149693,0.605762,0.),\nvec3f(0.034211,0.979980,0.),\nvec3f(0.503098,-0.308878,0.),\nvec3f(-0.016205,-0.872921,0.),\nvec3f(0.385784,-0.393902,0.),\nvec3f(-0.146886,-0.859249,0.),\nvec3f(0.643361,0.164098,0.),\nvec3f(0.634388,-0.049471,0.),\nvec3f(-0.688894,0.007843,0.),\nvec3f(0.464034,-0.188818,0.),\nvec3f(-0.440840,0.137486,0.),\nvec3f(0.364483,0.511704,0.),\nvec3f(0.034028,0.325968,0.),\nvec3f(0.099094,-0.308023,0.),\nvec3f(0.693960,-0.366253,0.),\nvec3f(0.678884,-0.204688,0.),\nvec3f(0.001801,0.780328,0.),\nvec3f(0.145177,-0.898984,0.),\nvec3f(0.062655,-0.611866,0.),\nvec3f(0.315226,-0.604297,0.),\nvec3f(-0.780145,0.486251,0.),\nvec3f(-0.371868,0.882138,0.),\nvec3f(0.200476,0.494430,0.),\nvec3f(-0.494552,-0.711051,0.),\nvec3f(0.612476,0.705252,0.),\nvec3f(-0.578845,-0.768792,0.),\nvec3f(-0.772454,-0.090976,0.),\nvec3f(0.504440,0.372295,0.),\nvec3f(0.155736,0.065157,0.),\nvec3f(0.391522,0.849605,0.),\nvec3f(-0.620106,-0.328104,0.),\nvec3f(0.789239,-0.419965,0.),\nvec3f(-0.545396,0.538133,0.),\nvec3f(-0.178564,-0.596057,0.)\n);fn computeShadowWithCSMPCSS(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d_array<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,searchTapCount: i32,pcfTapCount: i32,poissonSamplers: array<vec3f,64>,lightSizeUVCorrection: vec2f,depthCorrection: f32,penumbraDarkness: f32)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=clamp(getZInClip(clipSpace,uvDepth),0.,GREATEST_LESS_THAN_ONE);var uvDepthLayer: vec4f= vec4f(uvDepth.x,uvDepth.y,f32(layer),uvDepth.z);var blockerDepth: f32=0.0;var sumBlockerDepth: f32=0.0;var numBlocker: f32=0.0;for (var i: i32=0; i<searchTapCount; i ++) {blockerDepth=textureSample(depthTexture,depthSampler, uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer).r;numBlocker+=select(0.,1.,blockerDepth<depthMetric);sumBlockerDepth+=select(0.,blockerDepth,blockerDepth<depthMetric);}\nvar avgBlockerDepth: f32=sumBlockerDepth/numBlocker;var AAOffset: f32=shadowMapSizeInverse*10.;var penumbraRatio: f32=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);var filterRadius: vec4f= vec4f(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);var random: f32=getRand(vPositionFromLight.xy);var rotationAngle: f32=random*3.1415926;var rotationVector: vec2f= vec2f(cos(rotationAngle),sin(rotationAngle));var shadow: f32=0.;for (var i: i32=0; i<pcfTapCount; i++) {var offset: vec4f= vec4f(poissonSamplers[i],0.);offset= vec4f(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);let coords=uvDepthLayer+offset*filterRadius;shadow+=textureSampleCompare(shadowTexture,shadowSampler,coords.xy,i32(coords.z),coords.w);}\nshadow/= f32(pcfTapCount);shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));shadow=mix(darkness,1.,shadow);return select(computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff),1.0,numBlocker<1.0);}\nfn computeShadowWithPCSS(vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,searchTapCount: i32,pcfTapCount: i32,poissonSamplers: array<vec3f,64>)->f32\n{var clipSpace: vec3f=vPositionFromLight.xyz/vPositionFromLight.w;var uvDepth: vec3f= vec3f(0.5*clipSpace.xyz+ vec3f(0.5));uvDepth.z=getZInClip(clipSpace,uvDepth);var blockerDepth: f32=0.0;var sumBlockerDepth: f32=0.0;var numBlocker: f32=0.0;var exitCondition: bool=depthMetric>1.0 || depthMetric<0.0;for (var i: i32=0; i<searchTapCount; i ++) {if (exitCondition) {break;}\nblockerDepth=textureSampleLevel(depthTexture,depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy),0).r;numBlocker+=select(0.,1.,blockerDepth<depthMetric);sumBlockerDepth+=select(0.,blockerDepth,blockerDepth<depthMetric);}\nexitCondition=exitCondition || numBlocker<1.0;var avgBlockerDepth: f32=sumBlockerDepth/numBlocker;var AAOffset: f32=shadowMapSizeInverse*10.;var penumbraRatio: f32=((depthMetric-avgBlockerDepth)+AAOffset);var filterRadius: f32=penumbraRatio*lightSizeUV*shadowMapSizeInverse;var random: f32=getRand(vPositionFromLight.xy);var rotationAngle: f32=random*3.1415926;var rotationVector: vec2f= vec2f(cos(rotationAngle),sin(rotationAngle));var shadow: f32=0.;for (var i: i32=0; i<pcfTapCount; i++) {if (exitCondition) {break;}\nvar offset: vec3f=poissonSamplers[i];offset= vec3f(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);let coords=uvDepth+offset*filterRadius;shadow+=textureSampleCompareLevel(shadowTexture,shadowSampler,coords.xy,coords.z);}\nshadow/= f32(pcfTapCount);shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);shadow=mix(darkness,1.,shadow);return select(computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff),1.0,exitCondition);}\nfn computeShadowWithPCSS16(vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32)->f32\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);}\nfn computeShadowWithPCSS32(vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32)->f32\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);}\nfn computeShadowWithPCSS64(vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32)->f32\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);}\nfn computeShadowWithCSMPCSS16(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d_array<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,lightSizeUVCorrection: vec2f,depthCorrection: f32,penumbraDarkness: f32)->f32\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\nfn computeShadowWithCSMPCSS32(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d_array<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,lightSizeUVCorrection: vec2f,depthCorrection: f32,penumbraDarkness: f32)->f32\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\nfn computeShadowWithCSMPCSS64(layer: i32,vPositionFromLight: vec4f,depthMetric: f32,depthTexture: texture_2d_array<f32>,depthSampler: sampler,shadowTexture: texture_depth_2d_array,shadowSampler: sampler_comparison,shadowMapSizeInverse: f32,lightSizeUV: f32,darkness: f32,frustumEdgeFalloff: f32,lightSizeUVCorrection: vec2f,depthCorrection: f32,penumbraDarkness: f32)->f32\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthTexture,depthSampler,shadowTexture,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#endif\n",e.IncludesShadersStoreWGSL[ue]=de,me={name:ue,shader:de}}}),Ee={};l(Ee,{shadowsVertexWGSL:()=>Se});var Ae,Ce,Re,Te=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowsVertex.js"(){c(),ve="shadowsVertex",ge="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvertexOutputs.vPositionFromCamera{X}=scene.view*worldPos;\n#if SHADOWCSMNUM_CASCADES{X}>0\nvertexOutputs.vPositionFromLight{X}_0=uniforms.lightMatrix{X}[0]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}_0=(-vertexOutputs.vPositionFromLight{X}_0.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}_0= (vertexOutputs.vPositionFromLight{X}_0.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#if SHADOWCSMNUM_CASCADES{X}>1\nvertexOutputs.vPositionFromLight{X}_1=uniforms.lightMatrix{X}[1]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}_1=(-vertexOutputs.vPositionFromLight{X}_1.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}_1= (vertexOutputs.vPositionFromLight{X}_1.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif \n#if SHADOWCSMNUM_CASCADES{X}>2\nvertexOutputs.vPositionFromLight{X}_2=uniforms.lightMatrix{X}[2]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}_2=(-vertexOutputs.vPositionFromLight{X}_2.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}_2= (vertexOutputs.vPositionFromLight{X}_2.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif \n#if SHADOWCSMNUM_CASCADES{X}>3\nvertexOutputs.vPositionFromLight{X}_3=uniforms.lightMatrix{X}[3]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}_3=(-vertexOutputs.vPositionFromLight{X}_3.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}_3= (vertexOutputs.vPositionFromLight{X}_3.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif \n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvertexOutputs.vPositionFromLight{X}=uniforms.lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric{X}=(-vertexOutputs.vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvertexOutputs.vDepthMetric{X}=(vertexOutputs.vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n",e.IncludesShadersStoreWGSL[ve]=ge,Se={name:ve,shader:ge}}}),Ne={};l(Ne,{lightFragmentDeclaration:()=>Re});var Me,Ie,xe,be=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/lightFragmentDeclaration.js"(){c(),Ae="lightFragmentDeclaration",Ce="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};uniform highp sampler2DArray depthTexture{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};\n#else\nuniform highp sampler2DArray shadowTexture{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);vec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowTexture{X};\n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowTexture{X};uniform highp sampler2D depthTexture{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowTexture{X};\n#else\nuniform sampler2D shadowTexture{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightTexture{X};\n#endif\n#endif\n",e.IncludesShadersStore[Ae]=Ce,Re={name:Ae,shader:Ce}}}),Pe={};l(Pe,{lightFragment:()=>xe});var we,Oe,De,Le=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/lightFragment.js"(){c(),Me="lightFragment",Ie="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,vPositionW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,vPositionW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);info.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightTexture{X},textureProjectionMatrix{X},vPositionW);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {index{X}=i;break;}}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{index{X}+=1;float nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;shadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\naggShadow+=shadow;numLights+=1.0;\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n",e.IncludesShadersStore[Me]=Ie,xe={name:Me,shader:Ie}}}),Fe={};l(Fe,{lightUboDeclaration:()=>De});var ke,Be,Ge,Ue=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/lightUboDeclaration.js"(){c(),we="lightUboDeclaration",Oe="#ifdef LIGHT{X}\nuniform Light{X}\n{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;vec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;vec2 depthValues;} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightTexture{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};uniform highp sampler2DArray depthTexture{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};\n#else\nuniform highp sampler2DArray shadowTexture{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);vec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowTexture{X}; \n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowTexture{X};uniform highp sampler2D depthTexture{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowTexture{X};\n#else\nuniform sampler2D shadowTexture{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n",e.IncludesShadersStore[we]=Oe,De={name:we,shader:Oe}}}),He={};l(He,{lightVxUboDeclaration:()=>Ge});var Ve,We,ze,Xe=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/lightVxUboDeclaration.js"(){c(),ke="lightVxUboDeclaration",Be="#ifdef LIGHT{X}\nuniform Light{X}\n{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;vec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;vec2 depthValues;} light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};uniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n",e.IncludesShadersStore[ke]=Be,Ge={name:ke,shader:Be}}}),Ye={};l(Ye,{lightVxFragmentDeclaration:()=>ze});var je,Ke,$e,qe=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/lightVxFragmentDeclaration.js"(){c(),Ve="lightVxFragmentDeclaration",We="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};uniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#endif\n",e.IncludesShadersStore[Ve]=We,ze={name:Ve,shader:We}}}),Je={};l(Je,{helperFunctions:()=>$e});var Qe,Ze,et,tt=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/helperFunctions.js"(){c(),je="helperFunctions",Ke="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n",e.IncludesShadersStore[je]=Ke,$e={name:je,shader:Ke}}}),it={};l(it,{lightsFragmentFunctions:()=>et});var nt,at,st,rt=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/lightsFragmentFunctions.js"(){c(),Qe="lightsFragmentFunctions",Ze="struct lightingInfo\n{vec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 lightVectorW;float attenuation=1.0;if (lightData.w==0.)\n{vec3 direction=lightData.xyz-vPositionW;attenuation=max(0.,1.0-length(direction)/range);lightVectorW=normalize(direction);}\nelse\n{lightVectorW=normalize(-lightData.xyz);}\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 direction=lightData.xyz-vPositionW;vec3 lightVectorW=normalize(direction);float attenuation=max(0.,1.0-length(direction)/range);float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));if (cosAngle>=lightDirection.w)\n{cosAngle=max(0.,pow(cosAngle,lightData.w));attenuation*=cosAngle;float ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {lightingInfo result;float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor;\n#endif\nreturn result;}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix,vec3 posW){vec4 strq=textureProjectionMatrix*vec4(posW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return textureColor;}",e.IncludesShadersStore[Qe]=Ze,et={name:Qe,shader:Ze}}}),ot={};l(ot,{shadowsFragmentFunctions:()=>st});var lt,ct,ht,ft=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowsFragmentFunctions.js"(){c(),nt="shadowsFragmentFunctions",at="#ifdef SHADOWS\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)\n#else\n#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)\n#endif\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));return mix(value,1.0,mask);}\n#define inline\nfloat computeShadowCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nreturn depth>shadow ? darkness : 1.0;}\n#define inline\nfloat computeShadowWithPoissonSamplingCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;float visibility=1.;vec3 poissonDisk[4];poissonDisk[0]=vec3(-1.0,1.0,-1.0);poissonDisk[1]=vec3(1.0,-1.0,-1.0);poissonDisk[2]=vec3(-1.0,-1.0,-1.0);poissonDisk[3]=vec3(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);}\n#define inline\nfloat computeShadowWithESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return esm;}\n#define inline\nfloat computeShadowWithCloseESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return esm;}\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define inline\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);vec3 uvLayer=vec3(uv.x,uv.y,layer);float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}\n#endif\n#define inline\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadow=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}}\n#define inline\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);float visibility=1.;vec2 poissonDisk[4];poissonDisk[0]=vec2(-0.94201624,-0.39906216);poissonDisk[1]=vec2(0.94558609,-0.76890725);poissonDisk[2]=vec2(-0.094184101,-0.92938870);poissonDisk[3]=vec2(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;\n#else\nif (TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\n#ifdef IS_NDC_HALF_ZRANGE\n#define ZINCLIP clipSpace.z\n#else\n#define ZINCLIP uvDepth.z\n#endif\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define GREATEST_LESS_THAN_ONE 0.99999994\n#define DISABLE_UNIFORMITY_ANALYSIS\n#define inline\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float shadow=texture2D(shadowSampler,uvDepthLayer);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float shadow=TEXTUREFUNC(shadowSampler,uvDepth,0.);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw2.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow+=uvw2.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z),0.);shadow+=uvw0.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z),0.);shadow+=uvw1.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z),0.);shadow+=uvw2.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z),0.);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.)\n);const vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n#define inline\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec4 offset=vec4(poissonSamplers[i],0.);offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);}\nshadow/=float(pcfTapCount);shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));shadow=mix(darkness,1.,shadow);if (numBlocker<1.0) {return 1.0;}\nelse\n{return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=TEXTUREFUNC(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy),0.).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}\nif (numBlocker<1.0) {return 1.0;}\nelse\n{float avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec3 offset=poissonSamplers[i];offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);shadow+=TEXTUREFUNC(shadowSampler,uvDepth+offset*filterRadius,0.);}\nshadow/=float(pcfTapCount);shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}}\n#define inline\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);}\n#define inline\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);}\n#define inline\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);}\n#define inline\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#define inline\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#define inline\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#endif\n#endif\n",e.IncludesShadersStore[nt]=at,st={name:nt,shader:at}}}),ut={};l(ut,{shadowsVertex:()=>ht});var dt,mt,pt,_t=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowsVertex.js"(){c(),lt="shadowsVertex",ct="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n",e.IncludesShadersStore[lt]=ct,ht={name:lt,shader:ct}}}),vt={};l(vt,{fogFragmentDeclarationWGSL:()=>pt});var gt,St,yt,Et=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fogFragmentDeclaration.js"(){c(),dt="fogFragmentDeclaration",mt="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n",e.IncludesShadersStoreWGSL[dt]=mt,pt={name:dt,shader:mt}}}),At={};l(At,{fogFragmentDeclaration:()=>yt});var Ct,Rt,Tt,Nt=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/fogFragmentDeclaration.js"(){c(),gt="fogFragmentDeclaration",St="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n",e.IncludesShadersStore[gt]=St,yt={name:gt,shader:St}}}),Mt={};l(Mt,{shadowMapVertexMetricWGSL:()=>Tt});var It,xt,bt,Pt=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapVertexMetric.js"(){c(),Ct="shadowMapVertexMetric",Rt="#if SM_USEDISTANCE==1\nvertexOutputs.vPositionWSM=worldPos.xyz;\n#endif\n#if SM_DEPTHTEXTURE==1\n#ifdef IS_NDC_HALF_ZRANGE\n#define BIASFACTOR 0.5\n#else\n#define BIASFACTOR 1.0\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.position.z-=uniforms.biasAndScaleSM.x*vertexOutputs.position.w*BIASFACTOR;\n#else\nvertexOutputs.position.z+=uniforms.biasAndScaleSM.x*vertexOutputs.position.w*BIASFACTOR;\n#endif\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvertexOutputs.zSM=vertexOutputs.position.z;vertexOutputs.position.z=0.0;\n#elif SM_USEDISTANCE==0\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetricSM=(-vertexOutputs.position.z+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#else\nvertexOutputs.vDepthMetricSM=(vertexOutputs.position.z+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL[Ct]=Rt,Tt={name:Ct,shader:Rt}}}),wt={};l(wt,{packingFunctionsWGSL:()=>bt});var Ot,Dt,Lt,Ft=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/packingFunctions.js"(){c(),It="packingFunctions",xt="fn pack(depth: f32)->vec4f\n{const bit_shift: vec4f= vec4f(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const bit_mask: vec4f= vec4f(0.0,1.0/255.0,1.0/255.0,1.0/255.0);var res: vec4f=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\nfn unpack(color: vec4f)->f32\n{const bit_shift: vec4f= vec4f(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}",e.IncludesShadersStoreWGSL[It]=xt,bt={name:It,shader:xt}}}),kt={};l(kt,{shadowMapFragmentWGSL:()=>Lt});var Bt,Gt,Ut,Ht=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapFragment.js"(){c(),Ot="shadowMapFragment",Dt="var depthSM: f32=fragmentInputs.vDepthMetricSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\n#if SM_USEDISTANCE==1\ndepthSM=(length(fragmentInputs.vPositionWSM-uniforms.lightDataSM)+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\ndepthSM=(-fragmentInputs.zSM+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#else\ndepthSM=(fragmentInputs.zSM+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#endif\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\nfragmentOutputs.fragDepth=clamp(1.0-depthSM,0.0,1.0);\n#else\nfragmentOutputs.fragDepth=clamp(depthSM,0.0,1.0); \n#endif\n#elif SM_USEDISTANCE==1\ndepthSM=(length(fragmentInputs.vPositionWSM-uniforms.lightDataSM)+uniforms.depthValuesSM.x)/uniforms.depthValuesSM.y+uniforms.biasAndScaleSM.x;\n#endif\n#if SM_ESM==1\ndepthSM=clamp(exp(-min(87.,uniforms.biasAndScaleSM.z*depthSM)),0.,1.);\n#endif\n#if SM_FLOAT==1\nfragmentOutputs.color= vec4f(depthSM,1.0,1.0,1.0);\n#else\nfragmentOutputs.color=pack(depthSM);\n#endif\n",e.IncludesShadersStoreWGSL[Ot]=Dt,Lt={name:Ot,shader:Dt}}}),Vt={};l(Vt,{shadowMapVertexMetric:()=>Ut});var Wt,zt,Xt,Yt=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexMetric.js"(){c(),Bt="shadowMapVertexMetric",Gt="#if SM_USEDISTANCE==1\nvPositionWSM=worldPos.xyz;\n#endif\n#if SM_DEPTHTEXTURE==1\n#ifdef IS_NDC_HALF_ZRANGE\n#define BIASFACTOR 0.5\n#else\n#define BIASFACTOR 1.0\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\ngl_Position.z-=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;\n#else\ngl_Position.z+=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;\n#endif\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nzSM=gl_Position.z;gl_Position.z=0.0;\n#elif SM_USEDISTANCE==0\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetricSM=(-gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\nvDepthMetricSM=(gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#endif\n",e.IncludesShadersStore[Bt]=Gt,Ut={name:Bt,shader:Gt}}}),jt={};l(jt,{packingFunctions:()=>Xt});var Kt,$t,qt,Jt=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/packingFunctions.js"(){c(),Wt="packingFunctions",zt="vec4 pack(float depth)\n{const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\nfloat unpack(vec4 color)\n{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}",e.IncludesShadersStore[Wt]=zt,Xt={name:Wt,shader:zt}}}),Qt={};l(Qt,{shadowMapFragment:()=>qt});var Zt,ei,ti,ii=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragment.js"(){c(),Kt="shadowMapFragment",$t="float depthSM=vDepthMetricSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\n#if SM_USEDISTANCE==1\ndepthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\ndepthSM=(-zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\ndepthSM=(zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\ngl_FragDepth=clamp(1.0-depthSM,0.0,1.0);\n#else\ngl_FragDepth=clamp(depthSM,0.0,1.0); \n#endif\n#elif SM_USEDISTANCE==1\ndepthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#if SM_ESM==1\ndepthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);\n#endif\n#if SM_FLOAT==1\ngl_FragColor=vec4(depthSM,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depthSM);\n#endif\nreturn;",e.IncludesShadersStore[Kt]=$t,qt={name:Kt,shader:$t}}}),ni=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurVaryingDeclaration.js"(){c(),"kernelBlurVaryingDeclaration","varying vec2 sampleCoord{X};",e.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};"}}),ai=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurFragment.js"(){c(),"kernelBlurFragment","#ifdef DOF\nfactor=sampleCoC(sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif\n",e.IncludesShadersStore.kernelBlurFragment="#ifdef DOF\nfactor=sampleCoC(sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif\n"}}),si=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurFragment2.js"(){c(),"kernelBlurFragment2","#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});computedWeight=KERNEL_DEP_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif\n",e.IncludesShadersStore.kernelBlurFragment2="#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});computedWeight=KERNEL_DEP_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif\n"}}),ri={};l(ri,{kernelBlurPixelShader:()=>ti});var oi,li,ci,hi=o({"../node_modules/@babylonjs/core/Shaders/kernelBlur.fragment.js"(){c(),ni(),Jt(),ai(),si(),Zt="kernelBlurPixelShader",ei="uniform sampler2D textureSampler;uniform vec2 delta;varying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;float sampleCoC(in vec2 offset) {float coc=texture2D(circleOfConfusionSampler,offset).r;return coc; }\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\n#include<packingFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{float computedWeight=0.0;\n#ifdef PACKEDFLOAT\nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT; \nfloat factor=0.0;\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}",e.ShadersStore[Zt]=ei,ti={name:Zt,shader:ei}}}),fi=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurVertex.js"(){c(),"kernelBlurVertex","sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",e.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};"}}),ui={};l(ui,{kernelBlurVertexShader:()=>ci});var di,mi,pi,_i=o({"../node_modules/@babylonjs/core/Shaders/kernelBlur.vertex.js"(){c(),ni(),fi(),oi="kernelBlurVertexShader",li="attribute vec2 position;uniform vec2 delta;varying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStore[oi]=li,ci={name:oi,shader:li}}}),vi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/kernelBlurVaryingDeclaration.js"(){c(),"kernelBlurVaryingDeclaration","varying sampleCoord{X}: vec2f;",e.IncludesShadersStoreWGSL.kernelBlurVaryingDeclaration="varying sampleCoord{X}: vec2f;"}}),gi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/kernelBlurFragment.js"(){c(),"kernelBlurFragment","#ifdef DOF\nfactor=sampleCoC(fragmentInputs.sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCoord{X}))*computedWeight;\n#else\nblend+=textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCoord{X})*computedWeight;\n#endif\n",e.IncludesShadersStoreWGSL.kernelBlurFragment="#ifdef DOF\nfactor=sampleCoC(fragmentInputs.sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCoord{X}))*computedWeight;\n#else\nblend+=textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCoord{X})*computedWeight;\n#endif\n"}}),Si=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/kernelBlurFragment2.js"(){c(),"kernelBlurFragment2","#ifdef DOF\nfactor=sampleCoC(fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X});computedWeight=KERNEL_DEP_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif\n",e.IncludesShadersStoreWGSL.kernelBlurFragment2="#ifdef DOF\nfactor=sampleCoC(fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X});computedWeight=KERNEL_DEP_WEIGHT{X}*factor;sumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=textureSample(textureSampler,textureSamplerSampler,fragmentInputs.sampleCenter+uniforms.delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif\n"}}),yi={};l(yi,{kernelBlurPixelShaderWGSL:()=>pi});var Ei,Ai,Ci,Ri=o({"../node_modules/@babylonjs/core/ShadersWGSL/kernelBlur.fragment.js"(){c(),vi(),Ft(),gi(),Si(),di="kernelBlurPixelShader",mi="var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;uniform delta: vec2f;varying sampleCenter: vec2f;\n#ifdef DOF\nvar circleOfConfusionSamplerSampler: sampler;var circleOfConfusionSampler: texture_2d<f32>;fn sampleCoC(offset: vec2f)->f32 {var coc: f32=textureSample(circleOfConfusionSampler,circleOfConfusionSamplerSampler,offset).r;return coc; }\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\n#include<packingFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {var computedWeight: f32=0.0;\n#ifdef PACKEDFLOAT\nvar blend: f32=0.;\n#else\nvar blend: vec4f= vec4f(0.);\n#endif\n#ifdef DOF\nvar sumOfWeights: f32=CENTER_WEIGHT; \nvar factor: f32=0.0;\n#ifdef PACKEDFLOAT\nblend+=unpack(textureSample(textureSampler,textureSamplerSampler,input.sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=textureSample(textureSampler,textureSamplerSampler,input.sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\nfragmentOutputs.color=pack(blend);\n#else\nfragmentOutputs.color=blend;\n#endif\n#ifdef DOF\nfragmentOutputs.color/=sumOfWeights;\n#endif\n}",e.ShadersStoreWGSL[di]=mi,pi={name:di,shader:mi}}}),Ti=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/kernelBlurVertex.js"(){c(),"kernelBlurVertex","vertexOutputs.sampleCoord{X}=vertexOutputs.sampleCenter+uniforms.delta*KERNEL_OFFSET{X};",e.IncludesShadersStoreWGSL.kernelBlurVertex="vertexOutputs.sampleCoord{X}=vertexOutputs.sampleCenter+uniforms.delta*KERNEL_OFFSET{X};"}}),Ni={};l(Ni,{kernelBlurVertexShaderWGSL:()=>Ci});var Mi,Ii,xi,bi=o({"../node_modules/@babylonjs/core/ShadersWGSL/kernelBlur.vertex.js"(){c(),vi(),Ti(),Ei="kernelBlurVertexShader",Ai="attribute position: vec2f;uniform delta: vec2f;varying sampleCenter: vec2f;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {const madd: vec2f= vec2f(0.5,0.5);\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvertexOutputs.sampleCenter=(input.position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\nvertexOutputs.position= vec4f(input.position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStoreWGSL[Ei]=Ai,Ci={name:Ei,shader:Ai}}}),Pi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bayerDitherFunctions.js"(){c(),"bayerDitherFunctions","fn bayerDither2(_P: vec2f)->f32 {return ((2.0*_P.y+_P.x+1.0)%(4.0));}\nfn bayerDither4(_P: vec2f)->f32 {var P1: vec2f=((_P)%(2.0)); \nvar P2: vec2f=floor(0.5*((_P)%(4.0))); \nreturn 4.0*bayerDither2(P1)+bayerDither2(P2);}\nfn bayerDither8(_P: vec2f)->f32 {var P1: vec2f=((_P)%(2.0)); \nvar P2: vec2f=floor(0.5 *((_P)%(4.0))); \nvar P4: vec2f=floor(0.25*((_P)%(8.0))); \nreturn 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);}\n",e.IncludesShadersStoreWGSL.bayerDitherFunctions="fn bayerDither2(_P: vec2f)->f32 {return ((2.0*_P.y+_P.x+1.0)%(4.0));}\nfn bayerDither4(_P: vec2f)->f32 {var P1: vec2f=((_P)%(2.0)); \nvar P2: vec2f=floor(0.5*((_P)%(4.0))); \nreturn 4.0*bayerDither2(P1)+bayerDither2(P2);}\nfn bayerDither8(_P: vec2f)->f32 {var P1: vec2f=((_P)%(2.0)); \nvar P2: vec2f=floor(0.5 *((_P)%(4.0))); \nvar P4: vec2f=floor(0.25*((_P)%(8.0))); \nreturn 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);}\n"}}),wi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapFragmentExtraDeclaration.js"(){c(),Ft(),Pi(),"shadowMapFragmentExtraDeclaration","#if SM_FLOAT==0\n#include<packingFunctions>\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#include<bayerDitherFunctions>\nuniform softTransparentShadowSM: vec2f;\n#endif\nvarying vDepthMetricSM: f32;\n#if SM_USEDISTANCE==1\nuniform lightDataSM: vec3f;varying vPositionWSM: vec3f;\n#endif\nuniform biasAndScaleSM: vec3f;uniform depthValuesSM: vec2f;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying zSM: f32;\n#endif\n",e.IncludesShadersStoreWGSL.shadowMapFragmentExtraDeclaration="#if SM_FLOAT==0\n#include<packingFunctions>\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#include<bayerDitherFunctions>\nuniform softTransparentShadowSM: vec2f;\n#endif\nvarying vDepthMetricSM: f32;\n#if SM_USEDISTANCE==1\nuniform lightDataSM: vec3f;varying vPositionWSM: vec3f;\n#endif\nuniform biasAndScaleSM: vec3f;uniform depthValuesSM: vec2f;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying zSM: f32;\n#endif\n"}}),Oi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/clipPlaneFragmentDeclaration.js"(){c(),"clipPlaneFragmentDeclaration","#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n",e.IncludesShadersStoreWGSL.clipPlaneFragmentDeclaration="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n"}}),Di=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/clipPlaneFragment.js"(){c(),"clipPlaneFragment","#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n",e.IncludesShadersStoreWGSL.clipPlaneFragment="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n"}}),Li={};l(Li,{shadowMapPixelShaderWGSL:()=>xi});var Fi,ki,Bi,Gi=o({"../node_modules/@babylonjs/core/ShadersWGSL/shadowMap.fragment.js"(){c(),wi(),Oi(),Di(),Ht(),Mi="shadowMapPixelShader",Ii="#include<shadowMapFragmentExtraDeclaration>\n#ifdef ALPHATEXTURE\nvarying vUV: vec2f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#include<clipPlaneFragment>\n#ifdef ALPHATEXTURE\nvar opacityMap: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,fragmentInputs.vUV);var alphaFromAlphaTexture: f32=opacityMap.a;\n#if SM_SOFTTRANSPARENTSHADOW==1\nif (uniforms.softTransparentShadowSM.y==1.0) {opacityMap=vec4f(opacityMap.rgb* vec3f(0.3,0.59,0.11),opacityMap.a);alphaFromAlphaTexture=opacityMap.x+opacityMap.y+opacityMap.z;}\n#endif\n#ifdef ALPHATESTVALUE\nif (alphaFromAlphaTexture<ALPHATESTVALUE) {discard;}\n#endif\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#ifdef ALPHATEXTURE\nif ((bayerDither8(floor(((fragmentInputs.position.xy)%(8.0)))))/64.0>=uniforms.softTransparentShadowSM.x*alphaFromAlphaTexture) {discard;}\n#else\nif ((bayerDither8(floor(((fragmentInputs.position.xy)%(8.0)))))/64.0>=uniforms.softTransparentShadowSM.x) {discard;} \n#endif\n#endif\n#include<shadowMapFragment>\n}",e.ShadersStoreWGSL[Mi]=Ii,xi={name:Mi,shader:Ii}}}),Ui=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bakedVertexAnimationDeclaration.js"(){c(),"bakedVertexAnimationDeclaration","#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform bakedVertexAnimationTime: f32;uniform bakedVertexAnimationTextureSizeInverted: vec2<f32>;uniform bakedVertexAnimationSettings: vec4<f32>;var bakedVertexAnimationTexture : texture_2d<f32>;\n#ifdef INSTANCES\nattribute bakedVertexAnimationSettingsInstanced : vec4<f32>;\n#endif\nfn readMatrixFromRawSamplerVAT(smp : texture_2d<f32>,index : f32,frame : f32)->mat4x4<f32>\n{let offset=i32(index)*4;let frameUV=i32(frame);let m0=textureLoad(smp,vec2<i32>(offset+0,frameUV),0);let m1=textureLoad(smp,vec2<i32>(offset+1,frameUV),0);let m2=textureLoad(smp,vec2<i32>(offset+2,frameUV),0);let m3=textureLoad(smp,vec2<i32>(offset+3,frameUV),0);return mat4x4<f32>(m0,m1,m2,m3);}\n#endif\n",e.IncludesShadersStoreWGSL.bakedVertexAnimationDeclaration="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform bakedVertexAnimationTime: f32;uniform bakedVertexAnimationTextureSizeInverted: vec2<f32>;uniform bakedVertexAnimationSettings: vec4<f32>;var bakedVertexAnimationTexture : texture_2d<f32>;\n#ifdef INSTANCES\nattribute bakedVertexAnimationSettingsInstanced : vec4<f32>;\n#endif\nfn readMatrixFromRawSamplerVAT(smp : texture_2d<f32>,index : f32,frame : f32)->mat4x4<f32>\n{let offset=i32(index)*4;let frameUV=i32(frame);let m0=textureLoad(smp,vec2<i32>(offset+0,frameUV),0);let m1=textureLoad(smp,vec2<i32>(offset+1,frameUV),0);let m2=textureLoad(smp,vec2<i32>(offset+2,frameUV),0);let m3=textureLoad(smp,vec2<i32>(offset+3,frameUV),0);return mat4x4<f32>(m0,m1,m2,m3);}\n#endif\n"}}),Hi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/morphTargetsVertexGlobalDeclaration.js"(){c(),"morphTargetsVertexGlobalDeclaration","#ifdef MORPHTARGETS\nuniform morphTargetInfluences : array<f32,NUM_MORPH_INFLUENCERS>;\n#ifdef MORPHTARGETS_TEXTURE \nuniform morphTargetTextureIndices : array<f32,NUM_MORPH_INFLUENCERS>;uniform morphTargetTextureInfo : vec3<f32>;var morphTargets : texture_2d_array<f32>;var morphTargetsSampler : sampler;fn readVector3FromRawSampler(targetIndex : i32,vertexIndex : f32)->vec3<f32>\n{ \nlet y=floor(vertexIndex/uniforms.morphTargetTextureInfo.y);let x=vertexIndex-y*uniforms.morphTargetTextureInfo.y;let textureUV=vec2<f32>((x+0.5)/uniforms.morphTargetTextureInfo.y,(y+0.5)/uniforms.morphTargetTextureInfo.z);return textureSampleLevel(morphTargets,morphTargetsSampler,textureUV,i32(uniforms.morphTargetTextureIndices[targetIndex]),0.0).xyz;}\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.morphTargetsVertexGlobalDeclaration="#ifdef MORPHTARGETS\nuniform morphTargetInfluences : array<f32,NUM_MORPH_INFLUENCERS>;\n#ifdef MORPHTARGETS_TEXTURE \nuniform morphTargetTextureIndices : array<f32,NUM_MORPH_INFLUENCERS>;uniform morphTargetTextureInfo : vec3<f32>;var morphTargets : texture_2d_array<f32>;var morphTargetsSampler : sampler;fn readVector3FromRawSampler(targetIndex : i32,vertexIndex : f32)->vec3<f32>\n{ \nlet y=floor(vertexIndex/uniforms.morphTargetTextureInfo.y);let x=vertexIndex-y*uniforms.morphTargetTextureInfo.y;let textureUV=vec2<f32>((x+0.5)/uniforms.morphTargetTextureInfo.y,(y+0.5)/uniforms.morphTargetTextureInfo.z);return textureSampleLevel(morphTargets,morphTargetsSampler,textureUV,i32(uniforms.morphTargetTextureIndices[targetIndex]),0.0).xyz;}\n#endif\n#endif\n"}}),Vi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/morphTargetsVertexDeclaration.js"(){c(),"morphTargetsVertexDeclaration","#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute position{X} : vec3<f32>;\n#ifdef MORPHTARGETS_NORMAL\nattribute normal{X} : vec3<f32>;\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute tangent{X} : vec3<f32>;\n#endif\n#ifdef MORPHTARGETS_UV\nattribute uv_{X} : vec2<f32>;\n#endif\n#elif {X}==0\nuniform morphTargetCount: i32;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.morphTargetsVertexDeclaration="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute position{X} : vec3<f32>;\n#ifdef MORPHTARGETS_NORMAL\nattribute normal{X} : vec3<f32>;\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute tangent{X} : vec3<f32>;\n#endif\n#ifdef MORPHTARGETS_UV\nattribute uv_{X} : vec2<f32>;\n#endif\n#elif {X}==0\nuniform morphTargetCount: i32;\n#endif\n#endif\n"}}),Wi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/sceneUboDeclaration.js"(){c(),"sceneUboDeclaration","struct Scene {viewProjection : mat4x4<f32>,\n#ifdef MULTIVIEW\nviewProjectionR : mat4x4<f32>,\n#endif \nview : mat4x4<f32>,\nprojection : mat4x4<f32>,\nvEyePosition : vec4<f32>,};var<uniform> scene : Scene;\n",e.IncludesShadersStoreWGSL.sceneUboDeclaration="struct Scene {viewProjection : mat4x4<f32>,\n#ifdef MULTIVIEW\nviewProjectionR : mat4x4<f32>,\n#endif \nview : mat4x4<f32>,\nprojection : mat4x4<f32>,\nvEyePosition : vec4<f32>,};var<uniform> scene : Scene;\n"}}),zi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/meshUboDeclaration.js"(){c(),"meshUboDeclaration","struct Mesh {world : mat4x4<f32>,\nvisibility : f32,};var<uniform> mesh : Mesh;\n#define WORLD_UBO\n",e.IncludesShadersStoreWGSL.meshUboDeclaration="struct Mesh {world : mat4x4<f32>,\nvisibility : f32,};var<uniform> mesh : Mesh;\n#define WORLD_UBO\n"}}),Xi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapVertexExtraDeclaration.js"(){c(),"shadowMapVertexExtraDeclaration","#if SM_NORMALBIAS==1\nuniform lightDataSM: vec3f;\n#endif\nuniform biasAndScaleSM: vec3f;uniform depthValuesSM: vec2f;varying vDepthMetricSM: f32;\n#if SM_USEDISTANCE==1\nvarying vPositionWSM: vec3f;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying zSM: f32;\n#endif\n",e.IncludesShadersStoreWGSL.shadowMapVertexExtraDeclaration="#if SM_NORMALBIAS==1\nuniform lightDataSM: vec3f;\n#endif\nuniform biasAndScaleSM: vec3f;uniform depthValuesSM: vec2f;varying vDepthMetricSM: f32;\n#if SM_USEDISTANCE==1\nvarying vPositionWSM: vec3f;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying zSM: f32;\n#endif\n"}}),Yi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/clipPlaneVertexDeclaration.js"(){c(),"clipPlaneVertexDeclaration","#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n",e.IncludesShadersStoreWGSL.clipPlaneVertexDeclaration="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n"}}),ji=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/morphTargetsVertexGlobal.js"(){c(),"morphTargetsVertexGlobal","#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nvar vertexID : f32;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.morphTargetsVertexGlobal="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nvar vertexID : f32;\n#endif\n#endif\n"}}),Ki=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/morphTargetsVertex.js"(){c(),"morphTargetsVertex","#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\n#if {X}==0\nfor (var i=0; i<NUM_MORPH_INFLUENCERS; i=i+1) {if (i>=uniforms.morphTargetCount) {break;}\nvertexID=f32(vertexInputs.vertexIndex)*uniforms.morphTargetTextureInfo.x;positionUpdated=positionUpdated+(readVector3FromRawSampler(i,vertexID)-vertexInputs.position)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated=normalUpdated+(readVector3FromRawSampler(i,vertexID) -vertexInputs.normal)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated=uvUpdated+(readVector3FromRawSampler(i,vertexID).xy-vertexInputs.uv)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated=vec4f(tangentUpdated.xyz+(readVector3FromRawSampler(i,vertexID) -vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[i],tangentUpdated.a);\n#endif\n}\n#endif\n#else\npositionUpdated=positionUpdated+(vertexInputs.position{X}-vertexInputs.position)*uniforms.morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(vertexInputs.normal{X}-vertexInputs.normal)*uniforms.morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated=vec4f(tangentUpdated.xyz+(vertexInputs.tangent{X}-vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[{X}],tangentUpdated.a);\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated=uvUpdated+(vertexInputs.uv_{X}-vertexInputs.uv)*uniforms.morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.morphTargetsVertex="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\n#if {X}==0\nfor (var i=0; i<NUM_MORPH_INFLUENCERS; i=i+1) {if (i>=uniforms.morphTargetCount) {break;}\nvertexID=f32(vertexInputs.vertexIndex)*uniforms.morphTargetTextureInfo.x;positionUpdated=positionUpdated+(readVector3FromRawSampler(i,vertexID)-vertexInputs.position)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated=normalUpdated+(readVector3FromRawSampler(i,vertexID) -vertexInputs.normal)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated=uvUpdated+(readVector3FromRawSampler(i,vertexID).xy-vertexInputs.uv)*uniforms.morphTargetInfluences[i];vertexID=vertexID+1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated=vec4f(tangentUpdated.xyz+(readVector3FromRawSampler(i,vertexID) -vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[i],tangentUpdated.a);\n#endif\n}\n#endif\n#else\npositionUpdated=positionUpdated+(vertexInputs.position{X}-vertexInputs.position)*uniforms.morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(vertexInputs.normal{X}-vertexInputs.normal)*uniforms.morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated=vec4f(tangentUpdated.xyz+(vertexInputs.tangent{X}-vertexInputs.tangent.xyz)*uniforms.morphTargetInfluences[{X}],tangentUpdated.a);\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated=uvUpdated+(vertexInputs.uv_{X}-vertexInputs.uv)*uniforms.morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n"}}),$i=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/instancesVertex.js"(){c(),"instancesVertex","#ifdef INSTANCES\nvar finalWorld=mat4x4<f32>(vertexInputs.world0,vertexInputs.world1,vertexInputs.world2,vertexInputs.world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nvar finalPreviousWorld=mat4x4<f32>(vertexInputs.previousWorld0,vertexInputs.previousWorld1,vertexInputs.previousWorld2,vertexInputs.previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\n#if !defined(WORLD_UBO)\nfinalWorld=uniforms.world*finalWorld;\n#else\nfinalWorld=mesh.world*finalWorld;\n#endif\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=uniforms.previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nvar finalWorld=uniforms.world;\n#else\nvar finalWorld=mesh.world;\n#endif\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nvar finalPreviousWorld=uniforms.previousWorld;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.instancesVertex="#ifdef INSTANCES\nvar finalWorld=mat4x4<f32>(vertexInputs.world0,vertexInputs.world1,vertexInputs.world2,vertexInputs.world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nvar finalPreviousWorld=mat4x4<f32>(vertexInputs.previousWorld0,vertexInputs.previousWorld1,vertexInputs.previousWorld2,vertexInputs.previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\n#if !defined(WORLD_UBO)\nfinalWorld=uniforms.world*finalWorld;\n#else\nfinalWorld=mesh.world*finalWorld;\n#endif\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=uniforms.previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nvar finalWorld=uniforms.world;\n#else\nvar finalWorld=mesh.world;\n#endif\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nvar finalPreviousWorld=uniforms.previousWorld;\n#endif\n#endif\n"}}),qi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bakedVertexAnimation.js"(){c(),"bakedVertexAnimation","#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\nlet VATStartFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.x;let VATEndFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.y;let VATOffsetFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.z;let VATSpeed: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.w;\n#else\nlet VATStartFrame: f32=uniforms.bakedVertexAnimationSettings.x;let VATEndFrame: f32=uniforms.bakedVertexAnimationSettings.y;let VATOffsetFrame: f32=uniforms.bakedVertexAnimationSettings.z;let VATSpeed: f32=uniforms.bakedVertexAnimationSettings.w;\n#endif\nlet totalFrames: f32=VATEndFrame-VATStartFrame+1.0;let time: f32=uniforms.bakedVertexAnimationTime*VATSpeed/totalFrames;let frameCorrection: f32=select(1.0,0.0,time<1.0);let numOfFrames: f32=totalFrames-frameCorrection;var VATFrameNum: f32=fract(time)*numOfFrames;VATFrameNum=(VATFrameNum+VATOffsetFrame) % numOfFrames;VATFrameNum=floor(VATFrameNum);VATFrameNum=VATFrameNum+VATStartFrame+frameCorrection;var VATInfluence : mat4x4<f32>;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[0],VATFrameNum)*vertexInputs.matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[1],VATFrameNum)*vertexInputs.matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[2],VATFrameNum)*vertexInputs.matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[3],VATFrameNum)*vertexInputs.matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[0],VATFrameNum)*vertexInputs.matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[1],VATFrameNum)*vertexInputs.matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[2],VATFrameNum)*vertexInputs.matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[3],VATFrameNum)*vertexInputs.matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;}\n#endif\n",e.IncludesShadersStoreWGSL.bakedVertexAnimation="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\nlet VATStartFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.x;let VATEndFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.y;let VATOffsetFrame: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.z;let VATSpeed: f32=vertexInputs.bakedVertexAnimationSettingsInstanced.w;\n#else\nlet VATStartFrame: f32=uniforms.bakedVertexAnimationSettings.x;let VATEndFrame: f32=uniforms.bakedVertexAnimationSettings.y;let VATOffsetFrame: f32=uniforms.bakedVertexAnimationSettings.z;let VATSpeed: f32=uniforms.bakedVertexAnimationSettings.w;\n#endif\nlet totalFrames: f32=VATEndFrame-VATStartFrame+1.0;let time: f32=uniforms.bakedVertexAnimationTime*VATSpeed/totalFrames;let frameCorrection: f32=select(1.0,0.0,time<1.0);let numOfFrames: f32=totalFrames-frameCorrection;var VATFrameNum: f32=fract(time)*numOfFrames;VATFrameNum=(VATFrameNum+VATOffsetFrame) % numOfFrames;VATFrameNum=floor(VATFrameNum);VATFrameNum=VATFrameNum+VATStartFrame+frameCorrection;var VATInfluence : mat4x4<f32>;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[0],VATFrameNum)*vertexInputs.matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[1],VATFrameNum)*vertexInputs.matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[2],VATFrameNum)*vertexInputs.matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndices[3],VATFrameNum)*vertexInputs.matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[0],VATFrameNum)*vertexInputs.matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[1],VATFrameNum)*vertexInputs.matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[2],VATFrameNum)*vertexInputs.matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence=VATInfluence+readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,vertexInputs.matricesIndicesExtra[3],VATFrameNum)*vertexInputs.matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;}\n#endif\n"}}),Ji=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapVertexNormalBias.js"(){c(),"shadowMapVertexNormalBias","#if SM_NORMALBIAS==1\n#if SM_DIRECTIONINLIGHTDATA==1\nvar worldLightDirSM: vec3f=normalize(-uniforms.lightDataSM.xyz);\n#else\nvar directionToLightSM: vec3f=uniforms.lightDataSM.xyz-worldPos.xyz;var worldLightDirSM: vec3f=normalize(directionToLightSM);\n#endif\nvar ndlSM: f32=dot(vNormalW,worldLightDirSM);var sinNLSM: f32=sqrt(1.0-ndlSM*ndlSM);var normalBiasSM: f32=uniforms.biasAndScaleSM.y*sinNLSM;worldPos=vec4f(worldPos.xyz-vNormalW*normalBiasSM,worldPos.w);\n#endif\n",e.IncludesShadersStoreWGSL.shadowMapVertexNormalBias="#if SM_NORMALBIAS==1\n#if SM_DIRECTIONINLIGHTDATA==1\nvar worldLightDirSM: vec3f=normalize(-uniforms.lightDataSM.xyz);\n#else\nvar directionToLightSM: vec3f=uniforms.lightDataSM.xyz-worldPos.xyz;var worldLightDirSM: vec3f=normalize(directionToLightSM);\n#endif\nvar ndlSM: f32=dot(vNormalW,worldLightDirSM);var sinNLSM: f32=sqrt(1.0-ndlSM*ndlSM);var normalBiasSM: f32=uniforms.biasAndScaleSM.y*sinNLSM;worldPos=vec4f(worldPos.xyz-vNormalW*normalBiasSM,worldPos.w);\n#endif\n"}}),Qi=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/clipPlaneVertex.js"(){c(),"clipPlaneVertex","#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n",e.IncludesShadersStoreWGSL.clipPlaneVertex="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n"}}),Zi={};l(Zi,{shadowMapVertexShaderWGSL:()=>Bi});var en,tn,nn,an=o({"../node_modules/@babylonjs/core/ShadersWGSL/shadowMap.vertex.js"(){c(),x(),Ui(),Hi(),Vi(),he(),Wi(),zi(),Xi(),Yi(),ji(),Ki(),$i(),D(),qi(),Ji(),Pt(),Qi(),Fi="shadowMapVertexShader",ki="attribute position: vec3f;\n#ifdef NORMAL\nattribute normal: vec3f;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef INSTANCES\nattribute world0: vec4f;attribute world1: vec4f;attribute world2: vec4f;attribute world3: vec4f;\n#endif\n#include<helperFunctions>\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n#ifdef ALPHATEXTURE\nvarying vUV: vec2f;uniform diffuseMatrix: mat4x4f;\n#ifdef UV1\nattribute uv: vec2f;\n#endif\n#ifdef UV2\nattribute uv2: vec2f;\n#endif\n#endif\n#include<shadowMapVertexExtraDeclaration>\n#include<clipPlaneVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {var positionUpdated: vec3f=input.position;\n#ifdef UV1\nvar uvUpdated: vec2f=input.uv;\n#endif\n#ifdef NORMAL\nvar normalUpdated: vec3f=input.normal;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld* vec4f(positionUpdated,1.0);\n#ifdef NORMAL\nvar normWorldSM: mat3x3f= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvar vNormalW: vec3f=normalUpdated/ vec3f(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));vNormalW=normalize(normWorldSM*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormWorldSM=transposeMat3(inverseMat3(normWorldSM));\n#endif\nvar vNormalW: vec3f=normalize(normWorldSM*normalUpdated);\n#endif\n#endif\n#include<shadowMapVertexNormalBias>\nvertexOutputs.position=scene.viewProjection*worldPos;\n#include<shadowMapVertexMetric>\n#ifdef ALPHATEXTURE\n#ifdef UV1\nvertexOutputs.vUV= (uniforms.diffuseMatrix* vec4f(uvUpdated,1.0,0.0)).xy;\n#endif\n#ifdef UV2\nvertexOutputs.vUV= (uniforms.diffuseMatrix* vec4f(input.uv2,1.0,0.0)).xy;\n#endif\n#endif\n#include<clipPlaneVertex>\n}",e.ShadersStoreWGSL[Fi]=ki,Bi={name:Fi,shader:ki}}}),sn={};l(sn,{depthBoxBlurPixelShaderWGSL:()=>nn});var rn,on,ln,cn=o({"../node_modules/@babylonjs/core/ShadersWGSL/depthBoxBlur.fragment.js"(){c(),en="depthBoxBlurPixelShader",tn="varying vUV: vec2f;var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;uniform screenSize: vec2f;\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {var colorDepth: vec4f=vec4f(0.0);for (var x: i32=-OFFSET; x<=OFFSET; x++) {for (var y: i32=-OFFSET; y<=OFFSET; y++) {colorDepth+=textureSample(textureSampler,textureSamplerSampler,input.vUV+ vec2f(f32(x),f32(y))/uniforms.screenSize);}}\nfragmentOutputs.color=(colorDepth/ f32((OFFSET*2+1)*(OFFSET*2+1)));}",e.ShadersStoreWGSL[en]=tn,nn={name:en,shader:tn}}}),hn={};l(hn,{shadowMapFragmentSoftTransparentShadowWGSL:()=>ln});var fn,un,dn,mn=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/shadowMapFragmentSoftTransparentShadow.js"(){c(),rn="shadowMapFragmentSoftTransparentShadow",on="#if SM_SOFTTRANSPARENTSHADOW==1\nif ((bayerDither8(floor(((fragmentInputs.position.xy)%(8.0)))))/64.0>=uniforms.softTransparentShadowSM.x*alpha) {discard;}\n#endif\n",e.IncludesShadersStoreWGSL[rn]=on,ln={name:rn,shader:on}}}),pn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bayerDitherFunctions.js"(){c(),"bayerDitherFunctions","float bayerDither2(vec2 _P) {return mod(2.0*_P.y+_P.x+1.0,4.0);}\nfloat bayerDither4(vec2 _P) {vec2 P1=mod(_P,2.0); \nvec2 P2=floor(0.5*mod(_P,4.0)); \nreturn 4.0*bayerDither2(P1)+bayerDither2(P2);}\nfloat bayerDither8(vec2 _P) {vec2 P1=mod(_P,2.0); \nvec2 P2=floor(0.5 *mod(_P,4.0)); \nvec2 P4=floor(0.25*mod(_P,8.0)); \nreturn 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);}\n",e.IncludesShadersStore.bayerDitherFunctions="float bayerDither2(vec2 _P) {return mod(2.0*_P.y+_P.x+1.0,4.0);}\nfloat bayerDither4(vec2 _P) {vec2 P1=mod(_P,2.0); \nvec2 P2=floor(0.5*mod(_P,4.0)); \nreturn 4.0*bayerDither2(P1)+bayerDither2(P2);}\nfloat bayerDither8(vec2 _P) {vec2 P1=mod(_P,2.0); \nvec2 P2=floor(0.5 *mod(_P,4.0)); \nvec2 P4=floor(0.25*mod(_P,8.0)); \nreturn 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);}\n"}}),_n=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragmentExtraDeclaration.js"(){c(),Jt(),pn(),"shadowMapFragmentExtraDeclaration","#if SM_FLOAT==0\n#include<packingFunctions>\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#include<bayerDitherFunctions>\nuniform vec2 softTransparentShadowSM;\n#endif\nvarying float vDepthMetricSM;\n#if SM_USEDISTANCE==1\nuniform vec3 lightDataSM;varying vec3 vPositionWSM;\n#endif\nuniform vec3 biasAndScaleSM;uniform vec2 depthValuesSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying float zSM;\n#endif\n",e.IncludesShadersStore.shadowMapFragmentExtraDeclaration="#if SM_FLOAT==0\n#include<packingFunctions>\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#include<bayerDitherFunctions>\nuniform vec2 softTransparentShadowSM;\n#endif\nvarying float vDepthMetricSM;\n#if SM_USEDISTANCE==1\nuniform vec3 lightDataSM;varying vec3 vPositionWSM;\n#endif\nuniform vec3 biasAndScaleSM;uniform vec2 depthValuesSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying float zSM;\n#endif\n"}}),vn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneFragmentDeclaration.js"(){c(),"clipPlaneFragmentDeclaration","#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n",e.IncludesShadersStore.clipPlaneFragmentDeclaration="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n"}}),gn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneFragment.js"(){c(),"clipPlaneFragment","#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n",e.IncludesShadersStore.clipPlaneFragment="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n"}}),Sn={};l(Sn,{shadowMapPixelShader:()=>dn});var yn,En,An,Cn=o({"../node_modules/@babylonjs/core/Shaders/shadowMap.fragment.js"(){c(),_n(),vn(),gn(),ii(),fn="shadowMapPixelShader",un="#include<shadowMapFragmentExtraDeclaration>\n#ifdef ALPHATEXTURE\nvarying vec2 vUV;uniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEXTURE\nvec4 opacityMap=texture2D(diffuseSampler,vUV);float alphaFromAlphaTexture=opacityMap.a;\n#if SM_SOFTTRANSPARENTSHADOW==1\nif (softTransparentShadowSM.y==1.0) {opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);alphaFromAlphaTexture=opacityMap.x+opacityMap.y+opacityMap.z;}\n#endif\n#ifdef ALPHATESTVALUE\nif (alphaFromAlphaTexture<ALPHATESTVALUE)\ndiscard;\n#endif\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#ifdef ALPHATEXTURE\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM.x*alphaFromAlphaTexture) discard;\n#else\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM.x) discard;\n#endif\n#endif\n#include<shadowMapFragment>\n}",e.ShadersStore[fn]=un,dn={name:fn,shader:un}}}),Rn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bakedVertexAnimationDeclaration.js"(){c(),"bakedVertexAnimationDeclaration","#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}\n#endif\n",e.IncludesShadersStore.bakedVertexAnimationDeclaration="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}\n#endif\n"}}),Tn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexGlobalDeclaration.js"(){c(),"morphTargetsVertexGlobalDeclaration","#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}\n#endif\n#endif\n",e.IncludesShadersStore.morphTargetsVertexGlobalDeclaration="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}\n#endif\n#endif\n"}}),Nn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexDeclaration.js"(){c(),"morphTargetsVertexDeclaration","#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#elif {X}==0\nuniform int morphTargetCount;\n#endif\n#endif\n",e.IncludesShadersStore.morphTargetsVertexDeclaration="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#elif {X}==0\nuniform int morphTargetCount;\n#endif\n#endif\n"}}),Mn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/sceneVertexDeclaration.js"(){c(),"sceneVertexDeclaration","uniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\nuniform mat4 view;uniform mat4 projection;uniform vec4 vEyePosition;\n",e.IncludesShadersStore.sceneVertexDeclaration="uniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\nuniform mat4 view;uniform mat4 projection;uniform vec4 vEyePosition;\n"}}),In=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/meshVertexDeclaration.js"(){c(),"meshVertexDeclaration","uniform mat4 world;uniform float visibility;\n",e.IncludesShadersStore.meshVertexDeclaration="uniform mat4 world;uniform float visibility;\n"}}),xn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexDeclaration.js"(){c(),Mn(),In(),"shadowMapVertexDeclaration","#include<sceneVertexDeclaration>\n#include<meshVertexDeclaration>\n",e.IncludesShadersStore.shadowMapVertexDeclaration="#include<sceneVertexDeclaration>\n#include<meshVertexDeclaration>\n"}}),bn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/sceneUboDeclaration.js"(){c(),"sceneUboDeclaration","layout(std140,column_major) uniform;uniform Scene {mat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif \nmat4 view;mat4 projection;vec4 vEyePosition;};\n",e.IncludesShadersStore.sceneUboDeclaration="layout(std140,column_major) uniform;uniform Scene {mat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif \nmat4 view;mat4 projection;vec4 vEyePosition;};\n"}}),Pn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/meshUboDeclaration.js"(){c(),"meshUboDeclaration","#ifdef WEBGL2\nuniform mat4 world;uniform float visibility;\n#else\nlayout(std140,column_major) uniform;uniform Mesh\n{mat4 world;float visibility;};\n#endif\n#define WORLD_UBO\n",e.IncludesShadersStore.meshUboDeclaration="#ifdef WEBGL2\nuniform mat4 world;uniform float visibility;\n#else\nlayout(std140,column_major) uniform;uniform Mesh\n{mat4 world;float visibility;};\n#endif\n#define WORLD_UBO\n"}}),wn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapUboDeclaration.js"(){c(),bn(),Pn(),"shadowMapUboDeclaration","layout(std140,column_major) uniform;\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",e.IncludesShadersStore.shadowMapUboDeclaration="layout(std140,column_major) uniform;\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n"}}),On=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexExtraDeclaration.js"(){c(),"shadowMapVertexExtraDeclaration","#if SM_NORMALBIAS==1\nuniform vec3 lightDataSM;\n#endif\nuniform vec3 biasAndScaleSM;uniform vec2 depthValuesSM;varying float vDepthMetricSM;\n#if SM_USEDISTANCE==1\nvarying vec3 vPositionWSM;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying float zSM;\n#endif\n",e.IncludesShadersStore.shadowMapVertexExtraDeclaration="#if SM_NORMALBIAS==1\nuniform vec3 lightDataSM;\n#endif\nuniform vec3 biasAndScaleSM;uniform vec2 depthValuesSM;varying float vDepthMetricSM;\n#if SM_USEDISTANCE==1\nvarying vec3 vPositionWSM;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying float zSM;\n#endif\n"}}),Dn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneVertexDeclaration.js"(){c(),"clipPlaneVertexDeclaration","#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n",e.IncludesShadersStore.clipPlaneVertexDeclaration="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n"}}),Ln=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexGlobal.js"(){c(),"morphTargetsVertexGlobal","#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n",e.IncludesShadersStore.morphTargetsVertexGlobal="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n"}}),Fn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertex.js"(){c(),"morphTargetsVertex","#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\n#if {X}==0\nfor (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (i>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;positionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];vertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];vertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];vertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];\n#endif\n}\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n",e.IncludesShadersStore.morphTargetsVertex="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\n#if {X}==0\nfor (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (i>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;positionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];vertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];vertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];vertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];\n#endif\n}\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n"}}),kn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/instancesVertex.js"(){c(),"instancesVertex","#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n",e.IncludesShadersStore.instancesVertex="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n"}}),Bn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bakedVertexAnimation.js"(){c(),"bakedVertexAnimation","#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;}\n#endif\n",e.IncludesShadersStore.bakedVertexAnimation="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;}\n#endif\n"}}),Gn=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexNormalBias.js"(){c(),"shadowMapVertexNormalBias","#if SM_NORMALBIAS==1\n#if SM_DIRECTIONINLIGHTDATA==1\nvec3 worldLightDirSM=normalize(-lightDataSM.xyz);\n#else\nvec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;vec3 worldLightDirSM=normalize(directionToLightSM);\n#endif\nfloat ndlSM=dot(vNormalW,worldLightDirSM);float sinNLSM=sqrt(1.0-ndlSM*ndlSM);float normalBiasSM=biasAndScaleSM.y*sinNLSM;worldPos.xyz-=vNormalW*normalBiasSM;\n#endif\n",e.IncludesShadersStore.shadowMapVertexNormalBias="#if SM_NORMALBIAS==1\n#if SM_DIRECTIONINLIGHTDATA==1\nvec3 worldLightDirSM=normalize(-lightDataSM.xyz);\n#else\nvec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;vec3 worldLightDirSM=normalize(directionToLightSM);\n#endif\nfloat ndlSM=dot(vNormalW,worldLightDirSM);float sinNLSM=sqrt(1.0-ndlSM*ndlSM);float normalBiasSM=biasAndScaleSM.y*sinNLSM;worldPos.xyz-=vNormalW*normalBiasSM;\n#endif\n"}}),Un=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneVertex.js"(){c(),"clipPlaneVertex","#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n",e.IncludesShadersStore.clipPlaneVertex="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n"}}),Hn={};l(Hn,{shadowMapVertexShader:()=>An});var Vn,Wn,zn,Xn=o({"../node_modules/@babylonjs/core/Shaders/shadowMap.vertex.js"(){c(),G(),Rn(),Tn(),Nn(),tt(),xn(),wn(),On(),Dn(),Ln(),Fn(),kn(),z(),Bn(),Gn(),Yt(),Un(),yn="shadowMapVertexShader",En="attribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef INSTANCES\nattribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;\n#endif\n#include<helperFunctions>\n#include<__decl__shadowMapVertex>\n#ifdef ALPHATEXTURE\nvarying vec2 vUV;uniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<shadowMapVertexExtraDeclaration>\n#include<clipPlaneVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{vec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normWorldSM=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvec3 vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));vNormalW=normalize(normWorldSM*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormWorldSM=transposeMat3(inverseMat3(normWorldSM));\n#endif\nvec3 vNormalW=normalize(normWorldSM*normalUpdated);\n#endif\n#endif\n#include<shadowMapVertexNormalBias>\ngl_Position=viewProjection*worldPos;\n#include<shadowMapVertexMetric>\n#ifdef ALPHATEXTURE\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<clipPlaneVertex>\n}",e.ShadersStore[yn]=En,An={name:yn,shader:En}}}),Yn={};l(Yn,{depthBoxBlurPixelShader:()=>zn});var jn,Kn,$n,qn=o({"../node_modules/@babylonjs/core/Shaders/depthBoxBlur.fragment.js"(){c(),Vn="depthBoxBlurPixelShader",Wn="varying vec2 vUV;uniform sampler2D textureSampler;uniform vec2 screenSize;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{vec4 colorDepth=vec4(0.0);for (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));}",e.ShadersStore[Vn]=Wn,zn={name:Vn,shader:Wn}}}),Jn={};l(Jn,{shadowMapFragmentSoftTransparentShadow:()=>$n});var Qn,Zn,ea,ta=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragmentSoftTransparentShadow.js"(){c(),jn="shadowMapFragmentSoftTransparentShadow",Kn="#if SM_SOFTTRANSPARENTSHADOW==1\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM.x*alpha) discard;\n#endif\n",e.IncludesShadersStore[jn]=Kn,$n={name:jn,shader:Kn}}}),ia={};l(ia,{passPixelShaderWGSL:()=>ea});var na,aa,sa,ra=o({"../node_modules/@babylonjs/core/ShadersWGSL/pass.fragment.js"(){c(),Qn="passPixelShader",Zn="varying vUV: vec2f;var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=textureSample(textureSampler,textureSamplerSampler,input.vUV);}",e.ShadersStoreWGSL[Qn]=Zn,ea={name:Qn,shader:Zn}}}),oa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/defaultUboDeclaration.js"(){c(),Wi(),zi(),"defaultUboDeclaration","uniform diffuseLeftColor: vec4f;uniform diffuseRightColor: vec4f;uniform opacityParts: vec4f;uniform reflectionLeftColor: vec4f;uniform reflectionRightColor: vec4f;uniform refractionLeftColor: vec4f;uniform refractionRightColor: vec4f;uniform emissiveLeftColor: vec4f;uniform emissiveRightColor: vec4f;uniform vDiffuseInfos: vec2f;uniform vAmbientInfos: vec2f;uniform vOpacityInfos: vec2f;uniform vReflectionInfos: vec2f;uniform vReflectionPosition: vec3f;uniform vReflectionSize: vec3f;uniform vEmissiveInfos: vec2f;uniform vLightmapInfos: vec2f;uniform vSpecularInfos: vec2f;uniform vBumpInfos: vec3f;uniform diffuseMatrix: mat4x4f;uniform ambientMatrix: mat4x4f;uniform opacityMatrix: mat4x4f;uniform reflectionMatrix: mat4x4f;uniform emissiveMatrix: mat4x4f;uniform lightmapMatrix: mat4x4f;uniform specularMatrix: mat4x4f;uniform bumpMatrix: mat4x4f;uniform vTangentSpaceParams: vec2f;uniform pointSize: f32;uniform alphaCutOff: f32;uniform refractionMatrix: mat4x4f;uniform vRefractionInfos: vec4f;uniform vRefractionPosition: vec3f;uniform vRefractionSize: vec3f;uniform vSpecularColor: vec4f;uniform vEmissiveColor: vec3f;uniform vDiffuseColor: vec4f;uniform vAmbientColor: vec3f;\n#define ADDITIONAL_UBO_DECLARATION\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",e.IncludesShadersStoreWGSL.defaultUboDeclaration="uniform diffuseLeftColor: vec4f;uniform diffuseRightColor: vec4f;uniform opacityParts: vec4f;uniform reflectionLeftColor: vec4f;uniform reflectionRightColor: vec4f;uniform refractionLeftColor: vec4f;uniform refractionRightColor: vec4f;uniform emissiveLeftColor: vec4f;uniform emissiveRightColor: vec4f;uniform vDiffuseInfos: vec2f;uniform vAmbientInfos: vec2f;uniform vOpacityInfos: vec2f;uniform vReflectionInfos: vec2f;uniform vReflectionPosition: vec3f;uniform vReflectionSize: vec3f;uniform vEmissiveInfos: vec2f;uniform vLightmapInfos: vec2f;uniform vSpecularInfos: vec2f;uniform vBumpInfos: vec3f;uniform diffuseMatrix: mat4x4f;uniform ambientMatrix: mat4x4f;uniform opacityMatrix: mat4x4f;uniform reflectionMatrix: mat4x4f;uniform emissiveMatrix: mat4x4f;uniform lightmapMatrix: mat4x4f;uniform specularMatrix: mat4x4f;uniform bumpMatrix: mat4x4f;uniform vTangentSpaceParams: vec2f;uniform pointSize: f32;uniform alphaCutOff: f32;uniform refractionMatrix: mat4x4f;uniform vRefractionInfos: vec4f;uniform vRefractionPosition: vec3f;uniform vRefractionSize: vec3f;uniform vSpecularColor: vec4f;uniform vEmissiveColor: vec3f;uniform vDiffuseColor: vec4f;uniform vAmbientColor: vec3f;\n#define ADDITIONAL_UBO_DECLARATION\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n"}}),la=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/uvAttributeDeclaration.js"(){c(),"uvAttributeDeclaration","#ifdef UV{X}\nattribute uv{X}: vec2f;\n#endif\n",e.IncludesShadersStoreWGSL.uvAttributeDeclaration="#ifdef UV{X}\nattribute uv{X}: vec2f;\n#endif\n"}}),ca=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/instancesDeclaration.js"(){c(),"instancesDeclaration","#ifdef INSTANCES\nattribute world0 : vec4<f32>;attribute world1 : vec4<f32>;attribute world2 : vec4<f32>;attribute world3 : vec4<f32>;\n#ifdef INSTANCESCOLOR\nattribute instanceColor : vec4<f32>;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform world : mat4x4<f32>;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute previousWorld0 : vec4<f32>;attribute previousWorld1 : vec4<f32>;attribute previousWorld2 : vec4<f32>;attribute previousWorld3 : vec4<f32>;\n#ifdef THIN_INSTANCES\nuniform previousWorld : mat4x4<f32>;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform world : mat4x4<f32>;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform previousWorld : mat4x4<f32>;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.instancesDeclaration="#ifdef INSTANCES\nattribute world0 : vec4<f32>;attribute world1 : vec4<f32>;attribute world2 : vec4<f32>;attribute world3 : vec4<f32>;\n#ifdef INSTANCESCOLOR\nattribute instanceColor : vec4<f32>;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform world : mat4x4<f32>;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute previousWorld0 : vec4<f32>;attribute previousWorld1 : vec4<f32>;attribute previousWorld2 : vec4<f32>;attribute previousWorld3 : vec4<f32>;\n#ifdef THIN_INSTANCES\nuniform previousWorld : mat4x4<f32>;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform world : mat4x4<f32>;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform previousWorld : mat4x4<f32>;\n#endif\n#endif\n"}}),ha=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/prePassVertexDeclaration.js"(){c(),"prePassVertexDeclaration","#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vViewPos: vec3f;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform previousViewProjection: mat4x4f;varying vCurrentPosition: vec4f;varying vPreviousPosition: vec4f;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.prePassVertexDeclaration="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vViewPos: vec3f;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform previousViewProjection: mat4x4f;varying vCurrentPosition: vec4f;varying vPreviousPosition: vec4f;\n#endif\n#endif\n"}}),fa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/mainUVVaryingDeclaration.js"(){c(),"mainUVVaryingDeclaration","#ifdef MAINUV{X}\nvarying vMainUV{X}: vec2f;\n#endif\n",e.IncludesShadersStoreWGSL.mainUVVaryingDeclaration="#ifdef MAINUV{X}\nvarying vMainUV{X}: vec2f;\n#endif\n"}}),ua=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/samplerVertexDeclaration.js"(){c(),"samplerVertexDeclaration","#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\n",e.IncludesShadersStoreWGSL.samplerVertexDeclaration="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\n"}}),da=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpVertexDeclaration.js"(){c(),"bumpVertexDeclaration","#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying vTBN0: vec3f;varying vTBN1: vec3f;varying vTBN2: vec3f;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.bumpVertexDeclaration="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying vTBN0: vec3f;varying vTBN1: vec3f;varying vTBN2: vec3f;\n#endif\n#endif\n"}}),ma=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fogVertexDeclaration.js"(){c(),"fogVertexDeclaration","#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n",e.IncludesShadersStoreWGSL.fogVertexDeclaration="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n"}}),pa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/lightVxFragmentDeclaration.js"(){c(),"lightVxFragmentDeclaration","#ifdef LIGHT{X}\nuniform vLightData{X}: vec4f;uniform vLightDiffuse{X}: vec4f;\n#ifdef SPECULARTERM\nuniform vLightSpecular{X}: vec4f;\n#else\nvar vLightSpecular{X}: vec4f= vec4f(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform lightMatrix{X}: mat4x4f[SHADOWCSMNUM_CASCADES{X}];varying var vPositionFromLight{X}: vec4f[SHADOWCSMNUM_CASCADES{X}];varying var vDepthMetric{X}: f32[SHADOWCSMNUM_CASCADES{X}];varying var vPositionFromCamera{X}: vec4f;\n#elif defined(SHADOWCUBE{X})\n#else\nvarying var vPositionFromLight{X}: vec4f;varying var vDepthMetric{X}: f32;uniform lightMatrix{X}: mat4x4f;\n#endif\nuniform shadowsInfo{X}: vec4f;uniform depthValues{X}: vec2f;\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vLightDirection{X}: vec4f;uniform vLightFalloff{X}: vec4f;\n#elif defined(POINTLIGHT{X})\nuniform vLightFalloff{X}: vec4f;\n#elif defined(HEMILIGHT{X})\nuniform vLightGround{X}: vec3f;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.lightVxFragmentDeclaration="#ifdef LIGHT{X}\nuniform vLightData{X}: vec4f;uniform vLightDiffuse{X}: vec4f;\n#ifdef SPECULARTERM\nuniform vLightSpecular{X}: vec4f;\n#else\nvar vLightSpecular{X}: vec4f= vec4f(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform lightMatrix{X}: mat4x4f[SHADOWCSMNUM_CASCADES{X}];varying var vPositionFromLight{X}: vec4f[SHADOWCSMNUM_CASCADES{X}];varying var vDepthMetric{X}: f32[SHADOWCSMNUM_CASCADES{X}];varying var vPositionFromCamera{X}: vec4f;\n#elif defined(SHADOWCUBE{X})\n#else\nvarying var vPositionFromLight{X}: vec4f;varying var vDepthMetric{X}: f32;uniform lightMatrix{X}: mat4x4f;\n#endif\nuniform shadowsInfo{X}: vec4f;uniform depthValues{X}: vec2f;\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vLightDirection{X}: vec4f;uniform vLightFalloff{X}: vec4f;\n#elif defined(POINTLIGHT{X})\nuniform vLightFalloff{X}: vec4f;\n#elif defined(HEMILIGHT{X})\nuniform vLightGround{X}: vec3f;\n#endif\n#endif\n"}}),_a=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/logDepthDeclaration.js"(){c(),"logDepthDeclaration","#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n",e.IncludesShadersStoreWGSL.logDepthDeclaration="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n"}}),va=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/prePassVertex.js"(){c(),"prePassVertex","#ifdef PREPASS_DEPTH\nvertexOutputs.vViewPos=(scene.view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvertexOutputs.vCurrentPosition=scene.viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nvar previousInfluence: mat4x4f;previousInfluence=mPreviousBones[ i32(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld*previousInfluence* vec4f(positionUpdated,1.0);\n#else\nvertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld* vec4f(positionUpdated,1.0);\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.prePassVertex="#ifdef PREPASS_DEPTH\nvertexOutputs.vViewPos=(scene.view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvertexOutputs.vCurrentPosition=scene.viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nvar previousInfluence: mat4x4f;previousInfluence=mPreviousBones[ i32(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[ i32(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[ i32(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld*previousInfluence* vec4f(positionUpdated,1.0);\n#else\nvertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld* vec4f(positionUpdated,1.0);\n#endif\n#endif\n"}}),Sa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/uvVariableDeclaration.js"(){c(),"uvVariableDeclaration","#ifdef MAINUV{X}\n#if !defined(UV{X})\nvar uv{X}: vec2f=vec2f(0.,0.);\n#else\nvar uv{X}: vec2f=vertexInputs.uv{X};\n#endif\nvertexOutputs.vMainUV{X}=uv{X};\n#endif\n",e.IncludesShadersStoreWGSL.uvVariableDeclaration="#ifdef MAINUV{X}\n#if !defined(UV{X})\nvar uv{X}: vec2f=vec2f(0.,0.);\n#else\nvar uv{X}: vec2f=vertexInputs.uv{X};\n#endif\nvertexOutputs.vMainUV{X}=uv{X};\n#endif\n"}}),ya=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/samplerVertexImplementation.js"(){c(),"samplerVertexImplementation","#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (uniforms.v_INFONAME_==0.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(uvUpdated,1.0,0.0)).xy;}\n#ifdef UV2\nelse if (uniforms.v_INFONAME_==1.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv2,1.0,0.0)).xy;}\n#endif\n#ifdef UV3\nelse if (uniforms.v_INFONAME_==2.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv3,1.0,0.0)).xy;}\n#endif\n#ifdef UV4\nelse if (uniforms.v_INFONAME_==3.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv4,1.0,0.0)).xy;}\n#endif\n#ifdef UV5\nelse if (uniforms.v_INFONAME_==4.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv5,1.0,0.0)).xy;}\n#endif\n#ifdef UV6\nelse if (uniforms.v_INFONAME_==5.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv6,1.0,0.0)).xy;}\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.samplerVertexImplementation="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (uniforms.v_INFONAME_==0.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(uvUpdated,1.0,0.0)).xy;}\n#ifdef UV2\nelse if (uniforms.v_INFONAME_==1.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv2,1.0,0.0)).xy;}\n#endif\n#ifdef UV3\nelse if (uniforms.v_INFONAME_==2.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv3,1.0,0.0)).xy;}\n#endif\n#ifdef UV4\nelse if (uniforms.v_INFONAME_==3.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv4,1.0,0.0)).xy;}\n#endif\n#ifdef UV5\nelse if (uniforms.v_INFONAME_==4.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv5,1.0,0.0)).xy;}\n#endif\n#ifdef UV6\nelse if (uniforms.v_INFONAME_==5.)\n{vertexOutputs.v_VARYINGNAME_UV= (uniforms._MATRIXNAME_Matrix* vec4f(vertexInputs.uv6,1.0,0.0)).xy;}\n#endif\n#endif\n"}}),Ea=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpVertex.js"(){c(),"bumpVertex","#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvar tbnNormal: vec3f=normalize(normalUpdated);var tbnTangent: vec3f=normalize(tangentUpdated.xyz);var tbnBitangent: vec3f=cross(tbnNormal,tbnTangent)*tangentUpdated.w;var matTemp= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz)* mat3x3f(tbnTangent,tbnBitangent,tbnNormal);vertexOutputs.vTBN0=matTemp[0];vertexOutputs.vTBN1=matTemp[1];vertexOutputs.vTBN2=matTemp[2];\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.bumpVertex="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvar tbnNormal: vec3f=normalize(normalUpdated);var tbnTangent: vec3f=normalize(tangentUpdated.xyz);var tbnBitangent: vec3f=cross(tbnNormal,tbnTangent)*tangentUpdated.w;var matTemp= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz)* mat3x3f(tbnTangent,tbnBitangent,tbnNormal);vertexOutputs.vTBN0=matTemp[0];vertexOutputs.vTBN1=matTemp[1];vertexOutputs.vTBN2=matTemp[2];\n#endif\n#endif\n"}}),Aa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fogVertex.js"(){c(),"fogVertex","#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n",e.IncludesShadersStoreWGSL.fogVertex="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n"}}),Ca=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/vertexColorMixing.js"(){c(),"vertexColorMixing","#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvertexOutputs.vColor=vec4f(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvertexOutputs.vColor*=vertexInputs.color;\n#else\nvertexOutputs.vColor=vec4f(vertexOutputs.vColor.rgb*vertexInputs.color.rgb,vertexOutputs.vColor.a);\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvertexOutputs.vColor*=vertexInputs.instanceColor;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.vertexColorMixing="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvertexOutputs.vColor=vec4f(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvertexOutputs.vColor*=vertexInputs.color;\n#else\nvertexOutputs.vColor=vec4f(vertexOutputs.vColor.rgb*vertexInputs.color.rgb,vertexOutputs.vColor.a);\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvertexOutputs.vColor*=vertexInputs.instanceColor;\n#endif\n#endif\n"}}),Ra=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/logDepthVertex.js"(){c(),"logDepthVertex","#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n",e.IncludesShadersStoreWGSL.logDepthVertex="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n"}}),Ta={};l(Ta,{defaultVertexShaderWGSL:()=>sa});var Na,Ma,Ia,xa=o({"../node_modules/@babylonjs/core/ShadersWGSL/default.vertex.js"(){c(),oa(),la(),he(),x(),Ui(),ca(),ha(),fa(),ua(),da(),Yi(),ma(),pa(),se(),Hi(),Vi(),_a(),ji(),Ki(),$i(),D(),qi(),va(),Sa(),ya(),Ea(),Qi(),Aa(),Te(),Ca(),Ra(),na="defaultVertexShader",aa="#include<defaultUboDeclaration>\n#define CUSTOM_VERTEX_BEGIN\nattribute position: vec3f;\n#ifdef NORMAL\nattribute normal: vec3f;\n#endif\n#ifdef TANGENT\nattribute tangent: vec4f;\n#endif\n#ifdef UV1\nattribute uv: vec2f;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute color: vec4f;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)\nvarying vPositionW: vec3f;\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar positionUpdated: vec3f=vertexInputs.position;\n#ifdef NORMAL\nvar normalUpdated: vec3f=vertexInputs.normal;\n#endif\n#ifdef TANGENT\nvar tangentUpdated: vec4f=vertexInputs.tangent;\n#endif\n#ifdef UV1\nvar uvUpdated: vec2f=vertexInputs.uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvertexOutputs.vPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvertexOutputs.vCurrentPosition=scene.viewProjection*finalWorld* vec4f(positionUpdated,1.0);vertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld* vec4f(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld*vec4f(positionUpdated,1.0);\n#ifdef NORMAL\nvar normalWorld: mat3x3f= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvertexOutputs.vNormalW=normalUpdated/ vec3f(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vertexOutputs.vNormalW=normalize(normalWorld*vertexOutputs.vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvertexOutputs.vNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {vertexOutputs.position=scene.viewProjection*worldPos;} else {vertexOutputs.position=scene.viewProjectionR*worldPos;}\n#else\nvertexOutputs.position=scene.viewProjection*worldPos;\n#endif\nvertexOutputs.vPositionW= worldPos.xyz;\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvertexOutputs.vDirectionW=normalize((finalWorld* vec4f(positionUpdated,0.0)).xyz);\n#endif\n#ifndef UV1\nvar uvUpdated: vec2f=vec2f(0.,0.);\n#endif\n#ifdef MAINUV1\nvertexOutputs.vMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n",e.ShadersStoreWGSL[na]=aa,sa={name:na,shader:aa}}}),ba=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/prePassDeclaration.js"(){c(),"prePassDeclaration","#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vViewPos: vec3f;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying vCurrentPosition: vec4f;varying vPreviousPosition: vec4f;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.prePassDeclaration="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vViewPos: vec3f;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying vCurrentPosition: vec4f;varying vPreviousPosition: vec4f;\n#endif\n#endif\n"}}),Pa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/oitDeclaration.js"(){c(),"oitDeclaration","#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#define MAX_DEPTH 99999.0\nvar oitDepthSamplerSampler: sampler;var oitDepthSampler: texture_2d<f32>;var oitFrontColorSamplerSampler: sampler;var oitFrontColorSampler: texture_2d<f32>;\n#endif\n",e.IncludesShadersStoreWGSL.oitDeclaration="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#define MAX_DEPTH 99999.0\nvar oitDepthSamplerSampler: sampler;var oitDepthSampler: texture_2d<f32>;var oitFrontColorSamplerSampler: sampler;var oitFrontColorSampler: texture_2d<f32>;\n#endif\n"}}),wa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/samplerFragmentDeclaration.js"(){c(),"samplerFragmentDeclaration","#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\nvar _SAMPLERNAME_SamplerSampler: sampler;var _SAMPLERNAME_Sampler: texture_2d<f32>;\n#endif\n",e.IncludesShadersStoreWGSL.samplerFragmentDeclaration="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\nvar _SAMPLERNAME_SamplerSampler: sampler;var _SAMPLERNAME_Sampler: texture_2d<f32>;\n#endif\n"}}),Oa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fresnelFunction.js"(){c(),"fresnelFunction","#ifdef FRESNEL\nfn computeFresnelTerm(viewDirection: vec3f,worldNormal: vec3f,bias: f32,power: f32)->f32\n{let fresnelTerm: f32=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}\n#endif\n",e.IncludesShadersStoreWGSL.fresnelFunction="#ifdef FRESNEL\nfn computeFresnelTerm(viewDirection: vec3f,worldNormal: vec3f,bias: f32,power: f32)->f32\n{let fresnelTerm: f32=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}\n#endif\n"}}),Da=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/reflectionFunction.js"(){c(),"reflectionFunction","fn computeFixedEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,direction: vec3f)->vec3f\n{var lon: f32=atan2(direction.z,direction.x);var lat: f32=acos(direction.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(s,t,0); }\nfn computeMirroredFixedEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,direction: vec3f)->vec3f\n{var lon: f32=atan2(direction.z,direction.x);var lat: f32=acos(direction.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(1.0-s,t,0); }\nfn computeEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var cameraToVertex: vec3f=normalize(worldPos.xyz-eyePosition);var r: vec3f=normalize(reflect(cameraToVertex,worldNormal));r= (reflectionMatrix* vec4f(r,0)).xyz;var lon: f32=atan2(r.z,r.x);var lat: f32=acos(r.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(s,t,0);}\nfn computeSphericalCoords(worldPos: vec4f,worldNormal: vec3f,view: mat4x4f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=normalize((view*worldPos).xyz);var viewNormal: vec3f=normalize((view* vec4f(worldNormal,0.0)).xyz);var r: vec3f=reflect(viewDir,viewNormal);r= (reflectionMatrix* vec4f(r,0)).xyz;r.z=r.z-1.0;var m: f32=2.0*length(r);return vec3f(r.x/m+0.5,1.0-r.y/m-0.5,0);}\nfn computePlanarCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=worldPos.xyz-eyePosition;var coords: vec3f=normalize(reflect(viewDir,worldNormal));return (reflectionMatrix* vec4f(coords,1)).xyz;}\nfn computeCubicCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=normalize(worldPos.xyz-eyePosition);var coords: vec3f=reflect(viewDir,worldNormal);coords= (reflectionMatrix* vec4f(coords,0)).xyz;\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nfn computeCubicLocalCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f,reflectionSize: vec3f,reflectionPosition: vec3f)->vec3f\n{var viewDir: vec3f=normalize(worldPos.xyz-eyePosition);var coords: vec3f=reflect(viewDir,worldNormal);coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);coords=(reflectionMatrix* vec4f(coords,0)).xyz;\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nfn computeProjectionCoords(worldPos: vec4f,view: mat4x4f,reflectionMatrix: mat4x4f)->vec3f\n{return (reflectionMatrix*(view*worldPos)).xyz;}\nfn computeSkyBoxCoords(positionW: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{return (reflectionMatrix* vec4f(positionW,1.)).xyz;}\n#ifdef REFLECTION\nfn computeReflectionCoords(worldPos: vec4f,worldNormal: vec3f)->vec3f\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvar direction: vec3f=normalize(fragmentInputs.vDirectionW);return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvar direction: vec3f=normalize(fragmentInputs.vDirectionW);return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,scene.view,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix,uniforms.vReflectionSize,uniforms.vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,scene.view,uniforms.reflectionMatrix);\n#endif\n#ifndef REFLECTIONMAP_CUBIC\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(fragmentInputs.vPositionUVW,uniforms.reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3f(0,0,0);\n#endif\n}\n#endif\n",e.IncludesShadersStoreWGSL.reflectionFunction="fn computeFixedEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,direction: vec3f)->vec3f\n{var lon: f32=atan2(direction.z,direction.x);var lat: f32=acos(direction.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(s,t,0); }\nfn computeMirroredFixedEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,direction: vec3f)->vec3f\n{var lon: f32=atan2(direction.z,direction.x);var lat: f32=acos(direction.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(1.0-s,t,0); }\nfn computeEquirectangularCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var cameraToVertex: vec3f=normalize(worldPos.xyz-eyePosition);var r: vec3f=normalize(reflect(cameraToVertex,worldNormal));r= (reflectionMatrix* vec4f(r,0)).xyz;var lon: f32=atan2(r.z,r.x);var lat: f32=acos(r.y);var sphereCoords: vec2f= vec2f(lon,lat)*RECIPROCAL_PI2*2.0;var s: f32=sphereCoords.x*0.5+0.5;var t: f32=sphereCoords.y;return vec3f(s,t,0);}\nfn computeSphericalCoords(worldPos: vec4f,worldNormal: vec3f,view: mat4x4f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=normalize((view*worldPos).xyz);var viewNormal: vec3f=normalize((view* vec4f(worldNormal,0.0)).xyz);var r: vec3f=reflect(viewDir,viewNormal);r= (reflectionMatrix* vec4f(r,0)).xyz;r.z=r.z-1.0;var m: f32=2.0*length(r);return vec3f(r.x/m+0.5,1.0-r.y/m-0.5,0);}\nfn computePlanarCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=worldPos.xyz-eyePosition;var coords: vec3f=normalize(reflect(viewDir,worldNormal));return (reflectionMatrix* vec4f(coords,1)).xyz;}\nfn computeCubicCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{var viewDir: vec3f=normalize(worldPos.xyz-eyePosition);var coords: vec3f=reflect(viewDir,worldNormal);coords= (reflectionMatrix* vec4f(coords,0)).xyz;\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nfn computeCubicLocalCoords(worldPos: vec4f,worldNormal: vec3f,eyePosition: vec3f,reflectionMatrix: mat4x4f,reflectionSize: vec3f,reflectionPosition: vec3f)->vec3f\n{var viewDir: vec3f=normalize(worldPos.xyz-eyePosition);var coords: vec3f=reflect(viewDir,worldNormal);coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);coords=(reflectionMatrix* vec4f(coords,0)).xyz;\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nfn computeProjectionCoords(worldPos: vec4f,view: mat4x4f,reflectionMatrix: mat4x4f)->vec3f\n{return (reflectionMatrix*(view*worldPos)).xyz;}\nfn computeSkyBoxCoords(positionW: vec3f,reflectionMatrix: mat4x4f)->vec3f\n{return (reflectionMatrix* vec4f(positionW,1.)).xyz;}\n#ifdef REFLECTION\nfn computeReflectionCoords(worldPos: vec4f,worldNormal: vec3f)->vec3f\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvar direction: vec3f=normalize(fragmentInputs.vDirectionW);return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvar direction: vec3f=normalize(fragmentInputs.vDirectionW);return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,scene.view,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix,uniforms.vReflectionSize,uniforms.vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,scene.vEyePosition.xyz,uniforms.reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,scene.view,uniforms.reflectionMatrix);\n#endif\n#ifndef REFLECTIONMAP_CUBIC\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(fragmentInputs.vPositionUVW,uniforms.reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3f(0,0,0);\n#endif\n}\n#endif\n"}}),La=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/imageProcessingDeclaration.js"(){c(),"imageProcessingDeclaration","#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n",e.IncludesShadersStoreWGSL.imageProcessingDeclaration="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n"}}),Fa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/imageProcessingFunctions.js"(){c(),"imageProcessingFunctions","#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}",e.IncludesShadersStoreWGSL.imageProcessingFunctions="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}"}}),ka=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpFragmentMainFunctions.js"(){c(),"bumpFragmentMainFunctions","#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying vTBN0: vec3f;varying vTBN1: vec3f;varying vTBN2: vec3f;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform normalMatrix: mat4x4f;fn toNormalMatrix(m: mat4x4f)->mat4x4f\n{var a00=m[0][0];var a01=m[0][1];var a02=m[0][2];var a03=m[0][3];var a10=m[1][0];var a11=m[1][1];var a12=m[1][2];var a13=m[1][3];var a20=m[2][0]; \nvar a21=m[2][1];var a22=m[2][2];var a23=m[2][3];var a30=m[3][0]; \nvar a31=m[3][1];var a32=m[3][2];var a33=m[3][3];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;var mi=mat4x4<f32>(\n(a11*b11-a12*b10+a13*b09)/det,\n(a02*b10-a01*b11-a03*b09)/det,\n(a31*b05-a32*b04+a33*b03)/det,\n(a22*b04-a21*b05-a23*b03)/det,\n(a12*b08-a10*b11-a13*b07)/det,\n(a00*b11-a02*b08+a03*b07)/det,\n(a32*b02-a30*b05-a33*b01)/det,\n(a20*b05-a22*b02+a23*b01)/det,\n(a10*b10-a11*b08+a13*b06)/det,\n(a01*b08-a00*b10-a03*b06)/det,\n(a30*b04-a31*b02+a33*b00)/det,\n(a21*b02-a20*b04-a23*b00)/det,\n(a11*b07-a10*b09-a12*b06)/det,\n(a00*b09-a01*b07+a02*b06)/det,\n(a31*b01-a30*b03-a32*b00)/det,\n(a20*b03-a21*b01+a22*b00)/det);return mat4x4<f32>(mi[0][0],mi[1][0],mi[2][0],mi[3][0],\nmi[0][1],mi[1][1],mi[2][1],mi[3][1],\nmi[0][2],mi[1][2],mi[2][2],mi[3][2],\nmi[0][3],mi[1][3],mi[2][3],mi[3][3]);}\n#endif\nfn perturbNormalBase(cotangentFrame: mat3x3f,normal: vec3f,scale: f32)->vec3f\n{var output=normal;\n#ifdef NORMALXYSCALE\noutput=normalize(output* vec3f(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*output);}\nfn perturbNormal(cotangentFrame: mat3x3f,textureSample: vec3f,scale: f32)->vec3f\n{return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);}\nfn cotangent_frame(normal: vec3f,p: vec3f,uv: vec2f,tangentSpaceParams: vec2f)->mat3x3f\n{var dp1: vec3f=dpdx(p);var dp2: vec3f=dpdy(p);var duv1: vec2f=dpdx(uv);var duv2: vec2f=dpdy(uv);var dp2perp: vec3f=cross(dp2,normal);var dp1perp: vec3f=cross(normal,dp1);var tangent: vec3f=dp2perp*duv1.x+dp1perp*duv2.x;var bitangent: vec3f=dp2perp*duv1.y+dp1perp*duv2.y;tangent*=tangentSpaceParams.x;bitangent*=tangentSpaceParams.y;var det: f32=max(dot(tangent,tangent),dot(bitangent,bitangent));var invmax: f32=select(inverseSqrt(det),0.0,det==0.0);return mat3x3f(tangent*invmax,bitangent*invmax,normal);}\n#endif\n",e.IncludesShadersStoreWGSL.bumpFragmentMainFunctions="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying vTBN0: vec3f;varying vTBN1: vec3f;varying vTBN2: vec3f;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform normalMatrix: mat4x4f;fn toNormalMatrix(m: mat4x4f)->mat4x4f\n{var a00=m[0][0];var a01=m[0][1];var a02=m[0][2];var a03=m[0][3];var a10=m[1][0];var a11=m[1][1];var a12=m[1][2];var a13=m[1][3];var a20=m[2][0]; \nvar a21=m[2][1];var a22=m[2][2];var a23=m[2][3];var a30=m[3][0]; \nvar a31=m[3][1];var a32=m[3][2];var a33=m[3][3];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;var mi=mat4x4<f32>(\n(a11*b11-a12*b10+a13*b09)/det,\n(a02*b10-a01*b11-a03*b09)/det,\n(a31*b05-a32*b04+a33*b03)/det,\n(a22*b04-a21*b05-a23*b03)/det,\n(a12*b08-a10*b11-a13*b07)/det,\n(a00*b11-a02*b08+a03*b07)/det,\n(a32*b02-a30*b05-a33*b01)/det,\n(a20*b05-a22*b02+a23*b01)/det,\n(a10*b10-a11*b08+a13*b06)/det,\n(a01*b08-a00*b10-a03*b06)/det,\n(a30*b04-a31*b02+a33*b00)/det,\n(a21*b02-a20*b04-a23*b00)/det,\n(a11*b07-a10*b09-a12*b06)/det,\n(a00*b09-a01*b07+a02*b06)/det,\n(a31*b01-a30*b03-a32*b00)/det,\n(a20*b03-a21*b01+a22*b00)/det);return mat4x4<f32>(mi[0][0],mi[1][0],mi[2][0],mi[3][0],\nmi[0][1],mi[1][1],mi[2][1],mi[3][1],\nmi[0][2],mi[1][2],mi[2][2],mi[3][2],\nmi[0][3],mi[1][3],mi[2][3],mi[3][3]);}\n#endif\nfn perturbNormalBase(cotangentFrame: mat3x3f,normal: vec3f,scale: f32)->vec3f\n{var output=normal;\n#ifdef NORMALXYSCALE\noutput=normalize(output* vec3f(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*output);}\nfn perturbNormal(cotangentFrame: mat3x3f,textureSample: vec3f,scale: f32)->vec3f\n{return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);}\nfn cotangent_frame(normal: vec3f,p: vec3f,uv: vec2f,tangentSpaceParams: vec2f)->mat3x3f\n{var dp1: vec3f=dpdx(p);var dp2: vec3f=dpdy(p);var duv1: vec2f=dpdx(uv);var duv2: vec2f=dpdy(uv);var dp2perp: vec3f=cross(dp2,normal);var dp1perp: vec3f=cross(normal,dp1);var tangent: vec3f=dp2perp*duv1.x+dp1perp*duv2.x;var bitangent: vec3f=dp2perp*duv1.y+dp1perp*duv2.y;tangent*=tangentSpaceParams.x;bitangent*=tangentSpaceParams.y;var det: f32=max(dot(tangent,tangent),dot(bitangent,bitangent));var invmax: f32=select(inverseSqrt(det),0.0,det==0.0);return mat3x3f(tangent*invmax,bitangent*invmax,normal);}\n#endif\n"}}),Ba=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpFragmentFunctions.js"(){c(),wa(),"bumpFragmentFunctions","#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst minSamples: f32=4.;const maxSamples: f32=15.;const iMaxSamples: i32=15;fn parallaxOcclusion(vViewDirCoT: vec3f,vNormalCoT: vec3f,texCoord: vec2f,parallaxScale: f32)->vec2f {var parallaxLimit: f32=length(vViewDirCoT.xy)/vViewDirCoT.z;parallaxLimit*=parallaxScale;var vOffsetDir: vec2f=normalize(vViewDirCoT.xy);var vMaxOffset: vec2f=vOffsetDir*parallaxLimit;var numSamples: f32=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));var stepSize: f32=1.0/numSamples;var currRayHeight: f32=1.0;var vCurrOffset: vec2f= vec2f(0,0);var vLastOffset: vec2f= vec2f(0,0);var lastSampledHeight: f32=1.0;var currSampledHeight: f32=1.0;var keepWorking: bool=true;for (var i: i32=0; i<iMaxSamples; i++)\n{currSampledHeight=textureSample(bumpSampler,bumpSamplerSampler,texCoord+vCurrOffset).w;if (!keepWorking)\n{}\nelse if (currSampledHeight>currRayHeight)\n{var delta1: f32=currSampledHeight-currRayHeight;var delta2: f32=(currRayHeight+stepSize)-lastSampledHeight;var ratio: f32=delta1/(delta1+delta2);vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;keepWorking=false;}\nelse\n{currRayHeight-=stepSize;vLastOffset=vCurrOffset;\n#ifdef PARALLAX_RHS\nvCurrOffset-=stepSize*vMaxOffset;\n#else\nvCurrOffset+=stepSize*vMaxOffset;\n#endif\nlastSampledHeight=currSampledHeight;}}\nreturn vCurrOffset;}\nfn parallaxOffset(viewDir: vec3f,heightScale: f32)->vec2f\n{var height: f32=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).w;var texCoordOffset: vec2f=heightScale*viewDir.xy*height;\n#ifdef PARALLAX_RHS\nreturn texCoordOffset;\n#else\nreturn -texCoordOffset;\n#endif\n}\n#endif\n",e.IncludesShadersStoreWGSL.bumpFragmentFunctions="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst minSamples: f32=4.;const maxSamples: f32=15.;const iMaxSamples: i32=15;fn parallaxOcclusion(vViewDirCoT: vec3f,vNormalCoT: vec3f,texCoord: vec2f,parallaxScale: f32)->vec2f {var parallaxLimit: f32=length(vViewDirCoT.xy)/vViewDirCoT.z;parallaxLimit*=parallaxScale;var vOffsetDir: vec2f=normalize(vViewDirCoT.xy);var vMaxOffset: vec2f=vOffsetDir*parallaxLimit;var numSamples: f32=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));var stepSize: f32=1.0/numSamples;var currRayHeight: f32=1.0;var vCurrOffset: vec2f= vec2f(0,0);var vLastOffset: vec2f= vec2f(0,0);var lastSampledHeight: f32=1.0;var currSampledHeight: f32=1.0;var keepWorking: bool=true;for (var i: i32=0; i<iMaxSamples; i++)\n{currSampledHeight=textureSample(bumpSampler,bumpSamplerSampler,texCoord+vCurrOffset).w;if (!keepWorking)\n{}\nelse if (currSampledHeight>currRayHeight)\n{var delta1: f32=currSampledHeight-currRayHeight;var delta2: f32=(currRayHeight+stepSize)-lastSampledHeight;var ratio: f32=delta1/(delta1+delta2);vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;keepWorking=false;}\nelse\n{currRayHeight-=stepSize;vLastOffset=vCurrOffset;\n#ifdef PARALLAX_RHS\nvCurrOffset-=stepSize*vMaxOffset;\n#else\nvCurrOffset+=stepSize*vMaxOffset;\n#endif\nlastSampledHeight=currSampledHeight;}}\nreturn vCurrOffset;}\nfn parallaxOffset(viewDir: vec3f,heightScale: f32)->vec2f\n{var height: f32=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).w;var texCoordOffset: vec2f=heightScale*viewDir.xy*height;\n#ifdef PARALLAX_RHS\nreturn texCoordOffset;\n#else\nreturn -texCoordOffset;\n#endif\n}\n#endif\n"}}),Ga=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/bumpFragment.js"(){c(),"bumpFragment","var uvOffset: vec2f= vec2f(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nvar normalScale: f32=1.0;\n#elif defined(BUMP)\nvar normalScale: f32=uniforms.vBumpInfos.y;\n#else\nvar normalScale: f32=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nvar TBN: mat3x3f=mat3x3<f32>(input.vTBN0,input.vTBN1,input.vTBN2); \n#elif defined(BUMP)\nvar TBNUV: vec2f=select(-fragmentInputs.vBumpUV,fragmentInputs.vBumpUV,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW*normalScale,input.vPositionW,TBNUV,uniforms.vTangentSpaceParams);\n#else\nvar TBNUV: vec2f=select(-fragmentInputs.vDetailUV,fragmentInputs.vDetailUV,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW*normalScale,input.vPositionW,TBNUV, vec2f(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvar TBN: mat3x3f=mat3x3<f32>(input.vTBN0,input.vTBN1,input.vTBN2); \n#else\nvar TBNUV: vec2f=select( -fragmentInputs.vMainUV1,fragmentInputs.vMainUV1,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW,input.vPositionW,TBNUV, vec2f(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nvar invTBN: mat3x3f=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,fragmentInputs.vBumpUV,uniforms.vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,uniforms.vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvar detailColor: vec4f=textureSample(detailSampler,detailSamplerSampler,fragmentInputs.vDetailUV+uvOffset);var detailNormalRG: vec2f=detailColor.wy*2.0-1.0;var detailNormalB: f32=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));var detailNormal: vec3f= vec3f(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\n#define CUSTOM_FRAGMENT_BUMP_FRAGMENT\nnormalW=normalize(textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).xyz *2.0-1.0);normalW=normalize(mat3x3f(uniforms.normalMatrix[0].xyz,uniforms.normalMatrix[1].xyz,uniforms.normalMatrix[2].xyz)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV+uvOffset).xyz,uniforms.vBumpInfos.y);\n#else\nvar bumpNormal: vec3f=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);var blendedNormal: vec3f=normalize( vec3f(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);bumpNormal+= vec3f(0.0,0.0,1.0);detailNormal*= vec3f(-1.0,-1.0,1.0);var blendedNormal: vec3f=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,uniforms.vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);normalW=perturbNormalBase(TBN,detailNormal,uniforms.vDetailInfos.z);\n#endif\n",e.IncludesShadersStoreWGSL.bumpFragment="var uvOffset: vec2f= vec2f(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nvar normalScale: f32=1.0;\n#elif defined(BUMP)\nvar normalScale: f32=uniforms.vBumpInfos.y;\n#else\nvar normalScale: f32=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nvar TBN: mat3x3f=mat3x3<f32>(input.vTBN0,input.vTBN1,input.vTBN2); \n#elif defined(BUMP)\nvar TBNUV: vec2f=select(-fragmentInputs.vBumpUV,fragmentInputs.vBumpUV,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW*normalScale,input.vPositionW,TBNUV,uniforms.vTangentSpaceParams);\n#else\nvar TBNUV: vec2f=select(-fragmentInputs.vDetailUV,fragmentInputs.vDetailUV,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW*normalScale,input.vPositionW,TBNUV, vec2f(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvar TBN: mat3x3f=mat3x3<f32>(input.vTBN0,input.vTBN1,input.vTBN2); \n#else\nvar TBNUV: vec2f=select( -fragmentInputs.vMainUV1,fragmentInputs.vMainUV1,fragmentInputs.frontFacing);var TBN: mat3x3f=cotangent_frame(normalW,input.vPositionW,TBNUV, vec2f(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nvar invTBN: mat3x3f=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,fragmentInputs.vBumpUV,uniforms.vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,uniforms.vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvar detailColor: vec4f=textureSample(detailSampler,detailSamplerSampler,fragmentInputs.vDetailUV+uvOffset);var detailNormalRG: vec2f=detailColor.wy*2.0-1.0;var detailNormalB: f32=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));var detailNormal: vec3f= vec3f(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\n#define CUSTOM_FRAGMENT_BUMP_FRAGMENT\nnormalW=normalize(textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).xyz *2.0-1.0);normalW=normalize(mat3x3f(uniforms.normalMatrix[0].xyz,uniforms.normalMatrix[1].xyz,uniforms.normalMatrix[2].xyz)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV+uvOffset).xyz,uniforms.vBumpInfos.y);\n#else\nvar bumpNormal: vec3f=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);var blendedNormal: vec3f=normalize( vec3f(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);bumpNormal+= vec3f(0.0,0.0,1.0);detailNormal*= vec3f(-1.0,-1.0,1.0);var blendedNormal: vec3f=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,uniforms.vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal=vec3f(detailNormal.xy*uniforms.vDetailInfos.z,detailNormal.z);normalW=perturbNormalBase(TBN,detailNormal,uniforms.vDetailInfos.z);\n#endif\n"}}),Ua=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/decalFragment.js"(){c(),"decalFragment","#ifdef DECAL\nvar decalTempColor=decalColor.rgb;var decalTempAlpha=decalColor.a;\n#ifdef GAMMADECAL\ndecalTempColor=toLinearSpaceVec3(decalColor.rgb);\n#endif\n#ifdef DECAL_SMOOTHALPHA\ndecalTempAlpha=decalColor.a*decalColor.a;\n#endif\nsurfaceAlbedo=mix(surfaceAlbedo.rgb,decalTempColor,decalTempAlpha);\n#endif\n",e.IncludesShadersStoreWGSL.decalFragment="#ifdef DECAL\nvar decalTempColor=decalColor.rgb;var decalTempAlpha=decalColor.a;\n#ifdef GAMMADECAL\ndecalTempColor=toLinearSpaceVec3(decalColor.rgb);\n#endif\n#ifdef DECAL_SMOOTHALPHA\ndecalTempAlpha=decalColor.a*decalColor.a;\n#endif\nsurfaceAlbedo=mix(surfaceAlbedo.rgb,decalTempColor,decalTempAlpha);\n#endif\n"}}),Ha=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/depthPrePass.js"(){c(),"depthPrePass","#ifdef DEPTHPREPASS\nfragmentOutputs.color= vec4f(0.,0.,0.,1.0);return fragmentOutputs;\n#endif\n",e.IncludesShadersStoreWGSL.depthPrePass="#ifdef DEPTHPREPASS\nfragmentOutputs.color= vec4f(0.,0.,0.,1.0);return fragmentOutputs;\n#endif\n"}}),Va=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/logDepthFragment.js"(){c(),"logDepthFragment","#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n",e.IncludesShadersStoreWGSL.logDepthFragment="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n"}}),Wa=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/fogFragment.js"(){c(),"fogFragment","#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n",e.IncludesShadersStoreWGSL.fogFragment="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n"}}),za=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/oitFragment.js"(){c(),"oitFragment","#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nvar fragDepth: f32=fragmentInputs.position.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nvar halfFloat: i32=packHalf2x16( vec2f(fragDepth));var full: vec2f=unpackHalf2x16(halfFloat);fragDepth=full.x;\n#endif\nvar fragCoord: vec2i=vec2i(fragmentInputs.position.xy);var lastDepth: vec2f=textureLoad(oitDepthSampler,fragCoord,0).rg;var lastFrontColor: vec4f=textureLoad(oitFrontColorSampler,fragCoord,0);fragmentOutputs.depth=vec2f(-MAX_DEPTH);fragmentOutputs.frontColor=lastFrontColor;fragmentOutputs.backColor= vec4f(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nvar furthestDepth: f32=-lastDepth.x;var nearestDepth: f32=lastDepth.y;\n#else\nvar nearestDepth: f32=-lastDepth.x;var furthestDepth: f32=lastDepth.y;\n#endif\nvar alphaMultiplier: f32=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn fragmentOutputs;}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\nfragmentOutputs.depth=vec2f(-fragDepth,fragDepth);return fragmentOutputs;}\n#endif\n",e.IncludesShadersStoreWGSL.oitFragment="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nvar fragDepth: f32=fragmentInputs.position.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nvar halfFloat: i32=packHalf2x16( vec2f(fragDepth));var full: vec2f=unpackHalf2x16(halfFloat);fragDepth=full.x;\n#endif\nvar fragCoord: vec2i=vec2i(fragmentInputs.position.xy);var lastDepth: vec2f=textureLoad(oitDepthSampler,fragCoord,0).rg;var lastFrontColor: vec4f=textureLoad(oitFrontColorSampler,fragCoord,0);fragmentOutputs.depth=vec2f(-MAX_DEPTH);fragmentOutputs.frontColor=lastFrontColor;fragmentOutputs.backColor= vec4f(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nvar furthestDepth: f32=-lastDepth.x;var nearestDepth: f32=lastDepth.y;\n#else\nvar nearestDepth: f32=-lastDepth.x;var furthestDepth: f32=lastDepth.y;\n#endif\nvar alphaMultiplier: f32=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn fragmentOutputs;}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\nfragmentOutputs.depth=vec2f(-fragDepth,fragDepth);return fragmentOutputs;}\n#endif\n"}}),Xa={};l(Xa,{defaultPixelShaderWGSL:()=>Ia});var Ya,ja,Ka,$a=o({"../node_modules/@babylonjs/core/ShadersWGSL/default.fragment.js"(){c(),oa(),ba(),Pa(),fa(),he(),ee(),pe(),ye(),wa(),Oa(),Da(),La(),Fa(),ka(),Ba(),Oi(),_a(),Et(),Di(),Ga(),Ua(),Ha(),$(),Va(),Wa(),za(),Na="defaultPixelShader",Ma="#include<defaultUboDeclaration>\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\nvarying vPositionW: vec3f;\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<lightUboDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nvar refractionCubeSamplerSampler: sampler;var refractionCubeSampler: texture_cube<f32>;\n#else\nvar refraction2DSamplerSampler: sampler;var refraction2DSampler: texture_2d<f32>;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nvar reflectionCubeSamplerSampler: sampler;var reflectionCubeSampler: texture_cube<f32>;\n#else\nvar reflection2DSamplerSampler: sampler;var reflection2DSampler: texture_2d<f32>;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar viewDirectionW: vec3f=normalize(scene.vEyePosition.xyz-fragmentInputs.vPositionW);var baseColor: vec4f= vec4f(1.,1.,1.,1.);var diffuseColor: vec3f=uniforms.vDiffuseColor.rgb;var alpha: f32=uniforms.vDiffuseColor.a;\n#ifdef NORMAL\nvar normalW: vec3f=normalize(fragmentInputs.vNormalW);\n#else\nvar normalW: vec3f=normalize(-cross(dpdx(fragmentInputs.vPositionW),dpdy(fragmentInputs.vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=select(-normalW,normalW,fragmentInputs.frontFacing);\n#endif\n#ifdef DIFFUSE\nbaseColor=textureSample(diffuseSampler,diffuseSamplerSampler,fragmentInputs.vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<uniforms.alphaCutOff) {discard;}\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor=vec4f(baseColor.rgb*uniforms.vDiffuseInfos.y,baseColor.a);\n#endif\n#if defined(DECAL) && !defined(DECAL_AFTER_DETAIL)\nvar decalColor: vec4f=textureSample(decalSampler,decalSamplerSampler,fragmentInputs.vDecalUV+uvOffset);\n#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nbaseColor=vec4f(baseColor.rgb*fragmentInputs.vColor.rgb,baseColor.a);\n#endif\n#ifdef DETAIL\nbaseColor=vec4f(baseColor.rgb*2.0*mix(0.5,detailColor.r,uniforms.vDetailInfos.y),baseColor.a);\n#endif\n#if defined(DECAL) && defined(DECAL_AFTER_DETAIL)\nvar decalColor: vec4f=textureSample(decalSampler,decalSamplerSampler,fragmentInputs.vDecalUV+uvOffset);\n#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvar baseAmbientColor: vec3f= vec3f(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=textureSample(ambientSampler,ambientSamplerSampler,fragmentInputs.vAmbientUV+uvOffset).rgb*uniforms.vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nvar glossiness: f32=uniforms.vSpecularColor.a;var specularColor: vec3f=uniforms.vSpecularColor.rgb;\n#ifdef SPECULAR\nvar specularMapColor: vec4f=textureSample(specularSampler,specularSamplerSampler,fragmentInputs.vSpecularUV+uvOffset);specularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nvar glossiness: f32=0.;\n#endif\nvar diffuseBase: vec3f= vec3f(0.,0.,0.);var info: lightingInfo;\n#ifdef SPECULARTERM\nvar specularBase: vec3f= vec3f(0.,0.,0.);\n#endif\nvar shadow: f32=1.;var aggShadow: f32=0.;var numLights: f32=0.;\n#ifdef LIGHTMAP\nvar lightmapColor: vec4f=textureSample(lightmapSampler,lightmapSamplerSampler,fragmentInputs.vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor=vec4f(fromRGBD(lightmapColor),lightmapColor.a);\n#endif\nlightmapColor=vec4f(lightmapColor.rgb*vLightmapInfos.y,lightmapColor.a);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\naggShadow=aggShadow/numLights;var refractionColor: vec4f= vec4f(0.,0.,0.,1.);\n#ifdef REFRACTION\nvar refractionVector: vec3f=normalize(refract(-viewDirectionW,normalW,uniforms.vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(fragmentInputs.vPositionW,refractionVector,uniforms.vRefractionSize,uniforms.vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*uniforms.vRefractionInfos.w;var refractionLookup: vec4f=textureSample(refractionCubeSampler,refractionCubeSamplerSampler,refractionVector);if (dot(refractionVector,viewDirectionW)<1.0) {refractionColor=refractionLookup;}\n#else\nvar vRefractionUVW: vec3f= (uniforms.refractionMatrix*(scene.view* vec4f(fragmentInputs.vPositionW+refractionVector*uniforms.vRefractionInfos.z,1.0))).xyz;var refractionCoords: vec2f=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;refractionColor=textureSample(refraction2DSampler,refraction2DSamplerSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor=vec4f(fromRGBD(refractionColor),refractionColor.a);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=vec4f(toGammaSpaceVec3(refractionColor.rgb),refractionColor.a);\n#endif\nrefractionColor=vec4f(refractionColor.rgb*uniforms.vRefractionInfos.x,refractionColor.a);\n#endif\nvar reflectionColor: vec4f= vec4f(0.,0.,0.,1.);\n#ifdef REFLECTION\nvar vReflectionUVW: vec3f=computeReflectionCoords( vec4f(fragmentInputs.vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW=vec3f(vReflectionUVW.x,vReflectionUVW.y,vReflectionUVW.z*-1.0);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nvar bias: f32=uniforms.vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureSample(reflectionCubeSampler,reflectionCubeSamplerSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureSample(reflectionCubeSampler,reflectionCubeSamplerSampler,vReflectionUVW);\n#endif\n#else\nvar coords: vec2f=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;reflectionColor=textureSample(reflection2DSampler,reflection2DSamplerSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor=vec4f(fromRGBD(reflectionColor),reflectionColor.a);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=vec4f(toGammaSpaceVec3(reflectionColor.rgb),reflectionColor.a);\n#endif\nreflectionColor=vec4f(reflectionColor.rgb*uniforms.vReflectionInfos.x,reflectionColor.a);\n#ifdef REFLECTIONFRESNEL\nvar reflectionFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.reflectionRightColor.a,uniforms.reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor=vec4f(reflectionColor.rgb*specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*uniforms.reflectionRightColor.rgb,reflectionColor.a);\n#else\nreflectionColor=vec4f(reflectionColor.rgb*uniforms.reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*uniforms.reflectionRightColor.rgb,reflectionColor.a);\n#endif\n#else\nreflectionColor=vec4f(reflectionColor.rgb*uniforms.reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*uniforms.reflectionRightColor.rgb,reflectionColor.a);\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nvar refractionFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.refractionRightColor.a,uniforms.refractionLeftColor.a);refractionColor=vec4f(refractionColor.rgb*uniforms.refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*uniforms.refractionRightColor.rgb,refractionColor.a);\n#endif\n#ifdef OPACITY\nvar opacityMap: vec4f=textureSample(opacitySampler,opacitySamplerSampler,fragmentInputs.vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap=vec4f(opacityMap.rgb* vec3f(0.3,0.59,0.11),opacityMap.a);alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* uniforms.vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*uniforms.vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=fragmentInputs.vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nvar opacityFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.opacityParts.z,uniforms.opacityParts.w);alpha+=uniforms.opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*uniforms.opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<uniforms.alphaCutOff) {discard;}\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvar emissiveColor: vec3f=uniforms.vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=textureSample(emissiveSampler,emissiveSamplerSampler,fragmentInputs.vEmissiveUV+uvOffset).rgb*uniforms.vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nvar emissiveFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.emissiveRightColor.a,uniforms.emissiveLeftColor.a);emissiveColor*=uniforms.emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*uniforms.emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nvar diffuseFresnelTerm: f32=computeFresnelTerm(viewDirectionW,normalW,uniforms.diffuseRightColor.a,uniforms.diffuseLeftColor.a);diffuseBase*=uniforms.diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*uniforms.diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvar finalDiffuse: vec3f=clamp(diffuseBase*diffuseColor+uniforms.vAmbientColor,vec3f(0.0),vec3f(1.0))*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvar finalDiffuse: vec3f=clamp((diffuseBase+emissiveColor)*diffuseColor+uniforms.vAmbientColor,vec3f(0.0),vec3f(1.0))*baseColor.rgb;\n#else\nvar finalDiffuse: vec3f=clamp(diffuseBase*diffuseColor+emissiveColor+uniforms.vAmbientColor,vec3f(0.0),vec3f(1.0))*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvar finalSpecular: vec3f=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular, vec3f(0.3,0.59,0.11)),0.0,1.0);\n#endif\n#else\nvar finalSpecular: vec3f= vec3f(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb, vec3f(0.3,0.59,0.11)),0.0,1.0);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvar color: vec4f= vec4f(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvar color: vec4f= vec4f(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor=vec4f(color.rgb*lightmapColor.rgb,color.a);\n#else\ncolor=vec4f(color.rgb+lightmapColor.rgb,color.a);\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor=vec4f(max(color.rgb,vec3f(0.)),color.a);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor=vec4f(toLinearSpaceVec3(color.rgb),color.a);\n#else\n#ifdef IMAGEPROCESSING\ncolor=vec4f(toLinearSpaceVec3(color.rgb),color.a);color=applyImageProcessing(color);\n#endif\n#endif\ncolor=vec4f(color.rgb,color.a*mesh.visibility);\n#ifdef PREMULTIPLYALPHA\ncolor=vec4f(color.rgb*color.a, color.a);\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nvar writeGeometryInfo: f32=select(0.0,1.0,color.a>0.4);var fragData: array<vec4<f32>,SCENE_MRT_COUNT>;fragData[0]=color; \n#ifdef PREPASS_POSITION\nfragData[PREPASS_POSITION_INDEX]= vec4f(fragmentInputs.vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvar a: vec2f=(fragmentInputs.vCurrentPosition.xy/fragmentInputs.vCurrentPosition.w)*0.5+0.5;var b: vec2f=(fragmentInputs.vPreviousPosition.xy/fragmentInputs.vPreviousPosition.w)*0.5+0.5;var velocity: vec2f=abs(a-b);velocity= vec2f(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;fragData[PREPASS_VELOCITY_INDEX]= vec4f(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\nfragData[PREPASS_IRRADIANCE_INDEX]= vec4f(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\nfragData[PREPASS_DEPTH_INDEX]= vec4f(fragmentInputs.vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\n#ifdef PREPASS_NORMAL_WORLDSPACE\nfragData[PREPASS_NORMAL_INDEX]= vec4f(normalW,writeGeometryInfo); \n#else\nfragData[PREPASS_NORMAL_INDEX]= vec4f(normalize((scene.view* vec4f(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nfragData[PREPASS_ALBEDO_SQRT_INDEX]= vec4f(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f(toLinearSpaceVec4(specularMapColor))*writeGeometryInfo; \n#else\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f(toLinearSpaceVec3(specularColor),1.0)*writeGeometryInfo;\n#endif\n#else\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#if SCENE_MRT_COUNT>0\nfragmentOutputs.fragData0= fragData[0];\n#endif\n#if SCENE_MRT_COUNT>1\nfragmentOutputs.fragData1= fragData[1];\n#endif\n#if SCENE_MRT_COUNT>2\nfragmentOutputs.fragData2= fragData[2];\n#endif\n#if SCENE_MRT_COUNT>3\nfragmentOutputs.fragData3= fragData[3];\n#endif\n#if SCENE_MRT_COUNT>4\nfragmentOutputs.fragData4= fragData[4];\n#endif\n#if SCENE_MRT_COUNT>5\nfragmentOutputs.fragData5= fragData[5];\n#endif\n#if SCENE_MRT_COUNT>6\nfragmentOutputs.fragData6= fragData[6];\n#endif\n#if SCENE_MRT_COUNT>7\nfragmentOutputs.fragData7= fragData[7];\n#endif\n#endif\n#if !defined(PREPASS) && !defined(ORDER_INDEPENDENT_TRANSPARENCY)\nfragmentOutputs.color=color;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {fragmentOutputs.frontColor=vec4f(fragmentOutputs.frontColor.rgb+color.rgb*color.a*alphaMultiplier,1.0-alphaMultiplier*(1.0-color.a));} else {fragmentOutputs.backColor+=color;}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n",e.ShadersStoreWGSL[Na]=Ma,Ia={name:Na,shader:Ma}}}),qa=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/decalVertexDeclaration.js"(){c(),"decalVertexDeclaration","#ifdef DECAL\nuniform vec4 vDecalInfos;uniform mat4 decalMatrix;\n#endif\n",e.IncludesShadersStore.decalVertexDeclaration="#ifdef DECAL\nuniform vec4 vDecalInfos;uniform mat4 decalMatrix;\n#endif\n"}}),Ja=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultVertexDeclaration.js"(){c(),qa(),"defaultVertexDeclaration","uniform mat4 viewProjection;uniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;uniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;uniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;uniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;uniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;uniform mat4 detailMatrix;\n#endif\n#include<decalVertexDeclaration>\n#define ADDITIONAL_VERTEX_DECLARATION\n",e.IncludesShadersStore.defaultVertexDeclaration="uniform mat4 viewProjection;uniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;uniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;uniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;uniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;uniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;uniform mat4 detailMatrix;\n#endif\n#include<decalVertexDeclaration>\n#define ADDITIONAL_VERTEX_DECLARATION\n"}}),Qa=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultUboDeclaration.js"(){c(),bn(),Pn(),"defaultUboDeclaration","layout(std140,column_major) uniform;uniform Material\n{vec4 diffuseLeftColor;vec4 diffuseRightColor;vec4 opacityParts;vec4 reflectionLeftColor;vec4 reflectionRightColor;vec4 refractionLeftColor;vec4 refractionRightColor;vec4 emissiveLeftColor;vec4 emissiveRightColor;vec2 vDiffuseInfos;vec2 vAmbientInfos;vec2 vOpacityInfos;vec2 vReflectionInfos;vec3 vReflectionPosition;vec3 vReflectionSize;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec2 vSpecularInfos;vec3 vBumpInfos;mat4 diffuseMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 reflectionMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 specularMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;float pointSize;float alphaCutOff;mat4 refractionMatrix;vec4 vRefractionInfos;vec3 vRefractionPosition;vec3 vRefractionSize;vec4 vSpecularColor;vec3 vEmissiveColor;vec4 vDiffuseColor;vec3 vAmbientColor;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",e.IncludesShadersStore.defaultUboDeclaration="layout(std140,column_major) uniform;uniform Material\n{vec4 diffuseLeftColor;vec4 diffuseRightColor;vec4 opacityParts;vec4 reflectionLeftColor;vec4 reflectionRightColor;vec4 refractionLeftColor;vec4 refractionRightColor;vec4 emissiveLeftColor;vec4 emissiveRightColor;vec2 vDiffuseInfos;vec2 vAmbientInfos;vec2 vOpacityInfos;vec2 vReflectionInfos;vec3 vReflectionPosition;vec3 vReflectionSize;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec2 vSpecularInfos;vec3 vBumpInfos;mat4 diffuseMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 reflectionMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 specularMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;float pointSize;float alphaCutOff;mat4 refractionMatrix;vec4 vRefractionInfos;vec3 vRefractionPosition;vec3 vRefractionSize;vec4 vSpecularColor;vec3 vEmissiveColor;vec4 vDiffuseColor;vec3 vAmbientColor;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n"}}),Za=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/uvAttributeDeclaration.js"(){c(),"uvAttributeDeclaration","#ifdef UV{X}\nattribute vec2 uv{X};\n#endif\n",e.IncludesShadersStore.uvAttributeDeclaration="#ifdef UV{X}\nattribute vec2 uv{X};\n#endif\n"}}),es=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/instancesDeclaration.js"(){c(),"instancesDeclaration","#ifdef INSTANCES\nattribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n",e.IncludesShadersStore.instancesDeclaration="#ifdef INSTANCES\nattribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n"}}),ts=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassVertexDeclaration.js"(){c(),"prePassVertexDeclaration","#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform mat4 previousViewProjection;varying vec4 vCurrentPosition;varying vec4 vPreviousPosition;\n#endif\n#endif\n",e.IncludesShadersStore.prePassVertexDeclaration="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform mat4 previousViewProjection;varying vec4 vCurrentPosition;varying vec4 vPreviousPosition;\n#endif\n#endif\n"}}),is=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/mainUVVaryingDeclaration.js"(){c(),"mainUVVaryingDeclaration","#ifdef MAINUV{X}\nvarying vec2 vMainUV{X};\n#endif\n",e.IncludesShadersStore.mainUVVaryingDeclaration="#ifdef MAINUV{X}\nvarying vec2 vMainUV{X};\n#endif\n"}}),ns=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerVertexDeclaration.js"(){c(),"samplerVertexDeclaration","#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n",e.IncludesShadersStore.samplerVertexDeclaration="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n"}}),as=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpVertexDeclaration.js"(){c(),"bumpVertexDeclaration","#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n",e.IncludesShadersStore.bumpVertexDeclaration="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n"}}),ss=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/fogVertexDeclaration.js"(){c(),"fogVertexDeclaration","#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n",e.IncludesShadersStore.fogVertexDeclaration="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n"}}),rs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthDeclaration.js"(){c(),"logDepthDeclaration","#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n",e.IncludesShadersStore.logDepthDeclaration="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n"}}),os=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassVertex.js"(){c(),"prePassVertex","#ifdef PREPASS_DEPTH\nvViewPos=(view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n",e.IncludesShadersStore.prePassVertex="#ifdef PREPASS_DEPTH\nvViewPos=(view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n"}}),ls=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/uvVariableDeclaration.js"(){c(),"uvVariableDeclaration","#if !defined(UV{X}) && defined(MAINUV{X})\nvec2 uv{X}=vec2(0.,0.);\n#endif\n#ifdef MAINUV{X}\nvMainUV{X}=uv{X};\n#endif\n",e.IncludesShadersStore.uvVariableDeclaration="#if !defined(UV{X}) && defined(MAINUV{X})\nvec2 uv{X}=vec2(0.,0.);\n#endif\n#ifdef MAINUV{X}\nvMainUV{X}=uv{X};\n#endif\n"}}),cs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerVertexImplementation.js"(){c(),"samplerVertexImplementation","#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (v_INFONAME_==0.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));}\n#ifdef UV2\nelse if (v_INFONAME_==1.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));}\n#endif\n#ifdef UV3\nelse if (v_INFONAME_==2.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));}\n#endif\n#ifdef UV4\nelse if (v_INFONAME_==3.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));}\n#endif\n#ifdef UV5\nelse if (v_INFONAME_==4.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));}\n#endif\n#ifdef UV6\nelse if (v_INFONAME_==5.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));}\n#endif\n#endif\n",e.IncludesShadersStore.samplerVertexImplementation="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (v_INFONAME_==0.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));}\n#ifdef UV2\nelse if (v_INFONAME_==1.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));}\n#endif\n#ifdef UV3\nelse if (v_INFONAME_==2.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));}\n#endif\n#ifdef UV4\nelse if (v_INFONAME_==3.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));}\n#endif\n#ifdef UV5\nelse if (v_INFONAME_==4.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));}\n#endif\n#ifdef UV6\nelse if (v_INFONAME_==5.)\n{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));}\n#endif\n#endif\n"}}),hs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpVertex.js"(){c(),"bumpVertex","#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);vec3 tbnTangent=normalize(tangentUpdated.xyz);vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif\n",e.IncludesShadersStore.bumpVertex="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);vec3 tbnTangent=normalize(tangentUpdated.xyz);vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif\n"}}),fs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/fogVertex.js"(){c(),"fogVertex","#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n",e.IncludesShadersStore.fogVertex="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n"}}),us=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/vertexColorMixing.js"(){c(),"vertexColorMixing","#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n",e.IncludesShadersStore.vertexColorMixing="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n"}}),ds=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pointCloudVertex.js"(){c(),"pointCloudVertex","#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n",e.IncludesShadersStore.pointCloudVertex="#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n"}}),ms=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthVertex.js"(){c(),"logDepthVertex","#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n",e.IncludesShadersStore.logDepthVertex="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n"}}),ps={};l(ps,{defaultVertexShader:()=>Ka});var _s,vs,gs,Ss=o({"../node_modules/@babylonjs/core/Shaders/default.vertex.js"(){c(),Ja(),Qa(),Za(),tt(),G(),Rn(),es(),ts(),is(),ns(),as(),Dn(),ss(),qe(),Xe(),Tn(),Nn(),rs(),Ln(),Fn(),kn(),z(),Bn(),os(),ls(),cs(),hs(),Un(),fs(),_t(),us(),ds(),ms(),Ya="defaultVertexShader",ja="#include<__decl__defaultVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);vPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n",e.ShadersStore[Ya]=ja,Ka={name:Ya,shader:ja}}}),ys=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/decalFragmentDeclaration.js"(){c(),"decalFragmentDeclaration","#ifdef DECAL\nuniform vec4 vDecalInfos;\n#endif\n",e.IncludesShadersStore.decalFragmentDeclaration="#ifdef DECAL\nuniform vec4 vDecalInfos;\n#endif\n"}}),Es=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultFragmentDeclaration.js"(){c(),ys(),"defaultFragmentDeclaration","uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;uniform vec3 vAmbientColor;uniform float visibility;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform vec2 vTangentSpaceParams;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;uniform vec4 refractionRightColor;\n#endif\n#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)\nuniform vec3 vRefractionPosition;uniform vec3 vRefractionSize; \n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;uniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;uniform vec4 emissiveRightColor;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;uniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;uniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#include<decalFragmentDeclaration>\n#define ADDITIONAL_FRAGMENT_DECLARATION\n",e.IncludesShadersStore.defaultFragmentDeclaration="uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;uniform vec3 vAmbientColor;uniform float visibility;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform vec2 vTangentSpaceParams;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;uniform vec4 refractionRightColor;\n#endif\n#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)\nuniform vec3 vRefractionPosition;uniform vec3 vRefractionSize; \n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;uniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;uniform vec4 emissiveRightColor;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;uniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;uniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#include<decalFragmentDeclaration>\n#define ADDITIONAL_FRAGMENT_DECLARATION\n"}}),As=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassDeclaration.js"(){c(),"prePassDeclaration","#ifdef PREPASS\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;\n#ifdef PREPASS_DEPTH\nvarying highp vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;\n#endif\n#endif\n",e.IncludesShadersStore.prePassDeclaration="#ifdef PREPASS\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;\n#ifdef PREPASS_DEPTH\nvarying highp vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;\n#endif\n#endif\n"}}),Cs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/oitDeclaration.js"(){c(),"oitDeclaration","#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out vec2 depth; \nlayout(location=1) out vec4 frontColor;layout(location=2) out vec4 backColor;\n#define MAX_DEPTH 99999.0\nhighp vec4 gl_FragColor;uniform sampler2D oitDepthSampler;uniform sampler2D oitFrontColorSampler;\n#endif\n",e.IncludesShadersStore.oitDeclaration="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out vec2 depth; \nlayout(location=1) out vec4 frontColor;layout(location=2) out vec4 backColor;\n#define MAX_DEPTH 99999.0\nhighp vec4 gl_FragColor;uniform sampler2D oitDepthSampler;uniform sampler2D oitFrontColorSampler;\n#endif\n"}}),Rs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerFragmentDeclaration.js"(){c(),"samplerFragmentDeclaration","#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\nuniform sampler2D _SAMPLERNAME_Sampler;\n#endif\n",e.IncludesShadersStore.samplerFragmentDeclaration="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\nuniform sampler2D _SAMPLERNAME_Sampler;\n#endif\n"}}),Ts=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/fresnelFunction.js"(){c(),"fresnelFunction","#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}\n#endif\n",e.IncludesShadersStore.fresnelFunction="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}\n#endif\n"}}),Ns=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/reflectionFunction.js"(){c(),"reflectionFunction","vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0); }\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(1.0-s,t,0); }\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);vec3 r=normalize(reflect(cameraToVertex,worldNormal));r=vec3(reflectionMatrix*vec4(r,0));float lon=atan(r.z,r.x);float lat=acos(r.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0);}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{vec3 viewDir=normalize(vec3(view*worldPos));vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));vec3 r=reflect(viewDir,viewNormal);r=vec3(reflectionMatrix*vec4(r,0));r.z=r.z-1.0;float m=2.0*length(r);return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 viewDir=worldPos.xyz-eyePosition;vec3 coords=normalize(reflect(viewDir,worldNormal));return vec3(reflectionMatrix*vec4(coords,1));}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);coords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{return vec3(reflectionMatrix*(view*worldPos));}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{return vec3(reflectionMatrix*vec4(positionW,1.));}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\n",e.IncludesShadersStore.reflectionFunction="vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0); }\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(1.0-s,t,0); }\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);vec3 r=normalize(reflect(cameraToVertex,worldNormal));r=vec3(reflectionMatrix*vec4(r,0));float lon=atan(r.z,r.x);float lat=acos(r.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0);}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{vec3 viewDir=normalize(vec3(view*worldPos));vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));vec3 r=reflect(viewDir,viewNormal);r=vec3(reflectionMatrix*vec4(r,0));r.z=r.z-1.0;float m=2.0*length(r);return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 viewDir=worldPos.xyz-eyePosition;vec3 coords=normalize(reflect(viewDir,worldNormal));return vec3(reflectionMatrix*vec4(coords,1));}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);coords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{return vec3(reflectionMatrix*(view*worldPos));}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{return vec3(reflectionMatrix*vec4(positionW,1.));}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\n"}}),Ms=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/imageProcessingDeclaration.js"(){c(),"imageProcessingDeclaration","#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n",e.IncludesShadersStore.imageProcessingDeclaration="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n"}}),Is=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/imageProcessingFunctions.js"(){c(),"imageProcessingFunctions","#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}",e.IncludesShadersStore.imageProcessingFunctions="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}"}}),xs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragmentMainFunctions.js"(){c(),"bumpFragmentMainFunctions","#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#if defined(WEBGL2) || defined(WEBGPU)\nmat4 toNormalMatrix(mat4 wMatrix)\n{mat4 ret=inverse(wMatrix);ret=transpose(ret);ret[0][3]=0.;ret[1][3]=0.;ret[2][3]=0.;ret[3]=vec4(0.,0.,0.,1.);return ret;}\n#else\nmat4 toNormalMatrix(mat4 m)\n{float\na00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],\na10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],\na20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],\na30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],\nb00=a00*a11-a01*a10,\nb01=a00*a12-a02*a10,\nb02=a00*a13-a03*a10,\nb03=a01*a12-a02*a11,\nb04=a01*a13-a03*a11,\nb05=a02*a13-a03*a12,\nb06=a20*a31-a21*a30,\nb07=a20*a32-a22*a30,\nb08=a20*a33-a23*a30,\nb09=a21*a32-a22*a31,\nb10=a21*a33-a23*a31,\nb11=a22*a33-a23*a32,\ndet=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;mat4 mi=mat4(\na11*b11-a12*b10+a13*b09,\na02*b10-a01*b11-a03*b09,\na31*b05-a32*b04+a33*b03,\na22*b04-a21*b05-a23*b03,\na12*b08-a10*b11-a13*b07,\na00*b11-a02*b08+a03*b07,\na32*b02-a30*b05-a33*b01,\na20*b05-a22*b02+a23*b01,\na10*b10-a11*b08+a13*b06,\na01*b08-a00*b10-a03*b06,\na30*b04-a31*b02+a33*b00,\na21*b02-a20*b04-a23*b00,\na11*b07-a10*b09-a12*b06,\na00*b09-a01*b07+a02*b06,\na31*b01-a30*b03-a32*b00,\na20*b03-a21*b01+a22*b00)/det;return mat4(mi[0][0],mi[1][0],mi[2][0],mi[3][0],\nmi[0][1],mi[1][1],mi[2][1],mi[3][1],\nmi[0][2],mi[1][2],mi[2][2],mi[3][2],\nmi[0][3],mi[1][3],mi[2][3],mi[3][3]);}\n#endif\n#endif\nvec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)\n{\n#ifdef NORMALXYSCALE\nnormal=normalize(normal*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*normal);}\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);}\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{vec3 dp1=dFdx(p);vec3 dp2=dFdy(p);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;tangent*=tangentSpaceParams.x;bitangent*=tangentSpaceParams.y;float det=max(dot(tangent,tangent),dot(bitangent,bitangent));float invmax=det==0.0 ? 0.0 : inversesqrt(det);return mat3(tangent*invmax,bitangent*invmax,normal);}\n#endif\n",e.IncludesShadersStore.bumpFragmentMainFunctions="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#if defined(WEBGL2) || defined(WEBGPU)\nmat4 toNormalMatrix(mat4 wMatrix)\n{mat4 ret=inverse(wMatrix);ret=transpose(ret);ret[0][3]=0.;ret[1][3]=0.;ret[2][3]=0.;ret[3]=vec4(0.,0.,0.,1.);return ret;}\n#else\nmat4 toNormalMatrix(mat4 m)\n{float\na00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],\na10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],\na20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],\na30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],\nb00=a00*a11-a01*a10,\nb01=a00*a12-a02*a10,\nb02=a00*a13-a03*a10,\nb03=a01*a12-a02*a11,\nb04=a01*a13-a03*a11,\nb05=a02*a13-a03*a12,\nb06=a20*a31-a21*a30,\nb07=a20*a32-a22*a30,\nb08=a20*a33-a23*a30,\nb09=a21*a32-a22*a31,\nb10=a21*a33-a23*a31,\nb11=a22*a33-a23*a32,\ndet=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;mat4 mi=mat4(\na11*b11-a12*b10+a13*b09,\na02*b10-a01*b11-a03*b09,\na31*b05-a32*b04+a33*b03,\na22*b04-a21*b05-a23*b03,\na12*b08-a10*b11-a13*b07,\na00*b11-a02*b08+a03*b07,\na32*b02-a30*b05-a33*b01,\na20*b05-a22*b02+a23*b01,\na10*b10-a11*b08+a13*b06,\na01*b08-a00*b10-a03*b06,\na30*b04-a31*b02+a33*b00,\na21*b02-a20*b04-a23*b00,\na11*b07-a10*b09-a12*b06,\na00*b09-a01*b07+a02*b06,\na31*b01-a30*b03-a32*b00,\na20*b03-a21*b01+a22*b00)/det;return mat4(mi[0][0],mi[1][0],mi[2][0],mi[3][0],\nmi[0][1],mi[1][1],mi[2][1],mi[3][1],\nmi[0][2],mi[1][2],mi[2][2],mi[3][2],\nmi[0][3],mi[1][3],mi[2][3],mi[3][3]);}\n#endif\n#endif\nvec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)\n{\n#ifdef NORMALXYSCALE\nnormal=normalize(normal*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*normal);}\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);}\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{vec3 dp1=dFdx(p);vec3 dp2=dFdy(p);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;tangent*=tangentSpaceParams.x;bitangent*=tangentSpaceParams.y;float det=max(dot(tangent,tangent),dot(bitangent,bitangent));float invmax=det==0.0 ? 0.0 : inversesqrt(det);return mat3(tangent*invmax,bitangent*invmax,normal);}\n#endif\n"}}),bs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragmentFunctions.js"(){c(),Rs(),"bumpFragmentFunctions","#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;const float maxSamples=15.;const int iMaxSamples=15;vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;parallaxLimit*=parallaxScale;vec2 vOffsetDir=normalize(vViewDirCoT.xy);vec2 vMaxOffset=vOffsetDir*parallaxLimit;float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));float stepSize=1.0/numSamples;float currRayHeight=1.0;vec2 vCurrOffset=vec2(0,0);vec2 vLastOffset=vec2(0,0);float lastSampledHeight=1.0;float currSampledHeight=1.0;bool keepWorking=true;for (int i=0; i<iMaxSamples; i++)\n{currSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;if (!keepWorking)\n{}\nelse if (currSampledHeight>currRayHeight)\n{float delta1=currSampledHeight-currRayHeight;float delta2=(currRayHeight+stepSize)-lastSampledHeight;float ratio=delta1/(delta1+delta2);vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;keepWorking=false;}\nelse\n{currRayHeight-=stepSize;vLastOffset=vCurrOffset;\n#ifdef PARALLAX_RHS\nvCurrOffset-=stepSize*vMaxOffset;\n#else\nvCurrOffset+=stepSize*vMaxOffset;\n#endif\nlastSampledHeight=currSampledHeight;}}\nreturn vCurrOffset;}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{float height=texture2D(bumpSampler,vBumpUV).w;vec2 texCoordOffset=heightScale*viewDir.xy*height;\n#ifdef PARALLAX_RHS\nreturn texCoordOffset;\n#else\nreturn -texCoordOffset;\n#endif\n}\n#endif\n",e.IncludesShadersStore.bumpFragmentFunctions="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;const float maxSamples=15.;const int iMaxSamples=15;vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;parallaxLimit*=parallaxScale;vec2 vOffsetDir=normalize(vViewDirCoT.xy);vec2 vMaxOffset=vOffsetDir*parallaxLimit;float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));float stepSize=1.0/numSamples;float currRayHeight=1.0;vec2 vCurrOffset=vec2(0,0);vec2 vLastOffset=vec2(0,0);float lastSampledHeight=1.0;float currSampledHeight=1.0;bool keepWorking=true;for (int i=0; i<iMaxSamples; i++)\n{currSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;if (!keepWorking)\n{}\nelse if (currSampledHeight>currRayHeight)\n{float delta1=currSampledHeight-currRayHeight;float delta2=(currRayHeight+stepSize)-lastSampledHeight;float ratio=delta1/(delta1+delta2);vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;keepWorking=false;}\nelse\n{currRayHeight-=stepSize;vLastOffset=vCurrOffset;\n#ifdef PARALLAX_RHS\nvCurrOffset-=stepSize*vMaxOffset;\n#else\nvCurrOffset+=stepSize*vMaxOffset;\n#endif\nlastSampledHeight=currSampledHeight;}}\nreturn vCurrOffset;}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{float height=texture2D(bumpSampler,vBumpUV).w;vec2 texCoordOffset=heightScale*viewDir.xy*height;\n#ifdef PARALLAX_RHS\nreturn texCoordOffset;\n#else\nreturn -texCoordOffset;\n#endif\n}\n#endif\n"}}),Ps=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragment.js"(){c(),"bumpFragment","vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#elif defined(BUMP)\nfloat normalScale=vBumpInfos.y;\n#else\nfloat normalScale=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#elif defined(BUMP)\nvec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);\n#else\nvec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nvec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;mat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);vec2 detailNormalRG=detailColor.wy*2.0-1.0;float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));vec3 detailNormal=vec3(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\n#define CUSTOM_FRAGMENT_BUMP_FRAGMENT\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);normalW=normalize(mat3(normalMatrix)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);\n#else\nvec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal.xy*=vDetailInfos.z;vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal.xy*=vDetailInfos.z;bumpNormal+=vec3(0.0,0.0,1.0);detailNormal*=vec3(-1.0,-1.0,1.0);vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal.xy*=vDetailInfos.z;normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);\n#endif\n",e.IncludesShadersStore.bumpFragment="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#elif defined(BUMP)\nfloat normalScale=vBumpInfos.y;\n#else\nfloat normalScale=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#elif defined(BUMP)\nvec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);\n#else\nvec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nvec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;mat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);vec2 detailNormalRG=detailColor.wy*2.0-1.0;float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));vec3 detailNormal=vec3(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\n#define CUSTOM_FRAGMENT_BUMP_FRAGMENT\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);normalW=normalize(mat3(normalMatrix)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);\n#else\nvec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal.xy*=vDetailInfos.z;vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal.xy*=vDetailInfos.z;bumpNormal+=vec3(0.0,0.0,1.0);detailNormal*=vec3(-1.0,-1.0,1.0);vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal.xy*=vDetailInfos.z;normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);\n#endif\n"}}),ws=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/decalFragment.js"(){c(),"decalFragment","#ifdef DECAL\n#ifdef GAMMADECAL\ndecalColor.rgb=toLinearSpace(decalColor.rgb);\n#endif\n#ifdef DECAL_SMOOTHALPHA\ndecalColor.a*=decalColor.a;\n#endif\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,decalColor.rgb,decalColor.a);\n#endif\n",e.IncludesShadersStore.decalFragment="#ifdef DECAL\n#ifdef GAMMADECAL\ndecalColor.rgb=toLinearSpace(decalColor.rgb);\n#endif\n#ifdef DECAL_SMOOTHALPHA\ndecalColor.a*=decalColor.a;\n#endif\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,decalColor.rgb,decalColor.a);\n#endif\n"}}),Os=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/depthPrePass.js"(){c(),"depthPrePass","#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);return;\n#endif\n",e.IncludesShadersStore.depthPrePass="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);return;\n#endif\n"}}),Ds=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthFragment.js"(){c(),"logDepthFragment","#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n",e.IncludesShadersStore.logDepthFragment="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n"}}),Ls=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/fogFragment.js"(){c(),"fogFragment","#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n",e.IncludesShadersStore.fogFragment="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n"}}),Fs=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/oitFragment.js"(){c(),"oitFragment","#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nfloat fragDepth=gl_FragCoord.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nuint halfFloat=packHalf2x16(vec2(fragDepth));vec2 full=unpackHalf2x16(halfFloat);fragDepth=full.x;\n#endif\nivec2 fragCoord=ivec2(gl_FragCoord.xy);vec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;vec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);depth.rg=vec2(-MAX_DEPTH);frontColor=lastFrontColor;backColor=vec4(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nfloat furthestDepth=-lastDepth.x;float nearestDepth=lastDepth.y;\n#else\nfloat nearestDepth=-lastDepth.x;float furthestDepth=lastDepth.y;\n#endif\nfloat alphaMultiplier=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn;}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\ndepth.rg=vec2(-fragDepth,fragDepth);return;}\n#endif\n",e.IncludesShadersStore.oitFragment="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nfloat fragDepth=gl_FragCoord.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nuint halfFloat=packHalf2x16(vec2(fragDepth));vec2 full=unpackHalf2x16(halfFloat);fragDepth=full.x;\n#endif\nivec2 fragCoord=ivec2(gl_FragCoord.xy);vec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;vec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);depth.rg=vec2(-MAX_DEPTH);frontColor=lastFrontColor;backColor=vec4(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nfloat furthestDepth=-lastDepth.x;float nearestDepth=lastDepth.y;\n#else\nfloat nearestDepth=-lastDepth.x;float furthestDepth=lastDepth.y;\n#endif\nfloat alphaMultiplier=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn;}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\ndepth.rg=vec2(-fragDepth,fragDepth);return;}\n#endif\n"}}),ks={};l(ks,{defaultPixelShader:()=>gs});var Bs,Gs,Us,Hs=o({"../node_modules/@babylonjs/core/Shaders/default.fragment.js"(){c(),Es(),Qa(),As(),Cs(),is(),tt(),be(),Ue(),rt(),ft(),Rs(),Ts(),Ns(),Ms(),Is(),xs(),bs(),vn(),rs(),Nt(),gn(),Ps(),ws(),Os(),Le(),Ds(),Ls(),Fs(),_s="defaultPixelShader",vs="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#if defined(DECAL) && !defined(DECAL_AFTER_DETAIL)\nvec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);\n#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef DETAIL\nbaseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);\n#endif\n#if defined(DECAL) && defined(DECAL_AFTER_DETAIL)\nvec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);\n#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;vec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);specularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;float aggShadow=0.;float numLights=0.;\n#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\naggShadow=aggShadow/numLights;vec4 refractionColor=vec4(0.,0.,0.,1.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,vRefractionSize,vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;vec4 refractionLookup=textureCube(refractionCubeSampler,refractionVector);if (dot(refractionVector,viewDirectionW)<1.0) {refractionColor=refractionLookup;}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;refractionColor=texture2D(refraction2DSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor.rgb=fromRGBD(refractionColor);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor.rgb=toGammaSpace(refractionColor.rgb);\n#endif\nrefractionColor.rgb*=vRefractionInfos.x;\n#endif\nvec4 reflectionColor=vec4(0.,0.,0.,1.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;reflectionColor=texture2D(reflection2DSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor.rgb=toGammaSpace(reflectionColor.rgb);\n#endif\nreflectionColor.rgb*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);refractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<alphaCutOff)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor.rgb;\n#else\ncolor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);color=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;gl_FragData[0]=color; \n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;vec2 velocity=abs(a-b);velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\n#ifdef PREPASS_NORMAL_WORLDSPACE\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalW,writeGeometryInfo); \n#else\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalize((view*vec4(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toLinearSpace(specularMapColor))*writeGeometryInfo; \n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toLinearSpace(specularColor),1.0)*writeGeometryInfo;\n#endif\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=color;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {frontColor.rgb+=color.rgb*color.a*alphaMultiplier;frontColor.a=1.0-alphaMultiplier*(1.0-color.a);} else {backColor+=color;}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n",e.ShadersStore[_s]=vs,gs={name:_s,shader:vs}}}),Vs={};l(Vs,{spritesVertexShaderWGSL:()=>Us});var Ws,zs,Xs,Ys=o({"../node_modules/@babylonjs/core/ShadersWGSL/sprites.vertex.js"(){c(),ma(),_a(),Ra(),Bs="spritesVertexShader",Gs="attribute position: vec4f;attribute options: vec2f;attribute offsets: vec2f;attribute inverts: vec2f;attribute cellInfo: vec4f;attribute color: vec4f;uniform view: mat4x4f;uniform projection: mat4x4f;varying vUV: vec2f;varying vColor: vec4f;\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar viewPos: vec3f=(uniforms.view* vec4f(input.position.xyz,1.0)).xyz; \nvar cornerPos: vec2f;var angle: f32=input.position.w;var size: vec2f= vec2f(input.options.x,input.options.y);var offset: vec2f=input.offsets.xy;cornerPos= vec2f(offset.x-0.5,offset.y -0.5)*size;var rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;viewPos+=rotatedCorner;vertexOutputs.position=uniforms.projection*vec4f(viewPos,1.0); \nvertexOutputs.vColor=input.color;var uvOffset: vec2f= vec2f(abs(offset.x-input.inverts.x),abs(1.0-offset.y-input.inverts.y));var uvPlace: vec2f=input.cellInfo.xy;var uvSize: vec2f=input.cellInfo.zw;vertexOutputs.vUV.x=uvPlace.x+uvSize.x*uvOffset.x;vertexOutputs.vUV.y=uvPlace.y+uvSize.y*uvOffset.y;\n#ifdef FOG\nvertexOutputs.vFogDistance=viewPos;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStoreWGSL[Bs]=Gs,Us={name:Bs,shader:Gs}}}),js=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/imageProcessingCompatibility.js"(){c(),"imageProcessingCompatibility","#ifdef IMAGEPROCESSINGPOSTPROCESS\nfragmentOutputs.color=vec4f(pow(fragmentOutputs.color.rgb, vec3f(2.2)),fragmentOutputs.color.a);\n#endif\n",e.IncludesShadersStoreWGSL.imageProcessingCompatibility="#ifdef IMAGEPROCESSINGPOSTPROCESS\nfragmentOutputs.color=vec4f(pow(fragmentOutputs.color.rgb, vec3f(2.2)),fragmentOutputs.color.a);\n#endif\n"}}),Ks={};l(Ks,{spritesPixelShaderWGSL:()=>Xs});var $s,qs,Js,Qs=o({"../node_modules/@babylonjs/core/ShadersWGSL/sprites.fragment.js"(){c(),Et(),_a(),Va(),Wa(),js(),Ws="spritesPixelShader",zs="uniform alphaTest: i32;varying vColor: vec4f;varying vUV: vec2f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<fogFragmentDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#ifdef PIXEL_PERFECT\nfn uvPixelPerfect(uv: vec2f)->vec2f {var res: vec2f= vec2f(textureDimensions(diffuseSampler,0));var uvTemp=uv*res;var seam: vec2f=floor(uvTemp+0.5);uvTemp=seam+clamp((uvTemp-seam)/fwidth(uvTemp),vec2f(-0.5),vec2f(0.5));return uvTemp/res;}\n#endif\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#ifdef PIXEL_PERFECT\nvar uv: vec2f=uvPixelPerfect(input.vUV);\n#else\nvar uv: vec2f=input.vUV;\n#endif\nvar color: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,uv);var fAlphaTest: f32= f32(uniforms.alphaTest);if (fAlphaTest != 0.)\n{if (color.a<0.95) {discard;}}\ncolor*=input.vColor;\n#include<logDepthFragment>\n#include<fogFragment>\nfragmentOutputs.color=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}",e.ShadersStoreWGSL[Ws]=zs,Xs={name:Ws,shader:zs}}}),Zs={};l(Zs,{spritesVertexShader:()=>Js});var er,tr,ir,nr=o({"../node_modules/@babylonjs/core/Shaders/sprites.vertex.js"(){c(),ss(),rs(),ms(),$s="spritesVertexShader",qs="attribute vec4 position;attribute vec2 options;attribute vec2 offsets;attribute vec2 inverts;attribute vec4 cellInfo;attribute vec4 color;uniform mat4 view;uniform mat4 projection;varying vec2 vUV;varying vec4 vColor;\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;float angle=position.w;vec2 size=vec2(options.x,options.y);vec2 offset=offsets.xy;cornerPos=vec2(offset.x-0.5,offset.y -0.5)*size;vec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;viewPos+=rotatedCorner;gl_Position=projection*vec4(viewPos,1.0); \nvColor=color;vec2 uvOffset=vec2(abs(offset.x-inverts.x),abs(1.0-offset.y-inverts.y));vec2 uvPlace=cellInfo.xy;vec2 uvSize=cellInfo.zw;vUV.x=uvPlace.x+uvSize.x*uvOffset.x;vUV.y=uvPlace.y+uvSize.y*uvOffset.y;\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStore[$s]=qs,Js={name:$s,shader:qs}}}),ar=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/imageProcessingCompatibility.js"(){c(),"imageProcessingCompatibility","#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n",e.IncludesShadersStore.imageProcessingCompatibility="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n"}}),sr={};l(sr,{spritesPixelShader:()=>ir});var rr,or,lr,cr=o({"../node_modules/@babylonjs/core/Shaders/sprites.fragment.js"(){c(),Nt(),rs(),Ds(),Ls(),ar(),er="spritesPixelShader",tr="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform bool alphaTest;varying vec4 vColor;varying vec2 vUV;uniform sampler2D diffuseSampler;\n#include<fogFragmentDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#ifdef PIXEL_PERFECT\nvec2 uvPixelPerfect(vec2 uv) {vec2 res=vec2(textureSize(diffuseSampler,0));uv=uv*res;vec2 seam=floor(uv+0.5);uv=seam+clamp((uv-seam)/fwidth(uv),-0.5,0.5);return uv/res;}\n#endif\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#ifdef PIXEL_PERFECT\nvec2 uv=uvPixelPerfect(vUV);\n#else\nvec2 uv=vUV;\n#endif\nvec4 color=texture2D(diffuseSampler,uv);float fAlphaTest=float(alphaTest);if (fAlphaTest != 0.)\n{if (color.a<0.95)\ndiscard;}\ncolor*=vColor;\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}",e.ShadersStore[er]=tr,ir={name:er,shader:tr}}}),hr={};l(hr,{colorVertexShaderWGSL:()=>lr});var fr,ur,dr,mr=o({"../node_modules/@babylonjs/core/ShadersWGSL/color.vertex.js"(){c(),x(),Ui(),Yi(),ma(),ca(),$i(),D(),qi(),Qi(),Aa(),Ca(),rr="colorVertexShader",or="attribute position: vec3f;\n#ifdef VERTEXCOLOR\nattribute color: vec4f;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#ifdef FOG\nuniform view: mat4x4f;\n#endif\n#include<instancesDeclaration>\nuniform viewProjection: mat4x4f;\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld* vec4f(input.position,1.0);vertexOutputs.position=uniforms.viewProjection*worldPos;\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<vertexColorMixing>\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStoreWGSL[rr]=or,lr={name:rr,shader:or}}}),pr={};l(pr,{colorPixelShaderWGSL:()=>dr});var _r,vr,gr,Sr=o({"../node_modules/@babylonjs/core/ShadersWGSL/color.fragment.js"(){c(),Oi(),Et(),Di(),Wa(),fr="colorPixelShader",ur="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\n#define VERTEXCOLOR\nvarying vColor: vec4f;\n#else\nuniform color: vec4f;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nfragmentOutputs.color=input.vColor;\n#else\nfragmentOutputs.color=uniforms.color;\n#endif\n#include<fogFragment>(color,fragmentOutputs.color)\n#define CUSTOM_FRAGMENT_MAIN_END\n}",e.ShadersStoreWGSL[fr]=ur,dr={name:fr,shader:ur}}}),yr={};l(yr,{colorVertexShader:()=>gr});var Er,Ar,Cr,Rr=o({"../node_modules/@babylonjs/core/Shaders/color.vertex.js"(){c(),G(),Rn(),Dn(),ss(),es(),kn(),z(),Bn(),Un(),fs(),us(),_r="colorVertexShader",vr="attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#ifdef FOG\nuniform mat4 view;\n#endif\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<vertexColorMixing>\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStore[_r]=vr,gr={name:_r,shader:vr}}}),Tr={};l(Tr,{colorPixelShader:()=>Cr});var Nr,Mr,Ir,xr=o({"../node_modules/@babylonjs/core/Shaders/color.fragment.js"(){c(),vn(),Nt(),gn(),Ls(),Er="colorPixelShader",Ar="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\n#define VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n#include<fogFragment>(color,gl_FragColor)\n#define CUSTOM_FRAGMENT_MAIN_END\n}",e.ShadersStore[Er]=Ar,Cr={name:Er,shader:Ar}}}),br={};l(br,{depthPixelShader:()=>Ir});var Pr,wr,Or,Dr=o({"../node_modules/@babylonjs/core/Shaders/depth.fragment.js"(){c(),vn(),Jt(),gn(),Nr="depthPixelShader",Mr="#ifdef ALPHATEST\nvarying vec2 vUV;uniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvarying float vDepthMetric;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\n#ifdef STORE_CAMERASPACE_Z\nvarying vec4 vViewPos;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef STORE_CAMERASPACE_Z\n#ifdef PACKED\ngl_FragColor=pack(vViewPos.z);\n#else\ngl_FragColor=vec4(vViewPos.z,0.0,0.0,1.0);\n#endif\n#else\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\ngl_FragColor=pack(gl_FragCoord.z);\n#else\ngl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\ngl_FragColor=pack(vDepthMetric);\n#else\ngl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n#endif\n}",e.ShadersStore[Nr]=Mr,Ir={name:Nr,shader:Mr}}}),Lr=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pointCloudVertexDeclaration.js"(){c(),"pointCloudVertexDeclaration","#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",e.IncludesShadersStore.pointCloudVertexDeclaration="#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n"}}),Fr={};l(Fr,{depthVertexShader:()=>Or});var kr,Br,Gr,Ur=o({"../node_modules/@babylonjs/core/Shaders/depth.vertex.js"(){c(),G(),Rn(),Tn(),Nn(),Dn(),es(),Lr(),Ln(),Fn(),kn(),z(),Bn(),Un(),ds(),Pr="depthVertexShader",wr="attribute vec3 position;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;uniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;uniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#ifdef STORE_CAMERASPACE_Z\nuniform mat4 view;varying vec4 vViewPos;\n#endif\n#include<pointCloudVertexDeclaration>\nvarying float vDepthMetric;\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{vec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#include<clipPlaneVertex>\ngl_Position=viewProjection*worldPos;\n#ifdef STORE_CAMERASPACE_Z\nvViewPos=view*worldPos;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));\n#else\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#endif\n#endif\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<pointCloudVertex>\n}\n",e.ShadersStore[Pr]=wr,Or={name:Pr,shader:wr}}}),Hr={};l(Hr,{depthVertexShaderWGSL:()=>Gr});var Vr,Wr,zr,Xr=o({"../node_modules/@babylonjs/core/ShadersWGSL/depth.vertex.js"(){c(),x(),Ui(),Hi(),Vi(),Yi(),ca(),ji(),Ki(),$i(),D(),qi(),Qi(),kr="depthVertexShader",Br="attribute position: vec3f;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform viewProjection: mat4x4f;uniform depthValues: vec2f;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vUV: vec2f;uniform diffuseMatrix: mat4x4f;\n#ifdef UV1\nattribute uv: vec2f;\n#endif\n#ifdef UV2\nattribute uv2: vec2f;\n#endif\n#endif\n#ifdef STORE_CAMERASPACE_Z\nuniform view: mat4x4f;varying vViewPos: vec4f;\n#endif\nvarying vDepthMetric: f32;\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {var positionUpdated: vec3f=input.position;\n#ifdef UV1\nvar uvUpdated: vec2f=input.uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld* vec4f(positionUpdated,1.0);\n#include<clipPlaneVertex>\nvertexOutputs.position=uniforms.viewProjection*worldPos;\n#ifdef STORE_CAMERASPACE_Z\nvertexOutputs.vViewPos=uniforms.view*worldPos;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\nvertexOutputs.vDepthMetric=((-vertexOutputs.position.z+uniforms.depthValues.x)/(uniforms.depthValues.y));\n#else\nvertexOutputs.vDepthMetric=((vertexOutputs.position.z+uniforms.depthValues.x)/(uniforms.depthValues.y));\n#endif\n#endif\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvertexOutputs.vUV= (uniforms.diffuseMatrix* vec4f(uvUpdated,1.0,0.0)).xy;\n#endif\n#ifdef UV2\nvertexOutputs.vUV= (uniforms.diffuseMatrix* vec4f(input.uv2,1.0,0.0)).xy;\n#endif\n#endif\n}\n",e.ShadersStoreWGSL[kr]=Br,Gr={name:kr,shader:Br}}}),Yr={};l(Yr,{depthPixelShaderWGSL:()=>zr});var jr,Kr,$r,qr=o({"../node_modules/@babylonjs/core/ShadersWGSL/depth.fragment.js"(){c(),Oi(),Ft(),Di(),Vr="depthPixelShader",Wr="#ifdef ALPHATEST\nvarying vUV: vec2f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvarying vDepthMetric: f32;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\n#ifdef STORE_CAMERASPACE_Z\nvarying vViewPos: vec4f;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV).a<0.4) {discard;}\n#endif\n#ifdef STORE_CAMERASPACE_Z\n#ifdef PACKED\nfragmentOutputs.color=pack(input.vViewPos.z);\n#else\nfragmentOutputs.color= vec4f(input.vViewPos.z,0.0,0.0,1.0);\n#endif\n#else\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\nfragmentOutputs.color=pack(input.position.z);\n#else\nfragmentOutputs.color= vec4f(input.position.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\nfragmentOutputs.color=pack(input.vDepthMetric);\n#else\nfragmentOutputs.color= vec4f(input.vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n#endif\n}",e.ShadersStoreWGSL[Vr]=Wr,zr={name:Vr,shader:Wr}}}),Jr={};l(Jr,{rgbdDecodePixelShaderWGSL:()=>$r});var Qr,Zr,eo,to=o({"../node_modules/@babylonjs/core/ShadersWGSL/rgbdDecode.fragment.js"(){c(),he(),jr="rgbdDecodePixelShader",Kr="varying vUV: vec2f;var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=vec4f(fromRGBD(textureSample(textureSampler,textureSamplerSampler,input.vUV)),1.0);}",e.ShadersStoreWGSL[jr]=Kr,$r={name:jr,shader:Kr}}}),io={};l(io,{rgbdEncodePixelShaderWGSL:()=>eo});var no,ao,so,ro=o({"../node_modules/@babylonjs/core/ShadersWGSL/rgbdEncode.fragment.js"(){c(),he(),Qr="rgbdEncodePixelShader",Zr="varying vUV: vec2f;var textureSamplerSampler: sampler;var textureSampler: texture_2d<f32>;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=toRGBD(textureSample(textureSampler,textureSamplerSampler,input.vUV).rgb);}",e.ShadersStoreWGSL[Qr]=Zr,eo={name:Qr,shader:Zr}}}),oo={};l(oo,{rgbdDecodePixelShader:()=>so});var lo,co,ho,fo=o({"../node_modules/@babylonjs/core/Shaders/rgbdDecode.fragment.js"(){c(),tt(),no="rgbdDecodePixelShader",ao="varying vec2 vUV;uniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);}",e.ShadersStore[no]=ao,so={name:no,shader:ao}}}),uo={};l(uo,{rgbdEncodePixelShader:()=>ho});var mo,po,_o,vo=o({"../node_modules/@babylonjs/core/Shaders/rgbdEncode.fragment.js"(){c(),tt(),lo="rgbdEncodePixelShader",co="varying vec2 vUV;uniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);}",e.ShadersStore[lo]=co,ho={name:lo,shader:co}}}),go=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrUboDeclaration.js"(){c(),Wi(),zi(),"pbrUboDeclaration","uniform vAlbedoInfos: vec2f;uniform vAmbientInfos: vec4f;uniform vOpacityInfos: vec2f;uniform vEmissiveInfos: vec2f;uniform vLightmapInfos: vec2f;uniform vReflectivityInfos: vec3f;uniform vMicroSurfaceSamplerInfos: vec2f;uniform vReflectionInfos: vec2f;uniform vReflectionFilteringInfo: vec2f;uniform vReflectionPosition: vec3f;uniform vReflectionSize: vec3f;uniform vBumpInfos: vec3f;uniform albedoMatrix: mat4x4f;uniform ambientMatrix: mat4x4f;uniform opacityMatrix: mat4x4f;uniform emissiveMatrix: mat4x4f;uniform lightmapMatrix: mat4x4f;uniform reflectivityMatrix: mat4x4f;uniform microSurfaceSamplerMatrix: mat4x4f;uniform bumpMatrix: mat4x4f;uniform vTangentSpaceParams: vec2f;uniform reflectionMatrix: mat4x4f;uniform vReflectionColor: vec3f;uniform vAlbedoColor: vec4f;uniform vLightingIntensity: vec4f;uniform vReflectionMicrosurfaceInfos: vec3f;uniform pointSize: f32;uniform vReflectivityColor: vec4f;uniform vEmissiveColor: vec3f;uniform vAmbientColor: vec3f;uniform vDebugMode: vec2f;uniform vMetallicReflectanceFactors: vec4f;uniform vMetallicReflectanceInfos: vec2f;uniform metallicReflectanceMatrix: mat4x4f;uniform vReflectanceInfos: vec2f;uniform reflectanceMatrix: mat4x4f;uniform vSphericalL00: vec3f;uniform vSphericalL1_1: vec3f;uniform vSphericalL10: vec3f;uniform vSphericalL11: vec3f;uniform vSphericalL2_2: vec3f;uniform vSphericalL2_1: vec3f;uniform vSphericalL20: vec3f;uniform vSphericalL21: vec3f;uniform vSphericalL22: vec3f;uniform vSphericalX: vec3f;uniform vSphericalY: vec3f;uniform vSphericalZ: vec3f;uniform vSphericalXX_ZZ: vec3f;uniform vSphericalYY_ZZ: vec3f;uniform vSphericalZZ: vec3f;uniform vSphericalXY: vec3f;uniform vSphericalYZ: vec3f;uniform vSphericalZX: vec3f;\n#define ADDITIONAL_UBO_DECLARATION\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",e.IncludesShadersStoreWGSL.pbrUboDeclaration="uniform vAlbedoInfos: vec2f;uniform vAmbientInfos: vec4f;uniform vOpacityInfos: vec2f;uniform vEmissiveInfos: vec2f;uniform vLightmapInfos: vec2f;uniform vReflectivityInfos: vec3f;uniform vMicroSurfaceSamplerInfos: vec2f;uniform vReflectionInfos: vec2f;uniform vReflectionFilteringInfo: vec2f;uniform vReflectionPosition: vec3f;uniform vReflectionSize: vec3f;uniform vBumpInfos: vec3f;uniform albedoMatrix: mat4x4f;uniform ambientMatrix: mat4x4f;uniform opacityMatrix: mat4x4f;uniform emissiveMatrix: mat4x4f;uniform lightmapMatrix: mat4x4f;uniform reflectivityMatrix: mat4x4f;uniform microSurfaceSamplerMatrix: mat4x4f;uniform bumpMatrix: mat4x4f;uniform vTangentSpaceParams: vec2f;uniform reflectionMatrix: mat4x4f;uniform vReflectionColor: vec3f;uniform vAlbedoColor: vec4f;uniform vLightingIntensity: vec4f;uniform vReflectionMicrosurfaceInfos: vec3f;uniform pointSize: f32;uniform vReflectivityColor: vec4f;uniform vEmissiveColor: vec3f;uniform vAmbientColor: vec3f;uniform vDebugMode: vec2f;uniform vMetallicReflectanceFactors: vec4f;uniform vMetallicReflectanceInfos: vec2f;uniform metallicReflectanceMatrix: mat4x4f;uniform vReflectanceInfos: vec2f;uniform reflectanceMatrix: mat4x4f;uniform vSphericalL00: vec3f;uniform vSphericalL1_1: vec3f;uniform vSphericalL10: vec3f;uniform vSphericalL11: vec3f;uniform vSphericalL2_2: vec3f;uniform vSphericalL2_1: vec3f;uniform vSphericalL20: vec3f;uniform vSphericalL21: vec3f;uniform vSphericalL22: vec3f;uniform vSphericalX: vec3f;uniform vSphericalY: vec3f;uniform vSphericalZ: vec3f;uniform vSphericalXX_ZZ: vec3f;uniform vSphericalYY_ZZ: vec3f;uniform vSphericalZZ: vec3f;uniform vSphericalXY: vec3f;uniform vSphericalYZ: vec3f;uniform vSphericalZX: vec3f;\n#define ADDITIONAL_UBO_DECLARATION\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n"}}),So=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/harmonicsFunctions.js"(){c(),"harmonicsFunctions","#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nfn computeEnvironmentIrradiance(normal: vec3f)->vec3f {return uniforms.vSphericalL00\n+ uniforms.vSphericalL1_1*(normal.y)\n+ uniforms.vSphericalL10*(normal.z)\n+ uniforms.vSphericalL11*(normal.x)\n+ uniforms.vSphericalL2_2*(normal.y*normal.x)\n+ uniforms.vSphericalL2_1*(normal.y*normal.z)\n+ uniforms.vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ uniforms.vSphericalL21*(normal.z*normal.x)\n+ uniforms.vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));}\n#else\nfn computeEnvironmentIrradiance(normal: vec3f)->vec3f {var Nx: f32=normal.x;var Ny: f32=normal.y;var Nz: f32=normal.z;var C1: vec3f=uniforms.vSphericalZZ.rgb;var Cx: vec3f=uniforms.vSphericalX.rgb;var Cy: vec3f=uniforms.vSphericalY.rgb;var Cz: vec3f=uniforms.vSphericalZ.rgb;var Cxx_zz: vec3f=uniforms.vSphericalXX_ZZ.rgb;var Cyy_zz: vec3f=uniforms.vSphericalYY_ZZ.rgb;var Cxy: vec3f=uniforms.vSphericalXY.rgb;var Cyz: vec3f=uniforms.vSphericalYZ.rgb;var Czx: vec3f=uniforms.vSphericalZX.rgb;var a1: vec3f=Cyy_zz*Ny+Cy;var a2: vec3f=Cyz*Nz+a1;var b1: vec3f=Czx*Nz+Cx;var b2: vec3f=Cxy*Ny+b1;var b3: vec3f=Cxx_zz*Nx+b2;var t1: vec3f=Cz *Nz+C1;var t2: vec3f=a2 *Ny+t1;var t3: vec3f=b3 *Nx+t2;return t3;}\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.harmonicsFunctions="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nfn computeEnvironmentIrradiance(normal: vec3f)->vec3f {return uniforms.vSphericalL00\n+ uniforms.vSphericalL1_1*(normal.y)\n+ uniforms.vSphericalL10*(normal.z)\n+ uniforms.vSphericalL11*(normal.x)\n+ uniforms.vSphericalL2_2*(normal.y*normal.x)\n+ uniforms.vSphericalL2_1*(normal.y*normal.z)\n+ uniforms.vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ uniforms.vSphericalL21*(normal.z*normal.x)\n+ uniforms.vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));}\n#else\nfn computeEnvironmentIrradiance(normal: vec3f)->vec3f {var Nx: f32=normal.x;var Ny: f32=normal.y;var Nz: f32=normal.z;var C1: vec3f=uniforms.vSphericalZZ.rgb;var Cx: vec3f=uniforms.vSphericalX.rgb;var Cy: vec3f=uniforms.vSphericalY.rgb;var Cz: vec3f=uniforms.vSphericalZ.rgb;var Cxx_zz: vec3f=uniforms.vSphericalXX_ZZ.rgb;var Cyy_zz: vec3f=uniforms.vSphericalYY_ZZ.rgb;var Cxy: vec3f=uniforms.vSphericalXY.rgb;var Cyz: vec3f=uniforms.vSphericalYZ.rgb;var Czx: vec3f=uniforms.vSphericalZX.rgb;var a1: vec3f=Cyy_zz*Ny+Cy;var a2: vec3f=Cyz*Nz+a1;var b1: vec3f=Czx*Nz+Cx;var b2: vec3f=Cxy*Ny+b1;var b3: vec3f=Cxx_zz*Nx+b2;var t1: vec3f=Cz *Nz+C1;var t2: vec3f=a2 *Ny+t1;var t3: vec3f=b3 *Nx+t2;return t3;}\n#endif\n#endif\n"}}),yo={};l(yo,{pbrVertexShaderWGSL:()=>_o});var Eo,Ao,Co,Ro=o({"../node_modules/@babylonjs/core/ShadersWGSL/pbr.vertex.js"(){c(),go(),la(),fa(),he(),x(),Ui(),ca(),ha(),ua(),So(),da(),Yi(),ma(),se(),Hi(),Vi(),_a(),ji(),Ki(),$i(),D(),qi(),va(),Sa(),ya(),Ea(),Qi(),Aa(),Te(),Ca(),Ra(),mo="pbrVertexShader",po="#include<pbrUboDeclaration>\n#define CUSTOM_VERTEX_BEGIN\nattribute position: vec3f;\n#ifdef NORMAL\nattribute normal: vec3f;\n#endif\n#ifdef TANGENT\nattribute tangent: vec4f;\n#endif\n#ifdef UV1\nattribute uv: vec2f;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef VERTEXCOLOR\nattribute color: vec4f;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)\n#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)\n#ifdef CLEARCOAT\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor)\n#endif\nvarying vPositionW: vec3f;\n#if DEBUGMODE>0\nvarying vClipSpacePosition: vec4f;\n#endif\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vEnvironmentIrradiance: vec3f;\n#include<harmonicsFunctions>\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<lightVxUboDeclaration>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar positionUpdated: vec3f=vertexInputs.position;\n#ifdef NORMAL\nvar normalUpdated: vec3f=vertexInputs.normal;\n#endif\n#ifdef TANGENT\nvar tangentUpdated: vec4f=vertexInputs.tangent;\n#endif\n#ifdef UV1\nvar uvUpdated: vec2f=vertexInputs.uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvertexOutputs.vPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvertexOutputs.vCurrentPosition=scene.viewProjection*finalWorld* vec4f(positionUpdated,1.0);vertexOutputs.vPreviousPosition=uniforms.previousViewProjection*finalPreviousWorld* vec4f(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvar worldPos: vec4f=finalWorld* vec4f(positionUpdated,1.0);vertexOutputs.vPositionW= worldPos.xyz;\n#include<prePassVertex>\n#ifdef NORMAL\nvar normalWorld: mat3x3f= mat3x3f(finalWorld[0].xyz,finalWorld[1].xyz,finalWorld[2].xyz);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvertexOutputs.vNormalW=normalUpdated/ vec3f(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vertexOutputs.vNormalW=normalize(normalWorld*vertexOutputs.vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvertexOutputs.vNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvar reflectionVector: vec3f= (uniforms.reflectionMatrix* vec4f(vertexOutputs.vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvertexOutputs.vEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {vertexOutputs.position=scene.viewProjection*worldPos;} else {vertexOutputs.position=scene.viewProjectionR*worldPos;}\n#else\nvertexOutputs.position=scene.viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvertexOutputs.vClipSpacePosition=vertexOutputs.position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvertexOutputs.vDirectionW=normalize((finalWorld*vec4f(positionUpdated,0.0)).xyz);\n#endif\n#ifndef UV1\nvar uvUpdated: vec2f= vec2f(0.,0.);\n#endif\n#ifdef MAINUV1\nvertexOutputs.vMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)\n#ifdef CLEARCOAT\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)\n#endif\n#ifdef SHEEN\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheenRoughness,_INFONAME_,SheenInfos.z)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_MATRIXNAME_,translucencyColor,_INFONAME_,TranslucencyColorInfos.x)\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStoreWGSL[mo]=po,_o={name:mo,shader:po}}}),To=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrFragmentExtraDeclaration.js"(){c(),fa(),"pbrFragmentExtraDeclaration","varying vPositionW: vec3f;\n#if DEBUGMODE>0\nvarying vClipSpacePosition: vec4f;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vEnvironmentIrradiance: vec3f;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n",e.IncludesShadersStoreWGSL.pbrFragmentExtraDeclaration="varying vPositionW: vec3f;\n#if DEBUGMODE>0\nvarying vClipSpacePosition: vec4f;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vNormalW: vec3f;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vEnvironmentIrradiance: vec3f;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vColor: vec4f;\n#endif\n"}}),No=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/samplerFragmentAlternateDeclaration.js"(){c(),"samplerFragmentAlternateDeclaration","#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.samplerFragmentAlternateDeclaration="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying v_VARYINGNAME_UV: vec2f;\n#endif\n#endif\n"}}),Mo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrFragmentSamplersDeclaration.js"(){c(),wa(),No(),"pbrFragmentSamplersDeclaration","#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nvar clearCoatRoughnessSamplerSampler: sampler;var clearCoatRoughnessSampler: texture_2d<f32>;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS)\nvar sheenRoughnessSamplerSampler: sampler;var sheenRoughnessSampler: texture_2d<f32>;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nvar reflectionSamplerSampler: sampler;var reflectionSampler: texture_cube<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar reflectionLowSamplerSampler: sampler;var reflectionLowSampler: texture_cube<f32>;var reflectionHighSamplerSampler: sampler;var reflectionHighSampler: texture_cube<f32>;\n#endif\n#ifdef USEIRRADIANCEMAP\nvar irradianceSamplerSampler: sampler;var irradianceSampler: texture_cube<f32>;\n#endif\n#else\nvar reflectionSamplerSampler: sampler;var reflectionSampler: texture_2d<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar reflectionLowSamplerSampler: sampler;var reflectionLowSampler: texture_2d<f32>;var reflectionHighSamplerSampler: sampler;var reflectionHighSampler: texture_2d<f32>;\n#endif\n#ifdef USEIRRADIANCEMAP\nvar irradianceSamplerSampler: sampler;var irradianceSampler: texture_2d<f32>;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nvar environmentBrdfSamplerSampler: sampler;var environmentBrdfSampler: texture_2d<f32>;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\nvar refractionSamplerSampler: sampler;var refractionSampler: texture_cube<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar refractionLowSamplerSampler: sampler;var refractionLowSampler: texture_cube<f32>;var refractionHighSamplerSampler: sampler;var refractionHighSampler: texture_cube<f32>;\n#endif\n#else\nvar refractionSamplerSampler: sampler;var refractionSampler: texture_2d<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar refractionLowSamplerSampler: sampler;var refractionLowSampler: texture_2d<f32>;var refractionHighSamplerSampler: sampler;var refractionHighSampler: texture_2d<f32>;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_SAMPLERNAME_,translucencyColor)\n#endif\n",e.IncludesShadersStoreWGSL.pbrFragmentSamplersDeclaration="#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nvar clearCoatRoughnessSamplerSampler: sampler;var clearCoatRoughnessSampler: texture_2d<f32>;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS)\nvar sheenRoughnessSamplerSampler: sampler;var sheenRoughnessSampler: texture_2d<f32>;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nvar reflectionSamplerSampler: sampler;var reflectionSampler: texture_cube<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar reflectionLowSamplerSampler: sampler;var reflectionLowSampler: texture_cube<f32>;var reflectionHighSamplerSampler: sampler;var reflectionHighSampler: texture_cube<f32>;\n#endif\n#ifdef USEIRRADIANCEMAP\nvar irradianceSamplerSampler: sampler;var irradianceSampler: texture_cube<f32>;\n#endif\n#else\nvar reflectionSamplerSampler: sampler;var reflectionSampler: texture_2d<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar reflectionLowSamplerSampler: sampler;var reflectionLowSampler: texture_2d<f32>;var reflectionHighSamplerSampler: sampler;var reflectionHighSampler: texture_2d<f32>;\n#endif\n#ifdef USEIRRADIANCEMAP\nvar irradianceSamplerSampler: sampler;var irradianceSampler: texture_2d<f32>;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vPositionUVW: vec3f;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vDirectionW: vec3f;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nvar environmentBrdfSamplerSampler: sampler;var environmentBrdfSampler: texture_2d<f32>;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\nvar refractionSamplerSampler: sampler;var refractionSampler: texture_cube<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar refractionLowSamplerSampler: sampler;var refractionLowSampler: texture_cube<f32>;var refractionHighSamplerSampler: sampler;var refractionHighSampler: texture_cube<f32>;\n#endif\n#else\nvar refractionSamplerSampler: sampler;var refractionSampler: texture_2d<f32>;\n#ifdef LODBASEDMICROSFURACE\n#else\nvar refractionLowSamplerSampler: sampler;var refractionLowSampler: texture_2d<f32>;var refractionHighSamplerSampler: sampler;var refractionHighSampler: texture_2d<f32>;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_SAMPLERNAME_,translucencyColor)\n#endif\n"}}),Io=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/subSurfaceScatteringFunctions.js"(){c(),"subSurfaceScatteringFunctions","fn testLightingForSSS(diffusionProfile: f32)->bool\n{return diffusionProfile<1.;}",e.IncludesShadersStoreWGSL.subSurfaceScatteringFunctions="fn testLightingForSSS(diffusionProfile: f32)->bool\n{return diffusionProfile<1.;}"}}),xo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/importanceSampling.js"(){c(),"importanceSampling","fn hemisphereCosSample(u: vec2f)->vec3f {var phi: f32=2.*PI*u.x;var cosTheta2: f32=1.-u.y;var cosTheta: f32=sqrt(cosTheta2);var sinTheta: f32=sqrt(1.-cosTheta2);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nfn hemisphereImportanceSampleDggx(u: vec2f,a: f32)->vec3f {var phi: f32=2.*PI*u.x;var cosTheta2: f32=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));var cosTheta: f32=sqrt(cosTheta2);var sinTheta: f32=sqrt(1.-cosTheta2);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nfn hemisphereImportanceSampleDCharlie(u: vec2f,a: f32)->vec3f { \nvar phi: f32=2.*PI*u.x;var sinTheta: f32=pow(u.y,a/(2.*a+1.));var cosTheta: f32=sqrt(1.-sinTheta*sinTheta);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}",e.IncludesShadersStoreWGSL.importanceSampling="fn hemisphereCosSample(u: vec2f)->vec3f {var phi: f32=2.*PI*u.x;var cosTheta2: f32=1.-u.y;var cosTheta: f32=sqrt(cosTheta2);var sinTheta: f32=sqrt(1.-cosTheta2);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nfn hemisphereImportanceSampleDggx(u: vec2f,a: f32)->vec3f {var phi: f32=2.*PI*u.x;var cosTheta2: f32=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));var cosTheta: f32=sqrt(cosTheta2);var sinTheta: f32=sqrt(1.-cosTheta2);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nfn hemisphereImportanceSampleDCharlie(u: vec2f,a: f32)->vec3f { \nvar phi: f32=2.*PI*u.x;var sinTheta: f32=pow(u.y,a/(2.*a+1.));var cosTheta: f32=sqrt(1.-sinTheta*sinTheta);return vec3f(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}"}}),bo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrHelperFunctions.js"(){c(),"pbrHelperFunctions","#define MINIMUMVARIANCE 0.0005\nfn convertRoughnessToAverageSlope(roughness: f32)->f32\n{return roughness*roughness+MINIMUMVARIANCE;}\nfn fresnelGrazingReflectance(reflectance0: f32)->f32 {var reflectance90: f32=saturate(reflectance0*25.0);return reflectance90;}\nfn getAARoughnessFactors(normalVector: vec3f)->vec2f {\n#ifdef SPECULARAA\nvar nDfdx: vec3f=dpdx(normalVector.xyz);var nDfdy: vec3f=dpdy(normalVector.xyz);var slopeSquare: f32=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));var geometricRoughnessFactor: f32=pow(saturate(slopeSquare),0.333);var geometricAlphaGFactor: f32=sqrt(slopeSquare);geometricAlphaGFactor*=0.75;return vec2f(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2f(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_LEGACY\nfn getAnisotropicRoughness(alphaG: f32,anisotropy: f32)->vec2f {var alphaT: f32=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);var alphaB: f32=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);return vec2f(alphaT,alphaB);}\nfn getAnisotropicBentNormals(T: vec3f,B: vec3f,N: vec3f,V: vec3f,anisotropy: f32,roughness: f32)->vec3f {var anisotropicFrameDirection: vec3f=select(T,B,anisotropy>=0.0);var anisotropicFrameTangent: vec3f=cross(normalize(anisotropicFrameDirection),V);var anisotropicFrameNormal: vec3f=cross(anisotropicFrameTangent,anisotropicFrameDirection);var anisotropicNormal: vec3f=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));return anisotropicNormal;}\n#else\nfn getAnisotropicRoughness(alphaG: f32,anisotropy: f32)->vec2f {var alphaT: f32=max(mix(alphaG,1.0,anisotropy*anisotropy),MINIMUMVARIANCE);var alphaB: f32=max(alphaG,MINIMUMVARIANCE);return vec2f(alphaT,alphaB);}\nfn getAnisotropicBentNormals(T: vec3f,B: vec3f,N: vec3f,V: vec3f,anisotropy: f32,roughness: f32)->vec3f {var bentNormal: vec3f=cross(B,V);bentNormal=normalize(cross(bentNormal,B));var sq=1.0-anisotropy*(1.0-roughness);var a: f32=sq*sq*sq*sq;bentNormal=normalize(mix(bentNormal,N,a));return bentNormal;}\n#endif\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nfn cocaLambertVec3(alpha: vec3f,distance: f32)->vec3f {return exp(-alpha*distance);}\nfn cocaLambert(NdotVRefract: f32,NdotLRefract: f32,alpha: vec3f,thickness: f32)->vec3f {return cocaLambertVec3(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));}\nfn computeColorAtDistanceInMedia(color: vec3f,distance: f32)->vec3f {return -log(color)/distance;}\nfn computeClearCoatAbsorption(NdotVRefract: f32,NdotLRefract: f32,clearCoatColor: vec3f,clearCoatThickness: f32,clearCoatIntensity: f32)->vec3f {var clearCoatAbsorption: vec3f=mix( vec3f(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);return clearCoatAbsorption;}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfn computeDefaultMicroSurface(microSurface: f32,reflectivityColor: vec3f)->f32\n{const kReflectivityNoAlphaWorkflow_SmoothnessMax: f32=0.95;var reflectivityLuminance: f32=getLuminance(reflectivityColor);var reflectivityLuma: f32=sqrt(reflectivityLuminance);var resultMicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;return resultMicroSurface;}\n#endif\n",e.IncludesShadersStoreWGSL.pbrHelperFunctions="#define MINIMUMVARIANCE 0.0005\nfn convertRoughnessToAverageSlope(roughness: f32)->f32\n{return roughness*roughness+MINIMUMVARIANCE;}\nfn fresnelGrazingReflectance(reflectance0: f32)->f32 {var reflectance90: f32=saturate(reflectance0*25.0);return reflectance90;}\nfn getAARoughnessFactors(normalVector: vec3f)->vec2f {\n#ifdef SPECULARAA\nvar nDfdx: vec3f=dpdx(normalVector.xyz);var nDfdy: vec3f=dpdy(normalVector.xyz);var slopeSquare: f32=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));var geometricRoughnessFactor: f32=pow(saturate(slopeSquare),0.333);var geometricAlphaGFactor: f32=sqrt(slopeSquare);geometricAlphaGFactor*=0.75;return vec2f(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2f(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_LEGACY\nfn getAnisotropicRoughness(alphaG: f32,anisotropy: f32)->vec2f {var alphaT: f32=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);var alphaB: f32=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);return vec2f(alphaT,alphaB);}\nfn getAnisotropicBentNormals(T: vec3f,B: vec3f,N: vec3f,V: vec3f,anisotropy: f32,roughness: f32)->vec3f {var anisotropicFrameDirection: vec3f=select(T,B,anisotropy>=0.0);var anisotropicFrameTangent: vec3f=cross(normalize(anisotropicFrameDirection),V);var anisotropicFrameNormal: vec3f=cross(anisotropicFrameTangent,anisotropicFrameDirection);var anisotropicNormal: vec3f=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));return anisotropicNormal;}\n#else\nfn getAnisotropicRoughness(alphaG: f32,anisotropy: f32)->vec2f {var alphaT: f32=max(mix(alphaG,1.0,anisotropy*anisotropy),MINIMUMVARIANCE);var alphaB: f32=max(alphaG,MINIMUMVARIANCE);return vec2f(alphaT,alphaB);}\nfn getAnisotropicBentNormals(T: vec3f,B: vec3f,N: vec3f,V: vec3f,anisotropy: f32,roughness: f32)->vec3f {var bentNormal: vec3f=cross(B,V);bentNormal=normalize(cross(bentNormal,B));var sq=1.0-anisotropy*(1.0-roughness);var a: f32=sq*sq*sq*sq;bentNormal=normalize(mix(bentNormal,N,a));return bentNormal;}\n#endif\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nfn cocaLambertVec3(alpha: vec3f,distance: f32)->vec3f {return exp(-alpha*distance);}\nfn cocaLambert(NdotVRefract: f32,NdotLRefract: f32,alpha: vec3f,thickness: f32)->vec3f {return cocaLambertVec3(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));}\nfn computeColorAtDistanceInMedia(color: vec3f,distance: f32)->vec3f {return -log(color)/distance;}\nfn computeClearCoatAbsorption(NdotVRefract: f32,NdotLRefract: f32,clearCoatColor: vec3f,clearCoatThickness: f32,clearCoatIntensity: f32)->vec3f {var clearCoatAbsorption: vec3f=mix( vec3f(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);return clearCoatAbsorption;}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfn computeDefaultMicroSurface(microSurface: f32,reflectivityColor: vec3f)->f32\n{const kReflectivityNoAlphaWorkflow_SmoothnessMax: f32=0.95;var reflectivityLuminance: f32=getLuminance(reflectivityColor);var reflectivityLuma: f32=sqrt(reflectivityLuminance);var resultMicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;return resultMicroSurface;}\n#endif\n"}}),Po=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrDirectLightingSetupFunctions.js"(){c(),"pbrDirectLightingSetupFunctions","struct preLightingInfo\n{lightOffset: vec3f,\nlightDistanceSquared: f32,\nlightDistance: f32,\nattenuation: f32,\nL: vec3f,\nH: vec3f,\nNdotV: f32,\nNdotLUnclamped: f32,\nNdotL: f32,\nVdotH: f32,\nroughness: f32,\n#ifdef IRIDESCENCE\niridescenceIntensity: f32\n#endif\n};fn computePointAndSpotPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f,posW: vec3f)->preLightingInfo {var result: preLightingInfo;result.lightOffset=lightData.xyz-posW;result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);result.lightDistance=sqrt(result.lightDistanceSquared);result.L=normalize(result.lightOffset);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\nfn computeDirectionalPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f)->preLightingInfo {var result: preLightingInfo;result.lightDistance=length(-lightData.xyz);result.L=normalize(-lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\nfn computeHemisphericPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f)->preLightingInfo {var result: preLightingInfo;result.NdotL=dot(N,lightData.xyz)*0.5+0.5;result.NdotL=saturateEps(result.NdotL);result.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;}",e.IncludesShadersStoreWGSL.pbrDirectLightingSetupFunctions="struct preLightingInfo\n{lightOffset: vec3f,\nlightDistanceSquared: f32,\nlightDistance: f32,\nattenuation: f32,\nL: vec3f,\nH: vec3f,\nNdotV: f32,\nNdotLUnclamped: f32,\nNdotL: f32,\nVdotH: f32,\nroughness: f32,\n#ifdef IRIDESCENCE\niridescenceIntensity: f32\n#endif\n};fn computePointAndSpotPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f,posW: vec3f)->preLightingInfo {var result: preLightingInfo;result.lightOffset=lightData.xyz-posW;result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);result.lightDistance=sqrt(result.lightDistanceSquared);result.L=normalize(result.lightOffset);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\nfn computeDirectionalPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f)->preLightingInfo {var result: preLightingInfo;result.lightDistance=length(-lightData.xyz);result.L=normalize(-lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\nfn computeHemisphericPreLightingInfo(lightData: vec4f,V: vec3f,N: vec3f)->preLightingInfo {var result: preLightingInfo;result.NdotL=dot(N,lightData.xyz)*0.5+0.5;result.NdotL=saturateEps(result.NdotL);result.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;}"}}),wo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrDirectLightingFalloffFunctions.js"(){c(),"pbrDirectLightingFalloffFunctions","fn computeDistanceLightFalloff_Standard(lightOffset: vec3f,range: f32)->f32\n{return max(0.,1.0-length(lightOffset)/range);}\nfn computeDistanceLightFalloff_Physical(lightDistanceSquared: f32)->f32\n{return 1.0/maxEps(lightDistanceSquared);}\nfn computeDistanceLightFalloff_GLTF(lightDistanceSquared: f32,inverseSquaredRange: f32)->f32\n{var lightDistanceFalloff: f32=1.0/maxEps(lightDistanceSquared);var factor: f32=lightDistanceSquared*inverseSquaredRange;var attenuation: f32=saturate(1.0-factor*factor);attenuation*=attenuation;lightDistanceFalloff*=attenuation;return lightDistanceFalloff;}\nfn computeDistanceLightFalloff(lightOffset: vec3f,lightDistanceSquared: f32,range: f32,inverseSquaredRange: f32)->f32\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfn computeDirectionalLightFalloff_Standard(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32,exponent: f32)->f32\n{var falloff: f32=0.0;var cosAngle: f32=maxEps(dot(-lightDirection,directionToLightCenterW));if (cosAngle>=cosHalfAngle)\n{falloff=max(0.,pow(cosAngle,exponent));}\nreturn falloff;}\nfn computeDirectionalLightFalloff_Physical(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32)->f32\n{const kMinusLog2ConeAngleIntensityRatio: f32=6.64385618977; \nvar concentrationKappa: f32=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);var lightDirectionSpreadSG: vec4f= vec4f(-lightDirection*concentrationKappa,-concentrationKappa);var falloff: f32=exp2(dot( vec4f(directionToLightCenterW,1.0),lightDirectionSpreadSG));return falloff;}\nfn computeDirectionalLightFalloff_GLTF(lightDirection: vec3f,directionToLightCenterW: vec3f,lightAngleScale: f32,lightAngleOffset: f32)->f32\n{var cd: f32=dot(-lightDirection,directionToLightCenterW);var falloff: f32=saturate(cd*lightAngleScale+lightAngleOffset);falloff*=falloff;return falloff;}\nfn computeDirectionalLightFalloff(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32,exponent: f32,lightAngleScale: f32,lightAngleOffset: f32)->f32\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}",e.IncludesShadersStoreWGSL.pbrDirectLightingFalloffFunctions="fn computeDistanceLightFalloff_Standard(lightOffset: vec3f,range: f32)->f32\n{return max(0.,1.0-length(lightOffset)/range);}\nfn computeDistanceLightFalloff_Physical(lightDistanceSquared: f32)->f32\n{return 1.0/maxEps(lightDistanceSquared);}\nfn computeDistanceLightFalloff_GLTF(lightDistanceSquared: f32,inverseSquaredRange: f32)->f32\n{var lightDistanceFalloff: f32=1.0/maxEps(lightDistanceSquared);var factor: f32=lightDistanceSquared*inverseSquaredRange;var attenuation: f32=saturate(1.0-factor*factor);attenuation*=attenuation;lightDistanceFalloff*=attenuation;return lightDistanceFalloff;}\nfn computeDistanceLightFalloff(lightOffset: vec3f,lightDistanceSquared: f32,range: f32,inverseSquaredRange: f32)->f32\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfn computeDirectionalLightFalloff_Standard(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32,exponent: f32)->f32\n{var falloff: f32=0.0;var cosAngle: f32=maxEps(dot(-lightDirection,directionToLightCenterW));if (cosAngle>=cosHalfAngle)\n{falloff=max(0.,pow(cosAngle,exponent));}\nreturn falloff;}\nfn computeDirectionalLightFalloff_Physical(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32)->f32\n{const kMinusLog2ConeAngleIntensityRatio: f32=6.64385618977; \nvar concentrationKappa: f32=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);var lightDirectionSpreadSG: vec4f= vec4f(-lightDirection*concentrationKappa,-concentrationKappa);var falloff: f32=exp2(dot( vec4f(directionToLightCenterW,1.0),lightDirectionSpreadSG));return falloff;}\nfn computeDirectionalLightFalloff_GLTF(lightDirection: vec3f,directionToLightCenterW: vec3f,lightAngleScale: f32,lightAngleOffset: f32)->f32\n{var cd: f32=dot(-lightDirection,directionToLightCenterW);var falloff: f32=saturate(cd*lightAngleScale+lightAngleOffset);falloff*=falloff;return falloff;}\nfn computeDirectionalLightFalloff(lightDirection: vec3f,directionToLightCenterW: vec3f,cosHalfAngle: f32,exponent: f32,lightAngleScale: f32,lightAngleOffset: f32)->f32\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}"}}),Oo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBRDFFunctions.js"(){c(),"pbrBRDFFunctions","#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nfn getEnergyConservationFactor(specularEnvironmentR0: vec3f,environmentBrdf: vec3f)->vec3f {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}\n#endif\n#ifdef ENVIRONMENTBRDF\nfn getBRDFLookup(NdotV: f32,perceptualRoughness: f32)->vec3f {var UV: vec2f= vec2f(NdotV,perceptualRoughness);var brdfLookup: vec4f= textureSample(environmentBrdfSampler,environmentBrdfSamplerSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup=vec4f(fromRGBD(brdfLookup.rgba),brdfLookup.a);\n#endif\nreturn brdfLookup.rgb;}\nfn getReflectanceFromBRDFWithEnvLookup(specularEnvironmentR0: vec3f,specularEnvironmentR90: vec3f,environmentBrdf: vec3f)->vec3f {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar reflectance: vec3f=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvar reflectance: vec3f=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;}\nfn getReflectanceFromBRDFLookup(specularEnvironmentR0: vec3f,environmentBrdf: vec3f)->vec3f {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar reflectance: vec3f=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvar reflectance: vec3f=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfn getBRDFLookupCharlieSheen(NdotV: f32,perceptualRoughness: f32)->f32\n{var c: f32=1.0-NdotV;var c3: f32=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nfn getReflectanceFromAnalyticalBRDFLookup_Jones(VdotN: f32,reflectance0: vec3f,reflectance90: vec3f,smoothness: f32)->vec3f\n{var weight: f32=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nfn getSheenReflectanceFromBRDFLookup(reflectance0: vec3f,environmentBrdf: vec3f)->vec3f {var sheenEnvironmentReflectance: vec3f=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}\n#endif\nfn fresnelSchlickGGXVec3(VdotH: f32,reflectance0: vec3f,reflectance90: vec3f)->vec3f\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\nfn fresnelSchlickGGX(VdotH: f32,reflectance0: f32,reflectance90: f32)->f32\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\n#ifdef CLEARCOAT\nfn getR0RemappedForClearCoat(f0: vec3f)->vec3f {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturateVec3(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturateVec3(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvar s: vec3f=sqrt(f0);var t: vec3f=(uniforms.vClearCoatRefractionParams.z+uniforms.vClearCoatRefractionParams.w*s)/(uniforms.vClearCoatRefractionParams.w+uniforms.vClearCoatRefractionParams.z*s);return squareVec3(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst XYZ_TO_REC709: mat3x3f= mat3x3f(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);fn getIORTfromAirToSurfaceR0(f0: vec3f)->vec3f {var sqrtF0: vec3f=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}\nfn getR0fromIORsVec3(iorT: vec3f,iorI: f32)->vec3f {return squareVec3((iorT- vec3f(iorI))/(iorT+ vec3f(iorI)));}\nfn getR0fromIORs(iorT: f32,iorI: f32)->f32 {return square((iorT-iorI)/(iorT+iorI));}\nfn evalSensitivity(opd: f32,shift: vec3f)->vec3f {var phase: f32=2.0*PI*opd*1.0e-9;const val: vec3f= vec3f(5.4856e-13,4.4201e-13,5.2481e-13);const pos: vec3f= vec3f(1.6810e+06,1.7953e+06,2.2084e+06);const vr: vec3f= vec3f(4.3278e+09,9.3046e+09,6.6121e+09);var xyz: vec3f=val*sqrt(2.0*PI*vr)*cos(pos*phase+shift)*exp(-square(phase)*vr);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;var srgb: vec3f=XYZ_TO_REC709*xyz;return srgb;}\nfn evalIridescence(outsideIOR: f32,eta2: f32,cosTheta1: f32,thinFilmThickness: f32,baseF0: vec3f)->vec3f {var I: vec3f= vec3f(1.0);var iridescenceIOR: f32=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));var sinTheta2Sq: f32=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));var cosTheta2Sq: f32=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}\nvar cosTheta2: f32=sqrt(cosTheta2Sq);var R0: f32=getR0fromIORs(iridescenceIOR,outsideIOR);var R12: f32=fresnelSchlickGGX(cosTheta1,R0,1.);var R21: f32=R12;var T121: f32=1.0-R12;var phi12: f32=0.0;if (iridescenceIOR<outsideIOR) {phi12=PI;}\nvar phi21: f32=PI-phi12;var baseIOR: vec3f=getIORTfromAirToSurfaceR0(clamp(baseF0,vec3f(0.0),vec3f(0.9999))); \nvar R1: vec3f=getR0fromIORsVec3(baseIOR,iridescenceIOR);var R23: vec3f=fresnelSchlickGGXVec3(cosTheta2,R1, vec3f(1.));var phi23: vec3f= vec3f(0.0);if (baseIOR[0]<iridescenceIOR) {phi23[0]=PI;}\nif (baseIOR[1]<iridescenceIOR) {phi23[1]=PI;}\nif (baseIOR[2]<iridescenceIOR) {phi23[2]=PI;}\nvar opd: f32=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;var phi: vec3f= vec3f(phi21)+phi23;var R123: vec3f=clamp(R12*R23,vec3f(1e-5),vec3f(0.9999));var r123: vec3f=sqrt(R123);var Rs: vec3f=(T121*T121)*R23/( vec3f(1.0)-R123);var C0: vec3f=R12+Rs;I=C0;var Cm: vec3f=Rs-T121;for (var m: i32=1; m<=2; m++)\n{Cm*=r123;var Sm: vec3f=2.0*evalSensitivity( f32(m)*opd, f32(m)*phi);I+=Cm*Sm;}\nreturn max(I, vec3f(0.0));}\n#endif\nfn normalDistributionFunction_TrowbridgeReitzGGX(NdotH: f32,alphaG: f32)->f32\n{var a2: f32=alphaG*alphaG;var d: f32=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}\n#ifdef SHEEN\nfn normalDistributionFunction_CharlieSheen(NdotH: f32,alphaG: f32)->f32\n{var invR: f32=1./alphaG;var cos2h: f32=NdotH*NdotH;var sin2h: f32=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}\n#endif\n#ifdef ANISOTROPIC\nfn normalDistributionFunction_BurleyGGX_Anisotropic(NdotH: f32,TdotH: f32,BdotH: f32,alphaTB: vec2f)->f32 {var a2: f32=alphaTB.x*alphaTB.y;var v: vec3f= vec3f(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);var v2: f32=dot(v,v);var w2: f32=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfn smithVisibility_GGXCorrelated(NdotL: f32,NdotV: f32,alphaG: f32)->f32 {\n#ifdef MOBILE\nvar GGXV: f32=NdotL*(NdotV*(1.0-alphaG)+alphaG);var GGXL: f32=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);\n#else\nvar a2: f32=alphaG*alphaG;var GGXV: f32=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);var GGXL: f32=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfn smithVisibilityG1_TrowbridgeReitzGGXFast(dot: f32,alphaG: f32)->f32\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nvar alphaSquared: f32=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfn smithVisibility_TrowbridgeReitzGGXFast(NdotL: f32,NdotV: f32,alphaG: f32)->f32\n{var visibility: f32=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}\n#endif\n#ifdef ANISOTROPIC\nfn smithVisibility_GGXCorrelated_Anisotropic(NdotL: f32,NdotV: f32,TdotV: f32,BdotV: f32,TdotL: f32,BdotL: f32,alphaTB: vec2f)->f32 {var lambdaV: f32=NdotL*length( vec3f(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));var lambdaL: f32=NdotV*length( vec3f(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));var v: f32=0.5/(lambdaV+lambdaL);return v;}\n#endif\n#ifdef CLEARCOAT\nfn visibility_Kelemen(VdotH: f32)->f32 {return 0.25/(VdotH*VdotH); }\n#endif\n#ifdef SHEEN\nfn visibility_Ashikhmin(NdotL: f32,NdotV: f32)->f32\n{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfn l(x: f32,alphaG: f32)->f32\n{var oneMinusAlphaSq: f32=(1.0-alphaG)*(1.0-alphaG);var a: f32=mix(21.5473,25.3245,oneMinusAlphaSq);var b: f32=mix(3.82987,3.32435,oneMinusAlphaSq);var c: f32=mix(0.19823,0.16801,oneMinusAlphaSq);var d: f32=mix(-1.97760,-1.27393,oneMinusAlphaSq);var e: f32=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}\nfn lambdaSheen(cosTheta: f32,alphaG: f32)->f32\n{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}\nfn visibility_CharlieSheen(NdotL: f32,NdotV: f32,alphaG: f32)->f32\n{var G: f32=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}\n#endif\n*/\n#endif\nfn diffuseBRDF_Burley(NdotL: f32,NdotV: f32,VdotH: f32,roughness: f32)->f32 {var diffuseFresnelNV: f32=pow5(saturateEps(1.0-NdotL));var diffuseFresnelNL: f32=pow5(saturateEps(1.0-NdotV));var diffuseFresnel90: f32=0.5+2.0*VdotH*VdotH*roughness;var fresnel: f32 =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}\n#ifdef SS_TRANSLUCENCY\nfn transmittanceBRDF_Burley(tintColor: vec3f,diffusionDistance: vec3f,thickness: f32)->vec3f {var S: vec3f=1./maxEpsVec3(diffusionDistance);var temp: vec3f=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}\nfn computeWrappedDiffuseNdotL(NdotL: f32,w: f32)->f32 {var t: f32=1.0+w;var invt2: f32=1.0/(t*t);return saturate((NdotL+w)*invt2);}\n#endif\n",e.IncludesShadersStoreWGSL.pbrBRDFFunctions="#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nfn getEnergyConservationFactor(specularEnvironmentR0: vec3f,environmentBrdf: vec3f)->vec3f {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}\n#endif\n#ifdef ENVIRONMENTBRDF\nfn getBRDFLookup(NdotV: f32,perceptualRoughness: f32)->vec3f {var UV: vec2f= vec2f(NdotV,perceptualRoughness);var brdfLookup: vec4f= textureSample(environmentBrdfSampler,environmentBrdfSamplerSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup=vec4f(fromRGBD(brdfLookup.rgba),brdfLookup.a);\n#endif\nreturn brdfLookup.rgb;}\nfn getReflectanceFromBRDFWithEnvLookup(specularEnvironmentR0: vec3f,specularEnvironmentR90: vec3f,environmentBrdf: vec3f)->vec3f {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar reflectance: vec3f=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvar reflectance: vec3f=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;}\nfn getReflectanceFromBRDFLookup(specularEnvironmentR0: vec3f,environmentBrdf: vec3f)->vec3f {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar reflectance: vec3f=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvar reflectance: vec3f=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfn getBRDFLookupCharlieSheen(NdotV: f32,perceptualRoughness: f32)->f32\n{var c: f32=1.0-NdotV;var c3: f32=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nfn getReflectanceFromAnalyticalBRDFLookup_Jones(VdotN: f32,reflectance0: vec3f,reflectance90: vec3f,smoothness: f32)->vec3f\n{var weight: f32=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nfn getSheenReflectanceFromBRDFLookup(reflectance0: vec3f,environmentBrdf: vec3f)->vec3f {var sheenEnvironmentReflectance: vec3f=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}\n#endif\nfn fresnelSchlickGGXVec3(VdotH: f32,reflectance0: vec3f,reflectance90: vec3f)->vec3f\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\nfn fresnelSchlickGGX(VdotH: f32,reflectance0: f32,reflectance90: f32)->f32\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\n#ifdef CLEARCOAT\nfn getR0RemappedForClearCoat(f0: vec3f)->vec3f {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturateVec3(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturateVec3(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvar s: vec3f=sqrt(f0);var t: vec3f=(uniforms.vClearCoatRefractionParams.z+uniforms.vClearCoatRefractionParams.w*s)/(uniforms.vClearCoatRefractionParams.w+uniforms.vClearCoatRefractionParams.z*s);return squareVec3(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst XYZ_TO_REC709: mat3x3f= mat3x3f(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);fn getIORTfromAirToSurfaceR0(f0: vec3f)->vec3f {var sqrtF0: vec3f=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}\nfn getR0fromIORsVec3(iorT: vec3f,iorI: f32)->vec3f {return squareVec3((iorT- vec3f(iorI))/(iorT+ vec3f(iorI)));}\nfn getR0fromIORs(iorT: f32,iorI: f32)->f32 {return square((iorT-iorI)/(iorT+iorI));}\nfn evalSensitivity(opd: f32,shift: vec3f)->vec3f {var phase: f32=2.0*PI*opd*1.0e-9;const val: vec3f= vec3f(5.4856e-13,4.4201e-13,5.2481e-13);const pos: vec3f= vec3f(1.6810e+06,1.7953e+06,2.2084e+06);const vr: vec3f= vec3f(4.3278e+09,9.3046e+09,6.6121e+09);var xyz: vec3f=val*sqrt(2.0*PI*vr)*cos(pos*phase+shift)*exp(-square(phase)*vr);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;var srgb: vec3f=XYZ_TO_REC709*xyz;return srgb;}\nfn evalIridescence(outsideIOR: f32,eta2: f32,cosTheta1: f32,thinFilmThickness: f32,baseF0: vec3f)->vec3f {var I: vec3f= vec3f(1.0);var iridescenceIOR: f32=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));var sinTheta2Sq: f32=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));var cosTheta2Sq: f32=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}\nvar cosTheta2: f32=sqrt(cosTheta2Sq);var R0: f32=getR0fromIORs(iridescenceIOR,outsideIOR);var R12: f32=fresnelSchlickGGX(cosTheta1,R0,1.);var R21: f32=R12;var T121: f32=1.0-R12;var phi12: f32=0.0;if (iridescenceIOR<outsideIOR) {phi12=PI;}\nvar phi21: f32=PI-phi12;var baseIOR: vec3f=getIORTfromAirToSurfaceR0(clamp(baseF0,vec3f(0.0),vec3f(0.9999))); \nvar R1: vec3f=getR0fromIORsVec3(baseIOR,iridescenceIOR);var R23: vec3f=fresnelSchlickGGXVec3(cosTheta2,R1, vec3f(1.));var phi23: vec3f= vec3f(0.0);if (baseIOR[0]<iridescenceIOR) {phi23[0]=PI;}\nif (baseIOR[1]<iridescenceIOR) {phi23[1]=PI;}\nif (baseIOR[2]<iridescenceIOR) {phi23[2]=PI;}\nvar opd: f32=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;var phi: vec3f= vec3f(phi21)+phi23;var R123: vec3f=clamp(R12*R23,vec3f(1e-5),vec3f(0.9999));var r123: vec3f=sqrt(R123);var Rs: vec3f=(T121*T121)*R23/( vec3f(1.0)-R123);var C0: vec3f=R12+Rs;I=C0;var Cm: vec3f=Rs-T121;for (var m: i32=1; m<=2; m++)\n{Cm*=r123;var Sm: vec3f=2.0*evalSensitivity( f32(m)*opd, f32(m)*phi);I+=Cm*Sm;}\nreturn max(I, vec3f(0.0));}\n#endif\nfn normalDistributionFunction_TrowbridgeReitzGGX(NdotH: f32,alphaG: f32)->f32\n{var a2: f32=alphaG*alphaG;var d: f32=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}\n#ifdef SHEEN\nfn normalDistributionFunction_CharlieSheen(NdotH: f32,alphaG: f32)->f32\n{var invR: f32=1./alphaG;var cos2h: f32=NdotH*NdotH;var sin2h: f32=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}\n#endif\n#ifdef ANISOTROPIC\nfn normalDistributionFunction_BurleyGGX_Anisotropic(NdotH: f32,TdotH: f32,BdotH: f32,alphaTB: vec2f)->f32 {var a2: f32=alphaTB.x*alphaTB.y;var v: vec3f= vec3f(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);var v2: f32=dot(v,v);var w2: f32=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfn smithVisibility_GGXCorrelated(NdotL: f32,NdotV: f32,alphaG: f32)->f32 {\n#ifdef MOBILE\nvar GGXV: f32=NdotL*(NdotV*(1.0-alphaG)+alphaG);var GGXL: f32=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);\n#else\nvar a2: f32=alphaG*alphaG;var GGXV: f32=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);var GGXL: f32=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfn smithVisibilityG1_TrowbridgeReitzGGXFast(dot: f32,alphaG: f32)->f32\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nvar alphaSquared: f32=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfn smithVisibility_TrowbridgeReitzGGXFast(NdotL: f32,NdotV: f32,alphaG: f32)->f32\n{var visibility: f32=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}\n#endif\n#ifdef ANISOTROPIC\nfn smithVisibility_GGXCorrelated_Anisotropic(NdotL: f32,NdotV: f32,TdotV: f32,BdotV: f32,TdotL: f32,BdotL: f32,alphaTB: vec2f)->f32 {var lambdaV: f32=NdotL*length( vec3f(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));var lambdaL: f32=NdotV*length( vec3f(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));var v: f32=0.5/(lambdaV+lambdaL);return v;}\n#endif\n#ifdef CLEARCOAT\nfn visibility_Kelemen(VdotH: f32)->f32 {return 0.25/(VdotH*VdotH); }\n#endif\n#ifdef SHEEN\nfn visibility_Ashikhmin(NdotL: f32,NdotV: f32)->f32\n{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfn l(x: f32,alphaG: f32)->f32\n{var oneMinusAlphaSq: f32=(1.0-alphaG)*(1.0-alphaG);var a: f32=mix(21.5473,25.3245,oneMinusAlphaSq);var b: f32=mix(3.82987,3.32435,oneMinusAlphaSq);var c: f32=mix(0.19823,0.16801,oneMinusAlphaSq);var d: f32=mix(-1.97760,-1.27393,oneMinusAlphaSq);var e: f32=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}\nfn lambdaSheen(cosTheta: f32,alphaG: f32)->f32\n{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}\nfn visibility_CharlieSheen(NdotL: f32,NdotV: f32,alphaG: f32)->f32\n{var G: f32=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}\n#endif\n*/\n#endif\nfn diffuseBRDF_Burley(NdotL: f32,NdotV: f32,VdotH: f32,roughness: f32)->f32 {var diffuseFresnelNV: f32=pow5(saturateEps(1.0-NdotL));var diffuseFresnelNL: f32=pow5(saturateEps(1.0-NdotV));var diffuseFresnel90: f32=0.5+2.0*VdotH*VdotH*roughness;var fresnel: f32 =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}\n#ifdef SS_TRANSLUCENCY\nfn transmittanceBRDF_Burley(tintColor: vec3f,diffusionDistance: vec3f,thickness: f32)->vec3f {var S: vec3f=1./maxEpsVec3(diffusionDistance);var temp: vec3f=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}\nfn computeWrappedDiffuseNdotL(NdotL: f32,w: f32)->f32 {var t: f32=1.0+w;var invt2: f32=1.0/(t*t);return saturate((NdotL+w)*invt2);}\n#endif\n"}}),Do=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/hdrFilteringFunctions.js"(){c(),"hdrFilteringFunctions","#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\nfn radicalInverse_VdC(value: u32)->f32 \n{var bits=(value<<16u) | (value>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return f32(bits)*2.3283064365386963e-10; }\nfn hammersley(i: u32,N: u32)->vec2f\n{return vec2f( f32(i)/ f32(N),radicalInverse_VdC(i));}\nfn log4(x: f32)->f32 {return log2(x)/2.;}\nconst NUM_SAMPLES_FLOAT: f32= f32(NUM_SAMPLES);const NUM_SAMPLES_FLOAT_INVERSED: f32=1./NUM_SAMPLES_FLOAT;const K: f32=4.;fn irradiance(inputTexture: texture_cube<f32>,inputSampler: sampler,inputN: vec3f,filteringInfo: vec2f)->vec3f\n{var n: vec3f=normalize(inputN);var result: vec3f= vec3f(0.0);var tangent: vec3f=select(vec3f(1.,0.,0.),vec3f(0.,0.,1.),abs(n.z)<0.999);tangent=normalize(cross(tangent,n));var bitangent: vec3f=cross(n,tangent);var tbn: mat3x3f= mat3x3f(tangent,bitangent,n);var maxLevel: f32=filteringInfo.y;var dim0: f32=filteringInfo.x;var omegaP: f32=(4.*PI)/(6.*dim0*dim0);for(var i: u32=0u; i<NUM_SAMPLES; i++)\n{var Xi: vec2f=hammersley(i,NUM_SAMPLES);var Ls: vec3f=hemisphereCosSample(Xi);Ls=normalize(Ls);var Ns: vec3f= vec3f(0.,0.,1.);var NoL: f32=dot(Ns,Ls);if (NoL>0.) {var pdf_inversed: f32=PI/NoL;var omegaS: f32=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;var l: f32=log4(omegaS)-log4(omegaP)+log4(K);var mipLevel: f32=clamp(l,0.0,maxLevel);var c: vec3f=textureSampleLevel(inputTexture,inputSampler,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpaceVec3(c);\n#endif\nresult+=c;}}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}\nfn radiance(alphaG: f32,inputTexture: texture_cube<f32>,inputSampler: sampler,inputN: vec3f,filteringInfo: vec2f)->vec3f\n{var n: vec3f=normalize(inputN);var c: vec3f=textureSample(inputTexture,inputSampler,n).rgb; \nif (alphaG==0.) {\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;} else {var result: vec3f= vec3f(0.);var tangent: vec3f=select(vec3f(1.,0.,0.),vec3f(0.,0.,1.),abs(n.z)<0.999);tangent=normalize(cross(tangent,n));var bitangent: vec3f=cross(n,tangent);var tbn: mat3x3f= mat3x3f(tangent,bitangent,n);var maxLevel: f32=filteringInfo.y;var dim0: f32=filteringInfo.x;var omegaP: f32=(4.*PI)/(6.*dim0*dim0);var weight: f32=0.;for(var i: u32=0u; i<NUM_SAMPLES; i++)\n{var Xi: vec2f=hammersley(i,NUM_SAMPLES);var H: vec3f=hemisphereImportanceSampleDggx(Xi,alphaG);var NoV: f32=1.;var NoH: f32=H.z;var NoH2: f32=H.z*H.z;var NoL: f32=2.*NoH2-1.;var L: vec3f= vec3f(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {var pdf_inversed: f32=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);var omegaS: f32=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;var l: f32=log4(omegaS)-log4(omegaP)+log4(K);var mipLevel: f32=clamp( f32(l),0.0,maxLevel);weight+=NoL;var c: vec3f=textureSampleLevel(inputTexture,inputSampler,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;}}\nresult=result/weight;return result;}}\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.hdrFilteringFunctions="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\nfn radicalInverse_VdC(value: u32)->f32 \n{var bits=(value<<16u) | (value>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return f32(bits)*2.3283064365386963e-10; }\nfn hammersley(i: u32,N: u32)->vec2f\n{return vec2f( f32(i)/ f32(N),radicalInverse_VdC(i));}\nfn log4(x: f32)->f32 {return log2(x)/2.;}\nconst NUM_SAMPLES_FLOAT: f32= f32(NUM_SAMPLES);const NUM_SAMPLES_FLOAT_INVERSED: f32=1./NUM_SAMPLES_FLOAT;const K: f32=4.;fn irradiance(inputTexture: texture_cube<f32>,inputSampler: sampler,inputN: vec3f,filteringInfo: vec2f)->vec3f\n{var n: vec3f=normalize(inputN);var result: vec3f= vec3f(0.0);var tangent: vec3f=select(vec3f(1.,0.,0.),vec3f(0.,0.,1.),abs(n.z)<0.999);tangent=normalize(cross(tangent,n));var bitangent: vec3f=cross(n,tangent);var tbn: mat3x3f= mat3x3f(tangent,bitangent,n);var maxLevel: f32=filteringInfo.y;var dim0: f32=filteringInfo.x;var omegaP: f32=(4.*PI)/(6.*dim0*dim0);for(var i: u32=0u; i<NUM_SAMPLES; i++)\n{var Xi: vec2f=hammersley(i,NUM_SAMPLES);var Ls: vec3f=hemisphereCosSample(Xi);Ls=normalize(Ls);var Ns: vec3f= vec3f(0.,0.,1.);var NoL: f32=dot(Ns,Ls);if (NoL>0.) {var pdf_inversed: f32=PI/NoL;var omegaS: f32=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;var l: f32=log4(omegaS)-log4(omegaP)+log4(K);var mipLevel: f32=clamp(l,0.0,maxLevel);var c: vec3f=textureSampleLevel(inputTexture,inputSampler,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpaceVec3(c);\n#endif\nresult+=c;}}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}\nfn radiance(alphaG: f32,inputTexture: texture_cube<f32>,inputSampler: sampler,inputN: vec3f,filteringInfo: vec2f)->vec3f\n{var n: vec3f=normalize(inputN);var c: vec3f=textureSample(inputTexture,inputSampler,n).rgb; \nif (alphaG==0.) {\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;} else {var result: vec3f= vec3f(0.);var tangent: vec3f=select(vec3f(1.,0.,0.),vec3f(0.,0.,1.),abs(n.z)<0.999);tangent=normalize(cross(tangent,n));var bitangent: vec3f=cross(n,tangent);var tbn: mat3x3f= mat3x3f(tangent,bitangent,n);var maxLevel: f32=filteringInfo.y;var dim0: f32=filteringInfo.x;var omegaP: f32=(4.*PI)/(6.*dim0*dim0);var weight: f32=0.;for(var i: u32=0u; i<NUM_SAMPLES; i++)\n{var Xi: vec2f=hammersley(i,NUM_SAMPLES);var H: vec3f=hemisphereImportanceSampleDggx(Xi,alphaG);var NoV: f32=1.;var NoH: f32=H.z;var NoH2: f32=H.z*H.z;var NoL: f32=2.*NoH2-1.;var L: vec3f= vec3f(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {var pdf_inversed: f32=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);var omegaS: f32=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;var l: f32=log4(omegaS)-log4(omegaP)+log4(K);var mipLevel: f32=clamp( f32(l),0.0,maxLevel);weight+=NoL;var c: vec3f=textureSampleLevel(inputTexture,inputSampler,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;}}\nresult=result/weight;return result;}}\n#endif\n#endif\n"}}),Lo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrDirectLightingFunctions.js"(){c(),"pbrDirectLightingFunctions","#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{diffuse: vec3f,\n#ifdef SPECULARTERM\nspecular: vec3f,\n#endif\n#ifdef CLEARCOAT\nclearCoat: vec4f,\n#endif\n#ifdef SHEEN\nsheen: vec3f\n#endif\n};fn adjustRoughnessFromLightProperties(roughness: f32,lightRadius: f32,lightDistance: f32)->f32 {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nvar lightRoughness: f32=lightRadius/lightDistance;var totalRoughness: f32=saturate(lightRoughness+roughness);return totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfn computeHemisphericDiffuseLighting(info: preLightingInfo,lightColor: vec3f,groundColor: vec3f)->vec3f {return mix(groundColor,lightColor,info.NdotL);}\nfn computeDiffuseLighting(info: preLightingInfo,lightColor: vec3f)->vec3f {var diffuseTerm: f32=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*info.attenuation*info.NdotL*lightColor;}\nfn computeProjectionTextureDiffuseLighting(projectionLightTexture: texture_2d<f32>,projectionLightSampler: sampler,textureProjectionMatrix: mat4x4f,posW: vec3f)->vec3f{var strq: vec4f=textureProjectionMatrix* vec4f(posW,1.0);strq/=strq.w;var textureColor: vec3f=textureSample(projectionLightTexture,projectionLightSampler,strq.xy).rgb;return toLinearSpaceVec3(textureColor);}\n#ifdef SS_TRANSLUCENCY\nfn computeDiffuseAndTransmittedLighting(info: preLightingInfo,lightColor: vec3f,transmittance: vec3f)->vec3f {var NdotL: f32=absEps(info.NdotLUnclamped);var wrapNdotL: f32=computeWrappedDiffuseNdotL(NdotL,0.02);var trAdapt: f32=step(0.,info.NdotLUnclamped);var transmittanceNdotL: vec3f=mix(transmittance*wrapNdotL, vec3f(wrapNdotL),trAdapt);var diffuseTerm: f32=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;}\n#endif\n#ifdef SPECULARTERM\nfn computeSpecularLighting(info: preLightingInfo,N: vec3f,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var roughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var fresnel: vec3f=fresnelSchlickGGXVec3(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nvar distribution: f32=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar smithVisibility: f32=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nvar smithVisibility: f32=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvar specTerm: vec3f=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef ANISOTROPIC\nfn computeAnisotropicSpecularLighting(info: preLightingInfo,V: vec3f,N: vec3f,T: vec3f,B: vec3f,anisotropy: f32,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var TdotH: f32=dot(T,info.H);var BdotH: f32=dot(B,info.H);var TdotV: f32=dot(T,V);var BdotV: f32=dot(B,V);var TdotL: f32=dot(T,info.L);var BdotL: f32=dot(B,info.L);var alphaG: f32=convertRoughnessToAverageSlope(info.roughness);var alphaTB: vec2f=getAnisotropicRoughness(alphaG,anisotropy);alphaTB=max(alphaTB,vec2f(geometricRoughnessFactor*geometricRoughnessFactor));var fresnel: vec3f=fresnelSchlickGGXVec3(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nvar distribution: f32=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);var smithVisibility: f32=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);var specTerm: vec3f=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef CLEARCOAT\nfn computeClearCoatLighting(info: preLightingInfo,Ncc: vec3f,geometricRoughnessFactor: f32,clearCoatIntensity: f32,lightColor: vec3f)->vec4f {var NccdotL: f32=saturateEps(dot(Ncc,info.L));var NccdotH: f32=saturateEps(dot(Ncc,info.H));var clearCoatRoughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(clearCoatRoughness);var fresnel: f32=fresnelSchlickGGX(info.VdotH,uniforms.vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnel*=clearCoatIntensity;var distribution: f32=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);var kelemenVisibility: f32=visibility_Kelemen(info.VdotH);var clearCoatTerm: f32=fresnel*distribution*kelemenVisibility;return vec4f(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);}\nfn computeClearCoatLightingAbsorption(NdotVRefract: f32,L: vec3f,Ncc: vec3f,clearCoatColor: vec3f,clearCoatThickness: f32,clearCoatIntensity: f32)->vec3f {var LRefract: vec3f=-refract(L,Ncc,uniforms.vClearCoatRefractionParams.y);var NdotLRefract: f32=saturateEps(dot(Ncc,LRefract));var absorption: vec3f=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);return absorption;}\n#endif\n#ifdef SHEEN\nfn computeSheenLighting(info: preLightingInfo,N: vec3f,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var roughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var fresnel: f32=1.;var distribution: f32=normalDistributionFunction_CharlieSheen(NdotH,alphaG);/*#ifdef SHEEN_SOFTER\nvar visibility: f32=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nvar visibility: f32=visibility_Ashikhmin(info.NdotL,info.NdotV);/* #endif */\nvar sheenTerm: f32=fresnel*distribution*visibility;return sheenTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n",e.IncludesShadersStoreWGSL.pbrDirectLightingFunctions="#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{diffuse: vec3f,\n#ifdef SPECULARTERM\nspecular: vec3f,\n#endif\n#ifdef CLEARCOAT\nclearCoat: vec4f,\n#endif\n#ifdef SHEEN\nsheen: vec3f\n#endif\n};fn adjustRoughnessFromLightProperties(roughness: f32,lightRadius: f32,lightDistance: f32)->f32 {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nvar lightRoughness: f32=lightRadius/lightDistance;var totalRoughness: f32=saturate(lightRoughness+roughness);return totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfn computeHemisphericDiffuseLighting(info: preLightingInfo,lightColor: vec3f,groundColor: vec3f)->vec3f {return mix(groundColor,lightColor,info.NdotL);}\nfn computeDiffuseLighting(info: preLightingInfo,lightColor: vec3f)->vec3f {var diffuseTerm: f32=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*info.attenuation*info.NdotL*lightColor;}\nfn computeProjectionTextureDiffuseLighting(projectionLightTexture: texture_2d<f32>,projectionLightSampler: sampler,textureProjectionMatrix: mat4x4f,posW: vec3f)->vec3f{var strq: vec4f=textureProjectionMatrix* vec4f(posW,1.0);strq/=strq.w;var textureColor: vec3f=textureSample(projectionLightTexture,projectionLightSampler,strq.xy).rgb;return toLinearSpaceVec3(textureColor);}\n#ifdef SS_TRANSLUCENCY\nfn computeDiffuseAndTransmittedLighting(info: preLightingInfo,lightColor: vec3f,transmittance: vec3f)->vec3f {var NdotL: f32=absEps(info.NdotLUnclamped);var wrapNdotL: f32=computeWrappedDiffuseNdotL(NdotL,0.02);var trAdapt: f32=step(0.,info.NdotLUnclamped);var transmittanceNdotL: vec3f=mix(transmittance*wrapNdotL, vec3f(wrapNdotL),trAdapt);var diffuseTerm: f32=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;}\n#endif\n#ifdef SPECULARTERM\nfn computeSpecularLighting(info: preLightingInfo,N: vec3f,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var roughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var fresnel: vec3f=fresnelSchlickGGXVec3(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nvar distribution: f32=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvar smithVisibility: f32=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nvar smithVisibility: f32=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvar specTerm: vec3f=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef ANISOTROPIC\nfn computeAnisotropicSpecularLighting(info: preLightingInfo,V: vec3f,N: vec3f,T: vec3f,B: vec3f,anisotropy: f32,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var TdotH: f32=dot(T,info.H);var BdotH: f32=dot(B,info.H);var TdotV: f32=dot(T,V);var BdotV: f32=dot(B,V);var TdotL: f32=dot(T,info.L);var BdotL: f32=dot(B,info.L);var alphaG: f32=convertRoughnessToAverageSlope(info.roughness);var alphaTB: vec2f=getAnisotropicRoughness(alphaG,anisotropy);alphaTB=max(alphaTB,vec2f(geometricRoughnessFactor*geometricRoughnessFactor));var fresnel: vec3f=fresnelSchlickGGXVec3(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nvar distribution: f32=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);var smithVisibility: f32=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);var specTerm: vec3f=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef CLEARCOAT\nfn computeClearCoatLighting(info: preLightingInfo,Ncc: vec3f,geometricRoughnessFactor: f32,clearCoatIntensity: f32,lightColor: vec3f)->vec4f {var NccdotL: f32=saturateEps(dot(Ncc,info.L));var NccdotH: f32=saturateEps(dot(Ncc,info.H));var clearCoatRoughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(clearCoatRoughness);var fresnel: f32=fresnelSchlickGGX(info.VdotH,uniforms.vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnel*=clearCoatIntensity;var distribution: f32=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);var kelemenVisibility: f32=visibility_Kelemen(info.VdotH);var clearCoatTerm: f32=fresnel*distribution*kelemenVisibility;return vec4f(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);}\nfn computeClearCoatLightingAbsorption(NdotVRefract: f32,L: vec3f,Ncc: vec3f,clearCoatColor: vec3f,clearCoatThickness: f32,clearCoatIntensity: f32)->vec3f {var LRefract: vec3f=-refract(L,Ncc,uniforms.vClearCoatRefractionParams.y);var NdotLRefract: f32=saturateEps(dot(Ncc,LRefract));var absorption: vec3f=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);return absorption;}\n#endif\n#ifdef SHEEN\nfn computeSheenLighting(info: preLightingInfo,N: vec3f,reflectance0: vec3f,reflectance90: vec3f,geometricRoughnessFactor: f32,lightColor: vec3f)->vec3f {var NdotH: f32=saturateEps(dot(N,info.H));var roughness: f32=max(info.roughness,geometricRoughnessFactor);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var fresnel: f32=1.;var distribution: f32=normalDistributionFunction_CharlieSheen(NdotH,alphaG);/*#ifdef SHEEN_SOFTER\nvar visibility: f32=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nvar visibility: f32=visibility_Ashikhmin(info.NdotL,info.NdotV);/* #endif */\nvar sheenTerm: f32=fresnel*distribution*visibility;return sheenTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n"}}),Fo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrIBLFunctions.js"(){c(),"pbrIBLFunctions","#if defined(REFLECTION) || defined(SS_REFRACTION)\nfn getLodFromAlphaG(cubeMapDimensionPixels: f32,microsurfaceAverageSlope: f32)->f32 {var microsurfaceAverageSlopeTexels: f32=cubeMapDimensionPixels*microsurfaceAverageSlope;var lod: f32=log2(microsurfaceAverageSlopeTexels);return lod;}\nfn getLinearLodFromRoughness(cubeMapDimensionPixels: f32,roughness: f32)->f32 {var lod: f32=log2(cubeMapDimensionPixels)*roughness;return lod;}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfn environmentRadianceOcclusion(ambientOcclusion: f32,NdotVUnclamped: f32)->f32 {var temp: f32=NdotVUnclamped+ambientOcclusion;return saturate(temp*temp-1.0+ambientOcclusion);}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfn environmentHorizonOcclusion(view: vec3f,normal: vec3f,geometricNormal: vec3f)->f32 {var reflection: vec3f=reflect(view,normal);var temp: f32=saturate(1.0+1.1*dot(reflection,geometricNormal));return temp*temp;}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\nfn UNPACK_LOD(x: f32)->f32 {return (1.0-x)*255.0;}\nfn getLodFromAlphaGNdotV(cubeMapDimensionPixels: f32,alphaG: f32,NdotV: f32)->f32 {var microsurfaceAverageSlope: f32=alphaG;microsurfaceAverageSlope*=sqrt(abs(NdotV));return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);}\n#endif\n",e.IncludesShadersStoreWGSL.pbrIBLFunctions="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfn getLodFromAlphaG(cubeMapDimensionPixels: f32,microsurfaceAverageSlope: f32)->f32 {var microsurfaceAverageSlopeTexels: f32=cubeMapDimensionPixels*microsurfaceAverageSlope;var lod: f32=log2(microsurfaceAverageSlopeTexels);return lod;}\nfn getLinearLodFromRoughness(cubeMapDimensionPixels: f32,roughness: f32)->f32 {var lod: f32=log2(cubeMapDimensionPixels)*roughness;return lod;}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfn environmentRadianceOcclusion(ambientOcclusion: f32,NdotVUnclamped: f32)->f32 {var temp: f32=NdotVUnclamped+ambientOcclusion;return saturate(temp*temp-1.0+ambientOcclusion);}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfn environmentHorizonOcclusion(view: vec3f,normal: vec3f,geometricNormal: vec3f)->f32 {var reflection: vec3f=reflect(view,normal);var temp: f32=saturate(1.0+1.1*dot(reflection,geometricNormal));return temp*temp;}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\nfn UNPACK_LOD(x: f32)->f32 {return (1.0-x)*255.0;}\nfn getLodFromAlphaGNdotV(cubeMapDimensionPixels: f32,alphaG: f32,NdotV: f32)->f32 {var microsurfaceAverageSlope: f32=alphaG;microsurfaceAverageSlope*=sqrt(abs(NdotV));return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);}\n#endif\n"}}),ko=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockAlbedoOpacity.js"(){c(),Ua(),"pbrBlockAlbedoOpacity","struct albedoOpacityOutParams\n{surfaceAlbedo: vec3f,\nalpha: f32};\n#define pbr_inline\nfn albedoOpacityBlock(\nvAlbedoColor: vec4f\n#ifdef ALBEDO\n,albedoTexture: vec4f\n,albedoInfos: vec2f\n#endif\n#ifdef OPACITY\n,opacityMap: vec4f\n,vOpacityInfos: vec2f\n#endif\n#ifdef DETAIL\n,detailColor: vec4f\n,vDetailInfos: vec4f\n#endif\n#ifdef DECAL\n,decalColor: vec4f\n,vDecalInfos: vec4f\n#endif\n)->albedoOpacityOutParams\n{var outParams: albedoOpacityOutParams;var surfaceAlbedo: vec3f=vAlbedoColor.rgb;var alpha: f32=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpaceVec3(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#ifndef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nsurfaceAlbedo*=fragmentInputs.vColor.rgb;\n#endif\n#ifdef DETAIL\nvar detailAlbedo: f32=2.0*mix(0.5,detailColor.r,vDetailInfos.y);surfaceAlbedo=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#ifdef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=fragmentInputs.vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST \n#if DEBUGMODE != 88\nif (alpha<ALPHATESTVALUE) {discard;}\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;outParams.alpha=alpha;return outParams;}\n",e.IncludesShadersStoreWGSL.pbrBlockAlbedoOpacity="struct albedoOpacityOutParams\n{surfaceAlbedo: vec3f,\nalpha: f32};\n#define pbr_inline\nfn albedoOpacityBlock(\nvAlbedoColor: vec4f\n#ifdef ALBEDO\n,albedoTexture: vec4f\n,albedoInfos: vec2f\n#endif\n#ifdef OPACITY\n,opacityMap: vec4f\n,vOpacityInfos: vec2f\n#endif\n#ifdef DETAIL\n,detailColor: vec4f\n,vDetailInfos: vec4f\n#endif\n#ifdef DECAL\n,decalColor: vec4f\n,vDecalInfos: vec4f\n#endif\n)->albedoOpacityOutParams\n{var outParams: albedoOpacityOutParams;var surfaceAlbedo: vec3f=vAlbedoColor.rgb;var alpha: f32=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpaceVec3(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#ifndef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nsurfaceAlbedo*=fragmentInputs.vColor.rgb;\n#endif\n#ifdef DETAIL\nvar detailAlbedo: f32=2.0*mix(0.5,detailColor.r,vDetailInfos.y);surfaceAlbedo=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#ifdef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=fragmentInputs.vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST \n#if DEBUGMODE != 88\nif (alpha<ALPHATESTVALUE) {discard;}\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;outParams.alpha=alpha;return outParams;}\n"}}),Bo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockReflectivity.js"(){c(),"pbrBlockReflectivity","struct reflectivityOutParams\n{microSurface: f32,\nroughness: f32,\nsurfaceReflectivityColor: vec3f,\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo: vec3f,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nambientOcclusionColor: vec3f,\n#endif\n#if DEBUGMODE>0\n#ifdef METALLICWORKFLOW\nmetallicRoughness: vec2f,\n#ifdef REFLECTIVITY\nsurfaceMetallicColorMap: vec4f,\n#endif\n#ifndef FROSTBITE_REFLECTANCE\nmetallicF0: vec3f,\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColorMap: vec4f,\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nfn reflectivityBlock(\nvReflectivityColor: vec4f\n#ifdef METALLICWORKFLOW\n,surfaceAlbedo: vec3f\n,metallicReflectanceFactors: vec4f\n#endif\n#ifdef REFLECTIVITY\n,reflectivityInfos: vec3f\n,surfaceMetallicOrReflectivityColorMap: vec4f\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,ambientOcclusionColorIn: vec3f\n#endif\n#ifdef MICROSURFACEMAP\n,microSurfaceTexel: vec4f\n#endif\n#ifdef DETAIL\n,detailColor: vec4f\n,vDetailInfos: vec4f\n#endif\n)->reflectivityOutParams\n{var outParams: reflectivityOutParams;var microSurface: f32=vReflectivityColor.a;var surfaceReflectivityColor: vec3f=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvar metallicRoughness: vec2f=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvar aoStoreInMetalMap: vec3f= vec3f(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nvar detailRoughness: f32=mix(0.5,detailColor.b,vDetailInfos.w);var loLerp: f32=mix(0.,metallicRoughness.g,detailRoughness*2.);var hiLerp: f32=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;var baseColor: vec3f=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvar metallicF0: vec3f=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0), vec3f(0.,0.,0.),metallicRoughness.r);surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;microSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);var roughness: f32=1.-microSurface;outParams.microSurface=microSurface;outParams.roughness=roughness;outParams.surfaceReflectivityColor=surfaceReflectivityColor;return outParams;}\n",e.IncludesShadersStoreWGSL.pbrBlockReflectivity="struct reflectivityOutParams\n{microSurface: f32,\nroughness: f32,\nsurfaceReflectivityColor: vec3f,\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo: vec3f,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nambientOcclusionColor: vec3f,\n#endif\n#if DEBUGMODE>0\n#ifdef METALLICWORKFLOW\nmetallicRoughness: vec2f,\n#ifdef REFLECTIVITY\nsurfaceMetallicColorMap: vec4f,\n#endif\n#ifndef FROSTBITE_REFLECTANCE\nmetallicF0: vec3f,\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColorMap: vec4f,\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nfn reflectivityBlock(\nvReflectivityColor: vec4f\n#ifdef METALLICWORKFLOW\n,surfaceAlbedo: vec3f\n,metallicReflectanceFactors: vec4f\n#endif\n#ifdef REFLECTIVITY\n,reflectivityInfos: vec3f\n,surfaceMetallicOrReflectivityColorMap: vec4f\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,ambientOcclusionColorIn: vec3f\n#endif\n#ifdef MICROSURFACEMAP\n,microSurfaceTexel: vec4f\n#endif\n#ifdef DETAIL\n,detailColor: vec4f\n,vDetailInfos: vec4f\n#endif\n)->reflectivityOutParams\n{var outParams: reflectivityOutParams;var microSurface: f32=vReflectivityColor.a;var surfaceReflectivityColor: vec3f=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvar metallicRoughness: vec2f=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvar aoStoreInMetalMap: vec3f= vec3f(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nvar detailRoughness: f32=mix(0.5,detailColor.b,vDetailInfos.w);var loLerp: f32=mix(0.,metallicRoughness.g,detailRoughness*2.);var hiLerp: f32=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;var baseColor: vec3f=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvar metallicF0: vec3f=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0), vec3f(0.,0.,0.),metallicRoughness.r);surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;microSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);var roughness: f32=1.-microSurface;outParams.microSurface=microSurface;outParams.roughness=roughness;outParams.surfaceReflectivityColor=surfaceReflectivityColor;return outParams;}\n"}}),Go=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockAmbientOcclusion.js"(){c(),"pbrBlockAmbientOcclusion","struct ambientOcclusionOutParams\n{ambientOcclusionColor: vec3f,\n#if DEBUGMODE>0 && defined(AMBIENT)\nambientOcclusionColorMap: vec3f\n#endif\n};\n#define pbr_inline\nfn ambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap_: vec3f,\nvAmbientInfos: vec4f\n#endif\n)->ambientOcclusionOutParams\n{ \nvar outParams: ambientOcclusionOutParams;var ambientOcclusionColor: vec3f= vec3f(1.,1.,1.);\n#ifdef AMBIENT\nvar ambientOcclusionColorMap: vec3f=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap= vec3f(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;return outParams;}\n",e.IncludesShadersStoreWGSL.pbrBlockAmbientOcclusion="struct ambientOcclusionOutParams\n{ambientOcclusionColor: vec3f,\n#if DEBUGMODE>0 && defined(AMBIENT)\nambientOcclusionColorMap: vec3f\n#endif\n};\n#define pbr_inline\nfn ambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap_: vec3f,\nvAmbientInfos: vec4f\n#endif\n)->ambientOcclusionOutParams\n{ \nvar outParams: ambientOcclusionOutParams;var ambientOcclusionColor: vec3f= vec3f(1.,1.,1.);\n#ifdef AMBIENT\nvar ambientOcclusionColorMap: vec3f=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap= vec3f(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;return outParams;}\n"}}),Uo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockAlphaFresnel.js"(){c(),"pbrBlockAlphaFresnel","#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{alpha: f32};fn faceforward(N: vec3<f32>,I: vec3<f32>,Nref: vec3<f32>)->vec3<f32> {return select(N,-N,dot(Nref,I)>0.0);}\n#define pbr_inline\nfn alphaFresnelBlock(\nnormalW: vec3f,\nviewDirectionW: vec3f,\nalpha: f32,\nmicroSurface: f32\n)->alphaFresnelOutParams\n{var outParams: alphaFresnelOutParams;var opacityPerceptual: f32=alpha;\n#ifdef LINEARALPHAFRESNEL\nvar opacity0: f32=opacityPerceptual;\n#else\nvar opacity0: f32=opacityPerceptual*opacityPerceptual;\n#endif\nvar opacity90: f32=fresnelGrazingReflectance(opacity0);var normalForward: vec3f=faceforward(normalW,-viewDirectionW,normalW);outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)), vec3f(opacity0), vec3f(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE) {discard;}\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\nreturn outParams;}\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockAlphaFresnel="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{alpha: f32};fn faceforward(N: vec3<f32>,I: vec3<f32>,Nref: vec3<f32>)->vec3<f32> {return select(N,-N,dot(Nref,I)>0.0);}\n#define pbr_inline\nfn alphaFresnelBlock(\nnormalW: vec3f,\nviewDirectionW: vec3f,\nalpha: f32,\nmicroSurface: f32\n)->alphaFresnelOutParams\n{var outParams: alphaFresnelOutParams;var opacityPerceptual: f32=alpha;\n#ifdef LINEARALPHAFRESNEL\nvar opacity0: f32=opacityPerceptual;\n#else\nvar opacity0: f32=opacityPerceptual*opacityPerceptual;\n#endif\nvar opacity90: f32=fresnelGrazingReflectance(opacity0);var normalForward: vec3f=faceforward(normalW,-viewDirectionW,normalW);outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)), vec3f(opacity0), vec3f(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE) {discard;}\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\nreturn outParams;}\n#endif\n#endif\n"}}),Ho=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockAnisotropic.js"(){c(),"pbrBlockAnisotropic","#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{anisotropy: f32,\nanisotropicTangent: vec3f,\nanisotropicBitangent: vec3f,\nanisotropicNormal: vec3f,\n#if DEBUGMODE>0 && defined(ANISOTROPIC_TEXTURE)\nanisotropyMapData: vec3f\n#endif\n};\n#define pbr_inline\nfn anisotropicBlock(\nvAnisotropy: vec3f,\nroughness: f32,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData: vec3f,\n#endif\nTBN: mat3x3f,\nnormalW: vec3f,\nviewDirectionW: vec3f\n)->anisotropicOutParams\n{ \nvar outParams: anisotropicOutParams;var anisotropy: f32=vAnisotropy.b;var anisotropyDirection: vec3f= vec3f(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nvar amd=anisotropyMapData.rg;anisotropy*=anisotropyMapData.b;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\namd=amd*2.0-1.0;\n#ifdef ANISOTROPIC_LEGACY\nanisotropyDirection=vec3f(anisotropyDirection.xy*amd,anisotropyDirection.z);\n#else\nanisotropyDirection=vec3f(mat2x2f(anisotropyDirection.x,anisotropyDirection.y,-anisotropyDirection.y,anisotropyDirection.x)*normalize(amd),anisotropyDirection.z);\n#endif\n#endif\nvar anisoTBN: mat3x3f= mat3x3f(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));var anisotropicTangent: vec3f=normalize(anisoTBN*anisotropyDirection);var anisotropicBitangent: vec3f=normalize(cross(anisoTBN[2],anisotropicTangent));outParams.anisotropy=anisotropy;outParams.anisotropicTangent=anisotropicTangent;outParams.anisotropicBitangent=anisotropicBitangent;outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy,roughness);return outParams;}\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockAnisotropic="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{anisotropy: f32,\nanisotropicTangent: vec3f,\nanisotropicBitangent: vec3f,\nanisotropicNormal: vec3f,\n#if DEBUGMODE>0 && defined(ANISOTROPIC_TEXTURE)\nanisotropyMapData: vec3f\n#endif\n};\n#define pbr_inline\nfn anisotropicBlock(\nvAnisotropy: vec3f,\nroughness: f32,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData: vec3f,\n#endif\nTBN: mat3x3f,\nnormalW: vec3f,\nviewDirectionW: vec3f\n)->anisotropicOutParams\n{ \nvar outParams: anisotropicOutParams;var anisotropy: f32=vAnisotropy.b;var anisotropyDirection: vec3f= vec3f(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nvar amd=anisotropyMapData.rg;anisotropy*=anisotropyMapData.b;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\namd=amd*2.0-1.0;\n#ifdef ANISOTROPIC_LEGACY\nanisotropyDirection=vec3f(anisotropyDirection.xy*amd,anisotropyDirection.z);\n#else\nanisotropyDirection=vec3f(mat2x2f(anisotropyDirection.x,anisotropyDirection.y,-anisotropyDirection.y,anisotropyDirection.x)*normalize(amd),anisotropyDirection.z);\n#endif\n#endif\nvar anisoTBN: mat3x3f= mat3x3f(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));var anisotropicTangent: vec3f=normalize(anisoTBN*anisotropyDirection);var anisotropicBitangent: vec3f=normalize(cross(anisoTBN[2],anisotropicTangent));outParams.anisotropy=anisotropy;outParams.anisotropicTangent=anisotropicTangent;outParams.anisotropicBitangent=anisotropicBitangent;outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy,roughness);return outParams;}\n#endif\n"}}),Vo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockReflection.js"(){c(),"pbrBlockReflection","#ifdef REFLECTION\nstruct reflectionOutParams\n{environmentRadiance: vec4f\n,environmentIrradiance: vec3f\n#ifdef REFLECTIONMAP_3D\n,reflectionCoords: vec3f\n#else\n,reflectionCoords: vec2f\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,irradianceVector: vec3f\n#endif\n#endif\n#endif\n};\n#define pbr_inline\n#ifdef REFLECTIONMAP_3D\nfn createReflectionCoords(\nvPositionW: vec3f,\nnormalW: vec3f,\n#ifdef ANISOTROPIC\nanisotropicOut: anisotropicOutParams,\n#endif\n)->vec3f\n{var reflectionCoords: vec3f;\n#else\nfn createReflectionCoords(\nvPositionW: vec3f,\nnormalW: vec3f,\n#ifdef ANISOTROPIC\nanisotropicOut: anisotropicOutParams,\n#endif\n)->vec2f\n{ \nvar reflectionCoords: vec2f;\n#endif\n#ifdef ANISOTROPIC\nvar reflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvar reflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\nreturn reflectionCoords;}\n#define pbr_inline\nfn sampleReflectionTexture(\nalphaG: f32\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped: f32\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness: f32\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec3f\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec2f\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler\n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler\n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler\n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif \n)->vec4f\n{var environmentRadiance: vec4f;\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nvar reflectionLOD: f32=getLodFromAlphaGNdotV(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nvar reflectionLOD: f32=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nvar reflectionLOD: f32=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nvar automaticReflectionLOD: f32=UNPACK_LOD(textureSample(reflectionSampler,reflectionSamplerSampler,reflectionCoords).a);var requestedReflectionLOD: f32=max(automaticReflectionLOD,reflectionLOD);\n#else\nvar requestedReflectionLOD: f32=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance= vec4f(radiance(alphaG,reflectionSampler,reflectionSamplerSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=textureSampleLevel(reflectionSampler,reflectionSamplerSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nvar lodReflectionNormalized: f32=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));var lodReflectionNormalizedDoubled: f32=lodReflectionNormalized*2.0;var environmentMid: vec4f=textureSample(reflectionSampler,reflectionSamplerSampler,reflectionCoords);if (lodReflectionNormalizedDoubled<1.0){environmentRadiance=mix(\ntextureSample(reflectionHighSampler,reflectionHighSamplerSampler,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);} else {environmentRadiance=mix(\nenvironmentMid,\ntextureSample(reflectionLowSampler,reflectionLowSamplerSampler,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);}\n#endif\nvar envRadiance=environmentRadiance.rgb;\n#ifdef RGBDREFLECTION\nenvRadiance=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvRadiance=toLinearSpaceVec3(environmentRadiance.rgb);\n#endif\nenvRadiance*=vReflectionInfos.x;envRadiance*=vReflectionColor.rgb;return vec4f(envRadiance,environmentRadiance.a);}\n#define pbr_inline\nfn reflectionBlock(\nvPositionW: vec3f\n,normalW: vec3f\n,alphaG: f32\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped: f32\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness: f32\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,vEnvironmentIrradiance: vec3f\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionMatrix: mat4x4f\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,irradianceSampler: texture_cube<f32>\n,irradianceSamplerSampler: sampler \n#else\n,irradianceSampler: texture_2d<f32>\n,irradianceSamplerSampler: sampler \n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n)->reflectionOutParams\n{var outParams: reflectionOutParams;var environmentRadiance: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvar reflectionCoords: vec3f= vec3f(0.);\n#else\nvar reflectionCoords: vec2f= vec2f(0.);\n#endif\nreflectionCoords=createReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif \n);environmentRadiance=sampleReflectionTexture(\nalphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#else\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#endif\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif \n);var environmentIrradiance: vec3f= vec3f(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,reflectionSamplerSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvar environmentIrradiance4: vec4f=textureSample(irradianceSampler,irradianceSamplerSampler,reflectionCoords);environmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance=toLinearSpaceVec3(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;outParams.environmentRadiance=environmentRadiance;outParams.environmentIrradiance=environmentIrradiance;outParams.reflectionCoords=reflectionCoords;return outParams;}\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockReflection="#ifdef REFLECTION\nstruct reflectionOutParams\n{environmentRadiance: vec4f\n,environmentIrradiance: vec3f\n#ifdef REFLECTIONMAP_3D\n,reflectionCoords: vec3f\n#else\n,reflectionCoords: vec2f\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,irradianceVector: vec3f\n#endif\n#endif\n#endif\n};\n#define pbr_inline\n#ifdef REFLECTIONMAP_3D\nfn createReflectionCoords(\nvPositionW: vec3f,\nnormalW: vec3f,\n#ifdef ANISOTROPIC\nanisotropicOut: anisotropicOutParams,\n#endif\n)->vec3f\n{var reflectionCoords: vec3f;\n#else\nfn createReflectionCoords(\nvPositionW: vec3f,\nnormalW: vec3f,\n#ifdef ANISOTROPIC\nanisotropicOut: anisotropicOutParams,\n#endif\n)->vec2f\n{ \nvar reflectionCoords: vec2f;\n#endif\n#ifdef ANISOTROPIC\nvar reflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvar reflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\nreturn reflectionCoords;}\n#define pbr_inline\nfn sampleReflectionTexture(\nalphaG: f32\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped: f32\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness: f32\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec3f\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec2f\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler\n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler\n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler\n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif \n)->vec4f\n{var environmentRadiance: vec4f;\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nvar reflectionLOD: f32=getLodFromAlphaGNdotV(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nvar reflectionLOD: f32=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nvar reflectionLOD: f32=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nvar automaticReflectionLOD: f32=UNPACK_LOD(textureSample(reflectionSampler,reflectionSamplerSampler,reflectionCoords).a);var requestedReflectionLOD: f32=max(automaticReflectionLOD,reflectionLOD);\n#else\nvar requestedReflectionLOD: f32=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance= vec4f(radiance(alphaG,reflectionSampler,reflectionSamplerSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=textureSampleLevel(reflectionSampler,reflectionSamplerSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nvar lodReflectionNormalized: f32=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));var lodReflectionNormalizedDoubled: f32=lodReflectionNormalized*2.0;var environmentMid: vec4f=textureSample(reflectionSampler,reflectionSamplerSampler,reflectionCoords);if (lodReflectionNormalizedDoubled<1.0){environmentRadiance=mix(\ntextureSample(reflectionHighSampler,reflectionHighSamplerSampler,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);} else {environmentRadiance=mix(\nenvironmentMid,\ntextureSample(reflectionLowSampler,reflectionLowSamplerSampler,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);}\n#endif\nvar envRadiance=environmentRadiance.rgb;\n#ifdef RGBDREFLECTION\nenvRadiance=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvRadiance=toLinearSpaceVec3(environmentRadiance.rgb);\n#endif\nenvRadiance*=vReflectionInfos.x;envRadiance*=vReflectionColor.rgb;return vec4f(envRadiance,environmentRadiance.a);}\n#define pbr_inline\nfn reflectionBlock(\nvPositionW: vec3f\n,normalW: vec3f\n,alphaG: f32\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped: f32\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness: f32\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,vEnvironmentIrradiance: vec3f\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionMatrix: mat4x4f\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,irradianceSampler: texture_cube<f32>\n,irradianceSamplerSampler: sampler \n#else\n,irradianceSampler: texture_2d<f32>\n,irradianceSamplerSampler: sampler \n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n)->reflectionOutParams\n{var outParams: reflectionOutParams;var environmentRadiance: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvar reflectionCoords: vec3f= vec3f(0.);\n#else\nvar reflectionCoords: vec2f= vec2f(0.);\n#endif\nreflectionCoords=createReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif \n);environmentRadiance=sampleReflectionTexture(\nalphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness\n#endif\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#else\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#endif\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif \n);var environmentIrradiance: vec3f= vec3f(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,reflectionSamplerSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvar environmentIrradiance4: vec4f=textureSample(irradianceSampler,irradianceSamplerSampler,reflectionCoords);environmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance=toLinearSpaceVec3(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;outParams.environmentRadiance=environmentRadiance;outParams.environmentIrradiance=environmentIrradiance;outParams.reflectionCoords=reflectionCoords;return outParams;}\n#endif\n"}}),Wo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockSheen.js"(){c(),"pbrBlockSheen","#ifdef SHEEN\nstruct sheenOutParams\n{sheenIntensity: f32\n,sheenColor: vec3f\n,sheenRoughness: f32\n#ifdef SHEEN_LINKWITHALBEDO\n,surfaceAlbedo: vec3f\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\n,sheenAlbedoScaling: f32\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,finalSheenRadianceScaled: vec3f\n#endif\n#if DEBUGMODE>0\n#ifdef SHEEN_TEXTURE\n,sheenMapData: vec4f\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,sheenEnvironmentReflectance: vec3f\n#endif\n#endif\n};\n#define pbr_inline\nfn sheenBlock(\nvSheenColor: vec4f\n#ifdef SHEEN_ROUGHNESS\n,vSheenRoughness: f32\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,sheenMapRoughnessData: vec4f\n#endif\n#endif\n,roughness: f32\n#ifdef SHEEN_TEXTURE\n,sheenMapData: vec4f\n,sheenMapLevel: f32\n#endif\n,reflectance: f32\n#ifdef SHEEN_LINKWITHALBEDO\n,baseColor: vec3f\n,surfaceAlbedo: vec3f\n#endif\n#ifdef ENVIRONMENTBRDF\n,NdotV: f32\n,environmentBrdf: vec3f\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,AARoughnessFactors: vec2f\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n,vLightingIntensity: vec4f\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec3f\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec2f\n#endif\n,NdotVUnclamped: f32\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,seo: f32\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,eho: f32\n#endif\n#endif\n)->sheenOutParams\n{var outParams: sheenOutParams;var sheenIntensity: f32=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nvar sheenFactor: f32=pow5(1.0-sheenIntensity);var sheenColor: vec3f=baseColor.rgb*(1.0-sheenFactor);var sheenRoughness: f32=sheenIntensity;outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvar sheenColor: vec3f=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor*=toLinearSpaceVec3(sheenMapData.rgb);\n#else\nsheenColor*=sheenMapData.rgb;\n#endif\nsheenColor*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nvar sheenRoughness: f32=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#else\nvar sheenRoughness: f32=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvar environmentSheenBrdf: vec3f= vec3f(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvar environmentSheenBrdf: vec3f=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvar environmentSheenBrdf: vec3f=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvar sheenAlphaG: f32=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvar environmentSheenRadiance: vec4f= vec4f(0.,0.,0.,0.);environmentSheenRadiance=sampleReflectionTexture(\nsheenAlphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,sheenRoughness\n#endif\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n);var sheenEnvironmentReflectance: vec3f=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;outParams.sheenColor=sheenColor;outParams.sheenRoughness=sheenRoughness;return outParams;}\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockSheen="#ifdef SHEEN\nstruct sheenOutParams\n{sheenIntensity: f32\n,sheenColor: vec3f\n,sheenRoughness: f32\n#ifdef SHEEN_LINKWITHALBEDO\n,surfaceAlbedo: vec3f\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\n,sheenAlbedoScaling: f32\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,finalSheenRadianceScaled: vec3f\n#endif\n#if DEBUGMODE>0\n#ifdef SHEEN_TEXTURE\n,sheenMapData: vec4f\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,sheenEnvironmentReflectance: vec3f\n#endif\n#endif\n};\n#define pbr_inline\nfn sheenBlock(\nvSheenColor: vec4f\n#ifdef SHEEN_ROUGHNESS\n,vSheenRoughness: f32\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,sheenMapRoughnessData: vec4f\n#endif\n#endif\n,roughness: f32\n#ifdef SHEEN_TEXTURE\n,sheenMapData: vec4f\n,sheenMapLevel: f32\n#endif\n,reflectance: f32\n#ifdef SHEEN_LINKWITHALBEDO\n,baseColor: vec3f\n,surfaceAlbedo: vec3f\n#endif\n#ifdef ENVIRONMENTBRDF\n,NdotV: f32\n,environmentBrdf: vec3f\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,AARoughnessFactors: vec2f\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n,vLightingIntensity: vec4f\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec3f\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n,reflectionCoords: vec2f\n#endif\n,NdotVUnclamped: f32\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,seo: f32\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,eho: f32\n#endif\n#endif\n)->sheenOutParams\n{var outParams: sheenOutParams;var sheenIntensity: f32=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nvar sheenFactor: f32=pow5(1.0-sheenIntensity);var sheenColor: vec3f=baseColor.rgb*(1.0-sheenFactor);var sheenRoughness: f32=sheenIntensity;outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvar sheenColor: vec3f=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor*=toLinearSpaceVec3(sheenMapData.rgb);\n#else\nsheenColor*=sheenMapData.rgb;\n#endif\nsheenColor*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nvar sheenRoughness: f32=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#else\nvar sheenRoughness: f32=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvar environmentSheenBrdf: vec3f= vec3f(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvar environmentSheenBrdf: vec3f=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvar environmentSheenBrdf: vec3f=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvar sheenAlphaG: f32=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvar environmentSheenRadiance: vec4f= vec4f(0.,0.,0.,0.);environmentSheenRadiance=sampleReflectionTexture(\nsheenAlphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,sheenRoughness\n#endif\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionCoords\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n);var sheenEnvironmentReflectance: vec3f=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;outParams.sheenColor=sheenColor;outParams.sheenRoughness=sheenRoughness;return outParams;}\n#endif\n"}}),zo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockClearcoat.js"(){c(),"pbrBlockClearcoat","struct clearcoatOutParams\n{specularEnvironmentR0: vec3f,\nconservationFactor: f32,\nclearCoatNormalW: vec3f,\nclearCoatAARoughnessFactors: vec2f,\nclearCoatIntensity: f32,\nclearCoatRoughness: f32,\n#ifdef REFLECTION\nfinalClearCoatRadianceScaled: vec3f,\n#endif\n#ifdef CLEARCOAT_TINT\nabsorption: vec3f,\nclearCoatNdotVRefract: f32,\nclearCoatColor: vec3f,\nclearCoatThickness: f32,\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nenergyConservationFactorClearCoat: vec3f,\n#endif\n#if DEBUGMODE>0\n#ifdef CLEARCOAT_BUMP\nTBNClearCoat: mat3x3f,\n#endif\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData: vec2f,\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nclearCoatTintMapData: vec4f,\n#endif\n#ifdef REFLECTION\nenvironmentClearCoatRadiance: vec4f,\nclearCoatEnvironmentReflectance: vec3f,\n#endif\nclearCoatNdotV: f32\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\nfn clearcoatBlock(\nvPositionW: vec3f\n,geometricNormalW: vec3f\n,viewDirectionW: vec3f\n,vClearCoatParams: vec2f\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,clearCoatMapRoughnessData: vec4f\n#endif\n,specularEnvironmentR0: vec3f\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData: vec2f\n#endif\n#ifdef CLEARCOAT_TINT\n,vClearCoatTintParams: vec4f\n,clearCoatColorAtDistance: f32\n,vClearCoatRefractionParams: vec4f\n#ifdef CLEARCOAT_TINT_TEXTURE\n,clearCoatTintMapData: vec4f\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,vClearCoatBumpInfos: vec2f\n,clearCoatBumpMapData: vec4f\n,vClearCoatBumpUV: vec2f\n#if defined(TANGENT) && defined(NORMAL)\n,vTBN: mat3x3f\n#else\n,vClearCoatTangentSpaceParams: vec2f\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,normalMatrix: mat4x4f\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,faceNormal: vec3f\n#endif\n#ifdef REFLECTION\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n,vLightingIntensity: vec4f\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,ambientMonochrome: f32\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,frontFacingMultiplier: f32\n#endif \n)->clearcoatOutParams\n{var outParams: clearcoatOutParams;var clearCoatIntensity: f32=vClearCoatParams.x;var clearCoatRoughness: f32=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;outParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvar clearCoatColor: vec3f=vClearCoatTintParams.rgb;var clearCoatThickness: f32=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpaceVec3(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);outParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvar specularEnvironmentR0Updated: vec3f=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvar specularEnvironmentR0Updated: vec3f=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);var clearCoatNormalW: vec3f=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nvar clearCoatNormalScale: f32=1.0;\n#else\nvar clearCoatNormalScale: f32=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nvar TBNClearCoat: mat3x3f=vTBN;\n#else\nvar TBNClearCoatUV: vec2f=vClearCoatBumpUV*frontFacingMultiplier;var TBNClearCoat: mat3x3f=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);clearCoatNormalW=normalize( mat3x3f(normalMatrix[0].xyz,normalMatrix[1].xyz,normalMatrix[2].xyz)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);var clearCoatNdotVUnclamped: f32=dot(clearCoatNormalW,viewDirectionW);var clearCoatNdotV: f32=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvar clearCoatVRefract: vec3f=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvar environmentClearCoatBrdf: vec3f=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nvar clearCoatAlphaG: f32=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvar environmentClearCoatRadiance: vec4f= vec4f(0.,0.,0.,0.);var clearCoatReflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvar clearCoatReflectionCoords: vec3f=clearCoatReflectionVector;\n#else\nvar clearCoatReflectionCoords: vec2f=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nenvironmentClearCoatRadiance=sampleReflectionTexture(\nclearCoatAlphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,clearCoatNdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,clearCoatRoughness\n#endif\n,reflectionSampler\n,reflectionSamplerSampler\n,clearCoatReflectionCoords\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif \n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvar clearCoatEnvironmentReflectance: vec3f=getReflectanceFromBRDFLookup(vec3f(uniforms.vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nvar clearCoatEho: f32=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);clearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvar clearCoatEnvironmentReflectance: vec3f=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV, vec3f(1.), vec3f(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nvar fresnelIBLClearCoat: f32=fresnelSchlickGGX(clearCoatNdotV,uniforms.vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnelIBLClearCoat*=clearCoatIntensity;outParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\nreturn outParams;}\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockClearcoat="struct clearcoatOutParams\n{specularEnvironmentR0: vec3f,\nconservationFactor: f32,\nclearCoatNormalW: vec3f,\nclearCoatAARoughnessFactors: vec2f,\nclearCoatIntensity: f32,\nclearCoatRoughness: f32,\n#ifdef REFLECTION\nfinalClearCoatRadianceScaled: vec3f,\n#endif\n#ifdef CLEARCOAT_TINT\nabsorption: vec3f,\nclearCoatNdotVRefract: f32,\nclearCoatColor: vec3f,\nclearCoatThickness: f32,\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nenergyConservationFactorClearCoat: vec3f,\n#endif\n#if DEBUGMODE>0\n#ifdef CLEARCOAT_BUMP\nTBNClearCoat: mat3x3f,\n#endif\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData: vec2f,\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nclearCoatTintMapData: vec4f,\n#endif\n#ifdef REFLECTION\nenvironmentClearCoatRadiance: vec4f,\nclearCoatEnvironmentReflectance: vec3f,\n#endif\nclearCoatNdotV: f32\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\nfn clearcoatBlock(\nvPositionW: vec3f\n,geometricNormalW: vec3f\n,viewDirectionW: vec3f\n,vClearCoatParams: vec2f\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,clearCoatMapRoughnessData: vec4f\n#endif\n,specularEnvironmentR0: vec3f\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData: vec2f\n#endif\n#ifdef CLEARCOAT_TINT\n,vClearCoatTintParams: vec4f\n,clearCoatColorAtDistance: f32\n,vClearCoatRefractionParams: vec4f\n#ifdef CLEARCOAT_TINT_TEXTURE\n,clearCoatTintMapData: vec4f\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,vClearCoatBumpInfos: vec2f\n,clearCoatBumpMapData: vec4f\n,vClearCoatBumpUV: vec2f\n#if defined(TANGENT) && defined(NORMAL)\n,vTBN: mat3x3f\n#else\n,vClearCoatTangentSpaceParams: vec2f\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,normalMatrix: mat4x4f\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,faceNormal: vec3f\n#endif\n#ifdef REFLECTION\n,vReflectionMicrosurfaceInfos: vec3f\n,vReflectionInfos: vec2f\n,vReflectionColor: vec3f\n,vLightingIntensity: vec4f\n#ifdef REFLECTIONMAP_3D\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n#else\n,reflectionSampler: texture_2d<f32>\n,reflectionSamplerSampler: sampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,reflectionLowSampler: texture_cube<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_cube<f32>\n,reflectionHighSamplerSampler: sampler \n#else\n,reflectionLowSampler: texture_2d<f32>\n,reflectionLowSamplerSampler: sampler \n,reflectionHighSampler: texture_2d<f32>\n,reflectionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo: vec2f\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,ambientMonochrome: f32\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,frontFacingMultiplier: f32\n#endif \n)->clearcoatOutParams\n{var outParams: clearcoatOutParams;var clearCoatIntensity: f32=vClearCoatParams.x;var clearCoatRoughness: f32=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;outParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvar clearCoatColor: vec3f=vClearCoatTintParams.rgb;var clearCoatThickness: f32=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpaceVec3(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);outParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvar specularEnvironmentR0Updated: vec3f=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvar specularEnvironmentR0Updated: vec3f=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);var clearCoatNormalW: vec3f=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nvar clearCoatNormalScale: f32=1.0;\n#else\nvar clearCoatNormalScale: f32=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nvar TBNClearCoat: mat3x3f=vTBN;\n#else\nvar TBNClearCoatUV: vec2f=vClearCoatBumpUV*frontFacingMultiplier;var TBNClearCoat: mat3x3f=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);clearCoatNormalW=normalize( mat3x3f(normalMatrix[0].xyz,normalMatrix[1].xyz,normalMatrix[2].xyz)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);var clearCoatNdotVUnclamped: f32=dot(clearCoatNormalW,viewDirectionW);var clearCoatNdotV: f32=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvar clearCoatVRefract: vec3f=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvar environmentClearCoatBrdf: vec3f=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nvar clearCoatAlphaG: f32=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvar environmentClearCoatRadiance: vec4f= vec4f(0.,0.,0.,0.);var clearCoatReflectionVector: vec3f=computeReflectionCoords( vec4f(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvar clearCoatReflectionCoords: vec3f=clearCoatReflectionVector;\n#else\nvar clearCoatReflectionCoords: vec2f=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nenvironmentClearCoatRadiance=sampleReflectionTexture(\nclearCoatAlphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,clearCoatNdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,clearCoatRoughness\n#endif\n,reflectionSampler\n,reflectionSamplerSampler\n,clearCoatReflectionCoords\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif \n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvar clearCoatEnvironmentReflectance: vec3f=getReflectanceFromBRDFLookup(vec3f(uniforms.vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nvar clearCoatEho: f32=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);clearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvar clearCoatEnvironmentReflectance: vec3f=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV, vec3f(1.), vec3f(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nvar fresnelIBLClearCoat: f32=fresnelSchlickGGX(clearCoatNdotV,uniforms.vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnelIBLClearCoat*=clearCoatIntensity;outParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\nreturn outParams;}\n#endif\n"}}),Xo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockIridescence.js"(){c(),"pbrBlockIridescence","struct iridescenceOutParams\n{iridescenceIntensity: f32,\niridescenceIOR: f32,\niridescenceThickness: f32,\nspecularEnvironmentR0: vec3f};\n#ifdef IRIDESCENCE\nfn iridescenceBlock(\nvIridescenceParams: vec4f\n,viewAngle: f32\n,specularEnvironmentR0: vec3f\n#ifdef IRIDESCENCE_TEXTURE\n,iridescenceMapData: vec2f\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,iridescenceThicknessMapData: vec2f\n#endif\n#ifdef CLEARCOAT\n,NdotVUnclamped: f32\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData: vec2f\n#endif\n#endif\n)->iridescenceOutParams\n{var outParams: iridescenceOutParams;var iridescenceIntensity: f32=vIridescenceParams.x;var iridescenceIOR: f32=vIridescenceParams.y;var iridescenceThicknessMin: f32=vIridescenceParams.z;var iridescenceThicknessMax: f32=vIridescenceParams.w;var iridescenceThicknessWeight: f32=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nvar iridescenceThickness: f32=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);var topIor: f32=1.; \n#ifdef CLEARCOAT\nvar clearCoatIntensity: f32=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,uniforms.vClearCoatRefractionParams.w-1.,clearCoatIntensity);viewAngle=sqrt(1.0+((1.0/topIor)*(1.0/topIor))*((NdotVUnclamped*NdotVUnclamped)-1.0));\n#endif\nvar iridescenceFresnel: vec3f=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);outParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);outParams.iridescenceIntensity=iridescenceIntensity;outParams.iridescenceThickness=iridescenceThickness;outParams.iridescenceIOR=iridescenceIOR;return outParams;}\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockIridescence="struct iridescenceOutParams\n{iridescenceIntensity: f32,\niridescenceIOR: f32,\niridescenceThickness: f32,\nspecularEnvironmentR0: vec3f};\n#ifdef IRIDESCENCE\nfn iridescenceBlock(\nvIridescenceParams: vec4f\n,viewAngle: f32\n,specularEnvironmentR0: vec3f\n#ifdef IRIDESCENCE_TEXTURE\n,iridescenceMapData: vec2f\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,iridescenceThicknessMapData: vec2f\n#endif\n#ifdef CLEARCOAT\n,NdotVUnclamped: f32\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData: vec2f\n#endif\n#endif\n)->iridescenceOutParams\n{var outParams: iridescenceOutParams;var iridescenceIntensity: f32=vIridescenceParams.x;var iridescenceIOR: f32=vIridescenceParams.y;var iridescenceThicknessMin: f32=vIridescenceParams.z;var iridescenceThicknessMax: f32=vIridescenceParams.w;var iridescenceThicknessWeight: f32=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nvar iridescenceThickness: f32=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);var topIor: f32=1.; \n#ifdef CLEARCOAT\nvar clearCoatIntensity: f32=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,uniforms.vClearCoatRefractionParams.w-1.,clearCoatIntensity);viewAngle=sqrt(1.0+((1.0/topIor)*(1.0/topIor))*((NdotVUnclamped*NdotVUnclamped)-1.0));\n#endif\nvar iridescenceFresnel: vec3f=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);outParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);outParams.iridescenceIntensity=iridescenceIntensity;outParams.iridescenceThickness=iridescenceThickness;outParams.iridescenceIOR=iridescenceIOR;return outParams;}\n#endif\n"}}),Yo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockSubSurface.js"(){c(),"pbrBlockSubSurface","struct subSurfaceOutParams\n{specularEnvironmentReflectance: vec3f,\n#ifdef SS_REFRACTION\nfinalRefraction: vec3f,\nsurfaceAlbedo: vec3f,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha: f32,\n#endif\n#ifdef REFLECTION\nrefractionFactorForIrradiance: f32,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\ntransmittance: vec3f,\ntranslucencyIntensity: f32,\n#ifdef REFLECTION\nrefractionIrradiance: vec3f,\n#endif\n#endif\n#if DEBUGMODE>0\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nthicknessMap: vec4f,\n#endif\n#ifdef SS_REFRACTION\nenvironmentRefraction: vec4f,\nrefractionTransmittance: vec3f\n#endif\n#endif\n};\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#define pbr_inline\nfn sampleEnvironmentRefraction(\nior: f32\n,thickness: f32\n,refractionLOD: f32\n,normalW: vec3f\n,vPositionW: vec3f\n,viewDirectionW: vec3f\n,view: mat4x4f\n,vRefractionInfos: vec4f\n,refractionMatrix: mat4x4f\n,vRefractionMicrosurfaceInfos: vec4f\n,alphaG: f32\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler: texture_cube<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_cube<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_cube<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#else\n,refractionSampler: texture_2d<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_2d<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_2d<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo: vec2f\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition: vec3f\n,refractionSize: vec3f\n#endif\n)->vec4f {var environmentRefraction: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvar refractionVector: vec3f=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,ior);\n#else\nvar refractionVector: vec3f=refract(-viewDirectionW,normalW,ior);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;var refractionCoords: vec3f=refractionVector;refractionCoords= (refractionMatrix* vec4f(refractionCoords,0)).xyz;\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvar vRefractionUVW: vec3f= (refractionMatrix*(view* vec4f(vPositionW+refractionVector*thickness,1.0))).xyz;\n#else\nvar vRefractionUVW: vec3f= (refractionMatrix*(view* vec4f(vPositionW+refractionVector*vRefractionInfos.z,1.0))).xyz;\n#endif\nvar refractionCoords: vec2f=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODBASEDMICROSFURACE\nvar lod=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nvar automaticRefractionLOD: f32=UNPACK_LOD(textureSample(refractionSampler,refractionSamplerSampler,refractionCoords).a);var requestedRefractionLOD: f32=max(automaticRefractionLOD,lod);\n#else\nvar requestedRefractionLOD: f32=lod;\n#endif\n#if defined(REALTIME_FILTERING) && defined(SS_REFRACTIONMAP_3D)\nenvironmentRefraction= vec4f(radiance(alphaG,refractionSampler,refractionSamplerSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=textureSampleLevel(refractionSampler,refractionSamplerSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nvar lodRefractionNormalized: f32=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));var lodRefractionNormalizedDoubled: f32=lodRefractionNormalized*2.0;var environmentRefractionMid: vec4f=textureSample(refractionSampler,refractionSamplerSampler,refractionCoords);if (lodRefractionNormalizedDoubled<1.0){environmentRefraction=mix(\ntextureSample(refractionHighSampler,refractionHighSamplerSampler,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);} else {environmentRefraction=mix(\nenvironmentRefractionMid,\ntextureSample(refractionLowSampler,refractionLowSamplerSampler,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);}\n#endif\nvar refraction=environmentRefraction.rgb;\n#ifdef SS_RGBDREFRACTION\nrefraction=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nrefraction=toLinearSpaceVec3(environmentRefraction.rgb);\n#endif\nreturn vec4f(refraction,environmentRefraction.a);}\n#endif\n#define pbr_inline\nfn subSurfaceBlock(\nvSubSurfaceIntensity: vec3f\n,vThicknessParam: vec2f\n,vTintColor: vec4f\n,normalW: vec3f\n,specularEnvironmentReflectance: vec3f\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,thicknessMap: vec4f\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,refractionIntensityMap: vec4f\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,translucencyIntensityMap: vec4f\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,reflectionMatrix: mat4x4f\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,irradianceVector_: vec3f\n#endif\n#if defined(REALTIME_FILTERING)\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,vReflectionFilteringInfo: vec2f\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,irradianceSampler: texture_cube<f32>\n,irradianceSamplerSampler: sampler\n#else\n,irradianceSampler: texture_2d<f32>\n,irradianceSamplerSampler: sampler\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,surfaceAlbedo: vec3f\n#endif\n#ifdef SS_REFRACTION\n,vPositionW: vec3f\n,viewDirectionW: vec3f\n,view: mat4x4f\n,vRefractionInfos: vec4f\n,refractionMatrix: mat4x4f\n,vRefractionMicrosurfaceInfos: vec4f\n,vLightingIntensity: vec4f\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,alpha: f32\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,NdotVUnclamped: f32\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,roughness: f32\n#endif\n,alphaG: f32\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler: texture_cube<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_cube<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_cube<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#else\n,refractionSampler: texture_2d<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_2d<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_2d<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo: vec2f\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition: vec3f\n,refractionSize: vec3f\n#endif\n#ifdef SS_DISPERSION\n,dispersion: f32\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,vDiffusionDistance: vec3f\n,vTranslucencyColor: vec4f\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,translucencyColorMap: vec4f\n#endif\n#endif\n)->subSurfaceOutParams\n{var outParams: subSurfaceOutParams;outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvar refractionIntensity: f32=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);outParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvar translucencyIntensity: f32=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nvar thickness: f32=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nvar thickness: f32=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=thicknessMap.a;\n#else\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nvar thickness: f32=vThicknessParam.y;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTIONINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCYINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=translucencyIntensityMap.a;\n#else\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);var translucencyColor: vec4f=vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\ntranslucencyColor*=translucencyColorMap;\n#endif\nvar transmittance: vec3f=transmittanceBRDF_Burley(translucencyColor.rgb,vDiffusionDistance,thickness);transmittance*=translucencyIntensity;outParams.transmittance=transmittance;outParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvar environmentRefraction: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef SS_HAS_THICKNESS\nvar ior: f32=vRefractionInfos.y;\n#else\nvar ior: f32=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nvar refractionAlphaG: f32=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLodFromAlphaGNdotV(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nvar refractionRoughness: f32=alphaG;refractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nvar refractionAlphaG: f32=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\nvar refraction_ior: f32=vRefractionInfos.y;\n#ifdef SS_DISPERSION\nvar realIOR: f32=1.0/refraction_ior;var iorDispersionSpread: f32=0.04*dispersion*(realIOR-1.0);var iors: vec3f= vec3f(1.0/(realIOR-iorDispersionSpread),refraction_ior,1.0/(realIOR+iorDispersionSpread));for (var i: i32=0; i<3; i++) {refraction_ior=iors[i];\n#endif\nvar envSample: vec4f=sampleEnvironmentRefraction(refraction_ior,thickness,refractionLOD,normalW,vPositionW,viewDirectionW,view,vRefractionInfos,refractionMatrix,vRefractionMicrosurfaceInfos,alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler\n,refractionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler\n,refractionLowSamplerSampler\n,refractionHighSampler\n,refractionHighSamplerSampler\n#endif\n#else\n,refractionSampler\n,refractionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler\n,refractionLowSamplerSampler\n,refractionHighSampler\n,refractionHighSamplerSampler\n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition\n,refractionSize\n#endif\n);\n#ifdef SS_DISPERSION\nenvironmentRefraction[i]=envSample[i];}\n#else\nenvironmentRefraction=envSample;\n#endif\nenvironmentRefraction=vec4f(environmentRefraction.rgb*vRefractionInfos.x,environmentRefraction.a);\n#endif\n#ifdef SS_REFRACTION\nvar refractionTransmittance: vec3f= vec3f(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvar volumeAlbedo: vec3f=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambertVec3(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nvar maxChannel: f32=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);var volumeAlbedo: vec3f=saturateVec3(maxChannel*surfaceAlbedo);environmentRefraction=vec4f(environmentRefraction.rgb*volumeAlbedo,environmentRefraction.a);\n#else\nvar volumeAlbedo: vec3f=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambertVec3(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction=vec4f(environmentRefraction.rgb*surfaceAlbedo.rgb,environmentRefraction.a);\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvar bounceSpecularEnvironmentReflectance: vec3f=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvar irradianceVector: vec3f=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvar refractionIrradiance: vec3f=irradiance(reflectionSampler,reflectionSamplerSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvar refractionIrradiance: vec3f=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvar irradianceCoords: vec3f=irradianceVector;\n#else\nvar irradianceCoords: vec2f=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvar temp: vec4f=textureSample(irradianceSampler,irradianceSamplerSampler,-irradianceCoords);var refractionIrradiance=temp.rgb;\n#ifdef RGBDREFLECTION\nrefractionIrradiance=fromRGBD(temp).rgb;\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance=toLinearSpaceVec3(refractionIrradiance);\n#endif\n#else\nvar refractionIrradiance: vec3f= vec3f(0.);\n#endif\nrefractionIrradiance*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance;\n#endif\nreturn outParams;}\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockSubSurface="struct subSurfaceOutParams\n{specularEnvironmentReflectance: vec3f,\n#ifdef SS_REFRACTION\nfinalRefraction: vec3f,\nsurfaceAlbedo: vec3f,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha: f32,\n#endif\n#ifdef REFLECTION\nrefractionFactorForIrradiance: f32,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\ntransmittance: vec3f,\ntranslucencyIntensity: f32,\n#ifdef REFLECTION\nrefractionIrradiance: vec3f,\n#endif\n#endif\n#if DEBUGMODE>0\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nthicknessMap: vec4f,\n#endif\n#ifdef SS_REFRACTION\nenvironmentRefraction: vec4f,\nrefractionTransmittance: vec3f\n#endif\n#endif\n};\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#define pbr_inline\nfn sampleEnvironmentRefraction(\nior: f32\n,thickness: f32\n,refractionLOD: f32\n,normalW: vec3f\n,vPositionW: vec3f\n,viewDirectionW: vec3f\n,view: mat4x4f\n,vRefractionInfos: vec4f\n,refractionMatrix: mat4x4f\n,vRefractionMicrosurfaceInfos: vec4f\n,alphaG: f32\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler: texture_cube<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_cube<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_cube<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#else\n,refractionSampler: texture_2d<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_2d<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_2d<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo: vec2f\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition: vec3f\n,refractionSize: vec3f\n#endif\n)->vec4f {var environmentRefraction: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvar refractionVector: vec3f=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,ior);\n#else\nvar refractionVector: vec3f=refract(-viewDirectionW,normalW,ior);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;var refractionCoords: vec3f=refractionVector;refractionCoords= (refractionMatrix* vec4f(refractionCoords,0)).xyz;\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvar vRefractionUVW: vec3f= (refractionMatrix*(view* vec4f(vPositionW+refractionVector*thickness,1.0))).xyz;\n#else\nvar vRefractionUVW: vec3f= (refractionMatrix*(view* vec4f(vPositionW+refractionVector*vRefractionInfos.z,1.0))).xyz;\n#endif\nvar refractionCoords: vec2f=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODBASEDMICROSFURACE\nvar lod=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nvar automaticRefractionLOD: f32=UNPACK_LOD(textureSample(refractionSampler,refractionSamplerSampler,refractionCoords).a);var requestedRefractionLOD: f32=max(automaticRefractionLOD,lod);\n#else\nvar requestedRefractionLOD: f32=lod;\n#endif\n#if defined(REALTIME_FILTERING) && defined(SS_REFRACTIONMAP_3D)\nenvironmentRefraction= vec4f(radiance(alphaG,refractionSampler,refractionSamplerSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=textureSampleLevel(refractionSampler,refractionSamplerSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nvar lodRefractionNormalized: f32=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));var lodRefractionNormalizedDoubled: f32=lodRefractionNormalized*2.0;var environmentRefractionMid: vec4f=textureSample(refractionSampler,refractionSamplerSampler,refractionCoords);if (lodRefractionNormalizedDoubled<1.0){environmentRefraction=mix(\ntextureSample(refractionHighSampler,refractionHighSamplerSampler,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);} else {environmentRefraction=mix(\nenvironmentRefractionMid,\ntextureSample(refractionLowSampler,refractionLowSamplerSampler,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);}\n#endif\nvar refraction=environmentRefraction.rgb;\n#ifdef SS_RGBDREFRACTION\nrefraction=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nrefraction=toLinearSpaceVec3(environmentRefraction.rgb);\n#endif\nreturn vec4f(refraction,environmentRefraction.a);}\n#endif\n#define pbr_inline\nfn subSurfaceBlock(\nvSubSurfaceIntensity: vec3f\n,vThicknessParam: vec2f\n,vTintColor: vec4f\n,normalW: vec3f\n,specularEnvironmentReflectance: vec3f\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,thicknessMap: vec4f\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,refractionIntensityMap: vec4f\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,translucencyIntensityMap: vec4f\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,reflectionMatrix: mat4x4f\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,irradianceVector_: vec3f\n#endif\n#if defined(REALTIME_FILTERING)\n,reflectionSampler: texture_cube<f32>\n,reflectionSamplerSampler: sampler\n,vReflectionFilteringInfo: vec2f\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,irradianceSampler: texture_cube<f32>\n,irradianceSamplerSampler: sampler\n#else\n,irradianceSampler: texture_2d<f32>\n,irradianceSamplerSampler: sampler\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,surfaceAlbedo: vec3f\n#endif\n#ifdef SS_REFRACTION\n,vPositionW: vec3f\n,viewDirectionW: vec3f\n,view: mat4x4f\n,vRefractionInfos: vec4f\n,refractionMatrix: mat4x4f\n,vRefractionMicrosurfaceInfos: vec4f\n,vLightingIntensity: vec4f\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,alpha: f32\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,NdotVUnclamped: f32\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,roughness: f32\n#endif\n,alphaG: f32\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler: texture_cube<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_cube<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_cube<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#else\n,refractionSampler: texture_2d<f32>\n,refractionSamplerSampler: sampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler: texture_2d<f32>\n,refractionLowSamplerSampler: sampler\n,refractionHighSampler: texture_2d<f32>\n,refractionHighSamplerSampler: sampler \n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut: anisotropicOutParams\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo: vec2f\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition: vec3f\n,refractionSize: vec3f\n#endif\n#ifdef SS_DISPERSION\n,dispersion: f32\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,vDiffusionDistance: vec3f\n,vTranslucencyColor: vec4f\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,translucencyColorMap: vec4f\n#endif\n#endif\n)->subSurfaceOutParams\n{var outParams: subSurfaceOutParams;outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvar refractionIntensity: f32=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);outParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvar translucencyIntensity: f32=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nvar thickness: f32=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nvar thickness: f32=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=thicknessMap.a;\n#else\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nvar thickness: f32=vThicknessParam.y;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTIONINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCYINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=translucencyIntensityMap.a;\n#else\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);var translucencyColor: vec4f=vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\ntranslucencyColor*=translucencyColorMap;\n#endif\nvar transmittance: vec3f=transmittanceBRDF_Burley(translucencyColor.rgb,vDiffusionDistance,thickness);transmittance*=translucencyIntensity;outParams.transmittance=transmittance;outParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvar environmentRefraction: vec4f= vec4f(0.,0.,0.,0.);\n#ifdef SS_HAS_THICKNESS\nvar ior: f32=vRefractionInfos.y;\n#else\nvar ior: f32=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nvar refractionAlphaG: f32=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLodFromAlphaGNdotV(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nvar refractionRoughness: f32=alphaG;refractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nvar refractionAlphaG: f32=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));var refractionLOD: f32=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\nvar refraction_ior: f32=vRefractionInfos.y;\n#ifdef SS_DISPERSION\nvar realIOR: f32=1.0/refraction_ior;var iorDispersionSpread: f32=0.04*dispersion*(realIOR-1.0);var iors: vec3f= vec3f(1.0/(realIOR-iorDispersionSpread),refraction_ior,1.0/(realIOR+iorDispersionSpread));for (var i: i32=0; i<3; i++) {refraction_ior=iors[i];\n#endif\nvar envSample: vec4f=sampleEnvironmentRefraction(refraction_ior,thickness,refractionLOD,normalW,vPositionW,viewDirectionW,view,vRefractionInfos,refractionMatrix,vRefractionMicrosurfaceInfos,alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler\n,refractionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler\n,refractionLowSamplerSampler\n,refractionHighSampler\n,refractionHighSamplerSampler\n#endif\n#else\n,refractionSampler\n,refractionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler\n,refractionLowSamplerSampler\n,refractionHighSampler\n,refractionHighSamplerSampler\n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition\n,refractionSize\n#endif\n);\n#ifdef SS_DISPERSION\nenvironmentRefraction[i]=envSample[i];}\n#else\nenvironmentRefraction=envSample;\n#endif\nenvironmentRefraction=vec4f(environmentRefraction.rgb*vRefractionInfos.x,environmentRefraction.a);\n#endif\n#ifdef SS_REFRACTION\nvar refractionTransmittance: vec3f= vec3f(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvar volumeAlbedo: vec3f=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambertVec3(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nvar maxChannel: f32=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);var volumeAlbedo: vec3f=saturateVec3(maxChannel*surfaceAlbedo);environmentRefraction=vec4f(environmentRefraction.rgb*volumeAlbedo,environmentRefraction.a);\n#else\nvar volumeAlbedo: vec3f=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambertVec3(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction=vec4f(environmentRefraction.rgb*surfaceAlbedo.rgb,environmentRefraction.a);\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvar bounceSpecularEnvironmentReflectance: vec3f=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvar irradianceVector: vec3f= (reflectionMatrix* vec4f(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvar irradianceVector: vec3f=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvar refractionIrradiance: vec3f=irradiance(reflectionSampler,reflectionSamplerSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvar refractionIrradiance: vec3f=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvar irradianceCoords: vec3f=irradianceVector;\n#else\nvar irradianceCoords: vec2f=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvar temp: vec4f=textureSample(irradianceSampler,irradianceSamplerSampler,-irradianceCoords);var refractionIrradiance=temp.rgb;\n#ifdef RGBDREFLECTION\nrefractionIrradiance=fromRGBD(temp).rgb;\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance=toLinearSpaceVec3(refractionIrradiance);\n#endif\n#else\nvar refractionIrradiance: vec3f= vec3f(0.);\n#endif\nrefractionIrradiance*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance;\n#endif\nreturn outParams;}\n#endif\n"}}),jo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockNormalGeometric.js"(){c(),"pbrBlockNormalGeometric","var viewDirectionW: vec3f=normalize(scene.vEyePosition.xyz-input.vPositionW);\n#ifdef NORMAL\nvar normalW: vec3f=normalize(input.vNormalW);\n#else\nvar normalW: vec3f=normalize(cross(dpdx(input.vPositionW),dpdy(input.vPositionW)))*scene.vEyePosition.w;\n#endif\nvar geometricNormalW: vec3f=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=select(-geometricNormalW,geometricNormalW,fragmentInputs.frontFacing);\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockNormalGeometric="var viewDirectionW: vec3f=normalize(scene.vEyePosition.xyz-input.vPositionW);\n#ifdef NORMAL\nvar normalW: vec3f=normalize(input.vNormalW);\n#else\nvar normalW: vec3f=normalize(cross(dpdx(input.vPositionW),dpdy(input.vPositionW)))*scene.vEyePosition.w;\n#endif\nvar geometricNormalW: vec3f=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=select(-geometricNormalW,geometricNormalW,fragmentInputs.frontFacing);\n#endif\n"}}),Ko=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockNormalFinal.js"(){c(),"pbrBlockNormalFinal","#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvar faceNormal: vec3f=normalize(cross(dpdx(fragmentInputs.vPositionW),dpdy(fragmentInputs.vPositionW)))*scene.vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=select(-faceNormal,faceNormal,fragmentInputs.frontFacing);\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=select(-normalW,normalW,fragmentInputs.frontFacing);\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockNormalFinal="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvar faceNormal: vec3f=normalize(cross(dpdx(fragmentInputs.vPositionW),dpdy(fragmentInputs.vPositionW)))*scene.vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=select(-faceNormal,faceNormal,fragmentInputs.frontFacing);\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=select(-normalW,normalW,fragmentInputs.frontFacing);\n#endif\n"}}),$o=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockLightmapInit.js"(){c(),"pbrBlockLightmapInit","#ifdef LIGHTMAP\nvar lightmapColor: vec4f=textureSample(lightmapSampler,lightmapSamplerSampler,fragmentInputs.vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor=vec4f(fromRGBD(lightmapColor),lightmapColor.a);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor=vec4f(toLinearSpaceVec3(lightmapColor.rgb),lightmapColor.a);\n#endif\nlightmapColor=vec4f(lightmapColor.rgb*uniforms.vLightmapInfos.y,lightmapColor.a);\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockLightmapInit="#ifdef LIGHTMAP\nvar lightmapColor: vec4f=textureSample(lightmapSampler,lightmapSamplerSampler,fragmentInputs.vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor=vec4f(fromRGBD(lightmapColor),lightmapColor.a);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor=vec4f(toLinearSpaceVec3(lightmapColor.rgb),lightmapColor.a);\n#endif\nlightmapColor=vec4f(lightmapColor.rgb*uniforms.vLightmapInfos.y,lightmapColor.a);\n#endif\n"}}),qo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockGeometryInfo.js"(){c(),"pbrBlockGeometryInfo","var NdotVUnclamped: f32=dot(normalW,viewDirectionW);var NdotV: f32=absEps(NdotVUnclamped);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var AARoughnessFactors: vec2f=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvar environmentBrdf: vec3f=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nvar ambientMonochrome: f32=aoOut.ambientOcclusionColor.r;\n#else\nvar ambientMonochrome: f32=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nvar seo: f32=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nvar eho: f32=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockGeometryInfo="var NdotVUnclamped: f32=dot(normalW,viewDirectionW);var NdotV: f32=absEps(NdotVUnclamped);var alphaG: f32=convertRoughnessToAverageSlope(roughness);var AARoughnessFactors: vec2f=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvar environmentBrdf: vec3f=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nvar ambientMonochrome: f32=aoOut.ambientOcclusionColor.r;\n#else\nvar ambientMonochrome: f32=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nvar seo: f32=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nvar eho: f32=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n"}}),Jo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockReflectance0.js"(){c(),"pbrBlockReflectance0","var reflectance: f32=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);var specularEnvironmentR0: vec3f=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvar specularEnvironmentR90: vec3f= vec3f(metallicReflectanceFactors.a);\n#else \nvar specularEnvironmentR90: vec3f= vec3f(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nvar reflectance90: f32=fresnelGrazingReflectance(reflectance);specularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockReflectance0="var reflectance: f32=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);var specularEnvironmentR0: vec3f=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvar specularEnvironmentR90: vec3f= vec3f(metallicReflectanceFactors.a);\n#else \nvar specularEnvironmentR90: vec3f= vec3f(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nvar reflectance90: f32=fresnelGrazingReflectance(reflectance);specularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n"}}),Qo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockReflectance.js"(){c(),"pbrBlockReflectance","#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvar specularEnvironmentReflectance: vec3f=getReflectanceFromBRDFWithEnvLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvar specularEnvironmentReflectance: vec3f=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockReflectance="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvar specularEnvironmentReflectance: vec3f=getReflectanceFromBRDFWithEnvLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvar specularEnvironmentReflectance: vec3f=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n"}}),Zo=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockDirectLighting.js"(){c(),"pbrBlockDirectLighting","var diffuseBase: vec3f=vec3f(0.,0.,0.);\n#ifdef SPECULARTERM\nvar specularBase: vec3f=vec3f(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvar clearCoatBase: vec3f=vec3f(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvar sheenBase: vec3f=vec3f(0.,0.,0.);\n#endif\nvar preInfo: preLightingInfo;var info: lightingInfo;var shadow: f32=1.; \nvar aggShadow: f32=0.;var numLights: f32=0.;\n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvar absorption: vec3f=vec3f(0.);\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockDirectLighting="var diffuseBase: vec3f=vec3f(0.,0.,0.);\n#ifdef SPECULARTERM\nvar specularBase: vec3f=vec3f(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvar clearCoatBase: vec3f=vec3f(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvar sheenBase: vec3f=vec3f(0.,0.,0.);\n#endif\nvar preInfo: preLightingInfo;var info: lightingInfo;var shadow: f32=1.; \nvar aggShadow: f32=0.;var numLights: f32=0.;\n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvar absorption: vec3f=vec3f(0.);\n#endif\n"}}),el=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockFinalLitComponents.js"(){c(),"pbrBlockFinalLitComponents","aggShadow=aggShadow/numLights;\n#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvar energyConservationFactor: vec3f=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvar finalIrradiance: vec3f=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);finalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;finalIrradiance*=uniforms.vLightingIntensity.z;finalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvar finalSpecular: vec3f=specularBase;finalSpecular=max(finalSpecular,vec3f(0.0));var finalSpecularScaled: vec3f=finalSpecular*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvar finalRadiance: vec3f=reflectionOut.environmentRadiance.rgb;finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;var finalRadianceScaled: vec3f=finalRadiance*uniforms.vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvar finalSheen: vec3f=sheenBase*sheenOut.sheenColor;finalSheen=max(finalSheen,vec3f(0.0));var finalSheenScaled: vec3f=finalSheen*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvar finalClearCoat: vec3f=clearCoatBase;finalClearCoat=max(finalClearCoat,vec3f(0.0));var finalClearCoatScaled: vec3f=finalClearCoat*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nvar luminanceOverAlpha: f32=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockFinalLitComponents="aggShadow=aggShadow/numLights;\n#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvar energyConservationFactor: vec3f=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvar finalIrradiance: vec3f=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);finalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;finalIrradiance*=uniforms.vLightingIntensity.z;finalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvar finalSpecular: vec3f=specularBase;finalSpecular=max(finalSpecular,vec3f(0.0));var finalSpecularScaled: vec3f=finalSpecular*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvar finalRadiance: vec3f=reflectionOut.environmentRadiance.rgb;finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;var finalRadianceScaled: vec3f=finalRadiance*uniforms.vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvar finalSheen: vec3f=sheenBase*sheenOut.sheenColor;finalSheen=max(finalSheen,vec3f(0.0));var finalSheenScaled: vec3f=finalSheen*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvar finalClearCoat: vec3f=clearCoatBase;finalClearCoat=max(finalClearCoat,vec3f(0.0));var finalClearCoatScaled: vec3f=finalClearCoat*uniforms.vLightingIntensity.x*uniforms.vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nvar luminanceOverAlpha: f32=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n"}}),tl=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockFinalUnlitComponents.js"(){c(),"pbrBlockFinalUnlitComponents","var finalDiffuse: vec3f=diffuseBase;finalDiffuse*=surfaceAlbedo.rgb;finalDiffuse=max(finalDiffuse,vec3f(0.0));finalDiffuse*=uniforms.vLightingIntensity.x;var finalAmbient: vec3f=uniforms.vAmbientColor;finalAmbient*=surfaceAlbedo.rgb;var finalEmissive: vec3f=uniforms.vEmissiveColor;\n#ifdef EMISSIVE\nvar emissiveColorTex: vec3f=textureSample(emissiveSampler,emissiveSamplerSampler,fragmentInputs.vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpaceVec3(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= uniforms.vEmissiveInfos.y;\n#endif\nfinalEmissive*=uniforms.vLightingIntensity.y;\n#ifdef AMBIENT\nvar ambientOcclusionForDirectDiffuse: vec3f=mix( vec3f(1.),aoOut.ambientOcclusionColor,uniforms.vAmbientInfos.w);\n#else\nvar ambientOcclusionForDirectDiffuse: vec3f=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;finalDiffuse*=ambientOcclusionForDirectDiffuse;\n",e.IncludesShadersStoreWGSL.pbrBlockFinalUnlitComponents="var finalDiffuse: vec3f=diffuseBase;finalDiffuse*=surfaceAlbedo.rgb;finalDiffuse=max(finalDiffuse,vec3f(0.0));finalDiffuse*=uniforms.vLightingIntensity.x;var finalAmbient: vec3f=uniforms.vAmbientColor;finalAmbient*=surfaceAlbedo.rgb;var finalEmissive: vec3f=uniforms.vEmissiveColor;\n#ifdef EMISSIVE\nvar emissiveColorTex: vec3f=textureSample(emissiveSampler,emissiveSamplerSampler,fragmentInputs.vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpaceVec3(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= uniforms.vEmissiveInfos.y;\n#endif\nfinalEmissive*=uniforms.vLightingIntensity.y;\n#ifdef AMBIENT\nvar ambientOcclusionForDirectDiffuse: vec3f=mix( vec3f(1.),aoOut.ambientOcclusionColor,uniforms.vAmbientInfos.w);\n#else\nvar ambientOcclusionForDirectDiffuse: vec3f=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;finalDiffuse*=ambientOcclusionForDirectDiffuse;\n"}}),il=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockFinalColorComposition.js"(){c(),"pbrBlockFinalColorComposition","var finalColor: vec4f= vec4f(\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalAmbient +\nfinalDiffuse,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor=vec4f(finalColor.rgb*lightmapColor.rgb,finalColor.a);\n#else\nfinalColor=vec4f(finalColor.rgb+lightmapColor.rgb,finalColor.a);\n#endif\n#endif\n#endif\nfinalColor=vec4f(finalColor.rgb+finalEmissive,finalColor.a);\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,vec4f(0.0));\n",e.IncludesShadersStoreWGSL.pbrBlockFinalColorComposition="var finalColor: vec4f= vec4f(\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalAmbient +\nfinalDiffuse,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor=vec4f(finalColor.rgb*lightmapColor.rgb,finalColor.a);\n#else\nfinalColor=vec4f(finalColor.rgb+lightmapColor.rgb,finalColor.a);\n#endif\n#endif\n#endif\nfinalColor=vec4f(finalColor.rgb+finalEmissive,finalColor.a);\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,vec4f(0.0));\n"}}),nl=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrBlockImageProcessing.js"(){c(),"pbrBlockImageProcessing","#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor=vec4f(clamp(finalColor.rgb,vec3f(0.),vec3f(30.0)),finalColor.a);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor=vec4f(finalColor.rgb,finalColor.a*mesh.visibility);\n#ifdef PREMULTIPLYALPHA\nfinalColor=vec4f(finalColor.rgb*finalColor.a,finalColor.a);;\n#endif\n",e.IncludesShadersStoreWGSL.pbrBlockImageProcessing="#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor=vec4f(clamp(finalColor.rgb,vec3f(0.),vec3f(30.0)),finalColor.a);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor=vec4f(finalColor.rgb,finalColor.a*mesh.visibility);\n#ifdef PREMULTIPLYALPHA\nfinalColor=vec4f(finalColor.rgb*finalColor.a,finalColor.a);;\n#endif\n"}}),al=o({"../node_modules/@babylonjs/core/ShadersWGSL/ShadersInclude/pbrDebug.js"(){c(),"pbrDebug","#if DEBUGMODE>0\nif (input.vClipSpacePosition.x/input.vClipSpacePosition.w>=uniforms.vDebugMode.x) {var color: vec3f;\n#if DEBUGMODE==1\ncolor=fragmentInputs.vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ncolor=fragmentInputs.vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ncolor=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ncolor=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ncolor=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ncolor= vec3f(input.vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ncolor= vec3f(input.vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ncolor=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ncolor=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ncolor=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ncolor=albedoTexture.rgb;\n#ifndef GAMMAALBEDO\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==21 && defined(AMBIENT)\ncolor=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ncolor=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ncolor=emissiveColorTex.rgb;\n#ifndef GAMMAEMISSIVE\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ncolor=lightmapColor;\n#ifndef GAMMALIGHTMAP\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ncolor=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ncolor=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ncolor= vec3f(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ncolor=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ncolor=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ncolor=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ncolor=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==32 && defined(BUMP)\ncolor=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ncolor=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ncolor=reflectionOut.environmentRadiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ncolor=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ncolor=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ncolor=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ncolor=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ncolor=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ncolor=reflectionOut.environmentIrradiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==60\ncolor=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ncolor=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ncolor= vec3f(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ncolor=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ncolor= vec3f(roughness);\n#elif DEBUGMODE==64\ncolor= vec3f(alphaG);\n#elif DEBUGMODE==65\ncolor= vec3f(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ncolor=clearcoatOut.clearCoatColor;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ncolor= vec3f(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ncolor= vec3f(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ncolor=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ncolor=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==72\ncolor= vec3f(microSurface);\n#elif DEBUGMODE==73\ncolor=uniforms.vAlbedoColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==74 && !defined(METALLICWORKFLOW)\ncolor=uniforms.vReflectivityColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==75\ncolor=uniforms.vEmissiveColor;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ncolor= vec3f(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\ncolor= vec3f(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ncolor= vec3f(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ncolor=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ncolor=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ncolor=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ncolor= vec3f(luminanceOverAlpha);\n#elif DEBUGMODE==87\ncolor= vec3f(alpha);\n#elif DEBUGMODE==88 && defined(ALBEDO)\ncolor= vec3f(albedoTexture.a);\n#elif DEBUGMODE==89\ncolor=aoOut.ambientOcclusionColor;\n#else\nvar stripeWidth: f32=30.;var stripePos: f32=abs(floor(input.position.x/stripeWidth));var whichColor: f32=((stripePos)%(2.));var color1: vec3f= vec3f(.6,.2,.2);var color2: vec3f= vec3f(.3,.1,.1);color=mix(color1,color2,whichColor);\n#endif\ncolor*=uniforms.vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ncolor=normalize(color)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ncolor=toGammaSpaceVec3(color);\n#endif\nfragmentOutputs.color=vec4f(color,1.0);\n#ifdef PREPASS\nfragmentOutputs.fragData0=toLinearSpaceVec3(color); \nfragmentOutputs.fragData1=vec4f(0.,0.,0.,0.); \n#endif\n#ifdef DEBUGMODE_FORCERETURN\nreturn fragmentOutputs;\n#endif\n}\n#endif\n",e.IncludesShadersStoreWGSL.pbrDebug="#if DEBUGMODE>0\nif (input.vClipSpacePosition.x/input.vClipSpacePosition.w>=uniforms.vDebugMode.x) {var color: vec3f;\n#if DEBUGMODE==1\ncolor=fragmentInputs.vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ncolor=fragmentInputs.vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ncolor=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ncolor=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ncolor=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ncolor= vec3f(input.vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ncolor= vec3f(input.vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ncolor=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ncolor=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ncolor=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ncolor=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ncolor=albedoTexture.rgb;\n#ifndef GAMMAALBEDO\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==21 && defined(AMBIENT)\ncolor=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ncolor=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ncolor=emissiveColorTex.rgb;\n#ifndef GAMMAEMISSIVE\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ncolor=lightmapColor;\n#ifndef GAMMALIGHTMAP\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ncolor=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ncolor=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ncolor= vec3f(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ncolor=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ncolor=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ncolor=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ncolor=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==32 && defined(BUMP)\ncolor=textureSample(bumpSampler,bumpSamplerSampler,fragmentInputs.vBumpUV).rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ncolor=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ncolor=reflectionOut.environmentRadiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ncolor=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ncolor=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ncolor=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ncolor=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ncolor=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ncolor=reflectionOut.environmentIrradiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==60\ncolor=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ncolor=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ncolor= vec3f(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ncolor=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ncolor= vec3f(roughness);\n#elif DEBUGMODE==64\ncolor= vec3f(alphaG);\n#elif DEBUGMODE==65\ncolor= vec3f(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ncolor=clearcoatOut.clearCoatColor;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ncolor= vec3f(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ncolor= vec3f(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ncolor=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ncolor=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==72\ncolor= vec3f(microSurface);\n#elif DEBUGMODE==73\ncolor=uniforms.vAlbedoColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==74 && !defined(METALLICWORKFLOW)\ncolor=uniforms.vReflectivityColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==75\ncolor=uniforms.vEmissiveColor;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ncolor= vec3f(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\ncolor= vec3f(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ncolor= vec3f(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ncolor=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ncolor=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ncolor=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ncolor= vec3f(luminanceOverAlpha);\n#elif DEBUGMODE==87\ncolor= vec3f(alpha);\n#elif DEBUGMODE==88 && defined(ALBEDO)\ncolor= vec3f(albedoTexture.a);\n#elif DEBUGMODE==89\ncolor=aoOut.ambientOcclusionColor;\n#else\nvar stripeWidth: f32=30.;var stripePos: f32=abs(floor(input.position.x/stripeWidth));var whichColor: f32=((stripePos)%(2.));var color1: vec3f= vec3f(.6,.2,.2);var color2: vec3f= vec3f(.3,.1,.1);color=mix(color1,color2,whichColor);\n#endif\ncolor*=uniforms.vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ncolor=normalize(color)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ncolor=toGammaSpaceVec3(color);\n#endif\nfragmentOutputs.color=vec4f(color,1.0);\n#ifdef PREPASS\nfragmentOutputs.fragData0=toLinearSpaceVec3(color); \nfragmentOutputs.fragData1=vec4f(0.,0.,0.,0.); \n#endif\n#ifdef DEBUGMODE_FORCERETURN\nreturn fragmentOutputs;\n#endif\n}\n#endif\n"}}),sl={};l(sl,{pbrPixelShaderWGSL:()=>Co});var rl,ol,ll,cl=o({"../node_modules/@babylonjs/core/ShadersWGSL/pbr.fragment.js"(){c(),ba(),Pa(),go(),To(),ee(),Mo(),La(),Oi(),_a(),Et(),he(),Io(),xo(),bo(),Fa(),ye(),So(),Po(),wo(),Oo(),Do(),Lo(),Fo(),ka(),Ba(),Da(),ko(),Bo(),Go(),Uo(),Ho(),Vo(),Wo(),zo(),Xo(),Yo(),Di(),jo(),Ga(),Ko(),Ha(),$o(),qo(),Jo(),Qo(),Zo(),$(),el(),tl(),il(),Va(),Wa(),nl(),za(),al(),Eo="pbrPixelShader",Ao="#define CUSTOM_FRAGMENT_BEGIN\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n#include<pbrUboDeclaration>\n#include<pbrFragmentExtraDeclaration>\n#include<lightUboDeclaration>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockIridescence>\n#include<pbrBlockSubSurface>\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\nvar albedoOpacityOut: albedoOpacityOutParams;\n#ifdef ALBEDO\nvar albedoTexture: vec4f=textureSample(albedoSampler,albedoSamplerSampler,fragmentInputs.vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvar opacityMap: vec4f=textureSample(opacitySampler,opacitySamplerSampler,fragmentInputs.vOpacityUV+uvOffset);\n#endif\n#ifdef DECAL\nvar decalColor: vec4f=textureSample(decalSampler,decalSamplerSampler,fragmentInputs.vDecalUV+uvOffset);\n#endif\nalbedoOpacityOut=albedoOpacityBlock(\nuniforms.vAlbedoColor\n#ifdef ALBEDO\n,albedoTexture\n,uniforms.vAlbedoInfos\n#endif\n#ifdef OPACITY\n,opacityMap\n,uniforms.vOpacityInfos\n#endif\n#ifdef DETAIL\n,detailColor\n,uniforms.vDetailInfos\n#endif\n#ifdef DECAL\n,decalColor\n,uniforms.vDecalInfos\n#endif\n);var surfaceAlbedo: vec3f=albedoOpacityOut.surfaceAlbedo;var alpha: f32=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\nvar aoOut: ambientOcclusionOutParams;\n#ifdef AMBIENT\nvar ambientOcclusionColorMap: vec3f=textureSample(ambientSampler,ambientSamplerSampler,fragmentInputs.vAmbientUV+uvOffset).rgb;\n#endif\naoOut=ambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nuniforms.vAmbientInfos\n#endif \n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvar diffuseBase: vec3f= vec3f(1.,1.,1.);\n#else\nvar baseColor: vec3f=surfaceAlbedo;var reflectivityOut: reflectivityOutParams;\n#if defined(REFLECTIVITY)\nvar surfaceMetallicOrReflectivityColorMap: vec4f=textureSample(reflectivitySampler,reflectivitySamplerSampler,fragmentInputs.vReflectivityUV+uvOffset);var baseReflectivity: vec4f=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\n#ifdef REFLECTIVITY_GAMMA\nsurfaceMetallicOrReflectivityColorMap=toLinearSpaceVec4(surfaceMetallicOrReflectivityColorMap);\n#endif\nsurfaceMetallicOrReflectivityColorMap=vec4f(surfaceMetallicOrReflectivityColorMap.rgb*uniforms.vReflectivityInfos.y,surfaceMetallicOrReflectivityColorMap.a);\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvar microSurfaceTexel: vec4f=textureSample(microSurfaceSampler,microSurfaceSamplerSampler,fragmentInputs.vMicroSurfaceSamplerUV+uvOffset)*uniforms.vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvar metallicReflectanceFactors: vec4f=uniforms.vMetallicReflectanceFactors;\n#ifdef REFLECTANCE\nvar reflectanceFactorsMap: vec4f=textureSample(reflectanceSampler,reflectanceSamplerSampler,fragmentInputs.vReflectanceUV+uvOffset);\n#ifdef REFLECTANCE_GAMMA\nreflectanceFactorsMap=toLinearSpaceVec4(reflectanceFactorsMap);\n#endif\nmetallicReflectanceFactors=vec4f(metallicReflectanceFactors.rgb*reflectanceFactorsMap.rgb,metallicReflectanceFactors.a);\n#endif\n#ifdef METALLIC_REFLECTANCE\nvar metallicReflectanceFactorsMap: vec4f=textureSample(metallicReflectanceSampler,metallicReflectanceSamplerSampler,fragmentInputs.vMetallicReflectanceUV+uvOffset);\n#ifdef METALLIC_REFLECTANCE_GAMMA\nmetallicReflectanceFactorsMap=toLinearSpaceVec4(metallicReflectanceFactorsMap);\n#endif\n#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY\nmetallicReflectanceFactors=vec4f(metallicReflectanceFactors.rgb*reflectanceFactorsMap.rgb,metallicReflectanceFactors.a);\n#endif\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap.a;\n#endif\n#endif\nreflectivityOut=reflectivityBlock(\nuniforms.vReflectivityColor\n#ifdef METALLICWORKFLOW\n,surfaceAlbedo\n,metallicReflectanceFactors\n#endif\n#ifdef REFLECTIVITY\n,uniforms.vReflectivityInfos\n,surfaceMetallicOrReflectivityColorMap\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,aoOut.ambientOcclusionColor\n#endif\n#ifdef MICROSURFACEMAP\n,microSurfaceTexel\n#endif\n#ifdef DETAIL\n,detailColor\n,uniforms.vDetailInfos\n#endif\n);var microSurface: f32=reflectivityOut.microSurface;var roughness: f32=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nvar alphaFresnelOut: alphaFresnelOutParams;alphaFresnelOut=alphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface\n);alpha=alphaFresnelOut.alpha;\n#endif\n#endif\n#include<pbrBlockGeometryInfo>\n#ifdef ANISOTROPIC\nvar anisotropicOut: anisotropicOutParams;\n#ifdef ANISOTROPIC_TEXTURE\nvar anisotropyMapData: vec3f=textureSample(anisotropySampler,anisotropySamplerSampler,fragmentInputs.vAnisotropyUV+uvOffset).rgb*uniforms.vAnisotropyInfos.y;\n#endif\nanisotropicOut=anisotropicBlock(\nuniforms.vAnisotropy,\nroughness,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW \n);\n#endif\n#ifdef REFLECTION\nvar reflectionOut: reflectionOutParams;\n#ifndef USE_CUSTOM_REFLECTION\nreflectionOut=reflectionBlock(\ninput.vPositionW\n,normalW\n,alphaG\n,uniforms.vReflectionMicrosurfaceInfos\n,uniforms.vReflectionInfos\n,uniforms.vReflectionColor\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness\n#endif\n,reflectionSampler\n,reflectionSamplerSampler\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,input.vEnvironmentIrradiance\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,uniforms.reflectionMatrix\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n,irradianceSampler\n,irradianceSamplerSampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,uniforms.vReflectionFilteringInfo\n#endif\n);\n#else\n#define CUSTOM_REFLECTION\n#endif\n#endif\n#include<pbrBlockReflectance0>\n#ifdef SHEEN\nvar sheenOut: sheenOutParams;\n#ifdef SHEEN_TEXTURE\nvar sheenMapData: vec4f=textureSample(sheenSampler,sheenSamplerSampler,fragmentInputs.vSheenUV+uvOffset);\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvar sheenMapRoughnessData: vec4f=textureSample(sheenRoughnessSampler,sheenRoughnessSamplerSampler,fragmentInputs.vSheenRoughnessUV+uvOffset)*uniforms.vSheenInfos.w;\n#endif\nsheenOut=sheenBlock(\nuniforms.vSheenColor\n#ifdef SHEEN_ROUGHNESS\n,uniforms.vSheenRoughness\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,sheenMapRoughnessData\n#endif\n#endif\n,roughness\n#ifdef SHEEN_TEXTURE\n,sheenMapData\n,uniforms.vSheenInfos.y\n#endif\n,reflectance\n#ifdef SHEEN_LINKWITHALBEDO\n,baseColor\n,surfaceAlbedo\n#endif\n#ifdef ENVIRONMENTBRDF\n,NdotV\n,environmentBrdf\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,AARoughnessFactors\n,uniforms.vReflectionMicrosurfaceInfos\n,uniforms.vReflectionInfos\n,uniforms.vReflectionColor\n,uniforms.vLightingIntensity\n,reflectionSampler\n,reflectionSamplerSampler\n,reflectionOut.reflectionCoords\n,NdotVUnclamped\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,seo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,eho\n#endif\n#endif\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvar clearCoatMapData: vec2f=textureSample(clearCoatSampler,clearCoatSamplerSampler,fragmentInputs.vClearCoatUV+uvOffset).rg*uniforms.vClearCoatInfos.y;\n#endif\n#endif\n#ifdef IRIDESCENCE\nvar iridescenceOut: iridescenceOutParams;\n#ifdef IRIDESCENCE_TEXTURE\nvar iridescenceMapData: vec2f=textureSample(iridescenceSampler,iridescenceSamplerSampler,fragmentInputs.vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nvar iridescenceThicknessMapData: vec2f=textureSample(iridescenceThicknessSampler,iridescenceThicknessSamplerSampler,fragmentInputs.vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;\n#endif\niridescenceOut=iridescenceBlock(\nuniforms.vIridescenceParams\n,NdotV\n,specularEnvironmentR0\n#ifdef IRIDESCENCE_TEXTURE\n,iridescenceMapData\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,iridescenceThicknessMapData\n#endif\n#ifdef CLEARCOAT\n,NdotVUnclamped\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData\n#endif\n#endif\n);var iridescenceIntensity: f32=iridescenceOut.iridescenceIntensity;specularEnvironmentR0=iridescenceOut.specularEnvironmentR0;\n#endif\nvar clearcoatOut: clearcoatOutParams;\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvar clearCoatMapRoughnessData: vec4f=textureSample(clearCoatRoughnessSampler,clearCoatRoughnessSamplerSampler,fragmentInputs.vClearCoatRoughnessUV+uvOffset)*uniforms.vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvar clearCoatTintMapData: vec4f=textureSample(clearCoatTintSampler,clearCoatTintSamplerSampler,fragmentInputs.vClearCoatTintUV+uvOffset);\n#endif\n#ifdef CLEARCOAT_BUMP\nvar clearCoatBumpMapData: vec4f=textureSample(clearCoatBumpSampler,clearCoatBumpSamplerSampler,fragmentInputs.vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatOut=clearcoatBlock(\ninput.vPositionW\n,geometricNormalW\n,viewDirectionW\n,uniforms.vClearCoatParams\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,clearCoatMapRoughnessData\n#endif\n,specularEnvironmentR0\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData\n#endif\n#ifdef CLEARCOAT_TINT\n,uniforms.vClearCoatTintParams\n,uniforms.clearCoatColorAtDistance\n,uniforms.vClearCoatRefractionParams\n#ifdef CLEARCOAT_TINT_TEXTURE\n,clearCoatTintMapData\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,uniforms.vClearCoatBumpInfos\n,clearCoatBumpMapData\n,fragmentInputs.vClearCoatBumpUV\n#if defined(TANGENT) && defined(NORMAL)\n,vTBN\n#else\n,uniforms.vClearCoatTangentSpaceParams\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,uniforms.normalMatrix\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,faceNormal\n#endif\n#ifdef REFLECTION\n,uniforms.vReflectionMicrosurfaceInfos\n,uniforms.vReflectionInfos\n,uniforms.vReflectionColor\n,uniforms.vLightingIntensity\n,reflectionSampler\n,reflectionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,reflectionLowSampler\n,reflectionLowSamplerSampler\n,reflectionHighSampler\n,reflectionHighSamplerSampler\n#endif\n#ifdef REALTIME_FILTERING\n,uniforms.vReflectionFilteringInfo\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,ambientMonochrome\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,select(-1.,1.,fragmentInputs.frontFacing)\n#endif\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n#include<pbrBlockReflectance>\nvar subSurfaceOut: subSurfaceOutParams;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvar thicknessMap: vec4f=textureSample(thicknessSampler,thicknessSamplerSampler,fragmentInputs.vThicknessUV+uvOffset);\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nvar refractionIntensityMap: vec4f=textureSample(refractionIntensitySampler,refractionIntensitySamplerSampler,fragmentInputs.vRefractionIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nvar translucencyIntensityMap: vec4f=textureSample(translucencyIntensitySampler,translucencyIntensitySamplerSampler,fragmentInputs.vTranslucencyIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nvar translucencyColorMap: vec4f=textureSample(translucencyColorSampler,translucencyColorSamplerSampler,fragmentInputs.vTranslucencyColorUV+uvOffset);\n#endif\nsubSurfaceOut=subSurfaceBlock(\nuniforms.vSubSurfaceIntensity\n,uniforms.vThicknessParam\n,uniforms.vTintColor\n,normalW\n,specularEnvironmentReflectance\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,thicknessMap\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,refractionIntensityMap\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,translucencyIntensityMap\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,uniforms.reflectionMatrix\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionOut.irradianceVector\n#endif\n#if defined(REALTIME_FILTERING)\n,reflectionSampler\n,reflectionSamplerSampler\n,vReflectionFilteringInfo\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n,irradianceSampler\n,irradianceSamplerSampler\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,surfaceAlbedo\n#endif\n#ifdef SS_REFRACTION\n,input.vPositionW\n,viewDirectionW\n,scene.view\n,uniforms.vRefractionInfos\n,uniforms.refractionMatrix\n,uniforms.vRefractionMicrosurfaceInfos\n,uniforms.vLightingIntensity\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,alpha\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,NdotVUnclamped\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,roughness\n#endif\n,alphaG\n,refractionSampler\n,refractionSamplerSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionLowSampler\n,refractionLowSamplerSampler\n,refractionHighSampler\n,refractionHighSamplerSampler\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,uniforms.vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,uniforms.vRefractionPosition\n,uniforms.vRefractionSize\n#endif\n#ifdef SS_DISPERSION\n,dispersion\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,uniforms.vDiffusionDistance\n,uniforms.vTranslucencyColor\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,translucencyColorMap\n#endif\n#endif\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n#include<pbrBlockFinalLitComponents>\n#endif \n#include<pbrBlockFinalUnlitComponents>\n#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nvar writeGeometryInfo: f32=select(0.0,1.0,finalColor.a>0.4);var fragData: array<vec4<f32>,SCENE_MRT_COUNT>;\n#ifdef PREPASS_POSITION\nfragData[PREPASS_POSITION_INDEX]= vec4f(input.vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvar a: vec2f=(fragmentInputs.vCurrentPosition.xy/fragmentInputs.vCurrentPosition.w)*0.5+0.5;var b: vec2f=(fragmentInputs.vPreviousPosition.xy/fragmentInputs.vPreviousPosition.w)*0.5+0.5;var velocity: vec2f=abs(a-b);velocity= vec2f(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;fragData[PREPASS_VELOCITY_INDEX]= vec4f(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nvar sqAlbedo: vec3f=sqrt(surfaceAlbedo); \n#endif\n#ifdef PREPASS_IRRADIANCE\nvar irradiance: vec3f=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\n#ifdef SS_SCATTERING\nfragData[0]= vec4f(finalColor.rgb-irradiance,finalColor.a); \nirradiance/=sqAlbedo;\n#else\nfragData[0]=finalColor; \nvar scatteringDiffusionProfile: f32=255.;\n#endif\nfragData[PREPASS_IRRADIANCE_INDEX]= vec4f(clamp(irradiance, vec3f(0.), vec3f(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); \n#else\nfragData[0]= vec4f(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTH\nfragData[PREPASS_DEPTH_INDEX]= vec4f(fragmentInputs.vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\n#ifdef PREPASS_NORMAL_WORLDSPACE\nfragData[PREPASS_NORMAL_INDEX]= vec4f(normalW,writeGeometryInfo); \n#else\nfragData[PREPASS_NORMAL_INDEX]= vec4f(normalize((scene.view* vec4f(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nfragData[PREPASS_ALBEDO_SQRT_INDEX]= vec4f(sqAlbedo,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#ifndef UNLIT\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f(specularEnvironmentR0,microSurface)*writeGeometryInfo;\n#else\nfragData[PREPASS_REFLECTIVITY_INDEX]= vec4f( 0.0,0.0,0.0,1.0 )*writeGeometryInfo;\n#endif\n#endif\n#if SCENE_MRT_COUNT>0\nfragmentOutputs.fragData0= fragData[0];\n#endif\n#if SCENE_MRT_COUNT>1\nfragmentOutputs.fragData1= fragData[1];\n#endif\n#if SCENE_MRT_COUNT>2\nfragmentOutputs.fragData2= fragData[2];\n#endif\n#if SCENE_MRT_COUNT>3\nfragmentOutputs.fragData3= fragData[3];\n#endif\n#if SCENE_MRT_COUNT>4\nfragmentOutputs.fragData4= fragData[4];\n#endif\n#if SCENE_MRT_COUNT>5\nfragmentOutputs.fragData5= fragData[5];\n#endif\n#if SCENE_MRT_COUNT>6\nfragmentOutputs.fragData6= fragData[6];\n#endif\n#if SCENE_MRT_COUNT>7\nfragmentOutputs.fragData7= fragData[7];\n#endif\n#endif\n#if !defined(PREPASS) && !defined(ORDER_INDEPENDENT_TRANSPARENCY)\nfragmentOutputs.color=finalColor;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {fragmentOutputs.frontColor=vec4f(fragmentOutputs.frontColor.rgb+finalColor.rgb*finalColor.a*alphaMultiplier,1.0-alphaMultiplier*(1.0-finalColor.a));} else {fragmentOutputs.backColor+=finalColor;}\n#endif\n#include<pbrDebug>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n",e.ShadersStoreWGSL[Eo]=Ao,Co={name:Eo,shader:Ao}}}),hl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrVertexDeclaration.js"(){c(),qa(),"pbrVertexDeclaration","uniform mat4 view;uniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;uniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;uniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;uniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;uniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;uniform mat4 reflectivityMatrix;\n#endif\n#ifdef METALLIC_REFLECTANCE\nuniform vec2 vMetallicReflectanceInfos;uniform mat4 metallicReflectanceMatrix;\n#endif\n#ifdef REFLECTANCE\nuniform vec2 vReflectanceInfos;uniform mat4 reflectanceMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;uniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;uniform mat4 reflectionMatrix;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;uniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;uniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#ifdef IRIDESCENCE\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;uniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;uniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;uniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;uniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;uniform mat4 translucencyIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nuniform vec2 vTranslucencyColorInfos;uniform mat4 translucencyColorMatrix;\n#endif\n#endif\n#ifdef NORMAL\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;uniform vec3 vSphericalL1_1;uniform vec3 vSphericalL10;uniform vec3 vSphericalL11;uniform vec3 vSphericalL2_2;uniform vec3 vSphericalL2_1;uniform vec3 vSphericalL20;uniform vec3 vSphericalL21;uniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;uniform vec3 vSphericalY;uniform vec3 vSphericalZ;uniform vec3 vSphericalXX_ZZ;uniform vec3 vSphericalYY_ZZ;uniform vec3 vSphericalZZ;uniform vec3 vSphericalXY;uniform vec3 vSphericalYZ;uniform vec3 vSphericalZX;\n#endif\n#endif\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;uniform mat4 detailMatrix;\n#endif\n#include<decalVertexDeclaration>\n#define ADDITIONAL_VERTEX_DECLARATION\n",e.IncludesShadersStore.pbrVertexDeclaration="uniform mat4 view;uniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;uniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;uniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;uniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;uniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;uniform mat4 reflectivityMatrix;\n#endif\n#ifdef METALLIC_REFLECTANCE\nuniform vec2 vMetallicReflectanceInfos;uniform mat4 metallicReflectanceMatrix;\n#endif\n#ifdef REFLECTANCE\nuniform vec2 vReflectanceInfos;uniform mat4 reflectanceMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;uniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;uniform mat4 reflectionMatrix;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;uniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;uniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#ifdef IRIDESCENCE\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;uniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;uniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;uniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;uniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;uniform mat4 translucencyIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nuniform vec2 vTranslucencyColorInfos;uniform mat4 translucencyColorMatrix;\n#endif\n#endif\n#ifdef NORMAL\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;uniform vec3 vSphericalL1_1;uniform vec3 vSphericalL10;uniform vec3 vSphericalL11;uniform vec3 vSphericalL2_2;uniform vec3 vSphericalL2_1;uniform vec3 vSphericalL20;uniform vec3 vSphericalL21;uniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;uniform vec3 vSphericalY;uniform vec3 vSphericalZ;uniform vec3 vSphericalXX_ZZ;uniform vec3 vSphericalYY_ZZ;uniform vec3 vSphericalZZ;uniform vec3 vSphericalXY;uniform vec3 vSphericalYZ;uniform vec3 vSphericalZX;\n#endif\n#endif\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;uniform mat4 detailMatrix;\n#endif\n#include<decalVertexDeclaration>\n#define ADDITIONAL_VERTEX_DECLARATION\n"}}),fl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrUboDeclaration.js"(){c(),bn(),Pn(),"pbrUboDeclaration","layout(std140,column_major) uniform;uniform Material {vec2 vAlbedoInfos;vec4 vAmbientInfos;vec2 vOpacityInfos;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec3 vReflectivityInfos;vec2 vMicroSurfaceSamplerInfos;vec2 vReflectionInfos;vec2 vReflectionFilteringInfo;vec3 vReflectionPosition;vec3 vReflectionSize;vec3 vBumpInfos;mat4 albedoMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 reflectivityMatrix;mat4 microSurfaceSamplerMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;mat4 reflectionMatrix;vec3 vReflectionColor;vec4 vAlbedoColor;vec4 vLightingIntensity;vec3 vReflectionMicrosurfaceInfos;float pointSize;vec4 vReflectivityColor;vec3 vEmissiveColor;vec3 vAmbientColor;vec2 vDebugMode;vec4 vMetallicReflectanceFactors;vec2 vMetallicReflectanceInfos;mat4 metallicReflectanceMatrix;vec2 vReflectanceInfos;mat4 reflectanceMatrix;vec3 vSphericalL00;vec3 vSphericalL1_1;vec3 vSphericalL10;vec3 vSphericalL11;vec3 vSphericalL2_2;vec3 vSphericalL2_1;vec3 vSphericalL20;vec3 vSphericalL21;vec3 vSphericalL22;vec3 vSphericalX;vec3 vSphericalY;vec3 vSphericalZ;vec3 vSphericalXX_ZZ;vec3 vSphericalYY_ZZ;vec3 vSphericalZZ;vec3 vSphericalXY;vec3 vSphericalYZ;vec3 vSphericalZX;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n",e.IncludesShadersStore.pbrUboDeclaration="layout(std140,column_major) uniform;uniform Material {vec2 vAlbedoInfos;vec4 vAmbientInfos;vec2 vOpacityInfos;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec3 vReflectivityInfos;vec2 vMicroSurfaceSamplerInfos;vec2 vReflectionInfos;vec2 vReflectionFilteringInfo;vec3 vReflectionPosition;vec3 vReflectionSize;vec3 vBumpInfos;mat4 albedoMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 reflectivityMatrix;mat4 microSurfaceSamplerMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;mat4 reflectionMatrix;vec3 vReflectionColor;vec4 vAlbedoColor;vec4 vLightingIntensity;vec3 vReflectionMicrosurfaceInfos;float pointSize;vec4 vReflectivityColor;vec3 vEmissiveColor;vec3 vAmbientColor;vec2 vDebugMode;vec4 vMetallicReflectanceFactors;vec2 vMetallicReflectanceInfos;mat4 metallicReflectanceMatrix;vec2 vReflectanceInfos;mat4 reflectanceMatrix;vec3 vSphericalL00;vec3 vSphericalL1_1;vec3 vSphericalL10;vec3 vSphericalL11;vec3 vSphericalL2_2;vec3 vSphericalL2_1;vec3 vSphericalL20;vec3 vSphericalL21;vec3 vSphericalL22;vec3 vSphericalX;vec3 vSphericalY;vec3 vSphericalZ;vec3 vSphericalXX_ZZ;vec3 vSphericalYY_ZZ;vec3 vSphericalZZ;vec3 vSphericalXY;vec3 vSphericalYZ;vec3 vSphericalZX;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n"}}),ul=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/harmonicsFunctions.js"(){c(),"harmonicsFunctions","#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nvec3 computeEnvironmentIrradiance(vec3 normal) {return vSphericalL00\n+ vSphericalL1_1*(normal.y)\n+ vSphericalL10*(normal.z)\n+ vSphericalL11*(normal.x)\n+ vSphericalL2_2*(normal.y*normal.x)\n+ vSphericalL2_1*(normal.y*normal.z)\n+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ vSphericalL21*(normal.z*normal.x)\n+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));}\n#else\nvec3 computeEnvironmentIrradiance(vec3 normal) {float Nx=normal.x;float Ny=normal.y;float Nz=normal.z;vec3 C1=vSphericalZZ.rgb;vec3 Cx=vSphericalX.rgb;vec3 Cy=vSphericalY.rgb;vec3 Cz=vSphericalZ.rgb;vec3 Cxx_zz=vSphericalXX_ZZ.rgb;vec3 Cyy_zz=vSphericalYY_ZZ.rgb;vec3 Cxy=vSphericalXY.rgb;vec3 Cyz=vSphericalYZ.rgb;vec3 Czx=vSphericalZX.rgb;vec3 a1=Cyy_zz*Ny+Cy;vec3 a2=Cyz*Nz+a1;vec3 b1=Czx*Nz+Cx;vec3 b2=Cxy*Ny+b1;vec3 b3=Cxx_zz*Nx+b2;vec3 t1=Cz *Nz+C1;vec3 t2=a2 *Ny+t1;vec3 t3=b3 *Nx+t2;return t3;}\n#endif\n#endif\n",e.IncludesShadersStore.harmonicsFunctions="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nvec3 computeEnvironmentIrradiance(vec3 normal) {return vSphericalL00\n+ vSphericalL1_1*(normal.y)\n+ vSphericalL10*(normal.z)\n+ vSphericalL11*(normal.x)\n+ vSphericalL2_2*(normal.y*normal.x)\n+ vSphericalL2_1*(normal.y*normal.z)\n+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ vSphericalL21*(normal.z*normal.x)\n+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));}\n#else\nvec3 computeEnvironmentIrradiance(vec3 normal) {float Nx=normal.x;float Ny=normal.y;float Nz=normal.z;vec3 C1=vSphericalZZ.rgb;vec3 Cx=vSphericalX.rgb;vec3 Cy=vSphericalY.rgb;vec3 Cz=vSphericalZ.rgb;vec3 Cxx_zz=vSphericalXX_ZZ.rgb;vec3 Cyy_zz=vSphericalYY_ZZ.rgb;vec3 Cxy=vSphericalXY.rgb;vec3 Cyz=vSphericalYZ.rgb;vec3 Czx=vSphericalZX.rgb;vec3 a1=Cyy_zz*Ny+Cy;vec3 a2=Cyz*Nz+a1;vec3 b1=Czx*Nz+Cx;vec3 b2=Cxy*Ny+b1;vec3 b3=Cxx_zz*Nx+b2;vec3 t1=Cz *Nz+C1;vec3 t2=a2 *Ny+t1;vec3 t3=b3 *Nx+t2;return t3;}\n#endif\n#endif\n"}}),dl={};l(dl,{pbrVertexShader:()=>ll});var ml,pl,_l,vl=o({"../node_modules/@babylonjs/core/Shaders/pbr.vertex.js"(){c(),hl(),fl(),Za(),is(),tt(),G(),Rn(),es(),ts(),ns(),ul(),as(),Dn(),ss(),qe(),Xe(),Tn(),Nn(),rs(),Ln(),Fn(),kn(),z(),Bn(),os(),ls(),cs(),hs(),Un(),fs(),_t(),us(),ms(),rl="pbrVertexShader",ol="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)\n#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)\n#ifdef CLEARCOAT\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor)\n#endif\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);vPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);vPositionW=vec3(worldPos);\n#include<prePassVertex>\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)\n#ifdef CLEARCOAT\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)\n#endif\n#ifdef SHEEN\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheenRoughness,_INFONAME_,SheenInfos.z)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_MATRIXNAME_,translucencyColor,_INFONAME_,TranslucencyColorInfos.x)\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}",e.ShadersStore[rl]=ol,ll={name:rl,shader:ol}}}),gl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentDeclaration.js"(){c(),ys(),"pbrFragmentDeclaration","uniform vec4 vEyePosition;uniform vec3 vReflectionColor;uniform vec4 vAlbedoColor;uniform vec4 vLightingIntensity;uniform vec4 vReflectivityColor;uniform vec4 vMetallicReflectanceFactors;uniform vec3 vEmissiveColor;uniform float visibility;uniform vec3 vAmbientColor;\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REALTIME_FILTERING\nuniform vec2 vReflectionFilteringInfo;\n#endif\nuniform mat4 reflectionMatrix;uniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;uniform vec3 vReflectionSize; \n#endif\n#endif\n#if defined(SS_REFRACTION) && defined(SS_USE_LOCAL_REFRACTIONMAP_CUBIC)\nuniform vec3 vRefractionPosition;uniform vec3 vRefractionSize; \n#endif\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;uniform vec4 vClearCoatRefractionParams;\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;uniform vec2 vClearCoatTangentSpaceParams;uniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;uniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;uniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n#ifdef IRIDESCENCE\nuniform vec4 vIridescenceParams;\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;uniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_ROUGHNESS\nuniform float vSheenRoughness;\n#endif\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionMicrosurfaceInfos;uniform vec4 vRefractionInfos;uniform mat4 refractionMatrix;\n#ifdef REALTIME_FILTERING\nuniform vec2 vRefractionFilteringInfo;\n#endif\n#ifdef SS_DISPERSION\nuniform float dispersion;\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;uniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;uniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;uniform mat4 translucencyIntensityMatrix;\n#endif\nuniform vec2 vThicknessParam;uniform vec3 vDiffusionDistance;uniform vec4 vTintColor;uniform vec3 vSubSurfaceIntensity;uniform vec4 vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nuniform vec2 vTranslucencyColorInfos;uniform mat4 translucencyColorMatrix;\n#endif\n#endif\n#ifdef PREPASS\n#ifdef SS_SCATTERING\nuniform float scatteringDiffusionProfile;\n#endif\n#endif\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#include<decalFragmentDeclaration>\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;uniform vec3 vSphericalL1_1;uniform vec3 vSphericalL10;uniform vec3 vSphericalL11;uniform vec3 vSphericalL2_2;uniform vec3 vSphericalL2_1;uniform vec3 vSphericalL20;uniform vec3 vSphericalL21;uniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;uniform vec3 vSphericalY;uniform vec3 vSphericalZ;uniform vec3 vSphericalXX_ZZ;uniform vec3 vSphericalYY_ZZ;uniform vec3 vSphericalZZ;uniform vec3 vSphericalXY;uniform vec3 vSphericalYZ;uniform vec3 vSphericalZX;\n#endif\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n",e.IncludesShadersStore.pbrFragmentDeclaration="uniform vec4 vEyePosition;uniform vec3 vReflectionColor;uniform vec4 vAlbedoColor;uniform vec4 vLightingIntensity;uniform vec4 vReflectivityColor;uniform vec4 vMetallicReflectanceFactors;uniform vec3 vEmissiveColor;uniform float visibility;uniform vec3 vAmbientColor;\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;uniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REALTIME_FILTERING\nuniform vec2 vReflectionFilteringInfo;\n#endif\nuniform mat4 reflectionMatrix;uniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;uniform vec3 vReflectionSize; \n#endif\n#endif\n#if defined(SS_REFRACTION) && defined(SS_USE_LOCAL_REFRACTIONMAP_CUBIC)\nuniform vec3 vRefractionPosition;uniform vec3 vRefractionSize; \n#endif\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;uniform vec4 vClearCoatRefractionParams;\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;uniform vec2 vClearCoatTangentSpaceParams;uniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;uniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;uniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n#ifdef IRIDESCENCE\nuniform vec4 vIridescenceParams;\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;uniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_ROUGHNESS\nuniform float vSheenRoughness;\n#endif\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionMicrosurfaceInfos;uniform vec4 vRefractionInfos;uniform mat4 refractionMatrix;\n#ifdef REALTIME_FILTERING\nuniform vec2 vRefractionFilteringInfo;\n#endif\n#ifdef SS_DISPERSION\nuniform float dispersion;\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;uniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;uniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;uniform mat4 translucencyIntensityMatrix;\n#endif\nuniform vec2 vThicknessParam;uniform vec3 vDiffusionDistance;uniform vec4 vTintColor;uniform vec3 vSubSurfaceIntensity;uniform vec4 vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nuniform vec2 vTranslucencyColorInfos;uniform mat4 translucencyColorMatrix;\n#endif\n#endif\n#ifdef PREPASS\n#ifdef SS_SCATTERING\nuniform float scatteringDiffusionProfile;\n#endif\n#endif\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#include<decalFragmentDeclaration>\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;uniform vec3 vSphericalL1_1;uniform vec3 vSphericalL10;uniform vec3 vSphericalL11;uniform vec3 vSphericalL2_2;uniform vec3 vSphericalL2_1;uniform vec3 vSphericalL20;uniform vec3 vSphericalL21;uniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;uniform vec3 vSphericalY;uniform vec3 vSphericalZ;uniform vec3 vSphericalXX_ZZ;uniform vec3 vSphericalYY_ZZ;uniform vec3 vSphericalZZ;uniform vec3 vSphericalXY;uniform vec3 vSphericalYZ;uniform vec3 vSphericalZX;\n#endif\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n"}}),Sl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentExtraDeclaration.js"(){c(),is(),"pbrFragmentExtraDeclaration","varying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n",e.IncludesShadersStore.pbrFragmentExtraDeclaration="varying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n"}}),yl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerFragmentAlternateDeclaration.js"(){c(),"samplerFragmentAlternateDeclaration","#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n#endif\n",e.IncludesShadersStore.samplerFragmentAlternateDeclaration="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n#endif\n"}}),El=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentSamplersDeclaration.js"(){c(),Rs(),yl(),"pbrFragmentSamplersDeclaration","#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform sampler2D clearCoatRoughnessSampler;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform sampler2D sheenRoughnessSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;uniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;uniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;uniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D refractionSamplerLow;uniform sampler2D refractionSamplerHigh;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_SAMPLERNAME_,translucencyColor)\n#endif\n",e.IncludesShadersStore.pbrFragmentSamplersDeclaration="#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform sampler2D clearCoatRoughnessSampler;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform sampler2D sheenRoughnessSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;uniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;uniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;uniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D refractionSamplerLow;uniform sampler2D refractionSamplerHigh;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYCOLOR_TEXTURE,_VARYINGNAME_,TranslucencyColor,_SAMPLERNAME_,translucencyColor)\n#endif\n"}}),Al=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/subSurfaceScatteringFunctions.js"(){c(),"subSurfaceScatteringFunctions","bool testLightingForSSS(float diffusionProfile)\n{return diffusionProfile<1.;}",e.IncludesShadersStore.subSurfaceScatteringFunctions="bool testLightingForSSS(float diffusionProfile)\n{return diffusionProfile<1.;}"}}),Cl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/importanceSampling.js"(){c(),"importanceSampling","vec3 hemisphereCosSample(vec2 u) {float phi=2.*PI*u.x;float cosTheta2=1.-u.y;float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {float phi=2.*PI*u.x;float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { \nfloat phi=2.*PI*u.x;float sinTheta=pow(u.y,a/(2.*a+1.));float cosTheta=sqrt(1.-sinTheta*sinTheta);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}",e.IncludesShadersStore.importanceSampling="vec3 hemisphereCosSample(vec2 u) {float phi=2.*PI*u.x;float cosTheta2=1.-u.y;float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {float phi=2.*PI*u.x;float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { \nfloat phi=2.*PI*u.x;float sinTheta=pow(u.y,a/(2.*a+1.));float cosTheta=sqrt(1.-sinTheta*sinTheta);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}"}}),Rl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrHelperFunctions.js"(){c(),"pbrHelperFunctions","#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{return square(roughness)+MINIMUMVARIANCE;}\nfloat fresnelGrazingReflectance(float reflectance0) {float reflectance90=saturate(reflectance0*25.0);return reflectance90;}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);vec3 nDfdy=dFdy(normalVector.xyz);float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);float geometricAlphaGFactor=sqrt(slopeSquare);geometricAlphaGFactor*=0.75;return vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_LEGACY\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);return vec2(alphaT,alphaB);}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy,float roughness) {vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));return anisotropicNormal;}\n#else\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {float alphaT=max(mix(alphaG,1.0,anisotropy*anisotropy),MINIMUMVARIANCE);float alphaB=max(alphaG,MINIMUMVARIANCE);return vec2(alphaT,alphaB);}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy,float roughness) {vec3 bentNormal=cross(B,V);bentNormal=normalize(cross(bentNormal,B));float a=square(square(1.0-anisotropy*(1.0-roughness)));bentNormal=normalize(mix(bentNormal,N,a));return bentNormal;}\n#endif\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nvec3 cocaLambert(vec3 alpha,float distance) {return exp(-alpha*distance);}\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));}\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {return -log(color)/distance;}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {vec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);return clearCoatAbsorption;}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;float reflectivityLuminance=getLuminance(reflectivityColor);float reflectivityLuma=sqrt(reflectivityLuminance);microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;return microSurface;}\n#endif\n",e.IncludesShadersStore.pbrHelperFunctions="#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{return square(roughness)+MINIMUMVARIANCE;}\nfloat fresnelGrazingReflectance(float reflectance0) {float reflectance90=saturate(reflectance0*25.0);return reflectance90;}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);vec3 nDfdy=dFdy(normalVector.xyz);float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);float geometricAlphaGFactor=sqrt(slopeSquare);geometricAlphaGFactor*=0.75;return vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_LEGACY\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);return vec2(alphaT,alphaB);}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy,float roughness) {vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));return anisotropicNormal;}\n#else\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {float alphaT=max(mix(alphaG,1.0,anisotropy*anisotropy),MINIMUMVARIANCE);float alphaB=max(alphaG,MINIMUMVARIANCE);return vec2(alphaT,alphaB);}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy,float roughness) {vec3 bentNormal=cross(B,V);bentNormal=normalize(cross(bentNormal,B));float a=square(square(1.0-anisotropy*(1.0-roughness)));bentNormal=normalize(mix(bentNormal,N,a));return bentNormal;}\n#endif\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nvec3 cocaLambert(vec3 alpha,float distance) {return exp(-alpha*distance);}\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));}\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {return -log(color)/distance;}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {vec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);return clearCoatAbsorption;}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;float reflectivityLuminance=getLuminance(reflectivityColor);float reflectivityLuma=sqrt(reflectivityLuminance);microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;return microSurface;}\n#endif\n"}}),Tl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingSetupFunctions.js"(){c(),"pbrDirectLightingSetupFunctions","struct preLightingInfo\n{vec3 lightOffset;float lightDistanceSquared;float lightDistance;float attenuation;vec3 L;vec3 H;float NdotV;float NdotLUnclamped;float NdotL;float VdotH;float roughness;\n#ifdef IRIDESCENCE\nfloat iridescenceIntensity;\n#endif\n};preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N,vec3 posW) {preLightingInfo result;result.lightOffset=lightData.xyz-posW;result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);result.lightDistance=sqrt(result.lightDistanceSquared);result.L=normalize(result.lightOffset);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.lightDistance=length(-lightData.xyz);result.L=normalize(-lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.NdotL=dot(N,lightData.xyz)*0.5+0.5;result.NdotL=saturateEps(result.NdotL);result.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;}",e.IncludesShadersStore.pbrDirectLightingSetupFunctions="struct preLightingInfo\n{vec3 lightOffset;float lightDistanceSquared;float lightDistance;float attenuation;vec3 L;vec3 H;float NdotV;float NdotLUnclamped;float NdotL;float VdotH;float roughness;\n#ifdef IRIDESCENCE\nfloat iridescenceIntensity;\n#endif\n};preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N,vec3 posW) {preLightingInfo result;result.lightOffset=lightData.xyz-posW;result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);result.lightDistance=sqrt(result.lightDistanceSquared);result.L=normalize(result.lightOffset);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.lightDistance=length(-lightData.xyz);result.L=normalize(-lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.NdotL=dot(N,lightData.xyz)*0.5+0.5;result.NdotL=saturateEps(result.NdotL);result.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;}"}}),Nl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingFalloffFunctions.js"(){c(),"pbrDirectLightingFalloffFunctions","float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{return max(0.,1.0-length(lightOffset)/range);}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{return 1.0/maxEps(lightDistanceSquared);}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);float factor=lightDistanceSquared*inverseSquaredRange;float attenuation=saturate(1.0-factor*factor);attenuation*=attenuation;lightDistanceFalloff*=attenuation;return lightDistanceFalloff;}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{float falloff=0.0;float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));if (cosAngle>=cosHalfAngle)\n{falloff=max(0.,pow(cosAngle,exponent));}\nreturn falloff;}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{const float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));return falloff;}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{float cd=dot(-lightDirection,directionToLightCenterW);float falloff=saturate(cd*lightAngleScale+lightAngleOffset);falloff*=falloff;return falloff;}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}",e.IncludesShadersStore.pbrDirectLightingFalloffFunctions="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{return max(0.,1.0-length(lightOffset)/range);}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{return 1.0/maxEps(lightDistanceSquared);}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);float factor=lightDistanceSquared*inverseSquaredRange;float attenuation=saturate(1.0-factor*factor);attenuation*=attenuation;lightDistanceFalloff*=attenuation;return lightDistanceFalloff;}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{float falloff=0.0;float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));if (cosAngle>=cosHalfAngle)\n{falloff=max(0.,pow(cosAngle,exponent));}\nreturn falloff;}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{const float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));return falloff;}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{float cd=dot(-lightDirection,directionToLightCenterW);float falloff=saturate(cd*lightAngleScale+lightAngleOffset);falloff*=falloff;return falloff;}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}"}}),Ml=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBRDFFunctions.js"(){c(),"pbrBRDFFunctions","#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {vec2 UV=vec2(NdotV,perceptualRoughness);vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{float c=1.0-NdotV;float c3=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);return square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);vec3 getIORTfromAirToSurfaceR0(vec3 f0) {vec3 sqrtF0=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {return square((iorT-vec3(iorI))/(iorT+vec3(iorI)));}\nfloat getR0fromIORs(float iorT,float iorI) {return square((iorT-iorI)/(iorT+iorI));}\nvec3 evalSensitivity(float opd,vec3 shift) {float phase=2.0*PI*opd*1.0e-9;const vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);const vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);const vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);vec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;vec3 srgb=XYZ_TO_REC709*xyz;return srgb;}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {vec3 I=vec3(1.0);float iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));float sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));float cosTheta2Sq=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}\nfloat cosTheta2=sqrt(cosTheta2Sq);float R0=getR0fromIORs(iridescenceIOR,outsideIOR);float R12=fresnelSchlickGGX(cosTheta1,R0,1.);float R21=R12;float T121=1.0-R12;float phi12=0.0;if (iridescenceIOR<outsideIOR) phi12=PI;float phi21=PI-phi12;vec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);vec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));vec3 phi23=vec3(0.0);if (baseIOR[0]<iridescenceIOR) phi23[0]=PI;if (baseIOR[1]<iridescenceIOR) phi23[1]=PI;if (baseIOR[2]<iridescenceIOR) phi23[2]=PI;float opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;vec3 phi=vec3(phi21)+phi23;vec3 R123=clamp(R12*R23,1e-5,0.9999);vec3 r123=sqrt(R123);vec3 Rs=square(T121)*R23/(vec3(1.0)-R123);vec3 C0=R12+Rs;I=C0;vec3 Cm=Rs-T121;for (int m=1; m<=2; ++m)\n{Cm*=r123;vec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);I+=Cm*Sm;}\nreturn max(I,vec3(0.0));}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{float a2=square(alphaG);float d=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{float invR=1./alphaG;float cos2h=NdotH*NdotH;float sin2h=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {float a2=alphaTB.x*alphaTB.y;vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);float v2=dot(v,v);float w2=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));float v=0.5/(lambdaV+lambdaL);return v;}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {return 0.25/(VdotH*VdotH); }\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{float oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);float a=mix(21.5473,25.3245,oneMinusAlphaSq);float b=mix(3.82987,3.32435,oneMinusAlphaSq);float c=mix(0.19823,0.16801,oneMinusAlphaSq);float d=mix(-1.97760,-1.27393,oneMinusAlphaSq);float e=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{float G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;float fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {vec3 S=1./maxEps(diffusionDistance);vec3 temp=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {float t=1.0+w;float invt2=1.0/square(t);return saturate((NdotL+w)*invt2);}\n#endif\n",e.IncludesShadersStore.pbrBRDFFunctions="#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {vec2 UV=vec2(NdotV,perceptualRoughness);vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{float c=1.0-NdotV;float c3=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);return square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);vec3 getIORTfromAirToSurfaceR0(vec3 f0) {vec3 sqrtF0=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {return square((iorT-vec3(iorI))/(iorT+vec3(iorI)));}\nfloat getR0fromIORs(float iorT,float iorI) {return square((iorT-iorI)/(iorT+iorI));}\nvec3 evalSensitivity(float opd,vec3 shift) {float phase=2.0*PI*opd*1.0e-9;const vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);const vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);const vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);vec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;vec3 srgb=XYZ_TO_REC709*xyz;return srgb;}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {vec3 I=vec3(1.0);float iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));float sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));float cosTheta2Sq=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}\nfloat cosTheta2=sqrt(cosTheta2Sq);float R0=getR0fromIORs(iridescenceIOR,outsideIOR);float R12=fresnelSchlickGGX(cosTheta1,R0,1.);float R21=R12;float T121=1.0-R12;float phi12=0.0;if (iridescenceIOR<outsideIOR) phi12=PI;float phi21=PI-phi12;vec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);vec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));vec3 phi23=vec3(0.0);if (baseIOR[0]<iridescenceIOR) phi23[0]=PI;if (baseIOR[1]<iridescenceIOR) phi23[1]=PI;if (baseIOR[2]<iridescenceIOR) phi23[2]=PI;float opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;vec3 phi=vec3(phi21)+phi23;vec3 R123=clamp(R12*R23,1e-5,0.9999);vec3 r123=sqrt(R123);vec3 Rs=square(T121)*R23/(vec3(1.0)-R123);vec3 C0=R12+Rs;I=C0;vec3 Cm=Rs-T121;for (int m=1; m<=2; ++m)\n{Cm*=r123;vec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);I+=Cm*Sm;}\nreturn max(I,vec3(0.0));}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{float a2=square(alphaG);float d=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{float invR=1./alphaG;float cos2h=NdotH*NdotH;float sin2h=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {float a2=alphaTB.x*alphaTB.y;vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);float v2=dot(v,v);float w2=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));float v=0.5/(lambdaV+lambdaL);return v;}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {return 0.25/(VdotH*VdotH); }\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{float oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);float a=mix(21.5473,25.3245,oneMinusAlphaSq);float b=mix(3.82987,3.32435,oneMinusAlphaSq);float c=mix(0.19823,0.16801,oneMinusAlphaSq);float d=mix(-1.97760,-1.27393,oneMinusAlphaSq);float e=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{float G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;float fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {vec3 S=1./maxEps(diffusionDistance);vec3 temp=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {float t=1.0+w;float invt2=1.0/square(t);return saturate((NdotL+w)*invt2);}\n#endif\n"}}),Il=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/hdrFilteringFunctions.js"(){c(),"hdrFilteringFunctions","#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfloat radicalInverse_VdC(uint bits) \n{bits=(bits<<16u) | (bits>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return float(bits)*2.3283064365386963e-10; }\nvec2 hammersley(uint i,uint N)\n{return vec2(float(i)/float(N),radicalInverse_VdC(i));}\n#else\nfloat vanDerCorpus(int n,int base)\n{float invBase=1.0/float(base);float denom =1.0;float result =0.0;for(int i=0; i<32; ++i)\n{if(n>0)\n{denom =mod(float(n),2.0);result+=denom*invBase;invBase=invBase/2.0;n =int(float(n)/2.0);}}\nreturn result;}\nvec2 hammersley(int i,int N)\n{return vec2(float(i)/float(N),vanDerCorpus(i,2));}\n#endif\nfloat log4(float x) {return log2(x)/2.;}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;const float K=4.;\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{vec3 n=normalize(inputN);vec3 result=vec3(0.0);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 Ls=hemisphereCosSample(Xi);Ls=normalize(Ls);vec3 Ns=vec3(0.,0.,1.);float NoL=dot(Ns,Ls);if (NoL>0.) {float pdf_inversed=PI/NoL;float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(l,0.0,maxLevel);vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;}}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{vec3 n=normalize(inputN);vec3 c=textureCube(inputTexture,n).rgb; \nif (alphaG==0.) {\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;} else {vec3 result=vec3(0.);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);float weight=0.;\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);float NoV=1.;float NoH=H.z;float NoH2=H.z*H.z;float NoL=2.*NoH2-1.;vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(float(l),0.0,maxLevel);weight+=NoL;vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;}}\nresult=result/weight;return result;}}\n#endif\n#endif\n",e.IncludesShadersStore.hdrFilteringFunctions="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfloat radicalInverse_VdC(uint bits) \n{bits=(bits<<16u) | (bits>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return float(bits)*2.3283064365386963e-10; }\nvec2 hammersley(uint i,uint N)\n{return vec2(float(i)/float(N),radicalInverse_VdC(i));}\n#else\nfloat vanDerCorpus(int n,int base)\n{float invBase=1.0/float(base);float denom =1.0;float result =0.0;for(int i=0; i<32; ++i)\n{if(n>0)\n{denom =mod(float(n),2.0);result+=denom*invBase;invBase=invBase/2.0;n =int(float(n)/2.0);}}\nreturn result;}\nvec2 hammersley(int i,int N)\n{return vec2(float(i)/float(N),vanDerCorpus(i,2));}\n#endif\nfloat log4(float x) {return log2(x)/2.;}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;const float K=4.;\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{vec3 n=normalize(inputN);vec3 result=vec3(0.0);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 Ls=hemisphereCosSample(Xi);Ls=normalize(Ls);vec3 Ns=vec3(0.,0.,1.);float NoL=dot(Ns,Ls);if (NoL>0.) {float pdf_inversed=PI/NoL;float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(l,0.0,maxLevel);vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;}}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{vec3 n=normalize(inputN);vec3 c=textureCube(inputTexture,n).rgb; \nif (alphaG==0.) {\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;} else {vec3 result=vec3(0.);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);float weight=0.;\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);float NoV=1.;float NoH=H.z;float NoH2=H.z*H.z;float NoL=2.*NoH2-1.;vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(float(l),0.0,maxLevel);weight+=NoL;vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;}}\nresult=result/weight;return result;}}\n#endif\n#endif\n"}}),xl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingFunctions.js"(){c(),"pbrDirectLightingFunctions","#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{vec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nfloat lightRoughness=lightRadius/lightDistance;float totalRoughness=saturate(lightRoughness+roughness);return totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {return mix(groundColor,lightColor,info.NdotL);}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*info.attenuation*info.NdotL*lightColor;}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix,vec3 posW){vec4 strq=textureProjectionMatrix*vec4(posW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return toLinearSpace(textureColor);}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {float NdotL=absEps(info.NdotLUnclamped);float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);float trAdapt=step(0.,info.NdotLUnclamped);vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float roughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(roughness);vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float TdotH=dot(T,info.H);float BdotH=dot(B,info.H);float TdotV=dot(T,V);float BdotV=dot(B,V);float TdotL=dot(T,info.L);float BdotL=dot(B,info.L);float alphaG=convertRoughnessToAverageSlope(info.roughness);vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);alphaTB=max(alphaTB,square(geometricRoughnessFactor));vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);float smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);vec3 specTerm=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {float NccdotL=saturateEps(dot(Ncc,info.L));float NccdotH=saturateEps(dot(Ncc,info.H));float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnel*=clearCoatIntensity;float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);float kelemenVisibility=visibility_Kelemen(info.VdotH);float clearCoatTerm=fresnel*distribution*kelemenVisibility;return vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);float NdotLRefract=saturateEps(dot(Ncc,LRefract));vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);return absorption;}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float roughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(roughness);float fresnel=1.;float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);/*#ifdef SHEEN_SOFTER\nfloat visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);/* #endif */\nfloat sheenTerm=fresnel*distribution*visibility;return sheenTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n",e.IncludesShadersStore.pbrDirectLightingFunctions="#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{vec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nfloat lightRoughness=lightRadius/lightDistance;float totalRoughness=saturate(lightRoughness+roughness);return totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {return mix(groundColor,lightColor,info.NdotL);}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*info.attenuation*info.NdotL*lightColor;}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix,vec3 posW){vec4 strq=textureProjectionMatrix*vec4(posW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return toLinearSpace(textureColor);}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {float NdotL=absEps(info.NdotLUnclamped);float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);float trAdapt=step(0.,info.NdotLUnclamped);vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float roughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(roughness);vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float TdotH=dot(T,info.H);float BdotH=dot(B,info.H);float TdotV=dot(T,V);float BdotV=dot(B,V);float TdotL=dot(T,info.L);float BdotL=dot(B,info.L);float alphaG=convertRoughnessToAverageSlope(info.roughness);vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);alphaTB=max(alphaTB,square(geometricRoughnessFactor));vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);float smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);vec3 specTerm=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {float NccdotL=saturateEps(dot(Ncc,info.L));float NccdotH=saturateEps(dot(Ncc,info.H));float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnel*=clearCoatIntensity;float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);float kelemenVisibility=visibility_Kelemen(info.VdotH);float clearCoatTerm=fresnel*distribution*kelemenVisibility;return vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);float NdotLRefract=saturateEps(dot(Ncc,LRefract));vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);return absorption;}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float roughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(roughness);float fresnel=1.;float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);/*#ifdef SHEEN_SOFTER\nfloat visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);/* #endif */\nfloat sheenTerm=fresnel*distribution*visibility;return sheenTerm*info.attenuation*info.NdotL*lightColor;}\n#endif\n"}}),bl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrIBLFunctions.js"(){c(),"pbrIBLFunctions","#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {float microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;float lod=log2(microsurfaceAverageSlopeTexels);return lod;}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {float lod=log2(cubeMapDimensionPixels)*roughness;return lod;}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {float temp=NdotVUnclamped+ambientOcclusion;return saturate(square(temp)-1.0+ambientOcclusion);}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {vec3 reflection=reflect(view,normal);float temp=saturate(1.0+1.1*dot(reflection,geometricNormal));return square(temp);}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {float microsurfaceAverageSlope=alphaG;microsurfaceAverageSlope*=sqrt(abs(NdotV));return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);}\n#endif\n",e.IncludesShadersStore.pbrIBLFunctions="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {float microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;float lod=log2(microsurfaceAverageSlopeTexels);return lod;}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {float lod=log2(cubeMapDimensionPixels)*roughness;return lod;}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {float temp=NdotVUnclamped+ambientOcclusion;return saturate(square(temp)-1.0+ambientOcclusion);}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {vec3 reflection=reflect(view,normal);float temp=saturate(1.0+1.1*dot(reflection,geometricNormal));return square(temp);}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {float microsurfaceAverageSlope=alphaG;microsurfaceAverageSlope*=sqrt(abs(NdotV));return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);}\n#endif\n"}}),Pl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAlbedoOpacity.js"(){c(),ws(),"pbrBlockAlbedoOpacity","struct albedoOpacityOutParams\n{vec3 surfaceAlbedo;float alpha;};\n#define pbr_inline\nalbedoOpacityOutParams albedoOpacityBlock(\nin vec4 vAlbedoColor\n#ifdef ALBEDO\n,in vec4 albedoTexture\n,in vec2 albedoInfos\n#endif\n#ifdef OPACITY\n,in vec4 opacityMap\n,in vec2 vOpacityInfos\n#endif\n#ifdef DETAIL\n,in vec4 detailColor\n,in vec4 vDetailInfos\n#endif\n#ifdef DECAL\n,in vec4 decalColor\n,in vec4 vDecalInfos\n#endif \n)\n{albedoOpacityOutParams outParams;vec3 surfaceAlbedo=vAlbedoColor.rgb;float alpha=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#ifndef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#ifdef DETAIL\nfloat detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);surfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#ifdef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST \n#if DEBUGMODE != 88\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;outParams.alpha=alpha;return outParams;}\n",e.IncludesShadersStore.pbrBlockAlbedoOpacity="struct albedoOpacityOutParams\n{vec3 surfaceAlbedo;float alpha;};\n#define pbr_inline\nalbedoOpacityOutParams albedoOpacityBlock(\nin vec4 vAlbedoColor\n#ifdef ALBEDO\n,in vec4 albedoTexture\n,in vec2 albedoInfos\n#endif\n#ifdef OPACITY\n,in vec4 opacityMap\n,in vec2 vOpacityInfos\n#endif\n#ifdef DETAIL\n,in vec4 detailColor\n,in vec4 vDetailInfos\n#endif\n#ifdef DECAL\n,in vec4 decalColor\n,in vec4 vDecalInfos\n#endif \n)\n{albedoOpacityOutParams outParams;vec3 surfaceAlbedo=vAlbedoColor.rgb;float alpha=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#ifndef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#ifdef DETAIL\nfloat detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);surfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#ifdef DECAL_AFTER_DETAIL\n#include<decalFragment>\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST \n#if DEBUGMODE != 88\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;outParams.alpha=alpha;return outParams;}\n"}}),wl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectivity.js"(){c(),"pbrBlockReflectivity","struct reflectivityOutParams\n{float microSurface;float roughness;vec3 surfaceReflectivityColor;\n#ifdef METALLICWORKFLOW\nvec3 surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nvec3 ambientOcclusionColor;\n#endif\n#if DEBUGMODE>0\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap;\n#endif\n#ifndef FROSTBITE_REFLECTANCE\nvec3 metallicF0;\n#endif\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nreflectivityOutParams reflectivityBlock(\nin vec4 vReflectivityColor\n#ifdef METALLICWORKFLOW\n,in vec3 surfaceAlbedo\n,in vec4 metallicReflectanceFactors\n#endif\n#ifdef REFLECTIVITY\n,in vec3 reflectivityInfos\n,in vec4 surfaceMetallicOrReflectivityColorMap\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,in vec3 ambientOcclusionColorIn\n#endif\n#ifdef MICROSURFACEMAP\n,in vec4 microSurfaceTexel\n#endif\n#ifdef DETAIL\n,in vec4 detailColor\n,in vec4 vDetailInfos\n#endif\n)\n{reflectivityOutParams outParams;float microSurface=vReflectivityColor.a;vec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nfloat detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);float loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);float hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;vec3 baseColor=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;microSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);float roughness=1.-microSurface;outParams.microSurface=microSurface;outParams.roughness=roughness;outParams.surfaceReflectivityColor=surfaceReflectivityColor;return outParams;}\n",e.IncludesShadersStore.pbrBlockReflectivity="struct reflectivityOutParams\n{float microSurface;float roughness;vec3 surfaceReflectivityColor;\n#ifdef METALLICWORKFLOW\nvec3 surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nvec3 ambientOcclusionColor;\n#endif\n#if DEBUGMODE>0\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap;\n#endif\n#ifndef FROSTBITE_REFLECTANCE\nvec3 metallicF0;\n#endif\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nreflectivityOutParams reflectivityBlock(\nin vec4 vReflectivityColor\n#ifdef METALLICWORKFLOW\n,in vec3 surfaceAlbedo\n,in vec4 metallicReflectanceFactors\n#endif\n#ifdef REFLECTIVITY\n,in vec3 reflectivityInfos\n,in vec4 surfaceMetallicOrReflectivityColorMap\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,in vec3 ambientOcclusionColorIn\n#endif\n#ifdef MICROSURFACEMAP\n,in vec4 microSurfaceTexel\n#endif\n#ifdef DETAIL\n,in vec4 detailColor\n,in vec4 vDetailInfos\n#endif\n)\n{reflectivityOutParams outParams;float microSurface=vReflectivityColor.a;vec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nfloat detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);float loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);float hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;vec3 baseColor=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;microSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);float roughness=1.-microSurface;outParams.microSurface=microSurface;outParams.roughness=roughness;outParams.surfaceReflectivityColor=surfaceReflectivityColor;return outParams;}\n"}}),Ol=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAmbientOcclusion.js"(){c(),"pbrBlockAmbientOcclusion","struct ambientOcclusionOutParams\n{vec3 ambientOcclusionColor;\n#if DEBUGMODE>0 && defined(AMBIENT)\nvec3 ambientOcclusionColorMap;\n#endif\n};ambientOcclusionOutParams ambientOcclusionBlock(\n#ifdef AMBIENT\nin vec3 ambientOcclusionColorMap_,\nin vec4 vAmbientInfos\n#endif\n)\n{ambientOcclusionOutParams outParams;vec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;return outParams;}\n",e.IncludesShadersStore.pbrBlockAmbientOcclusion="struct ambientOcclusionOutParams\n{vec3 ambientOcclusionColor;\n#if DEBUGMODE>0 && defined(AMBIENT)\nvec3 ambientOcclusionColorMap;\n#endif\n};ambientOcclusionOutParams ambientOcclusionBlock(\n#ifdef AMBIENT\nin vec3 ambientOcclusionColorMap_,\nin vec4 vAmbientInfos\n#endif\n)\n{ambientOcclusionOutParams outParams;vec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;return outParams;}\n"}}),Dl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAlphaFresnel.js"(){c(),"pbrBlockAlphaFresnel","#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{float alpha;};\n#define pbr_inline\nalphaFresnelOutParams alphaFresnelBlock(\nin vec3 normalW,\nin vec3 viewDirectionW,\nin float alpha,\nin float microSurface\n)\n{alphaFresnelOutParams outParams;float opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\nreturn outParams;}\n#endif\n#endif\n",e.IncludesShadersStore.pbrBlockAlphaFresnel="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{float alpha;};\n#define pbr_inline\nalphaFresnelOutParams alphaFresnelBlock(\nin vec3 normalW,\nin vec3 viewDirectionW,\nin float alpha,\nin float microSurface\n)\n{alphaFresnelOutParams outParams;float opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\nreturn outParams;}\n#endif\n#endif\n"}}),Ll=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAnisotropic.js"(){c(),"pbrBlockAnisotropic","#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{float anisotropy;vec3 anisotropicTangent;vec3 anisotropicBitangent;vec3 anisotropicNormal;\n#if DEBUGMODE>0 && defined(ANISOTROPIC_TEXTURE)\nvec3 anisotropyMapData;\n#endif\n};\n#define pbr_inline\nanisotropicOutParams anisotropicBlock(\nin vec3 vAnisotropy,\nin float roughness,\n#ifdef ANISOTROPIC_TEXTURE\nin vec3 anisotropyMapData,\n#endif\nin mat3 TBN,\nin vec3 normalW,\nin vec3 viewDirectionW\n)\n{anisotropicOutParams outParams;float anisotropy=vAnisotropy.b;vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nanisotropy*=anisotropyMapData.b;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\nanisotropyMapData.rg=anisotropyMapData.rg*2.0-1.0;\n#ifdef ANISOTROPIC_LEGACY\nanisotropyDirection.rg*=anisotropyMapData.rg;\n#else\nanisotropyDirection.xy=mat2(anisotropyDirection.x,anisotropyDirection.y,-anisotropyDirection.y,anisotropyDirection.x)*normalize(anisotropyMapData.rg);\n#endif\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));outParams.anisotropy=anisotropy;outParams.anisotropicTangent=anisotropicTangent;outParams.anisotropicBitangent=anisotropicBitangent;outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy,roughness);return outParams;}\n#endif\n",e.IncludesShadersStore.pbrBlockAnisotropic="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{float anisotropy;vec3 anisotropicTangent;vec3 anisotropicBitangent;vec3 anisotropicNormal;\n#if DEBUGMODE>0 && defined(ANISOTROPIC_TEXTURE)\nvec3 anisotropyMapData;\n#endif\n};\n#define pbr_inline\nanisotropicOutParams anisotropicBlock(\nin vec3 vAnisotropy,\nin float roughness,\n#ifdef ANISOTROPIC_TEXTURE\nin vec3 anisotropyMapData,\n#endif\nin mat3 TBN,\nin vec3 normalW,\nin vec3 viewDirectionW\n)\n{anisotropicOutParams outParams;float anisotropy=vAnisotropy.b;vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nanisotropy*=anisotropyMapData.b;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\nanisotropyMapData.rg=anisotropyMapData.rg*2.0-1.0;\n#ifdef ANISOTROPIC_LEGACY\nanisotropyDirection.rg*=anisotropyMapData.rg;\n#else\nanisotropyDirection.xy=mat2(anisotropyDirection.x,anisotropyDirection.y,-anisotropyDirection.y,anisotropyDirection.x)*normalize(anisotropyMapData.rg);\n#endif\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));outParams.anisotropy=anisotropy;outParams.anisotropicTangent=anisotropicTangent;outParams.anisotropicBitangent=anisotropicBitangent;outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy,roughness);return outParams;}\n#endif\n"}}),Fl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflection.js"(){c(),"pbrBlockReflection","#ifdef REFLECTION\nstruct reflectionOutParams\n{vec4 environmentRadiance;vec3 environmentIrradiance;\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords;\n#else\nvec2 reflectionCoords;\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nvec3 irradianceVector;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nvoid createReflectionCoords(\nin vec3 vPositionW,\nin vec3 normalW,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REFLECTIONMAP_3D\nout vec3 reflectionCoords\n#else\nout vec2 reflectionCoords\n#endif\n)\n{\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n}\n#define pbr_inline\n#define inline\nvoid sampleReflectionTexture(\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nconst vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nconst vec2 reflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout vec4 environmentRadiance\n)\n{\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;vec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);if (lodReflectionNormalizedDoubled<1.0){environmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);} else {environmentRadiance=mix(\nenvironmentMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\nenvironmentRadiance.rgb*=vReflectionInfos.x;environmentRadiance.rgb*=vReflectionColor.rgb;}\n#define pbr_inline\n#define inline\nreflectionOutParams reflectionBlock(\nin vec3 vPositionW\n,in vec3 normalW\n,in float alphaG\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,in float NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,in float roughness\n#endif\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n#else\n,in sampler2D reflectionSampler\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,in vec3 vEnvironmentIrradiance\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,in mat4 reflectionMatrix\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,in samplerCube irradianceSampler\n#else\n,in sampler2D irradianceSampler\n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n)\n{reflectionOutParams outParams;vec4 environmentRadiance=vec4(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=vec3(0.);\n#else\nvec2 reflectionCoords=vec2(0.);\n#endif\ncreateReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\nreflectionCoords\n);sampleReflectionTexture(\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionSampler,\nreflectionCoords,\n#else\nreflectionSampler,\nreflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentRadiance\n);vec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);environmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;outParams.environmentRadiance=environmentRadiance;outParams.environmentIrradiance=environmentIrradiance;outParams.reflectionCoords=reflectionCoords;return outParams;}\n#endif\n",e.IncludesShadersStore.pbrBlockReflection="#ifdef REFLECTION\nstruct reflectionOutParams\n{vec4 environmentRadiance;vec3 environmentIrradiance;\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords;\n#else\nvec2 reflectionCoords;\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nvec3 irradianceVector;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nvoid createReflectionCoords(\nin vec3 vPositionW,\nin vec3 normalW,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REFLECTIONMAP_3D\nout vec3 reflectionCoords\n#else\nout vec2 reflectionCoords\n#endif\n)\n{\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n}\n#define pbr_inline\n#define inline\nvoid sampleReflectionTexture(\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nconst vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nconst vec2 reflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout vec4 environmentRadiance\n)\n{\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;vec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);if (lodReflectionNormalizedDoubled<1.0){environmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);} else {environmentRadiance=mix(\nenvironmentMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\nenvironmentRadiance.rgb*=vReflectionInfos.x;environmentRadiance.rgb*=vReflectionColor.rgb;}\n#define pbr_inline\n#define inline\nreflectionOutParams reflectionBlock(\nin vec3 vPositionW\n,in vec3 normalW\n,in float alphaG\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,in float NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,in float roughness\n#endif\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n#else\n,in sampler2D reflectionSampler\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,in vec3 vEnvironmentIrradiance\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,in mat4 reflectionMatrix\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,in samplerCube irradianceSampler\n#else\n,in sampler2D irradianceSampler\n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n)\n{reflectionOutParams outParams;vec4 environmentRadiance=vec4(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=vec3(0.);\n#else\nvec2 reflectionCoords=vec2(0.);\n#endif\ncreateReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\nreflectionCoords\n);sampleReflectionTexture(\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionSampler,\nreflectionCoords,\n#else\nreflectionSampler,\nreflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentRadiance\n);vec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);environmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;outParams.environmentRadiance=environmentRadiance;outParams.environmentIrradiance=environmentIrradiance;outParams.reflectionCoords=reflectionCoords;return outParams;}\n#endif\n"}}),kl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockSheen.js"(){c(),"pbrBlockSheen","#ifdef SHEEN\nstruct sheenOutParams\n{float sheenIntensity;vec3 sheenColor;float sheenRoughness;\n#ifdef SHEEN_LINKWITHALBEDO\nvec3 surfaceAlbedo;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfloat sheenAlbedoScaling;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 finalSheenRadianceScaled;\n#endif\n#if DEBUGMODE>0\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 sheenEnvironmentReflectance;\n#endif\n#endif\n};\n#define pbr_inline\n#define inline\nsheenOutParams sheenBlock(\nin vec4 vSheenColor\n#ifdef SHEEN_ROUGHNESS\n,in float vSheenRoughness\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,in vec4 sheenMapRoughnessData\n#endif\n#endif\n,in float roughness\n#ifdef SHEEN_TEXTURE\n,in vec4 sheenMapData\n,in float sheenMapLevel\n#endif\n,in float reflectance\n#ifdef SHEEN_LINKWITHALBEDO\n,in vec3 baseColor\n,in vec3 surfaceAlbedo\n#endif\n#ifdef ENVIRONMENTBRDF\n,in float NdotV\n,in vec3 environmentBrdf\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,in vec2 AARoughnessFactors\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n,in vec4 vLightingIntensity\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n,in vec3 reflectionCoords\n#else\n,in sampler2D reflectionSampler\n,in vec2 reflectionCoords\n#endif\n,in float NdotVUnclamped\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,in float seo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,in float eho\n#endif\n#endif\n)\n{sheenOutParams outParams;float sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);float sheenRoughness=sheenIntensity;outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#else\nsheenColor.rgb*=sheenMapData.rgb;\n#endif\nsheenColor.rgb*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nfloat sheenRoughness=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#else\nfloat sheenRoughness=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvec3 environmentSheenBrdf=vec3(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvec3 environmentSheenBrdf=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);sampleReflectionTexture(\nsheenAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nsheenRoughness,\n#endif\nreflectionSampler,\nreflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentSheenRadiance\n);vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;outParams.sheenColor=sheenColor;outParams.sheenRoughness=sheenRoughness;return outParams;}\n#endif\n",e.IncludesShadersStore.pbrBlockSheen="#ifdef SHEEN\nstruct sheenOutParams\n{float sheenIntensity;vec3 sheenColor;float sheenRoughness;\n#ifdef SHEEN_LINKWITHALBEDO\nvec3 surfaceAlbedo;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfloat sheenAlbedoScaling;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 finalSheenRadianceScaled;\n#endif\n#if DEBUGMODE>0\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 sheenEnvironmentReflectance;\n#endif\n#endif\n};\n#define pbr_inline\n#define inline\nsheenOutParams sheenBlock(\nin vec4 vSheenColor\n#ifdef SHEEN_ROUGHNESS\n,in float vSheenRoughness\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,in vec4 sheenMapRoughnessData\n#endif\n#endif\n,in float roughness\n#ifdef SHEEN_TEXTURE\n,in vec4 sheenMapData\n,in float sheenMapLevel\n#endif\n,in float reflectance\n#ifdef SHEEN_LINKWITHALBEDO\n,in vec3 baseColor\n,in vec3 surfaceAlbedo\n#endif\n#ifdef ENVIRONMENTBRDF\n,in float NdotV\n,in vec3 environmentBrdf\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,in vec2 AARoughnessFactors\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n,in vec4 vLightingIntensity\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n,in vec3 reflectionCoords\n#else\n,in sampler2D reflectionSampler\n,in vec2 reflectionCoords\n#endif\n,in float NdotVUnclamped\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,in float seo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,in float eho\n#endif\n#endif\n)\n{sheenOutParams outParams;float sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);float sheenRoughness=sheenIntensity;outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#else\nsheenColor.rgb*=sheenMapData.rgb;\n#endif\nsheenColor.rgb*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nfloat sheenRoughness=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#else\nfloat sheenRoughness=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvec3 environmentSheenBrdf=vec3(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvec3 environmentSheenBrdf=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);sampleReflectionTexture(\nsheenAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nsheenRoughness,\n#endif\nreflectionSampler,\nreflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentSheenRadiance\n);vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;outParams.sheenColor=sheenColor;outParams.sheenRoughness=sheenRoughness;return outParams;}\n#endif\n"}}),Bl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockClearcoat.js"(){c(),"pbrBlockClearcoat","struct clearcoatOutParams\n{vec3 specularEnvironmentR0;float conservationFactor;vec3 clearCoatNormalW;vec2 clearCoatAARoughnessFactors;float clearCoatIntensity;float clearCoatRoughness;\n#ifdef REFLECTION\nvec3 finalClearCoatRadianceScaled;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 absorption;float clearCoatNdotVRefract;vec3 clearCoatColor;float clearCoatThickness;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nvec3 energyConservationFactorClearCoat;\n#endif\n#if DEBUGMODE>0\n#ifdef CLEARCOAT_BUMP\nmat3 TBNClearCoat;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData;\n#endif\n#ifdef REFLECTION\nvec4 environmentClearCoatRadiance;vec3 clearCoatEnvironmentReflectance;\n#endif\nfloat clearCoatNdotV;\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\n#define inline\nclearcoatOutParams clearcoatBlock(\nin vec3 vPositionW\n,in vec3 geometricNormalW\n,in vec3 viewDirectionW\n,in vec2 vClearCoatParams\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,in vec4 clearCoatMapRoughnessData\n#endif\n,in vec3 specularEnvironmentR0\n#ifdef CLEARCOAT_TEXTURE\n,in vec2 clearCoatMapData\n#endif\n#ifdef CLEARCOAT_TINT\n,in vec4 vClearCoatTintParams\n,in float clearCoatColorAtDistance\n,in vec4 vClearCoatRefractionParams\n#ifdef CLEARCOAT_TINT_TEXTURE\n,in vec4 clearCoatTintMapData\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,in vec2 vClearCoatBumpInfos\n,in vec4 clearCoatBumpMapData\n,in vec2 vClearCoatBumpUV\n#if defined(TANGENT) && defined(NORMAL)\n,in mat3 vTBN\n#else\n,in vec2 vClearCoatTangentSpaceParams\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,in mat4 normalMatrix\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,in vec3 faceNormal\n#endif\n#ifdef REFLECTION\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n,in vec4 vLightingIntensity\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n#else\n,in sampler2D reflectionSampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,in float ambientMonochrome\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,in float frontFacingMultiplier\n#endif\n)\n{clearcoatOutParams outParams;float clearCoatIntensity=vClearCoatParams.x;float clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;outParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;float clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);outParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvec3 specularEnvironmentR0Updated=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);vec3 clearCoatNormalW=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nvec2 TBNClearCoatUV=vClearCoatBumpUV*frontFacingMultiplier;mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatVRefract=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nsampleReflectionTexture(\nclearCoatAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nclearCoatNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nclearCoatRoughness,\n#endif\nreflectionSampler,\nclearCoatReflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentClearCoatRadiance\n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);clearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnelIBLClearCoat*=clearCoatIntensity;outParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\nreturn outParams;}\n#endif\n",e.IncludesShadersStore.pbrBlockClearcoat="struct clearcoatOutParams\n{vec3 specularEnvironmentR0;float conservationFactor;vec3 clearCoatNormalW;vec2 clearCoatAARoughnessFactors;float clearCoatIntensity;float clearCoatRoughness;\n#ifdef REFLECTION\nvec3 finalClearCoatRadianceScaled;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 absorption;float clearCoatNdotVRefract;vec3 clearCoatColor;float clearCoatThickness;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nvec3 energyConservationFactorClearCoat;\n#endif\n#if DEBUGMODE>0\n#ifdef CLEARCOAT_BUMP\nmat3 TBNClearCoat;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData;\n#endif\n#ifdef REFLECTION\nvec4 environmentClearCoatRadiance;vec3 clearCoatEnvironmentReflectance;\n#endif\nfloat clearCoatNdotV;\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\n#define inline\nclearcoatOutParams clearcoatBlock(\nin vec3 vPositionW\n,in vec3 geometricNormalW\n,in vec3 viewDirectionW\n,in vec2 vClearCoatParams\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,in vec4 clearCoatMapRoughnessData\n#endif\n,in vec3 specularEnvironmentR0\n#ifdef CLEARCOAT_TEXTURE\n,in vec2 clearCoatMapData\n#endif\n#ifdef CLEARCOAT_TINT\n,in vec4 vClearCoatTintParams\n,in float clearCoatColorAtDistance\n,in vec4 vClearCoatRefractionParams\n#ifdef CLEARCOAT_TINT_TEXTURE\n,in vec4 clearCoatTintMapData\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,in vec2 vClearCoatBumpInfos\n,in vec4 clearCoatBumpMapData\n,in vec2 vClearCoatBumpUV\n#if defined(TANGENT) && defined(NORMAL)\n,in mat3 vTBN\n#else\n,in vec2 vClearCoatTangentSpaceParams\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,in mat4 normalMatrix\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,in vec3 faceNormal\n#endif\n#ifdef REFLECTION\n,in vec3 vReflectionMicrosurfaceInfos\n,in vec2 vReflectionInfos\n,in vec3 vReflectionColor\n,in vec4 vLightingIntensity\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSampler\n#else\n,in sampler2D reflectionSampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\n,in samplerCube reflectionSamplerLow\n,in samplerCube reflectionSamplerHigh\n#else\n,in sampler2D reflectionSamplerLow\n,in sampler2D reflectionSamplerHigh\n#endif\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vReflectionFilteringInfo\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,in float ambientMonochrome\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,in float frontFacingMultiplier\n#endif\n)\n{clearcoatOutParams outParams;float clearCoatIntensity=vClearCoatParams.x;float clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;outParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;float clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);outParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvec3 specularEnvironmentR0Updated=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);vec3 clearCoatNormalW=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nvec2 TBNClearCoatUV=vClearCoatBumpUV*frontFacingMultiplier;mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatVRefract=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nsampleReflectionTexture(\nclearCoatAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nclearCoatNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nclearCoatRoughness,\n#endif\nreflectionSampler,\nclearCoatReflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentClearCoatRadiance\n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);clearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnelIBLClearCoat*=clearCoatIntensity;outParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\nreturn outParams;}\n#endif\n"}}),Gl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockIridescence.js"(){c(),"pbrBlockIridescence","struct iridescenceOutParams\n{float iridescenceIntensity;float iridescenceIOR;float iridescenceThickness;vec3 specularEnvironmentR0;};\n#ifdef IRIDESCENCE\n#define pbr_inline\n#define inline\niridescenceOutParams iridescenceBlock(\nin vec4 vIridescenceParams\n,in float viewAngle\n,in vec3 specularEnvironmentR0\n#ifdef IRIDESCENCE_TEXTURE\n,in vec2 iridescenceMapData\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,in vec2 iridescenceThicknessMapData\n#endif\n#ifdef CLEARCOAT\n,in float NdotVUnclamped\n#ifdef CLEARCOAT_TEXTURE\n,in vec2 clearCoatMapData\n#endif\n#endif\n)\n{iridescenceOutParams outParams;float iridescenceIntensity=vIridescenceParams.x;float iridescenceIOR=vIridescenceParams.y;float iridescenceThicknessMin=vIridescenceParams.z;float iridescenceThicknessMax=vIridescenceParams.w;float iridescenceThicknessWeight=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nfloat iridescenceThickness=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);float topIor=1.; \n#ifdef CLEARCOAT\nfloat clearCoatIntensity=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,vClearCoatRefractionParams.w-1.,clearCoatIntensity);viewAngle=sqrt(1.0+square(1.0/topIor)*(square(NdotVUnclamped)-1.0));\n#endif\nvec3 iridescenceFresnel=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);outParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);outParams.iridescenceIntensity=iridescenceIntensity;outParams.iridescenceThickness=iridescenceThickness;outParams.iridescenceIOR=iridescenceIOR;return outParams;}\n#endif\n",e.IncludesShadersStore.pbrBlockIridescence="struct iridescenceOutParams\n{float iridescenceIntensity;float iridescenceIOR;float iridescenceThickness;vec3 specularEnvironmentR0;};\n#ifdef IRIDESCENCE\n#define pbr_inline\n#define inline\niridescenceOutParams iridescenceBlock(\nin vec4 vIridescenceParams\n,in float viewAngle\n,in vec3 specularEnvironmentR0\n#ifdef IRIDESCENCE_TEXTURE\n,in vec2 iridescenceMapData\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,in vec2 iridescenceThicknessMapData\n#endif\n#ifdef CLEARCOAT\n,in float NdotVUnclamped\n#ifdef CLEARCOAT_TEXTURE\n,in vec2 clearCoatMapData\n#endif\n#endif\n)\n{iridescenceOutParams outParams;float iridescenceIntensity=vIridescenceParams.x;float iridescenceIOR=vIridescenceParams.y;float iridescenceThicknessMin=vIridescenceParams.z;float iridescenceThicknessMax=vIridescenceParams.w;float iridescenceThicknessWeight=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nfloat iridescenceThickness=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);float topIor=1.; \n#ifdef CLEARCOAT\nfloat clearCoatIntensity=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,vClearCoatRefractionParams.w-1.,clearCoatIntensity);viewAngle=sqrt(1.0+square(1.0/topIor)*(square(NdotVUnclamped)-1.0));\n#endif\nvec3 iridescenceFresnel=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);outParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);outParams.iridescenceIntensity=iridescenceIntensity;outParams.iridescenceThickness=iridescenceThickness;outParams.iridescenceIOR=iridescenceIOR;return outParams;}\n#endif\n"}}),Ul=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockSubSurface.js"(){c(),"pbrBlockSubSurface","struct subSurfaceOutParams\n{vec3 specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvec3 finalRefraction;vec3 surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nfloat alpha;\n#endif\n#ifdef REFLECTION\nfloat refractionFactorForIrradiance;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvec3 transmittance;float translucencyIntensity;\n#ifdef REFLECTION\nvec3 refractionIrradiance;\n#endif\n#endif\n#if DEBUGMODE>0\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction;vec3 refractionTransmittance;\n#endif\n#endif\n};\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#define pbr_inline\n#define inline\nvec4 sampleEnvironmentRefraction(\nin float ior\n,in float thickness\n,in float refractionLOD\n,in vec3 normalW\n,in vec3 vPositionW\n,in vec3 viewDirectionW\n,in mat4 view\n,in vec4 vRefractionInfos\n,in mat4 refractionMatrix\n,in vec4 vRefractionMicrosurfaceInfos\n,in float alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,in samplerCube refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in samplerCube refractionSamplerLow\n,in samplerCube refractionSamplerHigh\n#endif\n#else\n,in sampler2D refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in sampler2D refractionSamplerLow\n,in sampler2D refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,in vec3 refractionPosition\n,in vec3 refractionSize\n#endif\n) {vec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,ior);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,ior);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;vec3 refractionCoords=refractionVector;refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*thickness,1.0)));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\n#endif\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODBASEDMICROSFURACE\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\n#if defined(REALTIME_FILTERING) && defined(SS_REFRACTIONMAP_3D)\nenvironmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);if (lodRefractionNormalizedDoubled<1.0){environmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);} else {environmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\nreturn environmentRefraction;}\n#endif\n#define pbr_inline\n#define inline\nsubSurfaceOutParams subSurfaceBlock(\nin vec3 vSubSurfaceIntensity\n,in vec2 vThicknessParam\n,in vec4 vTintColor\n,in vec3 normalW\n,in vec3 specularEnvironmentReflectance\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,in vec4 thicknessMap\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,in vec4 refractionIntensityMap\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,in vec4 translucencyIntensityMap\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,in mat4 reflectionMatrix\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,in vec3 irradianceVector_\n#endif\n#if defined(REALTIME_FILTERING)\n,in samplerCube reflectionSampler\n,in vec2 vReflectionFilteringInfo\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,in samplerCube irradianceSampler\n#else\n,in sampler2D irradianceSampler\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,in vec3 surfaceAlbedo\n#endif\n#ifdef SS_REFRACTION\n,in vec3 vPositionW\n,in vec3 viewDirectionW\n,in mat4 view\n,in vec4 vRefractionInfos\n,in mat4 refractionMatrix\n,in vec4 vRefractionMicrosurfaceInfos\n,in vec4 vLightingIntensity\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,in float alpha\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,in float NdotVUnclamped\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,in float roughness\n#endif\n,in float alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,in samplerCube refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in samplerCube refractionSamplerLow\n,in samplerCube refractionSamplerHigh\n#endif\n#else\n,in sampler2D refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in sampler2D refractionSamplerLow\n,in sampler2D refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,in vec3 refractionPosition\n,in vec3 refractionSize\n#endif\n#ifdef SS_DISPERSION\n,in float dispersion\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,in vec3 vDiffusionDistance\n,in vec4 vTranslucencyColor\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,in vec4 translucencyColorMap\n#endif\n#endif\n)\n{subSurfaceOutParams outParams;outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);outParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nfloat thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=thicknessMap.a;\n#else\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTIONINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCYINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=translucencyIntensityMap.a;\n#else\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);vec4 translucencyColor=vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\ntranslucencyColor*=translucencyColorMap;\n#endif\nvec3 transmittance=transmittanceBRDF_Burley(translucencyColor.rgb,vDiffusionDistance,thickness);transmittance*=translucencyIntensity;outParams.transmittance=transmittance;outParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef SS_HAS_THICKNESS\nfloat ior=vRefractionInfos.y;\n#else\nfloat ior=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionAlphaG=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionRoughness=alphaG;refractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nfloat refractionAlphaG=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\nfloat refraction_ior=vRefractionInfos.y;\n#ifdef SS_DISPERSION\nfloat realIOR=1.0/refraction_ior;float iorDispersionSpread=0.04*dispersion*(realIOR-1.0);vec3 iors=vec3(1.0/(realIOR-iorDispersionSpread),refraction_ior,1.0/(realIOR+iorDispersionSpread));for (int i=0; i<3; i++) {refraction_ior=iors[i];\n#endif\nvec4 envSample=sampleEnvironmentRefraction(refraction_ior,thickness,refractionLOD,normalW,vPositionW,viewDirectionW,view,vRefractionInfos,refractionMatrix,vRefractionMicrosurfaceInfos,alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionSamplerLow\n,refractionSamplerHigh\n#endif\n#else\n,refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionSamplerLow\n,refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition\n,refractionSize\n#endif\n);\n#ifdef SS_DISPERSION\nenvironmentRefraction[i]=envSample[i];}\n#else\nenvironmentRefraction=envSample;\n#endif\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);environmentRefraction.rgb*=volumeAlbedo;\n#else\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvec3 irradianceVector=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvec3 irradianceCoords=irradianceVector;\n#else\nvec2 irradianceCoords=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec4 refractionIrradiance=vec4(0.);\n#endif\nrefractionIrradiance.rgb*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance.rgb;\n#endif\nreturn outParams;}\n#endif\n",e.IncludesShadersStore.pbrBlockSubSurface="struct subSurfaceOutParams\n{vec3 specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvec3 finalRefraction;vec3 surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nfloat alpha;\n#endif\n#ifdef REFLECTION\nfloat refractionFactorForIrradiance;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvec3 transmittance;float translucencyIntensity;\n#ifdef REFLECTION\nvec3 refractionIrradiance;\n#endif\n#endif\n#if DEBUGMODE>0\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction;vec3 refractionTransmittance;\n#endif\n#endif\n};\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#define pbr_inline\n#define inline\nvec4 sampleEnvironmentRefraction(\nin float ior\n,in float thickness\n,in float refractionLOD\n,in vec3 normalW\n,in vec3 vPositionW\n,in vec3 viewDirectionW\n,in mat4 view\n,in vec4 vRefractionInfos\n,in mat4 refractionMatrix\n,in vec4 vRefractionMicrosurfaceInfos\n,in float alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,in samplerCube refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in samplerCube refractionSamplerLow\n,in samplerCube refractionSamplerHigh\n#endif\n#else\n,in sampler2D refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in sampler2D refractionSamplerLow\n,in sampler2D refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,in vec3 refractionPosition\n,in vec3 refractionSize\n#endif\n) {vec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,ior);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,ior);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;vec3 refractionCoords=refractionVector;refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*thickness,1.0)));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\n#endif\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODBASEDMICROSFURACE\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\n#if defined(REALTIME_FILTERING) && defined(SS_REFRACTIONMAP_3D)\nenvironmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);if (lodRefractionNormalizedDoubled<1.0){environmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);} else {environmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\nreturn environmentRefraction;}\n#endif\n#define pbr_inline\n#define inline\nsubSurfaceOutParams subSurfaceBlock(\nin vec3 vSubSurfaceIntensity\n,in vec2 vThicknessParam\n,in vec4 vTintColor\n,in vec3 normalW\n,in vec3 specularEnvironmentReflectance\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,in vec4 thicknessMap\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,in vec4 refractionIntensityMap\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,in vec4 translucencyIntensityMap\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,in mat4 reflectionMatrix\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,in vec3 irradianceVector_\n#endif\n#if defined(REALTIME_FILTERING)\n,in samplerCube reflectionSampler\n,in vec2 vReflectionFilteringInfo\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\n,in samplerCube irradianceSampler\n#else\n,in sampler2D irradianceSampler\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,in vec3 surfaceAlbedo\n#endif\n#ifdef SS_REFRACTION\n,in vec3 vPositionW\n,in vec3 viewDirectionW\n,in mat4 view\n,in vec4 vRefractionInfos\n,in mat4 refractionMatrix\n,in vec4 vRefractionMicrosurfaceInfos\n,in vec4 vLightingIntensity\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,in float alpha\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,in float NdotVUnclamped\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,in float roughness\n#endif\n,in float alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,in samplerCube refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in samplerCube refractionSamplerLow\n,in samplerCube refractionSamplerHigh\n#endif\n#else\n,in sampler2D refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,in sampler2D refractionSamplerLow\n,in sampler2D refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,in anisotropicOutParams anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,in vec2 vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,in vec3 refractionPosition\n,in vec3 refractionSize\n#endif\n#ifdef SS_DISPERSION\n,in float dispersion\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,in vec3 vDiffusionDistance\n,in vec4 vTranslucencyColor\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,in vec4 translucencyColorMap\n#endif\n#endif\n)\n{subSurfaceOutParams outParams;outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);outParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nfloat thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=thicknessMap.a;\n#else\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#if defined(SS_REFRACTION) && defined(SS_REFRACTIONINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCYINTENSITY_TEXTURE)\n#ifdef SS_USE_GLTF_TEXTURES\ntranslucencyIntensity*=translucencyIntensityMap.a;\n#else\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);vec4 translucencyColor=vTranslucencyColor;\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\ntranslucencyColor*=translucencyColorMap;\n#endif\nvec3 transmittance=transmittanceBRDF_Burley(translucencyColor.rgb,vDiffusionDistance,thickness);transmittance*=translucencyIntensity;outParams.transmittance=transmittance;outParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef SS_HAS_THICKNESS\nfloat ior=vRefractionInfos.y;\n#else\nfloat ior=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionAlphaG=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionRoughness=alphaG;refractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nfloat refractionAlphaG=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\nfloat refraction_ior=vRefractionInfos.y;\n#ifdef SS_DISPERSION\nfloat realIOR=1.0/refraction_ior;float iorDispersionSpread=0.04*dispersion*(realIOR-1.0);vec3 iors=vec3(1.0/(realIOR-iorDispersionSpread),refraction_ior,1.0/(realIOR+iorDispersionSpread));for (int i=0; i<3; i++) {refraction_ior=iors[i];\n#endif\nvec4 envSample=sampleEnvironmentRefraction(refraction_ior,thickness,refractionLOD,normalW,vPositionW,viewDirectionW,view,vRefractionInfos,refractionMatrix,vRefractionMicrosurfaceInfos,alphaG\n#ifdef SS_REFRACTIONMAP_3D\n,refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionSamplerLow\n,refractionSamplerHigh\n#endif\n#else\n,refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionSamplerLow\n,refractionSamplerHigh\n#endif\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,refractionPosition\n,refractionSize\n#endif\n);\n#ifdef SS_DISPERSION\nenvironmentRefraction[i]=envSample[i];}\n#else\nenvironmentRefraction=envSample;\n#endif\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);environmentRefraction.rgb*=volumeAlbedo;\n#else\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvec3 irradianceVector=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvec3 irradianceCoords=irradianceVector;\n#else\nvec2 irradianceCoords=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec4 refractionIrradiance=vec4(0.);\n#endif\nrefractionIrradiance.rgb*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance.rgb;\n#endif\nreturn outParams;}\n#endif\n"}}),Hl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockNormalGeometric.js"(){c(),"pbrBlockNormalGeometric","vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\nvec3 geometricNormalW=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;\n#endif\n",e.IncludesShadersStore.pbrBlockNormalGeometric="vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\nvec3 geometricNormalW=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;\n#endif\n"}}),Vl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockNormalFinal.js"(){c(),"pbrBlockNormalFinal","#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n",e.IncludesShadersStore.pbrBlockNormalFinal="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n"}}),Wl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockLightmapInit.js"(){c(),"pbrBlockLightmapInit","#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n",e.IncludesShadersStore.pbrBlockLightmapInit="#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n"}}),zl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockGeometryInfo.js"(){c(),"pbrBlockGeometryInfo","float NdotVUnclamped=dot(normalW,viewDirectionW);float NdotV=absEps(NdotVUnclamped);float alphaG=convertRoughnessToAverageSlope(roughness);vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=aoOut.ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n",e.IncludesShadersStore.pbrBlockGeometryInfo="float NdotVUnclamped=dot(normalW,viewDirectionW);float NdotV=absEps(NdotVUnclamped);float alphaG=convertRoughnessToAverageSlope(roughness);vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=aoOut.ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n"}}),Xl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectance0.js"(){c(),"pbrBlockReflectance0","float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);vec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);\n#else \nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nfloat reflectance90=fresnelGrazingReflectance(reflectance);specularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n",e.IncludesShadersStore.pbrBlockReflectance0="float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);vec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);\n#else \nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nfloat reflectance90=fresnelGrazingReflectance(reflectance);specularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n"}}),Yl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectance.js"(){c(),"pbrBlockReflectance","#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n",e.IncludesShadersStore.pbrBlockReflectance="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n"}}),jl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockDirectLighting.js"(){c(),"pbrBlockDirectLighting","vec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\npreLightingInfo preInfo;lightingInfo info;float shadow=1.; \nfloat aggShadow=0.;float numLights=0.;\n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvec3 absorption=vec3(0.);\n#endif\n",e.IncludesShadersStore.pbrBlockDirectLighting="vec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\npreLightingInfo preInfo;lightingInfo info;float shadow=1.; \nfloat aggShadow=0.;float numLights=0.;\n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvec3 absorption=vec3(0.);\n#endif\n"}}),Kl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalLitComponents.js"(){c(),"pbrBlockFinalLitComponents","aggShadow=aggShadow/numLights;\n#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvec3 finalIrradiance=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);finalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;finalIrradiance*=vLightingIntensity.z;finalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;finalSpecular=max(finalSpecular,0.0);vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvec3 finalRadiance=reflectionOut.environmentRadiance.rgb;finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenOut.sheenColor;finalSheen=max(finalSheen,0.0);vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;finalClearCoat=max(finalClearCoat,0.0);vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n",e.IncludesShadersStore.pbrBlockFinalLitComponents="aggShadow=aggShadow/numLights;\n#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvec3 finalIrradiance=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);finalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;finalIrradiance*=vLightingIntensity.z;finalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;finalSpecular=max(finalSpecular,0.0);vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvec3 finalRadiance=reflectionOut.environmentRadiance.rgb;finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenOut.sheenColor;finalSheen=max(finalSheen,0.0);vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;finalClearCoat=max(finalClearCoat,0.0);vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n"}}),$l=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalUnlitComponents.js"(){c(),"pbrBlockFinalUnlitComponents","vec3 finalDiffuse=diffuseBase;finalDiffuse*=surfaceAlbedo.rgb;finalDiffuse=max(finalDiffuse,0.0);finalDiffuse*=vLightingIntensity.x;vec3 finalAmbient=vAmbientColor;finalAmbient*=surfaceAlbedo.rgb;vec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= vEmissiveInfos.y;\n#endif\nfinalEmissive*=vLightingIntensity.y;\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;finalDiffuse*=ambientOcclusionForDirectDiffuse;\n",e.IncludesShadersStore.pbrBlockFinalUnlitComponents="vec3 finalDiffuse=diffuseBase;finalDiffuse*=surfaceAlbedo.rgb;finalDiffuse=max(finalDiffuse,0.0);finalDiffuse*=vLightingIntensity.x;vec3 finalAmbient=vAmbientColor;finalAmbient*=surfaceAlbedo.rgb;vec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= vEmissiveInfos.y;\n#endif\nfinalEmissive*=vLightingIntensity.y;\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;finalDiffuse*=ambientOcclusionForDirectDiffuse;\n"}}),ql=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalColorComposition.js"(){c(),"pbrBlockFinalColorComposition","vec4 finalColor=vec4(\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalAmbient +\nfinalDiffuse,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\nfinalColor.rgb+=finalEmissive;\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,0.0);\n",e.IncludesShadersStore.pbrBlockFinalColorComposition="vec4 finalColor=vec4(\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalAmbient +\nfinalDiffuse,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\nfinalColor.rgb+=finalEmissive;\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,0.0);\n"}}),Jl=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockImageProcessing.js"(){c(),"pbrBlockImageProcessing","#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\nfinalColor.rgb*=finalColor.a;\n#endif\n",e.IncludesShadersStore.pbrBlockImageProcessing="#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\nfinalColor.rgb*=finalColor.a;\n#endif\n"}}),Ql=o({"../node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDebug.js"(){c(),"pbrDebug","#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {\n#if DEBUGMODE==1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#ifndef GAMMAALBEDO\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==21 && defined(AMBIENT)\ngl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#ifndef GAMMAEMISSIVE\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#ifndef GAMMALIGHTMAP\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==32 && defined(BUMP)\ngl_FragColor.rgb=texture2D(bumpSampler,vBumpUV).rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ngl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE==64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE==65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==72\ngl_FragColor.rgb=vec3(microSurface);\n#elif DEBUGMODE==73\ngl_FragColor.rgb=vAlbedoColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==74 && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vReflectivityColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==75\ngl_FragColor.rgb=vEmissiveColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE==87\ngl_FragColor.rgb=vec3(alpha);\n#elif DEBUGMODE==88 && defined(ALBEDO)\ngl_FragColor.rgb=vec3(albedoTexture.a);\n#elif DEBUGMODE==89\ngl_FragColor.rgb=aoOut.ambientOcclusionColor.rgb;\n#else\nfloat stripeWidth=30.;float stripePos=floor(gl_FragCoord.x/stripeWidth);float whichColor=mod(stripePos,2.);vec3 color1=vec3(.6,.2,.2);vec3 color2=vec3(.3,.1,.1);gl_FragColor.rgb=mix(color1,color2,whichColor);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#ifdef PREPASS\ngl_FragData[0]=toLinearSpace(gl_FragColor); \ngl_FragData[1]=vec4(0.,0.,0.,0.); \n#endif\n#ifdef DEBUGMODE_FORCERETURN\nreturn;\n#endif\n}\n#endif\n",e.IncludesShadersStore.pbrDebug="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {\n#if DEBUGMODE==1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#ifndef GAMMAALBEDO\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==21 && defined(AMBIENT)\ngl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#ifndef GAMMAEMISSIVE\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#ifndef GAMMALIGHTMAP\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==32 && defined(BUMP)\ngl_FragColor.rgb=texture2D(bumpSampler,vBumpUV).rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;\n#ifndef GAMMAREFLECTION\n#define DEBUGMODE_GAMMA\n#endif\n#elif DEBUGMODE==60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ngl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE==64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE==65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==72\ngl_FragColor.rgb=vec3(microSurface);\n#elif DEBUGMODE==73\ngl_FragColor.rgb=vAlbedoColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==74 && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vReflectivityColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==75\ngl_FragColor.rgb=vEmissiveColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE==87\ngl_FragColor.rgb=vec3(alpha);\n#elif DEBUGMODE==88 && defined(ALBEDO)\ngl_FragColor.rgb=vec3(albedoTexture.a);\n#elif DEBUGMODE==89\ngl_FragColor.rgb=aoOut.ambientOcclusionColor.rgb;\n#else\nfloat stripeWidth=30.;float stripePos=floor(gl_FragCoord.x/stripeWidth);float whichColor=mod(stripePos,2.);vec3 color1=vec3(.6,.2,.2);vec3 color2=vec3(.3,.1,.1);gl_FragColor.rgb=mix(color1,color2,whichColor);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#ifdef PREPASS\ngl_FragData[0]=toLinearSpace(gl_FragColor); \ngl_FragData[1]=vec4(0.,0.,0.,0.); \n#endif\n#ifdef DEBUGMODE_FORCERETURN\nreturn;\n#endif\n}\n#endif\n"}}),Zl={};l(Zl,{pbrPixelShader:()=>_l});var ec=o({"../node_modules/@babylonjs/core/Shaders/pbr.fragment.js"(){c(),As(),Cs(),gl(),fl(),Sl(),be(),Ue(),El(),Ms(),vn(),rs(),Nt(),tt(),Al(),Cl(),Rl(),Is(),ft(),ul(),Tl(),Nl(),Ml(),Il(),xl(),bl(),xs(),bs(),Ns(),Pl(),wl(),Ol(),Dl(),Ll(),Fl(),kl(),Bl(),Gl(),Ul(),gn(),Hl(),Ps(),Vl(),Os(),Wl(),zl(),Xl(),Yl(),jl(),Le(),Kl(),$l(),ql(),Ds(),Ls(),Jl(),Fs(),Ql(),ml="pbrPixelShader",pl="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\nprecision highp float;\n#include<oitDeclaration>\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockIridescence>\n#include<pbrBlockSubSurface>\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\nalbedoOpacityOutParams albedoOpacityOut;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#endif\n#ifdef DECAL\nvec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);\n#endif\nalbedoOpacityOut=albedoOpacityBlock(\nvAlbedoColor\n#ifdef ALBEDO\n,albedoTexture\n,vAlbedoInfos\n#endif\n#ifdef OPACITY\n,opacityMap\n,vOpacityInfos\n#endif\n#ifdef DETAIL\n,detailColor\n,vDetailInfos\n#endif\n#ifdef DECAL\n,decalColor\n,vDecalInfos\n#endif\n);vec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;float alpha=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\nambientOcclusionOutParams aoOut;\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;\n#endif\naoOut=ambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nvAmbientInfos\n#endif \n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\nvec3 baseColor=surfaceAlbedo;reflectivityOutParams reflectivityOut;\n#if defined(REFLECTIVITY)\nvec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);vec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\n#ifdef REFLECTIVITY_GAMMA\nsurfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);\n#endif\nsurfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvec4 metallicReflectanceFactors=vMetallicReflectanceFactors;\n#ifdef REFLECTANCE\nvec4 reflectanceFactorsMap=texture2D(reflectanceSampler,vReflectanceUV+uvOffset);\n#ifdef REFLECTANCE_GAMMA\nreflectanceFactorsMap=toLinearSpace(reflectanceFactorsMap);\n#endif\nmetallicReflectanceFactors.rgb*=reflectanceFactorsMap.rgb;\n#endif\n#ifdef METALLIC_REFLECTANCE\nvec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);\n#ifdef METALLIC_REFLECTANCE_GAMMA\nmetallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);\n#endif\n#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY\nmetallicReflectanceFactors.rgb*=metallicReflectanceFactorsMap.rgb;\n#endif\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap.a;\n#endif\n#endif\nreflectivityOut=reflectivityBlock(\nvReflectivityColor\n#ifdef METALLICWORKFLOW\n,surfaceAlbedo\n,metallicReflectanceFactors\n#endif\n#ifdef REFLECTIVITY\n,vReflectivityInfos\n,surfaceMetallicOrReflectivityColorMap\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n,aoOut.ambientOcclusionColor\n#endif\n#ifdef MICROSURFACEMAP\n,microSurfaceTexel\n#endif\n#ifdef DETAIL\n,detailColor\n,vDetailInfos\n#endif\n);float microSurface=reflectivityOut.microSurface;float roughness=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nalphaFresnelOutParams alphaFresnelOut;alphaFresnelOut=alphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface\n);alpha=alphaFresnelOut.alpha;\n#endif\n#endif\n#include<pbrBlockGeometryInfo>\n#ifdef ANISOTROPIC\nanisotropicOutParams anisotropicOut;\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\n#endif\nanisotropicOut=anisotropicBlock(\nvAnisotropy,\nroughness,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW \n);\n#endif\n#ifdef REFLECTION\nreflectionOutParams reflectionOut;\n#ifndef USE_CUSTOM_REFLECTION\nreflectionOut=reflectionBlock(\nvPositionW\n,normalW\n,alphaG\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\n,NdotVUnclamped\n#endif\n#ifdef LINEARSPECULARREFLECTION\n,roughness\n#endif\n,reflectionSampler\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n,vEnvironmentIrradiance\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionMatrix\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n,irradianceSampler\n#endif\n#ifndef LODBASEDMICROSFURACE\n,reflectionSamplerLow\n,reflectionSamplerHigh\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n);\n#else\n#define CUSTOM_REFLECTION\n#endif\n#endif\n#include<pbrBlockReflectance0>\n#ifdef SHEEN\nsheenOutParams sheenOut;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset);\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;\n#endif\nsheenOut=sheenBlock(\nvSheenColor\n#ifdef SHEEN_ROUGHNESS\n,vSheenRoughness\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,sheenMapRoughnessData\n#endif\n#endif\n,roughness\n#ifdef SHEEN_TEXTURE\n,sheenMapData\n,vSheenInfos.y\n#endif\n,reflectance\n#ifdef SHEEN_LINKWITHALBEDO\n,baseColor\n,surfaceAlbedo\n#endif\n#ifdef ENVIRONMENTBRDF\n,NdotV\n,environmentBrdf\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n,AARoughnessFactors\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n,vLightingIntensity\n,reflectionSampler\n,reflectionOut.reflectionCoords\n,NdotVUnclamped\n#ifndef LODBASEDMICROSFURACE\n,reflectionSamplerLow\n,reflectionSamplerHigh\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\n,seo\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\n,eho\n#endif\n#endif\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\n#endif\n#endif\n#ifdef IRIDESCENCE\niridescenceOutParams iridescenceOut;\n#ifdef IRIDESCENCE_TEXTURE\nvec2 iridescenceMapData=texture2D(iridescenceSampler,vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nvec2 iridescenceThicknessMapData=texture2D(iridescenceThicknessSampler,vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;\n#endif\niridescenceOut=iridescenceBlock(\nvIridescenceParams\n,NdotV\n,specularEnvironmentR0\n#ifdef IRIDESCENCE_TEXTURE\n,iridescenceMapData\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\n,iridescenceThicknessMapData\n#endif\n#ifdef CLEARCOAT\n,NdotVUnclamped\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData\n#endif\n#endif\n);float iridescenceIntensity=iridescenceOut.iridescenceIntensity;specularEnvironmentR0=iridescenceOut.specularEnvironmentR0;\n#endif\nclearcoatOutParams clearcoatOut;\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\n#endif\n#ifdef CLEARCOAT_BUMP\nvec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatOut=clearcoatBlock(\nvPositionW\n,geometricNormalW\n,viewDirectionW\n,vClearCoatParams\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n,clearCoatMapRoughnessData\n#endif\n,specularEnvironmentR0\n#ifdef CLEARCOAT_TEXTURE\n,clearCoatMapData\n#endif\n#ifdef CLEARCOAT_TINT\n,vClearCoatTintParams\n,clearCoatColorAtDistance\n,vClearCoatRefractionParams\n#ifdef CLEARCOAT_TINT_TEXTURE\n,clearCoatTintMapData\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\n,vClearCoatBumpInfos\n,clearCoatBumpMapData\n,vClearCoatBumpUV\n#if defined(TANGENT) && defined(NORMAL)\n,vTBN\n#else\n,vClearCoatTangentSpaceParams\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n,normalMatrix\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\n,faceNormal\n#endif\n#ifdef REFLECTION\n,vReflectionMicrosurfaceInfos\n,vReflectionInfos\n,vReflectionColor\n,vLightingIntensity\n,reflectionSampler\n#ifndef LODBASEDMICROSFURACE\n,reflectionSamplerLow\n,reflectionSamplerHigh\n#endif\n#ifdef REALTIME_FILTERING\n,vReflectionFilteringInfo\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n,ambientMonochrome\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n,(gl_FrontFacing ? 1. : -1.)\n#endif\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n#include<pbrBlockReflectance>\nsubSurfaceOutParams subSurfaceOut;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nvec4 refractionIntensityMap=texture2D(refractionIntensitySampler,vRefractionIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nvec4 translucencyIntensityMap=texture2D(translucencyIntensitySampler,vTranslucencyIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\nvec4 translucencyColorMap=texture2D(translucencyColorSampler,vTranslucencyColorUV+uvOffset);\n#endif\nsubSurfaceOut=subSurfaceBlock(\nvSubSurfaceIntensity\n,vThicknessParam\n,vTintColor\n,normalW\n,specularEnvironmentReflectance\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n,thicknessMap\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n,refractionIntensityMap\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\n,translucencyIntensityMap\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\n,reflectionMatrix\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n,reflectionOut.irradianceVector\n#endif\n#if defined(REALTIME_FILTERING)\n,reflectionSampler\n,vReflectionFilteringInfo\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n,irradianceSampler\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n,surfaceAlbedo\n#endif\n#ifdef SS_REFRACTION\n,vPositionW\n,viewDirectionW\n,view\n,vRefractionInfos\n,refractionMatrix\n,vRefractionMicrosurfaceInfos\n,vLightingIntensity\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n,alpha\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\n,NdotVUnclamped\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\n,roughness\n#endif\n,alphaG\n,refractionSampler\n#ifndef LODBASEDMICROSFURACE\n,refractionSamplerLow\n,refractionSamplerHigh\n#endif\n#ifdef ANISOTROPIC\n,anisotropicOut\n#endif\n#ifdef REALTIME_FILTERING\n,vRefractionFilteringInfo\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n,vRefractionPosition\n,vRefractionSize\n#endif\n#ifdef SS_DISPERSION\n,dispersion\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\n,vDiffusionDistance\n,vTranslucencyColor\n#ifdef SS_TRANSLUCENCYCOLOR_TEXTURE\n,translucencyColorMap\n#endif\n#endif\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n#include<pbrBlockFinalLitComponents>\n#endif \n#include<pbrBlockFinalUnlitComponents>\n#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=finalColor.a>0.4 ? 1.0 : 0.0;\n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;vec2 velocity=abs(a-b);velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nvec3 sqAlbedo=sqrt(surfaceAlbedo); \n#endif\n#ifdef PREPASS_IRRADIANCE\nvec3 irradiance=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\n#ifdef SS_SCATTERING\ngl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a); \nirradiance/=sqAlbedo;\n#else\ngl_FragData[0]=finalColor; \nfloat scatteringDiffusionProfile=255.;\n#endif\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(clamp(irradiance,vec3(0.),vec3(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); \n#else\ngl_FragData[0]=vec4(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\n#ifdef PREPASS_NORMAL_WORLDSPACE\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalW,writeGeometryInfo); \n#else\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalize((view*vec4(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(sqAlbedo,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#ifndef UNLIT\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularEnvironmentR0,microSurface)*writeGeometryInfo;\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4( 0.0,0.0,0.0,1.0 )*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=finalColor;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {frontColor.rgb+=finalColor.rgb*finalColor.a*alphaMultiplier;frontColor.a=1.0-alphaMultiplier*(1.0-finalColor.a);} else {backColor+=finalColor;}\n#endif\n#include<pbrDebug>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n",e.ShadersStore[ml]=pl,_l={name:ml,shader:pl}}}),tc={gameNotFound:0,gameFull:0,badName:0,mainMenu:0,gameIdleExceeded:0,corruptedLoginData0:0,corruptedLoginData1:0,corruptedLoginData2:0,corruptedLoginData3:0,corruptedLoginData4:0,corruptedLoginData5:0,gameMaxPlayersExceeded:0,gameDestroyUser:0,joinGameOutOfOrder:0,gameShuttingDown:0,readyBeforeReady:0,booted:0,gameErrorOnUserSocket:0,uuidNotFound:0,sessionNotFound:0,clusterFullCpu:0,clusterFullMem:0,noClustersAvailable:0,locked:0},ic=4e3;Object.keys(tc).forEach((e=>{tc[e]=ic++}));var nc={t:100,k:101,M:102,I:103,N:104,J:105,T:106,F:107,_:108,K:109,W:110,v:111,G:112,U:113,O:114,i:115,D:116,j:117,H:118,S:119,$:120,u:121,V:122,C:123,P:124,tt:125,kt:126,Mt:127,dt:128,rt:129,It:130,Xt:131,Nt:132,At:133,wt:134,Jt:135,Tt:136,Ft:137,Bt:138,ht:139,_t:140,Kt:141,nt:142,Et:143,ot:144,Zt:145,et:146,Wt:147,vt:148,Gt:149,zt:150,Ut:151,Ot:152,it:153,Qt:154,Dt:155,bt:156,Yt:157,Rt:158,jt:159,ct:160,yt:161};ic=0;Object.keys(nc).forEach((e=>{nc[e]=ic++}));Object.keys(nc).reduce(((e,t)=>(e[nc[t]]=t,e)),{});var ac={none:0,pinned:2,team:4},sc={blue:1,red:2},rc={ffa:0,teams:1,ctf:2,king:3},oc=[{shortName:"FFA",longName:"Free For All",value:0},{shortName:"Teams",longName:"Teams",value:1},{shortName:"Spatula",longName:"Captula the Spatula",value:2},{shortName:"King",longName:"King of the Coop",value:3}],lc=[{name:"Eggk47"},{name:"Scrambler"},{name:"FreeRanger"},{name:"Cluck9mm"},{name:"Rpegg"},{name:"Whipper"},{name:"Crackshot"},{name:"TriHard"},{name:"Grenade"},{name:"Melee"},{name:"Fall"}],cc=Math.ceil(3),hc={perKill:10,video:100,perKillModTwo:20,discord:"rew_1200",tiktok:"rew_1208",Instagram:"rew_1219",Steam:"rew_1223",Facebook:"rew_1227",Twitter:"rew_1234",Twitch:"rew_twitch_social"},fc=7,uc={HardBoiled:1,EggBreaker:2,Restock:4,OverHeal:8,DoubleEggs:16,MiniEgg:32},dc={dailyLimit:3,cooldown:240,dailyCooldown:86400},mc={Primary:0,Secondary:1},pc={Hat:1,Stamp:2,Primary:3,Secondary:4,Grenade:6,Melee:7},_c={Soldier:0,Scrambler:1,Ranger:2,Eggsploder:3,Whipper:4,Crackshot:5,TriHard:6};_c.length=Object.keys(_c).length;var vc=["kills","deaths","streak","killsCluck9mm","killsGrenade","killsRpegg","killsEggk47","killsScrambler","killsFreeRanger","killsWhipper","killsCrackshot","killsTriHard","killsMelee","killsPrivate","killsPublic","killsKing","killsSpatula","killsTeams","killsFFA","deathsCluck9mm","deathsGrenade","deathsRpegg","deathsEggk47","deathsScrambler","deathsFreeRanger","deathsWhipper","deathsCrackshot","deathsTriHard","deathsMelee","deathsFall","deathsPrivate","deathsPublic","deathsKing","deathsSpatula","deathsTeams","deathsFFA","kotcCaptured","kotcWins"],gc={0:1584,1:1585},Sc={0:"rew_eggfu",1:"rew_eggsassin"},yc={a:20,b:20,c:20},Ec="1.0.0",Ac="a37ad6b8e",Cc=class{recycle(e){e.active=!1,this.numActive--}forEachActive(e){for(var t=0;t<this.size;t++){var i=this.objects[t];!0===i.active&&e(i,t)}}constructor(e,t){this.size=0,this.originalSize=t,this.constructorFn=e,this.objects=[],this.idx=0,this.numActive=0,this.expand(t)}retrieve(e){if(null!=e){for(;e>=this.size;)this.expand(this.originalSize);return this.numActive++,this.objects[e].active=!0,this.objects[e]}var t=this.idx;do{t=(t+1)%this.size;var i=this.objects[t];if(!i.active)return this.idx=t,this.numActive++,i.active=!0,i}while(t!=this.idx);return this.expand(this.originalSize),console.log("Expanding pool for: "+this.objects[0].constructor.name+" to: "+this.size),this.retrieve()}expand(e){for(var t=0;t<e;t++){var i=this.constructorFn();i.id=t+this.size,i.active=!1,this.objects.push(i)}this.size+=e}},Rc=class{constructor(e){this.idx=0,this.arrayBuffer=new ArrayBuffer(e),this.buffer=new Uint8Array(this.arrayBuffer,0,e)}kMzMvLp(e){this.ABkMzMvKE(8192*(e+Math.PI))}ABkMzMvKl(e){this.ABkMzMvKE(256*e)}ABkMzMvKP(e){this.buffer[this.idx]=255&e,this.buffer[this.idx+1]=e>>8&255,this.buffer[this.idx+2]=e>>16&255,this.idx+=3}BkMzMvLe(e){this.ABkMzMvKP(2097152*e)}BkMzMvJt(e){this.buffer[this.idx]=255&e,this.idx++}AAAAAABkMzMvLT(e){"string"!=typeof e&&(e=""),this.ABkMzMvKE(e.length);for(var t=0;t<e.length;t++)this.ABkMzMvKE(e.charCodeAt(t))}AABkMzMvLI(e){"string"!=typeof e&&(e=""),this.BkMzMvJt(e.length);for(var t=0;t<e.length;t++)this.ABkMzMvKE(e.charCodeAt(t))}ABkMzMvKa(e){this.buffer[this.idx]=255&e,this.buffer[this.idx+1]=e>>8&255,this.buffer[this.idx+2]=e>>16&255,this.buffer[this.idx+3]=e>>24&255,this.idx+=4}AABkMzMvKw(e){this.ABkMzMvKa(1048576*e)}send(e){var t=new Uint8Array(this.arrayBuffer,0,this.idx);e.send(t),Tc.bufferPool.recycle(this)}ABkMzMvKE(e){this.buffer[this.idx]=255&e,this.buffer[this.idx+1]=e>>8&255,this.idx+=2}},Tc=class{static getBuffer(){var e=this.bufferPool.retrieve();return e.idx=0,e}};Tc.buffer=null,Tc.bufferPool=new Cc((()=>new Rc(16384)),2);var Nc=class{static unPackRad(){return this.unPackInt16U()/8192-Math.PI}static unPackRadU(){return this.unPackInt24U()/2097152}static unPackInt16(){return(this.unPackInt16U()+32768)%65536-32768}static peekInt8U(){return this.buffer[this.idx]}static unPackInt8(){return(this.unPackInt8U()+128)%256-128}static isMoreDataAvailable(){return Math.max(0,this.buffer.length-this.idx)}static unPackInt32U(){var e=this.idx;return this.idx+=4,this.buffer[e]+256*this.buffer[e+1]+65536*this.buffer[e+2]+16777216*this.buffer[e+3]}static unPackFloat(){return this.unPackInt16()/256}static unPackStringHelper(e){if(this.isMoreDataAvailable()<e)return 0;for(var t=new String,i=0;i<e;i++){var n=this.unPackInt16U();n>0&&(t+=String.fromCodePoint(n))}return t}static unPackInt24U(){var e=this.idx;return this.idx+=3,this.buffer[e]+256*this.buffer[e+1]+65536*this.buffer[e+2]}static unPackInt8U(){var e=this.idx;return this.idx++,this.buffer[e]}static unPackDouble(){return this.unPackInt32()/1048576}static unPackLongString(e){e=e||16383;var t=Math.min(this.unPackInt16U(),e);return this.unPackStringHelper(t)}static unPackString(e){e=e||255;var t=Math.min(this.unPackInt8U(),e);return this.unPackStringHelper(t)}static unPackInt16U(){var e=this.idx;return this.idx+=2,this.buffer[e]+256*this.buffer[e+1]}static init(e){this.buffer=new Uint8Array(e),this.idx=0}static unPackInt32(){return(this.unPackInt32U()+2147483648)%4294967296-2147483648}},Mc=class e{static update(){for(var t of(e.position&&e.setPosition(e.position),e.orientation&&e.setOrientation(e.orientation),e.children))t.update()}static async load(t,i){e.audioCtx||e.init();var n=t.match(/[^/\\&\?]+\..{1,4}(?=([\?\#&].*$|$))/)[0],a=n.match(/[^\.]*$/).join(""),s=n.replace("."+a,"");"json"==a?await e.loadSprite(t):await e.loadSound(t,i||s)}static detach(){e.position={x:e.position.x,y:e.position.y,z:e.position.z},e.orientation={x:e.orientation.x,y:e.orientation.y,z:e.orientation.z}}static addChild(t){e.children.push(t)}static async loadSprite(t){var i=await fetch(t),n=await i.json(),a=await e.loadSpriteBuffer(t,n);Object.keys(n.spritemap).forEach((t=>{var i=n.spritemap[t];e.sounds[t]={buffer:a,start:i.start,end:i.end}}))}static play(t,i,n){var a=e.audioCtx;i=i||e.inputNode,"suspended"===a.state&&e.resume();var s=e.sounds[t];if(!s){let i;if(n&&(i=` or ${n}`,s=e.sounds[n]),!s)return console.error(`BAWK! ${t} ${i} not found. Did you wait for it to load?`),!1}if(s.end)var r=s.start,o=s.end-r;var l=a.createBufferSource();return l.buffer=s.buffer,l.connect(i),o?l.start(0,r,o):l.start(),l}static dispose(){this.audioCtx.close()}static resume(){e.audioCtx&&e.audioCtx.resume()}static setFormats(e){this.formats=e}static init(){console.log("BAWK! initializing...");var e=new AudioContext;this.audioCtx=e,this.children=[],this.sounds={},this.position={x:0,y:0,z:0},this.orientation={x:0,y:0,z:-1},this.detectFormats(),this.gainNode=e.createGain(),this.compNode=e.createDynamicsCompressor(),this.compNode.connect(this.gainNode),this.gainNode.connect(e.destination),this.inputNode=this.compNode,null!=this.volume&&(this.gainNode.gain.value=this.volume)}static async loadSpriteBuffer(t,i){for(var n of i.resources)if(n.endsWith(e.format))break;var a=t.match(/.+\//)+n;return console.log("BAWK! loading "+a),await e.getAudioBuffer(a+"?"+Ac)}static getVolume(){return e.volume}static request(e){return new Promise(((t,i)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer";let a=Loader.addTask();n.onprogress=e=>{a=Loader.progress(a,e.loaded,e.total)},n.onload=()=>{200!=n.status?(console.log("ERROR"),i()):t(n.response),Loader.finish(a)},n.send()}))}static attach(t,i){e.position=t,e.orientation=i}static setVolume(t){e.volume=t,e.gainNode&&(e.gainNode.gain.value=t)}static async getAudioBuffer(t){var i=await e.request(t);return await new Promise(((t,n)=>{e.audioCtx.decodeAudioData(i,t,n)}))}static setPosition(t){var i=e.audioCtx.listener;i.positionX?(i.positionX.value=t.x,i.positionY.value=t.y,i.positionZ.value=t.z):i.setPosition(t.x,t.y,t.z)}static async loadSound(t,i){t=t.replace("*",e.format);var n=await e.getAudioBuffer(t);n&&(e.sounds[i]&&console.warn('BAWK! duplicate sound name, "'+i+'" will be over-written'),e.sounds[i]={buffer:n})}static suspend(){e.audioCtx&&e.audioCtx.suspend()}static removeChild(t){e.children.splice(e.children.indexOf(t),1)}static setOrientation(t){var i=e.audioCtx.listener;i.forwardX?(i.forwardX.value=t.x,i.forwardY.value=t.y,i.forwardZ.value=t.z):i.setOrientation(t.x,t.y,t.z,0,1,0)}static detectFormats(){var t=e.formats||{webm:"audio/webm",ogg:"audio/ogg",mp3:"audio/mpeg"};/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&delete t.webm;var i=document.createElement("audio"),n=Object.keys(t);for(var a of n){var s=i.canPlayType(t[a]);if(console.log("BAWK! testing "+a,s),s){e.format=a,console.log("BAWK! selected "+a);break}}}},Ic=class e{setVolume(e){this.gainNode.gain.value=e}getVolume(){return this.gainNode.gain.value}update(){for(var t of this.channels)t.source&&t.follow&&e.setNodePosition(t.node,t.position)}findFreeChannel(e){var t=this.channels,i=this.numChannels,n=Mc.position;if(this.numPlaying<i)for(var a of t)if(!a.source)return a;var s,r=-1;for(var a of t){var o=Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)+Math.pow(e.z-n.z,2);o>r&&(r=o,s=a)}return s}static onEnded(e){e.target.channel.parent.numPlaying--,e.target.channel.source=null,e.target.channel=null}dispose(){this.gainNode.disconnect(),Mc.removeChild(this)}play(t,i,n){if(Mc.sounds[t]){var a=this.findFreeChannel(i);a.source&&a.source.stop();var s=a.node;a.position=i,a.follow=n,e.setNodePosition(s,i),a.source=Mc.play(t,s),a.source.channel=a,a.source.onended=e.onEnded,this.numPlaying++}else console.error("BAWK! "+t+" not found. Did you wait for it to load?")}static setNodePosition(e,t){var i=Mc.position.y+4*(t.y-Mc.position.y);e.positionX?(e.positionX.value=t.x,e.positionY.value=i,e.positionZ.value=t.z):e.setPosition(t.x,i,t.z)}constructor(e,t){Mc.addChild(this),e=e||{},this.numChannels=e.numChannels||16,this.numPlaying=0,this.channels=[],this.nextChannelIdx=0,this.gainNode=Mc.audioCtx.createGain(),this.gainNode.connect(Mc.inputNode);for(var i=0;i<this.numChannels;i++){var n=Mc.audioCtx.createPanner(t);n.connect(this.gainNode),this.channels.push({parent:this,source:null,position:{x:0,y:0,z:0},follow:!1,node:n})}}};window.BAWK=Mc;var xc={productBlockAds:!1,vipSubEnded:!1,passEnded:!1},bc=class{updateStats(e,t){return{total:void 0!==e.total?e.total:this[t].deaths,mode:{public:void 0!==e.mode.public?e.mode.public:this[t].mode.public,private:void 0!==e.mode.private?e.mode.private:this[t].mode.private},dmgType:{pistol:void 0!==e.dmgType.pistol?e.dmgType.pistol:this[t].dmgType.pistol,grenade:void 0!==e.dmgType.grenade?e.dmgType.grenade:this[t].dmgType.grenade,rpegg:void 0!==e.dmgType.rpegg?e.dmgType.rpegg:this[t].dmgType.rpegg,eggk:void 0!==e.dmgType.eggk?e.dmgType.eggk:this[t].dmgType.eggk,scrambler:void 0!==e.dmgType.scrambler?e.dmgType.scrambler:this[t].dmgType.scrambler,ranger:void 0!==e.dmgType.ranger?e.dmgType.ranger:this[t].dmgType.ranger,whipper:void 0!==e.dmgType.whipper?e.dmgType.whipper:this[t].dmgType.whipper,crackshot:void 0!==e.dmgType.crackshot?e.dmgType.crackshot:this[t].dmgType.crackshot,trihard:void 0!==e.dmgType.trihard?e.dmgType.trihard:this[t].dmgType.trihard,melee:void 0!==e.dmgType.melee?e.dmgType.melee:this[t].dmgType.melee,fall:void 0!==e.dmgType.fall?e.dmgType.fall:this[t].dmgType.fall},gameType:{kotc:void 0!==e.gameType.kotc?e.gameType.kotc:this[t].gameType.kotc,spatula:void 0!==e.gameType.spatula?e.gameType.spatula:this[t].gameType.spatula,team:void 0!==e.gameType.team?e.gameType.team:this[t].gameType.team,ffa:void 0!==e.gameType.ffa?e.gameType.ffa:this[t].gameType.ffa}}}get(){return{kills:this.kills,deaths:this.deaths,gameType:this.gameType,streak:this.streak,dateReset:this.dateReset}}constructor(){this.statStateTemp={total:0,mode:{public:0,private:0},dmgType:{pistol:0,grenade:0,rpegg:0,eggk:0,scrambler:0,ranger:0,whipper:0,crackshot:0,trihard:0,melee:0,fall:0},gameType:{kotc:0,spatula:0,team:0,ffa:0},kdr:{private:0,public:0,ffa:0,teams:0,kotc:0,spatula:0}},this.kills=Object.create(this.statStateTemp),this.deaths=Object.create(this.statStateTemp),this.gameType={kotc:{captured:0,wins:0}},this.streak=0,this.dateReset=null}set(e){if(!e||void 0!==e.error)return vueApp.showGenericPopup("uh_oh","auth_stat_error_msg","ok");void 0!==e.kills&&(this.kills=this.updateStats(e.kills,"kills")),void 0!==e.deaths&&(this.deaths=this.updateStats(e.deaths,"deaths")),void 0!==e.gameType&&(this.gameType={kotc:{captured:void 0!==e.gameType.kotc.captured?e.gameType.kotc.captured:this.gameType.kotc.captured,wins:void 0!==e.gameType.kotc.wins?e.gameType.kotc.wins:this.gameType.kotc.wins}}),e.streak&&(this.streak=void 0!==e.streak?e.streak:this.streak)}},Pc=new Blob(["\nvar sessionId;\nvar servicesServer;\nvar timeout;\n\nonmessage = function (e) {\n\tservicesServer = e.data.servicesServer;\n\tsessionId = e.data.sessionId;\n\tconsole.log(getTime(), 'Session: worker received session ID:', sessionId);\n\tclearTimeout(timeout);\n\n\tif (sessionId !== null) {\n\t\ttimeout = setTimeout(() => renewSession(), 600000);\n\t}\n}\n\nfunction getTime () {\n\tlet d = new Date();\n\treturn d.toTimeString();\n}\n\nfunction renewSession () {\n\tcallRenew(res => {\n\t\tconsole.log(getTime(), 'Session: renew result:', res.data);\n\n\t\tif (res.data === 'renewed') {\n\t\t\tconsole.log(getTime(), 'Session: session renewed');\n\t\t\ttimeout = setTimeout(() => renewSession(), 600000);\n\t\t}\n\t\telse {\n\t\t\tconsole.log(getTime(), 'Session: session expired');\n\t\t\tpostMessage('expired');\n\t\t}\n\t},\n\t\t() => {\n\t\t\tconsole.log(getTime(), 'Session: failed to renew - Trying again in 30 seconds');\n\t\t\ttimeout = setTimeout(() => renewSession(), 30000);\n\t\t}\n\t);\n}\n\nfunction callRenew (successCallback, errorCallback) {\n\tconsole.log(getTime(), 'Session: callRenew');\n\n\ttry {\n        var servicesWs = new WebSocket(servicesServer);\n\t} catch (e) {\n\t\terrorCallback();\n\t}\n\n\tservicesWs.onopen = function (e) {\n\t\tservicesWs.send(JSON.stringify({\n\t\t\tcmd: 'renewSession',\n\t\t\tsessionId: sessionId\n\t\t}));\n\t};\n\n\tservicesWs.onmessage = function (e) {\n\t\tvar response = null;\n\t\ttry {\n\t\t\tresponse = JSON.parse(e.data);\n\t\t\tsuccessCallback(response);\n\t\t} catch (e) {\n\t\t\terrorCallback();\n\t\t}\n\n\t\tservicesWs.close();\n\t};\n\n\tservicesWs.onerror = function (e) {\n\t\terrorCallback();\n\t};\n}\n"]),wc=window.URL.createObjectURL(Pc),Oc=new Worker(wc);Oc.onmessage=e=>{"expired"===e.data&&vueApp.showGenericPopup("session_expired","session_expired_msg","ok")};var Dc=class{getPrimaryWeapon(){return this.getPickedWeaponInSlot(mc.Primary)}addToInventory(e,t){this.isItemOwned(e)||this.inventory.push(e),!0===t&&this.tryEquipItem(e)}challengesAutoClaimed(e){const t=e.filter((e=>"claimed"===e.status));if(t.length>0){for(const e of t){const t=extern.playerChallenges.challengeGet(e.id);t&&t.loc_ref?ga("send","event","dailyChallenge","auto_claim",t.loc_ref):console.error("Challenge or loc_ref not found for id:",e.id)}return t}return!1}applyRandomLoadout(){let e=xc.catalog.hats.filter((e=>0===e.price&&"default"===e.unlock)),t=e[Math.randomInt(0,e.length)].id;this.hatItem=xc.catalog.findItemById(t),this.colorIdx=Math.randomInt(0,7);let i=this.generateLoadoutObject();i.hatId=t,i.stampId=null,i.stampPositionX=0,i.stampPositionY=0,i.color=this.colorIdx,this.applyLocalLoadout(i),setTimeout((()=>this.applyLoadoutObject(i)),0)}pickWeapon(e,t){t.item_type_id===ItemType.Primary&&this.setClass(t.exclusive_for_class),!1===xc.catalog.findItemInListById(t,xc.catalog.forClass[this.classIdx].forWeaponSlot[e])&&(t=xc.catalog.forClass[this.classIdx].forWeaponSlot[e][0]),this.pickedWeapons[this.classIdx][e]=t}factionChangedRemovePrevious(e){const t=this.getOtherFactionItemId(e);if(!t)return;this.removeFromInventory(xc.catalog.findItemById(t));const i=this.generateLoadoutObject();i.hatId===t&&(i.hatId=1,setTimeout((()=>{this.applyLoadoutObject(i),i.hatId=null,this.applyLocalLoadout(i),this.syncToServer()}),0))}getEquippedItems(){return{[ItemType.Primary]:this.pickedWeapons[this.classIdx][mc.Primary],[ItemType.Secondary]:this.pickedWeapons[this.classIdx][mc.Secondary],[ItemType.Hat]:this.hatItem,[ItemType.Stamp]:this.stampItem,[ItemType.Grenade]:this.grenadeItem,[ItemType.Melee]:this.meleeItem}}setEggBalances(e){this.currentBalance=e,this.eggsEarnedBalance=this.eggsSpent+this.currentBalance}getPickedWeaponInSlot(e){return this.pickedWeapons[this.classIdx][e]}convertLoadout(e){e||(e=this.generateLoadoutObject());return{primaryId:[e.soldier_primary_item_id,e.scrambler_primary_item_id,e.ranger_primary_item_id,e.eggsploder_primary_item_id,e.whipper_primary_item_id,e.crackshot_primary_item_id,e.trihard_primary_item_id],secondaryId:[e.soldier_secondary_item_id,e.scrambler_secondary_item_id,e.ranger_secondary_item_id,e.eggsploder_secondary_item_id,e.whipper_secondary_item_id,e.crackshot_secondary_item_id,e.trihard_secondary_item_id],hatId:e.hat_id,stampId:e.stamp_id,stampPositionX:e.stamp_position_x,stampPositionY:e.stamp_position_y,grenadeId:e.grenade_id,meleeId:e.melee_id,classIdx:e.class_idx,colorIdx:e.color}}isUpgraded(){return hasValue(this.upgradeProductId)&&!this.upgradeIsExpired}constructor(){this.pickedWeapons=[];for(var e=0;e<_c.length;e++){var t=[xc.catalog.forClass[e].primaryWeapons[0],xc.catalog.forClass[e].secondaryWeapons[0]];this.pickedWeapons.push(t)}this.firebaseId=null,this.session=null,this.maskedEmail=null,this.classIdx=0,this.inventory=[],this.hatItem=null,this.stampItem=null,this.stampPositionX=0,this.stampPositionY=0,this.grenadeItem=xc.catalog.grenades[0],this.meleeItem=xc.catalog.melee[0],this.colorIdx=0,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.upgradeProductId=null,this.killMultiplier=1,this.hideAds=!1,this.maybeSchoolEmail=!1,this.upgradeExpiryDate=null,this.upgradeIsExpired=null,this.upgradeName="",this.isSubscriber=!1,this.twitchLinked=!1,this.twitchName="",this.contentCreator=!1,this.dateCreated=null,this.accountAge=null,this.notification=null,this.statsCurrent=new bc,this.statsLifetime=new bc,this.eggsSpent=0,this.eggsSpentMonthly=0,this.eggsEarnedBalance=0,this.challenges=[],this.challengesDailyEnd=0,this.faction=null,this.factionActivated=!1,this._firebaseId,Object.defineProperty(this,"firebaseId",{get:function(){return this._firebaseId},set:function(e){this._firebaseId=e,vueApp.firebaseId=this._firebaseId}}),this._id,Object.defineProperty(this,"id",{get:function(){return this._id},set:function(e){this._id=e,vueApp.id=this._id}}),this._isAnonymous,Object.defineProperty(this,"isAnonymous",{get:function(){return this._isAnonymous},set:function(e){this._isAnonymous=e,vueApp.isAnonymous=this._isAnonymous,vueApp.googleAnalytics.isUser=this._isAnonymous?"Unclaimed":"Claimed",ga("set","dimension1",vueData.googleAnalytics.isUser)}}),this._currentBalance,Object.defineProperty(this,"currentBalance",{get:function(){return this._currentBalance},set:function(e){this._currentBalance=e,vueApp.eggs=this._currentBalance}}),this._kills,Object.defineProperty(this,"kills",{get:function(){return this._kills},set:function(e){this._kills=e,vueApp.kills=this._kills}}),this._deaths,Object.defineProperty(this,"deaths",{get:function(){return this._deaths},set:function(e){this._deaths=e,vueApp.deaths=this._deaths}}),this._kdr,Object.defineProperty(this,"kdr",{get:function(){return this._kdr},set:function(e){this._kdr=e,vueApp.kdr=this._kdr}}),this._kdrLifetime,Object.defineProperty(this,"kdrLifetime",{get:function(){return this._kdrLifetime},set:function(e){this._kdrLifetime=e,vueApp.kdrLifetime=this._kdrLifetime}}),this._streak,Object.defineProperty(this,"streak",{get:function(){return this._streak},set:function(e){this._streak=e,vueApp.streak=this._streak}}),this._statsCurrent=new bc,Object.defineProperty(this,"statsCurrent",{get:function(){return this._statsCurrent},set:function(e){this._statsCurrent.set(e),this.kills=this._statsCurrent.kills.total,this.deaths=this._statsCurrent.deaths.total,this.streak=this._statsCurrent.streak,this.kdr=Math.floor(this._statsCurrent.kills.total/Math.max(this._statsCurrent.deaths.total,1)*100)/100,vueApp.statsCurrent=this._statsCurrent}}),this._statsLifetime=new bc,Object.defineProperty(this,"statsLifetime",{get:function(){return this._statsLifetime},set:function(e){this._statsLifetime.set(e),this.kdrLifetime=Math.floor(this._statsLifetime.kills.total/Math.max(this._statsLifetime.deaths.total,1)*100)/100,vueApp.statsLifetime=this._statsLifetime}}),this._eggsSpent,Object.defineProperty(this,"eggsSpent",{get:function(){return this._eggsSpent},set:function(e){this._eggsSpent=null===e?0:e,vueApp.eggsSpent=this._eggsSpent}}),this._eggsSpentMonthly,Object.defineProperty(this,"eggsSpentMonthly",{get:function(){return this._eggsSpentMonthly},set:function(e){this._eggsSpentMonthly=e,vueApp.eggsSpentMonthly=this._eggsSpentMonthly}}),this._eggsEarnedBalance,Object.defineProperty(this,"eggsEarnedBalance",{get:function(){return this._eggsEarnedBalance},set:function(e){void 0!==e&&(this._eggsEarnedBalance=null===e?0:e,vueApp.eggsEarnedBalance=this._eggsEarnedBalance)}}),this._playerName,Object.defineProperty(this,"playerName",{get:function(){return this._playerName},set:function(e){this._playerName=e,vueApp.playerName=this._playerName}}),this._maskedEmail,Object.defineProperty(this,"maskedEmail",{get:function(){return this._maskedEmail},set:function(e){this._maskedEmail=e,vueApp.maskedEmail=this._maskedEmail}}),this._isEmailVerified,Object.defineProperty(this,"isEmailVerified",{get:function(){return this._isEmailVerified},set:function(e){this._isEmailVerified=e,vueApp.isEmailVerified=this._isEmailVerified}}),this._isSubscriber,Object.defineProperty(this,"isSubscriber",{get:function(){return this._isSubscriber},set:function(e){this._isSubscriber=e,vueApp.isSubscriber=e}}),this._upgradeName,Object.defineProperty(this,"upgradeName",{get:function(){return this._upgradeName},set:function(e){this._upgradeName=e,vueApp.upgradeName=e}}),this._hideAds,Object.defineProperty(this,"hideAds",{get:function(){return this._hideAds},set:function(e){vueApp.hideAds=!!e}}),this._twitchLinked,Object.defineProperty(this,"twitchLinked",{get(){return this._twitchLinked},set(e){this._twitchLinked=e,vueApp.twitchLinked=e}}),this._twitchName,Object.defineProperty(this,"twitchName",{get(){return this._twitchName},set(e){this._twitchName=e,vueApp.twitchName=e}}),this._challenges=[],Object.defineProperty(this,"challenges",{get(){return this._challenges},set(e){if(e.length){if(this._challenges.length>0){const[t,i]=this.getDifferenceIndexes(this._challenges,e,"challengeId");if(void 0!==t&&void 0!==i){const n=e.splice(i,1)[0];e.splice(t,0,n)}}this._challenges=e.slice(),vueApp.player.challenges=e.slice(),this.challengesSet()}}}),this._challengesClaimed=[],this.challengesClaimedUnique=[],Object.defineProperty(this,"challengesClaimed",{get:()=>this._challengesClaimed,set:e=>{this._challengesClaimed=e,this.challengesClaimedUnique=[...new Set(e)],vueApp.challengesClaimed.total=this._challengesClaimed.length,vueApp.challengesClaimed.unique=this.challengesClaimedUnique.length}}),this.isItemOwned,Object.defineProperty(this,"isItemOwned",{value:function(e){if(!e)return!1;for(var t=0;t<this.inventory.length;t++)if(this.inventory[t]&&this.inventory[t].id===e.id)return!0;return!1}}),this._contentCreator,Object.defineProperty(this,"contentCreator",{get(){return this._contentCreator},set(e){e&&(this._contentCreator=!0,vueApp.contentCreator=this._contentCreator)}}),this._dateCreated,Object.defineProperty(this,"dateCreated",{get(){return this._dateCreated},set(e){if(e){const t=new Date(e).toLocaleDateString();this._dateCreated=t,vueApp.accountCreated=t}else vueApp.accountCreated=null}})}applyLoadoutObject(e){if(hasValue(e)){void 0!==e.classIdx&&null!==e.classIdx&&this.setClass(e.classIdx);for(var t=this,i=function(e,i,n){var a=xc.catalog.forClass[i].forWeaponSlot[n][0];if(hasValue(e)){let t=xc.catalog.findItemById(e);t&&(a=t)}t.pickedWeapons[i][n]=a},n=0;n<_c.length;n++)i(e.primaryId[n],n,mc.Primary),i(e.secondaryId[n],n,mc.Secondary);if(hasValue(e.hatId)){var a=xc.catalog.findItemById(e.hatId);this.isItemOwned(a)||(this.hatItem=null),this.hatItem=a}if(hasValue(e.stampId)){var s=xc.catalog.findItemById(e.stampId);this.isItemOwned(s)||(this.stampItem=null),this.stampItem=s}if(hasValue(e.grenadeId)){var r=xc.catalog.findItemById(e.grenadeId);this.isItemOwned(r)||(r=xc.catalog.findItemById(16e3)),this.grenadeItem=r}if(hasValue(e.meleeId)){var o=xc.catalog.findItemById(e.meleeId);this.isItemOwned(o)||(o=xc.catalog.findItemById(15e3)),this.meleeItem=o}hasValue(e.colorIdx)&&(this.colorIdx=e.colorIdx,this.colorIdx>=7&&!1===this.isUpgraded()&&(this.colorIdx=0)),hasValue(e.stampPositionX)&&(this.stampPositionX=e.stampPositionX),hasValue(e.stampPositionY)&&(this.stampPositionY=e.stampPositionY)}xc.resetPaperDoll()}challengesSet(){if(this.challenges.length>0){let e=this.challenges.reduce(((e,t)=>e&&e.period>t.period?e:t));null!==e&&(this.challengesDailyEnd=Math.trunc(Date.now()/1e3)+e.period)}else console.log("Player challenges empty. Most likely reason: No challenges available for this player")}syncToServer(e){var t=this.generateLoadoutObject();xc.api_saveLoadout(t,e),null!==t&&this.applyLocalLoadout(t)}calculateKdr(){this.kdr=Math.floor(this.statsCurrent.kills/Math.max(this.statsCurrent.deaths,1)*100)/100,this.kdrLifetime=Math.floor(this.statslifetime.kills/Math.max(this.statslifetime.deaths,1)*100)/100}getDifferenceIndexes(e,t,i){const n=Math.max(e.length,t.length),a=[];for(let s=0;s<n;s++){const n=e[s],r=t[s];n&&r?i?n[i]!==r[i]&&a.push(s):JSON.stringify(n)!==JSON.stringify(r)&&a.push(s):a.push(s)}return a}setStats(e,t){this.statsLifetime=e,this.statsCurrent=t}loggingOut(){this.loggedOut(),this.applyLoadoutObject(),this.getPrimaryWeapon(),this.getSecondaryWeapon(),this.setClass(this.classIdx),vueApp.signOut()}applyLocalLoadout(e){if(!hasValue(e))return;let t=e;e.hasOwnProperty("primaryId")||(t=this.convertLoadout(e));let i={items:t,kills:this.kills?this.kills:0,deaths:this.deaths?this.deaths:0,kdr:this.kdr?this.kdr:0,streak:this.streak?this.streak:0,balance:this._currentBalance};localStore.setItem("localLoadOut",JSON.stringify(i))}signedIn(e,t){if(e.uid===t.firebaseId){if(this.isAnonymous=e.isAnonymous,this.isEmailVerified=!this.isAnonymous&&t.emailVerified,this.id=t.id,this.firebaseId=t.firebaseId,this.sessionId=t.sessionId,this.session=t.session,this.maskedEmail=t.maskedEmail,this.kills=t.kills,this.deaths=t.deaths,this.streak=t.streak,this.currentBalance=t.currentBalance,this.maybeSchoolEmail=t.maybeSchoolEmail,this.subscriptionEnded=t.subscriptionEnded,this.passEnded=t.passEnded,this.twitchLinked=t.twitchLinked,this.twitchName=t.twitchName,this.contentCreator=t.social&&t.social.length&&t.social[0]?t.social:"",this.checkNotification(t.notification),this.setStats(t.statsLifetime,t.statsCurrent),this.dateCreated=t.dateCreated,this.accountAge=t.accountAge,this.eggsSpent=t.eggsSpent,this.eggsSpentMonthly=t.eggsSpentMonthly,this.eggsEarnedBalance=this.setEggBalances(this.currentBalance),this.challengesHasAutoClaim=this.challengesAutoClaimed(t.unclaimedRewards),this.challengesClaimed=t.claimedChallenges,this.setUpgrade(t),this.challenges=t.challenges,xc.adminRoles=t.adminRoles,hasValue(t.ownedItemIds))for(var i=0;i<t.ownedItemIds.length;i++){var n=xc.catalog.findItemById(t.ownedItemIds[i]);this.inventory.push(n)}this.activateFaction(t.eggOrgNeedsFaction),this.setFaction(t.eggOrgSwitchTimer),xc.productBlockAds=xc.playerAccount.isUpgraded(),this.subscriptionEnded&&(xc.vipSubEnded=!0),t.passEnded&&(xc.passEnded=!0),t.firstSignin&&(xc.showSigninBonus=!0),this.applyLoadoutObject(t.loadout),this.applyLocalLoadout(t.loadout),Oc.postMessage({servicesServer:xc.servicesServer,sessionId:this.sessionId})}else console.log("Firebase user ID does not match account returned from API")}loggedOut(){this.firebaseId=null,this.id=null,this.session=null,this.sessionId=null,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.classIdx=0,this.inventory=[],this.pickedWeapons=[],this.stampItem=null,this.stampPositionX=0,this.stampPositionY=0,this.grenadeItem=xc.catalog.findItemById(16e3),this.meleeItem=xc.catalog.findItemById(15e3),this.hatItem=null,this.colorIdx=0,this.killMultiplier=1,this.hideAds=!1,this.maybeSchoolEmail=!1,this.isAnonymous=!0,this.upgradeIsExpired=null,this.upgradeExpiryDate=null,this.upgradeName="",this.isSubscriber=!1,this.twitchLinked=!1,this.twitchName="",this.contentCreator=!1,this.dateCreated=null,this.eggsSpent=0,this.eggsSpentMonthly=0,this.eggsEarnedBalance=0,this.challenges=[],this.statsCurrent=new bc,this.statsLifetime=new bc,this.faction=null,this.factionActivated=!1;for(var e=0;e<_c.length;e++){var t=[xc.catalog.forClass[e].primaryWeapons[0],xc.catalog.forClass[e].secondaryWeapons[0]];this.pickedWeapons.push(t)}Oc.postMessage({sessionId:null}),xc.adminRoles=0}checkNotification(e){e&&!e.read&&(this.notification=e)}setFaction(e){for(const t in gc){const i=xc.catalog.findItemById(gc[t]);if(this.isItemOwned(i)){this.faction=parseInt(t),vueApp.faction.playerFaction=this.faction,vueApp.faction.switchTimer=e;break}}}activateFaction(e){if(!e)return;const t=Object.keys(Sc).find((t=>Sc[t]===e));if(void 0===t)return;const i=gc[t];this.addFactionItemToInventory(i),vueApp.faction.showPopup=!0,this.factionActivated=!0}getOtherFactionItemId(e){const t=Object.keys(gc).find((t=>gc[t]===e));if(void 0===t)return null;const i=Object.keys(gc).find((e=>e!==t));return void 0!==i?gc[i]:null}getSecondaryWeapon(){return this.getPickedWeaponInSlot(mc.Secondary)}setUpgrade(e){const{upgradeProductId:t,upgradeMultiplier:i=1,upgradeExpiryDate:n=null,upgradeIsExpired:a=null,upgradeAdFree:s=!1,upgradeType:r,upgradePlanId:o,upgradeName:l}=e;this.upgradeProductId=t,this.upgradePlanId=o,this.multiplier=i,this.upgradeExpiryDate=n,this.upgradeIsExpired=a,this.hideAds=s&&!a,this.isSubscriber=("subscription"===r||"pass"===r)&&!a,this.upgradeName=l;const c=this.isUpgraded(),h=c?this.upgradeExpiryDate:null;this.colorIdx>=7&&!c&&(this.colorIdx=0),vueApp.setAccountUpgraded(c,h)}generateLoadoutObject(){return{classIdx:this.classIdx,hatId:hasValue(this.hatItem)?this.hatItem.id:null,stampId:hasValue(this.stampItem)?this.stampItem.id:null,stampPositionX:this.stampPositionX,stampPositionY:this.stampPositionY,grenadeId:hasValue(this.grenadeItem)?this.grenadeItem.id:null,meleeId:hasValue(this.meleeItem)?this.meleeItem.id:null,colorIdx:this.colorIdx,primaryId:this.pickedWeapons.map((e=>e[mc.Primary].id)),secondaryId:this.pickedWeapons.map((e=>e[mc.Secondary].id))}}tryEquipItem(e){if(this.isItemOwned(e)){switch(e.item_type_id){case ItemType.Hat:this.hatItem=e;break;case ItemType.Stamp:this.stampItem=e;break;case ItemType.Primary:e.exclusive_for_class!==this.classIdx&&this.setClass(e.exclusive_for_class),this.pickWeapon(mc.Primary,e);break;case ItemType.Secondary:this.pickWeapon(mc.Secondary,e);break;case ItemType.Grenade:this.grenadeItem=e;break;case ItemType.Melee:this.meleeItem=e}this.syncToServer()}}setClass(e){(null==e||e>=xc.classes.length)&&(e=0),this.classIdx=e,vueApp&&(vueApp.classIdx=this.classIdx)}factionChanged(e){e&&(this.addFactionItemToInventory(e),this.factionChangedRemovePrevious(e),this.setFaction())}removeFromInventory(e){const t=this.inventory.findIndex((t=>t===e));-1!==t&&this.inventory.splice(t,1)}addFactionItemToInventory(e){const t=xc.catalog.findItemById(e);this.addToInventory(t,!1)}};function Lc(e,t,i,n){var a,s=arguments.length,r=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(r=(s<3?a(r):s>3?a(t,i,r):a(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r}var Fc={},kc={};function Bc(e){const t=e.getClassName();if(Fc[t])return Fc[t];Fc[t]={};const i=Fc[t];let n=e,a=t;for(;a;){const e=kc[a];for(const t in e)i[t]=e[t];let t,s=!1;do{if(t=Object.getPrototypeOf(n),!t.getClassName){s=!0;break}if(t.getClassName()!==a)break;n=t}while(t);if(s)break;a=t.getClassName(),n=t}return i}function Gc(e,t){return(i,n)=>{const a=function(e){const t=e.getClassName();return kc[t]||(kc[t]={}),kc[t]}(i);a[n]||(a[n]={type:e,sourceName:t})}}function Uc(e,t=null){return function(e,t=null){return(i,n)=>{const a=t||"_"+n;Object.defineProperty(i,n,{get:function(){return this[a]},set:function(t){"function"==typeof this.equals&&this.equals(t)||this[a]!==t&&(this[a]=t,i[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function Hc(e){return Gc(0,e)}function Vc(e){return Gc(1,e)}function Wc(e){return Gc(2,e)}function zc(e){return Gc(3,e)}function Xc(e){return Gc(4,e)}function Yc(e){return Gc(5,e)}function jc(e){return Gc(6,e)}function Kc(e){return Gc(8,e)}function $c(e){return Gc(12,e)}function qc(e,t,i,n){const a=i.value;i.value=(...i)=>{let s=a;if("undefined"!=typeof _native&&_native[t]){const e=_native[t];s=n?(...t)=>n(...t)?e(...t):a(...t):e}return e[t]=s,s(...i)}}qc.filter=function(e){return(t,i,n)=>qc(t,i,n,e)};var Jc={};function Qc(e,t=!1){if(!t||!Jc[e])return Jc[e]=!0,`${e} needs to be imported before as it contains a side-effect required by your code.`}var Zc=class e{static _HandleParenthesisContent(t,i){let n;i=i||(e=>"true"===e);const a=t.split("||");for(const t in a)if(Object.prototype.hasOwnProperty.call(a,t)){let s=e._SimplifyNegation(a[t].trim());const r=s.split("&&");if(r.length>1)for(let t=0;t<r.length;++t){const a=e._SimplifyNegation(r[t].trim());if(n="true"!==a&&"false"!==a?"!"===a[0]?!i(a.substring(1)):i(a):"true"===a,!n){s="false";break}}if(n||"true"===s){n=!0;break}n="true"!==s&&"false"!==s?"!"===s[0]?!i(s.substring(1)):i(s):"true"===s}return n?"true":"false"}static Eval(t,i){return"true"===(t=t.match(/\([^()]*\)/g)?t.replace(/\([^()]*\)/g,(t=>(t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,i)))):e._HandleParenthesisContent(t,i))||"false"!==t&&e.Eval(t,i)}static _SimplifyNegation(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(e=>(e=e.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?e="false":"!false"===e&&(e="true"),e}},eh=class e{static EnableFor(t){t._tags=t._tags||{},t.hasTags=()=>e.HasTags(t),t.addTags=i=>e.AddTagsTo(t,i),t.removeTags=i=>e.RemoveTagsFrom(t,i),t.matchesTagsQuery=i=>e.MatchesQuery(t,i)}static _RemoveTagFrom(e,t){delete e._tags[t]}static GetTags(e,t=!0){if(!e._tags)return null;if(t){const t=[];for(const i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&t.push(i);return t.join(" ")}return e._tags}static HasTags(e){if(!e._tags)return!1;const t=e._tags;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}static _AddTagTo(t,i){""!==(i=i.trim())&&"true"!==i&&"false"!==i&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[i]=!0))}static RemoveTagsFrom(t,i){if(!e.HasTags(t))return;const n=i.split(" ");for(const i in n)e._RemoveTagFrom(t,n[i])}static AddTagsTo(t,i){if(!i)return;if("string"!=typeof i)return;i.split(" ").forEach((function(i){e._AddTagTo(t,i)}))}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static MatchesQuery(t,i){return void 0===i||(""===i?e.HasTags(t):Zc.Eval(i,(i=>e.HasTags(t)&&t._tags[i])))}};function th(e,t){const i=[];for(let n=0;n<e;++n)i.push(t());return i}function ih(e,t){return th(e,t)}var nh=["push","splice","pop","shift","unshift"];function ah(e,t){const i=nh.map((i=>function(e,t,i){const n=e[t];if("function"!=typeof n)return null;const a=function(){const n=e.length,s=a.previous.apply(e,arguments);return i(t,n),s};return n.next=a,a.previous=n,e[t]=a,()=>{const i=a.previous;if(!i)return;const n=a.next;n?(i.next=n,n.previous=i):(i.next=void 0,e[t]=i),a.next=void 0,a.previous=void 0}}(e,i,t)));return()=>{i.forEach((e=>{e?.()}))}}var sh={};function rh(e,t){sh[e]=t}function oh(e){return sh[e]}var lh=2.2,ch=(1+Math.sqrt(5))/2,hh=.001;function fh(e,t,i=1401298e-51){return Math.abs(e-t)<=i}function uh(e,t){return e===t?e:Math.random()*(t-e)+e}function dh(e,t,i){return e+(t-e)*i}function mh(e,t=0,i=1){return Math.min(i,Math.max(t,e))}function ph(e){return e-=2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function _h(e){const t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}var vh=class e{static LerpAngle(t,i,n){let a=e.Repeat(i-t,360);return a>180&&(a-=360),t+a*mh(n)}static ILog2(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;let t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}static PercentToRange(e,t,i){return(i-t)*e+t}static Log2(e){return Math.log(e)*Math.LOG2E}static Normalize(e,t,i){return(e-t)/(i-t)}static Hermite1stDerivative(e,t,i,n,a){const s=a*a;return 6*(s-a)*e+(3*s-4*a+1)*t+6*(-s+a)*i+(3*s-2*a)*n}static HCF(t,i){const n=t%i;return 0===n?i:e.HCF(i,n)}static DeltaAngle(t,i){let n=e.Repeat(i-t,360);return n>180&&(n-=360),n}static Repeat(e,t){return e-Math.floor(e/t)*t}static PingPong(t,i){const n=e.Repeat(t,2*i);return i-Math.abs(n-i)}static Sign(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1}static InverseLerp(e,t,i){let n=0;return n=e!=t?mh((i-e)/(t-e)):0,n}static Hermite(e,t,i,n,a){const s=a*a,r=a*s;return e*(2*r-3*s+1)+i*(-2*r+3*s)+t*(r-2*s+a)+n*(r-s)}static MoveTowards(t,i,n){let a=0;return a=Math.abs(i-t)<=n?i:t+e.Sign(i-t)*n,a}static SmoothStep(t,i,n){let a=e.Clamp(n);return a=-2*a*a*a+3*a*a,i*a+t*(1-a)}static MoveTowardsAngle(t,i,n){const a=e.DeltaAngle(t,i);let s=0;return-n<a&&a<n?s=i:(i=t+a,s=e.MoveTowards(t,i,n)),s}static RangeToPercent(e,t,i){return(e-t)/(i-t)}static Denormalize(e,t,i){return e*(i-t)+t}};function gh(e){return Math.pow(e,lh)}function Sh(e){return e<=.04045?.0773993808*e:Math.pow(.947867299*(e+.055),2.4)}function yh(e){return Math.pow(e,.45454545454545453)}function Eh(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}vh.TwoPi=2*Math.PI,vh.WithinEpsilon=fh,vh.ToHex=_h,vh.Clamp=mh,vh.Lerp=dh,vh.RandomRange=uh,vh.NormalizeRadians=ph;var Ah=class e{clampToRef(e=0,t=1,i){return i.r=mh(this.r,e,t),i.g=mh(this.g,e,t),i.b=mh(this.b,e,t),i}static FromInts(t,i,n){return new e(t/255,i/255,n/255)}static FromArray(t,i=0){return new e(t[i],t[i+1],t[i+2])}clone(){return new e(this.r,this.g,this.b)}maximizeInPlaceFromFloats(e,t,i){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this}toHSV(){return this.toHSVToRef(new e)}static Red(){return new e(1,0,0)}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}toLinearSpaceToRef(e,t=!1){return t?(e.r=Sh(this.r),e.g=Sh(this.g),e.b=Sh(this.b)):(e.r=gh(this.r),e.g=gh(this.g),e.b=gh(this.b)),this}negate(){throw new ReferenceError("Can not negate a color")}static Gray(){return new e(.5,.5,.5)}static get BlackReadOnly(){return e._BlackReadOnly}divideInPlace(e){throw new ReferenceError("Can not divide a color")}static HSVtoRGBToRef(e,t,i,n){const a=i*t,s=e/60,r=a*(1-Math.abs(s%2-1));let o=0,l=0,c=0;s>=0&&s<=1?(o=a,l=r):s>=1&&s<=2?(o=r,l=a):s>=2&&s<=3?(l=a,c=r):s>=3&&s<=4?(l=r,c=a):s>=4&&s<=5?(o=r,c=a):s>=5&&s<=6&&(o=a,c=r);const h=i-a;return n.r=o+h,n.g=l+h,n.b=c+h,n}static Yellow(){return new e(1,1,0)}fractToRef(e){throw new ReferenceError("Can not fract a color")}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}toColor4(e=1){return new Ch(this.r,this.g,this.b,e)}set(e,t,i){return this.copyFromFloats(e,t,i)}fract(){throw new ReferenceError("Can not fract a color")}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}static FromHSV(t,i,n){const a=new e(0,0,0);return e.HSVtoRGBToRef(t,i,n,a),a}static Magenta(){return new e(1,0,1)}static Hermite1stDerivative(t,i,n,a,s){const r=e.Black();return this.Hermite1stDerivativeToRef(t,i,n,a,s,r),r}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}add(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)}equalsToFloats(e,t,i){return this.r===e&&this.g===t&&this.b===i}static Green(){return new e(0,1,0)}static FromHexString(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);const i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),a=parseInt(t.substring(5,7),16);return e.FromInts(i,n,a)}toHSVToRef(e){const t=this.r,i=this.g,n=this.b,a=Math.max(t,i,n),s=Math.min(t,i,n);let r=0,o=0;const l=a,c=a-s;return 0!==a&&(o=c/a),a!=s&&(a==t?(r=(i-n)/c,i<n&&(r+=6)):a==i?r=(n-t)/c+2:a==n&&(r=(t-i)/c+4),r*=60),e.r=r,e.g=o,e.b=l,e}copyFromFloats(e,t,i){return this.r=e,this.g=t,this.b=i,this}equalsFloats(e,t,i){return this.equalsToFloats(e,t,i)}static Hermite1stDerivativeToRef(e,t,i,n,a,s){const r=a*a;s.r=6*(r-a)*e.r+(3*r-4*a+1)*t.r+6*(-r+a)*i.r+(3*r-2*a)*n.r,s.g=6*(r-a)*e.g+(3*r-4*a+1)*t.g+6*(-r+a)*i.g+(3*r-2*a)*n.g,s.b=6*(r-a)*e.b+(3*r-4*a+1)*t.b+6*(-r+a)*i.b+(3*r-2*a)*n.b}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}static Random(){return new e(Math.random(),Math.random(),Math.random())}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}multiplyByFloats(t,i,n){return new e(this.r*t,this.g*i,this.b*n)}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2]}subtractFromFloatsToRef(e,t,i,n){return n.r=this.r-e,n.g=this.g-t,n.b=this.b-i,n}static Black(){return new e(0,0,0)}minimizeInPlaceFromFloats(e,t,i){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this}toGammaSpace(t=!1){const i=new e;return this.toGammaSpaceToRef(i,t),i}floorToRef(e){throw new ReferenceError("Can not floor a color")}static Lerp(t,i,n){const a=new e(0,0,0);return e.LerpToRef(t,i,n,a),a}scale(t){return new e(this.r*t,this.g*t,this.b*t)}toHexString(){const e=Math.round(255*this.r),t=Math.round(255*this.g),i=Math.round(255*this.b);return"#"+_h(e)+_h(t)+_h(i)}static Purple(){return new e(.5,0,.5)}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}negateInPlace(){throw new ReferenceError("Can not negate a color")}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}subtractFromFloats(t,i,n){return new e(this.r-t,this.g-i,this.b-n)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}divide(e){throw new ReferenceError("Can not divide a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}toLinearSpace(t=!1){const i=new e;return this.toLinearSpaceToRef(i,t),i}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}asArray(){return[this.r,this.g,this.b]}getHashCode(){let e=255*this.r|0;return e=397*e^(255*this.g|0),e=397*e^(255*this.b|0),e}floor(){throw new ReferenceError("Can not floor a color")}static Teal(){return new e(0,1,1)}constructor(e=0,t=0,i=0){this.r=e,this.g=t,this.b=i}equalsWithEpsilon(e,t=hh){return vh.WithinEpsilon(this.r,e.r,t)&&vh.WithinEpsilon(this.g,e.g,t)&&vh.WithinEpsilon(this.b,e.b,t)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}setAll(e){return this.r=this.g=this.b=e,this}static Blue(){return new e(0,0,1)}static LerpToRef(e,t,i,n){n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i}subtract(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)}fromArray(t,i=0){return e.FromArrayToRef(t,i,this),this}static White(){return new e(1,1,1)}static Hermite(t,i,n,a,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,f=o-r,u=t.r*l+n.r*c+i.r*h+a.r*f,d=t.g*l+n.g*c+i.g*h+a.g*f,m=t.b*l+n.b*c+i.b*h+a.b*f;return new e(u,d,m)}getClassName(){return"Color3"}multiply(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}toGammaSpaceToRef(e,t=!1){return t?(e.r=Eh(this.r),e.g=Eh(this.g),e.b=Eh(this.b)):(e.r=yh(this.r),e.g=yh(this.g),e.b=yh(this.b)),this}addInPlaceFromFloats(e,t,i){return this.r+=e,this.g+=t,this.b+=i,this}};Ah._BlackReadOnly=Ah.Black(),Object.defineProperties(Ah.prototype,{dimension:{value:[3]},rank:{value:1}});var Ch=class e{maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}set(e,t,i,n){return this.copyFromFloats(e,t,i,n)}static Hermite1stDerivative(t,i,n,a,s){const r=new e;return this.Hermite1stDerivativeToRef(t,i,n,a,s,r),r}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}toHexString(e=!1){const t=Math.round(255*this.r),i=Math.round(255*this.g),n=Math.round(255*this.b);if(e)return"#"+_h(t)+_h(i)+_h(n);const a=Math.round(255*this.a);return"#"+_h(t)+_h(i)+_h(n)+_h(a)}add(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}equalsWithEpsilon(e,t=hh){return vh.WithinEpsilon(this.r,e.r,t)&&vh.WithinEpsilon(this.g,e.g,t)&&vh.WithinEpsilon(this.b,e.b,t)&&vh.WithinEpsilon(this.a,e.a,t)}asArray(){return[this.r,this.g,this.b,this.a]}fract(){throw new ReferenceError("Can not fract a color")}addInPlaceFromFloats(e,t,i,n){return this.r+=e,this.g+=t,this.b+=i,this.a+=n,this}divide(e){throw new ReferenceError("Can not divide a color")}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}minimizeInPlaceFromFloats(e,t,i,n){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this.a=Math.min(n,this.a),this}getClassName(){return"Color4"}scale(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)}static CheckColors4(e,t){if(e.length===3*t){const t=[];for(let i=0;i<e.length;i+=3){const n=i/3*4;t[n]=e[i],t[n+1]=e[i+1],t[n+2]=e[i+2],t[n+3]=1}return t}return e}clone(){return(new e).copyFrom(this)}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}static FromHexString(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return new e(0,0,0,0);const i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),a=parseInt(t.substring(5,7),16),s=9===t.length?parseInt(t.substring(7,9),16):255;return e.FromInts(i,n,a,s)}equalsToFloats(e,t,i,n){return this.r===e&&this.g===t&&this.b===i&&this.a===n}floor(){throw new ReferenceError("Can not floor a color")}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}negateInPlace(){throw new ReferenceError("Can not negate a color")}setAll(e){return this.r=this.g=this.b=this.a=e,this}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}static LerpToRef(e,t,i,n){return n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i,n.a=e.a+(t.a-e.a)*i,n}constructor(e=0,t=0,i=0,n=1){this.r=e,this.g=t,this.b=i,this.a=n}toGammaSpaceToRef(e,t=!1){return t?(e.r=Eh(this.r),e.g=Eh(this.g),e.b=Eh(this.b)):(e.r=yh(this.r),e.g=yh(this.g),e.b=yh(this.b)),e.a=this.a,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}subtractFromFloats(t,i,n,a){return new e(this.r-t,this.g-i,this.b-n,this.a-a)}toLinearSpace(t=!1){const i=new e;return this.toLinearSpaceToRef(i,t),i}maximizeInPlaceFromFloats(e,t,i,n){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this.a=Math.max(n,this.a),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}static Hermite1stDerivativeToRef(e,t,i,n,a,s){const r=a*a;s.r=6*(r-a)*e.r+(3*r-4*a+1)*t.r+6*(-r+a)*i.r+(3*r-2*a)*n.r,s.g=6*(r-a)*e.g+(3*r-4*a+1)*t.g+6*(-r+a)*i.g+(3*r-2*a)*n.g,s.b=6*(r-a)*e.b+(3*r-4*a+1)*t.b+6*(-r+a)*i.b+(3*r-2*a)*n.b,s.a=6*(r-a)*e.a+(3*r-4*a+1)*t.a+6*(-r+a)*i.a+(3*r-2*a)*n.a}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}static FromColor3(t,i=1){return new e(t.r,t.g,t.b,i)}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}subtract(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiplyByFloats(t,i,n,a){return new e(this.r*t,this.g*i,this.b*n,this.a*a)}clampToRef(e=0,t=1,i){return i.r=mh(this.r,e,t),i.g=mh(this.g,e,t),i.b=mh(this.b,e,t),i.a=mh(this.a,e,t),i}static FromArray(t,i=0){return new e(t[i],t[i+1],t[i+2],t[i+3])}subtractFromFloatsToRef(e,t,i,n,a){return a.r=this.r-e,a.g=this.g-t,a.b=this.b-i,a.a=this.a-n,a}multiply(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}static Lerp(t,i,n){return e.LerpToRef(t,i,n,new e)}toGammaSpace(t=!1){const i=new e;return this.toGammaSpaceToRef(i,t),i}static FromInts(t,i,n,a){return new e(t/255,i/255,n/255,a/255)}negateToRef(e){throw new ReferenceError("Can not negate a color")}static Hermite(t,i,n,a,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,f=o-r,u=t.r*l+n.r*c+i.r*h+a.r*f,d=t.g*l+n.g*c+i.g*h+a.g*f,m=t.b*l+n.b*c+i.b*h+a.b*f,p=t.a*l+n.a*c+i.a*h+a.a*f;return new e(u,d,m,p)}divideInPlace(e){throw new ReferenceError("Can not divide a color")}copyFromFloats(e,t,i,n){return this.r=e,this.g=t,this.b=i,this.a=n,this}negate(){throw new ReferenceError("Can not negate a color")}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}toLinearSpaceToRef(e,t=!1){return t?(e.r=Sh(this.r),e.g=Sh(this.g),e.b=Sh(this.b)):(e.r=gh(this.r),e.g=gh(this.g),e.b=gh(this.b)),e.a=this.a,this}getHashCode(){let e=255*this.r|0;return e=397*e^(255*this.g|0),e=397*e^(255*this.b|0),e=397*e^(255*this.a|0),e}fractToRef(e){throw new ReferenceError("Can not fract a color")}};Object.defineProperties(Ch.prototype,{dimension:{value:[4]},rank:{value:1}});var Rh=class{};Rh.Color3=th(3,Ah.Black),Rh.Color4=th(3,(()=>new Ch(0,0,0,0))),rh("BABYLON.Color3",Ah),rh("BABYLON.Color4",Ch);var Th=class e{static SetMatrixPrecision(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(let t=0;t<e.MatrixTrackedMatrices.length;++t){const i=e.MatrixTrackedMatrices[t],n=i._m;i._m=new Array(16);for(let e=0;e<16;++e)i._m[e]=n[e]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null}};Th.MatrixUse64Bits=!1,Th.MatrixTrackPrecisionChange=!0,Th.MatrixCurrentType=Float32Array,Th.MatrixTrackedMatrices=[];var Nh=class{constructor(e,t=!1,i,n){this.initialize(e,t,i,n)}initialize(e,t=!1,i,n){return this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=n,this}},Mh=class{constructor(e,t,i=null){this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}},Ih=class e{_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((()=>{this._remove(e)}),0))}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}hasSpecificMask(e=-1){for(const t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}add(e,t=-1,i=!1,n=null,a=!1){if(!e)return null;const s=new Mh(e,t,n);return s.unregisterOnNextCall=a,i?this._observers.unshift(s):this._observers.push(s),this._onObserverAdded&&this._onObserverAdded(s),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(s,this._lastNotifiedValue),s._remove=()=>{this.remove(s)},s}notifyObservers(e,t=-1,i,n,a){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;const s=this._eventState;s.mask=t,s.target=i,s.currentTarget=n,s.skipNextObservers=!1,s.lastReturnValue=e,s.userInfo=a;for(const i of this._observers)if(!i._willBeUnregistered&&(i.mask&t&&(i.unregisterOnNextCall&&this._deferUnregister(i),i.scope?s.lastReturnValue=i.callback.apply(i.scope,[e,s]):s.lastReturnValue=i.callback(e,s)),s.skipNextObservers))return!1;return!0}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}remove(e){if(!e)return!1;e._remove=null;return-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}removeCallback(e,t){for(let i=0;i<this._observers.length;i++){const n=this._observers[i];if(!n._willBeUnregistered&&(n.callback===e&&(!t||t===n.scope)))return this._deferUnregister(n),!0}return!1}get observers(){return this._observers}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}notifyObserver(e,t,i=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;const n=this._eventState;n.mask=i,n.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,n)}clone(){const t=new e;return t._observers=this._observers.slice(0),t}clear(){for(;this._observers.length;){const e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}constructor(e,t=!1){this.notifyIfTriggered=t,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new Nh(0),e&&(this._onObserverAdded=e)}_remove(e,t=!0){if(!e)return!1;const i=this._observers.indexOf(e);return-1!==i&&(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}static FromPromise(t,i){const n=new e;return t.then((e=>{n.notifyObservers(e)})).catch((e=>{if(!i)throw e;i.notifyObservers(e)})),n}},xh=class{static get LastCreatedScene(){return this._LastCreatedScene}static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}};xh.Instances=[],xh.OnEnginesDisposedObservable=new Ih,xh._LastCreatedScene=null,xh.UseFallbackTexture=!0,xh.FallbackTexture="";var bh=e=>parseInt(e.toString().replace(/\W/g,"")),Ph=class e{addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t}scale(t){return new e(this.x*t,this.y*t)}addInPlace(e){return this.x+=e.x,this.y+=e.y,this}static LerpToRef(e,t,i,n){return n.x=e.x+(t.x-e.x)*i,n.y=e.y+(t.y-e.y)*i,n}multiply(t){return new e(this.x*t.x,this.y*t.y)}static Dot(e,t){return e.x*t.x+e.y*t.y}scaleInPlace(e){return this.x*=e,this.y*=e,this}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i}getHashCode(){let e=bh(this.x);return e=397*e^bh(this.y),e}rotateToRef(e,t){const i=Math.cos(e),n=Math.sin(e),a=i*this.x-n*this.y,s=n*this.x+i*this.y;return t.x=a,t.y=s,t}static Maximize(t,i){const n=t.x>i.x?t.x:i.x,a=t.y>i.y?t.y:i.y;return new e(n,a)}static FromFloatsToRef(e,t,i){return i.copyFromFloats(e,t),i}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e}normalize(){return this.normalizeFromLength(this.length())}static DistanceOfPointFromSegment(t,i,n){const a=e.DistanceSquared(i,n);if(0===a)return e.Distance(t,i);const s=n.subtract(i),r=Math.max(0,Math.min(1,e.Dot(t.subtract(i),s)/a)),o=i.add(s.multiplyByFloats(r,r));return e.Distance(t,o)}negateInPlace(){return this.x*=-1,this.y*=-1,this}getClassName(){return"Vector2"}equals(e){return e&&this.x===e.x&&this.y===e.y}static get ZeroReadOnly(){return e._ZeroReadOnly}clone(){return new e(this.x,this.y)}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this}static Center(t,i){return e.CenterToRef(t,i,new e)}fract(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fromArray(t,i=0){return e.FromArrayToRef(t,i,this),this}copyFrom(e){return this.x=e.x,this.y=e.y,this}subtractFromFloats(t,i){return new e(this.x-t,this.y-i)}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t}static TransformToRef(e,t,i){const n=t.m,a=e.x*n[0]+e.y*n[4]+n[12],s=e.x*n[1]+e.y*n[5]+n[13];return i.x=a,i.y=s,i}constructor(e=0,t=0){this.x=e,this.y=t}subtractFromFloatsToRef(e,t,i){return i.x=this.x-e,i.y=this.y-t,i}static PointInTriangle(e,t,i,n){const a=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),s=a<0?-1:1,r=(t.y*n.x-t.x*n.y+(n.y-t.y)*e.x+(t.x-n.x)*e.y)*s,o=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*s;return r>0&&o>0&&r+o<2*a*s}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.x,e.y)}addInPlaceFromFloats(e,t){return this.x+=e,this.y+=t,this}negate(){return new e(-this.x,-this.y)}divide(t){return new e(this.x/t.x,this.y/t.y)}multiplyByFloats(t,i){return new e(this.x*t,this.y*i)}toString(){return`{X: ${this.x} Y: ${this.y}}`}equalsToFloats(e,t){return this.x===e&&this.y===t}setAll(e){return this.copyFromFloats(e,e)}normalizeToNew(){const t=new e;return this.normalizeToRef(t),t}normalizeToRef(e){const t=this.length();return 0===t&&(e.x=this.x,e.y=this.y),this.scaleToRef(1/t,e)}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}minimizeInPlaceFromFloats(e,t){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this}addVector3(t){return new e(this.x+t.x,this.y+t.y)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t}negateToRef(e){return e.x=-this.x,e.y=-this.y,e}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)}static Clamp(t,i,n){const a=mh(t.x,i.x,n.x),s=mh(t.y,i.y,n.y);return new e(a,s)}static Hermite1stDerivative(t,i,n,a,s){return this.Hermite1stDerivativeToRef(t,i,n,a,s,new e)}static Hermite1stDerivativeToRef(e,t,i,n,a,s){const r=a*a;return s.x=6*(r-a)*e.x+(3*r-4*a+1)*t.x+6*(-r+a)*i.x+(3*r-2*a)*n.x,s.y=6*(r-a)*e.y+(3*r-4*a+1)*t.y+6*(-r+a)*i.y+(3*r-2*a)*n.y,s}set(e,t){return this.copyFromFloats(e,t)}lengthSquared(){return this.x*this.x+this.y*this.y}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.x,e.y)}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,this}floor(){return new e(Math.floor(this.x),Math.floor(this.y))}static One(){return new e(1,1)}subtract(t){return new e(this.x-t.x,this.y-t.y)}static CatmullRom(t,i,n,a,s){const r=s*s,o=s*r,l=.5*(2*i.x+(-t.x+n.x)*s+(2*t.x-5*i.x+4*n.x-a.x)*r+(-t.x+3*i.x-3*n.x+a.x)*o),c=.5*(2*i.y+(-t.y+n.y)*s+(2*t.y-5*i.y+4*n.y-a.y)*r+(-t.y+3*i.y-3*n.y+a.y)*o);return new e(l,c)}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(uh(e,t),uh(e,t))}static FromArray(t,i=0){return new e(t[i],t[i+1])}equalsWithEpsilon(e,t=hh){return e&&fh(this.x,e.x,t)&&fh(this.y,e.y,t)}copyFromFloats(e,t){return this.x=e,this.y=t,this}static Normalize(t){return e.NormalizeToRef(t,new e)}static Random(t=0,i=1){return new e(uh(t,i),uh(t,i))}static DistanceSquared(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t}static Minimize(t,i){const n=t.x<i.x?t.x:i.x,a=t.y<i.y?t.y:i.y;return new e(n,a)}static Lerp(t,i,n){return e.LerpToRef(t,i,n,new e)}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}asArray(){return[this.x,this.y]}static Zero(){return new e(0,0)}static Distance(t,i){return Math.sqrt(e.DistanceSquared(t,i))}static Hermite(t,i,n,a,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,f=o-r,u=t.x*l+n.x*c+i.x*h+a.x*f,d=t.y*l+n.y*c+i.y*h+a.y*f;return new e(u,d)}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}divideInPlace(e){return this.x=this.x/e.x,this.y=this.y/e.y,this}maximizeInPlaceFromFloats(e,t){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this}dot(e){return this.x*e.x+this.y*e.y}static Transform(t,i){return e.TransformToRef(t,i,new e)}static ClampToRef(e,t,i,n){return n.x=mh(e.x,t.x,i.x),n.y=mh(e.y,t.y,i.y),n}add(t){return new e(this.x+t.x,this.y+t.y)}};Ph._ZeroReadOnly=Ph.Zero(),Object.defineProperties(Ph.prototype,{dimension:{value:[2]},rank:{value:1}});var wh=class e{multiplyToRef(e,t){return t._x=this._x*e._x,t._y=this._y*e._y,t._z=this._z*e._z,t._isDirty=!0,t}static One(){return new e(1,1,1)}static Up(){return new e(0,1,0)}scale(t){return new e(this._x*t,this._y*t,this._z*t)}floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}static Maximize(t,i){const n=new e;return n.copyFrom(t),n.maximizeInPlace(i),n}equalsWithEpsilon(e,t=hh){return e&&fh(this._x,e._x,t)&&fh(this._y,e._y,t)&&fh(this._z,e._z,t)}static TransformCoordinates(t,i){const n=e.Zero();return e.TransformCoordinatesToRef(t,i,n),n}rotateByQuaternionToRef(t,i){return t.toRotationMatrix(Fh.Matrix[0]),e.TransformCoordinatesToRef(this,Fh.Matrix[0],i),i}static ClampToRef(e,t,i,n){let a=e._x;a=a>i._x?i._x:a,a=a<t._x?t._x:a;let s=e._y;s=s>i._y?i._y:s,s=s<t._y?t._y:s;let r=e._z;return r=r>i._z?i._z:r,r=r<t._z?t._z:r,n.copyFromFloats(a,s,r),n}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getNormalToRef(e){const t=this.length();let i=Math.acos(this.y/t);const n=Math.atan2(this.z,this.x);i>Math.PI/2?i-=Math.PI/2:i+=Math.PI/2;const a=t*Math.sin(i)*Math.cos(n),s=t*Math.cos(i),r=t*Math.sin(i)*Math.sin(n);return e.set(a,s,r),e}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this}multiply(e){return this.multiplyByFloats(e._x,e._y,e._z)}applyRotationQuaternion(t){return this.applyRotationQuaternionToRef(t,new e)}static CenterToRef(e,t,i){return i.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)}static get ZeroReadOnly(){return e._ZeroReadOnly}static GetAngleBetweenVectors(t,i,n){const a=t.normalizeToRef(Fh.Vector3[1]),s=i.normalizeToRef(Fh.Vector3[2]);let r=e.Dot(a,s);r=mh(r,-1,1);const o=Math.acos(r),l=Fh.Vector3[3];return e.CrossToRef(a,s,l),e.Dot(l,n)>0?isNaN(o)?0:o:isNaN(o)?-Math.PI:-Math.acos(r)}projectOnPlane(t,i){return this.projectOnPlaneToRef(t,i,new e)}static SmoothToRef(t,i,n,a,s){return e.SlerpToRef(t,i,0===a?1:n/a,s),s}get x(){return this._x}static Right(){return new e(1,0,0)}clone(){return new e(this._x,this._y,this._z)}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(uh(e,t),uh(e,t),uh(e,t))}set x(e){this._x=e,this._isDirty=!0}static FromArray(t,i=0){return new e(t[i],t[i+1],t[i+2])}get isNonUniform(){const e=Math.abs(this._x);if(e!==Math.abs(this._y))return!0;return e!==Math.abs(this._z)}projectOnPlaneToRef(t,i,n){const a=t.normal,s=t.d,r=Fh.Vector3[0];this.subtractToRef(i,r),r.normalize();const o=e.Dot(r,a);if(Math.abs(o)<1e-10)n.setAll(1/0);else{const t=-(e.Dot(i,a)+s)/o,l=r.scaleInPlace(t);i.addToRef(l,n)}return n}fractToRef(e){return e._x=this.x-Math.floor(this._x),e._y=this.y-Math.floor(this._y),e._z=this.z-Math.floor(this._z),e._isDirty=!0,e}static TransformCoordinatesFromFloatsToRef(e,t,i,n,a){const s=n.m,r=e*s[0]+t*s[4]+i*s[8]+s[12],o=e*s[1]+t*s[5]+i*s[9]+s[13],l=e*s[2]+t*s[6]+i*s[10]+s[14],c=1/(e*s[3]+t*s[7]+i*s[11]+s[15]);return a._x=r*c,a._y=o*c,a._z=l*c,a._isDirty=!0,a}static UnprojectFromTransform(e,t,i,n,a){return this.Unproject(e,t,i,n,a,Lh.IdentityReadOnly)}static get RightHandedForwardReadOnly(){return e._RightHandedForwardReadOnly}normalizeToNew(){return this.normalizeToRef(new e)}static PitchYawRollToMoveBetweenPointsToRef(e,t,i){const n=kh.Vector3[0];return t.subtractToRef(e,n),i._y=Math.atan2(n.x,n.z)||0,i._x=Math.atan2(Math.sqrt(n.x**2+n.z**2),n.y)||0,i._z=0,i._isDirty=!0,i}static Clamp(t,i,n){const a=new e;return e.ClampToRef(t,i,n,a),a}applyRotationQuaternionToRef(e,t){const i=this._x,n=this._y,a=this._z,s=e._x,r=e._y,o=e._z,l=e._w,c=2*(r*a-o*n),h=2*(o*i-s*a),f=2*(s*n-r*i);return t._x=i+l*c+r*f-o*h,t._y=n+l*h+o*c-s*f,t._z=a+l*f+s*h-r*c,t._isDirty=!0,t}get hasAZeroComponent(){return this._x*this._y*this._z==0}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}static Unproject(t,i,n,a,s,r){const o=new e;return e.UnprojectToRef(t,i,n,a,s,r,o),o}static UnprojectFloatsToRef(t,i,n,a,s,r,o,l,c){const h=Fh.Matrix[0];r.multiplyToRef(o,h),h.multiplyToRef(l,h),h.invert();const f=Fh.Vector3[0];return f.x=t/a*2-1,f.y=-(i/s*2-1),xh.LastCreatedEngine?.isNDCHalfZRange?f.z=n:f.z=2*n-1,e._UnprojectFromInvertedMatrixToRef(f,h,c),c}static Project(t,i,n,a){const s=new e;return e.ProjectToRef(t,i,n,a,s),s}isNonUniformWithinEpsilon(e){const t=Math.abs(this._x),i=Math.abs(this._y);if(!fh(t,i,e))return!0;const n=Math.abs(this._z);return!fh(t,n,e)||!fh(i,n,e)}static Center(t,i){return e.CenterToRef(t,i,e.Zero())}get y(){return this._y}static get RightReadOnly(){return e._RightReadOnly}negateToRef(e){return e._x=-1*this._x,e._y=-1*this._y,e._z=-1*this._z,e._isDirty=!0,e}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._isDirty=!0,this}static Reflect(t,i){return this.ReflectToRef(t,i,new e)}asArray(){return[this._x,this._y,this._z]}static PitchYawRollToMoveBetweenPoints(t,i){const n=e.Zero();return e.PitchYawRollToMoveBetweenPointsToRef(t,i,n)}getHashCode(){let e=bh(this._x);return e=397*e^bh(this._y),e=397*e^bh(this._z),e}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._isDirty=!0,this}static CrossToRef(e,t,i){const n=e._y*t._z-e._z*t._y,a=e._z*t._x-e._x*t._z,s=e._x*t._y-e._y*t._x;return i.copyFromFloats(n,a,s),i}static FromFloatsToRef(e,t,i,n){return n.copyFromFloats(e,t,i),n}static get RightHandedBackwardReadOnly(){return e._RightHandedBackwardReadOnly}divideToRef(e,t){return t._x=this._x/e._x,t._y=this._y/e._y,t._z=this._z/e._z,t._isDirty=!0,t}rotateByQuaternionAroundPointToRef(e,t,i){return this.subtractToRef(t,Fh.Vector3[0]),Fh.Vector3[0].rotateByQuaternionToRef(e,Fh.Vector3[0]),t.addToRef(Fh.Vector3[0],i),i}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}cross(t){return e.CrossToRef(this,t,new e)}static Minimize(t,i){const n=new e;return n.copyFrom(t),n.minimizeInPlace(i),n}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z}static Down(){return new e(0,-1,0)}static LerpToRef(e,t,i,n){return n._x=e._x+(t._x-e._x)*i,n._y=e._y+(t._y-e._y)*i,n._z=e._z+(t._z-e._z)*i,n._isDirty=!0,n}static get OneReadOnly(){return e._OneReadOnly}static Hermite(t,i,n,a,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,f=o-r,u=t._x*l+n._x*c+i._x*h+a._x*f,d=t._y*l+n._y*c+i._y*h+a._y*f,m=t._z*l+n._z*c+i._z*h+a._z*f;return new e(u,d,m)}static GetClipFactor(t,i,n,a){const s=e.Dot(t,n);return(s-a)/(s-e.Dot(i,n))}static TransformCoordinatesToRef(t,i,n){return e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,i,n),n}set(e,t,i){return this.copyFromFloats(e,t,i)}subtract(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z)}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)}minimizeInPlaceFromFloats(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this}set z(e){this._z=e,this._isDirty=!0}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._isDirty=!0,t}length(){return Math.sqrt(this.lengthSquared())}static Left(){return new e(-1,0,0)}static TransformNormal(t,i){const n=e.Zero();return e.TransformNormalToRef(t,i,n),n}normalizeToRef(e){const t=this.length();return 0===t||1===t?(e._x=this._x,e._y=this._y,e._z=this._z,e._isDirty=!0,e):this.scaleToRef(1/t,e)}divide(t){return new e(this._x/t._x,this._y/t._y,this._z/t._z)}reorderInPlace(e){if("xyz"===(e=e.toLowerCase()))return this;const t=Fh.Vector3[0].copyFrom(this);return this.x=t[e[0]],this.y=t[e[1]],this.z=t[e[2]],this}addInPlaceFromFloats(e,t,i){return this._x+=e,this._y+=t,this._z+=i,this._isDirty=!0,this}static Normalize(t){const i=e.Zero();return e.NormalizeToRef(t,i),i}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._isDirty=!0,t}static SlerpToRef(t,i,n,a){n=mh(n,0,1);const s=Fh.Vector3[0],r=Fh.Vector3[1];s.copyFrom(t);const o=s.length();s.normalizeFromLength(o),r.copyFrom(i);const l=r.length();r.normalizeFromLength(l);const c=e.Dot(s,r);let h,f;if(c<1-hh){const e=Math.acos(c),t=1/Math.sin(e);h=Math.sin((1-n)*e)*t,f=Math.sin(n*e)*t}else h=1-n,f=n;return s.scaleInPlace(h),r.scaleInPlace(f),a.copyFrom(s).addInPlace(r),a.scaleInPlace(dh(o,l,n)),a}applyRotationQuaternionInPlace(e){return this.applyRotationQuaternionToRef(e,this)}static ProjectOnTriangleToRef(t,i,n,a,s){const r=Fh.Vector3[0],o=Fh.Vector3[1],l=Fh.Vector3[2],c=Fh.Vector3[3],h=Fh.Vector3[4];n.subtractToRef(i,r),a.subtractToRef(i,o),a.subtractToRef(n,l);const f=r.length(),u=o.length(),d=l.length();if(f<hh||u<hh||d<hh)return s.copyFrom(i),e.Distance(t,i);t.subtractToRef(i,h),e.CrossToRef(r,o,c);const m=c.length();if(m<hh)return s.copyFrom(i),e.Distance(t,i);c.normalizeFromLength(m);let p=h.length();if(p<hh)return s.copyFrom(i),0;h.normalizeFromLength(p);const _=e.Dot(c,h),v=Fh.Vector3[5],g=Fh.Vector3[6];v.copyFrom(c).scaleInPlace(-p*_),g.copyFrom(t).addInPlace(v);const S=Fh.Vector3[4],y=Fh.Vector3[5],E=Fh.Vector3[7],A=Fh.Vector3[8];S.copyFrom(r).scaleInPlace(1/f),A.copyFrom(o).scaleInPlace(1/u),S.addInPlace(A).scaleInPlace(-1),y.copyFrom(r).scaleInPlace(-1/f),A.copyFrom(l).scaleInPlace(1/d),y.addInPlace(A).scaleInPlace(-1),E.copyFrom(l).scaleInPlace(-1/d),A.copyFrom(o).scaleInPlace(-1/u),E.addInPlace(A).scaleInPlace(-1);const C=Fh.Vector3[9];let R;C.copyFrom(g).subtractInPlace(i),e.CrossToRef(S,C,A),R=e.Dot(A,c);const T=R;C.copyFrom(g).subtractInPlace(n),e.CrossToRef(y,C,A),R=e.Dot(A,c);const N=R;C.copyFrom(g).subtractInPlace(a),e.CrossToRef(E,C,A),R=e.Dot(A,c);const M=R,I=Fh.Vector3[10];let x,b;T>0&&N<0?(I.copyFrom(r),x=i,b=n):N>0&&M<0?(I.copyFrom(l),x=n,b=a):(I.copyFrom(o).scaleInPlace(-1),x=a,b=i);const P=Fh.Vector3[9],w=Fh.Vector3[4];x.subtractToRef(g,A),b.subtractToRef(g,P),e.CrossToRef(A,P,w);if(!(e.Dot(w,c)<0))return s.copyFrom(g),Math.abs(p*_);const O=Fh.Vector3[5];e.CrossToRef(I,w,O),O.normalize();const D=Fh.Vector3[9];D.copyFrom(x).subtractInPlace(g);const L=D.length();if(L<hh)return s.copyFrom(x),e.Distance(t,x);D.normalizeFromLength(L);const F=e.Dot(O,D),k=Fh.Vector3[7];k.copyFrom(g).addInPlace(O.scaleInPlace(L*F)),A.copyFrom(k).subtractInPlace(x),p=I.length(),I.normalizeFromLength(p);let B=e.Dot(A,I)/Math.max(p,hh);return B=mh(B,0,1),k.copyFrom(x).addInPlace(I.scaleInPlace(B*p)),s.copyFrom(k),e.Distance(t,k)}static GetAngleBetweenVectorsOnPlane(t,i,n){Fh.Vector3[0].copyFrom(t);const a=Fh.Vector3[0];Fh.Vector3[1].copyFrom(i);const s=Fh.Vector3[1];Fh.Vector3[2].copyFrom(n);const r=Fh.Vector3[2],o=Fh.Vector3[3],l=Fh.Vector3[4];a.normalize(),s.normalize(),r.normalize(),e.CrossToRef(r,a,o),e.CrossToRef(o,r,l);return ph(Math.atan2(e.Dot(s,o),e.Dot(s,l)))}static get LeftReadOnly(){return e._LeftReadOnly}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z}static CatmullRom(t,i,n,a,s){const r=s*s,o=s*r,l=.5*(2*i._x+(-t._x+n._x)*s+(2*t._x-5*i._x+4*n._x-a._x)*r+(-t._x+3*i._x-3*n._x+a._x)*o),c=.5*(2*i._y+(-t._y+n._y)*s+(2*t._y-5*i._y+4*n._y-a._y)*r+(-t._y+3*i._y-3*n._y+a._y)*o),h=.5*(2*i._z+(-t._z+n._z)*s+(2*t._z-5*i._z+4*n._z-a._z)*r+(-t._z+3*i._z-3*n._z+a._z)*o);return new e(l,c,h)}static Zero(){return new e(0,0,0)}static Hermite1stDerivative(t,i,n,a,s){const r=new e;return this.Hermite1stDerivativeToRef(t,i,n,a,s,r),r}multiplyByFloats(t,i,n){return new e(this._x*t,this._y*i,this._z*n)}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z}toQuaternion(){return Dh.lt(this._y,this._x,this._z)}static FromFloatArray(t,i){return e.FromArray(t,i)}static UnprojectToRef(t,i,n,a,s,r,o){return e.UnprojectFloatsToRef(t._x,t._y,t._z,i,n,a,s,r,o),o}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}subtractFromFloats(t,i,n){return new e(this._x-t,this._y-i,this._z-n)}constructor(e=0,t=0,i=0){this._isDirty=!0,this._x=e,this._y=t,this._z=i}static ProjectToRef(t,i,n,a,s){const r=a.width,o=a.height,l=a.x,c=a.y,h=Fh.Matrix[1],f=xh.LastCreatedEngine?.isNDCHalfZRange,u=f?1:.5,d=f?0:.5;Lh.FromValuesToRef(r/2,0,0,0,0,-o/2,0,0,0,0,u,0,l+r/2,o/2+c,d,1,h);const m=Fh.Matrix[0];return i.multiplyToRef(n,m),m.multiplyToRef(h,m),e.TransformCoordinatesToRef(t,m,s),s}static DistanceSquared(e,t){const i=e._x-t._x,n=e._y-t._y,a=e._z-t._z;return i*i+n*n+a*a}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._isDirty=!0,this}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)}static Hermite1stDerivativeToRef(e,t,i,n,a,s){const r=a*a;return s._x=6*(r-a)*e._x+(3*r-4*a+1)*t._x+6*(-r+a)*i._x+(3*r-2*a)*n._x,s._y=6*(r-a)*e._y+(3*r-4*a+1)*t._y+6*(-r+a)*i._y+(3*r-2*a)*n._y,s._z=6*(r-a)*e._z+(3*r-4*a+1)*t._z+6*(-r+a)*i._z+(3*r-2*a)*n._z,s._isDirty=!0,s}static get UpReadOnly(){return e._UpReadOnly}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._isDirty=!0,i}fract(){return new e(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}subtractFromFloatsToRef(e,t,i,n){return n._x=this._x-e,n._y=this._y-t,n._z=this._z-i,n._isDirty=!0,n}static RotationFromAxisToRef(e,t,i,n){const a=Fh.Ht[0];return Dh.RotationQuaternionFromAxisToRef(e,t,i,a),a.toEulerAnglesToRef(n),n}static get LeftHandedBackwardReadOnly(){return e._LeftHandedBackwardReadOnly}copyFromFloats(e,t,i){return this._x=e,this._y=t,this._z=i,this._isDirty=!0,this}subtractToRef(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)}static get DownReadOnly(){return e._DownReadOnly}fromArray(t,i=0){return e.FromArrayToRef(t,i,this),this}set y(e){this._y=e,this._isDirty=!0}static Distance(t,i){return Math.sqrt(e.DistanceSquared(t,i))}multiplyInPlace(e){return this._x*=e._x,this._y*=e._y,this._z*=e._z,this._isDirty=!0,this}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}static FromFloatArrayToRef(t,i,n){return e.FromArrayToRef(t,i,n)}static get LeftHandedForwardReadOnly(){return e._LeftHandedForwardReadOnly}equalsToFloats(e,t,i){return this._x===e&&this._y===t&&this._z===i}static RotationFromAxis(t,i,n){const a=new e;return e.RotationFromAxisToRef(t,i,n,a),a}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._isDirty=!0,t}static Forward(t=!1){return new e(0,0,t?-1:1)}add(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z)}static Backward(t=!1){return new e(0,0,t?1:-1)}setAll(e){return this._x=this._y=this._z=e,this._isDirty=!0,this}getClassName(){return"Vector3"}static ReflectToRef(t,i,n){const a=kh.Vector3[0];return a.copyFrom(i).scaleInPlace(2*e.Dot(t,i)),n.copyFrom(t).subtractInPlace(a)}static Random(t=0,i=1){return new e(uh(t,i),uh(t,i),uh(t,i))}static TransformNormalToRef(e,t,i){return this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i),i}divideInPlace(e){return this._x=this._x/e._x,this._y=this._y/e._y,this._z=this._z/e._z,this._isDirty=!0,this}normalize(){return this.normalizeFromLength(this.length())}copyFrom(e){return this.copyFromFloats(e._x,e._y,e._z)}static Lerp(t,i,n){const a=new e(0,0,0);return e.LerpToRef(t,i,n,a),a}floorToRef(e){return e._x=Math.floor(this._x),e._y=Math.floor(this._y),e._z=Math.floor(this._z),e._isDirty=!0,e}negate(){return new e(-this._x,-this._y,-this._z)}static Cross(t,i){const n=new e;return e.CrossToRef(t,i,n),n}static _UnprojectFromInvertedMatrixToRef(t,i,n){e.TransformCoordinatesToRef(t,i,n);const a=i.m,s=t._x*a[3]+t._y*a[7]+t._z*a[11]+a[15];return fh(s,1)&&n.scaleInPlace(1/s),n}get z(){return this._z}static TransformNormalFromFloatsToRef(e,t,i,n,a){const s=n.m;return a._x=e*s[0]+t*s[4]+i*s[8],a._y=e*s[1]+t*s[5]+i*s[9],a._z=e*s[2]+t*s[6]+i*s[10],a._isDirty=!0,a}maximizeInPlaceFromFloats(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this}};wh._UpReadOnly=wh.Up(),wh._DownReadOnly=wh.Down(),wh._LeftHandedForwardReadOnly=wh.Forward(!1),wh._RightHandedForwardReadOnly=wh.Forward(!0),wh._LeftHandedBackwardReadOnly=wh.Backward(!1),wh._RightHandedBackwardReadOnly=wh.Backward(!0),wh._RightReadOnly=wh.Right(),wh._LeftReadOnly=wh.Left(),wh._ZeroReadOnly=wh.Zero(),wh._OneReadOnly=wh.One(),Object.defineProperties(wh.prototype,{dimension:{value:[3]},rank:{value:1}});var Oh=class e{floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}divide(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}static Minimize(t,i){const n=new e;return n.copyFrom(t),n.minimizeInPlace(i),n}copyFromFloats(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}static Random(t=0,i=1){return new e(uh(t,i),uh(t,i),uh(t,i),uh(t,i))}negate(){return new e(-this.x,-this.y,-this.z,-this.w)}clone(){return new e(this.x,this.y,this.z,this.w)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,t}static TransformNormalToRef(e,t,i){const n=t.m,a=e.x*n[0]+e.y*n[4]+e.z*n[8],s=e.x*n[1]+e.y*n[5]+e.z*n[9],r=e.x*n[2]+e.y*n[6]+e.z*n[10];return i.x=a,i.y=s,i.z=r,i.w=e.w,i}static FromArray(t,i){return i||(i=0),new e(t[i],t[i+1],t[i+2],t[i+3])}divideInPlace(e){return this.divideToRef(e,this)}normalizeToRef(e){const t=this.length();return 0===t||1===t?(e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e):this.scaleToRef(1/t,e)}static TransformCoordinatesToRef(t,i,n){return e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,i,n),n}asArray(){return[this.x,this.y,this.z,this.w]}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e.z=Math.floor(this.z),e.w=Math.floor(this.w),e}static RandomToRef(e=0,t=1,i){return i.x=uh(e,t),i.y=uh(e,t),i.z=uh(e,t),i.w=uh(e,t),i}maximizeInPlaceFromFloats(e,t,i,n){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this.z=Math.max(i,this.z),this.w=Math.max(n,this.w),this}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}minimizeInPlace(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}static Dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}fract(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,t}equalsToFloats(e,t,i,n){return this.x===e&&this.y===t&&this.z===i&&this.w===n}subtractFromFloats(t,i,n,a){return new e(this.x-t,this.y-i,this.z-n,this.w-a)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}static Clamp(t,i,n){return e.ClampToRef(t,i,n,new e)}getHashCode(){let e=bh(this.x);return e=397*e^bh(this.y),e=397*e^bh(this.z),e=397*e^bh(this.w),e}toArray(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this}scaleInPlace(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}static Normalize(t){return e.NormalizeToRef(t,new e)}static FromVector3(t,i=0){return new e(t._x,t._y,t._z,i)}multiplyByFloats(t,i,n,a){return new e(this.x*t,this.y*i,this.z*n,this.w*a)}normalize(){return this.normalizeFromLength(this.length())}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static One(){return new e(1,1,1,1)}static Zero(){return new e(0,0,0,0)}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,t}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,t}normalizeToNew(){return this.normalizeToRef(new e)}static get ZeroReadOnly(){return e._ZeroReadOnly}toVector3(){return new wh(this.x,this.y,this.z)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e.z=this.z-Math.floor(this.z),e.w=this.w-Math.floor(this.w),e}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,t}static FromFloatsToRef(e,t,i,n,a){return a.x=e,a.y=t,a.z=i,a.w=n,a}maximizeInPlace(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}scale(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)}getClassName(){return"Vector4"}copyFrom(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}subtractFromFloatsToRef(e,t,i,n,a){return a.x=this.x-e,a.y=this.y-t,a.z=this.z-i,a.w=this.w-n,a}static Distance(t,i){return Math.sqrt(e.DistanceSquared(t,i))}add(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}static DistanceSquared(e,t){const i=e.x-t.x,n=e.y-t.y,a=e.z-t.z,s=e.w-t.w;return i*i+n*n+a*a+s*s}negateToRef(e){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=-this.w,e}fromArray(t,i=0){return e.FromArrayToRef(t,i,this),this}minimizeInPlaceFromFloats(e,t,i,n){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this.z=Math.min(i,this.z),this.w=Math.min(n,this.w),this}multiply(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}static FromFloatArrayToRef(t,i,n){return e.FromArrayToRef(t,i,n),n}setAll(e){return this.x=this.y=this.z=this.w=e,this}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3],i}static ClampToRef(e,t,i,n){return n.x=mh(e.x,t.x,i.x),n.y=mh(e.y,t.y,i.y),n.z=mh(e.z,t.z,i.z),n.w=mh(e.w,t.w,i.w),n}static TransformCoordinatesFromFloatsToRef(e,t,i,n,a){const s=n.m,r=e*s[0]+t*s[4]+i*s[8]+s[12],o=e*s[1]+t*s[5]+i*s[9]+s[13],l=e*s[2]+t*s[6]+i*s[10]+s[14],c=e*s[3]+t*s[7]+i*s[11]+s[15];return a.x=r,a.y=o,a.z=l,a.w=c,a}static CenterToRef(e,t,i){return i.x=(e.x+t.x)/2,i.y=(e.y+t.y)/2,i.z=(e.z+t.z)/2,i.w=(e.w+t.w)/2,i}static TransformNormalFromFloatsToRef(e,t,i,n,a,s){const r=a.m;return s.x=e*r[0]+t*r[4]+i*r[8],s.y=e*r[1]+t*r[5]+i*r[9],s.z=e*r[2]+t*r[6]+i*r[10],s.w=n,s}subtract(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.z=i,this.w=n}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,t}static TransformCoordinates(t,i){return e.TransformCoordinatesToRef(t,i,new e)}addInPlaceFromFloats(e,t,i,n){return this.x+=e,this.y+=t,this.z+=i,this.w+=n,this}set(e,t,i,n){return this.copyFromFloats(e,t,i,n)}addInPlace(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}equals(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}equalsWithEpsilon(e,t=hh){return e&&fh(this.x,e.x,t)&&fh(this.y,e.y,t)&&fh(this.z,e.z,t)&&fh(this.w,e.w,t)}static Center(t,i){return e.CenterToRef(t,i,new e)}static TransformNormal(t,i){return e.TransformNormalToRef(t,i,new e)}static Maximize(t,i){const n=new e;return n.copyFrom(t),n.maximizeInPlace(i),n}};Oh._ZeroReadOnly=Oh.Zero(),Object.defineProperties(Oh.prototype,{dimension:{value:[4]},rank:{value:1}});var Dh=class e{static RotationAxis(t,i){return e.RotationAxisToRef(t,i,new e)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this._isDirty=!0,this}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this._isDirty=!0,this}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._w+=this._w*e,t._isDirty=!0,t}get z(){return this._z}static FromFloatsToRef(e,t,i,n,a){return a.copyFromFloats(e,t,i,n),a}subtractFromFloatsToRef(e,t,i,n,a){return a._x=this._x-e,a._y=this._y-t,a._z=this._z-i,a._w=this._w-n,a._isDirty=!0,a}static Inverse(t){return new e(-t._x,-t._y,-t._z,t._w)}setAll(e){return this.copyFromFloats(e,e,e,e)}toAlphaBetaGammaToRef(e){const t=this._z,i=this._x,n=this._y,a=this._w,s=Math.sqrt(i*i+n*n),r=Math.sqrt(t*t+a*a),o=2*Math.atan2(s,r),l=2*Math.atan2(t,a),c=2*Math.atan2(n,i),h=(l+c)/2,f=(l-c)/2;return e.set(f,o,h),e}negateToRef(e){return e._x=-this._x,e._y=-this._y,e._z=-this._z,e._w=-this._w,e._isDirty=!0,e}static FromLookDirectionLHToRef(t,i,n){const a=Fh.Matrix[0];return Lh.LookDirectionLHToRef(t,i,a),e.FromRotationMatrixToRef(a,n),n}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}get w(){return this._w}static RotationAlphaBetaGamma(t,i,n){const a=new e;return e.RotationAlphaBetaGammaToRef(t,i,n,a),a}toEulerAnglesToRef(e){const t=this._z,i=this._x,n=this._y,a=this._w,s=n*t-i*a,r=.4999999;if(s<-r)e._y=2*Math.atan2(n,a),e._x=Math.PI/2,e._z=0,e._isDirty=!0;else if(s>r)e._y=2*Math.atan2(n,a),e._x=-Math.PI/2,e._z=0,e._isDirty=!0;else{const r=a*a,o=t*t,l=i*i,c=n*n;e._z=Math.atan2(2*(i*n+t*a),-o-l+c+r),e._x=Math.asin(-2*s),e._y=Math.atan2(2*(t*i+n*a),o-l-c+r),e._isDirty=!0}return e}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}equalsWithEpsilon(e,t=hh){return e&&fh(this._x,e._x,t)&&fh(this._y,e._y,t)&&fh(this._z,e._z,t)&&fh(this._w,e._w,t)}static FromUnitVectorsToRef(e,t,i,n=hh){const a=wh.Dot(e,t)+1;return a<n?Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0,0):i.set(0,-e.z,e.y,0):(wh.CrossToRef(e,t,kh.Vector3[0]),i.set(kh.Vector3[0].x,kh.Vector3[0].y,kh.Vector3[0].z,a)),i.normalize()}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}floorToRef(e){throw new ReferenceError("Can not floor a quaternion")}static InverseToRef(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._w*=e,this._isDirty=!0,this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}subtractFromFloats(t,i,n,a){return this.subtractFromFloatsToRef(t,i,n,a,new e)}asArray(){return[this._x,this._y,this._z,this._w]}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Normalize(t){const i=e.Zero();return e.NormalizeToRef(t,i),i}static Zero(){return new e(0,0,0,0)}constructor(e=0,t=0,i=0,n=1){this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=n}multiplyInPlace(e){return this.multiplyToRef(e,this)}static Hermite1stDerivative(t,i,n,a,s){const r=new e;return this.Hermite1stDerivativeToRef(t,i,n,a,s,r),r}static AreClose(t,i,n=.1){const a=e.Dot(t,i);return 1-a*a<=n}static FromEulerAngles(t,i,n){const a=new e;return e.RotationYawPitchRollToRef(i,t,n,a),a}fract(){throw new ReferenceError("Can not fract a quaternion")}static ClampToRef(e,t,i,n){return n.copyFromFloats(mh(e.x,t.x,i.x),mh(e.y,t.y,i.y),mh(e.z,t.z,i.z),mh(e.w,t.w,i.w))}static FromRotationMatrixToRef(e,t){const i=e.m,n=i[0],a=i[4],s=i[8],r=i[1],o=i[5],l=i[9],c=i[2],h=i[6],f=i[10],u=n+o+f;let d;return u>0?(d=.5/Math.sqrt(u+1),t._w=.25/d,t._x=(h-l)*d,t._y=(s-c)*d,t._z=(r-a)*d,t._isDirty=!0):n>o&&n>f?(d=2*Math.sqrt(1+n-o-f),t._w=(h-l)/d,t._x=.25*d,t._y=(a+r)/d,t._z=(s+c)/d,t._isDirty=!0):o>f?(d=2*Math.sqrt(1+o-n-f),t._w=(s-c)/d,t._x=(a+r)/d,t._y=.25*d,t._z=(l+h)/d,t._isDirty=!0):(d=2*Math.sqrt(1+f-n-o),t._w=(r-a)/d,t._x=(s+c)/d,t._y=(l+h)/d,t._z=.25*d,t._isDirty=!0),t}equalsToFloats(e,t,i,n){return this._x===e&&this._y===t&&this._z===i&&this._w===n}negate(){return this.negateToRef(new e)}static DistanceSquared(e,t){const i=e.x-t.x,n=e.y-t.y,a=e.z-t.z,s=e.w-t.w;return i*i+n*n+a*a+s*s}static IsIdentity(e){return e&&0===e._x&&0===e._y&&0===e._z&&1===e._w}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,this}normalizeFromLength(e){return 0===e||1===e?this:this.scaleInPlace(1/e)}set x(e){this._x=e,this._isDirty=!0}clone(){return new e(this._x,this._y,this._z,this._w)}invertInPlace(){this.conjugateInPlace();const e=this.lengthSquared();return 0==e||1==e||this.scaleInPlace(1/e),this}multiplyByFloats(e,t,i,n){return this._x*=e,this._y*=t,this._z*=i,this._w*=n,this._isDirty=!0,this}multiplyToRef(e,t){const i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,n=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,a=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,s=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,n,a,s),t}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}length(){return Math.sqrt(this.lengthSquared())}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._w=this._w*e,t._isDirty=!0,t}static FromEulerAnglesToRef(t,i,n,a){return e.RotationYawPitchRollToRef(i,t,n,a),a}conjugate(){return new e(-this._x,-this._y,-this._z,this._w)}fromRotationMatrix(t){return e.FromRotationMatrixToRef(t,this),this}static Identity(){return new e(0,0,0,1)}invert(){const e=this.conjugate(),t=this.lengthSquared();return 0==t||1==t||e.scaleInPlace(1/t),e}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w}static Hermite(t,i,n,a,s){const r=s*s,o=s*r,l=2*o-3*r+1,c=-2*o+3*r,h=o-2*r+s,f=o-r,u=t._x*l+n._x*c+i._x*h+a._x*f,d=t._y*l+n._y*c+i._y*h+a._y*f,m=t._z*l+n._z*c+i._z*h+a._z*f,p=t._w*l+n._w*c+i._w*h+a._w*f;return new e(u,d,m,p)}static FromEulerVector(t){const i=new e;return e.RotationYawPitchRollToRef(t._y,t._x,t._z,i),i}static RotationYawPitchRollToRef(e,t,i,n){const a=.5*i,s=.5*t,r=.5*e,o=Math.sin(a),l=Math.cos(a),c=Math.sin(s),h=Math.cos(s),f=Math.sin(r),u=Math.cos(r);return n._x=u*c*l+f*h*o,n._y=f*h*l-u*c*o,n._z=u*h*o-f*c*l,n._w=u*h*l+f*c*o,n._isDirty=!0,n}divideInPlace(e){throw new ReferenceError("Can not divide a quaternion")}static RotationAxisToRef(e,t,i){i._w=Math.cos(t/2);const n=Math.sin(t/2)/e.length();return i._x=e._x*n,i._y=e._y*n,i._z=e._z*n,i._isDirty=!0,i}fractToRef(e){throw new ReferenceError("Can not fract a quaternion")}static SmoothToRef(t,i,n,a,s){let r=0===a?1:n/a;return r=mh(r,0,1),e.SlerpToRef(t,i,r,s),s}copyFrom(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._isDirty=!0,this}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}normalize(){return this.normalizeFromLength(this.length())}getClassName(){return"Quaternion"}fromArray(t,i=0){return e.FromArrayToRef(t,i,this)}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)}divide(e){throw new ReferenceError("Can not divide a quaternion")}static FromArray(t,i){return i||(i=0),new e(t[i],t[i+1],t[i+2],t[i+3])}set z(e){this._z=e,this._isDirty=!0}normalizeToNew(){const t=new e(0,0,0,1);return this.normalizeToRef(t),t}addInPlaceFromFloats(e,t,i,n){return this._x+=e,this._y+=t,this._z+=i,this._w+=n,this._isDirty=!0,this}static Clamp(t,i,n){const a=new e;return e.ClampToRef(t,i,n,a),a}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}divideToRef(e,t){throw new ReferenceError("Can not divide a quaternion")}toEulerAngles(){const e=wh.Zero();return this.toEulerAnglesToRef(e),e}static FromRotationMatrix(t){const i=new e;return e.FromRotationMatrixToRef(t,i),i}set y(e){this._y=e,this._isDirty=!0}static SlerpToRef(e,t,i,n){let a,s,r=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,o=!1;if(r<0&&(o=!0,r=-r),r>.999999)s=1-i,a=o?-i:i;else{const e=Math.acos(r),t=1/Math.sin(e);s=Math.sin((1-i)*e)*t,a=o?-Math.sin(i*e)*t:Math.sin(i*e)*t}return n._x=s*e._x+a*t._x,n._y=s*e._y+a*t._y,n._z=s*e._z+a*t._z,n._w=s*e._w+a*t._w,n._isDirty=!0,n}static Random(t=0,i=1){return new e(uh(t,i),uh(t,i),uh(t,i),uh(t,i))}getHashCode(){let e=bh(this._x);return e=397*e^bh(this._y),e=397*e^bh(this._z),e=397*e^bh(this._w),e}static Distance(t,i){return Math.sqrt(e.DistanceSquared(t,i))}static lt(t,i,n){const a=new e;return e.RotationYawPitchRollToRef(t,i,n,a),a}static FromLookDirectionLH(t,i){const n=new e;return e.FromLookDirectionLHToRef(t,i,n),n}static RotationAlphaBetaGammaToRef(e,t,i,n){const a=.5*(i+e),s=.5*(i-e),r=.5*t;return n._x=Math.cos(s)*Math.sin(r),n._y=Math.sin(s)*Math.sin(r),n._z=Math.sin(a)*Math.cos(r),n._w=Math.cos(a)*Math.cos(r),n._isDirty=!0,n}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}static Slerp(t,i,n){const a=e.Identity();return e.SlerpToRef(t,i,n,a),a}copyFromFloats(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._isDirty=!0,this}set(e,t,i,n){return this.copyFromFloats(e,t,i,n)}multiply(t){const i=new e(0,0,0,1);return this.multiplyToRef(t,i),i}subtract(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)}static RotationQuaternionFromAxisToRef(t,i,n,a){const s=Fh.Matrix[0];return t=t.normalizeToRef(Fh.Vector3[0]),i=i.normalizeToRef(Fh.Vector3[1]),n=n.normalizeToRef(Fh.Vector3[2]),Lh.FromXYZAxesToRef(t,i,n,s),e.FromRotationMatrixToRef(s,a),a}static FromLookDirectionRH(t,i){const n=new e;return e.FromLookDirectionRHToRef(t,i,n),n}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._w=this._w+e._w,t._isDirty=!0,t}static FromEulerVectorToRef(t,i){return e.RotationYawPitchRollToRef(t._y,t._x,t._z,i),i}toRotationMatrix(e){return Lh.FromQuaternionToRef(this,e),e}static FromLookDirectionRHToRef(t,i,n){const a=Fh.Matrix[0];return Lh.LookDirectionRHToRef(t,i,a),e.FromRotationMatrixToRef(a,n)}scale(t){return new e(this._x*t,this._y*t,this._z*t,this._w*t)}add(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)}static Hermite1stDerivativeToRef(e,t,i,n,a,s){const r=a*a;return s._x=6*(r-a)*e._x+(3*r-4*a+1)*t._x+6*(-r+a)*i._x+(3*r-2*a)*n._x,s._y=6*(r-a)*e._y+(3*r-4*a+1)*t._y+6*(-r+a)*i._y+(3*r-2*a)*n._y,s._z=6*(r-a)*e._z+(3*r-4*a+1)*t._z+6*(-r+a)*i._z+(3*r-2*a)*n._z,s._w=6*(r-a)*e._w+(3*r-4*a+1)*t._w+6*(-r+a)*i._w+(3*r-2*a)*n._w,s._isDirty=!0,s}static RotationQuaternionFromAxis(t,i,n){const a=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,i,n,a),a}normalizeToRef(e){const t=this.length();return 0===t||1===t?e.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/t,e)}conjugateToRef(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),e}static Center(t,i){return e.CenterToRef(t,i,e.Zero())}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}get x(){return this._x}subtractToRef(e,t){return t._x=this._x-e._x,t._y=this._y-e._y,t._z=this._z-e._z,t._w=this._w-e._w,t._isDirty=!0,t}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(uh(e,t),uh(e,t),uh(e,t),uh(e,t))}get y(){return this._y}set w(e){this._w=e,this._isDirty=!0}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._w=e[t+3],i._isDirty=!0,i}floor(){throw new ReferenceError("Can not floor a quaternion")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}};Object.defineProperties(Dh.prototype,{dimension:{value:[4]},rank:{value:1}});var Lh=class e{multiplyAtIndex(e,t){return this._m[e]*=t,this.markAsUpdated(),this}addInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]+=i[e];return this.markAsUpdated(),this}static GetAsMatrix2x2(e){const t=e.m,i=[t[0],t[1],t[4],t[5]];return Th.MatrixUse64Bits?i:new Float32Array(i)}divide(t){return this.divideToRef(t,new e)}static ScalingToRef(t,i,n,a){return e.FromValuesToRef(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1,a),a._updateIdentityStatus(1===t&&1===i&&1===n),a}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}markAsUpdated(){this.updateFlag=e._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}static RotationAxis(t,i){const n=new e;return e.RotationAxisToRef(t,i,n),n}static RotationXToRef(t,i){const n=Math.sin(t),a=Math.cos(t);return e.FromValuesToRef(1,0,0,0,0,a,n,0,0,-n,a,0,0,0,0,1,i),i._updateIdentityStatus(1===a&&0===n),i}static FromArray(t,i=0){const n=new e;return e.FromArrayToRef(t,i,n),n}static LookDirectionRHToRef(t,i,n){const a=Fh.Vector3[2];return wh.CrossToRef(i,t,a),e.FromValuesToRef(a._x,a._y,a._z,0,i._x,i._y,i._z,0,t._x,t._y,t._z,0,0,0,0,1,n),n}static OrthoOffCenterRHToRef(t,i,n,a,s,r,o,l){return e.OrthoOffCenterLHToRef(t,i,n,a,s,r,o,l),o._m[10]*=-1,o}static FromValues(t,i,n,a,s,r,o,l,c,h,f,u,d,m,p,_){const v=new e,g=v._m;return g[0]=t,g[1]=i,g[2]=n,g[3]=a,g[4]=s,g[5]=r,g[6]=o,g[7]=l,g[8]=c,g[9]=h,g[10]=f,g[11]=u,g[12]=d,g[13]=m,g[14]=p,g[15]=_,v.markAsUpdated(),v}static GetAsMatrix3x3(e){const t=e.m,i=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return Th.MatrixUse64Bits?i:new Float32Array(i)}static get Use64Bits(){return Th.MatrixUse64Bits}copyToArray(e,t=0){const i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,Th.MatrixTrackPrecisionChange&&Th.MatrixTrackedMatrices.push(this),this._m=new Th.MatrixCurrentType(16),this.markAsUpdated()}static Reflection(t){const i=new e;return e.ReflectionToRef(t,i),i}static RotationAxisToRef(e,t,i){const n=Math.sin(-t),a=Math.cos(-t),s=1-a;e=e.normalizeToRef(Fh.Vector3[0]);const r=i._m;return r[0]=e._x*e._x*s+a,r[1]=e._x*e._y*s-e._z*n,r[2]=e._x*e._z*s+e._y*n,r[3]=0,r[4]=e._y*e._x*s+e._z*n,r[5]=e._y*e._y*s+a,r[6]=e._y*e._z*s-e._x*n,r[7]=0,r[8]=e._z*e._x*s-e._y*n,r[9]=e._z*e._y*s+e._x*n,r[10]=e._z*e._z*s+a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,i.markAsUpdated(),i}equalsToFloats(...e){const t=this._m;for(let i=0;i<16;i++)if(t[i]!=e[i])return!1;return!0}reset(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}setAll(e){const t=this._m;for(let i=0;i<16;i++)t[i]=e;return this.markAsUpdated(),this}static Identity(){const t=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t}static Translation(t,i,n){const a=new e;return e.TranslationToRef(t,i,n,a),a}multiplyByFloatsToRef(...e){const t=e.pop(),i=this._m,n=t._m,a=e;for(let e=0;e<16;e++)n[e]=i[e]*a[e];return t.markAsUpdated(),t}static FromXYZAxesToRef(t,i,n,a){return e.FromValuesToRef(t._x,t._y,t._z,0,i._x,i._y,i._z,0,n._x,n._y,n._z,0,0,0,0,1,a),a}invert(){return this.invertToRef(this),this}static LookDirectionLH(t,i){const n=new e;return e.LookDirectionLHToRef(t,i,n),n}multiply(t){const i=new e;return this.multiplyToRef(t,i),i}multiplyToRef(e,t){return this._isIdentity?(t.copyFrom(e),t):e._isIdentity?(t.copyFrom(this),t):(this.multiplyToArray(e,t._m,0),t.markAsUpdated(),t)}setTranslationFromFloats(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this.markAsUpdated(),this}static LookAtLH(t,i,n){const a=new e;return e.LookAtLHToRef(t,i,n,a),a}scale(t){const i=new e;return this.scaleToRef(t,i),i}static get IdentityReadOnly(){return e._IdentityReadOnly}getHashCode(){let e=bh(this._m[0]);for(let t=1;t<16;t++)e=397*e^bh(this._m[t]);return e}static OrthoLH(t,i,n,a,s){const r=new e;return e.OrthoLHToRef(t,i,n,a,r,s),r}divideInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]/=i[e];return this.markAsUpdated(),this}minimizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}subtractFromFloatsToRef(...e){const t=e.pop(),i=this._m,n=t._m,a=e;for(let e=0;e<16;e++)n[e]=i[e]-a[e];return t.markAsUpdated(),t}floorToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=Math.floor(t[e]);return e.markAsUpdated(),e}static RotationX(t){const i=new e;return e.RotationXToRef(t,i),i}static FromValuesToRef(e,t,i,n,a,s,r,o,l,c,h,f,u,d,m,p,_){const v=_._m;v[0]=e,v[1]=t,v[2]=i,v[3]=n,v[4]=a,v[5]=s,v[6]=r,v[7]=o,v[8]=l,v[9]=c,v[10]=h,v[11]=f,v[12]=u,v[13]=d,v[14]=m,v[15]=p,_.markAsUpdated()}removeRotationAndScaling(){const t=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this}static ComposeToRef(e,t,i,n){const a=n._m,s=t._x,r=t._y,o=t._z,l=t._w,c=s+s,h=r+r,f=o+o,u=s*c,d=s*h,m=s*f,p=r*h,_=r*f,v=o*f,g=l*c,S=l*h,y=l*f,E=e._x,A=e._y,C=e._z;return a[0]=(1-(p+v))*E,a[1]=(d+y)*E,a[2]=(m-S)*E,a[3]=0,a[4]=(d-y)*A,a[5]=(1-(u+v))*A,a[6]=(_+g)*A,a[7]=0,a[8]=(m+S)*C,a[9]=(_-g)*C,a[10]=(1-(u+p))*C,a[11]=0,a[12]=i._x,a[13]=i._y,a[14]=i._z,a[15]=1,n.markAsUpdated(),n}static RotationZToRef(t,i){const n=Math.sin(t),a=Math.cos(t);return e.FromValuesToRef(a,n,0,0,-n,a,0,0,0,0,1,0,0,0,0,1,i),i._updateIdentityStatus(1===a&&0===n),i}getRow(e){if(e<0||e>3)return null;const t=4*e;return new Oh(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])}copyFromFloats(...t){return e.FromArrayToRef(t,0,this)}static lt(t,i,n){const a=new e;return e.RotationYawPitchRollToRef(t,i,n,a),a}setTranslation(e){return this.setTranslationFromFloats(e._x,e._y,e._z)}fractToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=t[e]-Math.floor(t[e]);return e.markAsUpdated(),e}static RotationYToRef(t,i){const n=Math.sin(t),a=Math.cos(t);return e.FromValuesToRef(a,0,-n,0,0,1,0,0,n,0,a,0,0,0,0,1,i),i._updateIdentityStatus(1===a&&0===n),i}static LookDirectionLHToRef(t,i,n){const a=Fh.Vector3[0];a.copyFrom(t),a.scaleInPlace(-1);const s=Fh.Vector3[1];return wh.CrossToRef(i,a,s),e.FromValuesToRef(s._x,s._y,s._z,0,i._x,i._y,i._z,0,a._x,a._y,a._z,0,0,0,0,1,n),n}static ReflectionToRef(t,i){t.normalize();const n=t.normal.x,a=t.normal.y,s=t.normal.z,r=-2*n,o=-2*a,l=-2*s;return e.FromValuesToRef(r*n+1,o*n,l*n,0,r*a,o*a+1,l*a,0,r*s,o*s,l*s+1,0,r*t.d,o*t.d,l*t.d,1,i),i}static PerspectiveFovLHToRef(t,i,n,a,s,r=!0,o,l=0,c=!1){const h=n,f=a,u=1/Math.tan(.5*t),d=r?u/i:u,m=r?u:u*i,p=c&&0===h?-1:0!==f?(f+h)/(f-h):1,_=c&&0===h?2*f:0!==f?-2*f*h/(f-h):-2*h,v=Math.tan(l);return e.FromValuesToRef(d,0,0,0,0,m,0,v,0,0,p,1,0,0,_,0,s),o&&s.multiplyToRef(Bh,s),s._updateIdentityStatus(!1),s}toggleModelMatrixHandInPlace(){const e=this._m;return e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated(),this}static Invert(t){const i=new e;return t.invertToRef(i),i}asArray(){return this._m}divideToRef(e,t){const i=this._m,n=e.m,a=t._m;for(let e=0;e<16;e++)a[e]=i[e]/n[e];return t.markAsUpdated(),t}static IdentityToRef(t){return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0),t}subtract(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]-=i[e];return this.markAsUpdated(),this}negateToRef(e){const t=this._m,i=e._m;for(let e=0;e<16;e++)i[e]=-t[e];return e.markAsUpdated(),e}scaleInPlace(e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e;return this.markAsUpdated(),this}toArray(e=null,t=0){if(!e)return this._m;const i=this._m;for(let n=0;n<16;n++)e[t+n]=i[n];return this}getRotationMatrixToRef(t){const i=Fh.Vector3[0];if(!this.decompose(i))return e.IdentityToRef(t),t;const n=this._m,a=1/i._x,s=1/i._y,r=1/i._z;return e.FromValuesToRef(n[0]*a,n[1]*a,n[2]*a,0,n[4]*s,n[5]*s,n[6]*s,0,n[8]*r,n[9]*r,n[10]*r,0,0,0,0,1,t),t}subtractToRef(e,t){const i=this._m,n=e.m,a=t._m;for(let e=0;e<16;e++)a[e]=i[e]-n[e];return t.markAsUpdated(),t}static PerspectiveFovRH(t,i,n,a,s,r=0,o=!1){const l=new e;return e.PerspectiveFovRHToRef(t,i,n,a,l,!0,s,r,o),l}static OrthoLHToRef(t,i,n,a,s,r){const o=2/t,l=2/i,c=2/(a-n),h=-(a+n)/(a-n);return e.FromValuesToRef(o,0,0,0,0,l,0,0,0,0,c,0,0,0,h,1,s),r&&s.multiplyToRef(Bh,s),s._updateIdentityStatus(1===o&&1===l&&1===c&&0===h),s}static FromQuaternionToRef(e,t){const i=e._x*e._x,n=e._y*e._y,a=e._z*e._z,s=e._x*e._y,r=e._z*e._w,o=e._z*e._x,l=e._y*e._w,c=e._y*e._z,h=e._x*e._w;return t._m[0]=1-2*(n+a),t._m[1]=2*(s+r),t._m[2]=2*(o-l),t._m[3]=0,t._m[4]=2*(s-r),t._m[5]=1-2*(a+i),t._m[6]=2*(c+h),t._m[7]=0,t._m[8]=2*(o+l),t._m[9]=2*(c-h),t._m[10]=1-2*(n+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated(),t}static RotationY(t){const i=new e;return e.RotationYToRef(t,i),i}static PerspectiveFovReverseLHToRef(t,i,n,a,s,r=!0,o,l=0){const c=1/Math.tan(.5*t),h=r?c/i:c,f=r?c:c*i,u=Math.tan(l);return e.FromValuesToRef(h,0,0,0,0,f,0,u,0,0,-n,1,0,0,1,0,s),o&&s.multiplyToRef(Bh,s),s._updateIdentityStatus(!1),s}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity}subtractFromFloats(...t){return this.subtractFromFloatsToRef(...t,new e)}equals(e){const t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;const i=this.m,n=t.m;return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]}equalsWithEpsilon(e,t=0){const i=this._m,n=e.m;for(let e=0;e<16;e++)if(!fh(i[e],n[e],t))return!1;return!0}transpose(){const t=new e;return e.TransposeToRef(this,t),t}static FromArrayToRef(e,t,i){for(let n=0;n<16;n++)i._m[n]=e[n+t];return i.markAsUpdated(),i}static Transpose(t){const i=new e;return e.TransposeToRef(t,i),i}transposeToRef(t){return e.TransposeToRef(this,t),t}addTranslationFromFloats(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this.markAsUpdated(),this}multiplyByFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e[i];return this.markAsUpdated(),this}setRowFromFloats(e,t,i,n,a){if(e<0||e>3)return this;const s=4*e;return this._m[s+0]=t,this._m[s+1]=i,this._m[s+2]=n,this._m[s+3]=a,this.markAsUpdated(),this}static TranslationToRef(t,i,n,a){return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,i,n,1,a),a._updateIdentityStatus(0===t&&0===i&&0===n),a}static LookAtRHToRef(t,i,n,a){const s=Fh.Vector3[0],r=Fh.Vector3[1],o=Fh.Vector3[2];t.subtractToRef(i,o),o.normalize(),wh.CrossToRef(n,o,s);const l=s.lengthSquared();0===l?s.x=1:s.normalizeFromLength(Math.sqrt(l)),wh.CrossToRef(o,s,r),r.normalize();const c=-wh.Dot(s,t),h=-wh.Dot(r,t),f=-wh.Dot(o,t);return e.FromValuesToRef(s._x,r._x,o._x,0,s._y,r._y,o._y,0,s._z,r._z,o._z,0,c,h,f,1,a),a}decompose(t,i,n,a,s=!0){if(this._isIdentity)return n&&n.setAll(0),t&&t.setAll(1),i&&i.copyFromFloats(0,0,0,1),!0;const r=this._m;if(n&&n.copyFromFloats(r[12],r[13],r[14]),(t=t||Fh.Vector3[0]).x=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),t.y=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),t.z=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),a){const e=(s?a.absoluteScaling.x:a.scaling.x)<0?-1:1,i=(s?a.absoluteScaling.y:a.scaling.y)<0?-1:1,n=(s?a.absoluteScaling.z:a.scaling.z)<0?-1:1;t.x*=e,t.y*=i,t.z*=n}else this.determinant()<=0&&(t.y*=-1);if(0===t._x||0===t._y||0===t._z)return i&&i.copyFromFloats(0,0,0,1),!1;if(i){const n=1/t._x,a=1/t._y,s=1/t._z;e.FromValuesToRef(r[0]*n,r[1]*n,r[2]*n,0,r[4]*a,r[5]*a,r[6]*a,0,r[8]*s,r[9]*s,r[10]*s,0,0,0,0,1,Fh.Matrix[0]),Dh.FromRotationMatrixToRef(Fh.Matrix[0],i)}return!0}static Scaling(t,i,n){const a=new e;return e.ScalingToRef(t,i,n,a),a}fromArray(t,i=0){return e.FromArrayToRef(t,i,this)}static Lerp(t,i,n){const a=new e;return e.LerpToRef(t,i,n,a),a}maximizeInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]=Math.min(t[e],i[e]);return this.markAsUpdated(),this}addInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]+=e[i];return this.markAsUpdated(),this}scaleToRef(e,t){for(let i=0;i<16;i++)t._m[i]=this._m[i]*e;return t.markAsUpdated(),t}minimizeInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]=Math.min(t[e],i[e]);return this.markAsUpdated(),this}floor(){return this.floorToRef(new e)}get m(){return this._m}static RotationZ(t){const i=new e;return e.RotationZToRef(t,i),i}static ObliqueOffCenterRHToRef(t,i,n,a,s,r,o,l,c,h,f){const u=o*Math.cos(l),d=o*Math.sin(l);return e.TranslationToRef(0,0,c,Fh.Matrix[1]),e.FromValuesToRef(1,0,0,0,0,1,0,0,u,d,1,0,0,0,0,1,Fh.Matrix[0]),Fh.Matrix[1].multiplyToRef(Fh.Matrix[0],Fh.Matrix[0]),e.TranslationToRef(0,0,-c,Fh.Matrix[1]),Fh.Matrix[0].multiplyToRef(Fh.Matrix[1],Fh.Matrix[0]),e.OrthoOffCenterRHToRef(t,i,n,a,s,r,h,f),Fh.Matrix[0].multiplyToRef(h,h),h}static PerspectiveLH(t,i,n,a,s,r=0){const o=new e,l=2*n/t,c=2*n/i,h=(a+n)/(a-n),f=-2*a*n/(a-n),u=Math.tan(r);return e.FromValuesToRef(l,0,0,0,0,c,0,u,0,0,h,1,0,0,f,0,o),s&&o.multiplyToRef(Bh,o),o._updateIdentityStatus(!1),o}static LerpToRef(e,t,i,n){const a=n._m,s=e.m,r=t.m;for(let e=0;e<16;e++)a[e]=s[e]*(1-i)+r[e]*i;return n.markAsUpdated(),n}static OrthoOffCenterLH(t,i,n,a,s,r,o){const l=new e;return e.OrthoOffCenterLHToRef(t,i,n,a,s,r,l,o),l}static FromFloat32ArrayToRefScaled(e,t,i,n){return n._m[0]=e[0+t]*i,n._m[1]=e[1+t]*i,n._m[2]=e[2+t]*i,n._m[3]=e[3+t]*i,n._m[4]=e[4+t]*i,n._m[5]=e[5+t]*i,n._m[6]=e[6+t]*i,n._m[7]=e[7+t]*i,n._m[8]=e[8+t]*i,n._m[9]=e[9+t]*i,n._m[10]=e[10+t]*i,n._m[11]=e[11+t]*i,n._m[12]=e[12+t]*i,n._m[13]=e[13+t]*i,n._m[14]=e[14+t]*i,n._m[15]=e[15+t]*i,n.markAsUpdated(),n}addToSelf(e){const t=this._m,i=e.m;return t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[3],t[4]+=i[4],t[5]+=i[5],t[6]+=i[6],t[7]+=i[7],t[8]+=i[8],t[9]+=i[9],t[10]+=i[10],t[11]+=i[11],t[12]+=i[12],t[13]+=i[13],t[14]+=i[14],t[15]+=i[15],this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const e=this._m;return e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated(),this}static RotationAlignToRef(e,t,i,n=!1){const a=wh.Dot(t,e),s=i._m;if(a<-1+hh)s[0]=-1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n?1:-1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n?-1:1,s[11]=0;else{const i=wh.Cross(t,e),n=1/(1+a);s[0]=i._x*i._x*n+a,s[1]=i._y*i._x*n-i._z,s[2]=i._z*i._x*n+i._y,s[3]=0,s[4]=i._x*i._y*n+i._z,s[5]=i._y*i._y*n+a,s[6]=i._z*i._y*n-i._x,s[7]=0,s[8]=i._x*i._z*n-i._y,s[9]=i._y*i._z*n+i._x,s[10]=i._z*i._z*n+a,s[11]=0}return s[12]=0,s[13]=0,s[14]=0,s[15]=1,i.markAsUpdated(),i}clone(){const t=new e;return t.copyFrom(this),t}static Compose(t,i,n){const a=new e;return e.ComposeToRef(t,i,n,a),a}determinant(){if(!0===this._isIdentity)return 1;const e=this._m,t=e[0],i=e[1],n=e[2],a=e[3],s=e[4],r=e[5],o=e[6],l=e[7],c=e[8],h=e[9],f=e[10],u=e[11],d=e[12],m=e[13],p=e[14],_=e[15],v=f*_-p*u,g=h*_-m*u,S=h*p-m*f,y=c*_-d*u,E=c*p-f*d,A=c*m-d*h;return t*+(r*v-o*g+l*S)+i*-(s*v-o*y+l*E)+n*+(s*g-r*y+l*A)+a*-(s*S-r*E+o*A)}subtractInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]-=i[e];return this.markAsUpdated(),this}multiplyToArray(e,t,i){const n=this._m,a=e.m,s=n[0],r=n[1],o=n[2],l=n[3],c=n[4],h=n[5],f=n[6],u=n[7],d=n[8],m=n[9],p=n[10],_=n[11],v=n[12],g=n[13],S=n[14],y=n[15],E=a[0],A=a[1],C=a[2],R=a[3],T=a[4],N=a[5],M=a[6],I=a[7],x=a[8],b=a[9],P=a[10],w=a[11],O=a[12],D=a[13],L=a[14],F=a[15];return t[i]=s*E+r*T+o*x+l*O,t[i+1]=s*A+r*N+o*b+l*D,t[i+2]=s*C+r*M+o*P+l*L,t[i+3]=s*R+r*I+o*w+l*F,t[i+4]=c*E+h*T+f*x+u*O,t[i+5]=c*A+h*N+f*b+u*D,t[i+6]=c*C+h*M+f*P+u*L,t[i+7]=c*R+h*I+f*w+u*F,t[i+8]=d*E+m*T+p*x+_*O,t[i+9]=d*A+m*N+p*b+_*D,t[i+10]=d*C+m*M+p*P+_*L,t[i+11]=d*R+m*I+p*w+_*F,t[i+12]=v*E+g*T+S*x+y*O,t[i+13]=v*A+g*N+S*b+y*D,t[i+14]=v*C+g*M+S*P+y*L,t[i+15]=v*R+g*I+S*w+y*F,this}getRotationMatrix(){const t=new e;return this.getRotationMatrixToRef(t),t}static RotationYawPitchRollToRef(e,t,i,n){return Dh.RotationYawPitchRollToRef(e,t,i,Fh.Ht[0]),Fh.Ht[0].toRotationMatrix(n),n}addAtIndex(e,t){return this._m[e]+=t,this.markAsUpdated(),this}addToRef(e,t){const i=this._m,n=t._m,a=e.m;for(let e=0;e<16;e++)n[e]=i[e]+a[e];return t.markAsUpdated(),t}static LookAtLHToRef(t,i,n,a){const s=Fh.Vector3[0],r=Fh.Vector3[1],o=Fh.Vector3[2];i.subtractToRef(t,o),o.normalize(),wh.CrossToRef(n,o,s);const l=s.lengthSquared();0===l?s.x=1:s.normalizeFromLength(Math.sqrt(l)),wh.CrossToRef(o,s,r),r.normalize();const c=-wh.Dot(s,t),h=-wh.Dot(r,t),f=-wh.Dot(o,t);return e.FromValuesToRef(s._x,r._x,o._x,0,s._y,r._y,o._y,0,s._z,r._z,o._z,0,c,h,f,1,a),a}toNormalMatrix(t){const i=Fh.Matrix[0];this.invertToRef(i),i.transposeToRef(t);const n=t._m;return e.FromValuesToRef(n[0],n[1],n[2],0,n[4],n[5],n[6],0,n[8],n[9],n[10],0,0,0,0,1,t),t}getTranslationToRef(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],e}getRowToRef(e,t){if(e>=0&&e<=3){const i=4*e;t.x=this._m[i+0],t.y=this._m[i+1],t.z=this._m[i+2],t.w=this._m[i+3]}return t}maximizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}static GetFinalMatrix(t,i,n,a,s,r){const o=t.width,l=t.height,c=t.x,h=t.y,f=e.FromValues(o/2,0,0,0,0,-l/2,0,0,0,0,r-s,0,c+o/2,l/2+h,s,1),u=new e;return i.multiplyToRef(n,u),u.multiplyToRef(a,u),u.multiplyToRef(f,u)}multiplyInPlace(e){const t=this._m,i=e.m;for(let e=0;e<16;e++)t[e]*=i[e];return this.markAsUpdated(),this}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}static OrthoOffCenterLHToRef(t,i,n,a,s,r,o,l){const c=2/(i-t),h=2/(a-n),f=2/(r-s),u=-(r+s)/(r-s),d=(t+i)/(t-i),m=(a+n)/(n-a);return e.FromValuesToRef(c,0,0,0,0,h,0,0,0,0,f,0,d,m,u,1,o),l&&o.multiplyToRef(Bh,o),o.markAsUpdated(),o}static LookDirectionRH(t,i){const n=new e;return e.LookDirectionRHToRef(t,i,n),n}static Zero(){const t=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t}negateInPlace(){const e=this._m;for(let t=0;t<16;t++)e[t]=-e[t];return this.markAsUpdated(),this}static TransposeToRef(e,t){const i=e.m,n=i[0],a=i[4],s=i[8],r=i[12],o=i[1],l=i[5],c=i[9],h=i[13],f=i[2],u=i[6],d=i[10],m=i[14],p=i[3],_=i[7],v=i[11],g=i[15],S=t._m;return S[0]=n,S[1]=a,S[2]=s,S[3]=r,S[4]=o,S[5]=l,S[6]=c,S[7]=h,S[8]=f,S[9]=u,S[10]=d,S[11]=m,S[12]=p,S[13]=_,S[14]=v,S[15]=g,t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty),t}static DecomposeLerpToRef(t,i,n,a){const s=Fh.Vector3[0],r=Fh.Ht[0],o=Fh.Vector3[1];t.decompose(s,r,o);const l=Fh.Vector3[2],c=Fh.Ht[1],h=Fh.Vector3[3];i.decompose(l,c,h);const f=Fh.Vector3[4];wh.LerpToRef(s,l,n,f);const u=Fh.Ht[2];Dh.SlerpToRef(r,c,n,u);const d=Fh.Vector3[5];return wh.LerpToRef(o,h,n,d),e.ComposeToRef(f,u,d,a),a}add(t){const i=new e;return this.addToRef(t,i),i}copyFrom(e){e.copyToArray(this._m);const t=e;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this}static PerspectiveFovLH(t,i,n,a,s,r=0,o=!1){const l=new e;return e.PerspectiveFovLHToRef(t,i,n,a,l,!0,s,r,o),l}negate(){return this.negateToRef(new e)}getClassName(){return"Matrix"}setRow(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)}static OrthoOffCenterRH(t,i,n,a,s,r,o){const l=new e;return e.OrthoOffCenterRHToRef(t,i,n,a,s,r,l,o),l}decomposeToTransformNode(e){return e.rotationQuaternion=e.rotationQuaternion||new Dh,this.decompose(e.scaling,e.rotationQuaternion,e.position)}static ObliqueOffCenterLHToRef(t,i,n,a,s,r,o,l,c,h,f){const u=-o*Math.cos(l),d=-o*Math.sin(l);return e.TranslationToRef(0,0,-c,Fh.Matrix[1]),e.FromValuesToRef(1,0,0,0,0,1,0,0,u,d,1,0,0,0,0,1,Fh.Matrix[0]),Fh.Matrix[1].multiplyToRef(Fh.Matrix[0],Fh.Matrix[0]),e.TranslationToRef(0,0,c,Fh.Matrix[1]),Fh.Matrix[0].multiplyToRef(Fh.Matrix[1],Fh.Matrix[0]),e.OrthoOffCenterLHToRef(t,i,n,a,s,r,h,f),Fh.Matrix[0].multiplyToRef(h,h),h}set(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=e[i];return this.markAsUpdated(),this}scaleAndAddToRef(e,t){for(let i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t.markAsUpdated(),t}static PerspectiveFovRHToRef(t,i,n,a,s,r=!0,o,l=0,c=!1){const h=n,f=a,u=1/Math.tan(.5*t),d=r?u/i:u,m=r?u:u*i,p=c&&0===h?1:0!==f?-(f+h)/(f-h):-1,_=c&&0===h?2*f:0!==f?-2*f*h/(f-h):-2*h,v=Math.tan(l);return e.FromValuesToRef(d,0,0,0,0,m,0,v,0,0,p,-1,0,0,_,0,s),o&&s.multiplyToRef(Bh,s),s._updateIdentityStatus(!1),s}getTranslation(){return new wh(this._m[12],this._m[13],this._m[14])}static PerspectiveFovReverseRHToRef(t,i,n,a,s,r=!0,o,l=0){const c=1/Math.tan(.5*t),h=r?c/i:c,f=r?c:c*i,u=Math.tan(l);return e.FromValuesToRef(h,0,0,0,0,f,0,u,0,0,-n,-1,0,0,-1,0,s),o&&s.multiplyToRef(Bh,s),s._updateIdentityStatus(!1),s}static LookAtRH(t,i,n){const a=new e;return e.LookAtRHToRef(t,i,n,a),a}invertToRef(t){if(!0===this._isIdentity)return e.IdentityToRef(t),t;const i=this._m,n=i[0],a=i[1],s=i[2],r=i[3],o=i[4],l=i[5],c=i[6],h=i[7],f=i[8],u=i[9],d=i[10],m=i[11],p=i[12],_=i[13],v=i[14],g=i[15],S=d*g-v*m,y=u*g-_*m,E=u*v-_*d,A=f*g-p*m,C=f*v-d*p,R=f*_-p*u,T=+(l*S-c*y+h*E),N=-(o*S-c*A+h*C),M=+(o*y-l*A+h*R),I=-(o*E-l*C+c*R),x=n*T+a*N+s*M+r*I;if(0===x)return t.copyFrom(this),t;const b=1/x,P=c*g-v*h,w=l*g-_*h,O=l*v-_*c,D=o*g-p*h,L=o*v-p*c,F=o*_-p*l,k=c*m-d*h,B=l*m-u*h,G=l*d-u*c,U=o*m-f*h,H=o*d-f*c,V=o*u-f*l,W=-(a*S-s*y+r*E),z=+(n*S-s*A+r*C),X=-(n*y-a*A+r*R),Y=+(n*E-a*C+s*R),j=+(a*P-s*w+r*O),K=-(n*P-s*D+r*L),$=+(n*w-a*D+r*F),q=-(n*O-a*L+s*F),J=-(a*k-s*B+r*G),Q=+(n*k-s*U+r*H),Z=-(n*B-a*U+r*V),ee=+(n*G-a*H+s*V);return e.FromValuesToRef(T*b,W*b,j*b,J*b,N*b,z*b,K*b,Q*b,M*b,X*b,$*b,Z*b,I*b,Y*b,q*b,ee*b,t),t}_updateIdentityStatus(e,t=!1,i=!1,n=!0){this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&n}static DecomposeLerp(t,i,n){const a=new e;return e.DecomposeLerpToRef(t,i,n,a),a}fract(){return this.fractToRef(new e)}};Lh._UpdateFlagSeed=0,Lh._IdentityReadOnly=Lh.Identity(),Object.defineProperties(Lh.prototype,{dimension:{value:[4,4]},rank:{value:2}});var Fh=class{};Fh.Vector3=ih(11,wh.Zero),Fh.Matrix=ih(2,Lh.Identity),Fh.Ht=ih(3,Dh.Zero);var kh=class{};kh.Vector2=ih(3,Ph.Zero),kh.Vector3=ih(13,wh.Zero),kh.Vector4=ih(3,Oh.Zero),kh.Ht=ih(3,Dh.Zero),kh.Matrix=ih(8,Lh.Identity),rh("BABYLON.Vector2",Ph),rh("BABYLON.Vector3",wh),rh("BABYLON.Vector4",Oh),rh("BABYLON.Matrix",Lh);var Bh=Lh.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1),Gh=function(e,t,i,n={}){const a=e();eh&&eh.HasTags(t)&&eh.AddTagsTo(a,eh.GetTags(t,!0));const s=Bc(a),r={};for(const e in s){const o=s[e],l=t[e],c=o.type;if(null!=l&&("uniqueId"!==e||Uh.AllowLoadingUniqueId))switch(c){case 0:case 6:case 11:a[e]=l;break;case 1:n.cloneTexturesOnlyOnce&&r[l.xt]?a[e]=r[l.xt]:(a[e]=i||l.isRenderTarget?l:l.clone(),r[l.xt]=a[e]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:a[e]=i?l:l.clone()}}return a},Uh=class e{static Instanciate(e,t){return Gh(e,t,!0)}static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let i=0;i<e.animations.length;i++){const n=e.animations[i];t.animations.push(n.serialize())}}}static Clone(e,t,i={}){return Gh(e,t,!1,i)}static ParseProperties(t,i,n,a){a||(a="");const s=Bc(i);for(const r in s){const o=s[r],l=t[o.sourceName||r],c=o.type;if(null!=l&&("uniqueId"!==r||e.AllowLoadingUniqueId)){const t=i;switch(c){case 0:t[r]=l;break;case 1:n&&(t[r]=e._TextureParser(l,n,a));break;case 2:t[r]=Ah.FromArray(l);break;case 3:t[r]=e._FresnelParametersParser(l);break;case 4:t[r]=Ph.FromArray(l);break;case 5:t[r]=wh.FromArray(l);break;case 6:n&&(t[r]=n.getLastMeshById(l));break;case 7:t[r]=e._ColorCurvesParser(l);break;case 8:t[r]=Ch.FromArray(l);break;case 9:t[r]=e._ImageProcessingConfigurationParser(l);break;case 10:t[r]=Dh.FromArray(l);break;case 11:n&&(t[r]=n.getCameraById(l));break;case 12:t[r]=Lh.FromArray(l)}}}}static Parse(t,i,n,a=null){const s=t();return eh&&eh.AddTagsTo(s,i.tags),e.ParseProperties(i,s,n,a),s}static Serialize(t,i){i||(i={}),eh&&(i.tags=eh.GetTags(t));const n=Bc(t);for(const a in n){const s=n[a],r=s.sourceName||a,o=s.type,l=t[a];if(null!=l&&("uniqueId"!==a||e.AllowLoadingUniqueId))switch(o){case 0:i[r]=l;break;case 1:case 3:case 7:case 9:i[r]=l.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:i[r]=l.asArray();break;case 6:case 11:i[r]=l.id}}return i}};Uh.AllowLoadingUniqueId=!1,Uh._ImageProcessingConfigurationParser=e=>{throw Qc("ImageProcessingConfiguration")},Uh._FresnelParametersParser=e=>{throw Qc("FresnelParameters")},Uh._ColorCurvesParser=e=>{throw Qc("ColorCurves")},Uh._TextureParser=(e,t,i)=>{throw Qc("Texture")};var Hh=class{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new Ih,this._onClonedObservable=new Ih}},Vh=class e{get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}static ParseAnimationRanges(e,t,i){if(t.ranges)for(let i=0;i<t.ranges.length;i++){const n=t.ranges[i];e.createAnimationRange(n.name,n.from,n.to)}}_serializeAsParent(e){e.parentId=this.xt}getChildMeshes(e,t){const i=[];return this._getDescendants(i,e,(e=>(!t||t(e))&&void 0!==e.cullingStrategy)),i}_getDescendants(e,t=!1,i){if(this._children)for(let n=0;n<this._children.length;n++){const a=this._children[n];i&&!i(a)||e.push(a),t||a._getDescendants(e,!1,i)}}deleteAnimationRange(e,t=!0){for(let i=0,n=this.animations.length;i<n;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null}get worldMatrixFromCache(){return this._worldMatrix}get parent(){return this._parentNode}_updateCache(e){}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){const i=this.animations[t];if(i.name===e)return i}return null}addBehavior(e,t=!1){return-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((()=>{e.attach(this)})):e.attach(this),this._behaviors.push(e)),this}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}getHierarchyBoundingVectors(e=!0,t=null){let i,n;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const a=this;if(a.getBoundingInfo&&a.subMeshes){const e=a.getBoundingInfo();i=e.boundingBox.minimumWorld.clone(),n=e.boundingBox.maximumWorld.clone()}else i=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new wh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const e=this.getDescendants(!1);for(const a of e){const e=a;if(e.computeWorldMatrix(!0),t&&!t(e))continue;if(!e.getBoundingInfo||0===e.getTotalVertices())continue;const s=e.getBoundingInfo().boundingBox,r=s.minimumWorld,o=s.maximumWorld;wh.CheckExtends(r,i,n),wh.CheckExtends(o,i,n)}}return{min:i,max:n}}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}isDisposed(){return this._nodeDataStorage._isDisposed}_initCache(){this._cache={}}getAnimationRange(e){return this._ranges[e]||null}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}serializeAnimationRanges(){const e=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const n={};n.name=t,n.from=i.from,n.to=i.to,e.push(n)}return e}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}static Construct(e,t,i,n){const a=this._NodeConstructors[e];return a?a(t,i,n):null}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}createAnimationRange(t,i,n){if(!this._ranges[t]){this._ranges[t]=e._AnimationRangeFactory(t,i,n);for(let e=0,a=this.animations.length;e<a;e++)this.animations[e]&&this.animations[e].createRange(t,i,n)}}_isSynchronized(){return!0}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}_getActionManagerForTrigger(e,t=!0){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}removeBehavior(e){const t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}isDescendantOf(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}isReady(e=!1){return this._nodeDataStorage._isReady}get behaviors(){return this._behaviors}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}getDescendants(e,t){const i=[];return this._getDescendants(i,e,t),i}isEnabled(e=!0){return!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}getEngine(){return this._scene.getEngine()}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}getScene(){return this._scene}static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}get accessibilityTag(){return this._accessibilityTag}clone(t,i,n){const a=Uh.Clone((()=>new e(t,this.getScene())),this);if(i&&(a.parent=i),!n){const e=this.getDescendants(!0);for(let i=0;i<e.length;i++){const n=e[i];n.clone(t+"."+n.name,a)}}return a}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}getChildren(e,t=!0){return this.getDescendants(t,e)}set parent(e){if(this._parentNode===e)return;const t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((e=>{e._syncParentEnabledState()}))}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=Lh.Identity()),this._worldMatrix}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}dispose(e,t=!1){if(this._nodeDataStorage._isDisposed=!0,!e){const i=this.getDescendants(!0);for(const n of i)n.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const e of this._behaviors)e.detach();this._behaviors.length=0,this.metadata=null}updateCache(e){!e&&this.isSynchronized()||this._updateCache()}_setReady(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}constructor(e,t=null,i=!0){this._isDirty=!1,this._nodeDataStorage=new Hh,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new Ih,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=Lh.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new Ih,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||xh.LastCreatedScene,this.xt=this._scene.getUniqueId(),this._initCache(),i&&this._addToSceneRootNodes()}getClassName(){return"Node"}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}beginAnimation(e,t,i,n){const a=this.getAnimationRange(e);return a?this._scene.beginAnimation(this,a.from,a.to,t,i,n):null}};Vh._AnimationRangeFactory=(e,t,i)=>{throw Qc("AnimationRange")},Vh._NodeConstructors={},Lc([Hc()],Vh.prototype,"name",void 0),Lc([Hc()],Vh.prototype,"id",void 0),Lc([Hc()],Vh.prototype,"uniqueId",void 0),Lc([Hc()],Vh.prototype,"state",void 0),Lc([Hc()],Vh.prototype,"metadata",void 0);var Wh,zh=Lh.Compose(wh.One(),Dh.FromEulerAngles(0,Math.PI,0),wh.Zero()),Xh=class e extends Vh{get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}getPivotMatrix(){return this._pivotMatrix}get right(){return wh.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}freezeWorldMatrix(e=null,t=!1){return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||Dh.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}getPivotPoint(){const e=wh.Zero();return this.getPivotPointToRef(e),e}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}set scaling(e){this._scaling=e,this._isDirty=!0}getPositionInCameraSpace(e=null){return e||(e=this.getScene().activeCamera),wh.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}get rotationQuaternion(){return this._rotationQuaternion}getDirection(e){const t=wh.Zero();return this.getDirectionToRef(e,t),t}set rotation(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0}unregisterAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}registerAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}instantiateHierarchy(e=null,t,i){const n=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);n&&i&&i(this,n);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(n,t,i);return n}_isSynchronized(){const t=this._cache;return this._billboardMode===t.billboardMode&&this._billboardMode===e.BILLBOARDMODE_NONE&&(!t.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}isUsingPivotMatrix(){return this._usePivotMatrix}setAbsolutePosition(e){if(!e)return this;let t,i,n;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],i=arguments[1],n=arguments[2]}else t=e.x,i=e.y,n=e.z;if(this.parent){const e=kh.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),wh.TransformCoordinatesFromFloatsToRef(t,i,n,e,this.position)}else this.position.x=t,this.position.y=i,this.position.z=n;return this._absolutePosition.copyFrom(e),this}getDirectionToRef(e,t){return wh.TransformNormalToRef(e,this.getWorldMatrix(),t),this}getPivotPointToRef(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==e.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}setPreTransformMatrix(e){return this.setPivotMatrix(e,!1)}set infiniteDistance(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}markAsDirty(e){if(this._isDirty)return this;if(this._children)for(const t of this._children)t.markAsDirty(e);return super.markAsDirty(e)}get billboardMode(){return this._billboardMode}dispose(e,t=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const e=this._parentContainer.transformNodes.indexOf(this);e>-1&&this._parentContainer.transformNodes.splice(e,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){const e=this.getChildTransformNodes(!0);for(const t of e)t.parent=null,t.computeWorldMatrix(!0)}super.dispose(e,t)}addRotation(e,t,i){let n;this.rotationQuaternion?n=this.rotationQuaternion:(n=kh.Ht[1],Dh.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,n));const a=kh.Ht[0];return Dh.RotationYawPitchRollToRef(t,e,i,a),n.multiplyInPlace(a),this.rotationQuaternion||n.toEulerAnglesToRef(this.rotation),this}getAbsolutePivotPointToRef(e){return this.getPivotPointToRef(e),wh.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}setPositionWithLocalVector(e){return this.computeWorldMatrix(),this.position=wh.TransformNormal(e,this._localMatrix),this}resetLocalMatrix(e=!0){if(this.computeWorldMatrix(),e){const e=this.getChildren();for(let t=0;t<e.length;++t){const i=e[t];if(i){i.computeWorldMatrix();const e=kh.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,e);const t=kh.Ht[0];e.decompose(i.scaling,t,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(i.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=Dh.Identity()),this._worldMatrix=Lh.Identity()}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const e=kh.Matrix[0];return this._localMatrix.invertToRef(e),wh.TransformNormal(this.position,e)}removeChild(e,t=!1){return e.setParent(null,t),this}get absolutePosition(){return this.getAbsolutePosition()}setDirection(e,t=0,i=0,n=0){const a=-Math.atan2(e.z,e.x)+Math.PI/2,s=Math.sqrt(e.x*e.x+e.z*e.z),r=-Math.atan2(e.y,s);return this.rotationQuaternion?Dh.RotationYawPitchRollToRef(a+t,r+i,n,this.rotationQuaternion):(this.rotation.x=r+i,this.rotation.y=a+t,this.rotation.z=n),this}setPivotPoint(e,t=0){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);const i=this.getWorldMatrix();if(1==t){const t=kh.Matrix[0];i.invertToRef(t),e=wh.TransformCoordinates(e,t)}return this.setPivotMatrix(Lh.Translation(-e.x,-e.y,-e.z),!0)}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}getClassName(){return"TransformNode"}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._cache.useBillboardPosition=0!=(this._billboardMode&e.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}serialize(e){const t=Uh.Serialize(this,e);return t.type=this.getClassName(),t.xt=this.xt,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),Uh.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t}get scaling(){return this._scaling}set preserveParentRotationForBillboard(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e,this._computeUseBillboardPath())}getAbsolutePivotPoint(){const e=wh.Zero();return this.getAbsolutePivotPointToRef(e),e}detachFromBone(e=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}setPivotMatrix(e,t=!0){return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=Lh.Invert(this._pivotMatrix)),this}_afterComputeWorldMatrix(){}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=Lh.Identity()),this._poseMatrix}static Parse(t,i,n){const a=Uh.Parse((()=>new e(t.name,i)),t,i,n);if(t.localMatrix?a.setPreTransformMatrix(Lh.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(Lh.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),a._waitingParsedUniqueId=t.xt,void 0!==t.parentId&&(a._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(a._waitingParentInstanceIndex=t.parentInstanceIndex),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],n=oh("BABYLON.Animation");n&&a.animations.push(n.Parse(i))}Vh.ParseAnimationRanges(a,t,i)}return t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),a}locallyTranslate(e){return this.computeWorldMatrix(!0),this.position=wh.TransformCoordinates(e,this._localMatrix),this}clone(t,i,n){const a=Uh.Clone((()=>new e(t,this.getScene())),this);if(a.name=t,a.id=t,i&&(a.parent=i),!n){const e=this.getDescendants(!0);for(let i=0;i<e.length;i++){const n=e[i];n.clone&&n.clone(t+"."+n.name,a)}}return a}set rotationQuaternion(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0}rotateAround(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=Dh.lt(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const n=kh.Vector3[0],a=kh.Vector3[1],s=kh.Vector3[2],r=kh.Ht[0],o=kh.Matrix[0],l=kh.Matrix[1],c=kh.Matrix[2],h=kh.Matrix[3];return e.subtractToRef(this.position,n),Lh.TranslationToRef(n.x,n.y,n.z,o),Lh.TranslationToRef(-n.x,-n.y,-n.z,l),Lh.RotationAxisToRef(t,i,c),l.multiplyToRef(c,h),h.multiplyToRef(o,h),h.decompose(a,r,s),this.position.addInPlace(s),r.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}_updateNonUniformScalingState(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)}updatePoseMatrix(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}computeWorldMatrix(t=!1,i=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const n=this.getScene().getRenderId();if(!this._isDirty&&!t&&(this._currentRenderId===n||this.isSynchronized()))return this._currentRenderId=n,this._worldMatrix;i=i||this.getScene().activeCamera,this._updateCache();const a=this._cache;a.pivotMatrixUpdated=!1,a.billboardMode=this.billboardMode,a.infiniteDistance=this.infiniteDistance,a.parent=this._parentNode,this._currentRenderId=n,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const s=this._getEffectiveParent(),r=e._TmpScaling;let o,l=this._position;if(this._infiniteDistance&&!this.parent&&i){const t=i.getWorldMatrix(),n=new wh(t.m[12],t.m[13],t.m[14]);l=e._TmpTranslation,l.copyFromFloats(this._position.x+n.x,this._position.y+n.y,this._position.z+n.z)}if(r.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,o=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(Dh.lt(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else o=e._TmpRotation,Dh.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,o);if(this._usePivotMatrix){const e=kh.Matrix[1];Lh.ScalingToRef(r.x,r.y,r.z,e);const t=kh.Matrix[0];o.toRotationMatrix(t),this._pivotMatrix.multiplyToRef(e,kh.Matrix[4]),kh.Matrix[4].multiplyToRef(t,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(l.x,l.y,l.z)}else Lh.ComposeToRef(r,o,l,this._localMatrix);if(s&&s.getWorldMatrix){if(t&&s.computeWorldMatrix(t),a.useBillboardPath){if(this._transformToBoneReferal){const e=this.parent;e.getSkeleton().prepare(),e.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),kh.Matrix[7])}else kh.Matrix[7].copyFrom(s.getWorldMatrix());const t=kh.Vector3[5],i=kh.Vector3[6],n=kh.Ht[0];kh.Matrix[7].decompose(i,n,t),Lh.ScalingToRef(i.x,i.y,i.z,kh.Matrix[7]),kh.Matrix[7].setTranslation(t),e.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(n,t),this._localMatrix.setTranslation(t)),this._localMatrix.multiplyToRef(kh.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const e=this.parent;e.getSkeleton().prepare(),this._localMatrix.multiplyToRef(e.getFinalMatrix(),kh.Matrix[6]),kh.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(s.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(a.useBillboardPath&&i&&this.billboardMode&&!a.useBillboardPosition){const t=kh.Vector3[0];if(this._worldMatrix.getTranslationToRef(t),kh.Matrix[1].copyFrom(i.getViewMatrix()),this._scene.useRightHandedSystem&&kh.Matrix[1].multiplyToRef(zh,kh.Matrix[1]),kh.Matrix[1].setTranslationFromFloats(0,0,0),kh.Matrix[1].invertToRef(kh.Matrix[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){kh.Matrix[0].decompose(void 0,kh.Ht[0],void 0);const t=kh.Vector3[1];kh.Ht[0].toEulerAnglesToRef(t),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(t.z=0),Lh.RotationYawPitchRollToRef(t.y,t.x,t.z,kh.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(kh.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(kh.Vector3[0])}else if(a.useBillboardPath&&i&&a.useBillboardPosition){const t=kh.Vector3[0];this._worldMatrix.getTranslationToRef(t);const n=i.globalPosition;this._worldMatrix.invertToRef(kh.Matrix[1]);const a=kh.Vector3[1];wh.TransformCoordinatesToRef(n,kh.Matrix[1],a),a.normalize();const s=-Math.atan2(a.z,a.x)+Math.PI/2,r=Math.sqrt(a.x*a.x+a.z*a.z),o=-Math.atan2(a.y,r);if(Dh.RotationYawPitchRollToRef(s,o,0,kh.Ht[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){const t=kh.Vector3[1];kh.Ht[0].toEulerAnglesToRef(t),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(t.z=0),Lh.RotationYawPitchRollToRef(t.y,t.x,t.z,kh.Matrix[0])}else Lh.FromQuaternionToRef(kh.Ht[0],kh.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(kh.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(kh.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):s&&s._nonUniformScaling?this._updateNonUniformScalingState(s._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=Lh.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}get position(){return this._position}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}lookAt(t,i=0,n=0,a=0,s=0){const r=e._LookAtVectorCache,o=0===s?this.position:this.getAbsolutePosition();if(t.subtractToRef(o,r),this.setDirection(r,i,n,a),1===s&&this.parent)if(this.rotationQuaternion){const e=kh.Matrix[0];this.rotationQuaternion.toRotationMatrix(e);const t=kh.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.invert(),e.multiplyToRef(t,e),this.rotationQuaternion.fromRotationMatrix(e)}else{const e=kh.Ht[0];Dh.FromEulerVectorToRef(this.rotation,e);const t=kh.Matrix[0];e.toRotationMatrix(t);const i=kh.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.invert(),t.multiplyToRef(i,t),e.fromRotationMatrix(t),e.toEulerAnglesToRef(this.rotation)}return this}get up(){return wh.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}attachToBone(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(!0),e.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}get rotation(){return this._rotation}setParent(t,i=!1,n=!1){if(!t&&!this.parent)return this;const a=kh.Ht[0],s=kh.Vector3[0],r=kh.Vector3[1],o=kh.Matrix[1];Lh.IdentityToRef(o);const l=kh.Matrix[0];this.computeWorldMatrix(!0);let c=this.rotationQuaternion;return c||(c=e._TmpRotation,Dh.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,c)),Lh.ComposeToRef(this.scaling,c,this.position,l),this.parent&&l.multiplyToRef(this.parent.computeWorldMatrix(!0),l),t&&(t.computeWorldMatrix(!0).invertToRef(o),l.multiplyToRef(o,l)),l.decompose(r,a,s,i?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(r),this.position.copyFrom(s),this.parent=t,n&&this.setPivotMatrix(Lh.Identity()),this}translate(e,t,i){const n=e.scale(t);if(i&&0!==i)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{const e=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(e)}return this}_initCache(){super._initCache();const e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1,e.useBillboardPosition=!1,e.useBillboardPath=!1}constructor(t,i=null,n=!0){super(t,i,!1),this._forward=new wh(0,0,1),this._up=new wh(0,1,0),this._right=new wh(1,0,0),this._position=wh.Zero(),this._rotation=wh.Zero(),this._rotationQuaternion=null,this._scaling=wh.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=e.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=Lh.Zero(),this._usePivotMatrix=!1,this._absolutePosition=wh.Zero(),this._absoluteScaling=wh.Zero(),this._absoluteRotationQuaternion=Dh.Identity(),this._pivotMatrix=Lh.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new Ih,this._nonUniformScaling=!1,n&&this.getScene().addTransformNode(this)}rotate(t,i,n){let a;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),n&&0!==n){if(this.parent){const e=this.parent.getWorldMatrix(),n=kh.Matrix[0];e.invertToRef(n),t=wh.TransformNormal(t,n),e.determinant()<0&&(i*=-1)}a=Dh.RotationAxisToRef(t,i,e._RotationAxisCache),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else a=Dh.RotationAxisToRef(t,i,e._RotationAxisCache),this.rotationQuaternion.multiplyToRef(a,this.rotationQuaternion);return this}addChild(e,t=!1){return e.setParent(this,t),this}get infiniteDistance(){return this._infiniteDistance}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==e.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get forward(){return wh.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}_getEffectiveParent(){return this.parent}normalizeToUnitCube(e=!0,t=!1,i){let n=null,a=null;t&&(this.rotationQuaternion?(a=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(n=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const s=this.getHierarchyBoundingVectors(e,i),r=s.max.subtract(s.min),o=Math.max(r.x,r.y,r.z);if(0===o)return this;const l=1/o;return this.scaling.scaleInPlace(l),t&&(this.rotationQuaternion&&a?this.rotationQuaternion.copyFrom(a):this.rotation&&n&&this.rotation.copyFrom(n)),this}getChildTransformNodes(t,i){const n=[];return this._getDescendants(n,t,(t=>(!i||i(t))&&t instanceof e)),n}getDistanceToCamera(e=null){return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}set position(e){this._position=e,this._isDirty=!0}get nonUniformScaling(){return this._nonUniformScaling}};Xh.BILLBOARDMODE_NONE=0,Xh.BILLBOARDMODE_X=1,Xh.BILLBOARDMODE_Y=2,Xh.BILLBOARDMODE_Z=4,Xh.BILLBOARDMODE_ALL=7,Xh.BILLBOARDMODE_USE_POSITION=128,Xh.BillboardUseParentOrientation=!1,Xh._TmpRotation=Dh.Zero(),Xh._TmpScaling=wh.Zero(),Xh._TmpTranslation=wh.Zero(),Xh._LookAtVectorCache=new wh(0,0,0),Xh._RotationAxisCache=new Dh,Lc([Yc("position")],Xh.prototype,"_position",void 0),Lc([Yc("rotation")],Xh.prototype,"_rotation",void 0),Lc([(Wh="rotationQuaternion",Gc(10,Wh))],Xh.prototype,"_rotationQuaternion",void 0),Lc([Yc("scaling")],Xh.prototype,"_scaling",void 0),Lc([Hc("billboardMode")],Xh.prototype,"_billboardMode",void 0),Lc([Hc()],Xh.prototype,"scalingDeterminant",void 0),Lc([Hc("infiniteDistance")],Xh.prototype,"_infiniteDistance",void 0),Lc([Hc()],Xh.prototype,"ignoreNonUniformScaling",void 0),Lc([Hc()],Xh.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);var Yh=class e{constructor(){this.references=0,this.St=0,this.is32Bits=!1,this.xt=e._Counter++}get underlyingResource(){return null}};Yh._Counter=0;var jh=class e{static _GenerateLimitMessage(t,i=1){const n=e._LogLimitOutputs[t];if(!n||!e.MessageLimitReached)return;const a=this._Levels[i];n.current===n.limit&&e[a.name](e.MessageLimitReached.replace(/%LIMIT%/g,""+n.limit).replace(/%TYPE%/g,a.name??""))}static get LogCache(){return e._LogCache}static _LogDisabled(e,t){}static _FormatMessage(e){const t=e=>e<10?"0"+e:""+e,i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e}static _AddLogEntry(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)}static _CheckLimit(t,i){let n=e._LogLimitOutputs[t];return n?n.current++:(n={limit:i,current:1},e._LogLimitOutputs[t]=n),n.current<=n.limit}static _LogEnabled(t=1,i,n){const a=Array.isArray(i)?i[0]:i;if(void 0!==n&&!e._CheckLimit(a,n))return;const s=e._FormatMessage(a),r=this._Levels[t],o=Array.isArray(i)?i.slice(1):[];r.logFunc&&r.logFunc("BJS - "+s,...o);const l=`<div style='color:${r.color}'>${s}</div><br>`;e._AddLogEntry(l),e._GenerateLimitMessage(a,t)}static ClearLogCache(){e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0}static set LogLevels(t){e.Log=e._LogDisabled,e.Warn=e._LogDisabled,e.Error=e._LogDisabled,[e.MessageLogLevel,e.WarningLogLevel,e.ErrorLogLevel].forEach((i=>{if((t&i)===i){const t=this._Levels[i];e[t.name]=e._LogEnabled.bind(e,i)}}))}};jh.NoneLogLevel=0,jh.MessageLogLevel=1,jh.WarningLogLevel=2,jh.ErrorLogLevel=4,jh.AllLogLevel=7,jh.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",jh._LogCache="",jh._LogLimitOutputs={},jh._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],jh.errorsCount=0,jh.Log=jh._LogEnabled.bind(jh,jh.MessageLogLevel),jh.Warn=jh._LogEnabled.bind(jh,jh.WarningLogLevel),jh.Error=jh._LogEnabled.bind(jh,jh.ErrorLogLevel);var Kh=class{updateDirectly(e,t,i,n=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,n?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===t&&void 0===i?e:null)}constructor(e,t,i,n=0,a=!1,s=!1,r=!1,o,l){this._isAlreadyOwned=!1,this._isDisposed=!1,e&&e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=s,this._divisor=o||1,this._label=l,t instanceof Yh?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=r?n:n*Float32Array.BYTES_PER_ELEMENT,a||this.create()}create(e=null){!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e,this._label),this._data=e):this._buffer=this._engine.createVertexBuffer(e,void 0,this._label))}isUpdatable(){return this._updatable}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.St>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.St,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.St,void 0,this._label));jh.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.xt+")":""}. Buffer reconstruction failed.`),this._buffer=null}}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}getData(){return this._data}createVertexBuffer(e,t,i,n,a,s=!1,r){const o=s?t:t*Float32Array.BYTES_PER_ELEMENT,l=n?s?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new $h(this._engine,this,e,this._updatable,!0,l,void 0===a?this._instanced:a,o,i,void 0,void 0,!0,this._divisor||r)}get isDisposed(){return this._isDisposed}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}update(e){this.create(e)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}getBuffer(){return this._buffer}},$h=class e{constructor(t,i,n,a,s,r,o,l,c,h,f=!1,u=!1,d=1,m=!1){this._isDisposed=!1;let p=!1;if(this.engine=t,"object"==typeof a&&null!==a?(p=a.updatable??!1,s=a.postponeInternalCreation,r=a.stride,o=a.instanced,l=a.offset,c=a.size,h=a.type,f=a.normalized??!1,u=a.useBytes??!1,d=a.divisor??1,m=a.takeBufferOwnership??!1,this._label=a.label):p=!!a,i instanceof Kh?(this._buffer=i,this._ownsBuffer=m):(this._buffer=new Kh(t,i,p,r,s,o,u,d,this._label),this._ownsBuffer=!0),this.xt=e._Counter++,this._kind=n,void 0===h){const t=this.getData();this.type=t?e.GetDataType(t):e.FLOAT}else this.type=h;const _=e.GetTypeByteLength(this.type);u?(this._size=c||(r?r/_:e.DeduceStride(n)),this.byteStride=r||this._buffer.byteStride||this._size*_,this.byteOffset=l||0):(this._size=c||r||e.DeduceStride(n),this.byteStride=r?r*_:this._buffer.byteStride||this._size*_,this.byteOffset=(l||0)*_),this.normalized=f,this._instanced=void 0!==o&&o,this._instanceDivisor=o?d:0,this._alignBuffer(),this._computeHashCode()}isUpdatable(){return this._buffer.isUpdatable()}getInstanceDivisor(){return this._instanceDivisor}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}static ForEach(t,i,n,a,s,r,o,l){if(t instanceof Array){let e=i/4;const s=n/4;for(let i=0;i<r;i+=a){for(let n=0;n<a;n++)l(t[e+n],i+n);e+=s}}else{const c=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),h=e.GetTypeByteLength(s);for(let t=0;t<r;t+=a){let r=i;for(let i=0;i<a;i++){l(e._GetFloatValue(c,s,r,o),t+i),r+=h}i+=n}}}static GetDataType(t){return t instanceof Int8Array?e.BYTE:t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int16Array?e.SHORT:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int32Array?e.INT:t instanceof Uint32Array?e.UNSIGNED_INT:e.FLOAT}updateDirectly(e,t,i=!1){this._buffer.updateDirectly(e,t,void 0,i),this._alignBuffer()}forEach(t,i){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,i)}set instanceDivisor(e){const t=0!=e;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}getStrideSize(){return this.byteStride/e.GetTypeByteLength(this.type)}getBuffer(){return this._buffer.getBuffer()}update(e){this._buffer.update(e),this._alignBuffer()}getFloatData(t,i){const n=this.getData();return n?e.GetFloatData(n,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,i):null}getIsInstanced(){return this._instanced}getSize(t=!1){return t?this._size*e.GetTypeByteLength(this.type):this._size}get instanceDivisor(){return this._instanceDivisor}_alignBuffer(){}_rebuild(){this._buffer?._rebuild()}get _maxVerticesCount(){const e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}getOffset(){return this.byteOffset/e.GetTypeByteLength(this.type)}getData(){return this._buffer.getData()}getKind(){return this._kind}getWrapperBuffer(){return this._buffer}create(e){this._buffer.create(e),this._alignBuffer()}static _GetFloatValue(t,i,n,a){switch(i){case e.BYTE:{let e=t.getInt8(n);return a&&(e=Math.max(e/127,-1)),e}case e.UNSIGNED_BYTE:{let e=t.getUint8(n);return a&&(e/=255),e}case e.SHORT:{let e=t.getInt16(n,!0);return a&&(e=Math.max(e/32767,-1)),e}case e.UNSIGNED_SHORT:{let e=t.getUint16(n,!0);return a&&(e/=65535),e}case e.INT:return t.getInt32(n,!0);case e.UNSIGNED_INT:return t.getUint32(n,!0);case e.FLOAT:return t.getFloat32(n,!0);default:throw new Error(`Invalid component type ${i}`)}}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}static GetTypeByteLength(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error(`Invalid type '${t}'`)}}get isDisposed(){return this._isDisposed}static DeduceStride(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.ColorInstanceKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static GetFloatData(t,i,n,a,s,r,o,l){const c=i*e.GetTypeByteLength(n),h=o*i;if(n!==e.FLOAT||s!==c){const o=new Float32Array(h);return e.ForEach(t,a,s,i,n,h,r,((e,t)=>o[t]=e)),o}if(!(t instanceof Array||t instanceof Float32Array)||0!==a||t.length!==h){if(t instanceof Array){const e=a/4;return t.slice(e,e+h)}if(t instanceof ArrayBuffer)return new Float32Array(t,a,h);{const e=t.byteOffset+a;if(0!=(3&e)&&(jh.Warn("Float array must be aligned to 4-bytes border"),l=!0),l){const i=new Uint8Array(h*Float32Array.BYTES_PER_ELEMENT),n=new Uint8Array(t.buffer,e,i.length);return i.set(n),new Float32Array(i.buffer)}return new Float32Array(t.buffer,e,h)}}return l?t.slice():t}};function qh(e,t,i){try{const n=e.next();n.done?t(n):n.value?n.value.then((()=>{n.value=void 0,t(n)}),i):t(n)}catch(e){i(e)}}function Jh(e,t,i,n,a){const s=()=>{let r;const o=e=>{e.done?i(e.value):void 0===r?r=!0:s()};do{r=void 0,a&&a.aborted?n(new Error("Aborted")):t(e,o,n),void 0===r&&(r=!1)}while(r)};s()}function Qh(e,t){let i;return Jh(e,qh,(e=>i=e),(e=>{throw e}),t),i}$h._Counter=0,$h.BYTE=5120,$h.UNSIGNED_BYTE=5121,$h.SHORT=5122,$h.UNSIGNED_SHORT=5123,$h.INT=5124,$h.UNSIGNED_INT=5125,$h.FLOAT=5126,$h.PositionKind="position",$h.NormalKind="normal",$h.TangentKind="tangent",$h.UVKind="uv",$h.UV2Kind="uv2",$h.UV3Kind="uv3",$h.UV4Kind="uv4",$h.UV5Kind="uv5",$h.UV6Kind="uv6",$h.ColorKind="color",$h.ColorInstanceKind="instanceColor",$h.MatricesIndicesKind="matricesIndices",$h.MatricesWeightsKind="matricesWeights",$h.MatricesIndicesExtraKind="matricesIndicesExtra",$h.MatricesWeightsExtraKind="matricesWeightsExtra";var Zh=class extends Error{};Zh._setPrototypeOf=Object.setPrototypeOf||((e,t)=>(e.__proto__=t,e));var ef={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},tf=class e extends Zh{constructor(t,i,n){super(t),this.errorCode=i,this.innerError=n,this.name="RuntimeError",Zh._setPrototypeOf(this,e.prototype)}},nf=class{constructor(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}},af=class e{scale(t){const i=e._TmpVector3,n=this.maximum.subtractToRef(this.minimum,i[0]),a=n.length();n.normalizeFromLength(a);const s=a*t,r=n.scaleInPlace(.5*s),o=this.center.subtractToRef(r,i[1]),l=this.center.addToRef(r,i[2]);return this.reConstruct(o,l,this._worldMatrix),this}constructor(e,t,i){this.vectors=th(8,wh.Zero),this.center=wh.Zero(),this.centerWorld=wh.Zero(),this.extendSize=wh.Zero(),this.extendSizeWorld=wh.Zero(),this.directions=th(3,wh.Zero),this.vectorsWorld=th(8,wh.Zero),this.minimumWorld=wh.Zero(),this.maximumWorld=wh.Zero(),this.minimum=wh.Zero(),this.maximum=wh.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,i)}isInFrustum(t){return e.IsInFrustum(this.vectorsWorld,t)}reConstruct(e,t,i){const n=e.x,a=e.y,s=e.z,r=t.x,o=t.y,l=t.z,c=this.vectors;this.minimum.copyFromFloats(n,a,s),this.maximum.copyFromFloats(r,o,l),c[0].copyFromFloats(n,a,s),c[1].copyFromFloats(r,o,l),c[2].copyFromFloats(r,a,s),c[3].copyFromFloats(n,o,s),c[4].copyFromFloats(n,a,l),c[5].copyFromFloats(r,o,s),c[6].copyFromFloats(n,o,l),c[7].copyFromFloats(r,a,l),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||Lh.IdentityReadOnly,this._update(this._worldMatrix)}_update(e){const t=this.minimumWorld,i=this.maximumWorld,n=this.directions,a=this.vectorsWorld,s=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let e=0;e<8;++e)a[e].copyFrom(s[e]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let n=0;n<8;++n){const r=a[n];wh.TransformCoordinatesToRef(s[n],e,r),t.minimizeInPlace(r),i.maximizeInPlace(r)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}wh.FromArrayToRef(e.m,0,n[0]),wh.FromArrayToRef(e.m,4,n[1]),wh.FromArrayToRef(e.m,8,n[2]),this._worldMatrix=e}static Intersects(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}getWorldMatrix(){return this._worldMatrix}static IsCompletelyInFrustum(e,t){for(let i=0;i<6;++i){const n=t[i];for(let t=0;t<8;++t)if(n.dotCoordinate(e[t])<0)return!1}return!0}static IntersectsSphere(t,i,n,a){const s=e._TmpVector3[0];wh.ClampToRef(n,t,i,s);return wh.DistanceSquared(n,s)<=a*a}isCompletelyInFrustum(t){return e.IsCompletelyInFrustum(this.vectorsWorld,t)}intersectsMinMax(e,t){const i=this.minimumWorld,n=this.maximumWorld,a=i.x,s=i.y,r=i.z,o=n.x,l=n.y,c=n.z,h=e.x,f=e.y,u=e.z,d=t.x,m=t.y,p=t.z;return!(o<h||a>d)&&(!(l<f||s>m)&&!(c<u||r>p))}intersectsSphere(t){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}dispose(){this._drawWrapperFront?.dispose(),this._drawWrapperBack?.dispose()}static IsInFrustum(e,t){for(let i=0;i<6;++i){let n=!0;const a=t[i];for(let t=0;t<8;++t)if(a.dotCoordinate(e[t])>=0){n=!1;break}if(n)return!1}return!0}intersectsPoint(e){const t=this.minimumWorld,i=this.maximumWorld,n=t.x,a=t.y,s=t.z,r=i.x,o=i.y,l=i.z,c=e.x,h=e.y,f=e.z,u=-hh;return!(r-c<u||u>c-n)&&(!(o-h<u||u>h-a)&&!(l-f<u||u>f-s))}};af._TmpVector3=th(3,wh.Zero);var sf=class e{reConstruct(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);const n=wh.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*n,this._update(i||Lh.IdentityReadOnly)}constructor(e,t,i){this.center=wh.Zero(),this.centerWorld=wh.Zero(),this.minimum=wh.Zero(),this.maximum=wh.Zero(),this.reConstruct(e,t,i)}isCenterInFrustum(e){const t=this.centerWorld;for(let i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0}intersectsPoint(e){const t=wh.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}static CreateFromCenterAndRadius(t,i,n){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,i),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const a=new e(this._TmpVector3[0],this._TmpVector3[2]);return a._worldMatrix=n||Lh.Identity(),a}scale(t){const i=this.radius*t,n=e._TmpVector3,a=n[0].setAll(i),s=this.center.subtractToRef(a,n[1]),r=this.center.addToRef(a,n[2]);return this.reConstruct(s,r,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}isInFrustum(e){const t=this.centerWorld,i=this.radiusWorld;for(let n=0;n<6;n++)if(e[n].dotCoordinate(t)<=-i)return!1;return!0}static Intersects(e,t){const i=wh.DistanceSquared(e.centerWorld,t.centerWorld),n=e.radiusWorld+t.radiusWorld;return!(n*n<i)}_update(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{wh.TransformCoordinatesToRef(this.center,t,this.centerWorld);const i=e._TmpVector3[0];wh.TransformNormalFromFloatsToRef(1,1,1,t,i),this.radiusWorld=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z))*this.radius}}};sf._TmpVector3=th(3,wh.Zero);var rf={min:0,max:0},of={min:0,max:0},lf=(e,t,i)=>{const n=wh.Dot(t.centerWorld,e),a=Math.abs(wh.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(wh.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(wh.Dot(t.directions[2],e))*t.extendSize.z;i.min=n-a,i.max=n+a},cf=(e,t,i)=>(lf(e,t,rf),lf(e,i,of),!(rf.min>of.max||of.min>rf.max)),hf=class e{constructor(e,t,i){this._isLocked=!1,this.boundingBox=new af(e,t,i),this.boundingSphere=new sf(e,t,i)}get minimum(){return this.boundingBox.minimum}intersects(e,t){if(!sf.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!af.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;const i=this.boundingBox,n=e.boundingBox;return!!cf(i.directions[0],i,n)&&(!!cf(i.directions[1],i,n)&&(!!cf(i.directions[2],i,n)&&(!!cf(n.directions[0],i,n)&&(!!cf(n.directions[1],i,n)&&(!!cf(n.directions[2],i,n)&&(!!cf(wh.Cross(i.directions[0],n.directions[0]),i,n)&&(!!cf(wh.Cross(i.directions[0],n.directions[1]),i,n)&&(!!cf(wh.Cross(i.directions[0],n.directions[2]),i,n)&&(!!cf(wh.Cross(i.directions[1],n.directions[0]),i,n)&&(!!cf(wh.Cross(i.directions[1],n.directions[1]),i,n)&&(!!cf(wh.Cross(i.directions[1],n.directions[2]),i,n)&&(!!cf(wh.Cross(i.directions[2],n.directions[0]),i,n)&&(!!cf(wh.Cross(i.directions[2],n.directions[1]),i,n)&&!!cf(wh.Cross(i.directions[2],n.directions[2]),i,n))))))))))))))}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}reConstruct(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)}get diagonalLength(){const t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,e._TmpVector3[0]).length()}encapsulateBoundingInfo(e){const t=kh.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);const i=kh.Vector3[0];return wh.TransformCoordinatesToRef(e.boundingBox.minimumWorld,t,i),this.encapsulate(i),wh.TransformCoordinatesToRef(e.boundingBox.maximumWorld,t,i),this.encapsulate(i),this}encapsulate(e){const t=wh.Minimize(this.minimum,e),i=wh.Maximize(this.maximum,e);return this.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this}centerOn(t,i){const n=e._TmpVector3[0].copyFrom(t).subtractInPlace(i),a=e._TmpVector3[1].copyFrom(t).addInPlace(i);return this.boundingBox.reConstruct(n,a,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(n,a,this.boundingBox.getWorldMatrix()),this}get maximum(){return this.boundingBox.maximum}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}isInFrustum(e,t=0){if((2===t||3===t)&&this.boundingSphere.isCenterInFrustum(e))return!0;if(!this.boundingSphere.isInFrustum(e))return!1;return!(1!==t&&3!==t)||this.boundingBox.isInFrustum(e)}set isLocked(e){this._isLocked=e}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}get isLocked(){return this._isLocked}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}intersectsPoint(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))}};hf._TmpVector3=th(2,wh.Zero);var ff=class{static extractMinAndMax(e,t,i,n,a,s){for(let r=t,o=t*n;r<t+i;r++,o+=n){const t=e[o],i=e[o+1],n=e[o+2];a.minimizeInPlaceFromFloats(t,i,n),s.maximizeInPlaceFromFloats(t,i,n)}}static extractMinAndMaxIndexed(e,t,i,n,a,s){for(let r=i;r<i+n;r++){const i=3*t[r],n=e[i],o=e[i+1],l=e[i+2];a.minimizeInPlaceFromFloats(n,o,l),s.maximizeInPlaceFromFloats(n,o,l)}}};function uf(e,t,i,n=null,a){const s=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new wh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a||(a=3),ff.extractMinAndMax(e,t,i,a,s,r),n&&(s.x-=s.x*n.x+n.y,s.y-=s.y*n.x+n.y,s.z-=s.z*n.x+n.y,r.x+=r.x*n.x+n.y,r.y+=r.y*n.x+n.y,r.z+=r.z*n.x+n.y),{minimum:s,maximum:r}}Lc([qc.filter(((...[e,t])=>!Array.isArray(e)&&!Array.isArray(t)))],ff,"extractMinAndMaxIndexed",null),Lc([qc.filter(((...[e])=>!Array.isArray(e)))],ff,"extractMinAndMax",null);var df=class{dispose(){this.drawContext?.dispose()}constructor(e,t=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}static GetEffect(e){return void 0===e.getPipelineContext?e.effect:e}setEffect(e,t,i=!0){this.effect=e,void 0!==t&&(this.defines=t),i&&this.drawContext?.reset()}},mf=class e{constructor(e,t,i,n,a,s,r,o=!0,l=!0){this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=n,this.indexCount=a,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=r||s,l&&s.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=s.subMeshes.length-1,o&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}getMaterial(e=!0){const t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!t)return e?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(t)){const e=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this.resetDrawCache()),e}return t}setEffect(e,t=null,i,n=!0){const a=this._drawWrapper;a.setEffect(e,t,n),void 0!==i&&(a.materialContext=i),e||(a.defines=null,a.materialContext=void 0)}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}_intersectTriangles(e,t,i,n,a,s,r){let o=null,l=-1;for(let c=this.indexStart;c<this.indexStart+this.indexCount-(3-n);c+=n){l++;const n=i[c],h=i[c+1],f=i[c+2];if(a&&4294967295===f){c+=2;continue}const u=t[n],d=t[h],m=t[f];if(!u||!d||!m)continue;if(r&&!r(u,d,m,e,n,h,f))continue;const p=e.intersectsTriangle(u,d,m);if(p){if(p.distance<0)continue;if((s||!o||p.distance<o.distance)&&(o=p,o.faceId=l,s))break}}return o}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}dispose(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()}_intersectUnIndexedTriangles(e,t,i,n,a){let s=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=3){const r=t[i],o=t[i+1],l=t[i+2];if(a&&!a(r,o,l,e,-1,-1,-1))continue;const c=e.intersectsTriangle(r,o,l);if(c){if(c.distance<0)continue;if((n||!s||c.distance<s.distance)&&(s=c,s.faceId=i/3,n))break}}return s}canIntersects(e){const t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)}isCompletelyInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}getMesh(){return this._mesh}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getRenderingMesh(){return this._renderingMesh}get effect(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:this._getDrawWrapper()?.effect??null}static AddToMesh(t,i,n,a,s,r,o,l=!0){return new e(t,i,n,a,s,r,o,l)}resetDrawCache(e){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e);for(const e of this._drawWrappers)e?.dispose()}this._drawWrappers=[]}_getDrawWrapper(e,t=!1){e=e??this._engine.currentRenderPassId;let i=this._drawWrappers[e];return!i&&t&&(this._drawWrappers[e]=i=new df(this._mesh.getScene().getEngine())),i}intersects(e,t,i,n,a){const s=this.getMaterial();if(!s)return null;let r=3,o=!1;switch(s.fillMode){case 3:case 5:case 6:case 8:return null;case 7:r=1,o=!0}return 4===s.fillMode?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,n):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,n):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,n,a):this._intersectTriangles(e,t,i,r,o,n,a)}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){const i=[];for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)i.push(e[t],e[t+1],e[t+1],e[t+2],e[t+2],e[t]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer}getEffectiveMesh(){const e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}set materialDefines(e){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=e}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}getClassName(){return"SubMesh"}setBoundingInfo(e){return this._boundingInfo=e,this}get materialDefines(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:this._getDrawWrapper()?.defines}_isMultiMaterial(e){return void 0!==e.getSubMaterial}_removeDrawWrapper(e,t=!0){t&&this._drawWrappers[e]?.dispose(),this._drawWrappers[e]=void 0}_intersectUnIndexedLines(e,t,i,n,a){let s=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=2){const r=t[i],o=t[i+1],l=e.intersectionSegment(r,o,n);if(!(l<0)&&((a||!s||l<s.distance)&&(s=new nf(null,null,l),s.faceId=i/2,a)))break}return s}static CreateFromIndices(t,i,n,a,s,r=!0){let o=Number.MAX_VALUE,l=-Number.MAX_VALUE;const c=(s||a).getIndices();for(let e=i;e<i+n;e++){const t=c[e];t<o&&(o=t),t>l&&(l=t)}return new e(t,o,l-o+1,i,n,a,s,r)}refreshBoundingInfo(e=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData($h.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const t=this._renderingMesh.getIndices();let i;if(0===this.indexStart&&this.indexCount===t.length){const e=this._renderingMesh.getBoundingInfo();i={minimum:e.minimum.clone(),maximum:e.maximum.clone()}}else i=function(e,t,i,n,a=null){const s=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new wh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return ff.extractMinAndMaxIndexed(e,t,i,n,s,r),a&&(s.x-=s.x*a.x+a.y,s.y-=s.y*a.x+a.y,s.z-=s.z*a.x+a.y,r.x+=r.x*a.x+a.y,r.y+=r.y*a.x+a.y,r.z+=r.z*a.x+a.y),{minimum:s,maximum:r}}(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new hf(i.minimum,i.maximum),this}_intersectLines(e,t,i,n,a){let s=null;for(let r=this.indexStart;r<this.indexStart+this.indexCount;r+=2){const o=t[i[r]],l=t[i[r+1]],c=e.intersectionSegment(o,l,n);if(!(c<0)&&((a||!s||c<s.distance)&&(s=new nf(null,null,c),s.faceId=r/2,a)))break}return s}isInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)}clone(t,i){const n=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,i,!1);if(!this.IsGlobal){const e=this.getBoundingInfo();if(!e)return n;n._boundingInfo=new hf(e.minimum,e.maximum)}return n}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}},pf=class{},_f=class e{static ft(e){throw Qc("cylinderBuilder")}applyToGeometry(e,t){return this._applyTo(e,t,!1),this}static _ExtractFrom(t,i,n){const a=new e;if(t.isVerticesDataPresent($h.PositionKind)&&(a.positions=t.getVerticesData($h.PositionKind,i,n)),t.isVerticesDataPresent($h.NormalKind)&&(a.normals=t.getVerticesData($h.NormalKind,i,n)),t.isVerticesDataPresent($h.TangentKind)&&(a.tangents=t.getVerticesData($h.TangentKind,i,n)),t.isVerticesDataPresent($h.UVKind)&&(a.uvs=t.getVerticesData($h.UVKind,i,n)),t.isVerticesDataPresent($h.UV2Kind)&&(a.uvs2=t.getVerticesData($h.UV2Kind,i,n)),t.isVerticesDataPresent($h.UV3Kind)&&(a.uvs3=t.getVerticesData($h.UV3Kind,i,n)),t.isVerticesDataPresent($h.UV4Kind)&&(a.uvs4=t.getVerticesData($h.UV4Kind,i,n)),t.isVerticesDataPresent($h.UV5Kind)&&(a.uvs5=t.getVerticesData($h.UV5Kind,i,n)),t.isVerticesDataPresent($h.UV6Kind)&&(a.uvs6=t.getVerticesData($h.UV6Kind,i,n)),t.isVerticesDataPresent($h.ColorKind)){const e=t.geometry||t,s=e.getVertexBuffer($h.ColorKind),r=e.getVerticesData($h.ColorKind,i,n);if(3===s.getSize()){const e=new Float32Array(4*r.length/3);for(let t=0,i=0;t<r.length;t+=3,i+=4)e[i]=r[t],e[i+1]=r[t+1],e[i+2]=r[t+2],e[i+3]=1;a.colors=e}else{if(4!==s.getSize())throw new Error(`Unexpected number of color components: ${s.getSize()}`);a.colors=r}}return t.isVerticesDataPresent($h.MatricesIndicesKind)&&(a.matricesIndices=t.getVerticesData($h.MatricesIndicesKind,i,n)),t.isVerticesDataPresent($h.MatricesWeightsKind)&&(a.matricesWeights=t.getVerticesData($h.MatricesWeightsKind,i,n)),t.isVerticesDataPresent($h.MatricesIndicesExtraKind)&&(a.matricesIndicesExtra=t.getVerticesData($h.MatricesIndicesExtraKind,i,n)),t.isVerticesDataPresent($h.MatricesWeightsExtraKind)&&(a.matricesWeightsExtra=t.getVerticesData($h.MatricesWeightsExtraKind,i,n)),a.indices=t.getIndices(i,n),a}static CreateIcoSphere(e){throw Qc("icoSphereBuilder")}serialize(){const e={};if(this.positions&&(e.positions=Array.from(this.positions)),this.normals&&(e.normals=Array.from(this.normals)),this.tangents&&(e.tangents=Array.from(this.tangents)),this.uvs&&(e.uvs=Array.from(this.uvs)),this.uvs2&&(e.uvs2=Array.from(this.uvs2)),this.uvs3&&(e.uvs3=Array.from(this.uvs3)),this.uvs4&&(e.uvs4=Array.from(this.uvs4)),this.uvs5&&(e.uvs5=Array.from(this.uvs5)),this.uvs6&&(e.uvs6=Array.from(this.uvs6)),this.colors&&(e.colors=Array.from(this.colors),e.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(e.matricesIndices=Array.from(this.matricesIndices),e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(e.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),e.indices=Array.from(this.indices),this.materialInfos){e.materialInfos=[];for(const t of this.materialInfos){const i={indexStart:t.indexStart,indexCount:t.indexCount,materialIndex:t.materialIndex,verticesStart:t.verticesStart,verticesCount:t.verticesCount};e.materialInfos.push(i)}}return e}clone(){const t=this.serialize();return e.Parse(t)}static ExtractFromMesh(t,i,n){return e._ExtractFrom(t,i,n)}static CreatePolygon(e,t,i,n,a,s,r){throw Qc("polygonBuilder")}static CreateCapsule(e={orientation:wh.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw Qc("capsuleBuilder")}static ImportVertexData(t,i){const n=e.Parse(t);i.setAllVerticesData(n,t.updatable)}static CreateTiledGround(e){throw Qc("groundBuilder")}transform(t){const i=t.determinant()<0;return this.positions&&e._TransformVector3Coordinates(this.positions,t),this.normals&&e._TransformVector3Normals(this.normals,t),this.tangents&&e._TransformVector4Normals(this.tangents,t),i&&this.indices&&e._FlipFaces(this.indices),this}*_applyToCoroutine(e,t=!1,i){if(this.positions&&(e.setVerticesData($h.PositionKind,this.positions,t),i&&(yield)),this.normals&&(e.setVerticesData($h.NormalKind,this.normals,t),i&&(yield)),this.tangents&&(e.setVerticesData($h.TangentKind,this.tangents,t),i&&(yield)),this.uvs&&(e.setVerticesData($h.UVKind,this.uvs,t),i&&(yield)),this.uvs2&&(e.setVerticesData($h.UV2Kind,this.uvs2,t),i&&(yield)),this.uvs3&&(e.setVerticesData($h.UV3Kind,this.uvs3,t),i&&(yield)),this.uvs4&&(e.setVerticesData($h.UV4Kind,this.uvs4,t),i&&(yield)),this.uvs5&&(e.setVerticesData($h.UV5Kind,this.uvs5,t),i&&(yield)),this.uvs6&&(e.setVerticesData($h.UV6Kind,this.uvs6,t),i&&(yield)),this.colors&&(e.setVerticesData($h.ColorKind,this.colors,t),this.hasVertexAlpha&&void 0!==e.hasVertexAlpha&&(e.hasVertexAlpha=!0),i&&(yield)),this.matricesIndices&&(e.setVerticesData($h.MatricesIndicesKind,this.matricesIndices,t),i&&(yield)),this.matricesWeights&&(e.setVerticesData($h.MatricesWeightsKind,this.matricesWeights,t),i&&(yield)),this.matricesIndicesExtra&&(e.setVerticesData($h.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),i&&(yield)),this.matricesWeightsExtra&&(e.setVerticesData($h.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),i&&(yield)),this.indices?(e.setIndices(this.indices,null,t),i&&(yield)):e.setIndices([],null),e.subMeshes&&this.materialInfos&&this.materialInfos.length>1){const t=e;t.subMeshes=[];for(const e of this.materialInfos)new mf(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,t)}return this}_update(e,t,i){return this.positions&&e.updateVerticesData($h.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData($h.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData($h.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData($h.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData($h.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData($h.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData($h.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData($h.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData($h.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData($h.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData($h.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData($h.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData($h.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData($h.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this}static CreateTorusKnot(e){throw Qc("torusKnotBuilder")}*_mergeCoroutine(t,i,n=!1,a,s,r=!1,o=!1){this._validate();let l=i.map((e=>e.vertexData)),c=this;if(o)for(const e of l)e&&(e._validate(),!this.normals&&e.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&e.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&e.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&e.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&e.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&e.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&e.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&e.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&e.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&e.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&e.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&e.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&e.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(const e of l)if(e)if(o)this.normals&&!e.normals&&(e.normals=new Float32Array(e.positions.length)),this.tangents&&!e.tangents&&(e.tangents=new Float32Array(e.positions.length/3*4)),this.uvs&&!e.uvs&&(e.uvs=new Float32Array(e.positions.length/3*2)),this.uvs2&&!e.uvs2&&(e.uvs2=new Float32Array(e.positions.length/3*2)),this.uvs3&&!e.uvs3&&(e.uvs3=new Float32Array(e.positions.length/3*2)),this.uvs4&&!e.uvs4&&(e.uvs4=new Float32Array(e.positions.length/3*2)),this.uvs5&&!e.uvs5&&(e.uvs5=new Float32Array(e.positions.length/3*2)),this.uvs6&&!e.uvs6&&(e.uvs6=new Float32Array(e.positions.length/3*2)),this.colors&&!e.colors&&(e.colors=new Float32Array(e.positions.length/3*4),e.colors.fill(1)),this.matricesIndices&&!e.matricesIndices&&(e.matricesIndices=new Float32Array(e.positions.length/3*4)),this.matricesWeights&&!e.matricesWeights&&(e.matricesWeights=new Float32Array(e.positions.length/3*4)),this.matricesIndicesExtra&&!e.matricesIndicesExtra&&(e.matricesIndicesExtra=new Float32Array(e.positions.length/3*4)),this.matricesWeightsExtra&&!e.matricesWeightsExtra&&(e.matricesWeightsExtra=new Float32Array(e.positions.length/3*4));else if(e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(r){let e=0,n=0,a=0;const s=[];let r=null;const o=[];for(const e of this.splitBasedOnMaterialID())o.push({vertexData:e,transform:t});for(const e of i)if(e.vertexData)for(const t of e.vertexData.splitBasedOnMaterialID())o.push({vertexData:t,transform:e.transform});o.sort(((e,t)=>{const i=e.vertexData.materialInfos?e.vertexData.materialInfos[0].materialIndex:0,n=t.vertexData.materialInfos?t.vertexData.materialInfos[0].materialIndex:0;return i>n?1:i===n?0:-1}));for(const t of o){const i=t.vertexData;if(e=i.materialInfos?i.materialInfos[0].materialIndex:0,r&&r.materialIndex===e)r.indexCount+=i.indices.length,r.verticesCount+=i.positions.length/3;else{const t=new pf;t.materialIndex=e,t.indexStart=n,t.indexCount=i.indices.length,t.verticesStart=a,t.verticesCount=i.positions.length/3,s.push(t),r=t}n+=i.indices.length,a+=i.positions.length/3}const h=o.splice(0,1)[0];c=h.vertexData,t=h.transform,l=o.map((e=>e.vertexData)),i=o,this.materialInfos=s}const h=l.reduce(((e,t)=>e+(t.indices?.length??0)),c.indices?.length??0);let f=s||l.some((e=>e.indices===c.indices))?c.indices?.slice():c.indices;if(h>0){let s=f?.length??0;if(f||(f=new Array(h)),f.length!==h){if(Array.isArray(f))f.length=h;else{const e=n||f instanceof Uint32Array?new Uint32Array(h):new Uint16Array(h);e.set(f),f=e}t&&t.determinant()<0&&e._FlipFaces(f,0,s)}let r=c.positions?c.positions.length/3:0;for(const{vertexData:t,transform:n}of i)if(t.indices){for(let e=0;e<t.indices.length;e++)f[s+e]=t.indices[e]+r;n&&n.determinant()<0&&e._FlipFaces(f,s,t.indices.length),r+=t.positions.length/3,s+=t.indices.length,a&&(yield)}}return this.indices=f,this.positions=e._MergeElement($h.PositionKind,c.positions,t,i.map((e=>[e.vertexData.positions,e.transform]))),a&&(yield),c.normals&&(this.normals=e._MergeElement($h.NormalKind,c.normals,t,i.map((e=>[e.vertexData.normals,e.transform]))),a&&(yield)),c.tangents&&(this.tangents=e._MergeElement($h.TangentKind,c.tangents,t,i.map((e=>[e.vertexData.tangents,e.transform]))),a&&(yield)),c.uvs&&(this.uvs=e._MergeElement($h.UVKind,c.uvs,t,i.map((e=>[e.vertexData.uvs,e.transform]))),a&&(yield)),c.uvs2&&(this.uvs2=e._MergeElement($h.UV2Kind,c.uvs2,t,i.map((e=>[e.vertexData.uvs2,e.transform]))),a&&(yield)),c.uvs3&&(this.uvs3=e._MergeElement($h.UV3Kind,c.uvs3,t,i.map((e=>[e.vertexData.uvs3,e.transform]))),a&&(yield)),c.uvs4&&(this.uvs4=e._MergeElement($h.UV4Kind,c.uvs4,t,i.map((e=>[e.vertexData.uvs4,e.transform]))),a&&(yield)),c.uvs5&&(this.uvs5=e._MergeElement($h.UV5Kind,c.uvs5,t,i.map((e=>[e.vertexData.uvs5,e.transform]))),a&&(yield)),c.uvs6&&(this.uvs6=e._MergeElement($h.UV6Kind,c.uvs6,t,i.map((e=>[e.vertexData.uvs6,e.transform]))),a&&(yield)),c.colors&&(this.colors=e._MergeElement($h.ColorKind,c.colors,t,i.map((e=>[e.vertexData.colors,e.transform]))),(void 0!==c.hasVertexAlpha||i.some((e=>void 0!==e.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=c.hasVertexAlpha||i.some((e=>e.vertexData.hasVertexAlpha))),a&&(yield)),c.matricesIndices&&(this.matricesIndices=e._MergeElement($h.MatricesIndicesKind,c.matricesIndices,t,i.map((e=>[e.vertexData.matricesIndices,e.transform]))),a&&(yield)),c.matricesWeights&&(this.matricesWeights=e._MergeElement($h.MatricesWeightsKind,c.matricesWeights,t,i.map((e=>[e.vertexData.matricesWeights,e.transform]))),a&&(yield)),c.matricesIndicesExtra&&(this.matricesIndicesExtra=e._MergeElement($h.MatricesIndicesExtraKind,c.matricesIndicesExtra,t,i.map((e=>[e.vertexData.matricesIndicesExtra,e.transform]))),a&&(yield)),c.matricesWeightsExtra&&(this.matricesWeightsExtra=e._MergeElement($h.MatricesWeightsExtraKind,c.matricesWeightsExtra,t,i.map((e=>[e.vertexData.matricesWeightsExtra,e.transform])))),this}applyToMesh(e,t){return this._applyTo(e,t,!1),this}static CreateGround(e){throw Qc("groundBuilder")}static _MergeElement(t,i,n,a){const s=a.filter((e=>null!==e[0]&&void 0!==e[0]));if(!i&&0==s.length)return i;if(!i)return this._MergeElement(t,s[0][0],s[0][1],s.slice(1));const r=s.reduce(((e,t)=>e+t[0].length),i.length),o=t===$h.PositionKind?e._TransformVector3Coordinates:t===$h.NormalKind?e._TransformVector3Normals:t===$h.TangentKind?e._TransformVector4Normals:()=>{};if(i instanceof Float32Array){const e=new Float32Array(r);e.set(i),n&&o(e,n,0,i.length);let t=i.length;for(const[i,n]of s)e.set(i,t),n&&o(e,n,t,i.length),t+=i.length;return e}{const e=new Array(r);for(let t=0;t<i.length;t++)e[t]=i[t];n&&o(e,n,0,i.length);let t=i.length;for(const[i,n]of s){for(let n=0;n<i.length;n++)e[t+n]=i[n];n&&o(e,n,t,i.length),t+=i.length}return e}}static _TransformVector3Coordinates(e,t,i=0,n=e.length){const a=kh.Vector3[0],s=kh.Vector3[1];for(let r=i;r<i+n;r+=3)wh.FromArrayToRef(e,r,a),wh.TransformCoordinatesToRef(a,t,s),e[r]=s.x,e[r+1]=s.y,e[r+2]=s.z}static _FlipFaces(e,t=0,i=e.length){for(let n=t;n<t+i;n+=3){const t=e[n+1];e[n+1]=e[n+2],e[n+2]=t}}static st(e){throw Qc("ribbonBuilder")}updateGeometry(e){return this._update(e),this}_validate(){if(!this.positions)throw new tf("Positions are required",ef.MeshInvalidPositionsError);const e=(e,t)=>{const i=$h.DeduceStride(e);if(t.length%i!=0)throw new Error("The "+e+"s array count must be a multiple of "+i);return t.length/i},t=e($h.PositionKind,this.positions),i=(i,n)=>{const a=e(i,n);if(a!==t)throw new Error("The "+i+"s element count ("+a+") does not match the positions count ("+t+")")};this.normals&&i($h.NormalKind,this.normals),this.tangents&&i($h.TangentKind,this.tangents),this.uvs&&i($h.UVKind,this.uvs),this.uvs2&&i($h.UV2Kind,this.uvs2),this.uvs3&&i($h.UV3Kind,this.uvs3),this.uvs4&&i($h.UV4Kind,this.uvs4),this.uvs5&&i($h.UV5Kind,this.uvs5),this.uvs6&&i($h.UV6Kind,this.uvs6),this.colors&&i($h.ColorKind,this.colors),this.matricesIndices&&i($h.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i($h.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i($h.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i($h.MatricesWeightsExtraKind,this.matricesWeightsExtra)}static _ComputeSides(t,i,n,a,s,r,o){const l=n.length,c=a.length;let h,f;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:for(h=0;h<l;h+=3){const e=n[h];n[h]=n[h+2],n[h+2]=e}for(f=0;f<c;f++)a[f]=-a[f];break;case e.DOUBLESIDE:{const e=i.length,t=e/3;for(let t=0;t<e;t++)i[e+t]=i[t];for(h=0;h<l;h+=3)n[h+l]=n[h+2]+t,n[h+1+l]=n[h+1]+t,n[h+2+l]=n[h]+t;for(f=0;f<c;f++)a[c+f]=-a[f];const u=s.length;let d=0;for(d=0;d<u;d++)s[d+u]=s[d];for(r=r||new Oh(0,0,1,1),o=o||new Oh(0,0,1,1),d=0,h=0;h<u/2;h++)s[d]=r.x+(r.z-r.x)*s[d],s[d+1]=r.y+(r.w-r.y)*s[d+1],s[d+u]=o.x+(o.z-o.x)*s[d+u],s[d+u+1]=o.y+(o.w-o.y)*s[d+u+1],d+=2;break}}}static CreateTorus(e){throw Qc("torusBuilder")}merge(e,t=!1,i=!1,n=!1,a=!1){const s=Array.isArray(e)?e.map((e=>({vertexData:e}))):[{vertexData:e}];return Qh(this._mergeCoroutine(void 0,s,t,!1,i,n,a))}static $t(e){throw Qc("boxBuilder")}set(e,t){switch(e.length||jh.Warn(`Setting vertex data kind '${t}' with an empty array`),t){case $h.PositionKind:this.positions=e;break;case $h.NormalKind:this.normals=e;break;case $h.TangentKind:this.tangents=e;break;case $h.UVKind:this.uvs=e;break;case $h.UV2Kind:this.uvs2=e;break;case $h.UV3Kind:this.uvs3=e;break;case $h.UV4Kind:this.uvs4=e;break;case $h.UV5Kind:this.uvs5=e;break;case $h.UV6Kind:this.uvs6=e;break;case $h.ColorKind:this.colors=e;break;case $h.MatricesIndicesKind:this.matricesIndices=e;break;case $h.MatricesWeightsKind:this.matricesWeights=e;break;case $h.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case $h.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}}static gt(e){throw Qc("discBuilder")}static _TransformVector3Normals(e,t,i=0,n=e.length){const a=kh.Vector3[0],s=kh.Vector3[1];for(let r=i;r<i+n;r+=3)wh.FromArrayToRef(e,r,a),wh.TransformNormalToRef(a,t,s),e[r]=s.x,e[r+1]=s.y,e[r+2]=s.z}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const t=[];for(const i of this.materialInfos){const n=new e;if(this.positions&&(n.positions=this.positions.slice(3*i.verticesStart,3*(i.verticesCount+i.verticesStart))),this.normals&&(n.normals=this.normals.slice(3*i.verticesStart,3*(i.verticesCount+i.verticesStart))),this.tangents&&(n.tangents=this.tangents.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.colors&&(n.colors=this.colors.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.uvs&&(n.uvs=this.uvs.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs2&&(n.uvs2=this.uvs2.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs3&&(n.uvs3=this.uvs3.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs4&&(n.uvs4=this.uvs4.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs5&&(n.uvs5=this.uvs5.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.uvs6&&(n.uvs6=this.uvs6.slice(2*i.verticesStart,2*(i.verticesCount+i.verticesStart))),this.matricesIndices&&(n.matricesIndices=this.matricesIndices.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesIndicesExtra&&(n.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesWeights&&(n.matricesWeights=this.matricesWeights.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.matricesWeightsExtra&&(n.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*i.verticesStart,4*(i.verticesCount+i.verticesStart))),this.indices){n.indices=[];for(let e=i.indexStart;e<i.indexStart+i.indexCount;e++)n.indices.push(this.indices[e]-i.verticesStart)}const a=new pf;a.indexStart=0,a.indexCount=n.indices?n.indices.length:0,a.materialIndex=i.materialIndex,a.verticesStart=0,a.verticesCount=(n.positions?n.positions.length:0)/3,n.materialInfos=[a],t.push(n)}return t}static CreateDashedLines(e){throw Qc("linesBuilder")}static _TransformVector4Normals(e,t,i=0,n=e.length){const a=kh.Vector4[0],s=kh.Vector4[1];for(let r=i;r<i+n;r+=4)Oh.FromArrayToRef(e,r,a),Oh.TransformNormalToRef(a,t,s),e[r]=s.x,e[r+1]=s.y,e[r+2]=s.z,e[r+3]=s.w}static CreateLineSystem(e){throw Qc("linesBuilder")}static ut(e){throw Qc("sphereBuilder")}static CreateGroundFromHeightMap(e){throw Qc("groundBuilder")}static CreateTiledBox(e){throw Qc("tiledBoxBuilder")}static CreateTiledPlane(e){throw Qc("tiledPlaneBuilder")}static ComputeNormals(e,t,i,n){let a=0,s=0,r=0,o=0,l=0,c=0,h=0,f=0,u=0,d=0,m=0,p=0,_=0,v=0,g=0,S=0,y=0,E=0,A=0,C=0,R=!1,T=!1,N=!1,M=!1,I=1,x=0,b=null;n&&(R=!!n.facetNormals,T=!!n.facetPositions,N=!!n.facetPartitioning,I=!0===n.useRightHandedSystem?-1:1,x=n.ratio||0,M=!!n.depthSort,b=n.distanceTo,M&&void 0===b&&(b=wh.Zero()));let P=0,w=0,O=0,D=0;for(N&&n&&n.bbSize&&(P=n.subDiv.X*x/n.bbSize.x,w=n.subDiv.Y*x/n.bbSize.y,O=n.subDiv.Z*x/n.bbSize.z,D=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0),a=0;a<e.length;a++)i[a]=0;const L=t.length/3|0;for(a=0;a<L;a++){if(p=3*t[3*a],_=p+1,v=p+2,g=3*t[3*a+1],S=g+1,y=g+2,E=3*t[3*a+2],A=E+1,C=E+2,s=e[p]-e[g],r=e[_]-e[S],o=e[v]-e[y],l=e[E]-e[g],c=e[A]-e[S],h=e[C]-e[y],f=I*(r*h-o*c),u=I*(o*l-s*h),d=I*(s*c-r*l),m=Math.sqrt(f*f+u*u+d*d),m=0===m?1:m,f/=m,u/=m,d/=m,R&&n&&(n.facetNormals[a].x=f,n.facetNormals[a].y=u,n.facetNormals[a].z=d),T&&n&&(n.facetPositions[a].x=(e[p]+e[g]+e[E])/3,n.facetPositions[a].y=(e[_]+e[S]+e[A])/3,n.facetPositions[a].z=(e[v]+e[y]+e[C])/3),N&&n){const t=Math.floor((n.facetPositions[a].x-n.bInfo.minimum.x*x)*P),i=Math.floor((n.facetPositions[a].y-n.bInfo.minimum.y*x)*w),s=Math.floor((n.facetPositions[a].z-n.bInfo.minimum.z*x)*O),r=Math.floor((e[p]-n.bInfo.minimum.x*x)*P),o=Math.floor((e[_]-n.bInfo.minimum.y*x)*w),l=Math.floor((e[v]-n.bInfo.minimum.z*x)*O),c=Math.floor((e[g]-n.bInfo.minimum.x*x)*P),h=Math.floor((e[S]-n.bInfo.minimum.y*x)*w),f=Math.floor((e[y]-n.bInfo.minimum.z*x)*O),u=Math.floor((e[E]-n.bInfo.minimum.x*x)*P),d=Math.floor((e[A]-n.bInfo.minimum.y*x)*w),m=Math.floor((e[C]-n.bInfo.minimum.z*x)*O),R=r+n.subDiv.max*o+D*l,T=c+n.subDiv.max*h+D*f,N=u+n.subDiv.max*d+D*m,M=t+n.subDiv.max*i+D*s;n.facetPartitioning[M]=n.facetPartitioning[M]?n.facetPartitioning[M]:new Array,n.facetPartitioning[R]=n.facetPartitioning[R]?n.facetPartitioning[R]:new Array,n.facetPartitioning[T]=n.facetPartitioning[T]?n.facetPartitioning[T]:new Array,n.facetPartitioning[N]=n.facetPartitioning[N]?n.facetPartitioning[N]:new Array,n.facetPartitioning[R].push(a),T!=R&&n.facetPartitioning[T].push(a),N!=T&&N!=R&&n.facetPartitioning[N].push(a),M!=R&&M!=T&&M!=N&&n.facetPartitioning[M].push(a)}if(M&&n&&n.facetPositions){const e=n.depthSortedFacets[a];e.ind=3*a,e.sqDistance=wh.DistanceSquared(n.facetPositions[a],b)}i[p]+=f,i[_]+=u,i[v]+=d,i[g]+=f,i[S]+=u,i[y]+=d,i[E]+=f,i[A]+=u,i[C]+=d}for(a=0;a<i.length/3;a++)f=i[3*a],u=i[3*a+1],d=i[3*a+2],m=Math.sqrt(f*f+u*u+d*d),m=0===m?1:m,f/=m,u/=m,d/=m,i[3*a]=f,i[3*a+1]=u,i[3*a+2]=d}static CreatePolyhedron(e){throw Qc("polyhedronBuilder")}static ExtractFromGeometry(t,i,n){return e._ExtractFrom(t,i,n)}static Vt(e){throw Qc("planeBuilder")}updateMesh(e){return this._update(e),this}static Parse(t){const i=new e,n=t.positions;n&&i.set(n,$h.PositionKind);const a=t.normals;a&&i.set(a,$h.NormalKind);const s=t.tangents;s&&i.set(s,$h.TangentKind);const r=t.uvs;r&&i.set(r,$h.UVKind);const o=t.uvs2;o&&i.set(o,$h.UV2Kind);const l=t.uvs3;l&&i.set(l,$h.UV3Kind);const c=t.uvs4;c&&i.set(c,$h.UV4Kind);const h=t.uvs5;h&&i.set(h,$h.UV5Kind);const f=t.uvs6;f&&i.set(f,$h.UV6Kind);const u=t.colors;u&&(i.set(Ch.CheckColors4(u,n.length/3),$h.ColorKind),void 0!==t.hasVertexAlpha&&(i.hasVertexAlpha=t.hasVertexAlpha));const d=t.matricesIndices;d&&i.set(d,$h.MatricesIndicesKind);const m=t.matricesWeights;m&&i.set(m,$h.MatricesWeightsKind);const p=t.indices;p&&(i.indices=p);const _=t.materialInfos;if(_){i.materialInfos=[];for(const e of _){const t=new pf;t.indexCount=e.indexCount,t.indexStart=e.indexStart,t.verticesCount=e.verticesCount,t.verticesStart=e.verticesStart,t.materialIndex=e.materialIndex,i.materialInfos.push(t)}}return i}constructor(){var t,i;this.xt=0,this.metadata={},this._applyTo=(t=this._applyToCoroutine.bind(this),(...e)=>Qh(t(...e),i)),this.xt=e._UniqueIDGenerator,e._UniqueIDGenerator++}};function vf(){return"undefined"!=typeof window}function gf(){return"undefined"!=typeof navigator}function Sf(){return"undefined"!=typeof document}function yf(e){let t="",i=e.firstChild;for(;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t}_f.FRONTSIDE=0,_f.BACKSIDE=1,_f.DOUBLESIDE=2,_f.DEFAULTSIDE=0,_f._UniqueIDGenerator=0,Lc([qc.filter(((...[e])=>!Array.isArray(e)))],_f,"_TransformVector3Coordinates",null),Lc([qc.filter(((...[e])=>!Array.isArray(e)))],_f,"_TransformVector3Normals",null),Lc([qc.filter(((...[e])=>!Array.isArray(e)))],_f,"_TransformVector4Normals",null),Lc([qc.filter(((...[e])=>!Array.isArray(e)))],_f,"_FlipFaces",null);var Ef=(e,t,i)=>e?e.getClassName&&"Mesh"===e.getClassName()?null:!e.getClassName||"SubMesh"!==e.getClassName()&&"PhysicsBody"!==e.getClassName()?e.clone?e.clone():Array.isArray(e)?e.slice():i&&"object"==typeof e?{...e}:null:e.clone(t):null;var Af=class{static DeepCopy(e,t,i,n,a=!1){const s=function(e){const t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}(e);for(const r of s){if("_"===r[0]&&(!n||-1===n.indexOf(r)))continue;if(r.endsWith("Observable"))continue;if(i&&-1!==i.indexOf(r))continue;const s=e[r],o=typeof s;if("function"!==o)try{if("object"===o)if(s instanceof Uint8Array)t[r]=Uint8Array.from(s);else if(s instanceof Array){if(t[r]=[],s.length>0)if("object"==typeof s[0])for(let e=0;e<s.length;e++){const i=Ef(s[e],t,a);-1===t[r].indexOf(i)&&t[r].push(i)}else t[r]=s.slice(0)}else t[r]=Ef(s,t,a);else t[r]=s}catch(e){jh.Warn(e.message)}}}},Cf=class{static get Now(){return vf()&&window.performance&&window.performance.now?window.performance.now():Date.now()}};var Rf=class e{set onprogress(e){this._xhr.onprogress=e}get status(){return this._xhr.status}static get IsCustomRequestAvailable(){return Object.keys(e.CustomRequestHeaders).length>0||e.CustomRequestModifiers.length>0}getResponseHeader(e){return this._xhr.getResponseHeader(e)}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const t in e.CustomRequestHeaders){const i=e.CustomRequestHeaders[t];i&&this._xhr.setRequestHeader(t,i)}}set timeout(e){this._xhr.timeout=e}open(t,i){for(const t of e.CustomRequestModifiers){if(this._shouldSkipRequestModifications(i))return;t(this._xhr,i)}i=(i=i.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=i,this._xhr.open(t,i,!0)}get responseType(){return this._xhr.responseType}removeEventListener(e,t,i){this._xhr.removeEventListener(e,t,i)}set responseType(e){this._xhr.responseType=e}get responseURL(){return this._xhr.responseURL}send(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)}get timeout(){return this._xhr.timeout}get readyState(){return this._xhr.readyState}addEventListener(e,t,i){this._xhr.addEventListener(e,t,i)}get responseText(){return this._xhr.responseText}get onprogress(){return this._xhr.onprogress}_shouldSkipRequestModifications(t){return e.SkipRequestModificationForBabylonCDN&&(t.includes("preview.babylonjs.com")||t.includes("cdn.babylonjs.com"))}constructor(){this._xhr="undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}get response(){return this._xhr.response}get statusText(){return this._xhr.statusText}abort(){this._xhr.abort()}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}};Rf.CustomRequestHeaders={},Rf.CustomRequestModifiers=new Array,Rf.SkipRequestModificationForBabylonCDN=!0;var Tf=class{};Tf.FilesToLoad={};var Nf=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i,n,a,s,r,o,l,c="",h=0;const f=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;h<f.length;)i=f[h++],n=h<f.length?f[h++]:Number.NaN,a=h<f.length?f[h++]:Number.NaN,s=i>>2,r=(3&i)<<4|n>>4,o=(15&n)<<2|a>>6,l=63&a,isNaN(n)?o=l=64:isNaN(a)&&(l=64),c+=t.charAt(s)+t.charAt(r)+t.charAt(o)+t.charAt(l);return c},Mf=e=>atob(e),If=class{isValid(e){return!0}constructor(){this.children=[]}process(e,t){let i="";if(this.line){let n=this.line;const a=t.processor;if(a){a.lineProcessor&&(n=a.lineProcessor(n,t.isFragment,t.processingContext));const i=t.processor?.attributeKeywordName??"attribute",s=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:"varying";if(!t.isFragment&&a.attributeProcessor&&this.line.startsWith(i))n=a.attributeProcessor(this.line,e,t.processingContext);else if(a.varyingProcessor&&(a.varyingCheck?.(this.line,t.isFragment)||!a.varyingCheck&&this.line.startsWith(s)))n=a.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(a.uniformProcessor&&a.uniformRegexp&&a.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(n=a.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(a.uniformBufferProcessor&&a.uniformBufferRegexp&&a.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(n=a.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(a.textureProcessor&&a.textureRegexp&&a.textureRegexp.test(this.line))n=a.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((a.uniformProcessor||a.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?a.uniformProcessor&&(n=a.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):a.uniformBufferProcessor&&(n=a.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,a.endOfUniformBufferProcessor&&(n=a.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}i+=n+"\n"}return this.children.forEach((n=>{i+=n.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i}},xf=class{get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}constructor(){this._lines=[]}set lines(e){this._lines.length=0;for(const t of e){if(!t||"\r"===t)continue;if("#"===t[0]){this._lines.push(t);continue}const e=t.trim();if(!e)continue;if(e.startsWith("//")){this._lines.push(t);continue}const i=e.indexOf(";");if(-1===i)this._lines.push(e);else if(i===e.length-1)e.length>1&&this._lines.push(e);else{const e=t.split(";");for(let t=0;t<e.length;t++){let i=e[t];i&&(i=i.trim(),i&&this._lines.push(i+(t!==e.length-1?";":"")))}}}}},bf=class extends If{process(e,t){for(let i=0;i<this.children.length;i++){const n=this.children[i];if(n.isValid(e))return n.process(e,t)}return""}},Pf=class extends If{isValid(e){return this.testExpression.isTrue(e)}},wf=class e{static infixToPostfix(t){const i=e._InfixToPostfixCache.get(t);if(i)return i.accessTime=Date.now(),i.result;if(!(t.includes("&&")||t.includes("||")||t.includes(")")||t.includes("(")))return[t];const n=[];let a=-1;const s=()=>{h=h.trim(),""!==h&&(n.push(h),h="")},r=t=>{a<e._Stack.length-1&&(e._Stack[++a]=t)},o=()=>e._Stack[a],l=()=>-1===a?"!!INVALID EXPRESSION!!":e._Stack[a--];let c=0,h="";for(;c<t.length;){const i=t.charAt(c),f=c<t.length-1?t.substr(c,2):"";if("("===i)h="",r(i);else if(")"===i){for(s();-1!==a&&"("!==o();)n.push(l());l()}else if(e._OperatorPriority[f]>1){for(s();-1!==a&&e._OperatorPriority[o()]>=e._OperatorPriority[f];)n.push(l());r(f),c++}else h+=i;c++}for(s();-1!==a;)"("===o()?l():n.push(l());return e._InfixToPostfixCache.size>=e.InfixToPostfixCacheLimitSize&&e.ClearCache(),e._InfixToPostfixCache.set(t,{result:n,accessTime:Date.now()}),n}static postfixToInfix(t){const i=[];for(const n of t)if(void 0===e._OperatorPriority[n])i.push(n);else{const e=i[i.length-1],t=i[i.length-2];i.length-=2,i.push(`(${t}${n}${e})`)}return i[i.length-1]}isTrue(e){return!0}static ClearCache(){const t=Array.from(e._InfixToPostfixCache.entries()).sort(((e,t)=>e[1].accessTime-t[1].accessTime));for(let i=0;i<e.InfixToPostfixCacheCleanupSize;i++)e._InfixToPostfixCache.delete(t[i][0])}};wf.InfixToPostfixCacheLimitSize=5e4,wf.InfixToPostfixCacheCleanupSize=25e3,wf._InfixToPostfixCache=new Map,wf._OperatorPriority={")":0,"(":1,"||":2,"&&":3},wf._Stack=["","","","","","","","","","","","","","","","","","","",""];var Of=class extends wf{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=void 0!==e[this.define];return this.not&&(t=!t),t}},Df=class extends wf{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}},Lf=class extends wf{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}},Ff=class extends wf{isTrue(e){let t=e[this.define];void 0===t&&(t=this.define);let i=!1;const n=parseInt(t),a=parseInt(this.testValue);switch(this.operand){case">":i=n>a;break;case"<":i=n<a;break;case"<=":i=n<=a;break;case">=":i=n>=a;break;case"==":i=n===a;break;case"!=":i=n!==a}return i}constructor(e,t,i){super(),this.define=e,this.operand=t,this.testValue=i}},kf={};function Bf(e,t,i=""){return i+(t?t+"\n":"")+e}function Gf(e,t,i,n,a,s,r){const o=r||kf.loadFile;if(o){return o(e,t,i,n,a,s)}throw Qc("FileTools")}function Uf(e,t,i,n){if(e)return t?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,i?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(n?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return t&&(e+="#define IS_NDC_HALF_ZRANGE"),i&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),n&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}var Hf=/defined\s*?\((.+?)\)/g,Vf=/defined\s*?\[(.+?)\]/g,Wf=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,zf=/__decl__/,Xf=/light\{X\}.(\w*)/g,Yf=/\{X\}/g,jf=[],Kf=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function $f(e,t,i,n){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),eu(e,t,(e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines));const a=function(e,t,i){let n=function(e,t){if(t.processor?.noPrecision)return e;const i=t.shouldUseHighPrecisionShader;-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float"));return e}(e,t);if(!t.processor)return n;if(0===t.processor.shaderLanguage&&-1!==n.indexOf("#version 3")&&(n=n.replace("#version 300 es",""),!t.processor.parseGLES3))return n;const a=t.defines,s=function(e,t){const i=e.defines,n={};for(const e of i){const t=e.replace("#define","").replace(";","").trim().split(" ");n[t[0]]=t.length>1?t[1]:""}0===e.processor?.shaderLanguage&&(n.GL_ES="true");return n.__VERSION__=e.version,n[e.platformName]="true",Uf(n,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),n}(t,i);t.processor.preProcessor&&(n=t.processor.preProcessor(n,a,s,t.isFragment,t.processingContext));n=function(e,t,i){const n=new If,a=new xf;return a.lineIndex=-1,a.lines=e.split("\n"),Zf(a,n),n.process(t,i)}(n,s,t),t.processor.postProcessor&&(n=t.processor.postProcessor(n,a,t.isFragment,t.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{}));i?._features.needShaderCodeInlining&&(n=i.inlineShaderCode(n));return n}(e,t,n);i(a,e)}))}function qf(e){const t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new Of(t[1].trim(),"!"===e[0]);const i=["==","!=",">=","<=","<",">"];let n="",a=0;for(n of i)if(a=e.indexOf(n),a>-1)break;if(-1===a)return new Of(e);const s=e.substring(0,a).trim(),r=e.substring(a+n.length).trim();return new Ff(s,n,r)}function Jf(e,t){const i=new Pf,n=e.substring(0,t);let a=e.substring(t);return a=a.substring(0,(a.indexOf("//")+1||a.length+1)-1).trim(),i.testExpression="#ifdef"===n?new Of(a):"#ifndef"===n?new Of(a,!0):function(e){e=e.replace(Hf,"defined[$1]");const t=wf.infixToPostfix(e),i=[];for(const e of t)if("||"!==e&&"&&"!==e)i.push(e);else if(i.length>=2){let t=i[i.length-1],n=i[i.length-2];i.length-=2;const a="&&"==e?new Lf:new Df;"string"==typeof t&&(t=t.replace(Vf,"defined($1)")),"string"==typeof n&&(n=n.replace(Vf,"defined($1)")),a.leftOperand="string"==typeof n?qf(n):n,a.rightOperand="string"==typeof t?qf(t):t,i.push(a)}let n=i[i.length-1];return"string"==typeof n&&(n=n.replace(Vf,"defined($1)")),"string"==typeof n?qf(n):n}(a),i}function Qf(e,t,i){let n=e.currentLine;for(;Zf(e,i);){n=e.currentLine;const a=n.substring(0,5).toLowerCase();if("#else"===a){const i=new If;return t.children.push(i),void Zf(e,i)}if("#elif"===a){const e=Jf(n,5);t.children.push(e),i=e}}}function Zf(e,t){for(;e.canRead;){e.lineIndex++;const i=e.currentLine;if(i.indexOf("#")>=0){const n=Kf.exec(i);if(n&&n.length){switch(n[0]){case"#ifdef":{const n=new bf;t.children.push(n);const a=Jf(i,6);n.children.push(a),Qf(e,n,a);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const n=new bf;t.children.push(n);const a=Jf(i,7);n.children.push(a),Qf(e,n,a);break}case"#if":{const n=new bf,a=Jf(i,3);t.children.push(n),n.children.push(a),Qf(e,n,a);break}}continue}}const n=new If;if(n.line=i,t.children.push(n),"#"===i[0]&&"d"===i[1]){const e=i.replace(";","").split(" ");n.additionalDefineKey=e[1],3===e.length&&(n.additionalDefineValue=e[2])}}return!1}function eu(e,t,i){let n;for(jf.length=0;null!==(n=Wf.exec(e));)jf.push(n);let a=String(e),s=[e],r=!1;for(const e of jf){let n=e[1];if(-1!==n.indexOf("__decl__")&&(n=n.replace(zf,""),t.supportsUniformBuffers&&(n=n.replace("Vertex","Ubo").replace("Fragment","Ubo")),n+="Declaration"),!t.includesShadersStore[n]){const e=t.shadersRepository+"ShadersInclude/"+n+".fx";return void tu.loadFile(e,(e=>{t.includesShadersStore[n]=e,eu(s.join(""),t,i)}))}{let i=t.includesShadersStore[n];if(e[2]){const t=e[3].split(",");for(let e=0;e<t.length;e+=2){const n=new RegExp(t[e],"g"),a=t[e+1];i=i.replace(n,a)}}if(e[4]){const n=e[5];if(-1!==n.indexOf("..")){const e=n.split(".."),a=parseInt(e[0]);let s=parseInt(e[1]),r=i.slice(0);i="",isNaN(s)&&(s=t.indexParameters[e[1]]);for(let e=a;e<s;e++)t.supportsUniformBuffers||(r=r.replace(Xf,((e,t)=>t+"{X}"))),i+=r.replace(Yf,e.toString())+"\n"}else t.supportsUniformBuffers||(i=i.replace(Xf,((e,t)=>t+"{X}"))),i=i.replace(Yf,n)}const a=[];for(const t of s){const n=t.split(e[0]);for(let e=0;e<n.length-1;e++)a.push(n[e]),a.push(i);a.push(n[n.length-1])}s=a,r=r||i.indexOf("#include<")>=0||i.indexOf("#include <")>=0}}jf.length=0,a=s.join(""),r?eu(a.toString(),t,i):i(a)}var tu={loadFile:(e,t,i,n,a,s)=>{throw Qc("FileTools")}},iu=class{static SetImmediate(e){vf()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)}};c();var nu=class{setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setFloat3(e,t,i,n){this._cacheFloat3(e,t,i,n)&&(this.engine.setFloat3(this._uniforms[e],t,i,n)||(this._valueCache[e]=null))}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}get isAsync(){return this.isParallelCompiled}_cacheFloat2(e,t,i){let n=this._valueCache[e];if(!n||2!==n.length)return n=[t,i],this._valueCache[e]=n,!0;let a=!1;return n[0]!==t&&(n[0]=t,a=!0),n[1]!==i&&(n[1]=i,a=!0),a}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setInt3(e,t,i,n){this._cacheFloat3(e,t,i,n)&&(this.engine.setInt3(this._uniforms[e],t,i,n)||(this._valueCache[e]=null))}constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}setInt(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}dispose(){this._uniforms={},this._isDisposed=!0}setUInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setUInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setUInt(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}_fillEffectInformation(e,t,i,n,a,s,r,o){const l=this.engine;if(l.supportsUniformBuffers)for(const i in t)e.bindUniformBlock(i,t[i]);let c;for(this.engine.getUniforms(this,i).forEach(((e,t)=>{n[i[t]]=e})),this._uniforms=n,c=0;c<a.length;c++){null==e.getUniform(a[c])&&(a.splice(c,1),c--)}a.forEach(((e,t)=>{s[e]=t}));for(const e of l.getAttributes(this,r))o.push(e)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}_cacheFloat4(e,t,i,n,a){let s=this._valueCache[e];if(!s||4!==s.length)return s=[t,i,n,a],this._valueCache[e]=s,!0;let r=!1;return s[0]!==t&&(s[0]=t,r=!0),s[1]!==i&&(s[1]=i,r=!0),s[2]!==n&&(s[2]=n,r=!0),s[3]!==a&&(s[3]=a,r=!0),r}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}setInt4(e,t,i,n,a){this._cacheFloat4(e,t,i,n,a)&&(this.engine.setInt4(this._uniforms[e],t,i,n,a)||(this._valueCache[e]=null))}setUInt4(e,t,i,n,a){this._cacheFloat4(e,t,i,n,a)&&(this.engine.setUInt4(this._uniforms[e],t,i,n,a)||(this._valueCache[e]=null))}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setEngine(e){this.engine=e}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}_cacheMatrix(e,t){const i=this._valueCache[e],n=t.updateFlag;return(void 0===i||i!==n)&&(this._valueCache[e]=n,!0)}_cacheFloat3(e,t,i,n){let a=this._valueCache[e];if(!a||3!==a.length)return a=[t,i,n],this._valueCache[e]=a,!0;let s=!1;return a[0]!==t&&(a[0]=t,s=!0),a[1]!==i&&(a[1]=i,s=!0),a[2]!==n&&(a[2]=n,s=!0),s}setFloat4(e,t,i,n,a){this._cacheFloat4(e,t,i,n,a)&&(this.engine.setFloat4(this._uniforms[e],t,i,n,a)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setFloat2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setUInt3(e,t,i,n){this._cacheFloat3(e,t,i,n)&&(this.engine.setUInt3(this._uniforms[e],t,i,n)||(this._valueCache[e]=null))}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setFloat(e,t){const i=this._valueCache[e];void 0!==i&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setColor4(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null))}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}},au=new WeakMap,su={_webGLVersion:2,cachedPipelines:{}};function ru(e){let t=au.get(e);if(!t){if(!e)return su;t={_webGLVersion:e.TEXTURE_BINDING_3D?2:1,_context:e,cachedPipelines:{}},au.set(e,t)}return t}function ou(e,t,i,n,a,s){const r=ru(n);s||(s=r._createShaderProgramInjection??cu);return s(e,uu(t,"vertex",n,r._contextWasLost),uu(i,"fragment",n,r._contextWasLost),n,a,r.validateShaderPrograms)}function lu(e,t,i,n,a,s=null,r){const o=ru(a);r||(r=o._createShaderProgramInjection??cu);const l=o._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return r(e,fu(t,"vertex",n,l,a,o._contextWasLost),fu(i,"fragment",n,l,a,o._contextWasLost),a,s,o.validateShaderPrograms)}function cu(e,t,i,n,a=null,s){const r=n.createProgram();if(e.program=r,!r)throw new Error("Unable to create program");return n.attachShader(r,t),n.attachShader(r,i),n.linkProgram(r),e.context=n,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||hu(e,n,s),r}function hu(e,t,i){const n=e.context,a=e.vertexShader,s=e.fragmentShader,r=e.program;if(!n.getProgramParameter(r,n.LINK_STATUS)){if(!t.getShaderParameter(a,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(a);if(i)throw e.vertexCompilationError=i,new Error("VERTEX SHADER "+i)}if(!t.getShaderParameter(s,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(s);if(i)throw e.fragmentCompilationError=i,new Error("FRAGMENT SHADER "+i)}const i=n.getProgramInfoLog(r);if(i)throw e.programLinkError=i,new Error(i)}if(i){n.validateProgram(r);if(!n.getProgramParameter(r,n.VALIDATE_STATUS)){const t=n.getProgramInfoLog(r);if(t)throw e.programValidationError=t,new Error(t)}}n.deleteShader(a),n.deleteShader(s),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}function fu(e,t,i,n,a,s){return uu(Bf(e,i,n),t,a,s)}function uu(e,t,i,n){const a=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!a){let e=i.NO_ERROR,a=i.NO_ERROR;for(;(a=i.getError())!==i.NO_ERROR;)e=a;throw new Error(`Something went wrong while creating a gl ${t} shader object. gl error=${e}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${n}`)}return i.shaderSource(a,e),i.compileShader(a),a}function du(e){const t=e._name,i=e.context;if(t&&i){const e=ru(i),n=e.cachedPipelines[t];n?.dispose(),delete e.cachedPipelines[t]}}function mu(t,i,n,a,s,r){if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){return void a(yf(t))}if("source:"===t.substr(0,7))return void a(t.substr(7));if("base64:"===t.substr(0,7)){return void a(window.atob(t.substr(7)))}const o=e.GetShadersStore(s);if(o[t+i+"Shader"])return void a(o[t+i+"Shader"]);if(n&&o[t+n+"Shader"])return void a(o[t+n+"Shader"]);let l;if(l="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.GetShadersRepository(s)+t,!(r=r||Gf))throw new Error("loadFileInjection is not defined");r(l+"."+i.toLowerCase()+".fx",a)}c();var pu=class t{_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}get rawVertexSourceCode(){return this._rawVertexSourceCode}getUniformNames(){return this._uniformsNames}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat3(e,t,i,n){return this._pipelineContext.setFloat3(e,t,i,n),this}getIndexParameters(){return this._indexParameters}getAttributeLocation(e){return this._attributes[e]}static RegisterShader(t,i,n,a=0){i&&(e.GetShadersStore(a)[`${t}PixelShader`]=i),n&&(e.GetShadersStore(a)[`${t}VertexShader`]=n)}setFloat4(e,t,i,n,a){return this._pipelineContext.setFloat4(e,t,i,n,a),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}executeWhenCompiled(e){this.isReady()?e(this):(this.onCompileObservable.add((t=>{e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}get shaderLanguage(){return this._shaderLanguage}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}_processShaderCode(t=null,i=!1,n=null){this._processingContext=n||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);!function(e,t,i,n,a,s,r){let o,l;const c=vf()?s?.getHostDocument():null;o="string"==typeof t?t:t.vertexSource?"source:"+t.vertexSource:t.vertexElement?c?.getElementById(t.vertexElement)||t.vertexElement:t.vertex||t,l="string"==typeof t?t:t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?c?.getElementById(t.fragmentElement)||t.fragmentElement:t.fragment||t;const h=[void 0,void 0],f=()=>{if(h[0]&&h[1]){e.isFragment=!0;const[o,l]=h;$f(l,e,((s,l)=>{r&&(r._fragmentSourceCodeBeforeMigration=l),i&&(s=i("fragment",s));const c=function(e,t,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(e,t,i.processingContext):{vertexCode:e,fragmentCode:t}}(o,s,e);e=null;const h=function(e,t,i,n){return i?{vertexSourceCode:(1===n?"//":"")+"#define SHADER_NAME vertex:"+(i.vertexElement||i.vertex||i.spectorName||i)+"\n"+e,fragmentSourceCode:(1===n?"//":"")+"#define SHADER_NAME fragment:"+(i.fragmentElement||i.fragment||i.spectorName||i)+"\n"+t}:{vertexSourceCode:e,fragmentSourceCode:t}}(c.vertexCode,c.fragmentCode,t,a);n?.(h.vertexSourceCode,h.fragmentSourceCode)}),s)}};mu(o,"Vertex","",(t=>{var n;(n=e).processor&&n.processor.initializeShaders&&n.processor.initializeShaders(n.processingContext),$f(t,e,((e,n)=>{r&&(r._rawVertexSourceCode=t,r._vertexSourceCodeBeforeMigration=n),i&&(e=i("vertex",e)),h[0]=e,f()}),s)}),a),mu(l,"Fragment","Pixel",(e=>{r&&(r._rawFragmentSourceCode=e),h[1]=e,f()}),a)}({defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:t??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:e.GetShadersRepository(this._shaderLanguage),includesShadersStore:e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes},this.name,this._processFinalCode,((e,t)=>{this._vertexSourceCode=e,this._fragmentSourceCode=t,this._prepareEffect(i)}),this._shaderLanguage,this._engine,this)}static ResetCache(){t._BaseCache={}}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}getUniform(e){return this._uniforms[e]}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}isReady(){try{return this._isReadyInternal()}catch{return!1}}setUInt3(e,t,i,n){return this._pipelineContext.setUInt3(e,t,i,n),this}_checkIsReady(e){try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}this._isDisposed||setTimeout((()=>{this._checkIsReady(e)}),16)}setUInt2(e,t,i){return this._pipelineContext.setUInt2(e,t,i),this}setColor4(e,t,i){return this._pipelineContext.setColor4(e,t,i),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setTextureArray(e,t){const i=e+"Ex";if(-1===this._samplerList.indexOf(i+"0")){const n=this._samplerList.indexOf(e);for(let e=1;e<t.length;e++){const t=i+(e-1).toString();this._samplerList.splice(n+e,0,t)}let a=0;for(const e of this._samplerList)this._samplers[e]=a,a+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Ih),this._onBindObservable}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}static get ShadersRepository(){return e.ShadersRepository}get key(){return this._key}constructor(e,i,n,a=null,s,r=null,o=null,l=null,c=null,h,f="",u=0){this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.xt=0,this.onCompileObservable=new Ih,this.onErrorObservable=new Ih,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=e,this._key=f;const d=this._key.replace(/\r/g,"").replace(/\n/g,"|");let m;if(i.attributes){const e=i;if(this._engine=n,this._attributesNames=e.attributes,this._uniformsNames=e.uniformsNames.concat(e.samplers),this._samplerList=e.samplers.slice(),this.defines=e.defines,this.onError=e.onError,this.onCompiled=e.onCompiled,this._fallbacks=e.fallbacks,this._indexParameters=e.indexParameters,this._transformFeedbackVaryings=e.transformFeedbackVaryings||null,this._multiTarget=!!e.multiTarget,this._shaderLanguage=e.shaderLanguage??0,e.uniformBuffersNames){this._uniformBuffersNamesList=e.uniformBuffersNames.slice();for(let t=0;t<e.uniformBuffersNames.length;t++)this._uniformBuffersNames[e.uniformBuffersNames[t]]=t}this._processFinalCode=e.processFinalCode??null,this._processCodeAfterIncludes=e.processCodeAfterIncludes??void 0,m=e.existingPipelineContext}else this._engine=s,this.defines=null==r?"":r,this._uniformsNames=n.concat(a),this._samplerList=a?a.slice():[],this._attributesNames=i,this._uniformBuffersNamesList=[],this._shaderLanguage=u,this.onError=c,this.onCompiled=l,this._indexParameters=h,this._fallbacks=o;var p;"WEBGL2"===this._engine.shaderPlatformName&&(p=d,m=ru(this._engine._gl).cachedPipelines[p]??m),this._attributeLocationByName={},this.xt=t._UniqueIdSeed++,m?(this._pipelineContext=m,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCode()}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}static set ShadersRepository(t){e.ShadersRepository=t}_prepareEffect(e=!1){const t=this._pipelineContext;this._isReady=!1;try{const i=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),n=i?null:this.defines,a=i?this._vertexSourceCodeOverride:this._vertexSourceCode,s=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,r=this._engine;this._pipelineContext=((e,t,i,n)=>{try{const a=e.existingPipelineContext||t(e.shaderProcessingContext);return a._name=e.name,e.name&&e.context&&(ru(e.context).cachedPipelines[e.name]=a),i(a,e.vertex,e.fragment,!!e.createAsRaw,"","",e.rebuildRebind,e.defines,e.transformFeedbackVaryings,"",(()=>{n(a,(()=>{e.onRenderingStateCompiled?.(a)}))})),a}catch(e){throw jh.Error("Error compiling effect"),e}})({existingPipelineContext:e?t:null,vertex:a,fragment:s,context:"WEBGL2"===r.shaderPlatformName?r._gl:void 0,rebuildRebind:(e,t,i,n)=>this._rebuildProgram(e,t,i,n),defines:n,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,parallelShaderCompile:r._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:i=>{t&&!e&&this._engine._deletePipelineContext(t),i&&this._onRenderingStateCompiled(i)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(e){this._processCompilationErrors(e,t)}}_processCompilationErrors(e,i=null){this._compilationError=e.message;const n=this._attributesNames,a=this._fallbacks;if(jh.Error("Unable to compile effect:"),jh.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),jh.Error("Attributes: "+n.map((function(e){return" "+e}))),jh.Error("Defines:\n"+this.defines),t.LogShaderCodeOnCompilationError){let e=null,t=null,i=null;this._pipelineContext?._getVertexShaderCode()&&([i,e]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),i&&(jh.Error("Vertex code:"),jh.Error(i))),this._pipelineContext?._getFragmentShaderCode()&&([i,t]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),i&&(jh.Error("Fragment code:"),jh.Error(i))),e&&jh.Error(e),t&&jh.Error(t)}jh.Error("Error: "+this._compilationError);const s=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};i&&(this._pipelineContext=i,this._isReady=!0,s()),a?(this._pipelineContext=null,a.hasMoreFallbacks?(this._allFallbacksProcessed=!1,jh.Error("Trying next fallback."),this.defines=a.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,s(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,i||s())}getUniformIndex(e){return this._uniformsNames.indexOf(e)}get vertexSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}setUInt4(e,t,i,n,a){return this._pipelineContext.setUInt4(e,t,i,n,a),this}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setInt4(e,t,i,n,a){return this._pipelineContext.setInt4(e,t,i,n,a),this}getSamplers(){return this._samplerList}bindUniformBuffer(e,i){const n=this._uniformBuffersNames[i];void 0===n||t._BaseCache[n]===e&&this._engine._features.useUBOBindingCache||(t._BaseCache[n]=e,this._engine.bindUniformBufferBase(e,n,i))}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}get isSupported(){return""===this._compilationError}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}getAttributesCount(){return this._attributes.length}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&du(this._pipelineContext),this._engine._releaseEffect(this),this._isDisposed=!0)}getAttributesNames(){return this._attributesNames}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}setInt2(e,t,i){return this._pipelineContext.setInt2(e,t,i),this}_getShaderCodeAndErrorLine(e,t,i){const n=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let a=null;if(t&&e){const s=t.match(n);if(s&&2===s.length){const t=parseInt(s[1]),n=e.split("\n",-1);n.length>=t&&(a=`Offending line [${t}] in ${i?"fragment":"vertex"} code: ${n[t-1]}`)}}return[e,a]}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}get fragmentSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}getEngine(){return this._engine}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}_isReadyInternal(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}setArray(e,t){return this._pipelineContext.setArray(e,t),this}getCompilationError(){return this._compilationError}getUniformBuffersNames(){return this._uniformBuffersNamesList}setInt3(e,t,i,n){return this._pipelineContext.setInt3(e,t,i,n),this}getAttributeLocationByName(e){return this._attributeLocationByName[e]}_onRenderingStateCompiled(e){if(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let e=0;e<this._attributesNames.length;e++){const t=this._attributesNames[e];this._attributeLocationByName[t]=this._attributes[e]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh()}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}getPipelineContext(){return this._pipelineContext}setFloat2(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}_rebuildProgram(e,t,i,n){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(e,t)=>{n&&n(t)},this.onCompiled=()=>{const e=this.getEngine().scenes;if(e)for(let t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);this._pipelineContext._handlesSpectorRebuildCallback?.(i)},this._fallbacks=null,this._prepareEffect()}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}allFallbacksProcessed(){return this._allFallbacksProcessed}};pu.LogShaderCodeOnCompilationError=!0,pu._UniqueIdSeed=0,pu._BaseCache={},pu.ShadersStore=e.ShadersStore,pu.IncludesShadersStore=e.IncludesShadersStore;var _u=class{get zOffsetUnits(){return this._zOffsetUnits}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}get cull(){return this._cull}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}get zOffset(){return this._zOffset}get depthFunc(){return this._depthFunc}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get frontFace(){return this._frontFace}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get depthTest(){return this._depthTest}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}},vu=class{set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opDepthFail(){return this._opDepthFail}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get funcMask(){return this._funcMask}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get func(){return this._func}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilFail(){return this._opStencilFail}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get enabled(){return this._enabled}get opStencilDepthPass(){return this._opStencilDepthPass}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}reset(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}get funcRef(){return this._funcRef}apply(e){if(!e)return;const t=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get mask(){return this._mask}},gu=class e{reset(){this.enabled=!1,this.mask=255,this.func=e.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE}get stencilOpStencilFail(){return this.opStencilFail}get stencilFuncMask(){return this.funcMask}get stencilFuncRef(){return this.funcRef}set stencilFunc(e){this.func=e}get stencilFunc(){return this.func}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}set stencilFuncRef(e){this.funcRef=e}set stencilTest(e){this.enabled=e}constructor(){this.reset()}get stencilOpDepthFail(){return this.opDepthFail}set stencilFuncMask(e){this.funcMask=e}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilTest(){return this.enabled}};gu.ALWAYS=519,gu.KEEP=7680,gu.REPLACE=7681;var Su,yu,Eu=class{setAlphaBlendFunctionParameters(e,t,i,n){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===n||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)}set alphaBlend(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}setAlphaEquationParameters(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}setAlphaBlendConstants(e,t,i,n){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===n||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=n,this._isBlendConstantsDirty=!0)}get alphaBlend(){return this._alphaBlend}constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}apply(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}},Au=class{constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}set comparisonFunction(e){this._comparisonFunction=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}get useMipMaps(){return this._useMipMaps}get comparisonFunction(){return this._comparisonFunction}set useMipMaps(e){this._useMipMaps=e}set wrapU(e){this._cachedWrapU=e}get wrapR(){return this._cachedWrapR}get wrapU(){return this._cachedWrapU}setParameters(e=1,t=1,i=1,n=1,a=2,s=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=n,this.samplingMode=a,this._comparisonFunction=s,this}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}set wrapR(e){this._cachedWrapR=e}};(yu=Su||(Su={}))[yu.Unknown=0]="Unknown",yu[yu.Url=1]="Url",yu[yu.Temp=2]="Temp",yu[yu.Raw=3]="Raw",yu[yu.Dynamic=4]="Dynamic",yu[yu.RenderTarget=5]="RenderTarget",yu[yu.MultiRenderTarget=6]="MultiRenderTarget",yu[yu.Cube=7]="Cube",yu[yu.CubeRaw=8]="CubeRaw",yu[yu.CubePrefiltered=9]="CubePrefiltered",yu[yu.Raw3D=10]="Raw3D",yu[yu.Raw2DArray=11]="Raw2DArray",yu[yu.DepthStencil=12]="DepthStencil",yu[yu.CubeRawRGBD=13]="CubeRawRGBD",yu[yu.Depth=14]="Depth";var Cu=class e extends Au{updateSize(e,t,i=1){this._engine.updateTextureDimensions(this,e,t,i),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i}incrementReferences(){this._references++}get xt(){return this._uniqueId}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const e=this.onRebuildCallback(this),t=t=>{t._swapAndDie(this,!1),this.isReady=e.isReady};return void(e.isAsync?e.proxy.then(t):t(e.proxy))}let e;switch(this.source){case 2:case 12:case 14:break;case 1:return void(e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(e=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case 10:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 11:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 4:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(e=>{e&&e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(e._sphericalPolynomial=this._sphericalPolynomial)}}get useMipMaps(){return this.generateMipMaps}_swapAndDie(e,t=!0){this._hardwareTexture?.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);const i=this._engine.getLoadedTexturesCache();let n=i.indexOf(this);-1!==n&&i.splice(n,1),n=i.indexOf(e),-1===n&&i.push(e)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}constructor(t,i,n=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new Ih,this.onErrorObservable=new Ih,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=t,this._source=i,this._uniqueId=e._Counter++,n||(this._hardwareTexture=t._createHardwareTexture())}set useMipMaps(e){this.generateMipMaps=e}getEngine(){return this._engine}get source(){return this._source}_setUniqueId(e){this._uniqueId=e}};function Ru(e,t){if(vf()){const{requestAnimationFrame:i}=t||window;if("function"==typeof i)return i(e)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(e);return setTimeout(e,16)}Cu._Counter=0;var Tu=class e{static _CreateCanvas(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);const i=document.createElement("canvas");return i.width=e,i.height=t,i}set snapshotRendering(e){}get name(){return this._name}_rebuildTextures(){for(const e of this.scenes)e._rebuildTextures();for(const e of this._virtualScenes)e._rebuildTextures()}setSize(e,t,i=!1){if(!this._renderingCanvas)return!1;if(e|=0,t|=0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let e=0;e<this.scenes.length;e++){const t=this.scenes[e];for(let e=0;e<t.cameras.length;e++){t.cameras[e]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}get isStencilEnable(){return this._isStencilEnable}getDeltaTime(){return this._deltaTime}_reportDrawCall(e=1){this._drawCalls?.addCount(e,!1)}resize(e=!1){let t,i;if(this.adaptToDeviceRatio){const e=vf()&&window.devicePixelRatio||1,t=this._lastDevicePixelRatio/e;this._lastDevicePixelRatio=e,this._hardwareScalingLevel*=t}if(vf()&&Sf())if(this._renderingCanvas){const e=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};t=this._renderingCanvas.clientWidth||e.width||this._renderingCanvas.width||100,i=this._renderingCanvas.clientHeight||e.height||this._renderingCanvas.height||100}else t=window.innerWidth,i=window.innerHeight;else t=this._renderingCanvas?this._renderingCanvas.width:100,i=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,i/this._hardwareScalingLevel,e)}static _FileToolsLoadImage(e,t,i,n,a,s){throw Qc("FileTools")}getFps(){return this._fps}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)}get stencilStateComposer(){return this._stencilStateComposer}_rebuildEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}pu.ResetCache()}isDeterministicLockStep(){return this._deterministicLockstep}get compatibilityMode(){return this._compatibilityMode}_rebuildGraphicsResources(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}getZOffset(){const e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}constructor(e,t,i){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new _u,this._stencilStateComposer=new vu,this._stencilState=new gu,this._alphaState=new Eu,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new Ih,this.onCanvasFocusObservable=new Ih,this.onNewSceneAddedObservable=new Ih,this.onResizeObservable=new Ih,this.onCanvasPointerOutObservable=new Ih,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new Ih,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new Ih,this.onAfterShaderCompilationObservable=new Ih,this.onBeginFrameObservable=new Ih,this.onEndFrameObservable=new Ih,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new Ih,this.onContextRestoredObservable=new Ih,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new Ih,xh.Instances.push(this),this.startTime=Cf.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,Th.SetMatrixPrecision(!!t.useHighPrecisionMatrix),gf()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=i??!1,t.antialias=e??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.audioEngine=t.audioEngine??!0,t.stencil=t.stencil??!0,this._audioContext=t.audioEngineOptions?.audioContext??null,this._audioDestination=t.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;const n=vf()&&window.devicePixelRatio||1,a=t.limitDeviceRatio||n;i=i||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=i?1/Math.min(a,n):1,this._lastDevicePixelRatio=n,this._creationOptions=t}getLoadedTexturesCache(){return this._internalTexturesCache}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}get frameId(){return this._frameId}_rebuildBuffers(){for(const e of this._uniformBuffers)e._rebuildAfterContextLost()}get stencilState(){return this._stencilState}createImageBitmap(e,t){return createImageBitmap(e,t)}get depthCullingState(){return this._depthCullingState}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getAudioDestination(){return this._audioDestination}set compatibilityMode(e){this._compatibilityMode=!0}get snapshotRendering(){return!1}get doNotHandleContextLost(){return this._doNotHandleContextLost}getZOffsetUnits(){const e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}getAudioContext(){return this._audioContext}getTimeStep(){return 1e3*this._timeStep}createRawTexture2DArray(e,t,i,n,a,s,r,o,l,c,h){throw Qc("engine.rawTexture")}getFontOffset(e){throw new Error("getFontOffset is not implemented")}_loadFile(e,t,i,n,a,s){const r=Gf(e,t,i,n,a,s);return this._activeRequests.push(r),r.onCompleteObservable.add((()=>{const e=this._activeRequests.indexOf(r);-1!==e&&this._activeRequests.splice(e,1)})),r}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}getHostWindow(){return vf()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}createCanvasImage(){return document.createElement("img")}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get isDisposed(){return this._isDisposed}dispose(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();this.releaseComputeEffects?.(),pu.ResetCache();for(const e of this._activeRequests)e.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),vf()&&window.removeEventListener("resize",this._checkForMobile);const e=xh.Instances.indexOf(this);e>=0&&xh.Instances.splice(e,1),xh.Instances.length||(xh.OnEnginesDisposedObservable.notifyObservers(this),xh.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}get currentViewport(){return this._cachedViewport}_restoreEngineAfterContextLost(e){setTimeout((async()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,i=this._depthCullingState.depthFunc,n=this._depthCullingState.depthMask,a=this._stencilState.stencilTest;await e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=i,this._depthCullingState.depthMask=n,this._stencilState.stencilTest=a,this._flagContextRestored()}),0)}set name(e){this._name=e}set snapshotRenderingMode(e){}setDepthBuffer(e){this._depthCullingState.depthTest=e}_createTextureBase(t,i,n,a,s=3,r=null,o=null,l,c,h=null,f=null,u=null,d=null,m,p,_){const v="data:"===(t=t||"").substr(0,5),g="blob:"===t.substr(0,5),S=v&&-1!==t.indexOf(";base64,"),y=f||new Cu(this,1);y!==f&&(y.label=t.substring(0,60));const E=t;!this._transformTextureUrl||S||f||h||(t=this._transformTextureUrl(t)),E!==t&&(y._originalUrl=E);const A=t.lastIndexOf(".");let C=d||(A>-1?t.substring(A).toLowerCase():""),R=null;C.indexOf("?")>-1&&(C=C.split("?")[0]);for(const t of e._TextureLoaders)if(t.canLoad(C,m)){R=t;break}a&&a.addPendingData(y),y.url=t,y.generateMipMaps=!i,y.samplingMode=s,y.invertY=n,y._useSRGBBuffer=this._getUseSRGBBuffer(!!_,i),this._doNotHandleContextLost||(y._buffer=h);let T=null;r&&!f&&(T=y.onLoadedObservable.add(r)),f||this._internalTexturesCache.push(y);const N=(e,n)=>{a&&a.removePendingData(y),t===E?(T&&y.onLoadedObservable.remove(T),xh.UseFallbackTexture&&t!==xh.FallbackTexture&&this._createTextureBase(xh.FallbackTexture,i,y.invertY,a,s,null,o,l,c,h,y),e=(e||"Unknown error")+(xh.UseFallbackTexture?" - Fallback texture was used":""),y.onErrorObservable.notifyObservers({message:e,exception:n}),o&&o(e,n)):(jh.Warn(`Failed to load ${t}, falling back to ${E}`),this._createTextureBase(E,i,y.invertY,a,s,r,o,l,c,h,y,u,d,m,p,_))};if(R){const e=e=>{R.loadData(e,y,((e,t,i,n,r,o)=>{o?N("TextureLoader failed to load data"):l(y,C,a,{width:e,height:t},y.invertY,!i,n,(()=>(r(),!1)),s)}),p)};h?h instanceof ArrayBuffer?e(new Uint8Array(h)):ArrayBuffer.isView(h)?e(h):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(t=>e(new Uint8Array(t))),void 0,a?a.offlineProvider:void 0,!0,((e,t)=>{N("Unable to load "+(e&&e.responseURL,t))}))}else{const n=e=>{g&&!this._doNotHandleContextLost&&(y._buffer=e),l(y,C,a,e,y.invertY,i,!1,c,s)};!v||S?h&&("string"==typeof h.decoding||h.close)?n(h):e._FileToolsLoadImage(t||"",n,N,a?a.offlineProvider:null,m,y.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof h||h instanceof ArrayBuffer||ArrayBuffer.isView(h)||h instanceof Blob?e._FileToolsLoadImage(h,n,N,a?a.offlineProvider:null,m,y.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):h&&n(h)}return y}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}createRawTexture3D(e,t,i,n,a,s,r,o,l,c,h){throw Qc("engine.rawTexture")}static _FileToolsLoadFile(e,t,i,n,a,s){if(kf.loadFile)return kf.loadFile(e,t,i,n,a,s);throw Qc("FileTools")}_queueNewFrame(e,t){return Ru(e,t)}_getShaderProcessor(e){return this._shaderProcessor}_renderViews(){return!1}getLockstepMaxSteps(){return this._lockstepMaxSteps}getColorWrite(){return this._colorWrite}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}getRenderingCanvas(){return this._renderingCanvas}createVideoElement(e){return document.createElement("video")}getHardwareScalingLevel(){return this._hardwareScalingLevel}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}static get Version(){return"7.21.1"}getCaps(){return this._caps}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_releaseRenderTargetWrapper(e){const t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}createRawCubeTexture(e,t,i,n,a,s,r,o){throw Qc("engine.rawTexture")}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}}clearInternalTexturesCache(){this._internalTexturesCache.length=0}stopRenderLoop(e){if(!e)return this._activeRenderLoops.length=0,void this._cancelFrame();const t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),0==this._activeRenderLoops.length&&this._cancelFrame())}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:Sf()?document:null}static DefaultLoadingScreenFactory(e){throw Qc("LoadingScreen")}resetTextureCache(){for(const e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}getClassName(){return"AbstractEngine"}_getGlobalDefines(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);{let e="";return this.isNDCHalfZRange&&(e+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}get activeRenderLoops(){return this._activeRenderLoops}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get snapshotRenderingMode(){return 0}get alphaState(){return this._alphaState}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}_rebuildInternalTextures(){const e=this._internalTexturesCache.slice();for(const t of e)t._rebuild()}_cancelFrame(){if(0!==this._frameHandler){const e=this._frameHandler;if(this._frameHandler=0,vf()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if("function"==typeof t)return t(e)}else if("function"==typeof cancelAnimationFrame)return cancelAnimationFrame(e);return clearTimeout(e)}}get isWebGPU(){return this._isWebGPU}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}get emptyCubeTexture(){if(!this._emptyCubeTexture){const e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}static get NpmPackage(){return"babylonjs@7.21.1"}getDepthBuffer(){return this._depthCullingState.depthTest}_createImageBitmapFromSource(e,t){throw new Error("createImageBitmapFromSource is not implemented")}setViewport(e,t,i){const n=t||this.getRenderWidth(),a=i||this.getRenderHeight(),s=e.x||0,r=e.y||0;this._cachedViewport=e,this._viewport(s*n,r*a,n*e.width,a*e.height)}_flagContextRestored(){jh.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}get shaderPlatformName(){return this._shaderPlatformName}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}resizeImageBitmap(e,t,i){throw new Error("resizeImageBitmap is not implemented")}createCanvas(t,i){return e._CreateCanvas(t,i)}getCreationOptions(){return this._creationOptions}_rebuildRenderTargetWrappers(){const e=this._renderTargetWrapperCache.slice();for(const t of e)t._rebuild()}_sharedInit(e){this._renderingCanvas=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const e=navigator.userAgent;this.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&Sf()&&"ontouchend"in document},this._checkForMobile(),vf()&&window.addEventListener("resize",this._checkForMobile))}createRawTexture(e,t,i,n,a,s,r,o,l,c,h){throw Qc("engine.rawTexture")}qt(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}};Tu._TextureLoaders=[],Tu._RenderPassIdCounter=0,Tu._RescalePostProcessFactory=null;var Nu=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),Mu=class e extends tf{constructor(t,i){super(t,ef.LoadFileError),this.name="LoadFileError",Zh._setPrototypeOf(this,e.prototype),i instanceof Rf?this.request=i:this.file=i}},Iu=class e extends tf{constructor(t,i){super(t,ef.RequestFileError),this.request=i,this.name="RequestFileError",Zh._setPrototypeOf(this,e.prototype)}},xu=class e extends tf{constructor(t,i){super(t,ef.ReadFileError),this.file=i,this.name="ReadFileError",Zh._setPrototypeOf(this,e.prototype)}},bu={DefaultRetryStrategy:class{static ExponentialBackoff(e=3,t=500){return(i,n,a)=>0!==n.status||a>=e||-1!==i.indexOf("file:")?-1:Math.pow(2,a)*t}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:e=>e=e.replace(/#/gm,"%23")},Pu=(e,t)=>{if((!e||0!==e.indexOf("data:"))&&bu.CorsBehavior)if("string"==typeof bu.CorsBehavior||bu.CorsBehavior instanceof String)t.crossOrigin=bu.CorsBehavior;else{const i=bu.CorsBehavior(e);i&&(t.crossOrigin=i)}},wu=(e,t,i,n,a="",s)=>{const r=xh.LastCreatedEngine;if("undefined"==typeof HTMLImageElement&&!r?._features.forceBitmapOverHTMLImageElement)return i("LoadImage is only supported in web or BabylonNative environments."),null;let o,l=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(o=URL.createObjectURL(new Blob([e],{type:a})),l=!0):o=`data:${a};base64,`+Nf(e):e instanceof Blob?(o=URL.createObjectURL(e),l=!0):(o=bu.CleanUrl(e),o=bu.PreprocessUrl(o));const c=t=>{if(i){const n=o||e.toString();i(`Error while trying to load image: ${0===n.indexOf("http")||n.length<=128?n:n.slice(0,128)+"..."}`,t)}};if(r?._features.forceBitmapOverHTMLImageElement)return Du(o,(n=>{r.createImageBitmap(new Blob([n],{type:a}),{premultiplyAlpha:"none",...s}).then((e=>{t(e),l&&URL.revokeObjectURL(o)})).catch((t=>{i&&i("Error while trying to load image: "+e,t)}))}),void 0,n||void 0,!0,((e,t)=>{c(t)})),null;const h=new Image;Pu(o,h);const f=[],u=()=>{f.forEach((e=>{e.target.removeEventListener(e.name,e.handler)})),f.length=0};f.push({target:h,name:"load",handler:()=>{u(),t(h),l&&h.src&&URL.revokeObjectURL(h.src)}}),f.push({target:h,name:"error",handler:e=>{u(),c(e),l&&h.src&&URL.revokeObjectURL(h.src)}}),f.push({target:document,name:"securitypolicyviolation",handler:e=>{if(e.blockedURI!==h.src)return;u();const t=new Error(`CSP violation of policy ${e.effectiveDirective} ${e.blockedURI}. Current policy is ${e.originalPolicy}`);xh.UseFallbackTexture=!1,c(t),l&&h.src&&URL.revokeObjectURL(h.src),h.src=""}}),f.forEach((e=>{e.target.addEventListener(e.name,e.handler)}));const d="blob:"===o.substring(0,5),m="data:"===o.substring(0,5),p=()=>{d||m||!Rf.IsCustomRequestAvailable?h.src=o:Du(o,((e,t,i)=>{const n=new Blob([e],{type:!a&&i?i:a}),s=URL.createObjectURL(n);l=!0,h.src=s}),void 0,n||void 0,!0,((e,t)=>{c(t)}))},_=()=>{n&&n.loadImage(o,h)};if(!d&&!m&&n&&n.enableTexturesOffline)n.open(_,p);else{if(-1!==o.indexOf("file:")){const e=decodeURIComponent(o.substring(5).toLowerCase());if(Tf.FilesToLoad[e]&&"undefined"!=typeof URL){try{let t;try{t=URL.createObjectURL(Tf.FilesToLoad[e])}catch(i){t=URL.createObjectURL(Tf.FilesToLoad[e])}h.src=t,l=!0}catch(e){h.src=""}return h}}p()}return h},Ou=(e,t,i,n,a)=>{const s=new FileReader,r={onCompleteObservable:new Ih,abort:()=>s.abort()};return s.onloadend=()=>r.onCompleteObservable.notifyObservers(r),a&&(s.onerror=()=>{a(new xu(`Unable to read ${e.name}`,e))}),s.onload=e=>{t(e.target.result)},i&&(s.onprogress=i),n?s.readAsArrayBuffer(e):s.readAsText(e),r},Du=(e,t,i,n,a,s,r)=>{if(e.name)return Ou(e,t,i,a,s?e=>{s(void 0,e)}:void 0);const o=e;if(-1!==o.indexOf("file:")){let e=decodeURIComponent(o.substring(5).toLowerCase());0===e.indexOf("./")&&(e=e.substring(2));const n=Tf.FilesToLoad[e];if(n)return Ou(n,t,i,a,s?e=>s(void 0,new Mu(e.message,e.file)):void 0)}const{match:l,type:c}=Bu(o);if(l){const e={onCompleteObservable:new Ih,abort:()=>()=>{}};try{const e=a?Gu(o):Hu(o);t(e,void 0,c)}catch(e){s?s(void 0,e):jh.Error(e.message||"Failed to parse the Data URL")}return iu.SetImmediate((()=>{e.onCompleteObservable.notifyObservers(e)})),e}return Lu(o,((e,i)=>{t(e,i?.responseURL,i?.getResponseHeader("content-type"))}),i,n,a,s?e=>{s(e.request,new Mu(e.message,e.request))}:void 0,r)},Lu=(e,t,i,n,a,s,r)=>{e=bu.CleanUrl(e),e=bu.PreprocessUrl(e);const o=bu.BaseUrl+e;let l=!1;const c={onCompleteObservable:new Ih,abort:()=>l=!0},h=()=>{let e,n=new Rf,h=null;const f=()=>{n&&(i&&n.removeEventListener("progress",i),e&&n.removeEventListener("readystatechange",e),n.removeEventListener("loadend",u))};let u=()=>{f(),c.onCompleteObservable.notifyObservers(c),c.onCompleteObservable.clear(),i=void 0,e=null,u=null,s=void 0,r=void 0,t=void 0};c.abort=()=>{l=!0,u&&u(),n&&n.readyState!==(XMLHttpRequest.DONE||4)&&n.abort(),null!==h&&(clearTimeout(h),h=null),n=null};const d=e=>{const t=e.message||"Unknown error";s&&n?s(new Iu(t,n)):jh.Error(t)},m=c=>{if(n){if(n.open("GET",o),r)try{r(n)}catch(e){return void d(e)}a&&(n.responseType="arraybuffer"),i&&n.addEventListener("progress",i),u&&n.addEventListener("loadend",u),e=()=>{if(!l&&n&&n.readyState===(XMLHttpRequest.DONE||4)){if(e&&n.removeEventListener("readystatechange",e),n.status>=200&&n.status<300||0===n.status&&(!vf()||Fu())){try{t&&t(a?n.response:n.responseText,n)}catch(e){d(e)}return}const i=bu.DefaultRetryStrategy;if(i){const e=i(o,n,c);if(-1!==e)return f(),n=new Rf,void(h=setTimeout((()=>m(c+1)),e))}const r=new Iu("Error status: "+n.status+" "+n.statusText+" - Unable to load "+o,n);s&&s(r)}},n.addEventListener("readystatechange",e),n.send()}};m(0)};if(n&&n.enableSceneOffline){const r=e=>{e&&e.status>400?s&&s(e):h()},o=()=>{n&&n.loadFile(bu.BaseUrl+e,(e=>{!l&&t&&t(e),c.onCompleteObservable.notifyObservers(c)}),i?e=>{!l&&i&&i(e)}:void 0,r,a)};n.open(o,r)}else h();return c},Fu=()=>"undefined"!=typeof location&&"file:"===location.protocol,ku=e=>Nu.test(e),Bu=e=>{const t=Nu.exec(e);if(null===t||0===t.length)return{match:!1,type:""};return{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function Gu(e){return(e=>{const t=Mf(e),i=t.length,n=new Uint8Array(new ArrayBuffer(i));for(let e=0;e<i;e++)n[e]=t.charCodeAt(e);return n.buffer})(e.split(",")[1])}var Uu,Hu=e=>Mf(e.split(",")[1]);Tu._FileToolsLoadImage=wu,kf.loadFile=Du,tu.loadFile=Du;var Vu,Wu,zu,Xu,Yu,ju,Ku,$u;Wu=ku,zu=Fu,Xu=Du,Yu=wu,ju=Ou,Ku=Lu,$u=Pu,Uu={DecodeBase64UrlToBinary:Gu,DecodeBase64UrlToString:Hu,DefaultRetryStrategy:(Vu=bu).DefaultRetryStrategy,BaseUrl:Vu.BaseUrl,CorsBehavior:Vu.CorsBehavior,PreprocessUrl:Vu.PreprocessUrl,IsBase64DataUrl:Wu,IsFileURL:zu,LoadFile:Xu,LoadImage:Yu,ReadFile:ju,RequestFile:Ku,SetCorsBehavior:$u},Object.defineProperty(Uu,"DefaultRetryStrategy",{get:function(){return Vu.DefaultRetryStrategy},set:function(e){Vu.DefaultRetryStrategy=e}}),Object.defineProperty(Uu,"BaseUrl",{get:function(){return Vu.BaseUrl},set:function(e){Vu.BaseUrl=e}}),Object.defineProperty(Uu,"PreprocessUrl",{get:function(){return Vu.PreprocessUrl},set:function(e){Vu.PreprocessUrl=e}}),Object.defineProperty(Uu,"CorsBehavior",{get:function(){return Vu.CorsBehavior},set:function(e){Vu.CorsBehavior=e}});var qu=class{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];const t=oh(e);if(t)return t;jh.Warn(e+" not found, you may have missed an import.");const i=e.split(".");let n=window||this;for(let e=0,t=i.length;e<t;e++)n=n[i[e]];return"function"!=typeof n?null:n}};function Ju(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function Qu(e){let t=1;do{t*=2}while(t<e);return t===e}function Zu(e,t,i){return e*(1-i)+t*i}function ed(e){const t=td(e),i=id(e);return t-e>e-i?i:t}function td(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function id(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)}function nd(e,t,i=2){let n;switch(i){case 1:n=id(e);break;case 2:n=ed(e);break;default:n=td(e)}return Math.min(n,t)}qu.RegisteredExternalClasses={};var ad=class e{static FileAsURL(e){const t=new Blob([e]);return window.URL.createObjectURL(t)}static CreateScreenshotUsingRenderTarget(e,t,i,n,a="image/png",s=1,r=!1,o,l=!1,c=!1,h=!0,f){throw Qc("ScreenshotTools")}static GetFilename(e){const t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static _EndPerformanceConsole(t,i=!0){i&&(e._EndUserMark(t,i),console.timeEnd(t))}static Mix(e,t,i){return 0}static set CorsBehavior(e){bu.CorsBehavior=e}static get PreprocessUrl(){return bu.PreprocessUrl}static ReadFile(e,t,i,n,a){return Ou(e,t,i,n,a)}static GetPointerPrefix(e){let t="pointer";return vf()&&!window.PointerEvent&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document||(t="mouse"),t}static _StartPerformanceConsole(t,i=!0){i&&(e._StartUserMark(t,i),console.time&&console.time(t))}static Format(e,t=2){return e.toFixed(t)}static _EndPerformanceCounterDisabled(e,t){}static _IsOffScreenCanvas(e){return void 0!==e.convertToBlob}static get errorsCount(){return jh.errorsCount}static get ScriptPreprocessUrl(){return bu.ScriptPreprocessUrl}static LoadImage(e,t,i,n,a,s){return wu(e,t,i,n,a,s)}static getFullClassName(e,t=!1){let i=null,n=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){const a=t?e:Object.getPrototypeOf(e);i=a.constructor.__bjsclassName__,n=a.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(null!=n?n+".":"")+i:null}static get UseFallbackTexture(){return xh.UseFallbackTexture}static Warn(e){jh.Warn(e)}static CreateScreenshot(e,t,i,n,a="image/png",s=!1,r){throw Qc("ScreenshotTools")}static CreateScreenshotAsync(e,t,i,n="image/png",a){throw Qc("ScreenshotTools")}static BackCompatCameraNoPreventDefault(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]}static GetFolderPath(e,t=!1){const i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)}static LoadFileAsync(e,t=!0){return new Promise(((i,n)=>{Du(e,(e=>{i(e)}),void 0,void 0,t,((e,t)=>{n(t)}))}))}static GetBabylonScriptURL(t,i){if(!t)return"";if(e.ScriptBaseUrl&&t.startsWith(e._DefaultCdnUrl)){const i="/"===e.ScriptBaseUrl[e.ScriptBaseUrl.length-1]?e.ScriptBaseUrl.substring(0,e.ScriptBaseUrl.length-1):e.ScriptBaseUrl;t=t.replace(e._DefaultCdnUrl,i)}return t=e.ScriptPreprocessUrl(t),i&&(t=e.GetAbsoluteUrl(t)),t}static get RegisteredExternalClasses(){return qu.RegisteredExternalClasses}static DumpData(e,t,i,n,a="image/png",s,r=!1,o=!1,l){throw Qc("DumpTools")}static set RegisteredExternalClasses(e){qu.RegisteredExternalClasses=e}static IsEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static ToRadians(e){return e*Math.PI/180}static DumpDataAsync(e,t,i,n="image/png",a,s=!1,r=!1,o){throw Qc("DumpTools")}static ToBlob(t,i,n="image/png",a){e._IsOffScreenCanvas(t)||t.toBlob||(t.toBlob=function(e,t,i){setTimeout((()=>{const n=atob(this.toDataURL(t,i).split(",")[1]),a=n.length,s=new Uint8Array(a);for(let e=0;e<a;e++)s[e]=n.charCodeAt(e);e(new Blob([s]))}))}),e._IsOffScreenCanvas(t)?t.convertToBlob({type:n,quality:a}).then((e=>i(e))):t.toBlob((function(e){i(e)}),n,a)}static get Now(){return Cf.Now}static UnregisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const n=t[i];e.removeEventListener(n.name,n.handler);try{e.parent&&e.parent.removeEventListener(n.name,n.handler)}catch(e){}}}static SetImmediate(e){iu.SetImmediate(e)}static get LogCache(){return jh.LogCache}static set PerformanceLogLevel(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))}static DecodeBase64(e){return Gu(e)}static DelayAsync(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static set ScriptBaseUrl(e){bu.ScriptBaseUrl=e}static EncodeScreenshotCanvasData(t,i,n="image/png",a,s){if("string"!=typeof a&&i){if(i){if(e._IsOffScreenCanvas(t))return void t.convertToBlob({type:n,quality:s}).then((e=>{const t=new FileReader;t.readAsDataURL(e),t.onloadend=()=>{const e=t.result;i(e)}}));const a=t.toDataURL(n,s);i(a)}}else this.ToBlob(t,(function(t){t&&e.DownloadBlob(t,a),i&&i("")}),n,s)}static set LogLevels(e){jh.LogLevels=e}static SmoothAngleChange(e,t,i=.9){const n=this.ToRadians(e),a=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-i)*Math.sin(a)+i*Math.sin(n),(1-i)*Math.cos(a)+i*Math.cos(n)))}static SetCorsBehavior(e,t){Pu(e,t)}static set CleanUrl(e){bu.CleanUrl=e}static set ScriptPreprocessUrl(e){bu.ScriptPreprocessUrl=e}static LoadFile(e,t,i,n,a,s){return Du(e,t,i,n,a,s)}static LoadScript(e,t,i,n){if("function"==typeof importScripts){try{importScripts(e),t()}catch(t){i?.(`Unable to load script '${e}' in worker`,t)}return}if(!vf())return void i?.(`Cannot load script '${e}' outside of a window or a worker`);const a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",e),n&&(s.id=n),s.onload=()=>{t&&t()},s.onerror=t=>{i&&i(`Unable to load script '${e}'`,t)},a.appendChild(s)}static ReadFileAsDataURL(e,t,i){const n=new FileReader,a={onCompleteObservable:new Ih,abort:()=>n.abort()};return n.onloadend=()=>{a.onCompleteObservable.notifyObservers(a)},n.onload=e=>{t(e.target.result)},n.onprogress=i,n.readAsDataURL(e),a}static MakeArray(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null}static Log(e){jh.Log(e)}static DeepCopy(e,t,i,n){Af.DeepCopy(e,t,i,n)}static FloatRound(e){return Math.fround(e)}static RegisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const n=t[i];e.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch(e){}}}static Download(e,t){if("undefined"==typeof URL)return;const i=window.URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=i,n.download=t,n.addEventListener("click",(()=>{n.parentElement&&n.parentElement.removeChild(n)})),n.click(),window.URL.revokeObjectURL(i)}static LoadBabylonScript(t,i,n,a){t=e.GetBabylonScriptURL(t),e.LoadScript(t,i,n)}static set DefaultRetryStrategy(e){bu.DefaultRetryStrategy=e}static _StartUserMark(t,i=!0){if(!e._Performance){if(!vf())return;e._Performance=window.performance}i&&e._Performance.mark&&e._Performance.mark(t+"-Begin")}static GetClassName(e,t=!1){let i=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__}i||(i=typeof e)}return i}static set fallbackTexture(e){xh.FallbackTexture=e}static FetchToRef(e,t,i,n,a,s){const r=4*((Math.abs(e)*i%i|0)+(Math.abs(t)*n%n|0)*i);s.r=a[r]/255,s.g=a[r+1]/255,s.b=a[r+2]/255,s.a=a[r+3]/255}static set BaseUrl(e){bu.BaseUrl=e}static IsExponentOfTwo(e){return!0}static async DumpFramebuffer(e,t,i,n,a="image/png",s,r){throw Qc("DumpTools")}static Instantiate(e){return qu.Instantiate(e)}static DownloadBlob(t,i){if("download"in document.createElement("a")){if(!i){const e=new Date;i="screenshot_"+((e.getFullYear()+"-"+(e.getMonth()+1)).slice(2)+"-"+e.getDate()+"_"+e.getHours()+"-"+("0"+e.getMinutes()).slice(-2))+".png"}e.Download(t,i)}else if(t&&"undefined"!=typeof URL){const e=URL.createObjectURL(t),i=window.open("");if(!i)return;const n=i.document.createElement("img");n.onload=function(){URL.revokeObjectURL(e)},n.src=e,i.document.body.appendChild(n)}}static _EndUserMark(t,i=!0){i&&e._Performance.mark&&(e._Performance.mark(t+"-End"),e._Performance.measure(t,t+"-Begin",t+"-End"))}static get BaseUrl(){return bu.BaseUrl}static _StartPerformanceCounterDisabled(e,t){}static IsAbsoluteUrl(e){return 0===e.indexOf("//")||-1!==e.indexOf("://")&&(-1!==e.indexOf(".")&&(-1!==e.indexOf("/")&&(!(e.indexOf(":")>e.indexOf("/"))&&(e.indexOf("://")<e.indexOf(".")||(0===e.indexOf("data:")||0===e.indexOf("blob:"))))))}static ToDegrees(e){return 180*e/Math.PI}static set PreprocessUrl(e){bu.PreprocessUrl=e}static LoadBabylonScriptAsync(t){return t=e.GetBabylonScriptURL(t),e.LoadScriptAsync(t)}static get ScriptBaseUrl(){return bu.ScriptBaseUrl}static get CleanUrl(){return bu.CleanUrl}static ClearLogCache(){jh.ClearLogCache()}static set UseFallbackTexture(e){xh.UseFallbackTexture=e}static IsSafari(){return!!gf()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}static get fallbackTexture(){return xh.FallbackTexture}static CreateScreenshotUsingRenderTargetAsync(e,t,i,n="image/png",a=1,s=!1,r,o=!1,l=!1,c=!0,h){throw Qc("ScreenshotTools")}static Error(e){jh.Error(e)}static IsBase64(e){return ku(e)}static First(e,t){for(const i of e)if(t(i))return i;return null}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static get DefaultRetryStrategy(){return bu.DefaultRetryStrategy}static RandomId(){return Ju()}static LoadScriptAsync(e,t){return new Promise(((i,n)=>{this.LoadScript(e,(()=>{i()}),((e,t)=>{n(t||new Error(e))}),t)}))}static get CorsBehavior(){return bu.CorsBehavior}};ad.UseCustomRequestHeaders=!1,ad.CustomRequestHeaders=Rf.CustomRequestHeaders,ad.GetDOMTextContent=yf,ad._DefaultCdnUrl="https://cdn.babylonjs.com",ad.GetAbsoluteUrl="object"==typeof document?e=>{const t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?e=>new URL(e,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},ad.NoneLogLevel=jh.NoneLogLevel,ad.MessageLogLevel=jh.MessageLogLevel,ad.WarningLogLevel=jh.WarningLogLevel,ad.ErrorLogLevel=jh.ErrorLogLevel,ad.AllLogLevel=jh.AllLogLevel,ad.IsWindowObjectExist=vf,ad.PerformanceNoneLogLevel=0,ad.PerformanceUserMarkLogLevel=1,ad.PerformanceConsoleLogLevel=2,ad.StartPerformanceCounter=ad._StartPerformanceCounterDisabled,ad.EndPerformanceCounter=ad._EndPerformanceCounterDisabled;var sd=class e{constructor(e,t,i,n=0){this.iterations=e,this.index=n-1,this._done=!1,this._fn=t,this._successCallback=i}breakLoop(){this._done=!0,this._successCallback()}static SyncAsyncForLoop(t,i,n,a,s,r=0){return e.Run(Math.ceil(t/i),(e=>{s&&s()?e.breakLoop():setTimeout((()=>{for(let a=0;a<i;++a){const r=e.index*i+a;if(r>=t)break;if(n(r),s&&s()){e.breakLoop();break}}e.executeNext()}),r)}),a)}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}static Run(t,i,n,a=0){const s=new e(t,i,n,a);return s.executeNext(),s}};ad.Mix=Zu,ad.IsExponentOfTwo=Qu,xh.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";var rd=class e{reset(){this.length=0}sort(e){this.data.sort(e)}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}dispose(){this.reset(),this.data&&(this.data.length=0)}forEach(e){for(let t=0;t<this.length;t++)e(this.data[t])}indexOf(e){const t=this.data.indexOf(e);return t>=this.length?-1:t}concat(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}constructor(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}contains(e){return-1!==this.indexOf(e)}};rd._GlobalId=0;var od=class extends rd{reset(){super.reset(),this._duplicateId++}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}concatWithNoDuplicate(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let t=0;t<e.length;t++){const i=(e.data||e)[t];this.pushNoDuplicate(i)}}}constructor(){super(...arguments),this._duplicateId=0}pushNoDuplicate(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)}},ld=class e{toGlobal(t,i){return new e(this.x*t,this.y*i,this.width*t,this.height*i)}clone(){return new e(this.x,this.y,this.width,this.height)}toGlobalToRef(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this}constructor(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}},cd=class e{isFrontFacingTo(e,t){return wh.Dot(this.normal,e)<=t}static FromArray(t){return new e(t[0],t[1],t[2],t[3])}normalize(){const e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}static FromPositionAndNormal(t,i){const n=new e(0,0,0,0);return this.FromPositionAndNormalToRef(t,i,n)}static FromPositionAndNormalToRef(e,t,i){return i.normal.copyFrom(t),i.normal.normalize(),i.d=-e.dot(i.normal),i}transform(t){const i=e._TmpMatrix;t.invertToRef(i);const n=i.m,a=this.normal.x,s=this.normal.y,r=this.normal.z,o=this.d,l=a*n[0]+s*n[1]+r*n[2]+o*n[3],c=a*n[4]+s*n[5]+r*n[6]+o*n[7],h=a*n[8]+s*n[9]+r*n[10]+o*n[11],f=a*n[12]+s*n[13]+r*n[14]+o*n[15];return new e(l,c,h,f)}getHashCode(){let e=this.normal.getHashCode();return e=397*e^(0|this.d),e}copyFromPoints(e,t,i){const n=t.x-e.x,a=t.y-e.y,s=t.z-e.z,r=i.x-e.x,o=i.y-e.y,l=i.z-e.z,c=a*l-s*o,h=s*r-n*l,f=n*o-a*r,u=Math.sqrt(c*c+h*h+f*f);let d;return d=0!==u?1/u:0,this.normal.x=c*d,this.normal.y=h*d,this.normal.z=f*d,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}getClassName(){return"Plane"}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}static SignedDistanceToPlaneFromPositionAndNormal(e,t,i){const n=-(t.x*e.x+t.y*e.y+t.z*e.z);return wh.Dot(i,t)+n}constructor(e,t,i,n){this.normal=new wh(e,t,i),this.d=n}static FromPoints(t,i,n){const a=new e(0,0,0,0);return a.copyFromPoints(t,i,n),a}signedDistanceTo(e){return wh.Dot(e,this.normal)+this.d}clone(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)}};cd._TmpMatrix=Lh.Identity();var hd=class e{static GetNearPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()}static GetPlanes(t){const i=[];for(let e=0;e<6;e++)i.push(new cd(0,0,0,0));return e.GetPlanesToRef(t,i),i}static GetFarPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()}static GetTopPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()}static GetPlanesToRef(t,i){e.GetNearPlaneToRef(t,i[0]),e.GetFarPlaneToRef(t,i[1]),e.GetLeftPlaneToRef(t,i[2]),e.GetRightPlaneToRef(t,i[3]),e.GetTopPlaneToRef(t,i[4]),e.GetBottomPlaneToRef(t,i[5])}static GetLeftPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()}static IsPointInFrustum(e,t){for(let i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0}static GetRightPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()}static GetBottomPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()}},fd=class e extends Vh{_getViewMatrix(){return Lh.Identity()}serialize(){const e=Uh.Serialize(this);return e.xt=this.xt,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),Uh.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}get position(){return this._position}applyVerticalCorrection(){const e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}getProjectionMatrix(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const i=this.getEngine(),n=this.getScene(),a=i.useReverseDepthBuffer;if(this.mode===e.PERSPECTIVE_CAMERA){let t;this._cache.Lt=this.Lt,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=i.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),t=n.useRightHandedSystem?Lh.PerspectiveFovRHToRef:Lh.PerspectiveFovLHToRef,t(this.Lt,i.getAspectRatio(this),a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===e.FOVMODE_VERTICAL_FIXED,i.isNDCHalfZRange,this.projectionPlaneTilt,a)}else{const e=i.getRenderWidth()/2,t=i.getRenderHeight()/2;n.useRightHandedSystem?this.oblique?Lh.ObliqueOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-t,this.orthoTop??t,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,i.isNDCHalfZRange):Lh.OrthoOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-t,this.orthoTop??t,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,i.isNDCHalfZRange):this.oblique?Lh.ObliqueOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-t,this.orthoTop??t,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,i.isNDCHalfZRange):Lh.OrthoOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-t,this.orthoTop??t,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,i.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=this.oblique?.angle,this._cache.obliqueLength=this.oblique?.length,this._cache.obliqueOffset=this.oblique?.offset,this._cache.renderWidth=i.getRenderWidth(),this._cache.renderHeight=i.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}set mode(e){this._mode=e;for(const t of this._rigCameras)t.mode=e}get screenArea(){let t=0,i=0;if(this.mode===e.PERSPECTIVE_CAMERA)this.fovMode===e.FOVMODE_VERTICAL_FIXED?(i=2*this.minZ*Math.tan(this.Lt/2),t=this.getEngine().getAspectRatio(this)*i):(t=2*this.minZ*Math.tan(this.Lt/2),i=t/this.getEngine().getAspectRatio(this));else{const e=this.getEngine().getRenderWidth()/2,n=this.getEngine().getRenderHeight()/2;t=(this.orthoRight??e)-(this.orthoLeft??-e),i=(this.orthoTop??n)-(this.orthoBottom??-n)}return t*i}_updateRigCameras(){for(let e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].Lt=this.Lt,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===e.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}set upVector(e){this._upVector=e}get orthoTop(){return this._orthoTop}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}getDirection(e){const t=wh.Zero();return this.getDirectionToRef(e,t),t}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}_setRigMode(e){}set orthoLeft(e){this._orthoLeft=e;for(const t of this._rigCameras)t.orthoLeft=e}hasStateStored(){return!!this._stateStored}constructor(t,i,n,a=!0){super(t,n,!1),this._position=wh.Zero(),this._upVector=wh.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.Lt=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=e.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new ld(0,0,1,1),this.layerMask=268435455,this.fovMode=e.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=e.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new Ih,this.onProjectionMatrixChangedObservable=new Ih,this.onAfterCheckInputsObservable=new Ih,this.onRestoreStateObservable=new Ih,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new Lh,this._postProcesses=new Array,this._activeMeshes=new rd(256),this._globalPosition=wh.Zero(),this._computedViewMatrix=Lh.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=Lh.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=Dh.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),a&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=i,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${t}`)}get orthoBottom(){return this._orthoBottom}_cascadePostProcessesToRigCams(){const e=this._getFirstPostProcess();e&&e.markTextureDirty();for(let e=0,t=this._rigCameras.length;e<t;e++){const t=this._rigCameras[e],i=t._rigPostProcess;if(i){"pass"===i.getEffectName()&&(t.isIntermediate=0===this._postProcesses.length),t._postProcesses=this._postProcesses.slice(0).concat(i),i.markTextureDirty()}else t._postProcesses=this._postProcesses.slice(0)}}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}_getVRProjectionMatrix(){return Lh.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}detachControl(e){}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}get orthoLeft(){return this._orthoLeft}attachControl(e,t){}static Parse(t,i){const n=t.type,a=e.GetConstructorFromName(n,t.name,i,t.interaxial_distance,t.isStereoscopicSideBySide),s=Uh.Parse(a,t,i);if(void 0!==t.parentId&&(s._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(s._waitingParentInstanceIndex=t.parentInstanceIndex),s.inputs&&(s.inputs.parse(t),s._setupInputs()),t.upVector&&(s.upVector=wh.FromArray(t.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(wh.FromArray(t.position))),t.target&&s.setTarget&&s.setTarget(wh.FromArray(t.target)),t.cameraRigMode){const e=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};s.setCameraRigMode(t.cameraRigMode,e)}if(t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],n=oh("BABYLON.Animation");n&&s.animations.push(n.Parse(i))}Vh.ParseAnimationRanges(s,t,i)}return t.autoAnimate&&i.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&s.setEnabled(t.isEnabled),s}set orthoRight(e){this._orthoRight=e;for(const t of this._rigCameras)t.orthoRight=e}static GetConstructorFromName(t,i,n,a=0,s=!0){const r=Vh.Construct(t,i,n,{interaxial_distance:a,isStereoscopicSideBySide:s});return r||(()=>e._CreateDefaultParsedCamera(i,n))}set orthoTop(e){this._orthoTop=e;for(const t of this._rigCameras)t.orthoTop=e}getForwardRay(e=100,t,i){throw Qc("Ray")}set position(e){this._position=e}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}_initCache(){super._initCache(),this._cache.position=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.Lt=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}attachPostProcess(e,t=null){return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(jh.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}_setupInputs(){}getActiveMeshes(){return this._activeMeshes}getClassName(){return"Camera"}get orthoRight(){return this._orthoRight}freezeProjectionMatrix(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)}get globalPosition(){return this._globalPosition}get isRightCamera(){return this._isRightCamera}get mode(){return this._mode}isCompletelyInFrustum(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_computeObliqueDistance(e){return(this.radius||(this.target?wh.Distance(this.position,this.target):this.position.length()))+e}getForwardRayToRef(e,t=100,i,n){throw Qc("Ray")}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==e.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}get upVector(){return this._upVector}isInFrustum(e,t=!1){if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){let t=!1;return this.rigCameras.forEach((i=>{i._updateFrustumPlanes(),t=t||e.isInFrustum(i._frustumPlanes)})),t}return e.isInFrustum(this._frustumPlanes)}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigParameter(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=ad.ToRadians(t/.0637))}set orthoBottom(e){this._orthoBottom=e;for(const t of this._rigCameras)t.orthoBottom=e}get hasMoved(){return this._hasMoved}getDirectionToRef(e,t){wh.TransformNormalToRef(e,this.getWorldMatrix(),t)}_restoreStateValues(){return!!this._stateStored&&(this.Lt=this._storedFov,!0)}toString(e){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?hd.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=hd.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}storeState(){return this._stateStored=!0,this._storedFov=this.Lt,this}detachPostProcess(e){const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}_isSynchronizedProjectionMatrix(){let t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;const i=this.getEngine();return this.mode===e.PERSPECTIVE_CAMERA?t=this._cache.Lt===this.Lt&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===i.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(t=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight(),this.oblique&&(t=t&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),t}get isLeftCamera(){return this._isLeftCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}dispose(t,i=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this._parentContainer){const e=this._parentContainer.cameras.indexOf(this);e>-1&&this._parentContainer.cameras.splice(e,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==e.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let e=this._postProcesses.length;for(;--e>=0;){const t=this._postProcesses[e];t&&t.dispose(this)}}let n=this.customRenderTargets.length;for(;--n>=0;)this.customRenderTargets[n].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(t,i)}_updateCache(e){e||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}createRigCamera(e,t){return null}isReady(e=!1){if(e)for(const e of this._postProcesses)if(e&&!e.isReady())return!1;return super.isReady(e)}computeWorldMatrix(){return this.getWorldMatrix()}setCameraRigMode(t,i){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=i.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=ad.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==e.RIG_MODE_NONE){const e=this.createRigCamera(this.name+"_L",0);e&&(e._isLeftCamera=!0);const t=this.createRigCamera(this.name+"_R",1);t&&(t._isRightCamera=!0),e&&t&&(this._rigCameras.push(e),this._rigCameras.push(t))}this._setRigMode(i),this._cascadePostProcessesToRigCams(),this.update()}}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}_getFirstPostProcess(){for(let e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null}_calculateHandednessMultiplier(){let e=this.getScene().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),e}clone(t,i=null){const n=Uh.Clone(e.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return n.name=t,n.parent=i,this.onClonedObservable.notifyObservers(n),n}getViewMatrix(e){return!e&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}};fd._CreateDefaultParsedCamera=(e,t)=>{throw Qc("UniversalCamera")},fd.PERSPECTIVE_CAMERA=0,fd.ORTHOGRAPHIC_CAMERA=1,fd.FOVMODE_VERTICAL_FIXED=0,fd.FOVMODE_HORIZONTAL_FIXED=1,fd.RIG_MODE_NONE=0,fd.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,fd.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,fd.RIG_MODE_STEREOSCOPIC_INTERLACED=14,fd.RIG_MODE_VR=20,fd.RIG_MODE_CUSTOM=22,fd.ForceAttachControlToAlwaysPreventDefault=!1,Lc([Yc("position")],fd.prototype,"_position",void 0),Lc([Yc("upVector")],fd.prototype,"_upVector",void 0),Lc([Hc()],fd.prototype,"orthoLeft",null),Lc([Hc()],fd.prototype,"orthoRight",null),Lc([Hc()],fd.prototype,"orthoBottom",null),Lc([Hc()],fd.prototype,"orthoTop",null),Lc([Hc()],fd.prototype,"fov",void 0),Lc([Hc()],fd.prototype,"projectionPlaneTilt",void 0),Lc([Hc()],fd.prototype,"minZ",void 0),Lc([Hc()],fd.prototype,"maxZ",void 0),Lc([Hc()],fd.prototype,"inertia",void 0),Lc([Hc()],fd.prototype,"mode",null),Lc([Hc()],fd.prototype,"layerMask",void 0),Lc([Hc()],fd.prototype,"fovMode",void 0),Lc([Hc()],fd.prototype,"cameraRigMode",void 0),Lc([Hc()],fd.prototype,"interaxialDistance",void 0),Lc([Hc()],fd.prototype,"isStereoscopicSideBySide",void 0);var ud=class e{static set ForceFullSceneLoadingForIncremental(t){e._ForceFullSceneLoadingForIncremental=t}static get loggingLevel(){return e._LoggingLevel}static get CleanBoneMatrixWeights(){return e._CleanBoneMatrixWeights}static get ForceFullSceneLoadingForIncremental(){return e._ForceFullSceneLoadingForIncremental}static set loggingLevel(t){e._LoggingLevel=t}static set CleanBoneMatrixWeights(t){e._CleanBoneMatrixWeights=t}static set ShowLoadingScreen(t){e._ShowLoadingScreen=t}static get ShowLoadingScreen(){return e._ShowLoadingScreen}};ud._ForceFullSceneLoadingForIncremental=!1,ud._ShowLoadingScreen=!0,ud._CleanBoneMatrixWeights=!1,ud._LoggingLevel=0;var dd=!1;var md=class e{_updateExtend(e=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&!(e=this.getVerticesData($h.PositionKind)))return;this._extend=uf(e,0,this._totalVertices,this.boundingBias,3)}}isVerticesDataPresent(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};const e=this._meshes,t=e.length;for(let i=0;i<t;i++)e[i]._invalidateInstanceVertexArrayObject()}}setVerticesData(e,t,i=!1,n){i&&Array.isArray(t)&&(t=new Float32Array(t));const a=new $h(this._engine,t,e,{updatable:i,postponeInternalCreation:0===this._meshes.length,stride:n,label:"Geometry_"+this.id+"_"+e});this.setVerticesBuffer(a)}updateVerticesDataDirectly(e,t,i,n=!1){const a=this.getVertexBuffer(e);a&&(a.updateDirectly(t,i,n),this._notifyUpdate(e))}getTotalVertices(){return this.isReady()?this._totalVertices:0}get boundingBias(){return this._boundingBias}setIndices(e,t=null,i=!1){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i,"Geometry_"+this.id+"_IndexBuffer")),null!=t&&(this._totalVertices=t);for(const e of this._meshes)e._createGlobalSubMesh(!0),e.synchronizeInstances();this._notifyUpdate()}isVertexBufferUpdatable(e){const t=this._vertexBuffers[e];return!!t&&t.isUpdatable()}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const e in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(e=null){e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}static ExtractFromMesh(e,t){const i=e._geometry;return i?i.copy(t):null}_resetPointsArrayCache(){this._positions=null}getVerticesData(e,t,i){const n=this.getVertexBuffer(e);return n?n.getFloatData(this._totalVertices,i||t&&1!==this._meshes.length):null}removeVerticesData(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}static CreateGeometryForMesh(t){const i=new e(e.RandomId(),t.getScene());return i.applyToMesh(t),i}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const e=new Set;for(const t in this._vertexBuffers)e.add(this._vertexBuffers[t].getWrapperBuffer());e.forEach((e=>{e._rebuild()}))}setAllVerticesData(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}setVerticesBuffer(e,t=null,i=!0){const n=e.getKind();this._vertexBuffers[n]&&i&&this._vertexBuffers[n].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[n]=e;const a=this._meshes,s=a.length;if(n===$h.PositionKind){this._totalVertices=t??e._maxVerticesCount,this._updateExtend(e.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const i=this._extend&&this._extend.minimum||new wh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n=this._extend&&this._extend.maximum||new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let e=0;e<s;e++){const t=a[e];t.buildBoundingInfo(i,n),t._createGlobalSubMesh(t.isUnIndexed),t.computeWorldMatrix(!0),t.synchronizeInstances()}}this._notifyUpdate(n)}static RandomId(){return ad.RandomId()}applyToMesh(e){if(e._geometry===this)return;const t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();const i=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}_generatePointsArray(){if(this._positions)return!0;const e=this.getVerticesData($h.PositionKind);if(!e||0===e.length)return!1;for(let t=3*this._positionsCache.length,i=this._positionsCache.length;t<e.length;t+=3,++i)this._positionsCache[i]=wh.FromArray(e,t);for(let t=0,i=0;t<e.length;t+=3,++i)this._positionsCache[i].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}set boundingBias(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}copyVerticesData(e,t){const i=this.getVertexBuffer(e);if(!i)return;t[e]||(t[e]=new Float32Array(this._totalVertices*i.getSize()));const n=i.getData();n&&function(e,t,i,n,a,s,r,o){const l=t*$h.GetTypeByteLength(i),c=r*t;if(o.length!==c)throw new Error("Output length is not valid");if(i===$h.FLOAT&&a===l)if(e instanceof Array){const t=n/4;o.set(e,t)}else if(e instanceof ArrayBuffer){const t=new Float32Array(e,n,c);o.set(t)}else{const t=e.byteOffset+n;if(t%4)return jh.Warn("CopyFloatData: copied misaligned data."),void o.set(new Float32Array(e.buffer.slice(t,t+4*c)));const i=new Float32Array(e.buffer,t,c);o.set(i)}else $h.ForEach(e,n,a,t,i,c,s,((e,t)=>o[t]=e))}(n,i.getSize(),i.type,i.byteOffset,i.byteStride,i.normalized,this._totalVertices,t[e])}setIndexBuffer(e,t,i){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=e,this._totalVertices=t,this._totalIndices=i,e.is32Bits||(e.is32Bits=this._totalIndices>65535);for(const e of this._meshes)e._createGlobalSubMesh(!0),e.synchronizeInstances();this._notifyUpdate()}constructor(e,t,i,n=!1,a=null){this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||xh.LastCreatedScene,this._scene&&(this.id=e,this.xt=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=n,i?this.setAllVerticesData(i,n):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),a&&(this.applyToMesh(a),a.computeWorldMatrix(!0)))}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}updateVerticesData(e,t,i=!1){const n=this.getVertexBuffer(e);n&&(n.update(t),e===$h.PositionKind&&this._updateBoundingInfo(i,t),this._notifyUpdate(e))}toLeftHanded(){const e=this.getIndices(!1);if(null!=e&&e.length>0){for(let t=0;t<e.length;t+=3){const i=e[t+0];e[t+0]=e[t+2],e[t+2]=i}this.setIndices(e)}const t=this.getVerticesData($h.PositionKind,!1);if(null!=t&&t.length>0){for(let e=0;e<t.length;e+=3)t[e+2]=-t[e+2];this.setVerticesData($h.PositionKind,t,!1)}const i=this.getVerticesData($h.NormalKind,!1);if(null!=i&&i.length>0){for(let e=0;e<i.length;e+=3)i[e+2]=-i[e+2];this.setVerticesData($h.NormalKind,i,!1)}}_applyToMesh(e){const t=this._meshes.length;for(const i in this._vertexBuffers)1===t&&this._vertexBuffers[i].create(),i===$h.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}load(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))}getEngine(){return this._engine}updateIndices(e,t,i=!1){if(this._indexBuffer)if(this._indexBufferIsUpdatable){const n=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),n)for(const e of this._meshes)e._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)}dispose(){const e=this._meshes,t=e.length;let i;for(i=0;i<t;i++)this.releaseForMesh(e[i]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const e in this._vertexBuffers)this._vertexBuffers[e].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const e=this._parentContainer.geometries.indexOf(this);e>-1&&this._parentContainer.geometries.splice(e,1),this._parentContainer=null}this._isDisposed=!0}getIndices(e,t){if(!this.isReady())return null;const i=this._indices;return t||e&&1!==this._meshes.length?i.slice():i}_queueLoad(e,t){this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,(i=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(i),this),this.delayLoadState=1,this._delayInfo=[],e.removePendingData(this);const n=this._meshes,a=n.length;for(let e=0;e<a;e++)this._applyToMesh(n[e]);t&&t()}),void 0,!0))}getScene(){return this._scene}copy(t){const i=new _f;i.indices=[];const n=this.getIndices();if(n)for(let e=0;e<n.length;e++)i.indices.push(n[e]);let a,s=!1,r=!1;for(a in this._vertexBuffers){const e=this.getVerticesData(a);if(e&&(e instanceof Float32Array?i.set(new Float32Array(e),a):i.set(e.slice(0),a),!r)){const e=this.getVertexBuffer(a);e&&(s=e.isUpdatable(),r=!s)}}const o=new e(t,this._scene,i,s);for(a in o.delayLoadState=this.delayLoadState,o.delayLoadingFile=this.delayLoadingFile,o._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)o._delayInfo=o._delayInfo||[],o._delayInfo.push(a);return o._boundingInfo=new hf(this._extend.minimum,this._extend.maximum),o}getVerticesDataKinds(){const e=[];let t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e}releaseForMesh(e,t){const i=this._meshes,n=i.indexOf(e);-1!==n&&(i.splice(n,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===i.length&&t&&this.dispose())}_bind(e,t,i,n){if(!e)return;void 0===t&&(t=this._indexBuffer);const a=this.getVertexBuffers();if(!a)return;if(t!=this._indexBuffer||!this._vertexArrayObjects&&!n)return void this._engine.bindBuffers(a,t,e,i);const s=n||this._vertexArrayObjects,r=this._engine;s[e.key]||(s[e.key]=r.recordVertexArrayObject(a,t,e,i)),r.bindVertexArrayObject(s[e.key],t)}isDisposed(){return this._isDisposed}getVertexBuffer(e){return this.isReady()?this._vertexBuffers[e]:null}_updateBoundingInfo(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){const e=this._meshes;for(const t of e){t.hasBoundingInfo?t.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):t.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const e=t.subMeshes;for(const t of e)t.refreshBoundingInfo()}}}get extend(){return this._extend}static _GetGeometryByLoadedUniqueId(e,t){for(let i=0;i<t.geometries.length;i++)if(t.geometries[i]._loadedUniqueId===e)return t.geometries[i];return null}_toNumberArray(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}_notifyUpdate(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const e of this._meshes)e._markSubMeshesAsAttributesDirty()}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}serializeVerticeData(){const e=this.serialize();return this.isVerticesDataPresent($h.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData($h.PositionKind)),this.isVertexBufferUpdatable($h.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent($h.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData($h.NormalKind)),this.isVertexBufferUpdatable($h.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent($h.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData($h.TangentKind)),this.isVertexBufferUpdatable($h.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent($h.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData($h.UVKind)),this.isVertexBufferUpdatable($h.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent($h.UV2Kind)&&(e.uvs2=this._toNumberArray(this.getVerticesData($h.UV2Kind)),this.isVertexBufferUpdatable($h.UV2Kind)&&(e.uvs2._updatable=!0)),this.isVerticesDataPresent($h.UV3Kind)&&(e.uvs3=this._toNumberArray(this.getVerticesData($h.UV3Kind)),this.isVertexBufferUpdatable($h.UV3Kind)&&(e.uvs3._updatable=!0)),this.isVerticesDataPresent($h.UV4Kind)&&(e.uvs4=this._toNumberArray(this.getVerticesData($h.UV4Kind)),this.isVertexBufferUpdatable($h.UV4Kind)&&(e.uvs4._updatable=!0)),this.isVerticesDataPresent($h.UV5Kind)&&(e.uvs5=this._toNumberArray(this.getVerticesData($h.UV5Kind)),this.isVertexBufferUpdatable($h.UV5Kind)&&(e.uvs5._updatable=!0)),this.isVerticesDataPresent($h.UV6Kind)&&(e.uvs6=this._toNumberArray(this.getVerticesData($h.UV6Kind)),this.isVertexBufferUpdatable($h.UV6Kind)&&(e.uvs6._updatable=!0)),this.isVerticesDataPresent($h.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData($h.ColorKind)),this.isVertexBufferUpdatable($h.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent($h.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData($h.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable($h.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent($h.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData($h.MatricesWeightsKind)),this.isVertexBufferUpdatable($h.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}get doNotSerialize(){for(let e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}serialize(){const e={};return e.id=this.id,e.xt=this.xt,e.updatable=this._updatable,eh&&eh.HasTags(this)&&(e.tags=eh.GetTags(this)),e}get meshes(){return this._meshes}static _ImportGeometry(t,i){const n=i.getScene(),a=t.geometryUniqueId,s=t.geometryId;if(a||s){const e=a?this._GetGeometryByLoadedUniqueId(a,n):n.getGeometryById(s);e&&e.applyToMesh(i)}else if(t instanceof ArrayBuffer){const e=i._binaryInfo;if(e.positionsAttrDesc&&e.positionsAttrDesc.count>0){const n=new Float32Array(t,e.positionsAttrDesc.offset,e.positionsAttrDesc.count);i.setVerticesData($h.PositionKind,n,!1)}if(e.normalsAttrDesc&&e.normalsAttrDesc.count>0){const n=new Float32Array(t,e.normalsAttrDesc.offset,e.normalsAttrDesc.count);i.setVerticesData($h.NormalKind,n,!1)}if(e.tangetsAttrDesc&&e.tangetsAttrDesc.count>0){const n=new Float32Array(t,e.tangetsAttrDesc.offset,e.tangetsAttrDesc.count);i.setVerticesData($h.TangentKind,n,!1)}if(e.uvsAttrDesc&&e.uvsAttrDesc.count>0){const n=new Float32Array(t,e.uvsAttrDesc.offset,e.uvsAttrDesc.count);if(dd)for(let e=1;e<n.length;e+=2)n[e]=1-n[e];i.setVerticesData($h.UVKind,n,!1)}if(e.uvs2AttrDesc&&e.uvs2AttrDesc.count>0){const n=new Float32Array(t,e.uvs2AttrDesc.offset,e.uvs2AttrDesc.count);if(dd)for(let e=1;e<n.length;e+=2)n[e]=1-n[e];i.setVerticesData($h.UV2Kind,n,!1)}if(e.uvs3AttrDesc&&e.uvs3AttrDesc.count>0){const n=new Float32Array(t,e.uvs3AttrDesc.offset,e.uvs3AttrDesc.count);if(dd)for(let e=1;e<n.length;e+=2)n[e]=1-n[e];i.setVerticesData($h.UV3Kind,n,!1)}if(e.uvs4AttrDesc&&e.uvs4AttrDesc.count>0){const n=new Float32Array(t,e.uvs4AttrDesc.offset,e.uvs4AttrDesc.count);if(dd)for(let e=1;e<n.length;e+=2)n[e]=1-n[e];i.setVerticesData($h.UV4Kind,n,!1)}if(e.uvs5AttrDesc&&e.uvs5AttrDesc.count>0){const n=new Float32Array(t,e.uvs5AttrDesc.offset,e.uvs5AttrDesc.count);if(dd)for(let e=1;e<n.length;e+=2)n[e]=1-n[e];i.setVerticesData($h.UV5Kind,n,!1)}if(e.uvs6AttrDesc&&e.uvs6AttrDesc.count>0){const n=new Float32Array(t,e.uvs6AttrDesc.offset,e.uvs6AttrDesc.count);if(dd)for(let e=1;e<n.length;e+=2)n[e]=1-n[e];i.setVerticesData($h.UV6Kind,n,!1)}if(e.colorsAttrDesc&&e.colorsAttrDesc.count>0){const n=new Float32Array(t,e.colorsAttrDesc.offset,e.colorsAttrDesc.count);i.setVerticesData($h.ColorKind,n,!1,e.colorsAttrDesc.stride)}if(e.matricesIndicesAttrDesc&&e.matricesIndicesAttrDesc.count>0){const n=new Int32Array(t,e.matricesIndicesAttrDesc.offset,e.matricesIndicesAttrDesc.count),a=[];for(let e=0;e<n.length;e++){const t=n[e];a.push(255&t),a.push((65280&t)>>8),a.push((16711680&t)>>16),a.push(t>>24&255)}i.setVerticesData($h.MatricesIndicesKind,a,!1)}if(e.matricesIndicesExtraAttrDesc&&e.matricesIndicesExtraAttrDesc.count>0){const n=new Int32Array(t,e.matricesIndicesExtraAttrDesc.offset,e.matricesIndicesExtraAttrDesc.count),a=[];for(let e=0;e<n.length;e++){const t=n[e];a.push(255&t),a.push((65280&t)>>8),a.push((16711680&t)>>16),a.push(t>>24&255)}i.setVerticesData($h.MatricesIndicesExtraKind,a,!1)}if(e.matricesWeightsAttrDesc&&e.matricesWeightsAttrDesc.count>0){const n=new Float32Array(t,e.matricesWeightsAttrDesc.offset,e.matricesWeightsAttrDesc.count);i.setVerticesData($h.MatricesWeightsKind,n,!1)}if(e.indicesAttrDesc&&e.indicesAttrDesc.count>0){const n=new Int32Array(t,e.indicesAttrDesc.offset,e.indicesAttrDesc.count);i.setIndices(n,null)}if(e.subMeshesAttrDesc&&e.subMeshesAttrDesc.count>0){const n=new Int32Array(t,e.subMeshesAttrDesc.offset,5*e.subMeshesAttrDesc.count);i.subMeshes=[];for(let t=0;t<e.subMeshesAttrDesc.count;t++){const e=n[5*t+0],a=n[5*t+1],s=n[5*t+2],r=n[5*t+3],o=n[5*t+4];mf.AddToMesh(e,a,s,r,o,i)}}}else if(t.positions&&t.normals&&t.indices){if(i.setVerticesData($h.PositionKind,t.positions,t.positions._updatable),i.setVerticesData($h.NormalKind,t.normals,t.normals._updatable),t.tangents&&i.setVerticesData($h.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&i.setVerticesData($h.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&i.setVerticesData($h.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&i.setVerticesData($h.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&i.setVerticesData($h.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&i.setVerticesData($h.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&i.setVerticesData($h.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&i.setVerticesData($h.ColorKind,Ch.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData($h.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{const e=[];for(let i=0;i<t.matricesIndices.length;i++){const n=t.matricesIndices[i];e.push(255&n),e.push((65280&n)>>8),e.push((16711680&n)>>16),e.push(n>>24&255)}i.setVerticesData($h.MatricesIndicesKind,e,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData($h.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{const e=[];for(let i=0;i<t.matricesIndicesExtra.length;i++){const n=t.matricesIndicesExtra[i];e.push(255&n),e.push((65280&n)>>8),e.push((16711680&n)>>16),e.push(n>>24&255)}i.setVerticesData($h.MatricesIndicesExtraKind,e,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,i),i.setVerticesData($h.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&i.setVerticesData($h.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),i.setIndices(t.indices,null)}if(t.subMeshes){i.subMeshes=[];for(let e=0;e<t.subMeshes.length;e++){const n=t.subMeshes[e];mf.AddToMesh(n.materialIndex,n.verticesStart,n.verticesCount,n.indexStart,n.indexCount,i)}}i._shouldGenerateFlatShading&&(i.convertToFlatShadedMesh(),i._shouldGenerateFlatShading=!1),i.computeWorldMatrix(!0),n.onMeshImportedObservable.notifyObservers(i)}static Parse(t,i,n){const a=new e(t.id,i,void 0,t.updatable);return a._loadedUniqueId=t.xt,eh&&eh.AddTagsTo(a,t.tags),t.delayLoadingFile?(a.delayLoadState=4,a.delayLoadingFile=n+t.delayLoadingFile,a._boundingInfo=new hf(wh.FromArray(t.boundingBoxMinimum),wh.FromArray(t.boundingBoxMaximum)),a._delayInfo=[],t.hasUVs&&a._delayInfo.push($h.UVKind),t.hasUVs2&&a._delayInfo.push($h.UV2Kind),t.hasUVs3&&a._delayInfo.push($h.UV3Kind),t.hasUVs4&&a._delayInfo.push($h.UV4Kind),t.hasUVs5&&a._delayInfo.push($h.UV5Kind),t.hasUVs6&&a._delayInfo.push($h.UV6Kind),t.hasColors&&a._delayInfo.push($h.ColorKind),t.hasMatricesIndices&&a._delayInfo.push($h.MatricesIndicesKind),t.hasMatricesWeights&&a._delayInfo.push($h.MatricesWeightsKind),a._delayLoadingFunction=_f.ImportVertexData):_f.ImportVertexData(t,a),i.pushGeometry(a,!0),a}static _CleanMatricesWeights(e,t){const i=.001;if(!ud.CleanBoneMatrixWeights)return;let n=0;if(!(e.skeletonId>-1))return;{const i=t.getScene().getLastSkeletonById(e.skeletonId);if(!i)return;n=i.bones.length}const a=t.getVerticesData($h.MatricesIndicesKind),s=t.getVerticesData($h.MatricesIndicesExtraKind),r=e.matricesWeights,o=e.matricesWeightsExtra,l=e.numBoneInfluencer,c=r.length;for(let e=0;e<c;e+=4){let t=0,c=-1;for(let n=0;n<4;n++){const a=r[e+n];t+=a,a<i&&c<0&&(c=n)}if(o)for(let n=0;n<4;n++){const a=o[e+n];t+=a,a<i&&c<0&&(c=n+4)}if((c<0||c>l-1)&&(c=l-1),t>i){const i=1/t;for(let t=0;t<4;t++)r[e+t]*=i;if(o)for(let t=0;t<4;t++)o[e+t]*=i}else c>=4?(o[e+c-4]=1-t,s[e+c-4]=n):(r[e+c]=1-t,a[e+c]=n)}t.setVerticesData($h.MatricesIndicesKind,a),e.matricesWeightsExtra&&t.setVerticesData($h.MatricesIndicesExtraKind,s)}};var pd=class{constructor(){this.shaderLanguage=0}postProcessor(e,t,i,n,a){if(a.drawBuffersExtensionDisabled){const t=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(t,"")}return e}},_d=/(flat\s)?\s*varying\s*.*/,vd=class{varyingProcessor(e,t){return e.replace("varying",t?"in":"out")}varyingCheck(e,t){return _d.test(e)}attributeProcessor(e){return e.replace("attribute","in")}constructor(){this.shaderLanguage=0}postProcessor(e,t,i){const n=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i){const t=-1!==e.search(/layout *\(location *= *0\) *out/g);e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(n||t?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e}return e}},gd=class extends Yh{constructor(e){super(),this._buffer=e}get underlyingResource(){return this._buffer}},Sd=class{release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}setUsage(){}get underlyingResource(){return this._webGLTexture}set(e){this._webGLTexture=e}getMSAARenderBuffer(e=0){return this._MSAARenderBuffers?.[e]??null}constructor(e=null,t){if(this._MSAARenderBuffers=null,this._context=t,!e&&!(e=t.createTexture()))throw new Error("Unable to create webGL texture");this.set(e)}addMSAARenderBuffer(e){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(e)}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const e of this._MSAARenderBuffers)this._context.deleteRenderbuffer(e);this._MSAARenderBuffers=null}}},yd=class{},Ed=class e extends Tu{updateAndBindInstancesBuffer(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index)this.bindInstancesBuffer(e,i,!0);else for(let t=0;t<4;t++){const n=i[t];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*t),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}}inlineShaderCode(e){return e}createPipelineContext(e){if(this._gl){ru(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const t=function(e,t){const i=new nu,n=ru(e);return n.parallelShaderCompile&&(i.isParallelCompiled=!0),i.context=n._context,i}(this._gl);return t.engine=this,t}endFrame(){super.endFrame(),this._badOS&&this.flushFramebuffer()}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}bindBuffersDirectly(e,t,i,n,a){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==a){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=a;const t=a.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let s=0;for(let r=0;r<t;r++)if(r<i.length){const t=a.getAttributeLocation(r);t>=0&&(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0,this._vertexAttribPointer(e,t,i[r],this._gl.FLOAT,!1,n,s)),s+=4*i[r]}}this._bindIndexBufferWithCache(t)}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_setTextureParameterInteger(e,t,i,n){n&&this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameteri(e,t,i)}setFloat(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)}disableInstanceAttribute(e){let t,i=!1;for(;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),i=!0,t=this._currentInstanceLocations.indexOf(e);i&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))}_bindUnboundFramebuffer(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)}unbindInstanceAttributes(){let e;for(let t=0,i=this._currentInstanceLocations.length;t<i;t++){const i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));const n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}draw(e,t,i,n){this.drawElementsType(e?0:1,t,i,n)}_unpackFlipY(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))}setArray(e,t){return!!e&&(!(t.length<1)&&(this._gl.uniform1fv(e,t),!0))}setTextureArray(e,t,i,n){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(let t=0;t<i.length;t++){const n=i[t].getInternalTexture();n?(this._textureUnits[t]=e+t,n._associatedChannel=e+t):this._textureUnits[t]=-1}this._gl.uniform1iv(t,this._textureUnits);for(let e=0;e<i.length;e++)this._setTexture(this._textureUnits[e],i[e],!0)}}setUInt3(e,t,i,n){return!!e&&(this._gl.uniform3ui(e,t,i,n),!0)}setInt4(e,t,i,n,a){return!!e&&(this._gl.uniform4i(e,t,i,n,a),!0)}createMaterialContext(){}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const e=this._colorWrite;this._gl.colorMask(e,e,e,e)}}setIntArray2(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2iv(e,t),!0)}_normalizeIndexData(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(let t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{const e=this._gl.getExtension("WEBGL_draw_buffers");if(null!==e){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=e.drawBuffersWEBGL.bind(e),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let t=0;t<16;t++)this._gl["COLOR_ATTACHMENT"+t+"_WEBGL"]=e["COLOR_ATTACHMENT"+t+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const e=this._gl.getExtension("WEBGL_depth_texture");null!=e&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=e.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const e=this._gl.getExtension("OES_vertex_array_object");null!=e&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=e.createVertexArrayOES.bind(e),this._gl.bindVertexArray=e.bindVertexArrayOES.bind(e),this._gl.deleteVertexArray=e.deleteVertexArrayOES.bind(e))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const e=this._gl.getExtension("ANGLE_instanced_arrays");null!=e?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),this._gl.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),this._gl.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const e=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),t=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);e&&t&&(this._caps.highPrecisionShaderSupported=0!==e.precision&&0!==t.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const e=this._gl.getExtension("EXT_blend_minmax");null!=e&&(this._caps.blendMinMax=!0,this._gl.MAX=e.MAX_EXT,this._gl.MIN=e.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const e=this._gl.getExtension("EXT_sRGB");null!=e&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:e.SRGB_EXT,SRGB8:e.SRGB_ALPHA_EXT,SRGB8_ALPHA8:e.SRGB_ALPHA_EXT})}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let e=0;e<this._maxSimultaneousTextures;e++)this._nextFreeTextureSlots.push(e);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}drawElementsType(e,t,i,n){this.applyStates(),this._reportDrawCall();const a=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,r=this._uintIndicesCurrentlySet?4:2;n?this._gl.drawElementsInstanced(a,i,s,t*r,n):this._gl.drawElements(a,i,s,t*r)}bindIndexBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)}bindBuffers(e,t,i,n){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,n)),this._bindIndexBufferWithCache(t)}get version(){return this._webGLVersion}updateArrayBuffer(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)}bindInstancesBuffer(e,t,i=!0){this.bindArrayBuffer(e);let n=0;if(i)for(let e=0;e<t.length;e++){n+=4*t[e].attributeSize}for(let i=0;i<t.length;i++){const a=t[i];void 0===a.index&&(a.index=this._currentEffect.getAttributeLocationByName(a.attributeName)),a.index<0||(this._vertexAttribArraysEnabled[a.index]||(this._gl.enableVertexAttribArray(a.index),this._vertexAttribArraysEnabled[a.index]=!0),this._vertexAttribPointer(e,a.index,a.attributeSize,a.attributeType||this._gl.FLOAT,a.normalized||!1,n,a.offset),this._gl.vertexAttribDivisor(a.index,void 0===a.divisor?1:a.divisor),this._currentInstanceLocations.push(a.index),this._currentInstanceBuffers.push(e))}}_createShaderProgram(e,t,i,n,a=null){return cu(e,t,i,n,a)}_setTextureParameterFloat(e,t,i,n){this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameterf(e,t,i)}_bindTexture(e,t,i){if(void 0===e)return;t&&(t._associatedChannel=e),this._activeChannel=e;const n=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(n,t)}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}attachContextLostEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)}flushFramebuffer(){this._gl.flush()}createEffect(e,t,i,n,a,s,r,o,l,c=0){const h="string"==typeof e?e:e.vertexToken||e.vertexSource||e.vertexElement||e.vertex,f="string"==typeof e?e:e.fragmentToken||e.fragmentSource||e.fragmentElement||e.fragment,u=this._getGlobalDefines();let d=a??t.defines??"";u&&(d+=u);const m=h+"+"+f+"@"+d;if(this._compiledEffects[m]){const e=this._compiledEffects[m];return r&&e.isReady()&&r(e),e._refCount++,e}this._gl&&ru(this._gl);const p=new pu(e,t,i,n,this,a,s,r,o,l,m,t.shaderLanguage??c);return this._compiledEffects[m]=p,p}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}setIntArray3(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3iv(e,t),!0)}_createVertexBuffer(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");const n=new gd(i);return this.bindArrayBuffer(n),"number"!=typeof e?e instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t),n.St=4*e.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),n.St=e.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(e),t),n.St=e),this._resetVertexBufferBinding(),n.references=1,n}recordVertexArrayObject(e,t,i,n){const a=this._gl.createVertexArray();if(!a)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(a),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,n),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),a}_updateRenderBuffer(e,t,i,n,a,s,r,o=!0){const l=this._gl;return l.bindRenderbuffer(l.RENDERBUFFER,e),n>1&&l.renderbufferStorageMultisample?l.renderbufferStorageMultisample(l.RENDERBUFFER,n,s,t,i):l.renderbufferStorage(l.RENDERBUFFER,a,t,i),l.framebufferRenderbuffer(l.FRAMEBUFFER,r,l.RENDERBUFFER,e),o&&l.bindRenderbuffer(l.RENDERBUFFER,null),e}_bindTextureDirectly(e,t,i=!1,n=!1){let a=!1;const s=t&&t._associatedChannel>-1;i&&s&&(this._activeChannel=t._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==t||n){if(this._activateCurrentTexture(),t&&t.isMultiview)throw jh.Error(["_bindTextureDirectly called with a multiview texture!",e,t]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,t?._hardwareTexture?.underlyingResource??null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(a=!0,this._activateCurrentTexture());return s&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),a}_deletePipelineContext(e){const t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,du(t),this._gl.deleteProgram(t.program))}static set ShadersRepository(e){pu.ShadersRepository=e}releaseVertexArrayObject(e){this._gl.deleteVertexArray(e)}_getGlobalDefines(e){return Uf(e,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createDrawContext(){}_bindVertexBuffersAttributes(e,t,i){const n=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let a=0;a<n.length;a++){const s=t.getAttributeLocation(a);if(s>=0){const t=n[a];let r=null;if(i&&(r=i[t]),r||(r=e[t]),!r)continue;this._gl.enableVertexAttribArray(s),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[s]=!0);const o=r.getBuffer();o&&(this._vertexAttribPointer(o,s,r.getSize(),r.type,r.normalized,r.byteStride,r.byteOffset),r.getIsInstanced()&&(this._gl.vertexAttribDivisor(s,r.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(o))))}}}setTexture(e,t,i,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))}setUInt4(e,t,i,n,a){return!!e&&(this._gl.uniform4ui(e,t,i,n,a),!0)}bindFramebuffer(e,t=0,i,n,a,s=0,r=0){const o=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(o._MSAAFramebuffer?o._MSAAFramebuffer:o._framebuffer);const l=this._gl;e.isMulti||(e.is2DArray||e.is3D?l.framebufferTextureLayer(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,e.texture._hardwareTexture?.underlyingResource,s,r):e.isCube?l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.texture._hardwareTexture?.underlyingResource,s):o._currentLOD!==s&&(l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,e.texture._hardwareTexture?.underlyingResource,s),o._currentLOD=s));const c=e._depthStencilTexture;if(c){e.is3D&&(e.texture.width===c.width&&e.texture.height===c.height&&e.texture.depth===c.depth||jh.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const i=e._depthStencilTextureWithStencil?l.DEPTH_STENCIL_ATTACHMENT:l.DEPTH_ATTACHMENT;e.is2DArray||e.is3D?l.framebufferTextureLayer(l.FRAMEBUFFER,i,c._hardwareTexture?.underlyingResource,s,r):e.isCube?l.framebufferTexture2D(l.FRAMEBUFFER,i,l.TEXTURE_CUBE_MAP_POSITIVE_X+t,c._hardwareTexture?.underlyingResource,s):l.framebufferTexture2D(l.FRAMEBUFFER,i,l.TEXTURE_2D,c._hardwareTexture?.underlyingResource,s)}this._cachedViewport&&!a?this.setViewport(this._cachedViewport,i,n):(i||(i=e.width,s&&(i/=Math.pow(2,s))),n||(n=e.height,s&&(n/=Math.pow(2,s))),this._viewport(0,0,i,n)),this.wipeCaches()}_vertexAttribPointer(e,t,i,n,a,s,r){const o=this._currentBufferPointers[t];if(!o)return;let l=!1;o.active?(o.buffer!==e&&(o.buffer=e,l=!0),o.size!==i&&(o.size=i,l=!0),o.type!==n&&(o.type=n,l=!0),o.normalized!==a&&(o.normalized=a,l=!0),o.stride!==s&&(o.stride=s,l=!0),o.offset!==r&&(o.offset=r,l=!0)):(l=!0,o.active=!0,o.index=t,o.size=i,o.type=n,o.normalized=a,o.stride=s,o.offset=r,o.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),n===this._gl.UNSIGNED_INT||n===this._gl.INT?this._gl.vertexAttribIPointer(t,i,n,s,r):this._gl.vertexAttribPointer(t,i,n,a,s,r))}_getWebGLTextureType(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}updateTextureWrappingMode(e,t,i=null,n=null){const a=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==i&&(this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&null!==n&&(this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(n),e),e._cachedWrapR=n),this._bindTextureDirectly(a,null)}setMatrices(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)}_getTextureTarget(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(e,t,i=!1){const n=this._getTextureTarget(t),a=this._getSamplingParameters(e,t.useMipMaps||i);this._setTextureParameterInteger(n,this._gl.TEXTURE_MAG_FILTER,a.mag,t),this._setTextureParameterInteger(n,this._gl.TEXTURE_MIN_FILTER,a.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(n)),this._bindTextureDirectly(n,null),t.samplingMode=e}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}_createRenderBuffer(e,t,i,n,a,s,r=!0){const o=this._gl.createRenderbuffer();return this._updateRenderBuffer(o,e,t,i,n,a,s,r)}_getShaderProcessingContext(e){return null}setUIntArray2(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2uiv(e,t),!0)}setIntArray4(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4iv(e,t),!0)}_getTexImageParametersForCreateTexture(e,t){let i,n;return 1===this.webGLVersion?(i=this._getInternalFormat(e,t),n=i):(i=this._getInternalFormat(e,!1),n=this._getRGBABufferInternalSizedFormat(0,e,t)),{internalFormat:n,format:i,type:this._gl.UNSIGNED_BYTE}}snapshotRenderingReset(){this.snapshotRendering=!1}_releaseBuffer(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)}_setProgram(e){this._currentProgram!==e&&(!function(e,t){t.useProgram(e)}(e,this._gl),this._currentProgram=e)}drawUnIndexed(e,t,i,n){this.drawArraysType(e?0:1,t,i,n)}attachContextRestoredEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)}_isRenderingStateCompiled(e){const t=e;return!this._isDisposed&&!t._isDisposed&&(!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0))}static get ShadersRepository(){return pu.ShadersRepository}get webGLVersion(){return this._webGLVersion}disableInstanceAttributeByName(e){if(!this._currentEffect)return;const t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}_createHardwareTexture(){return new Sd(this._createTexture(),this._gl)}_bindSamplerUniformToChannel(e,t){const i=this._boundUniforms[e];i&&i._currentState!==t&&(this._gl.uniform1i(i,t),i._currentState=t)}setFloat4(e,t,i,n,a){return!!e&&(this._gl.uniform4f(e,t,i,n,a),!0)}drawArraysType(e,t,i,n){this.applyStates(),this._reportDrawCall();const a=this._drawMode(e);n?this._gl.drawArraysInstanced(a,t,i,n):this._gl.drawArrays(a,t,i)}_viewport(e,t,i,n){e===this._viewportCached.x&&t===this._viewportCached.y&&i===this._viewportCached.z&&n===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=n,this._gl.viewport(e,t,i,n))}releaseEffects(){const e=Object.keys(this._compiledEffects);for(const t of e){this._compiledEffects[t].dispose()}this._compiledEffects={}}_uploadCompressedDataToTextureDirectly(e,t,i,n,a,s=0,r=0){const o=this._gl;let l=o.TEXTURE_2D;if(e.isCube&&(l=o.TEXTURE_CUBE_MAP_POSITIVE_X+s),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=o.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(l,r,t,i,n,0,a)}getAttributes(e,t){const i=[],n=e;for(let e=0;e<t.length;e++)try{i.push(this._gl.getAttribLocation(n.program,t[e]))}catch(e){i.push(-1)}return i}_bindBuffer(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)}createRawShaderProgram(e,t,i,n,a=null){const s=ru(this._gl);return s._contextWasLost=this._contextWasLost,s.validateShaderPrograms=this.validateShaderPrograms,ou(e,t,i,n||this._gl,a)}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const e=Tu._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}_releaseEffect(e){this._compiledEffects[e._key]&&delete this._compiledEffects[e._key];const t=e.getPipelineContext();t&&this._deletePipelineContext(t)}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}_uploadArrayBufferViewToTexture(e,t,i=0,n=0){const a=this._gl,s=e.isCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,i,n),this._bindTextureDirectly(s,null,!0)}_setTexture(e,t,i=!1,n=!1,a=""){if(!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video){this._activeChannel=e;const i=t.getInternalTexture();i&&(i._associatedChannel=e),t.update()}else if(4===t.delayLoadState)return t.delayLoad(),!1;let s;s=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!i&&s&&(s._associatedChannel=e);let r=!0;this._boundTexturesCache[e]===s&&(i||this._bindSamplerUniformToChannel(s._associatedChannel,e),r=!1),this._activeChannel=e;const o=this._getTextureTarget(s);if(r&&this._bindTextureDirectly(o,s,i),s&&!s.isMultiview){if(s.isCube&&s._cachedCoordinatesMode!==t.coordinatesMode){s._cachedCoordinatesMode=t.coordinatesMode;const e=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=e,t.wrapV=e}s._cachedWrapU!==t.wrapU&&(s._cachedWrapU=t.wrapU,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),s)),s._cachedWrapV!==t.wrapV&&(s._cachedWrapV=t.wrapV,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),s)),s.is3D&&s._cachedWrapR!==t.wrapR&&(s._cachedWrapR=t.wrapR,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),s)),this._setAnisotropicLevel(o,s,t.anisotropicFilteringLevel)}return!0}_deleteBuffer(e){this._gl.deleteBuffer(e.underlyingResource)}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}setArray4(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4fv(e,t),!0)}getRenderHeight(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const e=Tu._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported}_prepareWebGLTexture(e,t,i,n,a,s,r,o,l,c){const h=this.getCaps().maxTextureSize,f=Math.min(h,this.needPOTTextures?nd(n.width,h):n.width),u=Math.min(h,this.needPOTTextures?nd(n.height,h):n.height),d=this._gl;d&&(e._hardwareTexture?(this._bindTextureDirectly(d.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===a||!!a),e.baseWidth=n.width,e.baseHeight=n.height,e.width=f,e.height=u,e.isReady=!0,e.type=-1!==e.type?e.type:0,e.format=-1!==e.format?e.format:c??(".jpg"!==t||e._useSRGBBuffer?5:4),o(f,u,n,t,e,(()=>{this._prepareWebGLTextureContinuation(e,i,s,r,l)}))||this._prepareWebGLTextureContinuation(e,i,s,r,l)):i&&i.removePendingData(e))}extractDriverInfo(){const e=this.getGlInfo();return e&&e.renderer?e.renderer:""}updateTextureDimensions(e,t,i,n=1){}_setupFramebufferDepthAttachments(e,t,i,n,a=1){const s=this._gl;if(e&&t)return this._createRenderBuffer(i,n,a,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){let e=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(e=s.DEPTH_COMPONENT32F),this._createRenderBuffer(i,n,a,e,e,s.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(i,n,a,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null}_getRGBABufferInternalSizedFormat(e,t,i=!1){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}constructor(t,i,n,a){if(n=n||{},super(i??n.antialias,n,a),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!t)return;let s=null;if(t.getContext){if(s=t,this._renderingCanvas=s,void 0===n.preserveDrawingBuffer&&(n.preserveDrawingBuffer=!1),void 0===n.xrCompatible&&(n.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const t=navigator.userAgent;for(const i of e.ExceptionList){const e=i.key,a=i.targets;if(new RegExp(e).test(t)){if(i.capture&&i.captureConstraint){const e=i.capture,n=i.captureConstraint,a=new RegExp(e).exec(t);if(a&&a.length>0){if(parseInt(a[a.length-1])>=n)continue}}for(const e of a)switch(e){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":n.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=e=>{e.preventDefault(),this._contextWasLost=!0,jh.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},s.addEventListener("webglcontextlost",this._onContextLost,!1),s.addEventListener("webglcontextrestored",this._onContextRestored,!1),n.powerPreference=n.powerPreference||"high-performance"),this._badDesktopOS&&(n.xrCompatible=!1),!n.disableWebGL2Support)try{this._gl=s.getContext("webgl2",n)||s.getContext("experimental-webgl2",n),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(e){}if(!this._gl){if(!s)throw new Error("The provided canvas is null or undefined.");try{this._gl=s.getContext("webgl",n)||s.getContext("experimental-webgl",n)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const e=this._gl.getContextAttributes();e&&(n.stencil=e.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==n.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=n.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let e=0;e<this._caps.maxVertexAttribs;e++)this._currentBufferPointers[e]=new yd;this._shaderProcessor=this.webGLVersion>1?new vd:new pd;const r=`Babylon.js v${e.Version}`;jh.Log(r+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",r);const o=ru(this._gl);o.validateShaderPrograms=this.validateShaderPrograms,o.parallelShaderCompile=this._caps.parallelShaderCompile}_createInternalTexture(e,t,i=!0,n=0){let a,s=!1,r=0,o=3,l=5,c=!1,h=1;void 0!==t&&"object"==typeof t?(s=!!t.generateMipMaps,r=void 0===t.type?0:t.type,o=void 0===t.samplingMode?3:t.samplingMode,l=void 0===t.format?5:t.format,c=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer,h=t.samples??1,a=t.label):s=!!t,c&&(c=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==r||this._caps.textureFloatLinearFiltering)&&(2!==r||this._caps.textureHalfFloatLinearFiltering)||(o=1),1!==r||this._caps.textureFloat||(r=0,jh.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const f=this._gl,u=new Cu(this,n),d=e.width||e,m=e.height||e,p=e.depth||0,_=e.layers||0,v=this._getSamplingParameters(o,s),g=0!==_?f.TEXTURE_2D_ARRAY:0!==p?f.TEXTURE_3D:f.TEXTURE_2D,S=this._getRGBABufferInternalSizedFormat(r,l,c),y=this._getInternalFormat(l),E=this._getWebGLTextureType(r);return this._bindTextureDirectly(g,u),0!==_?(u.is2DArray=!0,f.texImage3D(g,0,S,d,m,_,0,y,E,null)):0!==p?(u.is3D=!0,f.texImage3D(g,0,S,d,m,p,0,y,E,null)):f.texImage2D(g,0,S,d,m,0,y,E,null),f.texParameteri(g,f.TEXTURE_MAG_FILTER,v.mag),f.texParameteri(g,f.TEXTURE_MIN_FILTER,v.min),f.texParameteri(g,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(g,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),s&&this._gl.generateMipmap(g),this._bindTextureDirectly(g,null),u._useSRGBBuffer=c,u.baseWidth=d,u.baseHeight=m,u.width=d,u.height=m,u.depth=_,u.isReady=!0,u.samples=h,u.generateMipMaps=s,u.samplingMode=o,u.type=r,u.format=l,u.label=a,this._internalTexturesCache.push(u),u}bindUniformBlock(e,t,i){const n=e.program,a=this._gl.getUniformBlockIndex(n,t);this._gl.uniformBlockBinding(n,a,i)}get name(){return this._name}static get IsSupported(){return this.isSupported()}_getShaderSource(e){return this._gl.getShaderSource(e)}readPixels(e,t,i,n,a=!0,s=!0){const r=a?4:3,o=a?this._gl.RGBA:this._gl.RGB,l=new Uint8Array(n*i*r);return s&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,n,o,this._gl.UNSIGNED_BYTE,l),Promise.resolve(l)}setUIntArray(e,t){return!!e&&(this._gl.uniform1uiv(e,t),!0)}_prepareWebGLTextureContinuation(e,t,i,n,a){const s=this._gl;if(!s)return;const r=this._getSamplingParameters(a,!i);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,r.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,r.min),i||n||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t.removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}bindArrayBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)}unBindFramebuffer(e,t=!1,i){const n=e;this._currentRenderTarget=null;const a=this._gl;if(n._MSAAFramebuffer){if(e.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(e,t,i);a.bindFramebuffer(a.READ_FRAMEBUFFER,n._MSAAFramebuffer),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,n._framebuffer),a.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a.COLOR_BUFFER_BIT,a.NEAREST)}!e.texture?.generateMipMaps||t||e.isCube||this.generateMipmaps(e.texture),i&&(n._MSAAFramebuffer&&this._bindUnboundFramebuffer(n._framebuffer),i()),this._bindUnboundFramebuffer(null)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else for(let e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}clear(t,i,n,a=!1){const s=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=s;let r=0;if(i&&t){let i=!0;if(this._currentRenderTarget){const n=this._currentRenderTarget.texture?.format;if(8===n||9===n||10===n||11===n){const n=this._currentRenderTarget.texture?.type;7===n||5===n?(e._TempClearColorUint32[0]=255*t.r,e._TempClearColorUint32[1]=255*t.g,e._TempClearColorUint32[2]=255*t.b,e._TempClearColorUint32[3]=255*t.a,this._gl.clearBufferuiv(this._gl.COLOR,0,e._TempClearColorUint32),i=!1):(e._TempClearColorInt32[0]=255*t.r,e._TempClearColorInt32[1]=255*t.g,e._TempClearColorInt32[2]=255*t.b,e._TempClearColorInt32[3]=255*t.a,this._gl.clearBufferiv(this._gl.COLOR,0,e._TempClearColorInt32),i=!1)}}i&&(this._gl.clearColor(t.r,t.g,t.b,void 0!==t.a?t.a:1),r|=this._gl.COLOR_BUFFER_BIT)}n&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),r|=this._gl.DEPTH_BUFFER_BIT),a&&(this._gl.clearStencil(0),r|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(r)}_finalizePipelineContext(e){return hu(e,this._gl,this.validateShaderPrograms)}drawPointClouds(e,t,i){this.drawArraysType(2,e,t,i)}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}dispose(){var e;vf()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&this._gl.getExtension("WEBGL_lose_context")?.loseContext(),e=this._gl,au.delete(e)}setUIntArray4(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4uiv(e,t),!0)}setArray3(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3fv(e,t),!0)}_getUseSRGBBuffer(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||t)}setInt(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"==typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}updateTextureData(e,t,i,n,a,s,r=0,o=0,l=!1){const c=this._gl,h=this._getWebGLTextureType(e.type),f=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);let u=c.TEXTURE_2D,d=c.TEXTURE_2D;e.isCube&&(d=c.TEXTURE_CUBE_MAP_POSITIVE_X+r,u=c.TEXTURE_CUBE_MAP),this._bindTextureDirectly(u,e,!0),c.texSubImage2D(d,o,i,n,a,s,f,h,t),l&&this._gl.generateMipmap(d),this._bindTextureDirectly(u,null)}getUniforms(e,t){const i=new Array,n=e;for(let e=0;e<t.length;e++)i.push(this._gl.getUniformLocation(n.program,t[e]));return i}areAllEffectsReady(){for(const e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0}get _supportsHardwareTextureRescaling(){return!1}_getInternalFormat(e,t=!1){let i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:i=this._gl.RED;break;case 7:i=this._gl.RG;break;case 4:i=t?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER}return i}_getSamplingParameters(e,t){const i=this._gl;let n=i.NEAREST,a=i.NEAREST;switch(e){case 11:n=i.LINEAR,a=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 3:n=i.LINEAR,a=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 8:n=i.NEAREST,a=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 4:n=i.NEAREST,a=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 5:n=i.NEAREST,a=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 6:n=i.NEAREST,a=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 7:n=i.NEAREST,a=i.LINEAR;break;case 1:n=i.NEAREST,a=i.NEAREST;break;case 9:n=i.LINEAR,a=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 10:n=i.LINEAR,a=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 2:n=i.LINEAR,a=i.LINEAR;break;case 12:n=i.LINEAR,a=i.NEAREST}return{min:a,mag:n}}wipeCaches(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}set name(e){this._name=e}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}setFloat2(e,t,i){return!!e&&(this._gl.uniform2f(e,t,i),!0)}setIntArray(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)}setInt2(e,t,i){return!!e&&(this._gl.uniform2i(e,t,i),!0)}createShaderProgram(e,t,i,n,a,s=null){const r=ru(this._gl);return r._contextWasLost=this._contextWasLost,r.validateShaderPrograms=this.validateShaderPrograms,lu(e,t,i,n,a||this._gl,s)}_executeWhenRenderingStateIsCompiled(e,t){!function(e,t){const i=e;if(!i.isParallelCompiled)return void t(e);const n=i.onCompiled;i.onCompiled=()=>{n?.(),t(e)}}(e,t)}_getTextureWrapMode(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}setUInt(e,t){return!!e&&(this._gl.uniform1ui(e,t),!0)}setMatrix3x3(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)}_createTexture(){const e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e}createTexture(e,t,i,n,a=3,s=null,r=null,o=null,l=null,c=null,h=null,f,u,d,m){return this._createTextureBase(e,t,i,n,a,s,r,((...e)=>this._prepareWebGLTexture(...e,c)),((e,t,i,a,s,r)=>{const o=this._gl,l=i.width===e&&i.height===t;s._creationFlags=d??0;const c=this._getTexImageParametersForCreateTexture(s.format,s._useSRGBBuffer);if(l)return o.texImage2D(o.TEXTURE_2D,0,c.internalFormat,c.format,c.type,i),!1;const h=this._caps.maxTextureSize;if(i.width>h||i.height>h||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=e,this._workingCanvas.height=t,this._workingContext.drawImage(i,0,0,i.width,i.height,0,0,e,t),o.texImage2D(o.TEXTURE_2D,0,c.internalFormat,c.format,c.type,this._workingCanvas),s.width=e,s.height=t,!1);{const e=new Cu(this,2);this._bindTextureDirectly(o.TEXTURE_2D,e,!0),o.texImage2D(o.TEXTURE_2D,0,c.internalFormat,c.format,c.type,i),this._rescaleTexture(e,s,n,c.format,(()=>{this._releaseTexture(e),this._bindTextureDirectly(o.TEXTURE_2D,s,!0),r()}))}return!0}),o,l,c,h,f,u,m)}enableEffect(e){(e=null!==e&&function(e){return void 0===e.getPipelineContext}(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}unbindAllTextures(){for(let e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setMatrix2x2(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)}_releaseTexture(e){this._deleteTexture(e._hardwareTexture),this.unbindAllTextures();const t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()}createDynamicVertexBuffer(e,t){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)}setUIntArray3(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3uiv(e,t),!0)}_deleteTexture(e){e?.release()}_bindIndexBufferWithCache(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)}getError(){return this._gl.getError()}_rescaleTexture(e,t,i,n,a){}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_uploadDataToTextureDirectly(e,t,i=0,n=0,a,s=!1){const r=this._gl,o=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format),c=void 0===a?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(a,e._useSRGBBuffer);this._unpackFlipY(e.invertY);let h=r.TEXTURE_2D;e.isCube&&(h=r.TEXTURE_CUBE_MAP_POSITIVE_X+i);const f=Math.round(Math.log(e.width)*Math.LOG2E),u=Math.round(Math.log(e.height)*Math.LOG2E),d=s?e.width:Math.pow(2,Math.max(f-n,0)),m=s?e.height:Math.pow(2,Math.max(u-n,0));r.texImage2D(h,n,c,d,m,0,l,o,t)}generateMipmaps(e){const t=this._getTextureTarget(e);this._bindTextureDirectly(t,e,!0),this._gl.generateMipmap(t),this._bindTextureDirectly(t,null)}getRenderWidth(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}bindVertexArrayObject(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}createVertexBuffer(e,t,i){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}getInfo(){return this.getGlInfo()}setFloat3(e,t,i,n){return!!e&&(this._gl.uniform3f(e,t,i,n),!0)}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e}_setAnisotropicLevel(e,t,i){const n=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(i=1),n&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}disableAttributeByIndex(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}createIndexBuffer(e,t,i){const n=this._gl.createBuffer(),a=new gd(n);if(!n)throw new Error("Unable to create index buffer");this.bindIndexBuffer(a);const s=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),a.references=1,a.is32Bits=4===s.BYTES_PER_ELEMENT,a}setUInt2(e,t,i){return!!e&&(this._gl.uniform2ui(e,t,i),!0)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}_preparePipelineContext(e,t,i,n,a,s,r,o,l,c,h){const f=ru(this._gl);return f._contextWasLost=this._contextWasLost,f.validateShaderPrograms=this.validateShaderPrograms,f._createShaderProgramInjection=this._createShaderProgram.bind(this),f.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),f.createShaderProgramInjection=this.createShaderProgram.bind(this),f.loadFileInjection=this._loadFile.bind(this),function(e,t,i,n,a,s,r,o,l,c="",h,f,u){const d=ru(e.context);f||(f=d.createRawShaderProgramInjection??ou),u||(u=d.createShaderProgramInjection??lu);const m=e;m.program=n?f(m,t,i,m.context,l):u(m,t,i,o,m.context,l),m.program.__SPECTOR_rebuildProgram=r,h()}(e,t,i,n,0,0,r,o,l,c,h)}setState(e,t=0,i,n=!1,a,s,r=0){(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);const o=this.cullBackFaces??a??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==o||i)&&(this._depthCullingState.cullFace=o),this.setZOffset(t),this.setZOffsetUnits(r);const l=n?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==l||i)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=s}_drawMode(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}setArray2(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2fv(e,t),!0)}setInt3(e,t,i,n){return!!e&&(this._gl.uniform3i(e,t,i,n),!0)}bindSamplers(e){const t=e.getPipelineContext();this._setProgram(t.program);const i=e.getSamplers();for(let t=0;t<i.length;t++){const n=e.getUniform(i[t]);n&&(this._boundUniforms[t]=n)}this._currentEffect=null}_canRenderToFramebuffer(e){const t=this._gl;for(;t.getError()!==t.NO_ERROR;);let i=!0;const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&s===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);const e=t.RGBA,n=t.UNSIGNED_BYTE,a=new Uint8Array(4);t.readPixels(0,0,1,1,e,n,a),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(n),t.deleteFramebuffer(a),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i}getClassName(){return"ThinEngine"}};Ed._TempClearColorUint32=new Uint32Array(4),Ed._TempClearColorInt32=new Int32Array(4),Ed.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],Ed.CollisionsEpsilon=.001,Ed._ConcatenateShader=Bf,Ed._IsSupported=null,Ed._HasMajorPerformanceCaveat=null,Ed.CeilingPOT=td,Ed.FloorPOT=id,Ed.NearestPOT=ed,Ed.GetExponentOfTwo=nd,Ed.QueueNewFrame=Ru;var Ad=class{enable(){this._enabled=!0}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get averageFPS(){return 1e3/this._rollingFrameTime.average}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}constructor(e=30){this._enabled=!0,this._rollingFrameTime=new Cd(e)}disable(){this._enabled=!1,this._lastFrameTimeMs=null}sampleFrame(e=Cf.Now){if(this._enabled){if(null!=this._lastFrameTimeMs){const t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}get isEnabled(){return this._enabled}get instantaneousFPS(){const e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e}get averageFrameTime(){return this._rollingFrameTime.average}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get isSaturated(){return this._rollingFrameTime.isSaturated()}},Cd=class{constructor(e){this._samples=new Array(e),this.reset()}isSaturated(){return this._sampleCount>=this._samples.length}history(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;const t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}add(e){let t;if(this.isSaturated()){const e=this._samples[this._pos];t=e-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(e-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(e){const t=this._samples.length;return(e%t+t)%t}};function Rd(e){if(e.requestPointerLock){const t=e.requestPointerLock();t instanceof Promise?t.then((()=>{e.focus()})).catch((()=>{})):e.focus()}}Ed.prototype.setAlphaMode=function(e,t=!1){if(this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}else if(!t){const t=0===e;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}},Ed.prototype._readTexturePixelsSync=function(e,t,i,n=-1,a=0,s=null,r=!0,o=!1,l=0,c=0){const h=this._gl;if(!h)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const e=h.createFramebuffer();if(!e)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=e}h.bindFramebuffer(h.FRAMEBUFFER,this._dummyFramebuffer),n>-1?h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+n,e._hardwareTexture?.underlyingResource,a):h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,e._hardwareTexture?.underlyingResource,a);let f=void 0!==e.type?this._getWebGLTextureType(e.type):h.UNSIGNED_BYTE;if(o)s||(s=function(e,t,i=!1,n){switch(e){case 3:{const e=(ArrayBuffer,new Int8Array(t));return n&&e.set(new Int8Array(n)),e}case 0:{const e=(ArrayBuffer,new Uint8Array(t));return n&&e.set(new Uint8Array(n)),e}case 4:{const e=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(i?t/2:t);return n&&e.set(new Int16Array(n)),e}case 5:case 8:case 9:case 10:case 2:{const e=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(i?t/2:t);return n&&e.set(new Uint16Array(n)),e}case 6:{const e=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(i?t/4:t);return n&&e.set(new Int32Array(n)),e}case 7:case 11:case 12:case 13:case 14:case 15:{const e=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(i?t/4:t);return n&&e.set(new Uint32Array(n)),e}case 1:{const e=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(i?t/4:t);return n&&e.set(new Float32Array(n)),e}}const a=(ArrayBuffer,new Uint8Array(t));return n&&a.set(new Uint8Array(n)),a}(e.type,4*t*i));else if(f===h.UNSIGNED_BYTE)s||(s=new Uint8Array(4*t*i)),f=h.UNSIGNED_BYTE;else s||(s=new Float32Array(4*t*i)),f=h.FLOAT;return r&&this.flushFramebuffer(),h.readPixels(l,c,t,i,h.RGBA,f,s),h.bindFramebuffer(h.FRAMEBUFFER,this._currentFramebuffer),s},Ed.prototype._readTexturePixels=function(e,t,i,n=-1,a=0,s=null,r=!0,o=!1,l=0,c=0){return Promise.resolve(this._readTexturePixelsSync(e,t,i,n,a,s,r,o,l,c))},Ed.prototype.updateDynamicIndexBuffer=function(e,t,i=0){let n;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),n=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},Ed.prototype.updateDynamicVertexBuffer=function(e,t,i,n){this.bindArrayBuffer(e),void 0===i&&(i=0);const a=t.byteLength||t.length;void 0===n||n>=a&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+n)):(t=t instanceof ArrayBuffer?new Uint8Array(t,i,n):new Uint8Array(t.buffer,t.byteOffset+i,n),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},Tu.prototype.displayLoadingUI=function(){if(!vf())return;const e=this.loadingScreen;e&&e.displayLoadingUI()},Tu.prototype.hideLoadingUI=function(){if(!vf())return;const e=this._loadingScreen;e&&e.hideLoadingUI()},Object.defineProperty(Tu.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=Tu.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(Tu.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(Tu.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),Tu.prototype.getInputElement=function(){return this._renderingCanvas},Tu.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},Tu.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},Tu.prototype.getAspectRatio=function(e,t=!1){const i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},Tu.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},Tu.prototype._verifyPointerLock=function(){this._onPointerLockChange?.()},Tu.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},Tu.prototype.getInputElement=function(){return this._renderingCanvas},Tu.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},Tu.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},Tu.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},Tu.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},Tu.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},Tu.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},Tu.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},Tu.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},Tu.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},Tu.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},Tu.prototype.getStencilMask=function(){return this._stencilState.stencilMask},Tu.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},Tu.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},Tu.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},Tu.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},Tu.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},Tu.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},Tu.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},Tu.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},Tu.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},Tu.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},Tu.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},Tu.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},Tu.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},Tu.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},Tu.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},Tu.prototype.setAlphaConstants=function(e,t,i,n){this._alphaState.setAlphaBlendConstants(e,t,i,n)},Tu.prototype.getAlphaMode=function(){return this._alphaMode},Tu.prototype.getAlphaEquation=function(){return this._alphaEquation},Tu.prototype.getRenderPassNames=function(){return this._renderPassNames},Tu.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},Tu.prototype.createRenderPassId=function(e){const t=++Tu._RenderPassIdCounter;return this._renderPassNames[t]=e??"NONAME",t},Tu.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(let t=0;t<this.scenes.length;++t){const i=this.scenes[t];for(let t=0;t<i.meshes.length;++t){const n=i.meshes[t];if(n.subMeshes)for(let t=0;t<n.subMeshes.length;++t){n.subMeshes[t]._removeDrawWrapper(e)}}}},Tu.prototype.createDepthStencilTexture=function(e,t,i){if(t.isCube){const i=e.width||e;return this._createDepthStencilCubeTexture(i,t)}return this._createDepthStencilTexture(e,t,i)};var Td=class e{endFrame(){this._fetchResult()}get count(){return this._totalValueCount}beginMonitoring(){e.Enabled&&(this._startMonitoringTime=Cf.Now)}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const e=Cf.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}get max(){return this._max}get total(){return this._totalAccumulated}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}addCount(t,i){e.Enabled&&(this._current+=t,i&&this._fetchResult())}get min(){return this._min}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}endMonitoring(t=!0){if(!e.Enabled)return;t&&this.fetchNewFrame();const i=Cf.Now;this._current=i-this._startMonitoringTime,t&&this._fetchResult()}get current(){return this._current}};Td.Enabled=!0,Tu.AudioEngineFactory=(e,t,i)=>new Nd(e,t,i);var Nd=class{setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}unlock(){if("running"===this._audioContext?.state)return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?this._audioContext?.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContext(){return this._audioContext?.resume?this._audioContext.resume():Promise.resolve()}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",(()=>{this.unlocked&&"running"!==this._audioContext?.state&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(e){this.canUseWebAudio=!1,jh.Error("Web Audio: "+e.message)}}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",t=document.createElement("style");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}lock(){this._triggerSuspendedState()}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}constructor(e=null,t=null,i=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Ih,this.onAudioLockedObservable=new Ih,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!vf())return;void 0!==window.AudioContext&&(this.canUseWebAudio=!0);const n=document.createElement("audio");this._hostElement=e,this._audioContext=t,this._audioDestination=i;try{n&&n.canPlayType&&(n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||n.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(e){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}},Md=class e extends Ed{_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}static get LastCreatedEngine(){return xh.LastCreatedEngine}resizeImageBitmap(e,t,i){return function(e,t,i,n){const a=e.createCanvas(i,n).getContext("2d");if(!a)throw new Error("Unable to get 2d context for resizeImageBitmap");return a.drawImage(t,0,0),a.getImageData(0,0,i,n).data}(this,e,t,i)}_loadFileAsync(e,t,i){return new Promise(((n,a)=>{this._loadFile(e,(e=>{n(e)}),void 0,t,i,((e,t)=>{a(t)}))}))}createInstancesBuffer(e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");const i=new gd(t);return i.St=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i.references=1,i}_clientWaitAsync(e,t=0,i=10){const n=this._gl;return new Promise(((a,s)=>{const r=()=>{const o=n.clientWaitSync(e,t,0);o!=n.WAIT_FAILED?o!=n.TIMEOUT_EXPIRED?a():setTimeout(r,i):s()};r()}))}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}enterFullscreen(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&function(e){const t=e.requestFullscreen||e.webkitRequestFullscreen;t&&t.call(e)}(this._renderingCanvas))}getFontOffset(e){return function(e){const t=document.createElement("span");t.textContent="Hg",t.style.font=e;const i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";const n=document.createElement("div");n.style.whiteSpace="nowrap",n.appendChild(t),n.appendChild(i),document.body.appendChild(n);let a=0,s=0;try{s=i.getBoundingClientRect().top-t.getBoundingClientRect().top,i.style.verticalAlign="baseline",a=i.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(n)}return{ascent:a,height:s,descent:s-a}}(e)}enterPointerlock(){this._renderingCanvas&&Rd(this._renderingCanvas)}static get LastCreatedScene(){return xh.LastCreatedScene}wrapWebGLTexture(e,t=!1,i=3,n=0,a=0){const s=new Sd(e,this._gl),r=new Cu(this,0,!0);return r._hardwareTexture=s,r.baseWidth=n,r.baseHeight=a,r.width=n,r.height=a,r.isReady=!0,r.useMipMaps=t,this.updateTextureSamplingMode(i,r),r}exitFullscreen(){this.isFullscreen&&function(){const e=document;document.exitFullscreen?document.exitFullscreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen()}()}_readPixelsAsync(e,t,i,n,a,s,r){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const o=this._gl,l=o.createBuffer();o.bindBuffer(o.PIXEL_PACK_BUFFER,l),o.bufferData(o.PIXEL_PACK_BUFFER,r.byteLength,o.STREAM_READ),o.readPixels(e,t,i,n,a,s,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);const c=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);return c?(o.flush(),this._clientWaitAsync(c,0,10).then((()=>(o.deleteSync(c),o.bindBuffer(o.PIXEL_PACK_BUFFER,l),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,r),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.deleteBuffer(l),r)))):null}_createShaderProgram(e,t,i,n,a=null){const s=n.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");if(n.attachShader(s,t),n.attachShader(s,i),this.webGLVersion>1&&a){const t=this.createTransformFeedback();this.bindTransformFeedback(t),this.setTranformFeedbackVaryings(s,a),e.transformFeedback=t}return n.linkProgram(s),this.webGLVersion>1&&a&&this.bindTransformFeedback(null),e.context=n,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),s}scissorClear(e,t,i,n,a){this.enableScissor(e,t,i,n),this.clear(a,!0,!0,!0),this.disableScissor()}static DefaultLoadingScreenFactory(e){return Tu.DefaultLoadingScreenFactory(e)}setDitheringState(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}_uploadImageToTexture(e,t,i=0,n=0){const a=this._gl,s=this._getWebGLTextureType(e.type),r=this._getInternalFormat(e.format),o=this._getRGBABufferInternalSizedFormat(e.type,r),l=e.isCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D;this._bindTextureDirectly(l,e,!0),this._unpackFlipY(e.invertY);let c=a.TEXTURE_2D;e.isCube&&(c=a.TEXTURE_CUBE_MAP_POSITIVE_X+i),a.texImage2D(c,n,o,r,s,t),this._bindTextureDirectly(l,null,!0)}static get Version(){return Tu.Version}deleteInstancesBuffer(e){this._gl.deleteBuffer(e)}_deletePipelineContext(e){const t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),super._deletePipelineContext(e)}_releaseTexture(e){super._releaseTexture(e)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}getFragmentShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}constructor(e,t,i,n=!1){if(super(e,t,i,n),this.customAnimationFrameRequester=null,this._performanceMonitor=new Ad,this._drawCalls=new Td,e&&(this._features.supportRenderPasses=!0,i=this._creationOptions,e.getContext)){const t=e;this._sharedInit(t)}}static get NpmPackage(){return Tu.NpmPackage}get performanceMonitor(){return this._performanceMonitor}_rescaleTexture(t,i,n,a,s){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const r=this.createRenderTargetTexture({width:i.width,height:i.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&e._RescalePostProcessFactory&&(this._rescalePostProcess=e._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const e=()=>{this._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};let e=n;e||(e=this.scenes[this.scenes.length-1]),e.postProcessManager.directRender([this._rescalePostProcess],r,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,a,0,0,i.width,i.height,0),this.unBindFramebuffer(r),r.dispose(),s&&s()},o=this._rescalePostProcess.getEffect();o?o.executeWhenCompiled(e):this._rescalePostProcess.onEffectCreatedObservable.addOnce((t=>{t.executeWhenCompiled(e)}))}}get _supportsHardwareTextureRescaling(){return!!e._RescalePostProcessFactory}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}setDirectViewport(e,t,i,n){const a=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,n),a}getVertexShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}static get Instances(){return xh.Instances}_rebuildBuffers(){for(const e of this.scenes)e.resetCachedMaterial(),e._rebuildGeometries();for(const e of this._virtualScenes)e.resetCachedMaterial(),e._rebuildGeometries();super._rebuildBuffers()}disableScissor(){const e=this._gl;e.disable(e.SCISSOR_TEST)}_createImageBitmapFromSource(e,t){return function(e,t,i){return new Promise(((n,a)=>{const s=new Image;s.onload=()=>{s.decode().then((()=>{e.createImageBitmap(s,i).then((e=>{n(e)}))}))},s.onerror=()=>{a(`Error loading image ${s.src}`)},s.src=t}))}(this,e,t)}setRasterizerState(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}_releaseRenderTargetWrapper(e){super._releaseRenderTargetWrapper(e),this.scenes.forEach((t=>{t.postProcesses.forEach((t=>{t._outputTexture===e&&(t._outputTexture=null)})),t.cameras.forEach((t=>{t._postProcesses.forEach((t=>{t&&t._outputTexture===e&&(t._outputTexture=null)}))}))}))}updateTextureComparisonFunction(e,t){if(1===this.webGLVersion)return void jh.Error("WebGL 1 does not support texture comparison.");const i=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:e}=this.customAnimationFrameRequester;e&&e(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}enableScissor(e,t,i,n){const a=this._gl;a.enable(a.SCISSOR_TEST),a.scissor(e,t,i,n)}createShaderProgram(e,t,i,n,a,s=null){a=a||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const r=super.createShaderProgram(e,t,i,n,a,s);return this.onAfterShaderCompilationObservable.notifyObservers(this),r}static MarkAllMaterialsAsDirty(t,i){for(let n=0;n<e.Instances.length;n++){const a=e.Instances[n];for(let e=0;e<a.scenes.length;e++)a.scenes[e].markAllMaterialsAsDirty(t,i)}}beginFrame(){this._measureFps(),super.beginFrame()}switchFullscreen(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}_sharedInit(e){super._sharedInit(e),function(e,t,i){e._onCanvasFocus=()=>{e.onCanvasFocusObservable.notifyObservers(e)},e._onCanvasBlur=()=>{e.onCanvasBlurObservable.notifyObservers(e)},e._onCanvasContextMenu=t=>{e.disableContextMenu&&t.preventDefault()},t.addEventListener("focus",e._onCanvasFocus),t.addEventListener("blur",e._onCanvasBlur),t.addEventListener("contextmenu",e._onCanvasContextMenu),e._onBlur=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.disable(),e._windowIsBackground=!0},e._onFocus=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.enable(),e._windowIsBackground=!1},e._onCanvasPointerOut=i=>{document.elementFromPoint(i.clientX,i.clientY)!==t&&e.onCanvasPointerOutObservable.notifyObservers(i)};const n=e.getHostWindow();n&&"function"==typeof n.addEventListener&&(n.addEventListener("blur",e._onBlur),n.addEventListener("focus",e._onFocus)),t.addEventListener("pointerout",e._onCanvasPointerOut),i.doNotHandleTouchAction||function(e){e&&e.setAttribute&&(e.setAttribute("touch-action","none"),e.style.touchAction="none",e.style.webkitTapHighlightColor="transparent")}(t),!Tu.audioEngine&&i.audioEngine&&Tu.AudioEngineFactory&&(Tu.audioEngine=Tu.AudioEngineFactory(e.getRenderingCanvas(),e.getAudioContext(),e.getAudioDestination())),Sf()&&(e._onFullscreenChange=()=>{e.isFullscreen=!!document.fullscreenElement,e.isFullscreen&&e._pointerLockRequested&&t&&Rd(t)},document.addEventListener("fullscreenchange",e._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",e._onFullscreenChange,!1),e._onPointerLockChange=()=>{e.isPointerLock=document.pointerLockElement===t},document.addEventListener("pointerlockchange",e._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",e._onPointerLockChange,!1)),e.enableOfflineSupport=void 0!==Tu.OfflineProviderFactory,e._deterministicLockstep=!!i.deterministicLockstep,e._lockstepMaxSteps=i.lockstepMaxSteps||0,e._timeStep=i.timeStep||1/60}(this,e,this._creationOptions)}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(e,t){1===xh.Instances.length&&Tu.audioEngine&&(Tu.audioEngine.dispose(),Tu.audioEngine=null);const i=e.getHostWindow();i&&"function"==typeof i.removeEventListener&&(i.removeEventListener("blur",e._onBlur),i.removeEventListener("focus",e._onFocus)),t&&(t.removeEventListener("focus",e._onCanvasFocus),t.removeEventListener("blur",e._onCanvasBlur),t.removeEventListener("pointerout",e._onCanvasPointerOut),t.removeEventListener("contextmenu",e._onCanvasContextMenu)),Sf()&&(document.removeEventListener("fullscreenchange",e._onFullscreenChange),document.removeEventListener("mozfullscreenchange",e._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",e._onFullscreenChange),document.removeEventListener("msfullscreenchange",e._onFullscreenChange),document.removeEventListener("pointerlockchange",e._onPointerLockChange),document.removeEventListener("mspointerlockchange",e._onPointerLockChange),document.removeEventListener("mozpointerlockchange",e._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",e._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}};Md.ALPHA_DISABLE=0,Md.ALPHA_ADD=1,Md.ALPHA_COMBINE=2,Md.ALPHA_SUBTRACT=3,Md.ALPHA_MULTIPLY=4,Md.ALPHA_MAXIMIZED=5,Md.ALPHA_ONEONE=6,Md.ALPHA_PREMULTIPLIED=7,Md.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Md.ALPHA_INTERPOLATE=9,Md.ALPHA_SCREENMODE=10,Md.DELAYLOADSTATE_NONE=0,Md.DELAYLOADSTATE_LOADED=1,Md.DELAYLOADSTATE_LOADING=2,Md.DELAYLOADSTATE_NOTLOADED=4,Md.NEVER=512,Md.ALWAYS=519,Md.LESS=513,Md.EQUAL=514,Md.LEQUAL=515,Md.GREATER=516,Md.GEQUAL=518,Md.NOTEQUAL=517,Md.KEEP=7680,Md.REPLACE=7681,Md.INCR=7682,Md.DECR=7683,Md.INVERT=5386,Md.INCR_WRAP=34055,Md.DECR_WRAP=34056,Md.TEXTURE_CLAMP_ADDRESSMODE=0,Md.TEXTURE_WRAP_ADDRESSMODE=1,Md.TEXTURE_MIRROR_ADDRESSMODE=2,Md.TEXTUREFORMAT_ALPHA=0,Md.TEXTUREFORMAT_LUMINANCE=1,Md.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Md.TEXTUREFORMAT_RGB=4,Md.TEXTUREFORMAT_RGBA=5,Md.TEXTUREFORMAT_RED=6,Md.TEXTUREFORMAT_R=6,Md.TEXTUREFORMAT_RG=7,Md.TEXTUREFORMAT_RED_INTEGER=8,Md.TEXTUREFORMAT_R_INTEGER=8,Md.TEXTUREFORMAT_RG_INTEGER=9,Md.TEXTUREFORMAT_RGB_INTEGER=10,Md.TEXTUREFORMAT_RGBA_INTEGER=11,Md.TEXTURETYPE_UNSIGNED_BYTE=0,Md.TEXTURETYPE_UNSIGNED_INT=0,Md.TEXTURETYPE_FLOAT=1,Md.TEXTURETYPE_HALF_FLOAT=2,Md.TEXTURETYPE_BYTE=3,Md.TEXTURETYPE_SHORT=4,Md.TEXTURETYPE_UNSIGNED_SHORT=5,Md.TEXTURETYPE_INT=6,Md.TEXTURETYPE_UNSIGNED_INTEGER=7,Md.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Md.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Md.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Md.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Md.TEXTURETYPE_UNSIGNED_INT_24_8=12,Md.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Md.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Md.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Md.TEXTURE_NEAREST_SAMPLINGMODE=1,Md.TEXTURE_BILINEAR_SAMPLINGMODE=2,Md.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Md.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Md.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Md.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Md.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Md.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Md.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Md.TEXTURE_NEAREST_LINEAR=7,Md.TEXTURE_NEAREST_NEAREST=1,Md.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Md.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Md.TEXTURE_LINEAR_LINEAR=2,Md.TEXTURE_LINEAR_NEAREST=12,Md.TEXTURE_EXPLICIT_MODE=0,Md.TEXTURE_SPHERICAL_MODE=1,Md.TEXTURE_PLANAR_MODE=2,Md.TEXTURE_CUBIC_MODE=3,Md.TEXTURE_PROJECTION_MODE=4,Md.TEXTURE_SKYBOX_MODE=5,Md.TEXTURE_INVCUBIC_MODE=6,Md.TEXTURE_EQUIRECTANGULAR_MODE=7,Md.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Md.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Md.SCALEMODE_FLOOR=1,Md.SCALEMODE_NEAREST=2,Md.SCALEMODE_CEILING=3;var Id=class{getNormal(e=!1,t=!0){if(!this.pickedMesh||t&&!this.pickedMesh.isVerticesDataPresent($h.NormalKind))return null;let i,n=this.pickedMesh.getIndices();0===n?.length&&(n=null);const a=kh.Vector3[0],s=kh.Vector3[1],r=kh.Vector3[2];if(t){const e=this.pickedMesh.getVerticesData($h.NormalKind);let t=n?wh.FromArrayToRef(e,3*n[3*this.faceId],a):a.copyFromFloats(e[3*this.faceId*3],e[3*this.faceId*3+1],e[3*this.faceId*3+2]),o=n?wh.FromArrayToRef(e,3*n[3*this.faceId+1],s):s.copyFromFloats(e[3*(3*this.faceId+1)],e[3*(3*this.faceId+1)+1],e[3*(3*this.faceId+1)+2]),l=n?wh.FromArrayToRef(e,3*n[3*this.faceId+2],r):r.copyFromFloats(e[3*(3*this.faceId+2)],e[3*(3*this.faceId+2)+1],e[3*(3*this.faceId+2)+2]);t=t.scale(this.bu),o=o.scale(this.bv),l=l.scale(1-this.bu-this.bv),i=new wh(t.x+o.x+l.x,t.y+o.y+l.y,t.z+o.z+l.z)}else{const e=this.pickedMesh.getVerticesData($h.PositionKind),t=n?wh.FromArrayToRef(e,3*n[3*this.faceId],a):a.copyFromFloats(e[3*this.faceId*3],e[3*this.faceId*3+1],e[3*this.faceId*3+2]),o=n?wh.FromArrayToRef(e,3*n[3*this.faceId+1],s):s.copyFromFloats(e[3*(3*this.faceId+1)],e[3*(3*this.faceId+1)+1],e[3*(3*this.faceId+1)+2]),l=n?wh.FromArrayToRef(e,3*n[3*this.faceId+2],r):r.copyFromFloats(e[3*(3*this.faceId+2)],e[3*(3*this.faceId+2)+1],e[3*(3*this.faceId+2)+2]),c=t.subtract(o),h=l.subtract(o);i=wh.Cross(c,h)}const o=(e,t)=>{let i=e.getWorldMatrix();e.nonUniformScaling&&(kh.Matrix[0].copyFrom(i),i=kh.Matrix[0],i.setTranslationFromFloats(0,0,0),i.invert(),i.transposeToRef(kh.Matrix[1]),i=kh.Matrix[1]),wh.TransformNormalToRef(t,i,t)};if(e&&o(this.pickedMesh,i),this.ray){const t=kh.Vector3[0].copyFrom(i);e||o(this.pickedMesh,t),wh.Dot(t,this.ray.direction)>0&&i.negateInPlace()}return i.normalize(),i}getTextureCoordinates(e=$h.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e))return null;const t=this.pickedMesh.getIndices();if(!t)return null;const i=this.pickedMesh.getVerticesData(e);if(!i)return null;let n=Ph.FromArray(i,2*t[3*this.faceId]),a=Ph.FromArray(i,2*t[3*this.faceId+1]),s=Ph.FromArray(i,2*t[3*this.faceId+2]);return n=n.scale(this.bu),a=a.scale(this.bv),s=s.scale(1-this.bu-this.bv),new Ph(n.x+a.x+s.x,n.y+a.y+s.y)}constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}};Ed.prototype.createUniformBuffer=function(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create uniform buffer");const n=new gd(i);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},Ed.prototype.createDynamicUniformBuffer=function(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create dynamic uniform buffer");const n=new gd(i);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},Ed.prototype.updateUniformBuffer=function(e,t,i,n){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===n?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+n)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+n)),this.bindUniformBuffer(null)},Ed.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},Ed.prototype.bindUniformBufferBase=function(e,t,i){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},Ed.prototype.bindUniformBlock=function(e,t,i){const n=e.program,a=this._gl.getUniformBlockIndex(n,t);4294967295!==a&&this._gl.uniformBlockBinding(n,a,i)};var xd=class e{_updateMatricesForEffect(e,t){this._currentEffect.setMatrices(e,t)}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}addColor4(e,t,i){const n=[t.r,t.g,t.b,i];this.addUniform(e,n)}_updateUInt3ForEffect(e,t,i,n,a=""){this._currentEffect.setUInt3(e+a,t,i,n)}bindTexture(e,t){this._currentEffect._bindTexture(e,t)}_updateFloatForEffect(e,t){this._currentEffect.setFloat(e,t)}_updateUIntArrayForEffect(e,t){this._currentEffect.setUIntArray(e,t)}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}constructor(e,t,i,n,a=!1){this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||a,this._dynamic=i,this._name=n??"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}bindToEffect(e,t){this._currentEffect=e,this._currentEffectName=t}get _numBuffers(){return this._buffers.length}_updateInt3ForUniform(t,i,n,a){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=n,e._TempBufferInt32View[2]=a,this.updateUniform(t,e._TempBuffer,3)}_updateUInt2ForUniform(t,i,n){e._TempBufferUInt32View[0]=i,e._TempBufferUInt32View[1]=n,this.updateUniform(t,e._TempBuffer,2)}updateUniform(e,t,i){this._checkNewFrame();let n=this._uniformLocations[e];if(void 0===n){if(this._buffer)return void jh.Error("Cannot add an uniform after UBO has been created. uniformName="+e);this.addUniform(e,i),n=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(let e=0;e<i;e++)this._bufferData[n+e]=t[e];else{let e=!1;for(let a=0;a<i;a++)(16===i&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[n+a]!==Math.fround(t[a]))&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+a]=t[a]);this._needSync=this._needSync||e}}updateUniformArray(e,t,i){this._checkNewFrame();const n=this._uniformLocations[e];if(void 0===n)return void jh.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const a=this._uniformArraySizes[e];if(this._dynamic)for(let e=0;e<i;e++)this._bufferData[n+e]=t[e];else{let e=!1,s=0,r=0;for(let o=0;o<i;o++)if(this._bufferData[n+4*r+s]!==ad.FloatRound(t[o])&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+4*r+s]=t[o]),s++,s===a.strideSize){for(;s<4;s++)this._bufferData[n+4*r+s]=0;s=0,r++}this._needSync=this._needSync||e}}_updateDirectColor4ForUniform(t,i){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,e._TempBuffer[3]=i.a,this.updateUniform(t,e._TempBuffer,4)}_updateMatrix2x2ForUniform(t,i){for(let t=0;t<2;t++)e._TempBuffer[4*t]=i[2*t],e._TempBuffer[4*t+1]=i[2*t+1],e._TempBuffer[4*t+2]=0,e._TempBuffer[4*t+3]=0;this.updateUniform(t,e._TempBuffer,8)}getData(){return this._bufferData}addVector3(e,t){const i=[t.x,t.y,t.z];this.addUniform(e,i)}_updateMatrixForUniform(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.asArray(),16)}get _indexBuffer(){return this._bufferIndex}getBuffer(){return this._buffer}_updateColor4ForUniform(t,i,n){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,e._TempBuffer[3]=n,this.updateUniform(t,e._TempBuffer,4)}_updateInt3ForEffect(e,t,i,n,a=""){this._currentEffect.setInt3(e+a,t,i,n)}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(e._UpdatedUbosInFrame[this._name]||(e._UpdatedUbosInFrame[this._name]=0),e._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_updateUIntForEffect(e,t,i=""){this._currentEffect.setUInt(e+i,t)}_updateMatrix3x3ForUniform(t,i){for(let t=0;t<3;t++)e._TempBuffer[4*t]=i[3*t],e._TempBuffer[4*t+1]=i[3*t+1],e._TempBuffer[4*t+2]=i[3*t+2],e._TempBuffer[4*t+3]=0;this.updateUniform(t,e._TempBuffer,12)}_updateUInt3ForUniform(t,i,n,a){e._TempBufferUInt32View[0]=i,e._TempBufferUInt32View[1]=n,e._TempBufferUInt32View[2]=a,this.updateUniform(t,e._TempBuffer,3)}_updateColor4ForEffect(e,t,i,n=""){this._currentEffect.setColor4(e+n,t,i)}_updateArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateUIntForUniform(t,i){e._TempBufferUInt32View[0]=i,this.updateUniform(t,e._TempBuffer,1)}isDynamic(){return void 0!==this._dynamic}_updateIntArrayForEffect(e,t){this._currentEffect.setIntArray(e,t)}_updateMatricesForUniform(e,t){this.updateUniform(e,t,t.length)}addMatrix2x2(e){this.addUniform(e,8)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}_copyBuffer(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}_updateFloat2ForUniform(t,i,n){e._TempBuffer[0]=i,e._TempBuffer[1]=n,this.updateUniform(t,e._TempBuffer,2)}_updateFloatArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}addMatrix(e,t){this.addUniform(e,Array.prototype.slice.call(t.asArray()))}_updateFloat3ForUniform(t,i,n,a){e._TempBuffer[0]=i,e._TempBuffer[1]=n,e._TempBuffer[2]=a,this.updateUniform(t,e._TempBuffer,3)}updateUniformDirectly(e,t){this.updateUniform(e,t,t.length),this.update()}get name(){return this._name}addMatrix3x3(e){this.addUniform(e,12)}dispose(){if(this._noUBO)return;const e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let e=0;e<this._buffers.length;++e){const t=this._buffers[e][0];this._engine._releaseBuffer(t)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}_updateVector3ForEffect(e,t){this._currentEffect.setVector3(e,t)}_updateInt2ForEffect(e,t,i,n=""){this._currentEffect.setInt2(e+n,t,i)}_buffersEqual(e,t){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}_updateUIntArrayForUniform(t,i){e._TempBufferUInt32View.set(i),this.updateUniformArray(t,e._TempBuffer,i.length)}_fillAlignment(e){let t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){const e=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;const i=this._uniformLocationPointer-e;for(let e=0;e<i;e++)this._data.push(0)}}_updateVector4ForUniform(t,i){e._TempBuffer[0]=i.x,e._TempBuffer[1]=i.y,e._TempBuffer[2]=i.z,e._TempBuffer[3]=i.w,this.updateUniform(t,e._TempBuffer,4)}addFloat2(e,t,i){const n=[t,i];this.addUniform(e,n)}setTexture(e,t){this._currentEffect.setTexture(e,t)}addFloat3(e,t,i,n){const a=[t,i,n];this.addUniform(e,a)}_updateColor3ForEffect(e,t,i=""){this._currentEffect.setColor3(e+i,t)}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}get currentEffect(){return this._currentEffect}_updateFloatForUniform(t,i){e._TempBuffer[0]=i,this.updateUniform(t,e._TempBuffer,1)}_updateFloatArrayForEffect(e,t){this._currentEffect.setFloatArray(e,t)}_updateIntArrayForUniform(t,i){e._TempBufferInt32View.set(i),this.updateUniformArray(t,e._TempBuffer,i.length)}_updateArrayForEffect(e,t){this._currentEffect.setArray(e,t)}_updateFloat3ForEffect(e,t,i,n,a=""){this._currentEffect.setFloat3(e+a,t,i,n)}_updateVector4ForEffect(e,t){this._currentEffect.setVector4(e,t)}_updateColor3ForUniform(t,i){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,this.updateUniform(t,e._TempBuffer,3)}_updateUInt2ForEffect(e,t,i,n=""){this._currentEffect.setUInt2(e+n,t,i)}_updateInt2ForUniform(t,i,n){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=n,this.updateUniform(t,e._TempBuffer,2)}get isSync(){return!this._needSync}addColor3(e,t){const i=[t.r,t.g,t.b];this.addUniform(e,i)}get useUbo(){return!this._noUBO}_updateFloat4ForUniform(t,i,n,a,s){e._TempBuffer[0]=i,e._TempBuffer[1]=n,e._TempBuffer[2]=a,e._TempBuffer[3]=s,this.updateUniform(t,e._TempBuffer,4)}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}_updateInt4ForEffect(e,t,i,n,a,s=""){this._currentEffect.setInt4(e+s,t,i,n,a)}addUniform(e,t,i=0){if(this._noUBO)return;if(void 0!==this._uniformLocations[e])return;let n;if(i>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:i},16==t)t*=i;else{t=t*i+(4-t)*i}n=[];for(let e=0;e<t;e++)n.push(0)}else{if(t instanceof Array)n=t,t=n.length;else{n=[];for(let e=0;e<t;e++)n.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(let e=0;e<t;e++)this._data.push(n[e]);this._needSync=!0}_updateIntForEffect(e,t,i=""){this._currentEffect.setInt(e+i,t)}setDataBuffer(e){if(!this._buffers)return this._buffer===e;for(let t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}_updateMatrix2x2ForEffect(e,t){this._currentEffect.setMatrix2x2(e,t)}_updateMatrixForEffect(e,t){this._currentEffect.setMatrix(e,t)}_updateDirectColor4ForEffect(e,t,i=""){this._currentEffect.setDirectColor4(e+i,t)}_updateUInt4ForEffect(e,t,i,n,a,s=""){this._currentEffect.setUInt4(e+s,t,i,n,a)}_updateFloat4ForEffect(e,t,i,n,a,s=""){this._currentEffect.setFloat4(e+s,t,i,n,a)}_updateUInt4ForUniform(t,i,n,a,s){e._TempBufferUInt32View[0]=i,e._TempBufferUInt32View[1]=n,e._TempBufferUInt32View[2]=a,e._TempBufferUInt32View[3]=s,this.updateUniform(t,e._TempBuffer,4)}_cacheMatrix(e,t){this._checkNewFrame();const i=this._valueCache[e],n=t.updateFlag;return(void 0===i||i!==n)&&(this._valueCache[e]=n,!0)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_updateInt4ForUniform(t,i,n,a,s){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=n,e._TempBufferInt32View[2]=a,e._TempBufferInt32View[3]=s,this.updateUniform(t,e._TempBuffer,4)}_updateVector3ForUniform(t,i){e._TempBuffer[0]=i.x,e._TempBuffer[1]=i.y,e._TempBuffer[2]=i.z,this.updateUniform(t,e._TempBuffer,3)}_updateMatrix3x3ForEffect(e,t){this._currentEffect.setMatrix3x3(e,t)}_getNames(){const e=[];let t=0;for(const i in this._uniformLocations)if(e.push(i),10==++t)break;return e.join(",")}_updateIntForUniform(t,i){e._TempBufferInt32View[0]=i,this.updateUniform(t,e._TempBuffer,1)}_updateFloat2ForEffect(e,t,i,n=""){this._currentEffect.setFloat2(e+n,t,i)}};xd._UpdatedUbosInFrame={},xd._MAX_UNIFORM_SIZE=256,xd._TempBuffer=new Float32Array(xd._MAX_UNIFORM_SIZE),xd._TempBufferInt32View=new Int32Array(xd._TempBuffer.buffer),xd._TempBufferUInt32View=new Uint32Array(xd._TempBuffer.buffer);var bd,Pd,wd=class{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new wh(0,0,0),this._diffPositionForCollisions=new wh(0,0,0),this._collisionResponse=!0}};(Pd=bd||(bd={}))[Pd.LOCAL=0]="LOCAL",Pd[Pd.WORLD=1]="WORLD",Pd[Pd.BONE=2]="BONE";var Od,Dd,Ld=class{};Ld.X=new wh(1,0,0),Ld.Y=new wh(0,1,0),Ld.Z=new wh(0,0,1),(Dd=Od||(Od={}))[Dd.X=0]="X",Dd[Dd.Y=1]="Y",Dd[Dd.Z=2]="Z";var Fd=class{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=wh.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}},kd=class{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new Fd,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new wd,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}},Bd=class e extends Xh{moveWithCollisions(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.xt),this}_postActivate(){}clone(e,t,i){return null}set onCollisionPositionChange(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}static _ApplySkeleton(e,t,i,n,a,s,r){!function(e,t,i,n,a,s,r){const o=kh.Vector3[0],l=kh.Matrix[0],c=kh.Matrix[1],h=t===$h.NormalKind?wh.TransformNormalFromFloatsToRef:wh.TransformCoordinatesFromFloatsToRef;for(let t=0,f=0;t<e.length;t+=3,f+=4){let u,d;for(l.reset(),u=0;u<4;u++)d=a[f+u],d>0&&(Lh.FromFloat32ArrayToRefScaled(i,Math.floor(16*n[f+u]),d,c),l.addToSelf(c));if(s&&r)for(u=0;u<4;u++)d=r[f+u],d>0&&(Lh.FromFloat32ArrayToRefScaled(i,Math.floor(16*s[f+u]),d,c),l.addToSelf(c));h(e[t],e[t+1],e[t+2],l,o),o.toArray(e,t)}}(e,t,i,n,a,s,r)}set collisionGroup(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}_processCollisionsForSubMeshes(e,t){const i=this._scene.getCollidingSubMeshCandidates(this,e),n=i.length;for(let a=0;a<n;a++){const s=i.data[a];n>1&&!s._checkCollision(e)||this._collideForSubMesh(s,t,e)}return this}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}getVerticesData(e){return null}set skeleton(e){const t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get visibility(){return this._internalAbstractMeshDataInfo._visibility}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set layerMask(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}set bakedVertexAnimationManager(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}_checkCollision(e){if(!this.getBoundingInfo()._checkCollision(e))return this;const t=kh.Matrix[0],i=kh.Matrix[1];return Lh.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,i),this._processCollisionsForSubMeshes(e,i),this}getFacetNormal(e){const t=wh.Zero();return this.getFacetNormalToRef(e,t),t}alignWithNormal(e,t){t||(t=Ld.Y);const i=kh.Vector3[0],n=kh.Vector3[1];return wh.CrossToRef(t,e,n),wh.CrossToRef(e,n,i),this.rotationQuaternion?Dh.RotationQuaternionFromAxisToRef(i,e,n,this.rotationQuaternion):wh.RotationFromAxisToRef(i,e,n,this.rotation),this}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}updateIndices(e,t,i=!1){return this}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((e=>e.markAsMiscDirty()))}_getActionManagerForTrigger(e,t=!0){if(this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}getMeshUniformBuffer(){return this._uniformBuffer}isVerticesDataPresent(e){return!1}resetDrawCache(e){if(this.subMeshes)for(const t of this.subMeshes)t.resetDrawCache(e)}set Ct(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}_shouldConvertRHS(){return!1}set applyFog(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}_unBindEffect(){for(const e of this.subMeshes)e.setEffect(null)}getClosestFacetAtLocalCoordinates(e,t,i,n,a=!1,s=!0){let r=null,o=0,l=0,c=0,h=0,f=0,u=0,d=0,m=0;const p=this.getFacetLocalPositions(),_=this.getFacetLocalNormals(),v=this.getFacetsAtLocalCoordinates(e,t,i);if(!v)return null;let g,S,y,E=Number.MAX_VALUE,A=E;for(let C=0;C<v.length;C++)g=v[C],S=_[g],y=p[g],h=(e-y.x)*S.x+(t-y.y)*S.y+(i-y.z)*S.z,(!a||a&&s&&h>=0||a&&!s&&h<=0)&&(h=S.x*y.x+S.y*y.y+S.z*y.z,f=-(S.x*e+S.y*t+S.z*i-h)/(S.x*S.x+S.y*S.y+S.z*S.z),u=e+S.x*f,d=t+S.y*f,m=i+S.z*f,o=u-e,l=d-t,c=m-i,A=o*o+l*l+c*c,A<E&&(E=A,r=g,n&&(n.x=u,n.y=d,n.z=m)));return r}set collisionMask(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}intersectsMesh(e,t=!1,i){const n=this.getBoundingInfo(),a=e.getBoundingInfo();if(n.intersects(a,t))return!0;if(i)for(const i of this.getChildMeshes())if(i.intersectsMesh(e,t,!0))return!0;return!1}set partitioningSubdivisions(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}dispose(e,t=!1){let i;const n=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.xt]=void 0),n.freeActiveMeshes(),n.freeRenderingGroups(),n.renderingManager.maintainStateBetweenFrames&&n.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((e=>e!==this&&e.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){const e=this._intersectionsInProgress[i],t=e._intersectionsInProgress.indexOf(this);e._intersectionsInProgress.splice(t,1)}this._intersectionsInProgress.length=0;n.lights.forEach((e=>{let t=e.includedOnlyMeshes.indexOf(this);-1!==t&&e.includedOnlyMeshes.splice(t,1),t=e.excludedMeshes.indexOf(this),-1!==t&&e.excludedMeshes.splice(t,1);const i=e.getShadowGenerators();if(i){const e=i.values();for(let i=e.next();!0!==i.done;i=e.next()){const e=i.value.getShadowMap();e&&e.Pt&&(t=e.Pt.indexOf(this),-1!==t&&e.Pt.splice(t,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const a=n.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,a.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),a.wipeCaches(),n.removeMesh(this),this._parentContainer){const e=this._parentContainer.meshes.indexOf(this);e>-1&&this._parentContainer.meshes.splice(e,1),this._parentContainer=null}if(t&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(i=0;i<n.particleSystems.length;i++)n.particleSystems[i].emitter===this&&(n.particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(e,t)}getFacetLocalPartitioning(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}getNormalsData(e=!1,t=!1){return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},null,$h.NormalKind)}calcRotatePOV(e,t,i){const n=this.definedFacingForward?1:-1;return new wh(e*n,t,i*n)}getFacetNormalToRef(e,t){const i=this.getFacetLocalNormals()[e];return wh.TransformNormalToRef(i,this.getWorldMatrix(),t),this}set collisionRetryCount(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}_setMaterial(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.xt]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.xt]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}set isVisible(e){this._isVisible=e}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}set inheritVisibility(e){this._internalAbstractMeshDataInfo._inheritVisibility=e}_resyncLightSource(e){const t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);let n=!1;if(-1===i){if(!t)return;this._lightSources.push(e)}else{if(t)return;n=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(n)}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}getFacetLocalNormals(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}getFacetPosition(e){const t=wh.Zero();return this.getFacetPositionToRef(e,t),t}rotatePOV(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this}static get BILLBOARDMODE_Z(){return Xh.BILLBOARDMODE_Z}getTotalIndices(){return 0}getTotalVertices(){return 0}getFacetLocalPositions(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}set material(e){this._setMaterial(e)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set collisionResponse(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new hf(wh.Zero(),wh.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_removeLightSource(e,t){const i=this._lightSources.indexOf(e);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(t))}get isAnInstance(){return!1}get hasInstances(){return!1}getMaterialForRenderPass(e){return this._internalAbstractMeshDataInfo._materialForRenderPass?.[e]}static get BILLBOARDMODE_X(){return Xh.BILLBOARDMODE_X}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}get hasBoundingInfo(){return null!==this._boundingInfo}get lightSources(){return this._lightSources}set useVertexColors(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}normalizeToUnitCube(e=!0,t=!1,i){return super.normalizeToUnitCube(e,t,i)}set onCollide(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}set partitioningBBoxRatio(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}disableEdgesRendering(){throw Qc("EdgesRenderer")}getIndices(){return null}_preActivateForIntermediateRendering(e){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===Xh.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}get hasThinInstances(){return!1}_refreshBoundingInfo(e,t){if(e){const i=uf(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new hf(i.minimum,i.maximum)}if(this.subMeshes)for(let t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo(e);this._updateBoundingInfo()}buildBoundingInfo(e,t,i){return this._boundingInfo=new hf(e,t,i),this._boundingInfo}set pointerOverDisableMeshTesting(e){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=e}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set numBoneInfluencers(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}_activate(e,t){return this._renderId=e,!0}toString(e){let t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const i=this._internalAbstractMeshDataInfo._skeleton;return i&&(t+=", skeleton: "+i.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}get isBlocked(){return!1}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}_getData(t,i,n=$h.PositionKind){const a=t.cache,s=e=>{if(a){const t=a._vertexData||(a._vertexData={});return t[e]||this.copyVerticesData(e,t),t[e]}return this.getVerticesData(e)};if(i||(i=s(n)),!i)return null;if(a?(a._outputData?a._outputData.set(i):a._outputData=new Float32Array(i),i=a._outputData):(t.applyMorph&&this.morphTargetManager||t.applySkeleton&&this.skeleton)&&(i=i.slice()),t.applyMorph&&this.morphTargetManager&&function(e,t,i){let n=null;switch(t){case $h.PositionKind:n=e=>e.getPositions();break;case $h.NormalKind:n=e=>e.getNormals();break;case $h.TangentKind:n=e=>e.getTangents();break;case $h.UVKind:n=e=>e.getUVs();break;default:return}for(let t=0;t<e.length;t++){let a=e[t];for(let s=0;s<i.numTargets;s++){const r=i.getTarget(s),o=r.influence;if(0!==o){const i=n(r);i&&(a+=(i[t]-e[t])*o)}}e[t]=a}}(i,n,this.morphTargetManager),t.applySkeleton&&this.skeleton){const t=s($h.MatricesIndicesKind),a=s($h.MatricesWeightsKind);if(a&&t){const r=this.numBoneInfluencers>4,o=r?s($h.MatricesIndicesExtraKind):null,l=r?s($h.MatricesWeightsExtraKind):null,c=this.skeleton.getTransformMatrices(this);e._ApplySkeleton(i,n,c,t,a,o,l)}}if(!1!==t.updatePositionsArray&&n===$h.PositionKind){const e=this._internalAbstractMeshDataInfo._positions||[],t=e.length;if(e.length=i.length/3,t<e.length)for(let i=t;i<e.length;i++)e[i]=new wh;for(let t=0,n=0;t<e.length;t++,n+=3)e[t].copyFromFloats(i[n],i[n+1],i[n+2]);this._internalAbstractMeshDataInfo._positions=e}return i}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent($h.MatricesIndicesKind)&&this.isVerticesDataPresent($h.MatricesWeightsKind)}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==Xh.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}createNormals(e){const t=this.getVerticesData($h.PositionKind),i=this.getIndices();let n;return n=this.isVerticesDataPresent($h.NormalKind)?this.getVerticesData($h.NormalKind):[],_f.ComputeNormals(t,i,n,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData($h.NormalKind,n,e),this}get Ct(){return this._internalAbstractMeshDataInfo._renderingGroupId}_syncGeometryWithMorphTargetManager(){}_preActivate(){}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}getLOD(e){return this}set rawBoundingInfo(e){this._internalAbstractMeshDataInfo._rawBoundingInfo=e}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let e=this._parentNode;for(;e;){const t=e.isVisible;if(void 0!==t)return t;e=e.parent}}return this._isVisible}set facetDepthSortFrom(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}static get BILLBOARDMODE_ALL(){return Xh.BILLBOARDMODE_ALL}set receiveShadows(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}set mustDepthSortFacets(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}disableFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=[],e.facetNormals=[],e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this}enableEdgesRendering(e,t,i){throw Qc("EdgesRenderer")}_rebuild(e=!1){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){for(const e of this.subMeshes)e._rebuild();this.resetDrawCache()}}_updateSubMeshesBoundingInfo(e){if(!this.subMeshes)return this;const t=this.subMeshes.length;for(let i=0;i<t;i++){const n=this.subMeshes[i];(t>1||!n.IsGlobal)&&n.updateBoundingInfo(e)}return this}static get BILLBOARDMODE_USE_POSITION(){return Xh.BILLBOARDMODE_USE_POSITION}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}intersects(e,t,i,n=!1,a,s=!1){const r=new Id,o=this.getClassName(),l="InstancedLinesMesh"===o||"LinesMesh"===o||"GreasedLineMesh"===o?this.intersectionThreshold:0,c=this.getBoundingInfo();if(!this.subMeshes)return r;if(!(s||e.intersectsSphere(c.boundingSphere,l)&&e.intersectsBox(c.boundingBox,l)))return r;if(n)return r.hit=!s,r.pickedMesh=s?null:this,r.distance=s?0:wh.Distance(e.origin,c.boundingSphere.center),r.subMeshId=0,r;if(!this._generatePointsArray())return r;let h=null;const f=this._scene.getIntersectingSubMeshCandidates(this,e),u=f.length;let d=!1;for(let e=0;e<u;e++){const t=f.data[e].getMaterial();if(t&&(7==t.fillMode||0==t.fillMode||1==t.fillMode||2==t.fillMode||4==t.fillMode)){d=!0;break}}if(!d)return r.hit=!0,r.pickedMesh=this,r.distance=wh.Distance(e.origin,c.boundingSphere.center),r.subMeshId=-1,r;for(let n=0;n<u;n++){const a=f.data[n];if(u>1&&!s&&!a.canIntersects(e))continue;const r=a.intersects(e,this._positions,this.getIndices(),t,i);if(r&&(t||!h||r.distance<h.distance)&&(h=r,h.subMeshId=n,t))break}if(h){const t=a??this.getWorldMatrix(),i=kh.Vector3[0],n=kh.Vector3[1];wh.TransformCoordinatesToRef(e.origin,t,i),e.direction.scaleToRef(h.distance,n);const s=wh.TransformNormal(n,t).addInPlace(i);return r.hit=!0,r.distance=wh.Distance(i,s),r.pickedPoint=s,r.pickedMesh=this,r.bu=h.bu||0,r.bv=h.bv||0,r.subMeshFaceId=h.faceId,r.faceId=h.faceId+f.data[h.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),r.subMeshId=h.subMeshId,r}return r}static get BILLBOARDMODE_NONE(){return Xh.BILLBOARDMODE_NONE}isCompletelyInFrustum(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}transferToEffect(e){const t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}set visibility(e){if(this._internalAbstractMeshDataInfo._visibility===e)return;const t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(1===t&&1!==e||1!==t&&1===e)&&this._markSubMeshesAsDirty((e=>{e.markAsMiscDirty(),e.markAsPrePassDirty()}))}set enableDistantPicking(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}setIndices(e,t){return this}getConnectedParticleSystems(){return this._scene.particleSystems.filter((e=>e.emitter===this))}releaseSubMeshes(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[];return this}setBoundingInfo(e){return this._boundingInfo=e,this}set hasVertexAlpha(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}getPositionData(e=!1,t=!1,i=null){return this._getData({applySkeleton:e,applyMorph:t,updatePositionsArray:!1},i,$h.PositionKind)}set morphTargetManager(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}updateVerticesData(e,t,i,n){return this}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}_refreshBoundingInfoDirect(e){if(this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new hf(e.minimum,e.maximum),this.subMeshes)for(let e=0;e<this.subMeshes.length;e++)this.subMeshes[e].refreshBoundingInfo(null);this._updateBoundingInfo()}isInFrustum(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}_updateNonUniformScalingState(e){return!!super._updateNonUniformScalingState(e)&&(this._markSubMeshesAsMiscDirty(),!0)}_markSubMeshesAsDirty(e){if(this.subMeshes)for(const t of this.subMeshes)for(let i=0;i<t._drawWrappers.length;++i){const n=t._drawWrappers[i];n&&n.defines&&n.defines.markAllAsDirty&&e(n.defines)}}_freeze(){}movePOV(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}getFacetsAtLocalCoordinates(e,t,i){const n=this.getBoundingInfo(),a=this._internalAbstractMeshDataInfo._facetData,s=Math.floor((e-n.minimum.x*a.partitioningBBoxRatio)*a.subDiv.X*a.partitioningBBoxRatio/a.bbSize.x),r=Math.floor((t-n.minimum.y*a.partitioningBBoxRatio)*a.subDiv.Y*a.partitioningBBoxRatio/a.bbSize.y),o=Math.floor((i-n.minimum.z*a.partitioningBBoxRatio)*a.subDiv.Z*a.partitioningBBoxRatio/a.bbSize.z);return s<0||s>a.subDiv.max||r<0||r>a.subDiv.max||o<0||o>a.subDiv.max?null:a.facetPartitioning[s+a.subDiv.max*r+a.subDiv.max*a.subDiv.max*o]}static get BILLBOARDMODE_Y(){return Xh.BILLBOARDMODE_Y}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}_resyncLightSources(){this._lightSources.length=0;for(const e of this.getScene().lights)e.isEnabled()&&e.canAffectMesh(this)&&this._lightSources.push(e);this._markSubMeshesAsLightDirty()}getClassName(){return"AbstractMesh"}set surroundingMeshes(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}_markSubMeshesAsLightDirty(e=!1){this._markSubMeshesAsDirty((t=>t.markAsLightDirty(e)))}intersectsPoint(e){return this.getBoundingInfo().intersectsPoint(e)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setMaterialForRenderPass(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t}updateFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();const t=this.getVerticesData($h.PositionKind),i=this.getIndices(),n=this.getVerticesData($h.NormalKind),a=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,i instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(i);else{let t=!1;for(let e=0;e<i.length;e++)if(i[e]>65535){t=!0;break}e.depthSortedIndices=t?new Uint32Array(i):new Uint16Array(i)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){const t=this.getScene().activeCamera;e.facetDepthSortFrom=t?t.position:wh.Zero()}e.depthSortedFacets=[];for(let t=0;t<e.facetNb;t++){const i={ind:3*t,sqDistance:0};e.depthSortedFacets.push(i)}e.invertedMatrix=Lh.Identity(),e.facetDepthSortOrigin=wh.Zero()}e.bbSize.x=a.maximum.x-a.minimum.x>hh?a.maximum.x-a.minimum.x:hh,e.bbSize.y=a.maximum.y-a.minimum.y>hh?a.maximum.y-a.minimum.y:hh,e.bbSize.z=a.maximum.z-a.minimum.z>hh?a.maximum.z-a.minimum.z:hh;let s=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(s=s>e.bbSize.z?s:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/s),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/s),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/s),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=a,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),wh.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,n&&_f.ComputeNormals(t,i,n,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);const t=e.depthSortedIndices.length/3|0;for(let n=0;n<t;n++){const t=e.depthSortedFacets[n].ind;e.depthSortedIndices[3*n]=i[t],e.depthSortedIndices[3*n+1]=i[t+1],e.depthSortedIndices[3*n+2]=i[t+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}_unFreeze(){}getClosestFacetAtCoordinates(e,t,i,n,a=!1,s=!0){const r=this.getWorldMatrix(),o=kh.Matrix[5];r.invertToRef(o);const l=kh.Vector3[8];wh.TransformCoordinatesFromFloatsToRef(e,t,i,o,l);const c=this.getClosestFacetAtLocalCoordinates(l.x,l.y,l.z,n,a,s);return n&&wh.TransformCoordinatesFromFloatsToRef(n.x,n.y,n.z,r,n),c}calcMovePOV(e,t,i){const n=new Lh;(this.rotationQuaternion?this.rotationQuaternion:Dh.lt(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(n);const a=wh.Zero(),s=this.definedFacingForward?-1:1;return wh.TransformCoordinatesFromFloatsToRef(e*s,t,i*s,n,a),a}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((e=>e.markAsAttributesDirty()))}_initFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=[]),e.facetPositions||(e.facetPositions=[]),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(let t=0;t<e.facetNb;t++)e.facetNormals[t]=wh.Zero(),e.facetPositions[t]=wh.Zero();return e.facetDataEnabled=!0,this}_checkOcclusionQuery(){return!1}set checkCollisions(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}_generatePointsArray(){return!1}_collideForSubMesh(e,t,i){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];const i=e.verticesStart,n=e.verticesStart+e.verticesCount;for(let a=i;a<n;a++)e._lastColliderWorldVertices.push(wh.TransformCoordinates(this._positions[a],t))}return i._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),7===e.getMaterial()?.fillMode),this}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}constructor(t,i=null){switch(super(t,i,!1),this._internalAbstractMeshDataInfo=new kd,this._waitingMaterialId=null,this.cullingStrategy=e.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new Ih,this.onCollisionPositionChangeObservable=new Ih,this.onMaterialChangedObservable=new Ih,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=Ah.Red(),this.outlineWidth=.02,this.overlayColor=Ah.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new wh(.5,1,.5),this.ellipsoidOffset=new wh(0,0,0),this.edgesWidth=1,this.edgesColor=new Ch(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new Ih,this._onCollisionPositionChange=(e,t,i=null)=>{t.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>Md.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),i&&this.onCollideObservable.notifyObservers(i),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},(i=this.getScene()).addMesh(this),this._resyncLightSources(),this._uniformBuffer=new xd(this.getScene().getEngine(),void 0,void 0,t,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),i.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}setVerticesData(e,t,i,n){return this}get material(){return this._internalAbstractMeshDataInfo._material}getFacetPositionToRef(e,t){const i=this.getFacetLocalPositions()[e],n=this.getWorldMatrix();return wh.TransformCoordinatesToRef(i,n,t),this}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}};Bd.OCCLUSION_TYPE_NONE=0,Bd.OCCLUSION_TYPE_OPTIMISTIC=1,Bd.OCCLUSION_TYPE_STRICT=2,Bd.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,Bd.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,Bd.CULLINGSTRATEGY_STANDARD=0,Bd.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Bd.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Bd.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Lc([qc.filter(((...[e,t,i,n,a])=>!(Array.isArray(e)||Array.isArray(t)||Array.isArray(i)||Array.isArray(n)||Array.isArray(a))))],Bd,"_ApplySkeleton",null),rh("BABYLON.AbstractMesh",Bd);var Gd=class{constructor(){this.reset()}get opStencilDepthPass(){return this._opStencilDepthPass}serialize(){return Uh.Serialize(this)}set mask(e){this._mask=e}set funcRef(e){this._funcRef=e}set opStencilDepthPass(e){this._opStencilDepthPass=e}get opStencilFail(){return this._opStencilFail}getClassName(){return"MaterialStencilState"}copyTo(e){Uh.Clone((()=>e),this)}set funcMask(e){this._funcMask=e}get funcRef(){return this._funcRef}get funcMask(){return this._funcMask}get opDepthFail(){return this._opDepthFail}get mask(){return this._mask}parse(e,t,i){Uh.Parse((()=>this),e,t,i)}set opStencilFail(e){this._opStencilFail=e}set enabled(e){this._enabled=e}get func(){return this._func}get enabled(){return this._enabled}set opDepthFail(e){this._opDepthFail=e}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}set func(e){this._func=e}};Lc([Hc()],Gd.prototype,"func",null),Lc([Hc()],Gd.prototype,"funcRef",null),Lc([Hc()],Gd.prototype,"funcMask",null),Lc([Hc()],Gd.prototype,"opStencilFail",null),Lc([Hc()],Gd.prototype,"opDepthFail",null),Lc([Hc()],Gd.prototype,"opStencilDepthPass",null),Lc([Hc()],Gd.prototype,"mask",null),Lc([Hc()],Gd.prototype,"enabled",null);var Ud=class{static CompareLightsPriority(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}};function Hd(e){-1===e.indexOf("vClipPlane")&&e.push("vClipPlane"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")}function Vd(e,t,i){const n=!!(e.clipPlane??t.clipPlane),a=!!(e.clipPlane2??t.clipPlane2),s=!!(e.clipPlane3??t.clipPlane3),r=!!(e.clipPlane4??t.clipPlane4),o=!!(e.clipPlane5??t.clipPlane5),l=!!(e.clipPlane6??t.clipPlane6);n&&i.push("#define CLIPPLANE"),a&&i.push("#define CLIPPLANE2"),s&&i.push("#define CLIPPLANE3"),r&&i.push("#define CLIPPLANE4"),o&&i.push("#define CLIPPLANE5"),l&&i.push("#define CLIPPLANE6")}function Wd(e,t,i){let n=t.clipPlane??i.clipPlane;zd(e,"vClipPlane",n),n=t.clipPlane2??i.clipPlane2,zd(e,"vClipPlane2",n),n=t.clipPlane3??i.clipPlane3,zd(e,"vClipPlane3",n),n=t.clipPlane4??i.clipPlane4,zd(e,"vClipPlane4",n),n=t.clipPlane5??i.clipPlane5,zd(e,"vClipPlane5",n),n=t.clipPlane6??i.clipPlane6,zd(e,"vClipPlane6",n)}function zd(e,t,i){i&&e.setFloat4(t,i.normal.x,i.normal.y,i.normal.z,i.d)}Ud.FALLOFF_DEFAULT=0,Ud.FALLOFF_PHYSICAL=1,Ud.FALLOFF_GLTF=2,Ud.FALLOFF_STANDARD=3,Ud.LIGHTMAP_DEFAULT=0,Ud.LIGHTMAP_SPECULAR=1,Ud.LIGHTMAP_SHADOWSONLY=2,Ud.INTENSITYMODE_AUTOMATIC=0,Ud.INTENSITYMODE_LUMINOUSPOWER=1,Ud.INTENSITYMODE_LUMINOUSINTENSITY=2,Ud.INTENSITYMODE_ILLUMINANCE=3,Ud.INTENSITYMODE_LUMINANCE=4,Ud.LIGHTTYPEID_POINTLIGHT=0,Ud.LIGHTTYPEID_DIRECTIONALLIGHT=1,Ud.LIGHTTYPEID_SPOTLIGHT=2,Ud.LIGHTTYPEID_HEMISPHERICLIGHT=3;var Xd=Ah.Black(),Yd={NUM_MORPH_INFLUENCERS:0};function jd(e,t,i){if(!e||e.LOGARITHMICDEPTH||e.indexOf&&e.indexOf("LOGARITHMICDEPTH")>=0){const e=i.activeCamera;1===e.mode&&jh.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(e.maxZ+1)/Math.LN2))}}function Kd(e,t,i,n=!1){i&&e.fogEnabled&&(!t||t.applyFog)&&0!==e.fogMode&&(i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),n?(e.fogColor.toLinearSpaceToRef(Xd,e.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",Xd)):i.setColor3("vFogColor",e.fogColor))}function $d(e,t,i){Yd.NUM_MORPH_INFLUENCERS=i,qd(e,t,Yd)}function qd(e,t,i){const n=i.NUM_MORPH_INFLUENCERS;if(n>0&&xh.LastCreatedEngine){const a=xh.LastCreatedEngine.getCaps().maxVertexAttribs,s=t.morphTargetManager;if(s?.isUsingTextureForTargets)return;const r=s&&s.supportsNormals&&i.NORMAL,o=s&&s.supportsTangents&&i.TANGENT,l=s&&s.supportsUVs&&i.UV1;for(let i=0;i<n;i++)e.push("position"+i),r&&e.push("normal"+i),o&&e.push("tangent"+i),l&&e.push("uv_"+i),e.length>a&&jh.Error("Cannot add more vertex attributes for mesh "+t.name)}}function Jd(e,t=!1){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}function Qd(e,t){const i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)}function Zd(e,t){t.bindToEffect(e,"Scene")}function em(e,t,i){t._needUVs=!0,t[i]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[i+"DIRECTUV"]=0}function tm(e,t,i){const n=e.getTextureMatrix();t.updateMatrix(i+"Matrix",n)}function im(e,t,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}function nm(e,t,i){var n;if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){const a=e.skeleton;if(a.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){const i=a.getTransformMatrixTexture(e);t.setTexture("boneSampler",i),t.setFloat("boneTextureWidth",4*(a.bones.length+1))}else{const s=a.getTransformMatrices(e);s&&(t.setMatrices("mBones",s),i&&e.getScene().prePassRenderer&&e.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[e.xt]||(i.previousBones[e.xt]=s.slice()),t.setMatrices("mPreviousBones",i.previousBones[e.xt]),n=s,i.previousBones[e.xt].set(n)))}}}function am(e,t,i,n,a,s=!0){e._bindLight(t,i,n,a,s)}function sm(e,t,i,n,a=4){const s=Math.min(t.lightSources.length,a);for(let a=0;a<s;a++){am(t.lightSources[a],a,e,i,"boolean"==typeof n?n:n.SPECULARTERM,t.receiveShadows)}}function rm(e,t,i,n){i.NUM_BONE_INFLUENCERS>0&&(n.addCPUSkinningFallback(0,t),e.push("matricesIndices"),e.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(e.push("matricesIndicesExtra"),e.push("matricesWeightsExtra")))}function om(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&Jd(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push("instanceColor")}function lm(e,t,i=4,n=0){let a=0;for(let s=0;s<i&&e["LIGHT"+s];s++)s>0&&(a=n+s,t.addFallback(a,"LIGHT"+s)),e.SHADOWS||(e["SHADOW"+s]&&t.addFallback(n,"SHADOW"+s),e["SHADOWPCF"+s]&&t.addFallback(n,"SHADOWPCF"+s),e["SHADOWPCSS"+s]&&t.addFallback(n,"SHADOWPCSS"+s),e["SHADOWPOISSON"+s]&&t.addFallback(n,"SHADOWPOISSON"+s),e["SHADOWESM"+s]&&t.addFallback(n,"SHADOWESM"+s),e["SHADOWCLOSEESM"+s]&&t.addFallback(n,"SHADOWCLOSEESM"+s));return a++}function cm(e,t){return t.fogEnabled&&e.applyFog&&0!==t.fogMode}function hm(e,t,i,n,a,s,r,o=!1){r._areMiscDirty&&(r.LOGARITHMICDEPTH=i,r.POINTSIZE=n,r.FOG=a&&cm(e,t),r.NONUNIFORMSCALING=e.nonUniformScaling,r.ALPHATEST=s,r.DECAL_AFTER_DETAIL=o)}function fm(e,t,i,n,a=4,s=!1){if(!i._areLightsDirty)return i._needNormals;let r=0;const o={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!s)for(const s of t.lightSources)if(um(e,t,s,r,i,n,o),r++,r===a)break;i.SPECULARTERM=o.specularEnabled,i.SHADOWS=o.shadowEnabled;for(let e=r;e<a;e++)void 0!==i["LIGHT"+e]&&(i["LIGHT"+e]=!1,i["HEMILIGHT"+e]=!1,i["POINTLIGHT"+e]=!1,i["DIRLIGHT"+e]=!1,i["SPOTLIGHT"+e]=!1,i["SHADOW"+e]=!1,i["SHADOWCSM"+e]=!1,i["SHADOWCSMDEBUG"+e]=!1,i["SHADOWCSMNUM_CASCADES"+e]=!1,i["SHADOWCSMUSESHADOWMAXZ"+e]=!1,i["SHADOWCSMNOBLEND"+e]=!1,i["SHADOWCSM_RIGHTHANDED"+e]=!1,i["SHADOWPCF"+e]=!1,i["SHADOWPCSS"+e]=!1,i["SHADOWPOISSON"+e]=!1,i["SHADOWESM"+e]=!1,i["SHADOWCLOSEESM"+e]=!1,i["SHADOWCUBE"+e]=!1,i["SHADOWLOWQUALITY"+e]=!1,i["SHADOWMEDIUMQUALITY"+e]=!1);const l=e.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(o.needRebuild=!0),i.SHADOWFLOAT=o.shadowEnabled&&(l.textureFloatRender&&l.textureFloatLinearFiltering||l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=o.lightmapMode,o.needRebuild&&i.rebuild(),o.needNormals}function um(e,t,i,n,a,s,r){switch(r.needNormals=!0,void 0===a["LIGHT"+n]&&(r.needRebuild=!0),a["LIGHT"+n]=!0,a["SPOTLIGHT"+n]=!1,a["HEMILIGHT"+n]=!1,a["POINTLIGHT"+n]=!1,a["DIRLIGHT"+n]=!1,i.prepareLightSpecificDefines(a,n),a["LIGHT_FALLOFF_PHYSICAL"+n]=!1,a["LIGHT_FALLOFF_GLTF"+n]=!1,a["LIGHT_FALLOFF_STANDARD"+n]=!1,i.falloffType){case Ud.FALLOFF_GLTF:a["LIGHT_FALLOFF_GLTF"+n]=!0;break;case Ud.FALLOFF_PHYSICAL:a["LIGHT_FALLOFF_PHYSICAL"+n]=!0;break;case Ud.FALLOFF_STANDARD:a["LIGHT_FALLOFF_STANDARD"+n]=!0}if(s&&!i.specular.equalsFloats(0,0,0)&&(r.specularEnabled=!0),a["SHADOW"+n]=!1,a["SHADOWCSM"+n]=!1,a["SHADOWCSMDEBUG"+n]=!1,a["SHADOWCSMNUM_CASCADES"+n]=!1,a["SHADOWCSMUSESHADOWMAXZ"+n]=!1,a["SHADOWCSMNOBLEND"+n]=!1,a["SHADOWCSM_RIGHTHANDED"+n]=!1,a["SHADOWPCF"+n]=!1,a["SHADOWPCSS"+n]=!1,a["SHADOWPOISSON"+n]=!1,a["SHADOWESM"+n]=!1,a["SHADOWCLOSEESM"+n]=!1,a["SHADOWCUBE"+n]=!1,a["SHADOWLOWQUALITY"+n]=!1,a["SHADOWMEDIUMQUALITY"+n]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&i.shadowEnabled){const t=i.getShadowGenerator(e.activeCamera)??i.getShadowGenerator();if(t){const e=t.getShadowMap();e&&e.Pt&&e.Pt.length>0&&(r.shadowEnabled=!0,t.prepareDefines(a,n))}}i.lightmapMode!=Ud.LIGHTMAP_DEFAULT?(r.lightmapMode=!0,a["LIGHTMAPEXCLUDED"+n]=!0,a["LIGHTMAPNOSPECULAR"+n]=i.lightmapMode==Ud.LIGHTMAP_SHADOWSONLY):(a["LIGHTMAPEXCLUDED"+n]=!1,a["LIGHTMAPNOSPECULAR"+n]=!1)}function dm(e,t,i,n,a,s=null,r=!1){let o=Sm(e,n);!1!==s&&(o=function(e,t,i){let n=!1;const a=!!(e.clipPlane??t.clipPlane),s=!!(e.clipPlane2??t.clipPlane2),r=!!(e.clipPlane3??t.clipPlane3),o=!!(e.clipPlane4??t.clipPlane4),l=!!(e.clipPlane5??t.clipPlane5),c=!!(e.clipPlane6??t.clipPlane6);return i.CLIPPLANE!==a&&(i.CLIPPLANE=a,n=!0),i.CLIPPLANE2!==s&&(i.CLIPPLANE2=s,n=!0),i.CLIPPLANE3!==r&&(i.CLIPPLANE3=r,n=!0),i.CLIPPLANE4!==o&&(i.CLIPPLANE4=o,n=!0),i.CLIPPLANE5!==l&&(i.CLIPPLANE5=l,n=!0),i.CLIPPLANE6!==c&&(i.CLIPPLANE6=c,n=!0),n}(i,e,n)),n.DEPTHPREPASS!==!t.getColorWrite()&&(n.DEPTHPREPASS=!n.DEPTHPREPASS,o=!0),n.INSTANCES!==a&&(n.INSTANCES=a,o=!0),n.THIN_INSTANCES!==r&&(n.THIN_INSTANCES=r,o=!0),o&&n.markAsUnprocessed()}function mm(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;const i=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&i)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!i&&void 0;const n=e.getScene().prePassRenderer;if(n&&n.enabled){const i=-1===n.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=i}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,void 0!==t.BONETEXTURE&&(t.BONETEXTURE=!1)}function pm(e,t,i,n,a=!1,s=!0,r=!0){if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent("normal"),t._needNormals&&e.isVerticesDataPresent("tangent")&&(t.TANGENT=!0);for(let i=1;i<=6;++i)t["UV"+i]=!!t._needUVs&&e.isVerticesDataPresent(`uv${1===i?"":i}`);if(i){const i=e.useVertexColors&&e.isVerticesDataPresent("color");t.VERTEXCOLOR=i,t.VERTEXALPHA=e.hasVertexAlpha&&i&&s}return e.isVerticesDataPresent("instanceColor")&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),n&&mm(e,t),a&&function(e,t){const i=e.morphTargetManager;i?(t.MORPHTARGETS_UV=i.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=i.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=i.supportsNormals&&t.NORMAL,t.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,t.MORPHTARGETS=t.NUM_MORPH_INFLUENCERS>0,t.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}(e,t),r&&function(e,t){const i=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!i||!i.isEnabled)}(e,t),!0}function _m(e,t){if(e.activeCamera){const i=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=i&&t.markAsUnprocessed()}}function vm(e,t,i){const n=t.ORDER_INDEPENDENT_TRANSPARENCY,a=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&i,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,n===t.ORDER_INDEPENDENT_TRANSPARENCY&&a===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}function gm(e,t,i){const n=t.PREPASS;if(!t._arePrePassDirty)return;const a=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&i){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount,t.PREPASS_NORMAL_WORLDSPACE=e.prePassRenderer.generateNormalsInWorldSpace;for(let i=0;i<a.length;i++){const n=e.prePassRenderer.getIndex(a[i].type);-1!==n?(t[a[i].define]=!0,t[a[i].index]=n):t[a[i].define]=!1}}else{t.PREPASS=!1;for(let e=0;e<a.length;e++)t[a[e].define]=!1}t.PREPASS!=n&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}function Sm(e,t){let i=!1;if(e.activeCamera){const n=t.CAMERA_ORTHOGRAPHIC?1:0,a=t.CAMERA_PERSPECTIVE?1:0,s=1===e.activeCamera.mode?1:0,r=0===e.activeCamera.mode?1:0;(n^s||a^r)&&(t.CAMERA_ORTHOGRAPHIC=1===s,t.CAMERA_PERSPECTIVE=1===r,i=!0)}return i}function ym(e,t,i,n,a=null,s=!1){a&&a.push("Light"+e),s||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),i.push("shadowTexture"+e),i.push("depthTexture"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),n&&(i.push("projectionLightTexture"+e),t.push("textureProjectionMatrix"+e)))}function Em(e,t,i,n=4){let a,s=null;if(e.uniformsNames){const r=e;a=r.uniformsNames,s=r.uniformBuffersNames,t=r.samplers,i=r.defines,n=r.maxSimultaneousLights||0}else a=e,t||(t=[]);for(let e=0;e<n&&i["LIGHT"+e];e++)ym(e,a,t,i["PROJECTEDLIGHTTEXTURE"+e],s);i.NUM_MORPH_INFLUENCERS&&(a.push("morphTargetInfluences"),a.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(a.push("bakedVertexAnimationSettings"),a.push("bakedVertexAnimationTextureSizeInverted"),a.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}var Am=class e{get alphaMode(){return this._alphaMode}_preBind(t,i=null){const n=this._scene.getEngine(),a=(null==i?this.sideOrientation:i)===e.ClockWiseSideOrientation;return n.enableEffect(t||this._getDrawWrapper()),n.setState(this.backFaceCulling,this.zOffset,!1,a,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),a}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)}bindOnlyWorldMatrix(e){}get useLogarithmicDepth(){return this._useLogarithmicDepth}forceCompilationAsync(e,t){return new Promise(((i,n)=>{this.forceCompilation(e,(()=>{i()}),t,(e=>{n(e)}))}))}static _ParsePlugins(e,t,i,n){if(e.plugins)for(const a in e.plugins){const s=e.plugins[a];let r=t.pluginManager?.getPlugin(s.name);if(!r){const e=ad.Instantiate("BABYLON."+a);e&&(r=new e(t))}r?.parse(s,i,n)}}get fillMode(){return this._fillMode}getClassName(){return"Material"}get cullBackFaces(){return this._cullBackFaces}set alphaMode(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}markDirty(t=!1){const i=this.getScene().meshes;for(const e of i)if(e.subMeshes)for(const i of e.subMeshes)if(i.getMaterial()===this)for(const e of i._drawWrappers)e&&this._materialContext===e.materialContext&&(e._wasPreviouslyReady=!1,e._wasPreviouslyUsingInstances=null,e._forceRebindOnNextCall=t);t&&this.markAsDirty(e.AllDirtyFlag)}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(const t of this.pluginManager._plugins)e.plugins[t.getClassName()]=t.serialize()}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getAlphaTestTexture(){return null}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}get shaderLanguage(){return this._shaderLanguage}set fogEnabled(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))}get needDepthPrePass(){return this._needDepthPrePass}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Ih),this._onBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new Ih),this._onEffectCreatedObservable}clone(e){return null}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)}bindEyePosition(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}isReadyForSubMesh(e,t,i){const n=t.materialDefines;return!!n&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=n,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}get wireframe(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe}setPrePassRenderer(e){return!1}set wireframe(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode}get fogEnabled(){return this._fogEnabled}constructor(t,i,n){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new Ih,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new Gd,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;const a=i||xh.LastCreatedScene;a&&(this._scene=a,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||ad.RandomId(),this.xt=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new df(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new xd(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,n||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),e.OnEventObservable.notifyObservers(this,1))}needAlphaBlendingForMesh(e){return e.visibility<1||!this._disableAlphaBlending&&(e.hasVertexAlpha||this.needAlphaBlending())}markAsDirty(t){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),t&e.PrePassDirtyFlag&&e._DirtyCallbackArray.push(e._PrePassDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}get _disableAlphaBlending(){return this._transparencyMode===e.MATERIAL_OPAQUE||this._transparencyMode===e.MATERIAL_ALPHATEST}getScene(){return this._scene}isReady(e,t){return!0}getBindedMeshes(){if(this.meshMap){const e=[];for(const t in this.meshMap){const i=this.meshMap[t];i&&e.push(i)}return e}return this._scene.meshes.filter((e=>e.material===this))}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)}set backFaceCulling(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))}get _isMaterial(){return!0}_shouldTurnAlphaTestOn(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}resetDrawCache(){const e=this.getScene().meshes;for(const t of e)if(t.subMeshes)for(const e of t.subMeshes)e.getMaterial()===this&&e.resetDrawCache()}get transparencyMode(){return this._transparencyMode}get canRenderToMRT(){return!1}toString(e){return"Name: "+this.name}_afterBind(e,t=null,i){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,Zd(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){const e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(0!==this.depthFunction){const e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}}needAlphaTesting(){return!!this._forceAlphaTest}set fillMode(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))}get isPrePassCapable(){return!1}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(e._AllDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.onDisposeObservable.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)}))}}static Parse(e,t,i){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return jh.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";const n=ad.Instantiate(e.customType).Parse(e,t,i);return n._loadedUniqueId=e.xt,n}releaseVertexArrayObject(e,t){const i=e.geometry;if(i)if(this._storeEffectOnSubMeshes){if(e.subMeshes)for(const n of e.subMeshes)i._releaseVertexArrayObject(n.effect),t&&n.effect&&n.effect.dispose()}else i._releaseVertexArrayObject(this._drawWrapper.effect)}getEffect(){return this._drawWrapper.effect}get blockDirtyMechanism(){return this._blockDirtyMechanism}get alpha(){return this._alpha}dispose(e,t,i){const n=this.getScene();if(n.stopAnimation(this),n.freeProcessedMaterials(),n.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const e=this._parentContainer.materials.indexOf(this);e>-1&&this._parentContainer.materials.splice(e,1),this._parentContainer=null}if(!0!==i)if(this.meshMap)for(const t in this.meshMap){const i=this.meshMap[t];i&&(i.material=null,this.releaseVertexArrayObject(i,e))}else{const t=n.meshes;for(const i of t)i.material!==this||i.tk||(i.material=null,this.releaseVertexArrayObject(i,e))}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new Ih),this._onUnBindObservable}set cullBackFaces(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.markAsDirty(e.TextureDirtyFlag))}forceCompilation(e,t,i,n){const a={clipPlane:!1,useInstances:!1,...i},s=this.getScene(),r=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const o=()=>{if(!this._scene||!this._scene.getEngine())return;const i=s.clipPlane;if(a.clipPlane&&(s.clipPlane=new cd(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,s=null;if(e.subMeshes){const t=new mf(0,0,0,0,0,e,void 0,!1,!1);t.materialDefines&&(t.materialDefines._renderId=-1),this.isReadyForSubMesh(e,t,a.useInstances)||(t.effect&&t.effect.getCompilationError()&&t.effect.allFallbacksProcessed()?s=t.effect.getCompilationError():(i=!1,setTimeout(o,16)))}i&&(this.allowShaderHotSwapping=r,s&&n&&n(s),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=r,t&&t(this)):setTimeout(o,16);a.clipPlane&&(s.clipPlane=i)};o()}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}bind(e,t){}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.markDirty())}set useLogarithmicDepth(e){const t=this.getScene().getEngine().getCaps().fragmentDepthSupported;e&&!t&&jh.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._markAllSubMeshesAsMiscDirty()}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}get isFrozen(){return this.checkReadyOnlyOnce}_markAllSubMeshesAsDirty(e){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.getScene().meshes;for(const i of t)if(i.subMeshes)for(const t of i.subMeshes)if(t.getMaterial(!1)===this)for(const i of t._drawWrappers)i&&i.defines&&i.defines.markAllAsDirty&&this._materialContext===i.materialContext&&e(i.defines)}set transparencyMode(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}serialize(){const e=Uh.Serialize(this);return e.stencil=this.stencil.serialize(),e.xt=this.xt,this._serializePlugins(e),e}set alpha(t){if(this._alpha===t)return;const i=this._alpha;this._alpha=t,1!==i&&1!==t||this.markAsDirty(e.MiscDirtyFlag+e.PrePassDirtyFlag)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)}set pointsCloud(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode}get backFaceCulling(){return this._backFaceCulling}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(8,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)}_getEffectiveOrientation(e){return null!==this.sideOrientation?this.sideOrientation:e.sideOrientation}bindForSubMesh(e,t,i){const n=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),n._forceRebindOnNextCall=!1}get pointsCloud(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud}_clonePlugins(t,i){const n={};if(this._serializePlugins(n),e._ParsePlugins(n,t,this._scene,i),this.pluginManager)for(const e of this.pluginManager._plugins){const i=t.pluginManager.getPlugin(e.name);i&&e.copyTo(i)}}};Am.TriangleFillMode=0,Am.WireFrameFillMode=1,Am.PointFillMode=2,Am.PointListDrawMode=3,Am.LineListDrawMode=4,Am.LineLoopDrawMode=5,Am.LineStripDrawMode=6,Am.TriangleStripDrawMode=7,Am.TriangleFanDrawMode=8,Am.ClockWiseSideOrientation=0,Am.CounterClockWiseSideOrientation=1,Am.TextureDirtyFlag=1,Am.LightDirtyFlag=2,Am.FresnelDirtyFlag=4,Am.AttributesDirtyFlag=8,Am.MiscDirtyFlag=16,Am.PrePassDirtyFlag=32,Am.AllDirtyFlag=63,Am.MATERIAL_OPAQUE=0,Am.MATERIAL_ALPHATEST=1,Am.MATERIAL_ALPHABLEND=2,Am.MATERIAL_ALPHATESTANDBLEND=3,Am.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,Am.MATERIAL_NORMALBLENDMETHOD_RNM=1,Am.OnEventObservable=new Ih,Am._AllDirtyCallBack=e=>e.markAllAsDirty(),Am._ImageProcessingDirtyCallBack=e=>e.markAsImageProcessingDirty(),Am._TextureDirtyCallBack=e=>e.markAsTexturesDirty(),Am._FresnelDirtyCallBack=e=>e.markAsFresnelDirty(),Am._MiscDirtyCallBack=e=>e.markAsMiscDirty(),Am._PrePassDirtyCallBack=e=>e.markAsPrePassDirty(),Am._LightsDirtyCallBack=e=>e.markAsLightDirty(),Am._AttributeDirtyCallBack=e=>e.markAsAttributesDirty(),Am._FresnelAndMiscDirtyCallBack=e=>{Am._FresnelDirtyCallBack(e),Am._MiscDirtyCallBack(e)},Am._TextureAndMiscDirtyCallBack=e=>{Am._TextureDirtyCallBack(e),Am._MiscDirtyCallBack(e)},Am._DirtyCallbackArray=[],Am._RunDirtyCallBacks=e=>{for(const t of Am._DirtyCallbackArray)t(e)},Lc([Hc()],Am.prototype,"id",void 0),Lc([Hc()],Am.prototype,"uniqueId",void 0),Lc([Hc()],Am.prototype,"name",void 0),Lc([Hc()],Am.prototype,"metadata",void 0),Lc([Hc()],Am.prototype,"checkReadyOnEveryCall",void 0),Lc([Hc()],Am.prototype,"checkReadyOnlyOnce",void 0),Lc([Hc()],Am.prototype,"state",void 0),Lc([Hc("alpha")],Am.prototype,"_alpha",void 0),Lc([Hc("backFaceCulling")],Am.prototype,"_backFaceCulling",void 0),Lc([Hc("cullBackFaces")],Am.prototype,"_cullBackFaces",void 0),Lc([Hc()],Am.prototype,"sideOrientation",void 0),Lc([Hc("alphaMode")],Am.prototype,"_alphaMode",void 0),Lc([Hc()],Am.prototype,"_needDepthPrePass",void 0),Lc([Hc()],Am.prototype,"disableDepthWrite",void 0),Lc([Hc()],Am.prototype,"disableColorWrite",void 0),Lc([Hc()],Am.prototype,"forceDepthWrite",void 0),Lc([Hc()],Am.prototype,"depthFunction",void 0),Lc([Hc()],Am.prototype,"separateCullingPass",void 0),Lc([Hc("fogEnabled")],Am.prototype,"_fogEnabled",void 0),Lc([Hc()],Am.prototype,"pointSize",void 0),Lc([Hc()],Am.prototype,"zOffset",void 0),Lc([Hc()],Am.prototype,"zOffsetUnits",void 0),Lc([Hc()],Am.prototype,"pointsCloud",null),Lc([Hc()],Am.prototype,"fillMode",null),Lc([Hc()],Am.prototype,"useLogarithmicDepth",null),Lc([Hc()],Am.prototype,"transparencyMode",null);var Cm=class e extends Am{isReadyForSubMesh(e,t,i){for(let n=0;n<this.subMaterials.length;n++){const a=this.subMaterials[n];if(a){if(a._storeEffectOnSubMeshes){if(!a.isReadyForSubMesh(e,t,i))return!1;continue}if(!a.isReady(e))return!1}}return!0}serialize(){const e={};e.name=this.name,e.id=this.id,e.xt=this.xt,eh&&(e.tags=eh.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(let t=0;t<this.subMaterials.length;t++){const i=this.subMaterials[t];i?(e.materialsUniqueIds.push(i.xt),e.materials.push(i.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}get subMaterials(){return this._subMaterials}clone(t,i){const n=new e(t,this.getScene());for(let e=0;e<this.subMaterials.length;e++){let a=null;const s=this.subMaterials[e];a=i&&s?s.clone(t+"-"+s.name):this.subMaterials[e],n.subMaterials.push(a)}return n}getClassName(){return"MultiMaterial"}hasTexture(e){if(super.hasTexture(e))return!0;for(let t=0;t<this.subMaterials.length;t++)if(this.subMaterials[t]?.hasTexture(e))return!0;return!1}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map((e=>e?e.getActiveTextures():[])))}static ParseMultiMaterial(t,i){const n=new e(t.name,i);return n.id=t.id,n._loadedUniqueId=t.xt,eh&&eh.AddTagsTo(n,t.tags),t.materialsUniqueIds?n._waitingSubMaterialsUniqueIds=t.materialsUniqueIds:t.materials.forEach((e=>n.subMaterials.push(i.getLastMaterialById(e)))),n}set subMaterials(e){this._subMaterials=e,this._hookArray(e)}constructor(e,t){super(e,t,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}_hookArray(e){const t=e.push;e.push=(...i)=>{const n=t.apply(e,i);return this._markAllSubMeshesAsTexturesDirty(),n};const i=e.splice;e.splice=(t,n)=>{const a=i.apply(e,[t,n]);return this._markAllSubMeshesAsTexturesDirty(),a}}getSubMaterial(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}getChildren(){return this.subMaterials}dispose(e,t,i){const n=this.getScene();if(!n)return;if(i)for(let i=0;i<this.subMaterials.length;i++){const n=this.subMaterials[i];n&&n.dispose(e,t)}const a=n.multiMaterials.indexOf(this);a>=0&&n.multiMaterials.splice(a,1),super.dispose(e,t)}};rh("BABYLON.MultiMaterial",Cm);var Rm=class{};Rm.NAME_EFFECTLAYER="EffectLayer",Rm.NAME_LAYER="Layer",Rm.NAME_LENSFLARESYSTEM="LensFlareSystem",Rm.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",Rm.NAME_PARTICLESYSTEM="ParticleSystem",Rm.NAME_GAMEPAD="Gamepad",Rm.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",Rm.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",Rm.NAME_PREPASSRENDERER="PrePassRenderer",Rm.NAME_DEPTHRENDERER="DepthRenderer",Rm.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",Rm.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",Rm.NAME_SPRITE="Sprite",Rm.NAME_SUBSURFACE="SubSurface",Rm.NAME_OUTLINERENDERER="Outline",Rm.NAME_PROCEDURALTEXTURE="ProceduralTexture",Rm.NAME_SHADOWGENERATOR="ShadowGenerator",Rm.NAME_OCTREE="Octree",Rm.NAME_PHYSICSENGINE="PhysicsEngine",Rm.NAME_AUDIO="Audio",Rm.NAME_FLUIDRENDERER="FluidRenderer",Rm.STEP_ISREADYFORMESH_EFFECTLAYER=0,Rm.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,Rm.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,Rm.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,Rm.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,Rm.STEP_BEFORECAMERADRAW_PREPASS=0,Rm.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,Rm.STEP_BEFORECAMERADRAW_LAYER=2,Rm.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,Rm.STEP_BEFORERENDERTARGETDRAW_LAYER=1,Rm.STEP_BEFORERENDERINGMESH_PREPASS=0,Rm.STEP_BEFORERENDERINGMESH_OUTLINE=1,Rm.STEP_AFTERRENDERINGMESH_PREPASS=0,Rm.STEP_AFTERRENDERINGMESH_OUTLINE=1,Rm.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,Rm.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,Rm.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,Rm.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,Rm.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,Rm.STEP_BEFORECLEAR_PREPASS=1,Rm.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,Rm.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,Rm.STEP_AFTERRENDERTARGETDRAW_LAYER=1,Rm.STEP_AFTERCAMERADRAW_PREPASS=0,Rm.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,Rm.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,Rm.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,Rm.STEP_AFTERCAMERADRAW_LAYER=4,Rm.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,Rm.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,Rm.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,Rm.STEP_AFTERRENDER_AUDIO=0,Rm.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,Rm.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,Rm.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,Rm.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,Rm.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,Rm.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,Rm.STEP_POINTERMOVE_SPRITE=0,Rm.STEP_POINTERDOWN_SPRITE=0,Rm.STEP_POINTERUP_SPRITE=0;var Tm=class e extends Array{registerStep(e,t,i){let n=0,a=Number.MAX_VALUE;for(;n<this.length;n++){if(a=this[n].index,e<a)break}this.splice(n,0,{index:e,component:t,action:i.bind(t)})}static Create(){return Object.create(e.prototype)}constructor(e){super(...e)}clear(){this.length=0}},Nm=class{constructor(e,t){this.distanceOrScreenCoverage=e,this.mesh=t}},Mm=class{},Im=class{constructor(){this.visibleInstances={},this.batchCache=new xm,this.batchCacheReplacementModeInFrozenMode=new xm,this.instancesBufferSize=2048}},xm=class{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}},bm=class{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}},Pm=class{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}},wm=class e extends Bd{makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const e=this._geometry,t=this._geometry.copy(md.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this}_normalizeSkinFourWeights(){const e=this.getVerticesData($h.MatricesWeightsKind),t=e.length;for(let i=0;i<t;i+=4){const t=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===t)e[i]=1;else{const n=1/t;e[i]*=n,e[i+1]*=n,e[i+2]*=n,e[i+3]*=n}}this.setVerticesData($h.MatricesWeightsKind,e)}getAnimatables(){const e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e}get isUnIndexed(){return this._unIndexed}dispose(e,t=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),i._onBetweenPassObservable&&i._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(const e in i.meshMap){const t=i.meshMap[e];t&&(t._internalMeshDataInfo._source=null,i.meshMap[e]=void 0)}i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.xt]=void 0)}else{const e=this.getScene().meshes;for(const t of e){const e=t;e._internalMeshDataInfo&&e._internalMeshDataInfo._source&&e._internalMeshDataInfo._source===this&&(e._internalMeshDataInfo._source=null)}}i._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(e,t)}registerBeforeRender(e){return this.onBeforeRenderObservable.add(e),this}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(e){this._instanceDataStorage.previousManualUpdate=e}_disposeThinInstanceSpecificData(){}unregisterAfterRender(e){return this.onAfterRenderObservable.removeCallback(e),this}static Parse(t,i,n){let a;if(a=t.type&&"LinesMesh"===t.type?e._LinesMeshParser(t,i):t.type&&"GroundMesh"===t.type?e._GroundMeshParser(t,i):t.type&&"GoldbergMesh"===t.type?e._GoldbergMeshParser(t,i):t.type&&"GreasedLineMesh"===t.type?e._GreasedLineMeshParser(t,i):t.type&&"TrailMesh"===t.type?e._TrailMeshParser(t,i):new e(t.name,i),a.id=t.id,a._waitingParsedUniqueId=t.xt,eh&&eh.AddTagsTo(a,t.tags),a.position=wh.FromArray(t.position),void 0!==t.metadata&&(a.metadata=t.metadata),t.rotationQuaternion?a.rotationQuaternion=Dh.FromArray(t.rotationQuaternion):t.rotation&&(a.rotation=wh.FromArray(t.rotation)),a.scaling=wh.FromArray(t.scaling),t.localMatrix?a.setPreTransformMatrix(Lh.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(Lh.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),a.isVisible=t.isVisible,a.infiniteDistance=t.infiniteDistance,a.alwaysSelectAsActiveMesh=!!t.alwaysSelectAsActiveMesh,a.showBoundingBox=t.showBoundingBox,a.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(a.applyFog=t.applyFog),void 0!==t.pickable&&(a.isPickable=t.pickable),void 0!==t.alphaIndex&&(a.alphaIndex=t.alphaIndex),a.receiveShadows=t.receiveShadows,void 0!==t.billboardMode&&(a.billboardMode=t.billboardMode),void 0!==t.visibility&&(a.visibility=t.visibility),a.checkCollisions=t.checkCollisions,a.doNotSyncBoundingInfo=!!t.doNotSyncBoundingInfo,t.ellipsoid&&(a.ellipsoid=wh.FromArray(t.ellipsoid)),t.ellipsoidOffset&&(a.ellipsoidOffset=wh.FromArray(t.ellipsoidOffset)),null!=t.overrideMaterialSideOrientation&&(a.sideOrientation=t.overrideMaterialSideOrientation),void 0!==t.sideOrientation&&(a.sideOrientation=t.sideOrientation),void 0!==t.isBlocker&&(a.isBlocker=t.isBlocker),a._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(a._waitingData.freezeWorldMatrix=t.freezeWorldMatrix),void 0!==t.parentId&&(a._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(a._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.actions&&(a._waitingData.actions=t.actions),void 0!==t.overlayAlpha&&(a.overlayAlpha=t.overlayAlpha),void 0!==t.overlayColor&&(a.overlayColor=Ah.FromArray(t.overlayColor)),void 0!==t.renderOverlay&&(a.renderOverlay=t.renderOverlay),a.isUnIndexed=!!t.isUnIndexed,a.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(a.delayLoadState=4,a.delayLoadingFile=n+t.delayLoadingFile,a.buildBoundingInfo(wh.FromArray(t.boundingBoxMinimum),wh.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(a._binaryInfo=t._binaryInfo),a._delayInfo=[],t.hasUVs&&a._delayInfo.push($h.UVKind),t.hasUVs2&&a._delayInfo.push($h.UV2Kind),t.hasUVs3&&a._delayInfo.push($h.UV3Kind),t.hasUVs4&&a._delayInfo.push($h.UV4Kind),t.hasUVs5&&a._delayInfo.push($h.UV5Kind),t.hasUVs6&&a._delayInfo.push($h.UV6Kind),t.hasColors&&a._delayInfo.push($h.ColorKind),t.hasMatricesIndices&&a._delayInfo.push($h.MatricesIndicesKind),t.hasMatricesWeights&&a._delayInfo.push($h.MatricesWeightsKind),a._delayLoadingFunction=md._ImportGeometry,ud.ForceFullSceneLoadingForIncremental&&a._checkDelayState()):md._ImportGeometry(t,a),t.materialUniqueId?a._waitingMaterialId=t.materialUniqueId:t.materialId&&(a._waitingMaterialId=t.materialId),t.morphTargetManagerId>-1&&(a.morphTargetManager=i.getMorphTargetManagerById(t.morphTargetManagerId)),void 0!==t.skeletonId&&null!==t.skeletonId&&(a.skeleton=i.getLastSkeletonById(t.skeletonId),t.numBoneInfluencers&&(a.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],n=oh("BABYLON.Animation");n&&a.animations.push(n.Parse(i))}Vh.ParseAnimationRanges(a,t,i)}if(t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?a.layerMask=Math.abs(parseInt(t.layerMask)):a.layerMask=268435455,t.physicsImpostor&&(a.physicsImpostor=e._PhysicsImpostorParser(i,a,t)),t.lodMeshIds&&(a._waitingData.lods={ids:t.lodMeshIds,distances:t.lodDistances?t.lodDistances:null,coverages:t.lodCoverages?t.lodCoverages:null}),t.instances)for(let n=0;n<t.instances.length;n++){const s=t.instances[n],r=a.createInstance(s.name);if(s.id&&(r.id=s.id),eh&&(s.tags?eh.AddTagsTo(r,s.tags):eh.AddTagsTo(r,t.tags)),r.position=wh.FromArray(s.position),void 0!==s.metadata&&(r.metadata=s.metadata),void 0!==s.parentId&&(r._waitingParentId=s.parentId),void 0!==s.parentInstanceIndex&&(r._waitingParentInstanceIndex=s.parentInstanceIndex),void 0!==s.isEnabled&&null!==s.isEnabled&&r.setEnabled(s.isEnabled),void 0!==s.isVisible&&null!==s.isVisible&&(r.isVisible=s.isVisible),void 0!==s.isPickable&&null!==s.isPickable&&(r.isPickable=s.isPickable),s.rotationQuaternion?r.rotationQuaternion=Dh.FromArray(s.rotationQuaternion):s.rotation&&(r.rotation=wh.FromArray(s.rotation)),r.scaling=wh.FromArray(s.scaling),null!=s.checkCollisions&&null!=s.checkCollisions&&(r.checkCollisions=s.checkCollisions),null!=s.pickable&&null!=s.pickable&&(r.isPickable=s.pickable),null!=s.showBoundingBox&&null!=s.showBoundingBox&&(r.showBoundingBox=s.showBoundingBox),null!=s.showSubMeshesBoundingBox&&null!=s.showSubMeshesBoundingBox&&(r.showSubMeshesBoundingBox=s.showSubMeshesBoundingBox),null!=s.alphaIndex&&null!=s.showSubMeshesBoundingBox&&(r.alphaIndex=s.alphaIndex),s.physicsImpostor&&(r.physicsImpostor=e._PhysicsImpostorParser(i,r,s)),void 0!==s.actions&&(r._waitingData.actions=s.actions),s.animations){for(let e=0;e<s.animations.length;e++){const t=s.animations[e],i=oh("BABYLON.Animation");i&&r.animations.push(i.Parse(t))}Vh.ParseAnimationRanges(r,s,i),s.autoAnimate&&i.beginAnimation(r,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1)}}if(t.thinInstances){const e=t.thinInstances;if(a.thinInstanceEnablePicking=!!e.enablePicking,e.matrixData?(a.thinInstanceSetBuffer("matrix",new Float32Array(e.matrixData),16,!1),a._thinInstanceDataStorage.matrixBufferSize=e.matrixBufferSize,a._thinInstanceDataStorage.instancesCount=e.instancesCount):a._thinInstanceDataStorage.matrixBufferSize=e.matrixBufferSize,t.thinInstances.userThinInstance){const e=t.thinInstances.userThinInstance;for(const t in e.data)a.thinInstanceSetBuffer(t,new Float32Array(e.data[t]),e.strides[t],!1),a._userThinInstanceBuffersStorage.sizes[t]=e.sizes[t]}}return a}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}setPositionsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourcePositions){const t=this.getVerticesData($h.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable($h.PositionKind)||this.setVerticesData($h.PositionKind,t,!0)}return e._sourcePositions}get geometry(){return this._geometry}getVerticesData(e,t,i,n){if(!this._geometry)return null;let a=n?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e]?.getFloatData(this.instances.length+1,i||t&&1!==this._geometry.meshes.length);return a||(a=this._geometry.getVerticesData(e,t,i)),a}setIndices(e,t=null,i=!1){if(this._geometry)this._geometry.setIndices(e,t,i);else{const t=new _f;t.indices=e;const n=this.getScene();new md(md.RandomId(),n,t,i,this)}return this}isInFrustum(e){return 2!==this.delayLoadState&&(!!super.isInFrustum(e)&&(this._checkDelayState(),!0))}static kk(e,t,i,n,a,s,r){throw new Error("Import MeshBuilder to populate this function")}_bind(e,t,i,n=!0){if(!this._geometry)return this;const a=this.getScene().getEngine();let s;if(this._unIndexed)s=null;else switch(this._getRenderingFillMode(i)){case Am.PointFillMode:s=null;break;case Am.WireFrameFillMode:s=e._getLinesIndexBuffer(this.getIndices(),a);break;default:case Am.TriangleFillMode:s=this._geometry.getIndexBuffer()}return this._bindDirect(t,s,n)}_processRendering(e,t,i,n,a,s,r,o){const l=this.getScene(),c=l.getEngine();if(n=this._getRenderingFillMode(n),s&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,n,i,c),this;if(s)this._renderWithInstances(t,n,a,i,c);else{c._currentDrawContext&&(c._currentDrawContext.useInstancing=!1);let i=0;a.renderSelf[t._id]&&(r&&r(!1,e.getWorldMatrix(),o),i++,this._draw(t,n,this._instanceDataStorage.overridenInstanceCount));const s=a.visibleInstances[t._id];if(s){const e=s.length;i+=e;for(let i=0;i<e;i++){const e=s[i].getWorldMatrix();r&&r(!0,e,o),this._draw(t,n)}}l._activeIndices.addCount(t.indexCount*i,!1)}return this}set forcedInstanceCount(e){this._internalMeshDataInfo._forcedInstanceCount=e}validateSkinning(){const e=this.getVerticesData($h.MatricesWeightsExtraKind),t=this.getVerticesData($h.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};const i=t.length;let n=0,a=0,s=0,r=0;const o=null===e?4:8,l=[];for(let e=0;e<=o;e++)l[e]=0;for(let c=0;c<i;c+=4){let i=t[c],h=i,f=0===h?0:1;for(let a=1;a<o;a++){const s=a<4?t[c+a]:e[c+a-4];s>i&&n++,0!==s&&f++,h+=s,i=s}if(l[f]++,f>s&&(s=f),0===h)a++;else{const i=1/h;let n=0;for(let a=0;a<o;a++)n+=a<4?Math.abs(t[c+a]-t[c+a]*i):Math.abs(e[c+a-4]-e[c+a-4]*i);n>.001&&r++}}const c=this.skeleton.bones.length,h=this.getVerticesData($h.MatricesIndicesKind),f=this.getVerticesData($h.MatricesIndicesExtraKind);let u=0;for(let e=0;e<i;e+=4)for(let t=0;t<o;t++){const i=t<4?h[e+t]:f[e+t-4];(i>=c||i<0)&&u++}return{skinned:!0,valid:0===a&&0===r&&0===u,report:"Number of Weights = "+i/4+"\nMaximum influences = "+s+"\nMissing Weights = "+a+"\nNot Sorted = "+n+"\nNot Normalized = "+r+"\nWeightCounts = ["+l+"]\nNumber of bones = "+c+"\nBad Bone Indices = "+u}}static CreateTorusKnot(e,t,i,n,a,s,r,o,l,c){throw new Error("Import MeshBuilder to populate this function")}renderWithRenderPassId(e,t,i,n,a=!0){const s=this._scene.getEngine(),r=s.currentRenderPassId;if(void 0!==e&&(s.currentRenderPassId=e),n)(!a||a&&n.isInFrustum(this._scene._frustumPlanes))&&this.render(n,!!t,i);else for(let e=0;e<this.subMeshes.length;e++){const n=this.subMeshes[e];(!a||a&&n.isInFrustum(this._scene._frustumPlanes))&&this.render(n,!!t,i)}return void 0!==e&&(s.currentRenderPassId=r),this}setMaterialByID(e){return this.setMaterialById(e)}forceSharedVertices(){const e=_f.ExtractFromMesh(this),t=e.uvs,i=e.indices,n=e.positions,a=e.colors,s=e.matricesIndices,r=e.matricesWeights,o=e.matricesIndicesExtra,l=e.matricesWeightsExtra;if(void 0===i||void 0===n||null===i||null===n)jh.Warn("VertexData contains empty entries");else{const c=new Array,h=new Array,f=new Array,u=new Array,d=new Array,m=new Array,p=new Array,_=new Array;let v=new Array,g=0;const S={};let y,E;for(let e=0;e<i.length;e+=3){E=[i[e],i[e+1],i[e+2]],v=[];for(let e=0;e<3;e++){v[e]="";for(let t=0;t<3;t++)Math.abs(n[3*E[e]+t])<1e-8&&(n[3*E[e]+t]=0),v[e]+=n[3*E[e]+t]+"|"}if(v[0]!=v[1]&&v[0]!=v[2]&&v[1]!=v[2])for(let e=0;e<3;e++){if(y=S[v[e]],void 0===y){S[v[e]]=g,y=g++;for(let t=0;t<3;t++)c.push(n[3*E[e]+t]);if(null!=a)for(let t=0;t<4;t++)u.push(a[4*E[e]+t]);if(null!=t)for(let i=0;i<2;i++)f.push(t[2*E[e]+i]);if(null!=s)for(let t=0;t<4;t++)d.push(s[4*E[e]+t]);if(null!=r)for(let t=0;t<4;t++)m.push(r[4*E[e]+t]);if(null!=o)for(let t=0;t<4;t++)p.push(o[4*E[e]+t]);if(null!=l)for(let t=0;t<4;t++)_.push(l[4*E[e]+t])}h.push(y)}}const A=new Array;_f.ComputeNormals(c,h,A),e.positions=c,e.indices=h,e.normals=A,null!=t&&(e.uvs=f),null!=a&&(e.colors=u),null!=s&&(e.matricesIndices=d),null!=r&&(e.matricesWeights=m),null!=o&&(e.matricesIndicesExtra=p),null!=r&&(e.matricesWeightsExtra=_),e.applyToMesh(this,this.isVertexBufferUpdatable($h.PositionKind))}}setIndexBuffer(e,t,i){let n=this._geometry;n||(n=new md(md.RandomId(),this.getScene(),void 0,void 0,this)),n.setIndexBuffer(e,t,i)}_bindDirect(e,t,i=!0){return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(e),i&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(e,t,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(e,t),this):this}get _isMesh(){return!0}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}set overridenInstanceCount(e){this._instanceDataStorage.overridenInstanceCount=e}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}setVerticesData(e,t,i=!1,n){if(this._geometry)this._geometry.setVerticesData(e,t,i,n);else{const n=new _f;n.set(t,e);const a=this.getScene();new md(md.RandomId(),a,n,i,this)}return this}increaseVertices(e=1){const t=_f.ExtractFromMesh(this),i=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,n=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,a=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,s=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(i&&n){t.indices=i,t.positions=n,a&&(t.uvs=a),s&&(t.normals=s);const r=e+1,o=new Array;for(let e=0;e<r+1;e++)o[e]=new Array;let l,c;const h=new wh(0,0,0),f=new wh(0,0,0),u=new Ph(0,0),d=new Array,m=new Array,p=new Array;let _,v,g,S=n.length;a&&(v=a.length),s&&(g=s.length);for(let e=0;e<i.length;e+=3){m[0]=i[e],m[1]=i[e+1],m[2]=i[e+2];for(let e=0;e<3;e++)if(l=m[e],c=m[(e+1)%3],void 0===p[l]&&void 0===p[c]?(p[l]=new Array,p[c]=new Array):(void 0===p[l]&&(p[l]=new Array),void 0===p[c]&&(p[c]=new Array)),void 0===p[l][c]&&void 0===p[c][l]){p[l][c]=[],h.x=(n[3*c]-n[3*l])/r,h.y=(n[3*c+1]-n[3*l+1])/r,h.z=(n[3*c+2]-n[3*l+2])/r,s&&(f.x=(s[3*c]-s[3*l])/r,f.y=(s[3*c+1]-s[3*l+1])/r,f.z=(s[3*c+2]-s[3*l+2])/r),a&&(u.x=(a[2*c]-a[2*l])/r,u.y=(a[2*c+1]-a[2*l+1])/r),p[l][c].push(l);for(let e=1;e<r;e++)p[l][c].push(n.length/3),n[S++]=n[3*l]+e*h.x,n[S++]=n[3*l+1]+e*h.y,n[S++]=n[3*l+2]+e*h.z,s&&(s[g++]=s[3*l]+e*f.x,s[g++]=s[3*l+1]+e*f.y,s[g++]=s[3*l+2]+e*f.z),a&&(a[v++]=a[2*l]+e*u.x,a[v++]=a[2*l+1]+e*u.y);p[l][c].push(c),p[c][l]=new Array,_=p[l][c].length;for(let e=0;e<_;e++)p[c][l][e]=p[l][c][_-1-e]}o[0][0]=i[e],o[1][0]=p[i[e]][i[e+1]][1],o[1][1]=p[i[e]][i[e+2]][1];for(let t=2;t<r;t++){o[t][0]=p[i[e]][i[e+1]][t],o[t][t]=p[i[e]][i[e+2]][t],h.x=(n[3*o[t][t]]-n[3*o[t][0]])/t,h.y=(n[3*o[t][t]+1]-n[3*o[t][0]+1])/t,h.z=(n[3*o[t][t]+2]-n[3*o[t][0]+2])/t,s&&(f.x=(s[3*o[t][t]]-s[3*o[t][0]])/t,f.y=(s[3*o[t][t]+1]-s[3*o[t][0]+1])/t,f.z=(s[3*o[t][t]+2]-s[3*o[t][0]+2])/t),a&&(u.x=(a[2*o[t][t]]-a[2*o[t][0]])/t,u.y=(a[2*o[t][t]+1]-a[2*o[t][0]+1])/t);for(let e=1;e<t;e++)o[t][e]=n.length/3,n[S++]=n[3*o[t][0]]+e*h.x,n[S++]=n[3*o[t][0]+1]+e*h.y,n[S++]=n[3*o[t][0]+2]+e*h.z,s&&(s[g++]=s[3*o[t][0]]+e*f.x,s[g++]=s[3*o[t][0]+1]+e*f.y,s[g++]=s[3*o[t][0]+2]+e*f.z),a&&(a[v++]=a[2*o[t][0]]+e*u.x,a[v++]=a[2*o[t][0]+1]+e*u.y)}o[r]=p[i[e+1]][i[e+2]],d.push(o[0][0],o[1][0],o[1][1]);for(let e=1;e<r;e++){let t;for(t=0;t<e;t++)d.push(o[e][t],o[e+1][t],o[e+1][t+1]),d.push(o[e][t],o[e+1][t+1],o[e][t+1]);d.push(o[e][t],o[e+1][t],o[e+1][t+1])}}t.indices=d,t.applyToMesh(this,this.isVertexBufferUpdatable($h.PositionKind))}else jh.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}_queueLoad(e){e.addPendingData(this);const t=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return ad.LoadFile(this.delayLoadingFile,(t=>{t instanceof ArrayBuffer?this._delayLoadingFunction(t,this):this._delayLoadingFunction(JSON.parse(t),this),this.instances.forEach((e=>{e.refreshBoundingInfo(),e._syncSubMeshes()})),this.delayLoadState=1,e.removePendingData(this)}),(()=>{}),e.offlineProvider,t),this}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i;i="object"==typeof e?e:{applySkeleton:e,applyMorph:t};const n=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getData(i,null,$h.PositionKind),n),this}_getFlattenedNormals(e,t){const i=new Float32Array(3*e.length);let n=0;const a=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let s=0;s<e.length;s+=3){const r=wh.FromArray(t,3*e[s]),o=wh.FromArray(t,3*e[s+1]),l=wh.FromArray(t,3*e[s+2]),c=r.subtract(o),h=l.subtract(o),f=wh.Normalize(wh.Cross(c,h));a&&f.scaleInPlace(-1);for(let e=0;e<3;e++)i[n++]=f.x,i[n++]=f.y,i[n++]=f.z}return i}_preActivateForIntermediateRendering(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this}_rebuild(e=!1){if(this._instanceDataStorage.instancesBuffer&&(e&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const t in this._userInstancedBuffersStorage.vertexBuffers){const i=this._userInstancedBuffersStorage.vertexBuffers[t];i&&(e&&i.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(e)}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}static ExtrudePolygon(e,t,i,n,a,s,r,o){throw new Error("Import MeshBuilder to populate this function")}_registerInstanceForRenderId(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this}getIndices(e,t){return this._geometry?this._geometry.getIndices(e,t):[]}_renderWithInstances(t,i,n,a,s){const r=n.visibleInstances[t._id],o=r?r.length:0,l=this._instanceDataStorage,c=l.instancesBufferSize;let h=l.instancesBuffer,f=l.instancesPreviousBuffer;const u=16*(o+1)*4;for(;l.instancesBufferSize<u;)l.instancesBufferSize*=2;l.instancesData&&c==l.instancesBufferSize||(l.instancesData=new Float32Array(l.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousData||c!=l.instancesBufferSize)&&(l.instancesPreviousData=new Float32Array(l.instancesBufferSize/4));let d=0,m=0;const p=n.renderSelf[t._id],_=!h||c!==l.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||l.isFrozen&&!_)m=(p?1:0)+o;else{const i=this.getWorldMatrix();if(p&&(this._scene.needsPreviousWorldMatrices&&(l.masterMeshPreviousWorldMatrix?(l.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,d),l.masterMeshPreviousWorldMatrix.copyFrom(i)):(l.masterMeshPreviousWorldMatrix=i.clone(),l.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,d))),i.copyToArray(l.instancesData,d),d+=16,m++),r){if(e.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&t.getMaterial()?.needAlphaBlendingForMesh(t.getRenderingMesh())){const e=this._scene.activeCamera.globalPosition;for(let t=0;t<r.length;t++){const i=r[t];i._distanceToCamera=wh.Distance(i.getBoundingInfo().boundingSphere.centerWorld,e)}r.sort(((e,t)=>e._distanceToCamera>t._distanceToCamera?-1:e._distanceToCamera<t._distanceToCamera?1:0))}for(let e=0;e<r.length;e++){const t=r[e],i=t.getWorldMatrix();i.copyToArray(l.instancesData,d),this._scene.needsPreviousWorldMatrices&&(t._previousWorldMatrix?(t._previousWorldMatrix.copyToArray(l.instancesPreviousData,d),t._previousWorldMatrix.copyFrom(i)):(t._previousWorldMatrix=i.clone(),t._previousWorldMatrix.copyToArray(l.instancesPreviousData,d))),d+=16,m++}}}return _?(h&&h.dispose(),f&&f.dispose(),h=new Kh(s,l.instancesData,!0,16,!1,!0),l.instancesBuffer=h,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=h.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=h.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=h.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=h.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(f=new Kh(s,l.instancesPreviousData,!0,16,!1,!0),l.instancesPreviousBuffer=f,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=f.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=f.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=f.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=f.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(h.updateDirectly(l.instancesData,0,m),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||f.updateDirectly(l.instancesPreviousData,0,m)),this._processInstancedBuffers(r,p),this.getScene()._activeIndices.addCount(t.indexCount*m,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(t,a,i),this._draw(t,i,m),!this._scene.needsPreviousWorldMatrices||_||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||f.updateDirectly(l.instancesData,0,m),s.unbindInstanceAttributes(),this}setNormalsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourceNormals){const t=this.getVerticesData($h.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable($h.NormalKind)||this.setVerticesData($h.NormalKind,t,!0)}return e._sourceNormals}getClassName(){return"Mesh"}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}isVerticesDataPresent(e,t){return this._geometry?!t&&void 0!==this._userInstancedBuffersStorage?.vertexBuffers[e]||this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}_renderWithThinInstances(e,t,i,n){const a=this._thinInstanceDataStorage?.instancesCount??0;this.getScene()._activeIndices.addCount(e.indexCount*a,!1),n._currentDrawContext&&(n._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,a),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,a):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),n.unbindInstanceAttributes()}addInstance(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)}removeLODLevel(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this}get material(){return this._internalAbstractMeshDataInfo._material}static CreatePolyhedron(e,t,i){throw new Error("Import MeshBuilder to populate this function")}updateMeshPositions(e,t=!0){const i=this.getVerticesData($h.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData($h.PositionKind,i,!1,!1),t){const e=this.getIndices(),t=this.getVerticesData($h.NormalKind);if(!t)return this;_f.ComputeNormals(i,e,t),this.updateVerticesData($h.NormalKind,t,!1,!1)}return this}static CreateTube(e,t,i,n,a,s,r,o,l,c){throw new Error("Import MeshBuilder to populate this function")}_sortLODLevels(){const e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((t,i)=>t.distanceOrScreenCoverage<i.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>i.distanceOrScreenCoverage?-e:0))}static ExtendToGoldberg(e){throw new Error("Import MeshBuilder to populate this function")}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}static Center(t){const i=t instanceof Array?e.MinMax(t):t;return wh.Center(i.min,i.max)}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}_normalizeSkinWeightsAndExtra(){const e=this.getVerticesData($h.MatricesWeightsExtraKind),t=this.getVerticesData($h.MatricesWeightsKind),i=t.length;for(let n=0;n<i;n+=4){let i=t[n]+t[n+1]+t[n+2]+t[n+3];if(i+=e[n]+e[n+1]+e[n+2]+e[n+3],0===i)t[n]=1;else{const a=1/i;t[n]*=a,t[n+1]*=a,t[n+2]*=a,t[n+3]*=a,e[n]*=a,e[n+1]*=a,e[n+2]*=a,e[n+3]*=a}}this.setVerticesData($h.MatricesWeightsKind,t),this.setVerticesData($h.MatricesWeightsKind,e)}static CreateTorus(e,t,i,n,a,s,r){throw new Error("Import MeshBuilder to populate this function")}_freeze(){if(this.subMeshes){for(let e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}static CreateIcoSphere(e,t,i){throw new Error("Import MeshBuilder to populate this function")}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}applyDisplacementMapFromBuffer(e,t,i,n,a,s,r,o=!1){if(!this.isVerticesDataPresent($h.PositionKind)||!this.isVerticesDataPresent($h.NormalKind)||!this.isVerticesDataPresent($h.UVKind))return jh.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const l=this.getVerticesData($h.PositionKind,!0,!0),c=this.getVerticesData($h.NormalKind),h=this.getVerticesData($h.UVKind);let f=wh.Zero();const u=wh.Zero(),d=Ph.Zero();s=s||Ph.Zero(),r=r||new Ph(1,1);for(let o=0;o<l.length;o+=3){wh.FromArrayToRef(l,o,f),wh.FromArrayToRef(c,o,u),Ph.FromArrayToRef(h,o/3*2,d);const m=4*((Math.abs(d.x*r.x+s.x%1)*(t-1)%t|0)+(Math.abs(d.y*r.y+s.y%1)*(i-1)%i|0)*t),p=.3*(e[m]/255)+.59*(e[m+1]/255)+.11*(e[m+2]/255);u.normalize(),u.scaleInPlace(n+(a-n)*p),f=f.add(u),f.toArray(l,o)}return _f.ComputeNormals(l,this.getIndices(),c),o?(this.setVerticesData($h.PositionKind,l),this.setVerticesData($h.NormalKind,c),this.setVerticesData($h.UVKind,h)):(this.updateVerticesData($h.PositionKind,l),this.updateVerticesData($h.NormalKind,c)),this}get hasInstances(){return this.instances.length>0}static ExtrudeShape(e,t,i,n,a,s,r,o,l,c){throw new Error("Import MeshBuilder to populate this function")}_copySource(e,t,i=!0){const n=this.getScene();if(e._geometry&&e._geometry.applyToMesh(this),Af.DeepCopy(e,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=e,n.useClonedMeshMap&&(e._internalMeshDataInfo.meshMap||(e._internalMeshDataInfo.meshMap={}),e._internalMeshDataInfo.meshMap[this.xt]=this),this._originalBuilderSideOrientation=e._originalBuilderSideOrientation,this._creationDataStorage=e._creationDataStorage,e._ranges){const t=e._ranges;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]&&this.createAnimationRange(e,t[e].from,t[e].to)}if(e.metadata&&e.metadata.clone?this.metadata=e.metadata.clone():this.metadata=e.metadata,this._internalMetadata=e._internalMetadata,eh&&eh.HasTags(e)&&eh.AddTagsTo(this,eh.GetTags(e,!0)),this.setEnabled(e.isEnabled(!1)),this.parent=e.parent,this.setPivotMatrix(e.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+e.id,this.material=e.material,!t){const t=e.getDescendants(!0);for(let e=0;e<t.length;e++){const i=t[e];i.clone&&i.clone(this.name+"."+i.name,this)}}if(e.morphTargetManager&&(this.morphTargetManager=e.morphTargetManager),n.getPhysicsEngine){const t=n.getPhysicsEngine();if(i&&t)if(1===t.getPluginVersion()){const i=t.getImpostorForPhysicsObject(e);i&&(this.physicsImpostor=i.clone(this))}else 2===t.getPluginVersion()&&e.physicsBody&&e.physicsBody.clone(this)}for(let t=0;t<n.particleSystems.length;t++){const i=n.particleSystems[t];i.emitter===e&&i.clone(i.name,this)}this.skeleton=e.skeleton,this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}static st(e,t,i,n,a,s,r,o,l){throw new Error("Import MeshBuilder to populate this function")}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const n=this.getScene().getEngine();return this._unIndexed||t==Am.PointFillMode?n.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||i):t==Am.WireFrameFillMode?n.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||i):n.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i),this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}static CreateDashedLines(e,t,i,n,a,s,r,o){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(e,t,i,n,a,s,r){throw new Error("Import MeshBuilder to populate this function")}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new Ih),this._internalMeshDataInfo._onBetweenPassObservable}setMaterialById(e){const t=this.getScene().materials;let i;for(i=t.length-1;i>-1;i--)if(t[i].id===e)return this.material=t[i],this;const n=this.getScene().multiMaterials;for(i=n.length-1;i>-1;i--)if(n[i].id===e)return this.material=n[i],this;return this}subdivide(e){if(e<1)return;const t=this.getTotalIndices();let i=t/e|0,n=0;for(;i%3!=0;)i++;this.releaseSubMeshes();for(let a=0;a<e&&!(n>=t);a++)mf.CreateFromIndices(0,n,a===e-1?t-n:i,this,void 0,!1),n+=i;this.refreshBoundingInfo(),this.synchronizeInstances()}cleanMatrixWeights(){this.isVerticesDataPresent($h.MatricesWeightsKind)&&(this.isVerticesDataPresent($h.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_getInstancesRenderList(e,t=!1){if(this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const i=this.getScene(),n=i._isInIntermediateRendering(),a=n?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,s=this._instanceDataStorage.batchCache;if(s.mustReturn=!1,s.renderSelf[e]=t||!a&&this.isEnabled()&&this.isVisible,s.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){const t=this._instanceDataStorage.visibleInstances,a=i.getRenderId(),r=n?t.intermediateDefaultRenderId:t.defaultRenderId;s.visibleInstances[e]=t[a],!s.visibleInstances[e]&&r&&(s.visibleInstances[e]=t[r])}return s.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==s.visibleInstances[e]&&void 0!==s.visibleInstances[e],this._instanceDataStorage.previousBatch=s,s}get overrideMaterialSideOrientation(){return this.sideOrientation}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new Ih),this._internalMeshDataInfo._onAfterRenderObservable}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}isVertexBufferUpdatable(e,t){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(e);if(!t){const t=this._userInstancedBuffersStorage?.vertexBuffers[e];if(t)return t.isUpdatable()}return this._geometry.isVertexBufferUpdatable(e)}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}static CreateHemisphere(e,t,i,n){throw new Error("Import MeshBuilder to populate this function")}static Mk(e,t,i,n,a){throw new Error("Import MeshBuilder to populate this function")}createInstance(t){return e._instancedMeshFactory(t,this)}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new Ih),this._internalMeshDataInfo._onBeforeBindObservable}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}static MergeMeshes(t,i=!0,n,a,s,r){return Qh(e._MergeMeshesCoroutine(t,i,n,a,s,r,!1))}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}getVerticesDataKinds(e){if(!this._geometry){const e=[];return this._delayInfo&&this._delayInfo.forEach((function(t){e.push(t)})),e}const t=this._geometry.getVerticesDataKinds();if(!e&&this._userInstancedBuffersStorage)for(const e in this._userInstancedBuffersStorage.vertexBuffers)-1===t.indexOf(e)&&t.push(e);return t}updateIndices(e,t,i=!1){return this._geometry?(this._geometry.updateIndices(e,t,i),this):this}toString(e){let t=super.toString(e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){const e=this.getIndices(),i=this.getVerticesData($h.PositionKind);i&&e&&(t+=", flat shading: "+(i.length/3===e.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}get source(){return this._internalMeshDataInfo._source}copyVerticesData(e,t){this._geometry&&this._geometry.copyVerticesData(e,t)}set sideOrientation(e){this._internalMeshDataInfo._sideOrientation=e,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===e||!this._scene.useRightHandedSystem&&0===e}clone(t="",i=null,n,a=!0){return new e(t,this.getScene(),i,this,n,a)}static Vt(e,t,i,n,a){throw new Error("Import MeshBuilder to populate this function")}static*_MergeMeshesCoroutine(t,i=!0,n,a,s,r,o){if(0===(t=t.filter(Boolean)).length)return null;let l;if(!n){let e=0;for(l=0;l<t.length;l++)if(e+=t[l].getTotalVertices(),e>=65536)return jh.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}r&&(s=!1);const c=new Array,h=new Array,f=new Array,u=t[0].sideOrientation;for(l=0;l<t.length;l++){const e=t[l];if(e.isAnInstance)return jh.Warn("Cannot merge instance meshes."),null;if(u!==e.sideOrientation)return jh.Warn("Cannot merge meshes with different sideOrientation values."),null;if(s&&f.push(e.getTotalIndices()),r)if(e.material){const t=e.material;if(t instanceof Cm){for(let e=0;e<t.subMaterials.length;e++)c.indexOf(t.subMaterials[e])<0&&c.push(t.subMaterials[e]);for(let i=0;i<e.subMeshes.length;i++)h.push(c.indexOf(t.subMaterials[e.subMeshes[i].materialIndex])),f.push(e.subMeshes[i].indexCount)}else{c.indexOf(t)<0&&c.push(t);for(let i=0;i<e.subMeshes.length;i++)h.push(c.indexOf(t)),f.push(e.subMeshes[i].indexCount)}}else for(let t=0;t<e.subMeshes.length;t++)h.push(0),f.push(e.subMeshes[t].indexCount)}const d=t[0],m=e=>{const t=e.computeWorldMatrix(!0);return{vertexData:_f.ExtractFromMesh(e,!1,!1),transform:t}},{vertexData:p,transform:_}=m(d);o&&(yield);const v=new Array(t.length-1);for(let e=1;e<t.length;e++)v[e-1]=m(t[e]),o&&(yield);const g=p._mergeCoroutine(_,v,n,o,!i);let S=g.next();for(;!S.done;)o&&(yield),S=g.next();const y=S.value;a||(a=new e(d.name+"_merged",d.getScene()));const E=y._applyToCoroutine(a,void 0,o);let A=E.next();for(;!A.done;)o&&(yield),A=E.next();if(a.checkCollisions=d.checkCollisions,a.sideOrientation=d.sideOrientation,i)for(l=0;l<t.length;l++)t[l].dispose();if(s||r){a.releaseSubMeshes(),l=0;let e=0;for(;l<f.length;)mf.CreateFromIndices(0,e,f[l],a,void 0,!1),e+=f[l],l++;for(const e of a.subMeshes)e.refreshBoundingInfo();a.computeWorldMatrix(!0)}if(r){const e=new Cm(d.name+"_merged",d.getScene());e.subMaterials=c;for(let e=0;e<a.subMeshes.length;e++)a.subMeshes[e].materialIndex=h[e];a.material=e}else a.material=d.material;return a}constructor(t,i=null,n=null,a=null,s,r=!0){super(t,i),this._internalMeshDataInfo=new Pm,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new Im,this._thinInstanceDataStorage=new bm,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=e.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,i=this.getScene(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(e,t,i)=>{e&&i&&(this._uniformBuffer?this.transferToEffect(t):i.bindOnlyWorldMatrix(t))},a&&this._copySource(a,s,r),null!==n&&(this.parent=n),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=e=>{e.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new Ih(this._internalMeshDataInfo._onMeshReadyObserverAdded),a&&a.onClonedObservable.notifyObservers(this)}getLOD(e,t){const i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;const n=t||this.getBoundingInfo().boundingSphere,a=e.mode===fd.ORTHOGRAPHIC_CAMERA?e.minZ:n.centerWorld.subtract(e.globalPosition).length();let s=a,r=1;if(i._useLODScreenCoverage){const t=e.screenArea;let i=n.radiusWorld*e.minZ/a;i=i*i*Math.PI,s=i/t,r=-1}if(r*i._LODLevels[i._LODLevels.length-1].distanceOrScreenCoverage>r*s)return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this;for(let e=0;e<i._LODLevels.length;e++){const t=i._LODLevels[e];if(r*t.distanceOrScreenCoverage<r*s){if(t.mesh){if(4===t.mesh.delayLoadState)return t.mesh._checkDelayState(),this;if(2===t.mesh.delayLoadState)return this;t.mesh._preActivate(),t.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,t.mesh),t.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this}_getRenderingFillMode(e){const t=this.getScene();return t.forcePointsCloud?Am.PointFillMode:t.forceWireframe?Am.WireFrameFillMode:this.overrideRenderingFillMode??e}_processInstancedBuffers(e,t){}optimizeIndices(e){const t=this.getIndices(),i=this.getVerticesData($h.PositionKind);if(!i||!t)return this;const n=[];for(let e=0;e<i.length;e+=3)n.push(wh.FromArray(i,e));const a=[];return sd.SyncAsyncForLoop(n.length,40,(e=>{const t=n.length-1-e,i=n[t];for(let e=0;e<t;++e){const s=n[e];if(i.equals(s)){a[t]=e;break}}}),(()=>{for(let e=0;e<t.length;++e)t[e]=a[t[e]]||t[e];const i=this.subMeshes.slice(0);this.setIndices(t),this.subMeshes=i,e&&e(this)})),this}applyDisplacementMap(e,t,i,n,a,s,r=!1,o){const l=this.getScene();return ad.LoadImage(e,(e=>{const o=e.width,l=e.height,c=this.getEngine().createCanvas(o,l).getContext("2d");c.drawImage(e,0,0);const h=c.getImageData(0,0,o,l).data;this.applyDisplacementMapFromBuffer(h,o,l,t,i,a,s,r),n&&n(this)}),o||(()=>{}),l.offlineProvider),this}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}static MinMax(e){let t=null,i=null;return e.forEach((function(e){const n=e.getBoundingInfo().boundingBox;t&&i?(t.minimizeInPlace(n.minimumWorld),i.maximizeInPlace(n.maximumWorld)):(t=n.minimumWorld,i=n.maximumWorld)})),t&&i?{min:t,max:i}:{min:wh.Zero(),max:wh.Zero()}}static CreateGroundFromHeightMap(e,t,i,n,a,s,r,o,l,c,h){throw new Error("Import MeshBuilder to populate this function")}bakeTransformIntoVertices(e){if(!this.isVerticesDataPresent($h.PositionKind))return this;const t=this.subMeshes.splice(0);this._resetPointsArrayCache();let i=this.getVerticesData($h.PositionKind);const n=wh.Zero();let a;for(a=0;a<i.length;a+=3)wh.TransformCoordinatesFromFloatsToRef(i[a],i[a+1],i[a+2],e,n).toArray(i,a);if(this.setVerticesData($h.PositionKind,i,this.getVertexBuffer($h.PositionKind).isUpdatable()),this.isVerticesDataPresent($h.NormalKind)){for(i=this.getVerticesData($h.NormalKind),a=0;a<i.length;a+=3)wh.TransformNormalFromFloatsToRef(i[a],i[a+1],i[a+2],e,n).normalize().toArray(i,a);this.setVerticesData($h.NormalKind,i,this.getVertexBuffer($h.NormalKind).isUpdatable())}if(this.isVerticesDataPresent($h.TangentKind)){for(i=this.getVerticesData($h.TangentKind),a=0;a<i.length;a+=4)wh.TransformNormalFromFloatsToRef(i[a],i[a+1],i[a+2],e,n).normalize().toArray(i,a);this.setVerticesData($h.TangentKind,i,this.getVertexBuffer($h.TangentKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this}removeInstance(e){const t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){const e=this.instances[this.instances.length-1];this.instances[t]=e,e._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}set material(e){e&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(e.sideOrientation=null),this._setMaterial(e)}static CreateDecal(e,t,i,n,a,s){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(e,t,i,n,a,s,r,o,l){throw new Error("Import MeshBuilder to populate this function")}set useLODScreenCoverage(e){this._internalMeshDataInfo._useLODScreenCoverage=e,this._sortLODLevels()}serialize(e={}){e.name=this.name,e.id=this.id,e.xt=this.xt,e.type=this.getClassName(),eh&&eh.HasTags(this)&&(e.tags=eh.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,e.checkCollisions=this.checkCollisions,e.ellipsoid=this.ellipsoid.asArray(),e.ellipsoidOffset=this.ellipsoidOffset.asArray(),e.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,e.isBlocker=this.isBlocker,e.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;const t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.xt,e.geometryId=t.id,e.subMeshes=[];for(let t=0;t<this.subMeshes.length;t++){const i=this.subMeshes[t];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.xt,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.xt,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.xt),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(Rm.NAME_PHYSICSENGINE)){const t=this.getPhysicsImpostor();t&&(e.physicsMass=t.getParam("mass"),e.physicsFriction=t.getParam("friction"),e.physicsRestitution=t.getParam("mass"),e.physicsImpostor=t.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(let t=0;t<this.instances.length;t++){const i=this.instances[t];if(i.doNotSerialize)continue;const n={name:i.name,id:i.id,isEnabled:i.isEnabled(!1),isVisible:i.isVisible,isPickable:i.isPickable,checkCollisions:i.checkCollisions,position:i.position.asArray(),scaling:i.scaling.asArray()};if(i.parent&&i.parent._serializeAsParent(n),i.rotationQuaternion?n.rotationQuaternion=i.rotationQuaternion.asArray():i.rotation&&(n.rotation=i.rotation.asArray()),this.getScene()._getComponent(Rm.NAME_PHYSICSENGINE)){const e=i.getPhysicsImpostor();e&&(n.physicsMass=e.getParam("mass"),n.physicsFriction=e.getParam("friction"),n.physicsRestitution=e.getParam("mass"),n.physicsImpostor=e.type)}i.metadata&&(n.metadata=i.metadata),i.actionManager&&(n.actions=i.actionManager.serialize(i.name)),e.instances.push(n),Uh.AppendSerializedAnimations(i,n),n.ranges=i.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const t={data:{},sizes:{},strides:{}};for(const e in this._userThinInstanceBuffersStorage.data)t.data[e]=Array.from(this._userThinInstanceBuffersStorage.data[e]),t.sizes[e]=this._userThinInstanceBuffersStorage.sizes[e],t.strides[e]=this._userThinInstanceBuffersStorage.strides[e];e.thinInstances.userThinInstance=t}return Uh.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name)),e}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}_convertToUnIndexedMesh(e=!1){const t=this.getVerticesDataKinds(),i=this.getIndices(),n={},a=(e,t)=>{const n=new Float32Array(i.length*t);let a=0;for(let s=0;s<i.length;s++)for(let r=0;r<t;r++)n[a++]=e[i[s]*t+r];return n},s=this.getBoundingInfo(),r=this.geometry?this.subMeshes.slice(0):[];for(const e of t)n[e]=this.getVerticesData(e);for(const s of t){const t=this.getVertexBuffer(s),r=t.getSize();if(e&&s===$h.NormalKind){const e=this._getFlattenedNormals(i,n[$h.PositionKind]);this.setVerticesData($h.NormalKind,e,t.isUpdatable(),r)}else this.setVerticesData(s,a(n[s],r),t.isUpdatable(),r)}if(this.morphTargetManager){for(let t=0;t<this.morphTargetManager.numTargets;t++){const n=this.morphTargetManager.getTarget(t),s=n.getPositions();n.setPositions(a(s,3));const r=n.getNormals();r&&n.setNormals(e?this._getFlattenedNormals(i,s):a(r,3));const o=n.getTangents();o&&n.setTangents(a(o,3));const l=n.getUVs();l&&n.setUVs(a(l,2))}this.morphTargetManager.synchronize()}for(let e=0;e<i.length;e++)i[e]=e;this.setIndices(i),this._unIndexed=!0,this.releaseSubMeshes();for(const e of r){const t=e.getBoundingInfo();mf.AddToMesh(e.materialIndex,e.indexStart,e.indexCount,e.indexStart,e.indexCount,this).setBoundingInfo(t)}return this.setBoundingInfo(s),this.synchronizeInstances(),this}getVertexBuffer(e,t){return this._geometry?(t?void 0:this._userInstancedBuffersStorage?.vertexBuffers[e])??this._geometry.getVertexBuffer(e):null}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new Ih),this._internalMeshDataInfo._onBeforeRenderObservable}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData($h.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData($h.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}registerAfterRender(e){return this.onAfterRenderObservable.add(e),this}markVerticesDataAsUpdatable(e,t=!0){const i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)}updateVerticesData(e,t,i,n){return this._geometry?(n?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}_checkDelayState(){const e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this}synchronizeInstances(){for(let e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}static ExtrudeShapeCustom(e,t,i,n,a,s,r,o,l,c,h,f){throw new Error("Import MeshBuilder to populate this function")}isReady(e=!1,t=!1){if(2===this.delayLoadState)return!1;if(!super.isReady(e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;const i=this.getEngine(),n=this.getScene(),a=t||i.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const s=this.material||n.defaultMaterial;if(s)if(s._storeEffectOnSubMeshes)for(const e of this.subMeshes){const t=e.getMaterial();if(t)if(t._storeEffectOnSubMeshes){if(!t.isReadyForSubMesh(this,e,a))return!1}else if(!t.isReady(this,a))return!1}else if(!s.isReady(this,a))return!1;const r=i.currentRenderPassId;for(const e of this.lightSources){const t=e.getShadowGenerators();if(!t)continue;const n=t.values();for(let e=n.next();!0!==e.done;e=n.next()){const t=e.value;if(t&&(!t.getShadowMap()?.Pt||t.getShadowMap()?.Pt&&-1!==t.getShadowMap()?.Pt?.indexOf(this))){const e=t.getShadowMap().renderPassIds??[i.currentRenderPassId];for(let n=0;n<e.length;++n){i.currentRenderPassId=e[n];for(const e of this.subMeshes)if(!t.isReady(e,a,e.getMaterial()?.needAlphaBlendingForMesh(this)??!1))return i.currentRenderPassId=r,!1}i.currentRenderPassId=r}}}for(const e of this._internalMeshDataInfo._LODLevels)if(e.mesh&&!e.mesh.isReady(a))return!1;return!0}static $t(e,t,i,n,a){throw new Error("Import MeshBuilder to populate this function")}_unBindEffect(){super._unBindEffect();for(const e of this.instances)e._unBindEffect()}set forceWorldMatrixInstancedBufferUpdate(e){this._instanceDataStorage.forceMatrixUpdates=e}set manualUpdateOfWorldMatrixInstancedBuffer(e){this._instanceDataStorage.manualUpdate=e}getLODLevelAtDistance(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++){const n=t._LODLevels[i];if(n.distanceOrScreenCoverage===e)return n.mesh}return null}instantiateHierarchy(e=null,t,i){const n=0===this.getTotalVertices()||t&&t.doNotInstantiate&&(!0===t.doNotInstantiate||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));n.parent=e||this.parent,n.position=this.position.clone(),n.scaling=this.scaling.clone(),this.rotationQuaternion?n.rotationQuaternion=this.rotationQuaternion.clone():n.rotation=this.rotation.clone(),i&&i(this,n);for(const e of this.getChildTransformNodes(!0))"InstancedMesh"===e.getClassName()&&"Mesh"===n.getClassName()&&e.tk===this?e.instantiateHierarchy(n,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:n},i):e.instantiateHierarchy(n,t,i);return n}applySkeleton(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent($h.PositionKind))return this;if(!this.isVerticesDataPresent($h.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent($h.MatricesWeightsKind))return this;const t=this.isVerticesDataPresent($h.NormalKind),i=this._internalMeshDataInfo;if(!i._sourcePositions){const e=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=e}t&&!i._sourceNormals&&this.setNormalsForCPUSkinning();let n=this.getVerticesData($h.PositionKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));let a=this.getVerticesData($h.NormalKind);if(t){if(!a)return this;a instanceof Float32Array||(a=new Float32Array(a))}const s=this.getVerticesData($h.MatricesIndicesKind),r=this.getVerticesData($h.MatricesWeightsKind);if(!r||!s)return this;const o=this.numBoneInfluencers>4,l=o?this.getVerticesData($h.MatricesIndicesExtraKind):null,c=o?this.getVerticesData($h.MatricesWeightsExtraKind):null,h=e.getTransformMatrices(this),f=wh.Zero(),u=new Lh,d=new Lh;let m,p=0;for(let e=0;e<n.length;e+=3,p+=4){let _;for(m=0;m<4;m++)_=r[p+m],_>0&&(Lh.FromFloat32ArrayToRefScaled(h,Math.floor(16*s[p+m]),_,d),u.addToSelf(d));if(o)for(m=0;m<4;m++)_=c[p+m],_>0&&(Lh.FromFloat32ArrayToRefScaled(h,Math.floor(16*l[p+m]),_,d),u.addToSelf(d));wh.TransformCoordinatesFromFloatsToRef(i._sourcePositions[e],i._sourcePositions[e+1],i._sourcePositions[e+2],u,f),f.toArray(n,e),t&&(wh.TransformNormalFromFloatsToRef(i._sourceNormals[e],i._sourceNormals[e+1],i._sourceNormals[e+2],u,f),f.toArray(a,e)),u.reset()}return this.updateVerticesData($h.PositionKind,n),t&&this.updateVerticesData($h.NormalKind,a),this}set onBeforeDraw(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)}_invalidateInstanceVertexArrayObject(){}static CreateGround(e,t,i,n,a,s){throw new Error("Import MeshBuilder to populate this function")}static _instancedMeshFactory(e,t){throw Qc("InstancedMesh")}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===Am.CounterClockWiseSideOrientation}static MergeMeshesAsync(t,i=!0,n,a,s,r){return o=e._MergeMeshesCoroutine(t,i,n,a,s,r,!0),l=function(e=25){let t;return(i,n,a)=>{const s=performance.now();void 0===t||s-t>e?(t=s,setTimeout((()=>{qh(i,n,a)}),0)):qh(i,n,a)}}(),new Promise(((e,t)=>{Jh(o,l,e,t,c)}));var o,l,c}removeVerticesData(e){this._geometry&&this._geometry.removeVerticesData(e)}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new Ih),this._internalMeshDataInfo._onBeforeDrawObservable}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}_createGlobalSubMesh(e){const t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const i=this.getIndices();if(!i)return null;const n=i.length;let a=!1;if(e)a=!0;else for(const e of this.subMeshes){if(e.indexStart+e.indexCount>n){a=!0;break}if(e.verticesStart+e.verticesCount>t){a=!0;break}}if(!a)return this.subMeshes[0]}return this.releaseSubMeshes(),new mf(0,0,t,0,this.getTotalIndices(),this)}bakeCurrentTransformIntoVertices(e=!0){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this}static gt(e,t,i,n,a,s){throw new Error("Import MeshBuilder to populate this function")}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}_disposeInstanceSpecificData(){}set overrideMaterialSideOrientation(e){this.sideOrientation=e,this.material&&(this.material.sideOrientation=null)}static _GetDefaultSideOrientation(t){return t||e.FRONTSIDE}setVerticesBuffer(e,t=!0){return this._geometry||(this._geometry=md.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return jh.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(e.isUsingTextureForTargets)return;for(let t=0;t<e.numInfluencers;t++){const i=e.getActiveTarget(t),n=i.getPositions();if(!n)return void jh.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData($h.PositionKind+t,n,!1,3);const a=i.getNormals();a&&this.geometry.setVerticesData($h.NormalKind+t,a,!1,3);const s=i.getTangents();s&&this.geometry.setVerticesData($h.TangentKind+t,s,!1,3);const r=i.getUVs();r&&this.geometry.setVerticesData($h.UVKind+"_"+t,r,!1,2)}}else{let e=0;for(;this.geometry.isVerticesDataPresent($h.PositionKind+e);)this.geometry.removeVerticesData($h.PositionKind+e),this.geometry.isVerticesDataPresent($h.NormalKind+e)&&this.geometry.removeVerticesData($h.NormalKind+e),this.geometry.isVerticesDataPresent($h.TangentKind+e)&&this.geometry.removeVerticesData($h.TangentKind+e),this.geometry.isVerticesDataPresent($h.UVKind+e)&&this.geometry.removeVerticesData($h.UVKind+"_"+e),e++}}getLODLevels(){return this._internalMeshDataInfo._LODLevels}set isUnIndexed(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())}addLODLevel(e,t){if(t&&t._masterMesh)return jh.Warn("You cannot use a mesh as LOD level twice"),this;const i=new Nm(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this}_preActivate(){const e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}flipFaces(e=!1){const t=_f.ExtractFromMesh(this);let i;if(e&&this.isVerticesDataPresent($h.NormalKind)&&t.normals)for(i=0;i<t.normals.length;i++)t.normals[i]*=-1;if(t.indices){let e;for(i=0;i<t.indices.length;i+=3)e=t.indices[i+1],t.indices[i+1]=t.indices[i+2],t.indices[i+2]=e}return t.applyToMesh(this,this.isVertexBufferUpdatable($h.PositionKind)),this}static CreateCapsule(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static ft(e,t,i,n,a,s,r,o,l){throw new Error("Import MeshBuilder to populate this function")}static ut(e,t,i,n,a,s){throw new Error("Import MeshBuilder to populate this function")}set overrideRenderingFillMode(e){this._internalMeshDataInfo._overrideRenderingFillMode=e}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}static _PhysicsImpostorParser(e,t,i){throw Qc("PhysicsImpostor")}render(e,t,i){const n=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const a=n.activeCameras?.length??0;if((a>1&&n.activeCamera===n.activeCameras[0]||a<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const s=this._getInstancesRenderList(e._id,!!i);if(s.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const r=n.getEngine();let o=0,l=null;this.ignoreCameraMaxZ&&n.activeCamera&&!n._isInIntermediateRendering()&&(o=n.activeCamera.maxZ,l=n.activeCamera,n.activeCamera.maxZ=0,n.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const c=e.getRenderingMesh(),h=s.hardwareInstancedRendering[e._id]||c.hasThinInstances||!!this._userInstancedBuffersStorage&&!e.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,f=this._instanceDataStorage,u=e.getMaterial();if(!u)return l&&(l.maxZ=o,n.updateTransformMatrix(!0)),this;if(f.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===u){if(u._storeEffectOnSubMeshes&&!e._drawWrapper?._wasPreviouslyReady||!u._storeEffectOnSubMeshes&&!u._getDrawWrapper()._wasPreviouslyReady)return l&&(l.maxZ=o,n.updateTransformMatrix(!0)),this}else{if(u._storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(this,e,h))return l&&(l.maxZ=o,n.updateTransformMatrix(!0)),this}else if(!u.isReady(this,h))return l&&(l.maxZ=o,n.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=u}let d;t&&r.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),d=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?e._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const m=d?.effect??null;for(const t of n._beforeRenderingMeshStage)t.action(this,e,s,m);if(!d||!m)return l&&(l.maxZ=o,n.updateTransformMatrix(!0)),this;const p=i||this;let _;if(f.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)_=f.sideOrientation;else{const e=p._getWorldMatrixDeterminant();_=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),e<0&&(_=_===Am.ClockWiseSideOrientation?Am.CounterClockWiseSideOrientation:Am.ClockWiseSideOrientation),f.sideOrientation=_}const v=this._internalMeshDataInfo._effectiveMaterial._preBind(d,_);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&r.setDepthWrite(!0);const g=this._internalMeshDataInfo._effectiveMaterial,S=g.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),h||this._bind(e,m,S,!1);const y=p.getWorldMatrix();g._storeEffectOnSubMeshes?g.bindForSubMesh(y,this,e):g.bind(y,this),!g.backFaceCulling&&g.separateCullingPass&&(r.setState(!0,g.zOffset,!1,!v,g.cullBackFaces,g.stencil,g.zOffsetUnits),this._processRendering(this,e,m,S,s,h,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),r.setState(!0,g.zOffset,!1,v,g.cullBackFaces,g.stencil,g.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,m,S,s,h,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const t of n._afterRenderingMeshStage)t.action(this,e,s,m);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),l&&(l.maxZ=o,n.updateTransformMatrix(!0)),2!==n.performancePriority||f.isFrozen||this._freeze(),this}unregisterBeforeRender(e){return this.onBeforeRenderObservable.removeCallback(e),this}};wm.FRONTSIDE=_f.FRONTSIDE,wm.BACKSIDE=_f.BACKSIDE,wm.DOUBLESIDE=_f.DOUBLESIDE,wm.DEFAULTSIDE=_f.DEFAULTSIDE,wm.NO_CAP=0,wm.CAP_START=1,wm.CAP_END=2,wm.CAP_ALL=3,wm.NO_FLIP=0,wm.FLIP_TILE=1,wm.ROTATE_TILE=2,wm.FLIP_ROW=3,wm.ROTATE_ROW=4,wm.FLIP_N_ROTATE_TILE=5,wm.FLIP_N_ROTATE_ROW=6,wm.CENTER=0,wm.LEFT=1,wm.RIGHT=2,wm.TOP=3,wm.BOTTOM=4,wm.INSTANCEDMESH_SORT_TRANSPARENT=!1,wm._GroundMeshParser=(e,t)=>{throw Qc("GroundMesh")},wm._GoldbergMeshParser=(e,t)=>{throw Qc("GoldbergMesh")},wm._LinesMeshParser=(e,t)=>{throw Qc("LinesMesh")},wm._GreasedLineMeshParser=(e,t)=>{throw Qc("GreasedLineMesh")},wm._GreasedLineRibbonMeshParser=(e,t)=>{throw Qc("GreasedLineRibbonMesh")},wm._TrailMeshParser=(e,t)=>{throw Qc("TrailMesh")},rh("BABYLON.Mesh",wm);var Om,Dm,Lm,Fm,km=class{constructor(e){this.dk=new wm("hitMarker",e),this.dk.updatable=!0,this.dk.hasVertexAlpha=!0,this.dk.layerMask=536870912,this.dk.visibility=.2,this.positions=[1,2.5,0,0,3,0,-1,2.5,0];this.colors=new Array(12).fill(0),this.colors[0]=1,this.colors[4]=1,this.colors[8]=1,this.colors[7]=1;var t=new _f;return t.positions=this.positions,t.indices=[0,1,2],t.colors=this.colors,t.applyToMesh(this.dk,!0),this.dk.material=e.getMaterialByName("ui"),this.dk}},Bm=class{resize(){let e=.1*xc.engine.getRenderHeight();this.container.scaling.x=e,this.container.scaling.y=e}hide(){this.container.setEnabled(!1)}update(e,t){if(this.container.isEnabled()){this.container.rotation.z=t;for(let t of this.markers)if(t.mesh.visibility>0){t.mesh.visibility=Math.max(0,t.mesh.visibility-.06*e);let i=Math.max(1,t.mesh.scaling.x-.01*e);t.mesh.scaling.x=i,t.mesh.scaling.y=i}}}constructor(e){this.container=new Xh("hitMarkers",e),this.container.layerMask=536870912,this.markers=[];for(let t=0;t<4;t++){let t=new km(e);t.parent=this.container,this.markers.push({mesh:t,angle:0})}}hit(e,t){if(0===this.container.visibility)return;let i,n=Math.atan2(e,t),a=-Math.radRange(n);for(let e of this.markers)if(0===e.mesh.visibility){i=e;break}if(!i){let e=1e3;for(let t of this.markers){let n=Math.abs(Math.radRange(t.angle-a));n<e&&(e=n,i=t)}}i.angle=a,i.mesh.scaling.x=1.1,i.mesh.scaling.y=1.1,i.mesh.visibility=5,i.mesh.rotation.z=a}show(){this.container.setEnabled(!0)}},Gm=class extends Am{isReady(e,t){return!!e&&(!this._storeEffectOnSubMeshes||(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t)))}constructor(e,t,i=!0){super(e,t),this._normalMatrix=new Lh,this._storeEffectOnSubMeshes=i}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}_isReadyForSubMesh(e){const t=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!t||t._renderId!==this.getScene().getRenderId())}_mustRebind(e,t,i,n=1){return i._drawWrapper._forceRebindOnNextCall||e.isCachedMaterialInvalid(this,t,n)}bind(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}_afterBind(e,t=null,i){super._afterBind(e,t,i),this.getScene()._cachedEffect=t,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}dispose(e,t,i){this._activeEffect=void 0,super.dispose(e,t,i)}};(Dm=Om||(Om={}))[Dm.Float=1]="Float",Dm[Dm.Int=2]="Int",Dm[Dm.Vector2=4]="Vector2",Dm[Dm.Vector3=8]="Vector3",Dm[Dm.Vector4=16]="Vector4",Dm[Dm.Color3=32]="Color3",Dm[Dm.Color4=64]="Color4",Dm[Dm.Matrix=128]="Matrix",Dm[Dm.Object=256]="Object",Dm[Dm.AutoDetect=1024]="AutoDetect",Dm[Dm.BasedOnInput=2048]="BasedOnInput",Dm[Dm.All=4095]="All",(Fm=Lm||(Lm={}))[Fm.Vertex=1]="Vertex",Fm[Fm.Fragment=2]="Fragment",Fm[Fm.Neutral=4]="Neutral",Fm[Fm.VertexAndFragment=3]="VertexAndFragment",c();var Um,Hm,Vm,Wm,zm=class{_generateTernary(e,t,i){return 1===this.shaderLanguage?`select(${t}, ${e}, ${i})`:`(${i}) ? ${e} : ${t}`}_convertFunctionsToWGSL(e){const t=/var\s+(\w+)\s*:\s*(\w+)\((.*)\)/g;let i;for(;null!==(i=t.exec(e));){const t=i[1],n=i[2],a=i[3].replace(/var\s/g,"");e=e.replace(i[0],`fn ${t}(${a}) -> ${n}`)}return e}_emitCodeFromInclude(t,i,n){const a=e.GetIncludesShadersStore(this.shaderLanguage);if(n&&n.repeatKey)return`#include<${t}>${n.substitutionVars?"("+n.substitutionVars+")":""}[0..${n.repeatKey}]\n`;let s=a[t]+"\n";if(this.sharedData.emitComments&&(s=i+"\n"+s),!n)return s;if(n.replaceStrings)for(let e=0;e<n.replaceStrings.length;e++){const t=n.replaceStrings[e];s=s.replace(t.search,t.replace)}return s}_convertTernaryOperandsToWGSL(e){return e.replace(new RegExp("\\[(.*?)\\?(.*?):(.*)\\]","g"),((e,t,i,n)=>`select(${n}, ${i}, ${t})`))}constructor(){this.supportUniformBuffers=!1,this.attributes=[],this.uniforms=[],this.constants=[],this.samplers=[],this.functions={},this.extensions={},this.prePassOutput={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}_samplerFunc(){return 1===this.shaderLanguage?"textureSample":"texture2D"}_declareLocalVar(e,t,i){return 1===this.shaderLanguage?`${i?"const":"var"} ${e}: ${this._getShaderType(t)}`:`${this._getShaderType(t)} ${e}`}_emitUniformFromString(e,t,i="",n=!1){if(-1!==this.uniforms.indexOf(e))return;this.uniforms.push(e),i&&(i.startsWith("defined(")?this._uniformDeclaration+=`#if ${i}\n`:this._uniformDeclaration+=`${n?"#ifndef":"#ifdef"} ${i}\n`);const a=this._getShaderType(t);1===this.shaderLanguage?this._uniformDeclaration+=`uniform ${e}: ${a};\n`:this._uniformDeclaration+=`uniform ${a} ${e};\n`,i&&(this._uniformDeclaration+="#endif\n")}_registerTempVariable(e){return-1===this.sharedData.temps.indexOf(e)&&(this.sharedData.temps.push(e),!0)}_emitCubeSampler(e,t="",i=!1){(this.samplers.indexOf(e)<0||i)&&(t&&(this._samplerDeclaration+=`#if ${t}\n`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;\n`,this._samplerDeclaration+=`var ${e}: texture_cube<f32>;\n`):this._samplerDeclaration+=`uniform samplerCube ${e};\n`,t&&(this._samplerDeclaration+="#endif\n"),i||this.samplers.push(e))}_convertConstToWGSL(e){return e.replace(new RegExp("const var","g"),"const")}_babylonSLtoGLSL(e){return e=e.replace(/\[\*\]/g,""),e=this._convertTernaryOperandsToGLSL(e)}_convertTernaryOperandsToGLSL(e){return e.replace(new RegExp("\\[(.+?)\\?(.+?):(.+)\\]","g"),((e,t,i,n)=>`${t} ? ${i} : ${n}`))}_generateTextureSampleCube(e,t){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerCubeFunc()}(${t}, ${e})`}_babylonSLtoWGSL(e){return e=this._convertVariableDeclarationToWGSL("void","voidnull",e),e=this._convertVariableDeclarationToWGSL("bool","bool",e),e=this._convertVariableDeclarationToWGSL("int","i32",e),e=this._convertVariableDeclarationToWGSL("uint","u32",e),e=this._convertVariableDeclarationToWGSL("float","f32",e),e=this._convertVariableDeclarationToWGSL("vec2","vec2f",e),e=this._convertVariableDeclarationToWGSL("vec3","vec3f",e),e=this._convertVariableDeclarationToWGSL("vec4","vec4f",e),e=this._convertVariableDeclarationToWGSL("mat2","mat2x2f",e),e=this._convertVariableDeclarationToWGSL("mat3","mat3x3f",e),e=this._convertVariableDeclarationToWGSL("mat4","mat4x4f",e),e=this._convertVariableConstructorsToWGSL("float","f32",e),e=this._convertVariableConstructorsToWGSL("vec2","vec2f",e),e=this._convertVariableConstructorsToWGSL("vec3","vec3f",e),e=this._convertVariableConstructorsToWGSL("vec4","vec4f",e),e=this._convertVariableConstructorsToWGSL("mat2","mat2x2f",e),e=this._convertVariableConstructorsToWGSL("mat3","mat3x3f",e),e=this._convertVariableConstructorsToWGSL("mat4","mat4x4f",e),e=this._convertTernaryOperandsToWGSL(e),e=this._convertModOperatorsToWGSL(e),e=this._convertConstToWGSL(e),e=this._convertInnerFunctionsToWGSL(e),e=(e=this._convertOutParametersToWGSL(e)).replace(/\[\*\]/g,"*"),e=(e=(e=(e=this._convertFunctionsToWGSL(e)).replace(/\s->\svoidnull/g,"")).replace(/dFdx/g,"dpdx")).replace(/dFdy/g,"dpdy")}_generateTextureSample(e,t){return 1===this.shaderLanguage?`${this._samplerFunc()}(${t},${t+"Sampler"}, ${e})`:`${this._samplerFunc()}(${t}, ${e})`}get shaderLanguage(){return this.sharedData.nodeMaterial.shaderLanguage}_emitFunction(e,t,i){this.functions[e]||(this.sharedData.emitComments&&(t=i+"\n"+t),this.functions[e]=t)}_declareOutput(e,t){return this._declareLocalVar(e.associatedVariableName,e.type,t)}_emitVaryingFromString(e,t,i="",n=!1){if(-1!==this.sharedData.varyings.indexOf(e))return!1;this.sharedData.varyings.push(e),i&&(i.startsWith("defined(")?this.sharedData.varyingDeclaration+=`#if ${i}\n`:this.sharedData.varyingDeclaration+=`${n?"#ifndef":"#ifdef"} ${i}\n`);const a=this._getShaderType(t);return 1===this.shaderLanguage?this.sharedData.varyingDeclaration+=`varying ${e}: ${a};\n`:this.sharedData.varyingDeclaration+=`varying ${a} ${e};\n`,i&&(this.sharedData.varyingDeclaration+="#endif\n"),!0}_getGLType(e){switch(e){case Om.Float:return"float";case Om.Int:return"int";case Om.Vector2:return"vec2";case Om.Color3:case Om.Vector3:return"vec3";case Om.Color4:case Om.Vector4:return"vec4";case Om.Matrix:return"mat4"}return""}_emitExtension(e,t,i=""){this.extensions[e]||(i&&(t=`#if ${i}\n${t}\n#endif`),this.extensions[e]=t)}_convertOutParametersToWGSL(e){return e.replace(new RegExp("out\\s+var\\s+(\\w+)\\s*:\\s*(\\w+)","g"),"$1: ptr<function, $2>")}_getVaryingName(e){return 1===this.shaderLanguage?(this.target!==Lm.Fragment?"vertexOutputs.":"fragmentInputs.")+e:e}_samplerCubeFunc(){return 1===this.shaderLanguage?"textureSample":"textureCube"}_excludeVariableName(e){this.sharedData.variableNames[e]=0}_toLinearSpace(e){return 1===this.shaderLanguage&&(e.type===Om.Color3||e.type===Om.Vector3)?`toLinearSpaceVec3(${e.associatedVariableName})`:`toLinearSpace(${e.associatedVariableName})`}_samplerLODFunc(){return 1===this.shaderLanguage?"textureSampleLevel":"texture2DLodEXT"}_convertVariableDeclarationToWGSL(e,t,i){return i.replace(new RegExp(`(${e})\\s+(\\w+)`,"g"),`var $2: ${t}`)}_convertVariableConstructorsToWGSL(e,t,i){return i.replace(new RegExp(`(${e})\\(`,"g"),` ${t}(`)}_generateTextureSampleLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerLODFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerLODFunc()}(${t}, ${e}, ${i})`}_emitFloat(e){return e.toString()===e.toFixed(0)?`${e}.0`:e.toString()}get fSuffix(){return 1===this.shaderLanguage?"f":""}_getFreeDefineName(e){return void 0===this.sharedData.defineNames[e]?this.sharedData.defineNames[e]=0:this.sharedData.defineNames[e]++,e+this.sharedData.defineNames[e]}get _repeatableContentAnchor(){return`###___ANCHOR${this._repeatableContentAnchorIndex++}___###`}_generateTextureSampleCubeLOD(e,t,i){return 1===this.shaderLanguage?`${this._samplerCubeFunc()}(${t},${t+"Sampler"}, ${e}, ${i})`:`${this._samplerCubeFunc()}(${t}, ${e}, ${i})`}_emit2DArraySampler(e){this.samplers.indexOf(e)<0&&(this._samplerDeclaration+=`uniform sampler2DArray ${e};\n`,this.samplers.push(e))}_getFreeVariableName(e){return e=e.replace(/[^a-zA-Z_]+/g,""),void 0===this.sharedData.variableNames[e]?(this.sharedData.variableNames[e]=0,"output"===e||"texture"===e?e+this.sharedData.variableNames[e]:e):(this.sharedData.variableNames[e]++,e+this.sharedData.variableNames[e])}finalize(e){const t=e.sharedData.emitComments,i=this.target===Lm.Fragment;1===this.shaderLanguage?this.compilationString=i?`\n${t?"//Entry point\n":""}@fragment\nfn main(input: FragmentInputs) -> FragmentOutputs {\n${this.compilationString}`:`\n${t?"//Entry point\n":""}@vertex\nfn main(input: VertexInputs) -> FragmentInputs{\n${this.compilationString}`:this.compilationString=`\n${t?"//Entry point\n":""}void main(void) {\n${this.compilationString}`,this._constantDeclaration&&(this.compilationString=`\n${t?"//Constants\n":""}${this._constantDeclaration}\n${this.compilationString}`);let n="";for(const e in this.functions)n+=this.functions[e]+"\n";if(this.compilationString=`\n${n}\n${this.compilationString}`,!i&&this._varyingTransfer&&(this.compilationString=`${this.compilationString}\n${this._varyingTransfer}`),this._injectAtEnd&&(this.compilationString=`${this.compilationString}\n${this._injectAtEnd}`),this.compilationString=`${this.compilationString}\n}`,this.sharedData.varyingDeclaration&&(this.compilationString=`\n${t?"//Varyings\n":""}${this.sharedData.varyingDeclaration}\n${this.compilationString}`),this._samplerDeclaration&&(this.compilationString=`\n${t?"//Samplers\n":""}${this._samplerDeclaration}\n${this.compilationString}`),this._uniformDeclaration&&(this.compilationString=`\n${t?"//Uniforms\n":""}${this._uniformDeclaration}\n${this.compilationString}`),this._attributeDeclaration&&!i&&(this.compilationString=`\n${t?"//Attributes\n":""}${this._attributeDeclaration}\n${this.compilationString}`),1!==this.shaderLanguage){this.compilationString="precision highp float;\n"+this.compilationString,this.compilationString="#if defined(WEBGL2) || defined(WEBGPU)\nprecision highp sampler2DArray;\n#endif\n"+this.compilationString,i&&(this.compilationString="#if defined(PREPASS)\r\n#extension GL_EXT_draw_buffers : require\r\nlayout(location = 0) out highp vec4 glFragData[SCENE_MRT_COUNT];\r\nhighp vec4 gl_FragColor;\r\n#endif\r\n"+this.compilationString);for(const e in this.extensions){const t=this.extensions[e];this.compilationString=`\n${t}\n${this.compilationString}`}}this._builtCompilationString=this.compilationString}_convertModOperatorsToWGSL(e){return e.replace(new RegExp("mod\\((.+?),\\s*(.+?)\\)","g"),((e,t,i)=>`((${t})%(${i}))`))}_convertInnerFunctionsToWGSL(e){return e.replace(new RegExp("inversesqrt","g"),"inverseSqrt")}_emitFunctionFromInclude(t,i,n,a=""){const s=t+a;if(this.functions[s])return;const r=e.GetIncludesShadersStore(this.shaderLanguage);if(!(n&&(n.removeAttributes||n.removeUniforms||n.removeVaryings||n.removeIfDef||n.replaceStrings)))return n&&n.repeatKey?this.functions[s]=`#include<${t}>${n.substitutionVars?"("+n.substitutionVars+")":""}[0..${n.repeatKey}]\n`:this.functions[s]=`#include<${t}>${n?.substitutionVars?"("+n?.substitutionVars+")":""}\n`,void(this.sharedData.emitComments&&(this.functions[s]=i+"\n"+this.functions[s]));if(this.functions[s]=r[t],this.sharedData.emitComments&&(this.functions[s]=i+"\n"+this.functions[s]),n.removeIfDef&&(this.functions[s]=this.functions[s].replace(/^\s*?#ifdef.+$/gm,""),this.functions[s]=this.functions[s].replace(/^\s*?#endif.*$/gm,""),this.functions[s]=this.functions[s].replace(/^\s*?#else.*$/gm,""),this.functions[s]=this.functions[s].replace(/^\s*?#elif.*$/gm,"")),n.removeAttributes&&(this.functions[s]=this.functions[s].replace(/\s*?attribute .+?;/g,"\n")),n.removeUniforms&&(this.functions[s]=this.functions[s].replace(/\s*?uniform .*?;/g,"\n")),n.removeVaryings&&(this.functions[s]=this.functions[s].replace(/\s*?(varying|in) .+?;/g,"\n")),n.replaceStrings)for(let e=0;e<n.replaceStrings.length;e++){const t=n.replaceStrings[e];this.functions[s]=this.functions[s].replace(t.search,t.replace)}}_getShaderType(e){const t=1===this.shaderLanguage;switch(e){case Om.Float:return t?"f32":"float";case Om.Int:return t?"i32":"int";case Om.Vector2:return t?"vec2f":"vec2";case Om.Color3:case Om.Vector3:return t?"vec3f":"vec3";case Om.Color4:case Om.Vector4:return t?"vec4f":"vec4";case Om.Matrix:return t?"mat4x4f":"mat4"}return""}_emit2DSampler(e,t="",i=!1){(this.samplers.indexOf(e)<0||i)&&(t&&(this._samplerDeclaration+=`#if ${t}\n`),1===this.shaderLanguage?(this._samplerDeclaration+=`var ${e+"Sampler"}: sampler;\n`,this._samplerDeclaration+=`var ${e}: texture_2d<f32>;\n`):this._samplerDeclaration+=`uniform sampler2D ${e};\n`,t&&(this._samplerDeclaration+="#endif\n"),i||this.samplers.push(e))}},Xm=class{constructor(){this.temps=[],this.varyings=[],this.varyingDeclaration="",this.inputBlocks=[],this.textureBlocks=[],this.bindableBlocks=[],this.forcedBindableBlocks=[],this.blocksWithFallbacks=[],this.blocksWithDefines=[],this.repeatableContentBlocks=[],this.dynamicUniformBlocks=[],this.blockingBlocks=[],this.animatedInputs=[],this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}emitErrors(){let e="";this.checks.emitVertex||this.allowEmptyVertexProgram||(e+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\n"),this.checks.emitFragment||(e+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\n");for(const t of this.checks.notConnectedNonOptionalInputs)e+=`input ${t.name} from block ${t.ownerBlock.name}[${t.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(e)throw"Build of NodeMaterial failed:\n"+e}},Ym=class{cloneTo(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(let t=0;t<this._keys.length;t++){const i=this._keys[t];e[i]=this[i]}}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}_setDefaultValue(e){const t=this._externalProperties?.[e]?.type??typeof this[e],i=this._externalProperties?.[e]?.default;switch(t){case"number":this[e]=i??0;break;case"string":this[e]=i??"";break;default:this[e]=i??!1}}get isDirty(){return this._isDirty}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const e of Object.keys(this))"_"!==e[0]&&this._keys.push(e);if(this._externalProperties)for(const e in this._externalProperties)-1===this._keys.indexOf(e)&&this._keys.push(e)}constructor(e){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}isEqual(e){if(this._keys.length!==e._keys.length)return!1;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];if(this[i]!==e[i])return!1}return!0}reset(){this._keys.forEach((e=>this._setDefaultValue(e)))}markAsLightDirty(e=!1){this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}toString(){let e="";for(let t=0;t<this._keys.length;t++){const i=this._keys[t],n=this[i];switch(typeof n){case"number":case"string":e+="#define "+i+" "+n+"\n";break;default:n&&(e+="#define "+i+"\n")}}return e}markAsUnprocessed(){this._isDirty=!0}};(Hm=Um||(Um={}))[Hm.Compatible=0]="Compatible",Hm[Hm.TypeIncompatible=1]="TypeIncompatible",Hm[Hm.TargetIncompatible=2]="TargetIncompatible",Hm[Hm.HierarchyIssue=3]="HierarchyIssue",(Wm=Vm||(Vm={}))[Wm.Input=0]="Input",Wm[Wm.Output=1]="Output";var jm=class e{createCustomInputBlock(){return null}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}checkCompatibilityState(t){const i=this._ownerBlock,n=t.ownerBlock;if(i.target===Lm.Fragment){if(n.target===Lm.Vertex)return 2;for(const e of n.outputs)if(e.ownerBlock.target!=Lm.Neutral&&e.isConnectedInVertexShader)return 2}if(this.type!==t.type&&t.innerType!==Om.AutoDetect)return e.AreEquivalentTypes(this.type,t.type)||t.acceptedConnectionPointTypes&&-1!==t.acceptedConnectionPointTypes.indexOf(this.type)||t._acceptedConnectionPointType&&e.AreEquivalentTypes(t._acceptedConnectionPointType.type,this.type)?0:1;if(t.excludedConnectionPointTypes&&-1!==t.excludedConnectionPointTypes.indexOf(this.type))return 1;let a=n,s=i;return 0===this.direction&&(a=i,s=n),a.isAnAncestorOf(s)?3:0}get endpoints(){return this._endpoints}addExcludedConnectionPointFromAllowedTypes(e){let t=1;for(;t<Om.All;)e&t||this.excludedConnectionPointTypes.push(t),t<<=1}set _connectedPoint(e){this._connectedPointBackingField!==e&&(this._connectedPointTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._connectedPointBackingField=e)),this._connectedPointBackingField&&(this._connectedPointTypeChangedObserver=this._connectedPointBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}_notifyTypeChanged(){this._isTypeChangeObservableNotifying||(this._isTypeChangeObservableNotifying=!0,this.onTypeChangedObservable.notifyObservers(this.type),this._isTypeChangeObservableNotifying=!1)}get _defaultConnectionPointType(){return this._defaultConnectionPointTypeBackingField}get isConnectedToInputBlock(){return null!==this.connectedPoint&&this.connectedPoint.ownerBlock.isInput}get declarationVariableName(){return this._ownerBlock.isInput?this._ownerBlock.declarationVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.declarationVariableName}get type(){if(this._type===Om.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}if(this._type===Om.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}canConnectTo(e){return 0===this.checkCompatibilityState(e)}connectTo(e,t=!1){if(!t&&!this.canConnectTo(e))throw"Cannot connect these two connectors.";return this._endpoints.push(e),e._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this}get ownerBlock(){return this._ownerBlock}get associatedVariableName(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName}get direction(){return this._direction}static AreEquivalentTypes(e,t){switch(e){case Om.Vector3:if(t===Om.Color3)return!0;break;case Om.Vector4:if(t===Om.Color4)return!0;break;case Om.Color3:if(t===Om.Vector3)return!0;break;case Om.Color4:if(t===Om.Vector4)return!0}return!1}set target(e){this._target=e}disconnectFrom(e){const t=this._endpoints.indexOf(e);return-1===t||(this._endpoints.splice(t,1),e._connectedPoint=null,this._enforceAssociatedVariableName=!1,e._enforceAssociatedVariableName=!1,this.onDisconnectionObservable.notifyObservers(e),e.onDisconnectionObservable.notifyObservers(this)),this}set _defaultConnectionPointType(e){this._updateTypeDependentState((()=>this._defaultConnectionPointTypeBackingField=e))}_updateTypeDependentState(e){const t=this.type;e(),this.type!==t&&this._notifyTypeChanged()}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((e=>e.ownerBlock))}get _typeConnectionSource(){return this._typeConnectionSourceBackingField}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear(),this.onTypeChangedObservable.clear(),this._connectedPoint=null,this._typeConnectionSource=null,this._linkedConnectionSource=null}get isDirectlyConnectedToVertexOutput(){if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Lm.Vertex)return!0;if((e.ownerBlock.target===Lm.Neutral||e.ownerBlock.target===Lm.VertexAndFragment)&&e.ownerBlock.outputs.some((e=>e.isDirectlyConnectedToVertexOutput)))return!0}return!1}get target(){return this._prioritizeVertex&&this._ownerBlock?this._target!==Lm.VertexAndFragment?this._target:this._ownerBlock.target===Lm.Fragment?Lm.Fragment:Lm.Vertex:this._target}get isConnectedInVertexShader(){if(this.target===Lm.Vertex)return!0;if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Lm.Vertex)return!0;if(e.target===Lm.Vertex)return!0;if((e.ownerBlock.target===Lm.Neutral||e.ownerBlock.target===Lm.VertexAndFragment)&&e.ownerBlock.outputs.some((e=>e.isConnectedInVertexShader)))return!0}return!1}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}serialize(e=!0){const t={};return t.name=this.name,t.displayName=this.displayName,e&&this.connectedPoint&&(t.inputName=this.name,t.targetBlockId=this.connectedPoint.ownerBlock.xt,t.targetConnectionName=this.connectedPoint.name,t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),t}set type(e){this._updateTypeDependentState((()=>this._type=e))}getClassName(){return"NodeMaterialConnectionPoint"}get isConnectedInFragmentShader(){if(this.target===Lm.Fragment)return!0;if(!this.hasEndpoints)return!1;for(const e of this._endpoints){if(e.ownerBlock.target===Lm.Fragment)return!0;if((e.ownerBlock.target===Lm.Neutral||e.ownerBlock.target===Lm.VertexAndFragment)&&e.ownerBlock.isConnectedInFragmentShader())return!0}return!1}set _typeConnectionSource(e){this._typeConnectionSourceBackingField!==e&&(this._typeConnectionSourceTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._typeConnectionSourceBackingField=e)),this._typeConnectionSourceBackingField&&(this._typeConnectionSourceTypeChangedObserver=this._typeConnectionSourceBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}set _linkedConnectionSource(e){this._linkedConnectionSourceBackingField!==e&&(this._linkedConnectionSourceTypeChangedObserver?.remove(),this._updateTypeDependentState((()=>this._linkedConnectionSourceBackingField=e)),this._linkedConnectionSourceBackingField&&(this._linkedConnectionSourceTypeChangedObserver=this._linkedConnectionSourceBackingField.onTypeChangedObservable.add((()=>{this._notifyTypeChanged()}))))}get connectInputBlock(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null}constructor(e,t,i){this._connectedPointBackingField=null,this._endpoints=new Array,this._typeConnectionSourceBackingField=null,this._defaultConnectionPointTypeBackingField=null,this._linkedConnectionSourceBackingField=null,this._acceptedConnectionPointType=null,this._type=Om.Float,this._enforceAssociatedVariableName=!1,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new Ih,this.onDisconnectionObservable=new Ih,this.onTypeChangedObservable=new Ih,this._isTypeChangeObservableNotifying=!1,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._prioritizeVertex=!1,this._target=Lm.VertexAndFragment,this._ownerBlock=t,this.name=e,this._direction=i}get _connectedPoint(){return this._connectedPointBackingField}set associatedVariableName(e){this._associatedVariableName=e}get innerType(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type}get connectedPoint(){return this._connectedPoint}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get _linkedConnectionSource(){return this._linkedConnectionSourceBackingField}},Km=class{static get UniqueId(){const e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}};Km._UniqueIdCounter=1;var $m=class{_outputRename(e){return e}validateBlockName(e){const t=["position","normal","tangent","particle_positionw","uv","uv2","uv3","uv4","uv5","uv6","position2d","particle_uv","matricesIndices","matricesWeights","world0","world1","world2","world3","particle_color","particle_texturemask"];for(const i of t)if(e===i)return!1;return!0}dispose(){this.onCodeIsReadyObservable.clear();for(const e of this.inputs)e.dispose();for(const e of this.outputs)e.dispose()}get isUnique(){return this._isUnique}provideFallbacks(e,t){}set target(e){0==(this._target&e)&&(this._target=e)}serialize(){const e={};e.customType="BABYLON."+this.getClassName(),e.id=this.xt,e.name=this.name,e.comments=this.comments,e.visibleInInspector=this.visibleInInspector,e.visibleOnFrame=this.visibleOnFrame,e.target=this.target,e.inputs=[],e.outputs=[];for(const t of this.inputs)e.inputs.push(t.serialize());for(const t of this.outputs)e.outputs.push(t.serialize(!1));return e}bind(e,t,i,n){}initialize(e){}get buildId(){return this._buildId}get name(){return this._name}_inputRename(e){return e}constructor(e,t=Lm.Vertex,i=!1){this._isFinalMerger=!1,this._isInput=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._name="",this._isUnique=!1,this._codeIsReady=!0,this.onCodeIsReadyObservable=new Ih,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.visibleInInspector=!1,this.visibleOnFrame=!1,this._target=t,this._originalTargetIsNeutral=t===Lm.Neutral,this._isFinalMerger=i,this._isInput="InputBlock"===this.getClassName(),this._isTeleportOut="NodeMaterialTeleportOutBlock"===this.getClassName(),this._isTeleportIn="NodeMaterialTeleportInBlock"===this.getClassName(),this._name=e,this.xt=Km.UniqueId}initializeDefines(e,t,i,n=!1){}getInputByName(e){const t=this._inputs.filter((t=>t.name===e));return t.length?t[0]:null}replaceRepeatableContent(e,t,i,n){}registerInput(e,t,i=!1,n,a){return(a=a??new jm(e,this,0)).type=t,a.isOptional=i,n&&(a.target=n),this._inputs.push(a),this}_dumpCodeForOutputConnections(e){let t="";if(-1!==e.indexOf(this))return t;e.push(this);for(const i of this.inputs){if(!i.isConnected)continue;const n=i.connectedPoint,a=n.ownerBlock;t+=a._dumpCodeForOutputConnections(e),t+=`${a._codeVariableName}.${a._outputRename(n.name)}.connectTo(${this._codeVariableName}.${this._inputRename(i.name)});\n`}return t}get codeIsReady(){return this._codeIsReady}isReady(e,t,i,n=!1){return!0}updateUniformsAndSamples(e,t,i,n){}_processBuild(e,t,i,n){e.build(t,n);const a=null!=t._vertexState,s=e._buildTarget===Lm.Vertex&&e.target!==Lm.VertexAndFragment;if(a&&(0==(e.target&e._buildTarget)||0==(e.target&i.target)||this.target!==Lm.VertexAndFragment&&s)&&(!e.isInput&&t.target!==e._buildTarget||e.isInput&&e.isAttribute&&!e._noContextSwitch)){const e=i.connectedPoint;if(t._vertexState._emitVaryingFromString("v_"+e.declarationVariableName,e.type)){const i=1===t.shaderLanguage?"vertexOutputs.":"";t._vertexState.compilationString+=`${i}${"v_"+e.declarationVariableName} = ${e.associatedVariableName};\n`}const n=1===t.shaderLanguage?"fragmentInputs.":"";i.associatedVariableName=n+"v_"+e.declarationVariableName,i._enforceAssociatedVariableName=!0}}build(e,t){if(this._buildId===e.sharedData.buildId)return!0;if(!this.isInput)for(const t of this._outputs)t.associatedVariableName||(t.associatedVariableName=e._getFreeVariableName(t.name));for(const i of this._inputs){if(!i.connectedPoint){i.isOptional||e.sharedData.checks.notConnectedNonOptionalInputs.push(i);continue}if(this.target!==Lm.Neutral){if(0==(i.target&this.target))continue;if(0==(i.target&e.target))continue}const n=i.connectedPoint.ownerBlock;n&&n!==this&&this._processBuild(n,e,i,t)}if(this._customBuildStep(e,t),this._buildId===e.sharedData.buildId)return!0;if(e.sharedData.verbose&&jh.Log(`${e.target===Lm.Vertex?"Vertex shader":"Fragment shader"}: Building ${this.name} [${this.getClassName()}]`),this.isFinalMerger)switch(e.target){case Lm.Vertex:e.sharedData.checks.emitVertex=!0;break;case Lm.Fragment:e.sharedData.checks.emitFragment=!0}!this.isInput&&e.sharedData.emitComments&&(e.compilationString+=`\n//${this.name}\n`),this._buildBlock(e),this._buildId=e.sharedData.buildId,this._buildTarget=e.target;for(const i of this._outputs)if(0!=(i.target&e.target))for(const n of i.endpoints){const i=n.ownerBlock;i&&0!=(i.target&e.target)&&-1!==t.indexOf(i)&&this._processBuild(i,e,n,t)}return!1}get outputs(){return this._outputs}isAnAncestorOf(e){for(const t of this._outputs)if(t.hasEndpoints)for(const i of t.endpoints){if(i.ownerBlock===e)return!0;if(i.ownerBlock.isAnAncestorOf(e))return!0}return!1}get isInput(){return this._isInput}set buildId(e){this._buildId=e}connectTo(e,t){if(0===this._outputs.length)return;let i=t&&t.output?this.getOutputByName(t.output):this.getFirstAvailableOutput(e),n=!0;for(;n;){const a=t&&t.input?e.getInputByName(t.input):e.getFirstAvailableInput(i);if(i&&a&&i.canConnectTo(a))i.connectTo(a),n=!1;else{if(!i)throw"Unable to find a compatible match";i=this.getSiblingOutput(i)}}return this}get willBeGeneratedIntoVertexShaderFromFragmentShader(){return!this.isInput&&!this.isFinalMerger&&(!this._outputs.some((e=>e.isDirectlyConnectedToVertexOutput))&&(this.target!==Lm.Vertex&&!(this.target!==Lm.VertexAndFragment&&this.target!==Lm.Neutral||!this._outputs.some((e=>e.isConnectedInVertexShader)))))}_writeVariable(e){return e.connectedPoint?`${e.associatedVariableName}`:"0."}_buildBlock(e){}clone(e,t=""){const i=this.serialize(),n=oh(i.customType);if(n){const a=new n;return a._deserialize(i,e,t),a}return null}_setInitialTarget(e){this._target=e,this._originalTargetIsNeutral=e===Lm.Neutral}get inputs(){return this._inputs}get isFinalMerger(){return this._isFinalMerger}getClassName(){return"NodeMaterialBlock"}getOutputByName(e){const t=this._outputs.filter((t=>t.name===e));return t.length?t[0]:null}get isTeleportIn(){return this._isTeleportIn}_deserializePortDisplayNamesAndExposedOnFrame(e){const t=e.inputs,i=e.outputs;t&&t.forEach(((e,t)=>{e.displayName&&(this.inputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.inputs[t].isExposedOnFrame=e.isExposedOnFrame,this.inputs[t].exposedPortPosition=e.exposedPortPosition)})),i&&i.forEach(((e,t)=>{e.displayName&&(this.outputs[t].displayName=e.displayName),e.isExposedOnFrame&&(this.outputs[t].isExposedOnFrame=e.isExposedOnFrame,this.outputs[t].exposedPortPosition=e.exposedPortPosition)}))}_dumpPropertiesCode(){const e=this._codeVariableName;return`${e}.visibleInInspector = ${this.visibleInInspector};\n${e}.visibleOnFrame = ${this.visibleOnFrame};\n${e}.target = ${this.target};\n`}set name(e){this.validateBlockName(e)&&(this._name=e)}_deserialize(e,t,i,n){this.name=e.name,this.comments=e.comments,this.visibleInInspector=!!e.visibleInInspector,this.visibleOnFrame=!!e.visibleOnFrame,this._target=e.target??this.target,this._deserializePortDisplayNamesAndExposedOnFrame(e)}_customBuildStep(e,t){}getSiblingOutput(e){const t=this._outputs.indexOf(e);return-1===t||t>=this._outputs.length?null:this._outputs[t+1]}_linkConnectionTypes(e,t,i=!1){i?this._inputs[t]._acceptedConnectionPointType=this._inputs[e]:this._inputs[e]._linkedConnectionSource=this._inputs[t],this._inputs[t]._linkedConnectionSource=this._inputs[e]}autoConfigure(e,t=(()=>!0)){}_writeFloat(e){let t=e.toString();return-1===t.indexOf(".")&&(t+=".0"),`${t}`}get isTeleportOut(){return this._isTeleportOut}isConnectedInFragmentShader(){return this.outputs.some((e=>e.isConnectedInFragmentShader))}_dumpCode(e,t){t.push(this);const i=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=i||`${this.getClassName()}_${this.xt}`,-1!==e.indexOf(this._codeVariableName)){let t=0;do{t++,this._codeVariableName=i+t}while(-1!==e.indexOf(this._codeVariableName))}e.push(this._codeVariableName);let n=`\n// ${this.getClassName()}\n`;this.comments&&(n+=`// ${this.comments}\n`),n+=`var ${this._codeVariableName} = new BABYLON.${this.getClassName()}("${this.name}");\n`,n+=this._dumpPropertiesCode();for(const i of this.inputs){if(!i.isConnected)continue;const a=i.connectedPoint.ownerBlock;-1===t.indexOf(a)&&(n+=a._dumpCode(e,t))}for(const i of this.outputs)if(i.hasEndpoints)for(const a of i.endpoints){const i=a.ownerBlock;i&&-1===t.indexOf(i)&&(n+=i._dumpCode(e,t))}return n}prepareDefines(e,t,i,n=!1,a){}getFirstAvailableInput(e=null){for(const t of this._inputs)if(!(t.connectedPoint||e&&e.type!==t.type&&t.type!==Om.AutoDetect))return t;return null}getFirstAvailableOutput(e=null){for(const t of this._outputs)if(!e||!e.target||e.target===Lm.Neutral||0!=(e.target&t.target))return t;return null}get target(){return this._target}registerOutput(e,t,i,n){return(n=n??new jm(e,this,1)).type=t,i&&(n.target=i),this._outputs.push(n),this}},qm=class extends $m{_deserialize(e,t,i){super._deserialize(e,t,i),this.complementZ=void 0!==e.complementZ?e.complementZ:0,this.complementW=void 0!==e.complementW?e.complementW:1}get transform(){return this._inputs[1]}get xyz(){return this._outputs[1]}constructor(e){super(e,Lm.Neutral),this.complementW=1,this.complementZ=0,this.target=Lm.Vertex,this.registerInput("vector",Om.AutoDetect),this.registerInput("transform",Om.Matrix),this.registerOutput("output",Om.Vector4),this.registerOutput("xyz",Om.Vector3),this._inputs[0].onConnectionObservable.add((e=>{if(e.ownerBlock.isInput){const t=e.ownerBlock;"normal"!==t.name&&"tangent"!==t.name||(this.complementW=0)}}))}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=this.transform,n=e._getShaderType(Om.Vector4),a=e._getShaderType(Om.Vector3);if(t.connectedPoint){if(0===this.complementW){const s=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",s),e.sharedData.blocksWithDefines.push(this);const r=e._getFreeVariableName(`${i.associatedVariableName}_NUS`);switch(1===e.shaderLanguage?e.compilationString+=`var ${r}: mat3x3f = mat3x3f(${i.associatedVariableName}[0].xyz, ${i.associatedVariableName}[1].xyz, ${i.associatedVariableName}[2].xyz);\n`:e.compilationString+=`mat3 ${r} = mat3(${i.associatedVariableName});\n`,e.compilationString+="#ifdef NONUNIFORMSCALING\n",e.compilationString+=`${r} = transposeMat3(inverseMat3(${r}));\n`,e.compilationString+="#endif\n",t.connectedPoint.type){case Om.Vector2:e.compilationString+=e._declareOutput(this.output)+` = ${n}(${r} * ${a}(${t.associatedVariableName}, ${this._writeFloat(this.complementZ)}), ${this._writeFloat(this.complementW)});\n`;break;case Om.Vector3:case Om.Color3:e.compilationString+=e._declareOutput(this.output)+` = ${n}(${r} * ${t.associatedVariableName}, ${this._writeFloat(this.complementW)});\n`;break;default:e.compilationString+=e._declareOutput(this.output)+` = ${n}(${r} * ${t.associatedVariableName}.xyz, ${this._writeFloat(this.complementW)});\n`}}else{const a=i.associatedVariableName;switch(t.connectedPoint.type){case Om.Vector2:e.compilationString+=e._declareOutput(this.output)+` = ${a} * ${n}(${t.associatedVariableName}, ${this._writeFloat(this.complementZ)}, ${this._writeFloat(this.complementW)});\n`;break;case Om.Vector3:case Om.Color3:e.compilationString+=e._declareOutput(this.output)+` = ${a} * ${n}(${t.associatedVariableName}, ${this._writeFloat(this.complementW)});\n`;break;default:e.compilationString+=e._declareOutput(this.output)+` = ${a} * ${t.associatedVariableName};\n`}}this.xyz.hasEndpoints&&(e.compilationString+=e._declareOutput(this.xyz)+` = ${this.output.associatedVariableName}.xyz;\n`)}return this}serialize(){const e=super.serialize();return e.complementZ=this.complementZ,e.complementW=this.complementW,e}get vector(){return this._inputs[0]}prepareDefines(e,t,i){e.nonUniformScaling&&i.setValue("NONUNIFORMSCALING",!0)}get output(){return this._outputs[0]}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.complementZ = ${this.complementZ};\n`;return e+=`${this._codeVariableName}.complementW = ${this.complementW};\n`,e}getClassName(){return"TransformBlock"}};rh("BABYLON.TransformBlock",qm);var Jm,Qm,Zm=class extends $m{_isLogarithmicDepthEnabled(e,t){if(t)return!0;for(const t of e)if(t.useLogarithmicDepth)return!0;return!1}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=1===e.shaderLanguage;if(1===e.shaderLanguage?e.compilationString+=`vertexOutputs.position = ${t.associatedVariableName};\n`:e.compilationString+=`gl_Position = ${t.associatedVariableName};\n`,this._isLogarithmicDepthEnabled(e.sharedData.fragmentOutputNodes,e.sharedData.nodeMaterial.useLogarithmicDepth)){e._emitUniformFromString("logarithmicDepthConstant",Om.Float),e._emitVaryingFromString("vFragmentDepth",Om.Float);const t=i?"vertexOutputs.vFragmentDepth":"vFragmentDepth",n=i?"uniforms.":"",a=i?"vertexOutputs.position":"gl_Position";e.compilationString+=`${t} = 1.0 + ${a}.w;\n`,e.compilationString+=`${a}.z = log2(max(0.000001, ${t})) * ${n}logarithmicDepthConstant;\n`}return this}getClassName(){return"VertexOutputBlock"}constructor(e){super(e,Lm.Vertex,!0),this.registerInput("vector",Om.Vector4)}get vector(){return this._inputs[0]}};function ep(e,t=0,i="PROPERTIES",n){return(a,s)=>{let r=a._propStore;r||(r=[],a._propStore=r),r.push({propertyName:s,displayName:e,type:t,groupName:i,options:n??{}})}}rh("BABYLON.VertexOutputBlock",Zm),(Qm=Jm||(Jm={}))[Qm.Boolean=0]="Boolean",Qm[Qm.Float=1]="Float",Qm[Qm.Int=2]="Int",Qm[Qm.Vector2=3]="Vector2",Qm[Qm.List=4]="List";var tp,ip,np,ap,sp=class extends $m{initialize(e){e._excludeVariableName("logarithmicDepthConstant"),e._excludeVariableName("vFragmentDepth")}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToLinearSpace,!0),i.setValue(this._gammaDefineName,this.convertToGammaSpace,!0)}get a(){return this._inputs[2]}bind(e,t,i){(this.useLogarithmicDepth||t.useLogarithmicDepth)&&i&&jd(void 0,e,i.getScene())}constructor(e){super(e,Lm.Fragment,!0),this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this.useLogarithmicDepth=!1,this.registerInput("rgba",Om.Color4,!0),this.registerInput("rgb",Om.AutoDetect,!0),this.registerInput("a",Om.Float,!0),this.rgb.addExcludedConnectionPointFromAllowedTypes(Om.Color3|Om.Vector3|Om.Float)}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.convertToGammaSpace = ${this.convertToGammaSpace};\n`,e+=`${this._codeVariableName}.convertToLinearSpace = ${this.convertToLinearSpace};\n`,e+=`${this._codeVariableName}.useLogarithmicDepth = ${this.useLogarithmicDepth};\n`,e}_buildBlock(e){super._buildBlock(e);const t=this.rgba,i=this.rgb,n=this.a,a=1===e.shaderLanguage;e.sharedData.hints.needAlphaBlending=t.isConnected||n.isConnected,e.sharedData.blocksWithDefines.push(this),(this.useLogarithmicDepth||e.sharedData.nodeMaterial.useLogarithmicDepth)&&(e._emitUniformFromString("logarithmicDepthConstant",Om.Float),e._emitVaryingFromString("vFragmentDepth",Om.Float),e.sharedData.bindableBlocks.push(this)),this._linearDefineName=e._getFreeDefineName("CONVERTTOLINEAR"),this._gammaDefineName=e._getFreeDefineName("CONVERTTOGAMMA");const s=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",s);let r="gl_FragColor";1===e.shaderLanguage&&(e.compilationString+="var fragmentOutputsColor : vec4<f32>;\r\n",r="fragmentOutputsColor");const o=e._getShaderType(Om.Vector4);if(t.connectedPoint)n.isConnected?e.compilationString+=`${r} = ${o}(${t.associatedVariableName}.rgb, ${n.associatedVariableName});\n`:e.compilationString+=`${r}  = ${t.associatedVariableName};\n`;else if(i.connectedPoint){let t="1.0";n.connectedPoint&&(t=n.associatedVariableName),i.connectedPoint.type===Om.Float?e.compilationString+=`${r}  = ${o}(${i.associatedVariableName}, ${i.associatedVariableName}, ${i.associatedVariableName}, ${t});\n`:e.compilationString+=`${r}  = ${o}(${i.associatedVariableName}, ${t});\n`}else e.sharedData.checks.notConnectedNonOptionalInputs.push(t);if(e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${r}  = toLinearSpace(${r});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${r}  = toGammaSpace(${r});\n`,e.compilationString+="#endif\n",1===e.shaderLanguage&&(e.compilationString+="#if !defined(PREPASS)\r\n",e.compilationString+="fragmentOutputs.color = fragmentOutputsColor;\r\n",e.compilationString+="#endif\r\n"),this.useLogarithmicDepth||e.sharedData.nodeMaterial.useLogarithmicDepth){const t=a?"input.vFragmentDepth":"vFragmentDepth",i=a?"uniforms.":"",n=a?"fragmentOutputs.fragDepth":"gl_FragDepthEXT";e.compilationString+=`${n} = log2(${t}) * ${i}logarithmicDepthConstant * 0.5;\n`}return e.compilationString+="#if defined(PREPASS)\r\n",e.compilationString+=`${a?"fragmentOutputs.fragData0":"gl_FragData[0]"} = ${r};\r\n`,e.compilationString+="#endif\r\n",this}get rgb(){return this._inputs[1]}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this.useLogarithmicDepth=e.useLogarithmicDepth??!1}get rgba(){return this._inputs[0]}getClassName(){return"FragmentOutputBlock"}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.useLogarithmicDepth=this.useLogarithmicDepth,e}};Lc([ep("Convert to gamma space",0,"PROPERTIES",{notifiers:{update:!0}})],sp.prototype,"convertToGammaSpace",void 0),Lc([ep("Convert to linear space",0,"PROPERTIES",{notifiers:{update:!0}})],sp.prototype,"convertToLinearSpace",void 0),Lc([ep("Use logarithmic depth",0,"PROPERTIES")],sp.prototype,"useLogarithmicDepth",void 0),rh("BABYLON.FragmentOutputBlock",sp),(ip=tp||(tp={}))[ip.World=1]="World",ip[ip.View=2]="View",ip[ip.Projection=3]="Projection",ip[ip.ViewProjection=4]="ViewProjection",ip[ip.WorldView=5]="WorldView",ip[ip.WorldViewProjection=6]="WorldViewProjection",ip[ip.CameraPosition=7]="CameraPosition",ip[ip.FogColor=8]="FogColor",ip[ip.DeltaTime=9]="DeltaTime",ip[ip.CameraParameters=10]="CameraParameters",ip[ip.MaterialAlpha=11]="MaterialAlpha",(ap=np||(np={}))[ap.CW=0]="CW",ap[ap.CCW=1]="CCW";var rp,op,lp=class e{degrees(){return 180*this._radians/Math.PI}static FromRadians(t){return new e(t)}static BetweenTwoVectors(t,i){let n=t.lengthSquared()*i.lengthSquared();if(0===n)return new e(Math.PI/2);n=Math.sqrt(n);let a=t.dot(i)/n;a=vh.Clamp(a,-1,1);const s=Math.acos(a);return new e(s)}static BetweenTwoPoints(t,i){const n=i.subtract(t),a=Math.atan2(n.y,n.x);return new e(a)}constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}radians(){return this._radians}static FromDegrees(t){return new e(t*Math.PI/180)}},cp=class{constructor(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;const n=Math.pow(t.x,2)+Math.pow(t.y,2),a=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,r=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new Ph((a*(t.y-i.y)-s*(e.y-t.y))/r,((e.x-t.x)*s-(t.x-i.x)*a)/r),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=lp.BetweenTwoPoints(this.centerPoint,this.startPoint);const o=this.startAngle.degrees();let l=lp.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=lp.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();l-o>180&&(l-=360),l-o<-180&&(l+=360),c-l>180&&(c-=360),c-l<-180&&(c+=360),this.orientation=l-o<0?0:1,this.angle=lp.FromDegrees(0===this.orientation?o-c:c-o)}},hp=class e{static StartingAt(t,i){return new e(t,i)}addLineTo(e,t){if(this.closed)return this;const i=new Ph(e,t),n=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(n).length(),this}addBezierCurveTo(e,t,i,n,a,s,r=36){if(this.closed)return this;const o=(e,t,i,n,a)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*n+e*e*e*a,l=this._points[this._points.length-1];for(let c=0;c<=r;c++){const h=c/r,f=o(h,l.x,e,i,a),u=o(h,l.y,t,n,s);this.addLineTo(f,u)}return this}isPointInside(e){let t=!1;const i=this._points.length;for(let n=i-1,a=0;a<i;n=a++){let i=this._points[n],s=this._points[a],r=s.x-i.x,o=s.y-i.y;if(Math.abs(o)>Number.EPSILON){if(o<0&&(i=this._points[a],r=-r,s=this._points[n],o=-o),e.y<i.y||e.y>s.y)continue;if(e.y===i.y&&e.x===i.x)return!0;{const n=o*(e.x-i.x)-r*(e.y-i.y);if(0===n)return!0;if(n<0)continue;t=!t}}else{if(e.y!==i.y)continue;if(s.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=s.x)return!0}}return t}area(){const e=this._points.length;let t=0;for(let i=e-1,n=0;n<e;i=n++)t+=this._points[i].x*this._points[n].y-this._points[n].x*this._points[i].y;return.5*t}getPointAtLengthPosition(e){if(e<0||e>1)return Ph.Zero();const t=e*this.length();let i=0;for(let e=0;e<this._points.length;e++){const n=(e+1)%this._points.length,a=this._points[e],s=this._points[n].subtract(a),r=s.length()+i;if(t>=i&&t<=r){const e=s.normalize(),n=t-i;return new Ph(a.x+e.x*n,a.y+e.y*n)}i=r}return Ph.Zero()}addQuadraticCurveTo(e,t,i,n,a=36){if(this.closed)return this;const s=(e,t,i,n)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*n,r=this._points[this._points.length-1];for(let o=0;o<=a;o++){const l=o/a,c=s(l,r.x,e,i),h=s(l,r.y,t,n);this.addLineTo(c,h)}return this}close(){return this.closed=!0,this}addArcTo(e,t,i,n,a=36){if(this.closed)return this;const s=this._points[this._points.length-1],r=new Ph(e,t),o=new Ph(i,n),l=new cp(s,r,o);let c=l.angle.radians()/a;0===l.orientation&&(c*=-1);let h=l.startAngle.radians()+c;for(let e=0;e<a;e++){const e=Math.cos(h)*l.radius+l.centerPoint.x,t=Math.sin(h)*l.radius+l.centerPoint.y;this.addLineTo(e,t),h+=c}return this}length(){let e=this._length;if(this.closed){const t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e}constructor(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new Ph(e,t))}getPoints(){return this._points}},fp=class e{_compute(e,t=!1){const i=this._curve.length;if(i<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();const n=this._tangents[0],a=this._normalVector(n,e);let s,r,o,l,c;this._normals[0]=a,this._raw||this._normals[0].normalize(),this._binormals[0]=wh.Cross(n,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let e=1;e<i;e++)s=this._getLastNonNullVector(e),e<i-1&&(r=this._getFirstNonNullVector(e),this._tangents[e]=t?r:s.add(r),this._tangents[e].normalize()),this._distances[e]=this._distances[e-1]+this._curve[e].subtract(this._curve[e-1]).length(),o=this._tangents[e],c=this._binormals[e-1],this._normals[e]=wh.Cross(c,o),this._raw||(0===this._normals[e].length()?(l=this._normals[e-1],this._normals[e]=l.clone()):this._normals[e].normalize()),this._binormals[e]=wh.Cross(o,this._normals[e]),this._raw||this._binormals[e].normalize();this._pointAtData.id=NaN}_getLastNonNullVector(e){let t=1,i=this._curve[e].subtract(this._curve[e-t]);for(;0===i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i}length(){return this._distances[this._distances.length-1]}getDistanceAt(e){return this.length()*e}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=Lh.Identity();const e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){const t=e+1,i=this._tangents[e].clone(),n=this._normals[e].clone(),a=this._binormals[e].clone(),s=this._tangents[t].clone(),r=this._normals[t].clone(),o=this._binormals[t].clone(),l=Dh.RotationQuaternionFromAxis(n,a,i),c=Dh.RotationQuaternionFromAxis(r,o,s);Dh.Slerp(l,c,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}_updatePointAtData(e,t=!1){if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;const i=this.getPoints();if(e<=0)return this._setPointAtData(0,0,i[0],0,t);if(e>=1)return this._setPointAtData(1,1,i[i.length-1],i.length-1,t);let n,a=i[0],s=0;const r=e*this.length();for(let o=1;o<i.length;o++){n=i[o];const l=wh.Distance(a,n);if(s+=l,s===r)return this._setPointAtData(e,1,n,o,t);if(s>r){const i=(s-r)/l,c=a.subtract(n),h=n.add(c.scaleInPlace(i));return this._setPointAtData(e,1-i,h,o-1,t)}a=n}return this._pointAtData}getDistances(){return this._distances}_setPointAtData(e,t,i,n,a){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=n,this._pointAtData.interpolateReady=a,a&&this._updateInterpolationMatrix(),this._pointAtData}_getFirstNonNullVector(e){let t=1,i=this._curve[e+t].subtract(this._curve[e]);for(;0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i}constructor(e,t=null,i,n=!1){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:wh.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:Lh.Identity()};for(let t=0;t<e.length;t++)this._curve[t]=e[t].clone();this._raw=i||!1,this._alignTangentsWithPath=n,this._compute(t,n)}getPointAt(e){return this._updatePointAtData(e).point}getBinormals(){return this._binormals}getTangents(){return this._tangents}getCurve(){return this._curve}slice(t=0,i=1){if(t<0&&(t=1- -1*t%1),i<0&&(i=1- -1*i%1),t>i){const e=t;t=i,i=e}const n=this.getCurve(),a=this.getPointAt(t);let s=this.getPreviousPointIndexAt(t);const r=this.getPointAt(i),o=this.getPreviousPointIndexAt(i)+1,l=[];return 0!==t&&(s++,l.push(a)),l.push(...n.slice(s,o)),1===i&&1!==t||l.push(r),new e(l,this.getNormalAt(t),this._raw,this._alignTangentsWithPath)}getPoints(){return this._curve}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getBinormalAt(e,t=!1){return this._updatePointAtData(e,t),t?wh.TransformCoordinates(wh.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getNormalAt(e,t=!1){return this._updatePointAtData(e,t),t?wh.TransformCoordinates(wh.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getClosestPositionTo(e){let t=Number.MAX_VALUE,i=0;for(let n=0;n<this._curve.length-1;n++){const a=this._curve[n+0],s=this._curve[n+1].subtract(a).normalize(),r=this._distances[n+1]-this._distances[n+0],o=Math.min(Math.max(wh.Dot(s,e.subtract(a).normalize()),0)*wh.Distance(a,e)/r,1),l=wh.Distance(a.add(s.scale(o*r)),e);l<t&&(t=l,i=(this._distances[n+0]+r*o)/this.length())}return i}_normalVector(e,t){let i,n=e.length();if(0===n&&(n=1),null==t){let t;t=vh.WithinEpsilon(Math.abs(e.y)/n,1,hh)?vh.WithinEpsilon(Math.abs(e.x)/n,1,hh)?vh.WithinEpsilon(Math.abs(e.z)/n,1,hh)?wh.Zero():new wh(0,0,1):new wh(1,0,0):new wh(0,-1,0),i=wh.Cross(e,t)}else i=wh.Cross(e,t),wh.CrossToRef(i,e,i);return i.normalize(),i}update(e,t=null,i=!1){for(let t=0;t<e.length;t++)this._curve[t].x=e[t].x,this._curve[t].y=e[t].y,this._curve[t].z=e[t].z;return this._compute(t,i),this}getTangentAt(e,t=!1){return this._updatePointAtData(e,t),t?wh.TransformCoordinates(wh.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}getNormals(){return this._normals}},up=class e{static Lerp(t,i,n){const a=t.width+(i.width-t.width)*n,s=t.height+(i.height-t.height)*n;return new e(a,s)}equals(e){return!!e&&(this.width===e.width&&this.height===e.height)}constructor(e,t){this.width=e,this.height=t}getClassName(){return"Size"}scale(t){return new e(this.width*t,this.height*t)}copyFrom(e){this.width=e.width,this.height=e.height}getHashCode(){let e=0|this.width;return e=397*e^(0|this.height),e}toString(){return`{W: ${this.width}, H: ${this.height}}`}clone(){return new e(this.width,this.height)}static Zero(){return new e(0,0)}multiplyByFloats(t,i){return new e(this.width*t,this.height*i)}get surface(){return this.width*this.height}subtract(t){return new e(this.width-t.width,this.height-t.height)}set(e,t){return this.copyFromFloats(e,t)}add(t){return new e(this.width+t.width,this.height+t.height)}copyFromFloats(e,t){return this.width=e,this.height=t,this}};(op=rp||(rp={}))[op.None=0]="None",op[op.Time=1]="Time",op[op.RealTime=2]="RealTime",op[op.MouseInfo=3]="MouseInfo";var dp={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},mp={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},pp={particle_texturemask:!0},_p=class extends $m{get animationType(){return this._animationType}get isAttribute(){return 1===this._mode}_emitDefine(e){return"!"===e[0]?`#ifndef ${e.substring(1)}\n`:`#ifdef ${e}\n`}getClassName(){return"InputBlock"}setAsSystemValue(e){return this.systemValue=e,this}_dumpPropertiesCode(){const e=this._codeVariableName;if(this.isAttribute)return super._dumpPropertiesCode()+`${e}.setAsAttribute("${this.name}");\n`;if(this.isSystemValue)return super._dumpPropertiesCode()+`${e}.setAsSystemValue(BABYLON.NodeMaterialSystemValues.${tp[this._systemValue]});\n`;if(this.isUniform){const t=[];let i="";switch(this.type){case Om.Float:i=`${this.value}`;break;case Om.Vector2:i=`new BABYLON.Vector2(${this.value.x}, ${this.value.y})`;break;case Om.Vector3:i=`new BABYLON.Vector3(${this.value.x}, ${this.value.y}, ${this.value.z})`;break;case Om.Vector4:i=`new BABYLON.Vector4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;break;case Om.Color3:i=`new BABYLON.Color3(${this.value.r}, ${this.value.g}, ${this.value.b})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case Om.Color4:i=`new BABYLON.Color4(${this.value.r}, ${this.value.g}, ${this.value.b}, ${this.value.a})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case Om.Matrix:i=`BABYLON.Matrix.FromArray([${this.value.m}])`}return t.push(`${e}.value = ${i}`),this.type===Om.Float&&t.push(`${e}.min = ${this.min}`,`${e}.max = ${this.max}`,`${e}.isBoolean = ${this.isBoolean}`,`${e}.matrixMode = ${this.matrixMode}`,`${e}.animationType = BABYLON.AnimatedInputBlockTypes.${rp[this.animationType]}`),t.push(`${e}.isConstant = ${this.isConstant}`),t.push(""),super._dumpPropertiesCode()+t.join(";\n")}return super._dumpPropertiesCode()}get value(){return this._storedValue}get isUndefined(){return 3===this._mode}get associatedVariableName(){return this._prefix+this._associatedVariableName}get type(){if(this._type===Om.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=Om.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Om.Vector2,this._type;case"Vector3":return this._type=Om.Vector3,this._type;case"Vector4":return this._type=Om.Vector4,this._type;case"Color3":return this._type=Om.Color3,this._type;case"Color4":return this._type=Om.Color4,this._type;case"Matrix":return this._type=Om.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"particle_positionw":return this._type=Om.Vector3,this._type;case"uv":case"uv2":case"uv3":case"uv4":case"uv5":case"uv6":case"position2d":case"particle_uv":return this._type=Om.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"matricesIndicesExtra":case"matricesWeightsExtra":case"world0":case"world1":case"world2":case"world3":case"tangent":return this._type=Om.Vector4,this._type;case"color":case"instanceColor":case"particle_color":case"particle_texturemask":return this._type=Om.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case tp.World:case tp.WorldView:case tp.WorldViewProjection:case tp.View:case tp.ViewProjection:case tp.Projection:return this._type=Om.Matrix,this._type;case tp.CameraPosition:return this._type=Om.Vector3,this._type;case tp.FogColor:return this._type=Om.Color3,this._type;case tp.DeltaTime:case tp.MaterialAlpha:return this._type=Om.Float,this._type;case tp.CameraParameters:return this._type=Om.Vector4,this._type}}return this._type}get systemValue(){return this._systemValue}set isVarying(e){this._mode=e?2:3,this.associatedVariableName=""}_transmitWorld(e,t,i,n){if(!this._systemValue)return;const a=this._associatedVariableName;switch(this._systemValue){case tp.World:e.setMatrix(a,t);break;case tp.WorldView:e.setMatrix(a,i);break;case tp.WorldViewProjection:e.setMatrix(a,n)}}get _noContextSwitch(){return mp[this.name]}set isUniform(e){this._mode=e?0:3,this.associatedVariableName=""}_deserialize(e,t,i){if(this._mode=e.mode,super._deserialize(e,t,i),this._type=e.type,this._systemValue=e.systemValue||e.wellKnownValue,this._animationType=e.animationType,this.min=e.min||0,this.max=e.max||0,this.isBoolean=!!e.isBoolean,this.matrixMode=e.matrixMode||0,this.isConstant=!!e.isConstant,this.groupInInspector=e.groupInInspector||"",this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,"tangent"===e.name&&1===e.mode&&e.type===Om.Vector3&&(this._type=Om.Vector4),e.valueType)if("number"===e.valueType)this._storedValue=e.value;else{const t=oh(e.valueType);t&&(this._storedValue=t.FromArray(e.value))}}get isUniform(){return 0===this._mode}set valueCallback(e){this._valueCallback=e,this._mode=0}get isVarying(){return 2===this._mode}animate(e){switch(this._animationType){case rp.Time:this.type===Om.Float&&(this.value+=.01*e.getAnimationRatio());break;case rp.RealTime:this.type===Om.Float&&(this.value=(Cf.Now-e.getEngine().startTime)/1e3);break;case rp.MouseInfo:if(this.type===Om.Vector4){const t=e._inputManager._originMouseEvent;if(t){const e=t.offsetX,i=t.offsetY,n=0!=(1&t.buttons)?1:0,a=0!=(2&t.buttons)?1:0;this.value=new Oh(e,i,n,a)}else this.value=new Oh(0,0,0,0)}}}set systemValue(e){this._mode=0,this.associatedVariableName="",this._systemValue=e}setDefaultValue(){switch(this.type){case Om.Float:this.value=0;break;case Om.Vector2:this.value=Ph.Zero();break;case Om.Vector3:this.value=wh.Zero();break;case Om.Vector4:this.value=Oh.Zero();break;case Om.Color3:this.value=Ah.White();break;case Om.Color4:this.value=new Ch(1,1,1,1);break;case Om.Matrix:this.value=Lh.Identity()}}serialize(){const e=super.serialize();return e.type=this.type,e.mode=this._mode,e.systemValue=this._systemValue,e.animationType=this._animationType,e.min=this.min,e.max=this.max,e.isBoolean=this.isBoolean,e.matrixMode=this.matrixMode,e.isConstant=this.isConstant,e.groupInInspector=this.groupInInspector,e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,null!=this._storedValue&&0===this._mode&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e}constructor(e,t=Lm.Vertex,i=Om.AutoDetect){super(e,t,!1),this._mode=3,this._animationType=rp.None,this._prefix="",this.min=0,this.max=0,this.isBoolean=!1,this.matrixMode=0,this._systemValue=null,this.isConstant=!1,this.groupInInspector="",this.onValueChangedObservable=new Ih,this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._type=i,this.setDefaultValue(),this.registerOutput("output",i)}_emit(e,t){if(this.isUniform){if(this._associatedVariableName||(this._associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant){if(-1!==e.constants.indexOf(this.associatedVariableName))return;return e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=e._declareOutput(this.output,!0)+` = ${this._emitConstant(e)};\n`)}if(-1!==e.uniforms.indexOf(this.associatedVariableName))return;e.uniforms.push(this.associatedVariableName),t&&(e._uniformDeclaration+=this._emitDefine(t));const i=e._getShaderType(this.type);1===e.shaderLanguage?(e._uniformDeclaration+=`uniform ${this._associatedVariableName}: ${i};\n`,this._prefix="uniforms."):e._uniformDeclaration+=`uniform ${i} ${this.associatedVariableName};\n`,t&&(e._uniformDeclaration+="#endif\n");const n=e.sharedData.hints;if(null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case tp.WorldView:n.needWorldViewMatrix=!0;break;case tp.WorldViewProjection:n.needWorldViewProjectionMatrix=!0}else this._animationType!==rp.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=dp[this.name]??this.name,this.target===Lm.Vertex&&e._vertexState)return void(mp[this.name]?pp[this.name]?(e._emitUniformFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="vertexInputs.")):e._emitVaryingFromString(this.declarationVariableName,this.type,t):this._emit(e._vertexState,t));if(-1!==e.attributes.indexOf(this.declarationVariableName))return;e.attributes.push(this.declarationVariableName),mp[this.name]?pp[this.name]?(e._emitUniformFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="uniforms.")):(e._emitVaryingFromString(this.declarationVariableName,this.type,t),1===e.shaderLanguage&&(this._prefix="fragmentInputs.")):(t&&(e._attributeDeclaration+=this._emitDefine(t)),1===e.shaderLanguage?(e._attributeDeclaration+=`attribute ${this.declarationVariableName}: ${e._getShaderType(this.type)};\n`,this._prefix="vertexInputs."):e._attributeDeclaration+=`attribute ${e._getShaderType(this.type)} ${this.declarationVariableName};\n`,t&&(e._attributeDeclaration+="#endif\n"))}}_transmit(e,t,i){if(this.isAttribute)return;const n=this._associatedVariableName;if(this._systemValue){switch(this._systemValue){case tp.World:case tp.WorldView:case tp.WorldViewProjection:return;case tp.View:e.setMatrix(n,t.getViewMatrix());break;case tp.Projection:e.setMatrix(n,t.getProjectionMatrix());break;case tp.ViewProjection:e.setMatrix(n,t.getTransformMatrix());break;case tp.CameraPosition:t.bindEyePosition(e,n,!0);break;case tp.FogColor:e.setColor3(n,t.fogColor);break;case tp.DeltaTime:e.setFloat(n,t.deltaTime/1e3);break;case tp.CameraParameters:t.activeCamera&&e.setFloat4(n,t.getEngine().hasOriginBottomLeft?-1:1,t.activeCamera.minZ,t.activeCamera.maxZ,1/t.activeCamera.maxZ);break;case tp.MaterialAlpha:e.setFloat(n,i.alpha)}return}const a=this._valueCallback?this._valueCallback():this._storedValue;if(null!==a)switch(this.type){case Om.Float:e.setFloat(n,a);break;case Om.Int:e.setInt(n,a);break;case Om.Color3:Rh.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&Rh.Color3[0].toGammaSpaceToRef(Rh.Color3[0],t.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&Rh.Color3[0].toLinearSpaceToRef(Rh.Color3[0],t.getEngine().useExactSrgbConversions),e.setColor3(n,Rh.Color3[0]);break;case Om.Color4:Rh.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&Rh.Color4[0].toGammaSpaceToRef(Rh.Color4[0],t.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&Rh.Color4[0].toLinearSpaceToRef(Rh.Color4[0],t.getEngine().useExactSrgbConversions),e.setDirectColor4(n,Rh.Color4[0]);break;case Om.Vector2:e.setVector2(n,a);break;case Om.Vector3:e.setVector3(n,a);break;case Om.Vector4:e.setVector4(n,a);break;case Om.Matrix:e.setMatrix(n,a)}}_emitConstant(e){switch(this.type){case Om.Float:return`${e._emitFloat(this.value)}`;case Om.Vector2:return`vec2(${this.value.x}, ${this.value.y})`;case Om.Vector3:return`vec3(${this.value.x}, ${this.value.y}, ${this.value.z})`;case Om.Vector4:return`vec4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;case Om.Color3:return Rh.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&Rh.Color3[0].toGammaSpaceToRef(Rh.Color3[0],e.sharedData.scene.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&Rh.Color3[0].toLinearSpaceToRef(Rh.Color3[0],e.sharedData.scene.getEngine().useExactSrgbConversions),`vec3(${Rh.Color3[0].r}, ${Rh.Color3[0].g}, ${Rh.Color3[0].b})`;case Om.Color4:return Rh.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&Rh.Color4[0].toGammaSpaceToRef(Rh.Color4[0],e.sharedData.scene.getEngine().useExactSrgbConversions),this.convertToLinearSpace&&Rh.Color4[0].toLinearSpaceToRef(Rh.Color4[0],e.sharedData.scene.getEngine().useExactSrgbConversions),`vec4(${Rh.Color4[0].r}, ${Rh.Color4[0].g}, ${Rh.Color4[0].b}, ${Rh.Color4[0].a})`}return""}_buildBlock(e){super._buildBlock(e),(this.isUniform||this.isSystemValue)&&e.sharedData.inputBlocks.push(this),this._emit(e)}get declarationVariableName(){return this._associatedVariableName}set associatedVariableName(e){this._associatedVariableName=e}validateBlockName(e){return!!this.isAttribute||super.validateBlockName(e)}initialize(){this.associatedVariableName=""}dispose(){this.onValueChangedObservable.clear(),super.dispose()}get valueCallback(){return this._valueCallback}set value(e){this.type===Om.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=0,this.onValueChangedObservable.notifyObservers(this)}setAsAttribute(e){return this._mode=1,e&&(this.name=e),this}set animationType(e){this._animationType=e}get output(){return this._outputs[0]}get isSystemValue(){return null!=this._systemValue}set isAttribute(e){this._mode=e?1:3,this.associatedVariableName=""}};rh("BABYLON.InputBlock",_p);var vp=class e{isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}get is3D(){return!!this._texture&&this._texture.is3D}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}set isCube(e){this._texture&&(this._texture.isCube=e)}static _IsRenderTargetWrapper(e){return void 0!==e?.shareDepth}get coordinatesMode(){return 0}set wrapV(e){this._wrapV=e}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}delayLoad(){}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}constructor(t){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=up.Zero(),this._cachedBaseSize=up.Zero(),this._initialSamplingMode=2,this._texture=e._IsRenderTargetWrapper(t)?t.texture:t,this._texture&&(this._engine=this._texture.getEngine())}get isCube(){return!!this._texture&&this._texture.isCube}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}set is3D(e){this._texture&&(this._texture.is3D=e)}getInternalTexture(){return this._texture}get is2DArray(){return!!this._texture&&this._texture.is2DArray}getClassName(){return"ThinTexture"}},gp=class e extends vp{get wrapV(){return this._wrapV}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}get wrapU(){return this._wrapU}_getFromCache(e,t,i,n,a,s){const r=this._getEngine();if(!r)return null;const o=r._getUseSRGBBuffer(!!a,t),l=r.getLoadedTexturesCache();for(let r=0;r<l.length;r++){const c=l[r];if(!(void 0!==a&&o!==c._useSRGBBuffer||void 0!==n&&n!==c.invertY||c.url!==e||c.generateMipMaps!==!t||i&&i!==c.samplingMode||void 0!==s&&s!==c.isCube))return c.incrementReferences(),c}return null}set wrapU(e){this._wrapU=e}toString(){return this.name}get noMipmap(){return!1}getScene(){return this._scene}set isRGBD(e){e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}getReflectionTextureMatrix(){return Lh.IdentityReadOnly}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}get hasAlpha(){return this._hasAlpha}clone(){return null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const e=this._parentContainer.textures.indexOf(this);e>-1&&this._parentContainer.textures.splice(e,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}_readPixelsSync(e=0,t=0,i=null,n=!0,a=!1){if(!this._texture)return null;const s=this.getSize();let r=s.width,o=s.height;const l=this._getEngine();if(!l)return null;0!=t&&(r/=Math.pow(2,t),o/=Math.pow(2,t),r=Math.round(r),o=Math.round(o));try{return this._texture.isCube?l._readTexturePixelsSync(this._texture,r,o,e,t,i,n,a):l._readTexturePixelsSync(this._texture,r,o,-1,t,i,n,a)}catch(e){return null}}set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}readPixels(e=0,t=0,i=null,n=!0,a=!1,s=0,r=0,o=Number.MAX_VALUE,l=Number.MAX_VALUE){if(!this._texture)return null;const c=this._getEngine();if(!c)return null;const h=this.getSize();let f=h.width,u=h.height;0!==t&&(f/=Math.pow(2,t),u/=Math.pow(2,t),f=Math.round(f),u=Math.round(u)),o=Math.min(f,o),l=Math.min(u,l);try{return this._texture.isCube?c._readTexturePixels(this._texture,o,l,e,t,i,n,a,s,r):c._readTexturePixels(this._texture,o,l,-1,t,i,n,a,s,r)}catch(e){return null}}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}scale(e){}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}get errorObject(){return this._errorObject}get loadingError(){return this._loadingError}serialize(e=!1){if(!this.name&&!e)return null;const t=Uh.Serialize(this);return Uh.AppendSerializedAnimations(this,t),t}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}set wrapV(e){this._wrapV=e}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}get is2DArray(){return!!this._texture&&this._texture.is2DArray}_getEngine(){return this._engine}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}get isCube(){return this._texture?this._texture.isCube:this._isCube}get is3D(){return!!this._texture&&this._texture.is3D}getClassName(){return"BaseTexture"}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set is3D(e){this._texture&&(this._texture.is3D=e)}get isBlocking(){return!0}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))}get uid(){return this._uid||(this._uid=Ju()),this._uid}get canRescale(){return!1}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get getAlphaFromRGB(){return this._getAlphaFromRGB}constructor(t,i=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new Ih,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,t?e._IsScene(t)?this._scene=t:this._engine=t:this._scene=xh.LastCreatedScene,this._scene&&(this.xt=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=i,this._uid=null}getTextureMatrix(){return Lh.IdentityReadOnly}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}get coordinatesMode(){return this._coordinatesMode}static WhenAllReady(e,t){let i=e.length;if(0!==i)for(let n=0;n<e.length;n++){const a=e[n];if(a.isReady())0==--i&&t();else{const e=a.onLoadObservable;e?e.addOnce((()=>{0==--i&&t()})):0==--i&&t()}}else t()}_rebuild(e=!1){}static _IsScene(e){return"Scene"===e.getClassName()}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}};function Sp(e,t,i=!1){const n=t.width,a=t.height;if(e instanceof Float32Array){let t=e.byteLength/e.BYTES_PER_ELEMENT;const i=new Uint8Array(t);for(;--t>=0;){let n=e[t];n<0?n=0:n>1&&(n=1),i[t]=255*n}e=i}const s=document.createElement("canvas");s.width=n,s.height=a;const r=s.getContext("2d");if(!r)return null;const o=r.createImageData(n,a);if(o.data.set(e),r.putImageData(o,0,0),i){const e=document.createElement("canvas");e.width=n,e.height=a;const t=e.getContext("2d");return t?(t.translate(0,a),t.scale(1,-1),t.drawImage(s,0,0),e.toDataURL("image/png")):null}return s.toDataURL("image/png")}gp.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,Lc([Hc()],gp.prototype,"uniqueId",void 0),Lc([Hc()],gp.prototype,"name",void 0),Lc([Hc()],gp.prototype,"metadata",void 0),Lc([Hc("hasAlpha")],gp.prototype,"_hasAlpha",void 0),Lc([Hc("getAlphaFromRGB")],gp.prototype,"_getAlphaFromRGB",void 0),Lc([Hc()],gp.prototype,"level",void 0),Lc([Hc("coordinatesIndex")],gp.prototype,"_coordinatesIndex",void 0),Lc([Hc()],gp.prototype,"optimizeUVAllocation",void 0),Lc([Hc("coordinatesMode")],gp.prototype,"_coordinatesMode",void 0),Lc([Hc()],gp.prototype,"wrapU",null),Lc([Hc()],gp.prototype,"wrapV",null),Lc([Hc()],gp.prototype,"wrapR",void 0),Lc([Hc()],gp.prototype,"anisotropicFilteringLevel",void 0),Lc([Hc()],gp.prototype,"isCube",null),Lc([Hc()],gp.prototype,"is3D",null),Lc([Hc()],gp.prototype,"is2DArray",null),Lc([Hc()],gp.prototype,"gammaSpace",null),Lc([Hc()],gp.prototype,"invertZ",void 0),Lc([Hc()],gp.prototype,"lodLevelInAlpha",void 0),Lc([Hc()],gp.prototype,"lodGenerationOffset",null),Lc([Hc()],gp.prototype,"lodGenerationScale",null),Lc([Hc()],gp.prototype,"linearSpecularLOD",null),Lc([Vc()],gp.prototype,"irradianceTexture",null),Lc([Hc()],gp.prototype,"isRenderTarget",void 0);var yp=class e extends gp{getClassName(){return"Texture"}serialize(){const t=this.name;e.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const i=super.serialize(e._SerializeInternalTextureUniqueId);return i?((e.SerializeBuffers||e.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(i.base64String=this._buffer,i.name=i.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?i.base64String="data:image/png;base64,"+Nf(this._buffer):(e.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(i.base64String=!this._engine||this._engine._features.supportSyncTextureRead?function(e,t=0,i=0){const n=e.getInternalTexture();if(!n)return null;const a=e._readPixelsSync(t,i);return a?Sp(a,e.getSize(),n.invertY):null}(this):async function(e,t=0,i=0){const n=e.getInternalTexture();if(!n)return null;const a=await e.readPixels(t,i);return a?Sp(a,e.getSize(),n.invertY):null}(this))),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i._creationFlags=this._creationFlags,i._useSRGBBuffer=this._useSRGBBuffer,e._SerializeInternalTextureUniqueId&&(i.internalTextureUniqueId=this._texture?.xt??void 0),i.noMipmap=this._noMipmap,this.name=t,i):null}set isBlocking(e){this._isBlocking=e}updateURL(e,t=null,i,n){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=n,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?iu.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}static CreateFromBase64String(t,i,n,a,s,r=e.TRILINEAR_SAMPLINGMODE,o=null,l=null,c=5,h,f){return new e("data:"+i,n,a,s,r,o,l,t,!1,c,void 0,void 0,h,f)}clone(){const t={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return Uh.Clone((()=>new e(this._texture?this._texture.url:null,this.getScene(),t)),this)}get noMipmap(){return this._noMipmap}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=Lh.Zero(),this._rowGenerationMatrix=new Lh,this._t0=wh.Zero(),this._t1=wh.Zero(),this._t2=wh.Zero()),Lh.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(Lh.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,kh.Matrix[0]),Lh.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,kh.Matrix[1]),Lh.ScalingToRef(this._cachedUScale,this._cachedVScale,0,kh.Matrix[2]),Lh.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,kh.Matrix[3]),kh.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(kh.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(kh.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(kh.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),Lh.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();if(!t)return this._cachedTextureMatrix;const i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedTextureMatrix}_prepareRowForTextureGeneration(e,t,i,n){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,wh.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,n),n.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,n.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,n.z+=this.wRotationCenter}get invertY(){return this._invertY}get isBlocking(){return this._isBlocking}get mimeType(){return this._mimeType}static Parse(t,i,n){if(t.customType){const e=qu.Instantiate(t.customType).Parse(t,i,n);return t.samplingMode&&e.updateSamplingMode&&e._samplingMode&&e._samplingMode!==t.samplingMode&&e.updateSamplingMode(t.samplingMode),e}if(t.isCube&&!t.isRenderTarget)return e._CubeTextureParser(t,i,n);const a=void 0!==t.internalTextureUniqueId;if(!t.name&&!t.isRenderTarget&&!a)return null;let s;if(a){const e=i.getEngine().getLoadedTexturesCache();for(const i of e)if(i.xt===t.internalTextureUniqueId){s=i;break}}const r=e=>{if(e&&e._texture&&(e._texture._cachedWrapU=null,e._texture._cachedWrapV=null,e._texture._cachedWrapR=null),t.samplingMode){const i=t.samplingMode;e&&e.samplingMode!==i&&e.updateSamplingMode(i)}if(e&&t.animations)for(let i=0;i<t.animations.length;i++){const n=t.animations[i],a=oh("BABYLON.Animation");a&&e.animations.push(a.Parse(n))}a&&!s&&e?._texture?._setUniqueId(t.internalTextureUniqueId)};return Uh.Parse((()=>{let a=!0;if(t.noMipmap&&(a=!1),t.mirrorPlane){const n=e._CreateMirror(t.name,t.renderTargetSize,i,a);return n._waitingRenderList=t.Pt,n.mirrorPlane=cd.FromArray(t.mirrorPlane),r(n),n}if(t.isRenderTarget){let n=null;if(t.isCube){if(i.reflectionProbes)for(let e=0;e<i.reflectionProbes.length;e++){const n=i.reflectionProbes[e];if(n.name===t.name)return n.cubeTexture}}else n=e._CreateRenderTargetTexture(t.name,t.renderTargetSize,i,a,t._creationFlags??0),n._waitingRenderList=t.Pt;return r(n),n}if(t.isVideo){const s=e._CreateVideoTexture(n+(t.url||t.name),n+(t.src||t.url),i,a,t.invertY,t.samplingMode,t.settings||{});return r(s),s}{let o;if(t.base64String&&!s)o=e.CreateFromBase64String(t.base64String,t.base64String,i,!a,t.invertY,t.samplingMode,(()=>{r(o)}),t._creationFlags??0,t._useSRGBBuffer??!1),o.name=t.name;else{let l;l=t.name&&(t.name.indexOf("://")>0||t.name.startsWith("data:"))?t.name:n+t.name,t.url&&(t.url.startsWith("data:")||e.UseSerializedUrlIfAny)&&(l=t.url);const c={noMipmap:!a,invertY:t.invertY,samplingMode:t.samplingMode,onLoad:()=>{r(o)},internalTexture:s};o=new e(l,i,c)}return o}}),t,i)}static _CreateVideoTexture(t,i,n,a=!1,s=!1,r=e.TRILINEAR_SAMPLINGMODE,o={},l,c=5){throw Qc("VideoTexture")}static LoadFromDataString(t,i,n,a=!1,s,r=!0,o=e.TRILINEAR_SAMPLINGMODE,l=null,c=null,h=5,f,u){return"data:"!==t.substr(0,5)&&(t="data:"+t),new e(t,n,s,r,o,l,c,i,a,h,void 0,void 0,f,u)}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}constructor(t,i,n,a,s=e.TRILINEAR_SAMPLINGMODE,r=null,o=null,l=null,c=!1,h,f,u,d,m){let p;super(i),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new Ih,this._isBlocking=!0,this.name=t||"",this.url=t;let _=!1,v=null,g=!0;"object"==typeof n&&null!==n?(p=n.noMipmap??!1,a=n.invertY??!dd,s=n.samplingMode??e.TRILINEAR_SAMPLINGMODE,r=n.onLoad??null,o=n.onError??null,l=n.buffer??null,c=n.deleteBuffer??!1,h=n.format,f=n.mimeType,u=n.loaderOptions,d=n.creationFlags,_=n.useSRGBBuffer??!1,v=n.internalTexture??null,g=n.gammaSpace??g):p=!!n,this._gammaSpace=g,this._noMipmap=p,this._invertY=void 0===a?!dd:a,this._initialSamplingMode=s,this._buffer=l,this._deleteBuffer=c,this._mimeType=f,this._loaderOptions=u,this._creationFlags=d,this._useSRGBBuffer=_,this._forcedExtension=m,h&&(this._format=h);const S=this.getScene(),y=this._getEngine();if(!y)return;y.onBeforeTextureInitObservable.notifyObservers(this);const E=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),r&&r(),!this.isBlocking&&S&&S.resetCachedMaterial()},A=(t,i)=>{this._loadingError=!0,this._errorObject={message:t,exception:i},o&&o(t,i),e.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!v)return this._delayedOnLoad=E,void(this._delayedOnError=A);if(this._texture=v??this._getFromCache(this.url,p,s,this._invertY,_,this.isCube),this._texture)if(this._texture.isReady)iu.SetImmediate((()=>E()));else{const e=this._texture.onLoadedObservable.add(E);this._texture.onErrorObservable.add((t=>{A(t.message,t.exception),this._texture?.onLoadedObservable.remove(e)}))}else if(S&&S.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=E,this._delayedOnError=A;else{try{this._texture=y.createTexture(this.url,p,this._invertY,S,s,E,A,this._buffer,void 0,this._format,this._forcedExtension,f,u,d,_)}catch(e){throw A("error loading",e),e}c&&(this._buffer=null)}}getReflectionTextureMatrix(){const t=this.getScene();if(!t)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==e.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=Lh.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=Lh.Zero());const i=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case e.PLANAR_MODE:Lh.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case e.PROJECTION_MODE:{Lh.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const e=t.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=e.updateFlag,e.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:Lh.IdentityToRef(this._cachedReflectionTextureMatrix)}return i&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedReflectionTextureMatrix}};yp.SerializeBuffers=!0,yp.ForceSerializeBuffers=!1,yp.OnTextureLoadErrorObservable=new Ih,yp._SerializeInternalTextureUniqueId=!1,yp._CubeTextureParser=(e,t,i)=>{throw Qc("CubeTexture")},yp._CreateMirror=(e,t,i,n)=>{throw Qc("MirrorTexture")},yp._CreateRenderTargetTexture=(e,t,i,n,a)=>{throw Qc("RenderTargetTexture")},yp.NEAREST_SAMPLINGMODE=1,yp.NEAREST_NEAREST_MIPLINEAR=8,yp.BILINEAR_SAMPLINGMODE=2,yp.LINEAR_LINEAR_MIPNEAREST=11,yp.TRILINEAR_SAMPLINGMODE=3,yp.LINEAR_LINEAR_MIPLINEAR=3,yp.NEAREST_NEAREST_MIPNEAREST=4,yp.NEAREST_LINEAR_MIPNEAREST=5,yp.NEAREST_LINEAR_MIPLINEAR=6,yp.NEAREST_LINEAR=7,yp.NEAREST_NEAREST=1,yp.LINEAR_NEAREST_MIPNEAREST=9,yp.LINEAR_NEAREST_MIPLINEAR=10,yp.LINEAR_LINEAR=2,yp.LINEAR_NEAREST=12,yp.EXPLICIT_MODE=0,yp.SPHERICAL_MODE=1,yp.PLANAR_MODE=2,yp.CUBIC_MODE=3,yp.PROJECTION_MODE=4,yp.SKYBOX_MODE=5,yp.INVCUBIC_MODE=6,yp.EQUIRECTANGULAR_MODE=7,yp.FIXED_EQUIRECTANGULAR_MODE=8,yp.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,yp.CLAMP_ADDRESSMODE=0,yp.WRAP_ADDRESSMODE=1,yp.MIRROR_ADDRESSMODE=2,yp.UseSerializedUrlIfAny=!1,Lc([Hc()],yp.prototype,"url",void 0),Lc([Hc()],yp.prototype,"uOffset",void 0),Lc([Hc()],yp.prototype,"vOffset",void 0),Lc([Hc()],yp.prototype,"uScale",void 0),Lc([Hc()],yp.prototype,"vScale",void 0),Lc([Hc()],yp.prototype,"uAng",void 0),Lc([Hc()],yp.prototype,"vAng",void 0),Lc([Hc()],yp.prototype,"wAng",void 0),Lc([Hc()],yp.prototype,"uRotationCenter",void 0),Lc([Hc()],yp.prototype,"vRotationCenter",void 0),Lc([Hc()],yp.prototype,"wRotationCenter",void 0),Lc([Hc()],yp.prototype,"homogeneousRotationInUVTransform",void 0),Lc([Hc()],yp.prototype,"isBlocking",null),rh("BABYLON.Texture",yp),Uh._TextureParser=yp.Parse;var Ep=class extends $m{_writeTextureRead(e,t=!1){const i=this.uv;if(t){if(e.target===Lm.Fragment)return;const t=0===e.shaderLanguage?`texture2D(${this._samplerName},`:`textureSampleLevel(${this._samplerName}, ${this._samplerName+"Sampler"},`,n=0===e.shaderLanguage?"":", 0";return void(e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,Om.Vector4)} = ${t} ${i.associatedVariableName}${n});\n`)}const n=0===e.shaderLanguage?`texture2D(${this._samplerName},`:`textureSample(${this._samplerName}, ${this._samplerName+"Sampler"},`;this.uv.ownerBlock.target!==Lm.Fragment?e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,Om.Vector4)} = ${n} ${this._mainUVName});\n`:e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,Om.Vector4)} = ${n} ${i.associatedVariableName});\n`}get rgb(){return this._outputs[1]}getClassName(){return"CurrentScreenBlock"}_writeOutput(e,t,i,n=!1){if(n){if(e.target===Lm.Fragment)return;e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`}else this.uv.ownerBlock.target!==Lm.Fragment?(e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n"):e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`}get b(){return this._outputs[4]}get a(){return this._outputs[5]}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}get uv(){return this._inputs[0]}get target(){return this.uv.isConnected?this.uv.sourceBlock.isInput?Lm.VertexAndFragment:Lm.Fragment:Lm.VertexAndFragment}constructor(e){super(e,Lm.VertexAndFragment),this._samplerName="textureSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",Om.AutoDetect,!1,Lm.VertexAndFragment),this.registerOutput("rgba",Om.Color4,Lm.Neutral),this.registerOutput("rgb",Om.Color3,Lm.Neutral),this.registerOutput("r",Om.Float,Lm.Neutral),this.registerOutput("g",Om.Float,Lm.Neutral),this.registerOutput("b",Om.Float,Lm.Neutral),this.registerOutput("a",Om.Float,Lm.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Om.Vector2|Om.Vector3|Om.Vector4),this._inputs[0]._prioritizeVertex=!1}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}get g(){return this._outputs[3]}get r(){return this._outputs[2]}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=yp.Parse(e.texture,t,i))}initialize(e){e._excludeVariableName(this._samplerName)}_injectVertexCode(e){const t=this.uv;if(t.connectedPoint.ownerBlock.isInput){t.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(t.associatedVariableName,Om.Vector2)}if(this._mainUVName="vMain"+t.associatedVariableName,e._emitVaryingFromString(this._mainUVName,Om.Vector2),e.compilationString+=`${this._mainUVName} = ${t.associatedVariableName}.xy;\n`,this._outputs.some((e=>e.isConnectedInVertexShader))){this._writeTextureRead(e,!0);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name,!0)}}_buildBlock(e){if(super._buildBlock(e),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.blockingBlocks.indexOf(this)<0&&e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.indexOf(this)<0&&e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.indexOf(this)<0&&e.sharedData.blocksWithDefines.push(this),e.target!==Lm.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(!this._outputs.some((e=>e.isConnectedInFragmentShader)))return;e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),this._writeTextureRead(e);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name);return this}get rgba(){return this._outputs[0]}};rh("BABYLON.CurrentScreenBlock",Ep);var Ap=class extends $m{autoConfigure(e,t=(()=>!0)){if(!this.uv.isConnected){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"particle_uv"===e.name&&t(e)));i||(i=new _p("uv"),i.setAsAttribute("particle_uv")),i.output.connectTo(this.uv)}}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=yp.Parse(e.texture,t,i))}get r(){return this._outputs[2]}get rgba(){return this._outputs[0]}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}get b(){return this._outputs[4]}constructor(e){super(e,Lm.Fragment),this._samplerName="diffuseSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",Om.AutoDetect,!1,Lm.VertexAndFragment),this.registerOutput("rgba",Om.Color4,Lm.Neutral),this.registerOutput("rgb",Om.Color3,Lm.Neutral),this.registerOutput("r",Om.Float,Lm.Neutral),this.registerOutput("g",Om.Float,Lm.Neutral),this.registerOutput("b",Om.Float,Lm.Neutral),this.registerOutput("a",Om.Float,Lm.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Om.Vector2|Om.Vector3|Om.Vector4)}getClassName(){return"ParticleTextureBlock"}get rgb(){return this._outputs[1]}_buildBlock(e){if(super._buildBlock(e),e.target===Lm.Vertex)return;this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),e.compilationString+=`${e._declareLocalVar(this._tempTextureRead,Om.Vector4)} = ${e._generateTextureSample(this.uv.associatedVariableName,this._samplerName)};\n`;for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name);return this}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}get uv(){return this._inputs[0]}get g(){return this._outputs[3]}initialize(e){e._excludeVariableName("diffuseSampler")}get a(){return this._outputs[5]}_writeOutput(e,t,i){e.compilationString+=`${e._declareOutput(t)} = ${this._tempTextureRead}.${i};\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n`,e.compilationString+="#endif\n"}};rh("BABYLON.ParticleTextureBlock",Ap);var Cp=class extends $m{get color(){return this._inputs[0]}_buildBlock(e){if(super._buildBlock(e),e.target!==Lm.Vertex)return e._emit2DSampler("rampSampler","RAMPGRADIENT"),e._emitVaryingFromString("remapRanges",Om.Vector4,"RAMPGRADIENT"),e.compilationString+=`\n            #ifdef RAMPGRADIENT\n                ${e._declareLocalVar("baseColor",Om.Vector4)} = ${this.color.associatedVariableName};\n                ${e._declareLocalVar("alpha",Om.Float)} = ${this.color.associatedVariableName}.a;\n\n                ${e._declareLocalVar("remappedColorIndex",Om.Float)} = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);\n\n                ${e._declareLocalVar("rampColor",Om.Vector4)} = ${e._generateTextureSample("vec2(1.0 - remappedColorIndex, 0.)","rampSampler")};\n\n                // Remapped alpha\n                ${e._declareOutput(this.rampColor)} = vec4${e.fSuffix}(baseColor.rgb * rampColor.rgb, clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0));\n            #else\n                ${e._declareOutput(this.rampColor)} = ${this.color.associatedVariableName};\n            #endif\n        `,this}get rampColor(){return this._outputs[0]}getClassName(){return"ParticleRampGradientBlock"}constructor(e){super(e,Lm.Fragment),this._isUnique=!0,this.registerInput("color",Om.Color4,!1,Lm.Fragment),this.registerOutput("rampColor",Om.Color4,Lm.Fragment)}initialize(e){e._excludeVariableName("remapRanges"),e._excludeVariableName("rampSampler"),e._excludeVariableName("baseColor"),e._excludeVariableName("alpha"),e._excludeVariableName("remappedColorIndex"),e._excludeVariableName("rampColor")}};rh("BABYLON.ParticleRampGradientBlock",Cp);var Rp=class extends $m{initialize(e){e._excludeVariableName("sourceAlpha")}get alphaTexture(){return this._inputs[1]}getClassName(){return"ParticleBlendMultiplyBlock"}get blendColor(){return this._outputs[0]}get alphaColor(){return this._inputs[2]}get color(){return this._inputs[0]}_buildBlock(e){if(super._buildBlock(e),e.target!==Lm.Vertex)return e.compilationString+=`\n            #ifdef BLENDMULTIPLYMODE\n                ${e._declareOutput(this.blendColor)};\n                ${e._declareLocalVar("sourceAlpha",Om.Float)}  = ${this.alphaColor.associatedVariableName} * ${this.alphaTexture.associatedVariableName};\n                ${this.blendColor.associatedVariableName} = vec4${e.fSuffix}(${this.color.associatedVariableName}.rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha), ${this.color.associatedVariableName}.a);\n            #else\n                ${e._declareOutput(this.blendColor)} = ${this.color.associatedVariableName};\n            #endif\n        `,this}constructor(e){super(e,Lm.Fragment),this._isUnique=!0,this.registerInput("color",Om.Color4,!1,Lm.Fragment),this.registerInput("alphaTexture",Om.Float,!1,Lm.Fragment),this.registerInput("alphaColor",Om.Float,!1,Lm.Fragment),this.registerOutput("blendColor",Om.Color4,Lm.Fragment)}};rh("BABYLON.ParticleBlendMultiplyBlock",Rp);var Tp=class{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}reduce(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const i=this._mesh.getScene();for(let e=0;e<i.meshes.length;e++){const n=i.meshes[e];if(n.material){if(n.computeBonesUsingShaders&&0!==n.numBoneInfluencers)if(n.material.getEffect()===t)n.computeBonesUsingShaders=!1;else if(n.subMeshes)for(const e of n.subMeshes){if(e.effect===t){n.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&n.computeBonesUsingShaders&&n.numBoneInfluencers>0&&(n.computeBonesUsingShaders=!1)}}else{const t=this._defines[this._currentRank];if(t)for(let i=0;i<t.length;i++)e=e.replace("#define "+t[i],"");this._currentRank++}return e}unBindMesh(){this._mesh=null}addCPUSkinningFallback(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}addFallback(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}};m();var Np=class{get depthStencilTexture(){return this._depthStencilTexture}get height(){return this._size.height||this._size}setLayerAndFaceIndices(e,t){this._layerIndices=e,this._faceIndices=t}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get layers(){return this._size.layers||0}releaseTextures(){if(this._textures)for(let e=0;e<this._textures?.length;++e)this._textures[e].dispose();this._textures=null}setTextures(e){Array.isArray(e)?this._textures=e:this._textures=e?[e]:null}get width(){return this._size.width||this._size}setTexture(e,t=0,i=!0){this._textures||(this._textures=[]),this._textures[t]!==e&&(this._textures[t]&&i&&this._textures[t].dispose(),this._textures[t]=e)}_swapRenderTargetWrapper(e){if(this._textures&&e._textures)for(let t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}createDepthStencilTexture(e=0,t=!0,i=!1,n=1,a=14,s){return this._depthStencilTexture?.dispose(),this._depthStencilTextureWithStencil=i,this._depthStencilTextureLabel=s,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this._isCube,samples:n,depthTextureFormat:a,label:s},this),this._depthStencilTexture}_rebuild(){const e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){const t=this._depthStencilTexture.samplingMode,i=this._depthStencilTexture.format,n=2===t||3===t||11===t;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,n,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,i,this._depthStencilTextureLabel)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}}get is2DArray(){return this.layers>0}dispose(e=!1){e||(this._depthStencilTexture?.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}get texture(){return this._textures?.[0]??null}constructor(e,t,i,n,a){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=e,this._isCube=t,this._size=i,this._engine=n,this._depthStencilTexture=null,this.label=a}get textures(){return this._textures}setLayerAndFaceIndex(e=0,t,i){this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==t&&t>=0&&(this._layerIndices[e]=t),void 0!==i&&i>=0&&(this._faceIndices[e]=i)}get samples(){return this._samples}_cloneRenderTargetWrapper(){let e=null;if(this._isMulti){const t=this.textures;if(t&&t.length>0){let i=!1,n=t.length,a=-1;const s=t[t.length-1]._source;14!==s&&12!==s||(i=!0,a=t[t.length-1].format,n--);const r=[],o=[],l=[],c=[],h=[],f=[],u=[],d={};for(let e=0;e<n;++e){const i=t[e];r.push(i.samplingMode),o.push(i.type),l.push(i.format);void 0!==d[i.xt]?(c.push(-1),u.push(0)):(d[i.xt]=e,i.is2DArray?(c.push(35866),u.push(i.depth)):i.isCube?(c.push(34067),u.push(0)):i.is3D?(c.push(32879),u.push(i.depth)):(c.push(3553),u.push(0))),this._faceIndices&&h.push(this._faceIndices[e]??0),this._layerIndices&&f.push(this._layerIndices[e]??0)}const m={samplingModes:r,generateMipMaps:t[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:i,depthTextureFormat:a,types:o,formats:l,textureCount:n,targetTypes:c,faceIndex:h,layerIndex:f,layerCounts:u,label:this.label},p={width:this.width,height:this.height,depth:this.depth};e=this._engine.createMultipleRenderTarget(p,m);for(let i=0;i<n;++i){if(-1!==c[i])continue;const n=d[t[i].xt];e.setTexture(e.textures[n],i)}}}else{const t={};if(t.generateDepthBuffer=this._generateDepthBuffer,t.generateMipMaps=this.texture?.generateMipMaps??!1,t.generateStencilBuffer=this._generateStencilBuffer,t.samplingMode=this.texture?.samplingMode,t.type=this.texture?.type,t.format=this.texture?.format,t.noColorAttachment=!this._textures,t.label=this.label,this.isCube)e=this._engine.createRenderTargetCubeTexture(this.width,t);else{const i={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?this.texture?.depth:void 0};e=this._engine.createRenderTargetTexture(i,t)}e.texture&&(e.texture.isReady=!0)}return e}shareDepth(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,e._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}get isMulti(){return this._isMulti}get depth(){return this._size.depth||0}_shareDepth(e){this.shareDepth(e)}get layerIndices(){return this._layerIndices}setSamples(e,t=!0,i=!1){if(this.samples===e&&!i)return e;const n=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e);return this._samples=e,n}_swapAndDie(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)}get isCube(){return this._isCube}get faceIndices(){return this._faceIndices}get size(){return this.width}get is3D(){return this.depth>0}},Mp=class extends Np{setTexture(e,t=0,i=!0){super.setTexture(e,t,i),this._bindTextureRenderTarget(e,t)}setLayerAndFaceIndex(e=0,t,i){if(super.setLayerAndFaceIndex(e,t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;const n=this.textures[e];n.is2DArray||n.is3D?this._bindTextureRenderTarget(this.textures[e],e,this.layerIndices[e]):n.isCube&&this._bindTextureRenderTarget(this.textures[e],e,this.faceIndices[e])}_bindTextureRenderTarget(e,t=0,i,n=0){if(!e._hardwareTexture)return;const a=this._framebuffer,s=this._engine,r=s._currentFramebuffer;if(s._bindUnboundFramebuffer(a),s.webGLVersion>1){const a=this._context,s=a["COLOR_ATTACHMENT"+t];e.is2DArray||e.is3D?(i=i??this.layerIndices?.[t]??0,a.framebufferTextureLayer(a.FRAMEBUFFER,s,e._hardwareTexture.underlyingResource,n,i)):e.isCube?(i=i??this.faceIndices?.[t]??0,a.framebufferTexture2D(a.FRAMEBUFFER,s,a.TEXTURE_CUBE_MAP_POSITIVE_X+i,e._hardwareTexture.underlyingResource,n)):a.framebufferTexture2D(a.FRAMEBUFFER,s,a.TEXTURE_2D,e._hardwareTexture.underlyingResource,n)}else{const a=this._context,s=a["COLOR_ATTACHMENT"+t+"_WEBGL"],r=void 0!==i?a.TEXTURE_CUBE_MAP_POSITIVE_X+i:a.TEXTURE_2D;a.framebufferTexture2D(a.FRAMEBUFFER,s,r,e._hardwareTexture.underlyingResource,n)}s._bindUnboundFramebuffer(r)}_cloneRenderTargetWrapper(){let e=null;return this._colorTextureArray&&this._depthStencilTextureArray?(e=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),e.texture.isReady=!0):e=super._cloneRenderTargetWrapper(),e}_swapRenderTargetWrapper(e){super._swapRenderTargetWrapper(e),e._framebuffer=this._framebuffer,e._depthStencilBuffer=this._depthStencilBuffer,e._MSAAFramebuffer=this._MSAAFramebuffer,e._colorTextureArray=this._colorTextureArray,e._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(e=0,t=!0,i=!1,n=1,a=14,s){if(this._depthStencilBuffer){const e=this._engine,t=e._currentFramebuffer,i=this._context;e._bindUnboundFramebuffer(this._framebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,null),e._bindUnboundFramebuffer(t),i.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(e,t,i,n,a,s)}setLayerAndFaceIndices(e,t){if(super.setLayerAndFaceIndices(e,t),!this.textures||!this.layerIndices||!this.faceIndices)return;const i=this._attachments?.length??this.textures.length;for(let e=0;e<i;e++){const t=this.textures[e];t&&(t.is2DArray||t.is3D?this._bindTextureRenderTarget(t,e,this.layerIndices[e]):t.isCube?this._bindTextureRenderTarget(t,e,this.faceIndices[e]):this._bindTextureRenderTarget(t,e))}}dispose(e=this._disposeOnlyFramebuffers){const t=this._context;e||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(e)}shareDepth(e){super.shareDepth(e);const t=this._context,i=this._depthStencilBuffer,n=e._MSAAFramebuffer||e._framebuffer,a=this._engine;e._depthStencilBuffer&&e._depthStencilBuffer!==i&&t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=i;const s=e._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;a._bindUnboundFramebuffer(n),t.framebufferRenderbuffer(t.FRAMEBUFFER,s,t.RENDERBUFFER,i),a._bindUnboundFramebuffer(null)}constructor(e,t,i,n,a){super(e,t,i,n),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=a}};Ed.prototype._createHardwareRenderTargetWrapper=function(e,t,i){const n=new Mp(e,t,i,this,this._gl);return this._renderTargetWrapperCache.push(n),n},Ed.prototype.createRenderTargetTexture=function(e,t){const i=this._createHardwareRenderTargetWrapper(!1,!1,e);let n,a,s=!0,r=!1,o=!1,l=1;void 0!==t&&"object"==typeof t&&(s=t.generateDepthBuffer??!0,r=!!t.generateStencilBuffer,o=!!t.noColorAttachment,n=t.colorAttachment,l=t.samples??1,a=t.label);const c=n||(o?null:this._createInternalTexture(e,t,!0,5)),h=e.width||e,f=e.height||e,u=this._currentFramebuffer,d=this._gl,m=d.createFramebuffer();return this._bindUnboundFramebuffer(m),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(r,s,h,f),!c||c.is2DArray||c.is3D||d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(u),i.label=a??"RenderTargetWrapper",i._framebuffer=m,i._generateDepthBuffer=s,i._generateStencilBuffer=r,i.setTextures(c),this.updateRenderTargetTextureSampleCount(i,l),i},Ed.prototype._createDepthStencilTexture=function(e,t){const i=this._gl,n=e.layers||0,a=e.depth||0;let s=i.TEXTURE_2D;0!==n?s=i.TEXTURE_2D_ARRAY:0!==a&&(s=i.TEXTURE_3D);const r=new Cu(this,12);if(r.label=t.label,!this._caps.depthTextureExtension)return jh.Error("Depth texture is not supported by your browser or hardware."),r;const o={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t};if(this._bindTextureDirectly(s,r,!0),this._setupDepthStencilTexture(r,e,o.generateStencil,0!==o.comparisonFunction&&o.bilinearFiltering,o.comparisonFunction,o.samples),void 0!==o.depthTextureFormat){if(15!==o.depthTextureFormat&&16!==o.depthTextureFormat&&17!==o.depthTextureFormat&&13!==o.depthTextureFormat&&14!==o.depthTextureFormat&&18!==o.depthTextureFormat)return jh.Error("Depth texture format is not supported."),r;r.format=o.depthTextureFormat}else r.format=o.generateStencil?13:16;const l=17===r.format||13===r.format||18===r.format;let c=i.UNSIGNED_INT;15===r.format?c=i.UNSIGNED_SHORT:17===r.format||13===r.format?c=i.UNSIGNED_INT_24_8:14===r.format?c=i.FLOAT:18===r.format&&(c=i.FLOAT_32_UNSIGNED_INT_24_8_REV);const h=l?i.DEPTH_STENCIL:i.DEPTH_COMPONENT;let f=h;return this.webGLVersion>1&&(15===r.format?f=i.DEPTH_COMPONENT16:16===r.format?f=i.DEPTH_COMPONENT24:17===r.format||13===r.format?f=i.DEPTH24_STENCIL8:14===r.format?f=i.DEPTH_COMPONENT32F:18===r.format&&(f=i.DEPTH32F_STENCIL8)),r.is2DArray?i.texImage3D(s,0,f,r.width,r.height,n,0,h,c,null):r.is3D?i.texImage3D(s,0,f,r.width,r.height,a,0,h,c,null):i.texImage2D(s,0,f,r.width,r.height,0,h,c,null),this._bindTextureDirectly(s,null),this._internalTexturesCache.push(r),r},Ed.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e||!e.texture)return 1;if(e.samples===t)return t;const i=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);const n=e.texture._hardwareTexture;if(n.releaseMSAARenderBuffers(),t>1&&"function"==typeof i.renderbufferStorageMultisample){const a=i.createFramebuffer();if(!a)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=a,this._bindUnboundFramebuffer(e._MSAAFramebuffer);const s=this._createRenderBuffer(e.texture.width,e.texture.height,t,-1,this._getRGBABufferInternalSizedFormat(e.texture.type,e.texture.format,e.texture._useSRGBBuffer),i.COLOR_ATTACHMENT0,!1);if(!s)throw new Error("Unable to create multi sampled framebuffer");n.addMSAARenderBuffer(s)}else this._bindUnboundFramebuffer(e._framebuffer);return e.texture.samples=t,e._samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.texture.width,e.texture.height,t),this._bindUnboundFramebuffer(null),t},Ed.prototype._setupDepthStencilTexture=function(e,t,i,n,a,s=1){const r=t.width||t,o=t.height||t,l=t.layers||0,c=t.depth||0;e.baseWidth=r,e.baseHeight=o,e.width=r,e.height=o,e.is2DArray=l>0,e.depth=l||c,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=n?2:1,e.type=0,e._comparisonFunction=a;const h=this._gl,f=this._getTextureTarget(e),u=this._getSamplingParameters(e.samplingMode,!1);h.texParameteri(f,h.TEXTURE_MAG_FILTER,u.mag),h.texParameteri(f,h.TEXTURE_MIN_FILTER,u.min),h.texParameteri(f,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(f,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===a?(h.texParameteri(f,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(f,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(f,h.TEXTURE_COMPARE_FUNC,a),h.texParameteri(f,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE)))},Tu.prototype.setTextureFromPostProcess=function(e,t,i){let n=null;t&&(t._forcedOutputTexture?n=t._forcedOutputTexture:t._textures.data[t._currentRenderTextureInd]&&(n=t._textures.data[t._currentRenderTextureInd])),this._bindTexture(e,n?.texture??null,i)},Tu.prototype.setTextureFromPostProcessOutput=function(e,t,i){this._bindTexture(e,t?._outputTexture?.texture??null,i)},pu.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},pu.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)};var Ip=class e{_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}serialize(){const e=Uh.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e}get samples(){return this._samples}_disposeTextureCache(){for(let e=this._textureCache.length-1;e>=0;e--)this._textureCache[e].texture.dispose();this._textureCache.length=0}markTextureDirty(){this.width=-1}static RegisterShaderCodeProcessing(t,i){i?e._CustomShaderCodeProcessing[t??""]=i:delete e._CustomShaderCodeProcessing[t??""]}resize(e,t,i=null,n=!1,a=!1){this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;let s=null;if(i)for(let e=0;e<i._postProcesses.length;e++)if(null!==i._postProcesses[e]){s=i._postProcesses[e];break}const r={width:this.width,height:this.height},o={generateMipMaps:n,generateDepthBuffer:a||s===this,generateStencilBuffer:(a||s===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(r,o,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(r,o,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}isReusable(){return this._reusable}_createRenderTargetTexture(e,t,i=0){for(let n=0;n<this._textureCache.length;n++)if(this._textureCache[n].texture.width===e.width&&this._textureCache[n].texture.height===e.height&&this._textureCache[n].postProcessChannel===i&&this._textureCache[n].texture._generateDepthBuffer===t.generateDepthBuffer&&this._textureCache[n].texture.samples===t.samples)return this._textureCache[n].texture;const n=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:n,postProcessChannel:i,lastUsedRenderId:-1}),n}static _Parse(t,i,n,a){return Uh.Parse((()=>new e(t.name,t.fragmentUrl,t.parameters,t.samplers,t.options,i,t.renderTargetSamplingMode,t._engine,t.reusable,t.defines,t.textureType,t.vertexUrl,t.indexParameters,!1,t.textureFormat)),t,n,a)}set onActivate(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))}shareOutputWith(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this}get isSupported(){return!this._shadersLoaded||this._drawWrapper.effect.isSupported}_flushTextureCache(){const e=this._renderId;for(let t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){let e=!1;for(let i=0;i<this._textures.length;i++)if(this._textures.data[i]===this._textureCache[t].texture){e=!0;break}e||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}}getEffectName(){return this._fragmentUrl}constructor(e,t,i,n,a,s,r=1,o,l,c=null,h=0,f="postprocess",u,d=!1,m=5,p,_){this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.alphaMode=0,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._shadersLoaded=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new rd(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new Ph(1,1),this._texelSize=Ph.Zero(),this.onEffectCreatedObservable=new Ih(void 0,!0),this.onActivateObservable=new Ih,this.onSizeChangedObservable=new Ih,this.onApplyObservable=new Ih,this.onBeforeRenderObservable=new Ih,this.onAfterRenderObservable=new Ih,this._onInitShadersDone=null,this.name=e;let v=1,g=null;if(i&&!Array.isArray(i)){const e=i;i=e.uniforms??null,n=e.samplers??null,v=e.size??1,s=e.camera??null,r=e.samplingMode??1,o=e.engine,l=e.reusable,c=e.defines??null,h=e.textureType??0,f=e.vertexUrl??"postprocess",u=e.indexParameters,d=e.blockCompilation??!1,m=e.textureFormat??5,p=e.shaderLanguage??0,g=e.uniformBuffers??null}else a&&(v="number"==typeof a?a:{width:a.width,height:a.height});null!=s?(this._camera=s,this._scene=s.getScene(),s.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.xt=this._scene.getUniqueId()):o&&(this._engine=o,this._engine.postProcesses.push(this)),this._options=v,this.renderTargetSamplingMode=r||1,this._reusable=l||!1,this._textureType=h,this._textureFormat=m,this._shaderLanguage=p||0,this._samplers=n||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=f,this._parameters=i||[],this._parameters.push("scale"),this._uniformBuffers=g||[],this._indexParameters=u,this._drawWrapper=new df(this._engine),this._webGPUReady=1===this._shaderLanguage,this._postConstructor(d,c,_)}updateEffect(t=null,i=null,n=null,a,s,r,o,l){if(!this._shadersLoaded)return void(this._onInitShadersDone=()=>{this._shadersLoaded=!0,this._onInitShadersDone=null,this.updateEffect(t,i,n,a,s,r,o,l)});const c=e._GetShaderCodeProcessing(this.name);if(c?.defineCustomBindings){const e=i?.slice()??[];e.push(...this._parameters);const a=n?.slice()??[];a.push(...this._samplers),t=c.defineCustomBindings(this.name,t,e,a),i=e,n=a}this._postProcessDefines=t,this._drawWrapper.effect=this._engine.createEffect({vertex:o??this._vertexUrl,fragment:l??this._fragmentUrl},{attributes:["position"],uniformsNames:i||this._parameters,uniformBuffersNames:this._uniformBuffers,samplers:n||this._samplers,defines:null!==t?t:"",fallbacks:null,onCompiled:s??null,onError:r??null,indexParameters:a||this._indexParameters,processCodeAfterIncludes:c?.processCodeAfterIncludes?(e,t)=>c.processCodeAfterIncludes(this.name,e,t):null,processFinalCode:c?.processFinalCode?(e,t)=>c.processFinalCode(this.name,e,t):null,shaderLanguage:this._shaderLanguage},this._engine),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}getClassName(){return"PostProcess"}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}_getTarget(){let e;if(this._shareOutputWithPostProcess)e=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)e=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let t;e=this.inputTexture;for(let i=0;i<this._textureCache.length;i++)if(this._textureCache[i].texture===e){t=this._textureCache[i];break}t&&(t.lastUsedRenderId=this._renderId)}return e}set samples(e){this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach((e=>{e.setSamples(this._samples)}))}getCamera(){return this._camera}get shaderLanguage(){return this._shaderLanguage}getEngine(){return this._engine}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onApply(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)}set inputTexture(e){this._forcedOutputTexture=e}getEffect(){return this._drawWrapper.effect}static _GetShaderCodeProcessing(t){return e._CustomShaderCodeProcessing[t]??e._CustomShaderCodeProcessing[""]}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}async _postConstructor(t,i=null,n){const a=this.getEngine().isWebGPU&&!e.ForceGLSL;await this._initShaderSourceAsync(a),n&&await n(a),a&&this._webGPUReady&&(this._shaderLanguage=1),this._onInitShadersDone?this._onInitShadersDone():(this._shadersLoaded=!0,t||this.updateEffect(i))}setPrePassRenderer(e){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}useOwnOutput(){0==this._textures.length&&(this._textures=new rd(2)),this._shareOutputWithPostProcess=null}async _initShaderSourceAsync(e=!1){e&&this._webGPUReady?await Promise.all([Promise.resolve().then((()=>(S(),p)))]):await Promise.all([Promise.resolve().then((()=>(m(),h)))]),this._shadersLoaded=!0}set onSizeChanged(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)}clone(){const t=this.serialize();t._engine=this._engine,t.cameraId=null;const i=e.Parse(t,this._scene,"");return i?(i.onActivateObservable=this.onActivateObservable.clone(),i.onSizeChangedObservable=this.onSizeChangedObservable.clone(),i.onApplyObservable=this.onApplyObservable.clone(),i.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),i.onAfterRenderObservable=this.onAfterRenderObservable.clone(),i._prePassEffectConfiguration=this._prePassEffectConfiguration,i):null}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}activate(e,t=null,i){const n=(e=e||this._camera).getScene(),a=n.getEngine(),s=a.getCaps().maxTextureSize,r=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,o=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0;let l=this._options.width||r,c=this._options.height||o;const h=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let f=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const e=a.currentViewport;e&&(l*=e.width,c*=e.height)}(h||this.alwaysForcePOT)&&(this._options.width||(l=a.needPOTTextures?nd(l,s,this.scaleMode):l),this._options.height||(c=a.needPOTTextures?nd(c,s,this.scaleMode):c)),this.width===l&&this.height===c&&(f=this._getTarget())||this.resize(l,c,e,h,i),this._textures.forEach((e=>{e.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(e,this.samples)})),this._flushTextureCache(),this._renderId++}return f||(f=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(r/l,o/c),this._engine.bindFramebuffer(f,0,r,o,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(f,0,void 0,void 0,this.forceFullscreenViewport)),this._engine._debugInsertMarker?.(`post process ${this.name} input`),this.onActivateObservable.notifyObservers(e),this.autoClear&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:n.clearColor,n._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),f}apply(){if(!this._drawWrapper.effect?.isReady())return null;let t;return this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),t=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",t?.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),e._GetShaderCodeProcessing(this.name)?.bindCustomBindings?.(this.name,this._drawWrapper.effect),this._drawWrapper.effect}dispose(e){let t;if(e=e||this._camera,this._disposeTextures(),this._scene&&(t=this._scene.postProcesses.indexOf(this),-1!==t&&this._scene.postProcesses.splice(t,1)),this._parentContainer){const e=this._parentContainer.postProcesses.indexOf(this);e>-1&&this._parentContainer.postProcesses.splice(e,1),this._parentContainer=null}if(t=this._engine.postProcesses.indexOf(this),-1!==t&&this._engine.postProcesses.splice(t,1),e){if(e.detachPostProcess(this),t=e._postProcesses.indexOf(this),0===t&&e._postProcesses.length>0){const e=this._camera._getFirstPostProcess();e&&e.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}static Parse(e,t,i){const n=oh(e.customType);if(!n||!n._Parse)return null;const a=t?t.getCameraById(e.cameraId):null;return n._Parse(e,a,t,i)}isReady(){return!!this._shadersLoaded&&(this._drawWrapper.effect?.isReady()??!1)}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}};Ip.ForceGLSL=!1,Ip._CustomShaderCodeProcessing={},Lc([Hc()],Ip.prototype,"uniqueId",void 0),Lc([Hc()],Ip.prototype,"name",void 0),Lc([Hc()],Ip.prototype,"width",void 0),Lc([Hc()],Ip.prototype,"height",void 0),Lc([Hc()],Ip.prototype,"renderTargetSamplingMode",void 0),Lc([Kc()],Ip.prototype,"clearColor",void 0),Lc([Hc()],Ip.prototype,"autoClear",void 0),Lc([Hc()],Ip.prototype,"forceAutoClearInAlphaMode",void 0),Lc([Hc()],Ip.prototype,"alphaMode",void 0),Lc([Hc()],Ip.prototype,"alphaConstants",void 0),Lc([Hc()],Ip.prototype,"enablePixelPerfectMode",void 0),Lc([Hc()],Ip.prototype,"forceFullscreenViewport",void 0),Lc([Hc()],Ip.prototype,"scaleMode",void 0),Lc([Hc()],Ip.prototype,"alwaysForcePOT",void 0),Lc([Hc("samples")],Ip.prototype,"_samples",void 0),Lc([Hc()],Ip.prototype,"adaptScaleToCurrentViewport",void 0),rh("BABYLON.PostProcess",Ip);var xp=class extends $m{serialize(){const e=super.serialize();return e.xSwizzle=this.xSwizzle,e.ySwizzle=this.ySwizzle,e.zSwizzle=this.zSwizzle,e.wSwizzle=this.wSwizzle,e}constructor(e){super(e,Lm.Neutral),this.xSwizzle="x",this.ySwizzle="y",this.zSwizzle="z",this.wSwizzle="w",this.registerInput("xyzw ",Om.Vector4,!0),this.registerInput("xyz ",Om.Vector3,!0),this.registerInput("xy ",Om.Vector2,!0),this.registerInput("zw ",Om.Vector2,!0),this.registerInput("x",Om.Float,!0),this.registerInput("y",Om.Float,!0),this.registerInput("z",Om.Float,!0),this.registerInput("w",Om.Float,!0),this.registerOutput("xyzw",Om.Vector4),this.registerOutput("xyz",Om.Vector3),this.registerOutput("xy",Om.Vector2),this.registerOutput("zw",Om.Vector2)}get zwOut(){return this._outputs[3]}_deserialize(e,t,i){super._deserialize(e,t,i),this.xSwizzle=e.xSwizzle??"x",this.ySwizzle=e.ySwizzle??"y",this.zSwizzle=e.zSwizzle??"z",this.wSwizzle=e.wSwizzle??"w"}get xyzOut(){return this._outputs[1]}_buildBlock(e){super._buildBlock(e);const t=this.x,i=this.y,n=this.z,a=this.w,s=this.xyIn,r=this.zwIn,o=this.xyzIn,l=this.xyzwIn,c=this._outputs[0],h=this._outputs[1],f=this._outputs[2],u=this._outputs[3],d=e._getShaderType(Om.Vector4),m=e._getShaderType(Om.Vector3),p=e._getShaderType(Om.Vector2);return l.isConnected?(c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${l.associatedVariableName}${this._buildSwizzle(4)};\n`),h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${l.associatedVariableName}${this._buildSwizzle(3)};\n`),f.hasEndpoints&&(e.compilationString+=e._declareOutput(f)+` = ${l.associatedVariableName}${this._buildSwizzle(2)};\n`)):o.isConnected?(c.hasEndpoints&&(e.compilationString+=e._declareOutput(c)+` = ${d}(${o.associatedVariableName}, ${a.isConnected?this._writeVariable(a):"0.0"})${this._buildSwizzle(4)};\n`),h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${o.associatedVariableName}${this._buildSwizzle(3)};\n`),f.hasEndpoints&&(e.compilationString+=e._declareOutput(f)+` = ${o.associatedVariableName}${this._buildSwizzle(2)};\n`)):s.isConnected?(c.hasEndpoints&&(r.isConnected?e.compilationString+=e._declareOutput(c)+` = ${d}(${s.associatedVariableName}, ${r.associatedVariableName})${this._buildSwizzle(4)};\n`:e.compilationString+=e._declareOutput(c)+` = ${d}(${s.associatedVariableName}, ${n.isConnected?this._writeVariable(n):"0.0"}, ${a.isConnected?this._writeVariable(a):"0.0"})${this._buildSwizzle(4)};\n`),h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${m}(${s.associatedVariableName}, ${n.isConnected?this._writeVariable(n):"0.0"})${this._buildSwizzle(3)};\n`),f.hasEndpoints&&(e.compilationString+=e._declareOutput(f)+` = ${s.associatedVariableName}${this._buildSwizzle(2)};\n`),u.hasEndpoints&&(r.isConnected?e.compilationString+=e._declareOutput(u)+` = ${r.associatedVariableName}${this._buildSwizzle(2)};\n`:e.compilationString+=e._declareOutput(u)+` = ${p}(${n.isConnected?this._writeVariable(n):"0.0"}, ${a.isConnected?this._writeVariable(a):"0.0"})${this._buildSwizzle(2)};\n`)):(c.hasEndpoints&&(r.isConnected?e.compilationString+=e._declareOutput(c)+` = ${d}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${r.associatedVariableName})${this._buildSwizzle(4)};\n`:e.compilationString+=e._declareOutput(c)+` = ${d}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${n.isConnected?this._writeVariable(n):"0.0"}, ${a.isConnected?this._writeVariable(a):"0.0"})${this._buildSwizzle(4)};\n`),h.hasEndpoints&&(e.compilationString+=e._declareOutput(h)+` = ${m}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"}, ${n.isConnected?this._writeVariable(n):"0.0"})${this._buildSwizzle(3)};\n`),f.hasEndpoints&&(e.compilationString+=e._declareOutput(f)+` = ${p}(${t.isConnected?this._writeVariable(t):"0.0"}, ${i.isConnected?this._writeVariable(i):"0.0"})${this._buildSwizzle(2)};\n`),u.hasEndpoints&&(r.isConnected?e.compilationString+=e._declareOutput(u)+` = ${r.associatedVariableName}${this._buildSwizzle(2)};\n`:e.compilationString+=e._declareOutput(u)+` = ${p}(${n.isConnected?this._writeVariable(n):"0.0"}, ${a.isConnected?this._writeVariable(a):"0.0"})${this._buildSwizzle(2)};\n`)),this}get xyOut(){return this._outputs[2]}get xyz(){return this.xyzOut}_buildSwizzle(e){return"."+(this.xSwizzle+this.ySwizzle+this.zSwizzle+this.wSwizzle).substr(0,e)}getClassName(){return"VectorMergerBlock"}_inputRename(e){return"xyzw "===e?"xyzwIn":"xyz "===e?"xyzIn":"xy "===e?"xyIn":"zw "===e?"zwIn":e}get xyzwIn(){return this._inputs[0]}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.xSwizzle = "${this.xSwizzle}";\n`,e+=`${this._codeVariableName}.ySwizzle = "${this.ySwizzle}";\n`,e+=`${this._codeVariableName}.zSwizzle = "${this.zSwizzle}";\n`,e+=`${this._codeVariableName}.wSwizzle = "${this.wSwizzle}";\n`,e}get xyzw(){return this._outputs[0]}get zwIn(){return this._inputs[3]}get xy(){return this.xyOut}get w(){return this._inputs[7]}get x(){return this._inputs[4]}get z(){return this._inputs[6]}get xyIn(){return this._inputs[2]}get xyzIn(){return this._inputs[1]}get y(){return this._inputs[5]}};rh("BABYLON.VectorMergerBlock",xp);var bp=class extends $m{get input(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"RemapBlock"}get targetMax(){return this._inputs[4]}get sourceMax(){return this._inputs[2]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),n=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),a=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),s=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return e.compilationString+=e._declareOutput(t)+` = ${a} + (${this._inputs[0].associatedVariableName} - ${i}) * (${s} - ${a}) / (${n} - ${i});\n`,this}get targetMin(){return this._inputs[3]}serialize(){const e=super.serialize();return e.sourceRange=this.sourceRange.asArray(),e.targetRange=this.targetRange.asArray(),e}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.sourceRange = new BABYLON.Vector2(${this.sourceRange.x}, ${this.sourceRange.y});\n`;return e+=`${this._codeVariableName}.targetRange = new BABYLON.Vector2(${this.targetRange.x}, ${this.targetRange.y});\n`,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.sourceRange=Ph.FromArray(e.sourceRange),this.targetRange=Ph.FromArray(e.targetRange)}constructor(e){super(e,Lm.Neutral),this.sourceRange=new Ph(-1,1),this.targetRange=new Ph(0,1),this.registerInput("input",Om.AutoDetect),this.registerInput("sourceMin",Om.Float,!0),this.registerInput("sourceMax",Om.Float,!0),this.registerInput("targetMin",Om.Float,!0),this.registerInput("targetMax",Om.Float,!0),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}get sourceMin(){return this._inputs[1]}};Lc([ep("From",3)],bp.prototype,"sourceRange",void 0),Lc([ep("To",3)],bp.prototype,"targetRange",void 0),rh("BABYLON.RemapBlock",bp);var Pp,wp,Op=class extends $m{_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Om.Int||this.left.type===Om.Float&&this.right.type!==Om.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[e,t]of[[this.left,this.right],[this.right,this.left]])e.acceptedConnectionPointTypes=[Om.Int,Om.Float],t.isConnected&&(e.acceptedConnectionPointTypes.push(t.type),t.type!==Om.Int&&t.type!==Om.Float||e.acceptedConnectionPointTypes.push(Om.Vector2,Om.Vector3,Om.Vector4,Om.Color3,Om.Color4,Om.Matrix))}get left(){return this._inputs[0]}get output(){return this._outputs[0]}get right(){return this._inputs[1]}dispose(){super.dispose(),this._connectionObservers.forEach((e=>e.remove())),this._connectionObservers.length=0}constructor(e){super(e,Lm.Neutral),this.registerInput("left",Om.AutoDetect),this.registerInput("right",Om.AutoDetect),this.registerOutput("output",Om.BasedOnInput),this.output._typeConnectionSource=this.left,this._linkConnectionTypes(0,1,!0),this.left.acceptedConnectionPointTypes.push(Om.Float),this.right.acceptedConnectionPointTypes.push(Om.Float),this._connectionObservers=[this.left.onTypeChangedObservable.add((()=>this._updateInputOutputTypes())),this.right.onTypeChangedObservable.add((()=>this._updateInputOutputTypes()))]}},Dp=class extends Op{constructor(e){super(e)}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} * ${this.right.associatedVariableName};\n`,this}getClassName(){return"MultiplyBlock"}};rh("BABYLON.MultiplyBlock",Dp),(wp=Pp||(Pp={}))[wp.Material=0]="Material",wp[wp.PostProcess=1]="PostProcess",wp[wp.Particle=2]="Particle",wp[wp.ProceduralTexture=3]="ProceduralTexture";var Lp=class extends Ym{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}},Fp=class e{get isBillboardBased(){return this._isBillboardBased}set minEmitBox(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)}createDirectedConeEmitter(e=1,t=Math.PI/4,i=new wh(0,1,0),n=new wh(0,1,0)){throw new Error("Method not implemented.")}_removeGradientAndTexture(e,t,i){if(!t)return this;let n=0;for(const i of t){if(i.gradient===e){t.splice(n,1);break}n++}return i&&i.dispose(),this}getSizeGradients(){return this._sizeGradients}set noiseTexture(e){this._noiseTexture!==e&&(this._noiseTexture=e,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}createDirectedSphereEmitter(e=1,t=new wh(0,1,0),i=new wh(0,1,0)){throw new Error("Method not implemented.")}set isAnimationSheetEnabled(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())}getAngularSpeedGradients(){return this._angularSpeedGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getStartSizeGradients(){return this._startSizeGradients}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(!e&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=e)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:wh.Zero()}getEmitRateGradients(){return this._emitRateGradients}createConeEmitter(e=1,t=Math.PI/4){throw new Error("Method not implemented.")}get useLogarithmicDepth(){return this._useLogarithmicDepth}set maxEmitBox(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)}createCylinderEmitter(e=1,t=1,i=1,n=0){throw new Error("Method not implemented.")}createHemisphericEmitter(e=1,t=1){throw new Error("Method not implemented.")}getLimitVelocityGradients(){return this._limitVelocityGradients}getVelocityGradients(){return this._velocityGradients}createPointEmitter(e,t){throw new Error("Method not implemented.")}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}getDragGradients(){return this._dragGradients}getScene(){return this._scene}createDirectedCylinderEmitter(e=1,t=1,i=1,n=new wh(0,1,0),a=new wh(0,1,0)){throw new Error("Method not implemented.")}set direction1(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)}get noiseTexture(){return this._noiseTexture}set isBillboardBased(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:wh.Zero()}_reset(){}constructor(t){this.animations=[],this.Ct=0,this.emitter=wh.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new wh(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Ph(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new wh(0,0,0),this._useLogarithmicDepth=!1,this.gravity=wh.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Ch(1,1,1,1),this.color2=new Ch(1,1,1,1),this.colorDead=new Ch(0,0,0,1),this.textureMask=new Ch(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Lp,this.id=t,this.name=t}set useLogarithmicDepth(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:wh.Zero()}createBoxEmitter(e,t,i,n){throw new Error("Method not implemented.")}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._reset())}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:wh.Zero()}set direction2(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)}getColorRemapGradients(){return this._colorRemapGradients}get billboardMode(){return this._billboardMode}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e)}createSphereEmitter(e=1,t=1){throw new Error("Method not implemented.")}getLifeTimeGradients(){return this._lifeTimeGradients}getColorGradients(){return this._colorGradients}};Fp.BLENDMODE_ONEONE=0,Fp.BLENDMODE_STANDARD=1,Fp.BLENDMODE_ADD=2,Fp.BLENDMODE_MULTIPLY=3,Fp.BLENDMODE_MULTIPLYADD=4,rh("BABYLON.BaseParticleSystem",Fp);var kp=class extends $m{get rgba(){return this._inputs[0]}_inputRename(e){return"rgb "===e?"rgbIn":e}get r(){return this._outputs[1]}get b(){return this._outputs[3]}constructor(e){super(e,Lm.Neutral),this.registerInput("rgba",Om.Color4,!0),this.registerInput("rgb ",Om.Color3,!0),this.registerOutput("rgb",Om.Color3),this.registerOutput("r",Om.Float),this.registerOutput("g",Om.Float),this.registerOutput("b",Om.Float),this.registerOutput("a",Om.Float),this.inputsAreExclusive=!0}get a(){return this._outputs[4]}getClassName(){return"ColorSplitterBlock"}get rgbOut(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this.rgba.isConnected?this.rgba:this.rgbIn;if(!t.isConnected)return;const i=this._outputs[0],n=this._outputs[1],a=this._outputs[2],s=this._outputs[3],r=this._outputs[4];return i.hasEndpoints&&(e.compilationString+=e._declareOutput(i)+` = ${t.associatedVariableName}.rgb;\n`),n.hasEndpoints&&(e.compilationString+=e._declareOutput(n)+` = ${t.associatedVariableName}.r;\n`),a.hasEndpoints&&(e.compilationString+=e._declareOutput(a)+` = ${t.associatedVariableName}.g;\n`),s.hasEndpoints&&(e.compilationString+=e._declareOutput(s)+` = ${t.associatedVariableName}.b;\n`),r.hasEndpoints&&(e.compilationString+=e._declareOutput(r)+` = ${t.associatedVariableName}.a;\n`),this}get rgbIn(){return this._inputs[1]}get g(){return this._outputs[2]}_outputRename(e){return"rgb"===e?"rgbOut":e}};rh("BABYLON.ColorSplitterBlock",kp);var Bp=class{_buildIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}_finalizeFrame(e,t,i,n,a=!1){const s=this._scene.activeCamera;if(!s)return;if(0===(n=n||s._postProcesses.filter((e=>null!=e))).length||!this._scene.postProcessesEnabled)return;const r=this._scene.getEngine();for(let o=0,l=n.length;o<l;o++){const c=n[o];if(o<l-1?c._outputTexture=n[o+1].activate(s,t?.texture):(t?(r.bindFramebuffer(t,i,void 0,void 0,a),c._outputTexture=t):(r.restoreDefaultFramebuffer(),c._outputTexture=null),r._debugInsertMarker?.(`post process ${n[o].name} output`)),e)break;const h=c.apply();h&&(c.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,h),r.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(h))}r.setDepthBuffer(!0),r.setDepthWrite(!0),r.setAlphaMode(0)}_prepareBuffers(){if(this._vertexBuffers[$h.PositionKind])return;const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[$h.PositionKind]=new $h(this._scene.getEngine(),e,$h.PositionKind,!1,!1,2),this._buildIndexBuffer()}directRender(e,t=null,i=!1,n=0,a=0,s=!1){const r=this._scene.getEngine();for(let o=0;o<e.length;o++){o<e.length-1?e[o+1].activate(this._scene.activeCamera,t?.texture):(t?r.bindFramebuffer(t,n,void 0,void 0,i,a):s||r.restoreDefaultFramebuffer(),r._debugInsertMarker?.(`post process ${e[o].name} output`));const l=e[o],c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,c),r.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(c))}r.setDepthBuffer(!0),r.setDepthWrite(!0)}constructor(e){this._vertexBuffers={},this._scene=e}_prepareFrame(e=null,t=null){const i=this._scene.activeCamera;return!!i&&(!(!(t=t||i._postProcesses.filter((e=>null!=e)))||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(i,e,null!=t),!0))}dispose(){const e=this._vertexBuffers[$h.PositionKind];e&&(e.dispose(),this._vertexBuffers[$h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}_rebuild(){const e=this._vertexBuffers[$h.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}},Gp=class e{_renderParticles(e){if(0===this._particleSystems.length)return;const t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const n=this._particleSystems.data[i];if(0===(t&&t.layerMask&n.layerMask))continue;const a=n.emitter;a.position&&e&&-1===e.indexOf(a)||this._scene._activeParticles.addCount(n.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}render(e,t,i,n){if(e)return void e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const a=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(a.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),a.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const s=a.getStencilBuffer();if(a.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(a.setStencilBuffer(s),this._scene.useOrderIndependentTransparency){const e=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);e.length&&this._renderTransparent(e)}else this._renderTransparent(this._transparentSubMeshes);a.setAlphaMode(0)}if(a.setStencilBuffer(!1),this._edgesRenderers.length){for(let e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();a.setAlphaMode(0)}a.setStencilBuffer(s)}static _RenderSorted(t,i,n,a){let s,r=0;const o=n?n.globalPosition:e._ZeroVector;if(a)for(;r<t.length;r++)s=t.data[r],s._alphaIndex=s.getMesh().alphaIndex,s._distanceToCamera=wh.Distance(s.getBoundingInfo().boundingSphere.centerWorld,o);const l=t.length===t.data.length?t.data:t.data.slice(0,t.length);i&&l.sort(i);const c=l[0].getMesh().getScene();for(r=0;r<l.length;r++)if(s=l[r],!c._activeMeshesFrozenButKeepClipping||s.isInFrustum(c._frustumPlanes)){if(a){const e=s.getMaterial();if(e&&e.needDepthPrePass){const t=e.getScene().getEngine();t.setColorWrite(!1),t.setAlphaMode(0),s.render(!1),t.setColorWrite(!0)}}s.render(a)}}constructor(e,t,i=null,n=null,a=null){this.index=e,this._opaqueSubMeshes=new rd(256),this._transparentSubMeshes=new rd(256),this._alphaTestSubMeshes=new rd(256),this._depthOnlySubMeshes=new rd(256),this._particleSystems=new rd(256),this._spriteManagers=new rd(256),this._empty=!0,this._edgesRenderers=new od(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=a}set alphaTestSortCompareFn(t){this._alphaTestSortCompareFn=t||e.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}prepareSprites(){this._spriteManagers.reset()}static defaultTransparentSortCompare(t,i){return t._alphaIndex>i._alphaIndex?1:t._alphaIndex<i._alphaIndex?-1:e.backToFrontSortCompare(t,i)}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),void 0===i&&(i=e.getMaterial()),null!=i&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t.isEnabled()&&t.isVisible&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}set opaqueSortCompareFn(t){this._opaqueSortCompareFn=t||e.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}static backToFrontSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}_renderAlphaTestSorted(t){e._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderOpaqueSorted(t){e._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}set transparentSortCompareFn(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}static frontToBackSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}_renderTransparentSorted(t){e._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){const i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}static PainterSortCompare(e,t){const i=e.getMesh(),n=t.getMesh();return i.material&&n.material?i.material.xt-n.material.xt:i.xt-n.xt}};Gp._ZeroVector=wh.Zero();var Up=class{},Hp=class e{getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}setRenderingAutoClearDepthStencil(e,t,i=!0,n=!0){this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:n}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}resetSprites(){if(!this.maintainStateBetweenFrames)for(let t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){const e=this._renderingGroups[t];e&&e.prepareSprites()}}_prepareRenderingGroup(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new Gp(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}_clearDepthStencilBuffer(e=!0,t=!0){this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}reset(){if(!this.maintainStateBetweenFrames)for(let t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){const e=this._renderingGroups[t];e&&e.prepare()}}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.Ct).dispatchSprites(e))}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(t.Ct).dispatch(e,t,i))}freeRenderingGroups(){for(let t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){const e=this._renderingGroups[t];e&&e.dispose()}}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.Ct).dispatchParticles(e))}restoreDispachedFlags(){for(const e of this._scene.meshes)if(e.subMeshes)for(const t of e.subMeshes)t._wasDispatched=!1;if(this._scene.spriteManagers)for(const e of this._scene.spriteManagers)e._wasDispatched=!1;for(const e of this._scene.particleSystems)e._wasDispatched=!1}getRenderingGroup(e){const t=e||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}render(t,i,n,a){const s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&a)for(let e=0;e<this._scene.spriteManagers.length;e++){const t=this._scene.spriteManagers[e];this.dispatchSprites(t)}for(let r=e.MIN_RENDERINGGROUPS;r<e.MAX_RENDERINGGROUPS;r++){this._depthStencilBufferAlreadyCleaned=r===e.MIN_RENDERINGGROUPS;const o=this._renderingGroups[r];if(!o||o._empty)continue;const l=1<<r;if(s.Ct=r,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,l),e.AUTOCLEAR){const e=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(r):this._autoClearDepthStencil[r];e&&e.autoClear&&this._clearDepthStencilBuffer(e.depth,e.stencil)}for(const e of this._scene._beforeRenderingGroupDrawStage)e.action(r);o.render(t,a,n,i);for(const e of this._scene._afterRenderingGroupDrawStage)e.action(r);this._scene.onAfterRenderingGroupObservable.notifyObservers(s,l)}}setRenderingOrder(e,t=null,i=null,n=null){if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=n,this._renderingGroups[e]){const t=this._renderingGroups[e];t.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],t.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],t.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}constructor(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Up,this._maintainStateBetweenFrames=!1,this._scene=t;for(let t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}};Hp.MAX_RENDERINGGROUPS=4,Hp.MIN_RENDERINGGROUPS=0,Hp.AUTOCLEAR=!0,Ed.prototype.createRenderTargetCubeTexture=function(e,t){const i=this._createHardwareRenderTargetWrapper(!1,!0,e),n={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...t};n.generateStencilBuffer=n.generateDepthBuffer&&n.generateStencilBuffer,(1!==n.type||this._caps.textureFloatLinearFiltering)&&(2!==n.type||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=1);const a=this._gl,s=new Cu(this,5);this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,s,!0);const r=this._getSamplingParameters(n.samplingMode,n.generateMipMaps);1!==n.type||this._caps.textureFloat||(n.type=0,jh.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,r.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,r.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(let t=0;t<6;t++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this._getRGBABufferInternalSizedFormat(n.type,n.format),e,e,0,this._getInternalFormat(n.format),this._getWebGLTextureType(n.type),null);const o=a.createFramebuffer();return this._bindUnboundFramebuffer(o),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(n.generateStencilBuffer,n.generateDepthBuffer,e,e),n.generateMipMaps&&a.generateMipmap(a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),i._framebuffer=o,i._generateDepthBuffer=n.generateDepthBuffer,i._generateStencilBuffer=n.generateStencilBuffer,s.width=e,s.height=e,s.isReady=!0,s.isCube=!0,s.samples=1,s.generateMipMaps=n.generateMipMaps,s.samplingMode=n.samplingMode,s.type=n.type,s.format=n.format,this._internalTexturesCache.push(s),i.setTextures(s),i},Ed.prototype.setDepthStencilTexture=function(e,t,i,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0,n):this._setTexture(e,null,void 0,void 0,n))},m();var Vp,Wp={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},zp=class{draw(){this.engine.drawElementsType(0,0,6)}setViewport(e=this._fullscreenViewport){this.engine.setViewport(e)}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}render(e,t=null){if(!e.effect.isReady())return;this.saveStates(),this.setViewport();const i=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;i&&this.engine.bindFramebuffer(i),this.applyEffectWrapper(e),this.draw(),i&&this.engine.unBindFramebuffer(i),this.restoreStates()}constructor(e,t=Wp){this._fullscreenViewport=new ld(0,0,1,1);const i=t.positions??Wp.positions,n=t.indices??Wp.indices;this.engine=e,this._vertexBuffers={[$h.PositionKind]:new $h(e,i,$h.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(n),this._onContextRestoredObserver=e.onContextRestoredObservable.add((()=>{this._indexBuffer=e.createIndexBuffer(n);for(const e in this._vertexBuffers){this._vertexBuffers[e]._rebuild()}}))}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}_isRenderTargetTexture(e){return void 0!==e.renderTarget}dispose(){const e=this._vertexBuffers[$h.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[$h.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e._drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}},Xp=class{set effect(e){this._drawWrapper.effect=e}dispose(e=!1){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()}get effect(){return this._drawWrapper.effect}constructor(e){let t;this.onApplyObservable=new Ih;const i=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(i.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)})));const n=e.defines?e.defines.join("\n"):"";this._drawWrapper=new df(e.engine),e.useShaderStore?(t.fragment=t.fragmentSource,t.vertex||(t.vertex=t.vertexSource),delete t.fragmentSource,delete t.vertexSource,this.effect=e.engine.createEffect(t,e.attributeNames||["position"],i,e.samplerNames,n,void 0,e.onCompiled,void 0,void 0,e.shaderLanguage)):(this.effect=new pu(t,e.attributeNames||["position"],i,e.samplerNames,e.engine,n,void 0,e.onCompiled,void 0,void 0,void 0,e.shaderLanguage),this._onContextRestoredObserver=e.engine.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()})))}};function Yp(){if(!Vp){let e,t=null;const i={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};try{e=new OffscreenCanvas(100,100),t=new Ed(e,!1,i)}catch(n){e=document.createElement("canvas"),t=new Ed(e,!1,i)}xh.Instances.pop(),xh.OnEnginesDisposedObservable.add((e=>{t&&e!==t&&!t.isDisposed&&0===xh.Instances.length&&function(){Vp&&(Vp.wrapper.dispose(),Vp.renderer.dispose(),Vp.engine.dispose());Vp=null}()})),t.getCaps().parallelShaderCompile=void 0;const n=new zp(t),a=new Xp({engine:t,name:g.name,fragmentShader:g.shader,samplerNames:["textureSampler"]});Vp={canvas:e,engine:t,renderer:n,wrapper:a}}return Vp}async function jp(e,t,i,n,a="image/png",s,r){const o=await i.readPixels(0,0,e,t);$p(e,t,new Uint8Array(o.buffer),n,a,s,!0,void 0,r)}function Kp(e,t,i,n="image/png",a,s=!1,r=!1,o){return new Promise((l=>{$p(e,t,i,(e=>l(e)),n,a,s,r,o)}))}function $p(e,t,i,n,a="image/png",s,r=!1,o=!1,l){const c=Yp();if(c.engine.setSize(e,t,!0),i instanceof Float32Array){const e=new Uint8Array(i.length);let t=i.length;for(;t--;){const n=i[t];e[t]=Math.round(255*vh.Clamp(n))}i=e}const h=c.engine.createRawTexture(i,e,t,5,!1,!r,1);c.renderer.setViewport(),c.renderer.applyEffectWrapper(c.wrapper),c.wrapper.effect._bindTexture("textureSampler",h),c.renderer.draw(),o?ad.ToBlob(c.canvas,(e=>{const t=new FileReader;t.onload=e=>{const t=e.target.result;n&&n(t)},t.readAsArrayBuffer(e)}),a,l):ad.EncodeScreenshotCanvasData(c.canvas,n,a,s,l),h.dispose()}R();ad.DumpData=$p,ad.DumpDataAsync=Kp,ad.DumpFramebuffer=jp,pu.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)};var qp=class e extends yp{get isMulti(){return this._renderTarget?.isMulti??!1}isReadyForRendering(){return this._render(!1,!1,!0)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}_bestReflectionRenderTargetDimension(e,t){const i=e*t,n=ed(i+16384/(128+i));return Math.min(id(e),n)}createDepthStencilTexture(e=0,t=!0,i=!1,n=1,a=14,s){this._renderTarget?.createDepthStencilTexture(e,t,i,n,a,s)}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(const e of this._postProcesses)e.dispose();this._postProcesses=[]}}addPostProcess(e){if(!this._postProcessManager){const e=this.getScene();if(!e)return;this._postProcessManager=new Bp(e),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(t)}))}getViewCount(){return 1}_renderToTarget(e,t,i,n=0,a=null){const s=this.getScene();if(!s)return;const r=s.getEngine();r._debugPushGroup?.(`render to face #${e} layer #${n}`,1),this._prepareFrame(s,e,n,t),this.is2DArray||this.is3D?(r.currentRenderPassId=this._renderPassIds[n],this.onBeforeRenderObservable.notifyObservers(n)):(r.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e));if(r.snapshotRendering&&1===r.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(r):this.skipInitialClear||r.clear(this.clearColor||s.clearColor,!0,!0,!0);else{let o=null;const l=this.Pt?this.Pt:s.getActiveMeshes().data,c=this.Pt?this.Pt.length:s.getActiveMeshes().length;this.getCustomRenderList&&(o=this.getCustomRenderList(this.is2DArray||this.is3D?n:e,l,c)),o?this._prepareRenderingManager(o,o.length,a,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(l,c,a,!this.Pt||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),o=l);for(const t of s._beforeRenderTargetClearStage)t.action(this,e,n);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(r):this.skipInitialClear||r.clear(this.clearColor||s.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||s.updateTransformMatrix(!0);for(const t of s._beforeRenderTargetDrawStage)t.action(this,e,n);this._renderingManager.render(this.customRenderFunction,o,this.renderParticles,this.renderSprites);for(const t of s._afterRenderTargetDrawStage)t.action(this,e,n);const h=this._texture?.generateMipMaps??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e,this._postProcesses,this.ignoreCameraViewport):t&&s.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e);for(const t of s._afterRenderTargetPostProcessStage)t.action(this,e,n);this._texture&&(this._texture.generateMipMaps=h),this._doNotChangeAspectRatio||s.updateTransformMatrix(!0),i&&jp(this.getRenderWidth(),this.getRenderHeight(),r)}this._unbindFrameBuffer(r,e),this._texture&&this.isCube&&5===e&&r.generateMipMapsForCubemap(this._texture,!0),r._debugPopGroup?.(1)}dispose(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.Pt=null;const e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);t>=0&&e.customRenderTargets.splice(t,1);for(const i of e.cameras)t=i.customRenderTargets.indexOf(this),t>=0&&i.customRenderTargets.splice(t,1);this._renderTarget?.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}getRenderSize(){return this.getRenderWidth()}get postProcesses(){return this._postProcesses}get samples(){return this._renderTarget?.samples??this._samples}_render(e=!1,t=!1,i=!1){const n=this.getScene();if(!n)return i;const a=n.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.Pt=[];for(let e=0;e<this._waitingRenderList.length;e++){const t=this._waitingRenderList[e],i=n.getMeshById(t);i&&this.Pt.push(i)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.Pt?this.Pt.length=0:this.Pt=[];const e=this.getScene();if(!e)return i;const t=e.meshes;for(let e=0;e<t.length;e++){const i=t[e];this.renderListPredicate(i)&&this.Pt.push(i)}}const s=a.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const r=this.activeCamera??n.activeCamera,o=n.activeCamera;r&&(r!==n.activeCamera&&(n.setTransformMatrix(r.getViewMatrix(),r.getProjectionMatrix(!0)),n.activeCamera=r),a.setViewport(r.rigParent?r.rigParent.viewport:r.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let l=i;if(i){n.getViewMatrix()||n.updateTransformMatrix();const e=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let t=0;t<e&&l;t++){let e=null;const s=this.Pt?this.Pt:n.getActiveMeshes().data,r=this.Pt?this.Pt.length:n.getActiveMeshes().length;a.currentRenderPassId=this._renderPassIds[t],this.onBeforeRenderObservable.notifyObservers(t),this.getCustomRenderList&&(e=this.getCustomRenderList(t,s,r)),e||(e=s),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0);for(let t=0;t<e.length&&l;++t){const n=e[t];if(n.isEnabled()&&!n.isBlocked&&n.isVisible&&n.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(n,this.refreshRate,i)){l=!1;continue}}else if(!n.isReady(!0)){l=!1;continue}}this.onAfterRenderObservable.notifyObservers(t),(this.is2DArray||this.is3D||this.isCube)&&(n.incrementRenderId(),n.resetCachedMaterial())}}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let i=0;i<6;i++)this._renderToTarget(i,e,t,void 0,r),n.incrementRenderId(),n.resetCachedMaterial();else this._renderToTarget(0,e,t,void 0,r);else for(let i=0;i<this.getRenderLayers();i++)this._renderToTarget(0,e,t,i,r),n.incrementRenderId(),n.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),a.currentRenderPassId=s,o&&(n.activeCamera=o,this.activeCamera&&this.activeCamera!==n.activeCamera&&n.setTransformMatrix(n.activeCamera.getViewMatrix(),n.activeCamera.getProjectionMatrix(!0)),a.setViewport(n.activeCamera.viewport)),n.resetCachedMaterial(),l}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}get refreshRate(){return this._refreshRate}get canRescale(){return this._canRescale}_processSizeParameter(e,t=!0){if(e.ratio){this._sizeRatio=e.ratio;const t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e;t&&this._createRenderPassId()}getRenderWidth(){return this._size.width?this._size.width:this._size}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}removePostProcess(e){if(!this._postProcesses)return;const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}get renderTargetOptions(){return this._renderTargetOptions}_bindFrameBuffer(e=0,t=0){const i=this.getScene();if(!i)return;const n=i.getEngine();this._renderTarget&&n.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}disableRescaling(){this._canRescale=!1}setMaterialForRendering(e,t){let i;i=Array.isArray(e)?e:[e];for(let e=0;e<i.length;++e)for(let n=0;n<this._renderPassIds.length;++n)i[e].setMaterialForRenderPass(this._renderPassIds[n],void 0!==t?Array.isArray(t)?t[n]:t:void 0)}clone(){const t=this.getSize(),i=new e(this.name,t,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.coordinatesMode=this.coordinatesMode,this.Pt&&(i.Pt=this.Pt.slice(0)),i}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}render(e=!1,t=!1){this._render(e,t)}_prepareFrame(e,t,i,n){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,i)}get renderTarget(){return this._renderTarget}getRenderHeight(){return this._size.width?this._size.height:this._size}get Pt(){return this._renderList}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}serialize(){if(!this.name)return null;const e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.Pt=[],this.Pt)for(let t=0;t<this.Pt.length;t++)e.Pt.push(this.Pt[t].id);return e}setRenderingOrder(e,t=null,i=null,n=null){this._renderingManager.setRenderingOrder(e,t,i,n)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}_rebuild(){this.refreshRate===e.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=e.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}_releaseRenderPassId(){if(this._scene){const e=this._scene.getEngine();for(let t=0;t<this._renderPassIds.length;++t)e.releaseRenderPassId(this._renderPassIds[t])}this._renderPassIds=[]}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}_createRenderPassId(){this._releaseRenderPassId();const e=this._scene.getEngine(),t=this._isCubeData?6:this.getRenderLayers()||1;for(let i=0;i<t;++i)this._renderPassIds[i]=e.createRenderPassId(`RenderTargetTexture - ${this.name}#${i}`)}get currentRefreshId(){return this._currentRefreshId}get renderPassIds(){return this._renderPassIds}getRenderLayers(){const e=this._size.layers;if(e)return e;const t=this._size.depth;return t||0}constructor(e,t,i,n=!1,a=!0,s=0,r=!1,o=yp.TRILINEAR_SAMPLINGMODE,l=!0,c=!1,h=!1,f=5,u=!1,d,m,p=!1,_=!1){let v,g=!0;if("object"==typeof n){const e=n;n=!!e.generateMipMaps,a=e.doNotChangeAspectRatio??!0,s=e.type??0,r=!!e.isCube,o=e.samplingMode??yp.TRILINEAR_SAMPLINGMODE,l=e.generateDepthBuffer??!0,c=!!e.generateStencilBuffer,h=!!e.isMulti,f=e.format??5,u=!!e.delayAllocation,d=e.samples,m=e.creationFlags,p=!!e.noColorAttachment,_=!!e.useSRGBBuffer,v=e.colorAttachment,g=e.gammaSpace??g}if(super(null,i,!n,void 0,o,void 0,void 0,void 0,void 0,f),this._unObserveRenderList=null,this._renderListHasChanged=(e,t)=>{const i=this._renderList?this._renderList.length:0;(0===t&&i>0||0===i)&&this.getScene()?.meshes.forEach((e=>{e._markSubMeshesAsLightDirty()}))},this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new Ih,this.onAfterUnbindObservable=new Ih,this.onBeforeRenderObservable=new Ih,this.onAfterRenderObservable=new Ih,this.onClearObservable=new Ih,this.onResizeObservable=new Ih,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=wh.Zero(),!(i=this.getScene()))return;const S=this.getScene().getEngine();this._gammaSpace=g,this._coordinatesMode=yp.PROJECTION_MODE,this.Pt=[],this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._renderPassIds=[],this._isCubeData=r,this._processSizeParameter(t),this.renderPassId=this._renderPassIds[0],this._resizeObserver=S.onResizeObservable.add((()=>{})),this._generateMipMaps=!!n,this._doNotChangeAspectRatio=a,this._renderingManager=new Hp(i),this._renderingManager._useSceneAutoClearSetup=!0,h||(this._renderTargetOptions={generateMipMaps:n,type:s,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:l,generateStencilBuffer:c,samples:d,creationFlags:m,noColorAttachment:p,useSRGBBuffer:_,colorAttachment:v,label:this.name},this.samplingMode===yp.NEAREST_SAMPLINGMODE&&(this.wrapU=yp.CLAMP_ADDRESSMODE,this.wrapV=yp.CLAMP_ADDRESSMODE),u||(r?(this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=yp.INVCUBIC_MODE,this._textureMatrix=Lh.Identity()):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==d&&(this.samples=d)))}resetRefreshCounter(){this._currentRefreshId=-1}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}get depthStencilTexture(){return this._renderTarget?._depthStencilTexture??null}set Pt(e){this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),e&&(this._unObserveRenderList=ah(e,this._renderListHasChanged)),this._renderList=e}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}setRenderingAutoClearDepthStencil(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1}scale(e){const t=Math.max(1,this.getRenderSize()*e);this.resize(t)}releaseInternalTexture(){this._renderTarget?.releaseTextures(),this._texture=null}get boundingBoxSize(){return this._boundingBoxSize}disposeFramebufferObjects(){this._renderTarget?.dispose(!0)}resize(e){const t=this.isCube;this._renderTarget?.dispose(),this._renderTarget=null;const i=this.getScene();i&&(this._processSizeParameter(e,!1),this._renderTarget=t?i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}_prepareRenderingManager(e,t,i,n){const a=this.getScene();if(!a)return;this._renderingManager.reset();const s=a.getRenderId();for(let r=0;r<t;r++){const t=e[r];if(t&&!t.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(t,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!t.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!t._internalAbstractMeshDataInfo._currentLODIsUpToDate&&a.activeCamera&&(t._internalAbstractMeshDataInfo._currentLOD=a.customLODSelector?a.customLODSelector(t,this.activeCamera||a.activeCamera):t.getLOD(this.activeCamera||a.activeCamera),t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!t._internalAbstractMeshDataInfo._currentLOD)continue;let e,r=t._internalAbstractMeshDataInfo._currentLOD;if(r._preActivateForIntermediateRendering(s),e=!(!n||!i)&&0==(t.layerMask&i.layerMask),t.isEnabled()&&t.isVisible&&t.subMeshes&&!e){if(r!==t&&r._activate(s,!0),t._activate(s,!0)&&t.subMeshes.length){t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(r=t):r._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,r._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(let e=0;e<r.subMeshes.length;e++){const t=r.subMeshes[e];this._renderingManager.dispatch(t,r)}}t._postActivate()}}}for(let e=0;e<a.particleSystems.length;e++){const t=a.particleSystems[e],i=t.emitter;t.isStarted()&&i&&(!i.position||i.isEnabled())&&this._renderingManager.dispatchParticles(t)}}};qp.REFRESHRATE_RENDER_ONCE=0,qp.REFRESHRATE_RENDER_ONEVERYFRAME=1,qp.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,yp._CreateRenderTargetTexture=(e,t,i,n,a)=>new qp(e,t,i,n);var Jp=class{register(){this.scene._beforeClearStage.registerStep(Rm.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)}_beforeClear(){if(this.scene.proceduralTexturesEnabled){ad.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(let e=0;e<this.scene.proceduralTextures.length;e++){const t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}ad.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}}dispose(){}constructor(e){this.name=Rm.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=[]}rebuild(){}};c();e.ShadersStore.proceduralVertexShader="attribute vec2 position;varying vec2 vPosition;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvPosition=position;vUV=position*madd+madd;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";var Qp,Zp,e_=class e extends yp{isReady(){const e=this._fullEngine;if(this.nodeMaterialSource)return this._drawWrapper.effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;if(!this._texture)return!1;const t=this._getDefines();if(this._drawWrapper.effect&&t===this._cachedDefines&&this._drawWrapper.effect.isReady())return!0;const i={vertex:"procedural",fragmentElement:this._fragment.fragmentElement,fragmentSource:this._fragment.fragmentSource,fragment:"string"==typeof this._fragment?this._fragment:void 0};return this._cachedDefines!==t&&(this._cachedDefines=t,this._drawWrapper.effect=e.createEffect(i,[$h.PositionKind],this._uniforms,this._samplers,t,void 0,void 0,(()=>{this._rtWrapper?.dispose(),this._rtWrapper=this._texture=null,this._fallbackTexture&&(this._texture=this._fallbackTexture._texture,this._texture&&this._texture.incrementReferences()),this._fallbackTextureUsed=!0}))),this._drawWrapper.effect.isReady()}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}getEffect(){return this._drawWrapper.effect}resize(e,t){if(this._fallbackTextureUsed||!this._rtWrapper||!this._texture)return;const i=this._texture.isCube;this._rtWrapper.dispose();const n=this._createRtWrapper(i,e,t,this._textureType);this._texture=n.texture,this._size=e,this._generateMipMaps=t}_createRtWrapper(e,t,i,n){return e?(this._rtWrapper=this._fullEngine.createRenderTargetCubeTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:n,...this._options}),this.setFloat("face",0)):this._rtWrapper=this._fullEngine.createRenderTargetTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:n,...this._options}),this._rtWrapper}_checkUniform(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)}_shouldRender(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}get refreshRate(){return this._refreshRate}_getDefines(){return""}constructor(e,t,i,n,a=null,s=!0,r=!1,o=0){super(null,n,!s),this.isEnabled=!0,this.autoClear=!0,this.onGeneratedObservable=new Ih,this.onBeforeGenerationObservable=new Ih,this.nodeMaterialSource=null,this._textures={},this._currentRefreshId=-1,this._frameId=-1,this._refreshRate=1,this._vertexBuffers={},this._uniforms=new Array,this._samplers=new Array,this._floats={},this._ints={},this._floatsArrays={},this._colors3={},this._colors4={},this._vectors2={},this._vectors3={},this._vectors4={},this._matrices={},this._fallbackTextureUsed=!1,this._cachedDefines=null,this._contentUpdateId=-1,this._rtWrapper=null,null===a||a instanceof yp?(this._options={},this._fallbackTexture=a):(this._options=a,this._fallbackTexture=a.fallbackTexture??null);let l=(n=this.getScene()||xh.LastCreatedScene)._getComponent(Rm.NAME_PROCEDURALTEXTURE);l||(l=new Jp(n),n._addComponent(l)),n.proceduralTextures.push(this),this._fullEngine=n.getEngine(),this.name=e,this.isRenderTarget=!0,this._size=t,this._textureType=o,this._generateMipMaps=s,this._drawWrapper=new df(this._fullEngine),this.setFragment(i);const c=this._createRtWrapper(r,t,s,o);this._texture=c.texture;const h=[];h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),this._vertexBuffers[$h.PositionKind]=new $h(this._fullEngine,h,$h.PositionKind,!1,!1,2),this._createIndexBuffer()}reset(){this._drawWrapper.effect?.dispose(),this._drawWrapper.effect=null,this._cachedDefines=null}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}dispose(){const e=this.getScene();if(!e)return;const t=e.proceduralTextures.indexOf(this);t>=0&&e.proceduralTextures.splice(t,1);const i=this._vertexBuffers[$h.PositionKind];i&&(i.dispose(),this._vertexBuffers[$h.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),super.dispose()}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}_setEffect(e){this._drawWrapper.effect=e}getRenderSize(){return this._size}setTexture(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this}_createIndexBuffer(){const e=this._fullEngine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)}resetRefreshCounter(){this._currentRefreshId=-1}render(e){const t=this.getScene();if(!t)return;const i=this._fullEngine;if(i.enableEffect(this._drawWrapper),this.onBeforeGenerationObservable.notifyObservers(this),i.setState(!1),!this.nodeMaterialSource){for(const e in this._textures)this._drawWrapper.effect.setTexture(e,this._textures[e]);for(const e in this._ints)this._drawWrapper.effect.setInt(e,this._ints[e]);for(const e in this._floats)this._drawWrapper.effect.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)this._drawWrapper.effect.setArray(e,this._floatsArrays[e]);for(const e in this._colors3)this._drawWrapper.effect.setColor3(e,this._colors3[e]);for(const e in this._colors4){const t=this._colors4[e];this._drawWrapper.effect.setFloat4(e,t.r,t.g,t.b,t.a)}for(const e in this._vectors2)this._drawWrapper.effect.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)this._drawWrapper.effect.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)this._drawWrapper.effect.setVector4(e,this._vectors4[e]);for(const e in this._matrices)this._drawWrapper.effect.setMatrix(e,this._matrices[e])}if(!this._texture||!this._rtWrapper)return;i._debugPushGroup?.(`procedural texture generation for ${this.name}`,1);const n=i.currentViewport;if(this.isCube)for(let e=0;e<6;e++)i.bindFramebuffer(this._rtWrapper,e,void 0,void 0,!0),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._drawWrapper.effect.setFloat("face",e),this.autoClear&&i.clear(t.clearColor,!0,!1,!1),i.drawElementsType(Am.TriangleFillMode,0,6);else{let e=1;this._rtWrapper.is3D?e=this._rtWrapper.depth:this._rtWrapper.is2DArray&&(e=this._rtWrapper.layers);for(let n=0;n<e;n++)i.bindFramebuffer(this._rtWrapper,0,void 0,void 0,!0,0,n),(this._rtWrapper.is3D||this._rtWrapper.is2DArray)&&this._drawWrapper.effect?.setFloat("layer",1!==e?n/(e-1):0),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this.autoClear&&i.clear(t.clearColor,!0,!1,!1),i.drawElementsType(Am.TriangleFillMode,0,6)}i.unBindFramebuffer(this._rtWrapper,this.isCube),n&&i.setViewport(n),this.isCube&&i.generateMipMapsForCubemap(this._texture,!0),i._debugPopGroup?.(1),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}setFragment(e){this._fragment=e}getContent(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData?this._contentData.then((e=>{this._contentData=this.readPixels(0,0,e),this._contentUpdateId=this._frameId})):(this._contentData=this.readPixels(0,0),this._contentUpdateId=this._frameId)),this._contentData}_rebuild(){const e=this._vertexBuffers[$h.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===qp.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=qp.REFRESHRATE_RENDER_ONCE)}executeWhenReady(e){if(this.isReady())return void e(this);const t=this.getEffect();t&&t.executeWhenCompiled((()=>{e(this)}))}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}clone(){const t=this.getSize(),i=new e(this.name,t.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.coordinatesMode=this.coordinatesMode,i}};Lc([Hc()],e_.prototype,"isEnabled",void 0),Lc([Hc()],e_.prototype,"autoClear",void 0),Lc([Hc()],e_.prototype,"_generateMipMaps",void 0),Lc([Hc()],e_.prototype,"_size",void 0),Lc([Hc()],e_.prototype,"refreshRate",null),rh("BABYLON.ProceduralTexture",e_),(Zp=Qp||(Qp={}))[Zp.Cos=0]="Cos",Zp[Zp.Sin=1]="Sin",Zp[Zp.Abs=2]="Abs",Zp[Zp.Exp=3]="Exp",Zp[Zp.Exp2=4]="Exp2",Zp[Zp.Round=5]="Round",Zp[Zp.Floor=6]="Floor",Zp[Zp.Ceiling=7]="Ceiling",Zp[Zp.Sqrt=8]="Sqrt",Zp[Zp.Log=9]="Log",Zp[Zp.Tan=10]="Tan",Zp[Zp.ArcTan=11]="ArcTan",Zp[Zp.ArcCos=12]="ArcCos",Zp[Zp.ArcSin=13]="ArcSin",Zp[Zp.Fract=14]="Fract",Zp[Zp.Sign=15]="Sign",Zp[Zp.Radians=16]="Radians",Zp[Zp.Degrees=17]="Degrees",Zp[Zp.Set=18]="Set";var t_=class extends $m{_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.operation = BABYLON.TrigonometryBlockOperations.${Qp[this.operation]};\n`}getClassName(){return"TrigonometryBlock"}get output(){return this._outputs[0]}constructor(e){super(e,Lm.Neutral),this.operation=Qp.Cos,this.registerInput("input",Om.AutoDetect),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}serialize(){const e=super.serialize();return e.operation=this.operation,e}get input(){return this._inputs[0]}_deserialize(e,t,i){super._deserialize(e,t,i),this.operation=e.operation}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];let i="";switch(this.operation){case Qp.Cos:i="cos";break;case Qp.Sin:i="sin";break;case Qp.Abs:i="abs";break;case Qp.Exp:i="exp";break;case Qp.Exp2:i="exp2";break;case Qp.Round:i="round";break;case Qp.Floor:i="floor";break;case Qp.Ceiling:i="ceil";break;case Qp.Sqrt:i="sqrt";break;case Qp.Log:i="log";break;case Qp.Tan:i="tan";break;case Qp.ArcTan:i="atan";break;case Qp.ArcCos:i="acos";break;case Qp.ArcSin:i="asin";break;case Qp.Fract:i="fract";break;case Qp.Sign:i="sign";break;case Qp.Radians:i="radians";break;case Qp.Degrees:i="degrees";break;case Qp.Set:i=""}return e.compilationString+=e._declareOutput(t)+` = ${i}(${this.input.associatedVariableName});\n`,this}};rh("BABYLON.TrigonometryBlock",t_);var i_={effect:null,subMesh:null},n_=class extends Ym{constructor(){super(),this.NORMAL=!1,this.TANGENT=!1,this.VERTEXCOLOR_NME=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.PREPASS=!1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.EXPOSURE=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.BUMPDIRECTUV=0,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.rebuild()}setValue(e,t,i=!1){void 0===this[e]&&this._keys.push(e),i&&this[e]!==t&&this.markAsUnprocessed(),this[e]=t}},a_=class e extends Gm{get prePassTextureInputs(){const e=this.getAllTextureBlocks().filter((e=>"PrePassTextureBlock"===e.getClassName())),t=[];for(const i of e)i.position.isConnected&&!t.includes(1)&&t.push(1),i.depth.isConnected&&!t.includes(5)&&t.push(5),i.normal.isConnected&&!t.includes(6)&&t.push(6);return t}addOutputNode(e){if(null===e.target)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return 0!=(e.target&Lm.Vertex)&&this._addVertexOutputNode(e),0!=(e.target&Lm.Fragment)&&this._addFragmentOutputNode(e),this}set options(e){this._options=e}whenTexturesReadyAsync(){const e=[];return this.getActiveTextures().forEach((t=>{const i=t.getInternalTexture();i&&!i.isReady&&e.push(new Promise(((e,t)=>{i.onLoadedObservable.addOnce((()=>{e()})),i.onErrorObservable.addOnce((e=>{t(e)}))})))})),Promise.all(e)}serialize(e){const t=e?{}:Uh.Serialize(this);t.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];if(e)i=e;else{t.customType="BABYLON.NodeMaterial",t.outputNodes=[];for(const e of this._vertexOutputNodes)this._gatherBlocks(e,i),t.outputNodes.push(e.xt);for(const e of this._fragmentOutputNodes)this._gatherBlocks(e,i),-1===t.outputNodes.indexOf(e.xt)&&t.outputNodes.push(e.xt)}t.blocks=[];for(const e of i)t.blocks.push(e.serialize());if(!e)for(const e of this.attachedBlocks)-1===i.indexOf(e)&&t.blocks.push(e.serialize());return t.xt=this.xt,t}static Parse(t,i,n="",a=0){const s=Uh.Parse((()=>new e(t.name,i,{shaderLanguage:a})),t,i,n);return s.parseSerializedObject(t,n),s.build(),s}setToDefault(){this.clear(),this.editorData=null;const e=new _p("Position");e.setAsAttribute("position");const t=new _p("World");t.setAsSystemValue(tp.World);const i=new qm("WorldPos");e.connectTo(i),t.connectTo(i);const n=new _p("ViewProjection");n.setAsSystemValue(tp.ViewProjection);const a=new qm("WorldPos * ViewProjectionTransform");i.connectTo(a),n.connectTo(a);const s=new Zm("VertexOutput");a.connectTo(s);const r=new _p("color");r.value=new Ch(.8,.8,.8,1);const o=new sp("FragmentOutput");r.connectTo(o),this.addOutputNode(s),this.addOutputNode(o),this._mode=Pp.Material}getInputBlocks(){const e=[];for(const t of this.attachedBlocks)t.isInput&&e.push(t);return e}_removeFragmentOutputNode(e){const t=this._fragmentOutputNodes.indexOf(e);if(-1!==t)return this._fragmentOutputNodes.splice(t,1),this}_createNodeEditor(e){const t={nodeMaterial:this,...e};this.BJSNODEMATERIALEDITOR.NodeEditor.Show(t)}static CreateDefault(t,i){const n=new e(t,i);return n.setToDefault(),n.build(),n}_resetDualBlocks(e,t){e.target===Lm.VertexAndFragment&&(e.buildId=t);for(const i of e.inputs){const n=i.connectedPoint;if(n){const i=n.ownerBlock;i!==e&&this._resetDualBlocks(i,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._resetDualBlocks(i.entryPoint,t)}}set mode(e){this._mode=e}dispose(e,t,i){if(t)for(const e of this.getTextureBlocks().filter((e=>e.texture)).map((e=>e.texture)))e.dispose();for(const e of this.attachedBlocks)e.dispose();this.attachedBlocks.length=0,this._sharedData=null,this._vertexCompilationState=null,this._fragmentCompilationState=null,this.onBuildObservable.clear(),this._imageProcessingObserver&&(this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingObserver=null),super.dispose(e,t,i)}get options(){return this._options}isReadyForSubMesh(e,t,i=!1){if(!this._buildWasSuccessful)return!1;const n=this.getScene();if(this._sharedData.animatedInputs){const e=n.getFrameId();if(this._animationFrame!==e){for(const e of this._sharedData.animatedInputs)e.animate(n);this._animationFrame=e}}const a=t._drawWrapper;if(a.effect&&this.isFrozen&&a._wasPreviouslyReady&&a._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new n_);const s=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const r=n.getEngine();if(this._prepareDefinesForAttributes(e,s),this._sharedData.blockingBlocks.some((t=>!t.isReady(e,this,s,i))))return!1;const o=this._processDefines(e,s,i,t);if(o){const e=t.effect,i=s.toString();let a=r.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:o.mergedUniforms,uniformBuffersNames:o.uniformBuffers,samplers:o.mergedSamplers,defines:i,fallbacks:o.fallbacks,onCompiled:this.onCompiled,onError:this.onError,multiTarget:s.PREPASS,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:s.NUM_MORPH_INFLUENCERS},shaderLanguage:this.shaderLanguage},r);if(a)if(this._onEffectCreatedObservable&&(i_.effect=a,i_.subMesh=t,this._onEffectCreatedObservable.notifyObservers(i_)),this.allowShaderHotSwapping&&e&&!a.isReady()){if(a=e,s.markAsUnprocessed(),o.lightDisposed)return s._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),t.setEffect(a,s,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(s._renderId=n.getRenderId(),a._wasPreviouslyReady=!0,a._wasPreviouslyUsingInstances=i,this._checkScenePerformancePriority(),!0)}registerOptimizer(e){if(!(this._optimizers.indexOf(e)>-1))return this._optimizers.push(e),this}_processDefines(e,t,i=!1,n){let a=null;if(Sm(this.getScene(),t)&&t.markAsMiscDirty(),this._sharedData.blocksWithDefines.forEach((n=>{n.initializeDefines(e,this,t,i)})),this._sharedData.blocksWithDefines.forEach((a=>{a.prepareDefines(e,this,t,i,n)})),t.isDirty){const i=t._areLightsDisposed;t.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach((i=>{i.replaceRepeatableContent(this._vertexCompilationState,this._fragmentCompilationState,e,t)}));const n=[];this._sharedData.dynamicUniformBlocks.forEach((e=>{e.updateUniformsAndSamples(this._vertexCompilationState,this,t,n)}));const s=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach((e=>{-1===s.indexOf(e)&&s.push(e)}));const r=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach((e=>{-1===r.indexOf(e)&&r.push(e)}));const o=new Tp;this._sharedData.blocksWithFallbacks.forEach((t=>{t.provideFallbacks(e,o)})),a={lightDisposed:i,uniformBuffers:n,mergedUniforms:s,mergedSamplers:r,fallbacks:o}}return a}get mode(){return this._mode}get compiledShaders(){return`// Vertex shader\n${this._vertexCompilationState.compilationString}\n\n// Fragment shader\n${this._fragmentCompilationState.compilationString}`}getBlockByName(e){let t=null;for(const i of this.attachedBlocks)if(i.name===e){if(t)return ad.Warn("More than one block was found with the name `"+e+"`"),t;t=i}return t}_createEffectForPostProcess(e,t,i=1,n=1,a,s,r=0,o=5){let l=this.name+this._buildId;const c=new n_,h=new wm(l+"PostProcess",this.getScene());let f=this._buildId;return this._processDefines(h,c),pu.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage),e?e.updateEffect(c.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,l,l):e=new Ip(this.name+"PostProcess",l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,i,t,n,a,s,c.toString(),r,l,{maxSimultaneousLights:this.maxSimultaneousLights},!1,o,this.shaderLanguage),e.nodeMaterialSource=this,e.onApplyObservable.add((t=>{f!==this._buildId&&(delete pu.ShadersStore[l+"VertexShader"],delete pu.ShadersStore[l+"PixelShader"],l=this.name+this._buildId,c.markAllAsDirty(),f=this._buildId);this._processDefines(h,c)&&(pu.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString),iu.SetImmediate((()=>e.updateEffect(c.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,l,l)))),this._checkInternals(t)})),e}setToDefaultProceduralTexture(){this.clear(),this.editorData=null;const e=new _p("Position");e.setAsAttribute("position2d");const t=new _p("Constant1");t.isConstant=!0,t.value=1;const i=new xp("Position3D");e.connectTo(i),t.connectTo(i,{input:"w"});const n=new Zm("VertexOutput");i.connectTo(n);const a=new _p("Time");a.value=0,a.min=0,a.max=0,a.isBoolean=!1,a.matrixMode=0,a.animationType=rp.Time,a.isConstant=!1;const s=new _p("Color3");s.value=new Ah(1,1,1),s.isConstant=!1;const r=new sp("FragmentOutput"),o=new xp("VectorMerger");o.visibleInInspector=!1;const l=new t_("Cos");l.operation=Qp.Cos,e.connectTo(o),a.output.connectTo(l.input),l.output.connectTo(o.z),o.xyzOut.connectTo(r.rgb),this.addOutputNode(n),this.addOutputNode(r),this._mode=Pp.ProceduralTexture}get isPrePassCapable(){return!0}bindOnlyWorldMatrix(e){const t=this.getScene();if(!this._activeEffect)return;const i=this._sharedData.hints;i.needWorldViewMatrix&&e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),i.needWorldViewProjectionMatrix&&e.multiplyToRef(t.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(const t of this._sharedData.inputBlocks)t._transmitWorld(this._activeEffect,e,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}removeBlock(e){const t=this.attachedBlocks.indexOf(e);t>-1&&this.attachedBlocks.splice(t,1),e.isFinalMerger&&this.removeOutputNode(e)}set shaderLanguage(e){this._options.shaderLanguage=e}_restoreConnections(e,t,i){for(const n of e.outputs)for(const a of t.blocks){const s=i[a.id];if(s)for(const r of a.inputs)if(i[r.targetBlockId]!==e||r.targetConnectionName!==n.name);else{const e=s.getInputByName(r.inputName);if(!e||e.isConnected)continue;n.connectTo(e,!0),this._restoreConnections(s,t,i)}}}needAlphaTesting(){return this._sharedData&&this._sharedData.hints.needAlphaTesting}createEffectForPostProcess(e){this._createEffectForPostProcess(e)}constructor(t,i,n={}){if(super(t,i||xh.LastCreatedScene),this._buildId=e._BuildIdGenerator++,this._buildWasSuccessful=!1,this._cachedWorldViewMatrix=new Lh,this._cachedWorldViewProjectionMatrix=new Lh,this._optimizers=new Array,this._animationFrame=-1,this._buildIsInProgress=!1,this.BJSNODEMATERIALEDITOR=this._getGlobalNodeMaterialEditor(),this.editorData=null,this.ignoreAlpha=!1,this.maxSimultaneousLights=4,this.onBuildObservable=new Ih,this._vertexOutputNodes=new Array,this._fragmentOutputNodes=new Array,this.attachedBlocks=[],this._mode=Pp.Material,this.forceAlphaBlending=!1,n&&1===n.shaderLanguage&&!this.getScene().getEngine().isWebGPU)throw new Error("WebGPU shader language is only supported with WebGPU engine");this._options={emitComments:!1,shaderLanguage:e.DefaultShaderLanguage,...n},this._attachImageProcessingConfiguration(null)}get prePassTextureOutputs(){const e=this.getBlockByPredicate((e=>"PrePassOutputBlock"===e.getClassName())),t=[4];return e?(this.prePassTextureInputs.length||(e.viewDepth.isConnected&&t.push(5),e.viewNormal.isConnected&&t.push(6),e.worldPosition.isConnected&&t.push(1)),t):t}createPostProcess(e,t=1,i=1,n,a,s=0,r=5){return this.mode!==Pp.PostProcess?(jh.Log("Incompatible material mode"),null):this._createEffectForPostProcess(null,e,t,i,n,a,s,r)}static _BlockIsTextureBlock(e){return"TextureBlock"===e.getClassName()||"ReflectionTextureBaseBlock"===e.getClassName()||"ReflectionTextureBlock"===e.getClassName()||"ReflectionBlock"===e.getClassName()||"RefractionBlock"===e.getClassName()||"CurrentScreenBlock"===e.getClassName()||"ParticleTextureBlock"===e.getClassName()||"ImageSourceBlock"===e.getClassName()||"TriPlanarBlock"===e.getClassName()||"BiPlanarBlock"===e.getClassName()||"PrePassTextureBlock"===e.getClassName()}static ParseFromSnippetAsync(t,i=xh.LastCreatedScene,n="",a,s=!1,r=!1,o){return"_BLANK"===t?Promise.resolve(e.CreateDefault("blank",i)):new Promise(((l,c)=>{const h=new Rf;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const f=JSON.parse(JSON.parse(h.responseText).jsonPayload),u=JSON.parse(f.nodeMaterial);a||((a=Uh.Parse((()=>new e(t,i)),u,i,n)).xt=i.getUniqueId()),a.parseSerializedObject(u,void 0,void 0,o),a.snippetId=t,a.sideOrientation=null;try{s||a.build()}catch(e){c(e)}r?a.whenTexturesReadyAsync().then((()=>{l(a)})).catch((e=>{c(e)})):l(a)}else c("Unable to load the snippet "+t)})),h.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),h.send()}))}_processInitializeOnLink(e,t,i,n=!0){(e.target===Lm.VertexAndFragment||t.target===Lm.Fragment&&e.target===Lm.Vertex&&e._preparationId!==this._buildId)&&i.push(e),this._initializeBlock(e,t,i,n)}async loadAsync(t,i=""){return e.ParseFromFileAsync("",t,this.getScene(),i,!0,this)}clear(){this._vertexOutputNodes.length=0,this._fragmentOutputNodes.length=0,this.attachedBlocks.length=0}getAllTextureBlocks(){const t=[];for(const i of this.attachedBlocks)e._BlockIsTextureBlock(i)&&t.push(i);return t}_addFragmentOutputNode(e){if(-1===this._fragmentOutputNodes.indexOf(e))return e.target=Lm.Fragment,this._fragmentOutputNodes.push(e),this}get shaderLanguage(){return this._options.shaderLanguage}generateCode(){let e=[];const t=[],i=["const","var","let"];for(const e of this._vertexOutputNodes)this._gatherBlocks(e,t);const n=[];for(const e of this._fragmentOutputNodes)this._gatherBlocks(e,n);let a=`var nodeMaterial = new BABYLON.NodeMaterial("${this.name||"node material"}");\n`;a+=`nodeMaterial.mode = BABYLON.NodeMaterialModes.${Pp[this.mode]};\n`;for(const n of t)n.isInput&&-1===e.indexOf(n)&&(a+=n._dumpCode(i,e));for(const t of n)t.isInput&&-1===e.indexOf(t)&&(a+=t._dumpCode(i,e));e=[],a+="\n// Connections\n";for(const t of this._vertexOutputNodes)a+=t._dumpCodeForOutputConnections(e);for(const t of this._fragmentOutputNodes)a+=t._dumpCodeForOutputConnections(e);a+="\n// Output nodes\n";for(const e of this._vertexOutputNodes)a+=`nodeMaterial.addOutputNode(${e._codeVariableName});\n`;for(const e of this._fragmentOutputNodes)a+=`nodeMaterial.addOutputNode(${e._codeVariableName});\n`;return a+="nodeMaterial.build();\n",a}get buildId(){return this._buildId}hasTexture(e){if(super.hasTexture(e))return!0;if(!this._sharedData)return!1;for(const t of this._sharedData.textureBlocks)if(t.texture===e)return!0;return!1}getInputBlockByPredicate(e){for(const t of this.attachedBlocks)if(t.isInput&&e(t))return t;return null}_prepareDefinesForAttributes(e,t){const i=t.NORMAL,n=t.TANGENT,a=t.VERTEXCOLOR_NME;t.NORMAL=e.isVerticesDataPresent($h.NormalKind),t.TANGENT=e.isVerticesDataPresent($h.TangentKind);const s=e.useVertexColors&&e.isVerticesDataPresent($h.ColorKind);t.VERTEXCOLOR_NME=s;let r=!1;for(let i=1;i<=6;++i){const n=t["UV"+i];t["UV"+i]=e.isVerticesDataPresent(`uv${1===i?"":i}`),r=r||t["UV"+i]!==n}const o=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;gm(this.getScene(),t,!o),(i!==t.NORMAL||n!==t.TANGENT||a!==t.VERTEXCOLOR_NME||r)&&t.markAsAttributesDirty()}_gatherBlocks(e,t){if(-1===t.indexOf(e)){t.push(e);for(const i of e.inputs){const n=i.connectedPoint;if(n){const i=n.ownerBlock;i!==e&&this._gatherBlocks(i,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._gatherBlocks(i.entryPoint,t)}}}build(e=!1,t=!0,i=!1){if(this._buildIsInProgress)return void jh.Warn("Build is already in progress, You can use NodeMaterial.onBuildObservable to determine when the build is completed.");this._buildIsInProgress=!0,this._vertexCompilationState||i||(i=!0),this._buildWasSuccessful=!1;const n=this.getScene().getEngine(),a=this._mode===Pp.Particle;if(0===this._vertexOutputNodes.length&&!a)throw"You must define at least one vertexOutputNode";if(0===this._fragmentOutputNodes.length)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new zm,this._vertexCompilationState.supportUniformBuffers=n.supportsUniformBuffers,this._vertexCompilationState.target=Lm.Vertex,this._fragmentCompilationState=new zm,this._fragmentCompilationState.supportUniformBuffers=n.supportsUniformBuffers,this._fragmentCompilationState.target=Lm.Fragment,this._sharedData=new Xm,this._sharedData.nodeMaterial=this,this._sharedData.fragmentOutputNodes=this._fragmentOutputNodes,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=e,this._sharedData.scene=this.getScene(),this._sharedData.allowEmptyVertexProgram=a;const s=[],r=[];for(const e of this._vertexOutputNodes)s.push(e),this._initializeBlock(e,this._vertexCompilationState,r,i);for(const e of this._fragmentOutputNodes)r.push(e),this._initializeBlock(e,this._fragmentCompilationState,s,i);let o=0;for(const i of this.attachedBlocks)i.codeIsReady||(o++,i.onCodeIsReadyObservable.addOnce((()=>{o--,0===o&&this._finishBuildProcess(e,t,s,r)})));0===o&&this._finishBuildProcess(e,t,s,r)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}getClassName(){return"NodeMaterial"}getBlockByPredicate(e){for(const t of this.attachedBlocks)if(e(t))return t;return null}loadFromSerialization(e,t="",i=!1){this.parseSerializedObject(e,t,i)}setToDefaultParticle(){this.clear(),this.editorData=null;const e=new _p("uv");e.setAsAttribute("particle_uv");const t=new Ap("ParticleTexture");e.connectTo(t);const i=new _p("Color");i.setAsAttribute("particle_color");const n=new Dp("Texture * Color");t.connectTo(n),i.connectTo(n);const a=new Cp("ParticleRampGradient");n.connectTo(a);const s=new kp("ColorSplitter");i.connectTo(s);const r=new Rp("ParticleBlendMultiply");a.connectTo(r),t.connectTo(r,{output:"a"}),s.connectTo(r,{output:"a"});const o=new sp("FragmentOutput");r.connectTo(o),this.addOutputNode(o),this._mode=Pp.Particle}getTextureBlocks(){return this._sharedData?this._sharedData.textureBlocks:[]}clone(t,i=!1){const n=this.serialize(),a=Uh.Clone((()=>new e(t,this.getScene(),this.options)),this);return a.id=t,a.name=t,a.parseSerializedObject(n),a._buildId=this._buildId,a.build(!1,!i),a}setToDefaultPostProcess(){this.clear(),this.editorData=null;const e=new _p("Position");e.setAsAttribute("position2d");const t=new _p("Constant1");t.isConstant=!0,t.value=1;const i=new xp("Position3D");e.connectTo(i),t.connectTo(i,{input:"w"});const n=new Zm("VertexOutput");i.connectTo(n);const a=new _p("Scale");a.visibleInInspector=!0,a.value=new Ph(1,1);const s=new bp("uv0");e.connectTo(s);const r=new Dp("UV scale");s.connectTo(r),a.connectTo(r);const o=new Ep("CurrentScreen");r.connectTo(o),o.texture=new yp("https://assets.babylonjs.com/nme/currentScreenPostProcess.png",this.getScene());const l=new sp("FragmentOutput");o.connectTo(l,{output:"rgba"}),this.addOutputNode(n),this.addOutputNode(l),this._mode=Pp.PostProcess}optimize(){for(const e of this._optimizers)e.optimize(this._vertexOutputNodes,this._fragmentOutputNodes)}set buildId(e){this._buildId=e}createAsShadowDepthWrapper(e){this.mode===Pp.Material?e.shadowDepthWrapper=new BABYLON.ShadowDepthWrapper(this,this.getScene()):jh.Log("Incompatible material mode")}parseSerializedObject(e,t="",i=!1,n){i||this.clear();const a={};for(const i of e.blocks){const e=oh(i.customType);if(e){const s=new e;s._deserialize(i,this.getScene(),t,n),a[i.id]=s,this.attachedBlocks.push(s)}}for(const e of this.attachedBlocks)if(e.isTeleportOut){const t=e,i=t._tempEntryPointUniqueId;if(i){a[i].attachToEndpoint(t)}}for(let t=0;t<e.blocks.length;t++){const n=a[e.blocks[t].id];n&&(n.inputs.length&&!i||this._restoreConnections(n,e,a))}if(e.outputNodes)for(const t of e.outputNodes)this.addOutputNode(a[t]);if(e.locations||e.editorData&&e.editorData.locations){const t=e.locations||e.editorData.locations;for(const e of t)a[e.blockId]&&(e.blockId=a[e.blockId].xt);i&&this.editorData&&this.editorData.locations&&t.concat(this.editorData.locations),e.locations?this.editorData={locations:t}:(this.editorData=e.editorData,this.editorData.locations=t);const n=[];for(const e in a)n[e]=a[e].xt;this.editorData.map=n}this.comment=e.comment,void 0!==e.forceAlphaBlending&&(this.forceAlphaBlending=e.forceAlphaBlending),void 0!==e.alphaMode&&(this.alphaMode=e.alphaMode),i||(this._mode=e.mode??Pp.Material)}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}_removeVertexOutputNode(e){const t=this._vertexOutputNodes.indexOf(e);if(-1!==t)return this._vertexOutputNodes.splice(t,1),this}unregisterOptimizer(e){const t=this._optimizers.indexOf(e);if(-1!==t)return this._optimizers.splice(t,1),this}bindForSubMesh(e,t,i){const n=this.getScene(),a=i.effect;if(!a)return;this._activeEffect=a,this.bindOnlyWorldMatrix(e);const s=this._mustRebind(n,a,i,t.visibility),r=this._sharedData;if(s){for(const e of r.bindableBlocks)e.bind(a,this,t,i);for(const e of r.forcedBindableBlocks)e.bind(a,this,t,i);for(const e of r.inputBlocks)e._transmit(a,n,this)}else if(!this.isFrozen)for(const e of r.forcedBindableBlocks)e.bind(a,this,t,i);this._afterBind(t,this._activeEffect,i)}_getGlobalNodeMaterialEditor(){return"undefined"!=typeof NODEEDITOR?NODEEDITOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.NodeEditor?BABYLON:void 0}getActiveTextures(){const e=super.getActiveTextures();return this._sharedData&&e.push(...this._sharedData.textureBlocks.filter((e=>e.texture)).map((e=>e.texture))),e}needAlphaBlending(){return!this.ignoreAlpha&&(this.forceAlphaBlending||this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)}_checkInternals(e){if(this._sharedData.animatedInputs){const e=this.getScene(),t=e.getFrameId();if(this._animationFrame!==t){for(const t of this._sharedData.animatedInputs)t.animate(e);this._animationFrame=t}}for(const t of this._sharedData.bindableBlocks)t.bind(e,this);for(const t of this._sharedData.inputBlocks)t._transmit(e,this.getScene(),this)}edit(t){return new Promise((i=>{if(this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),void 0===this.BJSNODEMATERIALEDITOR){const n=t&&t.editorURL?t.editorURL:e.EditorURL;ad.LoadBabylonScript(n,(()=>{this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this._createNodeEditor(t?.nodeEditorConfig),i()}))}else this._createNodeEditor(t?.nodeEditorConfig),i()}))}_createEffectForParticles(e,t,i,n,a,s,r,o=""){let l=this.name+this._buildId+"_"+t;s||(s=new n_),r||(r=this.getScene().getMeshByName(this.name+"Particle"))||((r=new wm(this.name+"Particle",this.getScene())).reservedDataStore={hidden:!0});let c=this._buildId;const h=[];let f=o;if(!a){const o=this._processDefines(r,s);pu.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,void 0,this.shaderLanguage),e.fillDefines(h,t,!1),f=h.join("\n"),a=this.getScene().getEngine().createEffectForParticles(l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,s.toString()+"\n"+f,o?.fallbacks,i,n,e,this.shaderLanguage),e.setCustomEffect(a,t)}a.onBindObservable.add((a=>{c!==this._buildId&&(delete pu.ShadersStore[l+"PixelShader"],l=this.name+this._buildId+"_"+t,s.markAllAsDirty(),c=this._buildId),h.length=0,e.fillDefines(h,t,!1);const u=h.join("\n");u!==f&&(s.markAllAsDirty(),f=u);const d=this._processDefines(r,s);if(d)return pu.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,void 0,this.shaderLanguage),a=this.getScene().getEngine().createEffectForParticles(l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,s.toString()+"\n"+f,d?.fallbacks,i,n,e),e.setCustomEffect(a,t),void this._createEffectForParticles(e,t,i,n,a,s,r,o);this._checkInternals(a)}))}_addVertexOutputNode(e){if(-1===this._vertexOutputNodes.indexOf(e))return e.target=Lm.Vertex,this._vertexOutputNodes.push(e),this}createProceduralTexture(e,t){if(this.mode!==Pp.ProceduralTexture)return jh.Log("Incompatible material mode"),null;let i=this.name+this._buildId;const n=new e_(i,e,null,t),a=new wm(i+"Procedural",this.getScene());a.reservedDataStore={hidden:!0};const s=new n_,r=this._processDefines(a,s);pu.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage);let o=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[$h.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,s.toString(),r?.fallbacks,void 0,void 0,void 0,this.shaderLanguage);n.nodeMaterialSource=this,n._setEffect(o);let l=this._buildId;const c=()=>{l!==this._buildId&&(delete pu.ShadersStore[i+"VertexShader"],delete pu.ShadersStore[i+"PixelShader"],i=this.name+this._buildId,s.markAllAsDirty(),l=this._buildId);const e=this._processDefines(a,s);e&&(pu.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString,this.shaderLanguage),iu.SetImmediate((()=>{o=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[$h.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,s.toString(),e?.fallbacks,void 0),n._setEffect(o)}))),this._checkInternals(o)};return n.onBeforeGenerationObservable.add((()=>{c()})),this.onBuildObservable.add((()=>{c()})),n}_finishBuildProcess(t=!1,i=!0,n,a){this.optimize();for(const e of n)e.build(this._vertexCompilationState,n);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(const e of a)this._resetDualBlocks(e,this._buildId-1);for(const e of a)e.build(this._fragmentCompilationState,a);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),i&&(this._buildId=e._BuildIdGenerator++),this._sharedData.emitErrors(),t&&(jh.Log("Vertex shader:"),jh.Log(this._vertexCompilationState.compilationString),jh.Log("Fragment shader:"),jh.Log(this._fragmentCompilationState.compilationString)),this._buildIsInProgress=!1,this._buildWasSuccessful=!0,this.onBuildObservable.notifyObservers(this);const s=this.getScene().meshes;for(const e of s)if(e.subMeshes)for(const t of e.subMeshes){if(t.getMaterial()!==this)continue;if(!t.materialDefines)continue;const e=t.materialDefines;e.markAllAsDirty(),e.reset()}this.prePassTextureInputs.length&&this.getScene().enablePrePassRenderer();const r=this.getScene().prePassRenderer;r&&r.markAsDirty()}_initializeBlock(e,t,i,n=!0){if(e.initialize(t),n&&e.autoConfigure(this),e._preparationId=this._buildId,-1===this.attachedBlocks.indexOf(e)){if(e.isUnique){const t=e.getClassName();for(const e of this.attachedBlocks)if(e.getClassName()===t)throw`Cannot have multiple blocks of type ${t} in the same NodeMaterial`}this.attachedBlocks.push(e)}for(const a of e.inputs){a.associatedVariableName="";const s=a.connectedPoint;if(s){const a=s.ownerBlock;a!==e&&this._processInitializeOnLink(a,t,i,n)}}if(e.isTeleportOut){const a=e;a.entryPoint&&this._processInitializeOnLink(a.entryPoint,t,i,n)}for(const t of e.outputs)t.associatedVariableName=""}createEffectForParticles(e,t,i){this.mode===Pp.Particle?(this._createEffectForParticles(e,Fp.BLENDMODE_ONEONE,t,i),this._createEffectForParticles(e,Fp.BLENDMODE_MULTIPLY,t,i)):jh.Log("Incompatible material mode")}static async ParseFromFileAsync(t,i,n,a="",s=!1,r,o){const l=r??new e(t,n),c=await n._loadFileAsync(i),h=JSON.parse(c);return l.parseSerializedObject(h,a,void 0,o),s||l.build(),l}removeOutputNode(e){return null===e.target||(0!=(e.target&Lm.Vertex)&&this._removeVertexOutputNode(e),0!=(e.target&Lm.Fragment)&&this._removeFragmentOutputNode(e)),this}setPrePassRenderer(e){const t=this.prePassTextureInputs.concat(this.prePassTextureOutputs);if(e&&t.length>1){let i=e.getEffectConfiguration("nodeMaterial");i||(i=e.addEffectConfiguration({enabled:!0,needsImageProcessing:!1,name:"nodeMaterial",texturesRequired:[]}));for(const e of t)i.texturesRequired.includes(e)||i.texturesRequired.push(e);i.enabled=!0}return t.length>1}};a_._BuildIdGenerator=0,a_.EditorURL=`${ad._DefaultCdnUrl}/v${Tu.Version}/nodeEditor/babylon.nodeEditor.js`,a_.SnippetUrl="https://snippet.babylonjs.com",a_.IgnoreTexturesAtLoadTime=!1,a_.DefaultShaderLanguage=0,Lc([Hc()],a_.prototype,"ignoreAlpha",void 0),Lc([Hc()],a_.prototype,"maxSimultaneousLights",void 0),Lc([Hc("mode")],a_.prototype,"_mode",void 0),Lc([Hc("comment")],a_.prototype,"comment",void 0),Lc([Hc()],a_.prototype,"forceAlphaBlending",void 0),rh("BABYLON.NodeMaterial",a_);var s_=class extends $m{get world3(){return this._inputs[3]}get output(){return this._outputs[0]}get world1(){return this._inputs[1]}constructor(e){super(e,Lm.Vertex),this.registerInput("world0",Om.Vector4),this.registerInput("world1",Om.Vector4),this.registerInput("world2",Om.Vector4),this.registerInput("world3",Om.Vector4),this.registerInput("world",Om.Matrix,!0),this.registerOutput("output",Om.Matrix),this.registerOutput("instanceID",Om.Float)}get world2(){return this._inputs[2]}prepareDefines(e,t,i,n=!1,a){let s=!1;i.INSTANCES!==n&&(i.setValue("INSTANCES",n),s=!0),a&&i.THIN_INSTANCES!==!!a?.getRenderingMesh().hasThinInstances&&(i.setValue("THIN_INSTANCES",!!a?.getRenderingMesh().hasThinInstances),s=!0),s&&i.markAsUnprocessed()}getClassName(){return"InstancesBlock"}get instanceID(){return this._outputs[1]}get world0(){return this._inputs[0]}get world(){return this._inputs[4]}_buildBlock(e){super._buildBlock(e);const t=e.sharedData.scene.getEngine();e.sharedData.blocksWithDefines.push(this);const i=this._outputs[0],n=this._outputs[1],a=this.world0,s=this.world1,r=this.world2,o=this.world3;let l="mat4",c="gl_InstanceID",h="float";return 1===e.shaderLanguage&&(l="mat4x4f",c="vertexInputs.instanceIndex",h="f32"),e.compilationString+="#ifdef INSTANCES\n",e.compilationString+=e._declareOutput(i)+` = ${l}(${a.associatedVariableName}, ${s.associatedVariableName}, ${r.associatedVariableName}, ${o.associatedVariableName});\n`,e.compilationString+="#ifdef THIN_INSTANCES\n",e.compilationString+=`${i.associatedVariableName} = ${this.world.associatedVariableName} * ${i.associatedVariableName};\n`,e.compilationString+="#endif\n",t._caps.canUseGLInstanceID?e.compilationString+=e._declareOutput(n)+` = ${h}(${c});\n`:e.compilationString+=e._declareOutput(n)+" = 0.0;\n",e.compilationString+="#else\n",e.compilationString+=e._declareOutput(i)+` = ${this.world.associatedVariableName};\n`,e.compilationString+=e._declareOutput(n)+" = 0.0;\n",e.compilationString+="#endif\n",this}autoConfigure(e,t=(()=>!0)){if(!this.world0.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world0"===e.name&&t(e)));i||(i=new _p("world0"),i.setAsAttribute("world0")),i.output.connectTo(this.world0)}if(!this.world1.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world1"===e.name&&t(e)));i||(i=new _p("world1"),i.setAsAttribute("world1")),i.output.connectTo(this.world1)}if(!this.world2.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world2"===e.name&&t(e)));i||(i=new _p("world2"),i.setAsAttribute("world2")),i.output.connectTo(this.world2)}if(!this.world3.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world3"===e.name&&t(e)));i||(i=new _p("world3"),i.setAsAttribute("world3")),i.output.connectTo(this.world3)}if(!this.world.connectedPoint){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"world"===e.name&&t(e)));i||(i=new _p("world"),i.setAsSystemValue(tp.World)),i.output.connectTo(this.world)}this.world.define="!INSTANCES || THIN_INSTANCES"}};rh("BABYLON.InstancesBlock",s_);var r_=class extends Op{_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} + ${this.right.associatedVariableName};\n`,this}constructor(e){super(e)}getClassName(){return"AddBlock"}};rh("BABYLON.AddBlock",r_);rh("BABYLON.DivideBlock",class extends Op{_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} / ${this.right.associatedVariableName};\n`,this}getClassName(){return"DivideBlock"}constructor(e){super(e)}});rh("BABYLON.SubtractBlock",class extends Op{constructor(e){super(e)}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} - ${this.right.associatedVariableName};\n`,this}getClassName(){return"SubtractBlock"}});var o_=class extends $m{get value(){return this._inputs[0]}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.minimum = ${this.minimum};\n`;return e+=`${this._codeVariableName}.maximum = ${this.maximum};\n`,e}get output(){return this._outputs[0]}serialize(){const e=super.serialize();return e.minimum=this.minimum,e.maximum=this.maximum,e}constructor(e){super(e,Lm.Neutral),this.minimum=0,this.maximum=1,this.registerInput("value",Om.AutoDetect),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=1===e.shaderLanguage?e._getShaderType(this.value.type):"";return e.compilationString+=e._declareOutput(t)+` = clamp(${this.value.associatedVariableName}, ${i}(${this._writeFloat(this.minimum)}), ${i}(${this._writeFloat(this.maximum)}));\n`,this}getClassName(){return"ClampBlock"}_deserialize(e,t,i){super._deserialize(e,t,i),this.minimum=e.minimum,this.maximum=e.maximum}};Lc([ep("Minimum",1)],o_.prototype,"minimum",void 0),Lc([ep("Maximum",1)],o_.prototype,"maximum",void 0),rh("BABYLON.ClampBlock",o_);rh("BABYLON.VectorSplitterBlock",class extends $m{get xyOut(){return this._outputs[1]}constructor(e){super(e,Lm.Neutral),this.registerInput("xyzw",Om.Vector4,!0),this.registerInput("xyz ",Om.Vector3,!0),this.registerInput("xy ",Om.Vector2,!0),this.registerOutput("xyz",Om.Vector3),this.registerOutput("xy",Om.Vector2),this.registerOutput("zw",Om.Vector2),this.registerOutput("x",Om.Float),this.registerOutput("y",Om.Float),this.registerOutput("z",Om.Float),this.registerOutput("w",Om.Float),this.inputsAreExclusive=!0}get xyzIn(){return this._inputs[1]}_inputRename(e){switch(e){case"xy ":return"xyIn";case"xyz ":return"xyzIn";default:return e}}getClassName(){return"VectorSplitterBlock"}get x(){return this._outputs[3]}get zw(){return this._outputs[2]}get w(){return this._outputs[6]}get xyzOut(){return this._outputs[0]}_outputRename(e){switch(e){case"xy":return"xyOut";case"xyz":return"xyzOut";default:return e}}get y(){return this._outputs[4]}get z(){return this._outputs[5]}get xyzw(){return this._inputs[0]}get xyIn(){return this._inputs[2]}_buildBlock(e){super._buildBlock(e);const t=this.xyzw.isConnected?this.xyzw:this.xyzIn.isConnected?this.xyzIn:this.xyIn,i=this._outputs[0],n=this._outputs[1],a=this._outputs[2],s=this._outputs[3],r=this._outputs[4],o=this._outputs[5],l=this._outputs[6],c=e._getShaderType(Om.Vector3);return i.hasEndpoints&&(t===this.xyIn?e.compilationString+=e._declareOutput(i)+` = ${c}(${t.associatedVariableName}, 0.0);\n`:e.compilationString+=e._declareOutput(i)+` = ${t.associatedVariableName}.xyz;\n`),a.hasEndpoints&&this.xyzw.isConnected&&(e.compilationString+=e._declareOutput(a)+` = ${this.xyzw.associatedVariableName}.zw;\n`),n.hasEndpoints&&(e.compilationString+=e._declareOutput(n)+` = ${t.associatedVariableName}.xy;\n`),s.hasEndpoints&&(e.compilationString+=e._declareOutput(s)+` = ${t.associatedVariableName}.x;\n`),r.hasEndpoints&&(e.compilationString+=e._declareOutput(r)+` = ${t.associatedVariableName}.y;\n`),o.hasEndpoints&&(e.compilationString+=e._declareOutput(o)+` = ${t.associatedVariableName}.z;\n`),l.hasEndpoints&&(e.compilationString+=e._declareOutput(l)+` = ${t.associatedVariableName}.w;\n`),this}});var l_=class extends $m{get matricesIndicesExtra(){return this._inputs[2]}get output(){return this._outputs[0]}get matricesWeightsExtra(){return this._inputs[3]}get matricesWeights(){return this._inputs[1]}getClassName(){return"BonesBlock"}provideFallbacks(e,t){e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton&&t.addCPUSkinningFallback(0,e)}constructor(e){super(e,Lm.Vertex),this.registerInput("matricesIndices",Om.Vector4),this.registerInput("matricesWeights",Om.Vector4),this.registerInput("matricesIndicesExtra",Om.Vector4,!0),this.registerInput("matricesWeightsExtra",Om.Vector4,!0),this.registerInput("world",Om.Matrix),this.registerOutput("output",Om.Matrix)}async _initShaderSourceAsync(e){this._codeIsReady=!1,1===e?await Promise.all([Promise.resolve().then((()=>(x(),T))),Promise.resolve().then((()=>(D(),b)))]):await Promise.all([Promise.resolve().then((()=>(G(),L))),Promise.resolve().then((()=>(z(),U)))]),this._codeIsReady=!0,this.onCodeIsReadyObservable.notifyObservers(this)}_buildBlock(e){super._buildBlock(e),e.sharedData.blocksWithFallbacks.push(this),e.sharedData.forcedBindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.uniforms.push("boneTextureWidth"),e.uniforms.push("mBones"),e.samplers.push("boneSampler");const t=`//${this.name}`;e._emitFunctionFromInclude("bonesDeclaration",t,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});const i=e._getFreeVariableName("influence");e.compilationString+=e._emitCodeFromInclude("bonesVertex",t,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:i}]});const n=this._outputs[0],a=this.world;return e.compilationString+="#if NUM_BONE_INFLUENCERS>0\n",e.compilationString+=e._declareOutput(n)+` = ${a.associatedVariableName} * ${i};\n`,e.compilationString+="#else\n",e.compilationString+=e._declareOutput(n)+` = ${a.associatedVariableName};\n`,e.compilationString+="#endif\n",this}get matricesIndices(){return this._inputs[0]}prepareDefines(e,t,i){i._areAttributesDirty&&mm(e,i)}get world(){return this._inputs[4]}bind(e,t,i){nm(i,e)}autoConfigure(e,t=(()=>!0)){if(!this.matricesIndices.isConnected){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"matricesIndices"===e.name&&t(e)));i||(i=new _p("matricesIndices"),i.setAsAttribute("matricesIndices")),i.output.connectTo(this.matricesIndices)}if(!this.matricesWeights.isConnected){let i=e.getInputBlockByPredicate((e=>e.isAttribute&&"matricesWeights"===e.name&&t(e)));i||(i=new _p("matricesWeights"),i.setAsAttribute("matricesWeights")),i.output.connectTo(this.matricesWeights)}if(!this.world.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===tp.World&&t(e)));i||(i=new _p("world"),i.setAsSystemValue(tp.World)),i.output.connectTo(this.world)}}initialize(e){e._excludeVariableName("boneSampler"),e._excludeVariableName("boneTextureWidth"),e._excludeVariableName("mBones"),e._excludeVariableName("BonesPerMesh"),this._initShaderSourceAsync(e.shaderLanguage)}};rh("BABYLON.BonesBlock",l_);var c_=class extends $m{_deserialize(e,t,i){super._deserialize(e,t,i),e.lightId&&(this.light=t.getLightById(e.lightId)),this.generateOnlyFragmentCode=e.generateOnlyFragmentCode,this._setTarget()}updateUniformsAndSamples(e,t,i,n){for(let a=0;a<t.maxSimultaneousLights&&i["LIGHT"+a];a++){const t=e.uniforms.indexOf("vLightData"+a)>=0;ym(a,e.uniforms,e.samplers,i["PROJECTEDLIGHTTEXTURE"+a],n,t)}}get diffuseOutput(){return this._outputs[0]}bind(e,t,i){if(!i)return;const n=i.getScene();this.light?am(this.light,this._lightId,n,e,!0):sm(n,i,e,!0,t.maxSimultaneousLights)}_buildBlock(e){super._buildBlock(e);const t=1===e.shaderLanguage,i=t?"f":"",n=`//${this.name}`;if(e.target!==Lm.Fragment)return void this._injectVertexCode(e);this.generateOnlyFragmentCode&&e.sharedData.dynamicUniformBlocks.push(this);const a=1===e.shaderLanguage?"fragmentInputs.":"";e.sharedData.forcedBindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);const s=this.worldPosition;let r=s.associatedVariableName;this.generateOnlyFragmentCode?(r=e._getFreeVariableName("globalWorldPos"),e._emitFunction("light_globalworldpos",`${e._declareLocalVar(r,Om.Vector3)};\n`,n),e.compilationString+=`${r} = ${s.associatedVariableName}.xyz;\n`,e.compilationString+=e._emitCodeFromInclude("shadowsVertex",n,{repeatKey:"maxSimultaneousLights",substitutionVars:this.generateOnlyFragmentCode?`worldPos,${s.associatedVariableName}`:void 0})):r=a+"v_"+r+".xyz",e._emitFunctionFromInclude("helperFunctions",n),e._emitFunctionFromInclude("lightsFragmentFunctions",n,{replaceStrings:[{search:/vPositionW/g,replace:r}]}),e._emitFunctionFromInclude("shadowsFragmentFunctions",n,{replaceStrings:[{search:/vPositionW/g,replace:r}]}),this._injectUBODeclaration(e),0===this._lightId&&(e._registerTempVariable("viewDirectionW")&&(e.compilationString+=`${e._declareLocalVar("viewDirectionW",Om.Vector3)} = normalize(${this.cameraPosition.associatedVariableName} - ${r});\n`),e.compilationString+=t?"var info: lightingInfo;\n":"lightingInfo info;\n",e.compilationString+=`${e._declareLocalVar("shadow",Om.Float)} = 1.;\n`,e.compilationString+=`${e._declareLocalVar("aggShadow",Om.Float)} = 0.;\n`,e.compilationString+=`${e._declareLocalVar("numLights",Om.Float)} = 0.;\n`,e.compilationString+=`${e._declareLocalVar("glossiness",Om.Float)} = ${this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0"} * ${this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0"};\n`,e.compilationString+=`${e._declareLocalVar("diffuseBase",Om.Vector3)} = vec3${i}(0., 0., 0.);\n`,e.compilationString+=`${e._declareLocalVar("specularBase",Om.Vector3)}  = vec3${i}(0., 0., 0.);\n`,e.compilationString+=`${e._declareLocalVar("normalW",Om.Vector3)} = ${this.worldNormal.associatedVariableName}.xyz;\n`),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",n,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/vPositionW/g,replace:r+".xyz"}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",n,{repeatKey:"maxSimultaneousLights",substitutionVars:`vPositionW,${r}.xyz`}),0===this._lightId&&(e.compilationString+="aggShadow = aggShadow / numLights;\n");const o=this.diffuseOutput,l=this.specularOutput;return e.compilationString+=e._declareOutput(o)+` = diffuseBase${this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:""};\n`,l.hasEndpoints&&(e.compilationString+=e._declareOutput(l)+` = specularBase${this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:""};\n`),this.shadow.hasEndpoints&&(e.compilationString+=e._declareOutput(this.shadow)+" = aggShadow;\n"),this}get worldPosition(){return this._inputs[0]}_injectUBODeclaration(e){const t=`//${this.name}`;this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",t,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",t,{repeatKey:"maxSimultaneousLights",substitutionVars:this.generateOnlyFragmentCode?"varying,":void 0})}get glossiness(){return this._inputs[3]}get diffuseColor(){return this._inputs[5]}serialize(){const e=super.serialize();return e.generateOnlyFragmentCode=this.generateOnlyFragmentCode,this.light&&(e.lightId=this.light.id),e}prepareDefines(e,t,i){if(!i._areLightsDirty)return;const n=e.getScene();if(this.light){const t={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};um(n,e,this.light,this._lightId,i,!0,t),t.needRebuild&&i.rebuild()}else fm(n,e,i,!0,t.maxSimultaneousLights)}get worldNormal(){return this._inputs[1]}get glossPower(){return this._inputs[4]}autoConfigure(e,t=(()=>!0)){if(!this.cameraPosition.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===tp.CameraPosition&&t(e)));i||(i=new _p("cameraPosition"),i.setAsSystemValue(tp.CameraPosition)),i.output.connectTo(this.cameraPosition)}}get cameraPosition(){return this._inputs[2]}get view(){return this._inputs[7]}get shadow(){return this._outputs[2]}getClassName(){return"LightBlock"}initialize(e){this._initShaderSourceAsync(e.shaderLanguage)}_injectVertexCode(e){const t=this.worldPosition,i=`//${this.name}`;this.light?(this._lightId=(void 0!==e.counters.lightCounter?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",i,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));const n="v_"+t.associatedVariableName;e._emitVaryingFromString(n,Om.Vector4)&&(e.compilationString+=(1===e.shaderLanguage?"vertexOutputs.":"")+`${n} = ${t.associatedVariableName};\n`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:t.associatedVariableName}]}):(e.compilationString+=`${e._declareLocalVar("worldPos",Om.Vector4)} = ${t.associatedVariableName};\n`,this.view.isConnected&&(e.compilationString+=`${e._declareLocalVar("view",Om.Matrix)} = ${this.view.associatedVariableName};\n`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",i,{repeatKey:"maxSimultaneousLights"}))}_setTarget(){this._setInitialTarget(this.generateOnlyFragmentCode?Lm.Fragment:Lm.VertexAndFragment),this.getInputByName("worldPosition").target=this.generateOnlyFragmentCode?Lm.Fragment:Lm.Vertex}get specularOutput(){return this._outputs[1]}static _OnGenerateOnlyFragmentCodeChanged(e,t){const i=e;return i.worldPosition.isConnected?(i.generateOnlyFragmentCode=!i.generateOnlyFragmentCode,jh.Error("The worldPosition input must not be connected to be able to switch!"),!1):(i._setTarget(),!0)}async _initShaderSourceAsync(e){this._codeIsReady=!1,1===e?await Promise.all([Promise.resolve().then((()=>($(),X))),Promise.resolve().then((()=>(ee(),q))),Promise.resolve().then((()=>(se(),te))),Promise.resolve().then((()=>(he(),re))),Promise.resolve().then((()=>(pe(),fe))),Promise.resolve().then((()=>(ye(),_e))),Promise.resolve().then((()=>(Te(),Ee)))]):await Promise.all([Promise.resolve().then((()=>(be(),Ne))),Promise.resolve().then((()=>(Le(),Pe))),Promise.resolve().then((()=>(Ue(),Fe))),Promise.resolve().then((()=>(Xe(),He))),Promise.resolve().then((()=>(qe(),Ye))),Promise.resolve().then((()=>(tt(),Je))),Promise.resolve().then((()=>(rt(),it))),Promise.resolve().then((()=>(ft(),ot))),Promise.resolve().then((()=>(_t(),ut)))]),this._codeIsReady=!0,this.onCodeIsReadyObservable.notifyObservers(this)}get specularColor(){return this._inputs[6]}constructor(e){super(e,Lm.VertexAndFragment),this._lightId=0,this.generateOnlyFragmentCode=!1,this._isUnique=!0,this.registerInput("worldPosition",Om.Vector4,!1,Lm.Vertex),this.registerInput("worldNormal",Om.Vector4,!1,Lm.Fragment),this.registerInput("cameraPosition",Om.Vector3,!1,Lm.Fragment),this.registerInput("glossiness",Om.Float,!0,Lm.Fragment),this.registerInput("glossPower",Om.Float,!0,Lm.Fragment),this.registerInput("diffuseColor",Om.Color3,!0,Lm.Fragment),this.registerInput("specularColor",Om.Color3,!0,Lm.Fragment),this.registerInput("view",Om.Matrix,!0),this.registerOutput("diffuseOutput",Om.Color3,Lm.Fragment),this.registerOutput("specularOutput",Om.Color3,Lm.Fragment),this.registerOutput("shadow",Om.Float,Lm.Fragment)}};Lc([ep("Generate only fragment code",0,"ADVANCED",{notifiers:{rebuild:!0,update:!0,onValidation:c_._OnGenerateOnlyFragmentCodeChanged}})],c_.prototype,"generateOnlyFragmentCode",void 0),rh("BABYLON.LightBlock",c_);var h_=class extends $m{get power(){return this._inputs[1]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = pow(${this.value.associatedVariableName}, ${this.power.associatedVariableName});\n`,this}constructor(e){super(e,Lm.Neutral),this.registerInput("value",Om.AutoDetect),this.registerInput("power",Om.AutoDetect),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}get output(){return this._outputs[0]}getClassName(){return"PowBlock"}get value(){return this._inputs[0]}};rh("BABYLON.PowBlock",h_);var f_=class e extends jm{checkCompatibilityState(t){return t instanceof e&&t._blockName===this._blockName?0:1}constructor(e,t,i,n,a){super(e,t,i),this._blockType=n,this._blockName=a,this.needDualDirectionValidation=!0}createCustomInputBlock(){return[new this._blockType(this._blockName),this.name]}},u_=class e extends $m{bind(e){this.texture&&e.setTexture(this._samplerName,this.texture)}get source(){return this._outputs[0]}getClassName(){return"ImageSourceBlock"}get samplerName(){return this._samplerName}constructor(t){super(t,Lm.VertexAndFragment),this.registerOutput("source",Om.Object,Lm.VertexAndFragment,new f_("source",this,1,e,"ImageSourceBlock"))}set texture(e){if(this._texture===e)return;const t=e?.getScene()??xh.LastCreatedScene;!e&&t&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this._texture))),this._texture=e,e&&t&&t.markAllMaterialsAsDirty(1,(t=>t.hasTexture(e)))}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}_deserialize(e,t,i,n){super._deserialize(e,t,i,n),e.texture&&!a_.IgnoreTexturesAtLoadTime&&void 0!==e.texture.url&&(0===e.texture.url.indexOf("data:")?i="":n&&(e.texture.url=n(e.texture.url),e.texture.name=e.texture.url),this.texture=yp.Parse(e.texture,t,i))}_buildBlock(e){return super._buildBlock(e),e.target===Lm.Vertex&&(this._samplerName=e._getFreeVariableName(this.name+"Texture"),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.bindableBlocks.push(this)),e._emit2DSampler(this._samplerName),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return this.texture?(e+=`${this._codeVariableName}.texture = new BABYLON.Texture("${this.texture.name}", null, ${this.texture.noMipmap}, ${this.texture.invertY}, ${this.texture.samplingMode});\n`,e+=`${this._codeVariableName}.texture.wrapU = ${this.texture.wrapU};\n`,e+=`${this._codeVariableName}.texture.wrapV = ${this.texture.wrapV};\n`,e+=`${this._codeVariableName}.texture.uAng = ${this.texture.uAng};\n`,e+=`${this._codeVariableName}.texture.vAng = ${this.texture.vAng};\n`,e+=`${this._codeVariableName}.texture.wAng = ${this.texture.wAng};\n`,e+=`${this._codeVariableName}.texture.uOffset = ${this.texture.uOffset};\n`,e+=`${this._codeVariableName}.texture.vOffset = ${this.texture.vOffset};\n`,e+=`${this._codeVariableName}.texture.uScale = ${this.texture.uScale};\n`,e+=`${this._codeVariableName}.texture.vScale = ${this.texture.vScale};\n`,e+=`${this._codeVariableName}.texture.coordinatesMode = ${this.texture.coordinatesMode};\n`,e):e}serialize(){const e=super.serialize();return this.texture&&!this.texture.isRenderTarget&&"VideoTexture"!==this.texture.getClassName()&&(e.texture=this.texture.serialize()),e}get texture(){return this._texture}};rh("BABYLON.ImageSourceBlock",u_);var d_=class extends $m{_deserializeOptions(e){this._options=e,this._code=e.code.join("\n")+"\n",this.name=this.name||e.name,this.target=Lm[e.target],e.inParameters?.forEach(((e,t)=>{const i=Om[e.type];"sampler2D"===e.type||"samplerCube"===e.type?(this._inputSamplers=this._inputSamplers||[],this._inputSamplers.push(e.name),this.registerInput(e.name,Om.Object,!0,Lm.VertexAndFragment,new f_(e.name,this,0,u_,"ImageSourceBlock"))):this.registerInput(e.name,i),Object.defineProperty(this,e.name,{get:function(){return this._inputs[t]},enumerable:!0,configurable:!0})})),e.outParameters?.forEach(((e,t)=>{this.registerOutput(e.name,Om[e.type]),Object.defineProperty(this,e.name,{get:function(){return this._outputs[t]},enumerable:!0,configurable:!0}),"BasedOnInput"===e.type&&(this._outputs[t]._typeConnectionSource=this._findInputByName(e.typeFromInput)[0])})),e.inLinkedConnectionTypes?.forEach((e=>{this._linkConnectionTypes(this._findInputByName(e.input1)[1],this._findInputByName(e.input2)[1])}))}serialize(){const e=super.serialize();return e.options=this._options,e}get options(){return this._options}_buildBlock(e){super._buildBlock(e);let t=this._code,i=this._options.functionName;this._inputs.forEach((n=>{const a=new RegExp("\\{TYPE_"+n.name+"\\}","gm"),s=e._getGLType(n.type);t=t.replace(a,s),i=i.replace(a,s)})),this._outputs.forEach((n=>{const a=new RegExp("\\{TYPE_"+n.name+"\\}","gm"),s=e._getGLType(n.type);t=t.replace(a,s),i=i.replace(a,s)})),e._emitFunction(i,t,""),this._outputs.forEach((t=>{e.compilationString+=e._declareOutput(t)+";\n"})),e.compilationString+=i+"(";let n=!1;return this._inputs.forEach(((t,i)=>{i>0&&(e.compilationString+=", "),this._inputSamplers&&-1!==this._inputSamplers.indexOf(t.name)?e.compilationString+=t.connectedPoint?.ownerBlock?.samplerName??t.associatedVariableName:e.compilationString+=t.associatedVariableName,n=!0})),this._outputs.forEach(((t,i)=>{(i>0||n)&&(e.compilationString+=", "),e.compilationString+=t.associatedVariableName})),e.compilationString+=");\n",this}constructor(e){super(e)}set options(e){this._deserializeOptions(e)}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.options = ${JSON.stringify(this._options)};\n`,e}_findInputByName(e){if(!e)return null;for(let t=0;t<this._inputs.length;t++)if(this._inputs[t].name===e)return[this._inputs[t],t];return null}getClassName(){return"CustomBlock"}_deserialize(e,t,i){this._deserializeOptions(e.options),super._deserialize(e,t,i)}};rh("BABYLON.CustomBlock",d_);var m_=class extends $m{getClassName(){return"ScaleBlock"}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.input.associatedVariableName} * ${this.factor.associatedVariableName};\n`,this}get input(){return this._inputs[0]}get factor(){return this._inputs[1]}constructor(e){super(e,Lm.Neutral),this.registerInput("input",Om.AutoDetect),this.registerInput("factor",Om.Float),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}};rh("BABYLON.ScaleBlock",m_);var p_=class extends $m{get gradient(){return this._inputs[2]}get right(){return this._inputs[1]}getClassName(){return"LerpBlock"}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = mix(${this.left.associatedVariableName} , ${this.right.associatedVariableName}, ${this.gradient.associatedVariableName});\n`,this}get left(){return this._inputs[0]}constructor(e){super(e,Lm.Neutral),this.registerInput("left",Om.AutoDetect),this.registerInput("right",Om.AutoDetect),this.registerInput("gradient",Om.AutoDetect),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._linkConnectionTypes(1,2,!0),this._inputs[2].acceptedConnectionPointTypes.push(Om.Float)}};rh("BABYLON.LerpBlock",p_);var __=class extends $m{get value(){return this._inputs[0]}get edge(){return this._inputs[1]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = step(${this.edge.associatedVariableName}, ${this.value.associatedVariableName});\n`,this}constructor(e){super(e,Lm.Neutral),this.registerInput("value",Om.Float),this.registerInput("edge",Om.Float),this.registerOutput("output",Om.Float)}get output(){return this._outputs[0]}getClassName(){return"StepBlock"}};rh("BABYLON.StepBlock",__);var v_=class extends $m{constructor(e){super(e,Lm.Neutral),this.registerInput("worldPosition",Om.Vector4),this.registerInput("cameraPosition",Om.Vector3),this.registerOutput("output",Om.Vector3)}getClassName(){return"ViewDirectionBlock"}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = normalize(${this.cameraPosition.associatedVariableName} - ${this.worldPosition.associatedVariableName}.xyz);\n`,this}autoConfigure(e,t=(()=>!0)){if(!this.cameraPosition.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===tp.CameraPosition&&t(e)));i||(i=new _p("cameraPosition"),i.setAsSystemValue(tp.CameraPosition)),i.output.connectTo(this.cameraPosition)}}get cameraPosition(){return this._inputs[1]}get worldPosition(){return this._inputs[0]}};rh("BABYLON.ViewDirectionBlock",v_);var g_,S_,y_=class extends $m{get output(){return this._outputs[0]}get left(){return this._inputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = dot(${this.left.associatedVariableName}, ${this.right.associatedVariableName});\n`,this}getClassName(){return"DotBlock"}get right(){return this._inputs[1]}constructor(e){super(e,Lm.Neutral),this.registerInput("left",Om.AutoDetect),this.registerInput("right",Om.AutoDetect),this.registerOutput("output",Om.Float),this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(Om.Float),this._inputs[0].excludedConnectionPointTypes.push(Om.Matrix),this._inputs[1].excludedConnectionPointTypes.push(Om.Float),this._inputs[1].excludedConnectionPointTypes.push(Om.Matrix)}};rh("BABYLON.DotBlock",y_),(S_=g_||(g_={}))[S_.Equal=0]="Equal",S_[S_.NotEqual=1]="NotEqual",S_[S_.LessThan=2]="LessThan",S_[S_.GreaterThan=3]="GreaterThan",S_[S_.LessOrEqual=4]="LessOrEqual",S_[S_.GreaterOrEqual=5]="GreaterOrEqual",S_[S_.Xor=6]="Xor",S_[S_.Or=7]="Or",S_[S_.And=8]="And";rh("BABYLON.ConditionalBlock",class extends $m{get a(){return this._inputs[0]}get true(){return this._inputs[2]}get output(){return this._outputs[0]}get false(){return this._inputs[3]}getClassName(){return"ConditionalBlock"}constructor(e){super(e,Lm.Neutral),this.condition=g_.LessThan,this.registerInput("a",Om.Float),this.registerInput("b",Om.Float),this.registerInput("true",Om.AutoDetect,!0),this.registerInput("false",Om.AutoDetect,!0),this.registerOutput("output",Om.BasedOnInput),this._linkConnectionTypes(2,3),this._outputs[0]._typeConnectionSource=this._inputs[2],this._outputs[0]._defaultConnectionPointType=Om.Float}get b(){return this._inputs[1]}_deserialize(e,t,i){super._deserialize(e,t,i),this.condition=e.condition}serialize(){const e=super.serialize();return e.condition=this.condition,e}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=this.true.isConnected?this.true.associatedVariableName:"1.0",n=this.false.isConnected?this.false.associatedVariableName:"0.0";switch(this.condition){case g_.Equal:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`${this.a.associatedVariableName} == ${this.b.associatedVariableName}`)};\n`;break;case g_.NotEqual:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`${this.a.associatedVariableName} != ${this.b.associatedVariableName}`)};\n`;break;case g_.LessThan:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`${this.a.associatedVariableName} < ${this.b.associatedVariableName}`)};\n`;break;case g_.LessOrEqual:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`${this.a.associatedVariableName} <= ${this.b.associatedVariableName}`)};\n`;break;case g_.GreaterThan:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`${this.a.associatedVariableName} > ${this.b.associatedVariableName}`)};\n`;break;case g_.GreaterOrEqual:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`${this.a.associatedVariableName} >= ${this.b.associatedVariableName}`)};\n`;break;case g_.Xor:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`(((${this.a.associatedVariableName} + ${this.b.associatedVariableName}) % 2.0) > 0.0)`)};\n`;break;case g_.Or:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`(min(${this.a.associatedVariableName} + ${this.b.associatedVariableName}, 1.0) > 0.0)`)};\n`;break;case g_.And:e.compilationString+=e._declareOutput(t)+` = ${e._generateTernary(i,n,`(${this.a.associatedVariableName} * ${this.b.associatedVariableName} > 0.0)`)};\n`}return this}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.condition = BABYLON.ConditionalBlockConditions.${g_[this.condition]};\n`}});var E_=class extends $m{get output(){return this._outputs[0]}get input(){return this._inputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = 1. - ${this.input.associatedVariableName};\n`,this}constructor(e){super(e,Lm.Neutral),this.registerInput("input",Om.AutoDetect),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0].excludedConnectionPointTypes.push(Om.Matrix)}getClassName(){return"OneMinusBlock"}};rh("BABYLON.OneMinusBlock",E_),rh("BABYLON.OppositeBlock",E_);rh("BABYLON.MaxBlock",class extends $m{get output(){return this._outputs[0]}constructor(e){super(e,Lm.Neutral),this.registerInput("left",Om.AutoDetect),this.registerInput("right",Om.AutoDetect),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}get left(){return this._inputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = max(${this.left.associatedVariableName}, ${this.right.associatedVariableName});\n`,this}get right(){return this._inputs[1]}getClassName(){return"MaxBlock"}});rh("BABYLON.DistanceBlock",class extends $m{constructor(e){super(e,Lm.Neutral),this.registerInput("left",Om.AutoDetect),this.registerInput("right",Om.AutoDetect),this.registerOutput("output",Om.Float),this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(Om.Float),this._inputs[0].excludedConnectionPointTypes.push(Om.Matrix),this._inputs[1].excludedConnectionPointTypes.push(Om.Float),this._inputs[1].excludedConnectionPointTypes.push(Om.Matrix)}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = length(${this.left.associatedVariableName} - ${this.right.associatedVariableName});\n`,this}get right(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"DistanceBlock"}get left(){return this._inputs[0]}});var A_=class extends $m{initialize(e){this._initShaderSourceAsync(e.shaderLanguage)}get worldPosition(){return this._inputs[0]}get output(){return this._outputs[0]}get input(){return this._inputs[2]}_buildBlock(e){if(super._buildBlock(e),e.target===Lm.Fragment){e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this);let t=[],i="",n="";1===e.shaderLanguage?(t=[{search:/fn CalcFogFactor\(\)/,replace:"fn CalcFogFactor(vFogDistance: vec3f, vFogInfos: vec4f)"},{search:/uniforms.vFogInfos/g,replace:"vFogInfos"},{search:/fragmentInputs.vFogDistance/g,replace:"vFogDistance"}],i="fragmentInputs.",n="uniforms."):t=[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}],e._emitFunctionFromInclude("fogFragmentDeclaration",`//${this.name}`,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:t});const a=e._getFreeVariableName("fog"),s=this.input,r=this.fogColor;this._fogParameters=e._getFreeVariableName("fogParameters");const o=this._outputs[0];e._emitUniformFromString(this._fogParameters,Om.Vector4),e.compilationString+="#ifdef FOG\n",e.compilationString+=`${e._declareLocalVar(a,Om.Float)} = CalcFogFactor(${i}${this._fogDistanceName}, ${n}${this._fogParameters});\n`,e.compilationString+=e._declareOutput(o)+` = ${a} * ${s.associatedVariableName}.rgb + (1.0 - ${a}) * ${r.associatedVariableName}.rgb;\n`,e.compilationString+=`#else\n${e._declareOutput(o)} =  ${s.associatedVariableName}.rgb;\n`,e.compilationString+="#endif\n"}else{const t=this.worldPosition,i=this.view;this._fogDistanceName=e._getFreeVariableName("vFogDistance"),e._emitVaryingFromString(this._fogDistanceName,Om.Vector3);const n=1===e.shaderLanguage?"vertexOutputs.":"";e.compilationString+=`${n}${this._fogDistanceName} = (${i.associatedVariableName} * ${t.associatedVariableName}).xyz;\n`}return this}get fogColor(){return this._inputs[3]}async _initShaderSourceAsync(e){this._codeIsReady=!1,1===e?await Promise.resolve().then((()=>(Et(),vt))):await Promise.resolve().then((()=>(Nt(),At))),this._codeIsReady=!0,this.onCodeIsReadyObservable.notifyObservers(this)}getClassName(){return"FogBlock"}constructor(e){super(e,Lm.VertexAndFragment,!1),this.registerInput("worldPosition",Om.Vector4,!1,Lm.Vertex),this.registerInput("view",Om.Matrix,!1,Lm.Vertex),this.registerInput("input",Om.AutoDetect,!1,Lm.Fragment),this.registerInput("fogColor",Om.AutoDetect,!1,Lm.Fragment),this.registerOutput("output",Om.Color3,Lm.Fragment),this.input.addExcludedConnectionPointFromAllowedTypes(Om.Color3|Om.Vector3|Om.Color4),this.fogColor.addExcludedConnectionPointFromAllowedTypes(Om.Color3|Om.Vector3|Om.Color4)}get view(){return this._inputs[1]}autoConfigure(e,t=(()=>!0)){if(!this.view.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===tp.View&&t(e)));i||(i=new _p("view"),i.setAsSystemValue(tp.View)),i.output.connectTo(this.view)}if(!this.fogColor.isConnected){let i=e.getInputBlockByPredicate((e=>e.systemValue===tp.FogColor&&t(e)));i||(i=new _p("fogColor",void 0,Om.Color3),i.setAsSystemValue(tp.FogColor)),i.output.connectTo(this.fogColor)}}bind(e,t,i){if(!i)return;const n=i.getScene();e.setFloat4(this._fogParameters,n.fogMode,n.fogStart,n.fogEnd,n.fogDensity)}prepareDefines(e,t,i){const n=e.getScene();i.setValue("FOG",t.fogEnabled&&cm(e,n))}};rh("BABYLON.FogBlock",A_);rh("BABYLON.NegateBlock",class extends $m{getClassName(){return"NegateBlock"}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = -1.0 * ${this.value.associatedVariableName};\n`,this}get value(){return this._inputs[0]}constructor(e){super(e,Lm.Neutral),this.registerInput("value",Om.AutoDetect),this.registerOutput("output",Om.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}get output(){return this._outputs[0]}});rh("BABYLON.ShadowMapBlock",class extends $m{getClassName(){return"ShadowMapBlock"}get depth(){return this._outputs[0]}get viewProjection(){return this._inputs[1]}get worldPosition(){return this._inputs[0]}async _initShaderSourceAsync(e){this._codeIsReady=!1,1===e?await Promise.all([Promise.resolve().then((()=>(Pt(),Mt))),Promise.resolve().then((()=>(Ft(),wt))),Promise.resolve().then((()=>(Ht(),kt)))]):await Promise.all([Promise.resolve().then((()=>(Yt(),Vt))),Promise.resolve().then((()=>(Jt(),jt))),Promise.resolve().then((()=>(ii(),Qt)))]),this._codeIsReady=!0,this.onCodeIsReadyObservable.notifyObservers(this)}_buildBlock(e){super._buildBlock(e);const t=`//${this.name}`,i=1===e.shaderLanguage;e._emitUniformFromString("biasAndScaleSM",Om.Vector3),e._emitUniformFromString("lightDataSM",Om.Vector3),e._emitUniformFromString("depthValuesSM",Om.Vector2),e._emitFunctionFromInclude("packingFunctions",t),e.compilationString+=`${e._declareLocalVar("worldPos",Om.Vector4)} = ${this.worldPosition.associatedVariableName};\n`,e.compilationString+=`${e._declareLocalVar("vPositionWSM",Om.Vector3)};\n`,e.compilationString+=`${e._declareLocalVar("vDepthMetricSM",Om.Float)} = 0.0;\n`,e.compilationString+=`${e._declareLocalVar("zSM",Om.Float)};\n`,this.worldNormal.isConnected&&(e.compilationString+=`${e._declareLocalVar("vNormalW",Om.Vector3)} = ${this.worldNormal.associatedVariableName}.xyz;\n`,e.compilationString+=e._emitCodeFromInclude("shadowMapVertexNormalBias",t)),e.compilationString+=`${e._declareLocalVar("clipPos",Om.Vector4)} = ${this.viewProjection.associatedVariableName} * worldPos;\n`,e.compilationString+=e._emitCodeFromInclude("shadowMapVertexMetric",t,{replaceStrings:[{search:/gl_Position/g,replace:"clipPos"},{search:/vertexOutputs.position/g,replace:"clipPos"}]}),e.compilationString+=e._emitCodeFromInclude("shadowMapFragment",t,{replaceStrings:[{search:/return;/g,replace:""}]});const n=i?"fragmentOutputs.fragDepth":"gl_FragDepth";return e.compilationString+=`\n            #if SM_DEPTHTEXTURE == 1\n                #ifdef IS_NDC_HALF_ZRANGE\n                    ${n} = (clipPos.z / clipPos.w);\n                #else\n                    ${n} = (clipPos.z / clipPos.w) * 0.5 + 0.5;\n                #endif\n            #endif\n        `,e.compilationString+=`${e._declareOutput(this.depth)} = vec3${e.fSuffix}(depthSM, 1., 1.);\n`,this}initialize(e){e._excludeVariableName("vPositionWSM"),e._excludeVariableName("lightDataSM"),e._excludeVariableName("biasAndScaleSM"),e._excludeVariableName("depthValuesSM"),e._excludeVariableName("clipPos"),e._excludeVariableName("worldPos"),e._excludeVariableName("zSM"),this._initShaderSourceAsync(e.shaderLanguage)}constructor(e){super(e,Lm.Fragment),this.registerInput("worldPosition",Om.Vector4,!1),this.registerInput("viewProjection",Om.Matrix,!1),this.registerInput("worldNormal",Om.AutoDetect,!0),this.registerOutput("depth",Om.Vector3),this.worldNormal.addExcludedConnectionPointFromAllowedTypes(Om.Color3|Om.Vector3|Om.Vector4)}get worldNormal(){return this._inputs[2]}});var C_={standard:function(e,t){var i=new a_(e,t);i.mode=Pp.Material;var n=new _p("position");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.setAsAttribute("position");var a=new qm("WorldPos");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.complementZ=0,a.complementW=1;var s=new l_("Bones");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1;var r=new _p("matricesIndices");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsAttribute("matricesIndices");var o=new _p("matricesWeights");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("matricesWeights");var l=new _p("World");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsSystemValue(tp.World);var c=new qm("Transform");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.complementZ=0,c.complementW=0;var h=new _p("normal");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsAttribute("normal");var f=new c_("Lights");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=3;var u=new _p("cameraPosition");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1,u.setAsSystemValue(tp.CameraPosition);var d=new Dp("Multiply");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=4;var m=new h_("Pow");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=4;var p=new kp("ColorSplitter");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;var _=new _p("color");_.visibleInInspector=!1,_.visibleOnFrame=!1,_.target=1,_.setAsAttribute("color");var v=new xp("VectorMerger");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=4,v.xSwizzle="x",v.ySwizzle="y",v.zSwizzle="z",v.wSwizzle="w";var g=new _p("Float");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1,g.value=.5,g.min=0,g.max=0,g.isBoolean=!1,g.matrixMode=0,g.animationType=rp.None,g.isConstant=!1;var S=new r_("Add");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=4;var y=new _p("emissiveColor");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=1,y.value=new Ah(0,0,0),y.isConstant=!1;var E=new sp("FragmentOutput");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=2,E.convertToGammaSpace=!1,E.convertToLinearSpace=!1,E.useLogarithmicDepth=!1;var A=new qm("WorldPos * ViewProjectionTransform");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1,A.complementZ=0,A.complementW=1;var C=new _p("ViewProjection");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=1,C.setAsSystemValue(tp.ViewProjection);var R=new Zm("VertexOutput");return R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=1,n.output.connectTo(a.vector),r.output.connectTo(s.matricesIndices),o.output.connectTo(s.matricesWeights),l.output.connectTo(s.world),s.output.connectTo(a.transform),a.output.connectTo(A.vector),C.output.connectTo(A.transform),A.output.connectTo(R.vector),y.output.connectTo(S.left),a.output.connectTo(f.worldPosition),h.output.connectTo(c.vector),s.output.connectTo(c.transform),c.output.connectTo(f.worldNormal),u.output.connectTo(f.cameraPosition),f.diffuseOutput.connectTo(d.left),_.output.connectTo(p.rgba),p.rgbOut.connectTo(m.value),g.output.connectTo(v.x),g.output.connectTo(v.y),g.output.connectTo(v.z),v.xyz.connectTo(m.power),m.output.connectTo(d.right),d.output.connectTo(S.right),S.output.connectTo(E.rgb),i.addOutputNode(R),i.addOutputNode(E),i.build(),i},shell:function(e,t){var i=new a_(e,t);i.mode=Pp.Material;var n=new _p("position");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.setAsAttribute("position");var a=new qm("WorldPos");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.complementZ=0,a.complementW=1;var s=new l_("Bones");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1;var r=new _p("matricesIndices");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsAttribute("matricesIndices");var o=new _p("matricesWeights");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("matricesWeights");var l=new _p("World");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsSystemValue(tp.World);var c=new qm("Transform");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.complementZ=0,c.complementW=0;var h=new _p("normal");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsAttribute("normal");var f=new d_("StampNormal");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.options={name:"StampNormal",comments:"Calculate stamp normal",target:"Vertex",inParameters:[{name:"vPosition",type:"Vector3"},{name:"vNormal",type:"Vector3"},{name:"stampPosition",type:"Vector2"}],outParameters:[{name:"vUV",type:"Vector2"},{name:"stampNormal",type:"Vector3"}],functionName:"eggStampNormal",code:["mat4 rotationMatrix(vec3 axis, float angle) {","axis = normalize(axis);","float s = sin(angle);","float c = cos(angle);","float oc = 1.0 - c;","return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","0.0,                                0.0,                                0.0,                                1.0);","}","void eggStampNormal(vec3 vPosition, vec3 vNormal, vec2 stampPosition, out vec2 vUV, out vec3 stampNormal) {","mat4 rotY = rotationMatrix(vec3(0., 1., 0.), stampPosition.x * 0.01745329 * 2.5); // stampPosition is a value from -1 to 1, multiply that with max angle","mat4 rotX = rotationMatrix(vec3(1., 0., 0.), stampPosition.y * 0.01745329 * 2.5);","vec4 pos = rotX * rotY * vec4(vPosition, 1.);","// Project the stamp","vUV = pos.xy * 0.118; // base scale","vUV = vUV + vec2(0.03125, 0.03125) / 2.; // half stamp offset","vUV.x = 0.03125 - vUV.x; // flip axis","vUV.y = vUV.y + 0.00125; // position correction","//vUV = vUV - stampPosition / 100.;","stampNormal = (rotX * rotY * vec4(vNormal, 1.)).xyz;","}"]};var u=new _p("stampPosition");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1,u.value=new Ph(.003,.001),u.isConstant=!1;var d=new d_("EggStamp");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=2,d.options={name:"EggStamp",comments:"Sample selected stamp",target:"Fragment",inParameters:[{name:"source",type:"sampler2D"},{name:"color",type:"Color3"},{name:"vUV",type:"Vector2"},{name:"stampOffset",type:"Vector2"},{name:"stampNormal",type:"Vector3"}],outParameters:[{name:"rgb",type:"Color3"}],functionName:"eggStamp",code:["void eggStamp(sampler2D source, vec3 color, vec2 vUV, vec2 stampOffset, vec3 stampNormal, out vec3 rgb) {","float d = dot(stampNormal, vec3(0.0, 0.0, 1.0));","vec2 uv = clamp(vUV, vec2(0., 0.), vec2(0.03125, 0.03125));","uv += stampOffset - vec2(0., 0.03125);","vec4 stampColor = texture2D(source, uv);","if (d > -0.1) {","stampColor.a = 0.;","}","rgb = mix(color.rgb, stampColor.rgb, stampColor.a);","}"]};var m=new u_("ImageSource");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=3;var p=new Dp("Multiply");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;var _=new _p("customColor");_.visibleInInspector=!0,_.visibleOnFrame=!1,_.target=1,_.value=new Ah(1,1,1),_.isConstant=!1;var v=new h_("Pow");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=4;var g=new o_("Clamp");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=2,g.minimum=0,g.maximum=1;var S=new m_("Scale");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=1;var y=new r_("Add");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=1;var E=new kp("ColorSplitter");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=4;var A=new _p("color");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1,A.setAsAttribute("color");var C=new m_("Scale");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=1;var R=new _p("Color3");R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=1,R.value=new Ah(.16470588235294117,.16470588235294117,.16470588235294117),R.isConstant=!0;var T=new _p("hp");T.visibleInInspector=!0,T.visibleOnFrame=!1,T.target=1,T.value=0,T.min=0,T.max=1,T.isBoolean=!1,T.matrixMode=0,T.animationType=rp.None,T.isConstant=!1;var N=new _p("Float");N.visibleInInspector=!1,N.visibleOnFrame=!1,N.target=1,N.value=6,N.min=0,N.max=0,N.isBoolean=!1,N.matrixMode=0,N.animationType=rp.None,N.isConstant=!0;var M=new xp("VectorMerger");M.visibleInInspector=!1,M.visibleOnFrame=!1,M.target=4,M.xSwizzle="x",M.ySwizzle="y",M.zSwizzle="z",M.wSwizzle="w";var I=new _p("Float");I.visibleInInspector=!1,I.visibleOnFrame=!1,I.target=1,I.value=.5,I.min=0,I.max=0,I.isBoolean=!1,I.matrixMode=0,I.animationType=rp.None,I.isConstant=!1;var x=new _p("stampOffset");x.visibleInInspector=!1,x.visibleOnFrame=!1,x.target=1,x.value=new Ph(.003,.001),x.isConstant=!1;var b=new Dp("Multiply");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=4;var P=new c_("Lights");P.visibleInInspector=!1,P.visibleOnFrame=!1,P.target=3;var w=new _p("cameraPosition");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=1,w.setAsSystemValue(tp.CameraPosition);var O=new p_("Lerp");O.visibleInInspector=!1,O.visibleOnFrame=!1,O.target=2;var D=new kp("ColorSplitter");D.visibleInInspector=!1,D.visibleOnFrame=!1,D.target=1;var L=new _p("teamColor");L.visibleInInspector=!0,L.visibleOnFrame=!1,L.target=1,L.value=new Ch(1,0,0,.3137254901960784),L.isConstant=!1;var F=new __("Step");F.visibleInInspector=!1,F.visibleOnFrame=!1,F.target=4;var k=new y_("Dot");k.visibleInInspector=!1,k.visibleOnFrame=!1,k.target=1;var B=new v_("View direction");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=1;var G=new _p("cameraPosition");G.visibleInInspector=!1,G.visibleOnFrame=!1,G.target=1,G.setAsSystemValue(tp.CameraPosition);var U=new sp("FragmentOutput");U.visibleInInspector=!1,U.visibleOnFrame=!1,U.target=2,U.convertToGammaSpace=!1,U.convertToLinearSpace=!1,U.useLogarithmicDepth=!1;var H=new qm("WorldPos * ViewProjectionTransform");H.visibleInInspector=!1,H.visibleOnFrame=!1,H.target=1,H.complementZ=0,H.complementW=1;var V=new _p("ViewProjection");V.visibleInInspector=!1,V.visibleOnFrame=!1,V.target=1,V.setAsSystemValue(tp.ViewProjection);var W=new Zm("VertexOutput");return W.visibleInInspector=!1,W.visibleOnFrame=!1,W.target=1,n.output.connectTo(a.vector),r.output.connectTo(s.matricesIndices),o.output.connectTo(s.matricesWeights),l.output.connectTo(s.world),s.output.connectTo(a.transform),a.output.connectTo(H.vector),V.output.connectTo(H.transform),H.output.connectTo(W.vector),L.output.connectTo(D.rgba),D.rgbOut.connectTo(O.left),a.output.connectTo(P.worldPosition),h.output.connectTo(c.vector),s.output.connectTo(c.transform),c.output.connectTo(P.worldNormal),w.output.connectTo(P.cameraPosition),P.diffuseOutput.connectTo(b.left),m.source.connectTo(d.source),_.output.connectTo(p.left),A.output.connectTo(E.rgba),E.rgbOut.connectTo(y.left),R.output.connectTo(C.input),T.output.connectTo(C.factor),C.output.connectTo(y.right),y.output.connectTo(S.input),N.output.connectTo(S.factor),S.output.connectTo(g.value),g.output.connectTo(v.value),I.output.connectTo(M.x),I.output.connectTo(M.y),I.output.connectTo(M.z),M.xyz.connectTo(v.power),v.output.connectTo(p.right),p.output.connectTo(d.color),n.output.connectTo(f.vPosition),h.output.connectTo(f.vNormal),u.output.connectTo(f.stampPosition),f.vUV.connectTo(d.vUV),x.output.connectTo(d.stampOffset),f.stampNormal.connectTo(d.stampNormal),d.rgb.connectTo(b.right),b.output.connectTo(O.right),a.output.connectTo(B.worldPosition),G.output.connectTo(B.cameraPosition),B.output.connectTo(k.left),c.xyz.connectTo(k.right),k.output.connectTo(F.value),D.a.connectTo(F.edge),F.output.connectTo(O.gradient),O.output.connectTo(U.rgb),i.addOutputNode(W),i.addOutputNode(U),i.build(),i},instanced:function(e,t){var i=new a_(e,t);i.mode=Pp.Material;var n=new _p("position");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.setAsAttribute("position");var a=new qm("WorldPos");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.complementZ=0,a.complementW=1;var s=new s_("Instances");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1;var r=new _p("world0");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsAttribute("world0");var o=new _p("world1");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("world1");var l=new _p("world2");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsAttribute("world2");var c=new _p("world3");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsAttribute("world3");var h=new _p("world");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsSystemValue(tp.World);var f=new qm("Transform");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.complementZ=0,f.complementW=0;var u=new _p("normal");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1,u.setAsAttribute("normal");var d=new c_("Lights");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=3;var m=new _p("cameraPosition");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1,m.setAsSystemValue(tp.CameraPosition);var p=new Dp("Multiply");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;var _=new h_("Pow");_.visibleInInspector=!1,_.visibleOnFrame=!1,_.target=4;var v=new kp("ColorSplitter");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=4;var g=new _p("color");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1,g.setAsAttribute("color");var S=new xp("VectorMerger");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=4,S.xSwizzle="x",S.ySwizzle="y",S.zSwizzle="z",S.wSwizzle="w";var y=new _p("Float");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=1,y.value=.5,y.min=0,y.max=0,y.isBoolean=!1,y.matrixMode=0,y.animationType=rp.None,y.isConstant=!1;var E=new sp("FragmentOutput");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=2,E.convertToGammaSpace=!1,E.convertToLinearSpace=!1,E.useLogarithmicDepth=!1;var A=new qm("WorldPos * ViewProjectionTransform");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1,A.complementZ=0,A.complementW=1;var C=new _p("ViewProjection");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=1,C.setAsSystemValue(tp.ViewProjection);var R=new Zm("VertexOutput");return R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=1,n.output.connectTo(a.vector),r.output.connectTo(s.world0),o.output.connectTo(s.world1),l.output.connectTo(s.world2),c.output.connectTo(s.world3),h.output.connectTo(s.world),s.output.connectTo(a.transform),a.output.connectTo(A.vector),C.output.connectTo(A.transform),A.output.connectTo(R.vector),a.output.connectTo(d.worldPosition),u.output.connectTo(f.vector),s.output.connectTo(f.transform),f.output.connectTo(d.worldNormal),m.output.connectTo(d.cameraPosition),d.diffuseOutput.connectTo(p.left),g.output.connectTo(v.rgba),v.rgbOut.connectTo(_.value),y.output.connectTo(S.x),y.output.connectTo(S.y),y.output.connectTo(S.z),S.xyz.connectTo(_.power),_.output.connectTo(p.right),p.output.connectTo(E.rgb),i.addOutputNode(R),i.addOutputNode(E),i.build(),i},bullet:function(e,t){var i=new a_(e,t);i.mode=Pp.Material;var n=new _p("position");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.setAsAttribute("position");var a=new qm("WorldPos");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.complementZ=0,a.complementW=1;var s=new s_("Instances");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1;var r=new _p("world0");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.setAsAttribute("world0");var o=new _p("world1");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsAttribute("world1");var l=new _p("world2");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.setAsAttribute("world2");var c=new _p("world3");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsAttribute("world3");var h=new _p("world");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsSystemValue(tp.World);var f=new qm("WorldPos * ViewProjectionTransform");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,f.complementZ=0,f.complementW=1;var u=new _p("ViewProjection");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1,u.setAsSystemValue(tp.ViewProjection);var d=new Zm("VertexOutput");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=1;var m=new _p("color");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1,m.setAsAttribute("color");var p=new sp("FragmentOutput");return p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=2,p.convertToGammaSpace=!1,p.convertToLinearSpace=!1,p.useLogarithmicDepth=!1,n.output.connectTo(a.vector),r.output.connectTo(s.world0),o.output.connectTo(s.world1),l.output.connectTo(s.world2),c.output.connectTo(s.world3),h.output.connectTo(s.world),s.output.connectTo(a.transform),a.output.connectTo(f.vector),u.output.connectTo(f.transform),f.output.connectTo(d.vector),m.output.connectTo(p.rgba),i.addOutputNode(d),i.addOutputNode(p),i.build(),i},map:function(e,t){var i=new a_(e,t);i.mode=Pp.Material;var n=new _p("position");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.setAsAttribute("position");var a=new qm("WorldPos");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.complementZ=0,a.complementW=1;var s=new _p("World");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1,s.setAsSystemValue(tp.World);var r=new qm("WorldPos * ViewProjectionTransform");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=1;var o=new _p("ViewProjection");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsSystemValue(tp.ViewProjection);var l=new Zm("VertexOutput");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1;var c=new A_("Fog");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=3;var h=new _p("view");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1,h.setAsSystemValue(tp.View);var f=new Dp("Multiply");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=4;var u=new h_("Pow");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=4;var d=new kp("ColorSplitter");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=4;var m=new _p("color");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1,m.setAsAttribute("color");var p=new _p("Vector3");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=1,p.value=new wh(.5,.5,.5),p.isConstant=!1;var _=new d_("Shadow");_.visibleInInspector=!1,_.visibleOnFrame=!1,_.target=2,_.options={name:"Shadow",comments:"Custom shadow shit",target:"Fragment",inParameters:[{name:"posFromLight",type:"Vector4"},{name:"shadowSampler",type:"sampler2D"}],outParameters:[{name:"output",type:"Float"}],functionName:"computeShadow",code:["void computeShadow(vec4 posFromLight, sampler2D shadowSampler, out float result) {","vec3 depth = posFromLight.xyz / posFromLight.w;","depth = 0.5 * depth + vec3(0.5);","vec2 uv = depth.xy;","float s = texture2D(shadowSampler, uv).x;","if (s < 1.) {","float d = depth.z;","s = 1. - (s - d) * 80. - 1.;","if (s < 0.) s = 1.;","s = clamp(s, 0., 1.);","}","else {","s = 1.;","}","result = s;","}"]};var v=new qm("Transform");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1,v.complementZ=0,v.complementW=1;var g=new _p("shadowLightMatrix ");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1,g.value=Lh.FromArray([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),g.isConstant=!1;var S=new u_("shadowSampler");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=3;var y=new _p("fogColor");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=1,y.setAsSystemValue(tp.FogColor);var E=new sp("FragmentOutput");return E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=2,E.convertToGammaSpace=!1,E.convertToLinearSpace=!1,E.useLogarithmicDepth=!1,n.output.connectTo(a.vector),s.output.connectTo(a.transform),a.output.connectTo(r.vector),o.output.connectTo(r.transform),r.output.connectTo(l.vector),a.output.connectTo(c.worldPosition),h.output.connectTo(c.view),m.output.connectTo(d.rgba),d.rgbOut.connectTo(u.value),p.output.connectTo(u.power),u.output.connectTo(f.left),a.output.connectTo(v.vector),g.output.connectTo(v.transform),v.output.connectTo(_.posFromLight),S.source.connectTo(_.shadowSampler),_.output.connectTo(f.right),f.output.connectTo(c.input),y.output.connectTo(c.fogColor),c.output.connectTo(E.rgb),i.addOutputNode(l),i.addOutputNode(E),i.build(),i},colorized:function(e,t){var i=new a_(e,t);i.mode=Pp.Material;var n=new _p("position");n.visibleInInspector=!1,n.visibleOnFrame=!1,n.target=1,n.setAsAttribute("position");var a=new qm("WorldPos");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.complementZ=0,a.complementW=1;var s=new _p("World");s.visibleInInspector=!1,s.visibleOnFrame=!1,s.target=1,s.setAsSystemValue(tp.World);var r=new qm("WorldPos * ViewProjectionTransform");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=1;var o=new _p("ViewProjection");o.visibleInInspector=!1,o.visibleOnFrame=!1,o.target=1,o.setAsSystemValue(tp.ViewProjection);var l=new Zm("VertexOutput");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1;var c=new _p("color");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.value=new Ah(0,0,0),c.isConstant=!1;var h=new sp("FragmentOutput");return h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=2,h.convertToGammaSpace=!1,h.convertToLinearSpace=!1,h.useLogarithmicDepth=!1,n.output.connectTo(a.vector),s.output.connectTo(a.transform),a.output.connectTo(r.vector),o.output.connectTo(r.transform),r.output.connectTo(l.vector),c.output.connectTo(h.rgb),i.addOutputNode(l),i.addOutputNode(h),i.build(),i}},R_=class{get(e){const t=this._data[e];if(void 0!==t)return t}getAndRemove(e){const t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null}getOrAdd(e,t){const i=this.get(e);return void 0!==i?i:(this.add(e,t),t)}contains(e){return void 0!==this._data[e]}get count(){return this._count}clear(){this._data={},this._count=0}forEach(e){for(const t in this._data){e(t,this._data[t])}}getOrAddWithFactory(e,t){let i=this.get(e);return void 0!==i||(i=t(e),i&&this.add(e,i)),i}set(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)}constructor(){this._count=0,this._data={}}remove(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)}first(e){for(const t in this._data){const i=e(t,this._data[t]);if(i)return i}return null}add(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)}copyFrom(e){this.clear(),e.forEach(((e,t)=>this.add(e,t)))}},T_=class{static Parse(e,t,i,n){for(const a in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,a)&&this._BabylonFileParsers[a](e,t,i,n)}getNodes(){let e=[];return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach((t=>e=e.concat(t.bones))),e}static GetParser(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null}static AddParser(e,t){this._BabylonFileParsers[e]=t}static AddIndividualParser(e,t){this._IndividualBabylonFileParsers[e]=t}constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[]}static GetIndividualParser(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null}set environmentTexture(e){this._environmentTexture=e}get environmentTexture(){return this._environmentTexture}};function N_(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}T_._BabylonFileParsers={},T_._IndividualBabylonFileParsers={},rh("BABYLON.AbstractScene",T_);var M_=class e{set shadowsSaturation(e){this._shadowsSaturation=e,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesHue(e){this._midtonesHue=e,this._dirty=!0}set globalSaturation(e){this._globalSaturation=e,this._dirty=!0}set highlightsSaturation(e){this._highlightsSaturation=e,this._dirty=!0}get globalHue(){return this._globalHue}get midtonesHue(){return this._midtonesHue}set midtonesDensity(e){this._midtonesDensity=e,this._dirty=!0}set highlightsExposure(e){this._highlightsExposure=e,this._dirty=!0}set highlightsDensity(e){this._highlightsDensity=e,this._dirty=!0}getClassName(){return"ColorCurves"}set shadowsExposure(e){this._shadowsExposure=e,this._dirty=!0}set globalHue(e){this._globalHue=e,this._dirty=!0}clone(){return Uh.Clone((()=>new e),this)}get highlightsExposure(){return this._highlightsExposure}_getColorGradingDataToRef(t,i,n,a,s){null!=t&&(t=e._Clamp(t,0,360),i=e._Clamp(i,-100,100),n=e._Clamp(n,-100,100),a=e._Clamp(a,-100,100),i=e._ApplyColorGradingSliderNonlinear(i),i*=.5,a=e._ApplyColorGradingSliderNonlinear(a),i<0&&(i*=-1,t=(t+180)%360),e._FromHSBToRef(t,i,50+.25*a,s),s.scaleToRef(2,s),s.a=1+.01*n)}serialize(){return Uh.Serialize(this)}constructor(){this._dirty=!0,this._tempColor=new Ch(0,0,0,0),this._globalCurve=new Ch(0,0,0,0),this._highlightsCurve=new Ch(0,0,0,0),this._midtonesCurve=new Ch(0,0,0,0),this._shadowsCurve=new Ch(0,0,0,0),this._positiveCurve=new Ch(0,0,0,0),this._negativeCurve=new Ch(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}set shadowsHue(e){this._shadowsHue=e,this._dirty=!0}static Parse(t){return Uh.Parse((()=>new e),t,null,null)}set globalDensity(e){this._globalDensity=e,this._dirty=!0}static Bind(e,t,i="vCameraColorCurvePositive",n="vCameraColorCurveNeutral",a="vCameraColorCurveNegative"){e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(n,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(a,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}get shadowsDensity(){return this._shadowsDensity}static _FromHSBToRef(t,i,n,a){let s=e._Clamp(t,0,360);const r=e._Clamp(i/100,0,1),o=e._Clamp(n/100,0,1);if(0===r)a.r=o,a.g=o,a.b=o;else{s/=60;const e=Math.floor(s),t=s-e,i=o*(1-r),n=o*(1-r*t),l=o*(1-r*(1-t));switch(e){case 0:a.r=o,a.g=l,a.b=i;break;case 1:a.r=n,a.g=o,a.b=i;break;case 2:a.r=i,a.g=o,a.b=l;break;case 3:a.r=i,a.g=n,a.b=o;break;case 4:a.r=l,a.g=i,a.b=o;break;default:a.r=o,a.g=i,a.b=n}}a.a=1}get globalDensity(){return this._globalDensity}get midtonesSaturation(){return this._midtonesSaturation}static _ApplyColorGradingSliderNonlinear(e){e/=100;let t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100,t}set globalExposure(e){this._globalExposure=e,this._dirty=!0}set shadowsDensity(e){this._shadowsDensity=e,this._dirty=!0}set midtonesSaturation(e){this._midtonesSaturation=e,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}get globalSaturation(){return this._globalSaturation}get highlightsHue(){return this._highlightsHue}get highlightsDensity(){return this._highlightsDensity}get shadowsHue(){return this._shadowsHue}set midtonesExposure(e){this._midtonesExposure=e,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}get shadowsExposure(){return this._shadowsExposure}static _Clamp(e,t,i){return Math.min(Math.max(e,t),i)}set highlightsHue(e){this._highlightsHue=e,this._dirty=!0}get globalExposure(){return this._globalExposure}get highlightsSaturation(){return this._highlightsSaturation}};M_.PrepareUniforms=N_,Lc([Hc()],M_.prototype,"_globalHue",void 0),Lc([Hc()],M_.prototype,"_globalDensity",void 0),Lc([Hc()],M_.prototype,"_globalSaturation",void 0),Lc([Hc()],M_.prototype,"_globalExposure",void 0),Lc([Hc()],M_.prototype,"_highlightsHue",void 0),Lc([Hc()],M_.prototype,"_highlightsDensity",void 0),Lc([Hc()],M_.prototype,"_highlightsSaturation",void 0),Lc([Hc()],M_.prototype,"_highlightsExposure",void 0),Lc([Hc()],M_.prototype,"_midtonesHue",void 0),Lc([Hc()],M_.prototype,"_midtonesDensity",void 0),Lc([Hc()],M_.prototype,"_midtonesSaturation",void 0),Lc([Hc()],M_.prototype,"_midtonesExposure",void 0),Uh._ColorCurvesParser=M_.Parse;var I_=class e{get colorGradingBGR(){return this._colorGradingBGR}getClassName(){return"ImageProcessingConfiguration"}get vignetteCentreX(){return this.vignetteCenterX}constructor(){this.colorCurves=new M_,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new Ch(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new Ih}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingWithGreenDepth(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}set toneMappingType(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}set skipFinalColorClamp(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}prepareDefines(t,i=!1){if(i!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=0,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.DITHER=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case e.TONEMAPPING_KHR_PBR_NEUTRAL:t.TONEMAPPING=3;break;case e.TONEMAPPING_ACES:t.TONEMAPPING=2;break;default:t.TONEMAPPING=1}else t.TONEMAPPING=0;t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.DITHER=this._ditheringEnabled,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||!!t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING||t.DITHER}set ditheringEnabled(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}set exposure(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}set contrast(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}set applyByPostProcess(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}get toneMappingType(){return this._toneMappingType}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}get toneMappingEnabled(){return this._toneMappingEnabled}clone(){return Uh.Clone((()=>new e),this)}set isEnabled(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}get isEnabled(){return this._isEnabled}get exposure(){return this._exposure}set vignetteCentreX(e){this.vignetteCenterX=e}static Parse(t){const i=Uh.Parse((()=>new e),t,null,null);return void 0!==t.vignetteCentreX&&(i.vignetteCenterX=t.vignetteCentreX),void 0!==t.vignetteCentreY&&(i.vignetteCenterY=t.vignetteCentreY),i}set colorGradingEnabled(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set colorGradingBGR(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}get vignetteBlendMode(){return this._vignetteBlendMode}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}bind(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&M_.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){const i=1/e.getEngine().getRenderWidth(),n=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",i,n),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const a=null!=t?t:n/i;let s=Math.tan(.5*this.vignetteCameraFov),r=s*a;const o=Math.sqrt(r*s);r=Zu(r,o,this.vignetteStretch),s=Zu(s,o,this.vignetteStretch),e.setFloat4("vignetteSettings1",r,s,-r*this.vignetteCenterX,-s*this.vignetteCenterY);const l=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);const t=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(t-1)/t,.5/t,t,this.colorGradingTexture.level)}}get applyByPostProcess(){return this._applyByPostProcess}set vignetteBlendMode(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}set toneMappingEnabled(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}get colorCurvesEnabled(){return this._colorCurvesEnabled}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}set ditheringIntensity(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}set colorGradingTexture(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}get contrast(){return this._contrast}get colorGradingTexture(){return this._colorGradingTexture}serialize(){return Uh.Serialize(this)}set vignetteEnabled(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}get ditheringIntensity(){return this._ditheringIntensity}set colorCurvesEnabled(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}set vignetteCentreY(e){this.vignetteCenterY=e}get ditheringEnabled(){return this._ditheringEnabled}};I_.TONEMAPPING_STANDARD=0,I_.TONEMAPPING_ACES=1,I_.TONEMAPPING_KHR_PBR_NEUTRAL=2,I_.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&e.push("vInverseScreenSize"),t.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&N_(e),t.DITHER&&e.push("ditherIntensity")},I_.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},I_._VIGNETTEMODE_MULTIPLY=0,I_._VIGNETTEMODE_OPAQUE=1,Lc([function(e){return Gc(7,e)}()],I_.prototype,"colorCurves",void 0),Lc([Hc()],I_.prototype,"_colorCurvesEnabled",void 0),Lc([Vc("colorGradingTexture")],I_.prototype,"_colorGradingTexture",void 0),Lc([Hc()],I_.prototype,"_colorGradingEnabled",void 0),Lc([Hc()],I_.prototype,"_colorGradingWithGreenDepth",void 0),Lc([Hc()],I_.prototype,"_colorGradingBGR",void 0),Lc([Hc()],I_.prototype,"_exposure",void 0),Lc([Hc()],I_.prototype,"_toneMappingEnabled",void 0),Lc([Hc()],I_.prototype,"_toneMappingType",void 0),Lc([Hc()],I_.prototype,"_contrast",void 0),Lc([Hc()],I_.prototype,"vignetteStretch",void 0),Lc([Hc()],I_.prototype,"vignetteCenterX",void 0),Lc([Hc()],I_.prototype,"vignetteCenterY",void 0),Lc([Hc()],I_.prototype,"vignetteWeight",void 0),Lc([Kc()],I_.prototype,"vignetteColor",void 0),Lc([Hc()],I_.prototype,"vignetteCameraFov",void 0),Lc([Hc()],I_.prototype,"_vignetteBlendMode",void 0),Lc([Hc()],I_.prototype,"_vignetteEnabled",void 0),Lc([Hc()],I_.prototype,"_ditheringEnabled",void 0),Lc([Hc()],I_.prototype,"_ditheringIntensity",void 0),Lc([Hc()],I_.prototype,"_skipFinalColorClamp",void 0),Lc([Hc()],I_.prototype,"_applyByPostProcess",void 0),Lc([Hc()],I_.prototype,"_isEnabled",void 0),Uh._ImageProcessingConfigurationParser=I_.Parse,rh("BABYLON.ImageProcessingConfiguration",I_);var x_=class e{static CreateNewFromPrimitive(t,i,n,a){return new e(t,i.x,i.y,null,n,a)}constructor(e,t,i,n,a,s){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=n,this.sourceEvent=a,this.additionalData=s}static CreateNewFromScene(t,i){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)}static CreateNewFromSprite(t,i,n,a){return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer,n,a)}static CreateNew(t,i,n){const a=t.getScene();return new e(t,a.pointerX,a.pointerY,a.meshUnderPointer||t,i,n)}},b_=class{};b_.POINTERDOWN=1,b_.POINTERUP=2,b_.POINTERMOVE=4,b_.POINTERWHEEL=8,b_.POINTERPICK=16,b_.POINTERTAP=32,b_.POINTERDOUBLETAP=64;var P_=class{constructor(e,t){this.type=e,this.event=t}},w_=class extends P_{constructor(e,t,i,n){super(e,t),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new Ph(i,n)}},O_=class extends P_{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}constructor(e,t,i,n=null){super(e,t),this._pickInfo=i,this._inputManager=n}},D_=class e{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasPickTriggers(){for(const t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t)){const e=parseInt(t);if(e>=1&&e<=7)return!0}return!1}static get HasTriggers(){for(const t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t))return!0;return!1}static HasSpecificTrigger(t){for(const i in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,i)){if(parseInt(i)===t)return!0}return!1}};D_.Triggers={};var L_=class{};L_.KEYDOWN=1,L_.KEYUP=2;var F_,k_,B_,G_,U_,H_,V_,W_,z_,X_,Y_,j_,K_,$_,q_,J_,Q_=class{constructor(e,t){this.type=e,this.event=t}},Z_=class extends Q_{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}constructor(e,t){super(e,t),this.type=e,this.event=t,this.skipOnKeyboardObservable=!1}set skipOnPointerObservable(e){this.skipOnKeyboardObservable=e}};(k_=F_||(F_={}))[k_.Generic=0]="Generic",k_[k_.Keyboard=1]="Keyboard",k_[k_.Mouse=2]="Mouse",k_[k_.Touch=3]="Touch",k_[k_.DualShock=4]="DualShock",k_[k_.Xbox=5]="Xbox",k_[k_.Switch=6]="Switch",k_[k_.DualSense=7]="DualSense",(G_=B_||(B_={}))[G_.Horizontal=0]="Horizontal",G_[G_.Vertical=1]="Vertical",G_[G_.LeftClick=2]="LeftClick",G_[G_.MiddleClick=3]="MiddleClick",G_[G_.RightClick=4]="RightClick",G_[G_.BrowserBack=5]="BrowserBack",G_[G_.BrowserForward=6]="BrowserForward",G_[G_.MouseWheelX=7]="MouseWheelX",G_[G_.MouseWheelY=8]="MouseWheelY",G_[G_.MouseWheelZ=9]="MouseWheelZ",G_[G_.Move=12]="Move",(H_=U_||(U_={}))[H_.Horizontal=0]="Horizontal",H_[H_.Vertical=1]="Vertical",H_[H_.LeftClick=2]="LeftClick",H_[H_.MiddleClick=3]="MiddleClick",H_[H_.RightClick=4]="RightClick",H_[H_.BrowserBack=5]="BrowserBack",H_[H_.BrowserForward=6]="BrowserForward",H_[H_.MouseWheelX=7]="MouseWheelX",H_[H_.MouseWheelY=8]="MouseWheelY",H_[H_.MouseWheelZ=9]="MouseWheelZ",H_[H_.DeltaHorizontal=10]="DeltaHorizontal",H_[H_.DeltaVertical=11]="DeltaVertical",(W_=V_||(V_={}))[W_.Cross=0]="Cross",W_[W_.Circle=1]="Circle",W_[W_.Square=2]="Square",W_[W_.Triangle=3]="Triangle",W_[W_.L1=4]="L1",W_[W_.R1=5]="R1",W_[W_.L2=6]="L2",W_[W_.R2=7]="R2",W_[W_.Share=8]="Share",W_[W_.Options=9]="Options",W_[W_.L3=10]="L3",W_[W_.R3=11]="R3",W_[W_.DPadUp=12]="DPadUp",W_[W_.DPadDown=13]="DPadDown",W_[W_.DPadLeft=14]="DPadLeft",W_[W_.DPadRight=15]="DPadRight",W_[W_.Home=16]="Home",W_[W_.TouchPad=17]="TouchPad",W_[W_.LStickXAxis=18]="LStickXAxis",W_[W_.LStickYAxis=19]="LStickYAxis",W_[W_.RStickXAxis=20]="RStickXAxis",W_[W_.RStickYAxis=21]="RStickYAxis",(X_=z_||(z_={}))[X_.Cross=0]="Cross",X_[X_.Circle=1]="Circle",X_[X_.Square=2]="Square",X_[X_.Triangle=3]="Triangle",X_[X_.L1=4]="L1",X_[X_.R1=5]="R1",X_[X_.L2=6]="L2",X_[X_.R2=7]="R2",X_[X_.Create=8]="Create",X_[X_.Options=9]="Options",X_[X_.L3=10]="L3",X_[X_.R3=11]="R3",X_[X_.DPadUp=12]="DPadUp",X_[X_.DPadDown=13]="DPadDown",X_[X_.DPadLeft=14]="DPadLeft",X_[X_.DPadRight=15]="DPadRight",X_[X_.Home=16]="Home",X_[X_.TouchPad=17]="TouchPad",X_[X_.LStickXAxis=18]="LStickXAxis",X_[X_.LStickYAxis=19]="LStickYAxis",X_[X_.RStickXAxis=20]="RStickXAxis",X_[X_.RStickYAxis=21]="RStickYAxis",(j_=Y_||(Y_={}))[j_.A=0]="A",j_[j_.B=1]="B",j_[j_.X=2]="X",j_[j_.Y=3]="Y",j_[j_.LB=4]="LB",j_[j_.RB=5]="RB",j_[j_.LT=6]="LT",j_[j_.RT=7]="RT",j_[j_.Back=8]="Back",j_[j_.Start=9]="Start",j_[j_.LS=10]="LS",j_[j_.RS=11]="RS",j_[j_.DPadUp=12]="DPadUp",j_[j_.DPadDown=13]="DPadDown",j_[j_.DPadLeft=14]="DPadLeft",j_[j_.DPadRight=15]="DPadRight",j_[j_.Home=16]="Home",j_[j_.LStickXAxis=17]="LStickXAxis",j_[j_.LStickYAxis=18]="LStickYAxis",j_[j_.RStickXAxis=19]="RStickXAxis",j_[j_.RStickYAxis=20]="RStickYAxis",($_=K_||(K_={}))[$_.B=0]="B",$_[$_.A=1]="A",$_[$_.Y=2]="Y",$_[$_.X=3]="X",$_[$_.L=4]="L",$_[$_.R=5]="R",$_[$_.ZL=6]="ZL",$_[$_.ZR=7]="ZR",$_[$_.Minus=8]="Minus",$_[$_.Plus=9]="Plus",$_[$_.LS=10]="LS",$_[$_.RS=11]="RS",$_[$_.DPadUp=12]="DPadUp",$_[$_.DPadDown=13]="DPadDown",$_[$_.DPadLeft=14]="DPadLeft",$_[$_.DPadRight=15]="DPadRight",$_[$_.Home=16]="Home",$_[$_.Capture=17]="Capture",$_[$_.LStickXAxis=18]="LStickXAxis",$_[$_.LStickYAxis=19]="LStickYAxis",$_[$_.RStickXAxis=20]="RStickXAxis",$_[$_.RStickYAxis=21]="RStickYAxis",(J_=q_||(q_={}))[J_.PointerMove=0]="PointerMove",J_[J_.PointerDown=1]="PointerDown",J_[J_.PointerUp=2]="PointerUp";var ev=class{};ev.DOM_DELTA_PIXEL=0,ev.DOM_DELTA_LINE=1,ev.DOM_DELTA_PAGE=2;var tv=class{static _CreatePointerEvent(e,t,i,n,a,s,r){const o=this._CreateMouseEvent(e,t,i,n,a,s);e===F_.Mouse?(o.deviceType=F_.Mouse,o.pointerId=1,o.pointerType="mouse"):(o.deviceType=F_.Touch,o.pointerId=r??t,o.pointerType="touch");let l=0;return l+=a.pollInput(e,t,B_.LeftClick),l+=2*a.pollInput(e,t,B_.RightClick),l+=4*a.pollInput(e,t,B_.MiddleClick),o.buttons=l,i===B_.Move?o.type="pointermove":i>=B_.LeftClick&&i<=B_.RightClick&&(o.type=1===n?"pointerdown":"pointerup",o.button=i-2),o}static _CreateKeyboardEvent(e,t,i,n){const a=this._CreateEvent(n);return this._CheckNonCharacterKeys(a,i),a.deviceType=F_.Keyboard,a.deviceSlot=0,a.inputIndex=e,a.type=1===t?"keydown":"keyup",a.key=String.fromCharCode(e),a.keyCode=e,a}static _CreateEvent(e){const t={preventDefault:()=>{}};return t.target=e,t}static CreateDeviceEvent(e,t,i,n,a,s,r){switch(e){case F_.Keyboard:return this._CreateKeyboardEvent(i,n,a,s);case F_.Mouse:if(i===B_.MouseWheelX||i===B_.MouseWheelY||i===B_.MouseWheelZ)return this._CreateWheelEvent(e,t,i,n,a,s);case F_.Touch:return this._CreatePointerEvent(e,t,i,n,a,s,r);default:throw`Unable to generate event for device ${F_[e]}`}}static _CreateWheelEvent(e,t,i,n,a,s){const r=this._CreateMouseEvent(e,t,i,n,a,s);switch(r.pointerId=1,r.type="wheel",r.deltaMode=ev.DOM_DELTA_PIXEL,r.deltaX=0,r.deltaY=0,r.deltaZ=0,i){case B_.MouseWheelX:r.deltaX=n;break;case B_.MouseWheelY:r.deltaY=n;break;case B_.MouseWheelZ:r.deltaZ=n}return r}static _CheckNonCharacterKeys(e,t){const i=t.isDeviceAvailable(F_.Keyboard),n=i&&1===t.pollInput(F_.Keyboard,0,18),a=i&&1===t.pollInput(F_.Keyboard,0,17),s=i&&(1===t.pollInput(F_.Keyboard,0,91)||1===t.pollInput(F_.Keyboard,0,92)||1===t.pollInput(F_.Keyboard,0,93)),r=i&&1===t.pollInput(F_.Keyboard,0,16);e.altKey=n,e.ctrlKey=a,e.metaKey=s,e.shiftKey=r}static _CreateMouseEvent(e,t,i,n,a,s){const r=this._CreateEvent(s),o=a.pollInput(e,t,B_.Horizontal),l=a.pollInput(e,t,B_.Vertical);return s?(r.movementX=0,r.movementY=0,r.offsetX=r.movementX-s.getBoundingClientRect().x,r.offsetY=r.movementY-s.getBoundingClientRect().y):(r.movementX=a.pollInput(e,t,10),r.movementY=a.pollInput(e,t,11),r.offsetX=0,r.offsetY=0),this._CheckNonCharacterKeys(r,a),r.clientX=o,r.clientY=l,r.x=o,r.y=l,r.deviceType=e,r.deviceSlot=t,r.inputIndex=i,r}},iv=class{isDeviceAvailable(e){return e===F_.Mouse||e===F_.Touch}constructor(e,t,i){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,((e,t,n,a)=>{const s=tv.CreateDeviceEvent(e,t,n,a,this);i(e,t,s)})):this._createDummyNativeInput()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}dispose(){this._nativeInput.dispose()}pollInput(e,t,i){return this._nativeInput.pollInput(e,t,i)}},nv=Object.keys(B_).length/2,av=class{constructor(e,t,i,n){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=ad.IsSafari(),this._usingMacOS=gf()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=e=>{},this._keyboardUpEvent=e=>{},this._keyboardBlurEvent=e=>{},this._pointerMoveEvent=e=>{},this._pointerDownEvent=e=>{},this._pointerUpEvent=e=>{},this._pointerCancelEvent=e=>{},this._pointerWheelEvent=e=>{},this._pointerBlurEvent=e=>{},this._pointerMacOSChromeOutEvent=e=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=gf()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=gf()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=e=>{},this._gamepadDisconnectedEvent=e=>{},this._eventPrefix=ad.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=n,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}_addPointerDevice(e,t,i,n){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,nv);const a=this._inputs[e][t];a[0]=i,a[1]=n}_enableEvents(){const e=this?._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs)for(const e of this._inputs)if(e)for(const t in e){const i=e[+t];if(i)for(let e=0;e<i.length;e++)i[e]=0}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_handleGamepadActions(){this._gamepadConnectedEvent=e=>{this._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=e=>{if(this._gamepads){const t=this._getGamepadDeviceType(e.gamepad.id),i=e.gamepad.index;this._unregisterDevice(t,i),delete this._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_addGamePad(e){const t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t}_getPointerType(e){let t=F_.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=F_.Touch),t}_updateDevice(e,t,i){const n=navigator.getGamepads()[t];if(n&&e===this._gamepads[t]){const a=this._inputs[e][t];i>=n.buttons.length?a[i]=n.axes[i-n.buttons.length].valueOf():a[i]=n.buttons[i].value}}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_getGamepadDeviceType(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?F_.DualSense:F_.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?F_.Xbox:-1!==e.indexOf("057e")?F_.Switch:F_.Generic}_unregisterDevice(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}pollInput(e,t,i){const n=this._inputs[e][t];if(!n)throw`Unable to find device ${F_[e]}`;e>=F_.DualShock&&e<=F_.DualSense&&this._updateDevice(e,t,i);const a=n[i];if(void 0===a)throw`Unable to find input ${i} for device ${F_[e]} in slot ${t}`;return i===B_.Move&&ad.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),a}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}isDeviceAvailable(e){return void 0!==this._inputs[e]}_checkForConnectedDevices(){if(navigator.getGamepads){const e=navigator.getGamepads();for(const t of e)t&&this._addGamePad(t)}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(F_.Mouse,0,0,0)}_handlePointerActions(){this._maxTouchPoints=gf()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let e=0;e<this._maxTouchPoints;e++)this._activeTouchIds[e]=-1;this._pointerMoveEvent=e=>{const t=this._getPointerType(e);let i=t===F_.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===F_.Touch&&-1===i){const n=this._activeTouchIds.indexOf(-1);if(!(n>=0))return void ad.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);i=n,this._activeTouchIds[n]=e.pointerId,this._onDeviceConnected(t,i)}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]||this._addPointerDevice(t,i,e.clientX,e.clientY);const n=this._inputs[t][i];if(n){const a=e;a.inputIndex=B_.Move,n[B_.Horizontal]=e.clientX,n[B_.Vertical]=e.clientY,t===F_.Touch&&0===n[B_.LeftClick]&&(n[B_.LeftClick]=1),void 0===e.pointerId&&(e.pointerId=this._mouseId),this._onInputChanged(t,i,a),this._usingSafari||-1===e.button||(a.inputIndex=e.button+2,n[e.button+2]=n[e.button+2]?0:1,this._onInputChanged(t,i,a))}},this._pointerDownEvent=e=>{const t=this._getPointerType(e);let i=t===F_.Mouse?0:e.pointerId;if(t===F_.Touch){let t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t&&(t=this._activeTouchIds.indexOf(-1)),!(t>=0))return void ad.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);i=t,this._activeTouchIds[t]=e.pointerId}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]?t===F_.Touch&&this._onDeviceConnected(t,i):this._addPointerDevice(t,i,e.clientX,e.clientY);const n=this._inputs[t][i];if(n){const a=n[B_.Horizontal],s=n[B_.Vertical];if(t===F_.Mouse){if(void 0===e.pointerId&&(e.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(e){}}else if(e.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(e.pointerId)}catch(e){}n[B_.Horizontal]=e.clientX,n[B_.Vertical]=e.clientY,n[e.button+2]=1;const r=e;r.inputIndex=e.button+2,this._onInputChanged(t,i,r),a===e.clientX&&s===e.clientY||(r.inputIndex=B_.Move,this._onInputChanged(t,i,r))}},this._pointerUpEvent=e=>{const t=this._getPointerType(e),i=t===F_.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===F_.Touch){if(-1===i)return;this._activeTouchIds[i]=-1}const n=this._inputs[t]?.[i];if(n&&0!==n[e.button+2]){const a=n[B_.Horizontal],s=n[B_.Vertical];n[B_.Horizontal]=e.clientX,n[B_.Vertical]=e.clientY,n[e.button+2]=0;const r=e;void 0===e.pointerId&&(e.pointerId=this._mouseId),a===e.clientX&&s===e.clientY||(r.inputIndex=B_.Move,this._onInputChanged(t,i,r)),r.inputIndex=e.button+2,t===F_.Mouse&&this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):e.pointerId&&this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._onInputChanged(t,i,r),t===F_.Touch&&this._onDeviceDisconnected(t,i)}},this._pointerCancelEvent=e=>{if("mouse"===e.pointerType){const e=this._inputs[F_.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=B_.LeftClick;t<=B_.BrowserForward;t++)if(1===e[t]){e[t]=0;const i=tv.CreateDeviceEvent(F_.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(F_.Mouse,0,i)}}else{const t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t)return;this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._inputs[F_.Touch][t][B_.LeftClick]=0;const i=tv.CreateDeviceEvent(F_.Touch,t,B_.LeftClick,0,this,this._elementToAttachTo,e.pointerId);this._onInputChanged(F_.Touch,t,i),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(F_.Touch,t)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let e=!1;const t=function(){};try{const i=Object.defineProperty({},"passive",{get:function(){e=!0}});this._elementToAttachTo.addEventListener("test",t,i),this._elementToAttachTo.removeEventListener("test",t,i)}catch(e){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(F_.Mouse)){const e=this._inputs[F_.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=B_.LeftClick;t<=B_.BrowserForward;t++)if(1===e[t]){e[t]=0;const i=tv.CreateDeviceEvent(F_.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(F_.Mouse,0,i)}}if(this.isDeviceAvailable(F_.Touch)){const e=this._inputs[F_.Touch];for(let t=0;t<this._activeTouchIds.length;t++){const i=this._activeTouchIds[t];if(this._elementToAttachTo.hasPointerCapture?.(i)&&this._elementToAttachTo.releasePointerCapture(i),-1!==i&&1===e[t]?.[B_.LeftClick]){e[t][B_.LeftClick]=0;const n=tv.CreateDeviceEvent(F_.Touch,t,B_.LeftClick,0,this,this._elementToAttachTo,i);this._onInputChanged(F_.Touch,t,n),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(F_.Touch,t)}}}},this._pointerWheelEvent=e=>{const t=F_.Mouse;this._inputs[t]||(this._inputs[t]=[]),this._inputs[t][0]||(this._pointerActive=!0,this._registerDevice(t,0,nv));const i=this._inputs[t][0];if(i){i[B_.MouseWheelX]=e.deltaX||0,i[B_.MouseWheelY]=e.deltaY||e.wheelDelta||0,i[B_.MouseWheelZ]=e.deltaZ||0;const n=e;void 0===e.pointerId&&(e.pointerId=this._mouseId),0!==i[B_.MouseWheelX]&&(n.inputIndex=B_.MouseWheelX,this._onInputChanged(t,0,n)),0!==i[B_.MouseWheelY]&&(n.inputIndex=B_.MouseWheelY,this._onInputChanged(t,0,n)),0!==i[B_.MouseWheelZ]&&(n.inputIndex=B_.MouseWheelZ,this._onInputChanged(t,0,n))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=e=>{e.buttons>1&&this._pointerCancelEvent(e)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!e&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(F_.Mouse)){const e=this._inputs[F_.Mouse][0];e[B_.MouseWheelX]=0,e[B_.MouseWheelY]=0,e[B_.MouseWheelZ]=0}}))}_handleKeyActions(){this._keyboardDownEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(F_.Keyboard,0,255));const t=this._inputs[F_.Keyboard][0];if(t){t[e.keyCode]=1;const i=e;i.inputIndex=e.keyCode,this._usingMacOS&&e.metaKey&&"Meta"!==e.key&&(this._metaKeys.includes(e.keyCode)||this._metaKeys.push(e.keyCode)),this._onInputChanged(F_.Keyboard,0,i)}},this._keyboardUpEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(F_.Keyboard,0,255));const t=this._inputs[F_.Keyboard][0];if(t){t[e.keyCode]=0;const i=e;if(i.inputIndex=e.keyCode,this._usingMacOS&&"Meta"===e.key&&this._metaKeys.length>0){for(const e of this._metaKeys){const i=tv.CreateDeviceEvent(F_.Keyboard,0,e,0,this,this._elementToAttachTo);t[e]=0,this._onInputChanged(F_.Keyboard,0,i)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(F_.Keyboard,0,i)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const e=this._inputs[F_.Keyboard][0];for(let t=0;t<e.length;t++)if(0!==e[t]){e[t]=0;const i=tv.CreateDeviceEvent(F_.Keyboard,0,t,0,this,this._elementToAttachTo);this._onInputChanged(F_.Keyboard,0,i)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_registerDevice(e,t,i){if(void 0===t)throw`Unable to register device ${F_[e]} to undefined slot.`;if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){const n=new Array(i);n.fill(0),this._inputs[e][t]=n,this._onDeviceConnected(e,t)}}},sv=class{constructor(e,t,i=0){this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new Ih,this._deviceInputSystem=e}getInput(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}},rv=class{constructor(e){this._registeredManagers=new Array,this._refCount=0,this.registerManager=e=>{for(let t=0;t<this._devices.length;t++){const i=this._devices[t];for(const n in i){const i=+n;e._addDevice(new sv(this._deviceInputSystem,t,i))}}this._registeredManagers.push(e)},this.unregisterManager=e=>{const t=this._registeredManagers.indexOf(e);t>-1&&this._registeredManagers.splice(t,1)};const t=Object.keys(F_).length/2;this._devices=new Array(t);const i=(e,t)=>{this._devices[e]||(this._devices[e]=new Array),this._devices[e][t]||(this._devices[e][t]=t);for(const i of this._registeredManagers){const n=new sv(this._deviceInputSystem,e,t);i._addDevice(n)}},n=(e,t)=>{this._devices[e]?.[t]&&delete this._devices[e][t];for(const i of this._registeredManagers)i._removeDevice(e,t)},a=(e,t,i)=>{if(i)for(const n of this._registeredManagers)n._onInputChanged(e,t,i)};"undefined"!=typeof _native?this._deviceInputSystem=new iv(i,n,a):this._deviceInputSystem=new av(e,i,n,a)}dispose(){this._deviceInputSystem.dispose()}},ov=class{getDeviceSource(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}_onInputChanged(e,t,i){this._devices[e]?.[t]?.onInputChangedObservable.notifyObservers(i)}_addDevice(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}_updateFirstDevices(e){switch(e){case F_.Keyboard:case F_.Mouse:this._firstDevice[e]=0;break;case F_.Touch:case F_.DualSense:case F_.DualShock:case F_.Xbox:case F_.Switch:case F_.Generic:{delete this._firstDevice[e];const t=this._devices[e];if(t)for(let i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}break}}}getDeviceSources(e){return this._devices[e]?this._devices[e].filter((e=>!!e)):[]}_removeDevice(e,t){const i=this._devices[e]?.[t];this.onDeviceDisconnectedObservable.notifyObservers(i),this._devices[e]?.[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}constructor(e){const t=Object.keys(F_).length/2;this._devices=new Array(t),this._firstDevice=new Array(t),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new rv(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new Ih((e=>{for(const t of this._devices)if(t)for(const i of t)i&&this.onDeviceConnectedObservable.notifyObserver(e,i)})),this.onDeviceDisconnectedObservable=new Ih,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add((()=>{this.dispose()}))}},lv=class{set ignore(e){this._ignore=e}get singleClick(){return this._singleClick}set hasSwiped(e){this._hasSwiped=e}set singleClick(e){this._singleClick=e}constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get hasSwiped(){return this._hasSwiped}set doubleClick(e){this._doubleClick=e}get doubleClick(){return this._doubleClick}get ignore(){return this._ignore}},cv=class e{get unTranslatedPointer(){return new Ph(this._unTranslatedPointerX,this._unTranslatedPointerY)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_updatePointerPosition(e){const t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_invalidateMesh(e){this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null);for(const t in this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}setPointerOverMesh(e,t=0,i,n){if(!(this._meshUnderPointerId[t]!==e||e&&e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const a=this._meshUnderPointerId[t];let s;a&&(s=a._getActionManagerForTrigger(10),s&&s.processTrigger(10,x_.CreateNew(a,n,{pointerId:t}))),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,s=e._getActionManagerForTrigger(9),s&&s.processTrigger(9,x_.CreateNew(e,n,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}get pointerY(){return this._pointerY}_pickMove(e){const t=this._scene,i=t.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(i,e,t),i}_processPointerUp(e,t,i){const n=this._scene;if(e?.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(t,e),i.singleClick&&!i.ignore&&n.onPointerObservable.observers.length>this._cameraObserverCount)){const i=b_.POINTERPICK,a=new O_(i,t,e);this._setRayOnPointerInfo(e,t),n.onPointerObservable.notifyObservers(a,i)}const a=e.pickedMesh._getActionManagerForTrigger();if(a&&!i.ignore){a.processTrigger(7,x_.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&a.processTrigger(1,x_.CreateNew(e.pickedMesh,t,e));const n=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&n&&n.processTrigger(6,x_.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(const a of n._pointerUpStage)e=a.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,i.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const e=this._pickedDownMesh._getActionManagerForTrigger(16);e&&e.processTrigger(16,x_.CreateNew(this._pickedDownMesh,t))}if(!i.ignore){const a=new O_(b_.POINTERUP,t,e);if(this._setRayOnPointerInfo(e,t),n.onPointerObservable.notifyObservers(a,b_.POINTERUP),n.onPointerUp&&n.onPointerUp(t,e,b_.POINTERUP),!i.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let a=0;if(i.singleClick?a=b_.POINTERTAP:i.doubleClick&&(a=b_.POINTERDOUBLETAP),a){const i=new O_(a,t,e);n.onPointerObservable.hasObservers()&&n.onPointerObservable.hasSpecificMask(a)&&n.onPointerObservable.notifyObservers(i,a)}}}}_processPointerMove(e,t){const i=this._scene,n=i.getEngine(),a=n.getInputElement();a&&(a.tabIndex=n.canvasTabIndex,i.doNotHandleCursors||(a.style.cursor=i.defaultCursor)),this._setCursorAndPointerOverMesh(e,t,i);for(const n of i._pointerMoveStage){e=e||this._pickMove(t);const i=!!e?.pickedMesh;e=n.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,a)}const s=t.inputIndex>=B_.MouseWheelX&&t.inputIndex<=B_.MouseWheelZ?b_.POINTERWHEEL:b_.POINTERMOVE;let r;i.onPointerMove&&(e=e||this._pickMove(t),i.onPointerMove(t,e,s)),e?(r=new O_(s,t,e),this._setRayOnPointerInfo(e,t)):(r=new O_(s,t,null,this),this._movePointerInfo=r),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(r,s)}simulatePointerMove(e,t){const i=new PointerEvent("pointermove",t);i.inputIndex=B_.Move,this._checkPrePointerObservable(e,i,b_.POINTERMOVE)||this._processPointerMove(e,i)}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}simulatePointerUp(e,t,i){const n=new PointerEvent("pointerup",t);n.inputIndex=B_.Move;const a=new lv;i?a.doubleClick=!0:a.singleClick=!0,this._checkPrePointerObservable(e,n,b_.POINTERUP)||this._processPointerUp(e,n,a)}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}set pointerY(e){this._pointerY=e}getPointerOverMesh(){return this.meshUnderPointer}_setCursorAndPointerOverMesh(e,t,i){const n=i.getEngine().getInputElement();if(e?.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,t.pointerId,e,t),!i.doNotHandleCursors&&n&&this._pointerOverMesh){const e=this._pointerOverMesh._getActionManagerForTrigger();e&&e.hasPointerTriggers&&(n.style.cursor=e.hoverCursor||i.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,e,t)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}get pointerX(){return this._pointerX}_setRayOnPointerInfo(e,t){const i=this._scene;e&&i._pickingAvailable&&(e.ray||(e.ray=i.createPickingRay(t.offsetX,t.offsetY,Lh.Identity(),i.activeCamera)))}isPointerCaptured(e=0){return this._pointerCaptures[e]}constructor(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new Ph(0,0),this._previousStartingPointerPosition=new Ph(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||xh.LastCreatedScene,this._scene}_processPointerDown(t,i){const n=this._scene;if(t?.pickedMesh){this._pickedDownMesh=t.pickedMesh;const a=t.pickedMesh._getActionManagerForTrigger();if(a){if(a.hasPickTriggers)switch(a.processTrigger(5,x_.CreateNew(t.pickedMesh,i,t)),i.button){case 0:a.processTrigger(2,x_.CreateNew(t.pickedMesh,i,t));break;case 1:a.processTrigger(4,x_.CreateNew(t.pickedMesh,i,t));break;case 2:a.processTrigger(3,x_.CreateNew(t.pickedMesh,i,t))}a.hasSpecificTrigger(8)&&window.setTimeout((()=>{const t=n.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,(e=>e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===this._pickedDownMesh),!1,n.cameraToUseForPointers);t?.pickedMesh&&a&&0!==this._totalPointersPressed&&Date.now()-this._startingPointerTime>e.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,a.processTrigger(8,x_.CreateNew(t.pickedMesh,i)))}),e.LongPressDelay)}}else for(const e of n._pointerDownStage)t=e.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,i,!1);let a;const s=b_.POINTERDOWN;t?(n.onPointerDown&&n.onPointerDown(i,t,s),a=new O_(s,i,t),this._setRayOnPointerInfo(t,i)):a=new O_(s,i,null,this),n.onPointerObservable.hasObservers()&&n.onPointerObservable.notifyObservers(a,s)}_checkPrePointerObservable(e,t,i){const n=this._scene,a=new w_(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(a.originalPickingInfo=e,a.ray=e.ray,"xr-near"===t.pointerType&&e.originMesh&&(a.nearInteractionPickingInfo=e)),n.onPrePointerObservable.notifyObservers(a,i),!!a.skipOnPointerObservable}set pointerX(e){this._pointerX=e}simulatePointerDown(e,t){const i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,this._checkPrePointerObservable(e,i,b_.POINTERDOWN)||this._processPointerDown(e,i)}_isPointerSwiping(){return this._isSwiping}_addCameraPointerObserver(e,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,t)}attachControl(t=!0,i=!0,n=!0,a=null){const s=this._scene,r=s.getEngine();a||(a=r.getInputElement()),this._alreadyAttached&&this.detachControl(),a&&(this._alreadyAttachedTo=a),this._deviceSourceManager=new ov(r),this._initActionManager=e=>{if(!this._meshPickProceed){const t=s.skipPointerUpPicking||0===s._registeredActions&&!this._checkForPicking()&&!s.onPointerUp?null:s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,s.pointerUpPredicate,s.pointerUpFastCheck,s.cameraToUseForPointers,s.pointerUpTrianglePredicate);this._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return e},this._delayedSimpleClick=(t,i,n)=>{if((Date.now()-this._previousStartingPointerTime>e.DoubleClickDelay&&!this._doubleClickOccured||t!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,this._delayedClicks[t])){const e=this._delayedClicks[t].evt,i=b_.POINTERTAP,n=new O_(i,e,this._currentPickResult);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(i)&&s.onPointerObservable.notifyObservers(n,i),this._delayedClicks[t]=null}},this._initClickEvent=(t,i,n,a)=>{const s=new lv;this._currentPickResult=null;let r=null,o=t.hasSpecificMask(b_.POINTERPICK)||i.hasSpecificMask(b_.POINTERPICK)||t.hasSpecificMask(b_.POINTERTAP)||i.hasSpecificMask(b_.POINTERTAP)||t.hasSpecificMask(b_.POINTERDOUBLETAP)||i.hasSpecificMask(b_.POINTERDOUBLETAP);!o&&D_&&(r=this._initActionManager(r,s),r&&(o=r.hasPickTriggers));let l=!1;if(o){const o=n.button;if(s.hasSwiped=this._isPointerSwiping(),!s.hasSwiped){let c=!e.ExclusiveDoubleClickMode;if(c||(c=!t.hasSpecificMask(b_.POINTERDOUBLETAP)&&!i.hasSpecificMask(b_.POINTERDOUBLETAP),c&&!D_.HasSpecificTrigger(6)&&(r=this._initActionManager(r,s),r&&(c=!r.hasSpecificTrigger(6)))),c)(Date.now()-this._previousStartingPointerTime>e.DoubleClickDelay||o!==this._previousButtonPressed)&&(s.singleClick=!0,a(s,this._currentPickResult),l=!0);else{const t={evt:n,clickInfo:s,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,o,s,a),e.DoubleClickDelay)};this._delayedClicks[o]=t}let h=t.hasSpecificMask(b_.POINTERDOUBLETAP)||i.hasSpecificMask(b_.POINTERDOUBLETAP);!h&&D_.HasSpecificTrigger(6)&&(r=this._initActionManager(r,s),r&&(h=r.hasSpecificTrigger(6))),h&&(o===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<e.DoubleClickDelay&&!this._doubleClickOccured?(s.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=o,e.ExclusiveDoubleClickMode?(this._delayedClicks[o]&&(clearTimeout(this._delayedClicks[o]?.timeoutId),this._delayedClicks[o]=null),a(s,this._previousPickResult)):a(s,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,s.doubleClick=!0,s.ignore=!1,e.ExclusiveDoubleClickMode&&this._delayedClicks[o]&&(clearTimeout(this._delayedClicks[o]?.timeoutId),this._delayedClicks[o]=null),a(s,this._currentPickResult)),l=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=o))}}l||a(s,this._currentPickResult)},this._onPointerMove=t=>{if(this._updatePointerPosition(t),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold),r.isPointerLock&&r._verifyPointerLock(),this._checkPrePointerObservable(null,t,t.inputIndex>=B_.MouseWheelX&&t.inputIndex<=B_.MouseWheelZ?b_.POINTERWHEEL:b_.POINTERMOVE))return;if(!s.cameraToUseForPointers&&!s.activeCamera)return;if(s.skipPointerMovePicking)return void this._processPointerMove(new Id,t);s.pointerMovePredicate||(s.pointerMovePredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||s.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!s.cameraToUseForPointers||0!=(s.cameraToUseForPointers.layerMask&e.layerMask)));const i=s._registeredActions>0||s.constantlyUpdateMeshUnderPointer?this._pickMove(t):null;this._processPointerMove(i,t)},this._onPointerDown=t=>{if(this._totalPointersPressed++,this._pickedDownMesh=null,this._meshPickProceed=!1,e.ExclusiveDoubleClickMode)for(let e=0;e<this._delayedClicks.length;e++)if(this._delayedClicks[e])if(t.button===e)clearTimeout(this._delayedClicks[e]?.timeoutId);else{const t=this._delayedClicks[e].clickInfo;this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1;const i=this._delayedClicks[e].evt,n=b_.POINTERTAP,a=new O_(n,i,this._currentPickResult);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(n)&&s.onPointerObservable.notifyObservers(a,n),this._delayedClicks[e]=null}if(this._updatePointerPosition(t),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=t.button),s.preventDefaultOnPointerDown&&a&&(t.preventDefault(),a.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,t,b_.POINTERDOWN))return;if(!s.cameraToUseForPointers&&!s.activeCamera)return;let i;this._pointerCaptures[t.pointerId]=!0,s.pointerDownPredicate||(s.pointerDownPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!s.cameraToUseForPointers||0!=(s.cameraToUseForPointers.layerMask&e.layerMask))),this._pickedDownMesh=null,i=s.skipPointerDownPicking||0===s._registeredActions&&!this._checkForPicking()&&!s.onPointerDown?new Id:s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,s.pointerDownPredicate,s.pointerDownFastCheck,s.cameraToUseForPointers,s.pointerDownTrianglePredicate),this._processPointerDown(i,t)},this._onPointerUp=e=>{0!==this._totalPointersPressed&&(this._totalPointersPressed--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(e),s.preventDefaultOnPointerUp&&a&&(e.preventDefault(),a.focus()),this._initClickEvent(s.onPrePointerObservable,s.onPointerObservable,e,((t,i)=>{if(s.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!t.ignore)){if(this._checkPrePointerObservable(null,e,b_.POINTERUP))return this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1));t.hasSwiped||(t.singleClick&&s.onPrePointerObservable.hasSpecificMask(b_.POINTERTAP)&&this._checkPrePointerObservable(null,e,b_.POINTERTAP)&&(this._skipPointerTap=!0),t.doubleClick&&s.onPrePointerObservable.hasSpecificMask(b_.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,e,b_.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[e.pointerId]?(0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1),(s.cameraToUseForPointers||s.activeCamera)&&(s.pointerUpPredicate||(s.pointerUpPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!s.cameraToUseForPointers||0!=(s.cameraToUseForPointers.layerMask&e.layerMask))),!this._meshPickProceed&&(D_&&D_.HasTriggers||this._checkForPicking()||s.onPointerUp)&&this._initActionManager(null,t),i||(i=this._currentPickResult),this._processPointerUp(i,e,t),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=e=>{const t=L_.KEYDOWN;if(s.onPreKeyboardObservable.hasObservers()){const i=new Z_(t,e);if(s.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(s.onKeyboardObservable.hasObservers()){const i=new Q_(t,e);s.onKeyboardObservable.notifyObservers(i,t)}s.actionManager&&s.actionManager.processTrigger(14,x_.CreateNewFromScene(s,e))},this._onKeyUp=e=>{const t=L_.KEYUP;if(s.onPreKeyboardObservable.hasObservers()){const i=new Z_(t,e);if(s.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(s.onKeyboardObservable.hasObservers()){const i=new Q_(t,e);s.onKeyboardObservable.notifyObservers(i,t)}s.actionManager&&s.actionManager.processTrigger(15,x_.CreateNewFromScene(s,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((e=>{e.deviceType===F_.Mouse?e.onInputChangedObservable.add((a=>{this._originMouseEvent=a,a.inputIndex===B_.LeftClick||a.inputIndex===B_.MiddleClick||a.inputIndex===B_.RightClick||a.inputIndex===B_.BrowserBack||a.inputIndex===B_.BrowserForward?i&&1===e.getInput(a.inputIndex)?this._onPointerDown(a):t&&0===e.getInput(a.inputIndex)&&this._onPointerUp(a):n&&(a.inputIndex===B_.Move?this._onPointerMove(a):a.inputIndex!==B_.MouseWheelX&&a.inputIndex!==B_.MouseWheelY&&a.inputIndex!==B_.MouseWheelZ||this._onPointerMove(a))})):e.deviceType===F_.Touch?e.onInputChangedObservable.add((a=>{a.inputIndex===B_.LeftClick&&(i&&1===e.getInput(a.inputIndex)?(this._onPointerDown(a),this._totalPointersPressed>1&&(this._isMultiTouchGesture=!0)):t&&0===e.getInput(a.inputIndex)&&(this._onPointerUp(a),0===this._totalPointersPressed&&(this._isMultiTouchGesture=!1))),n&&a.inputIndex===B_.Move&&this._onPointerMove(a)})):e.deviceType===F_.Keyboard&&e.onInputChangedObservable.add((e=>{"keydown"===e.type?this._onKeyDown(e):"keyup"===e.type&&this._onKeyUp(e)}))})),this._alreadyAttached=!0}};cv.DragMovementThreshold=10,cv.LongPressDelay=500,cv.DoubleClickDelay=300,cv.ExclusiveDoubleClickMode=!1;var hv,fv,uv=class{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}};(fv=hv||(hv={}))[fv.BackwardCompatible=0]="BackwardCompatible",fv[fv.Intermediate=1]="Intermediate",fv[fv.Aggressive=2]="Aggressive";var dv=class e extends T_{_checkIntersections(){for(let e=0;e<this._meshesForIntersections.length;e++){const t=this._meshesForIntersections.data[e];if(t.actionManager)for(let e=0;t.actionManager&&e<t.actionManager.actions.length;e++){const i=t.actionManager.actions[e];if(12===i.trigger||13===i.trigger){const e=i.getTriggerParameter(),n=e.mesh?e.mesh:e,a=n.intersectsMesh(t,e.usePreciseIntersection),s=t._intersectionsInProgress.indexOf(n);a&&-1===s?12===i.trigger?(i._executeCurrent(x_.CreateNew(t,void 0,n)),t._intersectionsInProgress.push(n)):13===i.trigger&&t._intersectionsInProgress.push(n):!a&&s>-1&&(13===i.trigger&&i._executeCurrent(x_.CreateNew(t,void 0,n)),t.actionManager.hasSpecificTrigger(13,(e=>{const t=e.mesh?e.mesh:e;return n===t}))&&13!==i.trigger||t._intersectionsInProgress.splice(s,1))}}}}_addComponent(e){this._components.push(e),this._transientComponents.push(e);const t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}constructor(t,i){super(),this._inputManager=new cv(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this.clearColor=new Ch(.2,.2,.3,1),this.ambientColor=new Ah(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new Ih,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.onDisposeObservable=new Ih,this._onDisposeObserver=null,this.onBeforeRenderObservable=new Ih,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new Ih,this.onAfterRenderCameraObservable=new Ih,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new Ih,this.onAfterAnimationsObservable=new Ih,this.onBeforeDrawPhaseObservable=new Ih,this.onAfterDrawPhaseObservable=new Ih,this.onReadyObservable=new Ih,this.onBeforeCameraRenderObservable=new Ih,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new Ih,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new Ih,this.onAfterActiveMeshesEvaluationObservable=new Ih,this.onBeforeParticlesRenderingObservable=new Ih,this.onAfterParticlesRenderingObservable=new Ih,this.onDataLoadedObservable=new Ih,this.onNewCameraAddedObservable=new Ih,this.onCameraRemovedObservable=new Ih,this.onNewLightAddedObservable=new Ih,this.onLightRemovedObservable=new Ih,this.onNewGeometryAddedObservable=new Ih,this.onGeometryRemovedObservable=new Ih,this.onNewTransformNodeAddedObservable=new Ih,this.onTransformNodeRemovedObservable=new Ih,this.onNewMeshAddedObservable=new Ih,this.onMeshRemovedObservable=new Ih,this.onNewSkeletonAddedObservable=new Ih,this.onSkeletonRemovedObservable=new Ih,this.onNewMaterialAddedObservable=new Ih,this.onNewMultiMaterialAddedObservable=new Ih,this.onMaterialRemovedObservable=new Ih,this.onMultiMaterialRemovedObservable=new Ih,this.onNewTextureAddedObservable=new Ih,this.onTextureRemovedObservable=new Ih,this.onBeforeRenderTargetsRenderObservable=new Ih,this.onAfterRenderTargetsRenderObservable=new Ih,this.onBeforeStepObservable=new Ih,this.onAfterStepObservable=new Ih,this.onActiveCameraChanged=new Ih,this.onActiveCamerasChanged=new Ih,this.onBeforeRenderingGroupObservable=new Ih,this.onAfterRenderingGroupObservable=new Ih,this.onMeshImportedObservable=new Ih,this.onAnimationFileImportedObservable=new Ih,this._registeredForLateAnimationBindings=new od(256),this._pointerPickingConfiguration=new uv,this.onPrePointerObservable=new Ih,this.onPointerObservable=new Ih,this.onPreKeyboardObservable=new Ih,this.onKeyboardObservable=new Ih,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=e.FOGMODE_NONE,this.fogColor=new Ah(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new wh(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new od(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new Td,this._activeIndices=new Td,this._activeParticles=new Td,this._activeBones=new Td,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new rd(256),this._processedMaterials=new rd(256),this._renderTargets=new od(256),this._materialsRenderTargets=new od(256),this._activeParticleSystems=new rd(256),this._activeSkeletons=new od(32),this._softwareSkinnedMeshes=new od(32),this._activeAnimatables=new Array,this._transformMatrix=Lh.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=Tm.Create(),this._beforeClearStage=Tm.Create(),this._beforeRenderTargetClearStage=Tm.Create(),this._gatherRenderTargetsStage=Tm.Create(),this._gatherActiveCameraRenderTargetsStage=Tm.Create(),this._isReadyForMeshStage=Tm.Create(),this._beforeEvaluateActiveMeshStage=Tm.Create(),this._evaluateSubMeshStage=Tm.Create(),this._preActiveMeshStage=Tm.Create(),this._cameraDrawRenderTargetStage=Tm.Create(),this._beforeCameraDrawStage=Tm.Create(),this._beforeRenderTargetDrawStage=Tm.Create(),this._beforeRenderingGroupDrawStage=Tm.Create(),this._beforeRenderingMeshStage=Tm.Create(),this._afterRenderingMeshStage=Tm.Create(),this._afterRenderingGroupDrawStage=Tm.Create(),this._afterCameraDrawStage=Tm.Create(),this._afterCameraPostProcessStage=Tm.Create(),this._afterRenderTargetDrawStage=Tm.Create(),this._afterRenderTargetPostProcessStage=Tm.Create(),this._afterRenderStage=Tm.Create(),this._pointerMoveStage=Tm.Create(),this._pointerDownStage=Tm.Create(),this._pointerUpStage=Tm.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const n={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...i};t=this._engine=t||xh.LastCreatedEngine,n.virtual?t._virtualScenes.push(this):(xh._LastCreatedScene=this,t.scenes.push(this)),this._uid=null,this._renderingManager=new Hp(this),Bp&&(this.postProcessManager=new Bp(this)),vf()&&this.attachControl(),this._createUbo(),I_&&(this._imageProcessingConfiguration=new I_),this.setDefaultCandidateProviders(),n.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=n.useMaterialMeshMap,this.useClonedMeshMap=n.useClonedMeshMap,i&&i.virtual||t.onNewSceneAddedObservable.notifyObservers(this)}pick(e,t,i,n,a,s){const r=Qc("Ray",!0);return r&&jh.Warn(r),new Id}get activeParticlesPerfCounter(){return this._activeParticles}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}clearCachedVertexData(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e].geometry;t&&t.clearCachedData()}}set blockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))}getBoneById(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let t=0;t<i.bones.length;t++)if(i.bones[t].id===e)return i.bones[t]}return null}addAnimation(e){this._blockEntityCollection||this.animations.push(e)}simulatePointerMove(e,t){return this._inputManager.simulatePointerMove(e,t),this}get activeBonesPerfCounter(){return this._activeBones}getTransformNodeById(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getBoneByName(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let t=0;t<i.bones.length;t++)if(i.bones[t].name===e)return i.bones[t]}return null}unfreezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].unfreeze()}getLastSkeletonById(e){for(let t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getMorphTargetByName(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let t=0;t<i.numTargets;++t){const n=i.getTarget(t);if(n.name===e)return n}}return null}getSkeletonByName(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null}getMaterialByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}get forceWireframe(){return this._forceWireframe}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)return void(this._activeMeshes.length>0&&(this.activeCamera?._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset()));if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const e=this._activeMeshes.length;for(let t=0;t<e;t++){this._activeMeshes.data[t].computeWorldMatrix()}}if(this._activeParticleSystems){const e=this._activeParticleSystems.length;for(let t=0;t<e;t++)this._activeParticleSystems.data[t].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const e of this._beforeEvaluateActiveMeshStage)e.action();const e=this.getActiveMeshCandidates(),t=e.length;for(let i=0;i<t;i++){const t=e.data[i];if(t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,t.isBlocked)continue;if(this._totalVertices.addCount(t.getTotalVertices(),!1),!t.isReady()||!t.isEnabled()||t.scaling.hasAZeroComponent)continue;t.computeWorldMatrix(),t.actionManager&&t.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(t);let n=this.customLODSelector?this.customLODSelector(t,this.activeCamera):t.getLOD(this.activeCamera);if(t._internalAbstractMeshDataInfo._currentLOD=n,t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,null!=n&&(n!==t&&0!==n.billboardMode&&n.computeWorldMatrix(),t._preActivate(),t.isVisible&&t.visibility>0&&0!=(t.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||t.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(t),this.activeCamera._activeMeshes.push(t),n!==t&&n._activate(this._renderId,!1);for(const e of this._preActiveMeshStage)e.action(t);t._activate(this._renderId,!1)&&(t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(n=t):n._internalAbstractMeshDataInfo._onlyForInstances=!1,n._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(t,n)),t._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let e=0;e<this.particleSystems.length;e++){const t=this.particleSystems[e];if(!t.isStarted()||!t.emitter)continue;const i=t.emitter;i.position&&!i.isEnabled()||(this._activeParticleSystems.push(t),t.animate(),this._renderingManager.dispatchParticles(t))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}getTextureByName(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null}set pointerY(e){this._inputManager.pointerY=e}addTexture(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))}_getComponent(e){for(const t of this._components)if(t.name===e)return t;return null}getViewMatrix(){return this._viewMatrix}switchActiveCamera(e,t=!0){this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())}getMaterialByUniqueID(e,t=!1){return this._getMaterial(t,(t=>t.xt===e))}simulatePointerUp(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this}set pointerDownPredicate(e){this._pointerPickingConfiguration.pointerDownPredicate=e}getUniqueId(){return Km.UniqueId}addMesh(e,t=!1){this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.addMesh(e)})))}removeMaterial(e){const t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){const e=this.materials[this.materials.length-1];this.materials[t]=e,e._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t}getTransformNodeByName(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null}_disposeList(e,t){const i=e.slice(0);t=t??(e=>e.dispose());for(const e of i)t(e);e.length=0}set pointerDownFastCheck(e){this._pointerPickingConfiguration.pointerDownFastCheck=e}createSceneUniformBuffer(e){const t=new xd(this._engine,void 0,!1,e??"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}set blockfreeActiveMeshesAndRenderingGroups(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)}_advancePhysicsEngineStep(e){}set activeCameras(e){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),e&&(this._unObserveActiveCameras=ah(e,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=e}set shadowsEnabled(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))}set pointerX(e){this._inputManager.pointerX=e}_evaluateSubMesh(e,t,i,n){if(n||e.isInFrustum(this._frustumPlanes)){for(const i of this._evaluateSubMeshStage)i.action(t,e);const i=e.getMaterial();null!=i&&(i.hasRenderTargetTextures&&null!=i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._materialsRenderTargets.concatWithNoDuplicate(i.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,i))}}getSkeletonByUniqueId(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].xt===e)return this.skeletons[t];return null}getCameraByName(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null}getNodeByID(e){return this.getNodeById(e)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set skipPointerMovePicking(e){this._pointerPickingConfiguration.skipPointerMovePicking=e}getTransformNodesByID(e){return this.getTransformNodesById(e)}static get LongPressDelay(){return cv.LongPressDelay}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}getMeshByName(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}_getByTags(e,t,i){if(void 0===t)return e;const n=[];for(const a in e){const s=e[a];eh&&eh.MatchesQuery(s,t)&&(!i||i(s))&&n.push(s)}return n}set pointerUpPredicate(e){this._pointerPickingConfiguration.pointerUpPredicate=e}_forceBlockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism=e}isReady(e=!0){if(this._isDisposed)return!1;let t;const i=this.getEngine(),n=i.currentRenderPassId;i.currentRenderPassId=this.activeCamera?.renderPassId??n;let a=!0;for(this._pendingData.length>0&&(a=!1),this.prePassRenderer?.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&a&&(a=this.depthPeelingRenderer.isReady()),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),t=0;t<this.meshes.length;t++){const n=this.meshes[t];if(!n.subMeshes||0===n.subMeshes.length)continue;if(!n.isReady(!0)){a=!1;continue}const s=n.hasThinInstances||"InstancedMesh"===n.getClassName()||"InstancedLinesMesh"===n.getClassName()||i.getCaps().instancedArrays&&n.instances.length>0;for(const e of this._isReadyForMeshStage)e.action(n,s)||(a=!1);if(!e)continue;const r=n.material||this.defaultMaterial;if(r)if(r._storeEffectOnSubMeshes)for(const e of n.subMeshes){const t=e.getMaterial();t&&t.hasRenderTargetTextures&&null!=t.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(t)&&(this._processedMaterials.push(t),this._materialsRenderTargets.concatWithNoDuplicate(t.getRenderTargetTextures()))}else r.hasRenderTargetTextures&&null!=r.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(r)&&(this._processedMaterials.push(r),this._materialsRenderTargets.concatWithNoDuplicate(r.getRenderTargetTextures()))}if(e)for(t=0;t<this._materialsRenderTargets.length;++t){this._materialsRenderTargets.data[t].isReadyForRendering()||(a=!1)}for(t=0;t<this.geometries.length;t++){2===this.geometries[t].delayLoadState&&(a=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const e of this.activeCameras)e.isReady(!0)||(a=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(a=!1));for(const e of this.particleSystems)e.isReady()||(a=!1);if(this.layers)for(const e of this.layers)e.isReady()||(a=!1);return i.areAllEffectsReady()||(a=!1),i.currentRenderPassId=n,a}get skipPointerMovePicking(){return this._pointerPickingConfiguration.skipPointerMovePicking}multiPickWithRay(e,t,i){throw Qc("Ray")}getCameraByUniqueId(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].xt===e)return this.cameras[t];return null}get isDisposed(){return this._isDisposed}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}}get defaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=e.DefaultMaterialFactory(this)),this._defaultMaterial}pickWithRay(e,t,i,n){throw Qc("Ray")}getMeshByUniqueId(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].xt===e)return this.meshes[t];return null}_activeMesh(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));let i=e.hasInstances||e.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh;if(t&&t.subMeshes&&t.subMeshes.length>0){const n=this.getActiveSubMeshCandidates(t),a=n.length;i=i||1===a;for(let s=0;s<a;s++){const a=n.data[s];this._evaluateSubMesh(a,t,e,i)}}}getMaterialByID(e){return this.getMaterialById(e)}static set DragMovementThreshold(e){cv.DragMovementThreshold=e}_executeOnceBeforeRender(e){const t=()=>{e(),setTimeout((()=>{this.unregisterBeforeRender(t)}))};this.registerBeforeRender(t)}set defaultMaterial(e){this._defaultMaterial=e}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}static get DoubleClickDelay(){return cv.DoubleClickDelay}get activeCameras(){return this._activeCameras}set forcePointsCloud(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}stopAnimation(e,t,i){}getMorphTargetManagerById(e){for(let t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].xt===e)return this.morphTargetManagers[t];return null}get useRightHandedSystem(){return this._useRightHandedSystem}getWaitingItemsCount(){return this._pendingData.length}addActionManager(e){this.actionManagers.push(e)}_checkCameraRenderTarget(e){if(e?.outputRenderTarget&&!e?.isRigCamera&&(e.outputRenderTarget._cleared=!1),e?.rigCameras?.length)for(let t=0;t<e.rigCameras.length;++t){const i=e.rigCameras[t].outputRenderTarget;i&&(i._cleared=!1)}}getLastMeshByID(e){return this.getLastMeshById(e)}getLastEntryByID(e){return this.getLastEntryById(e)}setTransformMatrix(e,t,i,n){i||n||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?hd.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=hd.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,n):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}markAllMaterialsAsDirty(e,t){if(!this._blockMaterialDirtyMechanism)for(const i of this.materials)t&&!t(i)||i.markAsDirty(e)}setRenderingAutoClearDepthStencil(e,t,i=!0,n=!0){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,n)}bindEyePosition(e,t="vEyePosition",i=!1){const n=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,a=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return kh.Vector4[0].set(n.x,n.y,n.z,a?-1:1),e&&(i?e.setFloat3(t,kh.Vector4[0].x,kh.Vector4[0].y,kh.Vector4[0].z):e.setVector4(t,kh.Vector4[0])),kh.Vector4[0]}_requestFileAsync(e,t,i,n,a){return new Promise(((s,r)=>{this._requestFile(e,(e=>{s(e)}),t,i,n,(e=>{r(e)}),a)}))}get skipFrustumClipping(){return this._skipFrustumClipping}removeParticleSystem(e){const t=this.particleSystems.indexOf(e);return-1!==t&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}set performancePriority(e){if(e!==this._performancePriority){switch(this._performancePriority=e,e){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(e)}}addMaterial(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))}set pointerMoveFastCheck(e){this._pointerPickingConfiguration.pointerMoveFastCheck=e}getMaterialById(e,t=!1){return this._getMaterial(t,(t=>t.id===e))}getActiveParticles(){return this._activeParticles.current}getLastMaterialByID(e){return this.getLastMaterialById(e)}whenReadyAsync(e=!1){return new Promise((t=>{this.executeWhenReady((()=>{t()}),e)}))}_rebuildGeometries(){for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const e of this._components)e.rebuild();for(const e of this.particleSystems)e.rebuild();if(this.spriteManagers)for(const e of this.spriteManagers)e.rebuild()}removeMesh(e,t=!1){const i=this.meshes.indexOf(e);return-1!==i&&(this.meshes[i]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.removeMesh(e)})),i}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set environmentTexture(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))}getPerfCollector(){throw Qc("performanceViewerSceneExtension")}_isInIntermediateRendering(){return this._intermediateRendering}_clearFrameBuffer(e){if(e&&e._multiviewTexture);else if(e&&e.outputRenderTarget&&!e._renderingMultiview){const t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||e.isRightCamera||(this.autoClear&&this._engine.clear(t.clearColor||this.clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_bindFrameBuffer(e,t=!0){e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=e=>this._getDefaultSubMeshCandidates(e),this.getIntersectingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e),this.getCollidingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e)}dispose(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this.stopAllAnimations&&(this._activeAnimatables.forEach((e=>{e.onAnimationEndObservable.clear(),e.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const e=this._activeRequests.slice();for(const t of e)t.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(e){jh.Error("An error occurred while calling onDisposeObservable!",e)}this.detachControl();if(this._engine.getInputElement())for(let e=0;e<this.cameras.length;e++)this.cameras[e].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(e=>e.dispose(!0))),this._disposeList(this.transformNodes,(e=>e.dispose(!0)));const t=this.cameras;this._disposeList(t),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let i=this._engine.scenes.indexOf(this);i>-1&&this._engine.scenes.splice(i,1),xh._LastCreatedScene===this&&(this._engine.scenes.length>0?xh._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:xh._LastCreatedScene=null),i=this._engine._virtualScenes.indexOf(this),i>-1&&this._engine._virtualScenes.splice(i,1),this._engine.wipeCaches(!0),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this._isDisposed=!0}getCachedEffect(){return this._cachedEffect}getBoneByID(e){return this.getBoneById(e)}set skipPointerDownPicking(e){this._pointerPickingConfiguration.skipPointerDownPicking=e}registerBeforeRender(e){this.onBeforeRenderObservable.add(e)}isCachedMaterialInvalid(e,t,i=1){return this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i}getActiveMeshes(){return this._activeMeshes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const e of this._transientComponents)e.register();this._transientComponents.length=0}}setStepId(e){this._currentStepId=e}static CollisionCoordinatorFactory(){throw Qc("DefaultCollisionCoordinator")}get _pickingAvailable(){return!1}get frustumPlanes(){return this._frustumPlanes}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}getNodeByName(e){const t=this.getMeshByName(e);if(t)return t;const i=this.getTransformNodeByName(e);if(i)return i;const n=this.getLightByName(e);if(n)return n;const a=this.getCameraByName(e);if(a)return a;const s=this.getBoneByName(e);return s||null}getLightByUniqueId(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].xt===e)return this.lights[t];return null}get pointerX(){return this._inputManager.pointerX}removeCamera(e){const t=this.cameras.indexOf(e);if(-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){const t=this.activeCameras.indexOf(e);-1!==t&&this.activeCameras.splice(t,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t}_renderForCamera(e,t,i=!0){if(e&&e._skipRendering)return;const n=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(n.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&i){let t=!0;e._renderingMultiview&&e.outputRenderTarget&&(t=e.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=t)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let e=0;e<this._softwareSkinnedMeshes.length;e++){const t=this._softwareSkinnedMeshes.data[e];t.applySkeleton(t.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const e of this._gatherActiveCameraRenderTargetsStage)e.action(this._renderTargets);let a=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){ad.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let e=0;e<this._renderTargets.length;e++){const t=this._renderTargets.data[e];if(t._shouldRender()){this._renderId++;const e=t.activeCamera&&t.activeCamera!==this.activeCamera;t.render(e,this.dumpNextRenderTargets),a=!0}}ad.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const e of this._cameraDrawRenderTargetStage)a=e.action(this.activeCamera)||a;this._intermediateRendering=!1}this._engine.currentRenderPassId=e.outputRenderTarget?.renderPassId??e.renderPassId??0,a&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const e of this._beforeCameraDrawStage)e.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),n.snapshotRendering&&1===n.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const e of this._afterCameraDrawStage)e.action(this.activeCamera);if(this.postProcessManager&&!e._multiviewTexture){const t=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,t)}for(const e of this._afterCameraPostProcessStage)e.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}static get ExclusiveDoubleClickMode(){return cv.ExclusiveDoubleClickMode}set activeCamera(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))}getLightByUniqueID(e){return this.getLightByUniqueId(e)}addMultiMaterial(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))}getLightById(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null}getAnimationGroupByName(e){for(let t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null}set pointerUpFastCheck(e){this._pointerPickingConfiguration.pointerUpFastCheck=e}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}addSkeleton(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))}removePendingData(e){const t=this.isLoading,i=this._pendingData.indexOf(e);-1!==i&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}addLight(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(const t of this.meshes)-1===t.lightSources.indexOf(e)&&(t.lightSources.push(e),t._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(e)}}removeGeometry(e){let t;if(this._geometriesByUniqueId){if(t=this._geometriesByUniqueId[e.xt],void 0===t)return!1}else if(t=this.geometries.indexOf(e),t<0)return!1;if(t!==this.geometries.length-1){const e=this.geometries[this.geometries.length-1];e&&(this.geometries[t]=e,this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.xt]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.xt]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0}set pointerMovePredicate(e){this._pointerPickingConfiguration.pointerMovePredicate=e}removeMultiMaterial(e){const t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}removeExternalData(e){return this._externalData.remove(e)}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))}removeActionManager(e){const t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t}addPendingData(e){this._pendingData.push(e)}getWorldExtends(e){const t=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new wh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||(()=>!0),this.meshes.filter(e).forEach((e=>{if(e.computeWorldMatrix(!0),!e.subMeshes||0===e.subMeshes.length||e.infiniteDistance)return;const n=e.getBoundingInfo(),a=n.boundingBox.minimumWorld,s=n.boundingBox.maximumWorld;wh.CheckExtends(a,t,i),wh.CheckExtends(s,t,i)})),{min:t,max:i}}removeSkeleton(e){const t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t}removeTexture(e){const t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t}simulatePointerDown(e,t){return this._inputManager.simulatePointerDown(e,t),this}getCameraByID(e){return this.getCameraById(e)}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}getCachedMaterial(){return this._cachedMaterial}static get DragMovementThreshold(){return cv.DragMovementThreshold}getGeometries(){return this.geometries}getActiveBones(){return this._activeBones.current}addExternalData(e,t){return this._externalData||(this._externalData=new R_),this._externalData.add(e,t)}registerAfterRender(e){this.onAfterRenderObservable.add(e)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set skeletonsEnabled(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))}getLightByID(e){return this.getLightById(e)}pickWithBoundingInfo(e,t,i,n,a){const s=Qc("Ray",!0);return s&&jh.Warn(s),new Id}getLastMaterialById(e,t=!1){for(let t=this.materials.length-1;t>=0;t--)if(this.materials[t].id===e)return this.materials[t];if(t)for(let t=this.multiMaterials.length-1;t>=0;t--)if(this.multiMaterials[t].id===e)return this.multiMaterials[t];return null}getMeshesByID(e){return this.getMeshesById(e)}_clear(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}get shadowsEnabled(){return this._shadowsEnabled}getCachedVisibility(){return this._cachedVisibility}getFrameId(){return this._frameId}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let e=0;e<this.textures.length;e++){const t=this.textures[e];t&&t.Pt&&t.freeRenderingGroups()}}createPickingRayToRef(e,t,i,n,a,s=!1,r=!1){throw Qc("Ray")}_processSubCameras(e,t=!0){if(0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(let t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)}get fogEnabled(){return this._fogEnabled}addParticleSystem(e){this._blockEntityCollection||this.particleSystems.push(e)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}set fogMode(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))}static set LongPressDelay(e){cv.LongPressDelay=e}_getDefaultSubMeshCandidates(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates}static set ExclusiveDoubleClickMode(e){cv.ExclusiveDoubleClickMode=e}getAutoClearDepthStencilSetup(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)}getCameraById(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null}getTextureByUniqueId(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].xt===e)return this.textures[t];return null}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}set beforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))}updateTransformMatrix(e){const t=this.activeCamera;if(t)if(t._renderingMultiview){const i=t._rigCameras[0],n=t._rigCameras[1];this.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(e),n.getViewMatrix(),n.getProjectionMatrix(e))}else this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}get animationPropertiesOverride(){return this._animationPropertiesOverride}getTransformNodesById(e){return this.transformNodes.filter((function(t){return t.id===e}))}pushGeometry(e,t){return!(!t&&this._getGeometryByUniqueId(e.xt))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)}get fogMode(){return this._fogMode}resetLastAnimationTimeFrame(){this._animationTimeLast=Cf.Now}getTransformNodeByUniqueID(e){return this.getTransformNodeByUniqueId(e)}get forcePointsCloud(){return this._forcePointsCloud}addGeometry(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.xt]=this.geometries.length),this.geometries.push(e))}removeLight(e){const t=this.lights.indexOf(e);if(-1!==t){for(const t of this.meshes)t._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t}removeTransformNode(e){const t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){const e=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=e,e._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t}set lightsEnabled(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))}getLastTransformNodeById(e){for(let t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}freezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].freeze()}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=e.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get texturesEnabled(){return this._texturesEnabled}get totalActiveIndicesPerfCounter(){return this._activeIndices}getTransformNodeByUniqueId(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].xt===e)return this.transformNodes[t];return null}multiPick(e,t,i,n,a){throw Qc("Ray")}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getPostProcessByName(e){for(let t=0;t<this.postProcesses.length;++t){const i=this.postProcesses[t];if(i.name===e)return i}return null}getMeshByUniqueID(e){return this.getMeshByUniqueId(e)}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}static set DoubleClickDelay(e){cv.DoubleClickDelay=e}get pointerY(){return this._inputManager.pointerY}get uid(){return this._uid||(this._uid=ad.RandomId()),this._uid}finalizeSceneUbo(){const e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e}getInternalStep(){return this._currentInternalStep}setRenderingOrder(e,t=null,i=null,n=null){this._renderingManager.setRenderingOrder(e,t,i,n)}setSceneUniformBuffer(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}static DefaultMaterialFactory(e){throw Qc("StandardMaterial")}cleanCachedTextureBuffer(){for(const e of this.textures){e._buffer&&(e._buffer=null)}}setActiveCameraById(e){const t=this.getCameraById(e);return t?(this.activeCamera=t,t):null}getTransformNodeByID(e){return this.getTransformNodeById(e)}_animate(e){}getGeometryById(e){for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}getParticleSystemById(e){for(let t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null}getRenderId(){return this._renderId}getMeshesById(e){return this.meshes.filter((function(t){return t.id===e}))}get totalVerticesPerfCounter(){return this._totalVertices}removeAnimationGroup(e){const t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t}removeAnimation(e){const t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t}getExternalData(e){return this._externalData?this._externalData.get(e):null}unregisterBeforeRender(e){this.onBeforeRenderObservable.removeCallback(e)}createPickingRay(e,t,i,n,a=!1){throw Qc("Ray")}freeProcessedMaterials(){this._processedMaterials.dispose()}getSkeletonById(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null}get animatables(){return this._activeAnimatables}_getGeometryByUniqueId(e){if(this._geometriesByUniqueId){const t=this._geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].xt===e)return this.geometries[t];return null}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_requestFile(e,t,i,n,a,s,r){const o=Lu(e,t,i,n?this.offlineProvider:void 0,a,s,r);return this._activeRequests.push(o),o.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),o}set beforeCameraRender(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)}getCameraByUniqueID(e){return this.getCameraByUniqueId(e)}setActiveCameraByID(e){return this.setActiveCameraById(e)}getClassName(){return"Scene"}removeMorphTargetManager(e){const t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t}getTransformMatrix(){return this._transformMatrix}getActiveIndices(){return this._activeIndices.current}set skipPointerUpPicking(e){this._pointerPickingConfiguration.skipPointerUpPicking=e}getLastEntryById(e){let t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null}getProjectionMatrix(){return this._projectionMatrix}incrementRenderId(){this._renderId++}getLastSkeletonByID(e){return this.getLastSkeletonById(e)}set skipFrustumClipping(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)}getNodeById(e){const t=this.getMeshById(e);if(t)return t;const i=this.getTransformNodeById(e);if(i)return i;const n=this.getLightById(e);if(n)return n;const a=this.getCameraById(e);if(a)return a;const s=this.getBoneById(e);return s||null}createPickingRayInCameraSpace(e,t,i){throw Qc("Ray")}_getMaterial(e,t){for(let e=0;e<this.materials.length;e++){const i=this.materials[e];if(t(i))return i}if(e)for(let e=0;e<this.multiMaterials.length;e++){const i=this.multiMaterials[e];if(t(i))return i}return null}getMorphTargetById(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let t=0;t<i.numTargets;++t){const n=i.getTarget(t);if(n.id===e)return n}}return null}get lightsEnabled(){return this._lightsEnabled}_checkIsReady(e=!1){return this._registerTransientComponents(),this.isReady(e)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(e)}),100))}executeWhenReady(e,t=!1){this.onReadyObservable.addOnce(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)}_rebuildTextures(){for(const e of this.textures)e._rebuild(!0);this.markAllMaterialsAsDirty(1)}unfreezeActiveMeshes(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this}getTextureByUniqueID(e){return this.getTextureByUniqueId(e)}get environmentTexture(){return this._environmentTexture}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set useRightHandedSystem(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}render(e=!0,t=!1){if(this.isDisposed)return;this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),this.activeCameras?.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(const e of this._beforeCameraUpdateStage)e.action();if(e)if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];if(t.update(),0!==t.cameraRigMode)for(let e=0;e<t._rigCameras.length;e++)t._rigCameras[e].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let e=0;e<this.activeCamera._rigCameras.length;e++)this.activeCamera._rigCameras[e].update();this.onBeforeRenderObservable.notifyObservers(this);const i=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const n=this.activeCameras?.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){ad.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let e=0;e<this.customRenderTargets.length;e++){const t=this.customRenderTargets[e];if(t._shouldRender()){if(this._renderId++,this.activeCamera=t.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");i.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),t.render(n!==this.activeCamera,this.dumpNextRenderTargets)}}ad.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=n?.renderPassId??0,this.activeCamera=n,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const e of this._beforeClearStage)e.action();this._clearFrameBuffer(this.activeCamera);for(const e of this._gatherRenderTargetsStage)e.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++)this._processSubCameras(this.activeCameras[e],e>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(const e of this._afterRenderStage)e.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let e=0;e<this._toBeDisposed.length;e++){const t=this._toBeDisposed[e];t&&t.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(Ud.CompareLightsPriority)}set texturesEnabled(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))}getMeshByID(e){return this.getMeshById(e)}getOrAddExternalDataWithFactory(e,t){return this._externalData||(this._externalData=new R_),this._externalData.getOrAddWithFactory(e,t)}addAnimationGroup(e){this._blockEntityCollection||this.animationGroups.push(e)}unregisterAfterRender(e){this.onAfterRenderObservable.removeCallback(e)}isPointerCaptured(e=0){return this._inputManager.isPointerCaptured(e)}get isLoading(){return this._pendingData.length>0}animate(){if(this._engine.isDeterministicLockStep()){let t=Math.max(e.MinDeltaTime,Math.min(this._engine.getDeltaTime(),e.MaxDeltaTime))+this._timeAccumulator;const i=this._engine.getTimeStep(),n=1e3/i/1e3;let a=0;const s=this._engine.getLockstepMaxSteps();let r=Math.floor(t/i);for(r=Math.min(r,s);t>0&&a<r;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=i*n,this._animate(i),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(i),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,a++,t-=i;this._timeAccumulator=t<0?0:t}else{const t=this.useConstantAnimationDeltaTime?16:Math.max(e.MinDeltaTime,Math.min(this._engine.getDeltaTime(),e.MaxDeltaTime));this._animationRatio=.06*t,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t)}}getMaterialByName(e,t=!1){return this._getMaterial(t,(t=>t.name===e))}getLastMeshById(e){for(let t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null}set forceWireframe(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}setActiveCameraByName(e){const t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null}getStepId(){return this._currentStepId}_loadFile(e,t,i,n,a,s,r){const o=Du(e,t,i,n?this.offlineProvider:void 0,a,s,r);return this._activeRequests.push(o),o.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),o}getEngine(){return this._engine}get performancePriority(){return this._performancePriority}resetDrawCache(e){if(this.meshes)for(const t of this.meshes)t.resetDrawCache(e)}getGeometryByID(e){return this.getGeometryById(e)}set afterCameraRender(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)}_loadFileAsync(e,t,i,n,a){return new Promise(((s,r)=>{this._loadFile(e,(e=>{s(e)}),t,i,n,((e,t)=>{r(t)}),a)}))}detachControl(){this._inputManager.detachControl()}attachControl(e=!0,t=!0,i=!0){this._inputManager.attachControl(e,t,i)}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}getLightByName(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}getParticleSystemByID(e){return this.getParticleSystemById(e)}addCamera(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_readFileAsync(e,t,i){return new Promise(((n,a)=>{this._readFile(e,(e=>{n(e)}),t,i,(e=>{a(e)}))}))}getTotalVertices(){return this._totalVertices.current}setPointerOverMesh(e,t,i){this._inputManager.setPointerOverMesh(e,t,i)}set afterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))}executeOnceBeforeRender(e,t){void 0!==t?setTimeout((()=>{this._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)}createPickingRayInCameraSpaceToRef(e,t,i,n){throw Qc("Ray")}getMeshById(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null}addTransformNode(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))}get skeletonsEnabled(){return this._skeletonsEnabled}_readFile(e,t,i,n,a){const s=Ou(e,t,i,n,a);return this._activeRequests.push(s),s.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),s}freezeActiveMeshes(e=!1,t,i,n=!0,a=!1){return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=a,this._skipEvaluateActiveMeshesCompletely=e,n)for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._freeze();t&&t()}else i&&i("No active camera found")})),this}get renderingManager(){return this._renderingManager}addMorphTargetManager(e){this._blockEntityCollection||this.morphTargetManagers.push(e)}_executeActiveContainerCleanup(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>e.dispose()))}get activeCamera(){return this._activeCamera}};dv.FOGMODE_NONE=0,dv.FOGMODE_EXP=1,dv.FOGMODE_EXP2=2,dv.FOGMODE_LINEAR=3,dv.MinDeltaTime=1,dv.MaxDeltaTime=1e3,rh("BABYLON.Scene",dv);var mv=class e extends Vh{_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}set includedOnlyMeshes(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}set excludedMeshes(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}static Parse(t,i){const n=e.GetConstructorFromName(t.type,t.name,i);if(!n)return null;const a=Uh.Parse(n,t,i);if(t.excludedMeshesIds&&(a._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(a._includedOnlyMeshesIds=t.includedOnlyMeshesIds),void 0!==t.parentId&&(a._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(a._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.falloffType&&(a.falloffType=t.falloffType),void 0!==t.lightmapMode&&(a.lightmapMode=t.lightmapMode),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],n=oh("BABYLON.Animation");n&&a.animations.push(n.Parse(i))}Vh.ParseAnimationRanges(a,t,i)}return t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&a.setEnabled(t.isEnabled),a}transferTexturesToEffect(e,t){return this}getViewMatrix(e){return null}set intensityMode(e){this._intensityMode=e,this._computePhotometricScale()}getAbsolutePosition(){return wh.Zero()}set lightmapMode(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}_reorderLightsInScene(){const e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}get radius(){return this._radius}getClassName(){return"Light"}getScaledIntensity(){return this._photometricScale*this.intensity}_getPhotometricScale(){let t=0;const i=this.getTypeID();let n=this.intensityMode;switch(n===e.INTENSITYMODE_AUTOMATIC&&(n=i===e.LIGHTTYPEID_DIRECTIONALLIGHT?e.INTENSITYMODE_ILLUMINANCE:e.INTENSITYMODE_LUMINOUSINTENSITY),i){case e.LIGHTTYPEID_POINTLIGHT:case e.LIGHTTYPEID_SPOTLIGHT:switch(n){case e.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case e.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case e.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius}break;case e.LIGHTTYPEID_DIRECTIONALLIGHT:switch(n){case e.INTENSITYMODE_ILLUMINANCE:t=1;break;case e.INTENSITYMODE_LUMINANCE:{let e=this.radius;e=Math.max(e,.001);t=2*Math.PI*(1-Math.cos(e));break}}break;case e.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t}set shadowEnabled(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}getShadowGenerator(e=null){return null===this._shadowGenerators?null:this._shadowGenerators.get(e)??null}set radius(e){this._radius=e,this._computePhotometricScale()}constructor(t,i){super(t,i,!1),this.diffuse=new Ah(1,1,1),this.specular=new Ah(1,1,1),this.falloffType=e.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=e.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new xd(this.getScene().getEngine(),void 0,void 0,t),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}get includedOnlyMeshes(){return this._includedOnlyMeshes}_resyncMeshes(){for(const e of this.getScene().meshes)e._resyncLightSource(this)}_hookArrayForIncludedOnly(e){const t=e.push;e.push=(...i)=>{const n=t.apply(e,i);return this._resyncMeshes(),n};const i=e.splice;e.splice=(t,n)=>{const a=i.apply(e,[t,n]);return this._resyncMeshes(),a},this._resyncMeshes()}setEnabled(e){super.setEnabled(e),this._resyncMeshes()}set includeOnlyWithLayerMask(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}canAffectMesh(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))}_markMeshesAsLightDirty(){for(const e of this.getScene().meshes)-1!==e.lightSources.indexOf(this)&&e._markSubMeshesAsLightDirty()}getShadowGenerators(){return this._shadowGenerators}_bindLight(e,t,i,n,a=!0){const s=e.toString();let r=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+s),this._renderId!==t.getRenderId()||this._lastUseSpecular!==n||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=n;const e=this.getScaledIntensity();this.transferToEffect(i,s),this.diffuse.scaleToRef(e,Rh.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",Rh.Color3[0],this.range,s),n&&(this.specular.scaleToRef(e,Rh.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",Rh.Color3[1],this.radius,s)),r=!0}if(this.transferTexturesToEffect(i,s),t.shadowsEnabled&&this.shadowEnabled&&a){const e=this.getShadowGenerator(t.activeCamera)??this.getShadowGenerator();e&&(e.bindShadowLight(s,i),r=!0)}r?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}set range(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}get range(){return this._range}get excludeWithLayerMask(){return this._excludeWithLayerMask}getProjectionMatrix(e,t){return null}get intensityMode(){return this._intensityMode}get lightmapMode(){return this._lightmapMode}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}get excludedMeshes(){return this._excludedMeshes}set excludeWithLayerMask(e){this._excludeWithLayerMask=e,this._resyncMeshes()}clone(t,i=null){const n=e.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!n)return null;const a=Uh.Clone(n,this);return t&&(a.name=t),i&&(a.parent=i),a.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(a),a}serialize(){const e=Uh.Serialize(this);return e.xt=this.xt,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((t=>{e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((t=>{e.includedOnlyMeshesIds.push(t.id)}))),Uh.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}static GetConstructorFromName(e,t,i){const n=Vh.Construct("Light_Type_"+e,t,i);return n||null}get shadowEnabled(){return this._shadowEnabled}getTypeID(){return 0}toString(e){let t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}dispose(e,t=!1){if(this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next()){t.value.dispose()}this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const e=this._parentContainer.lights.indexOf(this);e>-1&&this._parentContainer.lights.splice(e,1),this._parentContainer=null}for(const e of this.getScene().meshes)e._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(e,t)}_hookArrayForExcluded(e){const t=e.push;e.push=(...i)=>{const n=t.apply(e,i);for(const e of i)e._resyncLightSource(this);return n};const i=e.splice;e.splice=(t,n)=>{const a=i.apply(e,[t,n]);for(const e of a)e._resyncLightSource(this);return a};for(const t of e)t._resyncLightSource(this)}};mv.FALLOFF_DEFAULT=Ud.FALLOFF_DEFAULT,mv.FALLOFF_PHYSICAL=Ud.FALLOFF_PHYSICAL,mv.FALLOFF_GLTF=Ud.FALLOFF_GLTF,mv.FALLOFF_STANDARD=Ud.FALLOFF_STANDARD,mv.LIGHTMAP_DEFAULT=Ud.LIGHTMAP_DEFAULT,mv.LIGHTMAP_SPECULAR=Ud.LIGHTMAP_SPECULAR,mv.LIGHTMAP_SHADOWSONLY=Ud.LIGHTMAP_SHADOWSONLY,mv.INTENSITYMODE_AUTOMATIC=Ud.INTENSITYMODE_AUTOMATIC,mv.INTENSITYMODE_LUMINOUSPOWER=Ud.INTENSITYMODE_LUMINOUSPOWER,mv.INTENSITYMODE_LUMINOUSINTENSITY=Ud.INTENSITYMODE_LUMINOUSINTENSITY,mv.INTENSITYMODE_ILLUMINANCE=Ud.INTENSITYMODE_ILLUMINANCE,mv.INTENSITYMODE_LUMINANCE=Ud.INTENSITYMODE_LUMINANCE,mv.LIGHTTYPEID_POINTLIGHT=Ud.LIGHTTYPEID_POINTLIGHT,mv.LIGHTTYPEID_DIRECTIONALLIGHT=Ud.LIGHTTYPEID_DIRECTIONALLIGHT,mv.LIGHTTYPEID_SPOTLIGHT=Ud.LIGHTTYPEID_SPOTLIGHT,mv.LIGHTTYPEID_HEMISPHERICLIGHT=Ud.LIGHTTYPEID_HEMISPHERICLIGHT,Lc([Wc()],mv.prototype,"diffuse",void 0),Lc([Wc()],mv.prototype,"specular",void 0),Lc([Hc()],mv.prototype,"falloffType",void 0),Lc([Hc()],mv.prototype,"intensity",void 0),Lc([Hc()],mv.prototype,"range",null),Lc([Hc()],mv.prototype,"intensityMode",null),Lc([Hc()],mv.prototype,"radius",null),Lc([Hc()],mv.prototype,"_renderPriority",void 0),Lc([Uc("_reorderLightsInScene")],mv.prototype,"renderPriority",void 0),Lc([Hc("shadowEnabled")],mv.prototype,"_shadowEnabled",void 0),Lc([Hc("excludeWithLayerMask")],mv.prototype,"_excludeWithLayerMask",void 0),Lc([Hc("includeOnlyWithLayerMask")],mv.prototype,"_includeOnlyWithLayerMask",void 0),Lc([Hc("lightmapMode")],mv.prototype,"_lightmapMode",void 0),Vh.AddNodeConstructor("Light_Type_3",((e,t)=>()=>new pv(e,wh.Zero(),t)));var pv=class extends mv{prepareLightSpecificDefines(e,t){e["HEMILIGHT"+t]=!0}transferToNodeMaterialEffect(e,t){const i=wh.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getTypeID(){return mv.LIGHTTYPEID_HEMISPHERICLIGHT}getShadowGenerator(){return null}constructor(e,t,i){super(e,i),this.groundColor=new Ah(0,0,0),this.direction=t||wh.Up()}setDirectionToTarget(e){return this.direction=wh.Normalize(e.subtract(wh.Zero())),this.direction}transferToEffect(e,t){const i=wh.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=Lh.Identity()),this._worldMatrix}getClassName(){return"HemisphericLight"}};Lc([Wc()],pv.prototype,"groundColor",void 0),Lc([Yc()],pv.prototype,"direction",void 0),rh("BABYLON.HemisphericLight",pv);var _v=class extends mv{_initCache(){super._initCache(),this._cache.position=wh.Zero()}get direction(){return this._direction}getProjectionMatrix(e,t){return this.setShadowProjectionMatrix(this._projectionMatrix,e??this._viewMatrix,t??[]),this._projectionMatrix}set position(e){this._setPosition(e)}_isSynchronized(){return!!this._cache.position.equals(this.position)}getRotation(){this.direction.normalize();const e=wh.Cross(this.direction,Ld.Y),t=wh.Cross(e,this.direction);return wh.RotationFromAxis(e,t,this.direction)}get shadowMaxZ(){return this._shadowMaxZ}getViewMatrix(e){const t=kh.Vector3[0];let i=this.position;this.computeTransformedInformation()&&(i=this.transformedPosition),wh.NormalizeToRef(this.getShadowDirection(e),t),1===Math.abs(wh.Dot(t,wh.Up()))&&(t.z=1e-13);const n=kh.Vector3[1];return i.addToRef(t,n),Lh.LookAtLHToRef(i,n,wh.Up(),this._viewMatrix),this._viewMatrix}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setShadowProjectionMatrix(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this}getDepthMaxZ(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getDepthMinZ(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ}get shadowMinZ(){return this._shadowMinZ}set direction(e){this._setDirection(e)}set shadowMaxZ(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()}getShadowDirection(e){return this.transformedDirection?this.transformedDirection:this.direction}constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=Lh.Identity(),this._projectionMatrix=Lh.Identity()}computeWorldMatrix(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=Lh.Identity()),Lh.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}_setDirection(e){this._direction=e}getDepthScale(){return 50}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=wh.Zero()),wh.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=wh.Zero()),wh.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}setDirectionToTarget(e){return this.direction=wh.Normalize(e.subtract(this.position)),this.direction}set shadowMinZ(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()}get position(){return this._position}_setPosition(e){this._position=e}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}};Lc([Yc()],_v.prototype,"position",null),Lc([Yc()],_v.prototype,"direction",null),Lc([Hc()],_v.prototype,"shadowMinZ",null),Lc([Hc()],_v.prototype,"shadowMaxZ",null),Vh.AddNodeConstructor("Light_Type_1",((e,t)=>()=>new vv(e,wh.Zero(),t)));var vv=class extends _v{set shadowFrustumSize(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()}_setDefaultFixedFrustumShadowProjectionMatrix(e){const t=this.getScene().activeCamera;t&&Lh.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e,this.getScene().getEngine().isNDCHalfZRange)}constructor(e,t,i){super(e,i),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=t.scale(-1),this.direction=t}set orthoRight(e){this._orthoRight=e}get orthoTop(){return this._orthoTop}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()}get orthoRight(){return this._orthoRight}get orthoBottom(){return this._orthoBottom}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?(e.setFloat3(t,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(t,this.direction.x,this.direction.y,this.direction.z),this)}_setDefaultAutoExtendShadowProjectionMatrix(e,t,i){const n=this.getScene().activeCamera;if(!n)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const e=wh.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let n=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let s=0;s<i.length;s++){const r=i[s];if(!r)continue;const o=r.getBoundingInfo().boundingBox;for(let i=0;i<o.vectorsWorld.length;i++)wh.TransformCoordinatesToRef(o.vectorsWorld[i],t,e),e.x<this._orthoLeft&&(this._orthoLeft=e.x),e.y<this._orthoBottom&&(this._orthoBottom=e.y),e.x>this._orthoRight&&(this._orthoRight=e.x),e.y>this._orthoTop&&(this._orthoTop=e.y),this.autoCalcShadowZBounds&&(e.z<n&&(n=e.z),e.z>a&&(a=e.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=n,this._shadowMaxZ=a)}const a=this._orthoRight-this._orthoLeft,s=this._orthoTop-this._orthoBottom,r=void 0!==this.shadowMinZ?this.shadowMinZ:n.minZ,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,l=this.getScene().getEngine().useReverseDepthBuffer;Lh.OrthoOffCenterLHToRef(this._orthoLeft-a*this.shadowOrthoScale,this._orthoRight+a*this.shadowOrthoScale,this._orthoBottom-s*this.shadowOrthoScale,this._orthoTop+s*this.shadowOrthoScale,l?o:r,l?r:o,e,this.getScene().getEngine().isNDCHalfZRange)}set orthoLeft(e){this._orthoLeft=e}set orthoTop(e){this._orthoTop=e}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"DirectionalLight"}set orthoBottom(e){this._orthoBottom=e}transferToEffect(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)}get orthoLeft(){return this._orthoLeft}get shadowFrustumSize(){return this._shadowFrustumSize}_setDefaultShadowProjectionMatrix(e,t,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,i)}getTypeID(){return mv.LIGHTTYPEID_DIRECTIONALLIGHT}prepareLightSpecificDefines(e,t){e["DIRLIGHT"+t]=!0}getDepthMaxZ(e){const t=this._scene.getEngine();return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}getDepthMinZ(e){const t=this._scene.getEngine();return!t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}};Lc([Hc()],vv.prototype,"shadowFrustumSize",null),Lc([Hc()],vv.prototype,"shadowOrthoScale",null),Lc([Hc()],vv.prototype,"autoUpdateExtends",void 0),Lc([Hc()],vv.prototype,"autoCalcShadowZBounds",void 0),Lc([Hc("orthoLeft")],vv.prototype,"_orthoLeft",void 0),Lc([Hc("orthoRight")],vv.prototype,"_orthoRight",void 0),Lc([Hc("orthoTop")],vv.prototype,"_orthoTop",void 0),Lc([Hc("orthoBottom")],vv.prototype,"_orthoBottom",void 0),rh("BABYLON.DirectionalLight",vv),hi(),_i();var gv=class e extends Ip{get packedFloat(){return this._packedFloat}_gaussianWeight(e){const t=1/3,i=-e*e/(2*t*t);return 1/(Math.sqrt(2*Math.PI)*t)*Math.exp(i)}async _initShaderSourceAsync(e){e?(this._webGPUReady=!0,await Promise.all([Promise.resolve().then((()=>(Ri(),yi))),Promise.resolve().then((()=>(bi(),Ni)))])):await Promise.all([Promise.resolve().then((()=>(hi(),ri))),Promise.resolve().then((()=>(_i(),ui)))]),await super._initShaderSourceAsync(e)}updateEffect(e=null,t=null,i=null,n,a,s){this._updateParameters(a,s)}constructor(e,t,i,n,a,s=yp.BILINEAR_SAMPLINGMODE,r,o,l=0,c="",h=!1,f=5){super(e,"kernelBlur",["delta","direction"],["circleOfConfusionSampler"],n,a,s,r,o,null,l,"kernelBlur",{varyingCount:0,depCount:0},!0,f),this._blockCompilation=h,this._packedFloat=!1,this._staticDefines="",this._staticDefines=c,this.direction=t,this.onApplyObservable.add((e=>{this._outputTexture?e.setFloat2("delta",1/this._outputTexture.width*this.direction.x,1/this._outputTexture.height*this.direction.y):e.setFloat2("delta",1/this.width*this.direction.x,1/this.height*this.direction.y)})),this.kernel=i}set kernel(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this._blockCompilation||this._updateParameters())}_nearestBestKernel(e){const t=Math.round(e);for(const e of[t,t-1,t+1,t-2,t+2])if(e%2!=0&&Math.floor(e/2)%2==0&&e>0)return Math.max(e,3);return Math.max(t,3)}set packedFloat(e){this._packedFloat!==e&&(this._packedFloat=e,this._blockCompilation||this._updateParameters())}_updateParameters(e,t){const i=this._kernel,n=(i-1)/2;let a=[],s=[],r=0;for(let e=0;e<i;e++){const t=e/(i-1),o=this._gaussianWeight(2*t-1);a[e]=e-n,s[e]=o,r+=o}for(let e=0;e<s.length;e++)s[e]/=r;const o=[],l=[],c=[];for(let e=0;e<=n;e+=2){const t=Math.min(e+1,Math.floor(n));if(e===t)c.push({o:a[e],w:s[e]});else{const i=t===n,r=s[e]+s[t]*(i?.5:1),o=a[e]+1/(1+s[e]/s[t]);0===o?(c.push({o:a[e],w:s[e]}),c.push({o:a[e+1],w:s[e+1]})):(c.push({o:o,w:r}),c.push({o:-o,w:r}))}}for(let e=0;e<c.length;e++)l[e]=c[e].o,o[e]=c[e].w;a=l,s=o;const h=this.getEngine().getCaps().maxVaryingVectors-(1===this.shaderLanguage?1:0),f=Math.max(h,0)-1;let u=Math.min(a.length,f),d="";d+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(d+=`#define CENTER_WEIGHT ${this._glslFloat(s[u-1])}\n`,u--);for(let e=0;e<u;e++)d+=`#define KERNEL_OFFSET${e} ${this._glslFloat(a[e])}\n`,d+=`#define KERNEL_WEIGHT${e} ${this._glslFloat(s[e])}\n`;let m=0;for(let e=f;e<a.length;e++)d+=`#define KERNEL_DEP_OFFSET${m} ${this._glslFloat(a[e])}\n`,d+=`#define KERNEL_DEP_WEIGHT${m} ${this._glslFloat(s[e])}\n`,m++;this.packedFloat&&(d+="#define PACKEDFLOAT 1"),this._blockCompilation=!1,super.updateEffect(d,null,null,{varyingCount:u,depCount:m},e,t)}_glslFloat(e,t=8){return e.toFixed(t).replace(/0+$/,"")}getClassName(){return"BlurPostProcess"}static _Parse(t,i,n,a){return Uh.Parse((()=>new e(t.name,t.direction,t.kernel,t.options,i,t.renderTargetSamplingMode,n.getEngine(),t.reusable,t.textureType,void 0,!1)),t,n,a)}get kernel(){return this._idealKernel}};Lc([Hc("kernel")],gv.prototype,"_kernel",void 0),Lc([Hc("packedFloat")],gv.prototype,"_packedFloat",void 0),Lc([Xc()],gv.prototype,"direction",void 0),rh("BABYLON.BlurPostProcess",gv);var Sv=class e{_bindCustomEffectForRenderSubMeshForShadowMap(e,t,i){t.setMatrix("viewProjection",this.getTransformMatrix())}get bias(){return this._bias}get blurScale(){return this._blurScale}set usePercentageCloserFiltering(t){const i=this._validateFilter(e.FILTER_PCF);(t||this.filter===e.FILTER_PCF)&&(this.filter=t?i:e.FILTER_NONE)}get projectionMatrix(){return this._projectionMatrix}set blurScale(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())}async _initShaderSourceAsync(t=!1){!this._scene.getEngine().isWebGPU||t||e.ForceGLSL?await Promise.all([Promise.resolve().then((()=>(Cn(),Sn))),Promise.resolve().then((()=>(Xn(),Hn))),Promise.resolve().then((()=>(qn(),Yn))),Promise.resolve().then((()=>(ta(),Jn)))]):(this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(Gi(),Li))),Promise.resolve().then((()=>(an(),Zi))),Promise.resolve().then((()=>(cn(),sn))),Promise.resolve().then((()=>(mn(),hn)))])),this._shadersLoaded=!0}get transparencyShadow(){return this._transparencyShadow}get shaderLanguage(){return this._shaderLanguage}isReady(t,i,n){if(!this._shadersLoaded)return!1;const a=t.getMaterial(),s=a?.shadowDepthWrapper;if(this._opacityTexture=null,!a)return!1;const r=[];if(this._prepareShadowDefines(t,i,r,n),s){if(!s.isReadyForSubMesh(t,r,this,i,this._scene.getEngine().currentRenderPassId))return!1}else{const n=t._getDrawWrapper(void 0,!0);let s=n.effect,o=n.defines;const l=[$h.PositionKind],c=t.getMesh();this.normalBias&&c.isVerticesDataPresent($h.NormalKind)&&(l.push($h.NormalKind),r.push("#define NORMAL"),c.nonUniformScaling&&r.push("#define NONUNIFORMSCALING"));const h=a.needAlphaTesting();if((h||a.needAlphaBlending())&&(this.useOpacityTextureForTransparentShadow?this._opacityTexture=a.opacityTexture:this._opacityTexture=a.getAlphaTestTexture(),this._opacityTexture)){if(!this._opacityTexture.isReady())return!1;const t=a.alphaCutOff??e.DEFAULT_ALPHA_CUTOFF;r.push("#define ALPHATEXTURE"),h&&r.push(`#define ALPHATESTVALUE ${t}${t%1==0?".":""}`),c.isVerticesDataPresent($h.UVKind)&&(l.push($h.UVKind),r.push("#define UV1")),c.isVerticesDataPresent($h.UV2Kind)&&1===this._opacityTexture.coordinatesIndex&&(l.push($h.UV2Kind),r.push("#define UV2"))}const f=new Tp;if(c.useBones&&c.computeBonesUsingShaders&&c.skeleton){l.push($h.MatricesIndicesKind),l.push($h.MatricesWeightsKind),c.numBoneInfluencers>4&&(l.push($h.MatricesIndicesExtraKind),l.push($h.MatricesWeightsExtraKind));const e=c.skeleton;r.push("#define NUM_BONE_INFLUENCERS "+c.numBoneInfluencers),c.numBoneInfluencers>0&&f.addCPUSkinningFallback(0,c),e.isUsingTextureForMatrices?r.push("#define BONETEXTURE"):r.push("#define BonesPerMesh "+(e.bones.length+1))}else r.push("#define NUM_BONE_INFLUENCERS 0");const u=c.morphTargetManager;let d=0;if(u&&(d=u.numMaxInfluencers||u.numInfluencers,d>0&&(r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+d),u.isUsingTextureForTargets&&r.push("#define MORPHTARGETS_TEXTURE"),$d(l,c,d))),Vd(a,this._scene,r),i&&(r.push("#define INSTANCES"),Jd(l),t.getRenderingMesh().hasThinInstances&&r.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(const e of this.customShaderOptions.defines)-1===r.indexOf(e)&&r.push(e);const m=c.bakedVertexAnimationManager;i&&m&&m.isEnabled&&(r.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),l.push("bakedVertexAnimationSettingsInstanced"));const p=r.join("\n");if(o!==p){o=p;let e="shadowMap";const t=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","morphTargetCount","boneTextureWidth","softTransparentShadowSM","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime","bakedVertexAnimationTexture"],i=["diffuseSampler","boneSampler","morphTargets","bakedVertexAnimationTexture"],a=["Scene","Mesh"];if(Hd(t),this.customShaderOptions){if(e=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(const e of this.customShaderOptions.attributes)-1===l.indexOf(e)&&l.push(e);if(this.customShaderOptions.uniforms)for(const e of this.customShaderOptions.uniforms)-1===t.indexOf(e)&&t.push(e);if(this.customShaderOptions.samplers)for(const e of this.customShaderOptions.samplers)-1===i.indexOf(e)&&i.push(e)}const r=this._scene.getEngine();s=r.createEffect(e,{attributes:l,uniformsNames:t,uniformBuffersNames:a,samplers:i,defines:p,fallbacks:f,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:d},shaderLanguage:this._shaderLanguage},r),n.setEffect(s,o)}if(!s.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady()))}prepareDefines(t,i){const n=this._scene,a=this._light;n.shadowsEnabled&&a.shadowEnabled&&(t["SHADOW"+i]=!0,this.useContactHardeningShadow?(t["SHADOWPCSS"+i]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePercentageCloserFiltering?(t["SHADOWPCF"+i]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+i]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+i]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+i]=!0),a.needCube()&&(t["SHADOWCUBE"+i]=!0))}_disposeRTTandPostProcesses(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()}_initializeGenerator(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()}_getCamera(){return this._camera??this._scene.activeCamera}recreateShadowMap(){const e=this._shadowMap;if(!e)return;const t=e.Pt;if(this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this._filter,this._applyFilterValues(),t){this._shadowMap.Pt||(this._shadowMap.Pt=[]);for(const e of t)this._shadowMap.Pt.push(e)}else this._shadowMap.Pt=null}forceCompilationAsync(e){return new Promise((t=>{this.forceCompilation((()=>{t()}),e)}))}dispose(){if(this._disposeRTTandPostProcesses(),this._disposeSceneUBOs(),this._light){if(this._light._shadowGenerators){const e=this._light._shadowGenerators.entries();for(let t=e.next();!0!==t.done;t=e.next()){const[e,i]=t.value;i===this&&this._light._shadowGenerators.delete(e)}0===this._light._shadowGenerators.size&&(this._light._shadowGenerators=null)}this._light._markMeshesAsLightDirty()}this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()}getShadowMapForRendering(){return this._shadowMap2?this._shadowMap2:this._shadowMap}_createTargetRenderTexture(){const e=this._scene.getEngine();e._features.supportDepthStencilTexture?(this._shadowMap=new qp(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1,void 0,this._useRedTextureType?6:5),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0,void 0,void 0,void 0,`DepthStencilForShadowGenerator-${this._light.name}`)):this._shadowMap=new qp(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.noPrePassRenderer=!0}get useKernelBlur(){return this._useKernelBlur}set useBlurCloseExponentialShadowMap(t){const i=this._validateFilter(e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)}get contactHardeningLightSizeUVRatio(){return this._contactHardeningLightSizeUVRatio}get blurKernel(){return this._blurKernel}get usePoissonSampling(){return this.filter===e.FILTER_POISSONSAMPLING}removeShadowCaster(e,t=!0){if(!this._shadowMap||!this._shadowMap.Pt)return this;const i=this._shadowMap.Pt.indexOf(e);if(-1!==i&&this._shadowMap.Pt.splice(i,1),t)for(const t of e.getChildren())this.removeShadowCaster(t);return this}addShadowCaster(e,t=!0){if(!this._shadowMap)return this;if(this._shadowMap.Pt||(this._shadowMap.Pt=[]),-1===this._shadowMap.Pt.indexOf(e)&&this._shadowMap.Pt.push(e),t)for(const t of e.getChildMeshes())-1===this._shadowMap.Pt.indexOf(t)&&this._shadowMap.Pt.push(t);return this}get mapSize(){return this._mapSize}set useKernelBlur(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())}get filteringQuality(){return this._filteringQuality}set useExponentialShadowMap(t){const i=this._validateFilter(e.FILTER_EXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)}_disposeBlurPostProcesses(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]}_prepareShadowDefines(e,t,i,n){i.push("#define SM_LIGHTTYPE_"+this._light.getClassName().toUpperCase()),i.push("#define SM_FLOAT "+(0!==this._textureType?"1":"0")),i.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),i.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));const a=e.getMesh();return i.push("#define SM_NORMALBIAS "+(this.normalBias&&a.isVerticesDataPresent($h.NormalKind)?"1":"0")),i.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===mv.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),i.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),i.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&n?"1":"0")),this._isReadyCustomDefines(i,e,t),i}set transparencyShadow(e){this.setTransparencyShadow(e)}get darkness(){return this._darkness}setDarkness(e){return this._darkness=e>=1?1:e<=0?0:e,this}_renderSubMeshForShadowMap(e,t=!1){const i=e.getRenderingMesh(),n=e.getEffectiveMesh(),a=this._scene,s=a.getEngine(),r=e.getMaterial();if(n._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!r||0===e.verticesCount||e._renderId===a.getRenderId())return;const o=a.useRightHandedSystem,l=n._getWorldMatrixDeterminant()<0;let c=r._getEffectiveOrientation(i);(l&&!o||!l&&o)&&(c=0===c?1:0);const h=0===c;s.setState(r.backFaceCulling,void 0,void 0,h,r.cullBackFaces);const f=i._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(f.mustReturn)return;const u=s.getCaps().instancedArrays&&(null!==f.visibleInstances[e._id]&&void 0!==f.visibleInstances[e._id]||i.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(e))if(this.isReady(e,u,t)){e._renderId=a.getRenderId();const o=r.shadowDepthWrapper,l=o?.getEffect(e,this,s.currentRenderPassId)??e._getDrawWrapper(),c=df.GetEffect(l);s.enableEffect(l),u||i._bind(e,c,r.fillMode),this.getTransformMatrix(),c.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===mv.LIGHTTYPEID_DIRECTIONALLIGHT?c.setVector3("lightDataSM",this._cachedDirection):c.setVector3("lightDataSM",this._cachedPosition);const h=this._getCamera();if(h&&c.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(h),this.getLight().getDepthMinZ(h)+this.getLight().getDepthMaxZ(h)),t&&this.enableSoftTransparentShadow&&c.setFloat2("softTransparentShadowSM",n.visibility*r.alpha,this._opacityTexture?.getAlphaFromRGB?1:0),o)e._setMainDrawWrapperOverride(l),o.standalone?o.baseMaterial.bindForSubMesh(n.getWorldMatrix(),i,e):r.bindForSubMesh(n.getWorldMatrix(),i,e),e._setMainDrawWrapperOverride(null);else{if(this._opacityTexture&&(c.setTexture("diffuseSampler",this._opacityTexture),c.setMatrix("diffuseMatrix",this._opacityTexture.getTextureMatrix()||this._defaultTextureMatrix)),i.useBones&&i.computeBonesUsingShaders&&i.skeleton){const e=i.skeleton;if(e.isUsingTextureForMatrices){const t=e.getTransformMatrixTexture(i);if(!t)return;c.setTexture("boneSampler",t),c.setFloat("boneTextureWidth",4*(e.bones.length+1))}else c.setMatrices("mBones",e.getTransformMatrices(i))}Qd(i,c),i.morphTargetManager&&i.morphTargetManager.isUsingTextureForTargets&&i.morphTargetManager._bind(c);const t=e.getMesh().bakedVertexAnimationManager;u&&t&&t.isEnabled&&t.bind(c,!0),Wd(c,r,a)}this._useUBO||o||this._bindCustomEffectForRenderSubMeshForShadowMap(e,c,n),Zd(c,this._scene.getSceneUniformBuffer()),this._scene.getSceneUniformBuffer().bindUniformBuffer();const d=n.getWorldMatrix();u&&(n.getMeshUniformBuffer().bindToEffect(c,"Mesh"),n.transferToEffect(d)),this.forceBackFacesOnly&&s.setState(!0,0,!1,!0,r.cullBackFaces),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(i),this.onBeforeShadowMapRenderObservable.notifyObservers(c),i._processRendering(n,e,c,r.fillMode,f,u,((e,t)=>{n===i||e?(n.getMeshUniformBuffer().bindToEffect(c,"Mesh"),n.transferToEffect(e?t:d)):(i.getMeshUniformBuffer().bindToEffect(c,"Mesh"),i.transferToEffect(t))})),this.forceBackFacesOnly&&s.setState(!0,0,!1,!1,r.cullBackFaces),this.onAfterShadowMapRenderObservable.notifyObservers(c),this.onAfterShadowMapRenderMeshObservable.notifyObservers(i)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}set mapSize(e){this._mapSize=e,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}constructor(t,i,n,a,s,r=!1){this.onBeforeShadowMapRenderObservable=new Ih,this.onAfterShadowMapRenderObservable=new Ih,this.onBeforeShadowMapRenderMeshObservable=new Ih,this.onAfterShadowMapRenderMeshObservable=new Ih,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.useOpacityTextureForTransparentShadow=!1,this.frustumEdgeFalloff=0,this._shaderLanguage=0,this.forceBackFacesOnly=!1,this._lightDirection=wh.Zero(),this._viewMatrix=Lh.Zero(),this._projectionMatrix=Lh.Zero(),this._transformMatrix=Lh.Zero(),this._cachedPosition=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=Lh.Identity(),this._shadersLoaded=!1,this._mapSize=t,this._light=i,this._scene=i.getScene(),this._camera=a??null,this._useRedTextureType=!!s,this._initShaderSourceAsync(r);let o=i._shadowGenerators;o||(o=i._shadowGenerators=new Map),o.set(this._camera,this),this.id=i.id,this._useUBO=this._scene.getEngine().supportsUniformBuffers,this._useUBO&&(this._sceneUBOs=[],this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for Shadow Generator (light "${this._light.name}")`))),e._SceneComponentInitialization(this._scene);const l=this._scene.getEngine().getCaps();n?l.textureFloatRender&&l.textureFloatLinearFiltering?this._textureType=1:l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering?this._textureType=2:this._textureType=0:l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering?this._textureType=2:l.textureFloatRender&&l.textureFloatLinearFiltering?this._textureType=1:this._textureType=0,this._initializeGenerator(),this._applyFilterValues()}get useExponentialShadowMap(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP}set useContactHardeningShadow(t){const i=this._validateFilter(e.FILTER_PCSS);(t||this.filter===e.FILTER_PCSS)&&(this.filter=t?i:e.FILTER_NONE)}_validateFilter(e){return e}_initializeBlurRTTAndPostProcesses(){const e=this._scene.getEngine(),t=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new qp(this._light.name+"_shadowMap2",t,this._scene,!1,!0,this._textureType,void 0,void 0,!1),this._shadowMap2.wrapU=yp.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=yp.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(yp.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new gv(this._light.name+"KernelBlurX",new Ph(1,0),this.blurKernel,1,null,yp.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.width=t,this._kernelBlurXPostprocess.height=t,this._kernelBlurXPostprocess.externalTextureSamplerBinding=!0,this._kernelBlurXPostprocess.onApplyObservable.add((e=>{e.setTexture("textureSampler",this._shadowMap)})),this._kernelBlurYPostprocess=new gv(this._light.name+"KernelBlurY",new Ph(0,1),this.blurKernel,1,null,yp.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,0===this._textureType&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new Ip(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,yp.BILINEAR_SAMPLINGMODE,e,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType,void 0,void 0,void 0,void 0,this._shaderLanguage),this._boxBlurPostprocess.externalTextureSamplerBinding=!0,this._boxBlurPostprocess.onApplyObservable.add((e=>{e.setFloat2("screenSize",t,t),e.setTexture("textureSampler",this._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])}set contactHardeningLightSizeUVRatio(e){this._contactHardeningLightSizeUVRatio=e}static Parse(t,i,n){const a=i.getLightById(t.lightId),s=void 0!==t.cameraId?i.getCameraById(t.cameraId):null,r=n?n(t.mapSize,a,s):new e(t.mapSize,a,void 0,s),o=r.getShadowMap();for(let e=0;e<t.Pt.length;e++){i.getMeshesById(t.Pt[e]).forEach((function(e){o&&(o.Pt||(o.Pt=[]),o.Pt.push(e))}))}return void 0!==t.id&&(r.id=t.id),r.forceBackFacesOnly=!!t.forceBackFacesOnly,void 0!==t.darkness&&r.setDarkness(t.darkness),t.transparencyShadow&&r.setTransparencyShadow(!0),void 0!==t.frustumEdgeFalloff&&(r.frustumEdgeFalloff=t.frustumEdgeFalloff),void 0!==t.bias&&(r.bias=t.bias),void 0!==t.normalBias&&(r.normalBias=t.normalBias),t.usePercentageCloserFiltering?r.usePercentageCloserFiltering=!0:t.useContactHardeningShadow?r.useContactHardeningShadow=!0:t.usePoissonSampling?r.usePoissonSampling=!0:t.useExponentialShadowMap?r.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?r.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?r.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?r.useBlurCloseExponentialShadowMap=!0:t.useVarianceShadowMap?r.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(r.useBlurExponentialShadowMap=!0),void 0!==t.contactHardeningLightSizeUVRatio&&(r.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio),void 0!==t.filteringQuality&&(r.filteringQuality=t.filteringQuality),t.depthScale&&(r.depthScale=t.depthScale),t.blurScale&&(r.blurScale=t.blurScale),t.blurBoxOffset&&(r.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(r.useKernelBlur=t.useKernelBlur),t.blurKernel&&(r.blurKernel=t.blurKernel),r}setTransparencyShadow(e){return this._transparencyShadow=e,this}set normalBias(e){this._normalBias=e}set useCloseExponentialShadowMap(t){const i=this._validateFilter(e.FILTER_CLOSEEXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)}set blurBoxOffset(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())}get useBlurExponentialShadowMap(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP}_disposeSceneUBOs(){if(this._sceneUBOs){for(const e of this._sceneUBOs)e.dispose();this._sceneUBOs=[]}}set useBlurExponentialShadowMap(t){const i=this._validateFilter(e.FILTER_BLUREXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)}get depthScale(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()}getDarkness(){return this._darkness}get viewMatrix(){return this._viewMatrix}_initializeShadowMap(){if(this._createTargetRenderTexture(),null===this._shadowMap)return;this._shadowMap.wrapU=yp.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=yp.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(yp.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.xt=this._storedUniqueId),this._shadowMap.customRenderFunction=(e,t,i,n)=>this._renderForShadowMap(e,t,i,n),this._shadowMap.customIsReadyFunction=()=>!0;const t=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.add((()=>{this._currentSceneUBO=this._scene.getSceneUniformBuffer(),t._debugPushGroup?.(`shadow map generation for pass id ${t.currentRenderPassId}`,1)})),this._shadowMap.onBeforeRenderObservable.add((i=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[0]),this._currentFaceIndex=i,this._filter===e.FILTER_PCF&&t.setColorWrite(!1),this.getTransformMatrix(),this._scene.setTransformMatrix(this._viewMatrix,this._projectionMatrix),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onAfterUnbindObservable.add((()=>{if(this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._currentSceneUBO),this._scene.updateTransformMatrix(),this._filter===e.FILTER_PCF&&t.setColorWrite(!0),!this.useBlurExponentialShadowMap&&!this.useBlurCloseExponentialShadowMap)return void t._debugPopGroup?.(1);const i=this.getShadowMapForRendering();i&&(this._scene.postProcessManager.directRender(this._blurPostProcesses,i.renderTarget,!0),t.unBindFramebuffer(i.renderTarget,!0),t._debugPopGroup?.(1))}));const i=new Ch(0,0,0,0),n=new Ch(1,1,1,1);this._shadowMap.onClearObservable.add((t=>{this._filter===e.FILTER_PCF?t.clear(n,!1,!0,!1):this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t.clear(i,!0,!0,!1):t.clear(n,!0,!0,!1)})),this._shadowMap.onResizeObservable.add((e=>{this._storedUniqueId=this._shadowMap.xt,this._mapSize=e.getRenderSize(),this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}));for(let e=Hp.MIN_RENDERINGGROUPS;e<Hp.MAX_RENDERINGGROUPS;e++)this._shadowMap.setRenderingAutoClearDepthStencil(e,!1)}getShadowMap(){return this._shadowMap}bindShadowLight(t,i){const n=this._light;if(!this._scene.shadowsEnabled||!n.shadowEnabled)return;const a=this._getCamera();if(!a)return;const s=this.getShadowMap();if(!s)return;n.needCube()||i.setMatrix("lightMatrix"+t,this.getTransformMatrix());const r=this.getShadowMapForRendering();this._filter===e.FILTER_PCF?(i.setDepthStencilTexture("shadowTexture"+t,r),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s.getSize().width,1/s.getSize().width,this.frustumEdgeFalloff,t)):this._filter===e.FILTER_PCSS?(i.setDepthStencilTexture("shadowTexture"+t,r),i.setTexture("depthTexture"+t,r),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/s.getSize().width,this._contactHardeningLightSizeUVRatio*s.getSize().width,this.frustumEdgeFalloff,t)):(i.setTexture("shadowTexture"+t,r),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/s.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),n._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(a),this.getLight().getDepthMinZ(a)+this.getLight().getDepthMaxZ(a),t)}get filter(){return this._filter}set depthScale(e){this._depthScale=e}getClassName(){return e.CLASSNAME}set blurKernel(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())}set usePoissonSampling(t){const i=this._validateFilter(e.FILTER_POISSONSAMPLING);(t||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=t?i:e.FILTER_NONE)}get useContactHardeningShadow(){return this.filter===e.FILTER_PCSS}getTransformMatrix(){const e=this._scene;if(this._currentRenderId===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderId=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;let t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),wh.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(wh.Dot(this._lightDirection,wh.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),Lh.LookAtLHToRef(t,t.add(this._lightDirection),wh.Up(),this._viewMatrix);const e=this.getShadowMap();if(e){const t=e.Pt;t&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,t)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix}getLight(){return this._light}set filteringQuality(e){this._filteringQuality!==e&&(this._filteringQuality=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())}_renderForShadowMap(e,t,i,n){let a;if(n.length)for(a=0;a<n.length;a++)this._renderSubMeshForShadowMap(n.data[a]);for(a=0;a<e.length;a++)this._renderSubMeshForShadowMap(e.data[a]);for(a=0;a<t.length;a++)this._renderSubMeshForShadowMap(t.data[a]);if(this._transparencyShadow)for(a=0;a<i.length;a++)this._renderSubMeshForShadowMap(i.data[a],!0);else for(a=0;a<i.length;a++)i.data[a].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}_applyFilterValues(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(yp.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(yp.BILINEAR_SAMPLINGMODE))}serialize(){const e={},t=this.getShadowMap();if(!t)return e;if(e.className=this.getClassName(),e.lightId=this._light.id,e.cameraId=this._camera?.id,e.id=this.id,e.mapSize=t.getRenderSize(),e.forceBackFacesOnly=this.forceBackFacesOnly,e.darkness=this.getDarkness(),e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.filteringQuality=this.filteringQuality,e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.depthScale=this.depthScale,e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.Pt=[],t.Pt)for(let i=0;i<t.Pt.length;i++){const n=t.Pt[i];e.Pt.push(n.id)}return e}forceCompilation(e,t){const i={useInstances:!1,...t},n=this.getShadowMap();if(!n)return void(e&&e(this));const a=n.Pt;if(!a)return void(e&&e(this));const s=[];for(const e of a)s.push(...e.subMeshes);if(0===s.length)return void(e&&e(this));let r=0;const o=()=>{if(this._scene&&this._scene.getEngine()){for(;this.isReady(s[r],i.useInstances,s[r].getMaterial()?.needAlphaBlendingForMesh(s[r].getMesh())??!1);)if(r++,r>=s.length)return void(e&&e(this));setTimeout(o,16)}};o()}set filter(t){if(t=this._validateFilter(t),this._light.needCube()){if(t===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===e.FILTER_PCF||t===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==e.FILTER_PCF&&t!==e.FILTER_PCSS||this._scene.getEngine()._features.supportShadowSamplers?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0}_isReadyCustomDefines(e,t,i){}get blurBoxOffset(){return this._blurBoxOffset}get usePercentageCloserFiltering(){return this.filter===e.FILTER_PCF}get useCloseExponentialShadowMap(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP}set darkness(e){this.setDarkness(e)}get useBlurCloseExponentialShadowMap(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP}get normalBias(){return this._normalBias}set bias(e){this._bias=e}};Sv.CLASSNAME="ShadowGenerator",Sv.ForceGLSL=!1,Sv.FILTER_NONE=0,Sv.FILTER_EXPONENTIALSHADOWMAP=1,Sv.FILTER_POISSONSAMPLING=2,Sv.FILTER_BLUREXPONENTIALSHADOWMAP=3,Sv.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,Sv.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,Sv.FILTER_PCF=6,Sv.FILTER_PCSS=7,Sv.QUALITY_HIGH=0,Sv.QUALITY_MEDIUM=1,Sv.QUALITY_LOW=2,Sv.DEFAULT_ALPHA_CUTOFF=.5,Sv._SceneComponentInitialization=e=>{throw Qc("ShadowGeneratorSceneComponent")},Vh.AddNodeConstructor("TargetCamera",((e,t)=>()=>new yv(e,wh.Zero(),t)));var yv=class e extends fd{getClassName(){return"TargetCamera"}_computeLocalCameraSpeed(){const e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))}_getRigCamPositionAndTarget(t,i){this.getTarget().subtractToRef(this.position,e._TargetFocalPoint),e._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const n=e._TargetFocalPoint.addInPlace(this.position);Lh.TranslationToRef(-n.x,-n.y,-n.z,e._TargetTransformMatrix),e._TargetTransformMatrix.multiplyToRef(Lh.RotationAxis(i.upVector,t),e._RigCamTransformMatrix),Lh.TranslationToRef(n.x,n.y,n.z,e._TargetTransformMatrix),e._RigCamTransformMatrix.multiplyToRef(e._TargetTransformMatrix,e._RigCamTransformMatrix),wh.TransformCoordinatesToRef(this.position,e._RigCamTransformMatrix,i.position),i.setTarget(n)}_computeViewMatrix(e,t,i){if(this.ignoreParentScaling){if(this.parent){const n=this.parent.getWorldMatrix();wh.TransformCoordinatesToRef(e,n,this._globalPosition),wh.TransformCoordinatesToRef(t,n,this._tmpTargetVector),wh.TransformNormalToRef(i,n,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(t),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?Lh.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):Lh.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?Lh.LookAtRHToRef(e,t,i,this._viewMatrix):Lh.LookAtLHToRef(e,t,i,this._viewMatrix),this.parent){const e=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(e,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case fd.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case fd.RIG_MODE_STEREOSCOPIC_OVERUNDER:case fd.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,n=this.cameraRigMode===fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*n,t);break}case fd.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}super._updateRigCameras()}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const e=this.lockedTarget;e.computeWorldMatrix().getTranslationToRef(e.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}set target(e){this.setTarget(e)}getTarget(){return this._currentTarget}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):Lh.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_checkInputs(){const e=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),i=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.copyFrom(this.rotation),this._deferredPositionUpdate.copyFrom(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.copyFrom(this.rotationQuaternion),t&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*e,this._deferredRotationUpdate.y+=this.cameraRotation.y*e,!this.noRotationConstraint){const e=1.570796;this._deferredRotationUpdate.x>e&&(this._deferredRotationUpdate.x=e),this._deferredRotationUpdate.x<-e&&(this._deferredRotationUpdate.x=-e)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.copyFrom(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(Dh.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate))}}t&&(Math.abs(this.cameraDirection.x)<this.speed*hh&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*hh&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*hh&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*hh&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*hh&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_rotateUpVectorWithCameraRotationMatrix(){return wh.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}constructor(e,t,i,n=!0){super(e,t,i,n),this._tmpUpVector=wh.Zero(),this._tmpTargetVector=wh.Zero(),this.cameraDirection=new wh(0,0,0),this.cameraRotation=new Ph(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new Dh,this.rotation=new wh(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=wh.Zero(),this._initialFocalDistance=1,this._viewMatrix=Lh.Zero(),this._camMatrix=Lh.Zero(),this._cameraTransformMatrix=Lh.Zero(),this._cameraRotationMatrix=Lh.Zero(),this._referencePoint=new wh(0,0,1),this._transformedReferencePoint=wh.Zero(),this._deferredPositionUpdate=new wh,this._deferredRotationQuaternionUpdate=new Dh,this._deferredRotationUpdate=new wh,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=wh.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}_updateCache(e){e||super._updateCache();const t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}createRigCamera(t,i){if(this.cameraRigMode!==fd.RIG_MODE_NONE){const i=new e(t,this.position.clone(),this.getScene());return i.isRigCamera=!0,i.rigParent=this,this.cameraRigMode===fd.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new Dh),i._cameraRigParams={},i.rotationQuaternion=new Dh),i.mode=this.mode,i.orthoLeft=this.orthoLeft,i.orthoRight=this.orthoRight,i.orthoTop=this.orthoTop,i.orthoBottom=this.orthoBottom,i}return null}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),wh.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Ld.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(Dh.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Ld.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(kh.Matrix[0]),wh.TransformNormalToRef(this.cameraDirection,kh.Matrix[0],kh.Vector3[0]),this._deferredPositionUpdate.addInPlace(kh.Vector3[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}setTarget(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=hh),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),Lh.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&Dh.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}getFrontPosition(e){this.getWorldMatrix();const t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}get target(){return this.getTarget()}_initCache(){super._initCache(),this._cache.lockedTarget=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new Dh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}};yv._RigCamTransformMatrix=new Lh,yv._TargetTransformMatrix=new Lh,yv._TargetFocalPoint=new wh,Lc([Yc()],yv.prototype,"rotation",void 0),Lc([Hc()],yv.prototype,"speed",void 0),Lc([jc("lockedTargetId")],yv.prototype,"lockedTarget",void 0);var Ev=class{set idleRotationWaitTime(e){this._idleRotationWaitTime=e}get idleRotationSpeed(){return this._idleRotationSpeed}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Cf.Now)}init(){}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}attach(e){this._attachedCamera=e;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver=t.onPrePointerObservable.add((e=>{e.type!==b_.POINTERDOWN?e.type===b_.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const e=Cf.Now;let t=0;null!=this._lastFrameTime&&(t=e-this._lastFrameTime),this._lastFrameTime=e,this._applyUserInteraction();const i=e-this._lastInteractionTime-this._idleRotationWaitTime,n=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*n,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(t/1e3))}))}get zoomStopsAnimation(){return this._zoomStopsAnimation}get idleRotationWaitTime(){return this._idleRotationWaitTime}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<hh}set idleRotationSpeed(e){this._idleRotationSpeed=e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}set idleRotationSpinupTime(e){this._idleRotationSpinupTime=e}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}get name(){return"AutoRotation"}resetLastInteractionTime(e){this._lastInteractionTime=e??Cf.Now}constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}},Av=class e{easeInCore(e){throw new Error("You must implement this method")}setEasingMode(e){const t=Math.min(Math.max(e,0),2);this._easingMode=t}ease(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}getEasingMode(){return this._easingMode}constructor(){this._easingMode=e.EASINGMODE_EASEIN}};Av.EASINGMODE_EASEIN=0,Av.EASINGMODE_EASEOUT=1,Av.EASINGMODE_EASEINOUT=2;var Cv=class extends Av{easeInCore(e){return e*e*e}},Rv=class extends Av{constructor(e=3,t=3){super(),this.oscillations=e,this.springiness=t}easeInCore(e){let t;const i=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return t=0==n?e:(Math.exp(n*e)-1)/(Math.exp(n)-1),t*Math.sin((6.283185307179586*i+1.5707963267948966)*e)}},Tv=class e{constructor(e,t,i){this.name=e,this.from=t,this.to=i}clone(){return new e(this.name,this.from,this.to)}},Nv=Object.freeze(new Dh(0,0,0,0)),Mv=Object.freeze(wh.Zero()),Iv=Object.freeze(Ph.Zero()),xv=Object.freeze(up.Zero()),bv=Object.freeze(Ah.Black()),Pv=Object.freeze(new Ch(0,0,0,0)),wv={key:0,repeatCount:0,loopMode:2},Ov=class e{createRange(e,t,i){this._ranges[e]||(this._ranges[e]=new Tv(e,t,i))}_getKeyValue(e){return"function"==typeof e?e():e}getHighestFrame(){let e=0;for(let t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e}_interpolate(t,i,n=!1){if(i.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&i.repeatCount>0)return i.highLimitValue.clone?i.highLimitValue.clone():i.highLimitValue;const a=this._keys,s=a.length;let r=i.key;for(;r>=0&&t<a[r].frame;)--r;for(;r+1<=s-1&&t>=a[r+1].frame;)++r;if(i.key=r,r<0)return n?void 0:this._getKeyValue(a[0].value);if(r+1>s-1)return n?void 0:this._getKeyValue(a[s-1].value);const o=a[r],l=a[r+1];if(n&&(t===o.frame||t===l.frame))return;const c=this._getKeyValue(o.value),h=this._getKeyValue(l.value);if(1===o.interpolation)return l.frame>t?c:h;const f=void 0!==o.outTangent&&void 0!==l.inTangent,u=l.frame-o.frame;let d=(t-o.frame)/u;const m=o.easingFunction||this.getEasingFunction();switch(null!==m&&(d=m.ease(d)),this.dataType){case e.ANIMATIONTYPE_FLOAT:{const t=f?this.floatInterpolateFunctionWithTangents(c,o.outTangent*u,h,l.inTangent*u,d):this.floatInterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(i.offsetValue??0)*i.repeatCount+t}break}case e.ANIMATIONTYPE_QUATERNION:{const t=f?this.quaternionInterpolateFunctionWithTangents(c,o.outTangent.scale(u),h,l.inTangent.scale(u),d):this.quaternionInterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.addInPlace((i.offsetValue||Nv).scale(i.repeatCount))}return t}case e.ANIMATIONTYPE_VECTOR3:{const t=f?this.vector3InterpolateFunctionWithTangents(c,o.outTangent.scale(u),h,l.inTangent.scale(u),d):this.vector3InterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||Mv).scale(i.repeatCount))}break}case e.ANIMATIONTYPE_VECTOR2:{const t=f?this.vector2InterpolateFunctionWithTangents(c,o.outTangent.scale(u),h,l.inTangent.scale(u),d):this.vector2InterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||Iv).scale(i.repeatCount))}break}case e.ANIMATIONTYPE_SIZE:switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(c,h,d);case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(c,h,d).add((i.offsetValue||xv).scale(i.repeatCount))}break;case e.ANIMATIONTYPE_COLOR3:{const t=f?this.color3InterpolateFunctionWithTangents(c,o.outTangent.scale(u),h,l.inTangent.scale(u),d):this.color3InterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||bv).scale(i.repeatCount))}break}case e.ANIMATIONTYPE_COLOR4:{const t=f?this.color4InterpolateFunctionWithTangents(c,o.outTangent.scale(u),h,l.inTangent.scale(u),d):this.color4InterpolateFunction(c,h,d);switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return t;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t.add((i.offsetValue||Pv).scale(i.repeatCount))}break}case e.ANIMATIONTYPE_MATRIX:switch(i.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:case e.ANIMATIONLOOPMODE_YOYO:return e.AllowMatricesInterpolation?this.matrixInterpolateFunction(c,h,d,i.workValue):c;case e.ANIMATIONLOOPMODE_RELATIVE:case e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return c}}return 0}getEasingFunction(){return this._easingFunction}addEvent(e){this._events.push(e),this._events.sort(((e,t)=>e.frame-t.frame))}static ParseFromSnippetAsync(e){return new Promise(((t,i)=>{const n=new Rf;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const i=JSON.parse(JSON.parse(n.responseText).jsonPayload);if(i.animations){const n=JSON.parse(i.animations),a=[];for(const t of n.animations){const i=this.Parse(t);i.snippetId=e,a.push(i)}t(a)}else{const n=JSON.parse(i.animation),a=this.Parse(n);a.snippetId=e,t(a)}}else i("Unable to load the snippet "+e)})),n.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),n.send()}))}floatInterpolateFunction(e,t,i){return vh.Lerp(e,t,i)}quaternionInterpolateFunctionWithTangents(e,t,i,n,a){return Dh.Hermite(e,t,i,n,a).normalize()}get runtimeAnimations(){return this._runtimeAnimations}color3InterpolateFunction(e,t,i){return Ah.Lerp(e,t,i)}removeEvents(e){for(let t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)}getEvents(){return this._events}color3InterpolateFunctionWithTangents(e,t,i,n,a){return Ah.Hermite(e,t,i,n,a)}setKeys(e,t=!1){this._keys=t?e:e.slice(0)}static _PrepareAnimation(t,i,n,a,s,r,o,l){let c;if(!isNaN(parseFloat(s))&&isFinite(s)?c=e.ANIMATIONTYPE_FLOAT:s instanceof Dh?c=e.ANIMATIONTYPE_QUATERNION:s instanceof wh?c=e.ANIMATIONTYPE_VECTOR3:s instanceof Ph?c=e.ANIMATIONTYPE_VECTOR2:s instanceof Ah?c=e.ANIMATIONTYPE_COLOR3:s instanceof Ch?c=e.ANIMATIONTYPE_COLOR4:s instanceof up&&(c=e.ANIMATIONTYPE_SIZE),null==c)return null;const h=new e(t,i,n,c,o),f=[{frame:0,value:s},{frame:a,value:r}];return h.setKeys(f),void 0!==l&&h.setEasingFunction(l),h}matrixInterpolateFunction(t,i,n,a){return e.AllowMatrixDecomposeForInterpolation?a?(Lh.DecomposeLerpToRef(t,i,n,a),a):Lh.DecomposeLerp(t,i,n):a?(Lh.LerpToRef(t,i,n,a),a):Lh.Lerp(t,i,n)}floatInterpolateFunctionWithTangents(e,t,i,n,a){return vh.Hermite(e,t,i,n,a)}getKeys(){return this._keys}deleteRange(e,t=!0){const i=this._ranges[e];if(i){if(t){const e=i.from,t=i.to;for(let i=this._keys.length-1;i>=0;i--)this._keys[i].frame>=e&&this._keys[i].frame<=t&&this._keys.splice(i,1)}this._ranges[e]=null}}color4InterpolateFunction(e,t,i){return Ch.Lerp(e,t,i)}static TransitionTo(e,t,i,n,a,s,r,o=null){if(r<=0)return i[e]=t,o&&o(),null;const l=a*(r/1e3);s.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:l,value:t}]),i.animations||(i.animations=[]),i.animations.push(s);const c=n.beginAnimation(i,0,l,!1);return c.onAnimationEnd=o,c}clone(){const t=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges){t._ranges={};for(const e in this._ranges){const i=this._ranges[e];i&&(t._ranges[e]=i.clone())}}return t}static CreateAndStartHierarchyAnimation(t,i,n,a,s,r,o,l,c,h,f){const u=e._PrepareAnimation(t,a,s,r,o,l,c,h);if(!u)return null;return i.getScene().beginDirectHierarchyAnimation(i,n,[u],0,r,1===u.loopMode,1,f)}vector2InterpolateFunctionWithTangents(e,t,i,n,a){return Ph.Hermite(e,t,i,n,a)}static CreateAndStartAnimation(t,i,n,a,s,r,o,l,c,h,f){const u=e._PrepareAnimation(t,n,a,s,r,o,l,c);return u?(i.getScene&&(f=i.getScene()),f?f.beginDirectAnimation(i,[u],0,s,1===u.loopMode,1,h):null):null}evaluate(e){return wv.key=0,this._interpolate(e,wv)}getRange(e){return this._ranges[e]}vector3InterpolateFunctionWithTangents(e,t,i,n,a){return wh.Hermite(e,t,i,n,a)}static Parse(t){const i=new e(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),n=t.dataType,a=[];let s,r;for(t.enableBlending&&(i.enableBlending=t.enableBlending),t.blendingSpeed&&(i.blendingSpeed=t.blendingSpeed),r=0;r<t.keys.length;r++){const i=t.keys[r];let o,l,c;switch(n){case e.ANIMATIONTYPE_FLOAT:s=i.values[0],i.values.length>=2&&(o=i.values[1]),i.values.length>=3&&(l=i.values[2]),i.values.length>=4&&(c=i.values[3]);break;case e.ANIMATIONTYPE_QUATERNION:if(s=Dh.FromArray(i.values),i.values.length>=8){const e=Dh.FromArray(i.values.slice(4,8));e.equals(Dh.Zero())||(o=e)}if(i.values.length>=12){const e=Dh.FromArray(i.values.slice(8,12));e.equals(Dh.Zero())||(l=e)}i.values.length>=13&&(c=i.values[12]);break;case e.ANIMATIONTYPE_MATRIX:s=Lh.FromArray(i.values),i.values.length>=17&&(c=i.values[16]);break;case e.ANIMATIONTYPE_COLOR3:s=Ah.FromArray(i.values),i.values[3]&&(o=Ah.FromArray(i.values[3])),i.values[4]&&(l=Ah.FromArray(i.values[4])),i.values[5]&&(c=i.values[5]);break;case e.ANIMATIONTYPE_COLOR4:s=Ch.FromArray(i.values),i.values[4]&&(o=Ch.FromArray(i.values[4])),i.values[5]&&(l=Ch.FromArray(i.values[5])),i.values[6]&&(c=Ch.FromArray(i.values[6]));break;case e.ANIMATIONTYPE_VECTOR3:default:s=wh.FromArray(i.values),i.values[3]&&(o=wh.FromArray(i.values[3])),i.values[4]&&(l=wh.FromArray(i.values[4])),i.values[5]&&(c=i.values[5])}const h={};h.frame=i.frame,h.value=s,null!=o&&(h.inTangent=o),null!=l&&(h.outTangent=l),null!=c&&(h.interpolation=c),a.push(h)}if(i.setKeys(a),t.ranges)for(r=0;r<t.ranges.length;r++)s=t.ranges[r],i.createRange(s.name,s.from,s.to);return i}sizeInterpolateFunction(e,t,i){return up.Lerp(e,t,i)}setEasingFunction(e){this._easingFunction=e}constructor(t,i,n,a,s,r){this.name=t,this.targetProperty=i,this.framePerSecond=n,this.dataType=a,this.loopMode=s,this.enableBlending=r,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=i.split("."),this.dataType=a,this.loopMode=void 0===s?e.ANIMATIONLOOPMODE_CYCLE:s,this.xt=e._UniqueIdGenerator++}static CreateMergeAndStartAnimation(t,i,n,a,s,r,o,l,c,h){const f=e._PrepareAnimation(t,n,a,s,r,o,l,c);return f?(i.animations.push(f),i.getScene().beginAnimation(i,0,s,1===f.loopMode,1,h)):null}serialize(){const t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;const i=this.dataType;t.keys=[];const n=this.getKeys();for(let a=0;a<n.length;a++){const s=n[a],r={};switch(r.frame=s.frame,i){case e.ANIMATIONTYPE_FLOAT:r.values=[s.value],void 0!==s.inTangent&&r.values.push(s.inTangent),void 0!==s.outTangent&&(void 0===s.inTangent&&r.values.push(void 0),r.values.push(s.outTangent)),void 0!==s.interpolation&&(void 0===s.inTangent&&r.values.push(void 0),void 0===s.outTangent&&r.values.push(void 0),r.values.push(s.interpolation));break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:r.values=s.value.asArray(),null!=s.inTangent&&r.values.push(s.inTangent.asArray()),null!=s.outTangent&&(void 0===s.inTangent&&r.values.push(void 0),r.values.push(s.outTangent.asArray())),void 0!==s.interpolation&&(void 0===s.inTangent&&r.values.push(void 0),void 0===s.outTangent&&r.values.push(void 0),r.values.push(s.interpolation))}t.keys.push(r)}t.ranges=[];for(const e in this._ranges){const i=this._ranges[e];if(!i)continue;const n={};n.name=e,n.from=i.from,n.to=i.to,t.ranges.push(n)}return t}get hasRunningRuntimeAnimations(){for(const e of this._runtimeAnimations)if(!e.isStopped())return!0;return!1}static _UniversalLerp(e,t,i){const n=e.constructor;return n.Lerp?n.Lerp(e,t,i):n.Slerp?n.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t}static MakeAnimationAdditive(t,i,n,a=!1,s){let r;r="object"==typeof i?i:{referenceFrame:i??0,range:n,cloneOriginalAnimation:a,clonedAnimationName:s};let o=t;if(r.cloneOriginalAnimation&&(o=t.clone(),o.name=r.clonedAnimationName||o.name),!o._keys.length)return o;const l=r.referenceFrame&&r.referenceFrame>=0?r.referenceFrame:0;let c=0;const h=o._keys[0];let f=o._keys.length-1;const u=o._keys[f],d={referenceValue:h.value,referencePosition:kh.Vector3[0],referenceQuaternion:kh.Ht[0],referenceScaling:kh.Vector3[1],keyPosition:kh.Vector3[2],keyQuaternion:kh.Ht[1],keyScaling:kh.Vector3[3]};let m=h.frame,p=u.frame;if(r.range){const e=o.getRange(r.range);e&&(m=e.from,p=e.to)}else m=r.fromFrame??m,p=r.toFrame??p;if(m!==h.frame&&(c=o.createKeyForFrame(m)),p!==u.frame&&(f=o.createKeyForFrame(p)),1===o._keys.length){const e=o._getKeyValue(o._keys[0]);d.referenceValue=e.clone?e.clone():e}else if(l<=h.frame){const e=o._getKeyValue(h.value);d.referenceValue=e.clone?e.clone():e}else if(l>=u.frame){const e=o._getKeyValue(u.value);d.referenceValue=e.clone?e.clone():e}else{wv.key=0;const e=o._interpolate(l,wv);d.referenceValue=e.clone?e.clone():e}o.dataType===e.ANIMATIONTYPE_QUATERNION?d.referenceValue.normalize().conjugateInPlace():o.dataType===e.ANIMATIONTYPE_MATRIX&&(d.referenceValue.decompose(d.referenceScaling,d.referenceQuaternion,d.referencePosition),d.referenceQuaternion.normalize().conjugateInPlace());let _=Number.MAX_VALUE;const v=r.clipKeys?[]:null;for(let t=c;t<=f;t++){let i=o._keys[t];if((v||r.cloneOriginalAnimation)&&(i={frame:i.frame,value:i.value.clone?i.value.clone():i.value,inTangent:i.inTangent,outTangent:i.outTangent,interpolation:i.interpolation,lockedTangent:i.lockedTangent},v&&(_===Number.MAX_VALUE&&(_=i.frame),i.frame-=_,v.push(i))),!t||o.dataType===e.ANIMATIONTYPE_FLOAT||i.value!==h.value)switch(o.dataType){case e.ANIMATIONTYPE_MATRIX:i.value.decompose(d.keyScaling,d.keyQuaternion,d.keyPosition),d.keyPosition.subtractInPlace(d.referencePosition),d.keyScaling.divideInPlace(d.referenceScaling),d.referenceQuaternion.multiplyToRef(d.keyQuaternion,d.keyQuaternion),Lh.ComposeToRef(d.keyScaling,d.keyQuaternion,d.keyPosition,i.value);break;case e.ANIMATIONTYPE_QUATERNION:d.referenceValue.multiplyToRef(i.value,i.value);break;case e.ANIMATIONTYPE_VECTOR2:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:i.value.subtractToRef(d.referenceValue,i.value);break;case e.ANIMATIONTYPE_SIZE:i.value.width-=d.referenceValue.width,i.value.height-=d.referenceValue.height;break;default:i.value-=d.referenceValue}}return v&&o.setKeys(v,!0),o}quaternionInterpolateFunction(e,t,i){return Dh.Slerp(e,t,i)}color4InterpolateFunctionWithTangents(e,t,i,n,a){return Ch.Hermite(e,t,i,n,a)}static CreateAnimation(t,i,n,a){const s=new e(t+"Animation",t,n,i,e.ANIMATIONLOOPMODE_CONSTANT);return s.setEasingFunction(a),s}createKeyForFrame(e){wv.key=0;const t=this._interpolate(e,wv,!0);if(!t)return this._keys[wv.key].frame===e?wv.key:wv.key+1;const i={frame:e,value:t.clone?t.clone():t};return this._keys.splice(wv.key+1,0,i),wv.key+1}vector2InterpolateFunction(e,t,i){return Ph.Lerp(e,t,i)}toString(e){let t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";let e=!0;for(const i in this._ranges)e&&(t+=", ",e=!1),t+=i;t+="}"}return t}static ParseFromFileAsync(e,t){return new Promise(((i,n)=>{const a=new Rf;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){let t=JSON.parse(a.responseText);if(t.animations&&(t=t.animations),t.length){const e=[];for(const i of t)e.push(this.Parse(i));i(e)}else{const n=this.Parse(t);e&&(n.name=e),i(n)}}else n("Unable to load the animation")})),a.open("GET",t),a.send()}))}static AppendSerializedAnimations(e,t){Uh.AppendSerializedAnimations(e,t)}vector3InterpolateFunction(e,t,i){return wh.Lerp(e,t,i)}};Ov._UniqueIdGenerator=0,Ov.AllowMatricesInterpolation=!1,Ov.AllowMatrixDecomposeForInterpolation=!0,Ov.SnippetUrl="https://snippet.babylonjs.com",Ov.ANIMATIONTYPE_FLOAT=0,Ov.ANIMATIONTYPE_VECTOR3=1,Ov.ANIMATIONTYPE_QUATERNION=2,Ov.ANIMATIONTYPE_MATRIX=3,Ov.ANIMATIONTYPE_COLOR3=4,Ov.ANIMATIONTYPE_COLOR4=7,Ov.ANIMATIONTYPE_VECTOR2=5,Ov.ANIMATIONTYPE_SIZE=6,Ov.ANIMATIONLOOPMODE_RELATIVE=0,Ov.ANIMATIONLOOPMODE_CYCLE=1,Ov.ANIMATIONLOOPMODE_CONSTANT=2,Ov.ANIMATIONLOOPMODE_YOYO=4,Ov.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,Ov.CreateFromSnippetAsync=Ov.ParseFromSnippetAsync,rh("BABYLON.Animation",Ov),Vh._AnimationRangeFactory=(e,t,i)=>new Tv(e,t,i);var Dv=class e{detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}attach(e){this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}get name(){return"Bouncing"}_applyBoundRadiusAnimation(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=Ov.CreateAnimation("radius",Ov.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const i=Ov.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));i&&this._animatables.push(i)}set autoTransitionRange(e){if(this._autoTransitionRange===e)return;this._autoTransitionRange=e;const t=this._attachedCamera;t&&(e?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((e=>{if(e&&(e.computeWorldMatrix(!0),e.getBoundingInfo)){const t=e.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*t,this.upperRadiusTransitionRange=.05*t}})):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}_isRadiusAtLimit(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)}init(){}get autoTransitionRange(){return this._autoTransitionRange}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}};Dv.EasingFunction=new class extends Av{easeInCore(e){const t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)}constructor(e=1){super(),this.amplitude=e}}(.3),Dv.EasingMode=Av.EASINGMODE_EASEOUT;var Lv=class e{zoomOnMesh(e,t=!1,i=null){e.computeWorldMatrix(!0);const n=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(n.minimumWorld,n.maximumWorld,t,i)}zoomOnMeshHierarchy(e,t=!1,i=null){e.computeWorldMatrix(!0);const n=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(n.min,n.max,t,i)}get radiusScale(){return this._radiusScale}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const t=Cf.Now-this._lastInteractionTime,i=.5*Math.PI-this._defaultElevation,n=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>n&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Ov.CreateAnimation("beta",Ov.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));const t=Ov.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));t&&this._animatables.push(t)}}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}set defaultElevation(e){this._defaultElevation=e}set mode(e){this._mode=e}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}get defaultElevation(){return this._defaultElevation}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}_calculateLowerRadiusFromModelBoundingSphere(t,i){const n=this._attachedCamera;if(!n)return 0;let a=n._calculateLowerRadiusFromModelBoundingSphere(t,i,this._radiusScale);return n.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(a=a<n.lowerRadiusLimit?n.lowerRadiusLimit:a),n.upperRadiusLimit&&(a=a>n.upperRadiusLimit?n.upperRadiusLimit:a),a}init(){}set elevationReturnWaitTime(e){this._elevationReturnWaitTime=e}zoomOnBoundingInfo(t,i,n=!1,a=null){let s;if(!this._attachedCamera)return!1;const r=t.y,o=r+(i.y-r)*this._positionScale,l=i.subtract(t).scale(.5);if(n)s=new wh(0,o,0);else{const e=t.add(l);s=new wh(e.x,o,e.z)}this._vectorTransition||(this._vectorTransition=Ov.CreateAnimation("target",Ov.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;let c=Ov.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);c&&this._animatables.push(c);let h=0;if(this._mode===e.FitFrustumSidesMode){const e=this._calculateLowerRadiusFromModelBoundingSphere(t,i);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=l.length()+this._attachedCamera.minZ),h=e}else this._mode===e.IgnoreBoundsSizeMode&&(h=this._calculateLowerRadiusFromModelBoundingSphere(t,i),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const e=i.subtract(t).length();this._attachedCamera.panningSensibility=5e3/e,this._attachedCamera.wheelPrecision=100/h}return this._radiusTransition||(this._radiusTransition=Ov.CreateAnimation("radius",Ov.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),c=Ov.TransitionTo("radius",h,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),a&&a(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),c&&this._animatables.push(c),!0}attach(t){this._attachedCamera=t;const i=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add((e=>{e.type!==b_.POINTERDOWN?e.type===b_.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((e=>{e&&e.getBoundingInfo&&this.zoomOnMesh(e,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}get zoomStopsAnimation(){return this._zoomStopsAnimation}get name(){return"Framing"}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Cf.Now,this.stopAllAnimations(),this._clearAnimationLocks())}get positionScale(){return this._positionScale}set framingTime(e){this._framingTime=e}set radiusScale(e){this._radiusScale=e}zoomOnMeshesHierarchy(e,t=!1,i=null){const n=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new wh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let t=0;t<e.length;t++){const i=e[t].getHierarchyBoundingVectors(!0);wh.CheckExtends(i.min,n,a),wh.CheckExtends(i.max,n,a)}this.zoomOnBoundingInfo(n,a,t,i)}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}get mode(){return this._mode}set elevationReturnTime(e){this._elevationReturnTime=e}get elevationReturnTime(){return this._elevationReturnTime}get framingTime(){return this._framingTime}constructor(){this.onTargetFramingAnimationEndObservable=new Ih,this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}_clearAnimationLocks(){this._betaIsAnimating=!1}set positionScale(e){this._positionScale=e}};Lv.EasingFunction=new class extends Av{constructor(e=2){super(),this.exponent=e}easeInCore(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}},Lv.EasingMode=Av.EASINGMODE_EASEINOUT,Lv.IgnoreBoundsSizeMode=0,Lv.FitFrustumSidesMode=1;var Fv={},kv=class{attachElement(e=!1){if(!this.attachedToElement){e=!fd.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e;for(const t in this.attached)this.attached[t].attachControl(e)}}removeByType(e){for(const t in this.attached){const i=this.attached[t];i.getClassName()===e&&(i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}}constructor(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=()=>{}}detachElement(e=!1){for(const t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const e in this.attached){const t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(e){const t={};for(const e in this.attached){const i=this.attached[e],n=Uh.Serialize(i);t[i.getClassName()]=n}e.inputsmgr=t}parse(e){const t=e.inputsmgr;if(t){this.clear();for(const e in t){const i=Fv[e];if(i){const n=t[e],a=Uh.Parse((()=>new i),n,null);this.add(a)}}}else for(const t in this.attached){const i=Fv[this.attached[t].getClassName()];if(i){const n=Uh.Parse((()=>new i),e,null);this.remove(this.attached[t]),this.add(n)}}}add(e){const t=e.getSimpleName();this.attached[t]?jh.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault))}remove(e){for(const t in this.attached){const i=this.attached[t];if(i===e)return i.detachControl(),i.camera=null,delete this.attached[t],void this.rebuildInputCheck()}}_addCheckInputs(e){const t=this.checkInputs;return()=>{t(),e()}}attachInput(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}},Bv=class{onMultiTouch(e,t,i,n,a,s){}onContextMenu(e){e.preventDefault()}onButtonDown(e){}attachControl(e){e=ad.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();let n=0,a=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=s=>{const r=s.event,o="touch"===r.pointerType;if(s.type!==b_.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const l=r.target;if(this._altKey=r.altKey,this._ctrlKey=r.ctrlKey,this._metaKey=r.metaKey,this._shiftKey=r.shiftKey,this._buttonsPressed=r.buttons,t.isPointerLock){const e=r.movementX,t=r.movementY;this.onTouch(null,e,t),this._pointA=null,this._pointB=null}else{if(s.type!==b_.POINTERDOWN&&s.type!==b_.POINTERDOUBLETAP&&o&&this._pointA?.pointerId!==r.pointerId&&this._pointB?.pointerId!==r.pointerId)return;if(s.type!==b_.POINTERDOWN||-1!==this._currentActiveButton&&!o)if(s.type===b_.POINTERDOUBLETAP)this.onDoubleTap(r.pointerType);else if(s.type!==b_.POINTERUP||this._currentActiveButton!==r.button&&!o){if(s.type===b_.POINTERMOVE)if(e||r.preventDefault(),this._pointA&&null===this._pointB){const e=r.clientX-this._pointA.x,t=r.clientY-this._pointA.y;this._pointA.x=r.clientX,this._pointA.y=r.clientY,this.onTouch(this._pointA,e,t)}else if(this._pointA&&this._pointB){const e=this._pointA.pointerId===r.pointerId?this._pointA:this._pointB;e.x=r.clientX,e.y=r.clientY;const t=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,o=t*t+i*i,l={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:r.pointerId,type:s.type};this.onMultiTouch(this._pointA,this._pointB,n,o,a,l),a=l,n=o}}else{try{l?.releasePointerCapture(r.pointerId)}catch(e){}o||(this._pointB=null),t._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==r.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==r.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==n||a)&&(this.onMultiTouch(this._pointA,this._pointB,n,0,a,null),n=0,a=null),this._currentActiveButton=-1,this.onButtonUp(r),e||r.preventDefault()}else{try{l?.setPointerCapture(r.pointerId)}catch(e){}if(null===this._pointA)this._pointA={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType};else{if(null!==this._pointB)return;this._pointB={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}}-1!==this._currentActiveButton||o||(this._currentActiveButton=r.button),this.onButtonDown(r),e||(r.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,b_.POINTERDOWN|b_.POINTERUP|b_.POINTERMOVE|b_.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,n=0,a=null,this.onLostFocus()},this._contextMenuBind=e=>this.onContextMenu(e),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const s=this.camera.getScene().getEngine().getHostWindow();s&&ad.RegisterTopRootEvents(s,[{name:"blur",handler:this._onLostFocus}])}getSimpleName(){return"pointers"}onButtonUp(e){}detachControl(){if(this._onLostFocus){const e=this.camera.getScene().getEngine().getHostWindow();e&&ad.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const e=this.camera.getScene().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}onDoubleTap(e){}constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}getClassName(){return"BaseCameraPointersInput"}onTouch(e,t,i){}onLostFocus(){}};Lc([Hc()],Bv.prototype,"buttons",void 0);var Gv=class e extends Bv{onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}_computePinchZoom(t,i){const n=this.camera.radius||e.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=n*Math.sqrt(t)/Math.sqrt(i):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(i-t)*n*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(i-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(e,t,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onMultiTouch(e,t,i,n,a,s){0===i&&null===a||0===n&&null===s||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,n),this._computeMultiTouchPanning(a,s)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(n)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,n),this._isPinching=!0):this._computeMultiTouchPanning(a,s)):this.multiTouchPanning?this._computeMultiTouchPanning(a,s):this.pinchZoom&&this._computePinchZoom(i,n))}onButtonDown(e){this._isPanClick=e.button===this.camera._panningMouseButton}onButtonUp(e){this._twoFingerActivityCount=0,this._isPinching=!1}constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(e,t){if(0!==this.panningSensibility&&e&&t){const i=t.x-e.x,n=t.y-e.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility}}};Gv.MinimumRadiusForPinch=.001,Lc([Hc()],Gv.prototype,"buttons",void 0),Lc([Hc()],Gv.prototype,"angularSensibilityX",void 0),Lc([Hc()],Gv.prototype,"angularSensibilityY",void 0),Lc([Hc()],Gv.prototype,"pinchPrecision",void 0),Lc([Hc()],Gv.prototype,"pinchDeltaPercentage",void 0),Lc([Hc()],Gv.prototype,"useNaturalPinchZoom",void 0),Lc([Hc()],Gv.prototype,"pinchZoom",void 0),Lc([Hc()],Gv.prototype,"panningSensibility",void 0),Lc([Hc()],Gv.prototype,"multiTouchPanning",void 0),Lc([Hc()],Gv.prototype,"multiTouchPanAndZoom",void 0),Fv.ArcRotateCameraPointersInput=Gv;var Uv=class{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(e){e=ad.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const i=t.event;if(!i.metaKey)if(t.type===L_.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(e||i.preventDefault())}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),i.preventDefault&&(e||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}}}};Lc([Hc()],Uv.prototype,"keysUp",void 0),Lc([Hc()],Uv.prototype,"keysDown",void 0),Lc([Hc()],Uv.prototype,"keysLeft",void 0),Lc([Hc()],Uv.prototype,"keysRight",void 0),Lc([Hc()],Uv.prototype,"keysReset",void 0),Lc([Hc()],Uv.prototype,"panningSensibility",void 0),Lc([Hc()],Uv.prototype,"zoomingSensibility",void 0),Lc([Hc()],Uv.prototype,"useAltToZoom",void 0),Lc([Hc()],Uv.prototype,"angularSpeed",void 0),Fv.ArcRotateCameraKeyboardMoveInput=Uv;var Hv=class{_getPosition(){const e=this.camera,t=e.getScene(),i=t.createPickingRay(t.pointerX,t.pointerY,Lh.Identity(),e,!1);0===e.targetScreenOffset.x&&0===e.targetScreenOffset.y||(this._viewOffset.set(e.targetScreenOffset.x,e.targetScreenOffset.y,0),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),this._globalOffset=wh.TransformNormal(this._viewOffset,e._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let n=0;return this._hitPlane&&(n=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(n))}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new wh(0,0,0),this._globalOffset=new wh(0,0,0),this._inertialPanning=wh.Zero()}getSimpleName(){return"mousewheel"}_updateHitPlane(){const e=this.camera,t=e.target.subtract(e.position);this._hitPlane=cd.FromPositionAndNormal(e.target,t)}attachControl(e){e=ad.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==b_.POINTERWHEEL)return;const i=t.event;let n=0;const a=i.deltaMode===ev.DOM_DELTA_LINE?40:1,s=-i.deltaY*a;if(this.customComputeDeltaFromMouseWheel)n=this.customComputeDeltaFromMouseWheel(s,this,i);else if(this.wheelDeltaPercentage){if(n=this._computeDeltaFromMouseWheelLegacyEvent(s,this.camera.radius),n>0){let e=this.camera.radius,t=this.camera.inertialRadiusOffset+n;for(let i=0;i<20&&Math.abs(t)>.001;i++)e-=t,t*=this.camera.inertia;e=vh.Clamp(e,0,Number.MAX_VALUE),n=this._computeDeltaFromMouseWheelLegacyEvent(s,e)}}else n=s/(40*this.wheelPrecision);n&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(n)):this.camera.inertialRadiusOffset+=n),i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,b_.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}checkInputs(){if(!this.zoomToMouseLocation)return;const e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}_zeroIfClose(e){Math.abs(e.x)<hh&&(e.x=0),Math.abs(e.y)<hh&&(e.y=0),Math.abs(e.z)<hh&&(e.z=0)}_zoomToMouse(e){const t=this.camera,i=1-t.inertia;if(t.lowerRadiusLimit){const n=t.lowerRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i<n&&(e=(t.radius-n)*i-t.inertialRadiusOffset)}if(t.upperRadiusLimit){const n=t.upperRadiusLimit??0;t.radius-(t.inertialRadiusOffset+e)/i>n&&(e=(t.radius-n)*i-t.inertialRadiusOffset)}const n=e/i/t.radius,a=this._getPosition(),s=kh.Vector3[6];a.subtractToRef(t.target,s),s.scaleInPlace(n),s.scaleInPlace(i),this._inertialPanning.addInPlace(s),t.inertialRadiusOffset+=e}_computeDeltaFromMouseWheelLegacyEvent(e,t){let i=0;const n=.01*e*this.wheelDeltaPercentage*t;return i=e>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage),i}};Lc([Hc()],Hv.prototype,"wheelPrecision",void 0),Lc([Hc()],Hv.prototype,"zoomToMouseLocation",void 0),Lc([Hc()],Hv.prototype,"wheelDeltaPercentage",void 0),Fv.ArcRotateCameraMouseWheelInput=Hv;var Vv=class extends kv{constructor(e){super(e)}addPointers(){return this.add(new Gv),this}addMouseWheel(){return this.add(new Hv),this}addKeyboard(){return this.add(new Uv),this}};Vh.AddNodeConstructor("ArcRotateCamera",((e,t)=>()=>new Wv(e,0,0,1,wh.Zero(),t)));var Wv=class e extends yv{createRigCamera(t,i){let n=0;switch(this.cameraRigMode){case fd.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case fd.RIG_MODE_STEREOSCOPIC_OVERUNDER:case fd.RIG_MODE_STEREOSCOPIC_INTERLACED:case fd.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(0===i?1:-1);break;case fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(0===i?-1:1)}const a=new e(t,this.alpha+n,this.beta,this.radius,this._target,this.getScene());return a._cameraRigParams={},a.isRigCamera=!0,a.rigParent=this,a.upVector=this.upVector,a.mode=this.mode,a.orthoLeft=this.orthoLeft,a.orthoRight=this.orthoRight,a.orthoBottom=this.orthoBottom,a.orthoTop=this.orthoTop,a}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set pinchDeltaPercentage(e){const t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}set useNaturalPinchZoom(e){const t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)}set pinchPrecision(e){const t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}_getViewMatrix(){const e=Math.cos(this.alpha),t=Math.sin(this.alpha),i=Math.cos(this.beta);let n=Math.sin(this.beta);0===n&&(n=1e-4),0===this.radius&&(this.radius=1e-4);const a=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*n,this.radius*i,this.radius*t*n),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||wh.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),a.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const e=this.getScene().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,e.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.xt)}else{this._position.copyFrom(this._newPosition);let e=this.upVector;this.allowUpsideDown&&n<0&&(e=e.negate()),this._computeViewMatrix(this._position,a,e),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=a,this._viewMatrix}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}_calculateLowerRadiusFromModelBoundingSphere(e,t,i=1){const n=wh.Distance(e,t),a=this.getScene().getEngine().getAspectRatio(this),s=Math.tan(this.Lt/2),r=s*a,o=.5*n*i,l=o*Math.sqrt(1+1/(r*r)),c=o*Math.sqrt(1+1/(s*s));return Math.max(l,c)}get upVector(){return this._upVector}focusOn(e,t=!1){let i,n;if(void 0===e.min){const t=e||this.getScene().meshes;i=wm.MinMax(t),n=wh.Distance(i.min,i.max)}else{i=e,n=e.distance}this._target=wm.Center(i),t||(this.maxZ=2*n)}set useBouncingBehavior(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Dv,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get useFramingBehavior(){return null!=this._framingBehavior}get useNaturalPinchZoom(){const e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom}dispose(){this.inputs.clear(),super.dispose()}set useAutoRotationBehavior(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Ev,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}set upVector(e){this._upToYMatrix||(this._yToUpMatrix=new Lh,this._upToYMatrix=new Lh,this._upVector=wh.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()}get framingBehavior(){return this._framingBehavior}set target(e){this.setTarget(e)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}const e=this._getLockedTargetPosition();return e||this._target}set zoomToMouseLocation(e){const t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=e)}get targetHost(){return this._targetHost}set angularSensibilityX(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)}set wheelPrecision(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)}_updateCache(e){e||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const e=this._scene.getEngine().getDeltaTime()/1e3,t=1-Math.pow(2,-e/this.restoreStateInterpolationFactor);this.setTarget(wh.Lerp(this.getTarget(),this._storedTarget,t)),Dh.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,kh.Ht[0]),Dh.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,kh.Ht[1]),Dh.SlerpToRef(kh.Ht[1],kh.Ht[0],t,kh.Ht[2]),kh.Ht[2].normalize(),kh.Ht[2].toAlphaBetaGammaToRef(kh.Vector3[0]),this.alpha=kh.Vector3[0].x,this.beta=kh.Vector3[0].y,this.radius+=(this._storedRadius-this.radius)*t,Ph.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,t,this.targetScreenOffset),(wh.DistanceSquared(this.getTarget(),this._storedTarget)<hh&&kh.Ht[2].equalsWithEpsilon(kh.Ht[0])&&Math.pow(this._storedRadius-this.radius,2)<hh&&Ph.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<hh||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const e=this.invertRotation?-1:1,t=this._calculateHandednessMultiplier();let i=this.inertialAlphaOffset*t;this.beta<0&&(i*=-1),this.alpha+=i*e,this.beta+=this.inertialBetaOffset*e,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<hh&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<hh&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*hh&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const e=new wh(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.multiplyInPlace(this.panningAxis),wh.TransformNormalToRef(e,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const e=this.upVector,t=wh.CrossToRef(this._transformedDirection,e,this._transformedDirection);wh.CrossToRef(e,t,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);wh.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else{if(this.parent){const e=kh.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.transposeToRef(e),wh.TransformCoordinatesToRef(this._transformedDirection,e,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*hh&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*hh&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}get wheelDeltaPercentage(){const e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}get autoRotationBehavior(){return this._autoRotationBehavior}get position(){return this._position}zoomOn(e,t=!1){e=e||this.getScene().meshes;const i=wm.MinMax(e);let n=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);n=Math.max(Math.min(n,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=n*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:n},t)}get panningSensibility(){const e=this.inputs.attached.pointers;return e?e.panningSensibility:0}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}get angularSensibilityX(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0}set panningSensibility(e){const t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)}attachControl(e,t,i=!0,n=2){const a=arguments;t=ad.BackCompatCameraNoPreventDefault(a),this._useCtrlForPanning=i,this._panningMouseButton=n,"boolean"==typeof a[0]&&(a.length>1&&(this._useCtrlForPanning=a[1]),a.length>2&&(this._panningMouseButton=a[2])),this.inputs.attachElement(t),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}set position(e){this.setPosition(e)}get zoomToMouseLocation(){const e=this.inputs.attached.mousewheel;return!!e&&e.zoomToMouseLocation}set useFramingBehavior(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new Lv,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}getTarget(){return this.target}constructor(e,t,i,n,a,s,r=!0){super(e,wh.Zero(),s,r),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=wh.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Ph.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new Lh,this.panningAxis=new wh(1,1,0),this._transformedDirection=new wh,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new Ih,this.checkCollisions=!1,this.collisionRadius=new wh(.5,.5,.5),this._previousPosition=wh.Zero(),this._collisionVelocity=wh.Zero(),this._newPosition=wh.Zero(),this._computationVector=wh.Zero(),this._onCollisionPositionChange=(e,t,i=null)=>{i?(this.setPosition(t),this.onCollide&&this.onCollide(i)):this._previousPosition.copyFrom(this._position);const n=Math.cos(this.alpha),a=Math.sin(this.alpha),s=Math.cos(this.beta);let r=Math.sin(this.beta);0===r&&(r=1e-4);const o=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*n*r,this.radius*s,this.radius*a*r),o.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let l=this.upVector;this.allowUpsideDown&&this.beta<0&&(l=l.clone(),l=l.negate()),this._computeViewMatrix(this._position,o,l),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=wh.Zero(),a&&this.setTarget(a),this.alpha=t,this.beta=i,this.radius=n,this.getViewMatrix(),this.inputs=new Vv(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new wh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Ph.Zero()}set angularSensibilityY(e){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||wh.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const e=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const t=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}get angularSensibilityY(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}get pinchDeltaPercentage(){const e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0}get pinchPrecision(){const e=this.inputs.attached.pointers;return e?e.pinchPrecision:0}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get useBouncingBehavior(){return null!=this._bouncingBehavior}set targetHost(e){e&&this.setTarget(e)}setPosition(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())}setTarget(e,t=!1,i=!1,n=!1){if(n=this.overrideCloneAlphaBetaRadius??n,e.computeWorldMatrix)t&&e.getBoundingInfo?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const t=e,n=this._getTargetPosition();if(n&&!i&&n.equals(t))return;this._targetHost=null,this._target=t,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}n||this.rebuildAnglesAndRadius()}set wheelDeltaPercentage(e){const t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>hh&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}_updateRigCameras(){const e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case fd.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case fd.RIG_MODE_STEREOSCOPIC_OVERUNDER:case fd.RIG_MODE_STEREOSCOPIC_INTERLACED:case fd.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case fd.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}setMatUp(){Lh.RotationAlignToRef(wh.UpReadOnly,this._upVector,this._yToUpMatrix),Lh.RotationAlignToRef(this._upVector,wh.UpReadOnly,this._upToYMatrix)}get wheelPrecision(){const e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0}getClassName(){return"ArcRotateCamera"}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}get bouncingBehavior(){return this._bouncingBehavior}get target(){return this._target}};Lc([Hc()],Wv.prototype,"alpha",void 0),Lc([Hc()],Wv.prototype,"beta",void 0),Lc([Hc()],Wv.prototype,"radius",void 0),Lc([Hc()],Wv.prototype,"overrideCloneAlphaBetaRadius",void 0),Lc([Yc("target")],Wv.prototype,"_target",void 0),Lc([jc("targetHost")],Wv.prototype,"_targetHost",void 0),Lc([Hc()],Wv.prototype,"inertialAlphaOffset",void 0),Lc([Hc()],Wv.prototype,"inertialBetaOffset",void 0),Lc([Hc()],Wv.prototype,"inertialRadiusOffset",void 0),Lc([Hc()],Wv.prototype,"lowerAlphaLimit",void 0),Lc([Hc()],Wv.prototype,"upperAlphaLimit",void 0),Lc([Hc()],Wv.prototype,"lowerBetaLimit",void 0),Lc([Hc()],Wv.prototype,"upperBetaLimit",void 0),Lc([Hc()],Wv.prototype,"lowerRadiusLimit",void 0),Lc([Hc()],Wv.prototype,"upperRadiusLimit",void 0),Lc([Hc()],Wv.prototype,"inertialPanningX",void 0),Lc([Hc()],Wv.prototype,"inertialPanningY",void 0),Lc([Hc()],Wv.prototype,"pinchToPanMaxDistance",void 0),Lc([Hc()],Wv.prototype,"panningDistanceLimit",void 0),Lc([Yc()],Wv.prototype,"panningOriginTarget",void 0),Lc([Hc()],Wv.prototype,"panningInertia",void 0),Lc([Hc()],Wv.prototype,"zoomToMouseLocation",null),Lc([Hc()],Wv.prototype,"zoomOnFactor",void 0),Lc([Xc()],Wv.prototype,"targetScreenOffset",void 0),Lc([Hc()],Wv.prototype,"allowUpsideDown",void 0),Lc([Hc()],Wv.prototype,"useInputToRestoreState",void 0),Lc([Hc()],Wv.prototype,"restoreStateInterpolationFactor",void 0),rh("BABYLON.ArcRotateCamera",Wv);var zv=class{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const i=this._keys[t],n=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?e._localDirection.copyFromFloats(-n,0,0):-1!==this.keysUp.indexOf(i)?e._localDirection.copyFromFloats(0,0,n):-1!==this.keysRight.indexOf(i)?e._localDirection.copyFromFloats(n,0,0):-1!==this.keysDown.indexOf(i)?e._localDirection.copyFromFloats(0,0,-n):-1!==this.keysUpward.indexOf(i)?e._localDirection.copyFromFloats(0,n,0):-1!==this.keysDownward.indexOf(i)?e._localDirection.copyFromFloats(0,-n,0):-1!==this.keysRotateLeft.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x+=this._getLocalRotation()),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),wh.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}_getLocalRotation(){const e=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*e}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}attachControl(e){e=ad.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const i=t.event;if(!i.metaKey)if(t.type===L_.KEYDOWN){if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),e||i.preventDefault()}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){const t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),e||i.preventDefault()}})))}getSimpleName(){return"keyboard"}};Lc([Hc()],zv.prototype,"keysUp",void 0),Lc([Hc()],zv.prototype,"keysUpward",void 0),Lc([Hc()],zv.prototype,"keysDown",void 0),Lc([Hc()],zv.prototype,"keysDownward",void 0),Lc([Hc()],zv.prototype,"keysLeft",void 0),Lc([Hc()],zv.prototype,"keysRight",void 0),Lc([Hc()],zv.prototype,"rotationSpeed",void 0),Lc([Hc()],zv.prototype,"keysRotateLeft",void 0),Lc([Hc()],zv.prototype,"keysRotateRight",void 0),Lc([Hc()],zv.prototype,"keysRotateUp",void 0),Lc([Hc()],zv.prototype,"keysRotateDown",void 0),Fv.FreeCameraKeyboardMoveInput=zv;var Xv=class{attachControl(e){e=ad.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),i=t.getInputElement();this._pointerInput||(this._pointerInput=n=>{const a=n.event,s="touch"===a.pointerType;if(!this.touchEnabled&&s)return;if(n.type!==b_.POINTERMOVE&&-1===this.buttons.indexOf(a.button))return;const r=a.target;if(n.type===b_.POINTERDOWN){if(s&&-1!==this._activePointerId||!s&&-1!==this._currentActiveButton)return;this._activePointerId=a.pointerId;try{r?.setPointerCapture(a.pointerId)}catch(e){}-1===this._currentActiveButton&&(this._currentActiveButton=a.button),this._previousPosition={x:a.clientX,y:a.clientY},e||(a.preventDefault(),i&&i.focus()),t.isPointerLock&&this._onMouseMove&&this._onMouseMove(n.event)}else if(n.type===b_.POINTERUP){if(s&&this._activePointerId!==a.pointerId||!s&&this._currentActiveButton!==a.button)return;try{r?.releasePointerCapture(a.pointerId)}catch(e){}this._currentActiveButton=-1,this._previousPosition=null,e||a.preventDefault(),this._activePointerId=-1}else if(n.type===b_.POINTERMOVE&&(this._activePointerId===a.pointerId||!s))if(t.isPointerLock&&this._onMouseMove)this._onMouseMove(n.event);else if(this._previousPosition){const t=this.camera._calculateHandednessMultiplier(),i=(a.clientX-this._previousPosition.x)*t,n=a.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=n/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:n}),this._previousPosition={x:a.clientX,y:a.clientY},e||a.preventDefault()}}),this._onMouseMove=i=>{if(!t.isPointerLock)return;const n=this.camera._calculateHandednessMultiplier(),a=i.movementX*n;this.camera.cameraRotation.y+=a/this.angularSensibility;const s=i.movementY;this.camera.cameraRotation.x+=s/this.angularSensibility,this._previousPosition=null,e||i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,b_.POINTERDOWN|b_.POINTERUP|b_.POINTERMOVE),i&&(this._contextMenuBind=e=>this.onContextMenu(e),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(e){e.preventDefault()}getClassName(){return"FreeCameraMouseInput"}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}constructor(e=!0){this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Ih,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}getSimpleName(){return"mouse"}};Lc([Hc()],Xv.prototype,"buttons",void 0),Lc([Hc()],Xv.prototype,"angularSensibility",void 0),Fv.FreeCameraMouseInput=Xv;var Yv,jv,Kv=class{checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Ih,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}getSimpleName(){return"mousewheel"}attachControl(e){e=ad.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==b_.POINTERWHEEL)return;const i=t.event,n=i.deltaMode===ev.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*n*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*n*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*n*i.deltaZ/this._normalize,i.preventDefault&&(e||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,b_.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}getClassName(){return"BaseCameraMouseWheelInput"}};Lc([Hc()],Kv.prototype,"wheelPrecisionX",void 0),Lc([Hc()],Kv.prototype,"wheelPrecisionY",void 0),Lc([Hc()],Kv.prototype,"wheelPrecisionZ",void 0),(jv=Yv||(Yv={}))[jv.MoveRelative=0]="MoveRelative",jv[jv.RotateRelative=1]="RotateRelative",jv[jv.MoveScene=2]="MoveScene";var $v=class extends Kv{getClassName(){return"FreeCameraMouseWheelInput"}set wheelZMoveRelative(e){null===e&&this._wheelZAction!==Yv.MoveRelative||(this._wheelZAction=Yv.MoveRelative,this._wheelZActionCoordinate=e)}get wheelZRotateRelative(){return this._wheelZAction!==Yv.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveRelative(e){null===e&&this._wheelXAction!==Yv.MoveRelative||(this._wheelXAction=Yv.MoveRelative,this._wheelXActionCoordinate=e)}get wheelYRotateRelative(){return this._wheelYAction!==Yv.RotateRelative?null:this._wheelYActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);const e=Lh.Zero();this.camera.getViewMatrix().invertToRef(e);const t=wh.Zero();wh.TransformNormalToRef(this._moveRelative,e,t),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(t),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}set wheelXRotateRelative(e){null===e&&this._wheelXAction!==Yv.RotateRelative||(this._wheelXAction=Yv.RotateRelative,this._wheelXActionCoordinate=e)}get wheelZMoveRelative(){return this._wheelZAction!==Yv.MoveRelative?null:this._wheelZActionCoordinate}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}set wheelXMoveScene(e){null===e&&this._wheelXAction!==Yv.MoveScene||(this._wheelXAction=Yv.MoveScene,this._wheelXActionCoordinate=e)}constructor(){super(...arguments),this._moveRelative=wh.Zero(),this._rotateRelative=wh.Zero(),this._moveScene=wh.Zero(),this._wheelXAction=Yv.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=Yv.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}set wheelYMoveRelative(e){null===e&&this._wheelYAction!==Yv.MoveRelative||(this._wheelYAction=Yv.MoveRelative,this._wheelYActionCoordinate=e)}get wheelXMoveScene(){return this._wheelXAction!==Yv.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(e){null===e&&this._wheelYAction!==Yv.MoveScene||(this._wheelYAction=Yv.MoveScene,this._wheelYActionCoordinate=e)}get wheelYMoveScene(){return this._wheelYAction!==Yv.MoveScene?null:this._wheelYActionCoordinate}get wheelXMoveRelative(){return this._wheelXAction!==Yv.MoveRelative?null:this._wheelXActionCoordinate}get wheelZMoveScene(){return this._wheelZAction!==Yv.MoveScene?null:this._wheelZActionCoordinate}set wheelYRotateRelative(e){null===e&&this._wheelYAction!==Yv.RotateRelative||(this._wheelYAction=Yv.RotateRelative,this._wheelYActionCoordinate=e)}get wheelXRotateRelative(){return this._wheelXAction!==Yv.RotateRelative?null:this._wheelXActionCoordinate}get wheelYMoveRelative(){return this._wheelYAction!==Yv.MoveRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(e){null===e&&this._wheelZAction!==Yv.RotateRelative||(this._wheelZAction=Yv.RotateRelative,this._wheelZActionCoordinate=e)}_updateCameraProperty(e,t,i){if(0===e)return;if(null===t||null===i)return;let n=null;switch(t){case Yv.MoveRelative:n=this._moveRelative;break;case Yv.RotateRelative:n=this._rotateRelative;break;case Yv.MoveScene:n=this._moveScene}switch(i){case 0:n.set(e,0,0);break;case 1:n.set(0,e,0);break;case 2:n.set(0,0,e)}}set wheelZMoveScene(e){null===e&&this._wheelZAction!==Yv.MoveScene||(this._wheelZAction=Yv.MoveScene,this._wheelZActionCoordinate=e)}};Lc([Hc()],$v.prototype,"wheelXMoveRelative",null),Lc([Hc()],$v.prototype,"wheelYMoveRelative",null),Lc([Hc()],$v.prototype,"wheelZMoveRelative",null),Lc([Hc()],$v.prototype,"wheelXRotateRelative",null),Lc([Hc()],$v.prototype,"wheelYRotateRelative",null),Lc([Hc()],$v.prototype,"wheelZRotateRelative",null),Lc([Hc()],$v.prototype,"wheelXMoveScene",null),Lc([Hc()],$v.prototype,"wheelYMoveScene",null),Lc([Hc()],$v.prototype,"wheelZMoveScene",null),Fv.FreeCameraMouseWheelInput=$v;var qv=class{getSimpleName(){return"touch"}getClassName(){return"FreeCameraTouchInput"}attachControl(e){e=ad.BackCompatCameraNoPreventDefault(arguments);let t=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const n=i.event,a="mouse"===n.pointerType||this._isSafari&&void 0===n.pointerType;if(this.allowMouse||!a)if(i.type===b_.POINTERDOWN){if(e||n.preventDefault(),this._pointerPressed.push(n.pointerId),1!==this._pointerPressed.length)return;t={x:n.clientX,y:n.clientY}}else if(i.type===b_.POINTERUP){e||n.preventDefault();const i=this._pointerPressed.indexOf(n.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;t=null,this._offsetX=null,this._offsetY=null}else if(i.type===b_.POINTERMOVE){if(e||n.preventDefault(),!t)return;if(0!=this._pointerPressed.indexOf(n.pointerId))return;this._offsetX=n.clientX-t.x,this._offsetY=-(n.clientY-t.y)}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,b_.POINTERDOWN|b_.POINTERUP|b_.POINTERMOVE),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.addEventListener("blur",this._onLostFocus)}}constructor(e=!1){this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=ad.IsSafari()}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const e=this.camera,t=e._calculateHandednessMultiplier();e.cameraRotation.y=t*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const t=e._computeLocalCameraSpeed(),i=new wh(0,0,0!==this.touchMoveSensibility?t*this._offsetY/this.touchMoveSensibility:0);Lh.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(wh.TransformCoordinates(i,e._cameraRotationMatrix))}}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}};Lc([Hc()],qv.prototype,"touchAngularSensibility",void 0),Lc([Hc()],qv.prototype,"touchMoveSensibility",void 0),Fv.FreeCameraTouchInput=qv;var Jv=class extends kv{removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}clear(){super.clear(),this._mouseInput=null}addMouse(e=!0){return this._mouseInput||(this._mouseInput=new Xv(e),this.add(this._mouseInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new $v,this.add(this._mouseWheelInput)),this}addKeyboard(){return this.add(new zv),this}constructor(e){super(e),this._mouseInput=null,this._mouseWheelInput=null}addTouch(){return this.add(new qv),this}},Qv=class extends yv{get keysRotateUp(){const e=this.inputs.attached.keyboard;return e?e.keysRotateUp:[]}detachControl(){this.inputs.detachElement(),this.cameraDirection=new wh(0,0,0),this.cameraRotation=new Ph(0,0)}get keysRotateRight(){const e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]}set keysUpward(e){const t=this.inputs.attached.keyboard;t&&(t.keysUpward=e)}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}set keysRotateRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateRight=e)}get keysRotateLeft(){const e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]}get keysDownward(){const e=this.inputs.attached.keyboard;return e?e.keysDownward:[]}get keysRotateDown(){const e=this.inputs.attached.keyboard;return e?e.keysRotateDown:[]}getClassName(){return"FreeCamera"}set angularSensibility(e){const t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)}get needMoveForGravity(){return this._needMoveForGravity}set collisionMask(e){this._collisionMask=isNaN(e)?-1:e}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysRotateLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateLeft=e)}_checkInputs(){this._localDirection||(this._localDirection=wh.Zero(),this._transformedDirection=wh.Zero()),this.inputs.checkInputs(),super._checkInputs()}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}get angularSensibility(){const e=this.inputs.attached.mouse;return e?e.angularSensibility:0}set needMoveForGravity(e){this._needMoveForGravity=e}get collisionMask(){return this._collisionMask}_collideWithWorld(e){let t;t=this.parent?wh.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let n=e;this.applyGravity&&(n=e.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.xt)}set keysRotateUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateUp=e)}set keysDownward(e){const t=this.inputs.attached.keyboard;t&&(t.keysDownward=e)}attachControl(e,t){t=ad.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(t)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}dispose(){this.inputs.clear(),super.dispose()}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}get keysUpward(){const e=this.inputs.attached.keyboard;return e?e.keysUpward:[]}constructor(e,t,i,n=!0){super(e,t,i,n),this.ellipsoid=new wh(.5,1,.5),this.ellipsoidOffset=new wh(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=wh.Zero(),this._diffPosition=wh.Zero(),this._newPosition=wh.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(e,t,i=null)=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>Md.CollisionsEpsilon&&(this.position.addToRef(this._diffPosition,this._deferredPositionUpdate),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate),this.onCollide&&i&&this.onCollide(i))},this.inputs=new Jv(this),this.inputs.addKeyboard().addMouse()}set keysRotateDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateDown=e)}};Lc([Yc()],Qv.prototype,"ellipsoid",void 0),Lc([Yc()],Qv.prototype,"ellipsoidOffset",void 0),Lc([Hc()],Qv.prototype,"checkCollisions",void 0),Lc([Hc()],Qv.prototype,"applyGravity",void 0),rh("BABYLON.FreeCamera",Qv),Ed.prototype.createDynamicTexture=function(e,t,i,n){const a=new Cu(this,4);return a.baseWidth=e,a.baseHeight=t,i&&(e=this.needPOTTextures?nd(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?nd(t,this._caps.maxTextureSize):t),a.width=e,a.height=t,a.isReady=!1,a.generateMipMaps=i,a.samplingMode=n,this.updateTextureSamplingMode(n,a),this._internalTexturesCache.push(a),a},Ed.prototype.updateDynamicTexture=function(e,t,i,n=!1,a,s=!1,r=!1){if(!e)return;const o=this._gl,l=o.TEXTURE_2D,c=this._bindTextureDirectly(l,e,!0,s);this._unpackFlipY(void 0===i?e.invertY:i),n&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const h=this._getWebGLTextureType(e.type),f=this._getInternalFormat(a||e.format),u=this._getRGBABufferInternalSizedFormat(e.type,f);o.texImage2D(l,0,u,f,h,t),e.generateMipMaps&&o.generateMipmap(l),c||this._bindTextureDirectly(l,null),n&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),a&&(e.format=a),e._dynamicTextureSource=t,e._premulAlpha=n,e.invertY=i||!1,e.isReady=!0};var Zv=class e extends yp{dispose(){super.dispose(),this._ownCanvas&&this._canvas?.remove?.(),this._canvas=null,this._context=null}drawText(e,t,i,n,a,s,r,o=!0){const l=this.getSize();if(s&&(this._context.fillStyle=s,this._context.fillRect(0,0,l.width,l.height)),this._context.font=n,null==t){const i=this._context.measureText(e);t=(l.width-i.width)/2}if(null==i){const e=parseInt(n.replace(/\D/g,""));i=l.height/2+e/3.65}this._context.fillStyle=a||"",this._context.fillText(e,t,i),o&&this.update(r)}scaleTo(e,t){const i=this.getSize();i.width=e,i.height=t,this._recreate(i)}_rebuild(){this.update()}scale(e){const t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)}update(e,t=!1,i=!1){this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0,void 0,i)}serialize(){const t=this.getScene();t&&!t.isReady()&&jh.Warn("The scene must be ready before serializing the dynamic texture");const i=super.serialize();return e._IsCanvasElement(this._canvas)&&(i.base64String=this._canvas.toDataURL()),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i}constructor(e,t,i=null,n=!1,a=3,s=5,r){super(null,i,!n,r,a,void 0,void 0,void 0,void 0,s),this.name=e,this.wrapU=yp.CLAMP_ADDRESSMODE,this.wrapV=yp.CLAMP_ADDRESSMODE,this._generateMipMaps=n;const o=this._getEngine();if(!o)return;t.getContext?(this._canvas=t,this._ownCanvas=!1,this._texture=o.createDynamicTexture(t.width,t.height,n,a)):(this._canvas=o.createCanvas(1,1),this._ownCanvas=!0,t.width||0===t.width?this._texture=o.createDynamicTexture(t.width,t.height,n,a):this._texture=o.createDynamicTexture(t,t,n,a));const l=this.getSize();this._canvas.width!==l.width&&(this._canvas.width=l.width),this._canvas.height!==l.height&&(this._canvas.height=l.height),this._context=this._canvas.getContext("2d")}static _IsCanvasElement(e){return void 0!==e.toDataURL}get canRescale(){return!0}clear(e){const t=this.getSize();e&&(this._context.fillStyle=e),this._context.clearRect(0,0,t.width,t.height)}_recreate(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)}clone(){const t=this.getScene();if(!t)return this;const i=this.getSize(),n=new e(this.name,i,t,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n}getContext(){return this._context}getClassName(){return"DynamicTexture"}};Tu.prototype._partialLoadFile=function(e,t,i,n,a=null){this._loadFile(e,(e=>{i[t]=e,i._internalCount++,6===i._internalCount&&n(i)}),void 0,void 0,!0,((e,t)=>{a&&e&&a(e.status+" "+e.statusText,t)}))},Tu.prototype._cascadeLoadFiles=function(e,t,i,n=null){const a=[];a._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(i[e],e,a,t,n)},Tu.prototype._cascadeLoadImgs=function(e,t,i,n,a=null,s){const r=[];r._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(n[o],o,r,e,t,i,a,s)},Tu.prototype._partialLoadImg=function(e,t,i,n,a,s,r=null,o){const l=Ju();wu(e,(e=>{i[t]=e,i._internalCount++,n&&n.removePendingData(l),6===i._internalCount&&s&&s(a,i)}),((e,t)=>{n&&n.removePendingData(l),r&&r(e,t)}),n?n.offlineProvider:null,o),n&&n.addPendingData(l)},Tu.prototype.createCubeTextureBase=function(e,t,i,n,a=null,s=null,r,o=null,l=!1,c=0,h=0,f=null,u=null,d=null,m=!1,p=null){const _=f||new Cu(this,7);_.isCube=!0,_.url=e,_.generateMipMaps=!n,_._lodGenerationScale=c,_._lodGenerationOffset=h,_._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),_!==f&&(_.label=e.substring(0,60)),this._doNotHandleContextLost||(_._extension=o,_._files=i,_._buffer=p);const v=e;this._transformTextureUrl&&!f&&(e=this._transformTextureUrl(e));const g=e.split("?")[0],S=g.lastIndexOf("."),y=o||(S>-1?g.substring(S).toLowerCase():"");let E=null;for(const e of Tu._TextureLoaders)if(e.canLoad(y)){E=e;break}const A=(f,g)=>{e===v?s&&f&&s(f.status+" "+f.statusText,g):(jh.Warn(`Failed to load ${e}, falling back to the ${v}`),this.createCubeTextureBase(v,t,i,!!n,a,s,r,o,l,c,h,_,u,d,m,p))};if(E){const n=e=>{u&&u(_,e),E.loadCubeData(e,_,l,a,s)};p?n(p):i&&6===i.length?E.supportCascades?this._cascadeLoadFiles(t,(e=>n(e.map((e=>new Uint8Array(e))))),i,s):s?s("Textures type does not support cascades."):jh.Warn("Texture loader does not support cascades."):this._loadFile(e,(e=>n(new Uint8Array(e))),void 0,void 0,!0,A)}else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,_,((e,t)=>{d&&d(e,t)}),i,s)}return this._internalTexturesCache.push(_),_},Ed.prototype._createDepthStencilCubeTexture=function(e,t){const i=new Cu(this,12);if(i.isCube=!0,1===this.webGLVersion)return jh.Error("Depth cube texture is not supported by WebGL 1."),i;const n={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t},a=this._gl;this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,i,!0),this._setupDepthStencilTexture(i,e,n.generateStencil,n.bilinearFiltering,n.comparisonFunction);for(let t=0;t<6;t++)n.generateStencil?a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,a.DEPTH24_STENCIL8,e,e,0,a.DEPTH_STENCIL,a.UNSIGNED_INT_24_8,null):a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,a.DEPTH_COMPONENT24,e,e,0,a.DEPTH_COMPONENT,a.UNSIGNED_INT,null);return this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(i),i},Ed.prototype._setCubeMapTextureParams=function(e,t,i){const n=this._gl;n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,t?n.LINEAR_MIPMAP_LINEAR:n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==i&&i>0&&(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAX_LEVEL,i),e._maxLodLevel=i),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null)},Ed.prototype.createCubeTexture=function(e,t,i,n,a=null,s=null,r,o=null,l=!1,c=0,h=0,f=null,u,d=!1,m=null){const p=this._gl;return this.createCubeTextureBase(e,t,i,!!n,a,s,r,o,l,c,h,f,(e=>this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,e,!0)),((e,t)=>{const i=this.needPOTTextures?nd(t[0].width,this._caps.maxCubemapTextureSize):t[0].width,s=i,o=[p.TEXTURE_CUBE_MAP_POSITIVE_X,p.TEXTURE_CUBE_MAP_POSITIVE_Y,p.TEXTURE_CUBE_MAP_POSITIVE_Z,p.TEXTURE_CUBE_MAP_NEGATIVE_X,p.TEXTURE_CUBE_MAP_NEGATIVE_Y,p.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(!1);const l=r?this._getInternalFormat(r,e._useSRGBBuffer):e._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:p.RGBA;let c=r?this._getInternalFormat(r):p.RGBA;e._useSRGBBuffer&&1===this.webGLVersion&&(c=l);for(let e=0;e<o.length;e++)if(t[e].width!==i||t[e].height!==s){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void jh.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=i,this._workingCanvas.height=s,this._workingContext.drawImage(t[e],0,0,t[e].width,t[e].height,0,0,i,s),p.texImage2D(o[e],0,l,c,p.UNSIGNED_BYTE,this._workingCanvas)}else p.texImage2D(o[e],0,l,c,p.UNSIGNED_BYTE,t[e]);n||p.generateMipmap(p.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(e,!n),e.width=i,e.height=s,e.isReady=!0,r&&(e.format=r),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),a&&a()}),!!d,m)},Ed.prototype.generateMipMapsForCubemap=function(e,t=!0){if(e.generateMipMaps){const i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)}};var eg=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],tg=[()=>1,e=>e.y,e=>e.z,e=>e.x,e=>e.x*e.y,e=>e.y*e.z,e=>3*e.z*e.z-1,e=>e.x*e.z,e=>e.x*e.x-e.y*e.y],ig=(e,t)=>eg[e]*tg[e](t),ng=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],ag=class e{static FromPolynomial(t){const i=new e;return i.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),i.l1_1=t.y.scale(.977204),i.l10=t.z.scale(.977204),i.l11=t.x.scale(.977204),i.l2_2=t.xy.scale(1.16538),i.l2_1=t.yz.scale(1.16538),i.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),i.l21=t.zx.scale(1.16538),i.l22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),i.l1_1.scaleInPlace(-1),i.l11.scaleInPlace(-1),i.l2_1.scaleInPlace(-1),i.l21.scaleInPlace(-1),i.scaleInPlace(Math.PI),i}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(eg[0]),this.l1_1.scaleInPlace(eg[1]),this.l10.scaleInPlace(eg[2]),this.l11.scaleInPlace(eg[3]),this.l2_2.scaleInPlace(eg[4]),this.l2_1.scaleInPlace(eg[5]),this.l20.scaleInPlace(eg[6]),this.l21.scaleInPlace(eg[7]),this.l22.scaleInPlace(eg[8])}updateFromArray(e){return wh.FromArrayToRef(e[0],0,this.l00),wh.FromArrayToRef(e[1],0,this.l1_1),wh.FromArrayToRef(e[2],0,this.l10),wh.FromArrayToRef(e[3],0,this.l11),wh.FromArrayToRef(e[4],0,this.l2_2),wh.FromArrayToRef(e[5],0,this.l2_1),wh.FromArrayToRef(e[6],0,this.l20),wh.FromArrayToRef(e[7],0,this.l21),wh.FromArrayToRef(e[8],0,this.l22),this}updateFromFloatsArray(e){return wh.FromFloatsToRef(e[0],e[1],e[2],this.l00),wh.FromFloatsToRef(e[3],e[4],e[5],this.l1_1),wh.FromFloatsToRef(e[6],e[7],e[8],this.l10),wh.FromFloatsToRef(e[9],e[10],e[11],this.l11),wh.FromFloatsToRef(e[12],e[13],e[14],this.l2_2),wh.FromFloatsToRef(e[15],e[16],e[17],this.l2_1),wh.FromFloatsToRef(e[18],e[19],e[20],this.l20),wh.FromFloatsToRef(e[21],e[22],e[23],this.l21),wh.FromFloatsToRef(e[24],e[25],e[26],this.l22),this}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}addLight(e,t,i){kh.Vector3[0].set(t.r,t.g,t.b);const n=kh.Vector3[0],a=kh.Vector3[1];n.scaleToRef(i,a),a.scaleToRef(ig(0,e),kh.Vector3[2]),this.l00.addInPlace(kh.Vector3[2]),a.scaleToRef(ig(1,e),kh.Vector3[2]),this.l1_1.addInPlace(kh.Vector3[2]),a.scaleToRef(ig(2,e),kh.Vector3[2]),this.l10.addInPlace(kh.Vector3[2]),a.scaleToRef(ig(3,e),kh.Vector3[2]),this.l11.addInPlace(kh.Vector3[2]),a.scaleToRef(ig(4,e),kh.Vector3[2]),this.l2_2.addInPlace(kh.Vector3[2]),a.scaleToRef(ig(5,e),kh.Vector3[2]),this.l2_1.addInPlace(kh.Vector3[2]),a.scaleToRef(ig(6,e),kh.Vector3[2]),this.l20.addInPlace(kh.Vector3[2]),a.scaleToRef(ig(7,e),kh.Vector3[2]),this.l21.addInPlace(kh.Vector3[2]),a.scaleToRef(ig(8,e),kh.Vector3[2]),this.l22.addInPlace(kh.Vector3[2])}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(ng[0]),this.l1_1.scaleInPlace(ng[1]),this.l10.scaleInPlace(ng[2]),this.l11.scaleInPlace(ng[3]),this.l2_2.scaleInPlace(ng[4]),this.l2_1.scaleInPlace(ng[5]),this.l20.scaleInPlace(ng[6]),this.l21.scaleInPlace(ng[7]),this.l22.scaleInPlace(ng[8])}static FromArray(t){return(new e).updateFromArray(t)}constructor(){this.preScaled=!1,this.l00=wh.Zero(),this.l1_1=wh.Zero(),this.l10=wh.Zero(),this.l11=wh.Zero(),this.l2_2=wh.Zero(),this.l2_1=wh.Zero(),this.l20=wh.Zero(),this.l21=wh.Zero(),this.l22=wh.Zero()}},sg=class e{static FromArray(t){const i=new e;return wh.FromArrayToRef(t[0],0,i.x),wh.FromArrayToRef(t[1],0,i.y),wh.FromArrayToRef(t[2],0,i.z),wh.FromArrayToRef(t[3],0,i.xx),wh.FromArrayToRef(t[4],0,i.yy),wh.FromArrayToRef(t[5],0,i.zz),wh.FromArrayToRef(t[6],0,i.yz),wh.FromArrayToRef(t[7],0,i.zx),wh.FromArrayToRef(t[8],0,i.xy),i}get preScaledHarmonics(){return this._harmonics||(this._harmonics=ag.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),kh.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),kh.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(kh.Vector3[0]).addInPlace(kh.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(kh.Vector3[0]).subtractInPlace(kh.Vector3[1]),this.zz.copyFrom(e.l00),kh.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(kh.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}addAmbient(e){kh.Vector3[0].copyFromFloats(e.r,e.g,e.b);const t=kh.Vector3[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}constructor(){this.x=wh.Zero(),this.y=wh.Zero(),this.z=wh.Zero(),this.xx=wh.Zero(),this.yy=wh.Zero(),this.zz=wh.Zero(),this.xy=wh.Zero(),this.yz=wh.Zero(),this.zx=wh.Zero()}static FromHarmonics(t){return(new e).updateFromHarmonics(t)}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}},rg=class{constructor(e,t,i,n){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=n}},og=class{static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,i=e.readPixels(0,void 0,void 0,!1),n=e.readPixels(1,void 0,void 0,!1);let a,s;e.isRenderTarget?(a=e.readPixels(3,void 0,void 0,!1),s=e.readPixels(2,void 0,void 0,!1)):(a=e.readPixels(2,void 0,void 0,!1),s=e.readPixels(3,void 0,void 0,!1));const r=e.readPixels(4,void 0,void 0,!1),o=e.readPixels(5,void 0,void 0,!1),l=e.gammaSpace;let c=0;return 1!=e.textureType&&2!=e.textureType||(c=1),new Promise((e=>{Promise.all([n,i,a,s,r,o]).then((([i,n,a,s,r,o])=>{const h={size:t,right:n,left:i,up:a,down:s,front:r,back:o,format:5,type:c,gammaSpace:l};e(this.ConvertCubeMapToSphericalPolynomial(h))}))}))}static ConvertCubeMapToSphericalPolynomial(e){const t=new ag;let i=0;const n=2/e.size,a=n,s=.5*n,r=s-1;for(let o=0;o<6;o++){const l=this._FileFaces[o],c=e[l.name];let h=r;const f=5===e.format?4:3;for(let o=0;o<e.size;o++){let u=r;for(let a=0;a<e.size;a++){const r=l.worldAxisForFileX.scale(u).add(l.worldAxisForFileY.scale(h)).add(l.worldAxisForNormal);r.normalize();const d=this._AreaElement(u-s,h-s)-this._AreaElement(u-s,h+s)-this._AreaElement(u+s,h-s)+this._AreaElement(u+s,h+s);let m=c[o*e.size*f+a*f+0],p=c[o*e.size*f+a*f+1],_=c[o*e.size*f+a*f+2];isNaN(m)&&(m=0),isNaN(p)&&(p=0),isNaN(_)&&(_=0),0===e.type&&(m/=255,p/=255,_/=255),e.gammaSpace&&(m=Math.pow(vh.Clamp(m),lh),p=Math.pow(vh.Clamp(p),lh),_=Math.pow(vh.Clamp(_),lh));const v=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(m,p,_);if(e>v){const t=v/e;m*=t,p*=t,_*=t}}else m=vh.Clamp(m,0,v),p=vh.Clamp(p,0,v),_=vh.Clamp(_,0,v);const g=new Ah(m,p,_);t.addLight(r,g,d),i+=d,u+=n}h+=a}}const o=6*(4*Math.PI)/6/i;return t.scaleInPlace(o),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),sg.FromHarmonics(t)}};og._FileFaces=[new rg("right",new wh(1,0,0),new wh(0,0,-1),new wh(0,-1,0)),new rg("left",new wh(-1,0,0),new wh(0,0,1),new wh(0,-1,0)),new rg("up",new wh(0,1,0),new wh(1,0,0),new wh(0,0,1)),new rg("down",new wh(0,-1,0),new wh(1,0,0),new wh(0,0,-1)),new rg("front",new wh(0,0,1),new wh(1,0,0),new wh(0,-1,0)),new rg("back",new wh(0,0,-1),new wh(-1,0,0),new wh(0,-1,0))],og.MAX_HDRI_VALUE=4096,og.PRESERVE_CLAMPED_COLORS=!1;var lg=class e extends Ip{async _initShaderSourceAsync(e){e?(this._webGPUReady=!0,await Promise.all([Promise.resolve().then((()=>(ra(),ia)))])):await Promise.all([Promise.resolve().then((()=>(R(),y)))]),await super._initShaderSourceAsync(e)}getClassName(){return"PassPostProcess"}constructor(e,t,i=null,n,a,s,r=0,o=!1){super(e,"pass",null,null,t,i,n,a,s,void 0,r,void 0,null,o)}static _Parse(t,i,n,a){return Uh.Parse((()=>new e(t.name,t.options,i,t.renderTargetSamplingMode,t._engine,t.reusable)),t,n,a)}};rh("BABYLON.PassPostProcess",lg),Tu._RescalePostProcessFactory=e=>new lg("rescale",1,null,2,e,!1,0),c();e.ShadersStore.lodPixelShader="#extension GL_EXT_shader_texture_lod : enable\nprecision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform sampler2D textureSampler;uniform float lod;uniform vec2 texSize;uniform bool gamma;void main(void)\n{gl_FragColor=textureLod(textureSampler,vUV,lod);if (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n",c();var cg,hg;function fg(e){cg||(cg=new Float32Array(1),hg=new Int32Array(cg.buffer)),cg[0]=e;const t=hg[0];let i=t>>16&32768,n=t>>12&2047;const a=t>>23&255;return a<103?i:a>142?(i|=31744,i|=(255==a?0:1)&&8388607&t,i):a<113?(n|=2048,i|=(n>>114-a)+(n>>113-a&1),i):(i|=a-112<<10|n>>1,i+=1&n,i)}function ug(e){const t=(32768&e)>>15,i=(31744&e)>>10,n=1023&e;return 0===i?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):31==i?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+n/Math.pow(2,10))}e.ShadersStore.lodCubePixelShader="precision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform samplerCube textureSampler;uniform float lod;uniform bool gamma;void main(void)\n{vec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x),lod);\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x),lod);\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x),lod);\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x),lod);\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001),lod);\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001),lod);\n#endif\nif (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n";var dg=131072,mg=131072;function pg(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var _g=pg("DXT1"),vg=pg("DXT3"),gg=pg("DXT5"),Sg=pg("DX10"),yg=class e{static _ExtractLongWordOrder(t){return 0===t||255===t||-16777216===t?0:1+e._ExtractLongWordOrder(t>>8)}static _GetRGBArrayBuffer(e,t,i,n,a,s,r,o){const l=new Uint8Array(n),c=new Uint8Array(a,i);let h=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const n=3*(t+i*e);l[h]=c[n+s],l[h+1]=c[n+r],l[h+2]=c[n+o],h+=3}return l}static _GetFloatRGBAArrayBuffer(t,i,n,a,s,r){if(e.StoreLODInAlphaChannel){const e=new Float32Array(a),o=new Float32Array(s,n);let l=0;for(let n=0;n<i;n++)for(let i=0;i<t;i++){const a=4*(i+n*t);e[l]=o[a],e[l+1]=o[a+1],e[l+2]=o[a+2],e[l+3]=r,l+=4}return e}return new Float32Array(s,n,a)}static _GetHalfFloatRGBAArrayBuffer(t,i,n,a,s,r){if(e.StoreLODInAlphaChannel){const e=new Uint16Array(a),o=new Uint16Array(s,n);let l=0;for(let n=0;n<i;n++)for(let i=0;i<t;i++){const a=4*(i+n*t);e[l]=o[a],e[l+1]=o[a+1],e[l+2]=o[a+2],e[l+3]=fg(r),l+=4}return e}return new Uint16Array(s,n,a)}static _GetHalfFloatAsUIntRGBAArrayBuffer(t,i,n,a,s,r){const o=new Uint8Array(a),l=new Uint16Array(s,n);let c=0;for(let n=0;n<i;n++)for(let i=0;i<t;i++){const a=4*(i+n*t);o[c]=255*vh.Clamp(ug(l[a])),o[c+1]=255*vh.Clamp(ug(l[a+1])),o[c+2]=255*vh.Clamp(ug(l[a+2])),e.StoreLODInAlphaChannel?o[c+3]=r:o[c+3]=255*vh.Clamp(ug(l[a+3])),c+=4}return o}static _GetFloatAsHalfFloatRGBAArrayBuffer(t,i,n,a,s,r){const o=new Uint16Array(a),l=new Float32Array(s,n);let c=0;for(let n=0;n<i;n++)for(let i=0;i<t;i++)o[c]=fg(l[c]),o[c+1]=fg(l[c+1]),o[c+2]=fg(l[c+2]),e.StoreLODInAlphaChannel?o[c+3]=fg(r):o[c+3]=fg(l[c+3]),c+=4;return o}static _GetHalfFloatAsFloatRGBAArrayBuffer(t,i,n,a,s,r){const o=new Float32Array(a),l=new Uint16Array(s,n);let c=0;for(let n=0;n<i;n++)for(let i=0;i<t;i++){const a=4*(i+n*t);o[c]=ug(l[a]),o[c+1]=ug(l[a+1]),o[c+2]=ug(l[a+2]),e.StoreLODInAlphaChannel?o[c+3]=r:o[c+3]=ug(l[a+3]),c+=4}return o}static _GetFloatAsUIntRGBAArrayBuffer(t,i,n,a,s,r){const o=new Uint8Array(a),l=new Float32Array(s,n);let c=0;for(let n=0;n<i;n++)for(let i=0;i<t;i++){const a=4*(i+n*t);o[c]=255*vh.Clamp(l[a]),o[c+1]=255*vh.Clamp(l[a+1]),o[c+2]=255*vh.Clamp(l[a+2]),e.StoreLODInAlphaChannel?o[c+3]=r:o[c+3]=255*vh.Clamp(l[a+3]),c+=4}return o}static _GetLuminanceArrayBuffer(e,t,i,n,a){const s=new Uint8Array(n),r=new Uint8Array(a,i);let o=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const n=t+i*e;s[o]=r[n],o++}return s}static UploadDDSLevels(t,i,n,a,s,r,o=-1,l,c=!0){let h=null;a.sphericalPolynomial&&(h=[]);const f=!!t.getCaps().s3tc;i.generateMipMaps=s;const u=new Int32Array(n.buffer,n.byteOffset,31);let d,m,p,_,v,g,S,y=0,E=0,A=1;if(542327876!==u[0])return void jh.Error("Invalid magic number in DDS header");if(!a.isFourCC&&!a.isRGB&&!a.isLuminance)return void jh.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(a.isCompressed&&!f)return void jh.Error("Compressed textures are not supported on this platform.");let C=u[22];_=u[1]+4;let R=!1;if(a.isFourCC)switch(d=u[21],d){case _g:A=8,E=33777;break;case vg:A=16,E=33778;break;case gg:A=16,E=33779;break;case 113:R=!0,C=64;break;case 116:R=!0,C=128;break;case Sg:{_+=20;let e=!1;switch(a.dxgiFormat){case 10:R=!0,C=64,e=!0;break;case 2:R=!0,C=128,e=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,C=32,e=!0}if(e)break}default:return void jh.Error(["Unsupported FourCC code:",(T=d,String.fromCharCode(255&T,T>>8&255,T>>16&255,T>>24&255))])}var T;const N=e._ExtractLongWordOrder(u[23]),M=e._ExtractLongWordOrder(u[24]),I=e._ExtractLongWordOrder(u[25]),x=e._ExtractLongWordOrder(u[26]);R&&(E=t._getRGBABufferInternalSizedFormat(a.textureType)),g=1,u[2]&dg&&!1!==s&&(g=Math.max(1,u[7]));const b=l||0,P=t.getCaps();for(let s=b;s<r;s++){for(m=u[4],p=u[3],S=0;S<g;++S){if(-1===o||o===S){const r=-1===o?S:0;if(!a.isCompressed&&a.isFourCC){i.format=5,y=m*p*4;let a=null;if(t._badOS||t._badDesktopOS||!P.textureHalfFloat&&!P.textureFloat)128===C?(a=e._GetFloatAsUIntRGBAArrayBuffer(m,p,n.byteOffset+_,y,n.buffer,r),h&&0==r&&h.push(e._GetFloatRGBAArrayBuffer(m,p,n.byteOffset+_,y,n.buffer,r))):64===C&&(a=e._GetHalfFloatAsUIntRGBAArrayBuffer(m,p,n.byteOffset+_,y,n.buffer,r),h&&0==r&&h.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(m,p,n.byteOffset+_,y,n.buffer,r))),i.type=0;else{const t=P.textureFloat&&(c&&P.textureFloatLinearFiltering||!c),s=P.textureHalfFloat&&(c&&P.textureHalfFloatLinearFiltering||!c),o=(128===C||64===C&&!s)&&t?1:(64===C||128===C&&!t)&&s?2:0;let l,f=null;if(128===C)switch(o){case 1:l=e._GetFloatRGBAArrayBuffer,f=null;break;case 2:l=e._GetFloatAsHalfFloatRGBAArrayBuffer,f=e._GetFloatRGBAArrayBuffer;break;case 0:l=e._GetFloatAsUIntRGBAArrayBuffer,f=e._GetFloatRGBAArrayBuffer}else switch(o){case 1:l=e._GetHalfFloatAsFloatRGBAArrayBuffer,f=null;break;case 2:l=e._GetHalfFloatRGBAArrayBuffer,f=e._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:l=e._GetHalfFloatAsUIntRGBAArrayBuffer,f=e._GetHalfFloatAsFloatRGBAArrayBuffer}i.type=o,a=l(m,p,n.byteOffset+_,y,n.buffer,r),h&&0==r&&h.push(f?f(m,p,n.byteOffset+_,y,n.buffer,r):a)}a&&t._uploadDataToTextureDirectly(i,a,s,r)}else if(a.isRGB)i.type=0,24===C?(i.format=4,y=m*p*3,v=e._GetRGBArrayBuffer(m,p,n.byteOffset+_,y,n.buffer,N,M,I),t._uploadDataToTextureDirectly(i,v,s,r)):(i.format=5,y=m*p*4,v=e._GetRGBAArrayBuffer(m,p,n.byteOffset+_,y,n.buffer,N,M,I,x),t._uploadDataToTextureDirectly(i,v,s,r));else if(a.isLuminance){const a=t._getUnpackAlignement(),o=m;y=Math.floor((m+a-1)/a)*a*(p-1)+o,v=e._GetLuminanceArrayBuffer(m,p,n.byteOffset+_,y,n.buffer),i.format=1,i.type=0,t._uploadDataToTextureDirectly(i,v,s,r)}else y=Math.max(4,m)/4*Math.max(4,p)/4*A,v=new Uint8Array(n.buffer,n.byteOffset+_,y),i.type=0,t._uploadCompressedDataToTextureDirectly(i,E,m,p,v,s,r)}_+=C?m*p*(C/8):y,m*=.5,p*=.5,m=Math.max(1,m),p=Math.max(1,p)}if(void 0!==l)break}h&&h.length>0?a.sphericalPolynomial=og.ConvertCubeMapToSphericalPolynomial({size:u[4],right:h[0],left:h[1],up:h[2],down:h[3],front:h[4],back:h[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,31),i=new Int32Array(e.buffer,e.byteOffset,35);let n=1;t[2]&dg&&(n=Math.max(1,t[7]));const a=t[21],s=a===Sg?i[32]:0;let r=0;switch(a){case 113:r=2;break;case 116:r=1;break;case Sg:if(10===s){r=2;break}if(2===s){r=1;break}}return{width:t[4],height:t[3],mipmapCount:n,isFourCC:4==(4&t[20]),isRGB:64==(64&t[20]),isLuminance:(t[20]&mg)===mg,isCube:512==(512&t[28]),isCompressed:a===_g||a===vg||a===gg,dxgiFormat:s,textureType:r}}static _GetRGBAArrayBuffer(e,t,i,n,a,s,r,o,l){const c=new Uint8Array(n),h=new Uint8Array(a,i);let f=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const n=4*(t+i*e);c[f]=h[n+s],c[f+1]=h[n+r],c[f+2]=h[n+o],c[f+3]=h[n+l],f+=4}return c}};yg.StoreLODInAlphaChannel=!1,Ed.prototype.createPrefilteredCubeTexture=function(e,t,i,n,a=null,s=null,r,o=null,l=!0){return this.createCubeTexture(e,t,null,!1,(e=>{if(!e)return void(a&&a(null));const s=e.texture;if(l?e.info.sphericalPolynomial&&(s._sphericalPolynomial=e.info.sphericalPolynomial):s._sphericalPolynomial=new sg,s._source=9,this.getCaps().textureLOD)return void(a&&a(s));const r=this._gl,o=e.width;if(!o)return;const c=[];for(let a=0;a<3;a++){const l=1-a/2,h=n,f=vh.Log2(o)*i+n,u=h+(f-h)*l,d=Math.round(Math.min(Math.max(u,0),f)),m=new Cu(this,2);if(m.type=s.type,m.format=s.format,m.width=Math.pow(2,Math.max(vh.Log2(o)-d,0)),m.height=m.width,m.isCube=!0,m._cachedWrapU=0,m._cachedWrapV=0,this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,m,!0),m.samplingMode=2,r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e.isDDS){const t=e.info,i=e.data;this._unpackFlipY(t.isCompressed),yg.UploadDDSLevels(this,m,i,t,!0,6,d)}else jh.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null);const p=new gp(t);p._isCube=!0,p._texture=m,m.isReady=!0,c.push(p)}s._lodTextureHigh=c[2],s._lodTextureMid=c[1],s._lodTextureLow=c[0],a&&a(s)}),s,r,o,l,i,n)};var Eg=class e extends gp{get rotationY(){return this._rotationY}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}updateURL(e,t=null,i=null,n=!1,a=null,s=null,r=!1,o=null,l=null){this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,t&&(this._forcedExtension=t);const c=e.lastIndexOf("."),h=t||(c>-1?e.substring(c).toLowerCase():""),f=0===h.indexOf(".dds"),u=0===h.indexOf(".env"),d=0===h.indexOf(".basis");if(u?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=n,n&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(d||u||f||s||(s=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,s){for(let t=0;t<s.length;t++)this._files.push(e+s[t]);this._extensions=s}this._buffer=l,r?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=a):this._loadTexture(i,a)}get forcedExtension(){return this._forcedExtension}static CreateFromImages(t,i,n){let a="";return t.forEach((e=>a+=e)),new e(a,i,null,n,t)}static CreateFromPrefilteredData(t,i,n=null,a=!0){const s=i.useDelayedTextureLoading;i.useDelayedTextureLoading=!1;const r=new e(t,i,null,!1,null,null,null,void 0,!0,n,a);return i.useDelayedTextureLoading=s,r}get noMipmap(){return this._noMipmap}setReflectionTextureMatrix(e){if(e.updateFlag===this._textureMatrix.updateFlag)return;if(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this))),this._textureMatrix=e,!this.getScene()?.useRightHandedSystem)return;const t=kh.Vector3[0],i=kh.Ht[0],n=kh.Vector3[1];this._textureMatrix.decompose(t,i,n),i.z*=-1,i.w*=-1,Lh.ComposeToRef(t,i,n,this._textureMatrixRefraction)}constructor(e,t,i=null,n=!1,a=null,s=null,r=null,o=5,l=!1,c=null,h=!1,f=.8,u=0,d,m){super(t),this.onLoadObservable=new Ih,this.boundingBoxPosition=wh.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Lh,this._buffer=null,this.name=e,this.url=e,this._noMipmap=n,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=Lh.Identity(),this.coordinatesMode=yp.CUBIC_MODE;let p=null,_=null;null===i||Array.isArray(i)?(this._noMipmap=n,this._format=o,this._createPolynomials=h,p=i,this._loaderOptions=d,this._useSRGBBuffer=m,this._lodScale=f,this._lodOffset=u):(p=i.extensions??null,this._noMipmap=i.noMipmap??!1,a=i.files??null,_=i.buffer??null,this._format=i.format??5,l=i.prefiltered??!1,c=i.forcedExtension??null,this._createPolynomials=i.createPolynomials??!1,this._lodScale=i.lodScale??.8,this._lodOffset=i.lodOffset??0,this._loaderOptions=i.loaderOptions,this._useSRGBBuffer=i.useSRGBBuffer,s=i.onLoad??null,r=i.onError??null),(e||a)&&this.updateURL(e,c,s,l,r,p,this.getScene()?.useDelayedTextureLoading,a,_)}_loadTexture(e=null,t=null){const i=this.getScene(),n=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const a=()=>{this.onLoadObservable.notifyObservers(this),n&&(n.dispose(),this.getScene()?.markAllMaterialsAsDirty(1)),e&&e()},s=(e,i)=>{this._loadingError=!0,this._errorObject={message:e,exception:i},t&&t(e,i),yp.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?ad.SetImmediate((()=>a())):this._texture.onLoadedObservable.add((()=>a())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,e,s,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,e,s,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),this._texture?.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}clone(){let t=0;const i=Uh.Clone((()=>{const i=new e(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return t=i.xt,i}),this);return i.xt=t,i}static Parse(t,i,n){const a=Uh.Parse((()=>{let a=!1;return t.prefiltered&&(a=t.prefiltered),new e(n+(t.url??t.name),i,t.extensions,!1,t.files||null,null,null,void 0,a,t.forcedExtension)}),t,i);if(t.boundingBoxPosition&&(a.boundingBoxPosition=wh.FromArray(t.boundingBoxPosition)),t.boundingBoxSize&&(a.boundingBoxSize=wh.FromArray(t.boundingBoxSize)),t.animations)for(let e=0;e<t.animations.length;e++){const i=t.animations[e],n=oh("BABYLON.Animation");n&&a.animations.push(n.Parse(i))}return a}getClassName(){return"CubeTexture"}getRefractionTextureMatrix(){return this.getScene()?.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(Lh.RotationY(this._rotationY))}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}};Lc([Hc()],Eg.prototype,"url",void 0),Lc([Yc()],Eg.prototype,"boundingBoxPosition",void 0),Lc([Yc()],Eg.prototype,"boundingBoxSize",null),Lc([Hc("rotationY")],Eg.prototype,"rotationY",null),Lc([Hc("files")],Eg.prototype,"_files",void 0),Lc([Hc("forcedExtension")],Eg.prototype,"_forcedExtension",void 0),Lc([Hc("extensions")],Eg.prototype,"_extensions",void 0),Lc([$c("textureMatrix")],Eg.prototype,"_textureMatrix",void 0),Lc([$c("textureMatrixRefraction")],Eg.prototype,"_textureMatrixRefraction",void 0),yp._CubeTextureParser=Eg.Parse,rh("BABYLON.CubeTexture",Eg);var Ag=class{static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}bindForSubMesh(e,t,i,n,a){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&-1!==t.prePassRenderer.getIndex(2)){this.previousWorldMatrices[i.xt]||(this.previousWorldMatrices[i.xt]=n.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());const a=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=a.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==a.frameId&&(this._lastUpdateFrameId=a.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[i.xt]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.xt]=n.clone()}}static AddSamplers(e){}constructor(){this.previousWorldMatrices={},this.previousBones={}}},Cg=class{static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set RefractionTextureEnabled(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set ClearCoatTintTextureEnabled(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set ClearCoatTextureEnabled(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set IridescenceTextureEnabled(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set EmissiveTextureEnabled(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set SpecularTextureEnabled(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ThicknessTextureEnabled(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set ReflectionTextureEnabled(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set AnisotropicTextureEnabled(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set DetailTextureEnabled(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set TranslucencyColorTextureEnabled(e){this._TranslucencyColorTextureEnabled!==e&&(this._TranslucencyColorTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set ClearCoatBumpTextureEnabled(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set BumpTextureEnabled(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static get FresnelEnabled(){return this._FresnelEnabled}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set LightmapTextureEnabled(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set AmbientTextureEnabled(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set DecalMapEnabled(e){this._DecalMapEnabled!==e&&(this._DecalMapEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set ColorGradingTextureEnabled(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set TranslucencyIntensityTextureEnabled(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set FresnelEnabled(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,Md.MarkAllMaterialsAsDirty(4))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set SheenTextureEnabled(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set OpacityTextureEnabled(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}static set DiffuseTextureEnabled(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,Md.MarkAllMaterialsAsDirty(1))}};Cg._DiffuseTextureEnabled=!0,Cg._DetailTextureEnabled=!0,Cg._DecalMapEnabled=!0,Cg._AmbientTextureEnabled=!0,Cg._OpacityTextureEnabled=!0,Cg._ReflectionTextureEnabled=!0,Cg._EmissiveTextureEnabled=!0,Cg._SpecularTextureEnabled=!0,Cg._BumpTextureEnabled=!0,Cg._LightmapTextureEnabled=!0,Cg._RefractionTextureEnabled=!0,Cg._ColorGradingTextureEnabled=!0,Cg._FresnelEnabled=!0,Cg._ClearCoatTextureEnabled=!0,Cg._ClearCoatBumpTextureEnabled=!0,Cg._ClearCoatTintTextureEnabled=!0,Cg._SheenTextureEnabled=!0,Cg._AnisotropicTextureEnabled=!0,Cg._ThicknessTextureEnabled=!0,Cg._RefractionIntensityTextureEnabled=!0,Cg._TranslucencyIntensityTextureEnabled=!0,Cg._TranslucencyColorTextureEnabled=!0,Cg._IridescenceTextureEnabled=!0,c();var Rg=new RegExp("^([gimus]+)!"),Tg=class t{_handlePluginEventHardBindForSubMesh(e){for(const t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventPrepareDefinesBeforeAttributes(e){for(const t of this._activePlugins)t.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}_handlePluginEvent(e,t){switch(e){case 512:{const e=t;for(const t of this._activePlugins)t.getActiveTextures(e.activeTextures);break}case 256:{const e=t;for(const t of this._activePlugins)t.getAnimatables(e.animatables);break}case 1024:{const e=t;let i=!1;for(const t of this._activePlugins)if(i=t.hasTexture(e.texture),i)break;e.hasTexture=i;break}case 2:{const e=t;for(const t of this._plugins)t.dispose(e.forceDisposeTextures);break}case 4:t.defineNames=this._defineNamesFromPlugins;break;case 128:{const e=t;for(const t of this._activePlugins)e.fallbackRank=t.addFallbacks(e.defines,e.fallbacks,e.fallbackRank),t.getAttributes(e.attributes,this._scene,e.mesh);this._uniformList.length>0&&e.uniforms.push(...this._uniformList),this._samplerList.length>0&&e.samplers.push(...this._samplerList),this._uboList.length>0&&e.uniformBuffersNames.push(...this._uboList),e.customCode=this._injectCustomCode(e,e.customCode);break}case 8:{const e=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const i=1===this._material.shaderLanguage;for(const t of this._plugins){const n=t.getUniforms(this._material.shaderLanguage);if(n){if(n.ubo)for(const t of n.ubo){if(t.size&&t.type){const n=t.arraySize??0;if(e.ubo.addUniform(t.name,t.size,n),i){let e;switch(t.type){case"mat4":e="mat4x4f";break;case"float":e="f32";break;default:e=`${t.type}f`}this._uboDeclaration+=`uniform ${t.name}: ${e}${n>0?`[${n}]`:""};\n`}else this._uboDeclaration+=`${t.type} ${t.name}${n>0?`[${n}]`:""};\n`}this._uniformList.push(t.name)}n.vertex&&(this._vertexDeclaration+=n.vertex+"\n"),n.fragment&&(this._fragmentDeclaration+=n.fragment+"\n")}t.getSamplers(this._samplerList),t.getUniformBuffersNames(this._uboList)}break}}}_activatePlugin(e){-1===this._activePlugins.indexOf(e)&&(this._activePlugins.push(e),this._activePlugins.sort(((e,t)=>e.priority-t.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort(((e,t)=>e.priority-t.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}_injectCustomCode(t,i){return(n,a)=>{i&&(a=i(n,a)),this._uboDeclaration&&(a=a.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(a=a.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(a=a.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const s=this._codeInjectionPoints?.[n];if(!s)return a;let r=null;for(let i in s){let s="";for(const a of this._activePlugins){let o=a.getCustomCode(n,this._material.shaderLanguage)?.[i];if(o){if(a.resolveIncludes){if(null===r){const i=0;r={defines:[],indexParameters:t.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:e.GetShadersRepository(i),includesShadersStore:e.GetIncludesShadersStore(i),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}r.isFragment="fragment"===n,eu(o,r,(e=>o=e))}s+=o+"\n"}}if(s.length>0)if("!"===i.charAt(0)){i=i.substring(1);let e="g";if("!"===i.charAt(0))e="",i=i.substring(1);else{const t=Rg.exec(i);t&&t.length>=2&&(e=t[1],i=i.substring(e.length+1))}e.indexOf("g")<0&&(e+="g");const t=a,n=new RegExp(i,e);let r=n.exec(t);for(;null!==r;){let e=s;for(let t=0;t<r.length;++t)e=e.replace("$"+t,r[t]);a=a.replace(r[0],e),r=n.exec(t)}}else{const e="#define "+i;a=a.replace(e,"\n"+s+"\n"+e)}}return a}}_collectPointNames(e,t){if(t)for(const i in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][i]=!0}_handlePluginEventHasRenderTargetTextures(e){let t=!1;for(const e of this._activePluginsForExtraEvents)if(t=e.hasRenderTargetTextures(),t)break;e.hasRenderTargetTextures=t}_handlePluginEventPrepareDefines(e){for(const t of this._activePlugins)t.prepareDefines(e.defines,this._scene,e.mesh)}_handlePluginEventFillRenderTargetTextures(e){for(const t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(e.renderTargets)}_handlePluginEventIsReadyForSubMesh(e){let t=!0;for(const i of this._activePlugins)t=t&&i.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh);e.isReadyForSubMesh=t}getPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}_addPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e.name)return!1;if(this._material._uniformBufferLayoutBuilt)throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.`;if(!e.isCompatible(this._material.shaderLanguage))throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const i=e.getClassName();t._MaterialPluginClassToMainDefine[i]||(t._MaterialPluginClassToMainDefine[i]="MATERIALPLUGIN_"+ ++t._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(e,t)=>this._handlePluginEvent(e,t),this._plugins.push(e),this._plugins.sort(((e,t)=>e.priority-t.priority)),this._codeInjectionPoints={};const n={};n[t._MaterialPluginClassToMainDefine[i]]={type:"boolean",default:!0};for(const e of this._plugins)e.collectDefines(n),this._collectPointNames("vertex",e.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",e.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=n,!0}constructor(e){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=e,this._scene=e.getScene(),this._engine=this._scene.getEngine()}_handlePluginEventBindForSubMesh(e){for(const t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}};Tg._MaterialPluginClassToMainDefine={},Tg._MaterialPluginCounter=0,xh.OnEnginesDisposedObservable.add((()=>{Ng.length=0,!1,Am.OnEventObservable.remove(Mg),Mg=null}));var Ng=[],Mg=null;var Ig=class{fillRenderTargetTextures(e){}parse(e,t,i){Uh.Parse((()=>this),e,t,i)}isReadyForSubMesh(e,t,i,n){return!0}serialize(){return Uh.Serialize(this)}_enable(e){e&&this._pluginManager._activatePlugin(this)}getCustomCode(e,t=0){return null}getClassName(){return"MaterialPluginBase"}getUniformBuffersNames(e){}copyTo(e){Uh.Clone((()=>e),this)}constructor(e,t,i,n,a=!0,s=!1,r=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=e,this.name=t,this.priority=i,this.resolveIncludes=r,e.pluginManager||(e.pluginManager=new Tg(e),e.onDisposeObservable.add((()=>{e.pluginManager=void 0}))),this._pluginDefineNames=n,this._pluginManager=e.pluginManager,a&&this._pluginManager._addPlugin(this),s&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[63]}prepareDefines(e,t,i){}getAttributes(e,t,i){}addFallbacks(e,t,i){return i}hardBindForSubMesh(e,t,i,n){}dispose(e){}prepareDefinesBeforeAttributes(e,t,i){}hasRenderTargetTextures(){return!1}getAnimatables(e){}getSamplers(e){}hasTexture(e){return!1}getUniforms(e=0){return{}}collectDefines(e){if(this._pluginDefineNames)for(const t of Object.keys(this._pluginDefineNames)){if("_"===t[0])continue;const i=typeof this._pluginDefineNames[t];e[t]={type:"number"===i?"number":"string"===i?"string":"boolean"===i?"boolean":"object",default:this._pluginDefineNames[t]}}}getActiveTextures(e){}isCompatible(e){return 0===e}bindForSubMesh(e,t,i,n){}};Lc([Hc()],Ig.prototype,"name",void 0),Lc([Hc()],Ig.prototype,"priority",void 0),Lc([Hc()],Ig.prototype,"resolveIncludes",void 0),Lc([Hc()],Ig.prototype,"registerForExtraEvents",void 0),rh("BABYLON.MaterialPluginBase",Ig);var xg=class extends Ym{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}},bg=class extends Ig{getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}prepareDefines(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&Cg.DetailTextureEnabled&&this._isEnabled?(em(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}isCompatible(){return!0}constructor(e,t=!0){super(e,"DetailMap",140,new xg,t),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=Am.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||this._texture&&Cg.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),tm(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&Cg.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}isReadyForSubMesh(e,t,i){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&i.getCaps().standardDerivatives&&this._texture&&Cg.DetailTextureEnabled&&!this._texture.isReady())}getSamplers(e){e.push("detailSampler")}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}getActiveTextures(e){this._texture&&e.push(this._texture)}dispose(e){e&&this._texture?.dispose()}hasTexture(e){return this._texture===e}getClassName(){return"DetailMapConfiguration"}};Lc([Vc("detailTexture"),Uc("_markAllSubMeshesAsTexturesDirty")],bg.prototype,"texture",void 0),Lc([Hc()],bg.prototype,"diffuseBlendLevel",void 0),Lc([Hc()],bg.prototype,"roughnessBlendLevel",void 0),Lc([Hc()],bg.prototype,"bumpLevel",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],bg.prototype,"normalBlendMethod",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],bg.prototype,"isEnabled",void 0);var Pg={effect:null,subMesh:null},wg=class extends Ym{setReflectionMode(e){const t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const i of t)this[i]=i===e}constructor(e){super(e),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}},Og=class e extends Gm{bindForSubMesh(t,i,n){const a=this.getScene(),s=n.materialDefines;if(!s)return;const r=n.effect;if(!r)return;this._activeEffect=r,i.getMeshUniformBuffer().bindToEffect(r,"Mesh"),i.transferToEffect(t),this._uniformBuffer.bindToEffect(r,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,i,t,this.isFrozen),this._eventInfo.subMesh=n,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),s.OBJECTSPACE_NORMALMAP&&(t.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const o=this._mustRebind(a,r,n,i.visibility);nm(i,r);const l=this._uniformBuffer;if(o){if(this.bindViewProjection(r),!l.useUbo||!this.isFrozen||!l.isSync||n._drawWrapper._forceRebindOnNextCall){if(e.FresnelEnabled&&s.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(l.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),l.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&l.updateColor4("opacityParts",new Ah(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(l.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),l.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(l.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),l.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(l.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),l.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),a.texturesEnabled){if(this._diffuseTexture&&e.DiffuseTextureEnabled&&(l.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),tm(this._diffuseTexture,l,"diffuse")),this._ambientTexture&&e.AmbientTextureEnabled&&(l.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),tm(this._ambientTexture,l,"ambient")),this._opacityTexture&&e.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),tm(this._opacityTexture,l,"opacity")),this._hasAlphaChannel()&&l.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&e.ReflectionTextureEnabled&&(l.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),l.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const e=this._reflectionTexture;l.updateVector3("vReflectionPosition",e.boundingBoxPosition),l.updateVector3("vReflectionSize",e.boundingBoxSize)}if(this._emissiveTexture&&e.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),tm(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&e.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),tm(this._lightmapTexture,l,"lightmap")),this._specularTexture&&e.SpecularTextureEnabled&&(l.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),tm(this._specularTexture,l,"specular")),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&e.BumpTextureEnabled&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),tm(this._bumpTexture,l,"bump"),a._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&e.RefractionTextureEnabled){let e=1;if(this._refractionTexture.isCube||(l.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(e=this._refractionTexture.depth)),l.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,e,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const e=this._refractionTexture;l.updateVector3("vRefractionPosition",e.boundingBoxPosition),l.updateVector3("vRefractionSize",e.boundingBoxSize)}}}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),s.SPECULARTERM&&l.updateColor4("vSpecularColor",this.specularColor,this.specularPower),l.updateColor3("vEmissiveColor",e.EmissiveTextureEnabled?this.emissiveColor:Ah.BlackReadOnly),l.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),a.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),l.updateColor3("vAmbientColor",this._globalAmbientColor)}a.texturesEnabled&&(this._diffuseTexture&&e.DiffuseTextureEnabled&&r.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&e.AmbientTextureEnabled&&r.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&e.OpacityTextureEnabled&&r.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&e.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?r.setTexture("reflectionCubeSampler",this._reflectionTexture):r.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&e.EmissiveTextureEnabled&&r.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&e.LightmapTextureEnabled&&r.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&e.SpecularTextureEnabled&&r.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&e.BumpTextureEnabled&&r.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&e.RefractionTextureEnabled&&(this._refractionTexture.isCube?r.setTexture("refractionCubeSampler",this._refractionTexture):r.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(i)&&this.getScene().depthPeelingRenderer.bind(r),this._eventInfo.subMesh=n,this._callbackPluginEventBindForSubMesh(this._eventInfo),Wd(r,this,a),this.bindEyePosition(r)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!o&&this.isFrozen||(a.lightsEnabled&&!this._disableLighting&&sm(a,i,r,s,this._maxSimultaneousLights),(a.fogEnabled&&i.applyFog&&a.fogMode!==dv.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||i.receiveShadows||s.PREPASS)&&this.bindView(r),Kd(a,i,r),s.NUM_MORPH_INFLUENCERS&&Qd(i,r),s.BAKED_VERTEX_ANIMATION_TEXTURE&&i.bakedVertexAnimationManager?.bind(r,s.INSTANCES),this.useLogarithmicDepth&&jd(s,r,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(i,this._activeEffect,n),l.update()}get isPrePassCapable(){return!this.disableDepthWrite}static Parse(t,i,n){const a=Uh.Parse((()=>new e(t.name,i)),t,i,n);return t.stencil&&a.stencil.parse(t.stencil,i,n),Am._ParsePlugins(t,a,i,n),a}static set BumpTextureEnabled(e){Cg.BumpTextureEnabled=e}static get FresnelEnabled(){return Cg.FresnelEnabled}getActiveTextures(){const e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}static set ColorGradingTextureEnabled(e){Cg.ColorGradingTextureEnabled=e}static get EmissiveTextureEnabled(){return Cg.EmissiveTextureEnabled}static get ReflectionTextureEnabled(){return Cg.ReflectionTextureEnabled}constructor(t,i,n=!1){super(t,i),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new Ah(0,0,0),this.diffuseColor=new Ah(1,1,1),this.specularColor=new Ah(1,1,1),this.emissiveColor=new Ah(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new rd(16),this._worldViewProjectionMatrix=Lh.Zero(),this._globalAmbientColor=new Ah(0,0,0),this._cacheHasRenderTargetTextures=!1,this._initShaderSourceAsync(n),this.detailMap=new bg(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new Ag,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Am.MATERIAL_ALPHATEST)}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}getAnimatables(){const e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}static set ReflectionTextureEnabled(e){Cg.ReflectionTextureEnabled=e}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Am.MATERIAL_OPAQUE}static set OpacityTextureEnabled(e){Cg.OpacityTextureEnabled=e}static set AmbientTextureEnabled(e){Cg.AmbientTextureEnabled=e}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}async _initShaderSourceAsync(t=!1){const i=this.getScene().getEngine();!i.isWebGPU||t||e.ForceGLSL?await Promise.all([Promise.resolve().then((()=>(Ss(),ps))),Promise.resolve().then((()=>(Hs(),ks)))]):(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new xd(i,void 0,void 0,this.name,!0),this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(xa(),Ta))),Promise.resolve().then((()=>($a(),Xa)))])),this._shadersLoaded=!0}static get AmbientTextureEnabled(){return Cg.AmbientTextureEnabled}static get RefractionTextureEnabled(){return Cg.RefractionTextureEnabled}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}static get DiffuseTextureEnabled(){return Cg.DiffuseTextureEnabled}getClassName(){return"StandardMaterial"}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}dispose(e,t){t&&(this._diffuseTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._specularTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._refractionTexture?.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}static get DetailTextureEnabled(){return Cg.DetailTextureEnabled}get hasRenderTargetTextures(){return!!(e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}static get ColorGradingTextureEnabled(){return Cg.ColorGradingTextureEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}isReadyForSubMesh(t,i,n=!1){if(!this._shadersLoaded)return!1;this._uniformBufferLayoutBuilt||this.buildUniformLayout();const a=i._drawWrapper;if(a.effect&&this.isFrozen&&a._wasPreviouslyReady&&a._wasPreviouslyUsingInstances===n)return!0;i.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),i.materialDefines=new wg(this._eventInfo.defineNames));const s=this.getScene(),r=i.materialDefines;if(this._isReadyForSubMesh(i))return!0;const o=s.getEngine();r._needNormals=fm(s,t,r,!0,this._maxSimultaneousLights,this._disableLighting),_m(s,r);const l=this.needAlphaBlendingForMesh(t)&&this.getScene().useOrderIndependentTransparency;if(gm(s,r,this.canRenderToMRT&&!l),vm(s,r,l),r._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,r._needUVs=!1;for(let e=1;e<=6;++e)r["MAINUV"+e]=!1;if(s.texturesEnabled){if(r.DIFFUSEDIRECTUV=0,r.BUMPDIRECTUV=0,r.AMBIENTDIRECTUV=0,r.OPACITYDIRECTUV=0,r.EMISSIVEDIRECTUV=0,r.SPECULARDIRECTUV=0,r.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&e.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;em(this._diffuseTexture,r,"DIFFUSE")}else r.DIFFUSE=!1;if(this._ambientTexture&&e.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;em(this._ambientTexture,r,"AMBIENT")}else r.AMBIENT=!1;if(this._opacityTexture&&e.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;em(this._opacityTexture,r,"OPACITY"),r.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else r.OPACITY=!1;if(this._reflectionTexture&&e.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(r._needNormals=!0,r.REFLECTION=!0,r.ROUGHNESS=this._roughness>0,r.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,r.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===yp.INVCUBIC_MODE,r.REFLECTIONMAP_3D=this._reflectionTexture.isCube,r.REFLECTIONMAP_OPPOSITEZ=r.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,r.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case yp.EXPLICIT_MODE:r.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case yp.PLANAR_MODE:r.setReflectionMode("REFLECTIONMAP_PLANAR");break;case yp.PROJECTION_MODE:r.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case yp.SKYBOX_MODE:r.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case yp.SPHERICAL_MODE:r.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case yp.EQUIRECTANGULAR_MODE:r.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case yp.FIXED_EQUIRECTANGULAR_MODE:r.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case yp.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:r.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case yp.CUBIC_MODE:case yp.INVCUBIC_MODE:default:r.setReflectionMode("REFLECTIONMAP_CUBIC")}r.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else r.REFLECTION=!1,r.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&e.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;em(this._emissiveTexture,r,"EMISSIVE")}else r.EMISSIVE=!1;if(this._lightmapTexture&&e.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;em(this._lightmapTexture,r,"LIGHTMAP"),r.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,r.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else r.LIGHTMAP=!1;if(this._specularTexture&&e.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;em(this._specularTexture,r,"SPECULAR"),r.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else r.SPECULAR=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&e.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;em(this._bumpTexture,r,"BUMP"),r.PARALLAX=this._useParallax,r.PARALLAX_RHS=s.useRightHandedSystem,r.PARALLAXOCCLUSION=this._useParallaxOcclusion,r.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else r.BUMP=!1,r.PARALLAX=!1,r.PARALLAX_RHS=!1,r.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&e.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;r._needUVs=!0,r.REFRACTION=!0,r.REFRACTIONMAP_3D=this._refractionTexture.isCube,r.RGBDREFRACTION=this._refractionTexture.isRGBD,r.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else r.REFRACTION=!1;r.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else r.DIFFUSE=!1,r.AMBIENT=!1,r.OPACITY=!1,r.REFLECTION=!1,r.EMISSIVE=!1,r.LIGHTMAP=!1,r.BUMP=!1,r.REFRACTION=!1;r.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),r.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,r.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,r.SPECULAROVERALPHA=this._useSpecularOverAlpha,r.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,r.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,r.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(t)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=r,this._eventInfo.subMesh=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(r._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(r),r.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,r.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}r._areFresnelDirty&&(e.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(r.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,r.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,r.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,r.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,r.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,r.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,r._needNormals=!0,r.FRESNEL=!0):r.FRESNEL=!1),hm(t,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(t)||this._forceAlphaTest,r,this._applyDecalMapAfterDetailMap),dm(s,o,this,r,n,null,i.getRenderingMesh().hasThinInstances),this._eventInfo.defines=r,this._eventInfo.mesh=t,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),pm(t,r,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let c=!1;if(r.isDirty){const e=r._areLightsDisposed;r.markAsProcessed();const n=new Tp;r.REFLECTION&&n.addFallback(0,"REFLECTION"),r.SPECULAR&&n.addFallback(0,"SPECULAR"),r.BUMP&&n.addFallback(0,"BUMP"),r.PARALLAX&&n.addFallback(1,"PARALLAX"),r.PARALLAX_RHS&&n.addFallback(1,"PARALLAX_RHS"),r.PARALLAXOCCLUSION&&n.addFallback(0,"PARALLAXOCCLUSION"),r.SPECULAROVERALPHA&&n.addFallback(0,"SPECULAROVERALPHA"),r.FOG&&n.addFallback(1,"FOG"),r.POINTSIZE&&n.addFallback(0,"POINTSIZE"),r.LOGARITHMICDEPTH&&n.addFallback(0,"LOGARITHMICDEPTH"),lm(r,n,this._maxSimultaneousLights),r.SPECULARTERM&&n.addFallback(0,"SPECULARTERM"),r.DIFFUSEFRESNEL&&n.addFallback(1,"DIFFUSEFRESNEL"),r.OPACITYFRESNEL&&n.addFallback(2,"OPACITYFRESNEL"),r.REFLECTIONFRESNEL&&n.addFallback(3,"REFLECTIONFRESNEL"),r.EMISSIVEFRESNEL&&n.addFallback(4,"EMISSIVEFRESNEL"),r.FRESNEL&&n.addFallback(4,"FRESNEL"),r.MULTIVIEW&&n.addFallback(0,"MULTIVIEW");const a=[$h.PositionKind];r.NORMAL&&a.push($h.NormalKind),r.TANGENT&&a.push($h.TangentKind);for(let e=1;e<=6;++e)r["UV"+e]&&a.push(`uv${1===e?"":e}`);r.VERTEXCOLOR&&a.push($h.ColorKind),rm(a,t,r,n),om(a,r),qd(a,t,r),im(a,0,r);let l="default";const h=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],f=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],u=["Material","Scene","Mesh"],d={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:r.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=n,this._eventInfo.fallbackRank=0,this._eventInfo.defines=r,this._eventInfo.uniforms=h,this._eventInfo.attributes=a,this._eventInfo.samplers=f,this._eventInfo.uniformBuffersNames=u,this._eventInfo.customCode=void 0,this._eventInfo.mesh=t,this._eventInfo.indexParameters=d,this._callbackPluginEventGeneric(128,this._eventInfo),Ag.AddUniforms(h),Ag.AddSamplers(f),I_&&(I_.PrepareUniforms(h,r),I_.PrepareSamplers(f,r)),Em({uniformsNames:h,uniformBuffersNames:u,samplers:f,defines:r,maxSimultaneousLights:this._maxSimultaneousLights}),Hd(h);const m={};this.customShaderNameResolve&&(l=this.customShaderNameResolve(l,h,u,f,r,a,m));const p=r.toString(),_=i.effect;let v=s.getEngine().createEffect(l,{attributes:a,uniformsNames:h,uniformBuffersNames:u,samplers:f,defines:p,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:d,processFinalCode:m.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:r.PREPASS,shaderLanguage:this._shaderLanguage},o);if(this._eventInfo.customCode=void 0,v)if(this._onEffectCreatedObservable&&(Pg.effect=v,Pg.subMesh=i,this._onEffectCreatedObservable.notifyObservers(Pg)),this.allowShaderHotSwapping&&_&&!v.isReady()){if(v=_,r.markAsUnprocessed(),c=this.isFrozen,e)return r._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),i.setEffect(v,r,this._materialContext)}return!(!i.effect||!i.effect.isReady())&&(r._renderId=s.getRenderId(),a._wasPreviouslyReady=!c,a._wasPreviouslyUsingInstances=n,this._checkScenePerformancePriority(),!0)}static get LightmapTextureEnabled(){return Cg.LightmapTextureEnabled}getAlphaTestTexture(){return this._diffuseTexture}static get BumpTextureEnabled(){return Cg.BumpTextureEnabled}clone(t,i=!0,n=""){const a=Uh.Clone((()=>new e(t,this.getScene())),this,{cloneTexturesOnlyOnce:i});return a.name=t,a.id=t,this.stencil.copyTo(a.stencil),this._clonePlugins(a,n),a}static set LightmapTextureEnabled(e){Cg.LightmapTextureEnabled=e}static set SpecularTextureEnabled(e){Cg.SpecularTextureEnabled=e}static set DetailTextureEnabled(e){Cg.DetailTextureEnabled=e}static set FresnelEnabled(e){Cg.FresnelEnabled=e}static set EmissiveTextureEnabled(e){Cg.EmissiveTextureEnabled=e}static set DiffuseTextureEnabled(e){Cg.DiffuseTextureEnabled=e}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}static set RefractionTextureEnabled(e){Cg.RefractionTextureEnabled=e}hasTexture(e){return!!super.hasTexture(e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}get canRenderToMRT(){return!0}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}static get SpecularTextureEnabled(){return Cg.SpecularTextureEnabled}get cameraContrast(){return this._imageProcessingConfiguration.contrast}static get OpacityTextureEnabled(){return Cg.OpacityTextureEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),super.buildUniformLayout()}};Og.ForceGLSL=!1,Lc([Vc("diffuseTexture")],Og.prototype,"_diffuseTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesAndMiscDirty")],Og.prototype,"diffuseTexture",void 0),Lc([Vc("ambientTexture")],Og.prototype,"_ambientTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"ambientTexture",void 0),Lc([Vc("opacityTexture")],Og.prototype,"_opacityTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesAndMiscDirty")],Og.prototype,"opacityTexture",void 0),Lc([Vc("reflectionTexture")],Og.prototype,"_reflectionTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"reflectionTexture",void 0),Lc([Vc("emissiveTexture")],Og.prototype,"_emissiveTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"emissiveTexture",void 0),Lc([Vc("specularTexture")],Og.prototype,"_specularTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"specularTexture",void 0),Lc([Vc("bumpTexture")],Og.prototype,"_bumpTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"bumpTexture",void 0),Lc([Vc("lightmapTexture")],Og.prototype,"_lightmapTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"lightmapTexture",void 0),Lc([Vc("refractionTexture")],Og.prototype,"_refractionTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"refractionTexture",void 0),Lc([Wc("ambient")],Og.prototype,"ambientColor",void 0),Lc([Wc("diffuse")],Og.prototype,"diffuseColor",void 0),Lc([Wc("specular")],Og.prototype,"specularColor",void 0),Lc([Wc("emissive")],Og.prototype,"emissiveColor",void 0),Lc([Hc()],Og.prototype,"specularPower",void 0),Lc([Hc("useAlphaFromDiffuseTexture")],Og.prototype,"_useAlphaFromDiffuseTexture",void 0),Lc([Uc("_markAllSubMeshesAsTexturesAndMiscDirty")],Og.prototype,"useAlphaFromDiffuseTexture",void 0),Lc([Hc("useEmissiveAsIllumination")],Og.prototype,"_useEmissiveAsIllumination",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"useEmissiveAsIllumination",void 0),Lc([Hc("linkEmissiveWithDiffuse")],Og.prototype,"_linkEmissiveWithDiffuse",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"linkEmissiveWithDiffuse",void 0),Lc([Hc("useSpecularOverAlpha")],Og.prototype,"_useSpecularOverAlpha",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"useSpecularOverAlpha",void 0),Lc([Hc("useReflectionOverAlpha")],Og.prototype,"_useReflectionOverAlpha",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"useReflectionOverAlpha",void 0),Lc([Hc("disableLighting")],Og.prototype,"_disableLighting",void 0),Lc([Uc("_markAllSubMeshesAsLightsDirty")],Og.prototype,"disableLighting",void 0),Lc([Hc("useObjectSpaceNormalMap")],Og.prototype,"_useObjectSpaceNormalMap",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"useObjectSpaceNormalMap",void 0),Lc([Hc("useParallax")],Og.prototype,"_useParallax",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"useParallax",void 0),Lc([Hc("useParallaxOcclusion")],Og.prototype,"_useParallaxOcclusion",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"useParallaxOcclusion",void 0),Lc([Hc()],Og.prototype,"parallaxScaleBias",void 0),Lc([Hc("roughness")],Og.prototype,"_roughness",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"roughness",void 0),Lc([Hc()],Og.prototype,"indexOfRefraction",void 0),Lc([Hc()],Og.prototype,"invertRefractionY",void 0),Lc([Hc()],Og.prototype,"alphaCutOff",void 0),Lc([Hc("useLightmapAsShadowmap")],Og.prototype,"_useLightmapAsShadowmap",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"useLightmapAsShadowmap",void 0),Lc([zc("diffuseFresnelParameters")],Og.prototype,"_diffuseFresnelParameters",void 0),Lc([Uc("_markAllSubMeshesAsFresnelDirty")],Og.prototype,"diffuseFresnelParameters",void 0),Lc([zc("opacityFresnelParameters")],Og.prototype,"_opacityFresnelParameters",void 0),Lc([Uc("_markAllSubMeshesAsFresnelAndMiscDirty")],Og.prototype,"opacityFresnelParameters",void 0),Lc([zc("reflectionFresnelParameters")],Og.prototype,"_reflectionFresnelParameters",void 0),Lc([Uc("_markAllSubMeshesAsFresnelDirty")],Og.prototype,"reflectionFresnelParameters",void 0),Lc([zc("refractionFresnelParameters")],Og.prototype,"_refractionFresnelParameters",void 0),Lc([Uc("_markAllSubMeshesAsFresnelDirty")],Og.prototype,"refractionFresnelParameters",void 0),Lc([zc("emissiveFresnelParameters")],Og.prototype,"_emissiveFresnelParameters",void 0),Lc([Uc("_markAllSubMeshesAsFresnelDirty")],Og.prototype,"emissiveFresnelParameters",void 0),Lc([Hc("useReflectionFresnelFromSpecular")],Og.prototype,"_useReflectionFresnelFromSpecular",void 0),Lc([Uc("_markAllSubMeshesAsFresnelDirty")],Og.prototype,"useReflectionFresnelFromSpecular",void 0),Lc([Hc("useGlossinessFromSpecularMapAlpha")],Og.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"useGlossinessFromSpecularMapAlpha",void 0),Lc([Hc("maxSimultaneousLights")],Og.prototype,"_maxSimultaneousLights",void 0),Lc([Uc("_markAllSubMeshesAsLightsDirty")],Og.prototype,"maxSimultaneousLights",void 0),Lc([Hc("invertNormalMapX")],Og.prototype,"_invertNormalMapX",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"invertNormalMapX",void 0),Lc([Hc("invertNormalMapY")],Og.prototype,"_invertNormalMapY",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"invertNormalMapY",void 0),Lc([Hc("twoSidedLighting")],Og.prototype,"_twoSidedLighting",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],Og.prototype,"twoSidedLighting",void 0),Lc([Hc("applyDecalMapAfterDetailMap")],Og.prototype,"_applyDecalMapAfterDetailMap",void 0),Lc([Uc("_markAllSubMeshesAsMiscDirty")],Og.prototype,"applyDecalMapAfterDetailMap",void 0),rh("BABYLON.StandardMaterial",Og),dv.DefaultMaterialFactory=e=>new Og("default material",e);var Dg=class{get fromIndex(){return this._fromIndex}get toIndex(){return this._toIndex}get loopAnimation(){return this._loopAnimation}constructor(){this.width=1,this.height=1,this.angle=0,this.invertU=!1,this.invertV=!1,this.isVisible=!0,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._onBaseAnimationEnd=null,this.position={x:1,y:1,z:1},this.color={r:1,g:1,b:1,a:1}}get delay(){return Math.max(this._delay,1)}get animationStarted(){return this._animationStarted}_animate(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onBaseAnimationEnd&&this._onBaseAnimationEnd()))))}stopAnimation(){this._animationStarted=!1}playAnimation(e,t,i,n,a){this._fromIndex=e,this._toIndex=t,this._loopAnimation=i,this._delay=n||1,this._animationStarted=!0,this._onBaseAnimationEnd=a,e<t?this._direction=1:(this._direction=-1,this._toIndex=e,this._fromIndex=t),this.cellIndex=e,this._time=0}},Lg=class e extends Dg{set size(e){this.width=e,this.height=e}dispose(){for(let e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1);this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}serialize(){const e={};return e.name=this.name,e.position=this.position.asArray(),e.color=this.color.asArray(),e.width=this.width,e.height=this.height,e.angle=this.angle,e.cellIndex=this.cellIndex,e.cellRef=this.cellRef,e.invertU=this.invertU,e.invertV=this.invertV,e.disposeWhenFinishedAnimating=this.disposeWhenFinishedAnimating,e.isPickable=this.isPickable,e.isVisible=this.isVisible,e.useAlphaForPicking=this.useAlphaForPicking,e.animationStarted=this.animationStarted,e.fromIndex=this.fromIndex,e.toIndex=this.toIndex,e.loopAnimation=this.loopAnimation,e.delay=this.delay,e}getClassName(){return"Sprite"}get fromIndex(){return this._fromIndex}get delay(){return Math.max(this._delay,1)}set toIndex(e){this.playAnimation(this._fromIndex,e,this._loopAnimation,this._delay,this._onAnimationEnd)}set loopAnimation(e){this.playAnimation(this._fromIndex,this._toIndex,e,this._delay,this._onAnimationEnd)}set delay(e){this.playAnimation(this._fromIndex,this._toIndex,this._loopAnimation,e,this._onAnimationEnd)}get size(){return this.width}set fromIndex(e){this.playAnimation(e,this._toIndex,this._loopAnimation,this._delay,this._onAnimationEnd)}playAnimation(e,t,i,n,a=null){this._onAnimationEnd=a,super.playAnimation(e,t,i,n,this._endAnimation)}get loopAnimation(){return this._loopAnimation}get toIndex(){return this._toIndex}static Parse(t,i){const n=new e(t.name,i);return n.position=wh.FromArray(t.position),n.color=Ch.FromArray(t.color),n.width=t.width,n.height=t.height,n.angle=t.angle,n.cellIndex=t.cellIndex,n.cellRef=t.cellRef,n.invertU=t.invertU,n.invertV=t.invertV,n.disposeWhenFinishedAnimating=t.disposeWhenFinishedAnimating,n.isPickable=t.isPickable,n.isVisible=t.isVisible,n.useAlphaForPicking=t.useAlphaForPicking,n._fromIndex=t.fromIndex,n._toIndex=t.toIndex,n._loopAnimation=t.loopAnimation,n._delay=t.delay,t.animationStarted&&n.playAnimation(n.fromIndex,n.toIndex,n.loopAnimation,n.delay),n}constructor(e,t){super(),this.name=e,this.animations=new Array,this.isPickable=!1,this.useAlphaForPicking=!1,this.onDisposeObservable=new Ih,this._onAnimationEnd=null,this._endAnimation=()=>{this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()},this.color=new Ch(1,1,1,1),this.position=wh.Zero(),this._manager=t,this._manager.sprites.push(this),this.xt=this._manager.scene.getUniqueId()}get manager(){return this._manager}},Fg=class e{intersectsAxis(e,t=0){switch(e){case"y":{const e=(this.origin.y-t)/this.direction.y;return e>0?null:new wh(this.origin.x+this.direction.x*-e,t,this.origin.z+this.direction.z*-e)}case"x":{const e=(this.origin.x-t)/this.direction.x;return e>0?null:new wh(t,this.origin.y+this.direction.y*-e,this.origin.z+this.direction.z*-e)}case"z":{const e=(this.origin.z-t)/this.direction.z;return e>0?null:new wh(this.origin.x+this.direction.x*-e,this.origin.y+this.direction.y*-e,t)}default:return null}}unprojectRayToRef(e,t,i,n,a,s,r){const o=kh.Matrix[0];a.multiplyToRef(s,o),o.multiplyToRef(r,o),o.invert();const l=xh.LastCreatedEngine,c=kh.Vector3[0];c.x=e/i*2-1,c.y=-(t/n*2-1),c.z=l?.useReverseDepthBuffer?1:l?.isNDCHalfZRange?0:-1;const h=kh.Vector3[1].copyFromFloats(c.x,c.y,1-1e-8),f=kh.Vector3[2],u=kh.Vector3[3];wh._UnprojectFromInvertedMatrixToRef(c,o,f),wh._UnprojectFromInvertedMatrixToRef(h,o,u),this.origin.copyFrom(f),u.subtractToRef(f,this.direction),this.direction.normalize()}intersectionSegment(t,i,n){const a=this.origin,s=kh.Vector3[0],r=kh.Vector3[1],o=kh.Vector3[2],l=kh.Vector3[3];i.subtractToRef(t,s),this.direction.scaleToRef(e._Rayl,o),a.addToRef(o,r),t.subtractToRef(a,l);const c=wh.Dot(s,s),h=wh.Dot(s,o),f=wh.Dot(o,o),u=wh.Dot(s,l),d=wh.Dot(o,l),m=c*f-h*h;let p,_,v=m,g=m;m<e._Smallnum?(p=0,v=1,_=d,g=f):(p=h*d-f*u,_=c*d-h*u,p<0?(p=0,_=d,g=f):p>v&&(p=v,_=d+h,g=f)),_<0?(_=0,-u<0?p=0:-u>c?p=v:(p=-u,v=c)):_>g&&(_=g,-u+h<0?p=0:-u+h>c?p=v:(p=-u+h,v=c));const S=Math.abs(p)<e._Smallnum?0:p/v,y=Math.abs(_)<e._Smallnum?0:_/g,E=kh.Vector3[4];o.scaleToRef(y,E);const A=kh.Vector3[5];s.scaleToRef(S,A),A.addInPlace(l);const C=kh.Vector3[6];A.subtractToRef(E,C);return y>0&&y<=this.length&&C.lengthSquared()<n*n?A.length():-1}static CreateNew(t,i,n,a,s,r,o){return e.Zero().update(t,i,n,a,s,r,o)}static Transform(t,i){const n=new e(new wh(0,0,0),new wh(0,0,0));return e.TransformToRef(t,i,n),n}intersectsTriangle(t,i,n){const a=e._TmpVector3[0],s=e._TmpVector3[1],r=e._TmpVector3[2],o=e._TmpVector3[3],l=e._TmpVector3[4];i.subtractToRef(t,a),n.subtractToRef(t,s),wh.CrossToRef(this.direction,s,r);const c=wh.Dot(a,r);if(0===c)return null;const h=1/c;this.origin.subtractToRef(t,o);const f=wh.Dot(o,r)*h;if(f<-this.epsilon||f>1+this.epsilon)return null;wh.CrossToRef(o,a,l);const u=wh.Dot(this.direction,l)*h;if(u<-this.epsilon||f+u>1+this.epsilon)return null;const d=wh.Dot(s,l)*h;return d>this.length?null:new nf(1-f-u,f,d)}update(t,i,n,a,s,r,o,l=!1){if(l){e._RayDistant||(e._RayDistant=e.Zero()),e._RayDistant.unprojectRayToRef(t,i,n,a,Lh.IdentityReadOnly,r,o);const l=kh.Matrix[0];s.invertToRef(l),e.TransformToRef(e._RayDistant,l,this)}else this.unprojectRayToRef(t,i,n,a,s,r,o);return this}intersectsMeshes(e,t,i){i?i.length=0:i=[];for(let n=0;n<e.length;n++){const a=this.intersectsMesh(e[n],t);a.hit&&i.push(a)}return i.sort(this._comparePickingInfo),i}clone(){return new e(this.origin.clone(),this.direction.clone(),this.length)}constructor(e,t,i=Number.MAX_VALUE,n=hh){this.origin=e,this.direction=t,this.length=i,this.epsilon=n}intersectsSphere(e,t=0){const i=e.center.x-this.origin.x,n=e.center.y-this.origin.y,a=e.center.z-this.origin.z,s=i*i+n*n+a*a,r=e.radius+t,o=r*r;if(s<=o)return!0;const l=i*this.direction.x+n*this.direction.y+a*this.direction.z;if(l<0)return!1;return s-l*l<=o}_comparePickingInfo(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}intersectsBox(e,t=0){return this.intersectsBoxMinMax(e.minimum,e.maximum,t)}intersectsMesh(t,i,n,a=!1,s,r=!1){const o=kh.Matrix[0];return t.getWorldMatrix().invertToRef(o),this._tmpRay?e.TransformToRef(this,o,this._tmpRay):this._tmpRay=e.Transform(this,o),t.intersects(this._tmpRay,i,n,a,s,r)}static CreateNewFromTo(t,i,n=Lh.IdentityReadOnly){const a=new e(new wh(0,0,0),new wh(0,0,0));return e.CreateFromToToRef(t,i,a,n)}static CreateFromToToRef(t,i,n,a=Lh.IdentityReadOnly){n.origin.copyFrom(t);const s=i.subtractToRef(t,n.direction),r=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return n.length=r,n.direction.normalize(),e.TransformToRef(n,a,n)}static Zero(){return new e(wh.Zero(),wh.Zero())}intersectsBoxMinMax(t,i,n=0){const a=e._TmpVector3[0].copyFromFloats(t.x-n,t.y-n,t.z-n),s=e._TmpVector3[1].copyFromFloats(i.x+n,i.y+n,i.z+n);let r,o,l,c,h=0,f=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<a.x||this.origin.x>s.x)return!1}else if(r=1/this.direction.x,o=(a.x-this.origin.x)*r,l=(s.x-this.origin.x)*r,l===-1/0&&(l=1/0),o>l&&(c=o,o=l,l=c),h=Math.max(o,h),f=Math.min(l,f),h>f)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<a.y||this.origin.y>s.y)return!1}else if(r=1/this.direction.y,o=(a.y-this.origin.y)*r,l=(s.y-this.origin.y)*r,l===-1/0&&(l=1/0),o>l&&(c=o,o=l,l=c),h=Math.max(o,h),f=Math.min(l,f),h>f)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<a.z||this.origin.z>s.z)return!1}else if(r=1/this.direction.z,o=(a.z-this.origin.z)*r,l=(s.z-this.origin.z)*r,l===-1/0&&(l=1/0),o>l&&(c=o,o=l,l=c),h=Math.max(o,h),f=Math.min(l,f),h>f)return!1;return!0}static TransformToRef(e,t,i){wh.TransformCoordinatesToRef(e.origin,t,i.origin),wh.TransformNormalToRef(e.direction,t,i.direction),i.length=e.length,i.epsilon=e.epsilon;const n=i.direction,a=n.length();if(0!==a&&1!==a){const e=1/a;n.x*=e,n.y*=e,n.z*=e,i.length*=a}return i}intersectsPlane(e){let t;const i=wh.Dot(e.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const n=wh.Dot(e.normal,this.origin);return t=(-e.d-n)/i,t<0?t<-9.99999997475243e-7?null:0:t}}};Fg._TmpVector3=th(6,wh.Zero),Fg._RayDistant=Fg.Zero(),Fg._Smallnum=1e-8,Fg._Rayl=1e9,dv.prototype.createPickingRay=function(e,t,i,n,a=!1){const s=Fg.Zero();return this.createPickingRayToRef(e,t,i,s,n,a),s},dv.prototype.createPickingRayToRef=function(e,t,i,n,a,s=!1,r=!1){const o=this.getEngine();if(!a&&!(a=this.activeCamera))return this;const l=a.viewport,c=o.getRenderHeight(),{x:h,y:f,width:u,height:d}=l.toGlobal(o.getRenderWidth(),c),m=1/o.getHardwareScalingLevel();return e=e*m-h,t=t*m-(c-f-d),n.update(e,t,u,d,i||Lh.IdentityReadOnly,s?Lh.IdentityReadOnly:a.getViewMatrix(),a.getProjectionMatrix(),r),this},dv.prototype.createPickingRayInCameraSpace=function(e,t,i){const n=Fg.Zero();return this.createPickingRayInCameraSpaceToRef(e,t,n,i),n},dv.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,n){if(!Id)return this;const a=this.getEngine();if(!n&&!(n=this.activeCamera))throw new Error("Active camera not set");const s=n.viewport,r=a.getRenderHeight(),{x:o,y:l,width:c,height:h}=s.toGlobal(a.getRenderWidth(),r),f=Lh.Identity(),u=1/a.getHardwareScalingLevel();return e=e*u-o,t=t*u-(r-l-h),i.update(e,t,c,h,f,f,n.getProjectionMatrix()),this},dv.prototype._internalPickForMesh=function(e,t,i,n,a,s,r,o){const l=t(n,i.enableDistantPicking),c=i.intersects(l,a,r,s,n,o);return c&&c.hit?!a&&null!=e&&c.distance>=e.distance?null:c:null},dv.prototype._internalPick=function(e,t,i,n,a){let s=null;const r=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),o=this.cameraToUseForPointers||this.activeCamera;for(let l=0;l<this.meshes.length;l++){const c=this.meshes[l];if(t){if(!t(c))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;const h=r&&c.isWorldMatrixCameraDependent(),f=c.computeWorldMatrix(h,o);if(c.hasThinInstances&&c.thinInstanceEnablePicking){const t=this._internalPickForMesh(s,e,c,f,!0,!0,a);if(t){if(n)return t;const r=kh.Matrix[1],o=c.thinInstanceGetWorldMatrices();for(let t=0;t<o.length;t++){o[t].multiplyToRef(f,r);const l=this._internalPickForMesh(s,e,c,r,i,n,a,!0);if(l&&(s=l,s.thinInstanceIndex=t,i))return s}}}else{const t=this._internalPickForMesh(s,e,c,f,i,n,a);if(t&&(s=t,i))return s}}return s||new Id},dv.prototype._internalMultiPick=function(e,t,i){if(!Id)return null;const n=[],a=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),s=this.cameraToUseForPointers||this.activeCamera;for(let r=0;r<this.meshes.length;r++){const o=this.meshes[r];if(t){if(!t(o))continue}else if(!o.isEnabled()||!o.isVisible||!o.isPickable)continue;const l=a&&o.isWorldMatrixCameraDependent(),c=o.computeWorldMatrix(l,s);if(o.hasThinInstances&&o.thinInstanceEnablePicking){if(this._internalPickForMesh(null,e,o,c,!0,!0,i)){const t=kh.Matrix[1],a=o.thinInstanceGetWorldMatrices();for(let s=0;s<a.length;s++){a[s].multiplyToRef(c,t);const r=this._internalPickForMesh(null,e,o,t,!1,!1,i,!0);r&&(r.thinInstanceIndex=s,n.push(r))}}}else{const t=this._internalPickForMesh(null,e,o,c,!1,!1,i);t&&n.push(t)}}return n},dv.prototype.pickWithBoundingInfo=function(e,t,i,n,a){if(!Id)return null;const s=this._internalPick((i=>(this._tempPickingRay||(this._tempPickingRay=Fg.Zero()),this.createPickingRayToRef(e,t,i,this._tempPickingRay,a||null),this._tempPickingRay)),i,n,!0);return s&&(s.ray=this.createPickingRay(e,t,Lh.Identity(),a||null)),s},Object.defineProperty(dv.prototype,"_pickingAvailable",{get:()=>!0,enumerable:!1,configurable:!1}),dv.prototype.pick=function(e,t,i,n,a,s,r=!1){const o=this._internalPick(((i,n)=>(this._tempPickingRay||(this._tempPickingRay=Fg.Zero()),this.createPickingRayToRef(e,t,i,this._tempPickingRay,a||null,!1,n),this._tempPickingRay)),i,n,!1,s);return o&&(o.ray=this.createPickingRay(e,t,Lh.Identity(),a||null)),o},dv.prototype.pickWithRay=function(e,t,i,n){const a=this._internalPick((t=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=Lh.Identity()),t.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=Fg.Zero()),Fg.TransformToRef(e,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),t,i,!1,n);return a&&(a.ray=e),a},dv.prototype.multiPick=function(e,t,i,n,a){return this._internalMultiPick((i=>this.createPickingRay(e,t,i,n||null)),i,a)},dv.prototype.multiPickWithRay=function(e,t,i){return this._internalMultiPick((t=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=Lh.Identity()),t.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=Fg.Zero()),Fg.TransformToRef(e,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),t,i)},fd.prototype.getForwardRay=function(e=100,t,i){return this.getForwardRayToRef(new Fg(wh.Zero(),wh.Zero(),e),e,t,i)},fd.prototype.getForwardRayToRef=function(e,t=100,i,n){i||(i=this.getWorldMatrix()),e.length=t,n?e.origin.copyFrom(n):e.origin.copyFrom(this.position);const a=kh.Vector3[2];a.set(0,0,this._scene.useRightHandedSystem?-1:1);const s=kh.Vector3[3];return wh.TransformNormalToRef(a,i,s),wh.NormalizeToRef(s,e.direction),e},dv.prototype._internalPickSprites=function(e,t,i,n){if(!Id)return null;let a=null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}if(this.spriteManagers&&this.spriteManagers.length>0)for(let s=0;s<this.spriteManagers.length;s++){const r=this.spriteManagers[s];if(!r.isPickable)continue;const o=r.intersects(e,n,t,i);if(o&&o.hit&&((i||null==a||!(o.distance>=a.distance))&&(a=o,i)))break}return a||new Id},dv.prototype._internalMultiPickSprites=function(e,t,i){if(!Id)return null;let n=[];if(!i){if(!this.activeCamera)return null;i=this.activeCamera}if(this.spriteManagers&&this.spriteManagers.length>0)for(let a=0;a<this.spriteManagers.length;a++){const s=this.spriteManagers[a];if(!s.isPickable)continue;const r=s.multiIntersects(e,i,t);null!==r&&(n=n.concat(r))}return n},dv.prototype.pickSprite=function(e,t,i,n,a){if(!this._tempSpritePickingRay)return null;this.createPickingRayInCameraSpaceToRef(e,t,this._tempSpritePickingRay,a);const s=this._internalPickSprites(this._tempSpritePickingRay,i,n,a);return s&&(s.ray=this.createPickingRayInCameraSpace(e,t,a)),s},dv.prototype.pickSpriteWithRay=function(e,t,i,n){if(!this._tempSpritePickingRay)return null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}Fg.TransformToRef(e,n.getViewMatrix(),this._tempSpritePickingRay);const a=this._internalPickSprites(this._tempSpritePickingRay,t,i,n);return a&&(a.ray=e),a},dv.prototype.multiPickSprite=function(e,t,i,n){return this.createPickingRayInCameraSpaceToRef(e,t,this._tempSpritePickingRay,n),this._internalMultiPickSprites(this._tempSpritePickingRay,i,n)},dv.prototype.multiPickSpriteWithRay=function(e,t,i){if(!this._tempSpritePickingRay)return null;if(!i){if(!this.activeCamera)return null;i=this.activeCamera}return Fg.TransformToRef(e,i.getViewMatrix(),this._tempSpritePickingRay),this._internalMultiPickSprites(this._tempSpritePickingRay,t,i)},dv.prototype.setPointerOverSprite=function(e){this._pointerOverSprite!==e&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(10,x_.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=e,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(9,x_.CreateNewFromSprite(this._pointerOverSprite,this)))},dv.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var kg=class{_pickSpriteButKeepRay(e,t,i,n,a){const s=this.scene.pickSprite(t,i,this._spritePredicate,n,a);return s&&(s.ray=e?e.ray:null),s}constructor(e){this.name=Rm.NAME_SPRITE,this.scene=e,this.scene.spriteManagers=[],this.scene._tempSpritePickingRay=Fg?Fg.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new Ih,this.scene.onAfterSpritesRenderingObservable=new Ih,this._spritePredicate=e=>!!e.actionManager&&(e.isPickable&&e.actionManager.hasPointerTriggers)}register(){this.scene._pointerMoveStage.registerStep(Rm.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(Rm.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(Rm.STEP_POINTERUP_SPRITE,this,this._pointerUp)}_pointerDown(e,t,i,n){const a=this.scene;if(a._pickedDownSprite=null,a.spriteManagers&&a.spriteManagers.length>0&&(i=a.pickSprite(e,t,this._spritePredicate,!1,a.cameraToUseForPointers||void 0))&&i.hit&&i.pickedSprite&&i.pickedSprite.actionManager){switch(a._pickedDownSprite=i.pickedSprite,n.button){case 0:i.pickedSprite.actionManager.processTrigger(2,x_.CreateNewFromSprite(i.pickedSprite,a,n));break;case 1:i.pickedSprite.actionManager.processTrigger(4,x_.CreateNewFromSprite(i.pickedSprite,a,n));break;case 2:i.pickedSprite.actionManager.processTrigger(3,x_.CreateNewFromSprite(i.pickedSprite,a,n))}i.pickedSprite.actionManager&&i.pickedSprite.actionManager.processTrigger(5,x_.CreateNewFromSprite(i.pickedSprite,a,n))}return i}rebuild(){}dispose(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();const e=this.scene.spriteManagers;if(e)for(;e.length;)e[0].dispose()}_pointerMove(e,t,i,n,a){const s=this.scene;return n?s.setPointerOverSprite(null):(i=this._pickSpriteButKeepRay(i,e,t,!1,s.cameraToUseForPointers||void 0))&&i.hit&&i.pickedSprite?(s.setPointerOverSprite(i.pickedSprite),!s.doNotHandleCursors&&a&&(s._pointerOverSprite&&s._pointerOverSprite.actionManager&&s._pointerOverSprite.actionManager.hoverCursor?a.style.cursor=s._pointerOverSprite.actionManager.hoverCursor:a.style.cursor=s.hoverCursor)):s.setPointerOverSprite(null),i}_pointerUp(e,t,i,n,a){const s=this.scene;if(s.spriteManagers&&s.spriteManagers.length>0){const i=s.pickSprite(e,t,this._spritePredicate,!1,s.cameraToUseForPointers||void 0);i&&(i.hit&&i.pickedSprite&&i.pickedSprite.actionManager&&(i.pickedSprite.actionManager.processTrigger(7,x_.CreateNewFromSprite(i.pickedSprite,s,n)),i.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||i.pickedSprite.actionManager.processTrigger(1,x_.CreateNewFromSprite(i.pickedSprite,s,n)),a&&i.pickedSprite.actionManager.processTrigger(6,x_.CreateNewFromSprite(i.pickedSprite,s,n)))),s._pickedDownSprite&&s._pickedDownSprite.actionManager&&s._pickedDownSprite!==i.pickedSprite&&s._pickedDownSprite.actionManager.processTrigger(16,x_.CreateNewFromSprite(s._pickedDownSprite,s,n)))}return i}},Bg=class e{constructor(e,t,i=.01,n=null){this.blendMode=2,this.autoResetAlpha=!0,this.disableDepthWrite=!1,this._fogEnabled=!0,this._pixelPerfect=!1,this._shaderLanguage=0,this._useVAO=!1,this._useInstancing=!1,this._vertexBuffers={},this._shadersLoaded=!1,this._capacity=t,this._epsilon=i,this._engine=e,this._useInstancing=e.getCaps().instancedArrays&&e._features.supportSpriteInstancing,this._useVAO=e.getCaps().vertexArrayObject&&!e.disableVertexArrayObjects,this._scene=n,this._useInstancing||this._buildIndexBuffer(),this._vertexBufferSize=this._useInstancing?16:18,this._vertexData=new Float32Array(t*this._vertexBufferSize*(this._useInstancing?1:4)),this._buffer=new Kh(e,this._vertexData,!0,this._vertexBufferSize);const a=this._buffer.createVertexBuffer($h.PositionKind,0,4,this._vertexBufferSize,this._useInstancing),s=this._buffer.createVertexBuffer("options",4,2,this._vertexBufferSize,this._useInstancing);let r,o=6;if(this._useInstancing){const t=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Kh(e,t,!1,2),r=this._spriteBuffer.createVertexBuffer("offsets",0,2)}else r=this._buffer.createVertexBuffer("offsets",o,2,this._vertexBufferSize,this._useInstancing),o+=2;const l=this._buffer.createVertexBuffer("inverts",o,2,this._vertexBufferSize,this._useInstancing),c=this._buffer.createVertexBuffer("cellInfo",o+2,4,this._vertexBufferSize,this._useInstancing),h=this._buffer.createVertexBuffer($h.ColorKind,o+6,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[$h.PositionKind]=a,this._vertexBuffers.options=s,this._vertexBuffers.offsets=r,this._vertexBuffers.inverts=l,this._vertexBuffers.cellInfo=c,this._vertexBuffers[$h.ColorKind]=h,this._initShaderSourceAsync()}get shaderLanguage(){return this._shaderLanguage}async _initShaderSourceAsync(){this._engine.isWebGPU&&!e.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(Ys(),Vs))),Promise.resolve().then((()=>(Qs(),Ks)))])):await Promise.all([Promise.resolve().then((()=>(nr(),Zs))),Promise.resolve().then((()=>(cr(),sr)))]),this._shadersLoaded=!0,this._createEffects()}get pixelPerfect(){return this._pixelPerfect}_createEffects(){this._drawWrapperBase?.dispose(),this._drawWrapperDepth?.dispose(),this._drawWrapperBase=new df(this._engine),this._drawWrapperDepth=new df(this._engine,!1),this._drawWrapperBase.drawContext&&(this._drawWrapperBase.drawContext.useInstancing=this._useInstancing),this._drawWrapperDepth.drawContext&&(this._drawWrapperDepth.drawContext.useInstancing=this._useInstancing);let e="";this._pixelPerfect&&(e+="#define PIXEL_PERFECT\n"),this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode&&this._fogEnabled&&(e+="#define FOG\n"),this._useLogarithmicDepth&&(e+="#define LOGARITHMICDEPTH\n"),this._drawWrapperBase.effect=this._engine.createEffect("sprites",[$h.PositionKind,"options","offsets","inverts","cellInfo",$h.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor","logarithmicDepthConstant"],["diffuseSampler"],e,void 0,void 0,void 0,void 0,this._shaderLanguage),this._drawWrapperDepth.effect=this._drawWrapperBase.effect,this._drawWrapperDepth.materialContext=this._drawWrapperBase.materialContext}_buildIndexBuffer(){const e=[];let t=0;for(let i=0;i<this._capacity;i++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._engine.createIndexBuffer(e)}set useLogarithmicDepth(e){const t=!!this._scene?.getEngine().getCaps().fragmentDepthSupported;e&&!t&&jh.Warn("Logarithmic depth has been requested for a sprite renderer on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._createEffects()}get fogEnabled(){return this._fogEnabled}get St(){return this._capacity}render(e,t,i,n,a=null){if(!(this._shadersLoaded&&this.texture&&this.texture.isReady()&&e.length))return;const s=this._drawWrapperBase,r=this._drawWrapperDepth,o=this.fogEnabled&&this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode,l=s.effect;if(!l.isReady())return;const c=this._engine,h=!(!this._scene||!this._scene.useRightHandedSystem),f=this.texture.getBaseSize(),u=Math.min(this._capacity,e.length);let d=0,m=!0;for(let i=0;i<u;i++){const n=e[i];n&&n.isVisible&&(m=!1,n._animate(t),this._appendSpriteVertex(d++,n,0,0,f,h,a),this._useInstancing||(this._appendSpriteVertex(d++,n,1,0,f,h,a),this._appendSpriteVertex(d++,n,1,1,f,h,a),this._appendSpriteVertex(d++,n,0,1,f,h,a)))}if(m)return;this._buffer.update(this._vertexData);const p=!!c.depthCullingState.cull,_=c.depthCullingState.zOffset,v=c.depthCullingState.zOffsetUnits;if(c.setState(p,_,!1,!1,void 0,void 0,v),c.enableEffect(s),l.setTexture("diffuseSampler",this.texture),l.setMatrix("view",i),l.setMatrix("projection",n),o){const e=this._scene;l.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),l.setColor3("vFogColor",e.fogColor)}this.useLogarithmicDepth&&this._scene&&jd(s.defines,l,this._scene),this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=c.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,l)),c.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):c.bindBuffers(this._vertexBuffers,this._indexBuffer,l),c.depthCullingState.depthFunc=c.useReverseDepthBuffer?518:515,this.disableDepthWrite||(l.setBool("alphaTest",!0),c.setColorWrite(!1),c.enableEffect(r),this._useInstancing?c.drawArraysType(7,0,4,d):c.drawElementsType(0,0,d/4*6),c.enableEffect(s),c.setColorWrite(!0),l.setBool("alphaTest",!1)),c.setAlphaMode(this.blendMode),this._useInstancing?c.drawArraysType(7,0,4,d):c.drawElementsType(0,0,d/4*6),this.autoResetAlpha&&c.setAlphaMode(0),h&&this._scene.getEngine().setState(p,_,!1,!0,void 0,void 0,v),c.unbindInstanceAttributes()}_appendSpriteVertex(e,t,i,n,a,s,r){let o=e*this._vertexBufferSize;if(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),r)r(t,a);else{t.cellIndex||(t.cellIndex=0);const e=a.width/this.cellWidth,i=t.cellIndex/e>>0;t._xOffset=(t.cellIndex-i*e)*this.cellWidth/a.width,t._yOffset=i*this.cellHeight/a.height,t._xSize=this.cellWidth,t._ySize=this.cellHeight}this._vertexData[o]=t.position.x,this._vertexData[o+1]=t.position.y,this._vertexData[o+2]=t.position.z,this._vertexData[o+3]=t.angle,this._vertexData[o+4]=t.width,this._vertexData[o+5]=t.height,this._useInstancing?o-=2:(this._vertexData[o+6]=i,this._vertexData[o+7]=n),this._vertexData[o+8]=s?t.invertU?0:1:t.invertU?1:0,this._vertexData[o+9]=t.invertV?1:0,this._vertexData[o+10]=t._xOffset,this._vertexData[o+11]=t._yOffset,this._vertexData[o+12]=t._xSize/a.width,this._vertexData[o+13]=t._ySize/a.height,this._vertexData[o+14]=t.color.r,this._vertexData[o+15]=t.color.g,this._vertexData[o+16]=t.color.b,this._vertexData[o+17]=t.color.a}rebuild(){this._indexBuffer&&this._buildIndexBuffer(),this._useVAO&&(this._vertexArrayObject=void 0),this._buffer._rebuild();for(const e in this._vertexBuffers){this._vertexBuffers[e]._rebuild()}this._spriteBuffer?._rebuild()}set pixelPerfect(e){this._pixelPerfect!==e&&(this._pixelPerfect=e,this._createEffects())}get useLogarithmicDepth(){return this._useLogarithmicDepth}dispose(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this.texture&&(this.texture.dispose(),this.texture=null),this._drawWrapperBase.dispose(),this._drawWrapperDepth.dispose()}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this._createEffects())}};Bg.ForceGLSL=!1;var Gg=class e{set useLogarithmicDepth(e){this._spriteRenderer.useLogarithmicDepth=e}get disableDepthWrite(){return this._disableDepthWrite}_makePacked(e,t){if(null!==t)try{let e;if(e="string"==typeof t?JSON.parse(t):t,e.frames.length){const t={};for(let i=0;i<e.frames.length;i++){const n=e.frames[i];if("string"!=typeof Object.keys(n)[0])throw new Error("Invalid JSON Format.  Check the frame values and make sure the name is the first parameter.");t[n[Object.keys(n)[0]]]=n}e.frames=t}const i=Reflect.ownKeys(e.frames);this._spriteMap=i,this._packedAndReady=!0,this._cellData=e.frames}catch(e){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON from string. Spritesheet managed with constant cell size.")}else{const t=/\./g;let i;do{i=t.lastIndex,t.test(e)}while(t.lastIndex>0);const n=e.substring(0,i-1)+".json",a=()=>{jh.Error("JSON ERROR: Unable to load JSON file."),this._fromPacked=!1,this._packedAndReady=!1},s=e=>{try{const t=JSON.parse(e),i=Reflect.ownKeys(t.frames);this._spriteMap=i,this._packedAndReady=!0,this._cellData=t.frames}catch(e){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON format. Please check documentation for format specifications.")}};ad.LoadFile(n,s,void 0,void 0,!1,a)}}get texture(){return this._spriteRenderer.texture}serialize(e=!1){const t={};t.name=this.name,t.St=this.St,t.cellWidth=this.cellWidth,t.cellHeight=this.cellHeight,t.fogEnabled=this.fogEnabled,t.blendMode=this.blendMode,t.disableDepthWrite=this.disableDepthWrite,t.pixelPerfect=this.pixelPerfect,t.useLogarithmicDepth=this.useLogarithmicDepth,this.texture&&(e?t.texture=this.texture.serialize():(t.textureUrl=this.texture.name,t.invertY=this.texture._invertY)),t.sprites=[];for(const e of this.sprites)t.sprites.push(e.serialize());return t.metadata=this.metadata,t}get scene(){return this._scene}set fogEnabled(e){this._spriteRenderer.fogEnabled=e}get useLogarithmicDepth(){return this._spriteRenderer.useLogarithmicDepth}getClassName(){return"SpriteManager"}rebuild(){this._spriteRenderer?.rebuild()}set cellHeight(e){this._spriteRenderer.cellHeight=e}static Parse(t,i,n){const a=new e(t.name,"",t.St,{width:t.cellWidth,height:t.cellHeight},i);void 0!==t.fogEnabled&&(a.fogEnabled=t.fogEnabled),void 0!==t.blendMode&&(a.blendMode=t.blendMode),void 0!==t.disableDepthWrite&&(a.disableDepthWrite=t.disableDepthWrite),void 0!==t.pixelPerfect&&(a.pixelPerfect=t.pixelPerfect),void 0!==t.useLogarithmicDepth&&(a.useLogarithmicDepth=t.useLogarithmicDepth),void 0!==t.metadata&&(a.metadata=t.metadata),t.texture?a.texture=yp.Parse(t.texture,i,n):t.textureName&&(a.texture=new yp(n+t.textureUrl,i,!1,void 0===t.invertY||t.invertY));for(const e of t.sprites)Lg.Parse(e,a);return a}get cellWidth(){return this._spriteRenderer.cellWidth}set cellWidth(e){this._spriteRenderer.cellWidth=e}set pixelPerfect(e){this._spriteRenderer.pixelPerfect=e,e&&3!==this.texture.samplingMode&&this.texture.updateSamplingMode(3)}multiIntersects(e,t,i){const n=Math.min(this.St,this.sprites.length),a=wh.Zero(),s=wh.Zero();let r;const o=[],l=kh.Vector3[0].copyFromFloats(0,0,0),c=kh.Vector3[1].copyFromFloats(0,0,0),h=t.getViewMatrix();for(let t=0;t<n;t++){const n=this.sprites[t];if(n){if(i){if(!i(n))continue}else if(!n.isPickable)continue;if(wh.TransformCoordinatesToRef(n.position,h,c),a.copyFromFloats(c.x-n.width/2,c.y-n.height/2,c.z),s.copyFromFloats(c.x+n.width/2,c.y+n.height/2,c.z),e.intersectsBoxMinMax(a,s)){if(r=wh.Distance(c,e.origin),!this._checkTextureAlpha(n,e,r,a,s))continue;const t=new Id;o.push(t),h.invertToRef(kh.Matrix[0]),t.hit=!0,t.pickedSprite=n,t.distance=r;const i=kh.Vector3[2];i.copyFrom(e.direction),i.normalize(),i.scaleInPlace(r),e.origin.addToRef(i,l),t.pickedPoint=wh.TransformCoordinates(l,kh.Matrix[0])}}}return o}set blendMode(e){this._spriteRenderer.blendMode=e}constructor(e,t,i,n,a,s=.01,r=yp.TRILINEAR_SAMPLINGMODE,o=!1,l=null){this.name=e,this.sprites=[],this.Ct=0,this.layerMask=268435455,this.isPickable=!1,this.metadata=null,this._wasDispatched=!1,this.onDisposeObservable=new Ih,this._disableDepthWrite=!1,this._packedAndReady=!1,this._customUpdate=(e,t)=>{e.cellRef||(e.cellIndex=0);const i=e.cellIndex;"number"==typeof i&&isFinite(i)&&Math.floor(i)===i&&(e.cellRef=this._spriteMap[e.cellIndex]),e._xOffset=this._cellData[e.cellRef].frame.x/t.width,e._yOffset=this._cellData[e.cellRef].frame.y/t.height,e._xSize=this._cellData[e.cellRef].frame.w,e._ySize=this._cellData[e.cellRef].frame.h},a||(a=xh.LastCreatedScene),a._getComponent(Rm.NAME_SPRITE)||a._addComponent(new kg(a)),this._fromPacked=o,this._scene=a;const c=this._scene.getEngine();if(this._spriteRenderer=new Bg(c,i,s,a),n.width&&n.height)this.cellWidth=n.width,this.cellHeight=n.height;else{if(void 0===n)return void(this._spriteRenderer=null);this.cellWidth=n,this.cellHeight=n}this._scene.spriteManagers&&this._scene.spriteManagers.push(this),this.xt=this.scene.getUniqueId(),t&&(this.texture=new yp(t,a,!0,!1,r)),this._fromPacked&&this._makePacked(t,l)}get St(){return this._spriteRenderer.St}_checkTextureAlpha(e,t,i,n,a){if(!e.useAlphaForPicking||!this.texture)return!0;const s=this.texture.getSize();this._textureContent||(this._textureContent=new Uint8Array(s.width*s.height*4),this.texture.readPixels(0,0,this._textureContent));const r=kh.Vector3[0];r.copyFrom(t.direction),r.normalize(),r.scaleInPlace(i),r.addInPlace(t.origin);const o=(r.x-n.x)/(a.x-n.x),l=1-(r.y-n.y)/(a.y-n.y),c=e._xOffset*s.width+o*e._xSize|0,h=e._yOffset*s.height+l*e._ySize|0;return this._textureContent[4*(c+h*s.width)+3]>.5}set disableDepthWrite(e){this._disableDepthWrite=e,this._spriteRenderer.disableDepthWrite=e}static ParseFromFileAsync(t,i,n,a=""){return new Promise(((s,r)=>{const o=new Rf;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const i=JSON.parse(o.responseText),r=e.Parse(i,n||xh.LastCreatedScene,a);t&&(r.name=t),s(r)}else r("Unable to load the sprite manager")})),o.open("GET",i),o.send()}))}static ParseFromSnippetAsync(t,i,n=""){return"_BLANK"===t?Promise.resolve(new e("Default sprite manager","//playground.babylonjs.com/textures/player.png",500,64,i)):new Promise(((a,s)=>{const r=new Rf;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const s=JSON.parse(JSON.parse(r.responseText).jsonPayload),o=JSON.parse(s.spriteManager),l=e.Parse(o,i||xh.LastCreatedScene,n);l.snippetId=t,a(l)}else s("Unable to load the snippet "+t)})),r.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),r.send()}))}dispose(){if(this._spriteRenderer&&(this._spriteRenderer.dispose(),this._spriteRenderer=null),this._textureContent=null,this._scene.spriteManagers){const e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1)}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null}get blendMode(){return this._spriteRenderer.blendMode}get children(){return this.sprites}render(){if(this._fromPacked&&(!this._packedAndReady||!this._spriteMap||!this._cellData))return;const e=this._scene.getEngine().getDeltaTime();this._packedAndReady?this._spriteRenderer.render(this.sprites,e,this._scene.getViewMatrix(),this._scene.getProjectionMatrix(),this._customUpdate):this._spriteRenderer.render(this.sprites,e,this._scene.getViewMatrix(),this._scene.getProjectionMatrix())}intersects(e,t,i,n){const a=Math.min(this.St,this.sprites.length),s=wh.Zero(),r=wh.Zero();let o=Number.MAX_VALUE,l=null;const c=kh.Vector3[0],h=kh.Vector3[1],f=t.getViewMatrix();let u=e,d=e;for(let t=0;t<a;t++){const a=this.sprites[t];if(a){if(i){if(!i(a))continue}else if(!a.isPickable)continue;if(wh.TransformCoordinatesToRef(a.position,f,h),a.angle?(Lh.TranslationToRef(-h.x,-h.y,0,kh.Matrix[1]),Lh.TranslationToRef(h.x,h.y,0,kh.Matrix[2]),Lh.RotationZToRef(-a.angle,kh.Matrix[3]),kh.Matrix[1].multiplyToRef(kh.Matrix[3],kh.Matrix[4]),kh.Matrix[4].multiplyToRef(kh.Matrix[2],kh.Matrix[0]),u=e.clone(),wh.TransformCoordinatesToRef(e.origin,kh.Matrix[0],u.origin),wh.TransformNormalToRef(e.direction,kh.Matrix[0],u.direction)):u=e,s.copyFromFloats(h.x-a.width/2,h.y-a.height/2,h.z),r.copyFromFloats(h.x+a.width/2,h.y+a.height/2,h.z),u.intersectsBoxMinMax(s,r)){const e=wh.Distance(h,u.origin);if(o>e){if(!this._checkTextureAlpha(a,u,e,s,r))continue;if(d=u,o=e,l=a,n)break}}}}if(l){const e=new Id;f.invertToRef(kh.Matrix[0]),e.hit=!0,e.pickedSprite=l,e.distance=o;const t=kh.Vector3[2];return t.copyFrom(d.direction),t.normalize(),t.scaleInPlace(o),d.origin.addToRef(t,c),e.pickedPoint=wh.TransformCoordinates(c,kh.Matrix[0]),e}return null}set texture(e){e.wrapU=yp.CLAMP_ADDRESSMODE,e.wrapV=yp.CLAMP_ADDRESSMODE,this._spriteRenderer.texture=e,this._textureContent=null}get fogEnabled(){return this._spriteRenderer.fogEnabled}get pixelPerfect(){return this._spriteRenderer.pixelPerfect}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get cellHeight(){return this._spriteRenderer.cellHeight}};Gg.SnippetUrl="https://snippet.babylonjs.com",Gg.CreateFromSnippetAsync=Gg.ParseFromSnippetAsync;var Ug=class{};function Hg(e){let t=e.pathArray;const i=e.closeArray||!1,n=e.closePath||!1,a=e.invertUV||!1,s=Math.floor(t[0].length/2);let r=e.offset||s;r=r>s?s:Math.floor(r);const o=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,l=e.uvs,c=e.colors,h=[],f=[],u=[],d=[],m=[],p=[],_=[],v=[];let g;const S=[],y=[];let E,A,C;if(t.length<2){const e=[],i=[];for(A=0;A<t[0].length-r;A++)e.push(t[0][A]),i.push(t[0][A+r]);t=[e,i]}let R=0;const T=n?1:0,N=i?1:0;let M,I,x,b,P,w;for(g=t[0].length,E=0;E<t.length+N;E++){for(_[E]=0,m[E]=[0],M=E===t.length?t[0]:t[E],I=M.length,g=g<I?g:I,C=0;C<I;)h.push(M[C].x,M[C].y,M[C].z),C>0&&(x=M[C].subtract(M[C-1]).length(),b=x+_[E],m[E].push(b),_[E]=b),C++;n&&(C--,h.push(M[0].x,M[0].y,M[0].z),x=M[C].subtract(M[0]).length(),b=x+_[E],m[E].push(b),_[E]=b),S[E]=I+T,y[E]=R,R+=I+T}let O,D,L=null,F=null;for(A=0;A<g+T;A++)for(v[A]=0,p[A]=[0],E=0;E<t.length-1+N;E++)P=t[E],w=E===t.length-1?t[0]:t[E+1],A===g?(L=P[0],F=w[0]):(L=P[A],F=w[A]),x=F.subtract(L).length(),b=x+v[A],p[A].push(b),v[A]=b;if(l)for(E=0;E<l.length;E++)d.push(l[E].x,dd?1-l[E].y:l[E].y);else for(E=0;E<t.length+N;E++)for(A=0;A<g+T;A++)O=0!=_[E]?m[E][A]/_[E]:0,D=0!=v[A]?p[A][E]/v[A]:0,a?d.push(D,O):d.push(O,dd?1-D:D);E=0;let k=0,B=S[E]-1,G=S[E+1]-1,U=B<G?B:G,H=y[1]-y[0];const V=S.length-1;for(;k<=U&&E<V;)f.push(k,k+H,k+1),f.push(k+H+1,k+1,k+H),k+=1,k===U&&(E++,H=y[E+1]-y[E],B=S[E]-1,G=S[E+1]-1,k=y[E],U=B<G?B+k:G+k);if(_f.ComputeNormals(h,f,u),n){let e=0,i=0;for(E=0;E<t.length;E++){e=3*y[E],i=E+1<t.length?3*(y[E+1]-1):u.length-3,u[e]=.5*(u[e]+u[i]),u[e+1]=.5*(u[e+1]+u[i+1]),u[e+2]=.5*(u[e+2]+u[i+2]);const n=Math.sqrt(u[e]*u[e]+u[e+1]*u[e+1]+u[e+2]*u[e+2]);u[e]/=n,u[e+1]/=n,u[e+2]/=n,u[i]=u[e],u[i+1]=u[e+1],u[i+2]=u[e+2]}}if(i){let e=3*y[0],i=3*y[t.length];for(A=0;A<g+T;A++){u[e]=.5*(u[e]+u[i]),u[e+1]=.5*(u[e+1]+u[i+1]),u[e+2]=.5*(u[e+2]+u[i+2]);const t=Math.sqrt(u[e]*u[e]+u[e+1]*u[e+1]+u[e+2]*u[e+2]);u[e]/=t,u[e+1]/=t,u[e+2]/=t,u[i]=u[e],u[i+1]=u[e+1],u[i+2]=u[e+2],e+=3,i+=3}}_f._ComputeSides(o,h,f,u,d,e.frontUVs,e.backUVs);let W=null;if(c){W=new Float32Array(4*c.length);for(let e=0;e<c.length;e++)W[4*e]=c[e].r,W[4*e+1]=c[e].g,W[4*e+2]=c[e].b,W[4*e+3]=c[e].a}const z=new _f,X=new Float32Array(h),Y=new Float32Array(u),j=new Float32Array(d);return z.indices=f,z.positions=X,z.normals=Y,z.uvs=j,W&&z.set(W,$h.ColorKind),n&&(z._idx=y),z}function Vg(e,t,i=null){const n=t.pathArray,a=t.closeArray,s=t.closePath,r=wm._GetDefaultSideOrientation(t.sideOrientation),o=t.instance,l=t.updatable;if(o){const e=kh.Vector3[0].setAll(Number.MAX_VALUE),i=kh.Vector3[1].setAll(-Number.MAX_VALUE),a=t=>{let a=n[0].length;const s=o;let r=0;const l=s._originalBuilderSideOrientation===wm.DOUBLESIDE?2:1;for(let o=1;o<=l;++o)for(let o=0;o<n.length;++o){const l=n[o],c=l.length;a=a<c?a:c;for(let n=0;n<a;++n){const a=l[n];t[r]=a.x,t[r+1]=a.y,t[r+2]=a.z,e.minimizeInPlaceFromFloats(a.x,a.y,a.z),i.maximizeInPlaceFromFloats(a.x,a.y,a.z),r+=3}if(s._creationDataStorage&&s._creationDataStorage.closePath){const e=l[0];t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z,r+=3}}},s=o.getVerticesData($h.PositionKind);if(a(s),o.hasBoundingInfo?o.getBoundingInfo().reConstruct(e,i,o._worldMatrix):o.buildBoundingInfo(e,i,o._worldMatrix),o.updateVerticesData($h.PositionKind,s,!1,!1),t.colors){const e=o.getVerticesData($h.ColorKind);for(let i=0,n=0;i<t.colors.length;i++,n+=4){const a=t.colors[i];e[n]=a.r,e[n+1]=a.g,e[n+2]=a.b,e[n+3]=a.a}o.updateVerticesData($h.ColorKind,e,!1,!1)}if(t.uvs){const e=o.getVerticesData($h.UVKind);for(let i=0;i<t.uvs.length;i++)e[2*i]=t.uvs[i].x,e[2*i+1]=dd?1-t.uvs[i].y:t.uvs[i].y;o.updateVerticesData($h.UVKind,e,!1,!1)}if(!o.areNormalsFrozen||o.isFacetDataEnabled){const e=o.getIndices(),t=o.getVerticesData($h.NormalKind),i=o.isFacetDataEnabled?o.getFacetDataParameters():null;if(_f.ComputeNormals(s,e,t,i),o._creationDataStorage&&o._creationDataStorage.closePath){let e=0,i=0;for(let a=0;a<n.length;a++)e=3*o._creationDataStorage.idx[a],i=a+1<n.length?3*(o._creationDataStorage.idx[a+1]-1):t.length-3,t[e]=.5*(t[e]+t[i]),t[e+1]=.5*(t[e+1]+t[i+1]),t[e+2]=.5*(t[e+2]+t[i+2]),t[i]=t[e],t[i+1]=t[e+1],t[i+2]=t[e+2]}o.areNormalsFrozen||o.updateVerticesData($h.NormalKind,t,!1,!1)}return o}{const n=new wm(e,i);n._originalBuilderSideOrientation=r,n._creationDataStorage=new Mm;const o=Hg(t);return s&&(n._creationDataStorage.idx=o._idx),n._creationDataStorage.closePath=s,n._creationDataStorage.closeArray=a,o.applyToMesh(n,l),n}}function Wg(e){const t=[],i=[],n=[],a=[],s=e.radius||.5,r=e.tessellation||64,o=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,l=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE;t.push(0,0,0),a.push(.5,.5);const c=2*Math.PI*o,h=1===o?c/r:c/(r-1);let f=0;for(let e=0;e<r;e++){const e=Math.cos(f),i=Math.sin(f),n=(e+1)/2,r=(1-i)/2;t.push(s*e,s*i,0),a.push(n,dd?1-r:r),f+=h}1===o&&(t.push(t[3],t[4],t[5]),a.push(a[2],dd?1-a[3]:a[3]));const u=t.length/3;for(let e=1;e<u-1;e++)i.push(e+1,0,e);_f.ComputeNormals(t,i,n),_f._ComputeSides(l,t,i,n,a,e.frontUVs,e.backUVs);const d=new _f;return d.indices=i,d.positions=t,d.normals=n,d.uvs=a,d}function zg(e,t={},i=null){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return Wg(t).applyToMesh(n,t.updatable),n}Ug.AUTOSAMPLERSUFFIX="Sampler",Ug.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",Ug.ALPHA_DISABLE=0,Ug.ALPHA_ADD=1,Ug.ALPHA_COMBINE=2,Ug.ALPHA_SUBTRACT=3,Ug.ALPHA_MULTIPLY=4,Ug.ALPHA_MAXIMIZED=5,Ug.ALPHA_ONEONE=6,Ug.ALPHA_PREMULTIPLIED=7,Ug.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Ug.ALPHA_INTERPOLATE=9,Ug.ALPHA_SCREENMODE=10,Ug.ALPHA_ONEONE_ONEONE=11,Ug.ALPHA_ALPHATOCOLOR=12,Ug.ALPHA_REVERSEONEMINUS=13,Ug.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Ug.ALPHA_ONEONE_ONEZERO=15,Ug.ALPHA_EXCLUSION=16,Ug.ALPHA_LAYER_ACCUMULATE=17,Ug.ALPHA_EQUATION_ADD=0,Ug.ALPHA_EQUATION_SUBSTRACT=1,Ug.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Ug.ALPHA_EQUATION_MAX=3,Ug.ALPHA_EQUATION_MIN=4,Ug.ALPHA_EQUATION_DARKEN=5,Ug.DELAYLOADSTATE_NONE=0,Ug.DELAYLOADSTATE_LOADED=1,Ug.DELAYLOADSTATE_LOADING=2,Ug.DELAYLOADSTATE_NOTLOADED=4,Ug.NEVER=512,Ug.ALWAYS=519,Ug.LESS=513,Ug.EQUAL=514,Ug.LEQUAL=515,Ug.GREATER=516,Ug.GEQUAL=518,Ug.NOTEQUAL=517,Ug.KEEP=7680,Ug.ZERO=0,Ug.REPLACE=7681,Ug.INCR=7682,Ug.DECR=7683,Ug.INVERT=5386,Ug.INCR_WRAP=34055,Ug.DECR_WRAP=34056,Ug.TEXTURE_CLAMP_ADDRESSMODE=0,Ug.TEXTURE_WRAP_ADDRESSMODE=1,Ug.TEXTURE_MIRROR_ADDRESSMODE=2,Ug.TEXTURE_CREATIONFLAG_STORAGE=1,Ug.TEXTUREFORMAT_ALPHA=0,Ug.TEXTUREFORMAT_LUMINANCE=1,Ug.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Ug.TEXTUREFORMAT_RGB=4,Ug.TEXTUREFORMAT_RGBA=5,Ug.TEXTUREFORMAT_RED=6,Ug.TEXTUREFORMAT_R=6,Ug.TEXTUREFORMAT_RG=7,Ug.TEXTUREFORMAT_RED_INTEGER=8,Ug.TEXTUREFORMAT_R_INTEGER=8,Ug.TEXTUREFORMAT_RG_INTEGER=9,Ug.TEXTUREFORMAT_RGB_INTEGER=10,Ug.TEXTUREFORMAT_RGBA_INTEGER=11,Ug.TEXTUREFORMAT_BGRA=12,Ug.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Ug.TEXTUREFORMAT_DEPTH32_FLOAT=14,Ug.TEXTUREFORMAT_DEPTH16=15,Ug.TEXTUREFORMAT_DEPTH24=16,Ug.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Ug.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Ug.TEXTUREFORMAT_STENCIL8=19,Ug.TEXTUREFORMAT_UNDEFINED=4294967295,Ug.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Ug.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Ug.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Ug.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Ug.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Ug.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Ug.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Ug.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Ug.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Ug.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Ug.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Ug.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Ug.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Ug.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Ug.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Ug.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Ug.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Ug.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Ug.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Ug.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Ug.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Ug.TEXTURETYPE_UNSIGNED_BYTE=0,Ug.TEXTURETYPE_UNSIGNED_INT=0,Ug.TEXTURETYPE_FLOAT=1,Ug.TEXTURETYPE_HALF_FLOAT=2,Ug.TEXTURETYPE_BYTE=3,Ug.TEXTURETYPE_SHORT=4,Ug.TEXTURETYPE_UNSIGNED_SHORT=5,Ug.TEXTURETYPE_INT=6,Ug.TEXTURETYPE_UNSIGNED_INTEGER=7,Ug.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Ug.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Ug.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Ug.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Ug.TEXTURETYPE_UNSIGNED_INT_24_8=12,Ug.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Ug.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Ug.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Ug.TEXTURETYPE_UNDEFINED=16,Ug.TEXTURE_2D=3553,Ug.TEXTURE_2D_ARRAY=35866,Ug.TEXTURE_CUBE_MAP=34067,Ug.TEXTURE_CUBE_MAP_ARRAY=3735928559,Ug.TEXTURE_3D=32879,Ug.TEXTURE_NEAREST_SAMPLINGMODE=1,Ug.TEXTURE_NEAREST_NEAREST=1,Ug.TEXTURE_BILINEAR_SAMPLINGMODE=2,Ug.TEXTURE_LINEAR_LINEAR=2,Ug.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Ug.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Ug.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Ug.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Ug.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Ug.TEXTURE_NEAREST_LINEAR=7,Ug.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Ug.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Ug.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Ug.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Ug.TEXTURE_LINEAR_NEAREST=12,Ug.TEXTURE_EXPLICIT_MODE=0,Ug.TEXTURE_SPHERICAL_MODE=1,Ug.TEXTURE_PLANAR_MODE=2,Ug.TEXTURE_CUBIC_MODE=3,Ug.TEXTURE_PROJECTION_MODE=4,Ug.TEXTURE_SKYBOX_MODE=5,Ug.TEXTURE_INVCUBIC_MODE=6,Ug.TEXTURE_EQUIRECTANGULAR_MODE=7,Ug.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Ug.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Ug.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Ug.TEXTURE_FILTERING_QUALITY_HIGH=64,Ug.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Ug.TEXTURE_FILTERING_QUALITY_LOW=8,Ug.SCALEMODE_FLOOR=1,Ug.SCALEMODE_NEAREST=2,Ug.SCALEMODE_CEILING=3,Ug.MATERIAL_TextureDirtyFlag=1,Ug.MATERIAL_LightDirtyFlag=2,Ug.MATERIAL_FresnelDirtyFlag=4,Ug.MATERIAL_AttributesDirtyFlag=8,Ug.MATERIAL_MiscDirtyFlag=16,Ug.MATERIAL_PrePassDirtyFlag=32,Ug.MATERIAL_AllDirtyFlag=63,Ug.MATERIAL_TriangleFillMode=0,Ug.MATERIAL_WireFrameFillMode=1,Ug.MATERIAL_PointFillMode=2,Ug.MATERIAL_PointListDrawMode=3,Ug.MATERIAL_LineListDrawMode=4,Ug.MATERIAL_LineLoopDrawMode=5,Ug.MATERIAL_LineStripDrawMode=6,Ug.MATERIAL_TriangleStripDrawMode=7,Ug.MATERIAL_TriangleFanDrawMode=8,Ug.MATERIAL_ClockWiseSideOrientation=0,Ug.MATERIAL_CounterClockWiseSideOrientation=1,Ug.ACTION_NothingTrigger=0,Ug.ACTION_OnPickTrigger=1,Ug.ACTION_OnLeftPickTrigger=2,Ug.ACTION_OnRightPickTrigger=3,Ug.ACTION_OnCenterPickTrigger=4,Ug.ACTION_OnPickDownTrigger=5,Ug.ACTION_OnDoublePickTrigger=6,Ug.ACTION_OnPickUpTrigger=7,Ug.ACTION_OnPickOutTrigger=16,Ug.ACTION_OnLongPressTrigger=8,Ug.ACTION_OnPointerOverTrigger=9,Ug.ACTION_OnPointerOutTrigger=10,Ug.ACTION_OnEveryFrameTrigger=11,Ug.ACTION_OnIntersectionEnterTrigger=12,Ug.ACTION_OnIntersectionExitTrigger=13,Ug.ACTION_OnKeyDownTrigger=14,Ug.ACTION_OnKeyUpTrigger=15,Ug.PARTICLES_BILLBOARDMODE_Y=2,Ug.PARTICLES_BILLBOARDMODE_ALL=7,Ug.PARTICLES_BILLBOARDMODE_STRETCHED=8,Ug.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,Ug.MESHES_CULLINGSTRATEGY_STANDARD=0,Ug.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Ug.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Ug.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Ug.SCENELOADER_NO_LOGGING=0,Ug.SCENELOADER_MINIMAL_LOGGING=1,Ug.SCENELOADER_SUMMARY_LOGGING=2,Ug.SCENELOADER_DETAILED_LOGGING=3,Ug.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Ug.PREPASS_POSITION_TEXTURE_TYPE=1,Ug.PREPASS_VELOCITY_TEXTURE_TYPE=2,Ug.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Ug.PREPASS_COLOR_TEXTURE_TYPE=4,Ug.PREPASS_DEPTH_TEXTURE_TYPE=5,Ug.PREPASS_NORMAL_TEXTURE_TYPE=6,Ug.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Ug.BUFFER_CREATIONFLAG_READ=1,Ug.BUFFER_CREATIONFLAG_WRITE=2,Ug.BUFFER_CREATIONFLAG_READWRITE=3,Ug.BUFFER_CREATIONFLAG_UNIFORM=4,Ug.BUFFER_CREATIONFLAG_VERTEX=8,Ug.BUFFER_CREATIONFLAG_INDEX=16,Ug.BUFFER_CREATIONFLAG_STORAGE=32,Ug.BUFFER_CREATIONFLAG_INDIRECT=64,Ug.RENDERPASS_MAIN=0,Ug.INPUT_ALT_KEY=18,Ug.INPUT_CTRL_KEY=17,Ug.INPUT_META_KEY1=91,Ug.INPUT_META_KEY2=92,Ug.INPUT_META_KEY3=93,Ug.INPUT_SHIFT_KEY=16,Ug.SNAPSHOTRENDERING_STANDARD=0,Ug.SNAPSHOTRENDERING_FAST=1,Ug.PERSPECTIVE_CAMERA=0,Ug.ORTHOGRAPHIC_CAMERA=1,Ug.FOVMODE_VERTICAL_FIXED=0,Ug.FOVMODE_HORIZONTAL_FIXED=1,Ug.RIG_MODE_NONE=0,Ug.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Ug.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Ug.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Ug.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Ug.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Ug.RIG_MODE_VR=20,Ug.RIG_MODE_CUSTOM=22,Ug.MAX_SUPPORTED_UV_SETS=6,Ug.GL_ALPHA_EQUATION_ADD=32774,Ug.GL_ALPHA_EQUATION_MIN=32775,Ug.GL_ALPHA_EQUATION_MAX=32776,Ug.GL_ALPHA_EQUATION_SUBTRACT=32778,Ug.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Ug.GL_ALPHA_FUNCTION_SRC=768,Ug.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Ug.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Ug.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Ug.GL_ALPHA_FUNCTION_DST_ALPHA=772,Ug.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Ug.GL_ALPHA_FUNCTION_DST_COLOR=774,Ug.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Ug.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Ug.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Ug.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Ug.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Ug.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Ug.SnippetUrl="https://snippet.babylonjs.com",Ug.FOGMODE_NONE=0,Ug.FOGMODE_EXP=1,Ug.FOGMODE_EXP2=2,Ug.FOGMODE_LINEAR=3,Ug.BYTE=5120,Ug.UNSIGNED_BYTE=5121,Ug.SHORT=5122,Ug.UNSIGNED_SHORT=5123,Ug.INT=5124,Ug.UNSIGNED_INT=5125,Ug.FLOAT=5126,Ug.PositionKind="position",Ug.NormalKind="normal",Ug.TangentKind="tangent",Ug.UVKind="uv",Ug.UV2Kind="uv2",Ug.UV3Kind="uv3",Ug.UV4Kind="uv4",Ug.UV5Kind="uv5",Ug.UV6Kind="uv6",Ug.ColorKind="color",Ug.ColorInstanceKind="instanceColor",Ug.MatricesIndicesKind="matricesIndices",Ug.MatricesWeightsKind="matricesWeights",Ug.MatricesIndicesExtraKind="matricesIndicesExtra",Ug.MatricesWeightsExtraKind="matricesWeightsExtra",_f.st=Hg,wm.st=(e,t,i=!1,n,a,s,r=!1,o,l)=>Vg(e,{pathArray:t,closeArray:i,closePath:n,offset:a,updatable:r,sideOrientation:o,instance:l},s),_f.gt=Wg,wm.gt=(e,t,i,n=null,a,s)=>zg(e,{radius:t,tessellation:i,sideOrientation:s,updatable:a},n),wm._GroundMeshParser=(e,t)=>Xg.Parse(e,t);var Xg=class e extends wm{serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}getNormalAtCoordinates(e,t){const i=new wh(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i}static Parse(t,i){const n=new e(t.name,i);return n._subdivisionsX=t.subdivisionsX||1,n._subdivisionsY=t.subdivisionsY||1,n._minX=t.minX,n._maxX=t.maxX,n._minZ=t.minZ,n._maxZ=t.maxZ,n._width=t.width,n._height=t.height,n}getNormalAtCoordinatesToRef(e,t,i){const n=this.getWorldMatrix(),a=kh.Matrix[5];n.invertToRef(a);const s=kh.Vector3[8];if(wh.TransformCoordinatesFromFloatsToRef(e,0,t,a,s),e=s.x,t=s.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const r=this._getFacetAt(e,t);return wh.TransformNormalFromFloatsToRef(r.x,r.y,r.z,n,i),this}getClassName(){return"GroundMesh"}_getFacetAt(e,t){const i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),n=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),a=this._heightQuads[n*this._subdivisionsX+i];let s;return s=t<a.slope.x*e+a.slope.y?a.facet1:a.facet2,s}optimize(e,t=32){this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(t)}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}_computeHeightQuads(){const e=this.getVerticesData($h.PositionKind);if(!e)return this;const t=kh.Vector3[3],i=kh.Vector3[2],n=kh.Vector3[1],a=kh.Vector3[0],s=kh.Vector3[4],r=kh.Vector3[5],o=kh.Vector3[6],l=kh.Vector3[7],c=kh.Vector3[8];let h=0,f=0,u=0,d=0,m=0,p=0,_=0;const v=this._subdivisionsX,g=this._subdivisionsY;for(let S=0;S<g;S++)for(let g=0;g<v;g++){h=3*g,f=S*(v+1)*3,u=(S+1)*(v+1)*3,t.x=e[f+h],t.y=e[f+h+1],t.z=e[f+h+2],i.x=e[f+h+3],i.y=e[f+h+4],i.z=e[f+h+5],n.x=e[u+h],n.y=e[u+h+1],n.z=e[u+h+2],a.x=e[u+h+3],a.y=e[u+h+4],a.z=e[u+h+5],d=(a.z-t.z)/(a.x-t.x),m=t.z-d*t.x,i.subtractToRef(t,s),n.subtractToRef(t,r),a.subtractToRef(t,o),wh.CrossToRef(o,r,l),wh.CrossToRef(s,o,c),l.normalize(),c.normalize(),p=-(l.x*t.x+l.y*t.y+l.z*t.z),_=-(c.x*i.x+c.y*i.y+c.z*i.z);const y=this._heightQuads[S*v+g];y.slope.copyFromFloats(d,m),y.facet1.copyFromFloats(l.x,l.y,l.z,p),y.facet2.copyFromFloats(c.x,c.y,c.z,_)}return this}getHeightAtCoordinates(e,t){const i=this.getWorldMatrix(),n=kh.Matrix[5];i.invertToRef(n);const a=kh.Vector3[8];if(wh.TransformCoordinatesFromFloatsToRef(e,0,t,n,a),e=a.x,t=a.z,e<this._minX||e>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const s=this._getFacetAt(e,t),r=-(s.x*e+s.z*t+s.w)/s.y;return wh.TransformCoordinatesFromFloatsToRef(0,r,0,i,a),a.y}get subdivisionsY(){return this._subdivisionsY}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_initHeightQuads(){const e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(let i=0;i<t;i++)for(let t=0;t<e;t++){const n={slope:Ph.Zero(),facet1:new Oh(0,0,0,0),facet2:new Oh(0,0,0,0)};this._heightQuads[i*e+t]=n}return this}constructor(e,t){super(e,t),this.generateOctree=!1}};function Yg(e){const t=[],i=[],n=[],a=[];let s,r;const o=e.width||1,l=e.height||1,c=0|(e.subdivisionsX||e.subdivisions||1),h=0|(e.subdivisionsY||e.subdivisions||1);for(s=0;s<=h;s++)for(r=0;r<=c;r++){const e=new wh(r*o/c-o/2,0,(h-s)*l/h-l/2),t=new wh(0,1,0);i.push(e.x,e.y,e.z),n.push(t.x,t.y,t.z),a.push(r/c,dd?s/h:1-s/h)}for(s=0;s<h;s++)for(r=0;r<c;r++)t.push(r+1+(s+1)*(c+1)),t.push(r+1+s*(c+1)),t.push(r+s*(c+1)),t.push(r+(s+1)*(c+1)),t.push(r+1+(s+1)*(c+1)),t.push(r+s*(c+1));const f=new _f;return f.indices=t,f.positions=i,f.normals=n,f.uvs=a,f}function jg(e){const t=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,i=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,n=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,a=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,s=e.subdivisions||{w:1,h:1},r=e.precision||{w:1,h:1},o=[],l=[],c=[],h=[];let f,u,d,m;s.h=s.h<1?1:s.h,s.w=s.w<1?1:s.w,r.w=r.w<1?1:r.w,r.h=r.h<1?1:r.h;const p=(n-t)/s.w,_=(a-i)/s.h;function v(e,t,i,n){const a=l.length/3,s=r.w+1;for(f=0;f<r.h;f++)for(u=0;u<r.w;u++){const e=[a+u+f*s,a+(u+1)+f*s,a+(u+1)+(f+1)*s,a+u+(f+1)*s];o.push(e[1]),o.push(e[2]),o.push(e[3]),o.push(e[0]),o.push(e[1]),o.push(e[3])}const d=wh.Zero(),m=new wh(0,1,0);for(f=0;f<=r.h;f++)for(d.z=f*(n-t)/r.h+t,u=0;u<=r.w;u++)d.x=u*(i-e)/r.w+e,d.y=0,l.push(d.x,d.y,d.z),c.push(m.x,m.y,m.z),h.push(u/r.w,f/r.h)}for(d=0;d<s.h;d++)for(m=0;m<s.w;m++)v(t+m*p,i+d*_,t+(m+1)*p,i+(d+1)*_);const g=new _f;return g.indices=o,g.positions=l,g.normals=c,g.uvs=h,g}function Kg(e){const t=[],i=[],n=[],a=[];let s,r;const o=e.colorFilter||new Ah(.3,.59,.11),l=e.alphaFilter||0;let c=!1;if(e.minHeight>e.maxHeight){c=!0;const t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(s=0;s<=e.subdivisions;s++)for(r=0;r<=e.subdivisions;r++){const t=new wh(r*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-s)*e.height/e.subdivisions-e.height/2),h=4*(((t.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(t.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth);let f=e.buffer[h]/255,u=e.buffer[h+1]/255,d=e.buffer[h+2]/255;const m=e.buffer[h+3]/255;c&&(f=1-f,u=1-u,d=1-d);const p=f*o.r+u*o.g+d*o.b;t.y=m>=l?e.minHeight+(e.maxHeight-e.minHeight)*p:e.minHeight-hh,e.heightBuffer&&(e.heightBuffer[s*(e.subdivisions+1)+r]=t.y),i.push(t.x,t.y,t.z),n.push(0,0,0),a.push(r/e.subdivisions,1-s/e.subdivisions)}for(s=0;s<e.subdivisions;s++)for(r=0;r<e.subdivisions;r++){const n=r+1+(s+1)*(e.subdivisions+1),a=r+1+s*(e.subdivisions+1),o=r+s*(e.subdivisions+1),l=r+(s+1)*(e.subdivisions+1),c=i[3*n+1]>=e.minHeight,h=i[3*a+1]>=e.minHeight,f=i[3*o+1]>=e.minHeight;c&&h&&f&&(t.push(n),t.push(a),t.push(o));i[3*l+1]>=e.minHeight&&c&&f&&(t.push(l),t.push(n),t.push(o))}_f.ComputeNormals(i,t,n);const h=new _f;return h.indices=t,h.positions=i,h.normals=n,h.uvs=a,h}function $g(e,t={},i){const n=new Xg(e,i);n._setReady(!1),n._subdivisionsX=t.subdivisionsX||t.subdivisions||1,n._subdivisionsY=t.subdivisionsY||t.subdivisions||1,n._width=t.width||1,n._height=t.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ;return Yg(t).applyToMesh(n,t.updatable),n._setReady(!0),n}function qg(e,t,i=null){const n=new wm(e,i);return jg(t).applyToMesh(n,t.updatable),n}function Jg(e,t,i={},n=null){const a=i.width||10,s=i.height||10,r=i.subdivisions||1,o=i.minHeight||0,l=i.maxHeight||1,c=i.colorFilter||new Ah(.3,.59,.11),h=i.alphaFilter||0,f=i.updatable,u=i.onReady;n=n||xh.LastCreatedScene;const d=new Xg(e,n);let m;d._subdivisionsX=r,d._subdivisionsY=r,d._width=a,d._height=s,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1),i.passHeightBufferInCallback&&(m=new Float32Array((r+1)*(r+1)));const p=(e,t,i)=>{Kg({width:a,height:s,subdivisions:r,minHeight:o,maxHeight:l,colorFilter:c,buffer:e,bufferWidth:t,bufferHeight:i,alphaFilter:h,heightBuffer:m}).applyToMesh(d,f),u&&u(d,m),d._setReady(!0)};if("string"==typeof t){const e=e=>{const t=e.width,i=e.height;if(n.isDisposed)return;const a=n?.getEngine().resizeImageBitmap(e,t,i);p(a,t,i)};ad.LoadImage(t,e,i.onError?i.onError:()=>{},n.offlineProvider)}else p(t.data,t.width,t.height);return d}function Qg(e){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[];let a=[];const s=e.width||e.size||1,r=e.height||e.size||1,o=e.depth||e.size||1,l=e.wrap||!1;let c=void 0===e.topBaseAt?1:e.topBaseAt,h=void 0===e.bottomBaseAt?0:e.bottomBaseAt;c=(c+4)%4,h=(h+4)%4;let f=[2,0,3,1][c],u=[2,0,1,3][h],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(l){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const n=[17,18,19,16],a=[22,23,20,21];for(;f>0;)e.unshift(e.pop()),n.unshift(n.pop()),f--;for(;u>0;)i.unshift(i.pop()),a.unshift(a.pop()),u--;e=e.flat(),i=i.flat(),d=d.concat(e).concat(i),t.push(n[0],n[2],n[3],n[0],n[1],n[2]),t.push(a[0],a[2],a[3],a[0],a[1],a[2])}const m=[s/2,r/2,o/2];a=d.reduce(((e,t,i)=>e.concat(t*m[i%3])),[]);const p=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,_=e.faceUV||new Array(6),v=e.faceColors,g=[];for(let e=0;e<6;e++)void 0===_[e]&&(_[e]=new Oh(0,0,1,1)),v&&void 0===v[e]&&(v[e]=new Ch(1,1,1,1));for(let e=0;e<6;e++)if(n.push(_[e].z,dd?1-_[e].w:_[e].w),n.push(_[e].x,dd?1-_[e].w:_[e].w),n.push(_[e].x,dd?1-_[e].y:_[e].y),n.push(_[e].z,dd?1-_[e].y:_[e].y),v)for(let t=0;t<4;t++)g.push(v[e].r,v[e].g,v[e].b,v[e].a);_f._ComputeSides(p,a,t,i,n,e.frontUVs,e.backUVs);const S=new _f;if(S.indices=t,S.positions=a,S.normals=i,S.uvs=n,v){const e=p===_f.DOUBLESIDE?g.concat(g):g;S.colors=e}return S}function Zg(e,t={},i=null){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return Qg(t).applyToMesh(n,t.updatable),n}function eS(e){const t=e.pattern||wm.NO_FLIP,i=e.tileWidth||e.tileSize||1,n=e.tileHeight||e.tileSize||1,a=e.alignHorizontal||0,s=e.alignVertical||0,r=e.width||e.size||1,o=Math.floor(r/i);let l=r-o*i;const c=e.height||e.size||1,h=Math.floor(c/n);let f=c-h*n;const u=i*o/2,d=n*h/2;let m=0,p=0,_=0,v=0,g=0,S=0;if(l>0||f>0){switch(_=-u,v=-d,g=u,S=d,a){case wm.CENTER:l/=2,_-=l,g+=l;break;case wm.LEFT:g+=l,m=-l/2;break;case wm.RIGHT:_-=l,m=l/2}switch(s){case wm.CENTER:f/=2,v-=f,S+=f;break;case wm.BOTTOM:S+=f,p=-f/2;break;case wm.TOP:v-=f,p=f/2}}const y=[],E=[],A=[];A[0]=[0,0,1,0,1,1,0,1],A[1]=[0,0,1,0,1,1,0,1],t!==wm.ROTATE_TILE&&t!==wm.ROTATE_ROW||(A[1]=[1,1,0,1,0,0,1,0]),t!==wm.FLIP_TILE&&t!==wm.FLIP_ROW||(A[1]=[1,0,0,0,0,1,1,1]),t!==wm.FLIP_N_ROTATE_TILE&&t!==wm.FLIP_N_ROTATE_ROW||(A[1]=[0,1,1,1,1,0,0,0]);let C=[];const R=[],T=[];let N=0;for(let e=0;e<h;e++)for(let a=0;a<o;a++)y.push(a*i-u+m,e*n-d+p,0),y.push((a+1)*i-u+m,e*n-d+p,0),y.push((a+1)*i-u+m,(e+1)*n-d+p,0),y.push(a*i-u+m,(e+1)*n-d+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),C=t===wm.FLIP_TILE||t===wm.ROTATE_TILE||t===wm.FLIP_N_ROTATE_TILE?C.concat(A[(a%2+e%2)%2]):t===wm.FLIP_ROW||t===wm.ROTATE_ROW||t===wm.FLIP_N_ROTATE_ROW?C.concat(A[e%2]):C.concat(A[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),N+=4;if(l>0||f>0){const e=f>0&&(s===wm.CENTER||s===wm.TOP),r=f>0&&(s===wm.CENTER||s===wm.BOTTOM),c=l>0&&(a===wm.CENTER||a===wm.RIGHT),A=l>0&&(a===wm.CENTER||a===wm.LEFT);let M,I,x,b,P=[];if(e&&c&&(y.push(_+m,v+p,0),y.push(-u+m,v+p,0),y.push(-u+m,v+f+p,0),y.push(_+m,v+f+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,M=1-l/i,I=1-f/n,x=1,b=1,P=[M,I,x,I,x,b,M,b],t===wm.ROTATE_ROW&&(P=[1-M,1-I,1-x,1-I,1-x,1-b,1-M,1-b]),t===wm.FLIP_ROW&&(P=[1-M,I,1-x,I,1-x,b,1-M,b]),t===wm.FLIP_N_ROTATE_ROW&&(P=[M,1-I,x,1-I,x,1-b,M,1-b]),C=C.concat(P),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&A&&(y.push(u+m,v+p,0),y.push(g+m,v+p,0),y.push(g+m,v+f+p,0),y.push(u+m,v+f+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,M=0,I=1-f/n,x=l/i,b=1,P=[M,I,x,I,x,b,M,b],(t===wm.ROTATE_ROW||t===wm.ROTATE_TILE&&o%2==0)&&(P=[1-M,1-I,1-x,1-I,1-x,1-b,1-M,1-b]),(t===wm.FLIP_ROW||t===wm.FLIP_TILE&&o%2==0)&&(P=[1-M,I,1-x,I,1-x,b,1-M,b]),(t===wm.FLIP_N_ROTATE_ROW||t===wm.FLIP_N_ROTATE_TILE&&o%2==0)&&(P=[M,1-I,x,1-I,x,1-b,M,1-b]),C=C.concat(P),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&c&&(y.push(_+m,d+p,0),y.push(-u+m,d+p,0),y.push(-u+m,S+p,0),y.push(_+m,S+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,M=1-l/i,I=0,x=1,b=f/n,P=[M,I,x,I,x,b,M,b],(t===wm.ROTATE_ROW&&h%2==1||t===wm.ROTATE_TILE&&h%1==0)&&(P=[1-M,1-I,1-x,1-I,1-x,1-b,1-M,1-b]),(t===wm.FLIP_ROW&&h%2==1||t===wm.FLIP_TILE&&h%2==0)&&(P=[1-M,I,1-x,I,1-x,b,1-M,b]),(t===wm.FLIP_N_ROTATE_ROW&&h%2==1||t===wm.FLIP_N_ROTATE_TILE&&h%2==0)&&(P=[M,1-I,x,1-I,x,1-b,M,1-b]),C=C.concat(P),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&A&&(y.push(u+m,d+p,0),y.push(g+m,d+p,0),y.push(g+m,S+p,0),y.push(u+m,S+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,M=0,I=0,x=l/i,b=f/n,P=[M,I,x,I,x,b,M,b],(t===wm.ROTATE_ROW&&h%2==1||t===wm.ROTATE_TILE&&(h+o)%2==1)&&(P=[1-M,1-I,1-x,1-I,1-x,1-b,1-M,1-b]),(t===wm.FLIP_ROW&&h%2==1||t===wm.FLIP_TILE&&(h+o)%2==1)&&(P=[1-M,I,1-x,I,1-x,b,1-M,b]),(t===wm.FLIP_N_ROTATE_ROW&&h%2==1||t===wm.FLIP_N_ROTATE_TILE&&(h+o)%2==1)&&(P=[M,1-I,x,1-I,x,1-b,M,1-b]),C=C.concat(P),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e){const e=[];M=0,I=1-f/n,x=1,b=1,e[0]=[M,I,x,I,x,b,M,b],e[1]=[M,I,x,I,x,b,M,b],t!==wm.ROTATE_TILE&&t!==wm.ROTATE_ROW||(e[1]=[1-M,1-I,1-x,1-I,1-x,1-b,1-M,1-b]),t!==wm.FLIP_TILE&&t!==wm.FLIP_ROW||(e[1]=[1-M,I,1-x,I,1-x,b,1-M,b]),t!==wm.FLIP_N_ROTATE_TILE&&t!==wm.FLIP_N_ROTATE_ROW||(e[1]=[M,1-I,x,1-I,x,1-b,M,1-b]);for(let n=0;n<o;n++)y.push(n*i-u+m,v+p,0),y.push((n+1)*i-u+m,v+p,0),y.push((n+1)*i-u+m,v+f+p,0),y.push(n*i-u+m,v+f+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,C=t===wm.FLIP_TILE||t===wm.ROTATE_TILE||t===wm.FLIP_N_ROTATE_TILE?C.concat(e[(n+1)%2]):t===wm.FLIP_ROW||t===wm.ROTATE_ROW||t===wm.FLIP_N_ROTATE_ROW?C.concat(e[1]):C.concat(e[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const e=[];M=0,I=0,x=1,b=f/n,e[0]=[M,I,x,I,x,b,M,b],e[1]=[M,I,x,I,x,b,M,b],t!==wm.ROTATE_TILE&&t!==wm.ROTATE_ROW||(e[1]=[1-M,1-I,1-x,1-I,1-x,1-b,1-M,1-b]),t!==wm.FLIP_TILE&&t!==wm.FLIP_ROW||(e[1]=[1-M,I,1-x,I,1-x,b,1-M,b]),t!==wm.FLIP_N_ROTATE_TILE&&t!==wm.FLIP_N_ROTATE_ROW||(e[1]=[M,1-I,x,1-I,x,1-b,M,1-b]);for(let n=0;n<o;n++)y.push(n*i-u+m,S-f+p,0),y.push((n+1)*i-u+m,S-f+p,0),y.push((n+1)*i-u+m,S+p,0),y.push(n*i-u+m,S+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,C=t===wm.FLIP_TILE||t===wm.ROTATE_TILE||t===wm.FLIP_N_ROTATE_TILE?C.concat(e[(n+h)%2]):t===wm.FLIP_ROW||t===wm.ROTATE_ROW||t===wm.FLIP_N_ROTATE_ROW?C.concat(e[h%2]):C.concat(e[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const e=[];M=1-l/i,I=0,x=1,b=1,e[0]=[M,I,x,I,x,b,M,b],e[1]=[M,I,x,I,x,b,M,b],t!==wm.ROTATE_TILE&&t!==wm.ROTATE_ROW||(e[1]=[1-M,1-I,1-x,1-I,1-x,1-b,1-M,1-b]),t!==wm.FLIP_TILE&&t!==wm.FLIP_ROW||(e[1]=[1-M,I,1-x,I,1-x,b,1-M,b]),t!==wm.FLIP_N_ROTATE_TILE&&t!==wm.FLIP_N_ROTATE_ROW||(e[1]=[M,1-I,x,1-I,x,1-b,M,1-b]);for(let i=0;i<h;i++)y.push(_+m,i*n-d+p,0),y.push(_+l+m,i*n-d+p,0),y.push(_+l+m,(i+1)*n-d+p,0),y.push(_+m,(i+1)*n-d+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,C=t===wm.FLIP_TILE||t===wm.ROTATE_TILE||t===wm.FLIP_N_ROTATE_TILE?C.concat(e[(i+1)%2]):t===wm.FLIP_ROW||t===wm.ROTATE_ROW||t===wm.FLIP_N_ROTATE_ROW?C.concat(e[i%2]):C.concat(e[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(A){const e=[];M=0,I=0,x=l/n,b=1,e[0]=[M,I,x,I,x,b,M,b],e[1]=[M,I,x,I,x,b,M,b],t!==wm.ROTATE_TILE&&t!==wm.ROTATE_ROW||(e[1]=[1-M,1-I,1-x,1-I,1-x,1-b,1-M,1-b]),t!==wm.FLIP_TILE&&t!==wm.FLIP_ROW||(e[1]=[1-M,I,1-x,I,1-x,b,1-M,b]),t!==wm.FLIP_N_ROTATE_TILE&&t!==wm.FLIP_N_ROTATE_ROW||(e[1]=[M,1-I,x,1-I,x,1-b,M,1-b]);for(let i=0;i<h;i++)y.push(g-l+m,i*n-d+p,0),y.push(g+m,i*n-d+p,0),y.push(g+m,(i+1)*n-d+p,0),y.push(g-l+m,(i+1)*n-d+p,0),T.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,C=t===wm.FLIP_TILE||t===wm.ROTATE_TILE||t===wm.FLIP_N_ROTATE_TILE?C.concat(e[(i+o)%2]):t===wm.FLIP_ROW||t===wm.ROTATE_ROW||t===wm.FLIP_N_ROTATE_ROW?C.concat(e[i%2]):C.concat(e[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const M=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE;_f._ComputeSides(M,y,T,E,C,e.frontUVs,e.backUVs);const I=new _f;I.indices=T,I.positions=y,I.normals=E,I.uvs=C;const x=M===_f.DOUBLESIDE?R.concat(R):R;return I.colors=x,I}function tS(e){const t=e.faceUV||new Array(6),i=e.faceColors,n=e.pattern||wm.NO_FLIP,a=e.width||e.size||1,s=e.height||e.size||1,r=e.depth||e.size||1,o=e.tileWidth||e.tileSize||1,l=e.tileHeight||e.tileSize||1,c=e.alignHorizontal||0,h=e.alignVertical||0,f=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE;for(let e=0;e<6;e++)void 0===t[e]&&(t[e]=new Oh(0,0,1,1)),i&&void 0===i[e]&&(i[e]=new Ch(1,1,1,1));const u=a/2,d=s/2,m=r/2,p=[];for(let e=0;e<2;e++)p[e]=eS({pattern:n,tileWidth:o,tileHeight:l,width:a,height:s,alignVertical:h,alignHorizontal:c,sideOrientation:f});for(let e=2;e<4;e++)p[e]=eS({pattern:n,tileWidth:o,tileHeight:l,width:r,height:s,alignVertical:h,alignHorizontal:c,sideOrientation:f});let _=h;h===wm.BOTTOM?_=wm.TOP:h===wm.TOP&&(_=wm.BOTTOM);for(let e=4;e<6;e++)p[e]=eS({pattern:n,tileWidth:o,tileHeight:l,width:a,height:r,alignVertical:_,alignHorizontal:c,sideOrientation:f});let v=[],g=[],S=[],y=[];const E=[],A=[],C=[],R=[];let T=0,N=0;for(let e=0;e<6;e++){const n=p[e].positions.length;A[e]=[],C[e]=[];for(let t=0;t<n/3;t++)A[e].push(new wh(p[e].positions[3*t],p[e].positions[3*t+1],p[e].positions[3*t+2])),C[e].push(new wh(p[e].normals[3*t],p[e].normals[3*t+1],p[e].normals[3*t+2]));T=p[e].uvs.length,R[e]=[];for(let i=0;i<T;i+=2)R[e][i]=t[e].x+(t[e].z-t[e].x)*p[e].uvs[i],R[e][i+1]=t[e].y+(t[e].w-t[e].y)*p[e].uvs[i+1],dd&&(R[e][i+1]=1-R[e][i+1]);if(S=S.concat(R[e]),y=y.concat(p[e].indices.map((e=>e+N))),N+=A[e].length,i)for(let t=0;t<4;t++)E.push(i[e].r,i[e].g,i[e].b,i[e].a)}const M=new wh(0,0,m),I=Lh.RotationY(Math.PI);v=A[0].map((e=>wh.TransformNormal(e,I).add(M))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),g=C[0].map((e=>wh.TransformNormal(e,I))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),v=v.concat(A[1].map((e=>e.subtract(M))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),g=g.concat(C[1].map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const x=new wh(u,0,0),b=Lh.RotationY(-Math.PI/2);v=v.concat(A[2].map((e=>wh.TransformNormal(e,b).add(x))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),g=g.concat(C[2].map((e=>wh.TransformNormal(e,b))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const P=Lh.RotationY(Math.PI/2);v=v.concat(A[3].map((e=>wh.TransformNormal(e,P).subtract(x))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),g=g.concat(C[3].map((e=>wh.TransformNormal(e,P))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const w=new wh(0,d,0),O=Lh.RotationX(Math.PI/2);v=v.concat(A[4].map((e=>wh.TransformNormal(e,O).add(w))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),g=g.concat(C[4].map((e=>wh.TransformNormal(e,O))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const D=Lh.RotationX(-Math.PI/2);v=v.concat(A[5].map((e=>wh.TransformNormal(e,D).subtract(w))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),g=g.concat(C[5].map((e=>wh.TransformNormal(e,D))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),_f._ComputeSides(f,v,y,g,S);const L=new _f;if(L.indices=y,L.positions=v,L.normals=g,L.uvs=S,i){const e=f===_f.DOUBLESIDE?E.concat(E):E;L.colors=e}return L}function iS(e){const t=0|(e.segments||32),i=e.diameterX||e.diameter||1,n=e.diameterY||e.diameter||1,a=e.diameterZ||e.diameter||1,s=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,r=e.slice&&e.slice<=0?1:e.slice||1,o=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,l=!!e.dedupTopBottomIndices,c=new wh(i/2,n/2,a/2),h=2+t,f=2*h,u=[],d=[],m=[],p=[];for(let e=0;e<=h;e++){const t=e/h,i=t*Math.PI*r;for(let e=0;e<=f;e++){const n=e/f,a=n*Math.PI*2*s,r=Lh.RotationZ(-i),o=Lh.RotationY(a),l=wh.TransformCoordinates(wh.Up(),r),h=wh.TransformCoordinates(l,o),u=h.multiply(c),_=h.divide(c).normalize();d.push(u.x,u.y,u.z),m.push(_.x,_.y,_.z),p.push(n,dd?1-t:t)}if(e>0){const t=d.length/3;for(let i=t-2*(f+1);i+f+2<t;i++)l?(e>1&&(u.push(i),u.push(i+1),u.push(i+f+1)),(e<h||r<1)&&(u.push(i+f+1),u.push(i+1),u.push(i+f+2))):(u.push(i),u.push(i+1),u.push(i+f+1),u.push(i+f+1),u.push(i+1),u.push(i+f+2))}}_f._ComputeSides(o,d,u,m,p,e.frontUVs,e.backUVs);const _=new _f;return _.indices=u,_.positions=d,_.normals=m,_.uvs=p,_}function nS(e,t={},i=null){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return iS(t).applyToMesh(n,t.updatable),n}function aS(e){const t=e.height||2;let i=0===e.diameterTop?0:e.diameterTop||e.diameter||1,n=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;i=i||1e-5,n=n||1e-5;const a=0|(e.tessellation||24),s=0|(e.subdivisions||1),r=!!e.hasRings,o=!!e.enclose,l=0===e.cap?0:e.cap||wm.CAP_ALL,c=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,h=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,f=e.faceUV||new Array(3),u=e.faceColors,d=2+(1+(1!==c&&o?2:0))*(r?s:1);let m;for(m=0;m<d;m++)u&&void 0===u[m]&&(u[m]=new Ch(1,1,1,1));for(m=0;m<d;m++)f&&void 0===f[m]&&(f[m]=new Oh(0,0,1,1));const p=[],_=[],v=[],g=[],S=[],y=2*Math.PI*c/a;let E,A,C;const R=(n-i)/2/t,T=wh.Zero(),N=wh.Zero(),M=wh.Zero(),I=wh.Zero(),x=wh.Zero(),b=Ld.Y;let P,w,O,D=1,L=1,F=0,k=0;for(P=0;P<=s;P++)for(A=P/s,C=(A*(i-n)+n)/2,D=r&&0!==P&&P!==s?2:1,O=0;O<D;O++){for(r&&(L+=O),o&&(L+=2*O),w=0;w<=a;w++)E=w*y,T.x=Math.cos(-E)*C,T.y=-t/2+A*t,T.z=Math.sin(-E)*C,0===i&&P===s?(N.x=v[v.length-3*(a+1)],N.y=v[v.length-3*(a+1)+1],N.z=v[v.length-3*(a+1)+2]):(N.x=T.x,N.z=T.z,N.y=Math.sqrt(N.x*N.x+N.z*N.z)*R,N.normalize()),0===w&&(M.copyFrom(T),I.copyFrom(N)),_.push(T.x,T.y,T.z),v.push(N.x,N.y,N.z),k=r?F!==L?f[L].y:f[L].w:f[L].y+(f[L].w-f[L].y)*A,g.push(f[L].x+(f[L].z-f[L].x)*w/a,dd?1-k:k),u&&S.push(u[L].r,u[L].g,u[L].b,u[L].a);1!==c&&o&&(_.push(T.x,T.y,T.z),_.push(0,T.y,0),_.push(0,T.y,0),_.push(M.x,M.y,M.z),wh.CrossToRef(b,N,x),x.normalize(),v.push(x.x,x.y,x.z,x.x,x.y,x.z),wh.CrossToRef(I,b,x),x.normalize(),v.push(x.x,x.y,x.z,x.x,x.y,x.z),k=r?F!==L?f[L+1].y:f[L+1].w:f[L+1].y+(f[L+1].w-f[L+1].y)*A,g.push(f[L+1].x,dd?1-k:k),g.push(f[L+1].z,dd?1-k:k),k=r?F!==L?f[L+2].y:f[L+2].w:f[L+2].y+(f[L+2].w-f[L+2].y)*A,g.push(f[L+2].x,dd?1-k:k),g.push(f[L+2].z,dd?1-k:k),u&&(S.push(u[L+1].r,u[L+1].g,u[L+1].b,u[L+1].a),S.push(u[L+1].r,u[L+1].g,u[L+1].b,u[L+1].a),S.push(u[L+2].r,u[L+2].g,u[L+2].b,u[L+2].a),S.push(u[L+2].r,u[L+2].g,u[L+2].b,u[L+2].a))),F!==L&&(F=L)}const B=1!==c&&o?a+4:a;for(P=0,L=0;L<s;L++){let e=0,t=0,i=0,n=0;for(w=0;w<a;w++)e=P*(B+1)+w,t=(P+1)*(B+1)+w,i=P*(B+1)+(w+1),n=(P+1)*(B+1)+(w+1),p.push(e,t,i),p.push(n,i,t);1!==c&&o&&(p.push(e+2,t+2,i+2),p.push(n+2,i+2,t+2),p.push(e+4,t+4,i+4),p.push(n+4,i+4,t+4)),P=r?P+2:P+1}const G=e=>{const s=e?i/2:n/2;if(0===s)return;let r,o,l;const h=e?f[d-1]:f[0];let m=null;u&&(m=e?u[d-1]:u[0]);const y=_.length/3,E=e?t/2:-t/2,A=new wh(0,E,0);_.push(A.x,A.y,A.z),v.push(0,e?1:-1,0);const C=h.y+.5*(h.w-h.y);g.push(h.x+.5*(h.z-h.x),dd?1-C:C),m&&S.push(m.r,m.g,m.b,m.a);const R=new Ph(.5,.5);for(l=0;l<=a;l++){r=2*Math.PI*l*c/a;const t=Math.cos(-r),i=Math.sin(-r);o=new wh(t*s,E,i*s);const n=new Ph(t*R.x+.5,i*R.y+.5);_.push(o.x,o.y,o.z),v.push(0,e?1:-1,0);const f=h.y+(h.w-h.y)*n.y;g.push(h.x+(h.z-h.x)*n.x,dd?1-f:f),m&&S.push(m.r,m.g,m.b,m.a)}for(l=0;l<a;l++)e?(p.push(y),p.push(y+(l+2)),p.push(y+(l+1))):(p.push(y),p.push(y+(l+1)),p.push(y+(l+2)))};l!==wm.CAP_START&&l!==wm.CAP_ALL||G(!1),l!==wm.CAP_END&&l!==wm.CAP_ALL||G(!0),_f._ComputeSides(h,_,p,v,g,e.frontUVs,e.backUVs);const U=new _f;return U.indices=p,U.positions=_,U.normals=v,U.uvs=g,u&&(U.colors=S),U}function sS(e,t={},i){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return aS(t).applyToMesh(n,t.updatable),n}function rS(e){const t=[],i=[],n=[],a=[],s=e.diameter||1,r=e.thickness||.5,o=0|(e.tessellation||16),l=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,c=o+1;for(let e=0;e<=o;e++){const l=e/o,h=e*Math.PI*2/o-Math.PI/2,f=Lh.Translation(s/2,0,0).multiply(Lh.RotationY(h));for(let s=0;s<=o;s++){const h=1-s/o,u=s*Math.PI*2/o+Math.PI,d=Math.cos(u),m=Math.sin(u);let p=new wh(d,m,0),_=p.scale(r/2);const v=new Ph(l,h);_=wh.TransformCoordinates(_,f),p=wh.TransformNormal(p,f),i.push(_.x,_.y,_.z),n.push(p.x,p.y,p.z),a.push(v.x,dd?1-v.y:v.y);const g=(e+1)%c,S=(s+1)%c;t.push(e*c+s),t.push(e*c+S),t.push(g*c+s),t.push(e*c+S),t.push(g*c+S),t.push(g*c+s)}}_f._ComputeSides(l,i,t,n,a,e.frontUVs,e.backUVs);const h=new _f;return h.indices=t,h.positions=i,h.normals=n,h.uvs=a,h}function oS(e,t={},i){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return rS(t).applyToMesh(n,t.updatable),n}function lS(e){const t=[],i=[],n=[],a=[],s=e.radius||2,r=e.tube||.5,o=e.radialSegments||32,l=e.tubularSegments||32,c=e.p||2,h=e.q||3,f=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,u=e=>{const t=Math.cos(e),i=Math.sin(e),n=h/c*e,a=Math.cos(n),r=s*(2+a)*.5*t,o=s*(2+a)*i*.5,l=s*Math.sin(n)*.5;return new wh(r,o,l)};let d,m;for(d=0;d<=o;d++){const e=d%o/o*2*c*Math.PI,t=u(e),n=u(e+.01),s=n.subtract(t);let h=n.add(t);const f=wh.Cross(s,h);for(h=wh.Cross(f,s),f.normalize(),h.normalize(),m=0;m<l;m++){const e=m%l/l*2*Math.PI,n=-r*Math.cos(e),s=r*Math.sin(e);i.push(t.x+n*h.x+s*f.x),i.push(t.y+n*h.y+s*f.y),i.push(t.z+n*h.z+s*f.z),a.push(d/o),a.push(dd?1-m/l:m/l)}}for(d=0;d<o;d++)for(m=0;m<l;m++){const e=(m+1)%l,i=d*l+m,n=(d+1)*l+m,a=(d+1)*l+e,s=d*l+e;t.push(s),t.push(n),t.push(i),t.push(s),t.push(a),t.push(n)}_f.ComputeNormals(i,t,n),_f._ComputeSides(f,i,t,n,a,e.frontUVs,e.backUVs);const p=new _f;return p.indices=t,p.positions=i,p.normals=n,p.uvs=a,p}function cS(e,t={},i){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return lS(t).applyToMesh(n,t.updatable),n}_f.CreateGround=Yg,_f.CreateTiledGround=jg,_f.CreateGroundFromHeightMap=Kg,wm.CreateGround=(e,t,i,n,a,s)=>$g(e,{width:t,height:i,subdivisions:n,updatable:s},a),wm.CreateTiledGround=(e,t,i,n,a,s,r,o,l)=>qg(e,{xmin:t,zmin:i,xmax:n,zmax:a,subdivisions:s,precision:r,updatable:l},o),wm.CreateGroundFromHeightMap=(e,t,i,n,a,s,r,o,l,c,h)=>Jg(e,t,{width:i,height:n,subdivisions:a,minHeight:s,maxHeight:r,updatable:l,onReady:c,alphaFilter:h},o),_f.$t=Qg,wm.$t=(e,t,i=null,n,a)=>Zg(e,{size:t,sideOrientation:a,updatable:n},i),_f.CreateTiledPlane=eS,_f.CreateTiledBox=tS,_f.ut=iS,wm.ut=(e,t,i,n,a,s)=>nS(e,{segments:t,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:s,updatable:a},n),_f.ft=aS,wm.ft=(e,t,i,n,a,s,r,o,l)=>{void 0!==r&&r instanceof dv||(void 0!==r&&(l=o||wm.DEFAULTSIDE,o=r),r=s,s=1);return sS(e,{height:t,diameterTop:i,diameterBottom:n,tessellation:a,subdivisions:s,sideOrientation:l,updatable:o},r)},_f.CreateTorus=rS,wm.CreateTorus=(e,t,i,n,a,s,r)=>oS(e,{diameter:t,thickness:i,tessellation:n,sideOrientation:r,updatable:s},a),_f.CreateTorusKnot=lS,wm.CreateTorusKnot=(e,t,i,n,a,s,r,o,l,c)=>cS(e,{radius:t,tube:i,radialSegments:n,tubularSegments:a,p:s,q:r,sideOrientation:c,updatable:l},o),wm._instancedMeshFactory=(e,t)=>{const i=new hS(e,t);if(t.instancedBuffers){i.instancedBuffers={};for(const e in t.instancedBuffers)i.instancedBuffers[e]=t.instancedBuffers[e]}return i};var hS=class extends Bd{get skeleton(){return this._sourceMesh.skeleton}get receiveShadows(){return this._sourceMesh.receiveShadows}_activate(e,t){if(super._activate(e,t),this._sourceMesh.subMeshes||jh.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}get visibility(){return this._sourceMesh.visibility}getIndices(){return this._sourceMesh.getIndices()}set skeleton(e){this._sourceMesh?.skeleton!==e&&ad.Warn("Setting skeleton on an instanced mesh has no effect")}get _positions(){return this._sourceMesh._positions}get lightSources(){return this._sourceMesh._lightSources}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.xt,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}setIndices(e,t=null){return this.tk&&this.tk.setIndices(e,t),this.tk}set receiveShadows(e){this._sourceMesh?.receiveShadows!==e&&ad.Warn("Setting receiveShadows on an instanced mesh has no effect")}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}isReady(e=!1){return this._sourceMesh.isReady(e,!0)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==Xh.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new Lh);const e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,kh.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(kh.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let i;i="object"==typeof e?e:{applySkeleton:e,applyMorph:t};const n=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getData(i,null,$h.PositionKind),n),this}_resyncLightSource(){}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}updateVerticesData(e,t,i,n){return this.tk&&this.tk.updateVerticesData(e,t,i,n),this.tk}get isAnInstance(){return!0}instantiateHierarchy(e=null,t,i){const n=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);n&&i&&i(this,n);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(n,t,i);return n}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}_preActivateForIntermediateRendering(e){return this.tk._preActivateForIntermediateRendering(e)}constructor(e,t){super(e,t.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.addInstance(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice();for(const e of t.getAnimationRanges())null!=e&&this.createAnimationRange(e.name,e.from,e.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}set Ct(e){this._sourceMesh&&e!==this._sourceMesh.Ct&&jh.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}_resyncLightSources(){}getVerticesData(e,t,i){return this._sourceMesh.getVerticesData(e,t,i)}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}get material(){return this._sourceMesh.material}setVerticesData(e,t,i,n){return this.tk&&this.tk.setVerticesData(e,t,i,n),this.tk}set material(e){this._sourceMesh?.material!==e&&ad.Warn("Setting material on an instanced mesh has no effect")}get tk(){return this._sourceMesh}_removeLightSource(){}copyVerticesData(e,t){this._sourceMesh.copyVerticesData(e,t)}set visibility(e){this._sourceMesh?.visibility!==e&&ad.Warn("Setting visibility on an instanced mesh has no effect")}dispose(e,t=!1){this._sourceMesh.removeInstance(this),super.dispose(e,t)}getTotalIndices(){return this._sourceMesh.getTotalIndices()}clone(e,t=null,i,n){const a=(n||this._sourceMesh).createInstance(e);if(Af.DeepCopy(this,a,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(a.parent=t),!i)for(let e=0;e<this.getScene().meshes.length;e++){const t=this.getScene().meshes[e];t.parent===this&&t.clone(t.name,a)}return a.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(a),a}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}get Ct(){return this._sourceMesh.Ct}getLOD(e){if(!e)return this;const t=this.tk.getLODLevels();if(t&&0!==t.length){const t=this.getBoundingInfo();this._currentLOD=this.tk.getLOD(e,t.boundingSphere)}else this._currentLOD=this.tk;return this._currentLOD}getClassName(){return"InstancedMesh"}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}createInstance(e){return this._sourceMesh.createInstance(e)}};wm.prototype.registerInstancedBuffer=function(e,t){if(this._userInstancedBuffersStorage?.vertexBuffers[e]?.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const e of this.instances)e.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new $h(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0);for(const t of this.instances)t.instancedBuffers[e]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},wm.prototype._processInstancedBuffers=function(e,t){const i=e?e.length:0;for(const n in this.instancedBuffers){let a=this._userInstancedBuffersStorage.sizes[n];const s=this._userInstancedBuffersStorage.strides[n],r=(i+1)*s;for(;a<r;)a*=2;this._userInstancedBuffersStorage.data[n].length!=a&&(this._userInstancedBuffersStorage.data[n]=new Float32Array(a),this._userInstancedBuffersStorage.sizes[n]=a,this._userInstancedBuffersStorage.vertexBuffers[n]&&(this._userInstancedBuffersStorage.vertexBuffers[n].dispose(),this._userInstancedBuffersStorage.vertexBuffers[n]=null));const o=this._userInstancedBuffersStorage.data[n];let l=0;if(t){const e=this.instancedBuffers[n];e.toArray?e.toArray(o,l):e.copyToArray?e.copyToArray(o,l):o[l]=e,l+=s}for(let t=0;t<i;t++){const i=e[t].instancedBuffers[n];i.toArray?i.toArray(o,l):i.copyToArray?i.copyToArray(o,l):o[l]=i,l+=s}this._userInstancedBuffersStorage.vertexBuffers[n]?this._userInstancedBuffersStorage.vertexBuffers[n].updateDirectly(o,0):(this._userInstancedBuffersStorage.vertexBuffers[n]=new $h(this.getEngine(),this._userInstancedBuffersStorage.data[n],n,!0,!1,s,!0),this._invalidateInstanceVertexArrayObject())}},wm.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},wm.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},rh("BABYLON.InstancedMesh",hS);var fS={effect:null,subMesh:null},uS=class e extends Gm{setQuaternionArray(e,t){return this._checkUniform(e),this._quaternionsArrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}static ParseFromSnippetAsync(e,t,i=""){return new Promise(((n,a)=>{const s=new Rf;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const a=JSON.parse(JSON.parse(s.responseText).jsonPayload),r=JSON.parse(a.shaderMaterial),o=this.Parse(r,t||xh.LastCreatedScene,i);o.snippetId=e,n(o)}else a("Unable to load the snippet "+e)})),s.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),s.send()}))}hasTexture(e){if(super.hasTexture(e))return!0;for(const t in this._textures)if(this._textures[t]===e)return!0;for(const t in this._textureArrays){const i=this._textureArrays[t];for(let t=0;t<i.length;t++)if(i[t]===e)return!0}return!1}dispose(e,t,i){if(t){let e;for(e in this._textures)this._textures[e].dispose();for(e in this._textureArrays){const t=this._textureArrays[e];for(let e=0;e<t.length;e++)t[e].dispose()}}this._textures={},super.dispose(e,t,i)}setUniformBuffer(e,t){return-1===this._options.uniformBuffers.indexOf(e)&&this._options.uniformBuffers.push(e),this._uniformBuffers[e]=t,this}static Parse(t,i,n){const a=Uh.Parse((()=>new e(t.name,i,t.shaderPath,t.options,t.storeEffectOnSubMeshes)),t,i,n);let s;for(s in t.stencil&&a.stencil.parse(t.stencil,i,n),t.textures)a.setTexture(s,yp.Parse(t.textures[s],i,n));for(s in t.textureArrays){const e=t.textureArrays[s],r=[];for(let t=0;t<e.length;t++)r.push(yp.Parse(e[t],i,n));a.setTextureArray(s,r)}for(s in t.ints)a.setInt(s,t.ints[s]);for(s in t.uints)a.setUInt(s,t.uints[s]);for(s in t.floats)a.setFloat(s,t.floats[s]);for(s in t.floatsArrays)a.setFloats(s,t.floatsArrays[s]);for(s in t.colors3)a.setColor3(s,Ah.FromArray(t.colors3[s]));for(s in t.colors3Arrays){const e=t.colors3Arrays[s].reduce(((e,t,i)=>(i%3==0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>Ah.FromArray(e)));a.setColor3Array(s,e)}for(s in t.colors4)a.setColor4(s,Ch.FromArray(t.colors4[s]));for(s in t.colors4Arrays){const e=t.colors4Arrays[s].reduce(((e,t,i)=>(i%4==0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>Ch.FromArray(e)));a.setColor4Array(s,e)}for(s in t.vectors2)a.setVector2(s,Ph.FromArray(t.vectors2[s]));for(s in t.vectors3)a.setVector3(s,wh.FromArray(t.vectors3[s]));for(s in t.vectors4)a.setVector4(s,Oh.FromArray(t.vectors4[s]));for(s in t.quaternions)a.setQuaternion(s,Dh.FromArray(t.quaternions[s]));for(s in t.matrices)a.setMatrix(s,Lh.FromArray(t.matrices[s]));for(s in t.matrixArray)a._matrixArrays[s]=new Float32Array(t.matrixArray[s]);for(s in t.matrices3x3)a.setMatrix3x3(s,t.matrices3x3[s]);for(s in t.matrices2x2)a.setMatrix2x2(s,t.matrices2x2[s]);for(s in t.vectors2Arrays)a.setArray2(s,t.vectors2Arrays[s]);for(s in t.vectors3Arrays)a.setArray3(s,t.vectors3Arrays[s]);for(s in t.vectors4Arrays)a.setArray4(s,t.vectors4Arrays[s]);for(s in t.quaternionsArrays)a.setArray4(s,t.quaternionsArrays[s]);return a}getClassName(){return"ShaderMaterial"}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}isReadyForSubMesh(e,t,i){return this.isReady(e,i,t)}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setStorageBuffer(e,t){return-1===this._options.storageBuffers.indexOf(e)&&this._options.storageBuffers.push(e),this._storageBuffers[e]=t,this}setTexture(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this}setExternalTexture(e,t){return-1===this._options.externalTextures.indexOf(e)&&this._options.externalTextures.push(e),this._externalTextures[e]=t,this}static ParseFromFileAsync(e,t,i,n=""){return new Promise(((a,s)=>{const r=new Rf;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const t=JSON.parse(r.responseText),s=this.Parse(t,i||xh.LastCreatedScene,n);e&&(s.name=e),a(s)}else s("Unable to load the ShaderMaterial")})),r.open("GET",t),r.send()}))}getActiveTextures(){const e=super.getActiveTextures();for(const t in this._textures)e.push(this._textures[t]);for(const t in this._textureArrays){const i=this._textureArrays[t];for(let t=0;t<i.length;t++)e.push(i[t])}return e}set shaderPath(e){this._shaderPath=e}setTextureSampler(e,t){return-1===this._options.samplerObjects.indexOf(e)&&this._options.samplerObjects.push(e),this._textureSamplers[e]=t,this}get isMultiview(){return this._multiview}setMatrix3x3(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this}setArray3(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this}get options(){return this._options}setMatrix2x2(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this}setQuaternion(e,t){return this._checkUniform(e),this._quaternions[e]=t,this}setArray4(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this}setTextureArray(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}needAlphaTesting(){return this._options.needAlphaTesting}bindOnlyWorldMatrix(e,t){const i=this.getScene(),n=t??this.getEffect();n&&(-1!==this._options.uniforms.indexOf("world")&&n.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(i.getViewMatrix(),this._cachedWorldViewMatrix),n.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(e.multiplyToRef(i.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),n.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&n.setMatrix("view",i.getViewMatrix()))}setUInt(e,t){return this._checkUniform(e),this._uints[e]=t,this}setMatrices(e,t){this._checkUniform(e);const i=new Float32Array(16*t.length);for(let e=0;e<t.length;e++){t[e].copyToArray(i,16*e)}return this._matrixArrays[e]=i,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setArray2(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this}serialize(){const e=Uh.Serialize(this);let t;for(t in e.customType="BABYLON.ShaderMaterial",e.xt=this.xt,e.options=this._options,e.shaderPath=this._shaderPath,e.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,e.stencil=this.stencil.serialize(),e.textures={},this._textures)e.textures[t]=this._textures[t].serialize();for(t in e.textureArrays={},this._textureArrays){e.textureArrays[t]=[];const i=this._textureArrays[t];for(let n=0;n<i.length;n++)e.textureArrays[t].push(i[n].serialize())}for(t in e.ints={},this._ints)e.ints[t]=this._ints[t];for(t in e.uints={},this._uints)e.uints[t]=this._uints[t];for(t in e.floats={},this._floats)e.floats[t]=this._floats[t];for(t in e.floatsArrays={},this._floatsArrays)e.floatsArrays[t]=this._floatsArrays[t];for(t in e.colors3={},this._colors3)e.colors3[t]=this._colors3[t].asArray();for(t in e.colors3Arrays={},this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];for(t in e.colors4={},this._colors4)e.colors4[t]=this._colors4[t].asArray();for(t in e.colors4Arrays={},this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];for(t in e.vectors2={},this._vectors2)e.vectors2[t]=this._vectors2[t].asArray();for(t in e.vectors3={},this._vectors3)e.vectors3[t]=this._vectors3[t].asArray();for(t in e.vectors4={},this._vectors4)e.vectors4[t]=this._vectors4[t].asArray();for(t in e.quaternions={},this._quaternions)e.quaternions[t]=this._quaternions[t].asArray();for(t in e.matrices={},this._matrices)e.matrices[t]=this._matrices[t].asArray();for(t in e.matrixArray={},this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];for(t in e.matrices3x3={},this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];for(t in e.matrices2x2={},this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];for(t in e.vectors2Arrays={},this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in e.vectors3Arrays={},this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in e.vectors4Arrays={},this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];for(t in e.quaternionsArrays={},this._quaternionsArrays)e.quaternionsArrays[t]=this._quaternionsArrays[t];return e}setColor4Array(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}get shaderPath(){return this._shaderPath}bind(e,t,i,n){const a=n&&this._storeEffectOnSubMeshes,s=i??(a?n.effect:this.getEffect());if(!s)return;const r=this.getScene();this._activeEffect=s,this.bindOnlyWorldMatrix(e,i);const o=this._options.uniformBuffers;let l=!1;if(s&&o&&o.length>0&&r.getEngine().supportsUniformBuffers)for(let i=0;i<o.length;++i){switch(o[i]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(s,"Mesh"),t.transferToEffect(e));break;case"Scene":Zd(s,r.getSceneUniformBuffer()),r.finalizeSceneUbo(),l=!0}}const c=t&&a?this._mustRebind(r,s,n,t.visibility):r.getCachedMaterial()!==this;if(s&&c){let e;for(e in l||-1===this._options.uniforms.indexOf("view")||s.setMatrix("view",r.getViewMatrix()),l||-1===this._options.uniforms.indexOf("projection")||s.setMatrix("projection",r.getProjectionMatrix()),l||-1===this._options.uniforms.indexOf("viewProjection")||(s.setMatrix("viewProjection",r.getTransformMatrix()),this._multiview&&s.setMatrix("viewProjectionR",r._transformMatrixR)),r.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&s.setVector3("cameraPosition",r.activeCamera.globalPosition),nm(t,s),Wd(s,this,r),this._useLogarithmicDepth&&jd(a?n.materialDefines:s.defines,s,r),t&&Kd(r,t,s),this._textures)s.setTexture(e,this._textures[e]);for(e in this._textureArrays)s.setTextureArray(e,this._textureArrays[e]);for(e in this._ints)s.setInt(e,this._ints[e]);for(e in this._uints)s.setUInt(e,this._uints[e]);for(e in this._floats)s.setFloat(e,this._floats[e]);for(e in this._floatsArrays)s.setArray(e,this._floatsArrays[e]);for(e in this._colors3)s.setColor3(e,this._colors3[e]);for(e in this._colors3Arrays)s.setArray3(e,this._colors3Arrays[e]);for(e in this._colors4){const t=this._colors4[e];s.setFloat4(e,t.r,t.g,t.b,t.a)}for(e in this._colors4Arrays)s.setArray4(e,this._colors4Arrays[e]);for(e in this._vectors2)s.setVector2(e,this._vectors2[e]);for(e in this._vectors3)s.setVector3(e,this._vectors3[e]);for(e in this._vectors4)s.setVector4(e,this._vectors4[e]);for(e in this._quaternions)s.setQuaternion(e,this._quaternions[e]);for(e in this._matrices)s.setMatrix(e,this._matrices[e]);for(e in this._matrixArrays)s.setMatrices(e,this._matrixArrays[e]);for(e in this._matrices3x3)s.setMatrix3x3(e,this._matrices3x3[e]);for(e in this._matrices2x2)s.setMatrix2x2(e,this._matrices2x2[e]);for(e in this._vectors2Arrays)s.setArray2(e,this._vectors2Arrays[e]);for(e in this._vectors3Arrays)s.setArray3(e,this._vectors3Arrays[e]);for(e in this._vectors4Arrays)s.setArray4(e,this._vectors4Arrays[e]);for(e in this._quaternionsArrays)s.setArray4(e,this._quaternionsArrays[e]);for(e in this._uniformBuffers){const t=this._uniformBuffers[e].getBuffer();t&&s.bindUniformBuffer(t,e)}const i=r.getEngine(),o=i.setExternalTexture;if(o)for(e in this._externalTextures)o.call(i,e,this._externalTextures[e]);const c=i.setTextureSampler;if(c)for(e in this._textureSamplers)c.call(i,e,this._textureSamplers[e]);const h=i.setStorageBuffer;if(h)for(e in this._storageBuffers)h.call(i,e,this._storageBuffers[e])}if(s&&t&&(c||!this.isFrozen)){const e=t.morphTargetManager;e&&e.numInfluencers>0&&Qd(t,s);const i=t.bakedVertexAnimationManager;if(i&&i.isEnabled){const e=a?n._drawWrapper:this._drawWrapper;t.bakedVertexAnimationManager?.bind(s,!!e._wasPreviouslyUsingInstances)}}this._afterBind(t,s,n)}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}constructor(e,t,i,n={},a=!0){super(e,t,a),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new Lh,this._cachedWorldViewProjectionMatrix=new Lh,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=i,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...n}}clone(t){const i=Uh.Clone((()=>new e(t,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);i.name=t,i.id=t,"object"==typeof i._shaderPath&&(i._shaderPath={...i._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((e=>{const t=this._options[e];Array.isArray(t)&&(this._options[e]=t.slice(0))})),this.stencil.copyTo(i.stencil);for(const e in this._textures)i.setTexture(e,this._textures[e]);for(const e in this._textureArrays)i.setTextureArray(e,this._textureArrays[e]);for(const e in this._externalTextures)i.setExternalTexture(e,this._externalTextures[e]);for(const e in this._ints)i.setInt(e,this._ints[e]);for(const e in this._uints)i.setUInt(e,this._uints[e]);for(const e in this._floats)i.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)i.setFloats(e,this._floatsArrays[e]);for(const e in this._colors3)i.setColor3(e,this._colors3[e]);for(const e in this._colors3Arrays)i._colors3Arrays[e]=this._colors3Arrays[e];for(const e in this._colors4)i.setColor4(e,this._colors4[e]);for(const e in this._colors4Arrays)i._colors4Arrays[e]=this._colors4Arrays[e];for(const e in this._vectors2)i.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)i.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)i.setVector4(e,this._vectors4[e]);for(const e in this._quaternions)i.setQuaternion(e,this._quaternions[e]);for(const e in this._quaternionsArrays)i._quaternionsArrays[e]=this._quaternionsArrays[e];for(const e in this._matrices)i.setMatrix(e,this._matrices[e]);for(const e in this._matrixArrays)i._matrixArrays[e]=this._matrixArrays[e].slice();for(const e in this._matrices3x3)i.setMatrix3x3(e,this._matrices3x3[e]);for(const e in this._matrices2x2)i.setMatrix2x2(e,this._matrices2x2[e]);for(const e in this._vectors2Arrays)i.setArray2(e,this._vectors2Arrays[e]);for(const e in this._vectors3Arrays)i.setArray3(e,this._vectors3Arrays[e]);for(const e in this._vectors4Arrays)i.setArray4(e,this._vectors4Arrays[e]);for(const e in this._uniformBuffers)i.setUniformBuffer(e,this._uniformBuffers[e]);for(const e in this._textureSamplers)i.setTextureSampler(e,this._textureSamplers[e]);for(const e in this._storageBuffers)i.setStorageBuffer(e,this._storageBuffers[e]);return i}setDefine(e,t){const i=e.trimEnd()+" ",n=this.options.defines.findIndex((t=>t===e||t.startsWith(i)));return n>=0&&this.options.defines.splice(n,1),("boolean"!=typeof t||t)&&this.options.defines.push(i+t),this}isReady(e,t,i){const n=i&&this._storeEffectOnSubMeshes;if(this.isFrozen){const e=n?i._drawWrapper:this._drawWrapper;if(e.effect&&e._wasPreviouslyReady&&e._wasPreviouslyUsingInstances===t)return!0}const a=this.getScene(),s=a.getEngine(),r=[],o=[],l=new Tp;let c=this._shaderPath,h=this._options.uniforms,f=this._options.uniformBuffers,u=this._options.samplers;s.getCaps().multiview&&a.activeCamera&&a.activeCamera.outputRenderTarget&&a.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,r.push("#define MULTIVIEW"),-1!==h.indexOf("viewProjection")&&-1===h.indexOf("viewProjectionR")&&h.push("viewProjectionR"));for(let e=0;e<this._options.defines.length;e++){const t=0===this._options.defines[e].indexOf("#define")?this._options.defines[e]:`#define ${this._options.defines[e]}`;r.push(t)}for(let e=0;e<this._options.attributes.length;e++)o.push(this._options.attributes[e]);if(e&&e.isVerticesDataPresent($h.ColorKind)&&(-1===o.indexOf($h.ColorKind)&&o.push($h.ColorKind),r.push("#define VERTEXCOLOR")),t&&(r.push("#define INSTANCES"),Jd(o,this._materialHelperNeedsPreviousMatrices),e?.hasThinInstances&&(r.push("#define THIN_INSTANCES"),e&&e.isVerticesDataPresent($h.ColorInstanceKind)&&(o.push($h.ColorInstanceKind),r.push("#define INSTANCESCOLOR")))),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){o.push($h.MatricesIndicesKind),o.push($h.MatricesWeightsKind),e.numBoneInfluencers>4&&(o.push($h.MatricesIndicesExtraKind),o.push($h.MatricesWeightsExtraKind));const t=e.skeleton;r.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),l.addCPUSkinningFallback(0,e),t.isUsingTextureForMatrices?(r.push("#define BONETEXTURE"),-1===h.indexOf("boneTextureWidth")&&h.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(r.push("#define BonesPerMesh "+(t.bones.length+1)),-1===h.indexOf("mBones")&&h.push("mBones"))}else r.push("#define NUM_BONE_INFLUENCERS 0");let d=0;const m=e?e.morphTargetManager:null;if(m){const e=m.supportsUVs&&-1!==r.indexOf("#define UV1"),t=m.supportsTangents&&-1!==r.indexOf("#define TANGENT"),i=m.supportsNormals&&-1!==r.indexOf("#define NORMAL");d=m.numMaxInfluencers||m.numInfluencers,e&&r.push("#define MORPHTARGETS_UV"),t&&r.push("#define MORPHTARGETS_TANGENT"),i&&r.push("#define MORPHTARGETS_NORMAL"),d>0&&r.push("#define MORPHTARGETS"),m.isUsingTextureForTargets&&(r.push("#define MORPHTARGETS_TEXTURE"),-1===h.indexOf("morphTargetTextureIndices")&&h.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),r.push("#define NUM_MORPH_INFLUENCERS "+d);for(let n=0;n<d;n++)o.push($h.PositionKind+n),i&&o.push($h.NormalKind+n),t&&o.push($h.TangentKind+n),e&&o.push($h.UVKind+"_"+n);d>0&&(h=h.slice(),h.push("morphTargetInfluences"),h.push("morphTargetCount"),h.push("morphTargetTextureInfo"),h.push("morphTargetTextureIndices"))}else r.push("#define NUM_MORPH_INFLUENCERS 0");if(e){const t=e.bakedVertexAnimationManager;t&&t.isEnabled&&(r.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===h.indexOf("bakedVertexAnimationSettings")&&h.push("bakedVertexAnimationSettings"),-1===h.indexOf("bakedVertexAnimationTextureSizeInverted")&&h.push("bakedVertexAnimationTextureSizeInverted"),-1===h.indexOf("bakedVertexAnimationTime")&&h.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),im(o,0,r)}for(const e in this._textures)if(!this._textures[e].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&r.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&(Hd(h),Vd(this,a,r)),a.fogEnabled&&e?.applyFog&&a.fogMode!==dv.FOGMODE_NONE&&(r.push("#define FOG"),-1===h.indexOf("view")&&h.push("view"),-1===h.indexOf("vFogInfos")&&h.push("vFogInfos"),-1===h.indexOf("vFogColor")&&h.push("vFogColor")),this._useLogarithmicDepth&&(r.push("#define LOGARITHMICDEPTH"),-1===h.indexOf("logarithmicDepthConstant")&&h.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(h=h.slice(),f=f.slice(),u=u.slice(),c=this.customShaderNameResolve(this.name,h,f,u,r,o));const p=n?i._getDrawWrapper(void 0,!0):this._drawWrapper,_=p?.effect??null,v=p?.defines??null,g=r.join("\n");let S=_;return v!==g&&(S=s.createEffect(c,{attributes:o,uniformsNames:h,uniformBuffersNames:f,samplers:u,defines:g,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:d},shaderLanguage:this._options.shaderLanguage},s),n?i.setEffect(S,g,this._materialContext):p&&p.setEffect(S,g),this._onEffectCreatedObservable&&(fS.effect=S,fS.subMesh=i??e?.subMeshes[0]??null,this._onEffectCreatedObservable.notifyObservers(fS))),p._wasPreviouslyUsingInstances=!!t,!!S?.isReady()&&(_!==S&&a.resetCachedMaterial(),p._wasPreviouslyReady=!0,!0)}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}_checkUniform(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}bindForSubMesh(e,t,i){this.bind(e,t,i._drawWrapperOverride?.effect,i)}setColor3Array(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}};uS.SnippetUrl="https://snippet.babylonjs.com",uS.CreateFromSnippetAsync=uS.ParseFromSnippetAsync,rh("BABYLON.ShaderMaterial",uS),wm._LinesMeshParser=(e,t)=>dS.Parse(e,t);var dS=class e extends wm{dispose(e,t=!1,i){i||this._lineMaterial.dispose(!1,!1,!0),super.dispose(e)}_isShaderMaterial(e){return"ShaderMaterial"===e.getClassName()}static Parse(t,i){const n=new e(t.name,i);return n.color=Ah.FromArray(t.color),n.alpha=t.alpha,n}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const n=this.getScene().getEngine();return this._unIndexed?n.drawArraysType(Am.LineListDrawMode,e.verticesStart,e.verticesCount,i):n.drawElementsType(Am.LineListDrawMode,e.indexStart,e.indexCount,i),this}createInstance(e){const t=new mS(e,this);if(this.instancedBuffers){t.instancedBuffers={};for(const e in this.instancedBuffers)t.instancedBuffers[e]=this.instancedBuffers[e]}return t}get material(){return this._lineMaterial}serialize(e){super.serialize(e),e.color=this.color.asArray(),e.alpha=this.alpha}set material(e){this._lineMaterial=e,this._lineMaterial.fillMode=Am.LineListDrawMode}_bind(e,t){if(!this._geometry)return this;const i=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,i):this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:e,g:t,b:i}=this.color;this._color4.set(e,t,i,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}isReady(){return!!this._shadersLoaded&&(!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady())}async _initShaderSourceAsync(t){this.getScene().getEngine().isWebGPU&&!e.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(mr(),hr))),Promise.resolve().then((()=>(Sr(),pr)))])):await Promise.all([Promise.resolve().then((()=>(Rr(),yr))),Promise.resolve().then((()=>(xr(),Tr)))]),this._shadersLoaded=!0,t.shaderLanguage=this._shaderLanguage,this.material=new uS("colorShader",this.getScene(),"color",t,!1),this.material.doNotSerialize=!0}get checkCollisions(){return!1}constructor(e,t=null,i=null,n=null,a,s,r,o){super(e,t,i,n,a),this.useVertexColor=s,this.useVertexAlpha=r,this.color=new Ah(1,1,1),this.alpha=1,this._shaderLanguage=0,this._shadersLoaded=!1,n&&(this.color=n.color.clone(),this.alpha=n.alpha,this.useVertexColor=n.useVertexColor,this.useVertexAlpha=n.useVertexAlpha),this.intersectionThreshold=.1;const l={attributes:[$h.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null};!1===r?l.needAlphaBlending=!1:l.defines.push("#define VERTEXALPHA"),s?(l.defines.push("#define VERTEXCOLOR"),l.attributes.push($h.ColorKind)):(l.uniforms.push("color"),this._color4=new Ch),o?(this.material=o,this._shadersLoaded=!0):this._initShaderSourceAsync(l)}set checkCollisions(e){}clone(t,i=null,n){return new e(t,this.getScene(),i,this,n)}getClassName(){return"LinesMesh"}};dS.ForceGLSL=!1;var mS=class extends hS{getClassName(){return"InstancedLinesMesh"}constructor(e,t){super(e,t),this.intersectionThreshold=t.intersectionThreshold}};function pS(e){const t=[],i=[],n=e.lines,a=e.colors,s=[];let r=0;for(let e=0;e<n.length;e++){const o=n[e];for(let n=0;n<o.length;n++){const{x:l,y:c,z:h}=o[n];if(i.push(l,c,h),a){const t=a[e],{r:i,g:r,b:o,a:l}=t[n];s.push(i,r,o,l)}n>0&&(t.push(r-1),t.push(r)),r++}}const o=new _f;return o.indices=t,o.positions=i,a&&(o.colors=s),o}function _S(e){const t=e.dashSize||3,i=e.gapSize||1,n=e.dashNb||200,a=e.points,s=[],r=[],o=wh.Zero();let l=0,c=0,h=0,f=0,u=0,d=0,m=0;for(m=0;m<a.length-1;m++)a[m+1].subtractToRef(a[m],o),l+=o.length();for(h=l/n,f=t*h/(t+i),m=0;m<a.length-1;m++){a[m+1].subtractToRef(a[m],o),c=Math.floor(o.length()/h),o.normalize();for(let e=0;e<c;e++)u=h*e,s.push(a[m].x+u*o.x,a[m].y+u*o.y,a[m].z+u*o.z),s.push(a[m].x+(u+f)*o.x,a[m].y+(u+f)*o.y,a[m].z+(u+f)*o.z),r.push(d,d+1),d+=2}const p=new _f;return p.positions=s,p.indices=r,p}function vS(e,t,i=null){const n=t.instance,a=t.lines,s=t.colors;if(n){const e=n.getVerticesData($h.PositionKind);let t,i;s&&(t=n.getVerticesData($h.ColorKind));let r=0,o=0;for(let n=0;n<a.length;n++){const l=a[n];for(let a=0;a<l.length;a++)e[r]=l[a].x,e[r+1]=l[a].y,e[r+2]=l[a].z,s&&t&&(i=s[n],t[o]=i[a].r,t[o+1]=i[a].g,t[o+2]=i[a].b,t[o+3]=i[a].a,o+=4),r+=3}return n.updateVerticesData($h.PositionKind,e,!1,!1),s&&t&&n.updateVerticesData($h.ColorKind,t,!1,!1),n.refreshBoundingInfo(),n}const r=new dS(e,i,null,void 0,void 0,!!s,t.useVertexAlpha,t.material);return pS(t).applyToMesh(r,t.updatable),r}function gS(e,t,i=null){const n=t.colors?[t.colors]:null;return vS(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:n,useVertexAlpha:t.useVertexAlpha,material:t.material},i)}function SS(e,t,i=null){const n=t.points,a=t.instance,s=t.gapSize||1,r=t.dashSize||3;if(a){const e=e=>{const t=wh.Zero(),i=e.length/6;let s=0,r=0,o=0,l=0,c=0,h=0,f=0,u=0;for(f=0;f<n.length-1;f++)n[f+1].subtractToRef(n[f],t),s+=t.length();o=s/i;const d=a._creationDataStorage.dashSize;for(l=d*o/(d+a._creationDataStorage.gapSize),f=0;f<n.length-1;f++)for(n[f+1].subtractToRef(n[f],t),r=Math.floor(t.length()/o),t.normalize(),u=0;u<r&&h<e.length;)c=o*u,e[h]=n[f].x+c*t.x,e[h+1]=n[f].y+c*t.y,e[h+2]=n[f].z+c*t.z,e[h+3]=n[f].x+(c+l)*t.x,e[h+4]=n[f].y+(c+l)*t.y,e[h+5]=n[f].z+(c+l)*t.z,h+=6,u++;for(;h<e.length;)e[h]=n[f].x,e[h+1]=n[f].y,e[h+2]=n[f].z,h+=3};return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&jh.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),a.updateMeshPositions(e,!1),a}const o=new dS(e,i,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return _S(t).applyToMesh(o,t.updatable),o._creationDataStorage=new Mm,o._creationDataStorage.dashSize=r,o._creationDataStorage.gapSize=s,o}_f.CreateLineSystem=pS,_f.CreateDashedLines=_S,wm.Mk=(e,t,i=null,n=!1,a=null)=>gS(e,{points:t,updatable:n,instance:a},i),wm.CreateDashedLines=(e,t,i,n,a,s=null,r,o)=>SS(e,{points:t,dashSize:i,gapSize:n,dashNb:a,updatable:r,instance:o},s);var yS=class extends Ph{constructor(e,t){super(e.x,e.y),this.index=t}},ES=class{computeBounds(){const e=new Ph(this.elements[0].x,this.elements[0].y),t=new Ph(this.elements[0].x,this.elements[0].y);return this.elements.forEach((i=>{i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)})),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}}constructor(){this.elements=[]}add(e){const t=[];return e.forEach((e=>{const i=new yS(e,this.elements.length);t.push(i),this.elements.push(i)})),t}},AS=class{constructor(e,t,i,n=earcut){let a;this._points=new ES,this._outlinepoints=new ES,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=n,this._name=e,this._scene=i||xh.LastCreatedScene,a=t instanceof hp?t.getPoints():t,this._addToepoint(a),this._points.add(a),this._outlinepoints.add(a),void 0===this.bjsEarcut&&jh.Warn("Earcut was not found, the polygon will not be built.")}_addToepoint(e){for(const t of e)this._epoints.push(t.x,t.y)}build(e=!1,t=0,i=2){const n=new wm(this._name,this._scene),a=this.buildVertexData(t,i);return n.setVerticesData($h.PositionKind,a.positions,e),n.setVerticesData($h.NormalKind,a.normals,e),n.setVerticesData($h.UVKind,a.uvs,e),n.setIndices(a.indices),n}buildVertexData(e=0,t=2){const i=new _f,n=[],a=[],s=[],r=this._points.computeBounds();this._points.elements.forEach((e=>{n.push(0,1,0),a.push(e.x,0,e.y),s.push((e.x-r.min.x)/r.width,(e.y-r.min.y)/r.height)}));const o=[],l=this.bjsEarcut(this._epoints,this._eholes,2);for(let e=0;e<l.length;e++)o.push(l[e]);if(e>0){const i=a.length/3;this._points.elements.forEach((t=>{n.push(0,-1,0),a.push(t.x,-e,t.y),s.push(1-(t.x-r.min.x)/r.width,1-(t.y-r.min.y)/r.height)}));const l=o.length;for(let e=0;e<l;e+=3){const t=o[e+0],n=o[e+1],a=o[e+2];o.push(a+i),o.push(n+i),o.push(t+i)}this._addSide(a,n,s,o,r,this._outlinepoints,e,!1,t),this._holes.forEach((i=>{this._addSide(a,n,s,o,r,i,e,!0,t)}))}return i.indices=o,i.positions=a,i.normals=n,i.uvs=s,i}addHole(e){this._points.add(e);const t=new ES;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this}_addSide(e,t,i,n,a,s,r,o,l){let c=e.length/3,h=0;for(let f=0;f<s.elements.length;f++){const u=s.elements[f],d=s.elements[(f+1)%s.elements.length];e.push(u.x,0,u.y),e.push(u.x,-r,u.y),e.push(d.x,0,d.y),e.push(d.x,-r,d.y);const m=s.elements[(f+s.elements.length-1)%s.elements.length],p=s.elements[(f+2)%s.elements.length];let _=new wh(-(d.y-u.y),0,d.x-u.x),v=new wh(-(u.y-m.y),0,u.x-m.x),g=new wh(-(p.y-d.y),0,p.x-d.x);o||(_=_.scale(-1),v=v.scale(-1),g=g.scale(-1));const S=_.normalizeToNew();let y=v.normalizeToNew(),E=g.normalizeToNew();const A=wh.Dot(y,S);y=A>l?A<hh-1?new wh(u.x,0,u.y).subtract(new wh(d.x,0,d.y)).normalize():v.add(_).normalize():S;const C=wh.Dot(g,_);E=C>l?C<hh-1?new wh(d.x,0,d.y).subtract(new wh(u.x,0,u.y)).normalize():g.add(_).normalize():S,i.push(h/a.width,0),i.push(h/a.width,1),h+=_.length(),i.push(h/a.width,0),i.push(h/a.width,1),t.push(y.x,y.y,y.z),t.push(y.x,y.y,y.z),t.push(E.x,E.y,E.z),t.push(E.x,E.y,E.z),o?(n.push(c),n.push(c+2),n.push(c+1),n.push(c+1),n.push(c+2),n.push(c+3)):(n.push(c),n.push(c+1),n.push(c+2),n.push(c+1),n.push(c+3),n.push(c+2)),c+=4}}};function CS(e,t,i,n,a,s,r){const o=i||new Array(3),l=n,c=[],h=r||!1;for(let e=0;e<3;e++)void 0===o[e]&&(o[e]=new Oh(0,0,1,1)),l&&void 0===l[e]&&(l[e]=new Ch(1,1,1,1));const f=e.getVerticesData($h.PositionKind),u=e.getVerticesData($h.NormalKind),d=e.getVerticesData($h.UVKind),m=e.getIndices(),p=f.length/9;let _=0,v=0,g=0,S=0,y=0;const E=[0];if(h)for(let e=p;e<f.length/3;e+=4)v=f[3*(e+2)]-f[3*e],g=f[3*(e+2)+2]-f[3*e+2],S=Math.sqrt(v*v+g*g),y+=S,E.push(y);let A=0,C=0;for(let e=0;e<u.length;e+=3)Math.abs(u[e+1])<.001&&(C=1),Math.abs(u[e+1]-1)<.001&&(C=0),Math.abs(u[e+1]+1)<.001&&(C=2),A=e/3,1===C?(_=A-p,d[2*A]=_%4<1.5?h?o[C].x+(o[C].z-o[C].x)*E[Math.floor(_/4)]/y:o[C].x:h?o[C].x+(o[C].z-o[C].x)*E[Math.floor(_/4)+1]/y:o[C].z,d[2*A+1]=_%2==0?dd?1-o[C].w:o[C].w:dd?1-o[C].y:o[C].y):(d[2*A]=(1-d[2*A])*o[C].x+d[2*A]*o[C].z,d[2*A+1]=(1-d[2*A+1])*o[C].y+d[2*A+1]*o[C].w,dd&&(d[2*A+1]=1-d[2*A+1])),l&&c.push(l[C].r,l[C].g,l[C].b,l[C].a);_f._ComputeSides(t,f,m,u,d,a,s);const R=new _f;if(R.indices=m,R.positions=f,R.normals=u,R.uvs=d,l){const e=t===_f.DOUBLESIDE?c.concat(c):c;R.colors=e}return R}function RS(e,t,i=null,n=earcut){t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation);const a=t.shape,s=t.holes||[],r=t.depth||0,o=t.smoothingThreshold||2,l=[];let c=[];for(let e=0;e<a.length;e++)l[e]=new Ph(a[e].x,a[e].z);l[0].equalsWithEpsilon(l[l.length-1],1e-8)&&l.pop();const h=new AS(e,l,i||xh.LastCreatedScene,n);for(let e=0;e<s.length;e++){c=[];for(let t=0;t<s[e].length;t++)c.push(new Ph(s[e][t].x,s[e][t].z));h.addHole(c)}const f=h.build(!1,r,o);f._originalBuilderSideOrientation=t.sideOrientation;return CS(f,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).applyToMesh(f,t.updatable),f}function TS(e,t,i=null,n=earcut){return RS(e,t,i,n)}function NS(e,t,i=null){const n=t.path,a=t.shape,s=t.scale||1,r=t.rotation||0,o=0===t.cap?0:t.cap||wm.NO_CAP,l=t.updatable,c=wm._GetDefaultSideOrientation(t.sideOrientation),h=t.instance||null,f=t.invertUV||!1,u=t.closeShape||!1;return IS(e,a,n,s,r,null,null,t.closePath||!1,u,o,!1,i,!!l,c,h,f,t.frontUVs||null,t.backUVs||null,t.firstNormal||null,!!t.adjustFrame)}function MS(e,t,i=null){const n=t.path,a=t.shape,s=t.scaleFunction||(()=>1),r=t.rotationFunction||(()=>0),o=t.closePath||t.ribbonCloseArray||!1,l=t.closeShape||t.ribbonClosePath||!1,c=0===t.cap?0:t.cap||wm.NO_CAP,h=t.updatable,f=t.firstNormal||null,u=t.adjustFrame||!1;return IS(e,a,n,null,null,s,r,o,l,c,!0,i,!!h,wm._GetDefaultSideOrientation(t.sideOrientation),t.instance||null,t.invertUV||!1,t.frontUVs||null,t.backUVs||null,f,u)}function IS(e,t,i,n,a,s,r,o,l,c,h,f,u,d,m,p,_,v,g,S){const y=(e,t,i,n,a,s,r,o,l,c,h)=>{const f=i.getTangents(),u=i.getNormals(),d=i.getBinormals(),m=i.getDistances();if(h)for(let e=0;e<f.length;e++)if(0==f[e].x&&0==f[e].y&&0==f[e].z&&f[e].copyFrom(f[e-1]),0==u[e].x&&0==u[e].y&&0==u[e].z&&u[e].copyFrom(u[e-1]),0==d[e].x&&0==d[e].y&&0==d[e].z&&d[e].copyFrom(d[e-1]),e>0){let t=f[e-1];wh.Dot(t,f[e])<0&&f[e].scaleInPlace(-1),t=u[e-1],wh.Dot(t,u[e])<0&&u[e].scaleInPlace(-1),t=d[e-1],wh.Dot(t,d[e])<0&&d[e].scaleInPlace(-1)}let p=0;const _=c&&o?o:()=>null!==s?s:0,v=c&&r?r:()=>null!==a?a:1;let g=l===wm.NO_CAP||l===wm.CAP_END?0:2;const S=kh.Matrix[0];for(let i=0;i<t.length;i++){const a=[],s=_(i,m[i]),r=v(i,m[i]);Lh.RotationAxisToRef(f[i],p,S);for(let n=0;n<e.length;n++){const s=f[i].scale(e[n].z).add(u[i].scale(e[n].x)).add(d[i].scale(e[n].y)),o=wh.Zero();wh.TransformCoordinatesToRef(s,S,o),o.scaleInPlace(r).addInPlace(t[i]),a[n]=o}n[g]=a,p+=s,g++}const y=e=>{const t=Array(),i=wh.Zero();let n;for(n=0;n<e.length;n++)i.addInPlace(e[n]);for(i.scaleInPlace(1/e.length),n=0;n<e.length;n++)t.push(i);return t};switch(l){case wm.NO_CAP:break;case wm.CAP_START:n[0]=y(n[2]),n[1]=n[2];break;case wm.CAP_END:n[g]=n[g-1],n[g+1]=y(n[g-1]);break;case wm.CAP_ALL:n[0]=y(n[2]),n[1]=n[2],n[g]=n[g-1],n[g+1]=y(n[g-1])}return n};let E,A;if(m){const e=m._creationDataStorage;return E=g?e.path3D.update(i,g):e.path3D.update(i),A=y(t,i,e.path3D,e.pathArray,n,a,s,r,e.cap,h,S),m=Vg("",{pathArray:A,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:m},f||void 0)}E=g?new fp(i,g):new fp(i);A=y(t,i,E,new Array,n,a,s,r,c=c<0||c>3?0:c,h,S);const C=Vg(e,{pathArray:A,closeArray:o,closePath:l,updatable:u,sideOrientation:d,invertUV:p,frontUVs:_||void 0,backUVs:v||void 0},f);return C._creationDataStorage.pathArray=A,C._creationDataStorage.path3D=E,C._creationDataStorage.cap=c,C}function xS(e,t,i=null){const n=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,a=void 0===t.closed||t.closed,s=t.shape,r=t.radius||1,o=t.tessellation||64,l=t.clip||0,c=t.updatable,h=wm._GetDefaultSideOrientation(t.sideOrientation),f=t.cap||wm.NO_CAP,u=2*Math.PI,d=[],m=t.invertUV||!1;let p=0,_=0;const v=u/o*n;let g,S;for(p=0;p<=o-l;p++){for(S=[],f!=wm.CAP_START&&f!=wm.CAP_ALL||(S.push(new wh(0,s[0].y,0)),S.push(new wh(Math.cos(p*v)*s[0].x*r,s[0].y,Math.sin(p*v)*s[0].x*r))),_=0;_<s.length;_++)g=new wh(Math.cos(p*v)*s[_].x*r,s[_].y,Math.sin(p*v)*s[_].x*r),S.push(g);f!=wm.CAP_END&&f!=wm.CAP_ALL||(S.push(new wh(Math.cos(p*v)*s[s.length-1].x*r,s[s.length-1].y,Math.sin(p*v)*s[s.length-1].x*r)),S.push(new wh(0,s[s.length-1].y,0))),d.push(S)}return Vg(e,{pathArray:d,closeArray:a,sideOrientation:h,updatable:c,invertUV:m,frontUVs:t.frontUVs,backUVs:t.backUVs},i)}function bS(e){const t=[],i=[],n=[],a=[],s=e.width||e.size||1,r=e.height||e.size||1,o=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,l=s/2,c=r/2;i.push(-l,-c,0),n.push(0,0,-1),a.push(0,dd?1:0),i.push(l,-c,0),n.push(0,0,-1),a.push(1,dd?1:0),i.push(l,c,0),n.push(0,0,-1),a.push(1,dd?0:1),i.push(-l,c,0),n.push(0,0,-1),a.push(0,dd?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),_f._ComputeSides(o,i,t,n,a,e.frontUVs,e.backUVs);const h=new _f;return h.indices=t,h.positions=i,h.normals=n,h.uvs=a,h}function PS(e,t={},i=null){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return bS(t).applyToMesh(n,t.updatable),t.sourcePlane&&(n.translate(t.sourcePlane.normal,-t.sourcePlane.d),n.setDirection(t.sourcePlane.normal.scale(-1))),n}function wS(e,t,i=null){const n=t.path;let a=t.instance,s=1;void 0!==t.radius?s=t.radius:a&&(s=a._creationDataStorage.radius);const r=t.tessellation||64,o=t.radiusFunction||null;let l=t.cap||wm.NO_CAP;const c=t.invertUV||!1,h=t.updatable,f=wm._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;const u=(e,t,i,n,a,s,r,o)=>{const l=t.getTangents(),c=t.getNormals(),h=t.getDistances(),f=2*Math.PI/a*o,u=s||(()=>n);let d,m,p,_;const v=kh.Matrix[0];let g=r===wm.NO_CAP||r===wm.CAP_END?0:2;for(let t=0;t<e.length;t++){m=u(t,h[t]),d=Array(),p=c[t];for(let i=0;i<a;i++)Lh.RotationAxisToRef(l[t],f*i,v),_=d[i]?d[i]:wh.Zero(),wh.TransformCoordinatesToRef(p,v,_),_.scaleInPlace(m).addInPlace(e[t]),d[i]=_;i[g]=d,g++}const S=(t,i)=>{const n=Array();for(let a=0;a<t;a++)n.push(e[i]);return n};switch(r){case wm.NO_CAP:break;case wm.CAP_START:i[0]=S(a,0),i[1]=i[2].slice(0);break;case wm.CAP_END:i[g]=i[g-1].slice(0),i[g+1]=S(a,e.length-1);break;case wm.CAP_ALL:i[0]=S(a,0),i[1]=i[2].slice(0),i[g]=i[g-1].slice(0),i[g+1]=S(a,e.length-1)}return i};let d,m;if(a){const e=a._creationDataStorage,i=t.arc||e.arc;return d=e.path3D.update(n),m=u(n,d,e.pathArray,s,e.tessellation,o,e.cap,i),a=Vg("",{pathArray:m,instance:a}),e.path3D=d,e.pathArray=m,e.arc=i,e.radius=s,a}d=new fp(n);l=l<0||l>3?0:l,m=u(n,d,new Array,s,r,o,l,t.arc);const p=Vg(e,{pathArray:m,closePath:!0,closeArray:!1,updatable:h,sideOrientation:f,invertUV:c,frontUVs:t.frontUVs,backUVs:t.backUVs},i);return p._creationDataStorage.pathArray=m,p._creationDataStorage.path3D=d,p._creationDataStorage.tessellation=r,p._creationDataStorage.cap=l,p._creationDataStorage.arc=t.arc,p._creationDataStorage.radius=s,p}function OS(e){const t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const i=e.type&&(e.type<0||e.type>=t.length)?0:e.type||0,n=e.size,a=e.sizeX||n||1,s=e.sizeY||n||1,r=e.sizeZ||n||1,o=e.custom||t[i],l=o.face.length,c=e.faceUV||new Array(l),h=e.faceColors,f=void 0===e.flat||e.flat,u=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,d=[],m=[],p=[],_=[],v=[];let g=0,S=0;const y=[];let E,A,C,R,T,N,M=0,I=0;if(f)for(I=0;I<l;I++)h&&void 0===h[I]&&(h[I]=new Ch(1,1,1,1)),c&&void 0===c[I]&&(c[I]=new Oh(0,0,1,1));if(f)for(I=0;I<l;I++){const e=o.face[I].length;for(C=2*Math.PI/e,R=.5*Math.tan(C/2),T=.5,M=0;M<e;M++)d.push(o.vertex[o.face[I][M]][0]*a,o.vertex[o.face[I][M]][1]*s,o.vertex[o.face[I][M]][2]*r),y.push(g),g++,E=c[I].x+(c[I].z-c[I].x)*(.5+R),A=c[I].y+(c[I].w-c[I].y)*(T-.5),_.push(E,dd?1-A:A),N=R*Math.cos(C)-T*Math.sin(C),T=R*Math.sin(C)+T*Math.cos(C),R=N,h&&v.push(h[I].r,h[I].g,h[I].b,h[I].a);for(M=0;M<e-2;M++)m.push(y[0+S],y[M+2+S],y[M+1+S]);S+=e}else{for(M=0;M<o.vertex.length;M++)d.push(o.vertex[M][0]*a,o.vertex[M][1]*s,o.vertex[M][2]*r),_.push(0,dd?1:0);for(I=0;I<l;I++)for(M=0;M<o.face[I].length-2;M++)m.push(o.face[I][0],o.face[I][M+2],o.face[I][M+1])}_f.ComputeNormals(d,m,p),_f._ComputeSides(u,d,m,p,_,e.frontUVs,e.backUVs);const x=new _f;return x.positions=d,x.indices=m,x.normals=p,x.uvs=_,h&&f&&(x.colors=v),x}function DS(e,t={},i=null){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return OS(t).applyToMesh(n,t.updatable),n}function LS(e){const t=e.sideOrientation||_f.DEFAULTSIDE,i=e.radius||1,n=void 0===e.flat||e.flat,a=0|(e.subdivisions||4),s=e.radiusX||i,r=e.radiusY||i,o=e.radiusZ||i,l=(1+Math.sqrt(5))/2,c=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],h=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],f=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],u=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],d=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],m=[],p=[],_=[],v=[];let g=0;const S=new Array(3),y=new Array(3);let E;for(E=0;E<3;E++)S[E]=wh.Zero(),y[E]=Ph.Zero();for(let e=0;e<20;e++){for(E=0;E<3;E++){const t=h[3*e+E];S[E].copyFromFloats(c[3*f[t]],c[3*f[t]+1],c[3*f[t]+2]),S[E].normalize(),y[E].copyFromFloats(.134765625*u[2*t]+.05859375+-.0390625*d[e],.2333984375*u[2*t+1]+.025390625+.01953125*d[e])}const t=(e,t,i,l)=>{const c=wh.Lerp(S[0],S[2],t/a),h=wh.Lerp(S[1],S[2],t/a),f=a===t?S[2]:wh.Lerp(c,h,e/(a-t));let u;if(f.normalize(),n){const e=wh.Lerp(S[0],S[2],l/a),t=wh.Lerp(S[1],S[2],l/a);u=wh.Lerp(e,t,i/(a-l))}else u=new wh(f.x,f.y,f.z);u.x/=s,u.y/=r,u.z/=o,u.normalize();const d=Ph.Lerp(y[0],y[2],t/a),E=Ph.Lerp(y[1],y[2],t/a),A=a===t?y[2]:Ph.Lerp(d,E,e/(a-t));p.push(f.x*s,f.y*r,f.z*o),_.push(u.x,u.y,u.z),v.push(A.x,dd?1-A.y:A.y),m.push(g),g++};for(let e=0;e<a;e++)for(let i=0;i+e<a;i++)t(i,e,i+1/3,e+1/3),t(i+1,e,i+1/3,e+1/3),t(i,e+1,i+1/3,e+1/3),i+e+1<a&&(t(i+1,e,i+2/3,e+2/3),t(i+1,e+1,i+2/3,e+2/3),t(i,e+1,i+2/3,e+2/3))}_f._ComputeSides(t,p,m,_,v,e.frontUVs,e.backUVs);const A=new _f;return A.indices=m,A.positions=p,A.normals=_,A.uvs=v,A}function FS(e,t={},i=null){const n=new wm(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;return LS(t).applyToMesh(n,t.updatable),n}_f.CreatePolygon=CS,wm.CreatePolygon=(e,t,i,n,a,s,r=earcut)=>RS(e,{shape:t,holes:n,updatable:a,sideOrientation:s},i,r),wm.ExtrudePolygon=(e,t,i,n,a,s,r,o=earcut)=>TS(e,{shape:t,holes:a,depth:i,updatable:s,sideOrientation:r},n,o),wm.ExtrudeShape=(e,t,i,n,a,s,r=null,o,l,c)=>NS(e,{shape:t,path:i,scale:n,rotation:a,cap:0===s?0:s||wm.NO_CAP,sideOrientation:l,instance:c,updatable:o},r),wm.ExtrudeShapeCustom=(e,t,i,n,a,s,r,o,l,c,h,f)=>MS(e,{shape:t,path:i,scaleFunction:n,rotationFunction:a,ribbonCloseArray:s,ribbonClosePath:r,cap:0===o?0:o||wm.NO_CAP,sideOrientation:h,instance:f,updatable:c},l),wm.kk=(e,t,i,n,a,s,r)=>xS(e,{shape:t,radius:i,tessellation:n,sideOrientation:r,updatable:s},a),_f.Vt=bS,wm.Vt=(e,t,i,n,a)=>PS(e,{size:t,width:t,height:t,sideOrientation:a,updatable:n},i),wm.CreateTube=(e,t,i,n,a,s,r,o,l,c)=>wS(e,{path:t,radius:i,tessellation:n,radiusFunction:a,arc:1,cap:s,updatable:o,sideOrientation:l,instance:c},r),_f.CreatePolyhedron=OS,wm.CreatePolyhedron=(e,t,i)=>DS(e,t,i),_f.CreateIcoSphere=LS,wm.CreateIcoSphere=(e,t,i)=>FS(e,t,i);var kS=new wh(1,0,0),BS=new wh(-1,0,0),GS=new wh(0,1,0),US=new wh(0,-1,0),HS=new wh(0,0,1),VS=new wh(0,0,-1),WS=class e{clone(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,this.localPositionOverride?.slice(),this.localNormalOverride?.slice(),this.matrixIndicesOverride?.slice(),this.matrixWeightsOverride?.slice())}constructor(e=wh.Zero(),t=wh.Up(),i=Ph.Zero(),n=0,a=0,s=null,r=null,o=null,l=null){this.position=e,this.normal=t,this.uv=i,this.vertexIdx=n,this.vertexIdxForBones=a,this.localPositionOverride=s,this.localNormalOverride=r,this.matrixIndicesOverride=o,this.matrixWeightsOverride=l}};function zS(e,t,i){const n=!!t.skeleton,a=i.localMode||n,s=t.getIndices(),r=n?t.getPositionData(!0,!0):t.getVerticesData($h.PositionKind),o=n?t.getNormalsData(!0,!0):t.getVerticesData($h.NormalKind),l=a?n?t.getVerticesData($h.PositionKind):r:null,c=a?n?t.getVerticesData($h.NormalKind):o:null,h=t.getVerticesData($h.UVKind),f=n?t.getVerticesData($h.MatricesIndicesKind):null,u=n?t.getVerticesData($h.MatricesWeightsKind):null,d=n?t.getVerticesData($h.MatricesIndicesExtraKind):null,m=n?t.getVerticesData($h.MatricesWeightsExtraKind):null,p=i.position||wh.Zero();let _=i.normal||wh.Up();const v=i.size||wh.One(),g=i.angle||0;if(!_){const e=new wh(0,0,1),i=t.getScene().activeCamera,n=wh.TransformCoordinates(e,i.getWorldMatrix());_=i.globalPosition.subtract(n)}const S=-Math.atan2(_.z,_.x)-Math.PI/2,y=Math.sqrt(_.x*_.x+_.z*_.z),E=Math.atan2(_.y,y),A=new _f;A.indices=[],A.positions=[],A.normals=[],A.uvs=[],A.matricesIndices=n?[]:null,A.matricesWeights=n?[]:null,A.matricesIndicesExtra=d?[]:null,A.matricesWeightsExtra=m?[]:null;let C=0;const R=(e,t)=>{const n=new WS;if(!s||!r||!o)return n;const a=s[e];if(n.vertexIdx=3*a,n.vertexIdxForBones=4*a,n.position=new wh(r[3*a],r[3*a+1],r[3*a+2]),wh.TransformCoordinatesToRef(n.position,t,n.position),n.normal=new wh(o[3*a],o[3*a+1],o[3*a+2]),wh.TransformNormalToRef(n.normal,t,n.normal),i.captureUVS&&h){const e=h[2*a+1];n.uv=new Ph(h[2*a],dd?1-e:e)}return n},T=[0,0,0,0],N=(e,t)=>{if(0===e.length)return e;const i=.5*Math.abs(wh.Dot(v,t)),n=(e,t,i,n)=>{for(let a=0;a<n;++a)if(e[i+a]===t)return i+a;return-1},a=(e,a)=>{const s=wh.GetClipFactor(e.position,a.position,t,i);let r=T,o=T;if(f&&u){const t=e.matrixIndicesOverride?0:e.vertexIdxForBones,i=e.matrixIndicesOverride??f,l=e.matrixWeightsOverride??u,c=a.matrixIndicesOverride?0:a.vertexIdxForBones,h=a.matrixIndicesOverride??f,d=a.matrixWeightsOverride??u;r=[0,0,0,0],o=[0,0,0,0];let m=0;for(let e=0;e<4;++e)if(l[t+e]>0){const a=n(h,i[t+e],c,4);r[m]=i[t+e],o[m]=vh.Lerp(l[t+e],a>=0?d[a]:0,s),m++}for(let e=0;e<4&&m<4;++e){const a=h[c+e];-1===n(i,a,t,4)&&(r[m]=a,o[m]=vh.Lerp(0,d[c+e],s),m++)}const p=o[0]+o[1]+o[2]+o[3];o[0]/=p,o[1]/=p,o[2]/=p,o[3]/=p}const h=e.localPositionOverride?e.localPositionOverride[0]:l?.[e.vertexIdx]??0,d=e.localPositionOverride?e.localPositionOverride[1]:l?.[e.vertexIdx+1]??0,m=e.localPositionOverride?e.localPositionOverride[2]:l?.[e.vertexIdx+2]??0,p=a.localPositionOverride?a.localPositionOverride[0]:l?.[a.vertexIdx]??0,_=a.localPositionOverride?a.localPositionOverride[1]:l?.[a.vertexIdx+1]??0,v=a.localPositionOverride?a.localPositionOverride[2]:l?.[a.vertexIdx+2]??0,g=e.localNormalOverride?e.localNormalOverride[0]:c?.[e.vertexIdx]??0,S=e.localNormalOverride?e.localNormalOverride[1]:c?.[e.vertexIdx+1]??0,y=e.localNormalOverride?e.localNormalOverride[2]:c?.[e.vertexIdx+2]??0,E=g+((a.localNormalOverride?a.localNormalOverride[0]:c?.[a.vertexIdx]??0)-g)*s,A=S+((a.localNormalOverride?a.localNormalOverride[1]:c?.[a.vertexIdx+1]??0)-S)*s,C=y+((a.localNormalOverride?a.localNormalOverride[2]:c?.[a.vertexIdx+2]??0)-y)*s,R=Math.sqrt(E*E+A*A+C*C);return new WS(wh.Lerp(e.position,a.position,s),wh.Lerp(e.normal,a.normal,s).normalize(),Ph.Lerp(e.uv,a.uv,s),-1,-1,l?[h+(p-h)*s,d+(_-d)*s,m+(v-m)*s]:null,c?[E/R,A/R,C/R]:null,r,o)};let s=null;e.length>3&&(s=[]);for(let n=0;n<e.length;n+=3){let r=0,o=null,l=null,c=null,h=null;const f=wh.Dot(e[n].position,t)-i>0,u=wh.Dot(e[n+1].position,t)-i>0,d=wh.Dot(e[n+2].position,t)-i>0;switch(r=(f?1:0)+(u?1:0)+(d?1:0),r){case 0:e.length>3?(s.push(e[n]),s.push(e[n+1]),s.push(e[n+2])):s=e;break;case 1:if(s=s??new Array,f&&(o=e[n+1],l=e[n+2],c=a(e[n],o),h=a(e[n],l)),u){o=e[n],l=e[n+2],c=a(e[n+1],o),h=a(e[n+1],l),s.push(c),s.push(l.clone()),s.push(o.clone()),s.push(l.clone()),s.push(c.clone()),s.push(h);break}d&&(o=e[n],l=e[n+1],c=a(e[n+2],o),h=a(e[n+2],l)),o&&l&&c&&h&&(s.push(o.clone()),s.push(l.clone()),s.push(c),s.push(h),s.push(c.clone()),s.push(l.clone()));break;case 2:s=s??new Array,f||(o=e[n].clone(),l=a(o,e[n+1]),c=a(o,e[n+2]),s.push(o),s.push(l),s.push(c)),u||(o=e[n+1].clone(),l=a(o,e[n+2]),c=a(o,e[n]),s.push(o),s.push(l),s.push(c)),d||(o=e[n+2].clone(),l=a(o,e[n]),c=a(o,e[n+1]),s.push(o),s.push(l),s.push(c))}}return s},M=t instanceof wm?t:null,I=M?._thinInstanceDataStorage.matrixData,x=M?.thinInstanceCount||1,b=kh.Matrix[0];b.copyFrom(Lh.IdentityReadOnly);for(let e=0;e<x;++e){if(M?.hasThinInstances&&I){const t=16*e;b.setRowFromFloats(0,I[t+0],I[t+1],I[t+2],I[t+3]),b.setRowFromFloats(1,I[t+4],I[t+5],I[t+6],I[t+7]),b.setRowFromFloats(2,I[t+8],I[t+9],I[t+10],I[t+11]),b.setRowFromFloats(3,I[t+12],I[t+13],I[t+14],I[t+15])}const n=Lh.lt(S,E,g).multiply(Lh.Translation(p.x,p.y,p.z)),r=Lh.Invert(n),o=t.getWorldMatrix(),h=b.multiply(o).multiply(r),_=new Array(3);for(let e=0;e<s.length;e+=3){let t=_;if(t[0]=R(e,h),t[1]=R(e+1,h),t[2]=R(e+2,h),!(i.cullBackFaces&&-t[0].normal.z<=0&&-t[1].normal.z<=0&&-t[2].normal.z<=0)&&(t=N(t,kS),t&&(t=N(t,BS),t&&(t=N(t,GS),t&&(t=N(t,US),t&&(t=N(t,HS),t&&(t=N(t,VS),t)))))))for(let e=0;e<t.length;e++){const n=t[e];if(A.indices.push(C),a?(n.localPositionOverride?(A.positions[3*C]=n.localPositionOverride[0],A.positions[3*C+1]=n.localPositionOverride[1],A.positions[3*C+2]=n.localPositionOverride[2]):l&&(A.positions[3*C]=l[n.vertexIdx],A.positions[3*C+1]=l[n.vertexIdx+1],A.positions[3*C+2]=l[n.vertexIdx+2]),n.localNormalOverride?(A.normals[3*C]=n.localNormalOverride[0],A.normals[3*C+1]=n.localNormalOverride[1],A.normals[3*C+2]=n.localNormalOverride[2]):c&&(A.normals[3*C]=c[n.vertexIdx],A.normals[3*C+1]=c[n.vertexIdx+1],A.normals[3*C+2]=c[n.vertexIdx+2])):(n.position.toArray(A.positions,3*C),n.normal.toArray(A.normals,3*C)),A.matricesIndices&&A.matricesWeights&&(n.matrixIndicesOverride?(A.matricesIndices[4*C]=n.matrixIndicesOverride[0],A.matricesIndices[4*C+1]=n.matrixIndicesOverride[1],A.matricesIndices[4*C+2]=n.matrixIndicesOverride[2],A.matricesIndices[4*C+3]=n.matrixIndicesOverride[3]):(f&&(A.matricesIndices[4*C]=f[n.vertexIdxForBones],A.matricesIndices[4*C+1]=f[n.vertexIdxForBones+1],A.matricesIndices[4*C+2]=f[n.vertexIdxForBones+2],A.matricesIndices[4*C+3]=f[n.vertexIdxForBones+3]),d&&A.matricesIndicesExtra&&(A.matricesIndicesExtra[4*C]=d[n.vertexIdxForBones],A.matricesIndicesExtra[4*C+1]=d[n.vertexIdxForBones+1],A.matricesIndicesExtra[4*C+2]=d[n.vertexIdxForBones+2],A.matricesIndicesExtra[4*C+3]=d[n.vertexIdxForBones+3])),n.matrixWeightsOverride?(A.matricesWeights[4*C]=n.matrixWeightsOverride[0],A.matricesWeights[4*C+1]=n.matrixWeightsOverride[1],A.matricesWeights[4*C+2]=n.matrixWeightsOverride[2],A.matricesWeights[4*C+3]=n.matrixWeightsOverride[3]):(u&&(A.matricesWeights[4*C]=u[n.vertexIdxForBones],A.matricesWeights[4*C+1]=u[n.vertexIdxForBones+1],A.matricesWeights[4*C+2]=u[n.vertexIdxForBones+2],A.matricesWeights[4*C+3]=u[n.vertexIdxForBones+3]),m&&A.matricesWeightsExtra&&(A.matricesWeightsExtra[4*C]=m[n.vertexIdxForBones],A.matricesWeightsExtra[4*C+1]=m[n.vertexIdxForBones+1],A.matricesWeightsExtra[4*C+2]=m[n.vertexIdxForBones+2],A.matricesWeightsExtra[4*C+3]=m[n.vertexIdxForBones+3]))),i.captureUVS)n.uv.toArray(A.uvs,2*C);else{A.uvs.push(.5+n.position.x/v.x);const e=.5+n.position.y/v.y;A.uvs.push(dd?1-e:e)}C++}}}0===A.indices.length&&(A.indices=null),0===A.positions.length&&(A.positions=null),0===A.normals.length&&(A.normals=null),0===A.uvs.length&&(A.uvs=null),0===A.matricesIndices?.length&&(A.matricesIndices=null),0===A.matricesWeights?.length&&(A.matricesWeights=null),0===A.matricesIndicesExtra?.length&&(A.matricesIndicesExtra=null),0===A.matricesWeightsExtra?.length&&(A.matricesWeightsExtra=null);const P=new wm(e,t.getScene());return A.applyToMesh(P),a?(P.skeleton=t.skeleton,P.parent=t):(P.position=p.clone(),P.rotation=new wh(E,S,g)),P.computeWorldMatrix(!0),P.refreshBoundingInfo(!0,!0),P}function XS(e={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){const t=0|Math.max(e.subdivisions?e.subdivisions:2,1),i=0|Math.max(e.tessellation?e.tessellation:16,3),n=Math.max(e.height?e.height:1,0),a=Math.max(e.radius?e.radius:.25,0),s=0|Math.max(e.capSubdivisions?e.capSubdivisions:6,1),r=i,o=t,l=Math.max(e.radiusTop?e.radiusTop:a,0),c=Math.max(e.radiusBottom?e.radiusBottom:a,0),h=n-(l+c),f=2*Math.PI,u=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:s,1),d=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:s,1),m=Math.acos((c-l)/n);let p=[];const _=[],v=[],g=[];let S=0;const y=[],E=.5*h,A=.5*Math.PI;let C,R;const T=wh.Zero(),N=wh.Zero(),M=Math.cos(m),I=Math.sin(m),x=new Ph(l*I,E+l*M).subtract(new Ph(c*I,c*M-E)).length(),b=l*m+x+c*(A-m);let P=0;for(R=0;R<=u;R++){const e=[],t=A-m*(R/u);P+=l*m/u;const i=Math.cos(t),n=Math.sin(t),a=i*l;for(C=0;C<=r;C++){const t=C/r,s=t*f+0,o=Math.sin(s),c=Math.cos(s);N.x=a*o,N.y=E+n*l,N.z=a*c,_.push(N.x,N.y,N.z),T.set(i*o,n,i*c),v.push(T.x,T.y,T.z),g.push(t,dd?P/b:1-P/b),e.push(S),S++}y.push(e)}const w=n-l-c+M*l-M*c,O=I*(c-l)/w;for(R=1;R<=o;R++){const e=[];P+=x/o;const t=I*(R*(c-l)/o+l);for(C=0;C<=r;C++){const i=C/r,n=i*f+0,a=Math.sin(n),s=Math.cos(n);N.x=t*a,N.y=E+M*l-R*w/o,N.z=t*s,_.push(N.x,N.y,N.z),T.set(a,O,s).normalize(),v.push(T.x,T.y,T.z),g.push(i,dd?P/b:1-P/b),e.push(S),S++}y.push(e)}for(R=1;R<=d;R++){const e=[],t=A-m-(Math.PI-m)*(R/d);P+=c*m/d;const i=Math.cos(t),n=Math.sin(t),a=i*c;for(C=0;C<=r;C++){const t=C/r,s=t*f+0,o=Math.sin(s),l=Math.cos(s);N.x=a*o,N.y=n*c-E,N.z=a*l,_.push(N.x,N.y,N.z),T.set(i*o,n,i*l),v.push(T.x,T.y,T.z),g.push(t,dd?P/b:1-P/b),e.push(S),S++}y.push(e)}for(C=0;C<r;C++)for(R=0;R<u+o+d;R++){const e=y[R][C],t=y[R+1][C],i=y[R+1][C+1],n=y[R][C+1];p.push(e),p.push(t),p.push(n),p.push(t),p.push(i),p.push(n)}if(p=p.reverse(),e.orientation&&!e.orientation.equals(wh.Up())){const t=new Lh;e.orientation.clone().scale(.5*Math.PI).cross(wh.Up()).toQuaternion().toRotationMatrix(t);const i=wh.Zero();for(let e=0;e<_.length;e+=3)i.set(_[e],_[e+1],_[e+2]),wh.TransformCoordinatesToRef(i.clone(),t,i),_[e]=i.x,_[e+1]=i.y,_[e+2]=i.z}const D=new _f;return D.positions=_,D.normals=v,D.uvs=g,D.indices=p,D}function YS(e,t={orientation:wh.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},i=null){const n=new wm(e,i);return XS(t).applyToMesh(n,t.updatable),n}wm.CreateDecal=(e,t,i,n,a,s)=>zS(e,t,{position:i,normal:n,size:a,angle:s}),wm.CreateCapsule=(e,t,i)=>YS(e,t,i),_f.CreateCapsule=XS;var jS=class e{rotate120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),jh.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),jh.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=e-i-this.y,this.y=t+i,this}clone(){return new e(this.x,this.y)}rotateNeg60About(e){const t=this.x;return this.x=t+this.y-e.y,this.y=e.x+e.y-t,this}rotate60About(e){const t=this.x;return this.x=e.x+e.y-this.y,this.y=t+this.y-e.x,this}rotateNeg120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),jh.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),jh.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-t,this.y=e+t-i-this.y,this}constructor(e=0,t=0){this.x=e,this.y=t,e!==Math.floor(e)&&(e=Math.floor(e),jh.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(t=Math.floor(t),jh.Warn("y is not an integer, floor(y) used"))}toCartesianOrigin(e,t){const i=wh.Zero();return i.x=e.x+2*this.x*t+this.y*t,i.y=e.y+Math.sqrt(3)*this.y*t,i}static Zero(){return new e(0,0)}},KS=class{build(e,t){const i=[],n=jS.Zero(),a=new jS(e,t),s=new jS(-t,e+t);i.push(n,a,s);for(let n=t;n<e+1;n++)for(let t=0;t<e+1-n;t++)i.push(new jS(t,n));if(t>0){const n=vh.HCF(e,t),a=e/n,s=t/n;for(let r=1;r<n;r++)i.push(new jS(r*a,r*s)),i.push(new jS(-r*s,r*(a+s))),i.push(new jS(e-r*(a+s),t+r*a));const r=e/t;for(let n=1;n<t;n++)for(let a=0;a<n*r;a++)i.push(new jS(a,n)),i.push(new jS(a,n).rotate120(e,t)),i.push(new jS(a,n).rotateNeg120(e,t))}i.sort(((e,t)=>e.x-t.x)),i.sort(((e,t)=>e.y-t.y));const r=new Array(e+t+1),o=new Array(e+t+1);for(let e=0;e<r.length;e++)r[e]=1/0,o[e]=-1/0;let l=0,c=0;const h=i.length;for(let e=0;e<h;e++)c=i[e].x,l=i[e].y,r[l]=Math.min(c,r[l]),o[l]=Math.max(c,o[l]);const f=(i,n)=>{const a=i.clone();return"A"===n&&a.rotateNeg120(e,t),"B"===n&&a.rotate120(e,t),a.x<0?a.y:a.x+a.y},u=[],d=[],m=[],p=[],_={},v=[];let g=-1,S=-1;for(let e=0;e<h;e++)u[e]=i[e].toCartesianOrigin(new jS(0,0),.5),d[e]=f(i[e],"O"),m[e]=f(i[e],"A"),p[e]=f(i[e],"B"),d[e]===m[e]&&m[e]===p[e]?(g=3,S=d[e]):d[e]===m[e]?(g=4,S=d[e]):m[e]===p[e]?(g=5,S=m[e]):p[e]===d[e]&&(g=6,S=d[e]),d[e]<m[e]&&d[e]<p[e]&&(g=2,S=d[e]),m[e]<d[e]&&m[e]<p[e]&&(g=1,S=m[e]),p[e]<m[e]&&p[e]<d[e]&&(g=0,S=p[e]),v.push([g,S,i[e].x,i[e].y]);v.sort(((e,t)=>e[2]-t[2])),v.sort(((e,t)=>e[3]-t[3])),v.sort(((e,t)=>e[1]-t[1])),v.sort(((e,t)=>e[0]-t[0]));for(let e=0;e<v.length;e++)_[v[e][2]+"|"+v[e][3]]=[v[e][0],v[e][1],e];return this.m=e,this.n=t,this.vertices=i,this.vertByDist=_,this.cartesian=u,this.min=r,this.max=o,this}mapABOBtoBAOA(){const e=new jS(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let n=0;n<3;n++)e.x=this.isoVecsABOB[t][n].x,e.y=this.isoVecsABOB[t][n].y,1===this.vertexTypes[t][n]&&e.rotate120(this.m,this.n),i.push(e.clone());this.isoVecsBAOA.push(i)}}mapABOBtoOBOA(){const e=new jS(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let n=0;n<3;n++)e.x=this.isoVecsABOB[t][n].x,e.y=this.isoVecsABOB[t][n].y,0===this.vertexTypes[t][n]&&e.rotateNeg120(this.m,this.n),i.push(e.clone());this.isoVecsOBOA.push(i)}}MapToFace(e,t){const i=this.IDATA.face[e],n=i[2],a=i[1],s=i[0],r=wh.FromArray(this.IDATA.vertex[n]),o=wh.FromArray(this.IDATA.vertex[a]),l=wh.FromArray(this.IDATA.vertex[s]),c=o.subtract(r),h=l.subtract(r),f=c.scale(this.coau).add(h.scale(this.cobu)),u=c.scale(this.coav).add(h.scale(this.cobv)),d=[];let m,p=kh.Vector3[0];for(let i=0;i<this.cartesian.length;i++)p=f.scale(this.cartesian[i].x).add(u.scale(this.cartesian[i].y)).add(r),d[i]=[p.x,p.y,p.z],m=e+"|"+this.vertices[i].x+"|"+this.vertices[i].y,t.vertex[this.vecToidx[m]]=[p.x,p.y,p.z]}constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new $S("icosahedron","Regular",[[0,ch,-1],[-ch,1,0],[-1,0,-ch],[1,0,-ch],[ch,1,0],[0,ch,1],[-1,0,ch],[-ch,-1,0],[0,-ch,-1],[ch,-1,0],[1,0,ch],[0,-ch,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e=12;const t={},i=this.m,n=this.n;let a,s,r,o,l,c=i,h=1,f=0;0!==n&&(c=vh.HCF(i,n)),h=i/c,f=n/c;const u=jS.Zero(),d=new jS(i,n),m=new jS(-n,i+n),p=jS.Zero(),_=jS.Zero(),v=jS.Zero();let g,S,y,E,A=[];const C=[],R=this.vertByDist,T=(i,n,a,s)=>{g=i+"|"+a,S=n+"|"+s,g in t||S in t?g in t&&!(S in t)?t[S]=t[g]:S in t&&!(g in t)&&(t[g]=t[S]):(t[g]=e,t[S]=e,e++),R[a][0]>2?C[t[g]]=[-R[a][0],R[a][1],t[g]]:C[t[g]]=[A[R[a][0]],R[a][1],t[g]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let S=0;S<20;S++){if(A=this.IDATA.face[S],r=A[2],o=A[1],l=A[0],y=u.x+"|"+u.y,g=S+"|"+y,g in t||(t[g]=r,C[r]=[A[R[y][0]],R[y][1]]),y=d.x+"|"+d.y,g=S+"|"+y,g in t||(t[g]=o,C[o]=[A[R[y][0]],R[y][1]]),y=m.x+"|"+m.y,g=S+"|"+y,g in t||(t[g]=l,C[l]=[A[R[y][0]],R[y][1]]),a=this.IDATA.edgematch[S][0],s=this.IDATA.edgematch[S][1],"B"===s)for(let e=1;e<c;e++)_.x=i-e*(h+f),_.y=n+e*h,v.x=-e*f,v.y=e*(h+f),y=_.x+"|"+_.y,E=v.x+"|"+v.y,T(S,a,y,E);if("O"===s)for(let e=1;e<c;e++)v.x=-e*f,v.y=e*(h+f),p.x=e*h,p.y=e*f,y=v.x+"|"+v.y,E=p.x+"|"+p.y,T(S,a,y,E);if(a=this.IDATA.edgematch[S][2],s=this.IDATA.edgematch[S][3],s&&"A"===s)for(let e=1;e<c;e++)p.x=e*h,p.y=e*f,_.x=i-(c-e)*(h+f),_.y=n+(c-e)*h,y=p.x+"|"+p.y,E=_.x+"|"+_.y,T(S,a,y,E);for(let i=0;i<this.vertices.length;i++)y=this.vertices[i].x+"|"+this.vertices[i].y,g=S+"|"+y,g in t||(t[g]=e++,R[y][0]>2?C[t[g]]=[-R[y][0],R[y][1],t[g]]:C[t[g]]=[A[R[y][0]],R[y][1],t[g]])}this.closestTo=C,this.vecToidx=t}createInnerFacets(){const e=this.m,t=this.n;for(let i=0;i<t+e+1;i++)for(let e=this.min[i];e<this.max[i]+1;e++)e<this.max[i]&&e<this.max[i+1]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+e+"|"+(i+1),"|"+(e+1)+"|"+i]),i>0&&e<this.max[i-1]&&e+1<this.max[i]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+(e+1)+"|"+i,"|"+(e+1)+"|"+(i-1)])}calcCoeffs(){const e=this.m,t=this.n,i=Math.sqrt(3)/3,n=e*e+t*t+e*t;this.coau=(e+t)/n,this.cobu=-t/n,this.coav=-i*(e-t)/n,this.cobv=i*(2*e+t)/n}edgeVecsABOB(){const e=this.m,t=this.n,i=new jS(-t,e+t);for(let n=1;n<e+t;n++){const e=new jS(this.min[n],n),t=new jS(this.min[n-1],n-1),a=new jS(this.min[n+1],n+1),s=e.clone(),r=t.clone(),o=a.clone();s.rotate60About(i),r.rotate60About(i),o.rotate60About(i);const l=new jS(this.max[s.y],s.y),c=new jS(this.max[s.y-1],s.y-1),h=new jS(this.max[s.y-1]-1,s.y-1);s.x===l.x&&s.y===l.y||(s.x!==c.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,c,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,h,l])):s.y===o.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,c]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([e,c,a])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,c]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,c,l])))}}},$S=class{constructor(e,t,i,n){this.name=e,this.category=t,this.vertex=i,this.face=n}},qS=class e extends $S{static BuildGeodesicData(t){const i=new e("Geodesic-m-n","Geodesic",[[0,ch,-1],[-ch,1,0],[-1,0,-ch],[1,0,-ch],[ch,1,0],[0,ch,1],[-1,0,ch],[-ch,-1,0],[0,-ch,-1],[ch,-1,0],[1,0,ch],[0,-ch,1]],[]);t.setIndices(),t.calcCoeffs(),t.createInnerFacets(),t.edgeVecsABOB(),t.mapABOBtoOBOA(),t.mapABOBtoBAOA();for(let e=0;e<t.IDATA.face.length;e++)t.MapToFace(e,i),i.innerToData(e,t),"B"===t.IDATA.edgematch[e][1]&&i.mapABOBtoDATA(e,t),"O"===t.IDATA.edgematch[e][1]&&i.mapOBOAtoDATA(e,t),"A"===t.IDATA.edgematch[e][3]&&i.mapBAOAtoDATA(e,t);i.orderData(t);return i.vertex=i.vertex.map((function(e){const t=e[0],i=e[1],n=e[2],a=Math.sqrt(t*t+i*i+n*n);return e[0]*=1/a,e[1]*=1/a,e[2]*=1/a,e})),i}orderData(e){const t=[];for(let e=0;e<13;e++)t[e]=[];const i=e.closestTo;for(let e=0;e<i.length;e++)i[e][0]>-1?i[e][1]>0&&t[i[e][0]].push([e,i[e][1]]):t[12].push([e,i[e][0]]);const n=[];for(let e=0;e<12;e++)n[e]=e;let a=12;for(let e=0;e<12;e++){t[e].sort(((e,t)=>e[1]-t[1]));for(let i=0;i<t[e].length;i++)n[t[e][i][0]]=a++}for(let e=0;e<t[12].length;e++)n[t[12][e][0]]=a++;for(let e=0;e<this.vertex.length;e++)this.vertex[e].push(n[e]);this.vertex.sort(((e,t)=>e[3]-t[3]));for(let e=0;e<this.vertex.length;e++)this.vertex[e].pop();for(let e=0;e<this.face.length;e++)for(let t=0;t<this.face[e].length;t++)this.face[e][t]=n[this.face[e][t]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}mapOBOAtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let n=0;n<t.isoVecsOBOA.length;n++){const a=[];for(let s=0;s<3;s++)1===t.vertexTypes[n][s]?a.push(e+"|"+t.isoVecsOBOA[n][s].x+"|"+t.isoVecsOBOA[n][s].y):a.push(i+"|"+t.isoVecsOBOA[n][s].x+"|"+t.isoVecsOBOA[n][s].y);this.face.push([t.vecToidx[a[0]],t.vecToidx[a[1]],t.vecToidx[a[2]]])}}setOrder(e,t){const i=[],n=[];let a=t.pop();n.push(a);let s=this.face[a].indexOf(e);s=(s+2)%3;let r=this.face[a][s];i.push(r);let o=0;for(;t.length>0;)a=t[o],this.face[a].indexOf(r)>-1?(s=(this.face[a].indexOf(r)+1)%3,r=this.face[a][s],i.push(r),n.push(a),t.splice(o,1),o=0):o++;return this.adjacentFaces.push(i),n}toGoldbergPolyhedronData(){const e=new $S("GeoDual","Goldberg",[],[]);e.name="GD dual";const t=this.vertex.length,i=new Array(t);for(let e=0;e<t;e++)i[e]=[];for(let e=0;e<this.face.length;e++)for(let t=0;t<3;t++)i[this.face[e][t]].push(e);let n=0,a=0,s=0,r=[],o=[];this.adjacentFaces=[];for(let t=0;t<i.length;t++)e.face[t]=this.setOrder(t,i[t].concat([])),i[t].forEach((t=>{n=0,a=0,s=0,r=this.face[t];for(let e=0;e<3;e++)o=this.vertex[r[e]],n+=o[0],a+=o[1],s+=o[2];e.vertex[t]=[n/3,a/3,s/3]}));return e}mapABOBtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let n=0;n<t.isoVecsABOB.length;n++){const a=[];for(let s=0;s<3;s++)0===t.vertexTypes[n][s]?a.push(e+"|"+t.isoVecsABOB[n][s].x+"|"+t.isoVecsABOB[n][s].y):a.push(i+"|"+t.isoVecsABOB[n][s].x+"|"+t.isoVecsABOB[n][s].y);this.face.push([t.vecToidx[a[0]],t.vecToidx[a[1]],t.vecToidx[a[2]]])}}mapBAOAtoDATA(e,t){const i=t.IDATA.edgematch[e][2];for(let n=0;n<t.isoVecsBAOA.length;n++){const a=[];for(let s=0;s<3;s++)1===t.vertexTypes[n][s]?a.push(e+"|"+t.isoVecsBAOA[n][s].x+"|"+t.isoVecsBAOA[n][s].y):a.push(i+"|"+t.isoVecsBAOA[n][s].x+"|"+t.isoVecsBAOA[n][s].y);this.face.push([t.vecToidx[a[0]],t.vecToidx[a[1]],t.vecToidx[a[2]]])}}innerToData(e,t){for(let i=0;i<t.innerFacets.length;i++)this.face.push(t.innerFacets[i].map((i=>t.vecToidx[e+i])))}};wm._GoldbergMeshParser=(e,t)=>JS.Parse(e,t);var JS=class e extends wm{relatedGoldbergFace(e,t){return void 0===t?(e>this.goldbergData.nbUnsharedFaces-1&&(jh.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(jh.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(jh.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)}setGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.setVerticesData($h.ColorKind,t)}_changeGoldbergFaceColors(e){for(let t=0;t<e.length;t++){const i=e[t][0],n=e[t][1],a=e[t][2];for(let e=i;e<n+1;e++)this.goldbergData.faceColors[e]=a}const t=[];for(let e=0;e<12;e++)for(let i=0;i<5;i++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);for(let e=12;e<this.goldbergData.faceColors.length;e++)for(let i=0;i<6;i++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);return t}serialize(e){super.serialize(e),e.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const e of this.goldbergData.faceColors)t.faceColors.push(e.asArray())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const e of this.goldbergData.faceCenters)t.faceCenters.push(e.asArray())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const e of this.goldbergData.faceZaxis)t.faceZaxis.push(e.asArray())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const e of this.goldbergData.faceYaxis)t.faceYaxis.push(e.asArray())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const e of this.goldbergData.faceXaxis)t.faceXaxis.push(e.asArray())}e.goldbergData=t}setGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.setVerticesData($h.UVKind,t)}updateGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.updateVerticesData($h.UVKind,t)}static Parse(t,i){const n=t.goldbergData;n.faceColors=n.faceColors.map((e=>Ch.FromArray(e))),n.faceCenters=n.faceCenters.map((e=>wh.FromArray(e))),n.faceZaxis=n.faceZaxis.map((e=>wh.FromArray(e))),n.faceXaxis=n.faceXaxis.map((e=>wh.FromArray(e))),n.faceYaxis=n.faceYaxis.map((e=>wh.FromArray(e)));const a=new e(t.name,i);return a.goldbergData=n,a}updateGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.updateVerticesData($h.ColorKind,t)}constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}_changeGoldbergFaceUVs(e){const t=this.getVerticesData($h.UVKind);for(let i=0;i<e.length;i++){const n=e[i][0],a=e[i][1],s=e[i][2],r=e[i][3],o=e[i][4],l=[],c=[];let h,f;for(let e=0;e<5;e++)h=s.x+r*Math.cos(o+e*Math.PI/2.5),f=s.y+r*Math.sin(o+e*Math.PI/2.5),h<0&&(h=0),h>1&&(h=1),l.push(h,f);for(let e=0;e<6;e++)h=s.x+r*Math.cos(o+e*Math.PI/3),f=s.y+r*Math.sin(o+e*Math.PI/3),h<0&&(h=0),h>1&&(h=1),c.push(h,f);for(let e=n;e<Math.min(12,a+1);e++)for(let i=0;i<5;i++)t[10*e+2*i]=l[2*i],t[10*e+2*i+1]=l[2*i+1];for(let e=Math.max(12,n);e<a+1;e++)for(let i=0;i<6;i++)t[12*e-24+2*i]=c[2*i],t[12*e-23+2*i]=c[2*i+1]}return t}placeOnGoldbergFaceAt(e,t,i){const n=wh.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=n,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(i.x)).add(this.goldbergData.faceYaxis[t].scale(i.y)).add(this.goldbergData.faceZaxis[t].scale(i.z))}};var QS=class{bezierCurveTo(e,t,i,n,a,s){this._currentPath.addBezierCurveTo(e,t,i,n,a,s,this._resolution)}get paths(){return this._paths}get holes(){return this._holes}lineTo(e,t){this._currentPath.addLineTo(e,t)}moveTo(e,t){this._currentPath=new hp(e,t),this._tempPaths.push(this._currentPath)}constructor(e){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=e}extractHoles(){for(const e of this._tempPaths)e.area()>0?this._holes.push(e):this._paths.push(e);if(!this._paths.length&&this._holes.length){const e=this._holes;this._holes=this._paths,this._paths=e}this._tempPaths.length=0}quadraticCurveTo(e,t,i,n){this._currentPath.addQuadraticCurveTo(e,t,i,n,this._resolution)}};function ZS(e,t,i,n,a,s){const r=s.glyphs[e]||s.glyphs["?"];if(!r)return null;const o=new QS(a);if(r.o){const e=r.o.split(" ");for(let a=0,s=e.length;a<s;){switch(e[a++]){case"m":{const s=parseInt(e[a++])*t+i,r=parseInt(e[a++])*t+n;o.moveTo(s,r);break}case"l":{const s=parseInt(e[a++])*t+i,r=parseInt(e[a++])*t+n;o.lineTo(s,r);break}case"q":{const s=parseInt(e[a++])*t+i,r=parseInt(e[a++])*t+n,l=parseInt(e[a++])*t+i,c=parseInt(e[a++])*t+n;o.quadraticCurveTo(l,c,s,r);break}case"b":{const s=parseInt(e[a++])*t+i,r=parseInt(e[a++])*t+n,l=parseInt(e[a++])*t+i,c=parseInt(e[a++])*t+n,h=parseInt(e[a++])*t+i,f=parseInt(e[a++])*t+n;o.bezierCurveTo(l,c,h,f,s,r);break}}}}return o.extractHoles(),{offsetX:r.ha*t,shapePath:o}}var ey={$t:Zg,CreateTiledBox:function(e,t,i=null){const n=new wm(e,i);return t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation,tS(t).applyToMesh(n,t.updatable),n},ut:nS,gt:zg,CreateIcoSphere:FS,st:Vg,ft:sS,CreateTorus:oS,CreateTorusKnot:cS,CreateLineSystem:vS,Mk:gS,CreateDashedLines:SS,ExtrudeShape:NS,ExtrudeShapeCustom:MS,kk:xS,CreateTiledPlane:function(e,t,i=null){const n=new wm(e,i);return t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation,eS(t).applyToMesh(n,t.updatable),n},Vt:PS,CreateGround:$g,CreateTiledGround:qg,CreateGroundFromHeightMap:Jg,CreatePolygon:RS,ExtrudePolygon:TS,CreateTube:wS,CreatePolyhedron:DS,CreateGeodesic:function(e,t,i=null){let n=t.m||1;n!==Math.floor(n)&&(n=Math.floor(n),jh.Warn("m not an integer only floor(m) used"));let a=t.n||0;if(a!==Math.floor(a)&&(a=Math.floor(a),jh.Warn("n not an integer only floor(n) used")),a>n){const e=a;a=n,n=e,jh.Warn("n > m therefore m and n swapped")}const s=new KS;return s.build(n,a),DS(e,{custom:qS.BuildGeodesicData(s),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs},i)},CreateGoldberg:function(e,t,i=null){const n=t.size,a=t.sizeX||n||1,s=t.sizeY||n||1,r=t.sizeZ||n||1;let o=t.m||1;o!==Math.floor(o)&&(o=Math.floor(o),jh.Warn("m not an integer only floor(m) used"));let l=t.n||0;if(l!==Math.floor(l)&&(l=Math.floor(l),jh.Warn("n not an integer only floor(n) used")),l>o){const e=l;l=o,o=e,jh.Warn("n > m therefore m and n swapped")}const c=new KS;c.build(o,l);const h=qS.BuildGeodesicData(c),f=h.toGoldbergPolyhedronData(),u=new JS(e,i);t.sideOrientation=wm._GetDefaultSideOrientation(t.sideOrientation),u._originalBuilderSideOrientation=t.sideOrientation;(function(e,t){const i=e.size,n=e.sizeX||i||1,a=e.sizeY||i||1,s=e.sizeZ||i||1,r=0===e.sideOrientation?0:e.sideOrientation||_f.DEFAULTSIDE,o=[],l=[],c=[],h=[];let f=1/0,u=-1/0,d=1/0,m=-1/0;for(let e=0;e<t.vertex.length;e++)f=Math.min(f,t.vertex[e][0]*n),u=Math.max(u,t.vertex[e][0]*n),d=Math.min(d,t.vertex[e][1]*a),m=Math.max(m,t.vertex[e][1]*a);let p=0;for(let e=0;e<t.face.length;e++){const i=t.face[e],r=wh.FromArray(t.vertex[i[0]]),_=wh.FromArray(t.vertex[i[2]]),v=wh.FromArray(t.vertex[i[1]]),g=_.subtract(r),S=v.subtract(r),y=wh.Cross(S,g).normalize();for(let e=0;e<i.length;e++){c.push(y.x,y.y,y.z);const r=t.vertex[i[e]];o.push(r[0]*n,r[1]*a,r[2]*s);const l=(r[1]*a-d)/(m-d);h.push((r[0]*n-f)/(u-f),dd?1-l:l)}for(let e=0;e<i.length-2;e++)l.push(p,p+e+2,p+e+1);p+=i.length}_f._ComputeSides(r,o,l,c,h);const _=new _f;return _.positions=o,_.indices=l,_.normals=c,_.uvs=h,_})(t,f).applyToMesh(u,t.updatable),u.goldbergData.nbSharedFaces=h.sharedNodes,u.goldbergData.nbUnsharedFaces=h.poleNodes,u.goldbergData.adjacentFaces=h.adjacentFaces,u.goldbergData.nbFaces=u.goldbergData.nbSharedFaces+u.goldbergData.nbUnsharedFaces,u.goldbergData.nbFacesAtPole=(u.goldbergData.nbUnsharedFaces-12)/12;for(let e=0;e<h.vertex.length;e++)u.goldbergData.faceCenters.push(wh.FromArray(h.vertex[e])),u.goldbergData.faceCenters[e].x*=a,u.goldbergData.faceCenters[e].y*=s,u.goldbergData.faceCenters[e].z*=r,u.goldbergData.faceColors.push(new Ch(1,1,1,1));for(let e=0;e<f.face.length;e++){const t=f.face[e],i=wh.FromArray(f.vertex[t[0]]),n=wh.FromArray(f.vertex[t[2]]),a=wh.FromArray(f.vertex[t[1]]),s=n.subtract(i),r=a.subtract(i),o=wh.Cross(r,s).normalize(),l=wh.Cross(r,o).normalize();u.goldbergData.faceXaxis.push(r.normalize()),u.goldbergData.faceYaxis.push(o),u.goldbergData.faceZaxis.push(l)}return u},CreateDecal:zS,CreateCapsule:YS,CreateText:function(e,t,i,n={size:50,resolution:8,depth:1},a=null,s=earcut){const r=function(e,t,i,n){const a=Array.from(e),s=t/n.resolution,r=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,o=[];let l=0,c=0;for(let e=0;e<a.length;e++){const t=a[e];if("\n"===t)l=0,c-=r;else{const e=ZS(t,s,l,c,i,n);e&&(l+=e.offsetX,o.push(e.shapePath))}}return o}(t,n.size||50,n.resolution||8,i),o=[];let l=0;for(const t of r){if(!t.paths.length)continue;const i=t.holes.slice();for(const r of t.paths){const t=[],c=[],h=r.getPoints();for(const e of h)c.push(new wh(e.x,0,e.y));const f=i.slice();for(const e of f){const n=e.getPoints();let a=!1;for(const e of n)if(r.isPointInside(e)){a=!0;break}if(!a)continue;const s=[];for(const e of n)s.push(new wh(e.x,0,e.y));t.push(s),i.splice(i.indexOf(e),1)}if(!t.length&&i.length)for(const e of i){const i=e.getPoints(),n=[];for(const e of i)n.push(new wh(e.x,0,e.y));t.push(n)}const u=TS(e,{shape:c,holes:t.length?t:void 0,depth:n.depth||1,faceUV:n.faceUV||n.perLetterFaceUV?.(l),faceColors:n.faceColors||n.perLetterFaceColors?.(l),sideOrientation:wm._GetDefaultSideOrientation(n.sideOrientation||wm.DOUBLESIDE)},a,s);o.push(u),l++}}const c=wm.MergeMeshes(o,!0,!0);if(c){const t=c.getBoundingInfo().boundingBox;c.position.x+=-(t.minimumWorld.x+t.maximumWorld.x)/2,c.position.y+=-(t.minimumWorld.y+t.maximumWorld.y)/2,c.position.z+=-(t.minimumWorld.z+t.maximumWorld.z)/2+t.extendSize.z,c.name=e;const i=new Xh("pivot",a);i.rotation.x=-Math.PI/2,c.parent=i,c.bakeCurrentTransformIntoVertices(),c.parent=null,i.dispose()}return c}},ty=class e{constructor(e,t,i){this.frame=e,this.action=t,this.onlyOnce=i,this.isDone=!1}_clone(){return new e(this.frame,this.action,this.onlyOnce)}},iy=class e extends Vh{getLocalMatrix(){return this._compose(),this._localMatrix}scale(t,i,n,a=!1){const s=this.getLocalMatrix(),r=e._TmpMats[0];Lh.ScalingToRef(t,i,n,r),r.multiplyToRef(s,s),r.invert();for(const e of this.children){const a=e.getLocalMatrix();a.multiplyToRef(r,a),a.multiplyAtIndex(12,t),a.multiplyAtIndex(13,i),a.multiplyAtIndex(14,n),e._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),a)for(const e of this.children)e.scale(t,i,n,a)}get scaling(){return this.getScale()}get rotation(){return this.getRotation()}set rotationQuaternion(e){this.setRotationQuaternion(e)}getScale(){return this._decompose(),this._localScaling}set position(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()}getBindMatrix(){return this._bindMatrix}setBindPose(e){this.setBindMatrix(e)}getDirection(e,t=null){const i=wh.Zero();return this.getDirectionToRef(e,t,i),i}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}constructor(e,t,i=null,n=null,a=null,s=null,r=null){super(e,t.getScene(),!1),this.name=e,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=t,this._localMatrix=n?.clone()??Lh.Identity(),this._restMatrix=a??this._localMatrix.clone(),this._bindMatrix=s??this._localMatrix.clone(),this._index=r,this._absoluteMatrix=new Lh,this._absoluteBindMatrix=new Lh,this._absoluteInverseBindMatrix=new Lh,this._finalMatrix=new Lh,t.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}setPosition(e,t=0,i){this._updatePosition(e,t,i,!1)}set rotation(e){this.setRotation(e)}getRotation(e=0,t=null){const i=wh.Zero();return this.getRotationToRef(e,t,i),i}getTransformNode(){return this._linkedTransformNode}getRotationMatrixToRef(t=0,i,n){if(0==t)this.getLocalMatrix().getRotationMatrixToRef(n);else{const t=e._TmpMats[0],a=this.getAbsoluteMatrix();i?a.multiplyToRef(i.getWorldMatrix(),t):t.copyFrom(a),t.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyAtIndex(1,this._scalingDeterminant),t.multiplyAtIndex(2,this._scalingDeterminant),t.getRotationMatrixToRef(n)}}getRestPose(){return this.getRestMatrix()}getBaseMatrix(){return this.getBindMatrix()}get position(){return this._decompose(),this._localPosition}setAxisAngle(t,i,n=0,a){if(0===n){const s=e._TmpQuat;return Dh.RotationAxisToRef(t,i,s),void this.setRotationQuaternion(s,n,a)}const s=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,a))return;const r=e._TmpMats[1];Lh.RotationAxisToRef(t,i,r),s.multiplyToRef(r,r),this._rotateWithMatrix(r,n,a)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}_updateAbsoluteBindMatrices(e,t=!0){if(e||(e=this._bindMatrix),this.parent?e.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.copyFrom(e),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),t)for(let e=0;e<this.children.length;e++)this.children[e]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}getPosition(e=0,t=null){const i=wh.Zero();return this.getPositionToRef(e,t,i),i}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Lh.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)}setRotation(e,t=0,i){this.setYawPitchRoll(e.y,e.x,e.z,t,i)}getScaleToRef(e){this._decompose(),e.copyFrom(this._localScaling)}setRotationMatrix(t,i=0,n){if(0===i){const a=e._TmpQuat;return Dh.FromRotationMatrixToRef(t,a),void this.setRotationQuaternion(a,i,n)}const a=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,n))return;const s=e._TmpMats[1];s.copyFrom(t),a.multiplyToRef(t,s),this._rotateWithMatrix(s,i,n)}setParent(e,t=!0){if(this.parent!==e){if(this.parent){const e=this.parent.children.indexOf(this);-1!==e&&this.parent.children.splice(e,1)}this._parentNode=e,this.parent&&this.parent.children.push(this),t&&this._updateAbsoluteBindMatrices(),this.markAsDirty()}}_updatePosition(t,i=0,n,a=!0){const s=this.getLocalMatrix();if(0==i)a?(s.addAtIndex(12,t.x),s.addAtIndex(13,t.y),s.addAtIndex(14,t.z)):s.setTranslationFromFloats(t.x,t.y,t.z);else{let i=null;n&&(i=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=e._TmpMats[0],o=e._TmpVecs[0];this.parent?n&&i?(r.copyFrom(this.parent.getAbsoluteMatrix()),r.multiplyToRef(i,r)):r.copyFrom(this.parent.getAbsoluteMatrix()):Lh.IdentityToRef(r),a&&r.setTranslationFromFloats(0,0,0),r.invert(),wh.TransformCoordinatesToRef(t,r,o),a?(s.addAtIndex(12,o.x),s.addAtIndex(13,o.y),s.addAtIndex(14,o.z)):s.setTranslationFromFloats(o.x,o.y,o.z)}this._markAsDirtyAndDecompose()}setAbsolutePosition(e,t){this.setPosition(e,1,t)}getLocalPositionFromAbsolute(e,t=null){const i=wh.Zero();return this.getLocalPositionFromAbsoluteToRef(e,t,i),i}translate(e,t=0,i){this._updatePosition(e,t,i,!0)}setBindMatrix(e){this.updateMatrix(e)}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=wh.Zero(),this._localRotation=Dh.Zero(),this._localPosition=wh.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))}getAbsoluteTransform(){return this._absoluteMatrix}get _matrix(){return this._compose(),this._localMatrix}get parent(){return this._parentNode}setYawPitchRoll(t,i,n,a=0,s){if(0===a){const r=e._TmpQuat;return Dh.RotationYawPitchRollToRef(t,i,n,r),void this.setRotationQuaternion(r,a,s)}const r=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,s))return;const o=e._TmpMats[1];Lh.RotationYawPitchRollToRef(t,i,n,o),r.multiplyToRef(o,o),this._rotateWithMatrix(o,a,s)}_rotateWithMatrix(t,i=0,n){const a=this.getLocalMatrix(),s=a.m[12],r=a.m[13],o=a.m[14],l=this.getParent(),c=e._TmpMats[3],h=e._TmpMats[4];l&&1==i?(n?(c.copyFrom(n.getWorldMatrix()),l.getAbsoluteMatrix().multiplyToRef(c,c)):c.copyFrom(l.getAbsoluteMatrix()),h.copyFrom(c),h.invert(),a.multiplyToRef(c,a),a.multiplyToRef(t,a),a.multiplyToRef(h,a)):1==i&&n?(c.copyFrom(n.getWorldMatrix()),h.copyFrom(c),h.invert(),a.multiplyToRef(c,a),a.multiplyToRef(t,a),a.multiplyToRef(h,a)):a.multiplyToRef(t,a),a.setTranslationFromFloats(s,r,o),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}getAbsolutePositionToRef(e,t){this.getPositionToRef(1,e,t)}linkTransformNode(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getRotationQuaternion(e=0,t=null){const i=Dh.Identity();return this.getRotationQuaternionToRef(e,t,i),i}updateMatrix(e,t=!0,i=!0){this._bindMatrix.copyFrom(e),t&&this._updateAbsoluteBindMatrices(),i?this._matrix=e:this.markAsDirty()}getAbsolutePositionFromLocal(e,t=null){const i=wh.Zero();return this.getAbsolutePositionFromLocalToRef(e,t,i),i}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}setRotationQuaternion(t,i=0,n){if(0===i)return this._decompose(),this._localRotation.copyFrom(t),void this._markAsDirtyAndCompose();const a=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,n))return;const s=e._TmpMats[1];Lh.FromQuaternionToRef(t,s),a.multiplyToRef(s,s),this._rotateWithMatrix(s,i,n)}getSkeleton(){return this._skeleton}getAbsoluteMatrix(){return this._absoluteMatrix}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}_getAbsoluteInverseMatrixUnscaledToRef(t,i){const n=e._TmpMats[2];return t.copyFrom(this.getAbsoluteMatrix()),i?(t.multiplyToRef(i.getWorldMatrix(),t),Lh.ScalingToRef(i.scaling.x,i.scaling.y,i.scaling.z,n)):Lh.IdentityToRef(n),t.invert(),!isNaN(t.m[0])&&(n.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(n,t),!0)}getParent(){return this.parent}getAbsolutePositionFromLocalToRef(t,i=null,n){let a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=e._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),i&&a&&s.multiplyToRef(a,s),wh.TransformCoordinatesToRef(t,s,n)}getRotationQuaternionToRef(t=0,i=null,n){if(0==t)this._decompose(),n.copyFrom(this._localRotation);else{const t=e._TmpMats[0],a=this.getAbsoluteMatrix();i?a.multiplyToRef(i.getWorldMatrix(),t):t.copyFrom(a),t.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyAtIndex(1,this._scalingDeterminant),t.multiplyAtIndex(2,this._scalingDeterminant),t.decompose(void 0,n,void 0)}}get rotationQuaternion(){return this._decompose(),this._localRotation}set parent(e){this.setParent(e)}setRestPose(e){this.setRestMatrix(e)}markAsDirty(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndDecompose(){this.markAsDirty(),this._needToDecompose=!0}_markAsDirtyAndCompose(){this.markAsDirty(),this._needToCompose=!0}getRestMatrix(){return this._restMatrix}getWorldMatrix(){return this.getFinalMatrix()}getDirectionToRef(t,i=null,n){let a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=e._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),i&&a&&s.multiplyToRef(a,s),wh.TransformNormalToRef(t,s,n),n.normalize()}getBindPose(){return this.getBindMatrix()}set _matrix(e){(e.updateFlag!==this._localMatrix.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose())}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}returnToRest(){if(this._linkedTransformNode){const e=kh.Vector3[0],t=kh.Ht[0],i=kh.Vector3[1];this.getRestMatrix().decompose(e,t,i),this._linkedTransformNode.position.copyFrom(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Dh.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(t),this._linkedTransformNode.scaling.copyFrom(e)}else this._matrix=this._restMatrix}getFinalMatrix(){return this._finalMatrix}getClassName(){return"Bone"}getAbsolutePosition(e=null){const t=wh.Zero();return this.getPositionToRef(1,e,t),t}getRotationToRef(t=0,i=null,n){const a=e._TmpQuat;this.getRotationQuaternionToRef(t,i,a),a.toEulerAnglesToRef(n)}getChildren(){return this.children}getRotationMatrix(e=0,t){const i=Lh.Identity();return this.getRotationMatrixToRef(e,t,i),i}set scaling(e){this.setScale(e)}setScale(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()}getPositionToRef(t=0,i,n){if(0==t){const e=this.getLocalMatrix();n.x=e.m[12],n.y=e.m[13],n.z=e.m[14]}else{let t=null;i&&(t=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let a=e._TmpMats[0];i&&t?(a.copyFrom(this.getAbsoluteMatrix()),a.multiplyToRef(t,a)):a=this.getAbsoluteMatrix(),n.x=a.m[12],n.y=a.m[13],n.z=a.m[14]}}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getLocalPositionFromAbsoluteToRef(t,i=null,n){let a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=e._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),i&&a&&s.multiplyToRef(a,s),s.invert(),wh.TransformCoordinatesToRef(t,s,n)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.copyFrom(this._localMatrix);const e=this._skeleton.getPoseMatrix();e&&this._absoluteMatrix.multiplyToRef(e,this._absoluteMatrix)}const e=this.children,t=e.length;for(let i=0;i<t;i++)e[i].computeAbsoluteMatrices()}setRestMatrix(e){this._restMatrix.copyFrom(e)}rotate(t,i,n=0,a){const s=e._TmpMats[0];s.setTranslationFromFloats(0,0,0),Lh.RotationAxisToRef(t,i,s),this._rotateWithMatrix(s,n,a)}};function ny(e,t,i,n){let a,s=1;1===n?a=new Float32Array(t*i*4):2===n?(a=new Uint16Array(t*i*4),s=15360):a=7===n?new Uint32Array(t*i*4):new Uint8Array(t*i*4);for(let n=0;n<t;n++)for(let r=0;r<i;r++){const i=3*(r*t+n),o=4*(r*t+n);a[o+0]=e[i+0],a[o+1]=e[i+1],a[o+2]=e[i+2],a[o+3]=s}return a}function ay(e){return function(t,i,n,a,s,r,o,l,c=null,h=0){const f=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,u=new Cu(this,e?10:11);u.baseWidth=i,u.baseHeight=n,u.baseDepth=a,u.width=i,u.height=n,u.depth=a,u.format=s,u.type=h,u.generateMipMaps=r,u.samplingMode=l,e?u.is3D=!0:u.is2DArray=!0,this._doNotHandleContextLost||(u._bufferView=t),e?this.updateRawTexture3D(u,t,s,o,c,h):this.updateRawTexture2DArray(u,t,s,o,c,h),this._bindTextureDirectly(f,u,!0);const d=this._getSamplingParameters(l,r);return this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,d.mag),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,d.min),r&&this._gl.generateMipmap(f),this._bindTextureDirectly(f,null),this._internalTexturesCache.push(u),u}}function sy(e){return function(t,i,n,a,s=null,r=0){const o=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,l=this._getWebGLTextureType(r),c=this._getInternalFormat(n),h=this._getRGBABufferInternalSizedFormat(r,n);this._bindTextureDirectly(o,t,!0),this._unpackFlipY(void 0===a||!!a),this._doNotHandleContextLost||(t._bufferView=i,t.format=n,t.invertY=a,t._compression=s),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&i?this._gl.compressedTexImage3D(o,0,this.getCaps().s3tc[s],t.width,t.height,t.depth,0,i):this._gl.texImage3D(o,0,h,t.width,t.height,t.depth,0,c,l,i),t.generateMipMaps&&this._gl.generateMipmap(o),this._bindTextureDirectly(o,null),t.isReady=!0}}iy._TmpVecs=th(2,wh.Zero),iy._TmpQuat=Dh.Identity(),iy._TmpMats=th(5,Lh.Identity),Ed.prototype.updateRawTexture=function(e,t,i,n,a=null,s=0,r=!1){if(!e)return;const o=this._getRGBABufferInternalSizedFormat(s,i,r),l=this._getInternalFormat(i),c=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===n||!!n),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.type=s,e.invertY=n,e._compression=a),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),a&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[a],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,e.width,e.height,0,l,c,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0},Ed.prototype.createRawTexture=function(e,t,i,n,a,s,r,o=null,l=0,c=0,h=!1){const f=new Cu(this,3);f.baseWidth=t,f.baseHeight=i,f.width=t,f.height=i,f.format=n,f.generateMipMaps=a,f.samplingMode=r,f.invertY=s,f._compression=o,f.type=l,f._useSRGBBuffer=this._getUseSRGBBuffer(h,!a),this._doNotHandleContextLost||(f._bufferView=e),this.updateRawTexture(f,e,n,s,o,l,f._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,f,!0);const u=this._getSamplingParameters(r,a);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),a&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(f),f},Ed.prototype.createRawCubeTexture=function(e,t,i,n,a,s,r,o=null){const l=this._gl,c=new Cu(this,8);c.isCube=!0,c.format=i,c.type=n,this._doNotHandleContextLost||(c._bufferViewArray=e);const h=this._getWebGLTextureType(n);let f=this._getInternalFormat(i);f===l.RGB&&(f=l.RGBA),h!==l.FLOAT||this._caps.textureFloatLinearFiltering?h!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?h!==l.FLOAT||this._caps.textureFloatRender?h!==l.HALF_FLOAT||this._caps.colorBufferFloat||(a=!1,jh.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(a=!1,jh.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(a=!1,r=1,jh.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(a=!1,r=1,jh.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const u=t,d=u;c.width=u,c.height=d,c.invertY=s,c._compression=o;if(!this.needPOTTextures||Qu(c.width)&&Qu(c.height)||(a=!1),e)this.updateRawCubeTexture(c,e,i,n,s,o);else{const e=this._getRGBABufferInternalSizedFormat(n),t=0;this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,c,!0);for(let i=0;i<6;i++)o?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,t,this.getCaps().s3tc[o],c.width,c.height,0,void 0):l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,t,e,c.width,c.height,0,f,h,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,c,!0),e&&a&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const m=this._getSamplingParameters(r,a);return l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,m.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,m.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),c.generateMipMaps=a,c.samplingMode=r,c.isReady=!0,c},Ed.prototype.updateRawCubeTexture=function(e,t,i,n,a,s=null,r=0){e._bufferViewArray=t,e.format=i,e.type=n,e.invertY=a,e._compression=s;const o=this._gl,l=this._getWebGLTextureType(n);let c=this._getInternalFormat(i);const h=this._getRGBABufferInternalSizedFormat(n);let f=!1;c===o.RGB&&(c=o.RGBA,f=!0),this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===a||!!a),e.width%4!=0&&o.pixelStorei(o.UNPACK_ALIGNMENT,1);for(let i=0;i<6;i++){let a=t[i];s?o.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+i,r,this.getCaps().s3tc[s],e.width,e.height,0,a):(f&&(a=ny(a,e.width,e.height,n)),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+i,r,h,e.width,e.height,0,c,l,a))}(!this.needPOTTextures||Qu(e.width)&&Qu(e.height))&&e.generateMipMaps&&0===r&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},Ed.prototype.createRawCubeTextureFromUrl=function(e,t,i,n,a,s,r,o,l=null,c=null,h=3,f=!1){const u=this._gl,d=this.createRawCubeTexture(null,i,n,a,!s,f,h,null);t?.addPendingData(d),d.url=e,d.isReady=!1,this._internalTexturesCache.push(d);const m=e=>{const i=d.width,s=r(e);if(s){if(o){const e=this._getWebGLTextureType(a);let t=this._getInternalFormat(n);const r=this._getRGBABufferInternalSizedFormat(a);let l=!1;t===u.RGB&&(t=u.RGBA,l=!0),this._bindTextureDirectly(u.TEXTURE_CUBE_MAP,d,!0),this._unpackFlipY(!1);const c=o(s);for(let n=0;n<c.length;n++){const s=i>>n;for(let i=0;i<6;i++){let o=c[n][i];l&&(o=ny(o,s,s,a)),u.texImage2D(i,n,r,s,s,0,t,e,o)}}this._bindTextureDirectly(u.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(d,s,n,a,f);d.isReady=!0,t?.removePendingData(d),d.onLoadedObservable.notifyObservers(d),d.onLoadedObservable.clear(),l&&l()}};return this._loadFile(e,(e=>{m(e)}),void 0,t?.offlineProvider,!0,((e,i)=>{t?.removePendingData(d),c&&e&&c(e.status+" "+e.statusText,i)})),d},Ed.prototype.createRawTexture2DArray=ay(!1),Ed.prototype.createRawTexture3D=ay(!0),Ed.prototype.updateRawTexture2DArray=sy(!1),Ed.prototype.updateRawTexture3D=sy(!0);var ry=class e extends yp{update(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}static CreateAlphaTexture(t,i,n,a,s=!0,r=!1,o=3){return new e(t,i,n,0,a,s,r,o)}clone(){if(!this._texture)return super.clone();const t=new e(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return t._texture=this._texture,this._texture.incrementReferences(),t}static CreateRGBTexture(t,i,n,a,s=!0,r=!1,o=3,l=0,c=0,h=!1){return new e(t,i,n,4,a,s,r,o,l,c,h)}static CreateRGBATexture(t,i,n,a,s=!0,r=!1,o=3,l=0,c=0,h=!1){return new e(t,i,n,5,a,s,r,o,l,c,h)}static CreateRGBAStorageTexture(t,i,n,a,s=!0,r=!1,o=3,l=0,c=!1){return new e(t,i,n,5,a,s,r,o,l,1,c)}static CreateRTexture(t,i,n,a,s=!0,r=!1,o=yp.TRILINEAR_SAMPLINGMODE,l=1){return new e(t,i,n,6,a,s,r,o,l)}static CreateRStorageTexture(t,i,n,a,s=!0,r=!1,o=yp.TRILINEAR_SAMPLINGMODE,l=1){return new e(t,i,n,6,a,s,r,o,l,1)}constructor(e,t,i,n,a,s=!0,r=!1,o=3,l=0,c,h){super(null,a,!s,r,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c),this.format=n,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==l||(o=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==l||(o=1),this._texture=this._engine.createRawTexture(e,t,i,n,s,r,o,null,l,c??0,h??!1),this.wrapU=yp.CLAMP_ADDRESSMODE,this.wrapV=yp.CLAMP_ADDRESSMODE)}static CreateLuminanceTexture(t,i,n,a,s=!0,r=!1,o=3){return new e(t,i,n,1,a,s,r,o)}static CreateLuminanceAlphaTexture(t,i,n,a,s=!0,r=!1,o=3){return new e(t,i,n,2,a,s,r,o)}},oy=class e{_unregisterMeshWithPoseMatrix(e){const t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)}_sortBones(e,t,i){if(i[e])return;i[e]=!0;const n=this.bones[e];if(!n)return;void 0===n._index&&(n._index=e);const a=n.getParent();a&&this._sortBones(this.bones.indexOf(a),t,i),t.push(n)}constructor(e,t,i){this.name=e,this.id=t,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=Lh.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Ih,this.bones=[],this._scene=i||xh.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const n=this._scene.getEngine().getCaps();this._canUseTextureForBones=n.textureFloat&&n.maxVertexTextureImageUnits>0}static MakeAnimationAdditive(e,t=0,i){const n=e.getAnimationRange(i);if(!n)return null;const a=e._scene.getAllAnimatablesByTarget(e);let s=null;for(let e=0;e<a.length;e++){const t=a[e];if(t.fromFrame===n?.from&&t.toFrame===n?.to){s=t;break}}const r=e.getAnimatables();for(let e=0;e<r.length;e++){const n=r[e].animations;if(n)for(let e=0;e<n.length;e++)Ov.MakeAnimationAdditive(n[e],t,i)}return s&&(s.isAdditive=!0),e}get xt(){return this._uniqueId}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}_computeTransformMatrices(e,t){this.onBeforeComputeObservable.notifyObservers(this);for(let i=0;i<this.bones.length;i++){const n=this.bones[i];n._childUpdateId++;const a=n.getParent();if(a?n.getLocalMatrix().multiplyToRef(a.getFinalMatrix(),n.getFinalMatrix()):t?n.getLocalMatrix().multiplyToRef(t,n.getFinalMatrix()):n.getFinalMatrix().copyFrom(n.getLocalMatrix()),-1!==n._index){const t=null===n._index?i:n._index;n.getAbsoluteInverseBindMatrix().multiplyToArray(n.getFinalMatrix(),e,16*t)}}this._identity.copyToArray(e,16*this.bones.length)}getTransformMatrices(e){if(this.needInitialSkinMatrix){if(!e)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return e._bonesTransformMatrices||this.prepare(!0),e._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(e){return this.needInitialSkinMatrix&&e._transformMatrixTexture?e._transformMatrixTexture:this._transformMatrixTexture}getAnimationRange(e){return this._ranges[e]||null}returnToRest(){for(const e of this.bones)-1!==e._index&&e.returnToRest()}_registerMeshWithPoseMatrix(e){this._meshesWithPoseMatrix.push(e)}get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}getScene(){return this._scene}clone(t,i){const n=new e(t,i||t,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){const t=this.bones[e];let i=null;const a=t.getParent();if(a){const e=this.bones.indexOf(a);i=n.bones[e]}const s=new iy(t.name,n,i,t.getBindMatrix().clone(),t.getRestMatrix().clone());s._index=t._index,t._linkedTransformNode&&s.linkTransformNode(t._linkedTransformNode),Af.DeepCopy(t.animations,s.animations)}if(this._ranges){n._ranges={};for(const e in this._ranges){const t=this._ranges[e];t&&(n._ranges[e]=t.clone())}}return this._isDirty=!0,n.prepare(!0),n}copyAnimationRange(e,t,i=!1){if(this._ranges[t]||!e.getAnimationRange(t))return!1;let n=!0;const a=this._getHighestAnimationFrame()+1,s={},r=e.bones;let o,l;for(l=0,o=r.length;l<o;l++)s[r[l].name]=r[l];this.bones.length!==r.length&&(jh.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${r.length}`),n=!1);const c=i&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(l=0,o=this.bones.length;l<o;l++){const e=this.bones[l].name,r=s[e];r?n=n&&this.bones[l].copyAnimationRange(r,t,a,i,c):(jh.Warn("copyAnimationRange: not same rig, missing source bone "+e),n=!1)}const h=e.getAnimationRange(t);return h&&(this._ranges[t]=new Tv(t,h.from+a,h.to+a)),n}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables}serialize(){const e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let t=0;t<this.bones.length;t++){const i=this.bones[t],n=i.getParent(),a={parentBoneIndex:n?this.bones.indexOf(n):-1,index:i.getIndex(),name:i.name,id:i.id,matrix:i.getBindMatrix().asArray(),rest:i.getRestMatrix().asArray(),linkedTransformNodeId:i.getTransformNode()?.id};e.bones.push(a),i.length&&(a.length=i.length),i.metadata&&(a.metadata=i.metadata),i.animations&&i.animations.length>0&&(a.animation=i.animations[0].serialize()),e.ranges=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const n={};n.name=t,n.from=i.from,n.to=i.to,e.ranges.push(n)}}return e}toString(e){let t=`Name: ${this.name}, nBones: ${this.bones.length}`;if(t+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,e){t+=", Ranges: {";let e=!0;for(const i in this._ranges)e&&(t+=", ",e=!1),t+=i;t+="}"}return t}computeAbsoluteMatrices(e=!1){(this._absoluteTransformIsDirty||e)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}createAnimationRange(e,t,i){if(!this._ranges[e]){this._ranges[e]=new Tv(e,t,i);for(let n=0,a=this.bones.length;n<a;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].createRange(e,t,i)}}getPoseMatrix(){let e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set useTextureToStoreBoneMatrices(e){this._useTextureToStoreBoneMatrices=e,this._markAsDirty()}prepare(e=!1){if(!e){const e=this.getScene().getRenderId();if(this._currentRenderId===e)return;this._currentRenderId=e}if(this._numBonesWithLinkedTransformNode>0)for(const e of this.bones)if(e._linkedTransformNode){const t=e._linkedTransformNode;e.position=t.position,t.rotationQuaternion?e.rotationQuaternion=t.rotationQuaternion:e.rotation=t.rotation,e.scaling=t.scaling}if(this.needInitialSkinMatrix)for(const e of this._meshesWithPoseMatrix){const t=e.getPoseMatrix();let i=this._isDirty;if(e._bonesTransformMatrices&&e._bonesTransformMatrices.length===16*(this.bones.length+1)||(e._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),i=!0),i){if(this._synchronizedWithMesh!==e){this._synchronizedWithMesh=e;for(const e of this.bones)if(!e.getParent()){e.getBindMatrix().multiplyToRef(t,kh.Matrix[1]),e._updateAbsoluteBindMatrices(kh.Matrix[1])}if(this.isUsingTextureForMatrices){const t=4*(this.bones.length+1);e._transformMatrixTexture&&e._transformMatrixTexture.getSize().width===t||(e._transformMatrixTexture&&e._transformMatrixTexture.dispose(),e._transformMatrixTexture=ry.CreateRGBATexture(e._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(e._bonesTransformMatrices,t),this.isUsingTextureForMatrices&&e._transformMatrixTexture&&e._transformMatrixTexture.update(e._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=ry.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}getChildren(){return this.bones.filter((e=>!e.getParent()))}beginAnimation(e,t,i,n){const a=this.getAnimationRange(e);return a?this._scene.beginAnimation(this,a.from,a.to,t,i,n):null}dispose(){if(this._meshesWithPoseMatrix.length=0,this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){const e=this._parentContainer.skeletons.indexOf(this);e>-1&&this._parentContainer.skeletons.splice(e,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}_getHighestAnimationFrame(){let e=0;for(let t=0,i=this.bones.length;t<i;t++)if(this.bones[t].animations[0]){const i=this.bones[t].animations[0].getHighestFrame();e<i&&(e=i)}return e}sortBones(){const e=[],t=new Array(this.bones.length);for(let i=0;i<this.bones.length;i++)this._sortBones(i,e,t);this.bones=e}getBoneIndexByName(e){for(let t=0,i=this.bones.length;t<i;t++)if(this.bones[t].name===e)return t;return-1}setCurrentPoseAsRest(){this.bones.forEach((e=>{e.setCurrentPoseAsRest()}))}deleteAnimationRange(e,t=!0){for(let i=0,n=this.bones.length;i<n;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(e,t);this._ranges[e]=null}getClassName(){return"Skeleton"}static Parse(t,i){const n=new e(t.name,t.id,i);let a;for(t.dimensionsAtRest&&(n.dimensionsAtRest=wh.FromArray(t.dimensionsAtRest)),n.needInitialSkinMatrix=t.needInitialSkinMatrix,a=0;a<t.bones.length;a++){const e=t.bones[a],i=t.bones[a].index;let s=null;e.parentBoneIndex>-1&&(s=n.bones[e.parentBoneIndex]);const r=e.rest?Lh.FromArray(e.rest):null,o=new iy(e.name,n,s,Lh.FromArray(e.matrix),r,null,i);void 0!==e.id&&null!==e.id&&(o.id=e.id),e.length&&(o.length=e.length),e.metadata&&(o.metadata=e.metadata),e.animation&&o.animations.push(Ov.Parse(e.animation)),void 0!==e.linkedTransformNodeId&&null!==e.linkedTransformNodeId&&(n._hasWaitingData=!0,o._waitingTransformNodeId=e.linkedTransformNodeId)}if(t.ranges)for(a=0;a<t.ranges.length;a++){const e=t.ranges[a];n.createAnimationRange(e.name,e.from,e.to)}return n}computeAbsoluteTransforms(e=!1){this.computeAbsoluteMatrices(e)}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}enableBlending(e=.01){this.bones.forEach((t=>{t.animations.forEach((t=>{t.enableBlending=!0,t.blendingSpeed=e}))}))}},ly=class{get quaternion(){return this.rotationQuaternion}isInFrustum(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)}get scale(){return this.scaling}set quaternion(e){this.rotationQuaternion=e}get hasBoundingInfo(){return null!==this._boundingInfo}getBoundingInfo(){return this._boundingInfo}intersectsMesh(e){return!(!this._boundingInfo||!e.hasBoundingInfo)&&(this._sps._bSphereOnly?sf.Intersects(this._boundingInfo.boundingSphere,e.getBoundingInfo().boundingSphere):this._boundingInfo.intersects(e.getBoundingInfo(),!1))}constructor(e,t,i,n,a,s,r,o,l=null,c=null){this.idx=0,this.id=0,this.color=new Ch(1,1,1,1),this.position=wh.Zero(),this.rotation=wh.Zero(),this.scaling=wh.One(),this.uvs=new Oh(0,0,1,1),this.velocity=wh.Zero(),this.pivot=wh.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.props=null,this.cullingStrategy=Bd.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=wh.Zero(),this.idx=e,this.id=t,this._pos=i,this._ind=n,this._model=a,this.shapeId=s,this.idxInShape=r,this._sps=o,l&&(this._modelBoundingInfo=l,this._boundingInfo=new hf(l.minimum,l.maximum)),null!==c&&(this.materialIndex=c)}set scale(e){this.scaling=e}getRotationMatrix(e){let t;if(this.rotationQuaternion)t=this.rotationQuaternion;else{t=kh.Ht[0];const e=this.rotation;Dh.RotationYawPitchRollToRef(e.y,e.x,e.z,t)}t.toRotationMatrix(e)}copyToRef(e){return e.position.copyFrom(this.position),e.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(e.rotationQuaternion?e.rotationQuaternion.copyFrom(this.rotationQuaternion):e.rotationQuaternion=this.rotationQuaternion.clone()),e.scaling.copyFrom(this.scaling),this.color&&(e.color?e.color.copyFrom(this.color):e.color=this.color.clone()),e.uvs.copyFrom(this.uvs),e.velocity.copyFrom(this.velocity),e.pivot.copyFrom(this.pivot),e.translateFromPivot=this.translateFromPivot,e.alive=this.alive,e.isVisible=this.isVisible,e.parentId=this.parentId,e.cullingStrategy=this.cullingStrategy,null!==this.materialIndex&&(e.materialIndex=this.materialIndex),this}},cy=class{set shapeID(e){this.shapeId=e}constructor(e,t,i,n,a,s,r,o,l){this._indicesLength=0,this.shapeId=e,this._shape=t,this._indices=i,this._indicesLength=i.length,this._shapeUV=s,this._shapeColors=a,this._normals=n,this._positionFunction=r,this._vertexFunction=o,this._material=l}get shapeID(){return this.shapeId}},hy=class{constructor(e,t,i,n){this.idx=0,this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.idx=e,this.ind=t,this.indicesLength=i,this.materialIndex=n}},fy=class{get z(){return this.position.z}set z(e){this.position.z=e}get x(){return this.position.x}get y(){return this.position.y}set x(e){this.position.x=e}set y(e){this.position.y=e}constructor(){this.position=wh.Zero(),this.color=new Ch(1,1,1,1),this.uv=Ph.Zero()}},uy=class{get isVisibilityBoxLocked(){return this._isVisibilityBoxLocked}get computeParticleTexture(){return this._computeParticleTexture}set autoUpdateSubMeshes(e){this._autoUpdateSubMeshes=e}pickedParticle(e){if(e.hit){const t=e.subMeshId,i=e.faceId-this.mesh.subMeshes[t].indexStart/3,n=this.pickedBySubMesh;if(n[t]&&n[t][i])return n[t][i]}return null}set computeParticleTexture(e){this._computeParticleTexture=e}refreshVisibleSize(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this}computeSubMeshes(){if(!this.mesh||!this._multimaterialEnabled)return this;const e=this.depthSortedParticles;if(this.particles.length>0)for(let t=0;t<this.particles.length;t++){const i=this.particles[t];i.materialIndex||(i.materialIndex=0);const n=e[t];n.materialIndex=i.materialIndex,n.ind=i._ind,n.indicesLength=i._model._indicesLength,n.idx=i.idx}this._sortParticlesByMaterial();const t=this._indicesByMaterial,i=this._materialIndexes,n=this.mesh;n.subMeshes=[];const a=n.getTotalVertices();for(let e=0;e<i.length;e++){const s=t[e],r=t[e+1]-s,o=i[e];new mf(o,0,a,s,r,n)}return this}get computeParticleVertex(){return this._computeParticleVertex}rebuildMesh(e=!1){for(let t=0;t<this.particles.length;t++)this._rebuildParticle(this.particles[t],e);return this.mesh.updateVerticesData($h.PositionKind,this._positions32,!1,!1),this}afterUpdateParticles(e,t,i){}updateParticle(e){return e}_posToShape(e){const t=[];for(let i=0;i<e.length;i+=3)t.push(wh.FromArray(e,i));return t}setVisibilityBox(e){const t=e/2;this.mesh.buildBoundingInfo(new wh(-t,-t,-t),new wh(t,t,t))}removeParticles(e,t){const i=t-e+1;if(!this._expandable||i<=0||i>=this.nbParticles||!this._updatable)return[];const n=this.particles,a=this.nbParticles;if(t<a-1){const i=t+1,s=n[i]._pos-n[e]._pos,r=n[i]._ind-n[e]._ind;for(let e=i;e<a;e++){const t=n[e];t._pos-=s,t._ind-=r}}const s=n.splice(e,i);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);let r=0;const o=n.length;for(let e=0;e<o;e++){const t=n[e],i=t._model,a=i._shape,s=i._indices,o=i._normals,l=i._shapeColors,c=i._shapeUV;t.idx=e,this._idxOfId[t.id]=e,this._meshBuilder(this._index,r,a,this._positions,s,this._indices,c,this._uvs,l,this._colors,o,this._normals,t.idx,t.idxInShape,null,i),this._index+=a.length,r+=s.length}return this.nbParticles-=i,this._isNotBuilt=!0,s}get computeBoundingBox(){return this._computeBoundingBox}digest(e,t){let i=t&&t.facetNb||1,n=t&&t.number||0,a=t&&t.delta||0;const s=e.getVerticesData($h.PositionKind),r=e.getIndices(),o=e.getVerticesData(this._getUVKind(e,t?.uvKind??0)),l=e.getVerticesData($h.ColorKind),c=e.getVerticesData($h.NormalKind),h=t&&t.storage?t.storage:null;let f=0;const u=r.length/3;n?(n=n>u?u:n,i=Math.round(u/n),a=0):i=i>u?u:i;const d=[],m=[],p=[],_=[],v=[],g=wh.Zero(),S=i;for(;f<u;){i=S+Math.floor((1+a)*Math.random()),f>u-i&&(i=u-f),d.length=0,m.length=0,p.length=0,_.length=0,v.length=0;let t=0;for(let e=3*f;e<3*(f+i);e++){p.push(t);const i=r[e],n=3*i;if(d.push(s[n],s[n+1],s[n+2]),m.push(c[n],c[n+1],c[n+2]),o){const e=2*i;_.push(o[e],o[e+1])}if(l){const e=4*i;v.push(l[e],l[e+1],l[e+2],l[e+3])}t++}let n=this.nbParticles;const y=this._posToShape(d),E=this._uvsToShapeUV(_),A=p.slice(),C=v.slice(),R=m.slice();let T;for(g.copyFromFloats(0,0,0),T=0;T<y.length;T++)g.addInPlace(y[T]);g.scaleInPlace(1/y.length);const N=new wh(1/0,1/0,1/0),M=new wh(-1/0,-1/0,-1/0);for(T=0;T<y.length;T++)y[T].subtractInPlace(g),N.minimizeInPlaceFromFloats(y[T].x,y[T].y,y[T].z),M.maximizeInPlaceFromFloats(y[T].x,y[T].y,y[T].z);let I;this._particlesIntersect&&(I=new hf(N,M));let x=null;this._useModelMaterial&&(x=e.material?e.material:this._setDefaultMaterial());const b=new cy(this._shapeCounter,y,A,R,C,E,null,null,x),P=this._positions.length,w=this._indices.length;this._meshBuilder(this._index,w,y,this._positions,A,this._indices,_,this._uvs,C,this._colors,R,this._normals,n,0,null,b),this._addParticle(n,this._lastParticleId,P,w,b,this._shapeCounter,0,I,h),this.particles[this.nbParticles].position.addInPlace(g),h||(this._index+=y.length,n++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,f+=i}return this._isNotBuilt=!0,this}_uvsToShapeUV(e){const t=[];if(e)for(let i=0;i<e.length;i++)t.push(e[i]);return t}get computeParticleColor(){return this._computeParticleColor}get depthSortParticles(){return this._depthSortParticles}set multimaterial(e){this._multimaterial=e}getParticlesByShapeIdToRef(e,t){t.length=0;for(let i=0;i<this.nbParticles;i++){const n=this.particles[i];n.shapeId==e&&t.push(n)}return this}get isAlwaysVisible(){return this._alwaysVisible}getParticlesByShapeId(e){const t=[];return this.getParticlesByShapeIdToRef(e,t),t}_getUVKind(e,t){return-1===t&&(e.material?.diffuseTexture?t=e.material.diffuseTexture.coordinatesIndex:e.material?.albedoTexture&&(t=e.material.albedoTexture.coordinatesIndex)),"uv"+(t?t+1:"")}set computeParticleVertex(e){this._computeParticleVertex=e}set computeParticleRotation(e){this._computeParticleRotation=e}_sortParticlesByMaterial(){const e=[0];this._indicesByMaterial=e;const t=[];this._materialIndexes=t;const i=this.depthSortedParticles;i.sort(this._materialSortFunction);const n=i.length,a=this._indices32,s=this._indices;let r=0,o=0,l=0,c=i[0].materialIndex;t.push(c),this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(let h=0;h<n;h++){const n=i[h],f=n.indicesLength,u=n.ind;n.materialIndex!==c&&(c=n.materialIndex,e.push(l),t.push(c),this._pickable&&(r++,this.pickedBySubMesh[r]=[],o=0));let d=0;for(let e=0;e<f;e++){if(a[l]=s[u+e],this._pickable){if(0==e%3){const e=this.pickedBySubMesh[r][o];e?(e.idx=n.idx,e.faceId=d):this.pickedBySubMesh[r][o]={idx:n.idx,faceId:d},o++,d++}}l++}}return e.push(a.length),this._updatable&&this.mesh.updateIndices(a),this}dispose(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null,this.pickedBySubMesh=null,this._materials=null,this._materialIndexes=null,this._indicesByMaterial=null,this._idxOfId=null}constructor(e,t,i){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new ly(0,0,0,0,null,0,0,this),this._color=new Ch(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._autoFixFaceOrientation=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=(e,t)=>t.sqDistance-e.sqDistance,this._materialSortFunction=(e,t)=>e.materialIndex-t.materialIndex,this._autoUpdateSubMeshes=!1,this._recomputeInvisibles=!1,this.name=e,this._scene=t||xh.LastCreatedScene,this._camera=t.activeCamera,this._pickable=!!i&&i.isPickable,this._depthSort=!!i&&i.enableDepthSort,this._multimaterialEnabled=!!i&&i.enableMultiMaterial,this._useModelMaterial=!!i&&i.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!i&&i.expandable,this._particlesIntersect=!!i&&i.particleIntersection,this._bSphereOnly=!!i&&i.boundingSphereOnly,this._bSphereRadiusFactor=i&&i.bSphereRadiusFactor?i.bSphereRadiusFactor:1,this._computeBoundingBox=!!i?.computeBoundingBox&&i.computeBoundingBox,this._autoFixFaceOrientation=!!i?.autoFixFaceOrientation&&i.autoFixFaceOrientation,i&&void 0!==i.updatable?this._updatable=i.updatable:this._updatable=!0,this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new Cm(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={}),this._tmpVertex=new fy}get multimaterial(){return this._multimaterial}get useModelMaterial(){return this._useModelMaterial}getParticleById(e){const t=this.particles[e];if(t&&t.id==e)return t;const i=this.particles,n=this._idxOfId[e];if(void 0!==n)return i[n];let a=0;const s=this.nbParticles;for(;a<s;){const t=i[a];if(t.id==e)return t;a++}return null}_addParticle(e,t,i,n,a,s,r,o=null,l=null){const c=new ly(e,t,i,n,a,s,r,this,o);return(l||this.particles).push(c),c}get autoUpdateSubMeshes(){return this._autoUpdateSubMeshes}_resetCopy(){const e=this._copy;e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.copyFromFloats(0,0,1,1),e.color=null,e.translateFromPivot=!1,e.shapeId=0,e.materialIndex=null}get computeParticleRotation(){return this._computeParticleRotation}_filterUniqueMaterialId(e){return e.filter((function(e,t,i){return i.indexOf(e)===t}))}set computeBoundingBox(e){this._computeBoundingBox=e}get expandable(){return this._expandable}buildMesh(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){const e=zg("",{radius:1,tessellation:3},this._scene);this.addShape(e,1),e.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){const e=new wm(this.name,this._scene);this.mesh=e}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&_f.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();const e=new _f;if(e.indices=this._depthSort?this._indices:this._indices32,e.set(this._positions32,$h.PositionKind),e.set(this._normals32,$h.NormalKind),this._uvs32.length>0&&e.set(this._uvs32,$h.UVKind),this._colors32.length>0&&e.set(this._colors32,$h.ColorKind),e.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._pickable){let e=0;for(let t=0;t<this.nbParticles;t++){const i=this.particles[t],n=i._model._indicesLength;for(let t=0;t<n;t++){if(0==t%3){const t={idx:i.idx,faceId:e};this.pickedParticles[e]=t,e++}}}}return this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||this._autoFixFaceOrientation||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this._recomputeInvisibles=!0,this.mesh}updateParticleVertex(e,t,i){return this}_rebuildParticle(e,t=!1){this._resetCopy();const i=this._copy;e._model._positionFunction&&e._model._positionFunction(i,e.idx,e.idxInShape);const n=kh.Matrix[0],a=kh.Vector3[0],s=kh.Vector3[1],r=kh.Vector3[2],o=kh.Vector3[3];i.getRotationMatrix(n),e.pivot.multiplyToRef(e.scaling,o),i.translateFromPivot?r.copyFromFloats(0,0,0):r.copyFrom(o);const l=e._model._shape;for(let t=0;t<l.length;t++)a.copyFrom(l[t]),e._model._vertexFunction&&e._model._vertexFunction(i,a,t),a.multiplyInPlace(i.scaling).subtractInPlace(o),wh.TransformCoordinatesToRef(a,n,s),s.addInPlace(r).addInPlace(i.position).toArray(this._positions32,e._pos+3*t);t&&(e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.setAll(0),e.pivot.setAll(0),e.translateFromPivot=!1,e.parentId=null)}initParticles(){}setMultiMaterial(e){this._materials=this._filterUniqueMaterialId(e),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new Cm(this.name+"MultiMaterial",this._scene);for(let e=0;e<this._materials.length;e++)this._multimaterial.subMaterials.push(this._materials[e]);this.computeSubMeshes(),this.mesh.material=this._multimaterial}_setMaterialIndexesById(){this._materialIndexesById={};for(let e=0;e<this._materials.length;e++){const t=this._materials[e].xt;this._materialIndexesById[t]=e}}setParticles(e=0,t=this.nbParticles-1,i=!0){if(!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(e,t,i);const n=kh.Matrix[0],a=kh.Matrix[1],s=this.mesh,r=this._colors32,o=this._positions32,l=this._normals32,c=this._uvs32,h=this._indices32,f=this._indices,u=this._fixedNormal32,d=this._depthSort&&this._depthSortParticles,m=kh.Vector3,p=m[5].copyFromFloats(1,0,0),_=m[6].copyFromFloats(0,1,0),v=m[7].copyFromFloats(0,0,1),g=m[8].setAll(Number.MAX_VALUE),S=m[9].setAll(-Number.MAX_VALUE),y=m[10].setAll(0),E=this._tmpVertex,A=E.position,C=E.color,R=E.uv;if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(a)),this.billboard){const e=m[0];this._camera.getDirectionToRef(Ld.Z,e),wh.TransformNormalToRef(e,a,v),v.normalize();const t=this._camera.getViewMatrix(!0);wh.TransformNormalFromFloatsToRef(t.m[1],t.m[5],t.m[9],a,_),wh.CrossToRef(_,v,p),_.normalize(),p.normalize()}this._depthSort&&wh.TransformCoordinatesToRef(this._camera.globalPosition,a,y),Lh.IdentityToRef(n);let T=0,N=0,M=0,I=0,x=0,b=0,P=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),t=t>=this.nbParticles?this.nbParticles-1:t,this._computeBoundingBox&&(0!=e||t!=this.nbParticles-1)){const e=this.mesh.getBoundingInfo();e&&(g.copyFrom(e.minimum),S.copyFrom(e.maximum))}N=this.particles[e]._pos;const w=N/3|0;I=4*w,b=2*w;for(let i=e;i<=t;i++){const e=this.particles[i];this.updateParticle(e);const t=e._model._shape,a=e._model._shapeUV,h=e._rotationMatrix,f=e.position,w=e.rotation,O=e.scaling,D=e._globalPosition;if(d){const t=this.depthSortedParticles[i];t.idx=e.idx,t.ind=e._ind,t.indicesLength=e._model._indicesLength,t.sqDistance=wh.DistanceSquared(e.position,y)}if(e.alive&&(!e._stillInvisible||e.isVisible||this._recomputeInvisibles)){if(e.isVisible){e._stillInvisible=!1;const i=m[12];e.pivot.multiplyToRef(O,i),this.billboard&&(w.x=0,w.y=0),(this._computeParticleRotation||this.billboard)&&e.getRotationMatrix(n);if(null!==e.parentId){const t=this.getParticleById(e.parentId);if(t){const e=t._rotationMatrix,i=t._globalPosition,a=f.x*e[1]+f.y*e[4]+f.z*e[7],s=f.x*e[0]+f.y*e[3]+f.z*e[6],r=f.x*e[2]+f.y*e[5]+f.z*e[8];if(D.x=i.x+s,D.y=i.y+a,D.z=i.z+r,this._computeParticleRotation||this.billboard){const t=n.m;h[0]=t[0]*e[0]+t[1]*e[3]+t[2]*e[6],h[1]=t[0]*e[1]+t[1]*e[4]+t[2]*e[7],h[2]=t[0]*e[2]+t[1]*e[5]+t[2]*e[8],h[3]=t[4]*e[0]+t[5]*e[3]+t[6]*e[6],h[4]=t[4]*e[1]+t[5]*e[4]+t[6]*e[7],h[5]=t[4]*e[2]+t[5]*e[5]+t[6]*e[8],h[6]=t[8]*e[0]+t[9]*e[3]+t[10]*e[6],h[7]=t[8]*e[1]+t[9]*e[4]+t[10]*e[7],h[8]=t[8]*e[2]+t[9]*e[5]+t[10]*e[8]}}else e.parentId=null}else if(D.x=f.x,D.y=f.y,D.z=f.z,this._computeParticleRotation||this.billboard){const e=n.m;h[0]=e[0],h[1]=e[1],h[2]=e[2],h[3]=e[4],h[4]=e[5],h[5]=e[6],h[6]=e[8],h[7]=e[9],h[8]=e[10]}const s=m[11];for(e.translateFromPivot?s.setAll(0):s.copyFrom(i),P=0;P<t.length;P++){T=N+3*P,M=I+4*P,x=b+2*P;const n=2*P,r=n+1;A.copyFrom(t[P]),this._computeParticleColor&&e.color&&C.copyFrom(e.color),this._computeParticleTexture&&R.copyFromFloats(a[n],a[r]),this._computeParticleVertex&&this.updateParticleVertex(e,E,P);const f=A.x*O.x-i.x,d=A.y*O.y-i.y,m=A.z*O.z-i.z;let y=f*h[0]+d*h[3]+m*h[6],w=f*h[1]+d*h[4]+m*h[7],L=f*h[2]+d*h[5]+m*h[8];y+=s.x,w+=s.y,L+=s.z;const F=o[T]=D.x+p.x*y+_.x*w+v.x*L,k=o[T+1]=D.y+p.y*y+_.y*w+v.y*L,B=o[T+2]=D.z+p.z*y+_.z*w+v.z*L;if(this._computeBoundingBox&&(g.minimizeInPlaceFromFloats(F,k,B),S.maximizeInPlaceFromFloats(F,k,B)),!this._computeParticleVertex){const e=u[T],t=u[T+1],i=u[T+2],n=e*h[0]+t*h[3]+i*h[6],a=e*h[1]+t*h[4]+i*h[7],s=e*h[2]+t*h[5]+i*h[8];l[T]=p.x*n+_.x*a+v.x*s,l[T+1]=p.y*n+_.y*a+v.y*s,l[T+2]=p.z*n+_.z*a+v.z*s}if(this._computeParticleColor&&e.color){const e=this._colors32;e[M]=C.r,e[M+1]=C.g,e[M+2]=C.b,e[M+3]=C.a}if(this._computeParticleTexture){const t=e.uvs;c[x]=R.x*(t.z-t.x)+t.x,c[x+1]=R.y*(t.w-t.y)+t.y}}}else for(e._stillInvisible=!0,P=0;P<t.length;P++){if(T=N+3*P,M=I+4*P,x=b+2*P,o[T]=o[T+1]=o[T+2]=0,l[T]=l[T+1]=l[T+2]=0,this._computeParticleColor&&e.color){const t=e.color;r[M]=t.r,r[M+1]=t.g,r[M+2]=t.b,r[M+3]=t.a}if(this._computeParticleTexture){const t=e.uvs;c[x]=a[2*P]*(t.z-t.x)+t.x,c[x+1]=a[2*P+1]*(t.w-t.y)+t.y}}if(this._particlesIntersect){const t=e.getBoundingInfo(),i=t.boundingBox,n=t.boundingSphere,a=e._modelBoundingInfo;if(!this._bSphereOnly){const e=a.boundingBox.vectors,t=m[1],n=m[2];t.setAll(Number.MAX_VALUE),n.setAll(-Number.MAX_VALUE);for(let i=0;i<8;i++){const a=e[i].x*O.x,s=e[i].y*O.y,r=e[i].z*O.z,o=a*h[0]+s*h[3]+r*h[6],l=a*h[1]+s*h[4]+r*h[7],c=a*h[2]+s*h[5]+r*h[8],u=f.x+p.x*o+_.x*l+v.x*c,d=f.y+p.y*o+_.y*l+v.y*c,m=f.z+p.z*o+_.z*l+v.z*c;t.minimizeInPlaceFromFloats(u,d,m),n.maximizeInPlaceFromFloats(u,d,m)}i.reConstruct(t,n,s._worldMatrix)}const r=a.minimum.multiplyToRef(O,m[1]),o=a.maximum.multiplyToRef(O,m[2]),l=o.addToRef(r,m[3]).scaleInPlace(.5).addInPlace(D),c=o.subtractToRef(r,m[4]).scaleInPlace(.5*this._bSphereRadiusFactor),u=l.subtractToRef(c,m[1]),d=l.addToRef(c,m[2]);n.reConstruct(u,d,s._worldMatrix)}N=T+3,I=M+4,b=x+2}else P=t.length,N+=3*P,I+=4*P,b+=2*P}if(i){if(this._computeParticleColor){const e=s.getVertexBuffer($h.ColorKind);e&&!s.isPickable?e.updateDirectly(r,0):s.updateVerticesData($h.ColorKind,r,!1,!1)}if(this._computeParticleTexture){const e=s.getVertexBuffer($h.UVKind);e&&!s.isPickable?e.updateDirectly(c,0):s.updateVerticesData($h.UVKind,c,!1,!1)}const e=s.getVertexBuffer($h.PositionKind);if(e&&!s.isPickable?e.updateDirectly(o,0):s.updateVerticesData($h.PositionKind,o,!1,!1),!s.areNormalsFrozen||s.isFacetDataEnabled){if(this._computeParticleVertex||s.isFacetDataEnabled){const e=s.isFacetDataEnabled?s.getFacetDataParameters():null;_f.ComputeNormals(o,h,l,e);for(let e=0;e<l.length;e++)u[e]=l[e]}if(!s.areNormalsFrozen){const e=s.getVertexBuffer($h.NormalKind);e&&!s.isPickable?e.updateDirectly(l,0):s.updateVerticesData($h.NormalKind,l,!1,!1)}}if(d){const e=this.depthSortedParticles;e.sort(this._depthSortFunction);const t=e.length;let i=0,n=0;for(let a=0;a<t;a++){const t=e[a],s=t.indicesLength,r=t.ind;for(let e=0;e<s;e++)if(h[i]=f[r+e],i++,this._pickable){if(0==e%3){const e=this.pickedParticles[n];e.idx=t.idx,e.faceId=n,n++}}}}if(this._autoFixFaceOrientation){let e=0;for(let t=0;t<this.particles.length;t++){const i=d?this.particles[this.depthSortedParticles[t].idx]:this.particles[t];if(i.scale.x*i.scale.y*i.scale.z<0)for(let t=0;t<i._model._indicesLength;t+=3){const n=f[i._ind+t];h[e+t]=f[i._ind+t+1],h[e+t+1]=n}e+=i._model._indicesLength}}(d||this._autoFixFaceOrientation)&&s.updateIndices(h)}return this._computeBoundingBox&&(s.hasBoundingInfo?s.getBoundingInfo().reConstruct(g,S,s._worldMatrix):s.buildBoundingInfo(g,S,s._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this._recomputeInvisibles=!1,this.afterUpdateParticles(e,t,i),this}set computeParticleColor(e){this._computeParticleColor=e}_unrotateFixedNormals(){let e=0,t=0;const i=kh.Vector3[0],n=kh.Ht[0],a=kh.Matrix[0];for(let s=0;s<this.particles.length;s++){const r=this.particles[s],o=r._model._shape;if(r.rotationQuaternion)r.rotationQuaternion.conjugateToRef(n);else{const e=r.rotation;Dh.RotationYawPitchRollToRef(e.y,e.x,e.z,n),n.conjugateInPlace()}n.toRotationMatrix(a);for(let n=0;n<o.length;n++)t=e+3*n,wh.TransformNormalFromFloatsToRef(this._normals32[t],this._normals32[t+1],this._normals32[t+2],a,i),i.toArray(this._fixedNormal32,t);e=t+3}}get materials(){return this._materials}_insertNewParticle(e,t,i,n,a,s,r,o,l,c,h){const f=this._positions.length,u=this._indices.length,d=this._meshBuilder(this._index,u,n,this._positions,a,this._indices,s,this._uvs,r,this._colors,o,this._normals,e,t,h,i);let m=null;return this._updatable&&(m=this._addParticle(this.nbParticles,this._lastParticleId,f,u,i,this._shapeCounter,t,l,c),m.position.copyFrom(d.position),m.rotation.copyFrom(d.rotation),d.rotationQuaternion&&(m.rotationQuaternion?m.rotationQuaternion.copyFrom(d.rotationQuaternion):m.rotationQuaternion=d.rotationQuaternion.clone()),d.color&&(m.color?m.color.copyFrom(d.color):m.color=d.color.clone()),m.scaling.copyFrom(d.scaling),m.uvs.copyFrom(d.uvs),null!==d.materialIndex&&(m.materialIndex=d.materialIndex),this.expandable&&(this._idxOfId[m.id]=m.idx)),c||(this._index+=n.length,this.nbParticles++,this._lastParticleId++),m}set depthSortParticles(e){this._depthSortParticles=e}_setDefaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=new Og(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial}addShape(e,t,i){const n=e.getVerticesData($h.PositionKind),a=e.getIndices(),s=e.getVerticesData($h.UVKind),r=e.getVerticesData($h.ColorKind),o=e.getVerticesData($h.NormalKind);this.recomputeNormals=!o;const l=Array.from(a),c=o?Array.from(o):[],h=r?Array.from(r):[],f=i&&i.storage?i.storage:null;let u=null;this._particlesIntersect&&(u=e.getBoundingInfo());const d=this._posToShape(n),m=this._uvsToShapeUV(s),p=i?i.positionFunction:null,_=i?i.vertexFunction:null;let v=null;this._useModelMaterial&&(v=e.material?e.material:this._setDefaultMaterial());const g=new cy(this._shapeCounter,d,l,c,h,m,p,_,v);for(let e=0;e<t;e++)this._insertNewParticle(this.nbParticles,e,g,d,a,s,r,o,u,f,i);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1}recycleParticle(e){return e}set isAlwaysVisible(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e}_meshBuilder(e,t,i,n,a,s,r,o,l,c,h,f,u,d,m,p){let _,v=0,g=0,S=0;this._resetCopy();const y=this._copy,E=!(!m||!m.storage);if(y.idx=u,y.idxInShape=d,y.shapeId=p.shapeId,this._useModelMaterial){const e=p._material.xt,t=this._materialIndexesById;Object.prototype.hasOwnProperty.call(t,e)||(t[e]=this._materials.length,this._materials.push(p._material));const i=t[e];y.materialIndex=i}if(m&&m.positionFunction&&(m.positionFunction(y,u,d),this._mustUnrotateFixedNormals=!0),E)return y;const A=kh.Matrix[0],C=this._tmpVertex,R=C.position,T=C.color,N=C.uv,M=kh.Vector3[1],I=kh.Vector3[2],x=kh.Vector3[3];Lh.IdentityToRef(A),y.getRotationMatrix(A),y.pivot.multiplyToRef(y.scaling,x),y.translateFromPivot?I.setAll(0):I.copyFrom(x);const b=m&&m.vertexFunction;for(_=0;_<i.length;_++){if(R.copyFrom(i[_]),y.color&&T.copyFrom(y.color),r&&N.copyFromFloats(r[v],r[v+1]),b&&m.vertexFunction(y,C,_),R.multiplyInPlace(y.scaling).subtractInPlace(x),wh.TransformCoordinatesToRef(R,A,M),M.addInPlace(I).addInPlace(y.position),n.push(M.x,M.y,M.z),r){const e=y.uvs;o.push((e.z-e.x)*N.x+e.x,(e.w-e.y)*N.y+e.y),v+=2}if(y.color)this._color.copyFrom(T);else{const e=this._color;l&&void 0!==l[g]?(e.r=l[g],e.g=l[g+1],e.b=l[g+2],e.a=l[g+3]):(e.r=1,e.g=1,e.b=1,e.a=1)}c.push(this._color.r,this._color.g,this._color.b,this._color.a),g+=4,!this.recomputeNormals&&h&&(wh.TransformNormalFromFloatsToRef(h[S],h[S+1],h[S+2],A,R),f.push(R.x,R.y,R.z),S+=3)}for(_=0;_<a.length;_++){const t=e+a[_];s.push(t),t>65535&&(this._needs32Bits=!0)}if(this._depthSort||this._multimaterialEnabled){const e=null!==y.materialIndex?y.materialIndex:0;this.depthSortedParticles.push(new hy(u,t,a.length,e))}return y}beforeUpdateParticles(e,t,i){}set isVisibilityBoxLocked(e){this._isVisibilityBoxLocked=e;this.mesh.getBoundingInfo().isLocked=e}insertParticlesFromArray(e){if(!this._expandable)return this;let t=0,i=e[0].shapeId;const n=e.length;for(let a=0;a<n;a++){const n=e[a],s=n._model,r=s._shape,o=s._indices,l=s._shapeUV,c=s._shapeColors,h=s._normals,f=!h;this.recomputeNormals=f||this.recomputeNormals;const u=n.getBoundingInfo(),d=this._insertNewParticle(this.nbParticles,t,s,r,o,l,c,h,u,null,null);n.copyToRef(d),t++,i!=n.shapeId&&(i=n.shapeId,t=0)}return this._isNotBuilt=!0,this}get multimaterialEnabled(){return this._multimaterialEnabled}},dy=class{setValue(e,t){if(this._targetIsArray)for(let i=0;i<this._target.length;i++){const n=this._target[i];this._setValue(n,this._activeTargets[i],e,t,i)}else this._setValue(this._target,this._directTarget,e,t,0)}animate(e,t,i,n,a,s=-1){const r=this._animation,o=r.targetPropertyPath;if(!o||o.length<1)return this._stopped=!0,!1;let l=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(i<this._minFrame||i>this._maxFrame)&&(i=this._maxFrame);const c=i-t;let h,f=e*(r.framePerSecond*a)/1e3+this._absoluteFrameOffset,u=0,d=!1;const m=n&&this._animationState.loopMode===Ov.ANIMATIONLOOPMODE_YOYO;if(m){const e=(f-t)/c,i=Math.sin(e*Math.PI);f=Math.abs(i)*c+t;const n=i>=0?1:-1;this._yoyoDirection!==n&&(d=!0),this._yoyoDirection=n}if(this._previousElapsedTime=e,this._previousAbsoluteFrame=f,!n&&i>=t&&(f>=c&&a>0||f<=0&&a<0))l=!1,u=r._getKeyValue(this._maxValue);else if(!n&&t>=i&&(f<=c&&a<0||f>=0&&a>0))l=!1,u=r._getKeyValue(this._minValue);else if(this._animationState.loopMode!==Ov.ANIMATIONLOOPMODE_CYCLE){const e=i.toString()+t.toString();if(!this._offsetsCache[e]){this._animationState.repeatCount=0,this._animationState.loopMode=Ov.ANIMATIONLOOPMODE_CYCLE;const n=r._interpolate(t,this._animationState),a=r._interpolate(i,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),r.dataType){case Ov.ANIMATIONTYPE_FLOAT:this._offsetsCache[e]=a-n;break;case Ov.ANIMATIONTYPE_QUATERNION:case Ov.ANIMATIONTYPE_VECTOR3:case Ov.ANIMATIONTYPE_VECTOR2:case Ov.ANIMATIONTYPE_SIZE:case Ov.ANIMATIONTYPE_COLOR3:this._offsetsCache[e]=a.subtract(n)}this._highLimitsCache[e]=a}u=this._highLimitsCache[e],h=this._offsetsCache[e]}if(void 0===h)switch(r.dataType){case Ov.ANIMATIONTYPE_FLOAT:h=0;break;case Ov.ANIMATIONTYPE_QUATERNION:h=Nv;break;case Ov.ANIMATIONTYPE_VECTOR3:h=Mv;break;case Ov.ANIMATIONTYPE_VECTOR2:h=Iv;break;case Ov.ANIMATIONTYPE_SIZE:h=xv;break;case Ov.ANIMATIONTYPE_COLOR3:h=bv;break;case Ov.ANIMATIONTYPE_COLOR4:h=Pv}let p;if(this._host&&this._host.syncRoot){const e=this._host.syncRoot;p=t+c*((e.masterFrame-e.fromFrame)/(e.toFrame-e.fromFrame))}else p=f>0&&t>i||f<0&&t<i?l&&0!==c?i+f%c:t:l&&0!==c?t+f%c:i;const _=this._events;if(!m&&(a>0&&this.currentFrame>p||a<0&&this.currentFrame<p)||m&&d){this._onLoop();for(let e=0;e<_.length;e++)_[e].onlyOnce||(_[e].isDone=!1);this._animationState.key=a>0?0:r.getKeys().length-1}this._currentFrame=p,this._animationState.repeatCount=0===c?0:f/c>>0,this._animationState.highLimitValue=u,this._animationState.offsetValue=h;const v=r._interpolate(p,this._animationState);if(this.setValue(v,s),_.length)for(let e=0;e<_.length;e++)if(c>=0&&p>=_[e].frame&&_[e].frame>=t||c<0&&p<=_[e].frame&&_[e].frame<=t){const t=_[e];t.isDone||(t.onlyOnce&&(_.splice(e,1),e--),t.isDone=!0,t.action(p))}return l||(this._stopped=!0),l}constructor(e,t,i,n){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=t,this._target=e,this._scene=i,this._host=n,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===Ov.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=Lh.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const e={frame:0,value:this._minValue};this._keys.splice(0,0,e)}if(this._target instanceof Array){let e=0;for(const t of this._target)this._preparePath(t,e),this._getOriginalValues(e),e++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const a=t.getEvents();a&&a.length>0&&a.forEach((e=>{this._events.push(e._clone())})),this._enableBlending=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.enableBlending:this._animation.enableBlending}get targetPath(){return this._targetPath}_prepareForSpeedRatioChange(e){const t=this._previousElapsedTime*(this._animation.framePerSecond*e)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-t}get animation(){return this._animation}_setValue(e,t,i,n,a){if(this._currentActiveTarget=t,this._weight=n,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const e=t[this._targetPath];e.clone?this._originalBlendValue=e.clone():this._originalBlendValue=e}this._originalBlendValue.m?Ov.AllowMatrixDecomposeForInterpolation?this._currentValue?Lh.DecomposeLerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=Lh.DecomposeLerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue?Lh.LerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=Lh.Lerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue=Ov._UniversalLerp(this._originalBlendValue,i,this._blendingFactor);const n=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=n}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(i):this._currentValue=i:this._currentValue=i?.clone?i.clone():i;-1!==n?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[a]):this._animationState.loopMode===Ov.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[a],t[this._targetPath]):t[this._targetPath]=this._originalValue[a]+this._currentValue:t[this._targetPath]=this._currentValue,e.markAsDirty&&e.markAsDirty(this._animation.targetProperty)}get isAdditive(){return this._host&&this._host.isAdditive}goToFrame(e,t=-1){const i=this._animation.getKeys();e<i[0].frame?e=i[0].frame:e>i[i.length-1].frame&&(e=i[i.length-1].frame);const n=this._events;if(n.length)for(let t=0;t<n.length;t++)n[t].onlyOnce||(n[t].isDone=n[t].frame<e);this._currentFrame=e;const a=this._animation._interpolate(e,this._animationState);this.setValue(a,t)}dispose(){const e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)}get target(){return this._currentActiveTarget}get weight(){return this._weight}_getOriginalValues(e=0){let t;const i=this._activeTargets[e];t=i.getLocalMatrix&&"_matrix"===this._targetPath?i.getLocalMatrix():i[this._targetPath],t&&t.clone?this._originalValue[e]=t.clone():this._originalValue[e]=t}_preparePath(e,t=0){const i=this._animation.targetPropertyPath;if(i.length>1){let n=e;for(let e=0;e<i.length-1;e++){const t=i[e];if(n=n[t],void 0===n)throw new Error(`Invalid property (${t}) in property path (${i.join(".")})`)}this._targetPath=i[i.length-1],this._activeTargets[t]=n}else this._targetPath=i[0],this._activeTargets[t]=e;if(void 0===this._activeTargets[t][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${i.join(".")})`)}reset(e=!1){if(e)if(this._target instanceof Array){let e=0;for(const t of this._target)void 0!==this._originalValue[e]&&this._setValue(t,this._activeTargets[e],this._originalValue[e],-1,e),e++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let e=0;e<this._events.length;e++)this._events[e].isDone=!1}get currentValue(){return this._currentValue}isStopped(){return this._stopped}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}get currentFrame(){return this._currentFrame}},my=class{set speedRatio(e){for(let t=0;t<this._runtimeAnimations.length;t++){this._runtimeAnimations[t]._prepareForSpeedRatioChange(e)}this._speedRatio=e,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}disableBlending(){const e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].animation.enableBlending=!1}getAnimationByTargetProperty(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i].animation;return null}constructor(e,t,i=0,n=100,a=!1,s=1,r,o,l,c=!1,h=0){this.target=t,this.fromFrame=i,this.toFrame=n,this.loopAnimation=a,this.onAnimationEnd=r,this.onAnimationLoop=l,this.isAdditive=c,this.playOrder=h,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new Ih,this.onAnimationLoopObservable=new Ih,this._scene=e,o&&this.appendAnimations(t,o),this._speedRatio=s,e._activeAnimatables.push(this)}waitAsync(){return new Promise((e=>{this.onAnimationEndObservable.add((()=>{e(this)}),void 0,void 0,this,!0)}))}getAnimations(){return this._runtimeAnimations}get weight(){return this._weight}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}pause(){this._paused||(this._paused=!0)}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}set weight(e){this._weight=-1!==e?Math.min(Math.max(e,0),1):-1}restart(){this._paused=!1}goToFrame(e){const t=this._runtimeAnimations;if(t[0]){const i=t[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??t[0].currentFrame;const n=0===this.speedRatio?0:(e-this._frameToSyncFromJump)/i*1e3/this.speedRatio;this._manualJumpDelay=-n}for(let i=0;i<t.length;i++)t[i].goToFrame(e,this._weight);this._goToFrame=e}getRuntimeAnimationByTargetProperty(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i];return null}_animate(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight)return!0;let t=!1;const i=this._runtimeAnimations;let n;for(n=0;n<i.length;n++){const a=i[n].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);t=t||a}if(this.animationStarted=t,!t){if(this.disposeOnEnd)for(n=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(n,1),n=0;n<i.length;n++)i[n].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return t}get syncRoot(){return this._syncRoot}stop(e,t,i=!1,n=!1){if(e||t){const a=this._scene._activeAnimatables.indexOf(this);if(a>-1){const s=this._runtimeAnimations;for(let i=s.length-1;i>=0;i--){const n=s[i];e&&n.animation.name!=e||(t&&!t(n.target)||(n.dispose(),s.splice(i,1)))}0==s.length&&(i||this._scene._activeAnimatables.splice(a,1),n||this._raiseOnAnimationEnd())}}else{const e=this._scene._activeAnimatables.indexOf(this);if(e>-1){i||this._scene._activeAnimatables.splice(e,1);const t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].dispose();this._runtimeAnimations.length=0,n||this._raiseOnAnimationEnd()}}}get paused(){return this._paused}enableBlending(e){const t=this._runtimeAnimations;for(let i=0;i<t.length;i++)t[i].animation.enableBlending=!0,t[i].animation.blendingSpeed=e}get speedRatio(){return this._speedRatio}syncWith(e){if(this._syncRoot=e,e){const e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this}reset(){const e=this._runtimeAnimations;for(let t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}appendAnimations(e,t){for(let i=0;i<t.length;i++){const n=t[i],a=new dy(e,n,this._scene,this);a._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(a)}}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}};dv.prototype._animate=function(e){if(!this.animationsEnabled)return;const t=Cf.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}this.deltaTime=void 0!==e?e:this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=t;const i=this._activeAnimatables;if(0===i.length)return;this._animationTime+=this.deltaTime;const n=this._animationTime;for(let e=0;e<i.length;e++){const t=i[e];!t._animate(n)&&t.disposeOnEnd&&e--}this._processLateAnimationBindings()},dv.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((e,t)=>e.playOrder-t.playOrder))},dv.prototype.beginWeightedAnimation=function(e,t,i,n=1,a,s=1,r,o,l,c,h=!1){const f=this.beginAnimation(e,t,i,a,s,r,o,!1,l,c,h);return f.weight=n,f},dv.prototype.beginAnimation=function(e,t,i,n,a=1,s,r,o=!0,l,c,h=!1){t>i&&a>0&&(a*=-1),o&&this.stopAnimation(e,void 0,l),r||(r=new my(this,e,t,i,n,a,s,void 0,c,h));const f=!l||l(e);if(e.animations&&f&&r.appendAnimations(e,e.animations),e.getAnimatables){const h=e.getAnimatables();for(let e=0;e<h.length;e++)this.beginAnimation(h[e],t,i,n,a,s,r,o,l,c)}return r.reset(),r},dv.prototype.beginHierarchyAnimation=function(e,t,i,n,a,s=1,r,o,l=!0,c,h,f=!1){const u=e.getDescendants(t),d=[];d.push(this.beginAnimation(e,i,n,a,s,r,o,l,c,void 0,f));for(const e of u)d.push(this.beginAnimation(e,i,n,a,s,r,o,l,c,void 0,f));return d},dv.prototype.beginDirectAnimation=function(e,t,i,n,a,s,r,o,l=!1){if(void 0===s&&(s=1),i>n&&s>0)s*=-1;else if(n>i&&s<0){const e=n;n=i,i=e}return new my(this,e,i,n,a,s,r,t,o,l)},dv.prototype.beginDirectHierarchyAnimation=function(e,t,i,n,a,s,r,o,l,c=!1){const h=e.getDescendants(t),f=[];f.push(this.beginDirectAnimation(e,i,n,a,s,r,o,l,c));for(const e of h)f.push(this.beginDirectAnimation(e,i,n,a,s,r,o,l,c));return f},dv.prototype.getAnimatableByTarget=function(e){for(let t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},dv.prototype.getAllAnimatablesByTarget=function(e){const t=[];for(let i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].target===e&&t.push(this._activeAnimatables[i]);return t},dv.prototype.stopAnimation=function(e,t,i){const n=this.getAllAnimatablesByTarget(e);for(const e of n)e.stop(t,i)},dv.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const e of this.animationGroups)e.stop()},dv.prototype._registerTargetForLateAnimationBinding=function(e,t){const i=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[e.targetPath]||(i._lateAnimationHolders[e.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:t}),e.isAdditive?(i._lateAnimationHolders[e.targetPath].additiveAnimations.push(e),i._lateAnimationHolders[e.targetPath].totalAdditiveWeight+=e.weight):(i._lateAnimationHolders[e.targetPath].animations.push(e),i._lateAnimationHolders[e.targetPath].totalWeight+=e.weight)},dv.prototype._processLateAnimationBindingsForMatrices=function(e){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return e.originalValue;let t=1;const i=kh.Vector3[0],n=kh.Vector3[1],a=kh.Ht[0];let s=0;const r=e.animations[0],o=e.originalValue;let l=1,c=!1;if(e.totalWeight<1)l=1-e.totalWeight,o.decompose(n,a,i);else{if(s=1,t=e.totalWeight,l=r.weight/t,1==l){if(!e.totalAdditiveWeight)return r.currentValue;c=!0}r.currentValue.decompose(n,a,i)}if(!c){n.scaleInPlace(l),i.scaleInPlace(l),a.scaleInPlace(l);for(let r=s;r<e.animations.length;r++){const s=e.animations[r];if(0===s.weight)continue;l=s.weight/t;const o=kh.Vector3[2],c=kh.Vector3[3],h=kh.Ht[1];s.currentValue.decompose(c,h,o),c.scaleAndAddToRef(l,n),h.scaleAndAddToRef(Dh.Dot(a,h)>0?l:-l,a),o.scaleAndAddToRef(l,i)}a.normalize()}for(let t=0;t<e.additiveAnimations.length;t++){const s=e.additiveAnimations[t];if(0===s.weight)continue;const r=kh.Vector3[2],o=kh.Vector3[3],l=kh.Ht[1];s.currentValue.decompose(o,l,r),o.multiplyToRef(n,o),wh.LerpToRef(n,o,s.weight,n),a.multiplyToRef(l,l),Dh.SlerpToRef(a,l,s.weight,a),r.scaleAndAddToRef(s.weight,i)}const h=r?r._animationState.workValue:kh.Matrix[0].clone();return Lh.ComposeToRef(n,a,i,h),h},dv.prototype._processLateAnimationBindingsForQuaternions=function(e,t){if(0===e.totalWeight&&0===e.totalAdditiveWeight)return t;const i=e.animations[0],n=e.originalValue;let a=t;if(0===e.totalWeight&&e.totalAdditiveWeight>0)a.copyFrom(n);else if(1===e.animations.length){if(Dh.SlerpToRef(n,i.currentValue,Math.min(1,e.totalWeight),a),0===e.totalAdditiveWeight)return a}else if(e.animations.length>1){let i,s,r=1;if(e.totalWeight<1){const t=1-e.totalWeight;i=[],s=[],i.push(n),s.push(t)}else{if(2===e.animations.length&&(Dh.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),0===e.totalAdditiveWeight))return t;i=[],s=[],r=e.totalWeight}for(let t=0;t<e.animations.length;t++){const n=e.animations[t];i.push(n.currentValue),s.push(n.weight/r)}let o=0;for(let e=0;e<i.length;)e?(o+=s[e],Dh.SlerpToRef(a,i[e],s[e]/o,a),e++):(Dh.SlerpToRef(i[e],i[e+1],s[e+1]/(s[e]+s[e+1]),t),a=t,o=s[e]+s[e+1],e+=2)}for(let t=0;t<e.additiveAnimations.length;t++){const i=e.additiveAnimations[t];0!==i.weight&&(a.multiplyToRef(i.currentValue,kh.Ht[0]),Dh.SlerpToRef(a,kh.Ht[0],i.weight,a))}return a},dv.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(let e=0;e<this._registeredForLateAnimationBindings.length;e++){const t=this._registeredForLateAnimationBindings.data[e];for(const e in t._lateAnimationHolders){const i=t._lateAnimationHolders[e],n=i.animations[0],a=i.originalValue;if(null==a)continue;const s=Ov.AllowMatrixDecomposeForInterpolation&&a.m;let r=t[e];if(s)r=this._processLateAnimationBindingsForMatrices(i);else{if(void 0!==a.w)r=this._processLateAnimationBindingsForQuaternions(i,r||Dh.Identity());else{let e=0,t=1;const s=n&&n._animationState.loopMode===Ov.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(i.totalWeight<1)r=s?a.clone?a.clone():a:n&&a.scale?a.scale(1-i.totalWeight):n?a*(1-i.totalWeight):a.clone?a.clone():a;else if(n){t=i.totalWeight;const o=n.weight/t;r=1!==o?n.currentValue.scale?n.currentValue.scale(o):n.currentValue*o:n.currentValue,s&&(r.addToRef?r.addToRef(a,r):r+=a),e=1}for(let n=e;n<i.animations.length;n++){const e=i.animations[n],a=e.weight/t;a&&(e.currentValue.scaleAndAddToRef?e.currentValue.scaleAndAddToRef(a,r):r+=e.currentValue*a)}for(let e=0;e<i.additiveAnimations.length;e++){const t=i.additiveAnimations[e],n=t.weight;n&&(t.currentValue.scaleAndAddToRef?t.currentValue.scaleAndAddToRef(n,r):r+=t.currentValue*n)}}}t[e]=r}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},iy.prototype.copyAnimationRange=function(e,t,i,n=!1,a=null){0===this.animations.length&&(this.animations.push(new Ov(this.name,"_matrix",e.animations[0].framePerSecond,Ov.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const s=e.animations[0].getRange(t);if(!s)return!1;const r=s.from,o=s.to,l=e.animations[0].getKeys(),c=e.length,h=e.getParent(),f=this.getParent(),u=n&&h&&c&&this.length&&c!==this.length,d=u&&f&&h?f.length/h.length:1,m=n&&!f&&a&&(1!==a.x||1!==a.y||1!==a.z),p=this.animations[0].getKeys();let _,v,g;for(let e=0,t=l.length;e<t;e++)_=l[e],_.frame>=r&&_.frame<=o&&(n?(g=_.value.clone(),u?(v=g.getTranslation(),g.setTranslation(v.scaleInPlace(d))):m&&a?(v=g.getTranslation(),g.setTranslation(v.multiplyInPlace(a))):g=_.value):g=_.value,p.push({frame:_.frame+i,value:g}));return this.animations[0].createRange(t,r+i,o+i),!0},Dr(),Ur();var py=class e{dispose(){const e=[];for(const t in this._scene._depthRenderer){this._scene._depthRenderer[t]===this&&e.push(t)}if(e.length>0){this._depthMap.dispose();for(const t of e)delete this._scene._depthRenderer[t]}}getDepthMap(){return this._depthMap}async _initShaderSourceAsync(t=!1){!this._scene.getEngine().isWebGPU||t||e.ForceGLSL?await Promise.all([Promise.resolve().then((()=>(Ur(),Fr))),Promise.resolve().then((()=>(Dr(),br)))]):(this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(Xr(),Hr))),Promise.resolve().then((()=>(qr(),Yr)))])),this._shadersLoaded=!0}isReady(e,t){if(!this._shadersLoaded)return!1;const i=this._scene.getEngine(),n=e.getMesh(),a=n.getScene(),s=n._internalAbstractMeshDataInfo._materialForRenderPass?.[i.currentRenderPassId];if(s)return s.isReadyForSubMesh(n,e,t);const r=e.getMaterial();if(!r||r.disableDepthWrite)return!1;const o=[],l=[$h.PositionKind];if(r&&r.needAlphaTesting()&&r.getAlphaTestTexture()&&(o.push("#define ALPHATEST"),n.isVerticesDataPresent($h.UVKind)&&(l.push($h.UVKind),o.push("#define UV1")),n.isVerticesDataPresent($h.UV2Kind)&&(l.push($h.UV2Kind),o.push("#define UV2"))),n.useBones&&n.computeBonesUsingShaders){l.push($h.MatricesIndicesKind),l.push($h.MatricesWeightsKind),n.numBoneInfluencers>4&&(l.push($h.MatricesIndicesExtraKind),l.push($h.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+n.numBoneInfluencers),o.push("#define BonesPerMesh "+(n.skeleton?n.skeleton.bones.length+1:0));const t=e.getRenderingMesh().skeleton;t?.isUsingTextureForMatrices&&o.push("#define BONETEXTURE")}else o.push("#define NUM_BONE_INFLUENCERS 0");const c=n.morphTargetManager;let h=0;c&&(h=c.numMaxInfluencers||c.numInfluencers,h>0&&(o.push("#define MORPHTARGETS"),o.push("#define NUM_MORPH_INFLUENCERS "+h),c.isUsingTextureForTargets&&o.push("#define MORPHTARGETS_TEXTURE"),$d(l,n,h))),r.pointsCloud&&o.push("#define POINTSIZE"),t&&(o.push("#define INSTANCES"),Jd(l),e.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES")),this._storeNonLinearDepth&&o.push("#define NONLINEARDEPTH"),this._storeCameraSpaceZ&&o.push("#define STORE_CAMERASPACE_Z"),this.isPacked&&o.push("#define PACKED"),Vd(r,a,o);const f=e._getDrawWrapper(void 0,!0),u=f.defines,d=o.join("\n");if(u!==d){const e=["world","mBones","boneTextureWidth","pointSize","viewProjection","view","diffuseMatrix","depthValues","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices"];Hd(e),f.setEffect(i.createEffect("depth",l,e,["diffuseSampler","morphTargets","boneSampler"],d,void 0,void 0,void 0,{maxSimultaneousMorphTargets:h},this._shaderLanguage),d)}return f.effect.isReady()}setMaterialForRendering(e,t){this._depthMap.setMaterialForRendering(e,t)}constructor(t,i=1,n=null,a=!1,s=yp.TRILINEAR_SAMPLINGMODE,r=!1,o){this._shaderLanguage=0,this.enabled=!0,this.forceDepthWriteTransparentMeshes=!1,this.useOnlyInActiveCamera=!1,this.reverseCulling=!1,this._shadersLoaded=!1,this._scene=t,this._storeNonLinearDepth=a,this._storeCameraSpaceZ=r,this.isPacked=0===i,this.isPacked?this.clearColor=new Ch(1,1,1,1):this.clearColor=new Ch(r?1e8:1,0,0,1),this._initShaderSourceAsync(),e._SceneComponentInitialization(this._scene);const l=t.getEngine();this._camera=n,s!==yp.NEAREST_SAMPLINGMODE&&(1!==i||l._caps.textureFloatLinearFiltering||(s=yp.NEAREST_SAMPLINGMODE),2!==i||l._caps.textureHalfFloatLinearFiltering||(s=yp.NEAREST_SAMPLINGMODE));const c=this.isPacked||!l._features.supportExtendedTextureFormats?5:6;this._depthMap=new qp(o??"DepthRenderer",{width:l.getRenderWidth(),height:l.getRenderHeight()},this._scene,!1,!0,i,!1,s,void 0,void 0,void 0,c),this._depthMap.wrapU=yp.CLAMP_ADDRESSMODE,this._depthMap.wrapV=yp.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.Pt=null,this._depthMap.noPrePassRenderer=!0,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add((e=>{e.clear(this.clearColor,!0,!0,!0)})),this._depthMap.onBeforeBindObservable.add((()=>{l._debugPushGroup?.("depth renderer",1)})),this._depthMap.onAfterUnbindObservable.add((()=>{l._debugPopGroup?.(1)})),this._depthMap.customIsReadyFunction=(e,t,i)=>{if((i||0===t)&&e.subMeshes)for(let t=0;t<e.subMeshes.length;++t){const i=e.subMeshes[t],n=i.getRenderingMesh(),a=n._getInstancesRenderList(i._id,!!i.getReplacementMesh()),s=l.getCaps().instancedArrays&&(null!==a.visibleInstances[i._id]&&void 0!==a.visibleInstances[i._id]||n.hasThinInstances);if(!this.isReady(i,s))return!1}return!0};const h=e=>{const t=e.getRenderingMesh(),i=e.getEffectiveMesh(),n=this._scene,a=n.getEngine(),s=e.getMaterial();if(i._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!s||i.infiniteDistance||s.disableDepthWrite||0===e.verticesCount||e._renderId===n.getRenderId())return;const r=i._getWorldMatrixDeterminant()<0;let o=s._getEffectiveOrientation(t);r&&(o=0===o?1:0);const l=0===o;a.setState(s.backFaceCulling,0,!1,l,this.reverseCulling?!s.cullBackFaces:s.cullBackFaces);const c=t._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(c.mustReturn)return;const h=a.getCaps().instancedArrays&&(null!==c.visibleInstances[e._id]&&void 0!==c.visibleInstances[e._id]||t.hasThinInstances),f=this._camera||n.activeCamera;if(this.isReady(e,h)&&f){e._renderId=n.getRenderId();const r=i._internalAbstractMeshDataInfo._materialForRenderPass?.[a.currentRenderPassId];let o=e._getDrawWrapper();!o&&r&&(o=r._getDrawWrapper());const l=f.mode===fd.ORTHOGRAPHIC_CAMERA;if(!o)return;const u=o.effect;let d,m;if(a.enableEffect(o),h||t._bind(e,u,s.fillMode),r?r.bindForSubMesh(i.getWorldMatrix(),i,e):(u.setMatrix("viewProjection",n.getTransformMatrix()),u.setMatrix("world",i.getWorldMatrix()),this._storeCameraSpaceZ&&u.setMatrix("view",n.getViewMatrix())),l?(d=!a.useReverseDepthBuffer&&a.isNDCHalfZRange?0:1,m=a.useReverseDepthBuffer&&a.isNDCHalfZRange?0:1):(d=a.useReverseDepthBuffer&&a.isNDCHalfZRange?f.minZ:a.isNDCHalfZRange?0:f.minZ,m=a.useReverseDepthBuffer&&a.isNDCHalfZRange?0:f.maxZ),u.setFloat2("depthValues",d,d+m),!r){if(s.needAlphaTesting()){const e=s.getAlphaTestTexture();e&&(u.setTexture("diffuseSampler",e),u.setMatrix("diffuseMatrix",e.getTextureMatrix()))}if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){const e=t.skeleton;if(e.isUsingTextureForMatrices){const i=e.getTransformMatrixTexture(t);if(!i)return;u.setTexture("boneSampler",i),u.setFloat("boneTextureWidth",4*(e.bones.length+1))}else u.setMatrices("mBones",e.getTransformMatrices(t))}Wd(u,s,n),Qd(t,u),t.morphTargetManager&&t.morphTargetManager.isUsingTextureForTargets&&t.morphTargetManager._bind(u),s.pointsCloud&&u.setFloat("pointSize",s.pointSize)}t._processRendering(i,e,u,s.fillMode,c,h,((e,t)=>u.setMatrix("world",t)))}};this._depthMap.customRenderFunction=(e,t,i,n)=>{let a;if(n.length)for(a=0;a<n.length;a++)h(n.data[a]);for(a=0;a<e.length;a++)h(e.data[a]);for(a=0;a<t.length;a++)h(t.data[a]);if(this.forceDepthWriteTransparentMeshes)for(a=0;a<i.length;a++)h(i.data[a]);else for(a=0;a<i.length;a++)i.data[a].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}}get shaderLanguage(){return this._shaderLanguage}};py.ForceGLSL=!1,py._SceneComponentInitialization=e=>{throw Qc("DepthRendererSceneComponent")},c();e.ShadersStore.minmaxReduxPixelShader="varying vec2 vUV;uniform sampler2D textureSampler;\n#if defined(INITIAL)\nuniform sampler2D sourceTexture;uniform vec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*(texSize-1.0));float f1=texelFetch(sourceTexture,coord,0).r;float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;float minz=min(min(min(f1,f2),f3),f4);\n#ifdef DEPTH_REDUX\nfloat maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);\n#else\nfloat maxz=max(max(max(f1,f2),f3),f4);\n#endif\nglFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(MAIN)\nuniform vec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*(texSize-1.0));vec2 f1=texelFetch(textureSampler,coord,0).rg;vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);glFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(ONEBEFORELAST)\nuniform ivec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*vec2(texSize-1));vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;float minz=min(f1.x,f2.x);float maxz=max(f1.y,f2.y);glFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(LAST)\nvoid main(void)\n{glFragColor=vec4(0.);if (true) { \ndiscard;}}\n#endif\n";var _y=class{set refreshRate(e){this._sourceTexture&&(this._sourceTexture.refreshRate=e)}get sourceTexture(){return this._sourceTexture}get activated(){return this._activated}deactivate(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)}constructor(e){this.onAfterReductionPerformed=new Ih,this._forceFullscreenViewport=!0,this._activated=!1,this._camera=e,this._postProcessManager=new Bp(e.getScene()),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{this._postProcessManager._rebuild()}))}setSourceTexture(e,t,i=2,n=!0){if(e===this._sourceTexture)return;this.dispose(!1),this._sourceTexture=e,this._reductionSteps=[],this._forceFullscreenViewport=n;const a=this._camera.getScene(),s=new Ip("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,1,a.getEngine(),!1,"#define INITIAL"+(t?"\n#define DEPTH_REDUX":""),i,void 0,void 0,void 0,7);s.autoClear=!1,s.forceFullscreenViewport=n;let r=this._sourceTexture.getRenderWidth(),o=this._sourceTexture.getRenderHeight();s.onApply=((e,t)=>i=>{i.setTexture("sourceTexture",this._sourceTexture),i.setFloat2("texSize",e,t)})(r,o),this._reductionSteps.push(s);let l=1;for(;r>1||o>1;){r=Math.max(Math.round(r/2),1),o=Math.max(Math.round(o/2),1);const e=new Ip("Reduction phase "+l,"minmaxRedux",["texSize"],null,{width:r,height:o},null,1,a.getEngine(),!1,"#define "+(1==r&&1==o?"LAST":1==r||1==o?"ONEBEFORELAST":"MAIN"),i,void 0,void 0,void 0,7);if(e.autoClear=!1,e.forceFullscreenViewport=n,e.onApply=((e,t)=>i=>{1==e||1==t?i.setInt2("texSize",e,t):i.setFloat2("texSize",e,t)})(r,o),this._reductionSteps.push(e),l++,1==r&&1==o){const t=(e,t,i)=>{const n=new Float32Array(4*e*t),s={min:0,max:0};return()=>{a.getEngine()._readTexturePixels(i.inputTexture.texture,e,t,-1,0,n,!1),s.min=n[0],s.max=n[1],this.onAfterReductionPerformed.notifyObservers(s)}};e.onAfterRenderObservable.add(t(r,o,e))}}}activate(){!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add((()=>{const e=this._camera.getScene().getEngine();e._debugPushGroup?.("min max reduction",1),this._reductionSteps[0].activate(this._camera),this._postProcessManager.directRender(this._reductionSteps,this._reductionSteps[0].inputTexture,this._forceFullscreenViewport),e.unBindFramebuffer(this._reductionSteps[0].inputTexture,!1),e._debugPopGroup?.(1)})),this._activated=!0)}dispose(e=!0){if(e&&(this.onAfterReductionPerformed.clear(),this._onContextRestoredObserver&&(this._camera.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)),this.deactivate(),this._reductionSteps){for(let e=0;e<this._reductionSteps.length;++e)this._reductionSteps[e].dispose();this._reductionSteps=null}this._postProcessManager&&e&&this._postProcessManager.dispose(),this._sourceTexture=null}get refreshRate(){return this._sourceTexture?this._sourceTexture.refreshRate:-1}},vy=class extends _y{setDepthRenderer(e=null,t=2,i=!0){const n=this._camera.getScene();this._depthRenderer&&(delete n._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),null===e&&(n._depthRenderer||(n._depthRenderer={}),(e=this._depthRenderer=new py(n,t,this._camera,!1,1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,n._depthRenderer[this._depthRendererId]=e),super.setSourceTexture(e.getDepthMap(),!0,t,i)}setSourceTexture(e,t,i=2,n=!0){super.setSourceTexture(e,t,i,n)}get depthRenderer(){return this._depthRenderer}dispose(e=!0){if(super.dispose(e),this._depthRenderer&&e){const e=this._depthRenderer.getDepthMap().getScene();e&&delete e._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null}}constructor(e){super(e)}deactivate(){super.deactivate(),this._depthRenderer&&(this._depthRenderer.enabled=!1)}activate(){this._depthRenderer&&(this._depthRenderer.enabled=!0),super.activate()}},gy=wh.Up(),Sy=wh.Zero(),yy=new wh,Ey=new wh,Ay=new Lh,Cy=class e extends Sv{_initializeShadowMap(){if(super._initializeShadowMap(),null===this._shadowMap)return;this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(let t=0;t<this._numCascades;++t){this._cascades[t]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[t]=Lh.Zero(),this._projectionMatrices[t]=Lh.Zero(),this._transformMatrices[t]=Lh.Zero(),this._cascadeMinExtents[t]=new wh,this._cascadeMaxExtents[t]=new wh,this._frustumCenter[t]=new wh,this._shadowCameraPos[t]=new wh,this._frustumCornersWorldSpace[t]=new Array(e._FrustumCornersNDCSpace.length);for(let i=0;i<e._FrustumCornersNDCSpace.length;++i)this._frustumCornersWorldSpace[t][i]=new wh}const t=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.clear(),this._shadowMap.onBeforeRenderObservable.clear(),this._shadowMap.onBeforeRenderObservable.add((e=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[e]),this._currentLayer=e,this._filter===Sv.FILTER_PCF&&t.setColorWrite(!1),this._scene.setTransformMatrix(this.getCascadeViewMatrix(e),this.getCascadeProjectionMatrix(e)),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onBeforeBindObservable.add((()=>{this._currentSceneUBO=this._scene.getSceneUniformBuffer(),t._debugPushGroup?.(`cascaded shadow map generation for pass id ${t.currentRenderPassId}`,1),this._breaksAreDirty&&this._splitFrustum(),this._computeMatrices()})),this._splitFrustum()}_computeFrustumInWorldSpace(t){const i=this._getCamera();if(!i)return;const n=this._cascades[t].prevBreakDistance,a=this._cascades[t].breakDistance,s=this._scene.getEngine().isNDCHalfZRange;i.getViewMatrix();const r=0===i.maxZ,o=i.maxZ;r&&(i.maxZ=this._shadowMaxZ,i.getProjectionMatrix(!0));const l=Lh.Invert(i.getTransformationMatrix());r&&(i.maxZ=o,i.getProjectionMatrix(!0));const c=this._scene.getEngine().useReverseDepthBuffer?4:0;for(let i=0;i<e._FrustumCornersNDCSpace.length;++i)yy.copyFrom(e._FrustumCornersNDCSpace[(i+c)%e._FrustumCornersNDCSpace.length]),s&&-1===yy.z&&(yy.z=0),wh.TransformCoordinatesToRef(yy,l,this._frustumCornersWorldSpace[t][i]);for(let i=0;i<e._FrustumCornersNDCSpace.length/2;++i)yy.copyFrom(this._frustumCornersWorldSpace[t][i+4]).subtractInPlace(this._frustumCornersWorldSpace[t][i]),Ey.copyFrom(yy).scaleInPlace(n),yy.scaleInPlace(a),yy.addInPlace(this._frustumCornersWorldSpace[t][i]),this._frustumCornersWorldSpace[t][i+4].copyFrom(yy),this._frustumCornersWorldSpace[t][i].addInPlace(Ey)}set depthClamp(e){this._depthClamp=e}get cascadeBlendPercentage(){return this._cascadeBlendPercentage}_recreateSceneUBOs(){if(this._disposeSceneUBOs(),this._sceneUBOs)for(let e=0;e<this._numCascades;++e)this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for CSM Shadow Generator (light "${this._light.name}" cascade #${e})`))}getClassName(){return e.CLASSNAME}_initializeGenerator(){this.penumbraDarkness=this.penumbraDarkness??1,this._numCascades=this._numCascades??e.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=this.stabilizeCascades??!1,this._freezeShadowCastersBoundingInfoObservable=this._freezeShadowCastersBoundingInfoObservable??null,this.freezeShadowCastersBoundingInfo=this.freezeShadowCastersBoundingInfo??!1,this._scbiMin=this._scbiMin??new wh(0,0,0),this._scbiMax=this._scbiMax??new wh(0,0,0),this._shadowCastersBoundingInfo=this._shadowCastersBoundingInfo??new hf(new wh(0,0,0),new wh(0,0,0)),this._breaksAreDirty=this._breaksAreDirty??!0,this._minDistance=this._minDistance??0,this._maxDistance=this._maxDistance??1,this._currentLayer=this._currentLayer??0,this._shadowMaxZ=this._shadowMaxZ??this._getCamera()?.maxZ??1e4,this._debug=this._debug??!1,this._depthClamp=this._depthClamp??!0,this._cascadeBlendPercentage=this._cascadeBlendPercentage??.1,this._lambda=this._lambda??.5,this._autoCalcDepthBounds=this._autoCalcDepthBounds??!1,this._recreateSceneUBOs(),super._initializeGenerator()}get numCascades(){return this._numCascades}set autoCalcDepthBoundsRefreshRate(e){this._depthReducer?.depthRenderer&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)}setDepthRenderer(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)}getCascadeTransformMatrix(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null}getCascadeProjectionMatrix(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null}_computeMatrices(){const e=this._scene;if(!this._getCamera())return;wh.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(wh.Dot(this._lightDirection,wh.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);const t=e.getEngine().useReverseDepthBuffer;for(let i=0;i<this._numCascades;++i){this._computeFrustumInWorldSpace(i),this._computeCascadeFrustum(i),this._cascadeMaxExtents[i].subtractToRef(this._cascadeMinExtents[i],yy),this._frustumCenter[i].addToRef(this._lightDirection.scale(this._cascadeMinExtents[i].z),this._shadowCameraPos[i]),Lh.LookAtLHToRef(this._shadowCameraPos[i],this._frustumCenter[i],gy,this._viewMatrices[i]);let n=0,a=yy.z;const s=this._shadowCastersBoundingInfo;s.update(this._viewMatrices[i]),a=Math.min(a,s.boundingBox.maximumWorld.z),n=this._depthClamp&&this.filter!==Sv.FILTER_PCSS?Math.max(n,s.boundingBox.minimumWorld.z):Math.min(n,s.boundingBox.minimumWorld.z),Lh.OrthoOffCenterLHToRef(this._cascadeMinExtents[i].x,this._cascadeMaxExtents[i].x,this._cascadeMinExtents[i].y,this._cascadeMaxExtents[i].y,t?a:n,t?n:a,this._projectionMatrices[i],e.getEngine().isNDCHalfZRange),this._cascadeMinExtents[i].z=n,this._cascadeMaxExtents[i].z=a,this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),wh.TransformCoordinatesToRef(Sy,this._transformMatrices[i],yy),yy.scaleInPlace(this._mapSize/2),Ey.copyFromFloats(Math.round(yy.x),Math.round(yy.y),Math.round(yy.z)),Ey.subtractInPlace(yy).scaleInPlace(2/this._mapSize),Lh.TranslationToRef(Ey.x,Ey.y,0,Ay),this._projectionMatrices[i].multiplyToRef(Ay,this._projectionMatrices[i]),this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),this._transformMatrices[i].copyToArray(this._transformMatricesAsArray,16*i)}}static get IsSupported(){const e=xh.LastCreatedEngine;return!!e&&e._features.supportCSM}static Parse(t,i){const n=Sv.Parse(t,i,((t,i,n)=>new e(t,i,void 0,n)));return void 0!==t.numCascades&&(n.numCascades=t.numCascades),void 0!==t.debug&&(n.debug=t.debug),void 0!==t.stabilizeCascades&&(n.stabilizeCascades=t.stabilizeCascades),void 0!==t.lambda&&(n.lambda=t.lambda),void 0!==t.cascadeBlendPercentage&&(n.cascadeBlendPercentage=t.cascadeBlendPercentage),void 0!==t.depthClamp&&(n.depthClamp=t.depthClamp),void 0!==t.autoCalcDepthBounds&&(n.autoCalcDepthBounds=t.autoCalcDepthBounds),void 0!==t.shadowMaxZ&&(n.shadowMaxZ=t.shadowMaxZ),void 0!==t.penumbraDarkness&&(n.penumbraDarkness=t.penumbraDarkness),void 0!==t.freezeShadowCastersBoundingInfo&&(n.freezeShadowCastersBoundingInfo=t.freezeShadowCastersBoundingInfo),void 0!==t.minDistance&&void 0!==t.maxDistance&&n.setMinMaxDistance(t.minDistance,t.maxDistance),n}_computeShadowCastersBoundingInfo(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._shadowMap&&this._shadowMap.Pt){const e=this._shadowMap.Pt;for(let t=0;t<e.length;t++){const i=e[t];if(!i)continue;const n=i.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(n.minimumWorld),this._scbiMax.maximizeInPlace(n.maximumWorld)}const t=this._scene.meshes;for(let e=0;e<t.length;e++){const i=t[e];if(!(i&&i.isVisible&&i.isEnabled&&i.receiveShadows))continue;const n=i.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(n.minimumWorld),this._scbiMax.maximizeInPlace(n.maximumWorld)}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)}dispose(){super.dispose(),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)}set autoCalcDepthBounds(e){const t=this._getCamera();if(t){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new vy(t),this._depthReducer.onAfterReductionPerformed.add((e=>{let t=e.min,i=e.max;t>=i&&(t=0,i=1),t==this._minDistance&&i==this._maxDistance||this.setMinMaxDistance(t,i)})),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}}_bindCustomEffectForRenderSubMeshForShadowMap(e,t){t.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))}_validateFilter(e){return e===Sv.FILTER_NONE||e===Sv.FILTER_PCF||e===Sv.FILTER_PCSS?e:(jh.Error('Unsupported filter "'+e+'"!'),Sv.FILTER_NONE)}get shadowCastersBoundingInfo(){return this._shadowCastersBoundingInfo}bindShadowLight(e,t){const i=this._light;if(!this._scene.shadowsEnabled||!i.shadowEnabled)return;const n=this._getCamera();if(!n)return;const a=this.getShadowMap();if(!a)return;const s=a.getSize().width;if(t.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),t.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),t.setFloat("cascadeBlendFactor"+e,0===this.cascadeBlendPercentage?1e4:1/this.cascadeBlendPercentage),t.setArray("frustumLengths"+e,this._frustumLengths),this._filter===Sv.FILTER_PCF)t.setDepthStencilTexture("shadowTexture"+e,a),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s,1/s,this.frustumEdgeFalloff,e);else if(this._filter===Sv.FILTER_PCSS){for(let e=0;e<this._numCascades;++e)this._lightSizeUVCorrection[2*e+0]=0===e?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[e].x-this._cascadeMinExtents[e].x),this._lightSizeUVCorrection[2*e+1]=0===e?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[e].y-this._cascadeMinExtents[e].y),this._depthCorrection[e]=0===e?1:(this._cascadeMaxExtents[e].z-this._cascadeMinExtents[e].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);t.setDepthStencilTexture("shadowTexture"+e,a),t.setTexture("depthTexture"+e,a),t.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),t.setArray("depthCorrection"+e,this._depthCorrection),t.setFloat("penumbraDarkness"+e,this.penumbraDarkness),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/s,this._contactHardeningLightSizeUVRatio*s,this.frustumEdgeFalloff,e)}else t.setTexture("shadowTexture"+e,a),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s,1/s,this.frustumEdgeFalloff,e);i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(n),this.getLight().getDepthMinZ(n)+this.getLight().getDepthMaxZ(n),e)}get lambda(){return this._lambda}getTransformMatrix(){return this.getCascadeTransformMatrix(0)}_createTargetRenderTexture(){const e=this._scene.getEngine(),t={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new qp(this._light.name+"_CSMShadowMap",t,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0,this._useRedTextureType?6:5),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0,void 0,void 0,void 0,`DepthStencilForCSMShadowGenerator-${this._light.name}`),this._shadowMap.noPrePassRenderer=!0}get maxDistance(){return this._maxDistance}set freezeShadowCastersBoundingInfo(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add((()=>this._computeShadowCastersBoundingInfo()))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()}_computeCascadeFrustum(e){this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0);if(this._getCamera()){for(let t=0;t<this._frustumCornersWorldSpace[e].length;++t)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][t]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){let t=0;for(let i=0;i<this._frustumCornersWorldSpace[e].length;++i){const n=this._frustumCornersWorldSpace[e][i].subtractToRef(this._frustumCenter[e],yy).length();t=Math.max(t,n)}t=Math.ceil(16*t)/16,this._cascadeMaxExtents[e].copyFromFloats(t,t,t),this._cascadeMinExtents[e].copyFromFloats(-t,-t,-t)}else{const t=this._frustumCenter[e];this._frustumCenter[e].addToRef(this._lightDirection,yy),Lh.LookAtLHToRef(t,yy,gy,Ay);for(let t=0;t<this._frustumCornersWorldSpace[e].length;++t)wh.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][t],Ay,yy),this._cascadeMinExtents[e].minimizeInPlace(yy),this._cascadeMaxExtents[e].maximizeInPlace(yy)}}}setMinMaxDistance(e,t){this._minDistance===e&&this._maxDistance===t||(e>t&&(e=0,t=1),e<0&&(e=0),t>1&&(t=1),this._minDistance=e,this._maxDistance=t,this._breaksAreDirty=!0)}get minDistance(){return this._minDistance}get autoCalcDepthBounds(){return this._autoCalcDepthBounds}getCascadeViewMatrix(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null}prepareDefines(e,t){super.prepareDefines(e,t);const i=this._scene,n=this._light;if(!i.shadowsEnabled||!n.shadowEnabled)return;e["SHADOWCSM"+t]=!0,e["SHADOWCSMDEBUG"+t]=this.debug,e["SHADOWCSMNUM_CASCADES"+t]=this.numCascades,e["SHADOWCSM_RIGHTHANDED"+t]=i.useRightHandedSystem;const a=this._getCamera();a&&this._shadowMaxZ<=(a.maxZ||this._shadowMaxZ)&&(e["SHADOWCSMUSESHADOWMAXZ"+t]=!0),0===this.cascadeBlendPercentage&&(e["SHADOWCSMNOBLEND"+t]=!0)}set debug(e){this._debug=e,this._light._markMeshesAsLightDirty()}_splitFrustum(){const e=this._getCamera();if(!e)return;const t=e.minZ,i=e.maxZ||this._shadowMaxZ,n=i-t,a=this._minDistance,s=t+a*n,r=t+(this._shadowMaxZ<i&&this._shadowMaxZ>=t?Math.min((this._shadowMaxZ-t)/(i-t),this._maxDistance):this._maxDistance)*n,o=r-s,l=r/s;for(let e=0;e<this._cascades.length;++e){const i=(e+1)/this._numCascades,r=s*l**i,c=s+o*i,h=this._lambda*(r-c)+c;this._cascades[e].prevBreakDistance=0===e?a:this._cascades[e-1].breakDistance,this._cascades[e].breakDistance=(h-t)/n,this._viewSpaceFrustumsZ[e]=h,this._frustumLengths[e]=(this._cascades[e].breakDistance-this._cascades[e].prevBreakDistance)*n}this._breaksAreDirty=!1}getCascadeMinExtents(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null}set shadowMaxZ(e){const t=this._getCamera();t?this._shadowMaxZ===e||e<t.minZ||e>t.maxZ&&0!==t.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e}serialize(){const e=super.serialize(),t=this.getShadowMap();if(!t)return e;if(e.numCascades=this._numCascades,e.debug=this._debug,e.stabilizeCascades=this.stabilizeCascades,e.lambda=this._lambda,e.cascadeBlendPercentage=this.cascadeBlendPercentage,e.depthClamp=this._depthClamp,e.autoCalcDepthBounds=this.autoCalcDepthBounds,e.shadowMaxZ=this._shadowMaxZ,e.penumbraDarkness=this.penumbraDarkness,e.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.Pt=[],t.Pt)for(let i=0;i<t.Pt.length;i++){const n=t.Pt[i];e.Pt.push(n.id)}return e}set lambda(e){const t=Math.min(Math.max(e,0),1);this._lambda!=t&&(this._lambda=t,this._breaksAreDirty=!0)}set cascadeBlendPercentage(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()}set numCascades(t){(t=Math.min(Math.max(t,e.MIN_CASCADES_COUNT),e.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=t,this.recreateShadowMap(),this._recreateSceneUBOs())}get debug(){return this._debug}constructor(t,i,n,a,s=!0){e.IsSupported?(super(t,i,n,a,s),this.usePercentageCloserFiltering=!0):jh.Error("CascadedShadowMap is not supported by the current engine.")}set shadowCastersBoundingInfo(e){this._shadowCastersBoundingInfo=e}get autoCalcDepthBoundsRefreshRate(){return this._depthReducer?.depthRenderer?.getDepthMap().refreshRate??-1}get depthClamp(){return this._depthClamp}get freezeShadowCastersBoundingInfo(){return this._freezeShadowCastersBoundingInfo}getCascadeMaxExtents(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null}get shadowMaxZ(){return this._getCamera()?this._shadowMaxZ:0}_isReadyCustomDefines(e){e.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==Sv.FILTER_PCSS?"1":"0"))}splitFrustum(){this._breaksAreDirty=!0}};Cy._FrustumCornersNDCSpace=[new wh(-1,1,-1),new wh(1,1,-1),new wh(1,-1,-1),new wh(-1,-1,-1),new wh(-1,1,1),new wh(1,1,1),new wh(1,-1,1),new wh(-1,-1,1)],Cy.CLASSNAME="CascadedShadowGenerator",Cy.DEFAULT_CASCADES_COUNT=4,Cy.MIN_CASCADES_COUNT=2,Cy.MAX_CASCADES_COUNT=4,Cy._SceneComponentInitialization=e=>{throw Qc("ShadowGeneratorSceneComponent")},T_.AddParser(Rm.NAME_SHADOWGENERATOR,((e,t)=>{if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(let i=0,n=e.shadowGenerators.length;i<n;i++){const n=e.shadowGenerators[i];n.className===Cy.CLASSNAME?Cy.Parse(n,t):Sv.Parse(n,t)}}));var Ry,Ty,Ny=class{register(){this.scene._gatherRenderTargetsStage.registerStep(Rm.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)}dispose(){}serialize(e){e.shadowGenerators=[];const t=this.scene.lights;for(const i of t){const t=i.getShadowGenerators();if(t){const i=t.values();for(let t=i.next();!0!==t.done;t=i.next()){const i=t.value;e.shadowGenerators.push(i.serialize())}}}}addFromContainer(e){}rebuild(){}removeFromContainer(e,t){}constructor(e){this.name=Rm.NAME_SHADOWGENERATOR,this.scene=e}_gatherRenderTargets(e){const t=this.scene;if(this.scene.shadowsEnabled)for(let i=0;i<t.lights.length;i++){const n=t.lights[i],a=n.getShadowGenerators();if(n.isEnabled()&&n.shadowEnabled&&a){const i=a.values();for(let n=i.next();!0!==n.done;n=i.next()){const i=n.value.getShadowMap();-1!==t.textures.indexOf(i)&&e.push(i)}}}}};Sv._SceneComponentInitialization=e=>{let t=e._getComponent(Rm.NAME_SHADOWGENERATOR);t||(t=new Ny(e),e._addComponent(t))},(Ty=Ry||(Ry={}))[Ty.Clean=0]="Clean",Ty[Ty.Stop=1]="Stop",Ty[Ty.Sync=2]="Sync",Ty[Ty.NoSync=3]="NoSync";var My=new Ih,Iy={},xy=!1;function by(){return Iy[".babylon"]}function Py(e){const t=Iy[e];return t||(jh.Warn("Unable to find a plugin to load "+e+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),by())}function wy(e,t,i){let n="Unable to load from "+(e.rawData?"binary data":e.url);return t?n+=`: ${t}`:i&&(n+=`: ${i}`),n}function Oy(e,t,i,n,a,s,r,o,l){const c="data:"===(h=e.url).substr(0,5)?h.substr(5):null;var h;if(e.rawData&&!r)throw"When using ArrayBufferView to load data the file extension must be provided.";const f=r?Py(r):c?function(e){for(const t in Iy){const i=Iy[t].plugin;if(i.canDirectLoad&&i.canDirectLoad(e))return Iy[t]}return by()}(e.url):function(e){const t=e.indexOf("?");-1!==t&&(e=e.substring(0,t));const i=e.lastIndexOf(".");return Py(e.substring(i,e.length).toLowerCase())}(e.url);if(!1===l?.[f.plugin.name]?.enabled)throw new Error(`The '${f.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(e.rawData&&!f.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";const u=f.plugin.createPlugin?.(l??{})??f.plugin;if(!u)throw`The loader plugin corresponding to the '${r}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(My.notifyObservers(u),c&&(u.canDirectLoad&&u.canDirectLoad(e.url)||!ku(e.url))){if(u.directLoad){const e=u.directLoad(t,c);e instanceof Promise?e.then((e=>{i(u,e)})).catch((e=>{a("Error in directLoad of _loadData: "+e,e)})):i(u,e)}else i(u,c);return u}const d=f.isBinary,m=(e,n)=>{t.isDisposed?a("Scene has been disposed"):i(u,e,n)};let p=null,_=!1;u.onDisposeObservable?.add((()=>{_=!0,p&&(p.abort(),p=null),s()}));const v=()=>{if(_)return;const i=(e,t)=>{a(e?.statusText,t)};if(!u.loadFile&&e.rawData)throw"Plugin does not support loading ArrayBufferView.";p=u.loadFile?u.loadFile(t,e.rawData||e.file||e.url,e.rootUrl,m,n,d,i,o):t._loadFile(e.file||e.url,m,n,!0,d,i)},g=t.getEngine();let S=g.enableOfflineSupport;if(S){let i=!1;for(const n of t.disableOfflineSupportExceptionRules)if(n.test(e.url)){i=!0;break}S=!i}return S&&Md.OfflineProviderFactory?t.offlineProvider=Md.OfflineProviderFactory(e.url,v,g.disableManifestCheck):v(),u}function Dy(e,t){let i,n,a=null,s=null;if(t)if(t.name)i=`file:${t.name}`,n=t.name,a=t;else if(ArrayBuffer.isView(t))i="",n=Ju(),s=t;else if(t.startsWith("data:"))i=t,n="";else if(e){const a=t;if("/"===a.substr(0,1))return ad.Error("Wrong sceneFilename parameter"),null;i=e+a,n=a}else i=t,n=ad.GetFilename(t),e=ad.GetFolderPath(t);else i=e,n=ad.GetFilename(e),e=ad.GetFolderPath(e);return{url:i,rootUrl:e,name:n,file:a,rawData:s}}function Ly(e){if("string"==typeof e.extensions){const t=e.extensions;Iy[t.toLowerCase()]={plugin:e,isBinary:!1}}else{const t=e.extensions;Object.keys(t).forEach((i=>{Iy[i.toLowerCase()]={plugin:e,isBinary:t[i].isBinary}}))}}function Fy(e,t,i="",n=xh.LastCreatedScene,a=null,s=null,r=null,o=null,l="",c={}){if(!n)return jh.Error("No scene available to import mesh to"),null;const h=Dy(t,i);if(!h)return null;const f={};n.addPendingData(f);const u=()=>{n.removePendingData(f)},d=(e,t)=>{const i=wy(h,e,t);r?r(n,i,new tf(i,ef.SceneLoaderError,t)):jh.Error(i),u()},m=s?e=>{try{s(e)}catch(e){d("Error in onProgress callback: "+e,e)}}:void 0,p=(e,t,i,s,r,o,l,c)=>{if(n.importedMeshesFiles.push(h.url),a)try{a(e,t,i,s,r,o,l,c)}catch(e){d("Error in onSuccess callback: "+e,e)}n.removePendingData(f)};return Oy(h,n,((t,i,a)=>{if(t.rewriteRootURL&&(h.rootUrl=t.rewriteRootURL(h.rootUrl,a)),t.importMesh){const a=[],s=[],r=[];if(!t.importMesh(e,n,i,h.rootUrl,a,s,r,d))return;n.loadingPluginName=t.name,p(a,s,r,[],[],[],[],[])}else{t.importMeshAsync(e,n,i,h.rootUrl,m,h.name).then((e=>{n.loadingPluginName=t.name,p(e.meshes,e.particleSystems,e.skeletons,e.animationGroups,e.transformNodes,e.geometries,e.lights,e.spriteManagers)})).catch((e=>{d(e.message,e)}))}}),m,d,u,o,l,c)}function ky(e,t="",i=xh.LastCreatedEngine,n=null,a=null,s=null,r=null,o="",l={}){return i?By(e,t,new dv(i),n,a,s,r,o,l):(ad.Error("No engine available"),null)}function By(e,t="",i=xh.LastCreatedScene,n=null,a=null,s=null,r=null,o="",l={}){if(!i)return jh.Error("No scene available to append to"),null;const c=Dy(e,t);if(!c)return null;const h={};i.addPendingData(h);const f=()=>{i.removePendingData(h)};ud.ShowLoadingScreen&&!xy&&(xy=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),xy=!1})));const u=(e,t)=>{const n=wy(c,e,t);s?s(i,n,new tf(n,ef.SceneLoaderError,t)):jh.Error(n),f()},d=a?e=>{try{a(e)}catch(e){u("Error in onProgress callback",e)}}:void 0,m=()=>{if(n)try{n(i)}catch(e){u("Error in onSuccess callback",e)}i.removePendingData(h)};return Oy(c,i,((e,t)=>{if(e.load){if(!e.load(i,t,c.rootUrl,u))return;i.loadingPluginName=e.name,m()}else{e.loadAsync(i,t,c.rootUrl,d,c.name).then((()=>{i.loadingPluginName=e.name,m()})).catch((e=>{u(e.message,e)}))}}),d,u,f,r,o,l)}function Gy(e,t="",i=xh.LastCreatedScene,n=null,a=null,s=null,r=null,o="",l={}){if(!i)return jh.Error("No scene available to load asset container to"),null;const c=Dy(e,t);if(!c)return null;const h={};i.addPendingData(h);const f=()=>{i.removePendingData(h)},u=(e,t)=>{const n=wy(c,e,t);s?s(i,n,new tf(n,ef.SceneLoaderError,t)):jh.Error(n),f()},d=a?e=>{try{a(e)}catch(e){u("Error in onProgress callback",e)}}:void 0,m=e=>{if(n)try{n(e)}catch(e){u("Error in onSuccess callback",e)}i.removePendingData(h)};return Oy(c,i,((e,t)=>{if(e.loadAssetContainer){const n=e.loadAssetContainer(i,t,c.rootUrl,u);if(!n)return;n.populateRootNodes(),i.loadingPluginName=e.name,m(n)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(i,t,c.rootUrl,d,c.name).then((t=>{t.populateRootNodes(),i.loadingPluginName=e.name,m(t)})).catch((e=>{u(e.message,e)}))}else u("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),d,u,f,r,o,l)}function Uy(e,t="",i=xh.LastCreatedScene,n=!0,a=0,s=null,r=null,o=null,l=null,c=null,h="",f={}){if(!i)return void jh.Error("No scene available to load animations to");if(n){for(const e of i.animatables)e.reset();i.stopAllAnimations(),i.animationGroups.slice().forEach((e=>{e.dispose()}));i.getNodes().forEach((e=>{e.animations&&(e.animations=[])}))}else switch(a){case 0:i.animationGroups.slice().forEach((e=>{e.dispose()}));break;case 1:i.animationGroups.forEach((e=>{e.stop()}));break;case 2:i.animationGroups.forEach((e=>{e.reset(),e.restart()}));break;case 3:break;default:return void jh.Error("Unknown animation group loading mode value '"+a+"'")}const u=i.animatables.length;Gy(e,t,i,(e=>{e.mergeAnimationsTo(i,i.animatables.slice(u),s),e.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),r&&r(i)}),o,l,c,h,f)}var Hy=class{static ImportMeshAsync(e,t,i,n,a,s,r){return function(e,t,i,n,a,s,r,o){return new Promise(((l,c)=>{Fy(e,t,i,n,((e,t,i,n,a,s,r,o)=>{l({meshes:e,particleSystems:t,skeletons:i,animationGroups:n,transformNodes:a,geometries:s,lights:r,spriteManagers:o})}),a,((e,t,i)=>{c(i||new Error(t))}),s,r,o)}))}(e,t,i,n,a,s,r)}static LoadAssetContainerAsync(e,t,i,n,a,s){return function(e,t,i,n,a,s,r){return new Promise(((o,l)=>{Gy(e,t,i,(e=>{o(e)}),n,((e,t,i)=>{l(i||new Error(t))}),a,s,r)}))}(e,t,i,n,a,s)}static get ShowLoadingScreen(){return ud.ShowLoadingScreen}static IsPluginForExtensionAvailable(e){return function(e){return!!Iy[e]}(e)}static Load(e,t,i,n,a,s,r,o){return ky(e,t,i,n,a,s,r,o)}static LoadAssetContainer(e,t,i,n,a,s,r,o){return Gy(e,t,i,n,a,s,r,o)}static get CleanBoneMatrixWeights(){return ud.CleanBoneMatrixWeights}static set ShowLoadingScreen(e){ud.ShowLoadingScreen=e}static ImportAnimationsAsync(e,t,i,n,a,s,r,o,l,c,h){return function(e,t,i,n,a,s,r,o,l,c){return new Promise(((h,f)=>{Uy(e,t,i,n,a,s,(e=>{h(e)}),r,((e,t,i)=>{f(i||new Error(t))}),o,l,c)}))}(e,t,i,n,a,s,o,c,h)}static LoadAsync(e,t,i,n,a,s){return function(e,t,i,n,a,s,r){return new Promise(((o,l)=>{ky(e,t,i,(e=>{o(e)}),n,((e,t,i)=>{l(i||new Error(t))}),a,s,r)}))}(e,t,i,n,a,s)}static set ForceFullSceneLoadingForIncremental(e){ud.ForceFullSceneLoadingForIncremental=e}static Append(e,t,i,n,a,s,r,o){return By(e,t,i,n,a,s,r,o)}static RegisterPlugin(e){Ly(e)}static ImportMesh(e,t,i,n,a,s,r,o,l){return Fy(e,t,i,n,a,s,r,o,l)}static ImportAnimations(e,t,i,n,a,s,r,o,l,c,h){Uy(e,t,i,n,a,s,r,o,l,c,h)}static GetDefaultPlugin(){return by()}static set CleanBoneMatrixWeights(e){ud.CleanBoneMatrixWeights=e}static GetPluginForExtension(e){return Py(e).plugin}static AppendAsync(e,t,i,n,a,s){return function(e,t,i,n,a,s,r){return new Promise(((o,l)=>{By(e,t,i,(e=>{o(e)}),n,((e,t,i)=>{l(i||new Error(t))}),a,s,r)}))}(e,t,i,n,a,s)}static get ForceFullSceneLoadingForIncremental(){return ud.ForceFullSceneLoadingForIncremental}static get loggingLevel(){return ud.loggingLevel}static set loggingLevel(e){ud.loggingLevel=e}};Hy.NO_LOGGING=0,Hy.MINIMAL_LOGGING=1,Hy.SUMMARY_LOGGING=2,Hy.DETAILED_LOGGING=3,Hy.OnPluginActivatedObservable=My;var Vy=class extends T_{},Wy=class{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((e=>{e.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((e=>{e.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((e=>{e.dispose()})),this.animationGroups.length=0}},zy=class extends T_{_addNodeAndDescendantsToList(e,t,i,n){if(i&&(!n||n(i))&&!t.has(i.xt)){e.push(i),t.add(i.xt);for(const a of i.getDescendants(!0))this._addNodeAndDescendantsToList(e,t,a,n)}}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||ad.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(const e of this.scene._serializableComponents)e.addFromContainer(this);this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}_isNodeInContainer(e){return e instanceof Bd&&-1!==this.meshes.indexOf(e)||(e instanceof Xh&&-1!==this.transformNodes.indexOf(e)||(e instanceof mv&&-1!==this.lights.indexOf(e)||e instanceof fd&&-1!==this.cameras.indexOf(e)))}dispose(){this.cameras.slice(0).forEach((e=>{e.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((e=>{e.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((e=>{e.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((e=>{e.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((e=>{e.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((e=>{e.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((e=>{e.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((e=>{e.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((e=>{e.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((e=>{e.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((e=>{e.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((e=>{e.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((e=>{e.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}instantiateModelsToScene(e,t=!1,i){this._isValidHierarchy()||ad.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const n={},a={},s=new Wy,r=[],o=[],l={doNotInstantiate:!0,...i},c=[],h=new Set;for(const e of this.transformNodes)null===e.parent&&this._addNodeAndDescendantsToList(c,h,e,l.predicate);for(const e of this.meshes)null===e.parent&&this._addNodeAndDescendantsToList(c,h,e,l.predicate);const f=this._topologicalSort(c),u=(i,r)=>{if(((t,i)=>{if(n[t.xt]=i.xt,a[i.xt]=i,e&&(i.name=e(t.name)),i instanceof wm){const e=i;if(e.morphTargetManager){const i=t.morphTargetManager;e.morphTargetManager=i.clone();for(let t=0;t<i.numTargets;t++){const s=i.getTarget(t),r=e.morphTargetManager.getTarget(t);n[s.xt]=r.xt,a[r.xt]=r}}}})(i,r),i.parent){const e=n[i.parent.xt],t=a[e];r.parent=t||i.parent}if(r.position&&i.position&&r.position.copyFrom(i.position),r.rotationQuaternion&&i.rotationQuaternion&&r.rotationQuaternion.copyFrom(i.rotationQuaternion),r.rotation&&i.rotation&&r.rotation.copyFrom(i.rotation),r.scaling&&i.scaling&&r.scaling.copyFrom(i.scaling),r.material){const s=r;if(s.material)if(t){const t=i.material;if(-1===o.indexOf(t)){let i=t.clone(e?e(t.name):"Clone of "+t.name);if(o.push(t),n[t.xt]=i.xt,a[i.xt]=i,"MultiMaterial"===t.getClassName()){const s=t;for(const t of s.subMaterials)t&&(i=t.clone(e?e(t.name):"Clone of "+t.name),o.push(t),n[t.xt]=i.xt,a[i.xt]=i);s.subMaterials=s.subMaterials.map((e=>e&&a[n[e.xt]]))}}"InstancedMesh"!==s.getClassName()&&(s.material=a[n[t.xt]])}else"MultiMaterial"===s.material.getClassName()?-1===this.scene.multiMaterials.indexOf(s.material)&&this.scene.addMultiMaterial(s.material):-1===this.scene.materials.indexOf(s.material)&&this.scene.addMaterial(s.material)}null===r.parent&&s.rootNodes.push(r)};return f.forEach((e=>{if("InstancedMesh"===e.getClassName()){const t=e,i=t.tk,s=n[i.xt],r=("number"==typeof s?a[s]:i).createInstance(t.name);u(t,r)}else{let t=!0;"TransformNode"===e.getClassName()||"Node"===e.getClassName()||e.skeleton||!e.getTotalVertices||0===e.getTotalVertices()?t=!1:l.doNotInstantiate&&(t="function"==typeof l.doNotInstantiate?!l.doNotInstantiate(e):!l.doNotInstantiate);const i=t?e.createInstance(`instance of ${e.name}`):e.clone(`Clone of ${e.name}`,null,!0);if(!i)throw new Error(`Could not clone or instantiate node on Asset Container ${e.name}`);u(e,i)}})),this.skeletons.forEach((t=>{if(l.predicate&&!l.predicate(t))return;const i=t.clone(e?e(t.name):"Clone of "+t.name);for(const e of this.meshes)if(e.skeleton===t&&!e.isAnInstance){const t=a[n[e.xt]];if(!t||t.isAnInstance)continue;if(t.skeleton=i,-1!==r.indexOf(i))continue;r.push(i);for(const e of i.bones)e._linkedTransformNode&&(e._linkedTransformNode=a[n[e._linkedTransformNode.xt]])}s.skeletons.push(i)})),this.animationGroups.forEach((t=>{if(l.predicate&&!l.predicate(t))return;const i=t.clone(e?e(t.name):"Clone of "+t.name,(e=>a[n[e.xt]]||e));s.animationGroups.push(i)})),s}addAllAssetsToContainer(e){if(!e)return;const t=[],i=new Set;for(t.push(e);t.length>0;){const e=t.pop();if(e instanceof wm?(e.geometry&&-1===this.geometries.indexOf(e.geometry)&&this.geometries.push(e.geometry),this.meshes.push(e)):e instanceof Xh?this.transformNodes.push(e):e instanceof mv?this.lights.push(e):e instanceof fd&&this.cameras.push(e),e instanceof Bd){if(e.material&&-1===this.materials.indexOf(e.material)){this.materials.push(e.material);for(const t of e.material.getActiveTextures())-1===this.textures.indexOf(t)&&this.textures.push(t)}e.skeleton&&-1===this.skeletons.indexOf(e.skeleton)&&this.skeletons.push(e.skeleton),e.morphTargetManager&&-1===this.morphTargetManagers.indexOf(e.morphTargetManager)&&this.morphTargetManagers.push(e.morphTargetManager)}for(const n of e.getChildren())i.has(n)||t.push(n);i.add(e)}this.populateRootNodes()}createRootMesh(){const e=new wm("assetContainerRootMesh",this.scene);return this.meshes.forEach((t=>{t.parent||e.addChild(t)})),this.meshes.unshift(e),e}removeAllFromScene(){this._isValidHierarchy()||ad.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this)}mergeAnimationsTo(e=xh.LastCreatedScene,t,i=null){if(!e)return jh.Error("No scene available to merge animations to"),[];const n=i||(t=>{let i=null;const n=t.animations.length?t.animations[0].targetProperty:"",a=t.name.split(".").join("").split("_primitive")[0];switch(n){case"position":case"rotationQuaternion":i=e.getTransformNodeByName(t.name)||e.getTransformNodeByName(a);break;case"influence":i=e.getMorphTargetByName(t.name)||e.getMorphTargetByName(a);break;default:i=e.getNodeByName(t.name)||e.getNodeByName(a)}return i});this.getNodes().forEach((e=>{const t=n(e);if(null!==t){for(const i of e.animations){const e=t.animations.filter((e=>e.targetProperty===i.targetProperty));for(const i of e){const e=t.animations.indexOf(i,0);e>-1&&t.animations.splice(e,1)}}t.animations=t.animations.concat(e.animations)}}));const a=[];return this.animationGroups.slice().forEach((e=>{a.push(e.clone(e.name,n)),e.animatables.forEach((e=>{e.stop()}))})),t.forEach((t=>{const i=n(t.target);i&&(e.beginAnimation(i,t.fromFrame,t.toFrame,t.loopAnimation,t.speedRatio,t.onAnimationEnd?t.onAnimationEnd:void 0,void 0,!0,void 0,t.onAnimationLoop?t.onAnimationLoop:void 0),e.stopAnimation(t.target))})),a}_moveAssets(e,t,i){if(e&&t)for(const n of e){let e=!0;if(i)for(const t of i)if(n===t){e=!1;break}e&&(t.push(n),n._parentContainer=this)}}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((e=>{e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)})),this.transformNodes.forEach((e=>{e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)})),this.lights.forEach((e=>{e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)})),this.cameras.forEach((e=>{e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)}))}constructor(e){super(),this._wasAddedToScene=!1,(e=e||xh.LastCreatedScene)&&(this.scene=e,this.sounds=[],this.effectLayers=[],this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.reflectionProbes=[],e.onDisposeObservable.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();for(const e of this.particleSystems)e.rebuild();for(const e of this.textures)e._rebuild()})))}_isValidHierarchy(){for(const e of this.meshes)if(e.parent&&!this._isNodeInContainer(e.parent))return jh.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.transformNodes)if(e.parent&&!this._isNodeInContainer(e.parent))return jh.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.lights)if(e.parent&&!this._isNodeInContainer(e.parent))return jh.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.cameras)if(e.parent&&!this._isNodeInContainer(e.parent))return jh.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;return!0}_topologicalSort(e){const t=new Map;for(const i of e)t.set(i.xt,i);const i={dependsOn:new Map,dependedBy:new Map};for(const t of e){const e=t.xt;i.dependsOn.set(e,new Set),i.dependedBy.set(e,new Set)}for(const n of e){const e=n.xt,a=i.dependsOn.get(e);if(n instanceof hS){const s=n.tk;t.has(s.xt)&&(a.add(s.xt),i.dependedBy.get(s.xt).add(e))}const s=i.dependedBy.get(e);for(const a of n.getDescendants()){const n=a.xt;if(t.has(n)){s.add(n);i.dependsOn.get(n).add(e)}}}const n=[],a=[];for(const n of e){const e=n.xt;0===i.dependsOn.get(e).size&&(a.push(n),t.delete(e))}const s=a;for(;s.length>0;){const e=s.shift();n.push(e);const a=i.dependedBy.get(e.xt);for(const n of Array.from(a.values())){const a=i.dependsOn.get(n);a.delete(e.xt),0===a.size&&t.get(n)&&(s.push(t.get(n)),t.delete(n))}}return t.size>0&&(jh.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),t.forEach((e=>jh.Error(e.name)))),n}addToScene(e=null){const t=[];this.cameras.forEach((i=>{e&&!e(i)||(this.scene.addCamera(i),t.push(i))})),this.lights.forEach((i=>{e&&!e(i)||(this.scene.addLight(i),t.push(i))})),this.meshes.forEach((i=>{e&&!e(i)||(this.scene.addMesh(i),t.push(i))})),this.skeletons.forEach((t=>{e&&!e(t)||this.scene.addSkeleton(t)})),this.animations.forEach((t=>{e&&!e(t)||this.scene.addAnimation(t)})),this.animationGroups.forEach((t=>{e&&!e(t)||this.scene.addAnimationGroup(t)})),this.multiMaterials.forEach((t=>{e&&!e(t)||this.scene.addMultiMaterial(t)})),this.materials.forEach((t=>{e&&!e(t)||this.scene.addMaterial(t)})),this.morphTargetManagers.forEach((t=>{e&&!e(t)||this.scene.addMorphTargetManager(t)})),this.geometries.forEach((t=>{e&&!e(t)||this.scene.addGeometry(t)})),this.transformNodes.forEach((i=>{e&&!e(i)||(this.scene.addTransformNode(i),t.push(i))})),this.actionManagers.forEach((t=>{e&&!e(t)||this.scene.addActionManager(t)})),this.textures.forEach((t=>{e&&!e(t)||this.scene.addTexture(t)})),this.reflectionProbes.forEach((t=>{e&&!e(t)||this.scene.addReflectionProbe(t)}));for(const e of t)e.parent&&-1===this.scene.getNodes().indexOf(e.parent)&&(e.setParent?e.setParent(null):e.parent=null)}moveAllFromScene(e){this._wasAddedToScene=!1,void 0===e&&(e=new Vy);for(const t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=this[t]||("_environmentTexture"===t?null:[]),this._moveAssets(this.scene[t],this[t],e[t]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()}removeFromScene(e=null){this.cameras.forEach((t=>{e&&!e(t)||this.scene.removeCamera(t)})),this.lights.forEach((t=>{e&&!e(t)||this.scene.removeLight(t)})),this.meshes.forEach((t=>{e&&!e(t)||this.scene.removeMesh(t,!0)})),this.skeletons.forEach((t=>{e&&!e(t)||this.scene.removeSkeleton(t)})),this.animations.forEach((t=>{e&&!e(t)||this.scene.removeAnimation(t)})),this.animationGroups.forEach((t=>{e&&!e(t)||this.scene.removeAnimationGroup(t)})),this.multiMaterials.forEach((t=>{e&&!e(t)||this.scene.removeMultiMaterial(t)})),this.materials.forEach((t=>{e&&!e(t)||this.scene.removeMaterial(t)})),this.morphTargetManagers.forEach((t=>{e&&!e(t)||this.scene.removeMorphTargetManager(t)})),this.geometries.forEach((t=>{e&&!e(t)||this.scene.removeGeometry(t)})),this.transformNodes.forEach((t=>{e&&!e(t)||this.scene.removeTransformNode(t)})),this.actionManagers.forEach((t=>{e&&!e(t)||this.scene.removeActionManager(t)})),this.textures.forEach((t=>{e&&!e(t)||this.scene.removeTexture(t)})),this.reflectionProbes.forEach((t=>{e&&!e(t)||this.scene.removeReflectionProbe(t)}))}},Xy=class{readString(e){return(e=>{if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t})(this.readUint8Array(e))}skipBytes(e){this._dataByteOffset+=e,this.byteOffset+=e}constructor(e){this.byteOffset=0,this.buffer=e}readUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,e);return this._dataByteOffset+=e,this.byteOffset+=e,t}readUint32(){const e=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,e}loadAsync(e){return this.buffer.readAsync(this.byteOffset,e).then((e=>{this._dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),this._dataByteOffset=0}))}};function Yy(e,t,i,n){const a={externalResourceFunction:n};return i&&(a.uri="file:"===t?i:t+i),ArrayBuffer.isView(e)?GLTFValidator.validateBytes(e,a):GLTFValidator.validateString(e,a)}function jy(){const e=[];onmessage=t=>{const i=t.data;switch(i.id){case"init":importScripts(i.url);break;case"validate":Yy(i.data,i.rootUrl,i.fileName,(t=>new Promise(((i,n)=>{const a=e.length;e.push({resolve:i,reject:n}),postMessage({id:"getExternalResource",index:a,uri:t})})))).then((e=>{postMessage({id:"validate.resolve",value:e})}),(e=>{postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[i.index].resolve(i.value);break;case"getExternalResource.reject":e[i.index].reject(i.reason)}}}var Ky=class{static ValidateAsync(e,t,i,n){return"function"==typeof Worker?new Promise(((a,s)=>{const r=`${Yy}(${jy})()`,o=URL.createObjectURL(new Blob([r],{type:"application/javascript"})),l=new Worker(o),c=e=>{l.removeEventListener("error",c),l.removeEventListener("message",h),s(e)},h=e=>{const t=e.data;switch(t.id){case"getExternalResource":n(t.uri).then((e=>{l.postMessage({id:"getExternalResource.resolve",index:t.index,value:e},[e.buffer])}),(e=>{l.postMessage({id:"getExternalResource.reject",index:t.index,reason:e})}));break;case"validate.resolve":l.removeEventListener("error",c),l.removeEventListener("message",h),a(t.value),l.terminate();break;case"validate.reject":l.removeEventListener("error",c),l.removeEventListener("message",h),s(t.reason),l.terminate()}};if(l.addEventListener("error",c),l.addEventListener("message",h),l.postMessage({id:"init",url:ad.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(e)){const n=e.slice();l.postMessage({id:"validate",data:n,rootUrl:t,fileName:i},[n.buffer])}else l.postMessage({id:"validate",data:e,rootUrl:t,fileName:i})})):(this._LoadScriptPromise||(this._LoadScriptPromise=ad.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>Yy(e,t,i,n))))}};Ky.Configuration={url:`${ad._DefaultCdnUrl}/gltf_validator.js`};var $y,qy,Jy,Qy,Zy,eE,tE="gltf";function iE(e,t,i){try{return Promise.resolve(new Uint8Array(e,t,i))}catch(e){return Promise.reject(e)}}(qy=$y||($y={}))[qy.AUTO=0]="AUTO",qy[qy.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED",(Qy=Jy||(Jy={}))[Qy.NONE=0]="NONE",Qy[Qy.FIRST=1]="FIRST",Qy[Qy.ALL=2]="ALL",(eE=Zy||(Zy={}))[eE.LOADING=0]="LOADING",eE[eE.READY=1]="READY",eE[eE.COMPLETE=2]="COMPLETE";var nE,aE,sE,rE,oE,lE,cE,hE,fE,uE,dE,mE,pE,_E,vE,gE,SE=class{constructor(){this.coordinateSystemMode=$y.AUTO,this.animationStartMode=Jy.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.preprocessUrlAsync=e=>Promise.resolve(e),this.extensionOptions={}}copyFrom(e){if(e){const t=t=>{const i=t;this[i]=e[i]??this[i]};for(const e in this)t(e);for(const e of["onParsed","onMeshLoaded","onSkinLoaded","onTextureLoaded","onMaterialLoaded","onCameraLoaded"])t(e)}}},yE=class e extends SE{importMeshAsync(e,t,i,n,a,s){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${s||""}`),this._loader=this._getLoader(i),this._loader.importMeshAsync(e,t,null,i,n,a,s))))}_getLoader(t){const i=t.json.asset||{};this._log(`Asset version: ${i.version}`),i.minVersion&&this._log(`Asset minimum version: ${i.minVersion}`),i.generator&&this._log(`Asset generator: ${i.generator}`);const n=e._parseVersion(i.version);if(!n)throw new Error("Invalid version: "+i.version);if(void 0!==i.minVersion){const t=e._parseVersion(i.minVersion);if(!t)throw new Error("Invalid minimum version: "+i.minVersion);if(e._compareVersion(t,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+i.minVersion)}const a={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[n.major];if(!a)throw new Error("Unsupported version: "+i.version);return a(this)}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}_unpackBinaryV1Async(e,t){const i=e.readUint32(),n=e.readUint32();if(0!==n)throw new Error(`Unexpected content format: ${n}`);const a=t-e.byteOffset,s={json:this._parseJson(e.readString(i)),bin:null};if(0!==a){const t=e.byteOffset;s.bin={readAsync:(i,n)=>e.buffer.readAsync(t+i,n),byteLength:a}}return Promise.resolve(s)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}_logClose(){--this._logIndentLevel}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}_logDisabled(e){}static _parseVersion(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};const t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}_startPerformanceCounterDisabled(e){}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);const t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((()=>{const t=e.readUint32();if(1179937895!==t)throw new tf("Unexpected magic: "+t,ef.GLTFLoaderUnexpectedMagicError);const i=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${i}`);const n=e.readUint32();let a;switch(this.useRangeRequests||n===e.buffer.byteLength||jh.Warn(`Length in header does not match actual data length: ${n} != ${e.buffer.byteLength}`),i){case 1:a=this._unpackBinaryV1Async(e,n);break;case 2:a=this._unpackBinaryV2Async(e,n);break;default:throw new Error("Unsupported version: "+i)}return this._endPerformanceCounter("Unpack Binary"),a}))}get loaderState(){return this._state}directLoad(t,i){if(i.startsWith("base64,"+e._MagicBase64Encoded)||i.startsWith(";base64,"+e._MagicBase64Encoded)||i.startsWith("application/octet-stream;base64,"+e._MagicBase64Encoded)||i.startsWith("model/gltf-binary;base64,"+e._MagicBase64Encoded)){const e=Gu(i);return this._validate(t,new Uint8Array(e,0,e.byteLength)),this._unpackBinaryAsync(new Xy({readAsync:(t,i)=>iE(e,t,i),byteLength:e.byteLength}))}return this._validate(t,i),Promise.resolve({json:this._parseJson(i)})}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}get loggingEnabled(){return this._loggingEnabled}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)}_startPerformanceCounterEnabled(e){ad.StartPerformanceCounter(e)}createPlugin(t){return new e(t[tE])}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}constructor(e){super(),this.onParsedObservable=new Ih,this.onMeshLoadedObservable=new Ih,this.onSkinLoadedObservable=new Ih,this.onTextureLoadedObservable=new Ih,this.onMaterialLoadedObservable=new Ih,this.onCameraLoadedObservable=new Ih,this.onCompleteObservable=new Ih,this.onErrorObservable=new Ih,this.onDisposeObservable=new Ih,this.onExtensionLoadedObservable=new Ih,this.validate=!1,this.onValidatedObservable=new Ih,this._loader=null,this._state=null,this._requests=new Array,this.name=tE,this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this.onLoaderStateChangedObservable=new Ih,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.copyFrom(e)}_logEnabled(t){const i=e._logSpaces.substr(0,2*this._logIndentLevel);jh.Log(`${i}${t}`)}_endPerformanceCounterDisabled(e){}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const e of this._requests)e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}canDirectLoad(t){return-1!==t.indexOf("asset")&&-1!==t.indexOf("version")||t.startsWith("data:base64,"+e._MagicBase64Encoded)||t.startsWith("data:;base64,"+e._MagicBase64Encoded)||t.startsWith("data:application/octet-stream;base64,"+e._MagicBase64Encoded)||t.startsWith("data:model/gltf-binary;base64,"+e._MagicBase64Encoded)}get capturePerformanceCounters(){return this._capturePerformanceCounters}loadAsync(e,t,i,n,a){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(e,t,i,n,a))))}loadAssetContainerAsync(e,t,i,n,a){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(t);const s=new zy(e),r=[];this.onMaterialLoadedObservable.add((e=>{r.push(e)}));const o=[];this.onTextureLoadedObservable.add((e=>{o.push(e)}));const l=[];this.onCameraLoadedObservable.add((e=>{l.push(e)}));const c=[];return this.onMeshLoadedObservable.add((e=>{e.morphTargetManager&&c.push(e.morphTargetManager)})),this._loader.importMeshAsync(null,e,s,t,i,n,a).then((e=>(Array.prototype.push.apply(s.geometries,e.geometries),Array.prototype.push.apply(s.meshes,e.meshes),Array.prototype.push.apply(s.particleSystems,e.particleSystems),Array.prototype.push.apply(s.skeletons,e.skeletons),Array.prototype.push.apply(s.animationGroups,e.animationGroups),Array.prototype.push.apply(s.materials,r),Array.prototype.push.apply(s.textures,o),Array.prototype.push.apply(s.lights,e.lights),Array.prototype.push.apply(s.transformNodes,e.transformNodes),Array.prototype.push.apply(s.cameras,l),Array.prototype.push.apply(s.morphTargetManagers,c),s)))}))}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(Zy[this._state]))}_loadFile(e,t,i,n,a,s){const r=e._loadFile(t,i,(e=>{this._onProgress(e,r)}),!0,n,a,s);return r.onCompleteObservable.add((()=>{r._lengthComputable=!0,r._total=r._loaded})),this._requests.push(r),r}static _compareVersion(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0}whenCompleteAsync(){return new Promise(((e,t)=>{this.onCompleteObservable.addOnce((()=>{e()})),this.onErrorObservable.addOnce((e=>{t(e)}))}))}_unpackBinaryV2Async(e,t){const i=1313821514,n=5130562,a=e.readUint32();if(e.readUint32()!==i)throw new Error("First chunk format is not JSON");return e.byteOffset+a===t?e.loadAsync(a).then((()=>({json:this._parseJson(e.readString(a)),bin:null}))):e.loadAsync(a+8).then((()=>{const s={json:this._parseJson(e.readString(a)),bin:null},r=()=>{const a=e.readUint32();switch(e.readUint32()){case i:throw new Error("Unexpected JSON chunk");case n:{const t=e.byteOffset;s.bin={readAsync:(i,n)=>e.buffer.readAsync(t+i,n),byteLength:a},e.skipBytes(a);break}default:e.skipBytes(a)}return e.byteOffset!==t?e.loadAsync(8).then(r):Promise.resolve(s)};return r()}))}loadFile(e,t,i,n,a,s,r,o){if(ArrayBuffer.isView(t))return this._loadBinary(e,t,i,n,r,o),null;this._progressCallback=a;const l=t.name||ad.GetFilename(t);if(s){if(this.useRangeRequests){this.validate&&jh.Warn("glTF validation is not supported when range requests are enabled");const i={abort:()=>{},onCompleteObservable:new Ih},a={readAsync:(i,n)=>new Promise(((a,s)=>{this._loadFile(e,t,(e=>{a(new Uint8Array(e))}),!0,(e=>{s(e)}),(e=>{e.setRequestHeader("Range",`bytes=${i}-${i+n-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Xy(a)).then((e=>{i.onCompleteObservable.notifyObservers(i),n(e)}),r?e=>r(void 0,e):void 0),i}return this._loadFile(e,t,(t=>{this._validate(e,new Uint8Array(t,0,t.byteLength),i,l),this._unpackBinaryAsync(new Xy({readAsync:(e,i)=>iE(t,e,i),byteLength:t.byteLength})).then((e=>{n(e)}),r?e=>r(void 0,e):void 0)}),!0,r)}return this._loadFile(e,t,(t=>{try{this._validate(e,t,i,l),n({json:this._parseJson(t)})}catch{r&&r()}}),!1,r)}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}set onSkinLoaded(e){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((t=>e(t.node,t.skinnedNode)))}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)}_validate(e,t,i="",n=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),Ky.ValidateAsync(t,i,n,(t=>this.preprocessUrlAsync(i+t).then((t=>e._loadFileAsync(t,void 0,!0,!0).then((e=>new Uint8Array(e,0,e.byteLength))))))).then((e=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(e),this.onValidatedObservable.clear()}),(e=>{this._endPerformanceCounter("Validate JSON"),ad.Warn(`Failed to validate: ${e.message}`),this.onValidatedObservable.clear()})))}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)}_logOpen(e){this._log(e),this._logIndentLevel++}_onProgress(e,t){if(!this._progressCallback)return;t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total;let i=!0,n=0,a=0;for(const e of this._requests){if(void 0===e._lengthComputable||void 0===e._loaded||void 0===e._total)return;i=i&&e._lengthComputable,n+=e._loaded,a+=e._total}this._progressCallback({lengthComputable:i,loaded:n,total:i?a:0})}_loadBinary(e,t,i,n,a,s){this._validate(e,new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i,s),this._unpackBinaryAsync(new Xy({readAsync:(e,i)=>function(e,t,i){try{if(t<0||t>=e.byteLength)throw new RangeError("Offset is out of range.");if(t+i>e.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(e.buffer,e.byteOffset+t,i))}catch(e){return Promise.reject(e)}}(t,e,i),byteLength:t.byteLength})).then((e=>{n(e)}),a?e=>a(void 0,e):void 0)}_endPerformanceCounterEnabled(e){ad.EndPerformanceCounter(e)}};yE.IncrementalLoading=!0,yE.HomogeneousCoordinates=!1,yE._MagicBase64Encoded="Z2xURg",yE._logSpaces="                                ",Ly(new yE),(aE=nE||(nE={}))[aE.BYTE=5120]="BYTE",aE[aE.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",aE[aE.SHORT=5122]="SHORT",aE[aE.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",aE[aE.FLOAT=5126]="FLOAT",(rE=sE||(sE={}))[rE.FRAGMENT=35632]="FRAGMENT",rE[rE.VERTEX=35633]="VERTEX",(lE=oE||(oE={}))[lE.BYTE=5120]="BYTE",lE[lE.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",lE[lE.SHORT=5122]="SHORT",lE[lE.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",lE[lE.INT=5124]="INT",lE[lE.UNSIGNED_INT=5125]="UNSIGNED_INT",lE[lE.FLOAT=5126]="FLOAT",lE[lE.FLOAT_VEC2=35664]="FLOAT_VEC2",lE[lE.FLOAT_VEC3=35665]="FLOAT_VEC3",lE[lE.FLOAT_VEC4=35666]="FLOAT_VEC4",lE[lE.INT_VEC2=35667]="INT_VEC2",lE[lE.INT_VEC3=35668]="INT_VEC3",lE[lE.INT_VEC4=35669]="INT_VEC4",lE[lE.BOOL=35670]="BOOL",lE[lE.BOOL_VEC2=35671]="BOOL_VEC2",lE[lE.BOOL_VEC3=35672]="BOOL_VEC3",lE[lE.BOOL_VEC4=35673]="BOOL_VEC4",lE[lE.FLOAT_MAT2=35674]="FLOAT_MAT2",lE[lE.FLOAT_MAT3=35675]="FLOAT_MAT3",lE[lE.FLOAT_MAT4=35676]="FLOAT_MAT4",lE[lE.SAMPLER_2D=35678]="SAMPLER_2D",(hE=cE||(cE={}))[hE.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",hE[hE.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",hE[hE.REPEAT=10497]="REPEAT",(uE=fE||(fE={}))[uE.NEAREST=9728]="NEAREST",uE[uE.LINEAR=9728]="LINEAR",uE[uE.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",uE[uE.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",uE[uE.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",uE[uE.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",(mE=dE||(dE={}))[mE.ALPHA=6406]="ALPHA",mE[mE.RGB=6407]="RGB",mE[mE.RGBA=6408]="RGBA",mE[mE.LUMINANCE=6409]="LUMINANCE",mE[mE.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",(_E=pE||(pE={}))[_E.FRONT=1028]="FRONT",_E[_E.BACK=1029]="BACK",_E[_E.FRONT_AND_BACK=1032]="FRONT_AND_BACK",(gE=vE||(vE={}))[gE.ZERO=0]="ZERO",gE[gE.ONE=1]="ONE",gE[gE.SRC_COLOR=768]="SRC_COLOR",gE[gE.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",gE[gE.DST_COLOR=774]="DST_COLOR",gE[gE.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",gE[gE.SRC_ALPHA=770]="SRC_ALPHA",gE[gE.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",gE[gE.DST_ALPHA=772]="DST_ALPHA",gE[gE.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",gE[gE.CONSTANT_COLOR=32769]="CONSTANT_COLOR",gE[gE.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",gE[gE.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",gE[gE.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",gE[gE.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",Vh.AddNodeConstructor("Light_Type_0",((e,t)=>()=>new EE(e,wh.Zero(),t)));var EE=class extends _v{prepareLightSpecificDefines(e,t){e["POINTLIGHT"+t]=!0}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(t,this.position.x,this.position.y,this.position.z),this}set shadowAngle(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}set direction(e){const t=this.needCube();if(this._direction=e,this.needCube()!==t&&this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next()){t.value.recreateShadowMap()}}}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}get direction(){return this._direction}needCube(){return!this.direction}getTypeID(){return mv.LIGHTTYPEID_POINTLIGHT}_setDefaultShadowProjectionMatrix(e,t,i){const n=this.getScene().activeCamera;if(!n)return;const a=void 0!==this.shadowMinZ?this.shadowMinZ:n.minZ,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,r=this.getScene().getEngine().useReverseDepthBuffer;Lh.PerspectiveFovLHToRef(this.shadowAngle,1,r?s:a,r?a:s,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,r)}getClassName(){return"PointLight"}get shadowAngle(){return this._shadowAngle}getShadowDirection(e){if(this.direction)return super.getShadowDirection(e);switch(e){case 0:return new wh(1,0,0);case 1:return new wh(-1,0,0);case 2:return new wh(0,-1,0);case 3:return new wh(0,1,0);case 4:return new wh(0,0,1);case 5:return new wh(0,0,-1)}return wh.Zero()}constructor(e,t,i){super(e,i),this._shadowAngle=Math.PI/2,this.position=t}};Lc([Hc()],EE.prototype,"shadowAngle",null),rh("BABYLON.PointLight",EE),Vh.AddNodeConstructor("Light_Type_2",((e,t)=>()=>new AE(e,wh.Zero(),wh.Zero(),0,0,t)));var AE=class e extends _v{set shadowAngleScale(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()}get projectionTexture(){return this._projectionTexture}get innerAngle(){return this._innerAngle}getTypeID(){return mv.LIGHTTYPEID_SPOTLIGHT}set angle(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}static _IsProceduralTexture(e){return void 0!==e.onGeneratedObservable}transferTexturesToEffect(e,t){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),e.setTexture("projectionLightTexture"+t,this.projectionTexture)),this}set projectionTextureUpDirection(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0}_setDirection(e){super._setDirection(e),this._projectionTextureViewLightDirty=!0}set projectionTexture(t){this._projectionTexture!==t&&(this._projectionTexture=t,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(e._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):e._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferToEffect(e,t){let i;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),i=wh.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),i=wh.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",i.x,i.y,i.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this}set projectionTextureLightFar(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0}getClassName(){return"SpotLight"}static _IsTexture(e){return void 0!==e.onLoadObservable}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const e=this.projectionTextureLightFar,t=this.projectionTextureLightNear,i=e/(e-t),n=-i*t,a=1/Math.tan(this._angle/2);Lh.FromValuesToRef(a/1,0,0,0,0,a,0,0,0,0,i,1,0,0,n,0,this._projectionTextureProjectionLightMatrix)}get shadowAngleScale(){return this._shadowAngleScale}set innerAngle(e){this._innerAngle=e,this._computeAngleValues()}_setDefaultShadowProjectionMatrix(e,t,i){const n=this.getScene().activeCamera;if(!n)return;this._shadowAngleScale=this._shadowAngleScale||1;const a=this._shadowAngleScale*this._angle,s=void 0!==this.shadowMinZ?this.shadowMinZ:n.minZ,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,o=this.getScene().getEngine().useReverseDepthBuffer;Lh.PerspectiveFovLHToRef(a,1,o?r:s,o?s:r,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}getDepthMaxZ(e){const t=this._scene.getEngine(),i=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:i}set projectionTextureProjectionLightMatrix(e){this._projectionTextureProjectionLightMatrix=e,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}_setPosition(e){super._setPosition(e),this._projectionTextureViewLightDirty=!0}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof yp){const e=this._projectionTexture.uScale/2,t=this._projectionTexture.vScale/2;Lh.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}prepareLightSpecificDefines(e,t){e["SPOTLIGHT"+t]=!0,e["PROJECTEDLIGHTTEXTURE"+t]=!(!this.projectionTexture||!this.projectionTexture.isReady())}get angle(){return this._angle}constructor(e,t,i,n,a,s){super(e,s),this._innerAngle=0,this._projectionTextureMatrix=Lh.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=wh.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=wh.Zero(),this._projectionTextureViewLightMatrix=Lh.Zero(),this._projectionTextureProjectionLightMatrix=Lh.Zero(),this._projectionTextureScalingMatrix=Lh.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=t,this.direction=i,this.angle=n,this.exponent=a}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}get projectionTextureLightNear(){return this._projectionTextureLightNear}transferToNodeMaterialEffect(e,t){let i;return i=this.computeTransformedInformation()?wh.Normalize(this.transformedDirection):wh.Normalize(this.direction),this.getScene().useRightHandedSystem?e.setFloat3(t,-i.x,-i.y,-i.z):e.setFloat3(t,i.x,i.y,i.z),this}get projectionTextureMatrix(){return this._projectionTextureMatrix}getDepthMinZ(e){const t=this._scene.getEngine(),i=void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?i:this._scene.getEngine().isNDCHalfZRange?0:i}set projectionTextureLightNear(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Lh.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}};Lc([Hc()],AE.prototype,"angle",null),Lc([Hc()],AE.prototype,"innerAngle",null),Lc([Hc()],AE.prototype,"shadowAngleScale",null),Lc([Hc()],AE.prototype,"exponent",void 0),Lc([Hc()],AE.prototype,"projectionTextureLightNear",null),Lc([Hc()],AE.prototype,"projectionTextureLightFar",null),Lc([Hc()],AE.prototype,"projectionTextureUpDirection",null),Lc([Vc("projectedLightTexture")],AE.prototype,"_projectionTexture",void 0),rh("BABYLON.SpotLight",AE);var CE,RE,TE=class e{static DecodeBufferToText(e){let t="";const i=e.byteLength;for(let n=0;n<i;++n)t+=String.fromCharCode(e[n]);return t}static SetUniform(e,t,i,n){switch(n){case oE.FLOAT:return e.setFloat(t,i),!0;case oE.FLOAT_VEC2:return e.setVector2(t,Ph.FromArray(i)),!0;case oE.FLOAT_VEC3:return e.setVector3(t,wh.FromArray(i)),!0;case oE.FLOAT_VEC4:return e.setVector4(t,Oh.FromArray(i)),!0;default:return!1}}static GetBufferFromBufferView(e,t,i,n,a){i=t.byteOffset+i;const s=e.loadedBufferViews[t.buffer];if(i+n>s.byteLength)throw new Error("Buffer access is out of range");const r=s.buffer;switch(i+=s.byteOffset,a){case nE.BYTE:return new Int8Array(r,i,n);case nE.UNSIGNED_BYTE:return new Uint8Array(r,i,n);case nE.SHORT:return new Int16Array(r,i,n);case nE.UNSIGNED_SHORT:return new Uint16Array(r,i,n);default:return new Float32Array(r,i,n)}}static GetDefaultMaterial(t){if(!e._DefaultMaterial){pu.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),pu.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join("\n");const i={vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},n={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};e._DefaultMaterial=new uS("GLTFDefaultMaterial",t,i,n),e._DefaultMaterial.setColor4("u_emission",new Ch(.5,.5,.5,1))}return e._DefaultMaterial}static GetTextureFilterMode(e){switch(e){case fE.LINEAR:case fE.LINEAR_MIPMAP_NEAREST:case fE.LINEAR_MIPMAP_LINEAR:return yp.TRILINEAR_SAMPLINGMODE;case fE.NEAREST:case fE.NEAREST_MIPMAP_NEAREST:return yp.NEAREST_SAMPLINGMODE;default:return yp.BILINEAR_SAMPLINGMODE}}static GetByteStrideFromType(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}}static GetWrapMode(e){switch(e){case cE.CLAMP_TO_EDGE:return yp.CLAMP_ADDRESSMODE;case cE.MIRRORED_REPEAT:return yp.MIRROR_ADDRESSMODE;case cE.REPEAT:default:return yp.WRAP_ADDRESSMODE}}static GetBufferFromAccessor(t,i){const n=t.bufferViews[i.bufferView],a=i.count*e.GetByteStrideFromType(i);return e.GetBufferFromBufferView(t,n,i.byteOffset,a,i.componentType)}static SetMatrix(e,t,i,n,a){let s=null;if("MODEL"===i.semantic?s=t.getWorldMatrix():"PROJECTION"===i.semantic?s=e.getProjectionMatrix():"VIEW"===i.semantic?s=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===i.semantic?s=Lh.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===i.semantic?s=t.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===i.semantic?s=t.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===i.semantic?s=t.getWorldMatrix().invert():"VIEWINVERSE"===i.semantic?s=e.getViewMatrix().invert():"PROJECTIONINVERSE"===i.semantic?s=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===i.semantic?s=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===i.semantic?s=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===i.semantic&&(s=Lh.Transpose(t.getWorldMatrix().invert())),s)switch(i.type){case oE.FLOAT_MAT2:a.setMatrix2x2(n,Lh.GetAsMatrix2x2(s));break;case oE.FLOAT_MAT3:a.setMatrix3x3(n,Lh.GetAsMatrix3x3(s));break;case oE.FLOAT_MAT4:a.setMatrix(n,s)}}};TE._DefaultMaterial=null,(RE=CE||(CE={}))[RE.IDENTIFIER=1]="IDENTIFIER",RE[RE.UNKNOWN=2]="UNKNOWN",RE[RE.END_OF_INPUT=3]="END_OF_INPUT";var NE=class{read(){return this._toParse[this._pos++]}isEnd(){return this._pos>=this._maxPos}getNextToken(){if(this.isEnd())return CE.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=CE.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=CE.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken}forward(){this._pos++}constructor(e){this._pos=0,this.currentToken=CE.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}peek(){return this._toParse[this._pos]}},ME=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],IE=["world","view","projection","worldView","worldViewProjection","mBones"],xE=["translation","rotation","scale"],bE=["position","rotationQuaternion","scaling"],PE=(e,t,i)=>{for(const n in e){const a=e[n];i[t][n]=a}},wE=e=>{if(e)for(let t=0;t<e.length/2;t++)e[2*t+1]=1-e[2*t+1]},OE=e=>{if("NORMAL"===e.semantic)return"normal";if("POSITION"===e.semantic)return"position";if("JOINT"===e.semantic)return"matricesIndices";if("WEIGHT"===e.semantic)return"matricesWeights";if("COLOR"===e.semantic)return"color";if(e.semantic&&-1!==e.semantic.indexOf("TEXCOORD_")){const t=Number(e.semantic.split("_")[1]);return"uv"+(0===t?"":t+1)}return null},DE=e=>{let t=null;if(e.translation||e.rotation||e.scale){const i=wh.FromArray(e.scale||[1,1,1]),n=Dh.FromArray(e.rotation||[0,0,0,1]),a=wh.FromArray(e.translation||[0,0,0]);t=Lh.Compose(i,n,a)}else t=Lh.FromArray(e.matrix);return t},LE=(e,t,i,n)=>{for(let e=0;e<n.bones.length;e++)if(n.bones[e].name===i)return n.bones[e];const a=e.nodes;for(const s in a){const r=a[s];if(!r.jointName)continue;const o=r.children;for(let a=0;a<o.length;a++){const l=e.nodes[o[a]];if(l.jointName&&l.jointName===i){const i=DE(r),a=new iy(r.name||"",n,LE(e,t,r.jointName,n),i);return a.id=s,a}}}return null},FE=(e,t)=>{for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.node.children.length;e++){if(n.node.children[e]===t)return n.bone}}return null},kE=(e,t)=>{const i=e.nodes;let n=i[t];if(n)return{node:n,id:t};for(const e in i)if(n=i[e],n.jointName===t)return{node:n,id:e};return null},BE=(e,t)=>{for(let i=0;i<e.jointNames.length;i++)if(e.jointNames[i]===t)return!0;return!1},GE=(e,t,i,n)=>{if(n||(n=new oy(t.name||"","",e.scene)),!t.babylonSkeleton)return n;const a=[],s=[];((e,t,i,n)=>{for(const a in e.nodes){const s=e.nodes[a],r=a;if(!s.jointName||BE(i,s.jointName))continue;const o=DE(s),l=new iy(s.name||"",t,null,o);l.id=r,n.push({bone:l,node:s,id:r})}for(let e=0;e<n.length;e++){const t=n[e],i=t.node.children;for(let e=0;e<i.length;e++){let a=null;for(let t=0;t<n.length;t++)if(n[t].id===i[e]){a=n[t];break}a&&(a.bone._parent=t.bone,t.bone.children.push(a.bone))}}})(e,n,t,a),n.bones=[];for(let i=0;i<t.jointNames.length;i++){const r=kE(e,t.jointNames[i]);if(!r)continue;const o=r.node;if(!o){ad.Warn("Joint named "+t.jointNames[i]+" does not exist");continue}const l=r.id,c=e.scene.getBoneById(l);if(c){n.bones.push(c);continue}let h=!1,f=null;for(let a=0;a<i;a++){const i=kE(e,t.jointNames[a]);if(!i)continue;const s=i.node;if(!s){ad.Warn("Joint named "+t.jointNames[a]+" does not exist when looking for parent");continue}const r=s.children;if(r){h=!1;for(let i=0;i<r.length;i++)if(r[i]===l){f=LE(e,t,t.jointNames[a],n),h=!0;break}if(h)break}}const u=DE(o);!f&&a.length>0&&(f=FE(a,l),f&&-1===s.indexOf(f)&&s.push(f));new iy(o.jointName||"",n,f,u).id=l}const r=n.bones;n.bones=[];for(let i=0;i<t.jointNames.length;i++){const a=kE(e,t.jointNames[i]);if(a)for(let e=0;e<r.length;e++)if(r[e].id===a.id){n.bones.push(r[e]);break}}n.prepare();for(let e=0;e<s.length;e++)n.bones.push(s[e]);return n},UE=(e,t,i,n,a)=>{if(a||(e.scene._blockEntityCollection=!!e.assetContainer,(a=new wm(t.name||"",e.scene))._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,a.id=n),!t.babylonNode)return a;const s=[];let r=null;const o=[],l=[],c=[],h=[];for(let t=0;t<i.length;t++){const n=i[t],a=e.meshes[n];if(a)for(let t=0;t<a.primitives.length;t++){const i=new _f,n=a.primitives[t];n.mode;const f=n.attributes;let u=null,d=null;for(const t in f)if(u=e.accessors[f[t]],d=TE.GetBufferFromAccessor(e,u),"NORMAL"===t)i.normals=new Float32Array(d.length),i.normals.set(d);else if("POSITION"===t){if(yE.HomogeneousCoordinates){i.positions=new Float32Array(d.length-d.length/4);for(let e=0;e<d.length;e+=4)i.positions[e]=d[e],i.positions[e+1]=d[e+1],i.positions[e+2]=d[e+2]}else i.positions=new Float32Array(d.length),i.positions.set(d);l.push(i.positions.length)}else if(-1!==t.indexOf("TEXCOORD_")){const e=Number(t.split("_")[1]),n=$h.UVKind+(0===e?"":e+1),a=new Float32Array(d.length);a.set(d),wE(a),i.set(a,n)}else"JOINT"===t?(i.matricesIndices=new Float32Array(d.length),i.matricesIndices.set(d)):"WEIGHT"===t?(i.matricesWeights=new Float32Array(d.length),i.matricesWeights.set(d)):"COLOR"===t&&(i.colors=new Float32Array(d.length),i.colors.set(d));if(u=e.accessors[n.indices],u)d=TE.GetBufferFromAccessor(e,u),i.indices=new Int32Array(d.length),i.indices.set(d),h.push(i.indices.length);else{const e=[];for(let t=0;t<i.positions.length/3;t++)e.push(t);i.indices=new Int32Array(e),h.push(i.indices.length)}r?r.merge(i):r=i;const m=e.scene.getMaterialById(n.material);s.push(null===m?TE.GetDefaultMaterial(e.scene):m),o.push(0===o.length?0:o[o.length-1]+l[l.length-2]),c.push(0===c.length?0:c[c.length-1]+h[h.length-2])}}let f;e.scene._blockEntityCollection=!!e.assetContainer,s.length>1?(f=new Cm("multimat"+n,e.scene),f.subMaterials=s):f=new Og("multimat"+n,e.scene),1===s.length&&(f=s[0]),f._parentContainer=e.assetContainer,a.material||(a.material=f),new md(n,e.scene,r,!1,a),a.computeWorldMatrix(!0),e.scene._blockEntityCollection=!1,a.subMeshes=[];let u=0;for(let t=0;t<i.length;t++){const n=i[t],s=e.meshes[n];if(s)for(let e=0;e<s.primitives.length;e++)s.primitives[e].mode,mf.AddToMesh(u,o[u],l[u],c[u],h[u],a,a,!0),u++}return a},HE=(e,t,i,n)=>{e.position&&(e.position=t),(e.rotationQuaternion||e.rotation)&&(e.rotationQuaternion=i),e.scaling&&(e.scaling=n)},VE=(e,t,i)=>{let n=null;if(e.importOnlyMeshes&&(t.skin||t.meshes)&&e.importMeshesNames&&e.importMeshesNames.length>0&&-1===e.importMeshesNames.indexOf(t.name||""))return null;if(t.skin){if(t.meshes){const a=e.skins[t.skin],s=UE(e,t,t.meshes,i,t.babylonNode);s.skeleton=e.scene.getLastSkeletonById(t.skin),null===s.skeleton&&(s.skeleton=GE(e,a,0,a.babylonSkeleton),a.babylonSkeleton||(a.babylonSkeleton=s.skeleton)),n=s}}else if(t.meshes){n=UE(e,t,t.mesh?[t.mesh]:t.meshes,i,t.babylonNode)}else if(!t.light||t.babylonNode||e.importOnlyMeshes){if(t.camera&&!t.babylonNode&&!e.importOnlyMeshes){const i=e.cameras[t.camera];if(i){if(e.scene._blockEntityCollection=!!e.assetContainer,"orthographic"===i.type){const i=new Qv(t.camera,wh.Zero(),e.scene,!1);i.name=t.name||"",i.mode=fd.ORTHOGRAPHIC_CAMERA,i.attachControl(),n=i,i._parentContainer=e.assetContainer}else if("perspective"===i.type){const a=i[i.type],s=new Qv(t.camera,wh.Zero(),e.scene,!1);s.name=t.name||"",s.attachControl(),a.aspectRatio||(a.aspectRatio=e.scene.getEngine().getRenderWidth()/e.scene.getEngine().getRenderHeight()),a.znear&&a.zfar&&(s.maxZ=a.zfar,s.minZ=a.znear),n=s,s._parentContainer=e.assetContainer}e.scene._blockEntityCollection=!1}}}else{const i=e.lights[t.light];if(i)if("ambient"===i.type){const a=i[i.type],s=new pv(t.light,wh.Zero(),e.scene);s.name=t.name||"",a.color&&(s.diffuse=Ah.FromArray(a.color)),n=s}else if("directional"===i.type){const a=i[i.type],s=new vv(t.light,wh.Zero(),e.scene);s.name=t.name||"",a.color&&(s.diffuse=Ah.FromArray(a.color)),n=s}else if("point"===i.type){const a=i[i.type],s=new EE(t.light,wh.Zero(),e.scene);s.name=t.name||"",a.color&&(s.diffuse=Ah.FromArray(a.color)),n=s}else if("spot"===i.type){const a=i[i.type],s=new AE(t.light,wh.Zero(),wh.Zero(),0,0,e.scene);s.name=t.name||"",a.color&&(s.diffuse=Ah.FromArray(a.color)),a.fallOfAngle&&(s.angle=a.fallOfAngle),a.fallOffExponent&&(s.exponent=a.fallOffExponent),n=s}}if(!t.jointName){if(t.babylonNode)return t.babylonNode;if(null===n){e.scene._blockEntityCollection=!!e.assetContainer;const i=new wm(t.name||"",e.scene);i._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,t.babylonNode=i,n=i}}if(null!==n){if(t.matrix&&n instanceof wm)((e,t)=>{if(t.matrix){const i=new wh(0,0,0),n=new Dh,a=new wh(0,0,0);Lh.FromArray(t.matrix).decompose(a,n,i),HE(e,i,n,a)}else t.translation&&t.rotation&&t.scale&&HE(e,wh.FromArray(t.translation),Dh.FromArray(t.rotation),wh.FromArray(t.scale));e.computeWorldMatrix(!0)})(n,t);else{const e=t.translation||[0,0,0],i=t.rotation||[0,0,0,1],a=t.scale||[1,1,1];HE(n,wh.FromArray(e),Dh.FromArray(i),wh.FromArray(a))}n.updateCache(!0),t.babylonNode=n}return n},WE=(e,t,i,n=!1)=>{const a=e.nodes[t];let s=null;if(n=!(e.importOnlyMeshes&&!n&&e.importMeshesNames)||(-1!==e.importMeshesNames.indexOf(a.name||"")||0===e.importMeshesNames.length),!a.jointName&&n&&(s=VE(e,a,t),null!==s&&(s.id=t,s.parent=i)),a.children)for(let t=0;t<a.children.length;t++)WE(e,a.children[t],s,n)},zE=e=>{let t=e.currentScene;if(t)for(let i=0;i<t.nodes.length;i++)WE(e,t.nodes[i],null);else for(const i in e.scenes){t=e.scenes[i];for(let i=0;i<t.nodes.length;i++)WE(e,t.nodes[i],null)}(e=>{for(const t in e.animations){const i=e.animations[t];if(!i.channels||!i.samplers)continue;let n=null;for(let a=0;a<i.channels.length;a++){const s=i.channels[a],r=i.samplers[s.sampler];if(!r)continue;let o=null,l=null;i.parameters?(o=i.parameters[r.input],l=i.parameters[r.output]):(o=r.input,l=r.output);const c=TE.GetBufferFromAccessor(e,e.accessors[o]),h=TE.GetBufferFromAccessor(e,e.accessors[l]),f=s.target.id;let u=e.scene.getNodeById(f);if(null===u&&(u=e.scene.getNodeByName(f)),null===u){ad.Warn("Creating animation named "+t+". But cannot find node named "+f+" to attach to");continue}const d=u instanceof iy;let m=s.target.path;const p=xE.indexOf(m);-1!==p&&(m=bE[p]);let _=Ov.ANIMATIONTYPE_MATRIX;d||("rotationQuaternion"===m?(_=Ov.ANIMATIONTYPE_QUATERNION,u.rotationQuaternion=new Dh):_=Ov.ANIMATIONTYPE_VECTOR3);let v=null;const g=[];let S=0,y=!1;d&&n&&n.getKeys().length===c.length&&(v=n,y=!0),y||(e.scene._blockEntityCollection=!!e.assetContainer,v=new Ov(t,d?"_matrix":m,1,_,Ov.ANIMATIONLOOPMODE_CYCLE),e.scene._blockEntityCollection=!1);for(let e=0;e<c.length;e++){let t=null;if("rotationQuaternion"===m?(t=Dh.FromArray([h[S],h[S+1],h[S+2],h[S+3]]),S+=4):(t=wh.FromArray([h[S],h[S+1],h[S+2]]),S+=3),d){const i=u;let a=wh.Zero(),s=new Dh,r=wh.Zero(),o=i.getBaseMatrix();y&&n&&(o=n.getKeys()[e].value),o.decompose(r,s,a),"position"===m?a=t:"rotationQuaternion"===m?s=t:r=t,t=Lh.Compose(r,s,a)}y?n&&(n.getKeys()[e].value=t):g.push({frame:c[e],value:t})}!y&&v&&(v.setKeys(g),u.animations.push(v)),n=v,e.scene.stopAnimation(u),e.scene.beginAnimation(u,0,c[c.length-1],!0,1)}}})(e);for(let t=0;t<e.scene.skeletons.length;t++){const i=e.scene.skeletons[t];e.scene.beginAnimation(i,0,Number.MAX_VALUE,!0,1)}},XE=(e,t,i,n,a,s)=>r=>{((e,t,i,n,a)=>{const s=n.values||i.parameters,r=i.uniforms;for(const i in a){const o=a[i],l=o.type;let c=s[r[i]];if(void 0===c&&(c=o.value),!c)continue;const h=e=>i=>{o.value&&e&&(t.setTexture(e,i),delete a[e])};l===oE.SAMPLER_2D?qE.LoadTextureAsync(e,n.values?c:o.value,h(i),(()=>h(null))):o.value&&TE.SetUniform(t,i,n.values?c:o.value,l)&&delete a[i]}})(e,t,i,n,a),t.onBind=r=>{((e,t,i,n,a,s,r)=>{const o=s.values||a.parameters;for(const r in i){const l=i[r],c=l.type;if(c===oE.FLOAT_MAT2||c===oE.FLOAT_MAT3||c===oE.FLOAT_MAT4)if(!l.semantic||l.source||l.node){if(l.semantic&&(l.source||l.node)){let e=t.scene.getNodeByName(l.source||l.node||"");if(null===e&&(e=t.scene.getNodeById(l.source||l.node||"")),null===e)continue;TE.SetMatrix(t.scene,e,l,r,n.getEffect())}}else TE.SetMatrix(t.scene,e,l,r,n.getEffect());else{const e=o[a.uniforms[r]];if(!e)continue;if(c===oE.SAMPLER_2D){const i=t.textures[s.values?e:l.value].babylonTexture;if(null==i)continue;n.getEffect().setTexture(r,i)}else TE.SetUniform(n.getEffect(),r,e,c)}}r(n)})(r,e,a,t,i,n,s)}},YE=(e,t,i)=>{for(const n in t.uniforms){const a=t.uniforms[n],s=t.parameters[a];if(e.currentIdentifier===n&&s.semantic&&!s.source&&!s.node){const e=ME.indexOf(s.semantic);if(-1!==e)return delete i[n],IE[e]}}return e.currentIdentifier},jE=e=>{for(const t in e.materials)qE.LoadMaterialAsync(e,t,(()=>{}),(()=>{}))},KE=class{static LoadShaderStringAsync(e,t,i,n){const a=e.shaders[t];if(ad.IsBase64(a.uri)){const e=atob(a.uri.split(",")[1]);i&&i(e)}else ad.LoadFile(e.rootUrl+a.uri,i,void 0,void 0,!1,(e=>{e&&n&&n(e.status+" "+e.statusText)}))}static CreateTextureAsync(e,t,i,n){const a=e.textures[t];if(a.babylonTexture)return void n(a.babylonTexture);const s=e.samplers[a.sampler],r=s.minFilter===fE.NEAREST_MIPMAP_NEAREST||s.minFilter===fE.NEAREST_MIPMAP_LINEAR||s.minFilter===fE.LINEAR_MIPMAP_NEAREST||s.minFilter===fE.LINEAR_MIPMAP_LINEAR,o=yp.BILINEAR_SAMPLINGMODE,l=null==i?new Blob:new Blob([i]),c=URL.createObjectURL(l),h=()=>URL.revokeObjectURL(c),f=new yp(c,e.scene,!r,!0,o,h,h);void 0!==s.wrapS&&(f.wrapU=TE.GetWrapMode(s.wrapS)),void 0!==s.wrapT&&(f.wrapV=TE.GetWrapMode(s.wrapT)),f.name=t,a.babylonTexture=f,n(f)}static CreateRuntime(e,t,i){const n={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:i,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return e.extensions&&PE(e.extensions,"extensions",n),e.extensionsUsed&&PE(e.extensionsUsed,"extensionsUsed",n),e.buffers&&((e,t)=>{for(const i in e){const n=e[i];t.buffers[i]=n,t.buffersCount++}})(e.buffers,n),e.bufferViews&&PE(e.bufferViews,"bufferViews",n),e.accessors&&PE(e.accessors,"accessors",n),e.meshes&&PE(e.meshes,"meshes",n),e.lights&&PE(e.lights,"lights",n),e.cameras&&PE(e.cameras,"cameras",n),e.nodes&&PE(e.nodes,"nodes",n),e.images&&PE(e.images,"images",n),e.textures&&PE(e.textures,"textures",n),e.shaders&&((e,t)=>{for(const i in e){const n=e[i];t.shaders[i]=n,t.shaderscount++}})(e.shaders,n),e.programs&&PE(e.programs,"programs",n),e.samplers&&PE(e.samplers,"samplers",n),e.techniques&&PE(e.techniques,"techniques",n),e.materials&&PE(e.materials,"materials",n),e.animations&&PE(e.animations,"animations",n),e.skins&&PE(e.skins,"skins",n),e.scenes&&(n.scenes=e.scenes),e.scene&&e.scenes&&(n.currentScene=e.scenes[e.scene]),n}static LoadBufferAsync(e,t,i,n,a){const s=e.buffers[t];ad.IsBase64(s.uri)?setTimeout((()=>i(new Uint8Array(ad.DecodeBase64(s.uri))))):ad.LoadFile(e.rootUrl+s.uri,(e=>i(new Uint8Array(e))),a,void 0,!0,(e=>{e&&n(e.status+" "+e.statusText)}))}static LoadTextureBufferAsync(e,t,i,n){const a=e.textures[t];if(!a||!a.source)return void n("");if(a.babylonTexture)return void i(null);const s=e.images[a.source];ad.IsBase64(s.uri)?setTimeout((()=>i(new Uint8Array(ad.DecodeBase64(s.uri))))):ad.LoadFile(e.rootUrl+s.uri,(e=>i(new Uint8Array(e))),void 0,void 0,!0,(e=>{e&&n(e.status+" "+e.statusText)}))}static LoadMaterialAsync(e,t,i,n){const a=e.materials[t];if(!a.technique)return void(n&&n("No technique found."));const s=e.techniques[a.technique];if(!s){e.scene._blockEntityCollection=!!e.assetContainer;const n=new Og(t,e.scene);return n._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,n.diffuseColor=new Ah(.5,.5,.5),n.sideOrientation=Am.CounterClockWiseSideOrientation,void i(n)}const r=e.programs[s.program],o=s.states,l=pu.ShadersStore[r.vertexShader+"VertexShader"],c=pu.ShadersStore[r.fragmentShader+"PixelShader"];let h="",f="";const u=new NE(l),d=new NE(c),m={},p=[],_=[],v=[];for(const e in s.uniforms){const t=s.uniforms[e],i=s.parameters[t];if(m[e]=i,!i.semantic||i.node||i.source)i.type===oE.SAMPLER_2D?v.push(e):p.push(e);else{const t=ME.indexOf(i.semantic);-1!==t?(p.push(IE[t]),delete m[e]):p.push(e)}}for(const e in s.attributes){const t=s.attributes[e],i=s.parameters[t];if(i.semantic){const e=OE(i);e&&_.push(e)}}for(;!u.isEnd()&&u.getNextToken();){if(u.currentToken!==CE.IDENTIFIER){h+=u.currentString;continue}let e=!1;for(const t in s.attributes){const i=s.attributes[t],n=s.parameters[i];if(u.currentIdentifier===t&&n.semantic){h+=OE(n),e=!0;break}}e||(h+=YE(u,s,m))}for(;!d.isEnd()&&d.getNextToken();){d.currentToken===CE.IDENTIFIER?f+=YE(d,s,m):f+=d.currentString}const g={vertex:r.vertexShader+t,fragment:r.fragmentShader+t},S={attributes:_,uniforms:p,samplers:v,needAlphaBlending:o&&o.enable&&-1!==o.enable.indexOf(3042)};pu.ShadersStore[r.vertexShader+t+"VertexShader"]=h,pu.ShadersStore[r.fragmentShader+t+"PixelShader"]=f;const y=new uS(t,e.scene,g,S);if(y.onError=((e,t,i)=>(n,a)=>{t.dispose(!0),i("Cannot compile program named "+e.name+". Error: "+a+". Default material will be applied")})(r,y,n),y.onCompiled=XE(e,y,s,a,m,i),y.sideOrientation=Am.CounterClockWiseSideOrientation,o&&o.functions){const e=o.functions;e.cullFace&&e.cullFace[0]!==pE.BACK&&(y.backFaceCulling=!1);const t=e.blendFuncSeparate;t&&(t[0]===vE.SRC_ALPHA&&t[1]===vE.ONE_MINUS_SRC_ALPHA&&t[2]===vE.ONE&&t[3]===vE.ONE?y.alphaMode=Ug.ALPHA_COMBINE:t[0]===vE.ONE&&t[1]===vE.ONE&&t[2]===vE.ZERO&&t[3]===vE.ONE?y.alphaMode=Ug.ALPHA_ONEONE:t[0]===vE.SRC_ALPHA&&t[1]===vE.ONE&&t[2]===vE.ZERO&&t[3]===vE.ONE?y.alphaMode=Ug.ALPHA_ADD:t[0]===vE.ZERO&&t[1]===vE.ONE_MINUS_SRC_COLOR&&t[2]===vE.ONE&&t[3]===vE.ONE?y.alphaMode=Ug.ALPHA_SUBTRACT:t[0]===vE.DST_COLOR&&t[1]===vE.ZERO&&t[2]===vE.ONE&&t[3]===vE.ONE?y.alphaMode=Ug.ALPHA_MULTIPLY:t[0]===vE.SRC_ALPHA&&t[1]===vE.ONE_MINUS_SRC_COLOR&&t[2]===vE.ONE&&t[3]===vE.ONE&&(y.alphaMode=Ug.ALPHA_MAXIMIZED))}}},$E=class e{_loadBuffersAsync(e,t){let i=!1;const n=(i,n)=>{qE.LoadBufferAsync(e,i,(a=>{e.loadedBufferCount++,a&&(a.byteLength!=e.buffers[i].byteLength&&ad.Error("Buffer named "+i+" is length "+a.byteLength+". Expected: "+n.byteLength),e.loadedBufferViews[i]=a),e.loadedBufferCount===e.buffersCount&&t()}),(()=>{ad.Error("Error when loading buffer named "+i+" located at "+n.uri)}))};for(const t in e.buffers){i=!0;const a=e.buffers[t];a?n.bind(this,t,a)():ad.Error("No buffer named: "+t)}i||t()}importMeshAsync(e,t,i,n,a,s){return new Promise(((r,o)=>{this._importMeshAsync(e,t,n,a,i,((e,t)=>{r({meshes:e,particleSystems:[],skeletons:t,animationGroups:[],lights:[],transformNodes:[],geometries:[],spriteManagers:[]})}),s,(e=>{o(new Error(e))}))}))}dispose(){}loadAsync(e,t,i,n){return new Promise(((a,s)=>{this._loadAsync(e,t,i,(()=>{a()}),n,(e=>{s(new Error(e))}))}))}_createNodes(e){let t=e.currentScene;if(t)for(let i=0;i<t.nodes.length;i++)WE(e,t.nodes[i],null);else for(const i in e.scenes){t=e.scenes[i];for(let i=0;i<t.nodes.length;i++)WE(e,t.nodes[i],null)}}_importMeshAsync(e,t,i,n,a,s,r,o){return t.useRightHandedSystem=!0,qE.LoadRuntimeAsync(t,i,n,(t=>{t.assetContainer=a,t.importOnlyMeshes=!0,""===e?t.importMeshesNames=[]:"string"==typeof e?t.importMeshesNames=[e]:!e||e instanceof Array?(t.importMeshesNames=[],ad.Warn("Argument meshesNames must be of type string or string[]")):t.importMeshesNames=[e],this._createNodes(t);const i=[],n=[];for(const e in t.nodes){const n=t.nodes[e];n.babylonNode instanceof Bd&&i.push(n.babylonNode)}for(const e in t.skins){const i=t.skins[e];i.babylonSkeleton instanceof oy&&n.push(i.babylonSkeleton)}this._loadBuffersAsync(t,(()=>{this._loadShadersAsync(t,(()=>{jE(t),zE(t),!yE.IncrementalLoading&&s&&s(i,n)}))})),yE.IncrementalLoading&&s&&s(i,n)}),o),!0}_loadAsync(e,t,i,n,a,s){e.useRightHandedSystem=!0,qE.LoadRuntimeAsync(e,t,i,(e=>{qE.LoadRuntimeExtensionsAsync(e,(()=>{this._createNodes(e),this._loadBuffersAsync(e,(()=>{this._loadShadersAsync(e,(()=>{jE(e),zE(e),yE.IncrementalLoading||n()}))})),yE.IncrementalLoading&&n()}),s)}),s)}static RegisterExtension(t){e.Extensions[t.name]?ad.Error('Tool with the same name "'+t.name+'" already exists'):e.Extensions[t.name]=t}_loadShadersAsync(e,t){let i=!1;const n=(i,n)=>{qE.LoadShaderStringAsync(e,i,(a=>{a instanceof ArrayBuffer||(e.loadedShaderCount++,a&&(pu.ShadersStore[i+(n.type===sE.VERTEX?"VertexShader":"PixelShader")]=a),e.loadedShaderCount===e.shaderscount&&t())}),(()=>{ad.Error("Error when loading shader program named "+i+" located at "+n.uri)}))};for(const t in e.shaders){i=!0;const a=e.shaders[t];a?n.bind(this,t,a)():ad.Error("No shader named: "+t)}i||t()}};$E.Extensions={};var qE=class e{static LoadShaderStringAsync(t,i,n,a){e._ApplyExtensions((e=>e.loadShaderStringAsync(t,i,n,a)),(()=>{KE.LoadShaderStringAsync(t,i,n,a)}))}loadMaterialAsync(e,t,i,n){return!1}static LoadMaterialAsync(t,i,n,a){e._ApplyExtensions((e=>e.loadMaterialAsync(t,i,n,a)),(()=>{KE.LoadMaterialAsync(t,i,n,a)}))}createTextureAsync(e,t,i,n,a){return!1}loadRuntimeAsync(e,t,i,n,a){return!1}loadTextureBufferAsync(e,t,i,n){return!1}static _ApplyExtensions(e,t){for(const t in $E.Extensions){if(e($E.Extensions[t]))return}t()}static LoadRuntimeAsync(t,i,n,a,s){e._ApplyExtensions((e=>e.loadRuntimeAsync(t,i,n,a,s)),(()=>{setTimeout((()=>{a&&a(KE.CreateRuntime(i.json,t,n))}))}))}static LoadTextureAsync(t,i,n,a){e._LoadTextureBufferAsync(t,i,(s=>{s&&e._CreateTextureAsync(t,i,s,n,a)}),a)}get name(){return this._name}static LoadBufferAsync(t,i,n,a,s){e._ApplyExtensions((e=>e.loadBufferAsync(t,i,n,a,s)),(()=>{KE.LoadBufferAsync(t,i,n,a,s)}))}loadShaderStringAsync(e,t,i,n){return!1}constructor(e){this._name=e}loadRuntimeExtensionsAsync(e,t,i){return!1}static _CreateTextureAsync(t,i,n,a,s){e._ApplyExtensions((e=>e.createTextureAsync(t,i,n,a,s)),(()=>{KE.CreateTextureAsync(t,i,n,a)}))}static LoadRuntimeExtensionsAsync(t,i,n){e._ApplyExtensions((e=>e.loadRuntimeExtensionsAsync(t,i,n)),(()=>{setTimeout((()=>{i()}))}))}loadBufferAsync(e,t,i,n,a){return!1}static _LoadTextureBufferAsync(t,i,n,a){e._ApplyExtensions((e=>e.loadTextureBufferAsync(t,i,n,a)),(()=>{KE.LoadTextureBufferAsync(t,i,n,a)}))}};yE._CreateGLTF1Loader=()=>new $E;$E.RegisterExtension(new class extends qE{loadShaderStringAsync(e,t,i){const n=e.shaders[t];if(!n.extensions||!(this.name in n.extensions))return!1;const a=n.extensions[this.name],s=e.bufferViews[a.bufferView],r=TE.GetBufferFromBufferView(e,s,0,s.byteLength,nE.UNSIGNED_BYTE);return setTimeout((()=>{const e=TE.DecodeBufferToText(r);i(e)})),!0}loadBufferAsync(e,t,i,n){return-1!==e.extensionsUsed.indexOf(this.name)&&("binary_glTF"===t&&(this._bin.readAsync(0,this._bin.byteLength).then(i,(e=>n(e.message))),!0))}constructor(){super("KHR_binary_glTF")}loadRuntimeAsync(e,t,i,n){const a=t.json.extensionsUsed;return!(!a||-1===a.indexOf(this.name)||!t.bin)&&(this._bin=t.bin,n(KE.CreateRuntime(t.json,e,i)),!0)}loadTextureBufferAsync(e,t,i){const n=e.textures[t],a=e.images[n.source];if(!a.extensions||!(this.name in a.extensions))return!1;const s=a.extensions[this.name],r=e.bufferViews[s.bufferView];return i(TE.GetBufferFromBufferView(e,r,0,r.byteLength,nE.UNSIGNED_BYTE)),!0}});$E.RegisterExtension(new class extends qE{constructor(){super("KHR_materials_common")}_loadTexture(e,t,i,n,a){KE.LoadTextureBufferAsync(e,t,(a=>{KE.CreateTextureAsync(e,t,a,(e=>i[n]=e))}),a)}loadRuntimeExtensionsAsync(e){if(!e.extensions)return!1;const t=e.extensions[this.name];if(!t)return!1;const i=t.lights;if(i)for(const t in i){const n=i[t];switch(n.type){case"ambient":{const t=new pv(n.name,new wh(0,1,0),e.scene),i=n.ambient;i&&(t.diffuse=Ah.FromArray(i.color||[1,1,1]));break}case"point":{const t=new EE(n.name,new wh(10,10,10),e.scene),i=n.point;i&&(t.diffuse=Ah.FromArray(i.color||[1,1,1]));break}case"directional":{const t=new vv(n.name,new wh(0,-1,0),e.scene),i=n.directional;i&&(t.diffuse=Ah.FromArray(i.color||[1,1,1]));break}case"spot":{const t=n.spot;if(t){new AE(n.name,new wh(0,10,0),new wh(0,-1,0),t.fallOffAngle||Math.PI,t.fallOffExponent||0,e.scene).diffuse=Ah.FromArray(t.color||[1,1,1])}break}default:ad.Warn('GLTF Material Common extension: light type "'+n.type+"\u201d not supported")}}return!1}loadMaterialAsync(e,t,i,n){const a=e.materials[t];if(!a||!a.extensions)return!1;const s=a.extensions[this.name];if(!s)return!1;const r=new Og(t,e.scene);return r.sideOrientation=Am.CounterClockWiseSideOrientation,"CONSTANT"===s.technique&&(r.disableLighting=!0),r.backFaceCulling=void 0!==s.doubleSided&&!s.doubleSided,r.alpha=void 0===s.values.transparency?1:s.values.transparency,r.specularPower=void 0===s.values.shininess?0:s.values.shininess,"string"==typeof s.values.ambient?this._loadTexture(e,s.values.ambient,r,"ambientTexture",n):r.ambientColor=Ah.FromArray(s.values.ambient||[0,0,0]),"string"==typeof s.values.diffuse?this._loadTexture(e,s.values.diffuse,r,"diffuseTexture",n):r.diffuseColor=Ah.FromArray(s.values.diffuse||[0,0,0]),"string"==typeof s.values.emission?this._loadTexture(e,s.values.emission,r,"emissiveTexture",n):r.emissiveColor=Ah.FromArray(s.values.emission||[0,0,0]),"string"==typeof s.values.specular?this._loadTexture(e,s.values.specular,r,"specularTexture",n):r.specularColor=Ah.FromArray(s.values.specular||[0,0,0]),!0}});var JE=class{constructor(){this.promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}get resolve(){return this._resolve}get reject(){return this._reject}},QE=class{serialize(){const e={};return e.animation=this.animation.serialize(),e.targetId=this.target.id,e}getClassName(){return"TargetedAnimation"}},ZE=class e{set playOrder(e){if(this._playOrder!==e&&(this._playOrder=e,this._animatables.length>0)){for(let e=0;e<this._animatables.length;e++)this._animatables[e].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}_processLoop(e,t,i){e.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(t),this._animationLoopFlags[i]||(this._animationLoopFlags[i]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}restart(){if(!this._isStarted)return this;for(let e=0;e<this._animatables.length;e++){this._animatables[e].restart()}return this.syncWithMask(),this.onAnimationGroupPlayObservable.notifyObservers(this),this._isPaused=!1,this}get isStarted(){return this._isStarted}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let e=0;e<this._animatables.length;e++){this._animatables[e].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this}set from(e){if(this._from!==e){this._from=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].fromFrame=this._from}}}get animatables(){return this._animatables}goToFrame(e){if(!this._isStarted)return this;for(let t=0;t<this._animatables.length;t++){this._animatables[t].goToFrame(e)}return this}normalize(e=null,t=null){null==e&&(e=this._from),null==t&&(t=this._to);for(let i=0;i<this._targetedAnimations.length;i++){const n=this._targetedAnimations[i].animation.getKeys(),a=n[0],s=n[n.length-1];if(a.frame>e){const t={frame:e,value:a.value,inTangent:a.inTangent,outTangent:a.outTangent,interpolation:a.interpolation};n.splice(0,0,t)}if(s.frame<t){const e={frame:t,value:s.value,inTangent:s.inTangent,outTangent:s.outTangent,interpolation:s.interpolation};n.push(e)}}return this._from=e,this._to=t,this}get weight(){return this._weight}get isAdditive(){return this._isAdditive}set loopAnimation(e){if(this._loopAnimation!==e){this._loopAnimation=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].loopAnimation=this._loopAnimation}}}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let e=0;e<this._animatables.length;++e){const t=this._animatables[e];this.mask.retainsTarget(t.target.name)||(t.stop(),this._animatables.splice(e,1),--e)}for(let e=0;e<this._targetedAnimations.length;e++){const t=this._targetedAnimations[e];this.mask.retainsTarget(t.target.name)||(this._targetedAnimations.splice(e,1),--e)}}}stop(e=!1){if(!this._isStarted)return this;const t=this._animatables.slice();for(let i=0;i<t.length;i++)t[i].stop(void 0,void 0,!0,e);let i=0;for(let t=0;t<this._scene._activeAnimatables.length;t++){const n=this._scene._activeAnimatables[t];n._runtimeAnimations.length>0?this._scene._activeAnimatables[i++]=n:e&&this._checkAnimationGroupEnded(n,e)}return this._scene._activeAnimatables.length=i,this._isStarted=!1,this}_checkAnimationGroupEnded(e,t=!1){const i=this._animatables.indexOf(e);i>-1&&this._animatables.splice(i,1),0===this._animatables.length&&(this._isStarted=!1,t||this.onAnimationGroupEndObservable.notifyObservers(this))}get blendingSpeed(){return this._blendingSpeed}removeTargetedAnimation(e){for(let t=this._targetedAnimations.length-1;t>-1;t--){this._targetedAnimations[t].animation===e&&this._targetedAnimations.splice(t,1)}}setWeightForAllAnimatables(e){for(let t=0;t<this._animatables.length;t++){this._animatables[t].weight=e}return this}static MergeAnimationGroups(t,i=!0,n=!1,a){if(0===t.length)return null;a=a??t[0].weight;let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;if(n)for(const e of t)e.from<s&&(s=e.from),e.to>r&&(r=e.to);const o=new e(t[0].name+"_merged",t[0]._scene,a);for(const e of t){n&&e.normalize(s,r);for(const t of e.targetedAnimations)o.addTargetedAnimation(t.animation,t.target);i&&e.dispose()}return o}get enableBlending(){return this._enableBlending}static ClipFramesInPlace(t,i,n,a){return e.ClipInPlace(t,i,n,a,!0)}get speedRatio(){return this._speedRatio}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const e=this._scene.animationGroups.indexOf(this);if(e>-1&&this._scene.animationGroups.splice(e,1),this._parentContainer){const e=this._parentContainer.animationGroups.indexOf(this);e>-1&&this._parentContainer.animationGroups.splice(e,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}get to(){return this._to}get mask(){return this._mask}syncAllAnimationsWith(e){for(let t=0;t<this._animatables.length;t++){this._animatables[t].syncWith(e)}return this}static ClipKeysInPlace(t,i,n,a){return e.ClipInPlace(t,i,n,a,!1)}static Parse(t,i){const n=new e(t.name,i,t.weight,t.playOrder);for(let e=0;e<t.targetedAnimations.length;e++){const a=t.targetedAnimations[e],s=Ov.Parse(a.animation),r=a.targetId;if("influence"===a.animation.property){const e=i.getMorphTargetById(r);e&&n.addTargetedAnimation(s,e)}else{const e=i.getNodeById(r);null!=e&&n.addTargetedAnimation(s,e)}}return eh&&eh.AddTagsTo(n,t.tags),null!==t.from&&null!==t.to&&n.normalize(t.from,t.to),void 0!==t.speedRatio&&(n._speedRatio=t.speedRatio),void 0!==t.loopAnimation&&(n._loopAnimation=t.loopAnimation),void 0!==t.isAdditive&&(n._isAdditive=t.isAdditive),void 0!==t.weight&&(n._weight=t.weight),void 0!==t.playOrder&&(n._playOrder=t.playOrder),void 0!==t.enableBlending&&(n._enableBlending=t.enableBlending),void 0!==t.blendingSpeed&&(n._blendingSpeed=t.blendingSpeed),void 0!==t.metadata&&(n.metadata=t.metadata),n}getLength(e,t){e=e??this._from;return((t=t??this._to)-e)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}clone(t,i,n=!1){const a=new e(t||this.name,this._scene,this._weight,this._playOrder);a._from=this.from,a._to=this.to,a._speedRatio=this.speedRatio,a._loopAnimation=this.loopAnimation,a._isAdditive=this.isAdditive,a._enableBlending=this.enableBlending,a._blendingSpeed=this.blendingSpeed,a.metadata=this.metadata,a.mask=this.mask;for(const e of this._targetedAnimations)a.addTargetedAnimation(n?e.animation.clone():e.animation,i?i(e.target):e.target);return a}set blendingSpeed(e){if(this._blendingSpeed!==e&&(this._blendingSpeed=e,null!==e))for(let t=0;t<this._targetedAnimations.length;++t)this._targetedAnimations[t].animation.blendingSpeed=e}get from(){return this._from}getClassName(){return"AnimationGroup"}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let e=0;e<this._animatables.length;e++){this._animatables[e].reset()}return this}set weight(e){this._weight!==e&&(this._weight=e,this.setWeightForAllAnimatables(this._weight))}set to(e){if(this._to!==e){this._to=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].toFrame=this._to}}}addTargetedAnimation(e,t){const i=new QE;i.animation=e,i.target=t;const n=e.getKeys();return this._from>n[0].frame&&(this._from=n[0].frame),this._to<n[n.length-1].frame&&(this._to=n[n.length-1].frame),null!==this._enableBlending&&(e.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(e.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(i),this._shouldStart=!0,i}static ClipInPlace(e,t,i,n,a=!1){let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;const o=e.targetedAnimations;for(let e=0;e<o.length;e++){const l=o[e],c=n?l.animation:l.animation.clone();a&&(c.createKeyForFrame(t),c.createKeyForFrame(i));const h=c.getKeys(),f=[];let u=Number.MAX_VALUE;for(let e=0;e<h.length;e++){const n=h[e];if(!a&&e>=t&&e<=i||a&&n.frame>=t&&n.frame<=i){const e={frame:n.frame,value:n.value.clone?n.value.clone():n.value,inTangent:n.inTangent,outTangent:n.outTangent,interpolation:n.interpolation,lockedTangent:n.lockedTangent};u===Number.MAX_VALUE&&(u=e.frame),e.frame-=u,f.push(e)}}0!==f.length?(s>f[0].frame&&(s=f[0].frame),r<f[f.length-1].frame&&(r=f[f.length-1].frame),c.setKeys(f,!0),l.animation=c):(o.splice(e,1),e--)}return e._from=s,e._to=r,e}constructor(e,t=null,i=-1,n=0){this.name=e,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new Ih,this.onAnimationLoopObservable=new Ih,this.onAnimationGroupLoopObservable=new Ih,this.onAnimationGroupEndObservable=new Ih,this.onAnimationGroupPauseObservable=new Ih,this.onAnimationGroupPlayObservable=new Ih,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=t||xh.LastCreatedScene,this._weight=i,this._playOrder=n,this.xt=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}static MakeAnimationAdditive(e,t,i,n=!1,a){let s;s="object"==typeof t?t:{referenceFrame:t,range:i,cloneOriginalAnimationGroup:n,clonedAnimationName:a};let r=e;s.cloneOriginalAnimationGroup&&(r=e.clone(s.clonedAnimationGroupName||r.name));const o=r.targetedAnimations;for(let e=0;e<o.length;e++){const t=o[e];t.animation=Ov.MakeAnimationAdditive(t.animation,s)}if(r.isAdditive=!0,s.clipKeys){let e=Number.MAX_VALUE,t=-Number.MAX_VALUE;const i=r.targetedAnimations;for(let n=0;n<i.length;n++){const a=i[n].animation.getKeys();e>a[0].frame&&(e=a[0].frame),t<a[a.length-1].frame&&(t=a[a.length-1].frame)}r._from=e,r._to=t}return r}syncWithMask(e=!1){if(this.mask||e){this._numActiveAnimatables=0;for(let e=0;e<this._animatables.length;++e){const t=this._animatables[e];!this.mask||this.mask.disabled||this.mask.retainsTarget(t.target.name)?(this._numActiveAnimatables++,t.paused&&t.restart()):t.paused||t.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}get loopAnimation(){return this._loopAnimation}get targetedAnimations(){return this._targetedAnimations}static ClipFrames(t,i,n,a,s){const r=t.clone(a||t.name);return e.ClipFramesInPlace(r,i,n,s)}get playOrder(){return this._playOrder}getCurrentFrame(){return this.animatables[0]?.masterFrame||0}get children(){return this._targetedAnimations}serialize(){const e={};e.name=this.name,e.from=this.from,e.to=this.to,e.speedRatio=this.speedRatio,e.loopAnimation=this.loopAnimation,e.isAdditive=this.isAdditive,e.weight=this.weight,e.playOrder=this.playOrder,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,e.targetedAnimations=[];for(let t=0;t<this.targetedAnimations.length;t++){const i=this.targetedAnimations[t];e.targetedAnimations[t]=i.serialize()}return eh&&eh.HasTags(this)&&(e.tags=eh.GetTags(this)),this.metadata&&(e.metadata=this.metadata),e}start(e=!1,t=1,i,n,a){if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=e,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let s=0;s<this._targetedAnimations.length;s++){const r=this._targetedAnimations[s],o=this._scene.beginDirectAnimation(r.target,[r.animation],void 0!==i?i:this._from,void 0!==n?n:this._to,e,t,void 0,void 0,void 0!==a?a:this._isAdditive);o.weight=this._weight,o.playOrder=this._playOrder,o.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(r),this._checkAnimationGroupEnded(o)},this._processLoop(o,r,s),this._animatables.push(o)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=t,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}set enableBlending(e){if(this._enableBlending!==e&&(this._enableBlending=e,null!==e))for(let t=0;t<this._targetedAnimations.length;++t)this._targetedAnimations[t].animation.enableBlending=e}play(e){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==e&&(this.loopAnimation=e),this.restart()):(this.stop(),this.start(e,this._speedRatio)),this}get isPlaying(){return this._isStarted&&!this._isPaused}set speedRatio(e){if(this._speedRatio!==e){this._speedRatio=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].speedRatio=this._speedRatio}}}set isAdditive(e){if(this._isAdditive!==e){this._isAdditive=e;for(let e=0;e<this._animatables.length;e++){this._animatables[e].isAdditive=this._isAdditive}}}set mask(e){this._mask!==e&&(this._mask=e,this.syncWithMask(!0))}static ClipKeys(t,i,n,a,s){const r=t.clone(a||t.name);return e.ClipKeysInPlace(r,i,n,s)}toString(e){let t="Name: "+this.name;return t+=", type: "+this.getClassName(),e&&(t+=", from: "+this._from,t+=", to: "+this._to,t+=", isStarted: "+this._isStarted,t+=", speedRatio: "+this._speedRatio,t+=", targetedAnimations length: "+this._targetedAnimations.length,t+=", animatables length: "+this._animatables),t}},eA=class{static EncodeTextureToRGBD(e,t,i=0){return function(e,t,i,n,a,s,r,o){const l=t.getEngine();return t.isReady=!1,a=a??t.samplingMode,n=n??t.type,s=s??t.format,r=r??t.width,o=o??t.height,-1===n&&(n=0),new Promise((c=>{const h=new Ip("postprocess",e,null,null,1,null,a,l,!1,void 0,n,void 0,null,!1,s);h.externalTextureSamplerBinding=!0;const f=l.createRenderTargetTexture({width:r,height:o},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:a,type:n,format:s});h.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{h.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},i.postProcessManager.directRender([h],f,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(t),h&&h.dispose(),f._swapAndDie(t),t.type=n,t.format=5,t.isReady=!0,c(t)}))}))}))}("rgbdEncode",e,t,i,1,5)}static ExpandRGBDTexture(e){const t=e._texture;if(!t||!e.isRGBD)return;const i=t.getEngine(),n=i.getCaps(),a=t.isReady;let s=!1;n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?(s=!0,t.type=2):n.textureFloatRender&&n.textureFloatLinearFiltering&&(s=!0,t.type=1),s&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);const r=async()=>{const n=i.isWebGPU,a=n?1:0;t.isReady=!1,this._ShaderImported||(this._ShaderImported=!0,n?await Promise.all([Promise.resolve().then((()=>(to(),Jr))),Promise.resolve().then((()=>(ro(),io)))]):await Promise.all([Promise.resolve().then((()=>(fo(),oo))),Promise.resolve().then((()=>(vo(),uo)))]));const s=new Ip("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,t.type,void 0,null,!1,void 0,a);s.externalTextureSamplerBinding=!0;const r=i.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});s.onEffectCreatedObservable.addOnce((n=>{n.executeWhenCompiled((()=>{s.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([s],r,!0),i.restoreDefaultFramebuffer(),i._releaseTexture(t),s&&s.dispose(),r._swapAndDie(t),t.isReady=!0}))}))};s&&(a?r():e.onLoadObservable.addOnce(r))}};eA._ShaderImported=!1;var tA=0,iA=e=>{if(!e.environmentBRDFTexture){const t=e.useDelayedTextureLoading;e.useDelayedTextureLoading=!1;const i=e._blockEntityCollection;e._blockEntityCollection=!1;const n=yp.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+tA++,e,!0,!1,yp.BILINEAR_SAMPLINGMODE);e._blockEntityCollection=i;const a=e.getEngine().getLoadedTexturesCache(),s=a.indexOf(n.getInternalTexture());-1!==s&&a.splice(s,1),n.isRGBD=!0,n.wrapU=yp.CLAMP_ADDRESSMODE,n.wrapV=yp.CLAMP_ADDRESSMODE,e.environmentBRDFTexture=n,e.useDelayedTextureLoading=t,eA.ExpandRGBDTexture(n);const r=e.getEngine().onContextRestoredObservable.add((()=>{n.isRGBD=!0;const t=e.onBeforeRenderObservable.add((()=>{n.isReady()&&(e.onBeforeRenderObservable.remove(t),eA.ExpandRGBDTexture(n))}))}));e.onDisposeObservable.add((()=>{e.getEngine().onContextRestoredObservable.remove(r)}))}return e.environmentBRDFTexture},nA=class extends Ym{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}},aA=class e extends Ig{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}prepareDefines(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}constructor(t,i=!0){super(t,"PBRBRDF",90,new nA,i),this._useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=t._dirtyCallbacks[16],this._enable(!0)}getClassName(){return"PBRBRDFConfiguration"}};aA.DEFAULT_USE_ENERGY_CONSERVATION=!0,aA.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,aA.DEFAULT_USE_SPHERICAL_HARMONICS=!0,aA.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,Lc([Hc(),Uc("_markAllSubMeshesAsMiscDirty")],aA.prototype,"useEnergyConservation",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsMiscDirty")],aA.prototype,"useSmithVisibilityHeightCorrelated",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsMiscDirty")],aA.prototype,"useSphericalHarmonics",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsMiscDirty")],aA.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),gp.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(gp.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=og.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0});var sA=class extends Ym{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}},rA=class e extends Ig{getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}isReadyForSubMesh(e,t,i){if(!this._isEnabled)return!0;const n=this._material._disableBumpMap;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&Cg.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&Cg.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(i.getCaps().standardDerivatives&&this._bumpTexture&&Cg.ClearCoatBumpTextureEnabled&&!n&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&Cg.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(t,i){this._isEnabled?(t.CLEARCOAT=!0,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,t._areTexturesDirty&&i.texturesEnabled&&(this._texture&&Cg.ClearCoatTextureEnabled?em(this._texture,t,"CLEARCOAT_TEXTURE"):t.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&Cg.ClearCoatTextureEnabled?em(this._textureRoughness,t,"CLEARCOAT_TEXTURE_ROUGHNESS"):t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&Cg.ClearCoatBumpTextureEnabled?em(this._bumpTexture,t,"CLEARCOAT_BUMP"):t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===e._DefaultIndexOfRefraction,this._isTintEnabled?(t.CLEARCOAT_TINT=!0,this._tintTexture&&Cg.ClearCoatTintTextureEnabled?(em(this._tintTexture,t,"CLEARCOAT_TINT_TEXTURE"),t.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):t.CLEARCOAT_TINT_TEXTURE=!1):(t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1))):(t.CLEARCOAT=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.CLEARCOAT_DEFAULTIOR=!1,t.CLEARCOAT_TEXTUREDIRECTUV=0,t.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,t.CLEARCOAT_BUMPDIRECTUV=0,t.CLEARCOAT_REMAP_F0=!1,t.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,t.CLEARCOAT_TINT_GAMMATEXTURE=!1)}constructor(t,i=!0){super(t,"PBRClearCoat",100,new sA,i),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=e._DefaultIndexOfRefraction,this.indexOfRefraction=e._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=Ah.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1]}addFallbacks(e,t,i){return e.CLEARCOAT_BUMP&&t.addFallback(i++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&t.addFallback(i++,"CLEARCOAT_TINT"),e.CLEARCOAT&&t.addFallback(i++,"CLEARCOAT"),i}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose(),this._bumpTexture?.dispose(),this._tintTexture?.dispose())}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}hasTexture(e){return this._texture===e||(this._textureRoughness===e||(this._bumpTexture===e||this._tintTexture===e))}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)}getSamplers(e){e.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getClassName(){return"PBRClearCoatConfiguration"}bindForSubMesh(e,t,i,n){if(!this._isEnabled)return;const a=n.materialDefines,s=this._material.isFrozen,r=this._material._disableBumpMap,o=this._material._invertNormalMapX,l=this._material._invertNormalMapY;if(!e.useUbo||!s||!e.isSync){(this._texture||this._textureRoughness)&&Cg.ClearCoatTextureEnabled&&(e.updateFloat4("vClearCoatInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&tm(this._texture,e,"clearCoat"),this._textureRoughness&&!a.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&tm(this._textureRoughness,e,"clearCoatRoughness")),this._bumpTexture&&i.getCaps().standardDerivatives&&Cg.ClearCoatTextureEnabled&&!r&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),tm(this._bumpTexture,e,"clearCoatBump"),t._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",o?1:-1,l?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",o?-1:1,l?-1:1)),this._tintTexture&&Cg.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),tm(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);const n=1-this._indexOfRefraction,s=1+this._indexOfRefraction,c=Math.pow(-n/s,2),h=1/this._indexOfRefraction;e.updateFloat4("vClearCoatRefractionParams",c,h,n,s),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&Cg.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!a.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&Cg.ClearCoatTextureEnabled&&e.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&i.getCaps().standardDerivatives&&Cg.ClearCoatBumpTextureEnabled&&!r&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&Cg.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))}};rA._DefaultIndexOfRefraction=1.5,Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"isEnabled",void 0),Lc([Hc()],rA.prototype,"intensity",void 0),Lc([Hc()],rA.prototype,"roughness",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"indexOfRefraction",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"texture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"useRoughnessFromMainTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"textureRoughness",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"remapF0OnInterfaceChange",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"bumpTexture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"isTintEnabled",void 0),Lc([Wc()],rA.prototype,"tintColor",void 0),Lc([Hc()],rA.prototype,"tintColorAtDistance",void 0),Lc([Hc()],rA.prototype,"tintThickness",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],rA.prototype,"tintTexture",void 0);var oA=class extends Ym{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}},lA=class e extends Ig{hasTexture(e){return this._texture===e||this._thicknessTexture===e}getSamplers(e){e.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}getClassName(){return"PBRIridescenceConfiguration"}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||((this._texture||this._thicknessTexture)&&Cg.IridescenceTextureEnabled&&(e.updateFloat4("vIridescenceInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._thicknessTexture?.coordinatesIndex??0,this._thicknessTexture?.level??0),this._texture&&tm(this._texture,e,"iridescence"),this._thicknessTexture&&tm(this._thicknessTexture,e,"iridescenceThickness")),e.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),t.texturesEnabled&&(this._texture&&Cg.IridescenceTextureEnabled&&e.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&Cg.IridescenceTextureEnabled&&e.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}dispose(e){e&&(this._texture?.dispose(),this._thicknessTexture?.dispose())}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isReadyForSubMesh(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&Cg.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&Cg.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}addFallbacks(e,t,i){return e.IRIDESCENCE&&t.addFallback(i++,"IRIDESCENCE"),i}getActiveTextures(e){this._texture&&e.push(this._texture),this._thicknessTexture&&e.push(this._thicknessTexture)}isCompatible(){return!0}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture)}constructor(t,i=!0){super(t,"PBRIridescence",110,new oA,i),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.minimumThickness=e._DefaultMinimumThickness,this.maximumThickness=e._DefaultMaximumThickness,this.indexOfRefraction=e._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1]}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.IRIDESCENCE=!0,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&Cg.IridescenceTextureEnabled?em(this._texture,e,"IRIDESCENCE_TEXTURE"):e.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&Cg.IridescenceTextureEnabled?em(this._thicknessTexture,e,"IRIDESCENCE_THICKNESS_TEXTURE"):e.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(e.IRIDESCENCE=!1,e.IRIDESCENCE_TEXTURE=!1,e.IRIDESCENCE_THICKNESS_TEXTURE=!1,e.IRIDESCENCE_TEXTUREDIRECTUV=0,e.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}};lA._DefaultMinimumThickness=100,lA._DefaultMaximumThickness=400,lA._DefaultIndexOfRefraction=1.3,Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],lA.prototype,"isEnabled",void 0),Lc([Hc()],lA.prototype,"intensity",void 0),Lc([Hc()],lA.prototype,"minimumThickness",void 0),Lc([Hc()],lA.prototype,"maximumThickness",void 0),Lc([Hc()],lA.prototype,"indexOfRefraction",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],lA.prototype,"texture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],lA.prototype,"thicknessTexture",void 0);var cA=class extends Ym{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}},hA=class extends Ig{parse(e,t,i){super.parse(e,t,i),void 0===e.legacy&&(this.legacy=!0)}dispose(e){e&&this._texture&&this._texture.dispose()}isReadyForSubMesh(e,t){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&Cg.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;e.useUbo&&i&&e.isSync||(this._texture&&Cg.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),tm(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),t.texturesEnabled&&this._texture&&Cg.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)}addFallbacks(e,t,i){return e.ANISOTROPIC&&t.addFallback(i++,"ANISOTROPIC"),i}constructor(e,t=!0){super(e,"PBRAnisotropic",110,new cA,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new Ph(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16]}get angle(){return Math.atan2(this.direction.y,this.direction.x)}hasTexture(e){return this._texture===e}getSamplers(e){e.push("anisotropySampler")}prepareDefinesBeforeAttributes(e,t,i){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!i.isVerticesDataPresent($h.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&Cg.AnisotropicTextureEnabled?em(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1),e._areMiscDirty&&(e.ANISOTROPIC_LEGACY=this._legacy)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.ANISOTROPIC_LEGACY=!1)}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}set angle(e){this.direction.x=Math.cos(e),this.direction.y=Math.sin(e)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}getClassName(){return"PBRAnisotropicConfiguration"}getActiveTextures(e){this._texture&&e.push(this._texture)}};Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],hA.prototype,"isEnabled",void 0),Lc([Hc()],hA.prototype,"intensity",void 0),Lc([Xc()],hA.prototype,"direction",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],hA.prototype,"texture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsMiscDirty")],hA.prototype,"legacy",void 0);var fA=class extends Ym{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}},uA=class extends Ig{hasTexture(e){return this._texture===e||this._textureRoughness===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness)}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}constructor(e,t=!0){super(e,"Sheen",120,new fA,t),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=Ah.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&Cg.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&Cg.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}bindForSubMesh(e,t,i,n){if(!this._isEnabled)return;const a=n.materialDefines,s=this._material.isFrozen;e.useUbo&&s&&e.isSync||((this._texture||this._textureRoughness)&&Cg.SheenTextureEnabled&&(e.updateFloat4("vSheenInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&tm(this._texture,e,"sheen"),this._textureRoughness&&!a.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&tm(this._textureRoughness,e,"sheenRoughness")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&e.updateFloat("vSheenRoughness",this._roughness)),t.texturesEnabled&&(this._texture&&Cg.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture),this._textureRoughness&&!a.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&Cg.SheenTextureEnabled&&e.setTexture("sheenRoughnessSampler",this._textureRoughness))}addFallbacks(e,t,i){return e.SHEEN&&t.addFallback(i++,"SHEEN"),i}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose())}isCompatible(){return!0}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness)}prepareDefinesBeforeAttributes(e,t){this._isEnabled?(e.SHEEN=!0,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e.SHEEN_ROUGHNESS=null!==this._roughness,e.SHEEN_ALBEDOSCALING=this._albedoScaling,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&Cg.SheenTextureEnabled?(em(this._texture,e,"SHEEN_TEXTURE"),e.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):e.SHEEN_TEXTURE=!1,this._textureRoughness&&Cg.SheenTextureEnabled?em(this._textureRoughness,e,"SHEEN_TEXTURE_ROUGHNESS"):e.SHEEN_TEXTURE_ROUGHNESS=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_GAMMATEXTURE=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}getSamplers(e){e.push("sheenSampler","sheenRoughnessSampler")}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}getClassName(){return"PBRSheenConfiguration"}};Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],uA.prototype,"isEnabled",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],uA.prototype,"linkSheenWithAlbedo",void 0),Lc([Hc()],uA.prototype,"intensity",void 0),Lc([Wc()],uA.prototype,"color",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],uA.prototype,"texture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],uA.prototype,"useRoughnessFromMainTexture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],uA.prototype,"roughness",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],uA.prototype,"textureRoughness",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],uA.prototype,"albedoScaling",void 0);var dA=class extends Ym{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}},mA=class extends Ig{hasTexture(e){return this._thicknessTexture===e||(this._refractionTexture===e||(this._refractionIntensityTexture===e||(this._translucencyIntensityTexture===e||this._translucencyColorTexture===e)))}fillRenderTargetTextures(e){Cg.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)}bindForSubMesh(e,t,i,n){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const a=n.materialDefines,s=this._material.isFrozen,r=this._material.realTimeFiltering,o=a.LODBASEDMICROSFURACE,l=this._getRefractionTexture(t);if(!e.useUbo||!s||!e.isSync){if(this._thicknessTexture&&Cg.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),tm(this._thicknessTexture,e,"thickness")),this._refractionIntensityTexture&&Cg.RefractionIntensityTextureEnabled&&a.SS_REFRACTIONINTENSITY_TEXTURE&&(e.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),tm(this._refractionIntensityTexture,e,"refractionIntensity")),this._translucencyColorTexture&&Cg.TranslucencyColorTextureEnabled&&a.SS_TRANSLUCENCYCOLOR_TEXTURE&&(e.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),tm(this._translucencyColorTexture,e,"translucencyColor")),this._translucencyIntensityTexture&&Cg.TranslucencyIntensityTextureEnabled&&a.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(e.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),tm(this._translucencyIntensityTexture,e,"translucencyIntensity")),l&&Cg.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",l.getRefractionTextureMatrix());let t=1;l.isCube||l.depth&&(t=l.depth);const i=l.getSize().width,n=this.volumeIndexOfRefraction;if(e.updateFloat4("vRefractionInfos",l.level,1/n,t,this._invertRefractionY?-1:1),e.updateFloat4("vRefractionMicrosurfaceInfos",i,l.lodGenerationScale,l.lodGenerationOffset,1/this.indexOfRefraction),r&&e.updateFloat2("vRefractionFilteringInfo",i,vh.Log2(i)),l.boundingBoxSize){const t=l;e.updateVector3("vRefractionPosition",t.boundingBoxPosition),e.updateVector3("vRefractionSize",t.boundingBoxSize)}}this._isScatteringEnabled&&e.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),e.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),e.updateFloat("dispersion",this.dispersion)}t.texturesEnabled&&(this._thicknessTexture&&Cg.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&Cg.RefractionIntensityTextureEnabled&&a.SS_REFRACTIONINTENSITY_TEXTURE&&e.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&Cg.TranslucencyIntensityTextureEnabled&&a.SS_TRANSLUCENCYINTENSITY_TEXTURE&&e.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&Cg.TranslucencyColorTextureEnabled&&a.SS_TRANSLUCENCYCOLOR_TEXTURE&&e.setTexture("translucencyColorSampler",this._translucencyColorTexture),l&&Cg.RefractionTextureEnabled&&(o?e.setTexture("refractionSampler",l):(e.setTexture("refractionSampler",l._lodTextureMid||l),e.setTexture("refractionSamplerLow",l._lodTextureLow||l),e.setTexture("refractionSamplerHigh",l._lodTextureHigh||l))))}_getRefractionTexture(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null}getActiveTextures(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture),this._translucencyColorTexture&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&e.push(this._translucencyIntensityTexture)}get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}prepareDefinesBeforeAttributes(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return e.SUBSURFACE=!1,e.SS_DISPERSION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_HAS_THICKNESS=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(e.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(e._areTexturesDirty){if(e.SUBSURFACE=!0,e.SS_DISPERSION=this._isDispersionEnabled,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_SCATTERING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_HAS_THICKNESS=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,e._areTexturesDirty&&t.texturesEnabled&&(this._thicknessTexture&&Cg.ThicknessTextureEnabled&&em(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&Cg.RefractionIntensityTextureEnabled&&em(this._refractionIntensityTexture,e,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&Cg.TranslucencyIntensityTextureEnabled&&em(this._translucencyIntensityTexture,e,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&Cg.TranslucencyColorTextureEnabled&&em(this._translucencyColorTexture,e,"SS_TRANSLUCENCYCOLOR_TEXTURE")),e.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!=0,e.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&t.texturesEnabled){const i=this._getRefractionTexture(t);i&&Cg.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=i.isCube,e.SS_GAMMAREFRACTION=i.gammaSpace,e.SS_RGBDREFRACTION=i.isRGBD,e.SS_LINEARSPECULARREFRACTION=i.linearSpecularLOD,e.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&i.isCube?!i.invertZ:i.invertZ,e.SS_LODINREFRACTIONALPHA=i.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,e.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=i.isCube&&i.boundingBoxSize,e.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(e.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hasRenderTargetTextures(){return!!(Cg.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}isCompatible(){return!0}addFallbacks(e,t,i){return e.SS_SCATTERING&&t.addFallback(i++,"SS_SCATTERING"),e.SS_TRANSLUCENCY&&t.addFallback(i++,"SS_TRANSLUCENCY"),i}getSamplers(e){e.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}hardBindForSubMesh(e,t,i,n){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)e.updateFloat2("vThicknessParam",0,0);else{n.getRenderingMesh().getWorldMatrix().decompose(kh.Vector3[0]);const t=Math.max(Math.abs(kh.Vector3[0].x),Math.abs(kh.Vector3[0].y),Math.abs(kh.Vector3[0].z));e.updateFloat2("vThicknessParam",this.minimumThickness*t,(this.maximumThickness-this.minimumThickness)*t)}}constructor(e,t=!0){super(e,"PBRSubSurface",130,new dA,t),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=Ah.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=Ah.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=e.getScene(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=e._dirtyCallbacks[32]}getAnimatables(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&e.push(this._translucencyIntensityTexture)}isReadyForSubMesh(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&Cg.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&Cg.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&Cg.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const e=this._getRefractionTexture(t);if(e&&Cg.RefractionTextureEnabled&&!e.isReadyOrNotBlocking())return!1}return!0}set volumeIndexOfRefraction(e){this._volumeIndexOfRefraction=e>=1?e:-1}set scatteringDiffusionProfile(e){this._scene.enableSubSurfaceForPrePass()&&e&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(e))}getClassName(){return"PBRSubSurfaceConfiguration"}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}dispose(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}};Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"isRefractionEnabled",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"isTranslucencyEnabled",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"isDispersionEnabled",void 0),Lc([Hc(),Uc("_markScenePrePassDirty")],mA.prototype,"isScatteringEnabled",void 0),Lc([Hc()],mA.prototype,"_scatteringDiffusionProfileIndex",void 0),Lc([Hc()],mA.prototype,"refractionIntensity",void 0),Lc([Hc()],mA.prototype,"translucencyIntensity",void 0),Lc([Hc()],mA.prototype,"useAlbedoToTintRefraction",void 0),Lc([Hc()],mA.prototype,"useAlbedoToTintTranslucency",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"thicknessTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"refractionTexture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"indexOfRefraction",void 0),Lc([Hc()],mA.prototype,"_volumeIndexOfRefraction",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"volumeIndexOfRefraction",null),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"invertRefractionY",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"linkRefractionWithTransparency",void 0),Lc([Hc()],mA.prototype,"minimumThickness",void 0),Lc([Hc()],mA.prototype,"maximumThickness",void 0),Lc([Hc()],mA.prototype,"useThicknessAsDepth",void 0),Lc([Wc()],mA.prototype,"tintColor",void 0),Lc([Hc()],mA.prototype,"tintColorAtDistance",void 0),Lc([Hc()],mA.prototype,"dispersion",void 0),Lc([Wc()],mA.prototype,"diffusionDistance",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"useMaskFromThicknessTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"refractionIntensityTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"translucencyIntensityTexture",void 0),Lc([Wc()],mA.prototype,"translucencyColor",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"translucencyColorTexture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],mA.prototype,"useGltfStyleTextures",void 0);var pA={effect:null,subMesh:null},_A=class extends Ym{reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}constructor(e){super(e),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}},vA=class e extends Gm{buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vAmbientColor",3),e.addUniform("vDebugMode",2),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),e.addUniform("vReflectanceInfos",2),e.addUniform("reflectanceMatrix",16),e.addUniform("vSphericalL00",3),e.addUniform("vSphericalL1_1",3),e.addUniform("vSphericalL10",3),e.addUniform("vSphericalL11",3),e.addUniform("vSphericalL2_2",3),e.addUniform("vSphericalL2_1",3),e.addUniform("vSphericalL20",3),e.addUniform("vSphericalL21",3),e.addUniform("vSphericalL22",3),e.addUniform("vSphericalX",3),e.addUniform("vSphericalY",3),e.addUniform("vSphericalZ",3),e.addUniform("vSphericalXX_ZZ",3),e.addUniform("vSphericalYY_ZZ",3),e.addUniform("vSphericalZZ",3),e.addUniform("vSphericalXY",3),e.addUniform("vSphericalYZ",3),e.addUniform("vSphericalZX",3),super.buildUniformLayout()}getActiveTextures(){const e=super.getActiveTextures();return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),e}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}dispose(e,t){this._breakShaderLoadedCheck=!0,t&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._albedoTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._metallicTexture?.dispose(),this._reflectivityTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._metallicReflectanceTexture?.dispose(),this._reflectanceTexture?.dispose(),this._microSurfaceTexture?.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}get _disableAlphaBlending(){return this._transparencyMode===e.PBRMATERIAL_OPAQUE||this._transparencyMode===e.PBRMATERIAL_ALPHATEST||this.subSurface?.disableAlphaBlending}isReadyForSubMesh(e,t,i){if(!this._shadersLoaded)return!1;this._uniformBufferLayoutBuilt||this.buildUniformLayout();const n=t._drawWrapper;if(n.effect&&this.isFrozen&&n._wasPreviouslyReady&&n._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new _A(this._eventInfo.defineNames));const a=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const s=this.getScene(),r=s.getEngine();if(a._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,s.texturesEnabled)){if(this._albedoTexture&&Cg.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&Cg.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&Cg.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const e=this._getReflectionTexture();if(e&&Cg.ReflectionTextureEnabled){if(!e.isReadyOrNotBlocking())return!1;if(e.irradianceTexture){if(!e.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!e.sphericalPolynomial&&e.getInternalTexture()?._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&Cg.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&Cg.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(Cg.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(r.getCaps().standardDerivatives&&this._bumpTexture&&Cg.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&Cg.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(a._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;r.getCaps().standardDerivatives||e.isVerticesDataPresent($h.NormalKind)||(e.createNormals(!0),jh.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));const o=t.effect,l=a._areLightsDisposed;let c=this._prepareEffect(e,a,this.onCompiled,this.onError,i,null,t.getRenderingMesh().hasThinInstances),h=!1;if(c)if(this._onEffectCreatedObservable&&(pA.effect=c,pA.subMesh=t,this._onEffectCreatedObservable.notifyObservers(pA)),this.allowShaderHotSwapping&&o&&!c.isReady()){if(c=o,a.markAsUnprocessed(),h=this.isFrozen,l)return a._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),t.setEffect(c,a,this._materialContext);return!(!t.effect||!t.effect.isReady())&&(a._renderId=s.getRenderId(),n._wasPreviouslyReady=!h,n._wasPreviouslyUsingInstances=!!i,this._checkScenePerformancePriority(),!0)}getAnimatables(){const e=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&e.push(this._microSurfaceTexture),e}hasTexture(e){return!!super.hasTexture(e)||(this._albedoTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._reflectivityTexture===e||(this._metallicTexture===e||(this._metallicReflectanceTexture===e||(this._reflectanceTexture===e||(this._microSurfaceTexture===e||(this._bumpTexture===e||this._lightmapTexture===e)))))))))))}constructor(t,i,n=!1){super(t,i),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new Oh(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=Ah.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new Ah(0,0,0),this._albedoColor=new Ah(1,1,1),this._reflectivityColor=new Ah(1,1,1),this._reflectionColor=new Ah(1,1,1),this._emissiveColor=new Ah(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=e.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new rd(16),this._globalAmbientColor=new Ah(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this._initShaderSourceAsync(n),this.brdf=new aA(this),this.clearCoat=new rA(this),this.iridescence=new lA(this),this.anisotropy=new hA(this),this.sheen=new uA(this),this.subSurface=new mA(this),this.detailMap=new bg(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),Cg.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=iA(this.getScene()),this.prePassConfiguration=new Ag}get realTimeFiltering(){return this._realTimeFiltering}set realTimeFilteringQuality(e){this._realTimeFilteringQuality=e,this.markAsDirty(1)}setPrePassRenderer(){if(!this.subSurface?.isScatteringEnabled)return!1;const e=this.getScene().enableSubSurfaceForPrePass();return e&&(e.enabled=!0),!0}get isPrePassCapable(){return!this.disableDepthWrite}getAlphaTestTexture(){return this._albedoTexture}set realTimeFiltering(e){this._realTimeFiltering=e,this.markAsDirty(1)}getClassName(){return"PBRBaseMaterial"}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture}async _initShaderSourceAsync(t=!1){const i=this.getScene().getEngine();!i.isWebGPU||t||e.ForceGLSL?await Promise.all([Promise.resolve().then((()=>(vl(),dl))),Promise.resolve().then((()=>(ec(),Zl)))]):(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new xd(i,void 0,void 0,this.name,!0),this._shaderLanguage=1,await Promise.all([Promise.resolve().then((()=>(Ro(),yo))),Promise.resolve().then((()=>(cl(),sl)))])),this._shadersLoaded=!0}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}bindForSubMesh(e,t,i){const n=this.getScene(),a=i.materialDefines;if(!a)return;const s=i.effect;if(!s)return;this._activeEffect=s,t.getMeshUniformBuffer().bindToEffect(s,"Mesh"),t.transferToEffect(e);const r=n.getEngine();this._uniformBuffer.bindToEffect(s,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,n,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),a.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const o=this._mustRebind(n,s,i,t.visibility);nm(t,this._activeEffect,this.prePassConfiguration);let l=null;const c=this._uniformBuffer;if(o){if(this.bindViewProjection(s),l=this._getReflectionTexture(),!c.useUbo||!this.isFrozen||!c.isSync||i._drawWrapper._forceRebindOnNextCall){if(n.texturesEnabled){if(this._albedoTexture&&Cg.DiffuseTextureEnabled&&(c.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),tm(this._albedoTexture,c,"albedo")),this._ambientTexture&&Cg.AmbientTextureEnabled&&(c.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),tm(this._ambientTexture,c,"ambient")),this._opacityTexture&&Cg.OpacityTextureEnabled&&(c.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),tm(this._opacityTexture,c,"opacity")),l&&Cg.ReflectionTextureEnabled){if(c.updateMatrix("reflectionMatrix",l.getReflectionTextureMatrix()),c.updateFloat2("vReflectionInfos",l.level,0),l.boundingBoxSize){const e=l;c.updateVector3("vReflectionPosition",e.boundingBoxPosition),c.updateVector3("vReflectionSize",e.boundingBoxSize)}if(this.realTimeFiltering){const e=l.getSize().width;c.updateFloat2("vReflectionFilteringInfo",e,vh.Log2(e))}if(!a.USEIRRADIANCEMAP){const e=l.sphericalPolynomial;if(a.USESPHERICALFROMREFLECTIONMAP&&e)if(a.SPHERICAL_HARMONICS){const t=e.preScaledHarmonics;c.updateVector3("vSphericalL00",t.l00),c.updateVector3("vSphericalL1_1",t.l1_1),c.updateVector3("vSphericalL10",t.l10),c.updateVector3("vSphericalL11",t.l11),c.updateVector3("vSphericalL2_2",t.l2_2),c.updateVector3("vSphericalL2_1",t.l2_1),c.updateVector3("vSphericalL20",t.l20),c.updateVector3("vSphericalL21",t.l21),c.updateVector3("vSphericalL22",t.l22)}else c.updateFloat3("vSphericalX",e.x.x,e.x.y,e.x.z),c.updateFloat3("vSphericalY",e.y.x,e.y.y,e.y.z),c.updateFloat3("vSphericalZ",e.z.x,e.z.y,e.z.z),c.updateFloat3("vSphericalXX_ZZ",e.xx.x-e.zz.x,e.xx.y-e.zz.y,e.xx.z-e.zz.z),c.updateFloat3("vSphericalYY_ZZ",e.yy.x-e.zz.x,e.yy.y-e.zz.y,e.yy.z-e.zz.z),c.updateFloat3("vSphericalZZ",e.zz.x,e.zz.y,e.zz.z),c.updateFloat3("vSphericalXY",e.xy.x,e.xy.y,e.xy.z),c.updateFloat3("vSphericalYZ",e.yz.x,e.yz.y,e.yz.z),c.updateFloat3("vSphericalZX",e.zx.x,e.zx.y,e.zx.z)}c.updateFloat3("vReflectionMicrosurfaceInfos",l.getSize().width,l.lodGenerationScale,l.lodGenerationOffset)}this._emissiveTexture&&Cg.EmissiveTextureEnabled&&(c.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),tm(this._emissiveTexture,c,"emissive")),this._lightmapTexture&&Cg.LightmapTextureEnabled&&(c.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),tm(this._lightmapTexture,c,"lightmap")),Cg.SpecularTextureEnabled&&(this._metallicTexture?(c.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),tm(this._metallicTexture,c,"reflectivity")):this._reflectivityTexture&&(c.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),tm(this._reflectivityTexture,c,"reflectivity")),this._metallicReflectanceTexture&&(c.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),tm(this._metallicReflectanceTexture,c,"metallicReflectance")),this._reflectanceTexture&&a.REFLECTANCE&&(c.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),tm(this._reflectanceTexture,c,"reflectance")),this._microSurfaceTexture&&(c.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),tm(this._microSurfaceTexture,c,"microSurfaceSampler"))),this._bumpTexture&&r.getCaps().standardDerivatives&&Cg.BumpTextureEnabled&&!this._disableBumpMap&&(c.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),tm(this._bumpTexture,c,"bump"),n._mirroredCameraPosition?c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&c.updateFloat("pointSize",this.pointSize),a.METALLICWORKFLOW){Rh.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,Rh.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,c.updateColor4("vReflectivityColor",Rh.Color3[0],1);const e=this.subSurface?._indexOfRefraction??1.5,t=1,i=Math.pow((e-t)/(e+t),2);this._metallicReflectanceColor.scaleToRef(i*this._metallicF0Factor,Rh.Color3[0]);const n=this._metallicF0Factor;c.updateColor4("vMetallicReflectanceFactors",Rh.Color3[0],n)}else c.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);c.updateColor3("vEmissiveColor",Cg.EmissiveTextureEnabled?this._emissiveColor:Ah.BlackReadOnly),c.updateColor3("vReflectionColor",this._reflectionColor),!a.SS_REFRACTION&&this.subSurface?._linkRefractionWithTransparency?c.updateColor4("vAlbedoColor",this._albedoColor,1):c.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*n.environmentIntensity,this._lightingInfos.w=this._specularIntensity,c.updateVector4("vLightingIntensity",this._lightingInfos),n.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),c.updateColor3("vAmbientColor",this._globalAmbientColor),c.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}n.texturesEnabled&&(this._albedoTexture&&Cg.DiffuseTextureEnabled&&c.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&Cg.AmbientTextureEnabled&&c.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Cg.OpacityTextureEnabled&&c.setTexture("opacitySampler",this._opacityTexture),l&&Cg.ReflectionTextureEnabled&&(a.LODBASEDMICROSFURACE?c.setTexture("reflectionSampler",l):(c.setTexture("reflectionSampler",l._lodTextureMid||l),c.setTexture("reflectionSamplerLow",l._lodTextureLow||l),c.setTexture("reflectionSamplerHigh",l._lodTextureHigh||l)),a.USEIRRADIANCEMAP&&c.setTexture("irradianceSampler",l.irradianceTexture)),a.ENVIRONMENTBRDF&&c.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&Cg.EmissiveTextureEnabled&&c.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Cg.LightmapTextureEnabled&&c.setTexture("lightmapSampler",this._lightmapTexture),Cg.SpecularTextureEnabled&&(this._metallicTexture?c.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&c.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&c.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&a.REFLECTANCE&&c.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&c.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&r.getCaps().standardDerivatives&&Cg.BumpTextureEnabled&&!this._disableBumpMap&&c.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(s),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),Wd(this._activeEffect,this,n),this.bindEyePosition(s)}else n.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!o&&this.isFrozen||(n.lightsEnabled&&!this._disableLighting&&sm(n,t,this._activeEffect,a,this._maxSimultaneousLights),(n.fogEnabled&&t.applyFog&&n.fogMode!==dv.FOGMODE_NONE||l||this.subSurface.refractionTexture||t.receiveShadows||a.PREPASS)&&this.bindView(s),Kd(n,t,this._activeEffect,!0),a.NUM_MORPH_INFLUENCERS&&Qd(t,this._activeEffect),a.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(s,a.INSTANCES),this._imageProcessingConfiguration.bind(this._activeEffect),jd(a,this._activeEffect,n)),this._afterBind(t,this._activeEffect,i),c.update()}_prepareEffect(e,t,i=null,n=null,a=null,s=null,r){if(this._prepareDefines(e,t,a,s,r),!t.isDirty)return null;t.markAsProcessed();const o=this.getScene().getEngine(),l=new Tp;let c=0;t.USESPHERICALINVERTEX&&l.addFallback(c++,"USESPHERICALINVERTEX"),t.FOG&&l.addFallback(c,"FOG"),t.SPECULARAA&&l.addFallback(c,"SPECULARAA"),t.POINTSIZE&&l.addFallback(c,"POINTSIZE"),t.LOGARITHMICDEPTH&&l.addFallback(c,"LOGARITHMICDEPTH"),t.PARALLAX&&l.addFallback(c,"PARALLAX"),t.PARALLAX_RHS&&l.addFallback(c,"PARALLAX_RHS"),t.PARALLAXOCCLUSION&&l.addFallback(c++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&l.addFallback(c++,"ENVIRONMENTBRDF"),t.TANGENT&&l.addFallback(c++,"TANGENT"),t.BUMP&&l.addFallback(c++,"BUMP"),c=lm(t,l,this._maxSimultaneousLights,c++),t.SPECULARTERM&&l.addFallback(c++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&l.addFallback(c++,"USESPHERICALFROMREFLECTIONMAP"),t.USEIRRADIANCEMAP&&l.addFallback(c++,"USEIRRADIANCEMAP"),t.LIGHTMAP&&l.addFallback(c++,"LIGHTMAP"),t.NORMAL&&l.addFallback(c++,"NORMAL"),t.AMBIENT&&l.addFallback(c++,"AMBIENT"),t.EMISSIVE&&l.addFallback(c++,"EMISSIVE"),t.VERTEXCOLOR&&l.addFallback(c++,"VERTEXCOLOR"),t.MORPHTARGETS&&l.addFallback(c++,"MORPHTARGETS"),t.MULTIVIEW&&l.addFallback(0,"MULTIVIEW");const h=[$h.PositionKind];t.NORMAL&&h.push($h.NormalKind),t.TANGENT&&h.push($h.TangentKind);for(let e=1;e<=6;++e)t["UV"+e]&&h.push(`uv${1===e?"":e}`);t.VERTEXCOLOR&&h.push($h.ColorKind),rm(h,e,t,l),om(h,t),qd(h,e,t),im(h,0,t);let f="pbr";const u=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],d=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],m=["Material","Scene","Mesh"],p={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=l,this._eventInfo.fallbackRank=c,this._eventInfo.defines=t,this._eventInfo.uniforms=u,this._eventInfo.attributes=h,this._eventInfo.samplers=d,this._eventInfo.uniformBuffersNames=m,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=p,this._callbackPluginEventGeneric(128,this._eventInfo),Ag.AddUniforms(u),Ag.AddSamplers(d),Hd(u),I_&&(I_.PrepareUniforms(u,t),I_.PrepareSamplers(d,t)),Em({uniformsNames:u,uniformBuffersNames:m,samplers:d,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});const _={};this.customShaderNameResolve&&(f=this.customShaderNameResolve(f,u,m,d,t,h,_));const v=t.toString(),g=o.createEffect(f,{attributes:h,uniformsNames:u,uniformBuffersNames:m,samplers:d,defines:v,fallbacks:l,onCompiled:i,onError:n,indexParameters:p,processFinalCode:_.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS,shaderLanguage:this._shaderLanguage},o);return this._eventInfo.customCode=void 0,g}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}get hasRenderTargetTextures(){return!!(Cg.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}_prepareDefines(t,i,n=null,a=null,s=!1){const r=this.getScene(),o=r.getEngine();fm(r,t,i,!0,this._maxSimultaneousLights,this._disableLighting),i._needNormals=!0,_m(r,i);const l=this.needAlphaBlendingForMesh(t)&&this.getScene().useOrderIndependentTransparency;if(gm(r,i,this.canRenderToMRT&&!l),vm(r,i,l),i.METALLICWORKFLOW=this.isMetallicWorkflow(),i._areTexturesDirty){i._needUVs=!1;for(let e=1;e<=6;++e)i["MAINUV"+e]=!1;if(r.texturesEnabled){i.ALBEDODIRECTUV=0,i.AMBIENTDIRECTUV=0,i.OPACITYDIRECTUV=0,i.EMISSIVEDIRECTUV=0,i.REFLECTIVITYDIRECTUV=0,i.MICROSURFACEMAPDIRECTUV=0,i.METALLIC_REFLECTANCEDIRECTUV=0,i.REFLECTANCEDIRECTUV=0,i.BUMPDIRECTUV=0,i.LIGHTMAPDIRECTUV=0,o.getCaps().textureLOD&&(i.LODBASEDMICROSFURACE=!0),this._albedoTexture&&Cg.DiffuseTextureEnabled?(em(this._albedoTexture,i,"ALBEDO"),i.GAMMAALBEDO=this._albedoTexture.gammaSpace):i.ALBEDO=!1,this._ambientTexture&&Cg.AmbientTextureEnabled?(em(this._ambientTexture,i,"AMBIENT"),i.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):i.AMBIENT=!1,this._opacityTexture&&Cg.OpacityTextureEnabled?(em(this._opacityTexture,i,"OPACITY"),i.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):i.OPACITY=!1;const e=this._getReflectionTexture();if(e&&Cg.ReflectionTextureEnabled){switch(i.REFLECTION=!0,i.GAMMAREFLECTION=e.gammaSpace,i.RGBDREFLECTION=e.isRGBD,i.LODINREFLECTIONALPHA=e.lodLevelInAlpha,i.LINEARSPECULARREFLECTION=e.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(i.NUM_SAMPLES=""+this.realTimeFilteringQuality,o._features.needTypeSuffixInShaderConstants&&(i.NUM_SAMPLES=i.NUM_SAMPLES+"u"),i.REALTIME_FILTERING=!0):i.REALTIME_FILTERING=!1,i.INVERTCUBICMAP=e.coordinatesMode===yp.INVCUBIC_MODE,i.REFLECTIONMAP_3D=e.isCube,i.REFLECTIONMAP_OPPOSITEZ=i.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!e.invertZ:e.invertZ,i.REFLECTIONMAP_CUBIC=!1,i.REFLECTIONMAP_EXPLICIT=!1,i.REFLECTIONMAP_PLANAR=!1,i.REFLECTIONMAP_PROJECTION=!1,i.REFLECTIONMAP_SKYBOX=!1,i.REFLECTIONMAP_SPHERICAL=!1,i.REFLECTIONMAP_EQUIRECTANGULAR=!1,i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.coordinatesMode){case yp.EXPLICIT_MODE:i.REFLECTIONMAP_EXPLICIT=!0;break;case yp.PLANAR_MODE:i.REFLECTIONMAP_PLANAR=!0;break;case yp.PROJECTION_MODE:i.REFLECTIONMAP_PROJECTION=!0;break;case yp.SKYBOX_MODE:i.REFLECTIONMAP_SKYBOX=!0;break;case yp.SPHERICAL_MODE:i.REFLECTIONMAP_SPHERICAL=!0;break;case yp.EQUIRECTANGULAR_MODE:i.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case yp.FIXED_EQUIRECTANGULAR_MODE:i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case yp.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case yp.CUBIC_MODE:case yp.INVCUBIC_MODE:default:i.REFLECTIONMAP_CUBIC=!0,i.USE_LOCAL_REFLECTIONMAP_CUBIC=!!e.boundingBoxSize}e.coordinatesMode!==yp.SKYBOX_MODE&&(e.irradianceTexture?(i.USEIRRADIANCEMAP=!0,i.USESPHERICALFROMREFLECTIONMAP=!1):e.isCube&&(i.USESPHERICALFROMREFLECTIONMAP=!0,i.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||o.getCaps().maxVaryingVectors<=8?i.USESPHERICALINVERTEX=!1:i.USESPHERICALINVERTEX=!0))}else i.REFLECTION=!1,i.REFLECTIONMAP_3D=!1,i.REFLECTIONMAP_SPHERICAL=!1,i.REFLECTIONMAP_PLANAR=!1,i.REFLECTIONMAP_CUBIC=!1,i.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,i.REFLECTIONMAP_PROJECTION=!1,i.REFLECTIONMAP_SKYBOX=!1,i.REFLECTIONMAP_EXPLICIT=!1,i.REFLECTIONMAP_EQUIRECTANGULAR=!1,i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,i.INVERTCUBICMAP=!1,i.USESPHERICALFROMREFLECTIONMAP=!1,i.USEIRRADIANCEMAP=!1,i.USESPHERICALINVERTEX=!1,i.REFLECTIONMAP_OPPOSITEZ=!1,i.LODINREFLECTIONALPHA=!1,i.GAMMAREFLECTION=!1,i.RGBDREFLECTION=!1,i.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&Cg.LightmapTextureEnabled?(em(this._lightmapTexture,i,"LIGHTMAP"),i.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,i.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,i.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):i.LIGHTMAP=!1,this._emissiveTexture&&Cg.EmissiveTextureEnabled?(em(this._emissiveTexture,i,"EMISSIVE"),i.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):i.EMISSIVE=!1,Cg.SpecularTextureEnabled?(this._metallicTexture?(em(this._metallicTexture,i,"REFLECTIVITY"),i.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,i.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,i.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,i.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,i.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(em(this._reflectivityTexture,i,"REFLECTIVITY"),i.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,i.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,i.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):i.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(i.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?(em(this._metallicReflectanceTexture,i,"METALLIC_REFLECTANCE"),i.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):i.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(em(this._reflectanceTexture,i,"REFLECTANCE"),i.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):i.REFLECTANCE=!1):(i.METALLIC_REFLECTANCE=!1,i.REFLECTANCE=!1),this._microSurfaceTexture?em(this._microSurfaceTexture,i,"MICROSURFACEMAP"):i.MICROSURFACEMAP=!1):(i.REFLECTIVITY=!1,i.MICROSURFACEMAP=!1),o.getCaps().standardDerivatives&&this._bumpTexture&&Cg.BumpTextureEnabled&&!this._disableBumpMap?(em(this._bumpTexture,i,"BUMP"),this._useParallax&&this._albedoTexture&&Cg.DiffuseTextureEnabled?(i.PARALLAX=!0,i.PARALLAX_RHS=r.useRightHandedSystem,i.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):i.PARALLAX=!1,i.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(i.BUMP=!1,i.PARALLAX=!1,i.PARALLAX_RHS=!1,i.PARALLAXOCCLUSION=!1,i.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&Cg.ReflectionTextureEnabled?(i.ENVIRONMENTBRDF=!0,i.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(i.ENVIRONMENTBRDF=!1,i.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?i.ALPHAFROMALBEDO=!0:i.ALPHAFROMALBEDO=!1}i.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===e.LIGHTFALLOFF_STANDARD?(i.USEPHYSICALLIGHTFALLOFF=!1,i.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===e.LIGHTFALLOFF_GLTF?(i.USEPHYSICALLIGHTFALLOFF=!1,i.USEGLTFLIGHTFALLOFF=!0):(i.USEPHYSICALLIGHTFALLOFF=!0,i.USEGLTFLIGHTFALLOFF=!1),i.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?i.TWOSIDEDLIGHTING=!0:i.TWOSIDEDLIGHTING=!1,i.SPECULARAA=o.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(i._areTexturesDirty||i._areMiscDirty)&&(i.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1==0?".":""}`,i.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,i.ALPHABLEND=this.needAlphaBlendingForMesh(t),i.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,i.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),i._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(i),i.FORCENORMALFORWARD=this._forceNormalForward,i.RADIANCEOCCLUSION=this._useRadianceOcclusion,i.HORIZONOCCLUSION=this._useHorizonOcclusion,i._areMiscDirty&&(hm(t,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(t)||this._forceAlphaTest,i,this._applyDecalMapAfterDetailMap),i.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!t.isVerticesDataPresent($h.NormalKind),i.DEBUGMODE=this._debugMode),dm(r,o,this,i,!!n,a,s),this._eventInfo.defines=i,this._eventInfo.mesh=t,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),pm(t,i,!0,!0,!0,this._transparencyMode!==e.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(e,t,i){const n={clipPlane:!1,useInstances:!1,...i};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);const a=()=>{if(!this._breakShaderLoadedCheck)if(this._shadersLoaded){const i=new _A(this._eventInfo.defineNames),a=this._prepareEffect(e,i,void 0,void 0,n.useInstances,n.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(pA.effect=a,pA.subMesh=null,this._onEffectCreatedObservable.notifyObservers(pA)),a.isReady()?t&&t(this):a.onCompileObservable.add((()=>{t&&t(this)}))}else setTimeout(a,16)};a()}get canRenderToMRT(){return!0}needAlphaTesting(){return!!this._forceAlphaTest||!this.subSurface?.disableAlphaBlending&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===e.PBRMATERIAL_ALPHATEST))}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==e.PBRMATERIAL_OPAQUE}};vA.PBRMATERIAL_OPAQUE=Am.MATERIAL_OPAQUE,vA.PBRMATERIAL_ALPHATEST=Am.MATERIAL_ALPHATEST,vA.PBRMATERIAL_ALPHABLEND=Am.MATERIAL_ALPHABLEND,vA.PBRMATERIAL_ALPHATESTANDBLEND=Am.MATERIAL_ALPHATESTANDBLEND,vA.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,vA.LIGHTFALLOFF_PHYSICAL=0,vA.LIGHTFALLOFF_GLTF=1,vA.LIGHTFALLOFF_STANDARD=2,vA.ForceGLSL=!1,Lc([function(e){return Gc(9,e)}()],vA.prototype,"_imageProcessingConfiguration",void 0),Lc([Uc("_markAllSubMeshesAsMiscDirty")],vA.prototype,"debugMode",void 0);var gA=class e extends vA{set refractionTexture(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set invertRefractionY(e){this.subSurface.invertRefractionY=e}static Parse(t,i,n){const a=Uh.Parse((()=>new e(t.name,i)),t,i,n);return t.stencil&&a.stencil.parse(t.stencil,i,n),Am._ParsePlugins(t,a,i,n),t.clearCoat&&a.clearCoat.parse(t.clearCoat,i,n),t.anisotropy&&a.anisotropy.parse(t.anisotropy,i,n),t.brdf&&a.brdf.parse(t.brdf,i,n),t.sheen&&a.sheen.parse(t.sheen,i,n),t.subSurface&&a.subSurface.parse(t.subSurface,i,n),t.iridescence&&a.iridescence.parse(t.iridescence,i,n),a}get cameraContrast(){return this._imageProcessingConfiguration.contrast}serialize(){const e=super.serialize();return e.customType="BABYLON.PBRMaterial",e}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get useGLTFLightFalloff(){return this._lightFalloff===vA.LIGHTFALLOFF_GLTF}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set linkRefractionWithTransparency(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set useGLTFLightFalloff(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?vA.LIGHTFALLOFF_GLTF:vA.LIGHTFALLOFF_STANDARD)}get refractionTexture(){return this.subSurface.refractionTexture}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set indexOfRefraction(e){this.subSurface.indexOfRefraction=e}getClassName(){return"PBRMaterial"}get usePhysicalLightFalloff(){return this._lightFalloff===vA.LIGHTFALLOFF_PHYSICAL}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}clone(t,i=!0,n=""){const a=Uh.Clone((()=>new e(t,this.getScene())),this,{cloneTexturesOnlyOnce:i});return a.id=t,a.name=t,this.stencil.copyTo(a.stencil),this._clonePlugins(a,n),a}set usePhysicalLightFalloff(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?vA.LIGHTFALLOFF_PHYSICAL:vA.LIGHTFALLOFF_STANDARD)}get invertRefractionY(){return this.subSurface.invertRefractionY}get indexOfRefraction(){return this.subSurface.indexOfRefraction}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}constructor(t,i,n=!1){super(t,i,n),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=Ah.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new Ah(0,0,0),this.albedoColor=new Ah(1,1,1),this.reflectivityColor=new Ah(1,1,1),this.reflectionColor=new Ah(1,1,1),this.emissiveColor=new Ah(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=iA(this.getScene())}};gA.PBRMATERIAL_OPAQUE=vA.PBRMATERIAL_OPAQUE,gA.PBRMATERIAL_ALPHATEST=vA.PBRMATERIAL_ALPHATEST,gA.PBRMATERIAL_ALPHABLEND=vA.PBRMATERIAL_ALPHABLEND,gA.PBRMATERIAL_ALPHATESTANDBLEND=vA.PBRMATERIAL_ALPHATESTANDBLEND,gA.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=vA.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"directIntensity",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"emissiveIntensity",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"environmentIntensity",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"specularIntensity",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"disableBumpMap",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"albedoTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"ambientTexture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"ambientTextureStrength",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesAndMiscDirty")],gA.prototype,"opacityTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"reflectionTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"emissiveTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"reflectivityTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"metallicTexture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"metallic",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"roughness",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"metallicF0Factor",void 0),Lc([Wc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"metallicReflectanceColor",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"metallicReflectanceTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"reflectanceTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"microSurfaceTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"bumpTexture",void 0),Lc([Vc(),Uc("_markAllSubMeshesAsTexturesDirty",null)],gA.prototype,"lightmapTexture",void 0),Lc([Wc("ambient"),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"ambientColor",void 0),Lc([Wc("albedo"),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"albedoColor",void 0),Lc([Wc("reflectivity"),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"reflectivityColor",void 0),Lc([Wc("reflection"),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"reflectionColor",void 0),Lc([Wc("emissive"),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"emissiveColor",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"microSurface",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useLightmapAsShadowmap",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesAndMiscDirty")],gA.prototype,"useAlphaFromAlbedoTexture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesAndMiscDirty")],gA.prototype,"forceAlphaTest",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesAndMiscDirty")],gA.prototype,"alphaCutOff",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useSpecularOverAlpha",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useRoughnessFromMetallicTextureGreen",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useMetallnessFromMetallicTextureBlue",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useAmbientInGrayScale",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),Lc([Hc()],gA.prototype,"usePhysicalLightFalloff",null),Lc([Hc()],gA.prototype,"useGLTFLightFalloff",null),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useRadianceOverAlpha",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useObjectSpaceNormalMap",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useParallax",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useParallaxOcclusion",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"parallaxScaleBias",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsLightsDirty")],gA.prototype,"disableLighting",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"forceIrradianceInFragment",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsLightsDirty")],gA.prototype,"maxSimultaneousLights",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"invertNormalMapX",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"invertNormalMapY",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"twoSidedLighting",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useAlphaFresnel",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useLinearAlphaFresnel",void 0),Lc([Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"environmentBRDFTexture",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"forceNormalForward",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"enableSpecularAntiAliasing",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useHorizonOcclusion",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsTexturesDirty")],gA.prototype,"useRadianceOcclusion",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsMiscDirty")],gA.prototype,"unlit",void 0),Lc([Hc(),Uc("_markAllSubMeshesAsMiscDirty")],gA.prototype,"applyDecalMapAfterDetailMap",void 0),rh("BABYLON.PBRMaterial",gA);var SA=class e{getPositions(){return this._positions}clone(){const t=Uh.Clone((()=>new e(this.name,this.influence,this._scene)),this);return t._positions=this._positions,t._normals=this._normals,t._tangents=this._tangents,t._uvs=this._uvs,t}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}constructor(e,t=0,i=null){this.name=e,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new Ih,this._onDataLayoutChanged=new Ih,this._animationPropertiesOverride=null,this._scene=i||xh.LastCreatedScene,this.influence=t,this._scene&&(this._uniqueId=this._scene.getUniqueId())}getUVs(){return this._uvs}setUVs(e){const t=this.hasUVs;this._uvs=e,t!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}setPositions(e){const t=this.hasPositions;this._positions=e,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}static FromMesh(t,i,n){i||(i=t.name);const a=new e(i,n,t.getScene());return a.setPositions(t.getVerticesData($h.PositionKind)),t.isVerticesDataPresent($h.NormalKind)&&a.setNormals(t.getVerticesData($h.NormalKind)),t.isVerticesDataPresent($h.TangentKind)&&a.setTangents(t.getVerticesData($h.TangentKind)),t.isVerticesDataPresent($h.UVKind)&&a.setUVs(t.getVerticesData($h.UVKind)),a}getNormals(){return this._normals}getTangents(){return this._tangents}get hasUVs(){return!!this._uvs}get hasTangents(){return!!this._tangents}setNormals(e){const t=this.hasNormals;this._normals=e,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}get hasNormals(){return!!this._normals}static Parse(t,i){const n=new e(t.name,t.influence);if(n.setPositions(t.positions),null!=t.id&&(n.id=t.id),t.normals&&n.setNormals(t.normals),t.tangents&&n.setTangents(t.tangents),t.uvs&&n.setUVs(t.uvs),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],a=oh("BABYLON.Animation");a&&n.animations.push(a.Parse(i))}t.autoAnimate&&i&&i.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1)}return n}set influence(e){if(this._influence===e)return;const t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===t||0===e)}serialize(){const e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(e.uvs=Array.prototype.slice.call(this.getUVs())),Uh.AppendSerializedAnimations(this,e),e}getClassName(){return"MorphTarget"}get hasPositions(){return!!this._positions}get influence(){return this._influence}setTangents(e){const t=this.hasTangents;this._tangents=e,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}get xt(){return this._uniqueId}};Lc([Hc()],SA.prototype,"id",void 0);var yA=class e extends yp{update(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)}constructor(e,t,i,n,a,s,r=!0,o=!1,l=yp.TRILINEAR_SAMPLINGMODE,c=0,h){super(null,s,!r,o),this.format=a,this._texture=s.getEngine().createRawTexture2DArray(e,t,i,n,a,r,o,l,null,c,h),this._depth=n,this.is2DArray=!0}static CreateRGBATexture(t,i,n,a,s,r=!0,o=!1,l=3,c=0){return new e(t,i,n,a,5,s,r,o,l,c)}get depth(){return this._depth}},EA=class e{set areUpdatesFrozen(e){e?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get vertexCount(){return this._vertexCount}removeTarget(e){const t=this._targets.indexOf(e);t>=0&&(this._targets.splice(t,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(e)}addTarget(e){this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add((e=>{this._syncActiveTargets(e)}))),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}_bind(e){e.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),e.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),e.setTexture("morphTargets",this._targetStoreTexture),e.setInt("morphTargetCount",this.numInfluencers)}getTarget(e){return this._targets[e]}constructor(e=null){if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new rd(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,e||(e=xh.LastCreatedScene),this._scene=e,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const e=this._scene.getEngine().getCaps();this._canUseTextureForTargets=e.canUseGLVertexID&&e.textureFloat&&e.maxVertexTextureImageUnits>0&&e.texture2DArrayMaxLayerCount>1}}get numInfluencers(){return this._activeTargets.length}_syncActiveTargets(t){if(this.areUpdatesFrozen)return;let i=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let n=-1;for(const t of this._targets){if(n++,0===t.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=e.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(t),this._morphTargetTextureIndices[i]=n,this._tempInfluences[i++]=t.influence,this._supportsNormals=this._supportsNormals&&t.hasNormals,this._supportsTangents=this._supportsTangents&&t.hasTangents,this._supportsUVs=this._supportsUVs&&t.hasUVs;const a=t.getPositions();if(a){const e=a.length/3;if(0===this._vertexCount)this._vertexCount=e;else if(this._vertexCount!==e)return void jh.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==i&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,i)),this._influences&&this._influences.length===i||(this._influences=new Float32Array(i));for(let e=0;e<i;e++)this._influences[e]=this._tempInfluences[e];t&&this.synchronize()}get xt(){return this._uniqueId}get areUpdatesFrozen(){return this._blockCounter>0}get numTargets(){return this._targets.length}getTargetByName(e){for(const t of this._targets)if(t.name===e)return t;return null}get influences(){return this._influences}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}static Parse(t,i){const n=new e(i);n._uniqueId=t.id;for(const e of t.targets)n.addTarget(SA.Parse(e,i));return n}get isUsingTextureForTargets(){return e.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!this._scene?.getEngine().getCaps().disableMorphTargetTexture}serialize(){const e={};e.id=this.xt,e.targets=[];for(const t of this._targets)e.targets.push(t.serialize());return e}set numMaxInfluencers(e){this._numMaxInfluencers!==e&&(this._numMaxInfluencers=e,this._syncActiveTargets(!0))}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(e){this._useTextureToStoreTargets=e}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}clone(){const t=new e(this._scene);for(const e of this._targets)t.addTarget(e.clone());return t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const e=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>e&&(this._textureHeight=Math.ceil(this._textureWidth/e),this._textureWidth=e);let t=!0;if(this._targetStoreTexture){const e=this._targetStoreTexture.getSize();e.width===this._textureWidth&&e.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(t=!1)}if(t){this._targetStoreTexture&&this._targetStoreTexture.dispose();const e=this._targets.length,t=new Float32Array(e*this._textureWidth*this._textureHeight*4);let i=0;for(let n=0;n<e;n++){const e=this._targets[n],a=e.getPositions(),s=e.getNormals(),r=e.getUVs(),o=e.getTangents();if(!a)return void(0===n&&jh.Error("Invalid morph target. Target must have positions."));i=n*this._textureWidth*this._textureHeight*4;for(let e=0;e<this._vertexCount;e++)t[i]=a[3*e],t[i+1]=a[3*e+1],t[i+2]=a[3*e+2],i+=4,this._supportsNormals&&s&&(t[i]=s[3*e],t[i+1]=s[3*e+1],t[i+2]=s[3*e+2],i+=4),this._supportsUVs&&r&&(t[i]=r[2*e],t[i+1]=r[2*e+1],i+=4),this._supportsTangents&&o&&(t[i]=o[3*e],t[i+1]=o[3*e+1],t[i+2]=o[3*e+2],i+=4)}this._targetStoreTexture=yA.CreateRGBATexture(t,this._textureWidth,this._textureHeight,e,this._scene,!1,!1,1,1)}}for(const e of this._scene.meshes)e.morphTargetManager===this&&e._syncGeometryWithMorphTargetManager()}}get numMaxInfluencers(){return this._numMaxInfluencers}getActiveTarget(e){return this._activeTargets.data[e]}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const e=this._parentContainer.morphTargetManagers.indexOf(this);e>-1&&this._parentContainer.morphTargetManagers.splice(e,1),this._parentContainer=null}for(const e of this._targets)this._scene.stopAnimation(e)}}};function AA(e,t,i,n){return wh.FromArray(t,i).scaleInPlace(n)}EA.EnableTextureStorage=!0,EA.MaxActiveMorphTargetsInVertexAttributeMode=8;var CA=class{_buildAnimation(e,t,i){const n=new Ov(e,this.name,t,this.type);return n.setKeys(i),n}constructor(e,t,i,n){this.type=e,this.name=t,this.getValue=i,this.getStride=n}},RA=class extends CA{buildAnimations(e,t,i,n,a){a(e._babylonTransformNode,this._buildAnimation(t,i,n))}},TA={translation:[new RA(Ov.ANIMATIONTYPE_VECTOR3,"position",AA,(()=>3))],rotation:[new RA(Ov.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(e,t,i,n){return Dh.FromArray(t,i).scaleInPlace(n)}),(()=>4))],scale:[new RA(Ov.ANIMATIONTYPE_VECTOR3,"scaling",AA,(()=>3))],weights:[new class extends CA{buildAnimations(e,t,i,n,a){if(e._numMorphTargets)for(let s=0;s<e._numMorphTargets;s++){const r=new Ov(`${t}_${s}`,this.name,i,this.type);if(r.setKeys(n.map((e=>({frame:e.frame,inTangent:e.inTangent?e.inTangent[s]:void 0,value:e.value[s],outTangent:e.outTangent?e.outTangent[s]:void 0,interpolation:e.interpolation})))),e._primitiveBabylonMeshes)for(const t of e._primitiveBabylonMeshes)if(t.morphTargetManager){const e=t.morphTargetManager.getTarget(s),i=r.clone();e.animations.push(i),a(e,i)}}}}(Ov.ANIMATIONTYPE_FLOAT,"influence",(function(e,t,i,n){const a=new Array(e._numMorphTargets);for(let e=0;e<a.length;e++)a[e]=t[i++]*n;return a}),(e=>e._numMorphTargets))]};function NA(...e){const t=e=>e&&"object"==typeof e;return e.reduce(((e,i)=>(Object.keys(i).forEach((n=>{const a=e[n],s=i[n];Array.isArray(a)&&Array.isArray(s)?e[n]=a.concat(...s):t(a)&&t(s)?e[n]=NA(a,s):e[n]=s})),e)),{})}var MA=class{static Assign(e){if(e)for(let t=0;t<e.length;t++)e[t].index=t}static TryGet(e,t){return e&&null!=t&&e[t]?e[t]:null}static Get(e,t,i){if(!t||null==i||!t[i])throw new Error(`${e}: Failed to find index (${i})`);return t[i]}},IA=class e{log(e){this._parent._log(e)}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){const t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){const i=t[0];(i.byteLength<e.bin.byteLength-3||i.byteLength>e.bin.byteLength)&&jh.Warn(`Binary buffer length (${i.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else jh.Warn("Unexpected BIN chunk")}}_loadVertexDataAsync(e,t,i){const n=this._extensionsLoadVertexDataAsync(e,t,i);if(n)return n;const a=t.attributes;if(!a)throw new Error(`${e}: Attributes are missing`);const s=new Array,r=new md(i.name,this._babylonScene);if(null==t.indices)i.isUnIndexed=!0;else{const i=MA.Get(`${e}/indices`,this._gltf.accessors,t.indices);s.push(this._loadIndicesAccessorAsync(`/accessors/${i.index}`,i).then((e=>{r.setIndices(e)})))}const o=(t,n,o)=>{if(null==a[t])return;i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(n)&&i._delayInfo.push(n);const l=MA.Get(`${e}/attributes/${t}`,this._gltf.accessors,a[t]);s.push(this._loadVertexAccessorAsync(`/accessors/${l.index}`,l,n).then((e=>{if(e.getKind()===$h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!i.skeleton&&l.min&&l.max){const e=kh.Vector3[0].copyFromFloats(...l.min),t=kh.Vector3[1].copyFromFloats(...l.max);if(l.normalized&&5126!==l.componentType){let i=1;switch(l.componentType){case 5120:i=127;break;case 5121:i=255;break;case 5122:i=32767;break;case 5123:i=65535}const n=1/i;e.scaleInPlace(n),t.scaleInPlace(n)}r._boundingInfo=new hf(e,t),r.useBoundingInfoFromGeometry=!0}r.setVerticesBuffer(e,l.count)}))),n==$h.MatricesIndicesExtraKind&&(i.numBoneInfluencers=8),o&&o(l)};return o("POSITION",$h.PositionKind),o("NORMAL",$h.NormalKind),o("TANGENT",$h.TangentKind),o("TEXCOORD_0",$h.UVKind),o("TEXCOORD_1",$h.UV2Kind),o("TEXCOORD_2",$h.UV3Kind),o("TEXCOORD_3",$h.UV4Kind),o("TEXCOORD_4",$h.UV5Kind),o("TEXCOORD_5",$h.UV6Kind),o("JOINTS_0",$h.MatricesIndicesKind),o("WEIGHTS_0",$h.MatricesWeightsKind),o("JOINTS_1",$h.MatricesIndicesExtraKind),o("WEIGHTS_1",$h.MatricesWeightsExtraKind),o("COLOR_0",$h.ColorKind,(e=>{"VEC4"===e.type&&(i.hasVertexAlpha=!0)})),Promise.all(s).then((()=>r))}loadSceneAsync(e,t){const i=this._extensionsLoadSceneAsync(e,t);if(i)return i;const n=new Array;if(this.logOpen(`${e} ${t.name||""}`),t.nodes)for(const i of t.nodes){const t=MA.Get(`${e}/nodes/${i}`,this._gltf.nodes,i);n.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(e=>{e.parent=this._rootBabylonMesh})))}for(const e of this._postSceneLoadActions)e();return n.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(n).then((()=>{}))}get bin(){return this._bin}_extensionsLoadBufferAsync(e,t,i,n){return this._applyExtensions(t,"loadBuffer",(a=>a.loadBufferAsync&&a.loadBufferAsync(e,t,i,n)))}_createMorphTargets(e,t,i,n,a){if(!n.targets||!this._parent.loadMorphTargets)return;if(null==t._numMorphTargets)t._numMorphTargets=n.targets.length;else if(n.targets.length!==t._numMorphTargets)throw new Error(`${e}: Primitives do not have the same number of targets`);const s=i.extras?i.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,a.morphTargetManager=new EA(this._babylonScene),a.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.morphTargetManager.areUpdatesFrozen=!0;for(let e=0;e<n.targets.length;e++){const n=t.weights?t.weights[e]:i.weights?i.weights[e]:0,r=s?s[e]:`morphTarget${e}`;a.morphTargetManager.addTarget(new SA(r,n,a.getScene()))}}static _GetTextureWrapMode(e,t){switch(t=null==t?10497:t){case 33071:return yp.CLAMP_ADDRESSMODE;case 33648:return yp.MIRROR_ADDRESSMODE;case 10497:return yp.WRAP_ADDRESSMODE;default:return jh.Warn(`${e}: Invalid value (${t})`),yp.WRAP_ADDRESSMODE}}get rootBabylonMesh(){return this._rootBabylonMesh}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new wm("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);const i={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case $y.AUTO:this._babylonScene.useRightHandedSystem||(i.rotation=[0,1,0,0],i.scale=[1,1,-1],e._LoadTransform(i,this._rootBabylonMesh));break;case $y.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(t),i}logOpen(e){this._parent._logOpen(e)}_extensionsLoadAnimationAsync(e,t){return this._applyExtensions(t,"loadAnimation",(i=>i.loadAnimationAsync&&i.loadAnimationAsync(e,t)))}createMaterial(e,t,i){const n=this._extensionsCreateMaterial(e,t,i);if(n)return n;const a=t.name||`material${t.index}`;return this._createDefaultMaterial(a,i)}static _GetDrawMode(e,t){switch(null==t&&(t=4),t){case 0:return Am.PointListDrawMode;case 1:return Am.LineListDrawMode;case 2:return Am.LineLoopDrawMode;case 3:return Am.LineStripDrawMode;case 4:return Am.TriangleFillMode;case 5:return Am.TriangleStripDrawMode;case 6:return Am.TriangleFanDrawMode}throw new Error(`${e}: Invalid mesh primitive mode (${t})`)}loadBufferViewAsync(e,t){const i=this._extensionsLoadBufferViewAsync(e,t);if(i)return i;if(t._data)return t._data;const n=MA.Get(`${e}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${n.index}`,n,t.byteOffset||0,t.byteLength),t._data}_extensionsLoadNodeAsync(e,t,i){return this._applyExtensions(t,"loadNode",(n=>n.loadNodeAsync&&n.loadNodeAsync(e,t,i)))}_getNodeMatrix(e){return e.matrix?Lh.FromArray(e.matrix):Lh.Compose(e.scale?wh.FromArray(e.scale):wh.One(),e.rotation?Dh.FromArray(e.rotation):Dh.Identity(),e.translation?wh.FromArray(e.translation):wh.Zero())}_forEachExtensions(e){for(const t of this._extensions)t.enabled&&e(t)}_extensionsLoadAnimationChannelAsync(e,t,i,n,a){return this._applyExtensions(i,"loadAnimationChannel",(s=>s._loadAnimationChannelAsync&&s._loadAnimationChannelAsync(e,t,i,n,a)))}loadBufferAsync(e,t,i,n){const a=this._extensionsLoadBufferAsync(e,t,i,n);if(a)return a;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{if(!this._bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then((t=>{try{return new Uint8Array(t.buffer,t.byteOffset+i,n)}catch(t){throw new Error(`${e}: ${t.message}`)}}))}_extensionsLoadMaterialPropertiesAsync(e,t,i){return this._applyExtensions(t,"loadMaterialProperties",(n=>n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(e,t,i)))}_extensionsLoadSkinAsync(e,t,i){return this._applyExtensions(i,"loadSkin",(n=>n._loadSkinAsync&&n._loadSkinAsync(e,t,i)))}_getTransformNodes(){const e=[],t=this._gltf.nodes;if(t)for(const i of t)i._babylonTransformNode&&"TransformNode"===i._babylonTransformNode.getClassName()&&e.push(i._babylonTransformNode),i._babylonTransformNodeForSkin&&e.push(i._babylonTransformNodeForSkin);return e}loadCameraAsync(t,i,n=(()=>{})){const a=this._extensionsLoadCameraAsync(t,i,n);if(a)return a;const s=new Array;this.logOpen(`${t} ${i.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new Qv(i.name||`camera${i.index}`,wh.Zero(),this._babylonScene,!1);switch(r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.ignoreParentScaling=!0,i._babylonCamera=r,r.rotation.set(0,Math.PI,0),i.type){case"perspective":{const e=i.perspective;if(!e)throw new Error(`${t}: Camera perspective properties are missing`);r.Lt=e.yfov,r.minZ=e.znear,r.maxZ=e.zfar||0;break}case"orthographic":if(!i.orthographic)throw new Error(`${t}: Camera orthographic properties are missing`);r.mode=fd.ORTHOGRAPHIC_CAMERA,r.orthoLeft=-i.orthographic.xmag,r.orthoRight=i.orthographic.xmag,r.orthoBottom=-i.orthographic.ymag,r.orthoTop=i.orthographic.ymag,r.minZ=i.orthographic.znear,r.maxZ=i.orthographic.zfar;break;default:throw new Error(`${t}: Invalid camera type (${i.type})`)}return e.AddPointerMetadata(r,t),this._parent.onCameraLoadedObservable.notifyObservers(r),n(r),this.logClose(),Promise.all(s).then((()=>r))}_loadMeshAsync(e,t,i,n){const a=i.primitives;if(!a||!a.length)throw new Error(`${e}: Primitives are missing`);null==a[0].index&&MA.Assign(a);const s=new Array;this.logOpen(`${e} ${i.name||""}`);const r=t.name||`node${t.index}`;if(1===a.length){const n=i.primitives[0];s.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${n.index}`,r,t,i,n,(e=>{t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new Xh(r,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(const n of a)s.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${n.index}`,`${r}_primitive${n.index}`,t,i,n,(e=>{e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)})))}return n(t._babylonTransformNode),this.logClose(),Promise.all(s).then((()=>t._babylonTransformNode))}_loadFloatAccessorAsync(e,t){return this._loadAccessorAsync(e,t,Float32Array)}_extensionsLoadCameraAsync(e,t,i){return this._applyExtensions(t,"loadCamera",(n=>n.loadCameraAsync&&n.loadCameraAsync(e,t,i)))}_extensionsLoadTextureAsync(e,t,i){return this._applyExtensions(t,"loadTexture",(n=>n._loadTextureAsync&&n._loadTextureAsync(e,t,i)))}_loadBone(e,t,i,n){e._isJoint=!0;let a=n[e.index];if(a)return a;let s=null;e.index!==t.skeleton&&(e.parent&&-1!==e.parent.index?s=this._loadBone(e.parent,t,i,n):void 0!==t.skeleton&&jh.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));const r=t.joints.indexOf(e.index);return a=new iy(e.name||`joint${e.index}`,i,s,this._getNodeMatrix(e),null,null,r),n[e.index]=a,this._postSceneLoadActions.push((()=>{a.linkTransformNode(e._babylonTransformNode)})),a}_loadVertexAccessorAsync(t,i,n){if(i._babylonVertexBuffer?.[n])return i._babylonVertexBuffer[n];i._babylonVertexBuffer||(i._babylonVertexBuffer={});const a=this._babylonScene.getEngine();if(i.sparse||null==i.bufferView)i._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(t,i).then((e=>new $h(a,e,n,!1)));else{const s=MA.Get(`${t}/bufferView`,this._gltf.bufferViews,i.bufferView);i._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(s).then((r=>{const o=e._GetNumComponents(t,i.type);return new $h(a,r,n,!1,void 0,s.byteStride,void 0,i.byteOffset,o,i.componentType,i.normalized,!0,void 0,!0)}))}return i._babylonVertexBuffer[n]}static LoadExtensionAsync(e,t,i,n){if(!t.extensions)return null;const a=t.extensions[i];return a?n(`${e}/extensions/${i}`,a):null}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const e=new Array;if(this._gltf.materials)for(const t of this._gltf.materials)if(t._data)for(const i in t._data){const n=t._data[i];for(const t of n.babylonMeshes){t.computeWorldMatrix(!0);const i=n.babylonMaterial;e.push(i.forceCompilationAsync(t)),e.push(i.forceCompilationAsync(t,{useInstances:!0})),this._parent.useClipPlane&&(e.push(i.forceCompilationAsync(t,{clipPlane:!0})),e.push(i.forceCompilationAsync(t,{clipPlane:!0,useInstances:!0})))}}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_loadBones(e,t,i){if(null==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){const i=this._findSkeletonRootNode(`${e}/joints`,t.joints);if(i)if(void 0===t.skeleton)t.skeleton=i.index;else{const n=(e,t)=>{for(;t.parent;t=t.parent)if(t.parent===e)return!0;return!1},a=MA.Get(`${e}/skeleton`,this._gltf.nodes,t.skeleton);a===i||n(a,i)||(jh.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=i.index)}else jh.Warn(`${e}: Failed to find common root`)}const n={};for(const a of t.joints){const s=MA.Get(`${e}/joints/${a}`,this._gltf.nodes,a);this._loadBone(s,t,i,n)}}logClose(){this._parent._logClose()}_extensionsCreateMaterial(e,t,i){return this._applyExtensions(t,"createMaterial",(n=>n.createMaterial&&n.createMaterial(e,t,i)))}_loadAccessorAsync(t,i,n){if(i._data)return i._data;const a=e._GetNumComponents(t,i.type),s=a*$h.GetTypeByteLength(i.componentType),r=a*i.count;if(null==i.bufferView)i._data=Promise.resolve(new n(r));else{const o=MA.Get(`${t}/bufferView`,this._gltf.bufferViews,i.bufferView);i._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((l=>{if(5126!==i.componentType||i.normalized||o.byteStride&&o.byteStride!==s){const e=new n(r);return $h.ForEach(l,i.byteOffset||0,o.byteStride||s,a,i.componentType,e.length,i.normalized||!1,((t,i)=>{e[i]=t})),e}return e._GetTypedArray(t,i.componentType,l,i.byteOffset,r)}))}if(i.sparse){const r=i.sparse;i._data=i._data.then((o=>{const l=o,c=MA.Get(`${t}/sparse/indices/bufferView`,this._gltf.bufferViews,r.indices.bufferView),h=MA.Get(`${t}/sparse/values/bufferView`,this._gltf.bufferViews,r.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${c.index}`,c),this.loadBufferViewAsync(`/bufferViews/${h.index}`,h)]).then((([o,c])=>{const h=e._GetTypedArray(`${t}/sparse/indices`,r.indices.componentType,o,r.indices.byteOffset,r.count),f=a*r.count;let u;if(5126!==i.componentType||i.normalized){const o=e._GetTypedArray(`${t}/sparse/values`,i.componentType,c,r.values.byteOffset,f);u=new n(f),$h.ForEach(o,0,s,a,i.componentType,u.length,i.normalized||!1,((e,t)=>{u[t]=e}))}else u=e._GetTypedArray(`${t}/sparse/values`,i.componentType,c,r.values.byteOffset,f);let d=0;for(let e=0;e<h.length;e++){let t=h[e]*a;for(let e=0;e<a;e++)l[t++]=u[d++]}return l}))}))}return i._data}_getSkeletons(){const e=[],t=this._gltf.skins;if(t)for(const i of t)i._data&&e.push(i._data.babylonSkeleton);return e}loadAnimationAsync(e,t){const i=this._extensionsLoadAnimationAsync(e,t);if(i)return i;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new ZE(t.name||`animation${t.index}`,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=n;const a=new Array;MA.Assign(t.channels),MA.Assign(t.samplers);for(const i of t.channels)a.push(this._loadAnimationChannelAsync(`${e}/channels/${i.index}`,e,t,i,((e,t)=>{e.animations=e.animations||[],e.animations.push(t),n.addTargetedAnimation(t,e)})));return Promise.all(a).then((()=>(n.normalize(0),n)))}static _LoadTransform(e,t){if(null!=e.skin)return;let i=wh.Zero(),n=Dh.Identity(),a=wh.One();if(e.matrix){Lh.FromArray(e.matrix).decompose(a,n,i)}else e.translation&&(i=wh.FromArray(e.translation)),e.rotation&&(n=Dh.FromArray(e.rotation)),e.scale&&(a=wh.FromArray(e.scale));t.position=i,t.rotationQuaternion=n,t.scaling=a}loadMaterialPropertiesAsync(e,t,i){const n=this._extensionsLoadMaterialPropertiesAsync(e,t,i);if(n)return n;const a=new Array;return a.push(this.loadMaterialBasePropertiesAsync(e,t,i)),t.pbrMetallicRoughness&&a.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,t.pbrMetallicRoughness,i)),this.loadMaterialAlphaProperties(e,t,i),Promise.all(a).then((()=>{}))}_loadMaterialMetallicRoughnessPropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;return t&&(t.baseColorFactor?(i.albedoColor=Ah.FromArray(t.baseColorFactor),i.alpha=t.baseColorFactor[3]):i.albedoColor=Ah.White(),i.metallic=null==t.metallicFactor?1:t.metallicFactor,i.roughness=null==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&n.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,t.baseColorTexture,(e=>{e.name=`${i.name} (Base Color)`,i.albedoTexture=e}))),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,t.metallicRoughnessTexture,(e=>{e.name=`${i.name} (Metallic Roughness)`,i.metallicTexture=e}))),i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(n).then((()=>{}))}_setupData(){if(MA.Assign(this._gltf.accessors),MA.Assign(this._gltf.animations),MA.Assign(this._gltf.buffers),MA.Assign(this._gltf.bufferViews),MA.Assign(this._gltf.cameras),MA.Assign(this._gltf.images),MA.Assign(this._gltf.materials),MA.Assign(this._gltf.meshes),MA.Assign(this._gltf.nodes),MA.Assign(this._gltf.samplers),MA.Assign(this._gltf.scenes),MA.Assign(this._gltf.skins),MA.Assign(this._gltf.textures),this._gltf.nodes){const e={};for(const t of this._gltf.nodes)if(t.children)for(const i of t.children)e[i]=t.index;const t=this._createRootNode();for(const i of this._gltf.nodes){const n=e[i.index];i.parent=void 0===n?t:this._gltf.nodes[n]}}}loadMaterialAlphaProperties(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);switch(t.alphaMode||"OPAQUE"){case"OPAQUE":i.transparencyMode=gA.PBRMATERIAL_OPAQUE,i.alpha=1;break;case"MASK":i.transparencyMode=gA.PBRMATERIAL_ALPHATEST,i.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,i.albedoTexture&&(i.albedoTexture.hasAlpha=!0);break;case"BLEND":i.transparencyMode=gA.PBRMATERIAL_ALPHABLEND,i.albedoTexture&&(i.albedoTexture.hasAlpha=!0,i.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${e}/alphaMode: Invalid value (${t.alphaMode})`)}}_loadIndicesAccessorAsync(t,i){if("SCALAR"!==i.type)throw new Error(`${t}/type: Invalid value ${i.type}`);if(5121!==i.componentType&&5123!==i.componentType&&5125!==i.componentType)throw new Error(`${t}/componentType: Invalid value ${i.componentType}`);if(i._data)return i._data;if(i.sparse){const n=e._GetTypedArrayConstructor(`${t}/componentType`,i.componentType);i._data=this._loadAccessorAsync(t,i,n)}else{const n=MA.Get(`${t}/bufferView`,this._gltf.bufferViews,i.bufferView);i._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((n=>e._GetTypedArray(t,i.componentType,n,i.byteOffset,i.count)))}return i._data}_loadMorphTargetsAsync(e,t,i,n){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();const a=new Array,s=i.morphTargetManager;for(let i=0;i<s.numTargets;i++){const r=s.getTarget(i);a.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${i}`,n,t.targets[i],r))}return Promise.all(a).then((()=>{s.areUpdatesFrozen=!1}))}_extensionsLoadBufferViewAsync(e,t){return this._applyExtensions(t,"loadBufferView",(i=>i.loadBufferViewAsync&&i.loadBufferViewAsync(e,t)))}_loadAsync(e,t,i,n){return Promise.resolve().then((()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&t?e:`${e}${Date.now()}/`,this._fileName=t,this._allMaterialsDirtyRequired=!1,this._loadExtensions(),this._checkExtensions();const a=`${Zy[Zy.LOADING]} => ${Zy[Zy.READY]}`,s=`${Zy[Zy.LOADING]} => ${Zy[Zy.COMPLETE]}`;this._parent._startPerformanceCounter(a),this._parent._startPerformanceCounter(s),this._parent._setState(Zy.LOADING),this._extensionsOnLoading();const r=new Array,o=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials)if(i)r.push(this.loadSceneAsync("/nodes",{nodes:i,index:-1}));else if(null!=this._gltf.scene||this._gltf.scenes&&this._gltf.scenes[0]){const e=MA.Get("/scene",this._gltf.scenes,this._gltf.scene||0);r.push(this.loadSceneAsync(`/scenes/${e.index}`,e))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let e=0;e<this._gltf.materials.length;++e){const t=this._gltf.materials[e],i="/materials/"+e,n=Am.TriangleFillMode;r.push(this._loadMaterialAsync(i,t,null,n,(()=>{})))}this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=o:this._babylonScene._forceBlockMaterialDirtyMechanism(o),this._parent.compileMaterials&&r.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&r.push(this._compileShadowGeneratorsAsync());return Promise.all(r).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.setEnabled(!0),this._extensionsOnReady(),this._parent._setState(Zy.READY),this._startAnimations(),n()))).then((e=>(this._parent._endPerformanceCounter(a),ad.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(s),this._parent._setState(Zy.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(e=>{this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()}))})),e)))})).catch((e=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()),e}))}_extensionsLoadMeshPrimitiveAsync(e,t,i,n,a,s){return this._applyExtensions(a,"loadMeshPrimitive",(r=>r._loadMeshPrimitiveAsync&&r._loadMeshPrimitiveAsync(e,t,i,n,a,s)))}_loadSkinAsync(e,t,i,n){if(!this._parent.loadSkins)return Promise.resolve();const a=this._extensionsLoadSkinAsync(e,t,i);if(a)return a;if(i._data)return n(i._data.babylonSkeleton),i._data.promise;const s=`skeleton${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new oy(i.name||s,s,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,i,r);const o=this._loadSkinInverseBindMatricesDataAsync(e,i).then((e=>{this._updateBoneMatrices(r,e)}));return i._data={babylonSkeleton:r,promise:o},n(r),o}static _GetNumComponents(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${e}: Invalid type (${t})`)}_getAnimationGroups(){const e=[],t=this._gltf.animations;if(t)for(const i of t)i._babylonAnimationGroup&&e.push(i._babylonAnimationGroup);return e}_loadSkinInverseBindMatricesDataAsync(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);const i=MA.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const e=new Array,t=this._babylonScene.lights;for(const i of t){const t=i.getShadowGenerator();t&&e.push(t.forceCompilationAsync())}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_extensionsLoadSceneAsync(e,t){return this._applyExtensions(t,"loadScene",(i=>i.loadSceneAsync&&i.loadSceneAsync(e,t)))}_loadAnimationsAsync(){const e=this._gltf.animations;if(!e)return Promise.resolve();const t=new Array;for(let i=0;i<e.length;i++){const n=e[i];t.push(this.loadAnimationAsync(`/animations/${n.index}`,n).then((e=>{0===e.targetedAnimations.length&&e.dispose()})))}return Promise.all(t).then((()=>{}))}loadAsync(e,t,i,n,a=""){return Promise.resolve().then((()=>(this._babylonScene=e,this._loadData(t),this._loadAsync(i,a,null,(()=>{})))))}static _GetTypedArrayConstructor(e,t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${e}: Invalid component type ${t}`)}}static _ValidateUri(e){return ad.IsBase64(e)||-1===e.indexOf("..")}loadUriAsync(t,i,n){const a=this._extensionsLoadUriAsync(t,i,n);if(a)return a;if(!e._ValidateUri(n))throw new Error(`${t}: '${n}' is invalid`);if(ku(n)){const e=new Uint8Array(Gu(n));return this.log(`${t}: Decoded ${n.substr(0,64)}... (${e.length} bytes)`),Promise.resolve(e)}return this.log(`${t}: Loading ${n}`),this._parent.preprocessUrlAsync(this._rootUrl+n).then((e=>new Promise(((i,a)=>{this._parent._loadFile(this._babylonScene,e,(e=>{this._disposed||(this.log(`${t}: Loaded ${n} (${e.byteLength} bytes)`),i(new Uint8Array(e)))}),!0,(e=>{a(new Mu(`${t}: Failed to load '${n}'${e?": "+e.status+" "+e.statusText:""}`,e))}))}))))}get rootUrl(){return this._rootUrl}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((e=>e.dispose&&e.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}static _GetTypedArray(t,i,n,a,s){const r=n.buffer;a=n.byteOffset+(a||0);const o=e._GetTypedArrayConstructor(`${t}/componentType`,i),l=$h.GetTypeByteLength(i);return a%l!=0?(jh.Warn(`${t}: Copying buffer as byte offset (${a}) is not a multiple of component type byte length (${l})`),new o(r.slice(a,a+s*l),0)):new o(r,a,s)}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}loadTextureInfoAsync(t,i,n=(()=>{})){const a=this._extensionsLoadTextureInfoAsync(t,i,n);if(a)return a;if(this.logOpen(`${t}`),i.texCoord>=6)throw new Error(`${t}/texCoord: Invalid value (${i.texCoord})`);const s=MA.Get(`${t}/index`,this._gltf.textures,i.index);s._textureInfo=i;const r=this._loadTextureAsync(`/textures/${i.index}`,s,(a=>{a.coordinatesIndex=i.texCoord||0,e.AddPointerMetadata(a,t),this._parent.onTextureLoadedObservable.notifyObservers(a),n(a)}));return this.logClose(),r}_loadAnimationSamplerAsync(e,t){if(t._data)return t._data;const i=t.interpolation||"LINEAR";switch(i){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${e}/interpolation: Invalid value (${t.interpolation})`)}const n=MA.Get(`${e}/input`,this._gltf.accessors,t.input),a=MA.Get(`${e}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${n.index}`,n),this._loadFloatAccessorAsync(`/accessors/${a.index}`,a)]).then((([e,t])=>({input:e,interpolation:i,output:t}))),t._data}_extensionsOnReady(){this._forEachExtensions((e=>e.onReady&&e.onReady()))}_extensionsLoadMaterialAsync(e,t,i,n,a){return this._applyExtensions(t,"loadMaterial",(s=>s._loadMaterialAsync&&s._loadMaterialAsync(e,t,i,n,a)))}_loadMaterialAsync(t,i,n,a,s=(()=>{})){const r=this._extensionsLoadMaterialAsync(t,i,n,a,s);if(r)return r;i._data=i._data||{};let o=i._data[a];if(!o){this.logOpen(`${t} ${i.name||""}`);const n=this.createMaterial(t,i,a);o={babylonMaterial:n,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,i,n)},i._data[a]=o,e.AddPointerMetadata(n,t),this._parent.onMaterialLoadedObservable.notifyObservers(n),this.logClose()}return n&&(o.babylonMeshes.push(n),n.onDisposeObservable.addOnce((()=>{const e=o.babylonMeshes.indexOf(n);-1!==e&&o.babylonMeshes.splice(e,1)}))),s(o.babylonMaterial),o.promise.then((()=>o.babylonMaterial))}_startAnimations(){switch(this._parent.animationStartMode){case Jy.NONE:break;case Jy.FIRST:{const e=this._getAnimationGroups();0!==e.length&&e[0].start(!0);break}case Jy.ALL:{const e=this._getAnimationGroups();for(const t of e)t.start(!0);break}default:return void jh.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}_findSkeletonRootNode(e,t){if(0===t.length)return null;const i={};for(const n of t){const t=[];let a=MA.Get(`${e}/${n}`,this._gltf.nodes,n);for(;-1!==a.index;)t.unshift(a),a=a.parent;i[n]=t}let n=null;for(let e=0;;++e){let a=i[t[0]];if(e>=a.length)return n;const s=a[e];for(let r=1;r<t.length;++r)if(a=i[t[r]],e>=a.length||s!==a[e])return n;n=s}}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;const t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>new Kh(t,e,!1))),e._babylonBuffer}_loadMeshPrimitiveAsync(t,i,n,a,s,r){const o=this._extensionsLoadMeshPrimitiveAsync(t,i,n,a,s,r);if(o)return o;this.logOpen(`${t}`);const l=0===this._disableInstancedMesh&&this._parent.createInstances&&null==n.skin&&!a.primitives[0].targets;let c,h;if(l&&s._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,c=s._instanceData.babylonSourceMesh.createInstance(i),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h=s._instanceData.promise;else{const r=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new wm(i,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.sideOrientation=this._babylonScene.useRightHandedSystem?Am.CounterClockWiseSideOrientation:Am.ClockWiseSideOrientation,this._createMorphTargets(t,n,a,s,o),r.push(this._loadVertexDataAsync(t,s,o).then((e=>this._loadMorphTargetsAsync(t,s,o,e).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,e.applyToMesh(o),e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const f=e._GetDrawMode(t,s.mode);if(null==s.material){let e=this._defaultBabylonMaterialData[f];e||(e=this._createDefaultMaterial("__GLTFLoader._default",f),this._parent.onMaterialLoadedObservable.notifyObservers(e),this._defaultBabylonMaterialData[f]=e),o.material=e}else if(!this.parent.skipMaterials){const e=MA.Get(`${t}/material`,this._gltf.materials,s.material);r.push(this._loadMaterialAsync(`/materials/${e.index}`,e,o,f,(e=>{o.material=e})))}h=Promise.all(r),l&&(s._instanceData={babylonSourceMesh:o,promise:h}),c=o}return e.AddPointerMetadata(c,t),this._parent.onMeshLoadedObservable.notifyObservers(c),r(c),this.logClose(),h.then((()=>c))}_extensionsLoadVertexDataAsync(e,t,i){return this._applyExtensions(t,"loadVertexData",(n=>n._loadVertexDataAsync&&n._loadVertexDataAsync(e,t,i)))}_createDefaultMaterial(e,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new gA(e,this._babylonScene);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.fillMode=t,i.enableSpecularAntiAliasing=!0,i.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,i.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,i.transparencyMode=gA.PBRMATERIAL_OPAQUE,i.metallic=1,i.roughness=1,i}static LoadExtraAsync(e,t,i,n){if(!t.extras)return null;const a=t.extras[i];return a?n(`${e}/extras/${i}`,a):null}_applyExtensions(e,t,i){for(const n of this._extensions)if(n.enabled){const a=`${n.name}.${t}`,s=e;s._activeLoaderExtensionFunctions=s._activeLoaderExtensionFunctions||{};const r=s._activeLoaderExtensionFunctions;if(!r[a]){r[a]=!0;try{const e=i(n);if(e)return e}finally{delete r[a]}}}return null}_extensionsOnLoading(){this._forEachExtensions((e=>e.onLoading&&e.onLoading()))}_loadSampler(t,i){return i._data||(i._data={noMipMaps:9728===i.minFilter||9729===i.minFilter,samplingMode:e._GetTextureSamplingMode(t,i),wrapU:e._GetTextureWrapMode(`${t}/wrapS`,i.wrapS),wrapV:e._GetTextureWrapMode(`${t}/wrapT`,i.wrapT)}),i._data}_checkExtensions(){if(this._gltf.extensionsRequired)for(const e of this._gltf.extensionsRequired){if(!this._extensions.some((t=>t.name===e&&t.enabled))){if(!1===this.parent.extensionOptions[e]?.enabled)throw new Error(`Required extension ${e} is disabled`);throw new Error(`Required extension ${e} is not available`)}}}_loadTextureAsync(t,i,n=(()=>{})){const a=this._extensionsLoadTextureAsync(t,i,n);if(a)return a;this.logOpen(`${t} ${i.name||""}`);const s=null==i.sampler?e.DefaultSampler:MA.Get(`${t}/sampler`,this._gltf.samplers,i.sampler),r=MA.Get(`${t}/source`,this._gltf.images,i.source),o=this._createTextureAsync(t,s,r,n,void 0,!i._textureInfo.nonColorData);return this.logClose(),o}_extensionsLoadUriAsync(e,t,i){return this._applyExtensions(t,"loadUri",(n=>n._loadUriAsync&&n._loadUriAsync(e,t,i)))}_loadAnimationChannelFromTargetInfoAsync(e,t,i,n,a,s){const r=this.parent.targetFps,o=1/r,l=MA.Get(`${e}/sampler`,i.samplers,n.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${n.sampler}`,l).then((e=>{let t=0;const l=a.object,c=a.info;for(const a of c){const c=a.getStride(l),h=e.input,f=e.output,u=new Array(h.length);let d=0;switch(e.interpolation){case"STEP":for(let e=0;e<h.length;e++){const t=a.getValue(l,f,d,1);d+=c,u[e]={frame:h[e]*r,value:t,interpolation:1}}break;case"CUBICSPLINE":for(let e=0;e<h.length;e++){const t=a.getValue(l,f,d,o);d+=c;const i=a.getValue(l,f,d,1);d+=c;const n=a.getValue(l,f,d,o);d+=c,u[e]={frame:h[e]*r,inTangent:t,value:i,outTangent:n}}break;case"LINEAR":for(let e=0;e<h.length;e++){const t=a.getValue(l,f,d,1);d+=c,u[e]={frame:h[e]*r,value:t}}}if(d>0){const e=`${i.name||`animation${i.index}`}_channel${n.index}_${t}`;a.buildAnimations(l,e,r,u,((e,i)=>{++t,s(e,i)}))}}}))}_createTextureAsync(e,t,i,n=(()=>{}),a,s){const r=this._loadSampler(`/samplers/${t.index}`,t),o=new Array,l=new JE;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c={noMipmap:r.noMipMaps,invertY:!1,samplingMode:r.samplingMode,onLoad:()=>{this._disposed||l.resolve()},onError:(t,i)=>{this._disposed||l.reject(new Error(`${e}: ${i&&i.message?i.message:t||"Failed to load texture"}`))},mimeType:i.mimeType,loaderOptions:a,useSRGBBuffer:!!s&&this._parent.useSRGBBuffers},h=new yp(null,this._babylonScene,c);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.push(l.promise),o.push(this.loadImageAsync(`/images/${i.index}`,i).then((e=>{const t=i.uri||`${this._fileName}#image${i.index}`,n=`data:${this._uniqueRootUrl}${t}`;h.updateURL(n,e)}))),h.wrapU=r.wrapU,h.wrapV=r.wrapV,n(h),Promise.all(o).then((()=>h))}get parent(){return this._parent}loadMaterialBasePropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;return i.emissiveColor=t.emissiveFactor?Ah.FromArray(t.emissiveFactor):new Ah(0,0,0),t.doubleSided&&(i.backFaceCulling=!1,i.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${e}/normalTexture`,t.normalTexture,(e=>{e.name=`${i.name} (Normal)`,i.bumpTexture=e}))),i.invertNormalMapX=!this._babylonScene.useRightHandedSystem,i.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&i.bumpTexture&&(i.bumpTexture.level=t.normalTexture.scale),i.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,t.occlusionTexture,(e=>{e.name=`${i.name} (Occlusion)`,i.ambientTexture=e}))),i.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(i.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&n.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,t.emissiveTexture,(e=>{e.name=`${i.name} (Emissive)`,i.emissiveTexture=e}))),Promise.all(n).then((()=>{}))}loadNodeAsync(t,i,n=(()=>{})){const a=this._extensionsLoadNodeAsync(t,i,n);if(a)return a;if(i._babylonTransformNode)throw new Error(`${t}: Invalid recursive node hierarchy`);const s=new Array;this.logOpen(`${t} ${i.name||""}`);const r=a=>{if(e.AddPointerMetadata(a,t),e._LoadTransform(i,a),null!=i.camera){const e=MA.Get(`${t}/camera`,this._gltf.cameras,i.camera);s.push(this.loadCameraAsync(`/cameras/${e.index}`,e,(e=>{e.parent=a})))}if(i.children)for(const e of i.children){const i=MA.Get(`${t}/children/${e}`,this._gltf.nodes,e);s.push(this.loadNodeAsync(`/nodes/${i.index}`,i,(e=>{e.parent=a})))}n(a)},o=null!=i.mesh,l=this._parent.loadSkins&&null!=i.skin;if(!o||l){const e=i.name||`node${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new Xh(e,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,null==i.mesh?i._babylonTransformNode=t:i._babylonTransformNodeForSkin=t,r(t)}if(o)if(l){const e=MA.Get(`${t}/mesh`,this._gltf.meshes,i.mesh);s.push(this._loadMeshAsync(`/meshes/${e.index}`,i,e,(e=>{const n=i._babylonTransformNodeForSkin;e.metadata=NA(n.metadata,e.metadata||{});const a=MA.Get(`${t}/skin`,this._gltf.skins,i.skin);s.push(this._loadSkinAsync(`/skins/${a.index}`,i,a,(t=>{this._forEachPrimitive(i,(e=>{e.skeleton=t})),this._postSceneLoadActions.push((()=>{if(null!=a.skeleton){const t=MA.Get(`/skins/${a.index}/skeleton`,this._gltf.nodes,a.skeleton).parent;i.index===t.index?e.parent=n.parent:e.parent=t._babylonTransformNode}else e.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:n,skinnedNode:e})}))})))})))}else{const e=MA.Get(`${t}/mesh`,this._gltf.meshes,i.mesh);s.push(this._loadMeshAsync(`/meshes/${e.index}`,i,e,r))}return this.logClose(),Promise.all(s).then((()=>(this._forEachPrimitive(i,(e=>{e.geometry&&e.geometry.useBoundingInfoFromGeometry?e._updateBoundingInfo():e.refreshBoundingInfo(!0,!0)})),i._babylonTransformNode)))}_loadExtensions(){for(const t in e._RegisteredExtensions)if(!1===this.parent.extensionOptions[t]?.enabled)this.isExtensionUsed(t)&&jh.Warn(`Extension ${t} is used but has been explicitly disabled.`);else{const i=e._RegisteredExtensions[t].factory(this);i.name!==t&&jh.Warn(`The name of the glTF loader extension instance does not match the registered name: ${i.name} !== ${t}`),this._extensions.push(i),this._parent.onExtensionLoadedObservable.notifyObservers(i)}this._extensions.sort(((e,t)=>(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear()}_getMeshes(){const e=[];this._rootBabylonMesh instanceof Bd&&e.push(this._rootBabylonMesh);const t=this._gltf.nodes;if(t)for(const i of t)this._forEachPrimitive(i,(t=>{e.push(t)}));return e}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}static AddPointerMetadata(e,t){e.metadata=e.metadata||{};const i=e._internalMetadata=e._internalMetadata||{},n=i.gltf=i.gltf||{};(n.pointers=n.pointers||[]).push(t)}_extensionsLoadTextureInfoAsync(e,t,i){return this._applyExtensions(t,"loadTextureInfo",(n=>n.loadTextureInfoAsync&&n.loadTextureInfoAsync(e,t,i)))}get gltf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}constructor(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}importMeshAsync(e,t,i,n,a,s,r=""){return Promise.resolve().then((()=>{this._babylonScene=t,this._assetContainer=i,this._loadData(n);let s=null;if(e){const t={};if(this._gltf.nodes)for(const e of this._gltf.nodes)e.name&&(t[e.name]=e.index);s=(e instanceof Array?e:[e]).map((e=>{const i=t[e];if(void 0===i)throw new Error(`Failed to find node '${e}'`);return i}))}return this._loadAsync(a,r,s,(()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}static _GetTextureSamplingMode(e,t){const i=null==t.magFilter?9729:t.magFilter,n=null==t.minFilter?9987:t.minFilter;if(9729===i)switch(n){case 9728:return yp.LINEAR_NEAREST;case 9729:return yp.LINEAR_LINEAR;case 9984:return yp.LINEAR_NEAREST_MIPNEAREST;case 9985:return yp.LINEAR_LINEAR_MIPNEAREST;case 9986:return yp.LINEAR_NEAREST_MIPLINEAR;case 9987:return yp.LINEAR_LINEAR_MIPLINEAR;default:return jh.Warn(`${e}/minFilter: Invalid value (${n})`),yp.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==i&&jh.Warn(`${e}/magFilter: Invalid value (${i})`),n){case 9728:return yp.NEAREST_NEAREST;case 9729:return yp.NEAREST_LINEAR;case 9984:return yp.NEAREST_NEAREST_MIPNEAREST;case 9985:return yp.NEAREST_LINEAR_MIPNEAREST;case 9986:return yp.NEAREST_NEAREST_MIPLINEAR;case 9987:return yp.NEAREST_LINEAR_MIPLINEAR;default:return jh.Warn(`${e}/minFilter: Invalid value (${n})`),yp.NEAREST_NEAREST_MIPNEAREST}}_forEachPrimitive(e,t){if(e._primitiveBabylonMeshes)for(const i of e._primitiveBabylonMeshes)t(i)}_loadMorphTargetVertexDataAsync(e,t,i,n){const a=new Array,s=(n,s,r)=>{if(null==i[n])return;const o=t.getVertexBuffer(s);if(!o)return;const l=MA.Get(`${e}/${n}`,this._gltf.accessors,i[n]);a.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then((e=>{r(o,e)})))};return s("POSITION",$h.PositionKind,((e,t)=>{const i=new Float32Array(t.length);e.forEach(t.length,((e,n)=>{i[n]=t[n]+e})),n.setPositions(i)})),s("NORMAL",$h.NormalKind,((e,t)=>{const i=new Float32Array(t.length);e.forEach(i.length,((e,n)=>{i[n]=t[n]+e})),n.setNormals(i)})),s("TANGENT",$h.TangentKind,((e,t)=>{const i=new Float32Array(t.length/3*4);let a=0;e.forEach(t.length/3*4,((e,n)=>{(n+1)%4!=0&&(i[a]=t[a]+e,a++)})),n.setTangents(i)})),Promise.all(a).then((()=>{}))}_getGeometries(){const e=[],t=this._gltf.nodes;if(t)for(const i of t)this._forEachPrimitive(i,(t=>{const i=t.geometry;i&&-1===e.indexOf(i)&&e.push(i)}));return e}loadImageAsync(e,t){if(!t._data){if(this.logOpen(`${e} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{const i=MA.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}this.logClose()}return t._data}_updateBoneMatrices(e,t){for(const i of e.bones){const e=Lh.Identity(),n=i._index;t&&-1!==n&&(Lh.FromArrayToRef(t,16*n,e),e.invertToRef(e));const a=i.getParent();a&&e.multiplyToRef(a.getAbsoluteInverseBindMatrix(),e),i.updateMatrix(e,!1,!1),i._updateAbsoluteBindMatrices(void 0,!1)}}_loadAnimationChannelAsync(e,t,i,n,a){const s=this._extensionsLoadAnimationChannelAsync(e,t,i,n,a);if(s)return s;if(null==n.target.node)return Promise.resolve();const r=MA.Get(`${e}/target/node`,this._gltf.nodes,n.target.node),o=n.target.path,l="weights"===o;if(l&&!r._numMorphTargets||!l&&!r._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!l&&!r._isJoint)return Promise.resolve();let c;switch(o){case"translation":c=TA.translation;break;case"rotation":c=TA.rotation;break;case"scale":c=TA.scale;break;case"weights":c=TA.weights;break;default:throw new Error(`${e}/target/path: Invalid value (${n.target.path})`)}const h={object:r,info:c};return this._loadAnimationChannelFromTargetInfoAsync(e,t,i,n,h,a)}static UnregisterExtension(t){return!!e._RegisteredExtensions[t]&&(delete e._RegisteredExtensions[t],!0)}static RegisterExtension(t,i){e.UnregisterExtension(t)&&jh.Warn(`Extension with the name '${t}' already exists`),e._RegisteredExtensions[t]={factory:i}}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}};IA._RegisteredExtensions={},IA.DefaultSampler={index:-1},yE._CreateGLTF2Loader=e=>new IA(e);var xA="image/png";function bA(e,t,i,n,a,s,r,o,l,c,h){return new Promise(((f,u)=>{if(i){const i=t.createTexture(null,!0,!0,null,1,null,(e=>{u(e)}),e);n?.onEffectCreatedObservable.addOnce((o=>{o.executeWhenCompiled((()=>{n.externalTextureSamplerBinding=!0,n.onApply=n=>{n._bindTexture("textureSampler",i),n.setFloat2("scale",1,t._features.needsInvertingBitmap&&e instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([n],c,!0,s,r),t.restoreDefaultFramebuffer(),i.dispose(),URL.revokeObjectURL(a),f())}))}))}else{if(t._uploadImageToTexture(h,e,s,r),o){const i=l[r];i&&t._uploadImageToTexture(i._texture,e,s,0)}f()}}))}async function PA(e,t,i=xA){if(!ad.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");const n=vh.ILog2(e.width)+1,a=e.getEngine();let s=!1,r=!1,o=null,l=null,c=null;const h=a.getCaps();e.format=5,e.type=0,e.generateMipMaps=!0,e._cachedAnisotropicFilteringLevel=null,a.updateTextureSamplingMode(3,e),h.textureLOD?a._features.supportRenderAndCopyToLodForFloatTextures?h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(s=!0,e.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(s=!0,e.type=1):s=!1:(s=!1,r=!0,c={});let f=0;if(s)a.isWebGPU?(f=1,await Promise.resolve().then((()=>(to(),Jr)))):await Promise.resolve().then((()=>(fo(),oo))),o=new Ip("rgbdDecode","rgbdDecode",null,null,1,null,3,a,!1,void 0,e.type,void 0,null,!1,void 0,f),e._isRGBD=!1,e.invertY=!1,l=a.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:e.type,format:5});else if(e._isRGBD=!0,e.invertY=!0,r){const t=3,i=e._lodGenerationScale,s=e._lodGenerationOffset;for(let r=0;r<t;r++){const o=(n-1)*i+s,l=s+(o-s)*(1-r/(t-1)),h=Math.round(Math.min(Math.max(l,0),o)),f=new Cu(a,2);f.isCube=!0,f.invertY=!0,f.generateMipMaps=!1,a.updateTextureSamplingMode(2,f);const u=new gp(null);switch(u._isCube=!0,u._texture=f,c[h]=u,r){case 0:e._lodTextureLow=u;break;case 1:e._lodTextureMid=u;break;case 2:e._lodTextureHigh=u}}}const u=[];for(let n=0;n<t.length;n++)for(let h=0;h<6;h++){const f=t[n][h],d=new Blob([f],{type:i}),m=URL.createObjectURL(d);let p;if(a._features.forceBitmapOverHTMLImageElement)p=a.createImageBitmap(d,{premultiplyAlpha:"none"}).then((t=>bA(t,a,s,o,m,h,n,r,c,l,e)));else{const t=new Image;t.src=m,p=new Promise(((i,f)=>{t.onload=()=>{bA(t,a,s,o,m,h,n,r,c,l,e).then((()=>i())).catch((e=>{f(e)}))},t.onerror=e=>{f(e)}}))}u.push(p)}if(t.length<n){let i;const s=Math.pow(2,n-1-t.length),r=s*s*4;switch(e.type){case 0:i=new Uint8Array(r);break;case 2:i=new Uint16Array(r);break;case 1:i=new Float32Array(r)}for(let s=t.length;s<n;s++)for(let t=0;t<6;t++)a._uploadArrayBufferViewToTexture(e,i,t,s)}return Promise.all(u).then((()=>{l&&(a._releaseTexture(e),l._swapAndDie(e)),o&&o.dispose(),r&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))}))}var wA=class e extends Eg{clone(){return Uh.Clone((()=>{const t=this.getScene(),i=this._texture,n=new e(t,i._bufferViewArray,i.width,i.format,i.type,i.generateMipMaps,i.invertY,i.samplingMode,i._compression);return 13===i.source&&n.updateRGBDAsync(i._bufferViewArrayArray,i._sphericalPolynomial,i._lodGenerationScale,i._lodGenerationOffset),n}),this)}update(e,t,i,n,a=null){this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,i,n,a)}updateRGBDAsync(e,t=null,i=.8,n=0){return function(e,t,i,n,a){const s=PA(e.getEngine().createRawCubeTexture(null,e.width,e.format,e.type,e.generateMipMaps,e.invertY,e.samplingMode,e._compression),t).then((()=>e));return e.onRebuildCallback=e=>({proxy:s,isReady:!0,isAsync:!0}),e._source=13,e._bufferViewArrayArray=t,e._lodGenerationScale=n,e._lodGenerationOffset=a,e._sphericalPolynomial=i,PA(e,t).then((()=>(e.isReady=!0,e)))}(this._texture,e,t,i,n).then((()=>{}))}constructor(e,t,i,n=5,a=0,s=!1,r=!1,o=3,l=null){super("",e),this._texture=e.getEngine().createRawCubeTexture(t,i,n,a,s,r,o,l)}},OA="EXT_lights_image_based",DA=class{loadSceneAsync(e,t){return IA.LoadExtensionAsync(e,t,this.name,((i,n)=>{this._loader._allMaterialsDirtyRequired=!0;const a=new Array;a.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${i}`);const s=MA.Get(`${i}/light`,this._lights,n.light);return a.push(this._loadLightAsync(`/extensions/${this.name}/lights/${n.light}`,s).then((e=>{this._loader.babylonScene.environmentTexture=e}))),this._loader.logClose(),Promise.all(a).then((()=>{}))}))}constructor(e){this.name=OA,this._loader=e,this.enabled=this._loader.isExtensionUsed(OA)}dispose(){this._loader=null,delete this._lights}_loadLightAsync(e,t){if(!t._loaded){const i=new Array;this._loader.logOpen(`${e}`);const n=new Array(t.specularImages.length);for(let a=0;a<t.specularImages.length;a++){const s=t.specularImages[a];n[a]=new Array(s.length);for(let t=0;t<s.length;t++){const r=`${e}/specularImages/${a}/${t}`;this._loader.logOpen(`${r}`);const o=s[t],l=MA.Get(r,this._loader.gltf.images,o);i.push(this._loader.loadImageAsync(`/images/${o}`,l).then((e=>{n[a][t]=e}))),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(i).then((()=>{const i=new wA(this._loader.babylonScene,null,t.specularImageSize);if(i.name=t.name||"environment",t._babylonTexture=i,null!=t.intensity&&(i.level=t.intensity),t.rotation){let e=Dh.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(e=Dh.Inverse(e)),Lh.FromQuaternionToRef(e,i.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const a=ag.FromArray(t.irradianceCoefficients);a.scaleInPlace(t.intensity),a.convertIrradianceToLambertianRadiance();const s=sg.FromHarmonics(a),r=(n.length-1)/vh.Log2(t.specularImageSize);return i.updateRGBDAsync(n,s,r)}))}return t._loaded.then((()=>t._babylonTexture))}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights}}};IA.RegisterExtension(OA,(e=>new DA(e))),wm.prototype.thinInstanceAdd=function(e,t=!0){if(!this.getScene().getEngine().getCaps().instancedArrays)return jh.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(e)?e.length:1);const i=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(e))for(let i=0;i<e.length;++i)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e[i],i===e.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e,t);return i},wm.prototype.thinInstanceAddSelf=function(e=!0){return this.thinInstanceAdd(Lh.IdentityReadOnly,e)},wm.prototype.thinInstanceRegisterAttribute=function(e,t){e===$h.ColorKind&&(e=$h.ColorInstanceKind),this.removeVerticesData(e),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[e]=t,this._userThinInstanceBuffersStorage.sizes[e]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[e]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[e]),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new $h(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])},wm.prototype.thinInstanceSetMatrixAt=function(e,t,i=!0){if(!this._thinInstanceDataStorage.matrixData||e>=this._thinInstanceDataStorage.instancesCount)return!1;const n=this._thinInstanceDataStorage.matrixData;return t.copyToArray(n,16*e),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[e]=t),i&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},wm.prototype.thinInstanceSetAttributeAt=function(e,t,i,n=!0){return e===$h.ColorKind&&(e=$h.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[e]||t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(e,0),this._userThinInstanceBuffersStorage.data[e].set(i,t*this._userThinInstanceBuffersStorage.strides[e]),n&&this.thinInstanceBufferUpdated(e),!0)},Object.defineProperty(wm.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(e){const t=this._thinInstanceDataStorage.matrixData??this.source?._thinInstanceDataStorage.matrixData;e<=(t?t.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=e)},enumerable:!0,configurable:!0}),wm.prototype._thinInstanceCreateMatrixBuffer=function(e,t,i=!0){const n=new Kh(this.getEngine(),t,!i,16,!1,!0);for(let t=0;t<4;t++)this.setVerticesBuffer(n.createVertexBuffer(e+t,4*t,4));return n},wm.prototype.thinInstanceSetBuffer=function(e,t,i=0,n=!0){i=i||16,"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*i,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,null!==t?(this._thinInstanceDataStorage.instancesCount=t.length/i,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",t,n),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):"previousMatrix"===e?(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=t,null!==t&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",t,n))):(e===$h.ColorKind&&(e=$h.ColorInstanceKind),null===t?this._userThinInstanceBuffersStorage?.data[e]&&(this.removeVerticesData(e),delete this._userThinInstanceBuffersStorage.data[e],delete this._userThinInstanceBuffersStorage.strides[e],delete this._userThinInstanceBuffersStorage.sizes[e],delete this._userThinInstanceBuffersStorage.vertexBuffers[e]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[e]=t,this._userThinInstanceBuffersStorage.strides[e]=i,this._userThinInstanceBuffersStorage.sizes[e]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new $h(this.getEngine(),t,e,!n,!1,i,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])))},wm.prototype.thinInstanceBufferUpdated=function(e){"matrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.matrixBuffer?.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount)):"previousMatrix"===e?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._thinInstanceDataStorage.previousMatrixBuffer?.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)):(e===$h.ColorKind&&(e=$h.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&(this.thinInstanceAllowAutomaticStaticBufferRecreation&&!this._userThinInstanceBuffersStorage.vertexBuffers[e].isUpdatable()&&this._thinInstanceRecreateBuffer(e),this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(this._userThinInstanceBuffersStorage.data[e],0)))},wm.prototype.thinInstancePartialBufferUpdate=function(e,t,i){"matrix"===e?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,i):(e===$h.ColorKind&&(e=$h.ColorInstanceKind),this._userThinInstanceBuffersStorage?.vertexBuffers[e]&&this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(t,i))},wm.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const e=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=Lh.FromArray(e,16*t)}return this._thinInstanceDataStorage.worldMatrices},wm.prototype.thinInstanceRefreshBoundingInfo=function(e=!1,t=!1,i=!1){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const n=this._thinInstanceDataStorage.boundingVectors;if(e||!this.rawBoundingInfo){n.length=0,this.refreshBoundingInfo(t,i);const e=this.getBoundingInfo();this.rawBoundingInfo=new hf(e.minimum,e.maximum)}const a=this.getBoundingInfo(),s=this._thinInstanceDataStorage.matrixData;if(0===n.length)for(let e=0;e<a.boundingBox.vectors.length;++e)n.push(a.boundingBox.vectors[e].clone());kh.Vector3[0].setAll(Number.POSITIVE_INFINITY),kh.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(let e=0;e<this._thinInstanceDataStorage.instancesCount;++e){Lh.FromArrayToRef(s,16*e,kh.Matrix[0]);for(let e=0;e<n.length;++e)wh.TransformCoordinatesToRef(n[e],kh.Matrix[0],kh.Vector3[2]),kh.Vector3[0].minimizeInPlace(kh.Vector3[2]),kh.Vector3[1].maximizeInPlace(kh.Vector3[2])}a.reConstruct(kh.Vector3[0],kh.Vector3[1]),this._updateBoundingInfo()},wm.prototype._thinInstanceRecreateBuffer=function(e,t=!0){"matrix"===e?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,t)):"previousMatrix"===e?this._scene.needsPreviousWorldMatrices&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,t)):(e===$h.ColorKind&&(e=$h.ColorInstanceKind),this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new $h(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!t,!1,this._userThinInstanceBuffersStorage.strides[e],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))},wm.prototype._thinInstanceUpdateBufferSize=function(e,t=1){e===$h.ColorKind&&(e=$h.ColorInstanceKind);const i="matrix"===e;if(!(i||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[e]))return;const n=i?16:this._userThinInstanceBuffersStorage.strides[e],a=i?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[e];let s=i?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[e];const r=(this._thinInstanceDataStorage.instancesCount+t)*n;let o=a;for(;o<r;)o*=2;if(!s||a!=o){if(s){const e=new Float32Array(o);e.set(s,0),s=e}else s=new Float32Array(o);i?(this._thinInstanceDataStorage.matrixBuffer?.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",s,!1),this._thinInstanceDataStorage.matrixData=s,this._thinInstanceDataStorage.matrixBufferSize=o,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",s,!1))):(this._userThinInstanceBuffersStorage.vertexBuffers[e]?.dispose(),this._userThinInstanceBuffersStorage.data[e]=s,this._userThinInstanceBuffersStorage.sizes[e]=o,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new $h(this.getEngine(),s,e,!0,!1,n,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))}},wm.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},wm.prototype._disposeThinInstanceSpecificData=function(){this._thinInstanceDataStorage?.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)};var LA="EXT_mesh_gpu_instancing",FA=class{dispose(){this._loader=null}constructor(e){this.name=LA,this._loader=e,this.enabled=this._loader.isExtensionUsed(LA)}loadNodeAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((e,n)=>{this._loader._disableInstancedMesh++;const a=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,i);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return a;const s=new Array;let r=0;const o=t=>{if(null==n.attributes[t])return void s.push(Promise.resolve(null));const i=MA.Get(`${e}/attributes/${t}`,this._loader.gltf.accessors,n.attributes[t]);if(s.push(this._loader._loadFloatAccessorAsync(`/accessors/${i.bufferView}`,i)),0===r)r=i.count;else if(r!==i.count)throw new Error(`${e}/attributes: Instance buffer accessors do not have the same count.`)};return o("TRANSLATION"),o("ROTATION"),o("SCALE"),a.then((e=>Promise.all(s).then((([i,n,a])=>{const s=new Float32Array(16*r);kh.Vector3[0].copyFromFloats(0,0,0),kh.Ht[0].copyFromFloats(0,0,0,1),kh.Vector3[1].copyFromFloats(1,1,1);for(let e=0;e<r;++e)i&&wh.FromArrayToRef(i,3*e,kh.Vector3[0]),n&&Dh.FromArrayToRef(n,4*e,kh.Ht[0]),a&&wh.FromArrayToRef(a,3*e,kh.Vector3[1]),Lh.ComposeToRef(kh.Vector3[1],kh.Ht[0],kh.Vector3[0],kh.Matrix[0]),kh.Matrix[0].copyToArray(s,16*e);for(const e of t._primitiveBabylonMeshes)e.thinInstanceSetBuffer("matrix",s,16,!0);return e}))))}))}};IA.RegisterExtension(LA,(e=>new FA(e)));var kA=class e{dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(e,t,i,n,a){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const s=await MeshoptDecoder.decodeGltfBufferAsync(t,i,e,n,a);return MeshoptDecoder.useWorkers(0),s}))}constructor(){const t=e.Configuration.decoder;this._decoderModulePromise=ad.LoadBabylonScriptAsync(t.url).then((()=>MeshoptDecoder.ready))}static get Default(){return e._Default||(e._Default=new e),e._Default}};kA.Configuration={decoder:{url:`${ad._DefaultCdnUrl}/meshopt_decoder.js`}},kA._Default=null;var BA="EXT_meshopt_compression",GA=class{dispose(){this._loader=null}constructor(e){this.name=BA,this.enabled=e.isExtensionUsed(BA),this._loader=e}loadBufferViewAsync(e,t){return IA.LoadExtensionAsync(e,t,this.name,((i,n)=>{const a=t;if(a._meshOptData)return a._meshOptData;const s=MA.Get(`${e}/buffer`,this._loader.gltf.buffers,n.buffer);return a._meshOptData=this._loader.loadBufferAsync(`/buffers/${s.index}`,s,n.byteOffset||0,n.byteLength).then((e=>kA.Default.decodeGltfBufferAsync(e,n.count,n.byteStride,n.mode,n.filter))),a._meshOptData}))}};IA.RegisterExtension(BA,(e=>new GA(e)));var UA="EXT_texture_webp",HA=class{_loadTextureAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=null==t.sampler?IA.DefaultSampler:MA.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),r=MA.Get(`${n}/source`,this._loader.gltf.images,a.source);return this._loader._createTextureAsync(e,s,r,(e=>{i(e)}),void 0,!t._textureInfo.nonColorData)}))}constructor(e){this.name=UA,this._loader=e,this.enabled=e.isExtensionUsed(UA)}dispose(){this._loader=null}};IA.RegisterExtension(UA,(e=>new HA(e)));var VA="EXT_texture_avif",WA=class{_loadTextureAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=null==t.sampler?IA.DefaultSampler:MA.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),r=MA.Get(`${n}/source`,this._loader.gltf.images,a.source);return this._loader._createTextureAsync(e,s,r,(e=>{i(e)}),void 0,!t._textureInfo.nonColorData)}))}dispose(){this._loader=null}constructor(e){this.name=VA,this._loader=e,this.enabled=e.isExtensionUsed(VA)}};IA.RegisterExtension(VA,(e=>new WA(e)));var zA=class{_execute(e,t){e.idle=!1,e.workerPromise.then((i=>{t(i,(()=>{const t=this._pendingActions.shift();t?this._execute(e,t):e.idle=!0}))}))}dispose(){for(const e of this._workerInfos)e.workerPromise.then((e=>{e.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}_executeOnIdleWorker(e){for(const t of this._workerInfos)if(t.idle)return this._execute(t,e),!0;return!1}constructor(e){this._pendingActions=new Array,this._workerInfos=e.map((e=>({workerPromise:Promise.resolve(e),idle:!0})))}push(e){this._executeOnIdleWorker(e)||this._pendingActions.push(e)}},XA=class e extends zA{push(e){if(!this._executeOnIdleWorker(e))if(this._workerInfos.length<this._maxWorkers){const t={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(t),this._execute(t,e)}else this._pendingActions.push(e)}constructor(t,i,n=e.DefaultOptions){super([]),this._maxWorkers=t,this._createWorkerAsync=i,this._options=n}_execute(e,t){e.timeoutId&&(clearTimeout(e.timeoutId),delete e.timeoutId),super._execute(e,((i,n)=>{t(i,(()=>{n(),e.idle&&(e.timeoutId=setTimeout((()=>{e.workerPromise.then((e=>{e.terminate()}));const t=this._workerInfos.indexOf(e);-1!==t&&this._workerInfos.splice(t,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}};function YA(e,t,i,n,a){let s=null,r=null,o=null;try{let l;s=new e.Decoder,r=new e.DecoderBuffer,r.Init(t,t.byteLength);const c=s.GetEncodedGeometryType(r);switch(c){case e.TRIANGULAR_MESH:{const t=new e.Mesh;if(l=s.DecodeBufferToMesh(r,t),!l.ok()||0===t.ptr)throw new Error(l.error_msg());const i=3*t.num_faces(),a=4*i,c=e._malloc(a);try{s.GetTrianglesUInt32Array(t,a,c);const r=new Uint32Array(i);r.set(new Uint32Array(e.HEAPF32.buffer,c,i)),n(r)}finally{e._free(c)}o=t;break}case e.POINT_CLOUD:{const t=new e.PointCloud;if(l=s.DecodeBufferToPointCloud(r,t),!l.ok()||!t.ptr)throw new Error(l.error_msg());o=t;break}default:throw new Error(`Invalid geometry type ${c}`)}const h=o.num_points(),f=(t,i,n,s)=>{const r=s.data_type(),o=s.num_components(),l=s.normalized(),c=s.byte_stride(),f=s.byte_offset(),u={[e.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:e.HEAPF32},[e.DT_INT8]:{typedArrayConstructor:Int8Array,heap:e.HEAP8},[e.DT_INT16]:{typedArrayConstructor:Int16Array,heap:e.HEAP16},[e.DT_INT32]:{typedArrayConstructor:Int32Array,heap:e.HEAP32},[e.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:e.HEAPU8},[e.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:e.HEAPU16},[e.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:e.HEAPU32}}[r];if(!u)throw new Error(`Invalid data type ${r}`);const d=h*o,m=d*u.typedArrayConstructor.BYTES_PER_ELEMENT,p=e._malloc(m);try{t.GetAttributeDataArrayForAllPoints(i,s,r,m,p);const e=new u.typedArrayConstructor(u.heap.buffer,p,d);a(n,e.slice(),o,f,c,l)}finally{e._free(p)}};if(i)for(const e in i){const t=i[e],n=s.GetAttributeByUniqueId(o,t);f(s,o,e,n)}else{const t={position:e.POSITION,normal:e.NORMAL,color:e.COLOR,uv:e.TEX_COORD};for(const e in t){const i=s.GetAttributeId(o,t[e]);if(-1!==i){const t=s.GetAttribute(o,i);f(s,o,e,t)}}}return h}finally{o&&e.destroy(o),r&&e.destroy(r),s&&e.destroy(s)}}function jA(){let e;onmessage=t=>{const i=t.data;switch(i.id){case"init":{const t=i.decoder;t.url&&importScripts(t.url);const n=t.wasmBinary?{wasmBinary:t.wasmBinary}:{};e=DracoDecoderModule(n),postMessage({id:"initDone"});break}case"decodeMesh":if(!e)throw new Error("Draco decoder module is not available");e.then((e=>{const t=YA(e,i.dataView,i.attributes,(e=>{postMessage({id:"indices",data:e},[e.buffer])}),((e,t,i,n,a,s)=>{postMessage({id:"attribute",kind:e,data:t,size:i,byteOffset:n,byteStride:a,normalized:s},[t.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:t})}))}}}XA.DefaultOptions={idleTimeElapsedBeforeRelease:1e3};var KA=class e{decodeMeshToMeshDataAsync(e,t,i){const n=e instanceof ArrayBuffer?new Int8Array(e):new Int8Array(e.buffer,e.byteOffset,e.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((e=>new Promise(((a,s)=>{e.push(((e,r)=>{let o=null;const l=[],c=t=>{e.removeEventListener("error",c),e.removeEventListener("message",h),s(t),r()},h=t=>{const n=t.data;switch(n.id){case"decodeMeshDone":e.removeEventListener("error",c),e.removeEventListener("message",h),a({indices:o,attributes:l,totalVertices:n.totalVertices}),r();break;case"indices":o=n.data;break;case"attribute":l.push({kind:n.kind,data:n.data,size:n.size,byteOffset:n.byteOffset,byteStride:n.byteStride,normalized:(s=n.kind,f=n.normalized,i&&void 0!==i[s]?(f!==i[s]&&jh.Warn(`Normalized flag from Draco data (${f}) does not match normalized flag from glTF accessor (${i[s]}). Using flag from glTF accessor.`),i[s]):f)})}var s,f};e.addEventListener("error",c),e.addEventListener("message",h);const f=n.slice();e.postMessage({id:"decodeMesh",dataView:f,attributes:t},[f.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((e=>{let i=null;const a=[],s=YA(e.module,n,t,(e=>{i=e}),((e,t,i,n,s,r)=>{a.push({kind:e,data:t,size:i,byteOffset:n,byteStride:s,normalized:r})}));return{indices:i,attributes:a,totalVertices:s}}));throw new Error("Draco decoder module is not available")}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}async _decodeMeshToGeometryForGltfAsync(e,t,i,n,a){const s=await this.decodeMeshToMeshDataAsync(i,n,a),r=new md(e,t);s.indices&&r.setIndices(s.indices);for(const e of s.attributes)r.setVerticesBuffer(new $h(t.getEngine(),e.data,e.kind,!1,void 0,e.byteStride,void 0,e.byteOffset,e.size,void 0,e.normalized,!0),s.totalVertices);return r}static GetDefaultNumWorkers(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static ResetDefault(t){e._Default&&(t||e._Default.dispose(),e._Default=null)}async decodeMeshToGeometryAsync(e,t,i,n){const a=await this.decodeMeshToMeshDataAsync(i,n),s=new md(e,t);a.indices&&s.setIndices(a.indices);for(const e of a.attributes)s.setVerticesBuffer(new $h(t.getEngine(),e.data,e.kind,!1,void 0,e.byteStride,void 0,e.byteOffset,e.size,void 0,e.normalized,!0),a.totalVertices);return s}constructor(t=e.DefaultNumWorkers){const i=e.Configuration.decoder;if(i.workerPool||"object"==typeof t&&t.workerPool)this._workerPoolPromise=Promise.resolve(i.workerPool||t.workerPool);else{const e=i.wasmBinary||"object"==typeof t&&t.wasmBinary,n="number"==typeof t?t:t.numWorkers,a=n&&"function"==typeof Worker&&"function"==typeof URL,s=a||!a&&!i.jsModule,r=i.wasmUrl&&i.wasmBinaryUrl&&"object"==typeof WebAssembly?{url:s?ad.GetBabylonScriptURL(i.wasmUrl,!0):"",wasmBinaryPromise:e?Promise.resolve(e):ad.LoadFileAsync(ad.GetBabylonScriptURL(i.wasmBinaryUrl,!0))}:{url:s?ad.GetBabylonScriptURL(i.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};a?this._workerPoolPromise=r.wasmBinaryPromise.then((e=>{const t=`${YA}(${jA})()`,i=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));return new XA(n,(()=>function(e,t,i){return new Promise(((n,a)=>{const s=t=>{e.removeEventListener("error",s),e.removeEventListener("message",r),a(t)},r=t=>{"initDone"===t.data.id&&(e.removeEventListener("error",s),e.removeEventListener("message",r),n(e))};if(e.addEventListener("error",s),e.addEventListener("message",r),t){const n=t.slice(0);e.postMessage({id:"init",decoder:{url:i,wasmBinary:n}},[n])}else e.postMessage({id:"init",decoder:{url:i}})}))}(new Worker(i),e,r.url)))})):this._decoderModulePromise=r.wasmBinaryPromise.then((async e=>{if("undefined"==typeof DracoDecoderModule&&!i.jsModule){if(!r.url)throw new Error("Draco decoder module is not available");await ad.LoadBabylonScriptAsync(r.url)}return await(t=e,n=i.jsModule,new Promise((e=>{(n||DracoDecoderModule)({wasmBinary:t}).then((t=>{e({module:t})}))})));var t,n}))}}static get DecoderAvailable(){const t=e.Configuration.decoder;return!!(t.wasmUrl&&t.wasmBinaryUrl&&"object"==typeof WebAssembly||t.fallbackUrl)}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((e=>{e.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}static get Default(){return e._Default||(e._Default=new e),e._Default}async decodeMeshAsync(e,t){const i=await this.decodeMeshToMeshDataAsync(e,t),n=new _f;i.indices&&(n.indices=i.indices);for(const e of i.attributes){const t=$h.GetFloatData(e.data,e.size,$h.GetDataType(e.data),e.byteOffset,e.byteStride,e.normalized,i.totalVertices);n.set(t,e.kind)}return n}};KA.Configuration={decoder:{wasmUrl:`${ad._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${ad._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${ad._DefaultCdnUrl}/draco_decoder_gltf.js`}},KA.DefaultNumWorkers=KA.GetDefaultNumWorkers(),KA._Default=null;var $A="KHR_draco_mesh_compression",qA=class{dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{if(null!=t.mode&&4!==t.mode&&5!==t.mode)throw new Error(`${e}: Unsupported mode ${t.mode}`);const s={},r={},o=(e,n)=>{const o=a.attributes[e];if(null!=o&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(n)&&i._delayInfo.push(n),s[n]=o,this.useNormalizedFlagFromAccessor)){const i=MA.TryGet(this._loader.gltf.accessors,t.attributes[e]);i&&(r[n]=i.normalized||!1)}};o("POSITION",$h.PositionKind),o("NORMAL",$h.NormalKind),o("TANGENT",$h.TangentKind),o("TEXCOORD_0",$h.UVKind),o("TEXCOORD_1",$h.UV2Kind),o("TEXCOORD_2",$h.UV3Kind),o("TEXCOORD_3",$h.UV4Kind),o("TEXCOORD_4",$h.UV5Kind),o("TEXCOORD_5",$h.UV6Kind),o("JOINTS_0",$h.MatricesIndicesKind),o("WEIGHTS_0",$h.MatricesWeightsKind),o("COLOR_0",$h.ColorKind);const l=MA.Get(n,this._loader.gltf.bufferViews,a.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((t=>(this.dracoCompression||KA.Default)._decodeMeshToGeometryForGltfAsync(i.name,this._loader.babylonScene,t,s,r).catch((t=>{throw new Error(`${e}: ${t.message}`)}))))),l._dracoBabylonGeometry}))}constructor(e){this.name=$A,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=KA.DecoderAvailable&&this._loader.isExtensionUsed($A)}};IA.RegisterExtension($A,(e=>new qA(e)));var JA="KHR_lights_punctual",QA=class{onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights,MA.Assign(this._lights)}}loadNodeAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(e,t,(e=>{let t;const s=MA.Get(n,this._lights,a.light),r=s.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,s.type){case"directional":{const e=new vv(r,wh.Backward(),this._loader.babylonScene);e.position.setAll(0),t=e;break}case"point":t=new EE(r,wh.Zero(),this._loader.babylonScene);break;case"spot":{const e=new AE(r,wh.Zero(),wh.Backward(),0,1,this._loader.babylonScene);e.angle=2*(s.spot&&s.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(s.spot&&s.spot.innerConeAngle||0),t=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${n}: Invalid light type (${s.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=t,t.falloffType=mv.FALLOFF_GLTF,t.diffuse=s.color?Ah.FromArray(s.color):Ah.White(),t.intensity=null==s.intensity?1:s.intensity,t.range=null==s.range?Number.MAX_VALUE:s.range,t.parent=e,this._loader._babylonLights.push(t),IA.AddPointerMetadata(t,n),i(e)})))))}dispose(){this._loader=null,delete this._lights}constructor(e){this.name=JA,this._loader=e,this.enabled=this._loader.isExtensionUsed(JA)}};IA.RegisterExtension(JA,(e=>new QA(e)));var ZA="KHR_materials_pbrSpecularGlossiness",eC=class{dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loadSpecularGlossinessPropertiesAsync(n,a,i)),this._loader.loadMaterialAlphaProperties(e,t,i),Promise.all(s).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;return i.metallic=null,i.roughness=null,t.diffuseFactor?(i.albedoColor=Ah.FromArray(t.diffuseFactor),i.alpha=t.diffuseFactor[3]):i.albedoColor=Ah.White(),i.reflectivityColor=t.specularFactor?Ah.FromArray(t.specularFactor):Ah.White(),i.microSurface=null==t.glossinessFactor?1:t.glossinessFactor,t.diffuseTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,t.diffuseTexture,(e=>{e.name=`${i.name} (Diffuse)`,i.albedoTexture=e}))),t.specularGlossinessTexture&&(n.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,t.specularGlossinessTexture,(e=>{e.name=`${i.name} (Specular Glossiness)`,i.reflectivityTexture=e,i.reflectivityTexture.hasAlpha=!0}))),i.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(n).then((()=>{}))}constructor(e){this.name=ZA,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(ZA)}};IA.RegisterExtension(ZA,(e=>new eC(e)));var tC="KHR_materials_unlit",iC=class{_loadUnlitPropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;i.unlit=!0;const a=t.pbrMetallicRoughness;return a&&(a.baseColorFactor?(i.albedoColor=Ah.FromArray(a.baseColorFactor),i.alpha=a.baseColorFactor[3]):i.albedoColor=Ah.White(),a.baseColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,a.baseColorTexture,(e=>{e.name=`${i.name} (Base Color)`,i.albedoTexture=e})))),t.doubleSided&&(i.backFaceCulling=!1,i.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,i),Promise.all(n).then((()=>{}))}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,(()=>this._loadUnlitPropertiesAsync(e,t,i)))}dispose(){this._loader=null}constructor(e){this.name=tC,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(tC)}};IA.RegisterExtension(tC,(e=>new iC(e)));var nC="KHR_materials_clearcoat",aC=class{_loadClearCoatPropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;return i.clearCoat.isEnabled=!0,i.clearCoat.useRoughnessFromMainTexture=!1,i.clearCoat.remapF0OnInterfaceChange=!1,null!=t.clearcoatFactor?i.clearCoat.intensity=t.clearcoatFactor:i.clearCoat.intensity=0,t.clearcoatTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,t.clearcoatTexture,(e=>{e.name=`${i.name} (ClearCoat Intensity)`,i.clearCoat.texture=e}))),null!=t.clearcoatRoughnessFactor?i.clearCoat.roughness=t.clearcoatRoughnessFactor:i.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,(e=>{e.name=`${i.name} (ClearCoat Roughness)`,i.clearCoat.textureRoughness=e})))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,t.clearcoatNormalTexture,(e=>{e.name=`${i.name} (ClearCoat Normal)`,i.clearCoat.bumpTexture=e}))),i.invertNormalMapX=!i.getScene().useRightHandedSystem,i.invertNormalMapY=i.getScene().useRightHandedSystem,null!=t.clearcoatNormalTexture.scale&&(i.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(n).then((()=>{}))}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadClearCoatPropertiesAsync(n,a,i)),Promise.all(s).then((()=>{}))}))}dispose(){this._loader=null}constructor(e){this.name=nC,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(nC)}};IA.RegisterExtension(nC,(e=>new aC(e)));var sC="KHR_materials_iridescence",rC=class{loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadIridescencePropertiesAsync(n,a,i)),Promise.all(s).then((()=>{}))}))}dispose(){this._loader=null}_loadIridescencePropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;return i.iridescence.isEnabled=!0,i.iridescence.intensity=t.iridescenceFactor??0,i.iridescence.indexOfRefraction=t.iridescenceIor??t.iridescenceIOR??1.3,i.iridescence.minimumThickness=t.iridescenceThicknessMinimum??100,i.iridescence.maximumThickness=t.iridescenceThicknessMaximum??400,t.iridescenceTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,t.iridescenceTexture,(e=>{e.name=`${i.name} (Iridescence Intensity)`,i.iridescence.texture=e}))),t.iridescenceThicknessTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,(e=>{e.name=`${i.name} (Iridescence Thickness)`,i.iridescence.thicknessTexture=e}))),Promise.all(n).then((()=>{}))}constructor(e){this.name=sC,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(sC)}};IA.RegisterExtension(sC,(e=>new rC(e)));var oC="KHR_materials_anisotropy",lC=class{dispose(){this._loader=null}_loadIridescencePropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;return i.anisotropy.isEnabled=!0,i.anisotropy.intensity=t.anisotropyStrength??0,i.anisotropy.angle=t.anisotropyRotation??0,t.anisotropyTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/anisotropyTexture`,t.anisotropyTexture,(e=>{e.name=`${i.name} (Anisotropy Intensity)`,i.anisotropy.texture=e}))),Promise.all(n).then((()=>{}))}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadIridescencePropertiesAsync(n,a,i)),Promise.all(s).then((()=>{}))}))}constructor(e){this.name=oC,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(oC)}};IA.RegisterExtension(oC,(e=>new lC(e)));var cC="KHR_materials_emissive_strength",hC=class{_loadEmissiveProperties(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);void 0!==t.emissiveStrength&&(i.emissiveIntensity=t.emissiveStrength)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>this._loader.loadMaterialPropertiesAsync(e,t,i).then((()=>{this._loadEmissiveProperties(n,a,i)}))))}constructor(e){this.name=cC,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(cC)}};IA.RegisterExtension(cC,(e=>new hC(e)));var fC="KHR_materials_sheen",uC=class{dispose(){this._loader=null}constructor(e){this.name=fC,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(fC)}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadSheenPropertiesAsync(n,a,i)),Promise.all(s).then((()=>{}))}))}_loadSheenPropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;return i.sheen.isEnabled=!0,i.sheen.intensity=1,null!=t.sheenColorFactor?i.sheen.color=Ah.FromArray(t.sheenColorFactor):i.sheen.color=Ah.Black(),t.sheenColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,t.sheenColorTexture,(e=>{e.name=`${i.name} (Sheen Color)`,i.sheen.texture=e}))),void 0!==t.sheenRoughnessFactor?i.sheen.roughness=t.sheenRoughnessFactor:i.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,t.sheenRoughnessTexture,(e=>{e.name=`${i.name} (Sheen Roughness)`,i.sheen.textureRoughness=e})))),i.sheen.albedoScaling=!0,i.sheen.useRoughnessFromMainTexture=!1,Promise.all(n).then((()=>{}))}};IA.RegisterExtension(fC,(e=>new uC(e)));var dC="KHR_materials_specular",mC=class{constructor(e){this.name=dC,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(dC)}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadSpecularPropertiesAsync(n,a,i)),Promise.all(s).then((()=>{}))}))}dispose(){this._loader=null}_loadSpecularPropertiesAsync(e,t,i){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const n=new Array;return void 0!==t.specularFactor&&(i.metallicF0Factor=t.specularFactor),void 0!==t.specularColorFactor&&(i.metallicReflectanceColor=Ah.FromArray(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,t.specularTexture,(e=>{e.name=`${i.name} (Specular F0 Strength)`,i.metallicReflectanceTexture=e,i.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),t.specularColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,t.specularColorTexture,(e=>{e.name=`${i.name} (Specular F0 Color)`,i.reflectanceTexture=e}))),Promise.all(n).then((()=>{}))}};IA.RegisterExtension(dC,(e=>new mC(e)));var pC="KHR_materials_ior",_C=class e{loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadIorPropertiesAsync(n,a,i)),Promise.all(s).then((()=>{}))}))}constructor(e){this.name=pC,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(pC)}dispose(){this._loader=null}_loadIorPropertiesAsync(t,i,n){if(!(n instanceof gA))throw new Error(`${t}: Material type not supported`);return void 0!==i.ior?n.indexOfRefraction=i.ior:n.indexOfRefraction=e._DEFAULT_IOR,Promise.resolve()}};_C._DEFAULT_IOR=1.5,IA.RegisterExtension(pC,(e=>new _C(e)));var vC="KHR_materials_variants",gC=class e{static GetLastSelectedVariant(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${vC} extension`);return t.lastSelected}static Reset(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error(`Cannot reset on a glTF mesh that does not have the ${vC} extension`);for(const e of t.original)e.mesh.material=e.material;t.lastSelected=null}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._variants=t.variants}}reset(t){e.Reset(t)}static SelectVariant(e,t){const i=this._GetExtensionMetadata(e);if(!i)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${vC} extension`);const n=e=>{const t=i.variants[e];if(t)for(const e of t)e.mesh.material=e.material};if(t instanceof Array)for(const e of t)n(e);else n(t);i.lastSelected=t}constructor(e){this.name=vC,this._loader=e,this.enabled=this._loader.isExtensionUsed(vC)}selectVariant(t,i){e.SelectVariant(t,i)}dispose(){this._loader=null}getLastSelectedVariant(t){return e.GetLastSelectedVariant(t)}_loadMeshPrimitiveAsync(t,i,n,a,s,r){return IA.LoadExtensionAsync(t,s,this.name,((o,l)=>{const c=new Array;return c.push(this._loader._loadMeshPrimitiveAsync(t,i,n,a,s,(i=>{if(r(i),i instanceof wm){const n=IA._GetDrawMode(t,s.mode),a=this._loader.rootBabylonMesh,r=a?a._internalMetadata=a._internalMetadata||{}:{},h=r.gltf=r.gltf||{},f=h[vC]=h[vC]||{lastSelected:null,original:[],variants:{}};f.original.push({mesh:i,material:i.material});for(let t=0;t<l.mappings.length;++t){const s=l.mappings[t],r=MA.Get(`${o}/mappings/${t}/material`,this._loader.gltf.materials,s.material);c.push(this._loader._loadMaterialAsync(`#/materials/${s.material}`,r,i,n,(t=>{for(let n=0;n<s.variants.length;++n){const r=s.variants[n],o=MA.Get(`/extensions/${vC}/variants/${r}`,this._variants,r);f.variants[o.name]=f.variants[o.name]||[],f.variants[o.name].push({mesh:i,material:t}),i.onClonedObservable.add((t=>{const n=t;let s=null,r=n;do{if(r=r.parent,!r)return;s=e._GetExtensionMetadata(r)}while(null===s);if(a&&s===e._GetExtensionMetadata(a)){r._internalMetadata={};for(const e in a._internalMetadata)r._internalMetadata[e]=a._internalMetadata[e];r._internalMetadata.gltf=[];for(const e in a._internalMetadata.gltf)r._internalMetadata.gltf[e]=a._internalMetadata.gltf[e];r._internalMetadata.gltf[vC]={lastSelected:null,original:[],variants:{}};for(const e of s.original)r._internalMetadata.gltf[vC].original.push({mesh:e.mesh,material:e.material});for(const e in s.variants)if(Object.prototype.hasOwnProperty.call(s.variants,e)){r._internalMetadata.gltf[vC].variants[e]=[];for(const t of s.variants[e])r._internalMetadata.gltf[vC].variants[e].push({mesh:t.mesh,material:t.material})}s=r._internalMetadata.gltf[vC]}for(const e of s.original)e.mesh===i&&(e.mesh=n);for(const e of s.variants[o.name])e.mesh===i&&(e.mesh=n)}))}})))}}}))),Promise.all(c).then((([e])=>e))}))}getAvailableVariants(t){return e.GetAvailableVariants(t)}static GetAvailableVariants(e){const t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]}static _GetExtensionMetadata(e){return e?._internalMetadata?.gltf?.[vC]||null}};IA.RegisterExtension(vC,(e=>new gC(e)));var SC=class e{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Ug.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}_onMeshMaterialChanged(e){const t=this._transparentMeshesCache.indexOf(e),i=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof gA&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==i?(this._opaqueMeshesCache.splice(i,1),this._transparentMeshesCache.push(e)):-1===t&&this._transparentMeshesCache.push(e)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):-1===i&&this._opaqueMeshesCache.push(e)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}getOpaqueTarget(){return this._opaqueRenderTarget}_isRenderTargetValid(){return null!==this._opaqueRenderTarget?.getInternalTexture()}_addMesh(e){this._materialObservers[e.xt]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),ad.SetImmediate((()=>{this._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(e)&&this._transparentMeshesCache.push(e)):-1===this._opaqueMeshesCache.indexOf(e)&&this._opaqueMeshesCache.push(e)}))}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.xt]),delete this._materialObservers[e.xt];let t=this._transparentMeshesCache.indexOf(e);-1!==t&&this._transparentMeshesCache.splice(t,1),t=this._opaqueMeshesCache.indexOf(e),-1!==t&&this._opaqueMeshesCache.splice(t,1)}_setupRenderTargets(){let e,t;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new qp("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.Pt=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=this._options.clearColor?.clone()??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((i=>{t=this._scene.environmentIntensity,this._scene.environmentIntensity=1,e=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?i.clearColor.copyFrom(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(i.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=t,this._scene.imageProcessingConfiguration._applyByPostProcess=e})),this._transparentMeshesCache.forEach((e=>{this._shouldRenderAsTransmission(e.material)&&(e.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}constructor(t,i){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...e._GetDefaultOptions(),...t},this._scene=i,this._scene._transmissionHelper=this,this.onErrorObservable=new Ih,this._scene.onDisposeObservable.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(e){if(!Object.keys(e).filter((t=>this._options[t]!==e[t])).length)return;const t={...this._options,...e},i=this._options;this._options=t,t.renderSize===i.renderSize&&t.renderTargetTextureType===i.renderTargetTextureType&&t.generateMipmaps===i.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=t.samples,this._opaqueRenderTarget.lodGenerationScale=t.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=t.lodGenerationOffset):this._setupRenderTargets()}_shouldRenderAsTransmission(e){return!!e&&!!(e instanceof gA&&e.subSurface.isRefractionEnabled)}},yC="KHR_materials_transmission",EC=class{dispose(){this._loader=null}constructor(e){this.name=yC,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(yC),this.enabled&&(e.parent.transparencyAsCoverage=!0)}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadTransparentPropertiesAsync(n,t,i,a)),Promise.all(s).then((()=>{}))}))}_loadTransparentPropertiesAsync(e,t,i,n){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const a=i;if(a.subSurface.isRefractionEnabled=!0,a.subSurface.volumeIndexOfRefraction=1,a.subSurface.useAlbedoToTintRefraction=!0,void 0===n.transmissionFactor)return a.subSurface.refractionIntensity=0,a.subSurface.isRefractionEnabled=!1,Promise.resolve();{a.subSurface.refractionIntensity=n.transmissionFactor;const e=a.getScene();a.subSurface.refractionIntensity&&!e._transmissionHelper?new SC({},a.getScene()):a.subSurface.refractionIntensity&&!e._transmissionHelper?._isRenderTargetValid()&&e._transmissionHelper?._setupRenderTargets()}return a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=0,n.transmissionTexture?(n.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,n.transmissionTexture,void 0).then((e=>{a.subSurface.refractionIntensityTexture=e,a.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}};IA.RegisterExtension(yC,(e=>new EC(e)));var AC="KHR_materials_diffuse_transmission",CC=class{loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadTranslucentPropertiesAsync(n,t,i,a)),Promise.all(s).then((()=>{}))}))}dispose(){this._loader=null}_loadTranslucentPropertiesAsync(e,t,i,n){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);const a=i;if(a.subSurface.isTranslucencyEnabled=!0,a.subSurface.volumeIndexOfRefraction=1,a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=0,a.subSurface.useAlbedoToTintTranslucency=!1,void 0===n.diffuseTransmissionFactor)return a.subSurface.translucencyIntensity=0,a.subSurface.isTranslucencyEnabled=!1,Promise.resolve();a.subSurface.translucencyIntensity=n.diffuseTransmissionFactor;const s=new Array;return a.subSurface.useGltfStyleTextures=!0,n.diffuseTransmissionTexture&&(n.diffuseTransmissionTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionTexture`,n.diffuseTransmissionTexture).then((e=>{a.subSurface.translucencyIntensityTexture=e})))),void 0!==n.diffuseTransmissionColorFactor?a.subSurface.translucencyColor=Ah.FromArray(n.diffuseTransmissionColorFactor):a.subSurface.translucencyColor=Ah.White(),n.diffuseTransmissionColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionColorTexture`,n.diffuseTransmissionColorTexture).then((e=>{a.subSurface.translucencyColorTexture=e}))),Promise.all(s).then((()=>{}))}constructor(e){this.name=AC,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(AC),this.enabled&&(e.parent.transparencyAsCoverage=!0)}};IA.RegisterExtension(AC,(e=>new CC(e)));var RC="KHR_materials_volume",TC=class{constructor(e){this.name=RC,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(RC),this.enabled&&this._loader._disableInstancedMesh++}_loadVolumePropertiesAsync(e,t,i,n){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);if(!i.subSurface.isRefractionEnabled&&!i.subSurface.isTranslucencyEnabled||!n.thicknessFactor)return Promise.resolve();i.subSurface.volumeIndexOfRefraction=i.indexOfRefraction;const a=void 0!==n.attenuationDistance?n.attenuationDistance:Number.MAX_VALUE;return i.subSurface.tintColorAtDistance=a,void 0!==n.attenuationColor&&3==n.attenuationColor.length&&i.subSurface.tintColor.copyFromFloats(n.attenuationColor[0],n.attenuationColor[1],n.attenuationColor[2]),i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=n.thicknessFactor,i.subSurface.useThicknessAsDepth=!0,n.thicknessTexture?(n.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,n.thicknessTexture).then((e=>{i.subSurface.thicknessTexture=e,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadVolumePropertiesAsync(n,t,i,a)),Promise.all(s).then((()=>{}))}))}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}};IA.RegisterExtension(RC,(e=>new TC(e)));var NC="KHR_materials_dispersion",MC=class{constructor(e){this.name=NC,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(NC)}_loadDispersionPropertiesAsync(e,t,i,n){if(!(i instanceof gA))throw new Error(`${e}: Material type not supported`);return i.subSurface.isRefractionEnabled&&n.dispersion?(i.subSurface.isDispersionEnabled=!0,i.subSurface.dispersion=n.dispersion,Promise.resolve()):Promise.resolve()}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=new Array;return s.push(this._loader.loadMaterialBasePropertiesAsync(e,t,i)),s.push(this._loader.loadMaterialPropertiesAsync(e,t,i)),s.push(this._loadDispersionPropertiesAsync(n,t,i,a)),Promise.all(s).then((()=>{}))}))}dispose(){this._loader=null}};IA.RegisterExtension(NC,(e=>new MC(e)));var IC="KHR_mesh_quantization",xC=class{dispose(){}constructor(e){this.name=IC,this.enabled=e.isExtensionUsed(IC)}};IA.RegisterExtension(IC,(e=>new xC(e)));var bC="KHR_texture_basisu",PC=class{constructor(e){this.name=bC,this._loader=e,this.enabled=e.isExtensionUsed(bC)}dispose(){this._loader=null}_loadTextureAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>{const s=null==t.sampler?IA.DefaultSampler:MA.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),r=MA.Get(`${n}/source`,this._loader.gltf.images,a.source);return this._loader._createTextureAsync(e,s,r,(e=>{i(e)}),t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)}))}};IA.RegisterExtension(bC,(e=>new PC(e)));var wC="KHR_texture_transform",OC=class{dispose(){this._loader=null}loadTextureInfoAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((n,a)=>this._loader.loadTextureInfoAsync(e,t,(e=>{if(!(e instanceof yp))throw new Error(`${n}: Texture type not supported`);a.offset&&(e.uOffset=a.offset[0],e.vOffset=a.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,a.rotation&&(e.wAng=-a.rotation),a.scale&&(e.uScale=a.scale[0],e.vScale=a.scale[1]),null!=a.texCoord&&(e.coordinatesIndex=a.texCoord),i(e)}))))}constructor(e){this.name=wC,this._loader=e,this.enabled=this._loader.isExtensionUsed(wC)}};IA.RegisterExtension(wC,(e=>new OC(e)));var DC="KHR_xmp_json_ld",LC=class{dispose(){this._loader=null}constructor(e){this.name=DC,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(DC)}onLoading(){if(null===this._loader.rootBabylonMesh)return;const e=this._loader.gltf.extensions?.KHR_xmp_json_ld,t=this._loader.gltf.asset?.extensions?.KHR_xmp_json_ld;if(e&&t){const i=+t.packet;e.packets&&i<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[i])}}};function FC(e,t,i,n){return Ah.FromArray(t,i).scale(n)}function kC(e,t,i,n){return t[i]*n}function BC(e,t,i,n){return-t[i]*n}function GC(e,t,i,n){return t[i+1]*n}function UC(e,t,i,n){return t[i]*n*2}function HC(e){return{scale:[new WC(Ov.ANIMATIONTYPE_FLOAT,`${e}.uScale`,kC,(()=>2)),new WC(Ov.ANIMATIONTYPE_FLOAT,`${e}.vScale`,GC,(()=>2))],offset:[new WC(Ov.ANIMATIONTYPE_FLOAT,`${e}.uOffset`,kC,(()=>2)),new WC(Ov.ANIMATIONTYPE_FLOAT,`${e}.vOffset`,GC,(()=>2))],rotation:[new WC(Ov.ANIMATIONTYPE_FLOAT,`${e}.wAng`,BC,(()=>1))]}}IA.RegisterExtension(DC,(e=>new LC(e)));var VC=class extends CA{buildAnimations(e,t,i,n,a){a(e._babylonCamera,this._buildAnimation(t,i,n))}},WC=class extends CA{buildAnimations(e,t,i,n,a){for(const s in e._data)a(e._data[s].babylonMaterial,this._buildAnimation(t,i,n))}},zC=class extends CA{buildAnimations(e,t,i,n,a){a(e._babylonLight,this._buildAnimation(t,i,n))}},XC={__array__:{__target__:!0,...TA}},YC={__array__:{__target__:!0,orthographic:{xmag:[new VC(Ov.ANIMATIONTYPE_FLOAT,"orthoLeft",BC,(()=>1)),new VC(Ov.ANIMATIONTYPE_FLOAT,"orthoRight",GC,(()=>1))],ymag:[new VC(Ov.ANIMATIONTYPE_FLOAT,"orthoBottom",BC,(()=>1)),new VC(Ov.ANIMATIONTYPE_FLOAT,"orthoTop",GC,(()=>1))],zfar:[new VC(Ov.ANIMATIONTYPE_FLOAT,"maxZ",kC,(()=>1))],znear:[new VC(Ov.ANIMATIONTYPE_FLOAT,"minZ",kC,(()=>1))]},perspective:{yfov:[new VC(Ov.ANIMATIONTYPE_FLOAT,"fov",kC,(()=>1))],zfar:[new VC(Ov.ANIMATIONTYPE_FLOAT,"maxZ",kC,(()=>1))],znear:[new VC(Ov.ANIMATIONTYPE_FLOAT,"minZ",kC,(()=>1))]}}},jC={nodes:XC,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new WC(Ov.ANIMATIONTYPE_COLOR3,"albedoColor",FC,(()=>4)),new WC(Ov.ANIMATIONTYPE_FLOAT,"alpha",(function(e,t,i,n){return t[i+3]*n}),(()=>4))],metallicFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"metallic",kC,(()=>1))],roughnessFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"roughness",kC,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:HC("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:HC("metallicTexture")}}},emissiveFactor:[new WC(Ov.ANIMATIONTYPE_COLOR3,"emissiveColor",FC,(()=>3))],normalTexture:{scale:[new WC(Ov.ANIMATIONTYPE_FLOAT,"bumpTexture.level",kC,(()=>1))],extensions:{KHR_texture_transform:HC("bumpTexture")}},occlusionTexture:{strength:[new WC(Ov.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",kC,(()=>1))],extensions:{KHR_texture_transform:HC("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:HC("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new WC(Ov.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",kC,(()=>1))],anisotropyRotation:[new WC(Ov.ANIMATIONTYPE_FLOAT,"anisotropy.angle",kC,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:HC("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",kC,(()=>1))],clearcoatRoughnessFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",kC,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:HC("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new WC(Ov.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",kC,(()=>1))],extensions:{KHR_texture_transform:HC("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:HC("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new WC(Ov.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",kC,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new WC(Ov.ANIMATIONTYPE_FLOAT,"emissiveIntensity",kC,(()=>1))]},KHR_materials_ior:{ior:[new WC(Ov.ANIMATIONTYPE_FLOAT,"indexOfRefraction",kC,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"iridescence.intensity",kC,(()=>1))],iridescenceIor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",kC,(()=>1))],iridescenceThicknessMinimum:[new WC(Ov.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",kC,(()=>1))],iridescenceThicknessMaximum:[new WC(Ov.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",kC,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:HC("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:HC("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new WC(Ov.ANIMATIONTYPE_COLOR3,"sheen.color",FC,(()=>3))],sheenRoughnessFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"sheen.roughness",kC,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:HC("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:HC("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"metallicF0Factor",kC,(()=>1))],specularColorFactor:[new WC(Ov.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",FC,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:HC("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:HC("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",kC,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:HC("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new WC(Ov.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",FC,(()=>3))],attenuationDistance:[new WC(Ov.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",kC,(()=>1))],thicknessFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",kC,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:HC("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new WC(Ov.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",kC,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:HC("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new WC(Ov.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",FC,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:HC("subSurface.translucencyColorTexture")}}}}}},cameras:YC,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new zC(Ov.ANIMATIONTYPE_COLOR3,"diffuse",FC,(()=>3))],intensity:[new zC(Ov.ANIMATIONTYPE_FLOAT,"intensity",kC,(()=>1))],range:[new zC(Ov.ANIMATIONTYPE_FLOAT,"range",kC,(()=>1))],spot:{innerConeAngle:[new zC(Ov.ANIMATIONTYPE_FLOAT,"innerAngle",UC,(()=>1))],outerConeAngle:[new zC(Ov.ANIMATIONTYPE_FLOAT,"angle",UC,(()=>1))]}}}}}},KC=class{convert(e){let t,i=this._gltf,n=this._infoTree;if(!e.startsWith("/"))throw new Error("Path must start with a /");const a=e.split("/");a.shift();for(const s of a){if(n.__array__)n=n.__array__;else if(n=n[s],!n)throw new Error(`Path ${e} is invalid`);if(void 0===i)throw new Error(`Path ${e} is invalid`);i=i[s],n.__target__&&(t=i)}return{object:t,info:n}}constructor(e,t){this._gltf=e,this._infoTree=t}},$C="KHR_animation_pointer",qC=class extends KC{constructor(e){super(e,jC)}},JC=class{constructor(e){this.name=$C,this._loader=e,this._pathToObjectConverter=new qC(this._loader.gltf)}dispose(){this._loader=null,delete this._pathToObjectConverter}get enabled(){return this._loader.isExtensionUsed($C)}_loadAnimationChannelAsync(e,t,i,n,a){const s=n.target.extensions?.KHR_animation_pointer;if(!s||!this._pathToObjectConverter)return null;"pointer"!==n.target.path&&jh.Warn(`${e}/target/path: Value (${n.target.path}) must be (pointer) when using the ${this.name} extension`),null!=n.target.node&&jh.Warn(`${e}/target/node: Value (${n.target.node}) must not be present when using the ${this.name} extension`);const r=`${e}/extensions/${this.name}`,o=s.pointer;if(!o)throw new Error(`${r}: Pointer is missing`);try{const s=this._pathToObjectConverter.convert(o);return this._loader._loadAnimationChannelFromTargetInfoAsync(e,t,i,n,s,a)}catch(e){return jh.Warn(`${r}/pointer: Invalid pointer (${o}) skipped`),null}}};IA.RegisterExtension($C,(e=>new JC(e)));var QC=class e{set directionalConeOuterAngle(e){if(e!=this._coneOuterAngle){if(e<this._coneInnerAngle)return void jh.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e,Md.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}attachToMesh(e){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=e,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=e=>this._onRegisterAfterWorldMatrixUpdate(e),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}getClassName(){return"Sound"}_onRegisterAfterWorldMatrixUpdate(e){if(e.getBoundingInfo){const t=e.getBoundingInfo();this.setPosition(t.boundingSphere.centerWorld)}else this.setPosition(e.absolutePosition);Md.audioEngine?.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}connectToSoundTrackAudioNode(e){Md.audioEngine?.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(e),this._isOutputConnected=!0)}_soundLoaded(e){Md.audioEngine?.audioContext&&Md.audioEngine.audioContext.decodeAudioData(e,(e=>{this._audioBufferLoaded(e)}),(e=>{jh.Error("Error while decoding audio data for: "+this.name+" / Error: "+e)}))}_switchPanningModel(){Md.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}updateOptions(e){e&&(this.loop=e.loop??this.loop,this.maxDistance=e.maxDistance??this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor??this.rolloffFactor,this.refDistance=e.refDistance??this.refDistance,this.distanceModel=e.distanceModel??this.distanceModel,this._playbackRate=e.playbackRate??this._playbackRate,this._length=e.length??void 0,this.spatialSound=e.spatialSound??this._spatialSound,this._setOffset(e.offset??void 0),this.setVolume(e.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_clearTimeoutsAndObservers(){this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver&&(Md.audioEngine?.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}set directionalConeInnerAngle(e){if(e!=this._coneInnerAngle){if(this._coneOuterAngle<e)return void jh.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e,Md.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}setAudioBuffer(e){Md.audioEngine?.canUseWebAudio&&(this._audioBuffer=e,this._isReadyToPlay=!0)}setDirectionalCone(e,t,i){t<e?jh.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=e,this._coneOuterAngle=t,this._coneOuterGain=i,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}dispose(){Md.audioEngine?.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}getAudioBuffer(){return this._audioBuffer}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}setAttenuationFunction(e){this._customAttenuationFunction=e}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}serialize(){const e={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(e.connectedMeshId=this._connectedTransformNode.id),e.position=this._position.asArray(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.asArray(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e}setLocalDirectionToMesh(e){this._localDirection=e,Md.audioEngine?.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}get currentTime(){if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(Md.audioEngine?.audioContext&&(this.isPlaying||this.isPaused)){const e=this.isPaused?0:Md.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+e}return 0}_setOffset(e){this._offset!==e&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=e)}set spatialSound(e){if(e==this._spatialSound)return;const t=this.isPlaying;this.pause(),e?(this._spatialSound=e,this._updateSpatialParameters()):this._disableSpatialSound(),t&&this.play()}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_createSpatialParameters(){Md.audioEngine?.canUseWebAudio&&Md.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Md.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}stop(e){if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(Md.audioEngine?.audioContext&&this._soundSource){const t=e?Md.audioEngine.audioContext.currentTime+e:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(t)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}get directionalConeInnerAngle(){return this._coneInnerAngle}static Parse(t,i,n,a){const s=t.name;let r;r=t.url?n+t.url:n+s;const o={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};let l;if(a){const t=()=>{a._isReadyToPlay?(l._audioBuffer=a.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,l._offset,l._length)):setTimeout(t,300)};l=new e(s,new ArrayBuffer(0),i,null,o),t()}else l=new e(s,r,i,(()=>{i.removePendingData(l)}),o),i.addPendingData(l);if(t.position){const e=wh.FromArray(t.position);l.setPosition(e)}if(t.isDirectional&&(l.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){const e=wh.FromArray(t.localDirectionToMesh);l.setLocalDirectionToMesh(e)}if(t.connectedMeshId){const e=i.getMeshById(t.connectedMeshId);e&&l.attachToMesh(e)}return t.metadata&&(l.metadata=t.metadata),l}pause(){this.isPlaying&&(this._clearTimeoutsAndObservers(),this._streaming?(this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect(),this.isPlaying=!1,this.isPaused=!0):Md.audioEngine?.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Md.audioEngine.audioContext.currentTime-this._startTime))}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}isReady(){return this._isReadyToPlay}getPlaybackRate(){return this._playbackRate}set loop(e){e!==this._loop&&(this._loop=e,this.updateOptions({loop:e}))}getVolume(){return this._volume}setVolume(e,t){Md.audioEngine?.canUseWebAudio&&this._soundGain&&(t&&Md.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Md.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Md.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(e,Md.audioEngine.audioContext.currentTime+t)):this._soundGain.gain.value=e),this._volume=e}clone(){if(this._streaming)return null;{const t=()=>{this._isReadyToPlay?(n._audioBuffer=this.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play(0,this._offset,this._length)):setTimeout(t,300)},i={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},n=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,i);return this.useCustomAttenuation&&n.setAttenuationFunction(this._customAttenuationFunction),n.setPosition(this._position),n.setPlaybackRate(this._playbackRate),t(),n}}get directionalConeOuterAngle(){return this._coneOuterAngle}getSoundSource(){return this._soundSource}play(e,t,i){if(this._isReadyToPlay&&this._scene.audioEnabled&&Md.audioEngine?.audioContext)try{this._clearTimeoutsAndObservers();let n=e?Md.audioEngine?.audioContext.currentTime+e:Md.audioEngine?.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=Md.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){const e=()=>{if(Md.audioEngine?.unlocked){const t=this._htmlAudioElement.play();void 0!==t&&t.catch((()=>{Md.audioEngine?.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Md.audioEngine?.onAudioUnlockedObservable.addOnce((()=>{e()})))}))}else(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Md.audioEngine?.onAudioUnlockedObservable.addOnce((()=>{e()})))};e()}}else{const a=()=>{if(Md.audioEngine?.audioContext){if(i=i||this._length,void 0!==t&&this._setOffset(t),this._soundSource){const e=this._soundSource;e.onended=()=>{e.disconnect()}}if(this._soundSource=Md.audioEngine?.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==t&&(this._soundSource.loopStart=t),void 0!==i&&(this._soundSource.loopEnd=(0|t)+i),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},n=e?Md.audioEngine?.audioContext.currentTime+e:Md.audioEngine.audioContext.currentTime;const a=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(n,a,this.loop?void 0:i)}}};"suspended"===Md.audioEngine?.audioContext.state?this._tryToPlayTimeout=setTimeout((()=>{"suspended"===Md.audioEngine?.audioContext.state?(Md.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Md.audioEngine.onAudioUnlockedObservable.addOnce((()=>{a()})))):a()}),500):a()}this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(e){jh.Error("Error while trying to play audio: "+this.name+", "+e.message)}}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const e=this._connectedTransformNode.getWorldMatrix(),t=wh.TransformNormal(this._localDirection,e);t.normalize(),this._soundPanner.orientationX.value=t.x,this._soundPanner.orientationY.value=t.y,this._soundPanner.orientationZ.value=t.z}_audioBufferLoaded(e){Md.audioEngine?.audioContext&&(this._audioBuffer=e,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_disableSpatialSound(){this._spatialSound&&(this._inputAudioNode=this._soundGain,this._soundPanner?.disconnect(),this._soundPanner=null,this._spatialSound=!1)}constructor(t,i,n,a=null,s){if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Ih,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=wh.Zero(),this._localDirection=new wh(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,n=n||xh.LastCreatedScene)if(this._scene=n,e._SceneComponentInitialization(n),this._readyToPlayCallback=a,this._customAttenuationFunction=(e,t,i,n,a)=>t<i?e*(1-t/i):0,s&&(this.autoplay=s.autoplay||!1,this._loop=s.loop||!1,void 0!==s.volume&&(this._volume=s.volume),this._spatialSound=s.spatialSound??!1,this.maxDistance=s.maxDistance??100,this.useCustomAttenuation=s.useCustomAttenuation??!1,this.rolloffFactor=s.rolloffFactor||1,this.refDistance=s.refDistance||1,this.distanceModel=s.distanceModel||"linear",this._playbackRate=s.playbackRate||1,this._streaming=s.streaming??!1,this._length=s.length,this._offset=s.offset),Md.audioEngine?.canUseWebAudio&&Md.audioEngine.audioContext){this._soundGain=Md.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let e=!0;if(i)try{"string"==typeof i?(this._urlType="String",this._url=i):i instanceof ArrayBuffer?this._urlType="ArrayBuffer":i instanceof HTMLMediaElement?this._urlType="MediaElement":i instanceof MediaStream?this._urlType="MediaStream":i instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(i)&&(this._urlType="Array");let t=[],n=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Md.audioEngine.audioContext.createMediaElementSource(i),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Md.audioEngine.audioContext.createMediaStreamSource(i),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":i.byteLength>0&&(n=!0,this._soundLoaded(i));break;case"AudioBuffer":this._audioBufferLoaded(i);break;case"String":t.push(i);case"Array":0===t.length&&(t=i);for(let e=0;e<t.length;e++){const i=t[e];if(n=s&&s.skipCodecCheck||-1!==i.indexOf(".mp3",i.length-4)&&Md.audioEngine.isMP3supported||-1!==i.indexOf(".ogg",i.length-4)&&Md.audioEngine.isOGGsupported||-1!==i.indexOf(".wav",i.length-4)||-1!==i.indexOf(".m4a",i.length-4)||-1!==i.indexOf(".mp4",i.length-4)||-1!==i.indexOf("blob:"),n){this._streaming?(this._htmlAudioElement=new Audio(i),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,ad.SetCorsBehavior(i,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()})),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(i,(e=>{this._soundLoaded(e)}),void 0,!0,!0,(e=>{e&&jh.Error("XHR "+e.status+" error on: "+i+"."),jh.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:e=!1}e?n||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):jh.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(e){jh.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Md.audioEngine&&!Md.audioEngine.WarnedWebAudioUnsupported&&(jh.Error("Web Audio is not supported by your browser."),Md.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}updateDistanceFromListener(){if(Md.audioEngine?.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const e=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.subtract(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,e,this.maxDistance,this.refDistance,this.rolloffFactor)}}setPosition(e){e.equals(this._position)||(this._position.copyFrom(e),Md.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}get loop(){return this._loop}getSoundGain(){return this._soundGain}get spatialSound(){return this._spatialSound}setPlaybackRate(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}};QC._SceneComponentInitialization=e=>{throw Qc("AudioSceneComponent")},rh("BABYLON.Sound",QC);var ZC=class{get directionalConeInnerAngle(){return this._coneInnerAngle}set volume(e){if(e!==this._volume)for(const t of this._sounds)t.setVolume(e)}play(e){if(!this.isPaused){this.stop();const e=Math.random();let t=0;for(let i=0;i<this._weights.length;i++)if(t+=this._weights[i],e<=t){this._currentIndex=i;break}}const t=this._sounds[this._currentIndex];t.isReady()?t.play(0,this.isPaused?void 0:e):t.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}set directionalConeOuterAngle(e){if(e!==this._coneOuterAngle){if(e<this._coneInnerAngle)return void jh.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e;for(const t of this._sounds)t.directionalConeOuterAngle=e}}get directionalConeOuterAngle(){return this._coneOuterAngle}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}pause(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()}get volume(){return this._volume}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}constructor(e,t,i){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==i.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=i;let n=0;for(const e of i)n+=e;const a=n>0?1/n:0;for(let e=0;e<this._weights.length;e++)this._weights[e]*=a;this._sounds=t;for(const e of this._sounds)e.onEndedObservable.add((()=>{this._onended()}))}set directionalConeInnerAngle(e){if(e!==this._coneInnerAngle){if(this._coneOuterAngle<e)return void jh.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e;for(const t of this._sounds)t.directionalConeInnerAngle=e}}},eR="MSFT_audio_emitter",tR=class{dispose(){this._loader=null,this._clips=null,this._emitters=null}_loadClipAsync(e,t){if(t._objectURL)return t._objectURL;let i;if(t.uri)i=this._loader.loadUriAsync(e,t,t.uri);else{const n=MA.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,t.bufferView);i=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}return t._objectURL=i.then((e=>URL.createObjectURL(new Blob([e],{type:t.mimeType})))),t._objectURL}_loadAnimationEventAsync(e,t,i,n,a){if(0==a.targetedAnimations.length)return Promise.resolve();const s=a.targetedAnimations[0],r=n.emitter,o=MA.Get(`/extensions/${this.name}/emitters`,this._emitters,r);return this._loadEmitterAsync(e,o).then((()=>{const t=o._babylonData.sound;if(t){const i=new ty(n.time,this._getEventAction(e,t,n.action,n.time,n.startOffset));s.animation.addEvent(i),a.onAnimationGroupEndObservable.add((()=>{t.stop()})),a.onAnimationGroupPauseObservable.add((()=>{t.pause()}))}}))}_getEventAction(e,t,i,n,a){switch(i){case"play":return e=>{const i=(a||0)+(e-n);t.play(i)};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw new Error(`${e}: Unsupported action ${i}`)}}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,MA.Assign(this._clips),MA.Assign(this._emitters)}}loadNodeAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((e,n)=>{const a=new Array;return this._loader.loadNodeAsync(e,t,(t=>{for(const i of n.emitters){const n=MA.Get(`${e}/emitters`,this._emitters,i);a.push(this._loadEmitterAsync(`${e}/emitters/${n.index}`,n).then((()=>{for(const e of n._babylonSounds)e.attachToMesh(t),null==n.innerAngle&&null==n.outerAngle||(e.setLocalDirectionToMesh(wh.Forward()),e.setDirectionalCone(2*ad.ToDegrees(null==n.innerAngle?Math.PI:n.innerAngle),2*ad.ToDegrees(null==n.outerAngle?Math.PI:n.outerAngle),0))})))}i(t)})).then((e=>Promise.all(a).then((()=>e))))}))}_loadEmitterAsync(e,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){const e=new Array,i=t.name||`emitter${t.index}`,n={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume};for(let a=0;a<t.clips.length;a++){const s=`/extensions/${this.name}/clips`,r=MA.Get(s,this._clips,t.clips[a].clip);e.push(this._loadClipAsync(`${s}/${t.clips[a].clip}`,r).then((e=>{const s=t._babylonSounds[a]=new QC(i,e,this._loader.babylonScene,null,n);s.refDistance=t.refDistance||1,s.maxDistance=t.maxDistance||256,s.rolloffFactor=t.rolloffFactor||1,s.distanceModel=t.distanceModel||"exponential"})))}const a=Promise.all(e).then((()=>{const e=t.clips.map((e=>e.weight||1)),i=new ZC(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(i.directionalConeInnerAngle=2*ad.ToDegrees(t.innerAngle)),t.outerAngle&&(i.directionalConeOuterAngle=2*ad.ToDegrees(t.outerAngle)),t.volume&&(i.volume=t.volume),t._babylonData.sound=i}));t._babylonData={loaded:a}}return t._babylonData.loaded}loadSceneAsync(e,t){return IA.LoadExtensionAsync(e,t,this.name,((i,n)=>{const a=new Array;a.push(this._loader.loadSceneAsync(e,t));for(const e of n.emitters){const t=MA.Get(`${i}/emitters`,this._emitters,e);if(null!=t.refDistance||null!=t.maxDistance||null!=t.rolloffFactor||null!=t.distanceModel||null!=t.innerAngle||null!=t.outerAngle)throw new Error(`${i}: Direction or Distance properties are not allowed on emitters attached to a scene`);a.push(this._loadEmitterAsync(`${i}/emitters/${t.index}`,t))}return Promise.all(a).then((()=>{}))}))}constructor(e){this.name=eR,this._loader=e,this.enabled=this._loader.isExtensionUsed(eR)}loadAnimationAsync(e,t){return IA.LoadExtensionAsync(e,t,this.name,((i,n)=>this._loader.loadAnimationAsync(e,t).then((a=>{const s=new Array;MA.Assign(n.events);for(const r of n.events)s.push(this._loadAnimationEventAsync(`${i}/events/${r.index}`,e,t,r,a));return Promise.all(s).then((()=>a))}))))}};IA.RegisterExtension(eR,(e=>new tR(e)));var iR="MSFT_lod",nR=class{_disposeMaterials(e){const t={};for(const i of e){for(const e of i.getActiveTextures())t[e.xt]=e;i.dispose()}for(const e in t)for(const i of this._loader.babylonScene.materials)i.hasTexture(t[e])&&delete t[e];for(const e in t)t[e].dispose()}loadBufferAsync(e,t,i,n){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);const t=(e,t)=>{const a=i,s=a+n-1;let r=e[t];return r?(r.start=Math.min(r.start,a),r.end=Math.max(r.end,s)):(r={start:a,end:s,loaded:new JE},e[t]=r),r.loaded.promise.then((e=>new Uint8Array(e.buffer,e.byteOffset+i-r.start,n)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null}_loadMaterialAsync(e,t,i,n,a){return this._nodeIndexLOD?null:IA.LoadExtensionAsync(e,t,this.name,((e,s)=>{let r;const o=this._getLODs(e,t,this._loader.gltf.materials,s.ids);this._loader.logOpen(`${e}`);for(let e=0;e<o.length;e++){const t=o[e];0!==e&&(this._materialIndexLOD=e);const s=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,i,n,(t=>{0===e&&a(t)})).then((t=>{if(0!==e){a(t);const i=o[e-1]._data;i[n]&&(this._disposeMaterials([i[n].babylonMaterial]),delete i[n])}return t}));this._materialPromiseLODs[e]=this._materialPromiseLODs[e]||[],0===e?r=s:(this._materialIndexLOD=null,this._materialPromiseLODs[e].push(s))}return this._loader.logClose(),r}))}_loadBufferLOD(e,t){const i=e[t];i&&(this._loader.log(`Loading buffer range [${i.start}-${i.end}]`),this._loader.bin.readAsync(i.start,i.end-i.start+1).then((e=>{i.loaded.resolve(e)}),(e=>{i.loaded.reject(e)})))}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}loadNodeAsync(e,t,i){return IA.LoadExtensionAsync(e,t,this.name,((e,n)=>{let a;const s=this._getLODs(e,t,this._loader.gltf.nodes,n.ids);this._loader.logOpen(`${e}`);for(let e=0;e<s.length;e++){const t=s[e];0!==e&&(this._nodeIndexLOD=e,this._nodeSignalLODs[e]=this._nodeSignalLODs[e]||new JE);const n=e=>{i(e),e.setEnabled(!1)},r=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,n).then((t=>{if(0!==e){const t=s[e-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.setEnabled(!0),t}));this._nodePromiseLODs[e]=this._nodePromiseLODs[e]||[],0===e?a=r:(this._nodeIndexLOD=null,this._nodePromiseLODs[e].push(r))}return this._loader.logClose(),a}))}_disposeTransformNode(e){const t=[],i=e.material;i&&t.push(i);for(const i of e.getChildMeshes())i.material&&t.push(i.material);e.dispose();const n=t.filter((e=>this._loader.babylonScene.meshes.every((t=>t.material!=e))));this._disposeMaterials(n)}constructor(e){this.name=iR,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Ih,this.onMaterialLODsLoadedObservable=new Ih,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.maxLODsToLoad=this._loader.parent.extensionOptions[iR]?.maxLODsToLoad??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(iR)}loadSceneAsync(e,t){const i=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),i}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){const t=Promise.all(this._nodePromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())}));this._loader._completePromises.push(t)}for(let e=0;e<this._materialPromiseLODs.length;e++){const t=Promise.all(this._materialPromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())}));this._loader._completePromises.push(t)}}_loadUriAsync(e,t,i){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const n=this._nodeIndexLOD-1;return this._nodeSignalLODs[n]=this._nodeSignalLODs[n]||new JE,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(e,t,i)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const n=this._materialIndexLOD-1;return this._materialSignalLODs[n]=this._materialSignalLODs[n]||new JE,this._materialSignalLODs[n].promise.then((()=>this._loader.loadUriAsync(e,t,i)))}return null}_getLODs(e,t,i,n){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const a=[];for(let t=n.length-1;t>=0;t--)if(a.push(MA.Get(`${e}/ids/${n[t]}`,i,n[t])),a.length===this.maxLODsToLoad)return a;return a.push(t),a}};IA.RegisterExtension(iR,(e=>new nR(e)));var aR="MSFT_minecraftMesh",sR=class{loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtraAsync(e,t,this.name,((n,a)=>{if(a){if(!(i instanceof gA))throw new Error(`${n}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(e,t,i);return i.needAlphaBlending()&&(i.forceDepthWrite=!0,i.separateCullingPass=!0),i.backFaceCulling=i.forceDepthWrite,i.twoSidedLighting=!0,a}return null}))}constructor(e){this.name=aR,this._loader=e,this.enabled=this._loader.isExtensionUsed(aR)}dispose(){this._loader=null}};IA.RegisterExtension(aR,(e=>new sR(e)));var rR,oR,lR="MSFT_sRGBFactors",cR=class{constructor(e){this.name=lR,this._loader=e,this.enabled=this._loader.isExtensionUsed(lR)}loadMaterialPropertiesAsync(e,t,i){return IA.LoadExtraAsync(e,t,this.name,((n,a)=>{if(a){if(!(i instanceof gA))throw new Error(`${n}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(e,t,i),s=i.getScene().getEngine().useExactSrgbConversions;return i.albedoTexture||i.albedoColor.toLinearSpaceToRef(i.albedoColor,s),i.reflectivityTexture||i.reflectivityColor.toLinearSpaceToRef(i.reflectivityColor,s),a}return null}))}dispose(){this._loader=null}};IA.RegisterExtension(lR,(e=>new cR(e))),(oR=rR||(rR={}))[oR.Input=0]="Input",oR[oR.Output=1]="Output";var hR=class{static Parse(e={},t){const i=new(ad.Instantiate(e.className))(e.name,e._connectionType,t);return i.deserialize(e),i}connectTo(e){if(this._connectionType===e._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||e._isSingularConnection()&&e._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(e),e._connectedPoint.push(this)}deserialize(e){this.xt=e.xt,this.name=e.name,this._connectionType=e._connectionType,this.connectedPointIds=e.connectedPointIds}_isSingularConnection(){return!0}serialize(e={}){e.xt=this.xt,e.name=this.name,e._connectionType=this._connectionType,e.connectedPointIds=[],e.className=this.getClassName();for(const t of this._connectedPoint)e.connectedPointIds.push(t.xt)}constructor(e,t,i){this._ownerBlock=i,this._connectedPoint=[],this.xt=Ju(),this.connectedPointIds=[],this.name=e,this._connectionType=t}isConnected(){return this._connectedPoint.length>0}get connectionType(){return this._connectionType}getClassName(){return"FGConnection"}},fR=class e{equals(e){return this.value===e.value}add(t){return new e(this.value+t.value)}divide(t){return new e(this.value/t.value)}subtract(t){return new e(this.value-t.value)}multiply(t){return new e(Math.imul(this.value,t.value))}static Parse(t){return new e(t.value)}getClassName(){return e.ClassName}_toInt(e){return 0|e}constructor(e){this.value=this._toInt(e)}};fR.ClassName="FlowGraphInteger",rh("FlowGraphInteger",fR);var uR=class e{static Parse(t){return new e(t.typeName,t.defaultValue)}constructor(e,t){this.typeName=e,this.defaultValue=t}serialize(e){e.typeName=this.typeName,e.defaultValue=this.defaultValue}},dR=new uR("any",void 0),mR=(new uR("string",""),new uR("number",0)),pR=new uR("boolean",!1),_R=new uR("Vector2",Ph.Zero()),vR=new uR("Vector3",wh.Zero()),gR=(new uR("Vector4",Oh.Zero()),new uR("Matrix",Lh.Identity())),SR=(new uR("Color3",Ah.Black()),new uR("Color4",new Ch(0,0,0,0)),new uR("Quaternion",Dh.Identity()),new uR("FlowGraphInteger",new fR(0))),yR=class extends hR{_getValueOrDefault(e){return e._hasConnectionValue(this)?e._getConnectionValue(this):this.richType.defaultValue}getClassName(){return"FGDataConnection"}setValue(e,t){t._setConnectionValue(this,e)}getValue(e){return 1===this.connectionType?(e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(e),this._getValueOrDefault(e)):this.isConnected()?this._connectedPoint[0].getValue(e):this._getValueOrDefault(e)}serialize(e={}){super.serialize(e),e.richType={},this.richType.serialize(e.richType)}constructor(e,t,i,n){super(e,t,i),this.richType=n}static Parse(e,t){const i=hR.Parse(e,t);return i.richType=uR.Parse(e.richType),i}connectTo(e){super.connectTo(e)}_isSingularConnection(){return 0===this.connectionType}};function ER(e){return"Mesh"===e||"AbstractMesh"===e||"GroundMesh"===e||"InstanceMesh"===e||"LinesMesh"===e||"GoldbergMesh"===e||"GreasedLineMesh"===e||"TrailMesh"===e}function AR(e){return"Vector2"===e||"Vector3"===e||"Vector4"===e||"Quaternion"===e||"Color3"===e||"Color4"===e}function CR(e,t,i){const n=t?.getClassName?.()??"";ER(n)?i[e]={name:t.name,className:n}:AR(n)?i[e]={value:t.asArray(),className:n}:i[e]=t}function RR(e,t,i){const n=t[e];let a;const s=n?.className;return a=ER(s)?i.getMeshByName(n.name):AR(s)?function(e,t){if("Vector2"===e)return Ph.FromArray(t);if("Vector3"===e)return wh.FromArray(t);if("Vector4"===e)return Oh.FromArray(t);if("Quaternion"===e)return Dh.FromArray(t);if("Color3"===e)return new Ah(t[0],t[1],t[2]);if("Color4"===e)return new Ch(t[0],t[1],t[2],t[3]);throw new Error(`Unknown vector class name ${e}`)}(s,n.value):"Matrix"===s?Lh.FromArray(n.value):s===fR.ClassName?fR.Parse(n):n&&void 0!==n.value?n.value:n,a}rh("FGDataConnection",yR);var TR=class{getClassName(){return"FGBlock"}_updateOutputs(e){}getDataOutput(e){return this.dataOutputs.find((t=>t.name===e))}registerDataOutput(e,t){const i=new yR(e,1,this,t);return this.dataOutputs.push(i),i}serialize(e={},t=CR){e.xt=this.xt,e.config={},this.config&&(e.config.name=this.config.name),e.dataInputs=[],e.dataOutputs=[],e.className=this.getClassName();for(const t of this.dataInputs){const i={};t.serialize(i),e.dataInputs.push(i)}for(const t of this.dataOutputs){const i={};t.serialize(i),e.dataOutputs.push(i)}}constructor(e){this.config=e,this.xt=Ju(),this.name=this.config?.name??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}registerDataInput(e,t){const i=new yR(e,0,this,t);return this.dataInputs.push(i),i}static Parse(e,t){const i=ad.Instantiate(e.className),n={},a=t.valueParseFunction??RR;if(e.config)for(const i in e.config)n[i]=a(i,e.config,t.scene);var s;("FGSetPropertyBlock"===(s=e.className)||"FGGetPropertyBlock"===s||"FGPlayAnimationBlock"===s||"FGMeshPickEventBlock"===s)&&(n.pathConverter=t.pathConverter);const r=new i(n);r.xt=e.xt;for(let t=0;t<e.dataInputs.length;t++){const i=r.getDataInput(e.dataInputs[t].name);if(!i)throw new Error("Could not find data input with name "+e.dataInputs[t].name+" in block "+e.className);i.deserialize(e.dataInputs[t])}for(let t=0;t<e.dataOutputs.length;t++){const i=r.getDataOutput(e.dataOutputs[t].name);if(!i)throw new Error("Could not find data output with name "+e.dataOutputs[t].name+" in block "+e.className);i.deserialize(e.dataOutputs[t])}return r.metadata=e.metadata,r.deserialize&&r.deserialize(e),r}getDataInput(e){return this.dataInputs.find((t=>t.name===e))}},NR=class extends hR{_activateSignal(e){0===this.connectionType?(e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(e,this),e._increaseExecutionId()):this._connectedPoint[0]?._activateSignal(e)}_isSingularConnection(){return 1===this.connectionType}};rh("FlowGraphSignalConnection",NR);var MR=class extends TR{deserialize(e){for(let t=0;t<e.signalInputs.length;t++){const i=this.getSignalInput(e.signalInputs[t].name);if(!i)throw new Error("Could not find signal input with name "+e.signalInputs[t].name+" in block "+e.className);i.deserialize(e.signalInputs[t])}for(let t=0;t<e.signalOutputs.length;t++){const i=this.getSignalOutput(e.signalOutputs[t].name);if(!i)throw new Error("Could not find signal output with name "+e.signalOutputs[t].name+" in block "+e.className);i.deserialize(e.signalOutputs[t])}}getSignalOutput(e){return this.signalOutputs.find((t=>t.name===e))}getClassName(){return"FGExecutionBlock"}serialize(e={}){super.serialize(e),e.signalInputs=[],e.signalOutputs=[];for(const t of this.signalInputs){const i={};t.serialize(i),e.signalInputs.push(i)}for(const t of this.signalOutputs){const i={};t.serialize(i),e.signalOutputs.push(i)}}constructor(e){super(e),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalOutput(e){const t=new NR(e,1,this);return this.signalOutputs.push(t),t}_registerSignalInput(e){const t=new NR(e,0,this);return this.signalInputs.push(t),t}getSignalInput(e){return this.signalInputs.find((t=>t.name===e))}},IR=class extends MR{_startPendingTasks(e){this._preparePendingTasks(e),e._addPendingBlock(this)}constructor(e){super(e),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}},xR=class extends IR{_execute(e){e._notifyExecuteNode(this),this.out._activateSignal(e)}},bR=class{getVariable(e){return this._userVariables[e]}_hasConnectionValue(e){return e.xt in this._connectionValues}get userVariables(){return this._userVariables}hasVariable(e){return e in this._userVariables}get configuration(){return this._configuration}_getExecutionVariable(e,t,i){return this._hasExecutionVariable(e,t)?this._executionVariables[this._getUniqueIdPrefixedName(e,t)]:i}_notifyExecuteNode(e){this.onNodeExecutedObservable.notifyObservers(e)}_removePendingBlock(e){const t=this._pendingBlocks.indexOf(e);-1!==t&&this._pendingBlocks.splice(t,1)}_getUniqueIdPrefixedName(e,t){return`${e.xt}_${t}`}serialize(e={},t=CR){e.xt=this.xt,e._userVariables={};for(const i in this._userVariables)t(i,this._userVariables[i],e._userVariables);e._connectionValues={};for(const i in this._connectionValues)t(i,this._connectionValues[i],e._connectionValues)}static Parse(e,t){const i=t.graph.createContext(),n=t.valueParseFunction??RR;i.xt=e.xt;for(const t in e._userVariables){const a=n(t,e._userVariables,i._configuration.scene);i._userVariables[t]=a}for(const t in e._connectionValues){const a=n(t,e._connectionValues,i._configuration.scene);i._connectionValues[t]=a}return i}_setExecutionVariable(e,t,i){this._executionVariables[this._getUniqueIdPrefixedName(e,t)]=i}_addPendingBlock(e){this._pendingBlocks.push(e)}constructor(e){this.xt=Ju(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Ih,this._configuration=e}_increaseExecutionId(){this._executionId++}setVariable(e,t){this._userVariables[e]=t}_deleteExecutionVariable(e,t){delete this._executionVariables[this._getUniqueIdPrefixedName(e,t)]}_clearPendingBlocks(){for(const e of this._pendingBlocks)e._cancelPendingTasks(this);this._pendingBlocks.length=0}_getConnectionValue(e){return this._connectionValues[e.xt]}get executionId(){return this._executionId}getClassName(){return"FGContext"}_setConnectionValue(e,t){this._connectionValues[e.xt]=t}_hasExecutionVariable(e,t){return this._getUniqueIdPrefixedName(e,t)in this._executionVariables}};function PR(e,t){return!(!e.parent||e.parent!==t&&!PR(e.parent,t))}Lc([Hc()],bR.prototype,"uniqueId",void 0);var wR,OR,DR=class e extends xR{_onDispose(e){this._cancelPendingTasks(e),e._removePendingBlock(this)}_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"mesh"),i=e._getExecutionVariable(this,"meshPickObserver"),n=e._getExecutionVariable(this,"meshDisposeObserver");t.getScene().onPointerObservable.remove(i),t.onDisposeObservable.remove(n),e._deleteExecutionVariable(this,"mesh"),e._deleteExecutionVariable(this,"meshPickObserver"),e._deleteExecutionVariable(this,"meshDisposeObserver")}_getReferencedMesh(){const e=this.config.pathConverter.convert(this.config.path),t=e.info.getObject(e.object);if(!(t&&t instanceof Bd))throw new Error("Mesh pick event block requires a valid mesh");return t}getClassName(){return e.ClassName}_preparePendingTasks(e){let t=e._getExecutionVariable(this,"meshPickObserver");if(!t){const i=this._getReferencedMesh();e._setExecutionVariable(this,"mesh",i),t=i.getScene().onPointerObservable.add((t=>{t.type===b_.POINTERPICK&&t.pickInfo?.pickedMesh&&(t.pickInfo?.pickedMesh===i||PR(t.pickInfo?.pickedMesh,i))&&this._execute(e)}));const n=i.onDisposeObservable.add((()=>this._onDispose));e._setExecutionVariable(this,"meshPickObserver",t),e._setExecutionVariable(this,"meshDisposeObserver",n)}}serialize(e){super.serialize(e),e.config.path=this.config.path}constructor(e){super(e),this.config=e}};DR.ClassName="FGMeshPickEventBlock",rh(DR.ClassName,DR),(OR=wR||(wR={}))[OR.Stopped=0]="Stopped",OR[OR.Started=1]="Started";var LR=class e{static GetDataOutConnectionByUniqueId(e,t){for(const i of e)for(const e of i.dataOutputs)if(e.xt===t)return e;throw new Error("Could not find data out connection with unique id "+t)}dispose(){if(0!==this.state){this.state=0;for(const e of this._executionContexts)e._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.onDisposeObservable.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}getContext(e){return this._executionContexts[e]}addEventBlock(e){this._eventBlocks.push(e)}constructor(e){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=e.scene,this._coordinator=e.coordinator,this._sceneDisposeObserver=this._scene.onDisposeObservable.add((()=>this.dispose()))}_getContextualOrder(){const e=[];for(const t of this._eventBlocks)if(t.getClassName()===DR.ClassName){const i=t._getReferencedMesh();let n=0;for(;n<e.length;n++){const t=e[n]._getReferencedMesh();if(i&&t&&PR(i,t))break}e.splice(n,0,t)}else e.push(t);return e}visitAllBlocks(e){const t=[],i=new Set;for(const e of this._eventBlocks)t.push(e),i.add(e.xt);for(;t.length>0;){const n=t.pop();e(n);for(const e of n.dataInputs)for(const n of e._connectedPoint)i.has(n._ownerBlock.xt)||(t.push(n._ownerBlock),i.add(n._ownerBlock.xt));if(n instanceof MR)for(const e of n.signalOutputs)for(const n of e._connectedPoint)i.has(n._ownerBlock.xt)||(t.push(n._ownerBlock),i.add(n._ownerBlock.xt))}}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const e of this._executionContexts){const t=this._getContextualOrder();for(const i of t)i._startPendingTasks(e)}}}static GetSignalInConnectionByUniqueId(e,t){for(const i of e)if(i instanceof MR)for(const e of i.signalInputs)if(e.xt===t)return e;throw new Error("Could not find signal in connection with unique id "+t)}createContext(){const e=new bR({scene:this._scene,coordinator:this._coordinator});return this._executionContexts.push(e),e}static Parse(t,i){const n=i.coordinator.createGraph(),a=[],s=i.valueParseFunction??RR;for(const e of t.allBlocks){const t=TR.Parse(e,{scene:i.coordinator.config.scene,pathConverter:i.pathConverter,valueParseFunction:s});a.push(t),t instanceof xR&&n.addEventBlock(t)}for(const t of a){for(const i of t.dataInputs)for(const t of i.connectedPointIds){const n=e.GetDataOutConnectionByUniqueId(a,t);i.connectTo(n)}if(t instanceof MR)for(const i of t.signalOutputs)for(const t of i.connectedPointIds){const n=e.GetSignalInConnectionByUniqueId(a,t);i.connectTo(n)}}for(const e of t.executionContexts)bR.Parse(e,{graph:n,valueParseFunction:s});return n}serialize(e={},t){e.allBlocks=[],this.visitAllBlocks((t=>{const i={};t.serialize(i),e.allBlocks.push(i)})),e.executionContexts=[];for(const i of this._executionContexts){const n={};i.serialize(n,t),e.executionContexts.push(n)}}},FR=class e{createGraph(){const e=new LR({scene:this.config.scene,coordinator:this});return this._flowGraphs.push(e),e}static Parse(t,i){const n=i.valueParseFunction??RR,a=new e({scene:i.scene});return t._flowGraphs?.forEach((e=>{LR.Parse(e,{coordinator:a,valueParseFunction:n,pathConverter:i.pathConverter})})),a}constructor(t){this.config=t,this._flowGraphs=[],this._customEventsMap=new Map,this.config.scene.onDisposeObservable.add((()=>{this.dispose()}));(e.SceneCoordinators.get(this.config.scene)??[]).push(this)}getCustomEventObservable(e){let t=this._customEventsMap.get(e);return t||(t=new Ih,this._customEventsMap.set(e,t)),t}notifyCustomEvent(e,t){const i=this._customEventsMap.get(e);i&&i.notifyObservers(t)}start(){this._flowGraphs.forEach((e=>e.start()))}dispose(){this._flowGraphs.forEach((e=>e.dispose())),this._flowGraphs.length=0;const t=e.SceneCoordinators.get(this.config.scene)??[],i=t.indexOf(this);-1!==i&&t.splice(i,1)}serialize(e,t){e._flowGraphs=[],this._flowGraphs.forEach((i=>{const n={};i.serialize(n,t),e._flowGraphs.push(n)}))}get flowGraphs(){return this._flowGraphs}removeGraph(e){const t=this._flowGraphs.indexOf(e);-1!==t&&(e.dispose(),this._flowGraphs.splice(t,1))}};FR.SceneCoordinators=new Map;var kR=class e extends xR{_preparePendingTasks(e){if(!e._getExecutionVariable(this,"sceneReadyObserver")){const t=e.configuration.scene.onReadyObservable.add((()=>{this._execute(e)}));e._setExecutionVariable(this,"sceneReadyObserver",t)}}getClassName(){return e.ClassName}_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"sceneReadyObserver");e.configuration.scene.onReadyObservable.remove(t),e._deleteExecutionVariable(this,"sceneReadyObserver")}};kR.ClassName="FGSceneReadyEventBlock",rh("FGSceneReadyEventBlock",kR);var BR=class e extends xR{_preparePendingTasks(e){if(!e._getExecutionVariable(this,"sceneBeforeRender")){const t=e.configuration.scene.onBeforeRenderObservable.add((()=>{this._execute(e)}));e._setExecutionVariable(this,"sceneBeforeRender",t)}}_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"sceneBeforeRender");e.configuration.scene.onBeforeRenderObservable.remove(t),e._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return e.ClassName}};BR.ClassName="FGSceneTickEventBlock",rh(BR.ClassName,BR);var GR,UR,HR=class extends MR{constructor(e){super(e),this.out=this._registerSignalOutput("out")}},VR=class e extends HR{_execute(e){const t=this.message.getValue(e);jh.Log(t),this.out._activateSignal(e)}constructor(e){super(e),this.message=this.registerDataInput("message",dR)}getClassName(){return e.ClassName}};VR.ClassName="FGConsoleLogBlock",rh(VR.ClassName,VR),(UR=GR||(GR={}))[UR.INIT=0]="INIT",UR[UR.STARTED=1]="STARTED",UR[UR.ENDED=2]="ENDED";var WR=class{dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}set breakCondition(e){this._breakCondition=e}_setState(e){this._state=e,this.onStateChangedObservable.notifyObservers(this._state)}start(e=this._timeToEnd){if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=e,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}constructor(e){this.onEachCountObservable=new Ih,this.onTimerAbortedObservable=new Ih,this.onTimerEndedObservable=new Ih,this.onStateChangedObservable=new Ih,this._observer=null,this._breakOnNextTick=!1,this._tick=e=>{const t=Date.now();this._timer=t-this._startTime;const i={startTime:this._startTime,currentTime:t,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:e},n=this._breakOnNextTick||this._breakCondition(i);n||this._timer>=this._timeToEnd?this._stop(i,n):this.onEachCountObservable.notifyObservers(i)},this._setState(0),this._contextObservable=e.contextObservable,this._observableParameters=e.observableParameters??{},this._breakCondition=e.breakCondition??(()=>!1),this._timeToEnd=e.timeout,e.onEnded&&this.onTimerEndedObservable.add(e.onEnded),e.onTick&&this.onEachCountObservable.add(e.onTick),e.onAborted&&this.onTimerAbortedObservable.add(e.onAborted)}_stop(e,t=!1){this._contextObservable.remove(this._observer),this._setState(2),t?this.onTimerAbortedObservable.notifyObservers(e):this.onTimerEndedObservable.notifyObservers(e)}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}stop(){1===this._state&&(this._breakOnNextTick=!0)}},zR=class e extends IR{_onEnded(e,t){const i=t._getExecutionVariable(this,"runningTimers")||[],n=i.indexOf(e);-1!==n?i.splice(n,1):ad.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),t._removePendingBlock(this),this.done._activateSignal(t)}_preparePendingTasks(e){const t=this.timeout.getValue(e);if(void 0!==t&&t>=0){const i=e._getExecutionVariable(this,"runningTimers")||[],n=e.configuration.scene,a=new WR({timeout:t,contextObservable:n.onBeforeRenderObservable,onEnded:()=>this._onEnded(a,e)});a.start(),i.push(a),e._setExecutionVariable(this,"runningTimers",i)}}_execute(e){this._startPendingTasks(e),this.out._activateSignal(e)}constructor(e){super(e),this.timeout=this.registerDataInput("timeout",mR)}_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"runningTimers")||[];for(const e of t)e.dispose();e._deleteExecutionVariable(this,"runningTimers")}getClassName(){return e.ClassName}};zR.ClassName="FGTimerBlock",rh("FGTimerBlock",zR);var XR=class e extends HR{_execute(e){const t=this.config.eventId,i=this.dataInputs.map((t=>t.getValue(e)));e.configuration.coordinator.notifyCustomEvent(t,i),this.out._activateSignal(e)}getClassName(){return e.ClassName}constructor(e){super(e),this.config=e;for(let e=0;e<this.config.eventData.length;e++){const t=this.config.eventData[e];this.registerDataInput(t,dR)}}};XR.ClassName="FGSendCustomEventBlock",rh("FGSendCustomEventBlock",XR);var YR=class e extends xR{constructor(e){super(e),this.config=e;for(let e=0;e<this.config.eventData.length;e++){const t=this.config.eventData[e];this.registerDataOutput(t,dR)}}_preparePendingTasks(e){const t=e.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=t.add((t=>{for(let i=0;i<t.length;i++)this.dataOutputs[i].setValue(t[i],e);this._execute(e)}))}_cancelPendingTasks(e){const t=e.configuration.coordinator.getCustomEventObservable(this.config.eventId);t?t.remove(this._eventObserver):ad.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return e.ClassName}serialize(e){super.serialize(e),e.eventId=this.config.eventId,e.eventData=this.config.eventData}};YR.ClassName="FGReceiveCustomEventBlock",rh(YR.ClassName,YR);var jR=class e extends MR{constructor(e){super(e),this.config=e,this.outFlows=[];for(let e=0;e<this.config.numberOutputFlows;e++)this.outFlows.push(this._registerSignalOutput(`${e}`))}getClassName(){return e.ClassName}_execute(e){for(let t=0;t<this.config.numberOutputFlows;t++)this.outFlows[t]._activateSignal(e)}};jR.ClassName="FGSequenceBlock",rh(jR.ClassName,jR);var KR=new RegExp(/\{(\w+)\}/g),$R=class{getAccessor(e,t){let i=this.path;for(const e of this.templatedInputs){const n=e.getValue(t).value;i=i.replace(`{${e.name}}`,n.toString())}return e.convert(i)}constructor(e,t){this.path=e,this.ownerBlock=t,this.templatedInputs=[];let i=KR.exec(e);for(;i;){const[,n]=i;this.templatedInputs.push(t.registerDataInput(n,SR)),i=KR.exec(e)}}},qR=class e extends TR{getClassName(){return e.ClassName}_updateOutputs(e){const t=this.templateComponent.getAccessor(this.config.pathConverter,e),i=t.info.get(t.object);this.value.setValue(i,e)}constructor(e){super(e),this.config=e,this.value=this.registerDataOutput("value",dR),this.templateComponent=new $R(e.path,this)}serialize(e={}){super.serialize(e),e.config.path=this.config.path}};qR.ClassName="FGGetPropertyBlock",rh(qR.ClassName,qR);var JR=class e extends HR{serialize(e={}){super.serialize(e),e.config.path=this.config.path}getClassName(){return e.ClassName}constructor(e){super(e),this.config=e,this.a=this.registerDataInput("a",dR),this.templateComponent=new $R(e.path,this)}_execute(e){const t=this.a.getValue(e),i=this.templateComponent.getAccessor(this.config.pathConverter,e);i.info.set(t,i.object),this.out._activateSignal(e)}};JR.ClassName="FGSetPropertyBlock",rh("FGSetPropertyBlock",JR);var QR="cachedOperationValue",ZR="cachedExecutionId",eT=class extends TR{constructor(e,t){super(t),this.value=this.registerDataOutput("value",e)}_updateOutputs(e){const t=e._getExecutionVariable(this,ZR),i=e._getExecutionVariable(this,QR);if(void 0!==i&&t===e.executionId)this.value.setValue(i,e);else{const t=this._doOperation(e);e._setExecutionVariable(this,QR,t),e._setExecutionVariable(this,ZR,e.executionId),this.value.setValue(t,e)}}},tT=class extends eT{getClassName(){return this._className}constructor(e,t,i,n,a,s){super(i,s),this._operation=n,this._className=a,this.a=this.registerDataInput("a",e),this.b=this.registerDataInput("b",t)}_doOperation(e){return this._operation(this.a.getValue(e),this.b.getValue(e))}},iT=class extends eT{getClassName(){return this._className}_doOperation(e){return this._operation()}constructor(e,t,i,n){super(e,n),this._operation=t,this._className=i}},nT=class extends eT{constructor(e,t,i,n,a){super(t,a),this._operation=i,this._className=n,this.a=this.registerDataInput("a",e)}getClassName(){return this._className}_doOperation(e){return this._operation(this.a.getValue(e))}},aT=class extends eT{constructor(e,t,i,n,a,s,r){super(n,r),this._operation=a,this._className=s,this.a=this.registerDataInput("a",e),this.b=this.registerDataInput("b",t),this.c=this.registerDataInput("c",i)}_doOperation(e){return this._operation(this.a.getValue(e),this.b.getValue(e),this.c.getValue(e))}getClassName(){return this._className}};function sT(e){return e.getClassName?e.getClassName():""}function rT(e,t){return"Vector2"===e&&"Vector2"===t||"Vector3"===e&&"Vector3"===t||"Vector4"===e&&"Vector4"===t}function oT(e,t){return"Matrix"===e&&"Matrix"===t}function lT(e,t){return"FlowGraphInteger"===e&&"FlowGraphInteger"===t}var cT=class e extends tT{_polymorphicAdd(e,t){const i=sT(e),n=sT(t);return rT(i,n)||oT(i,n)||lT(i,n)?e.add(t):e+t}constructor(t){super(dR,dR,dR,((e,t)=>this._polymorphicAdd(e,t)),e.ClassName,t)}};cT.ClassName="FGAddBlock",rh(cT.ClassName,cT);var hT=class e extends tT{constructor(t){super(dR,dR,dR,((e,t)=>this._polymorphicAdd(e,t)),e.ClassName,t)}_polymorphicAdd(e,t){const i=sT(e),n=sT(t);return rT(i,n)||lT(i,n)?e.subtract(t):oT(i,n)?e.add(t.scale(-1)):e-t}};hT.ClassName="FGSubBlock",rh(hT.ClassName,hT);var fT=class e extends tT{constructor(t){super(dR,dR,dR,((e,t)=>this._polymorphicMultiply(e,t)),e.ClassName,t)}_polymorphicMultiply(e,t){const i=sT(e),n=sT(t);return rT(i,n)||lT(i,n)?e.multiply(t):oT(i,n)?Lh.FromValues(e.m[0]*t.m[0],e.m[4]*t.m[4],e.m[8]*t.m[8],e.m[12]*t.m[12],e.m[1]*t.m[1],e.m[5]*t.m[5],e.m[9]*t.m[9],e.m[13]*t.m[13],e.m[2]*t.m[2],e.m[6]*t.m[6],e.m[10]*t.m[10],e.m[14]*t.m[14],e.m[3]*t.m[3],e.m[7]*t.m[7],e.m[11]*t.m[11],e.m[15]*t.m[15]):e*t}};fT.ClassName="FGMultiplyBlock",rh(fT.ClassName,fT);var uT=class e extends tT{_polymorphicDivide(e,t){const i=sT(e),n=sT(t);return rT(i,n)||lT(i,n)?e.divide(t):oT(i,n)?Lh.FromValues(e.m[0]/t.m[0],e.m[4]/t.m[4],e.m[8]/t.m[8],e.m[12]/t.m[12],e.m[1]/t.m[1],e.m[5]/t.m[5],e.m[9]/t.m[9],e.m[13]/t.m[13],e.m[2]/t.m[2],e.m[6]/t.m[6],e.m[10]/t.m[10],e.m[14]/t.m[14],e.m[3]/t.m[3],e.m[7]/t.m[7],e.m[11]/t.m[11],e.m[15]/t.m[15]):e/t}constructor(t){super(dR,dR,dR,((e,t)=>this._polymorphicDivide(e,t)),e.ClassName,t)}};uT.ClassName="FGDivideBlock",rh(uT.ClassName,uT);var dT=class e extends iT{constructor(t){super(mR,(()=>Math.random()),e.ClassName,t)}};dT.ClassName="FGRandomBlock",rh(dT.ClassName,dT);var mT=class e extends tT{constructor(t){super(dR,dR,mR,((e,t)=>this._polymorphicDot(e,t)),e.ClassName,t)}_polymorphicDot(e,t){switch(sT(e)){case"Vector2":return Ph.Dot(e,t);case"Vector3":return wh.Dot(e,t);case"Vector4":return Oh.Dot(e,t);default:throw new Error(`Cannot get dot product of ${e} and ${t}`)}}};mT.ClassName="FGDotBlock",rh(mT.ClassName,mT);var pT=class e extends iT{constructor(t){super(mR,(()=>Math.E),e.ClassName,t)}};pT.ClassName="FGEBlock",rh(pT.ClassName,pT);var _T=class e extends iT{constructor(t){super(mR,(()=>Math.PI),e.ClassName,t)}};_T.ClassName="FGPIBlock",rh(_T.ClassName,_T);var vT=class e extends iT{constructor(t){super(mR,(()=>Number.POSITIVE_INFINITY),e.ClassName,t)}};vT.ClassName="FGInfBlock",rh(vT.ClassName,vT);var gT=class e extends iT{constructor(t){super(mR,(()=>Number.NaN),e.ClassName,t)}};function ST(e,t){switch(sT(e)){case"FlowGraphInteger":return new fR(t(e.value));case"Vector2":return new Ph(t(e.x),t(e.y));case"Vector3":return new wh(t(e.x),t(e.y),t(e.z));case"Vector4":return new Oh(t(e.x),t(e.y),t(e.z),t(e.w));case"Matrix":return Lh.FromValues(t(e.m[0]),t(e.m[4]),t(e.m[8]),t(e.m[12]),t(e.m[1]),t(e.m[5]),t(e.m[9]),t(e.m[13]),t(e.m[2]),t(e.m[6]),t(e.m[10]),t(e.m[14]),t(e.m[3]),t(e.m[7]),t(e.m[11]),t(e.m[15]));default:return t(e)}}gT.ClassName="FGNaNBlock",rh(gT.ClassName,gT);var yT=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicAbs(e)),e.ClassName,t)}_polymorphicAbs(e){return ST(e,Math.abs)}};yT.ClassName="FGAbsBlock",rh(yT.ClassName,yT);var ET=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicSign(e)),e.ClassName,t)}_polymorphicSign(e){return ST(e,Math.sign)}};ET.ClassName="FGSignBlock",rh(ET.ClassName,ET);var AT=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicTrunc(e)),e.ClassName,t)}_polymorphicTrunc(e){return ST(e,Math.trunc)}};AT.ClassName="FGTruncBlock",rh(AT.ClassName,AT);var CT=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicFloor(e)),e.ClassName,t)}_polymorphicFloor(e){return ST(e,Math.floor)}};CT.ClassName="FGFloorBlock",rh(CT.ClassName,CT);var RT=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicCeiling(e)),e.ClassName,t)}_polymorphicCeiling(e){return ST(e,Math.ceil)}};RT.ClassName="FGCeilBlock",rh(RT.ClassName,RT);var TT=class e extends nT{_polymorphicFract(e){return ST(e,(e=>e-Math.floor(e)))}constructor(t){super(dR,dR,(e=>this._polymorphicFract(e)),e.ClassName,t)}};TT.ClassName="FGFractBlock",rh(TT.ClassName,TT);var NT=class e extends nT{_polymorphicNeg(e){return ST(e,(e=>-e))}constructor(t){super(dR,dR,(e=>this._polymorphicNeg(e)),e.ClassName,t)}};function MT(e,t,i){switch(sT(e)){case"FlowGraphInteger":return new fR(i(e.value,t.value));case"Vector2":return new Ph(i(e.x,t.x),i(e.y,t.y));case"Vector3":return new wh(i(e.x,t.x),i(e.y,t.y),i(e.z,t.z));case"Vector4":return new Oh(i(e.x,t.x),i(e.y,t.y),i(e.z,t.z),i(e.w,t.w));case"Matrix":return Lh.FromValues(i(e.m[0],t.m[0]),i(e.m[4],t.m[4]),i(e.m[8],t.m[8]),i(e.m[12],t.m[12]),i(e.m[1],t.m[1]),i(e.m[5],t.m[5]),i(e.m[9],t.m[9]),i(e.m[13],t.m[13]),i(e.m[2],t.m[2]),i(e.m[6],t.m[6]),i(e.m[10],t.m[10]),i(e.m[14],t.m[14]),i(e.m[3],t.m[3]),i(e.m[7],t.m[7]),i(e.m[11],t.m[11]),i(e.m[15],t.m[15]));default:return i(e,t)}}NT.ClassName="FGNegBlock",rh(NT.ClassName,NT);var IT=class e extends tT{_polymorphicRemainder(e,t){return MT(e,t,((e,t)=>e%t))}constructor(t){super(dR,dR,dR,((e,t)=>this._polymorphicRemainder(e,t)),e.ClassName,t)}};IT.ClassName="FGRemainderBlock",rh(IT.ClassName,IT);var xT=class e extends tT{_polymorphicMin(e,t){return MT(e,t,Math.min)}constructor(t){super(dR,dR,dR,((e,t)=>this._polymorphicMin(e,t)),e.ClassName,t)}};xT.ClassName="FGMinBlock",rh(xT.ClassName,xT);var bT=class e extends tT{_polymorphicMax(e,t){return MT(e,t,Math.max)}constructor(t){super(dR,dR,dR,((e,t)=>this._polymorphicMax(e,t)),e.ClassName,t)}};function PT(e,t,i){return Math.min(Math.max(e,Math.min(t,i)),Math.max(t,i))}function wT(e,t,i,n){switch(sT(e)){case"FlowGraphInteger":return new fR(n(e.value,t.value,i.value));case"Vector2":return new Ph(n(e.x,t.x,i.x),n(e.y,t.y,i.y));case"Vector3":return new wh(n(e.x,t.x,i.x),n(e.y,t.y,i.y),n(e.z,t.z,i.z));case"Vector4":return new Oh(n(e.x,t.x,i.x),n(e.y,t.y,i.y),n(e.z,t.z,i.z),n(e.w,t.w,i.w));case"Matrix":return Lh.FromValues(n(e.m[0],t.m[0],i.m[0]),n(e.m[4],t.m[4],i.m[4]),n(e.m[8],t.m[8],i.m[8]),n(e.m[12],t.m[12],i.m[12]),n(e.m[1],t.m[1],i.m[1]),n(e.m[5],t.m[5],i.m[5]),n(e.m[9],t.m[9],i.m[9]),n(e.m[13],t.m[13],i.m[13]),n(e.m[2],t.m[2],i.m[2]),n(e.m[6],t.m[6],i.m[6]),n(e.m[10],t.m[10],i.m[10]),n(e.m[14],t.m[14],i.m[14]),n(e.m[3],t.m[3],i.m[3]),n(e.m[7],t.m[7],i.m[7]),n(e.m[11],t.m[11],i.m[11]),n(e.m[15],t.m[15],i.m[15]));default:return n(e,t,i)}}bT.ClassName="FGMaxBlock",rh(bT.ClassName,bT);var OT=class e extends aT{constructor(t){super(dR,dR,dR,dR,((e,t,i)=>this._polymorphicClamp(e,t,i)),e.ClassName,t)}_polymorphicClamp(e,t,i){return wT(e,t,i,PT)}};function DT(e){return Math.min(Math.max(e,0),1)}OT.ClassName="FGClampBlock",rh(OT.ClassName,OT);var LT=class e extends nT{_polymorphicSaturate(e){return ST(e,DT)}constructor(t){super(dR,dR,(e=>this._polymorphicSaturate(e)),e.ClassName,t)}};LT.ClassName="FGSaturateBlock",rh(LT.ClassName,LT);var FT=class e extends aT{_interpolate(e,t,i){return(1-i)*e+i*t}_polymorphicInterpolate(e,t,i){return wT(e,t,i,this._interpolate)}constructor(t){super(dR,dR,dR,dR,((e,t,i)=>this._polymorphicInterpolate(e,t,i)),e.ClassName,t)}};FT.ClassName="FGInterpolateBlock",rh(FT.ClassName,FT);var kT=class e extends tT{_polymorphicEq(e,t){const i=sT(e),n=sT(t);return rT(i,n)||oT(i,n)||lT(i,n)?e.equals(t):e===t}constructor(t){super(dR,dR,pR,((e,t)=>this._polymorphicEq(e,t)),e.ClassName,t)}};function BT(e,t,i){const n=sT(e);if(n===sT(t)){if(""===n)return i(e,t);if("FlowGraphInteger"===n)return i(e.value,t.value);throw new Error(`Cannot compare ${e} and ${t}`)}throw new Error(`${e} and ${t} are of different types.`)}kT.ClassName="FGEqBlock",rh(kT.ClassName,kT);var GT=class e extends tT{constructor(t){super(dR,dR,pR,((e,t)=>this._polymorphicLessThan(e,t)),e.ClassName,t)}_polymorphicLessThan(e,t){return BT(e,t,((e,t)=>e<t))}};GT.ClassName="FGLessThanBlock",rh(GT.ClassName,GT);var UT=class e extends tT{constructor(t){super(dR,dR,pR,((e,t)=>this._polymorphicLessThanOrEqual(e,t)),e.ClassName,t)}_polymorphicLessThanOrEqual(e,t){return BT(e,t,((e,t)=>e<=t))}};UT.ClassName="FGLessThanOrEqualBlock";var HT=class e extends tT{constructor(t){super(dR,dR,pR,((e,t)=>this._polymorphicGreaterThan(e,t)),e.ClassName,t)}_polymorphicGreaterThan(e,t){return BT(e,t,((e,t)=>e>t))}};HT.ClassName="FGGreaterThanBlock",rh(HT.ClassName,HT);var VT=class e extends tT{constructor(t){super(dR,dR,pR,((e,t)=>this._polymorphicGreaterThanOrEqual(e,t)),e.ClassName,t)}_polymorphicGreaterThanOrEqual(e,t){return BT(e,t,((e,t)=>e>=t))}};VT.ClassName="FGGreaterThanOrEqualBlock",rh(VT.ClassName,VT);var WT=class e extends nT{constructor(t){super(dR,pR,(e=>this._polymorphicIsNan(e)),e.ClassName,t)}_polymorphicIsNan(e){const t=sT(e);if(""===t)return isNaN(e);if("FlowGraphInteger"===t)return isNaN(e.value);throw new Error(`Cannot get NaN of ${e}`)}};WT.ClassName="FGIsNanBlock",rh(WT.ClassName,WT);var zT=class e extends nT{constructor(t){super(dR,pR,(e=>this._polymorphicIsInf(e)),e.ClassName,t)}_polymorphicIsInf(e){const t=sT(e);if(""===t)return!isFinite(e);if("FlowGraphInteger"===t)return!isFinite(e.value);throw new Error(`Cannot get isInf of ${e}`)}};zT.ClassName="FGIsInfBlock";var XT=class e extends nT{_degToRad(e){return e*Math.PI/180}constructor(t){super(dR,dR,(e=>this._polymorphicDegToRad(e)),e.ClassName,t)}_polymorphicDegToRad(e){return ST(e,this._degToRad)}};XT.ClassName="FGDegToRadBlock",rh(XT.ClassName,XT);var YT=class e extends nT{_polymorphicRadToDeg(e){return ST(e,this._radToDeg)}constructor(t){super(dR,dR,(e=>this._polymorphicRadToDeg(e)),e.ClassName,t)}_radToDeg(e){return 180*e/Math.PI}};YT.ClassName="FGRadToDegBlock",rh(YT.ClassName,YT);var jT=class e extends nT{_polymorphicSin(e){return ST(e,Math.sin)}constructor(t){super(dR,dR,(e=>this._polymorphicSin(e)),e.ClassName,t)}};jT.ClassName="FGSinBlock",rh(jT.ClassName,jT);var KT=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicCos(e)),e.ClassName,t)}_polymorphicCos(e){return ST(e,Math.cos)}};KT.ClassName="FGCosBlock",rh(KT.ClassName,KT);var $T=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicTan(e)),e.ClassName,t)}_polymorphicTan(e){return ST(e,Math.tan)}};$T.ClassName="FGTanBlock",rh($T.ClassName,$T);var qT=class e extends nT{_polymorphicAsin(e){return ST(e,Math.asin)}constructor(t){super(dR,dR,(e=>this._polymorphicAsin(e)),e.ClassName,t)}};qT.ClassName="FGAsinBlock",rh(qT.ClassName,qT);var JT=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicAcos(e)),e.ClassName,t)}_polymorphicAcos(e){return ST(e,Math.acos)}};JT.ClassName="FGAcosBlock",rh(JT.ClassName,JT);var QT=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicAtan(e)),e.ClassName,t)}_polymorphicAtan(e){return ST(e,Math.atan)}};QT.ClassName="FGAtanBlock",rh(QT.ClassName,QT);var ZT=class e extends tT{constructor(t){super(dR,dR,dR,((e,t)=>this._polymorphicAtan2(e,t)),e.ClassName,t)}_polymorphicAtan2(e,t){return MT(e,t,Math.atan2)}};ZT.ClassName="FGAtan2Block",rh(ZT.ClassName,ZT);var eN=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicSinh(e)),e.ClassName,t)}_polymorphicSinh(e){return ST(e,Math.sinh)}};eN.ClassName="FGSinhBlock",rh(eN.ClassName,eN);var tN=class e extends nT{_polymorphicCosh(e){return ST(e,Math.cosh)}constructor(t){super(dR,dR,(e=>this._polymorphicCosh(e)),e.ClassName,t)}};tN.ClassName="FGCoshBlock",rh(tN.ClassName,tN);var iN=class e extends nT{constructor(t){super(dR,dR,(e=>this._polymorphicTanh(e)),e.ClassName,t)}_polymorphicTanh(e){return ST(e,Math.tanh)}};iN.ClassName="FGTanhBlock",rh(iN.ClassName,iN);var nN=class e extends nT{constructor(t){super(dR,mR,(e=>this._polymorphicAsinh(e)),e.ClassName,t)}_polymorphicAsinh(e){return ST(e,Math.asinh)}};nN.ClassName="FGAsinhBlock",rh(nN.ClassName,nN);var aN=class e extends nT{_polymorphicAcosh(e){return ST(e,Math.acosh)}constructor(t){super(dR,mR,(e=>this._polymorphicAcosh(e)),e.ClassName,t)}};aN.ClassName="FGAcoshBlock",rh(aN.ClassName,aN);var sN=class e extends nT{_polymorphicAtanh(e){return ST(e,Math.atanh)}constructor(t){super(dR,mR,(e=>this._polymorphicAtanh(e)),e.ClassName,t)}};sN.ClassName="FGAtanhBlock",rh(sN.ClassName,sN);var rN=class e extends nT{_polymorphicExp(e){return ST(e,Math.exp)}constructor(t){super(dR,mR,(e=>this._polymorphicExp(e)),e.ClassName,t)}};rN.ClassName="FGExpBlock",rh(rN.ClassName,rN);var oN=class e extends nT{_polymorphicLog(e){return ST(e,Math.log)}constructor(t){super(dR,mR,(e=>this._polymorphicLog(e)),e.ClassName,t)}};oN.ClassName="FGLogBlock",rh(oN.ClassName,oN);var lN=class e extends nT{constructor(t){super(dR,mR,(e=>this._polymorphicLog2(e)),e.ClassName,t)}_polymorphicLog2(e){return ST(e,Math.log2)}};lN.ClassName="FGLog2Block",rh(lN.ClassName,lN);var cN=class e extends nT{_polymorphicLog10(e){return ST(e,Math.log10)}constructor(t){super(dR,mR,(e=>this._polymorphicLog10(e)),e.ClassName,t)}};cN.ClassName="FGLog10Block",rh(cN.ClassName,cN);var hN=class e extends nT{constructor(t){super(dR,mR,(e=>this._polymorphicSqrt(e)),e.ClassName,t)}_polymorphicSqrt(e){return ST(e,Math.sqrt)}};hN.ClassName="FGSqrtBlock",rh(hN.ClassName,hN);var fN=class e extends nT{_polymorphicCubeRoot(e){return ST(e,Math.cbrt)}constructor(t){super(dR,mR,(e=>this._polymorphicCubeRoot(e)),e.ClassName,t)}};fN.ClassName="FGCubeRootBlock",rh(fN.ClassName,fN);var uN=class e extends tT{constructor(t){super(dR,mR,mR,((e,t)=>this._polymorphicPow(e,t)),e.ClassName,t)}_polymorphicPow(e,t){return MT(e,t,Math.pow)}};uN.ClassName="FGPowBlock",rh(uN.ClassName,uN);var dN=class e extends nT{constructor(t){super(dR,mR,(e=>this._polymorphicLength(e)),e.ClassName,t)}_polymorphicLength(e){switch(sT(e)){case"Vector2":case"Vector3":case"Vector4":return e.length();default:throw new Error(`Cannot compute length of value ${e}`)}}};dN.ClassName="FGLengthBlock",rh(dN.ClassName,dN);var mN=class e extends nT{_polymorphicNormalize(e){switch(sT(e)){case"Vector2":case"Vector3":case"Vector4":return e.normalize();default:throw new Error(`Cannot normalize value ${e}`)}}constructor(t){super(dR,dR,(e=>this._polymorphicNormalize(e)),e.ClassName,t)}};mN.ClassName="FGNormalizeBlock",rh(mN.ClassName,mN);var pN=class e extends tT{constructor(t){super(vR,vR,vR,((e,t)=>wh.Cross(e,t)),e.ClassName,t)}};pN.ClassName="FGCrossBlock",rh(pN.ClassName,pN);var _N=class e extends tT{constructor(t){super(_R,mR,_R,((e,t)=>Ph.Transform(e,Lh.RotationZ(t))),e.ClassName,t)}};_N.ClassName="FGRotate2DBlock",rh(_N.ClassName,_N);var vN=class e extends aT{constructor(t){super(vR,vR,mR,vR,((e,t,i)=>wh.TransformCoordinates(e,Lh.RotationAxis(t,i))),e.ClassName,t)}};vN.ClassName="FGRotate3DBlock",rh(vN.ClassName,vN);var gN=class e extends nT{constructor(t){super(gR,gR,(e=>Lh.Transpose(e)),e.ClassName,t)}};gN.ClassName="FGTransposeBlock",rh(gN.ClassName,gN);var SN=class e extends nT{constructor(t){super(gR,mR,(e=>e.determinant()),e.ClassName,t)}};SN.ClassName="FGDeterminantBlock",rh(SN.ClassName,SN);var yN=class e extends nT{constructor(t){super(gR,gR,(e=>Lh.Invert(e)),e.ClassName,t)}};yN.ClassName="FGInvertMatrixBlock",rh(yN.ClassName,yN);var EN=class e extends tT{constructor(t){super(gR,gR,gR,((e,t)=>t.multiply(e)),e.ClassName,t)}};EN.ClassName="FGMatMulBlock",rh(EN.ClassName,EN);var AN=class e extends nT{constructor(t){super(SR,SR,(e=>new fR(~e.value)),e.ClassName,t)}};AN.ClassName="FGBitwiseNotBlock",rh(AN.ClassName,AN);var CN=class e extends tT{constructor(t){super(SR,SR,SR,((e,t)=>new fR(e.value&t.value)),e.ClassName,t)}};CN.ClassName="FGBitwiseAndBlock",rh(CN.ClassName,CN);var RN=class e extends tT{constructor(t){super(SR,SR,SR,((e,t)=>new fR(e.value|t.value)),e.ClassName,t)}};RN.ClassName="FGBitwiseOrBlock",rh(RN.ClassName,RN);var TN=class e extends tT{constructor(t){super(SR,SR,SR,((e,t)=>new fR(e.value^t.value)),e.ClassName,t)}};TN.ClassName="FGBitwiseXorBlock",rh(TN.ClassName,TN);var NN=class e extends tT{constructor(t){super(SR,SR,SR,((e,t)=>new fR(e.value<<t.value)),e.ClassName,t)}};NN.ClassName="FGBitwiseLeftShiftBlock",rh(NN.ClassName,NN);var MN=class e extends tT{constructor(t){super(SR,SR,SR,((e,t)=>new fR(e.value>>t.value)),e.ClassName,t)}};MN.ClassName="FGBitwiseRightShiftBlock",rh(MN.ClassName,MN);var IN=class e extends nT{constructor(t){super(SR,SR,(e=>new fR(Math.clz32(e.value))),e.ClassName,t)}};IN.ClassName="FGCountLeadingZerosBlock",rh(IN.ClassName,IN);var xN=class e extends nT{constructor(t){super(SR,SR,(e=>new fR(e.value?31-Math.clz32(e.value&-e.value):32)),e.ClassName,t)}};xN.ClassName="FGCountTrailingZerosBlock",rh(xN.ClassName,xN);var bN=class e extends nT{constructor(t){super(SR,SR,(e=>new fR(function(e){let t=0;for(;e;)t+=1&e,e>>=1;return t}(e.value))),e.ClassName,t)}};bN.ClassName="FGCountOneBitsBlock",rh(bN.ClassName,bN);var PN=class e extends HR{getClassName(){return e.ClassName}constructor(e={startIndex:new fR(0)}){super(e),this.config=e,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",SR),this.value=this.registerDataOutput("value",SR)}_execute(e,t){if(t===this.reset)this.value.setValue(this.config.startIndex,e);else{const t=this.value.getValue(e);t.value<this.n.getValue(e).value&&(this.value.setValue(new fR(t.value+1),e),this.out._activateSignal(e))}}};PN.ClassName="FGDoNBlock",rh(PN.ClassName,PN);var wN=class e extends TR{serialize(e){super.serialize(e),e.config.variableName=this.config.variableName}constructor(e){super(e),this.config=e,this.output=this.registerDataOutput(e.variableName,dR)}getClassName(){return e.ClassName}_updateOutputs(e){const t=this.config.variableName;e.hasVariable(t)&&this.output.setValue(e.getVariable(t),e)}};wN.ClassName="FGGetVariableBlock",rh(wN.ClassName,wN);var ON=class e extends HR{constructor(e){super(e),this.config=e,this.input=this.registerDataInput(e.variableName,dR)}getClassName(){return e.ClassName}_execute(e){const t=this.config.variableName,i=this.input.getValue(e);e.setVariable(t,i),this.out._activateSignal(e)}};ON.ClassName="FGSetVariableBlock",rh(ON.ClassName,ON);var DN=class e extends HR{getClassName(){return e.ClassName}constructor(e){super(e),this.config=e,this.condition=this.registerDataInput("condition",pR),this.loopBody=this._registerSignalOutput("loopBody")}serialize(e){super.serialize(e),e.isDo=this.config?.isDo}_execute(e,t){let i=this.condition.getValue(e);for(this.config?.isDo&&!i&&this.loopBody._activateSignal(e);i;)this.loopBody._activateSignal(e),i=this.condition.getValue(e);this.out._activateSignal(e)}};DN.ClassName="FGWhileLoopBlock",rh(DN.ClassName,DN);var LN={"lifecycle/onStart":kR.ClassName,"lifecycle/onTick":BR.ClassName,log:VR.ClassName,"flow/delay":zR.ClassName,"customEvent/send":XR.ClassName,"customEvent/receive":YR.ClassName,"flow/sequence":jR.ClassName,"world/get":qR.ClassName,"world/set":JR.ClassName,"flow/doN":PN.ClassName,"variable/get":wN.ClassName,"variable/set":ON.ClassName,"flow/whileLoop":DN.ClassName,"math/random":dT.ClassName,"math/e":pT.ClassName,"math/pi":_T.ClassName,"math/inf":vT.ClassName,"math/nan":gT.ClassName,"math/abs":yT.ClassName,"math/sign":ET.ClassName,"math/trunc":AT.ClassName,"math/floor":CT.ClassName,"math/ceil":RT.ClassName,"math/fract":TT.ClassName,"math/neg":NT.ClassName,"math/add":cT.ClassName,"math/sub":hT.ClassName,"math/mul":fT.ClassName,"math/div":uT.ClassName,"math/rem":IT.ClassName,"math/min":xT.ClassName,"math/max":bT.ClassName,"math/clamp":OT.ClassName,"math/saturate":LT.ClassName,"math/mix":FT.ClassName,"math/eq":kT.ClassName,"math/lt":GT.ClassName,"math/le":UT.ClassName,"math/gt":HT.ClassName,"math/ge":VT.ClassName,"math/isnan":WT.ClassName,"math/isinf":zT.ClassName,"math/rad":XT.ClassName,"math/deg":YT.ClassName,"math/sin":jT.ClassName,"math/cos":KT.ClassName,"math/tan":$T.ClassName,"math/asin":qT.ClassName,"math/acos":JT.ClassName,"math/atan":QT.ClassName,"math/atan2":ZT.ClassName,"math/sinh":eN.ClassName,"math/cosh":tN.ClassName,"math/tanh":iN.ClassName,"math/asinh":nN.ClassName,"math/acosh":aN.ClassName,"math/atanh":sN.ClassName,"math/exp":rN.ClassName,"math/log":oN.ClassName,"math/log2":lN.ClassName,"math/log10":cN.ClassName,"math/sqrt":hN.ClassName,"math/cbrt":fN.ClassName,"math/pow":uN.ClassName,"math/length":dN.ClassName,"math/normalize":mN.ClassName,"math/dot":mT.ClassName,"math/cross":pN.ClassName,"math/rotate2d":_N.ClassName,"math/rotate3d":vN.ClassName,"math/transpose":gN.ClassName,"math/determinant":SN.ClassName,"math/inverse":yN.ClassName,"math/matmul":EN.ClassName,"math/not":AN.ClassName,"math/and":CN.ClassName,"math/or":RN.ClassName,"math/xor":TN.ClassName,"math/asr":MN.ClassName,"math/lsl":NN.ClassName,"math/clz":IN.ClassName,"math/ctz":xN.ClassName,"math/popcnt":bN.ClassName},FN={float2:"Vector2",float3:"Vector3",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function kN(e,t,i){if(void 0!==e.type){const n=t.types&&t.types[e.type];if(!n)throw new Error(`${i}: Unknown type: ${e.type}`);const a=n.signature;if(!a)throw new Error(`${i}: Type ${e.type} has no signature`);const s=FN[a];return{value:e.value,className:s}}return e.value}function BN(e,t,i){const n=LN[t.type];if(!n)throw new Error(`/extensions/KHR_interactivity/nodes/${e}: Unknown block type: ${t.type}`);const a=e.toString(),s=function(e,t,i){const n={},a=e.configuration??[];for(const e of a)if("customEvent"===e.id){const a=t.customEvents&&t.customEvents[e.value];if(!a)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Unknown custom event: ${e.value}`);n.eventId=a.id,n.eventData=a.values.map((e=>e.id))}else if("variable"===e.id){const a=t.variables&&t.variables[e.value];if(!a)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Unknown variable: ${e.value}`);n.variableName=a.id}else if("path"===e.id){const t=e.value;n.path=t}else n[e.id]=kN(e,t,`/extensions/KHR_interactivity/nodes/${i}`);return n}(t,i,a);return{className:n,config:s,xt:a,metadata:t.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}var GN=class extends KC{constructor(e){super(e,UN)}},UN={nodes:{__array__:{__target__:!0,translation:{type:"Vector3",get:e=>e._babylonTransformNode.position,set:(e,t)=>{t._babylonTransformNode.position=e},getObject:e=>e._babylonTransformNode}}}},HN="KHR_interactivity",VN=class{dispose(){this._loader=null,delete this._pathConverter}onReady(){if(!this._loader.babylonScene||!this._pathConverter)return;const e=this._loader.babylonScene,t=this._loader.gltf.extensions?.KHR_interactivity,i=function(e){const t={xt:Ju(),_userVariables:{},_connectionValues:{}},i=[t],n=[];for(let t=0;t<e.nodes.length;t++){const i=BN(t,e.nodes[t],e);n.push(i)}for(let i=0;i<e.nodes.length;i++){const a=e.nodes[i],s=n[i],r=a.flows??[];for(const e of r){const t=e.id,a={xt:Ju(),name:t,_connectionType:1,connectedPointIds:[]};s.signalOutputs.push(a);const r=e.node,o=e.socket,l=n[r];if(!l)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Could not find node with id ${r} that connects its input with with node ${i}'s output ${t}`);let c=l.signalInputs.find((e=>e.name===o));c||(c={xt:Ju(),name:o,_connectionType:0,connectedPointIds:[]},l.signalInputs.push(c)),c.connectedPointIds.push(a.xt),a.connectedPointIds.push(c.xt)}const o=a.values??[];for(const a of o){const r=a.id,o={xt:Ju(),name:r,_connectionType:0,connectedPointIds:[]};if(s.dataInputs.push(o),void 0!==a.value){const n=kN(a,e,`/extensions/KHR_interactivity/nodes/${i}`);t._connectionValues[o.xt]=n}else{if(void 0===a.node||void 0===a.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Invalid socket ${r} in node ${i}`);{const e=a.node,t=a.socket,s=n[e];if(!s)throw new Error(`/extensions/KHR_interactivity/nodes/${i}: Could not find node with id ${e} that connects its output with node${i}'s input ${r}`);let l=s.dataOutputs.find((e=>e.name===t));l||(l={xt:Ju(),name:t,_connectionType:1,connectedPointIds:[]},s.dataOutputs.push(l)),o.connectedPointIds.push(l.xt),l.connectedPointIds.push(o.xt)}}}}const a=e.variables??[];for(let i=0;i<a.length;i++){const n=a[i],s=n.id;t._userVariables[s]=kN(n,e,`/extensions/KHR_interactivity/variables/${i}`)}return{allBlocks:n,executionContexts:i}}(t),n=new FR({scene:e});LR.Parse(i,{coordinator:n,pathConverter:this._pathConverter}),n.start()}constructor(e){this._loader=e,this.name=HN,this.enabled=this._loader.isExtensionUsed(HN),this._pathConverter=new GN(this._loader.gltf)}};IA.RegisterExtension(HN,(e=>new VN(e)));var WN="ExtrasAsMetadata",zN=class{loadCameraAsync(e,t,i){return this._loader.loadCameraAsync(e,t,(e=>{this._assignExtras(e,t),i(e)}))}loadNodeAsync(e,t,i){return this._loader.loadNodeAsync(e,t,(e=>{this._assignExtras(e,t),i(e)}))}dispose(){this._loader=null}createMaterial(e,t,i){const n=this._loader.createMaterial(e,t,i);return this._assignExtras(n,t),n}_assignExtras(e,t){if(t.extras&&Object.keys(t.extras).length>0){const i=e.metadata=e.metadata||{};(i.gltf=i.gltf||{}).extras=t.extras}}constructor(e){this.name=WN,this.enabled=!0,this._loader=e}};IA.RegisterExtension(WN,(e=>new zN(e))),c(),vn(),rs(),gn(),Ds();e.ShadersStore.outlinePixelShader="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;uniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n#define CUSTOM_FRAGMENT_MAIN_END\n}",c(),G(),Rn(),Tn(),Nn(),Dn(),es(),rs(),Ln(),Fn(),kn(),z(),Bn(),Un(),ms();e.ShadersStore.outlineVertexShader="attribute vec3 position;attribute vec3 normal;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;uniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{vec3 positionUpdated=position;vec3 normalUpdated=normal;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\nvec3 offsetPosition=positionUpdated+(normalUpdated*offset);\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(offsetPosition,1.0);gl_Position=viewProjection*worldPos;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n}\n",dv.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new XN(this)),this._outlineRenderer},Object.defineProperty(wm.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOutline=e},enumerable:!0,configurable:!0}),Object.defineProperty(wm.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOverlay=e},enumerable:!0,configurable:!0});var XN=class e{_afterRenderingMesh(e,t,i){if(e.renderOverlay){const e=this._engine.getAlphaMode(),n=this._engine.alphaState.alphaBlend;this._engine.setAlphaMode(2),this.render(t,i,!0,this._passIdForDrawWrapper[3]),this._engine.setAlphaMode(e),this._engine.setDepthWrite(this._savedDepthWrite),this._engine.alphaState.alphaBlend=n}e.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(t,i,!1,this._passIdForDrawWrapper[2]),this._engine.setColorWrite(!0))}rebuild(){}dispose(){for(let e=0;e<this._passIdForDrawWrapper.length;++e)this._engine.releaseRenderPassId(this._passIdForDrawWrapper[e])}render(e,t,i=!1,n){n=n??this._passIdForDrawWrapper[0];const a=this.scene,s=a.getEngine(),r=s.getCaps().instancedArrays&&(null!==t.visibleInstances[e._id]&&void 0!==t.visibleInstances[e._id]||e.getRenderingMesh().hasThinInstances);if(!this.isReady(e,r,n))return;const o=e.getMesh(),l=o._internalAbstractMeshDataInfo._actAsRegularMesh?o:null,c=e.getRenderingMesh(),h=l||c,f=e.getMaterial();if(!f||!a.activeCamera)return;const u=e._getDrawWrapper(n),d=df.GetEffect(u);if(s.enableEffect(u),f.useLogarithmicDepth&&d.setFloat("logarithmicDepthConstant",2/(Math.log(a.activeCamera.maxZ+1)/Math.LN2)),d.setFloat("offset",i?0:c.outlineWidth),d.setColor4("color",i?c.overlayColor:c.outlineColor,i?c.overlayAlpha:f.alpha),d.setMatrix("viewProjection",a.getTransformMatrix()),d.setMatrix("world",h.getWorldMatrix()),c.useBones&&c.computeBonesUsingShaders&&c.skeleton&&d.setMatrices("mBones",c.skeleton.getTransformMatrices(c)),c.morphTargetManager&&c.morphTargetManager.isUsingTextureForTargets&&c.morphTargetManager._bind(d),Qd(c,d),r||c._bind(e,d,f.fillMode),f&&f.needAlphaTesting()){const e=f.getAlphaTestTexture();e&&(d.setTexture("diffuseSampler",e),d.setMatrix("diffuseMatrix",e.getTextureMatrix()))}Wd(d,f,a),s.setZOffset(-this.zOffset),s.setZOffsetUnits(-this.zOffsetUnits),c._processRendering(h,e,d,f.fillMode,t,r,((e,t)=>{d.setMatrix("world",t)})),s.setZOffset(0),s.setZOffsetUnits(0)}isReady(e,t,i){i=i??this._passIdForDrawWrapper[0];const n=[],a=[$h.PositionKind,$h.NormalKind],s=e.getMesh(),r=e.getMaterial();if(!r)return!1;const o=s.getScene();r.needAlphaTesting()&&(n.push("#define ALPHATEST"),s.isVerticesDataPresent($h.UVKind)&&(a.push($h.UVKind),n.push("#define UV1")),s.isVerticesDataPresent($h.UV2Kind)&&(a.push($h.UV2Kind),n.push("#define UV2"))),r.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH"),Vd(r,o,n),s.useBones&&s.computeBonesUsingShaders?(a.push($h.MatricesIndicesKind),a.push($h.MatricesWeightsKind),s.numBoneInfluencers>4&&(a.push($h.MatricesIndicesExtraKind),a.push($h.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),n.push("#define BonesPerMesh "+(s.skeleton?s.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0");const l=s.morphTargetManager;let c=0;l&&(c=l.numMaxInfluencers||l.numInfluencers,c>0&&(n.push("#define MORPHTARGETS"),n.push("#define NUM_MORPH_INFLUENCERS "+c),l.isUsingTextureForTargets&&n.push("#define MORPHTARGETS_TEXTURE"),$d(a,s,c))),t&&(n.push("#define INSTANCES"),Jd(a),e.getRenderingMesh().hasThinInstances&&n.push("#define THIN_INSTANCES"));const h=e._getDrawWrapper(i,!0),f=h.defines,u=n.join("\n");if(f!==u){const e=["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices"];Hd(e),h.setEffect(this.scene.getEngine().createEffect("outline",a,e,["diffuseSampler","morphTargets"],u,void 0,void 0,void 0,{maxSimultaneousMorphTargets:c}),u)}return h.effect.isReady()}register(){this.scene._beforeRenderingMeshStage.registerStep(Rm.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(Rm.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)}constructor(e){this.name=Rm.NAME_OUTLINERENDERER,this.zOffset=1,this.zOffsetUnits=4,this.scene=e,this._engine=e.getEngine(),this.scene._addComponent(this),this._passIdForDrawWrapper=[];for(let e=0;e<4;++e)this._passIdForDrawWrapper[e]=this._engine.createRenderPassId(`Outline Renderer (${e})`)}_beforeRenderingMesh(t,i,n){if(this._savedDepthWrite=this._engine.getDepthWrite(),t.renderOutline){const a=i.getMaterial();a&&a.needAlphaBlendingForMesh(t)&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(7681),this._engine.setStencilFunction(519),this._engine.setStencilMask(e._StencilReference),this._engine.setStencilFunctionReference(e._StencilReference),this._engine.stencilStateComposer.useStencilGlobalOnly=!0,this.render(i,n,!0,this._passIdForDrawWrapper[1]),this._engine.setColorWrite(!0),this._engine.setStencilFunction(517)),this._engine.setDepthWrite(!1),this.render(i,n,!1,this._passIdForDrawWrapper[0]),this._engine.setDepthWrite(this._savedDepthWrite),a&&a.needAlphaBlendingForMesh(t)&&(this._engine.stencilStateComposer.useStencilGlobalOnly=!1,this._engine.restoreStencilState())}}};XN._StencilReference=4;var YN,jN,KN,$N,qN,JN,QN,ZN,eM,tM,iM,nM,aM,sM,rM,oM,lM,cM,hM,fM,uM,dM,mM,pM,_M,vM,gM,SM=null,yM=null,EM=void 0,AM=!1,CM=!1,RM=!1,TM=!1,NM=!1,MM="",IM={},xM=!1,bM=!1,PM=null,wM=null,OM=!1,DM={},LM=!1,FM=null,kM={},BM=!1,GM=!1,UM=!1,HM=null,VM=null,WM=null,zM=!1,XM=!1,YM=[],jM={},KM=0,$M=!1,qM=null,JM=null,QM=!1,ZM=null,eI=null,tI=null,iI=[],nI=document.createElement("canvas"),aI=!1,sI=!0,rI=navigator.language,oI=parsedUrl.query.debug,lI=null,cI=!1,hI=null,fI=!1,uI=!1,dI=null,mI=!1,pI=!1,_I=!1,vI=null,gI=!1,SI=!1,yI=null,EI=!1,AI=!1,CI=null,RI=[],TI=null,NI=null,MI=!0,II=!1,xI="pass_welcome",bI=15084,PI=!1,wI=null,OI=!1,DI={discord:0,ticTok:0},LI={},FI={},kI=["midMonthGiveMeEggs","newYolkerSignupReward","newYolkerItemReward","newYolkerWelcomeBack","WelcomeBack","mercZoneFinalGift","merryEggsmas"],BI={premFeatOne:0,premFeatTwo:0},GI={text:["#fff100","#00ffff","#f53e40"],meBackground:["rgba(255, 192, 64, 0.75)","rgba(0, 192, 255, 0.8)","rgba(192, 64, 32, 0.8)"],themBackground:["rgba(0, 0, 0, 0.25)","rgba(0, 64, 192, 0.3)","rgba(192, 64, 32, 0.3)"],summaryBackground:["rgba(64, 64, 64, 0.75)","rgba(0, 64, 192, 0.75)","rgba(192, 64, 32, 0.75)"],outline:[new Ch(1,1,1,-1),new Ch(0,.75,1,.3),new Ch(1,.25,.25,.3)],textColor:[new Ch(1,1,1,1),new Ch(0,.75,1,1),new Ch(1,.25,.25,1)],meClass:["playerSlot-me","playerSlot-me-blue","playerSlot-me-red"],rk:["playerSlot-them","playerSlot-them-blue","playerSlot-them-red"]},UI={isCaseSensitive:!1,includeScore:!0,shouldSort:!0,includeMatches:!0,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.2,distance:100,useExtendedSearch:!0,keys:["name","unlock","item_data.tags","item_data.meshName"]},HI=!1,VI=[{version:"1.0.0",date:"Apr 1 2025",content:["EGG ORG have returned from the shadows! Sides have been drawn & only one will win!","The winning side will unlock a special skin for all eggs!","Get more info, check the score & change sides by clicking the banner on the homescreen","Changing teams is possible but costly!","EGG ORG are messing with eggtopia, all killstreak bonuses are now RANDOM!","Be the biggest egg in the Dojo with the latest Premium Sumo Hat - in-store & free for VIPs ","Upgraded database to the latest SQL version - let us know if something is unusual... more than normal.","Enjoy the latest map, Yolkido, in public and private lobbies","Moved Outer Reach, Facility, Timetwist, Jailbreak, Wreckage & Exposure to the Public map pool","Moved Uncovered, Foundation, Metamorph, Shipyard, Road, Shellville & Cash to the Private map pool"]}],WI=[{itemIds:null,sku:"egg_pack_small",name:"Small Pack",price:3,salePrice:5,flagText:"",type:"currency",inStore:1,currency:3e4,isActive:!0,id:1},{itemIds:null,sku:"egg_pack_medium",name:"Medium Pack",price:6,salePrice:10,flagText:"",type:"currency",inStore:1,currency:65e3,isActive:!0,id:2},{itemIds:null,sku:"egg_pack_large",name:"Large Pack",price:12,salePrice:20,flagText:"",type:"currency",inStore:1,currency:15e4,isActive:!0,id:3},{itemIds:null,sku:"egg_pack_giant",name:"Giant Pack",price:50,salePrice:25,flagText:"p_egg_shop_bestvalue",type:"currency",inStore:0,currency:5e4,isActive:!0,id:4},{itemIds:[4223],sku:"item_gun_m24_techno",name:"Untz Untz Gun",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:8},{itemIds:[1112],sku:"item_hat_yolk_arms",name:"Yolk Arms",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:9},{itemIds:[1105],sku:"item_hat_cape",name:"Magic Cape",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:10},{itemIds:[1092],sku:"item_hat_dragon",name:"GoE Dragon",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:11},{itemIds:[1110],sku:"item_hat_space_gladi",name:"Space Gladiator",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:12},{itemIds:[1126],sku:"item_hat_zombie_mask",name:"Zombie Mask",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:13},{itemIds:[3016],sku:"item_gun_9mm_space",name:"Cluck 9mm Space Egg",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:14},{itemIds:[1125],sku:"item_hat_oni",name:"Oni Hat",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:15},{itemIds:[3416],sku:"item_gun_csg1_space",name:"CSG1 Space Egg Skin",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:16},{itemIds:[1160],sku:"item_hat_galeggsy",name:"Galeggsy Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:17},{itemIds:[3025],sku:"item_gun_9mm_techno",name:"Cluck 9mm Techno",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:18},{itemIds:[1171],sku:"item_hat_rooter_wing",name:"Rooster Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:19},{itemIds:[4026],sku:"item_gun_smg_techno",name:"Tuh SMG",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:20},{itemIds:[1174],sku:"item_hat_demon_wings",name:"Demon Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:21},{itemIds:[3627],sku:"gun_gauge_techno",name:"Badoosh Dozen Gauge",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:22},{itemIds:[1184],sku:"item_hat_fallen_wing",name:"Fallen Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:23},{itemIds:[3426],sku:"item_gun_csg1_techno",name:"CSG1 Techno Catz",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:24},{itemIds:[1185,2204,16011],sku:"1oOnkjL7",name:"1 month membership",price:699,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!0,id:25},{itemIds:[1185,2204,16011],sku:"K5JjxL1z",name:"3 month membership",price:1499,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!0,id:26},{itemIds:[1185,2204,16011],sku:"TymKKdoQ",name:"12 month membership",price:4999,salePrice:null,flagText:"p_egg_shop_bestvalue",type:"subscription",inStore:0,currency:0,isActive:!0,id:27},{itemIds:[1186],sku:"item_hat_chrome_wing",name:"Chrome Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:29},{itemIds:[3126],sku:"gun_eggk47_techno",name:"Eggk Poggers",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:30},{itemIds:[1193],sku:"item_hat_steamWings",name:"Steampunk Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:31},{itemIds:[3828],sku:"item_gun_rpeggTechno",name:"RPEGGTechno",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:32},{itemIds:[3029],sku:"item_gun_retro_9mm",name:"Retro Skin Cluck9mm",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:33},{itemIds:[1195],sku:"item_hat_pixel_wings",name:"Angel Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:34},{itemIds:[16014],sku:"item_gre_skullnado",name:"Skullnado",price:7,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:35},{itemIds:[1202],sku:"item_hat_skull_wings",name:"Skull Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:36},{itemIds:[4512],sku:"item_gun_aug_retro",name:"Retro TriHard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:37},{itemIds:[1215],sku:"item_hat_robot_wings",name:"Robot Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:38},{itemIds:[16019],sku:"item_gre_unicorn",name:"Unicorn Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:39},{itemIds:[1222],sku:"item_hat_uni_wing",name:"Unicorn Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:40},{itemIds:[4229],sku:"item_gun_m24_retro",name:"M2DZ Retro Skin",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:41},{itemIds:[1226],sku:"item_hat_fairy_wings",name:"Fairy Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:42},{itemIds:[16023],sku:"item_gre_toilet_papr",name:"Grenade Toilet Paper",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:43},{itemIds:[3431],sku:"item_gun_csg1_retro",name:"CSG1 Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:45},{itemIds:[1235],sku:"item_hat_pixel_fire",name:"Fire Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:46},{itemIds:[16027],sku:"item_gre_glitterbomb",name:"Grenade Glitterbomb",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:47},{itemIds:[1241],sku:"item_hat_glitch_wing",name:"Glitch Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:48},{itemIds:[3634],sku:"item_gun_crack_retro",name:"Scrambler Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:49},{itemIds:[1245],sku:"item_hat_moth_wings",name:"Moth Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:50},{itemIds:[16032],sku:"item_gre_thermal",name:"Grenade Thermal Detonator",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:51},{itemIds:[1248],sku:"hat_thermal_wings",name:"Thermal Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:52},{itemIds:[4032],sku:"item_gun_smg_retro",name:"SMEGG Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:53},{itemIds:[1269],sku:"item_hat_pixel_butt",name:"Pixel Butterfly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:54},{itemIds:[1272],sku:"item_hat_pixel_bird",name:"Pixel Bird Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:55},{itemIds:[16036],sku:"item_gre_supernova",name:"Grenade Supernova",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:56},{itemIds:[16038],sku:"item_gre_octopus",name:"Grenade Octopus",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:57},{itemIds:[3835],sku:"item_gun_rpegg_retro",name:"RPEGG Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:58},{itemIds:[1212],sku:"item_hat_dog_cap",name:"Dog Cap",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:59},{itemIds:[1044],sku:"item_hat_egg_glasses",name:"Egg Glasses",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:60},{itemIds:[1288],sku:"item_hat_luckywings",name:"Lucky Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:61},{itemIds:[3637],sku:"item_gun_bros",name:"Dozen Gauge Bros",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:63},{itemIds:[4528],sku:"item_gun_valk_aug",name:"Trihard Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:64},{itemIds:[16041],sku:"item_gre_diablo",name:"Grenade Diablo",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:65},{itemIds:[3134],sku:"item_gun_ak_retro",name:"Eggk47 Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:66},{itemIds:[3136],sku:"item_gun_ak_valkyrie",name:"Eggk47 Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:67},{itemIds:[1312],sku:"item_hat_dinowings",name:"Dino Pterodactyl Win",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:68},{itemIds:[1316],sku:"item_hat_airplane",name:"Airplane Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:69},{itemIds:[16044],sku:"item_gre_bumble",name:"Grenade Bumblebee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:71},{itemIds:[3642],sku:"item_gauge_valk",name:"Valkyrie Scrambler",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:72},{itemIds:[16046],sku:"item_gre_football",name:"Grenade Football",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:73},{itemIds:[16048],sku:"item_gre_valk",name:"Grenade Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:74},{itemIds:[3439],sku:"item_csg1_rubchick",name:"CSG1 Rubber Chicken",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:75},{itemIds:[16049],sku:"item_gre_milk",name:"Grenade Milk",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:76},{itemIds:[4240],sku:"item_gun_m24_scav",name:"Crackshot Scavenger",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:77},{itemIds:[3045],sku:"item_gun_9mm_valk",name:"Cluck 9mm Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:78},{itemIds:[1341],sku:"item_hat_rainbow",name:"Rainbow Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:79},{itemIds:[3441],sku:"item_range_valk",name:"Free-Ranger Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:80},{itemIds:[1349],sku:"item_hat_teggtris",name:"Teggtris wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:81},{itemIds:[16054],sku:"item_gre_blood",name:"Grenade Blood",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:82},{itemIds:[1356],sku:"item_hat_bloodwing",name:"Blood Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:83},{itemIds:[3843],sku:"item_gun_rpegg_valk",name:"RPEGG Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:84},{itemIds:[4040],sku:"item_gun_smg_turk",name:"Turkey-Supreme Whipp",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:85},{itemIds:[4242],sku:"item_gun_m24_valk",name:"Crackshot Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:86},{itemIds:[1363],sku:"item_hat_fall",name:"Fall Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:87},{itemIds:[3844],sku:"item_rpegg_christ",name:"RPEGG Santa Boot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:88},{itemIds:[1369],sku:"item_holy_wings",name:"Holly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:89},{itemIds:[4042],sku:"item_gun_smg_valk",name:"Whipper Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:90},{itemIds:[3443],sku:"item_csg1_fusion",name:"Free-Ranger Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:92},{itemIds:[1372],sku:"item_hat_soundwave",name:"Sound Wave Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:93},{itemIds:[3650],sku:"item_gauge_octopus",name:"Octopus Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:94},{itemIds:[3050],sku:"item_9mm_cloud",name:"Cluck 9mm Clouds",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:95},{itemIds:[3142],sku:"item_ak47_fusion",name:"Eggk47 Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:96},{itemIds:[4044],sku:"item_smg_fusion",name:"Whipper Fusion",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:99},{itemIds:[1394],sku:"item_hat_hooped",name:"Hooped",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:100},{itemIds:[3654],sku:"item_gauge_monster",name:"Beholder Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:101},{itemIds:[1400],sku:"item_qwings",name:"Question Block Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:102},{itemIds:[3054],sku:"item_9mm_fusion",name:"Cluck 9mm Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:103},{itemIds:[15023],sku:"item_melee_stone",name:"Stone Hammer Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:104},{itemIds:[3445],sku:"item_csg1_shellpreme",name:"Free-Ranger Shellpre",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:105},{itemIds:[3655],sku:"item_gauge_fusion",name:"Fusion Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:106},{itemIds:[3055],sku:"item_9mm_camera",name:"Cluck 9mm Camera",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:107},{itemIds:[1417],sku:"item_hat_surf",name:"Octopus Surfboard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:108},{itemIds:[15013],sku:"item_melee_valk",name:"Melee Valkyrie",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:109},{itemIds:[15030],sku:"item_melee_fusion",name:"The Fusion Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:110},{itemIds:[1423],sku:"item_hat_scales",name:"Scales of Justice",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:111},{itemIds:[4540],sku:"item_aug_fusion",name:"Fusion Trihard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:113},{itemIds:[16064],sku:"item_gre_timebomb",name:"Timebomb Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:115},{itemIds:[15037],sku:"item_melee_cat",name:"Harrison Cat Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:120},{itemIds:[3059],sku:"item_9mm_mega",name:"Megaphone Cluck 9mm",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:121},{itemIds:[4248],sku:"item_m24_fusion",name:"The Fusion Crackshot",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:124},{itemIds:[3951],sku:"item_rpegg_fusion",name:"Fusion RPEGG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:126},{itemIds:[3952],sku:"item_rpegg_skele",name:"Skellington RPEGG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:128},{itemIds:[3149],sku:"item_ak_infernal",name:"Infernal Eggk47",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:129},{itemIds:[15047],sku:"item_melee_turkcar",name:"The Turkey Carver",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:134},{itemIds:[1470],sku:"item_hat_owl",name:"Snow Owl Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:136},{itemIds:[4253],sku:"item_m24_infernal",name:"Infernal Crackshot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:138},{itemIds:[3455],sku:"item_csg1_infernal",name:"Infernal CSG1",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:140},{itemIds:[3662],sku:"item_gauge_cloud",name:"Cloudkicker Scramble",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:144},{itemIds:[16074],sku:"item_gre_fusion",name:"Fusion Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:146},{itemIds:[3663],sku:"item_gauge_irish",name:"Irish Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:148},{itemIds:[3058],sku:"item_9mm_infernal",name:"Infernal Cluck 9mm",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:150},{itemIds:[3154],sku:"item_ak_choc",name:"gun_eggk47_Chocolate",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:151},{itemIds:[4256],sku:"item_m24_cyborg",name:"Cyborg Crackshot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:152},{itemIds:[4550],sku:"item_aug_infernal",name:"Infernal Tri-hard",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:155},{itemIds:[4054],sku:"item_smg_infernal",name:"Infernal SMG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:159},{itemIds:[15063],sku:"item_melee_infernal",name:"Infernal Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:163},{itemIds:[3665],sku:"item_gauge_infernal",name:"Infernal Scrambler",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:166},{itemIds:[3958],sku:"item_rpegg_infernal",name:"Infernal RPEGG",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:172},{itemIds:[16082],sku:"item_gre_infernal",name:"Infernal Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:176},{itemIds:[15072],sku:"item_melee_pan",name:"Frying Pan Melee",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:180},{itemIds:[15074],sku:"item_melee_panegg",name:"Let Them Cook Melee",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:181},{itemIds:[1565],sku:"item_hat_sleigh",name:"Santa's Sleigh",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:185},{itemIds:[1073,4216,15084,16038],sku:"pass_welcome",name:"Welcome Bonus",price:1,salePrice:null,flagText:"",type:"pass",inStore:1,currency:5e4,isActive:!0,id:187},{itemIds:[15083],sku:"item_melee_frost",name:"Frostfall Whisk",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:188},{itemIds:[1569],sku:"item_hat_equal",name:"The Equalizer",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:190},{itemIds:[1578],sku:"item_hat_frost",name:"The Frostfall Wings",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:197},{itemIds:[3070],sku:"item_9mm_frost",name:"Frostfall 9mm",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0,id:200},{itemIds:[1587,2167,3071,15088],sku:"bun_rd",name:"Red Dragon Bundle",price:6,salePrice:null,flagText:"",type:"bundle",inStore:1,currency:0,isActive:!0,id:203},{itemIds:[1589],sku:"item_hat_pixair",name:"Pixel Airplane Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:1,currency:0,isActive:!0,id:204}],zI=[{id:1001,name:"Ball Cap",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ballCap",tags:["Green","White"]},is_available:!0,unlock:"default",align:{x:-.12075649338775385,y:-.2670312477499075,z:-.05526682671835026}},{id:1002,name:"Boat Fedora",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boatHat",tags:["Blue","Yellow"]},is_available:!0,unlock:"default",align:{x:-.06794416359249578,y:-.2926280197469384,z:-.031091489433501096}},{id:1003,name:"Top Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_topHat",tags:["Black","Grey","Gray"]},is_available:!0,unlock:"default",align:{x:-.07981952093539624,y:-.3437907063524166,z:-.036536185440272706}},{id:1004,name:"Derby Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_derby",tags:["Orange","Brown"]},is_available:!0,unlock:"default",align:{x:-.07446247955425545,y:-.32070966531188816,z:-.03407966061498702}},{id:1005,name:"Mountie Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mounty",tags:["Brown","Police"]},is_available:!0,unlock:"default",align:{x:-.07281390620627182,y:-.313607479576798,z:-.03332383477670581}},{id:1006,name:"Pablo Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowSheriff",tags:["Orange","Brown","Police","Meme"]},is_available:!0,unlock:"default",align:{x:-.07552652492916812,y:-.3252818085896001,z:-.03455986096692204}},{id:1007,name:"Blue Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaBlue",tags:["Blue"]},is_available:!0,unlock:"purchase",align:{x:-.007368110577478548,y:-.19183106931370097,z:-.0033645168072600345}},{id:1008,name:"Hero Mask",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batman",tags:["Black","Brown","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.08850633059890223,y:-.20411254048573135,z:-.04050447716602543}},{id:1009,name:"Cop Hat",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cop",tags:["Blue","Gold","Black"]},is_available:!0,unlock:"purchase",align:{x:-.09346306940354143,y:-.3048509545616378,z:-.04277696469919828}},{id:1010,name:"Robber Mask",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg2",tags:["Black","Purple"]},is_available:!0,unlock:"purchase",align:{x:-.06208516448358958,y:-.23382330506514326,z:-.030489917048234644}},{id:1011,name:"Red Bandana",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaRed",tags:["Red"]},is_available:!0,unlock:"purchase",align:{x:-.03329404211409126,y:-.09315583255063686,z:-.0338189869509566}},{id:1012,name:"Pink Bow",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bowPink",tags:["Pink"]},is_available:!0,unlock:"purchase",align:{x:-.07152407629324964,y:-.16299272012141341,z:-.03272766766614457}},{id:1013,name:"Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glasses",tags:["Black"]},is_available:!0,unlock:"purchase",align:{x:-.11215674530971143,y:-.12985890272324596,z:-.05132938270796705}},{id:1014,name:"Pompadour",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pompadour",tags:["Black","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.04210170142754954,y:-.1703824912060592,z:-.01927515951061251}},{id:1015,name:"Plague Doctor Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_plagueDoctor",tags:["Black"]},is_available:!0,unlock:"purchase",align:{x:-.14593688893752033,y:-.1458279454647442,z:-.06679311948184694}},{id:1016,name:"Poop Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_poop",tags:["Brown","Yellow","Gold","Poop"]},is_available:!0,unlock:"purchase",align:{x:-.07576287181211017,y:-.2815449537609993,z:-.047155212248999545}},{id:1017,name:"Unicorn Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_unicorn",tags:["Red","Orange","Yellow","Green","Blue","Silver","Rainbow"]},is_available:!0,unlock:"purchase",align:{x:-.008777315183921996,y:-.2019233629032106,z:-.004008638766223961}},{id:1018,name:"Baws Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pimp",tags:["Black","White","Grey","Gray","Purple"]},is_available:!0,unlock:"purchase",align:{x:-.07524018320712944,y:-.2980561083433546,z:-.04214661518926316}},{id:1019,name:"Pirate Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pirateHat",tags:["Black","Red"]},is_available:!0,unlock:"purchase",align:{x:.038701332916645015,y:-.33612905457241826,z:.017725198966349165}},{id:1023,name:"Hunting Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hunting",tags:["Red"]},is_available:!0,unlock:"purchase",align:{x:-.07052450007171451,y:-.24257874509170918,z:-.032275120288940806}},{id:1024,name:"Happy Bear Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_huntingBear",tags:["Pink","Heart","Cute"]},is_available:!0,unlock:"purchase",align:{x:-.09769183784970448,y:-.23620789822747934,z:-.04470940837408727}},{id:1025,name:"Crown",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crown",tags:["Gold","Red","Royal"]},is_available:!0,unlock:"purchase",align:{x:-.07916117268462308,y:-.3409402733304543,z:-.036456397957456144}},{id:1020,name:"ShellShockers Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shellshockers",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_hat",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/splat-hat",tags:["White","Brown","Egg"]},is_available:!1,unlock:"physical",align:{x:-.12105426939220987,y:-.26831388754484853,z:-.055403073383391954}},{id:1021,name:"Frying Pan",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fryingPan",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_pan",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/no-pans-tee",tags:["Black","Silver"]},is_available:!1,unlock:"physical",align:{x:-.11201926980773491,y:-.22758383372001356,z:.11466896053477657}},{id:1022,name:"Viking Horns",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_horns",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_shirt",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/logo-tee",tags:["Brown","Bone"]},is_available:!1,unlock:"physical",align:{x:-.1099168405070956,y:-.28237664010873953,z:-.05142539504200483}},{id:1026,name:"Jack O' Lantern Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkin",tags:["Halloween","Oct23","Orange","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.08877468412138612,y:-.35784089569708666,z:-.040628405489095076}},{id:1027,name:"Bat Wings",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batWings",tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase",align:{x:.02978222309901922,y:-.31216370123269704,z:.013630059749994518}},{id:1028,name:"Witch Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_witch",tags:["Halloween","Purple","Gold","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.08843731903919094,y:-.3808892641791377,z:-.040473991412663834}},{id:1029,name:"Axe-in-head",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_axe",tags:["Halloween","Oct23","Red","Brown","Wood","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.11495007537093782,y:-.36874335549165216,z:.049209529757712867}},{id:1030,name:"Executioner's Cowl",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_executioner",tags:["Halloween","Oct23","Red","Black","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.0390971212209168,y:-.2468287543633152,z:-.017893093144459582}},{id:1031,name:"Devil Horns",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_devilHorns",tags:["Halloween","Oct23","Red","Oct24","bun_demon"]},is_available:!1,unlock:"purchase",align:{x:-.15973168149370132,y:-.25177154715062167,z:-.0731024120297798}},{id:1032,name:"Angel Wings & Halo",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angel",tags:["Halloween","Oct23","Gold","White","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.0716592226014976,y:-.3086211609886207,z:-.032795385093542906}},{id:1033,name:"Hockey Mask",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hockeyMask",tags:["Halloween","Oct23","Black","White","Oct24"]},is_available:!1,unlock:"purchase",align:{x:-.07589509037547937,y:-.16818670050730733,z:-.0347356499804236}},{id:1034,name:"Pilgrim Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pilgrim",tags:["NovM23","Thanksgiving","Black","Brown","Gold","NovM24"]},is_available:!1,unlock:"purchase",align:{x:-.08367638664963417,y:-.3603847907294966,z:-.03829511470354685}},{id:1035,name:"Cooked Turkey Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turkeyDead",tags:["NovM23","Thanksgiving","Brown","NovM24"]},is_available:!1,unlock:"purchase",align:{x:-.08560931605836686,y:-.3608351087257782,z:-.039177128845210685}},{id:1036,name:"Turkey Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turkeyAlive",tags:["NovM23","Thanksgiving","Brown","Red","NovM24"]},is_available:!1,unlock:"purchase",align:{x:-.11404848303094717,y:-.39460177972163324,z:-.051068506334921826}},{id:1037,name:"Golden Chicken Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_Top1Percent",tags:["Reward","RewardTopPercent","Gold"]},is_available:!1,unlock:"manual",align:{x:-.12167748309378656,y:-.39821262976584126,z:-.055643594750763914}},{id:1038,name:"Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier1",tags:["Reward","RewardKills","Grey","Gray"]},is_available:!1,unlock:"manual",align:{x:-.10368928049503356,y:-.30866668214003234,z:-.03454567398459779}},{id:1039,name:"Bronze Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier2",tags:["Reward","RewardKills","Red","Brown"]},is_available:!1,unlock:"manual",align:{x:-.10368928049503356,y:-.30866668214003234,z:-.03454567398459779}},{id:1040,name:"Silver Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier3",tags:["Reward","RewardKills","Gray","Blue"]},is_available:!1,unlock:"manual",align:{x:-.10368928049503356,y:-.30866668214003234,z:-.03454567398459779}},{id:1041,name:"Gold Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier4",tags:["Reward","RewardKills","Gold","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.10368928049503356,y:-.30866668214003234,z:-.03454567398459779}},{id:1042,name:"Cracked Egg Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier1",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual",align:{x:-.11030323640447248,y:-.2896262491678324,z:.020385131504372322}},{id:1043,name:"Egg Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier2",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual",align:{x:-.048033927839143065,y:-.2180969454203714,z:-.021983090293065694}},{id:1044,name:"Egg Glasses",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier3",tags:["Reward","RewardDeaths","Yellow","White","MayM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_egg_glasses"],align:{x:-.12332005541021429,y:-.14104254579369258,z:-.0564383560017033}},{id:1045,name:"Cracked Egg Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier4",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual",align:{x:-.0981315547263597,y:-.3846123488611959,z:-.04491118067578559}},{id:1046,name:"Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier1",tags:["Reward","RewardKDR","Bone"]},is_available:!1,unlock:"manual",align:{x:-.16209354742210902,y:-.21191916844016578,z:-.07417661895069405}},{id:1047,name:"Bronze Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier2",tags:["Reward","RewardKDR","Red","Brown"]},is_available:!1,unlock:"manual",align:{x:-.16209354742210902,y:-.21191916844016578,z:-.07417661895069405}},{id:1048,name:"Silver Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier3",tags:["Reward","RewardKDR","Silver","Blue"]},is_available:!1,unlock:"manual",align:{x:-.16209354742210902,y:-.21191916844016578,z:-.07417661895069405}},{id:1049,name:"Gold Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier4",tags:["Reward","RewardKDR","Yellow","Gold"]},is_available:!1,unlock:"manual",align:{x:-.16209354742210902,y:-.21191916844016578,z:-.07417661895069405}},{id:1050,name:"Golden Egg Trophy",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier1",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.0890999824704708,y:-.3863056827916843,z:-.04038368444876095}},{id:1051,name:"Golden Faberge Egg Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier2",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.09461650809618338,y:-.4080207829771313,z:-.043304410336916344}},{id:1052,name:"Dollar Sign Glasses",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier3",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.12722235142344962,y:-.16985672809344665,z:-.05822427127650384}},{id:1053,name:"Golden Baws Hat",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier4",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.0767370155249445,y:-.3045029212488539,z:-.04283165181820048}},{id:1054,name:"Nate's Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headphones",tags:["Nate","Green","Black"]},is_available:!1,unlock:"manual",align:{x:-.05333618875843271,y:-.23311434767345263,z:-.024409710099744658}},{id:1055,name:"Reindeer Antlers",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_reindeer",tags:["Dec23","Christmas","Green","Red","Brown","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.08044681365354378,y:-.3563788865655062,z:-.036817092584971345}},{id:1056,name:"Elf Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_elf",tags:["Dec23","Christmas","Green","Red","Gold","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.10117501028704234,y:-.3587848770061639,z:.0009369108254608793}},{id:1057,name:"Santa Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santa",tags:["Dec23","Christmas","White","Red","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.08867192605372676,y:-.3103943980263475,z:.00330065841716054}},{id:1058,name:"Party Hat 2019",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party",tags:["NewYears","2019","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1059,name:"Headband 2019",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2019",tags:["NewYears","2019","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09701051785922554,y:-.36462418466845886,z:-.044397597085921225}},{id:1060,name:"Happy New Yolk Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_newYolk",tags:["NewYears","Black","Gold","Yellow","DecM24"]},is_available:!1,unlock:"purchase",align:{x:-.08047965861827411,y:-.44975516111728364,z:-.08518973241487715}},{id:1061,name:"Ski Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg1",tags:["Newsletter","Black"]},is_available:!1,unlock:"manual",align:{x:-.03748757324468832,y:-.16145836066470826,z:-.017156471367526203}},{id:1062,name:"Pirate Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaPirate",tags:["Newsletter","Red"]},is_available:!1,unlock:"manual",align:{x:-.04209499130342831,y:-.11506229870273388,z:.012622500466411724}},{id:1063,name:"Colander Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_colander",tags:["Newsletter","Red"]},is_available:!1,unlock:"manual",align:{x:-.04228013671699182,y:-.2435412902962173,z:-.015922203388946482}},{id:1064,name:"Hamburger Earmuffs",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_earmuffsHamburger",tags:["Newsletter","Brown","Pickles"]},is_available:!1,unlock:"manual",align:{x:-.061589629342688745,y:-.24315872165034946,z:-.028186959601940453}},{id:1065,name:"Fez Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fez",tags:["Newsletter","Red","Gold"]},is_available:!1,unlock:"manual",align:{x:-.08950497321590545,y:-.33408258825568216,z:-.009421125014752674}},{id:1066,name:"Blue Wizard Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_blueWizard",tags:["Newsletter","Blue"]},is_available:!1,unlock:"manual",align:{x:-.08360071955828996,y:-.3600554455273177,z:-.03825404477815042}},{id:1067,name:"Chef Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chef",tags:["Newsletter","White"]},is_available:!1,unlock:"manual",align:{x:-.08918353428454662,y:-.3841111684404195,z:-.04081551884995449}},{id:1068,name:"Jester Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_jester",tags:["Newsletter","Black","Gold"]},is_available:!1,unlock:"manual",align:{x:-.020359835690789474,y:-.33615386721409024,z:-.013314527764688}},{id:1069,name:"Straw Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_straw",tags:["Newsletter","Blue","Gold"]},is_available:!1,unlock:"manual",align:{x:-.052496549211439536,y:-.30300028377516663,z:-.02402367283223006}},{id:1070,name:"Spring Sapling Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spring",tags:["Groundhog","Feb23","Green","Brown","Feb24"]},is_available:!1,unlock:"purchase",align:{x:-.09172522689294382,y:-.40464863138897356,z:-.035806813799312165}},{id:1071,name:"Winter Sapling Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winter",tags:["Groundhog","Feb23","White","Brown","Feb24"]},is_available:!1,unlock:"purchase",align:{x:-.09121137445390537,y:-.39284191237794097,z:-.04174510747384019}},{id:1072,name:"Groundhog Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase",align:{x:-.06865825713552098,y:-.27690700557536063,z:-.03141564496555199}},{id:1073,name:"Skull Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaSkull",tags:["Promotional","Black"]},is_available:!1,unlock:"manual",align:{x:-.015739329783290512,y:-.12197913424975876,z:-.007196258564224477}},{id:1074,name:"Firefighter Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fireFighter",tags:["Promotional","Red"]},is_available:!1,unlock:"manual",align:{x:.00029003301364083356,y:-.2815446091386393,z:.00013425993600540975}},{id:1075,name:"Sunglasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sunglasses",tags:["Promotional","Black"]},is_available:!1,unlock:"manual",align:{x:-.11162996980256423,y:-.1299960469185888,z:-.05108829991299102}},{id:1076,name:"Monocle",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_monocle",tags:["Newsletter","Black"]},is_available:!1,unlock:"manual",align:{x:-.2250944940320183,y:-.07000462146414632,z:.009119977687944966}},{id:1077,name:"Gas Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gasMask",tags:["Promotional","Black","Green"]},is_available:!1,unlock:"manual",align:{x:-.11600129068485865,y:-.16795717258715603,z:-.05462135011036057}},{id:1078,name:"Aviator Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_aviator",tags:["Promotional","Brown"]},is_available:!1,unlock:"manual",align:{x:-.04615350218817005,y:-.19552917505354284,z:-.020616418825203403}},{id:1079,name:"Red Goggles",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gogglesRed",tags:["Promotional","Black"]},is_available:!1,unlock:"manual",align:{x:-.056151049789669116,y:-.16989981310822988,z:-.025692511892349168}},{id:1080,name:"Astronaut Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_astronaut",tags:["Promotional","Grey","Gray"]},is_available:!1,unlock:"manual",align:{x:-.04205338420983762,y:-.1810887170833807,z:-.0192440499996792}},{id:1081,name:"Heart Glasses",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesHeart",tags:["ValentinesDay","Pink","Red","Feb24","Feb25"]},is_available:!1,unlock:"purchase",align:{x:-.11678575639135991,y:-.13217398099861333,z:-.05344788463866976}},{id:1082,name:"Baws Fedora",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fedoraPimp",tags:["ValentinesDay","Pink","Brown","Feb25"]},is_available:!1,unlock:"purchase",align:{x:-.0742835205682435,y:-.3193658969606836,z:-.0340018064079084}},{id:1083,name:"Valentine's Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_valentines",tags:["ValentinesDay","Red","Feb25"]},is_available:!1,unlock:"purchase",align:{x:-.08518905206413807,y:-.3668995553978778,z:-.03898739746891}},{id:1084,name:"Shamrock Glasses",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesShamrock",tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.12025224778385146,y:-.14696498652850365,z:-.05503435063727033}},{id:1085,name:"Pot O' Gold Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_potOfGold",tags:["StPatricksDay","MarM23","Black","Gold","Mar24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.063050017457572,y:-.3813351352595771,z:-.09620290937519904}},{id:1086,name:"Leprechaun Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leprechaun",tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.07051683154538146,y:-.30371404636288934,z:-.032272561188218196}},{id:1087,name:"Bunny Ears",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bunnyEars",tags:["Easter","White","Pink","MarM24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.19599893671002944,y:-.39234999864297326,z:-.09717267795762519}},{id:1088,name:"Egg Nest",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggNest",tags:["Easter","Brown","Grey","Gray","MarM24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.11291007649482054,y:-.3417085298117506,z:-.051628527402411084}},{id:1089,name:"Egg Basket",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggBasket",tags:["Easter","Brown","MarM24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.12958749591523677,y:-.3491056580469325,z:-.033891141085516274}},{id:1090,name:"Egg Crown",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggCrown",tags:["Easter","Blue","Yellow","MarM24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.09516800672925507,y:-.37943767643095594,z:-.04250190002299581}},{id:1091,name:"GoE Ice Crown",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_iceCrown",tags:["GameOfEggs","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.10376858078351825,y:-.23115996005856543,z:-.046543193158390894}},{id:1092,name:"GoE Dragon",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dragon",tags:["GameOfEggs","May23","Green","July24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_dragon"],align:{x:-.11122381511525159,y:-.22438668422477548,z:-.05123433364416541}},{id:1093,name:"Green Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaGreen",tags:["Green"]},is_available:!0,unlock:"purchase",align:{x:.004054956862579839,y:-.14563528059130337,z:.00186138626719895}},{id:1094,name:"Mohawk Hair",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_moHawk",tags:["Purple","Pink"]},is_available:!0,unlock:"purchase",align:{x:.006255775047743578,y:-.2945871342626449,z:.0028594610992341285}},{id:1095,name:"Bihawk Hair",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_biHawk",tags:["Green","Yellow"]},is_available:!0,unlock:"purchase",align:{x:.022753773112818454,y:-.29021241960514166,z:.010408569345783436}},{id:1096,name:"Trihawk Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_triHawk",tags:["Red","Yellow"]},is_available:!0,unlock:"purchase",align:{x:.008256199193995034,y:-.3011313509430575,z:.0037766439203970395}},{id:1097,name:"Pigtails Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pigtails",tags:["Yellow","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.07467920777476911,y:-.28400226572156007,z:-.034177504156685634}},{id:1098,name:"Side Pony",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sidePony",tags:["Black","Pink","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.2048439206899455,y:-.23961453155660994,z:.15926519498135824}},{id:1099,name:"Egg Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggHelmet",tags:["Aveggers","Gold","Bone","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.06476139106979284,y:-.2427274343340584,z:-.029638540345020253}},{id:1100,name:"Fohawk Wig",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_arrow",tags:["Aveggers","Brown","Black","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.0424208650320651,y:-.2345596826772796,z:.013231958207907298}},{id:1101,name:"American Bandana",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaAmerica",tags:["Aveggers","JulyM23","Red","White","Blue","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:.0017704487943540625,y:-.15880670916438272,z:-.0011344025820544876}},{id:1102,name:"Bike Helmet",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bikeHelmet",tags:["Aveggers","Red","Yellow","Blue","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.051070299137746744,y:-.31222624951636146,z:-.02337270855193546}},{id:1103,name:"Bucket Hero Hat",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bucketMan",tags:["Aveggers","Red","Yellow","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.06696777176977298,y:-.26648197543203245,z:-.030655009661612387}},{id:1104,name:"Bug Mask",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bugMask",tags:["Aveggers","Jun23","Red","Brown","Jun24","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.09202838165917981,y:-.24281215767282105,z:-.042112847134861325}},{id:1105,name:"Magic Cape",price:1,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cape",tags:["Aveggers","Jun23","Red","Purple","Pink","Jun24","JulyM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_cape"],align:{x:-.04266781721470947,y:-.21042771527528292,z:-.019527249183542233}},{id:1106,name:"Eyepatch",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eyepatch",tags:["Aveggers","May23","Black","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.043774138824827946,y:-.13452079563909275,z:-.008427424416465414}},{id:1107,name:"Panther Mask",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pantherMask",tags:["Aveggers","Black","Yellow","JulyM24","bun_mayan"]},is_available:!1,unlock:"purchase",align:{x:-.08867675721627499,y:-.21152161186369334,z:-.03961583791196849}},{id:1108,name:"Red Hair Wig",price:12500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_redHair",tags:["Aveggers","Black","Red","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.03884946332902017,y:-.21260971107733917,z:-.029016434478789557}},{id:1109,name:"Helmet of Sight",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sightHelmet",tags:["Aveggers","Purple","Black","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.046740069611680646,y:-.20162379194021973,z:-.017085394972692097}},{id:1110,name:"Space Gladiator Hat",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceGladiator",tags:["Aveggers","JunM23","Red","Brown","MayM24","JulyM24","premFeatOne","MarM25"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_hat_space_gladi"],align:{x:-.017042282162588518,y:-.19924159541308178,z:-.011752371250181241}},{id:1111,name:"Spider Mask",price:12e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spiderMask",tags:["Aveggers","Sep23","Red","Black","White","JulyM24"]},is_available:!1,unlock:"purchase",align:{x:-.06870616529405815,y:-.2201279271430785,z:-.03144389611102072}},{id:1112,name:"Yolk Arms Hat",price:1,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_yolkArms",tags:["Aveggers","Mar23","Yellow","MarM24","JulyM24","Feb25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_yolk_arms"],align:{x:-.09824611395142124,y:-.25366739592574794,z:-.04496307701845989}},{id:1113,name:"Guy Fawkes Mask",price:1105,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fawkes",tags:["Bone"]},is_available:!0,unlock:"purchase",align:{x:-.17510285990363794,y:-.16123009897717056,z:-.0801371481130441}},{id:1114,name:"Birthday Hat 1",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_birthday1",tags:["HappyBirthday","Yellow","Red","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.09004528014090063,y:-.38780118220464077,z:-.041205839243954934}},{id:1115,name:"Birthday Hat 2",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_birthday2",tags:["HappyBirthday","Red","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.0900442074975476,y:-.38780141753043695,z:-.0412062578498793}},{id:1116,name:"Birthday Cake Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cake",tags:["HappyBirthday","Red","Blue","Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.08715138787708865,y:-.375358800154143,z:-.039885508067528885}},{id:1117,name:"League Staff Sash",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leagueStaff",tags:["League","Blue","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.005004015304724163,y:-.09218018923075544,z:.024480075383928684}},{id:1118,name:"Cat Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cat",tags:["Orange","Black","Ears","bun_cat"]},is_available:!0,unlock:"purchase",align:{x:.2530345577929287,y:-.14335075697889277,z:.11579685356438585}},{id:1119,name:"Egg Shell Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggshell",tags:["Bone"]},is_available:!0,unlock:"purchase",align:{x:-.05005480363389614,y:-.2332627400135887,z:-.021899960910532007}},{id:1120,name:"Dino Shell Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinoShell",tags:["Orange","Brown","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.04136180758052088,y:-.2322692477439574,z:-.018399734357048114}},{id:1121,name:"Penguin Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_penguin",tags:["Black","White"]},is_available:!0,unlock:"purchase",align:{x:-.0460468107990728,y:-.1449311872766339,z:-.0210736711744981}},{id:1122,name:"Pot Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pot",tags:["Black","Grey","Gray"]},is_available:!0,unlock:"purchase",align:{x:-.1274127231102291,y:-.27853762228909873,z:.10954927288677535}},{id:1123,name:"Tiny Tophat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tophatTiny",tags:["Black","Red"]},is_available:!0,unlock:"purchase",align:{x:-.09473700016832165,y:-.28327946990930697,z:.10673072112087173}},{id:1124,name:"Nurse Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_nurse",tags:["White","Red"]},is_available:!0,unlock:"purchase",align:{x:-.07263141897925252,y:-.3124360336056615,z:-.03320790353491676}},{id:1125,name:"Oni Hat",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oni",tags:["Sidearms","White","Red","Black","MarM24","premFeatOne","MarM25"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_hat_oni"],align:{x:-.02850137689570731,y:-.19644521944177756,z:-.01721496207172566}},{id:1126,name:"Zombie Mask",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_zombieMask",tags:["July23","Black","OctM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_zombie_mask"],align:{x:-.20507391906817896,y:-.19136930956056042,z:-.0938526467524887}},{id:1127,name:"Cinnamon Bun Hair",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cinnamonBun",tags:["Eggwalker","Brown","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.025574859788104032,y:-.16097458820901694,z:-.011704527956558644}},{id:1128,name:"Bounty Egger",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bountyEgger",tags:["Eggwalker","Green","Black","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.09010359208146834,y:-.3096931721367018,z:-.041236590283360686}},{id:1129,name:"Good Robes Hat",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goodRobes",tags:["Eggwalker","Brown","Red","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.003294669149456579,y:-.20397595543931507,z:-.004414162955776901}},{id:1130,name:"Bad Robes Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badRobes",tags:["Eggwalker","Black","Red"]},is_available:!1,unlock:"purchase",align:{x:-.005494201510522094,y:-.20397595543931507,z:.00039190273387446073}},{id:1131,name:"Space Emo Hair",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceEmo",tags:["Eggwalker","Black","Red"]},is_available:!1,unlock:"purchase",align:{x:-.04992203535431816,y:-.2453196733532348,z:-.03147177018283026}},{id:1132,name:"Space Monk Cloak",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceMonk",tags:["Eggwalker","Blue","Bone","May24"]},is_available:!1,unlock:"purchase",align:{x:-.01596096538967145,y:-.15676441899143595,z:-.028658131445658874}},{id:1133,name:"Eggperor Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggperor",tags:["Eggwalker","Black","Yellow","Meme"]},is_available:!1,unlock:"purchase",align:{x:-.04922442032078411,y:-.23044239490212748,z:-.022527928177171253}},{id:1134,name:"BBEgg Hat",price:65e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bbEgg",tags:["Eggwalker","Orange","White","MarM24"]},is_available:!1,unlock:"purchase",align:{x:-.09303705158508402,y:-.40071116169074616,z:-.042576668436322795}},{id:1135,name:"C3PYolk Mask",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c3pYolk",tags:["Eggwalker","Rainbow","Gold","Mar24"]},is_available:!1,unlock:"purchase",align:{x:-.05234545439905691,y:-.1644001004459974,z:-.023951376783042433}},{id:1136,name:"2020 Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2020",tags:["NewYears","2020","Yellow","White"]},is_available:!1,unlock:"purchase",align:{x:-.09511683446205477,y:-.3564681457999029,z:-.04353093855962348}},{id:1137,name:"Eggy Cash Ensemble",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggyCash",tags:["EggyCash","Brown","Black"]},is_available:!0,unlock:"purchase",align:{x:-.0350094254989175,y:-.20970473415592883,z:.009832643987000289}},{id:1138,name:"Soda Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_drinkdew",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:-.12717812078732038,y:-.29468604465734005,z:-.05820376655005444}},{id:1139,name:"Surgical Mask",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalMask",tags:["Surgical","Green"]},is_available:!0,unlock:"purchase",align:{x:-.05816313573477583,y:-.15443180825077962,z:-.026618798915909347}},{id:1140,name:"Surgical Mask White",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalWhite",tags:["Surgical","White"]},is_available:!0,unlock:"purchase",align:{x:-.05816313573477583,y:-.15443180825077962,z:-.026618798915909347}},{id:1141,name:"Surgical Mask Smile",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalSmile",tags:["Surgical","Black"]},is_available:!0,unlock:"purchase",align:{x:-.05816313573477583,y:-.15443180825077962,z:-.026618798915909347}},{id:1142,name:"Falcon Hunter Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_falconHunter",tags:["RaidLand","Yellow","Nov23"]},is_available:!1,unlock:"purchase",align:{x:-.019465021575194363,y:-.16061997810856643,z:-.018786977876343564}},{id:1143,name:"Shadow Hunter Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shadowHunter",tags:["RaidLand","Mar23","Purple","Aug24","Apr25","premFeatTwo"]},is_available:!0,unlock:"purchase",align:{x:.040752448565812394,y:-.1410023327458786,z:.01865425522337505}},{id:1144,name:"Frost Berserker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frostBerserker",tags:["RaidLand","Blue","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.09647713804661162,y:-.25489461130332036,z:-.04415349181618433}},{id:1145,name:"Grim Berserker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_grimBerserker",tags:["RaidLand","Blue","Gray","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.12139285377596032,y:-.2813697501715835,z:-.05555635755260763}},{id:1146,name:"Golem Warrior Hat",price:1200,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_golemWarrior",tags:["RaidLand","Green","Mar24"]},is_available:!1,unlock:"purchase",align:{x:-.047041600207025525,y:-.25179530384755866,z:-.02146208281435391}},{id:1147,name:"Immortal Warrior Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_immortalWarrior",tags:["RaidLand","Blue","Gray","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.1087318992256816,y:-.3323169847959204,z:-.046798794735782745}},{id:1148,name:"Sheep Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sheep",tags:["Newsletter","White","Brown"]},is_available:!1,unlock:"manual",align:{x:-.06234328566352154,y:-.2657714995353031,z:-.02853187610986624}},{id:1149,name:"Blue Toxic  Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicBlue",tags:["Rotten","Blue","Green"]},is_available:!0,unlock:"purchase",align:{x:-.020208838470678003,y:-.12523480985630764,z:-.009249284905003152}},{id:1150,name:"Green Toxic Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicGreen",tags:["Rotten","Green"]},is_available:!0,unlock:"purchase",align:{x:-.020208838470678003,y:-.12523480985630764,z:-.009249284905003152}},{id:1151,name:"Orange Toxic Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicOrange",tags:["Rotten","Orange","Green"]},is_available:!0,unlock:"purchase",align:{x:-.020208838470678003,y:-.12523480985630764,z:-.009249284905003152}},{id:1152,name:"Double Filter Gas Mask",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_doubleFilter",tags:["Black","Red"]},is_available:!0,unlock:"purchase",align:{x:-.07869036843854582,y:-.1670771929647512,z:-.03601121015262934}},{id:1153,name:"Brown Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar1",tags:["Rockstar","JanM23","Brown","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.02668556941149891,y:-.2766025877174578,z:-.012212852578724787}},{id:1154,name:"Black & Red Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar3",tags:["Rockstar","JanM23","Black","Red","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.017915658211507868,y:-.22147999618357828,z:-.008199236407690325}},{id:1155,name:"Black & White Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar2",tags:["Rockstar","JanM23","Black","White","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.009818349718689667,y:-.2951244655343809,z:-.004493441910886048}},{id:1156,name:"Umbrella Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_umbrella",tags:["Newsletter","Rainbow"]},is_available:!1,unlock:"manual",align:{x:-.09443312459641184,y:-.2901235633645569,z:.07806251993890007}},{id:1157,name:"Star Glasses",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesStar",tags:["Galeggsy","AprM23","Pink","Aug24"]},is_available:!1,unlock:"purchase",align:{x:-.12484232000679674,y:-.15004544071299453,z:-.05713503190453892}},{id:1158,name:"Star Bandana",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaStars",tags:["Galeggsy","AprM23","Purple","Pink","Aug24"]},is_available:!1,unlock:"purchase",align:{x:-.001362708306832383,y:-.10213714959788034,z:-.01903713589631366}},{id:1159,name:"Alien Antennae",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headbandAlien",tags:["Galeggsy","AprM23","Purple","Pink","Aug24"]},is_available:!1,unlock:"purchase",align:{x:-.08112413050090228,y:-.3190124338524207,z:-.03712708816247562}},{id:1160,name:"Galeggsy Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premiumButterfly",tags:["Galeggsy","AprM23","Purple","Pink","Aug24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_galeggsy"],align:{x:.060713865081625795,y:-.19942954633235135,z:.028818182231672013}},{id:1161,name:"Black Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZoneBlack",tags:["MercZone","Black","Suit"]},is_available:!1,unlock:"manual",align:{x:-.02678216325299232,y:-.1177158487880896,z:-.012284197322337875}},{id:1162,name:"Red Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZoneRed",tags:["MercZone","Red","Suit"]},is_available:!1,unlock:"manual",align:{x:-.02678216325299232,y:-.1177158487880896,z:-.012284197322337875}},{id:1163,name:"Pink Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZonePink",tags:["MercZone","Pink","Suit"]},is_available:!1,unlock:"manual",align:{x:-.02678216325299232,y:-.1177158487880896,z:-.012284197322337875}},{id:1164,name:"Academic Cap",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academic",tags:["Newsletter","Black","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.07093971494621032,y:-.3224853891775712,z:-.03574759001854644}},{id:1166,name:"Fuzzy Earmuffs",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_earmuffs",tags:["Newsletter","Pink"]},is_available:!1,unlock:"manual",align:{x:-.05017462989413346,y:-.23629499324838232,z:-.022962798773102838}},{id:1167,name:"Chains Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chains",tags:["Newsletter","Gray"]},is_available:!1,unlock:"manual",align:{x:-.07525641311957942,y:-.1397572844128152,z:-.014165312798006618}},{id:1168,name:"Hen Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hen",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.10092032091586889,y:-.29804565019893214,z:-.04618398189947076}},{id:1169,name:"Rooster Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rooster",tags:["Chicken","Brown","Red","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.09455461013304145,y:-.28662472287303387,z:-.04326614325353481}},{id:1170,name:"Rooster Tail Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roosterTail",tags:["Chicken","Green","MayM24"]},is_available:!1,unlock:"purchase",align:{x:.037684122283645705,y:-.3188342003436098,z:.02145330553469857}},{id:1171,name:"Rooster Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RoosterWings",tags:["MayM23","Chicken","Green","Red","May24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_rooter_wing"],align:{x:-.014848230007995955,y:-.21470955736788944,z:-.006795404693105883}},{id:1172,name:"Bee Wings",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_BeeWings",tags:["Rainbow","Pink","Green","Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.009994370735535885,y:-.19329762292182273,z:-.004573999293501552}},{id:1173,name:"Jason Mask",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_F13",tags:["f13","Bone","Red","Nov24"]},is_available:!1,unlock:"purchase",align:{x:.024964612025391908,y:-.000438791196881283,z:-.04600707116643499}},{id:1174,name:"Demon Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DemonWings",tags:["Premium","Red","OctM23","FebM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_demon_wings"],align:{x:.0685948197299946,y:-.18782834752363142,z:.03139293810363847}},{id:1175,name:"Among Egg Hat 1",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_01",tags:["AmongEgg","Blue","White","Meme"]},is_available:!0,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1176,name:"Among Egg Hat 2",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_02",tags:["AmongEgg","Blue","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1177,name:"Among Egg Hat 3",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_03",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1178,name:"Among Egg Hat 4",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_04",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1179,name:"Among Egg Hat 5",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_05",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1180,name:"Among Egg Hat 6",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_06",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1181,name:"Among Egg Hat 7",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_07",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase",align:{x:.02161537822779458,y:-.049224838353181144,z:.00733596647313256}},{id:1182,name:"Eggolorian Helmet",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggolorianBig",tags:["Eggolorian","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.026411921972668395,y:-.13509385847251787,z:-.024761750354195478}},{id:1183,name:"Toadstool Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toadstool",tags:["Newsletter","Red","White"]},is_available:!1,unlock:"manual",align:{x:-.055709877852442524,y:-.2792171461306885,z:.0021067564280323192}},{id:1184,name:"Fallen Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_FallenWings",tags:["Premium","FebM23","Gray","Brown","bun_dove"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fallen_wing"],align:{x:-.016135329117298647,y:-.21346623949778282,z:-.007384455335413202}},{id:1185,name:"Golden Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_GoldenWings",tags:["Premium","vipItem","Gray","Silver"]},is_available:!1,unlock:"vip",align:{x:.02761299490618674,y:-.14516558338113816,z:.012637296007242005}},{id:1186,name:"Chrome Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ChromeWings",tags:["July23","Gold","Yellow","DecM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_chrome_wing"],align:{x:.01674006510310644,y:-.247877226408992,z:.007661217482458432}},{id:1187,name:"Wero Viking Hair",price:4e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wero",tags:["Wero","Brown"]},is_available:!0,unlock:"purchase",align:{x:.056303593911419814,y:-.14612210750057109,z:.025765045299767086}},{id:1188,name:"Mech Energy Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_MechEnergyWings",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:.015330953250958235,y:-.19451067287062584,z:.007016326768703868}},{id:1189,name:"Egg Sandwich Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sandwich",tags:["Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.07130919700923943,y:-.30712692187370716,z:-.032635193234431537}},{id:1190,name:"Party Hat 2021",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2021",tags:["NewYears","2021","Red","Green"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1191,name:"Headband 2021",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2021",tags:["NewYears","2021","Green"]},is_available:!1,unlock:"purchase",align:{x:-.09511683446205477,y:-.3564681457999029,z:-.04353093855962348}},{id:1192,name:"Hindsight Glasses",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesHindsight",tags:["NewYears","Black","Purple","DecM24"]},is_available:!1,unlock:"purchase",align:{x:.0547271990742301,y:-.20063102866948732,z:.025046316631686674}},{id:1193,name:"Steampunk Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SteampunkWings",tags:["Premium","JulyM23","Gold"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_steamWings"],align:{x:-.03198825591038429,y:-.2260334318073813,z:-.014639667176367683}},{id:1194,name:"Thee_Owl Hat",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_theeowl",tags:["TheeOwl","Red","Orange","Green","Blue","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.018544171968607248,y:-.19240670414833727,z:-.008486880491591603}},{id:1195,name:"Angel Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelAngel",tags:["Jun23","Blue","Yellow","White","Dec24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_wings"],align:{x:.0472404788655226,y:-.2091868482273766,z:.021619962507704864}},{id:1196,name:"C4bra Hair",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c4bra",tags:["C4bra","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.05256816415156407,y:-.21887927713761113,z:-.04389734348691249}},{id:1197,name:"C4bra Ram Hat",price:35e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c4brahorn",tags:["C4bra","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.023596361624323547,y:-.20407749696274824,z:-.010799053294252028}},{id:1198,name:"Hazmatt Mask",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hazmat",tags:["Hazmat","Yellow","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.11308287904866399,y:-.16479260690206332,z:-.05328025989807142}},{id:1199,name:"Slashy Camp Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slashy",tags:["SlashyCamp","White","Bone","Red","Brown","Skullface","Slayaway"]},is_available:!1,unlock:"manual",align:{x:-.08886748152911006,y:-.1743046148683261,z:.010484776937821606}},{id:1200,name:"Discord Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_discord",tags:["Discord","Black","Purple","White"]},is_available:!1,unlock:"manual",align:{x:-.12105425626384658,y:-.2683138912314549,z:-.055403067375097204}},{id:1201,name:"Definitely not Egg",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_funnyGlasses",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.1835774998200077,y:-.16995815775748346,z:-.08400750293600584}},{id:1202,name:"Skull Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SkullWings",tags:["Red","Brown","Black","Bone","Oct23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_skull_wings"],align:{x:-.00010832741414268376,y:-.12452614579911303,z:-.0003290829473785589}},{id:1203,name:"Egg Earpods",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_airpods",tags:["White"]},is_available:!0,unlock:"purchase",align:{x:-.019127507470631577,y:-.16649293479814636,z:-.008753848404344206}},{id:1204,name:"Paper Bag Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bag",tags:["Brown"]},is_available:!0,unlock:"purchase",align:{x:-.0570301614362152,y:-.2653326619474974,z:-.025899324044152905}},{id:1205,name:"Backwards Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hipster",tags:["Egg","Black"]},is_available:!0,unlock:"purchase",align:{x:-.011468426131167497,y:-.2906639602185078,z:-.04635516963121872}},{id:1206,name:"Beret",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beret",tags:["White","Red","Egg"]},is_available:!0,unlock:"purchase",align:{x:-.055021973188496,y:-.27189908716968936,z:-.056135607980478675}},{id:1207,name:"Spike Hat",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spike",tags:["Gold","Black","Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.08330871023780784,y:-.32247434428827937,z:-.03728431149234124}},{id:1208,name:"TikTok Bowler",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tiktok",tags:["Pink","Blue","Black","Gray"]},is_available:!1,unlock:"manual",align:{x:-.05193614209106312,y:-.2747381724486184,z:-.030040690041946927}},{id:1209,name:"Propeller Beanie",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beanie",tags:["Newsletter","Rainbow","Blue"]},is_available:!1,unlock:"manual",align:{x:-.07773122740157001,y:-.33478619745174276,z:-.03557433316800812}},{id:1210,name:"Riddler Bowler",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_riddler",tags:["Purple","Yellow","Green"]},is_available:!1,unlock:"manual",align:{x:-.06902895424785793,y:-.29730062114783573,z:-.031588443706486946}},{id:1211,name:"Miner Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_miner",tags:["Yellow","Black"]},is_available:!1,unlock:"manual",align:{x:-.07637135947582285,y:-.26818667179554234,z:-.03494866906248434}},{id:1212,name:"Dog Ears",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dog",tags:["sale","Mar23","Brown","NovM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_dog_cap"],align:{x:.15090627867947326,y:-.148499481909677,z:.06644016204783357}},{id:1213,name:"Satellite Headgear",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_satellite",tags:["Gray","Grey"]},is_available:!1,unlock:"manual",align:{x:-.1003526479958019,y:-.3126854219834809,z:-.031678792439267967}},{id:1214,name:"Diablo Hat",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_evilpablo",tags:["EGGORG","Black","Red","Apr25"]},is_available:!0,unlock:"purchase",align:{x:-.07552652492916812,y:-.3252818085896001,z:-.03455986096692204}},{id:1215,name:"Robot Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelRobot",tags:["Aug23","Green","Gray","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_robot_wings"],align:{x:.010422668079778596,y:-.15195166020488457,z:.004770012924198996}},{id:1216,name:"Train Conductor",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_conductor",tags:["Trains","Cars","Yellow","Black"]},is_available:!0,unlock:"purchase",align:{x:-.07447285699071271,y:-.27373920004456487,z:-.034084459105144516}},{id:1217,name:"Train Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_train",tags:["Trains","Cars","Red","Gray"]},is_available:!0,unlock:"purchase",align:{x:-.12181852358880674,y:-.25462191713874516,z:-.02548535493101492}},{id:1218,name:"Bindle Hat",price:4500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bindle",tags:["Trains","Cars","Red","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.07625396127772457,y:-.19259195468605367,z:.1997715437643714}},{id:1219,name:"Instagram Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_instagram",tags:["Purple","Orange","Gray"]},is_available:!1,unlock:"manual",align:{x:-.10458216013544197,y:-.3038086237336537,z:-.0051294333925099855}},{id:1220,name:"UFO Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ufo",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:-.06048177152047618,y:-.32833299960741713,z:-.0693053769660591}},{id:1221,name:"RandomLife Headgear",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_randomlife",tags:["Random","Red","Brown","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.049085380484119145,y:-.18555836262817182,z:-.022464295558879216}},{id:1222,name:"Unicorn Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_UnicornWings",tags:["Mar23","Pink","White","OctM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_uni_wing"],align:{x:-.008910853390342588,y:-.2650553005622003,z:-.004078119362420363}},{id:1223,name:"Steam Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_steam",tags:["Pink"]},is_available:!1,unlock:"manual",align:{x:-.0956015549521565,y:-.2864809679826543,z:-.043752774580604115}},{id:1224,name:"Ice Cream Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_icecream",tags:["Newsletter","Blue","Brown"]},is_available:!1,unlock:"manual",align:{x:-.057938759706054554,y:-.2783004123624848,z:.03933975026677053}},{id:1225,name:"Ethan Gamer Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ethangamer",tags:["EthanGamer","Brown","Green","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.03556352559610376,y:-.19568013520375716,z:-.017074842448833144}},{id:1226,name:"Fairy Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelFairy",tags:["Dec23","Pink","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fairy_wings"],align:{x:.025487516259037335,y:-.11036003837934794,z:.01166455461777266}},{id:1227,name:"Facebook Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_facebook",tags:["Blue","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.13911162234386953,y:-.24736789717254104,z:-.0659173981798371}},{id:1228,name:"Sun Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sun",tags:["Summer","JunM23","Yellow","Brown","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.050488251857767175,y:-.25609643737374777,z:-.023112360850326363}},{id:1229,name:"Picnic Basket Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_picnic",tags:["Summer","JunM23","Brown","White","Red","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.06391937586354324,y:-.3049931703225548,z:-.0372255670228166}},{id:1230,name:"Beehive Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beehive",tags:["Summer","JunM23","Yellow","Black","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.09472312087566159,y:-.34840081463281347,z:-.035276375097910984}},{id:1231,name:"Parrot Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_parrot",tags:["Newsletter","Red","Green"]},is_available:!1,unlock:"manual",align:{x:-.10044149920045642,y:-.27678159126613106,z:.12029495213527525}},{id:1232,name:"Toilet Paper Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ToiletPaperWings",tags:["Premium","White","Brown","bun_toilet"]},is_available:!1,unlock:"premium",align:{x:.010997881077290383,y:-.24427555574888432,z:.00503326353283963}},{id:1233,name:"Watermelon Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_watermelon",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:-.03885382911933832,y:-.19948565389743578,z:-.0065169765907116955}},{id:1234,name:"Twitter Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_twitter",tags:["Blue","White"]},is_available:!1,unlock:"manual",align:{x:-.12276427275929835,y:-.2736920598170087,z:-.05496658279849259}},{id:1235,name:"Fire Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelFire",tags:["Premium","Red","Yellow","Mar24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_fire"],align:{x:-.0030721007352483287,y:-.1384340684230544,z:-.001405970091427386}},{id:1236,name:"Backpack Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_backpack",tags:["Pencil","Sep23","Red","Sep24"]},is_available:!1,unlock:"purchase",align:{x:.12218146949814168,y:-.16622138475595996,z:.05686431041429582}},{id:1237,name:"Backpack Rainbow Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_backpackrainbow",tags:["Pencil","Sep23","Rainbow","White","Sep24"]},is_available:!1,unlock:"purchase",align:{x:.122528399626321,y:-.16631880701545823,z:.05702308561137556}},{id:1238,name:"Round Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roundglasses",tags:["Pencil","Sep23","Black","Sep24"]},is_available:!0,unlock:"purchase",align:{x:-.11772619456545064,y:-.1430215058655926,z:-.053878283278210176}},{id:1239,name:"Books Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_books",tags:["Newsletter","Yellow","Brown","Red"]},is_available:!1,unlock:"manual",align:{x:-.09433236283052882,y:-.3004764423791535,z:-.026153673415162615}},{id:1240,name:"Wero Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weroShort",tags:["Wero","Brown","Hair"]},is_available:!0,unlock:"purchase",align:{x:-.053723864256666864,y:-.2665844331860534,z:-.019579849924790615}},{id:1241,name:"Glitch Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_GlitchWings",tags:["Premium","Purple","Pink","Black","NovM23","Apr24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_glitch_wing"],align:{x:.05340656668026472,y:-.22606012536383804,z:.02444191923667508}},{id:1242,name:"Sherlock Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sherlock",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.05668436102263996,y:-.2441306698166108,z:-.025937601815962552}},{id:1243,name:"Grave Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_RIP",tags:["Halloween2","Oct23","Grey","Gray","Egg","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.11837364791910598,y:-.3453135657676538,z:-.02841929196202969}},{id:1244,name:"Ghost Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ghost",tags:["Halloween2","Oct23","White","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.0525359727521153,y:-.13535000874785352,z:-.00785241763098675}},{id:1245,name:"Moth Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelMoth",tags:["Nov23","Brown","Black","Skull","Lambs"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_moth_wings"],align:{x:.06648429136962275,y:-.18018318464573405,z:.030427038834781373}},{id:1246,name:"Android Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_android",tags:["Mobile","Green"]},is_available:!1,unlock:"purchase",align:{x:-.0686633228481126,y:-.2957310387488832,z:-.03142428891712207}},{id:1247,name:"Bravo Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bravo",tags:["Newsletter","Yellow","Hair"]},is_available:!1,unlock:"manual",align:{x:-.06819602391192303,y:-.25251405511395886,z:-.03364586243139556}},{id:1248,name:"Thermal Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ThermalWings",tags:["Red","DecM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["hat_thermal_wings"],align:{x:-.04496152602050674,y:-.22804447072723255,z:-.020576982360488452}},{id:1249,name:"Apple Pie Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_applepie",tags:["Food","Brown","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.07402118177510753,y:-.3129973850256931,z:-.034363178649461035}},{id:1250,name:"Pumpkin Pie Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkinpie",tags:["Food","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.07684515275051185,y:-.3226497851796406,z:-.035164717517768396}},{id:1251,name:"Cheese Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cheese",tags:["Food","Yellow","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.09736025924578184,y:-.30784507348091106,z:-.044840917772301314}},{id:1252,name:"Gravy hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gravy",tags:["Food","Brown","Yellow","NovM23"]},is_available:!1,unlock:"purchase",align:{x:-.10764049404297893,y:-.3242807539480268,z:-.04858410689496345}},{id:1253,name:"Dollar Sign Glasses Black",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_PremiumEggTier3",tags:["Black Fryday","MayM23","Black"]},is_available:!1,unlock:"purchase",align:{x:-.1272223463951172,y:-.16985670643656636,z:-.05822426897524949}},{id:1254,name:"Pink Hair",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkwarrior",tags:["Eggs of Legends","Pink"]},is_available:!0,unlock:"purchase",align:{x:-.051101478189649496,y:-.21837873885616244,z:-.04886738805522073}},{id:1255,name:"Blue Braids",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bluebraids",tags:["Eggs of Legends","Blue","Hair"]},is_available:!0,unlock:"purchase",align:{x:.014294459551864591,y:-.0564965739245884,z:.00654219696920838}},{id:1256,name:"Weather Vane",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weathervane",tags:["KotC","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase",align:{x:-.08938104127416624,y:-.3949801858969135,z:-.047053257971897744}},{id:1257,name:"Red Crown Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winnerRed",tags:["KotC","Gold","Red"]},is_available:!0,unlock:"purchase",align:{x:-.024404769481507493,y:-.4032693734415156,z:-.010993647592823785}},{id:1258,name:"Blue Crown Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winnerBlue",tags:["KotC","Gold","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.024742434488183473,y:-.4031638504834284,z:-.011144839475885127}},{id:1259,name:"Bison Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bison",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.09099733428325463,y:-.28127430856860536,z:-.041638129058378215}},{id:1260,name:"Egg Cluster Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcluster",tags:["KotC","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.07079690890193824,y:-.3420100851495165,z:-.045823917581105156}},{id:1261,name:"Party Hat 2022",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2022",tags:["NewYears","2022","Brown","Red","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1262,name:"Headband 2022",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2022",tags:["NewYears","2022","Red","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.09499434428437392,y:-.3559405841960604,z:-.04347488000356631}},{id:1263,name:"Nervous Elf Belt",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_nervouself",tags:["Christmas2","Elf","Brown","Gold","Green","Red","bun_mistle","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.02412197895070589,y:-.06700092007771397,z:-.011163725420193032}},{id:1264,name:"Bugs Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bluehair",tags:["Meggtrix","JulyM23","Blue","Jun24"]},is_available:!1,unlock:"purchase",align:{x:-.06755290806472969,y:-.2574267838016908,z:-.05731751448656369}},{id:1265,name:"Meggtrix Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_clampglasses",tags:["Meggtrix","Black","DecM24"]},is_available:!1,unlock:"purchase",align:{x:-.19919493077297812,y:-.13104190797669846,z:-.09116306656828238}},{id:1266,name:"Agent Smithe Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_smith",tags:["Meggtrix","Black"]},is_available:!1,unlock:"purchase",align:{x:-.018096408130339636,y:-.07236629676634476,z:-.00827871328761573}},{id:1267,name:"Dreadlocks Hair",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_twins",tags:["Meggtrix","Gray"]},is_available:!1,unlock:"purchase",align:{x:.013752778058945037,y:-.1260515983702566,z:.004499134103787522}},{id:1268,name:"Twitch Bits",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bits",tags:["Purple","Green","Red"]},is_available:!1,unlock:"manual",align:{x:-.07625784724232476,y:-.3212491848476593,z:-.03724174556834575}},{id:1269,name:"Butterfly Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelButterfly",tags:["Purple","Blurple","Jun24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_butt"],align:{x:.06842190316438235,y:-.1664346465616369,z:.03131380152266161}},{id:1270,name:"Mandrake Glasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mandrake",tags:["Drops","Blue","Black","Gray"]},is_available:!1,unlock:"manual",align:{x:-.045350248619579814,y:-.18856227419506955,z:-.02203309706400762}},{id:1271,name:"Lyerpald Wolf Helmut",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lyerpald",tags:["Drops","Gray"]},is_available:!1,unlock:"manual",align:{x:-.09070205347941274,y:-.2946872575472672,z:-.04097567283638698}},{id:1272,name:"Pixel Bird Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelBird",tags:["Premium","AugM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_bird"],align:{x:-.006167608731298957,y:-.23009693766193717,z:-.002822652707942727}},{id:1273,name:"xSerpius Hair",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_xserpiusbeard",tags:["Drops","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.03782371298281717,y:-.08324704596677912,z:-.020377304636828963}},{id:1274,name:"Blue & Yellow Toque ",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toque",tags:["Chilly","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.04545315805478767,y:-.23604199770916368,z:-.020801981476676862}},{id:1275,name:"Purple & Red Toque",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pufftoque",tags:["Chilly","Purple","Red"]},is_available:!1,unlock:"purchase",align:{x:-.0520856055559209,y:-.24271405955948588,z:-.023837371235649107}},{id:1276,name:"Ear Flaps Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_greenearhat",tags:["Chilly","Sep23","Green"]},is_available:!1,unlock:"purchase",align:{x:-.07667842259454893,y:-.21881040618974978,z:-.035092459960448186}},{id:1277,name:"Bow Headband",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkbow",tags:["Kawaii","Blue","Pink","Hair"]},is_available:!0,unlock:"purchase",align:{x:.013242936048015075,y:-.1033230738103943,z:-.008508166486768332}},{id:1278,name:"Cute Ponytail",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkpony",tags:["Kawaii","Pink","Hair"]},is_available:!0,unlock:"purchase",align:{x:.025839573329109022,y:-.12563835757091635,z:.03822514136542354}},{id:1279,name:"High Pigtails",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hightails",tags:["Kawaii","Purple","Hair"]},is_available:!0,unlock:"purchase",align:{x:.0276683407182281,y:-.06620158453736735,z:.012662625411135664}},{id:1280,name:"Orange Hair Buns",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spacebuns",tags:["Kawaii","Orange"]},is_available:!0,unlock:"purchase",align:{x:-.023154355564313445,y:-.1721316874022778,z:-.010596765888274434}},{id:1281,name:"Cat Braids",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_catbraids",tags:["Kawaii","Brown","Hair"]},is_available:!0,unlock:"purchase",align:{x:.04942305559527016,y:-.08275381442845631,z:.022625504948921016}},{id:1282,name:"Sashimi Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sushi",tags:["Kawaii","Pink","White"]},is_available:!0,unlock:"purchase",align:{x:-.06607460559824174,y:-.3145620311388375,z:-.023349608686141055}},{id:1283,name:"Big Cat Ears",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bigears",tags:["Kawaii","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.08912079570999865,y:-.2812066668309523,z:-.04078680610014129}},{id:1284,name:"Spiky Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spikyband",tags:["Kawaii","White","Black"]},is_available:!0,unlock:"purchase",align:{x:-.023430270261315833,y:-.29978976104196253,z:.01652652925006237}},{id:1285,name:"Gamer Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerhair",tags:["Yellow"]},is_available:!0,unlock:"purchase",align:{x:-.013377586824752985,y:-.1219796445900333,z:-.015800351731837636}},{id:1286,name:"Purple Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purplehair",tags:["Purple"]},is_available:!0,unlock:"purchase",align:{x:.023129168688115875,y:-.11083660530794659,z:.006054604634013971}},{id:1287,name:"Mmm Donut Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_donut",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.08550644276840513,y:-.27604362378568936,z:-.026332007285230108}},{id:1288,name:"Lucky Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_LuckyWings",tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_luckywings"],align:{x:-.033786312351363645,y:-.1967396243343998,z:-.015462594090161368}},{id:1289,name:"Turtle Power Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turtle",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.019347811387824265,y:-.2317573148140306,z:-.008854672137101616}},{id:1290,name:"Ukraine Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaUkraine",tags:["UA","Blue","Yellow"]},is_available:!1,unlock:"premium",align:{x:-.037327876564546614,y:-.09202308400058623,z:-.03566510179609639}},{id:1291,name:"Sweatband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sweatband",tags:["BBros","Egg","Purple","Gold","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.03139999298521712,y:-.20010309398013404,z:-.014370444207938982}},{id:1292,name:"Spartan Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spartan",tags:["BBros","Green"]},is_available:!1,unlock:"purchase",align:{x:-.11924556069189718,y:-.28847717682052254,z:-.05456955212903192}},{id:1293,name:"Gators Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gators",tags:["BBros","Blue","Orange","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.11924556069189718,y:-.28847717682052254,z:-.05456955212903192}},{id:1294,name:"Rams Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rams",tags:["BBros","Aug23","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.11924556069189718,y:-.28847717682052254,z:-.05456955212903192}},{id:1295,name:"Knight Hat",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knight",tags:["EGGORG","Blue","Red"]},is_available:!1,unlock:"purchase",align:{x:-.0714147299793606,y:-.23565709532673618,z:-.0326814591627768}},{id:1296,name:"Viking Helmet",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_viking",tags:["EGGORG","Yellow","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.0695631630520892,y:-.18345971679684459,z:-.03183610762846864}},{id:1297,name:"Egg Cape",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcape",tags:["EGGORG","Yellow","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.005960168837245927,y:-.06521101336169344,z:-.0027277491000435583}},{id:1298,name:"Joker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_joker",tags:["EGGORG","Blue","Red","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.004737473505517453,y:-.30091891990419384,z:-.006680355253004977}},{id:1299,name:"Shield Hat",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shield",tags:["EGGORG","Apr23","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.001314076285751753,y:-.145188741690077,z:-.007500360642775039}},{id:1300,name:"Valkyrie Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_valkyrie",tags:["Newsletter","Blue","Gray"]},is_available:!1,unlock:"manual",align:{x:-.057175017244421866,y:-.20885034996221186,z:-.026166578997877943}},{id:1301,name:"Tattered Cape",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcapeRust",tags:["Relic","Drops2","Brown","Gold"]},is_available:!1,unlock:"manual",align:{x:-.0032140950995573903,y:-.05338375428872988,z:-.0014709876888352458}},{id:1302,name:"Gold Joker Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_jokerGold",tags:["Relic","Drops2","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.004737473505517453,y:-.30091891990419384,z:-.006680355253004977}},{id:1303,name:"Rusty Viking Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_vikingRust",tags:["Relic","Drops2","Brown","Gold"]},is_available:!1,unlock:"manual",align:{x:-.0695631630520892,y:-.18345971679684459,z:-.03183610762846864}},{id:1304,name:"Rusty Knight Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knightRust",tags:["Relic","Drops2","Brown","Red"]},is_available:!1,unlock:"manual",align:{x:-.07254534842625415,y:-.2387070727526709,z:-.03319142252026157}},{id:1305,name:"JWBerry3D Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerglasses",tags:["Relic","Red","Black"]},is_available:!0,unlock:"purchase",align:{x:-.11078425287591509,y:-.1237525930467187,z:-.05070125116724264}},{id:1306,name:"Ocean Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oceanglasses",tags:["Relic","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.12495636346710981,y:-.13507479491885022,z:-.05737283020232181}},{id:1307,name:"Tooth Survivor Bandana",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toothbandana",tags:["Dino","May23","Gray","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.04755004110646732,y:-.12795363370519897,z:-.006119485827542431}},{id:1308,name:"Steggasauras Scales",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_stego",tags:["Dino","May23","Orange","Green","Dec23","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.10516669405657098,y:-.14039272566488192,z:.048125859170304874}},{id:1309,name:"Red Dino Tail",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailred",tags:["Dino","May23","Yellow","Red","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.10781959893149307,y:-.13401897970572288,z:.14210710777705432}},{id:1310,name:"Green Dino Tail",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailgreen",tags:["Dino","May23","Green","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.10781959893149307,y:-.13401897970572288,z:.14210710777705432}},{id:1311,name:"Dino Mouth Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinomouth",tags:["Dino","May23","Red","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.031831313732059385,y:-.3524354179999527,z:-.013994178632266319}},{id:1312,name:"Alpha Pterodactyl Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DinoWings",tags:["Dino","May23","Green","AugM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_dinowings"],align:{x:-.07859264188282022,y:-.20860363417986472,z:-.035968582448789366}},{id:1313,name:"Dino Triceratops Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dino",tags:["Dino","Newsletter","Orange"]},is_available:!1,unlock:"manual",align:{x:-.09452825597300052,y:-.3315847405619863,z:-.04468450251659173}},{id:1314,name:"Tablet Backpack",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tabletpack",tags:["Mobile","SepM23","Red","Egg"]},is_available:!1,unlock:"purchase",align:{x:.11079876174309317,y:-.19012561884289186,z:.05168685108465057}},{id:1315,name:"Telephone Hat ",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_telephone",tags:["Mobile","AugM23","Red"]},is_available:!1,unlock:"purchase",align:{x:.05860631546825945,y:-.13663260348863965,z:.12487819389459201}},{id:1316,name:"Airplane Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Airplane",tags:["Sep23","Premium","White","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_airplane"],align:{x:.23034786490917902,y:-.1547492657728725,z:.10487083678434686}},{id:1317,name:"Head Tail",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headtails",tags:["Eggwalker2","White","Green","Black"]},is_available:!1,unlock:"purchase",align:{x:-.0196740573061005,y:-.19606196947358268,z:-.009000703549737338}},{id:1318,name:"Eggpire Cap",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_imperial",tags:["Eggwalker2","Green"]},is_available:!1,unlock:"purchase",align:{x:-.06259811515829705,y:-.2829860136744101,z:-.02864312563205662}},{id:1319,name:"Sci-fi Visor",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_obiwan",tags:["Eggwalker2","Black"]},is_available:!1,unlock:"purchase",align:{x:-.24271137738414206,y:-.13328460556968547,z:-.1197112186589378}},{id:1320,name:"Cross Fighter Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_CrossWing",tags:["Eggwalker2","Premium","White","Grey","Gray","Red","Yellow"]},is_available:!1,unlock:"premium",align:{x:.15930024282913313,y:-.18075422946571956,z:.07290496100199528}},{id:1321,name:"Pineapple Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pineapple",tags:["Summer","JunM23","Green","White","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.09812463178535724,y:-.4156135499303326,z:-.04060392769329296}},{id:1322,name:"Kite Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kite",tags:["Summer","JunM23","Rainbow","Yellow","JunM24"]},is_available:!1,unlock:"purchase",align:{x:.017159674628105748,y:-.31965418856758354,z:.007851239309207725}},{id:1323,name:"UK Bucket Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_buckethat",tags:["Summer","Newsletter","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.05810470285745151,y:-.2502452533755086,z:-.02659205663663128}},{id:1324,name:"Baseball Helmet",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_baseball",tags:["Sports","JulyM23","Black","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.05151488588494635,y:-.19998687433606954,z:-.0245622817722769}},{id:1325,name:"Football Helmet",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_football",tags:["Sports","JulyM23","Blue","Yellow","Fbros","JunM24","SepM24"]},is_available:!1,unlock:"purchase",align:{x:-.04832931417978026,y:-.1352946574924434,z:-.024871745773064752}},{id:1326,name:"Swim Cap",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_swimcap",tags:["Sports","JulyM23","Oct23","Blue","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.056393739829843526,y:-.2477807183539309,z:-.02621372851028153}},{id:1327,name:"Frisbee Damage Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frisbee",tags:["Sports","JulyM23","Red","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.1388062207676577,y:-.2588205395914731,z:.05984669179307067}},{id:1328,name:"SPORTS headband",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headband",tags:["Sports","JulyM23","Green","Egg","JunM24"]},is_available:!1,unlock:"purchase",align:{x:-.028531595495777218,y:-.19854721990374058,z:-.013057700403261097}},{id:1329,name:"Cone Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cone",tags:["Newsletter","Sports","JulyM23","Orange"]},is_available:!1,unlock:"manual",align:{x:-.08905438095940177,y:-.42381444261433376,z:-.01246906664059666}},{id:1330,name:"Egg Yolk Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggyolk",tags:["Breakfast","Egg","White","Yellow","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.05723363847063201,y:-.2392488492437903,z:-.029219959301922005}},{id:1331,name:"Waffles Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_waffles",tags:["Breakfast","Brown","Yellow","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.042130070070243164,y:-.31705850027197235,z:-.03466427348870399}},{id:1332,name:"Pancakes Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pancakes",tags:["Breakfast","Brown","Yellow","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.06990694206534798,y:-.29184377670850803,z:-.026418624087968023}},{id:1333,name:"Teacup Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_teacup",tags:["Breakfast","White","Red","MayM24"]},is_available:!1,unlock:"purchase",align:{x:-.020174507966058464,y:-.3111035460059972,z:-.05108915694622945}},{id:1334,name:"Captain Breakfast Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_captaincrunch",tags:["Breakfast","Newsletter","Blue"]},is_available:!1,unlock:"manual",align:{x:-.0795272416879782,y:-.34252532281063364,z:-.03639624352455051}},{id:1335,name:"Keyhole Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_keyhole",tags:["Scavenger","Black"]},is_available:!1,unlock:"purchase",align:{x:-.06380360008562347,y:-.2806049993457588,z:-.029200200044923463}},{id:1336,name:"Distinguished Gentlemen Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pipe",tags:["Dec23","Scavenger","Brown","Hair"]},is_available:!1,unlock:"purchase",align:{x:-.07267364803907439,y:-.07707951378019828,z:-.030264409392351255}},{id:1337,name:"Wizskull Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wizskull",tags:["Scavenger","Blue","White","Bone","BWD"]},is_available:!1,unlock:"purchase",align:{x:-.07311251264431373,y:-.3864593884402616,z:-.026130767254658238}},{id:1338,name:"Tucked Pencil Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pencilhair",tags:["Pencil2","Sep23","Yellow","Hair"]},is_available:!1,unlock:"purchase",align:{x:.0013188852656638161,y:-.17071437423368385,z:-.00400523791892099}},{id:1339,name:"Slide Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slide",tags:["Pencil2","Sep23","Blue","Red"]},is_available:!1,unlock:"purchase",align:{x:-.061648028991867276,y:-.29935279262378456,z:-.05595923369651101}},{id:1340,name:"Scavenger Hunt Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scavenger",tags:["Pencil2","Sep23","Red","Black","bun_tactic"]},is_available:!1,unlock:"manual",align:{x:.021280807735962526,y:-.08324928006068566,z:-.03461372436507171}},{id:1341,name:"Rainbow Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RainbowWings",tags:["Pencil2","Feb24","Sep24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_rainbow"],align:{x:-.028255568232114003,y:-.20604891688816965,z:-.012931374435978412}},{id:1342,name:"Paper Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paper",tags:["Newsletter","Pencil2","Blue","White"]},is_available:!1,unlock:"manual",align:{x:-.07504639711106442,y:-.32322996356140976,z:-.03434997576052584}},{id:1343,name:"Albino Book Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snake",tags:["Sep22","Drops3","ABHS"]},is_available:!1,unlock:"manual",align:{x:-.10654993328936069,y:-.3049933511591818,z:.010810588651829045}},{id:1344,name:"Heart Backpack",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_heartpack",tags:["Sep22","Drops3","Red","Pink"]},is_available:!1,unlock:"manual",align:{x:.1192583355157325,y:-.1421948706555937,z:.05552651603134384}},{id:1345,name:"Deal with it Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_deal",tags:["Sep22","Drops3","Black","Meme"]},is_available:!1,unlock:"manual",align:{x:-.11043058566823083,y:-.16601334249151134,z:-.050539409068671715}},{id:1346,name:"Kilzomatic Hat",price:6e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kilzomatic",tags:["Sep22","Yellow","Blue"]},is_available:!0,unlock:"purchase",align:{x:-.12905256312871272,y:-.24911179539016315,z:-.0594282252578634}},{id:1347,name:"Sharkbucks Hat",price:6900,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sharkbucks",tags:["Sep22","Pink","Blue"]},is_available:!0,unlock:"purchase",align:{x:.21499460632334902,y:-.03987941087591835,z:.0983899090714259}},{id:1348,name:"The cap cap",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cap",tags:["Newsletter","Blue"]},is_available:!1,unlock:"manual",align:{x:-.033141315905745206,y:-.25396539010293706,z:-.03265648318202702}},{id:1349,name:"Teggtris Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Tetris",tags:["Sep22","Premium","Rainbow","AprM24","bun_gamer"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_teggtris"],align:{x:.053994584418046276,y:-.24203561520647465,z:.02471099723170675}},{id:1350,name:"Scary Balloon Hat",price:1990,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_balloon",tags:["Halloween3","OctM23","Blue","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.09396296415455252,y:-.40272741126518463,z:-.0441197548395883}},{id:1351,name:"Witch Cobwebs Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cobweb",tags:["Halloween3","Newsletter","OctM23","Purple","Black","OctM24"]},is_available:!1,unlock:"manual",align:{x:-.05431075864222201,y:-.3132789494852095,z:-.028827580904545458}},{id:1352,name:"Cauldron Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cauldron",tags:["Halloween3","OctM23","Black","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.06636454224849953,y:-.3565532588626168,z:-.07375228691929708}},{id:1353,name:"Mummy Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mummy",tags:["Halloween3","OctM23","White","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.030624381654509758,y:-.13131398433488894,z:-.013650365127290592}},{id:1354,name:"Black Cat Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kitten",tags:["Halloween3","OctM23","Black","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.08157292019093898,y:-.3068674371149698,z:-.03979017085383357}},{id:1355,name:"Dracula Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dracula",tags:["Halloween3","OctM23","White","Grey","Gray","Black","OctM24"]},is_available:!1,unlock:"purchase",align:{x:.0319311755874756,y:-.22035354384456102,z:.014534916593597402}},{id:1356,name:"Blood Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_BloodWings",tags:["Jun23","Red","Oct24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_bloodwing"],align:{x:-.0031766899539928672,y:-.257898661391988,z:-.001453836099716374}},{id:1357,name:"It's Corn Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_corn",tags:["NovM23","Thanksgiving2","Meme","Yellow","Food","Nov23"]},is_available:!1,unlock:"purchase",align:{x:-.08300421788058454,y:-.3452676390577907,z:-.04519249290448918}},{id:1358,name:"NPS Clan Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_NPS",tags:["League"]},is_available:!1,unlock:"manual",align:{x:-.0698797704830616,y:-.30096415980790403,z:-.03198100537574555}},{id:1359,name:"Drone Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_drone",tags:["Badegg","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.070109722971063,y:-.312839052884192,z:-.02738976843544816}},{id:1360,name:"Tactical Vest",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tacticalvest",tags:["Badegg","Black"]},is_available:!1,unlock:"purchase",align:{x:-.005726648924688327,y:-.0279753566254346,z:-.0026208441828656226}},{id:1361,name:"Medbox Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_medbox",tags:["Badegg","Black"]},is_available:!1,unlock:"purchase",align:{x:-.08406234297441406,y:-.36207676320852444,z:-.0384744708681079}},{id:1362,name:"Crash Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crash",tags:["Badegg","Red"]},is_available:!1,unlock:"purchase",align:{x:-.015373292358376367,y:-.10284669633262417,z:-.025062619631484602}},{id:1363,name:"Fall Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Fall",tags:["Badegg","SepM23","Orange","Brown","NovM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fall"],align:{x:-.018163515810662334,y:-.19512975431341528,z:-.008312670321063961}},{id:1364,name:"Ribbon Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ribbon",tags:["Red"]},is_available:!1,unlock:"purchase",align:{x:-.0526775922207674,y:-.10401408076862528,z:-.024770748952875912}},{id:1365,name:"Santa Hat & Beard",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santabeard",tags:["Christmas2","Newsletter","Red","White"]},is_available:!1,unlock:"manual",align:{x:-.06458211428133787,y:-.09819808490009518,z:.018212343046531076}},{id:1366,name:"Sailor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sailor",tags:["Mar24","Newsletter","White","Seaman"]},is_available:!1,unlock:"manual",align:{x:-.06435460038219576,y:-.2767952786517658,z:-.04267529046957927}},{id:1367,name:"Party Hat 2023",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1368,name:"2023 Headband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09492951642647074,y:-.3559587886582341,z:-.04344521104408777}},{id:1369,name:"Holly Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Holly",tags:["Dec23","Red","Green"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_holy_wings"],align:{x:-.005623716634233666,y:-.18569631620346605,z:-.002573736390560827}},{id:1370,name:"Piano Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_piano",tags:["Rockstar","JanM23","Black","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.08104278879501514,y:-.366555756379946,z:-.03708692812794501}},{id:1371,name:"Gramophone Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gramaphone",tags:["Rockstar","JanM23","Gold","Yellow","Brown","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.16684042187958514,y:-.448131830052956,z:-.06255529683169103}},{id:1372,name:"Sound Wave Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Music",tags:["Rockstar","Premium","JanM23","Blue","Purple","Blurple","Music","SepM24","Mar25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_soundwave"],align:{x:.1473629434689976,y:-.10723354724906936,z:.06744176564235072}},{id:1373,name:"Fancy Band Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fancyband",tags:["Rockstar","JanM23","Blue","Green","Gold","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.00973114550144527,y:-.21567867185108125,z:-.05196604239560981}},{id:1374,name:"Winter Scarf",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarf",tags:["Groundhog","Feb23","Red","Feb24","Feb25"]},is_available:!1,unlock:"purchase",align:{x:-.00784791552887576,y:-.02390157873911347,z:.0015132619478031017}},{id:1375,name:"Bull Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bull",tags:["farm","FebM23","Bone","Brown","Gray","Grey","May24"]},is_available:!1,unlock:"purchase",align:{x:-.11597261106923407,y:-.21024345924677446,z:-.05307577528187574}},{id:1376,name:"Farmer Shirt",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_farmer",tags:["farm","FebM23","Red","May24"]},is_available:!1,unlock:"purchase",align:{x:-.002040217164151592,y:.004750899815876952,z:-.0012440683218514215}},{id:1377,name:"Cowbell Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowbell",tags:["farm","FebM23","Silver","May24"]},is_available:!1,unlock:"purchase",align:{x:-.1137706593369594,y:-.34387384785790454,z:-.06759212950473148}},{id:1378,name:"Barrel Eye",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_barrel",tags:["Drops4","Mar23","AugM23","Brown","Silver","Gray","Grey","AprM24","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.04510483699042789,y:-.16127109706054976,z:-.021459554866939207}},{id:1379,name:"Kiwi Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kiwi",tags:["Drops4","Mar23","AugM23","Yellow","Brown","AprM24","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.11486035543267459,y:-.10621039239967178,z:-.05256110579263329}},{id:1380,name:"Eggscellent Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggscellent",tags:["Drops4","Mar23","AugM23","Blue","White","AprM24","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.10978212137635612,y:-.2845944901731632,z:-.05023481757921583}},{id:1381,name:"KJs Dad",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oldman",tags:["Drops4","Mar23","Old","Grey","Gray","Meme","Hair"]},is_available:!1,unlock:"purchase",align:{x:-.08705671410668012,y:-.14984666212434217,z:-.03983416645942446}},{id:1382,name:"Novosuper Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_novo",tags:["Drops4","Mar23","Black","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.06499036673467007,y:-.2604408479505427,z:-.02975142823595156}},{id:1383,name:"Bracket Shell Sombrero",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_banana",tags:["Drops4","Mar23","Yellow","Blue","Bananas"]},is_available:!1,unlock:"manual",align:{x:-.014458675665466547,y:-.2596999000231326,z:-.007485859219670016}},{id:1384,name:"The Mask of Paradise",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paradise",tags:["Drops4","Mar23","Black"]},is_available:!1,unlock:"manual",align:{x:-.06563638857843951,y:-.23343711723846364,z:-.030038989575604757}},{id:1385,name:"xQc Hair",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_xhair",tags:["Drops4","Mar23","White","Black","Meme"]},is_available:!1,unlock:"manual",align:{x:-.04473346186974193,y:-.17901427823277163,z:-.011890543194713117}},{id:1386,name:"Marshmallow Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_marshmallow",tags:["Drops4","Mar23","White","Red"]},is_available:!1,unlock:"manual",align:{x:-.02750959876124981,y:-.22266327721726858,z:-.018605044079386478}},{id:1387,name:"Big Brain Hat",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_brain",tags:["Drops4","Mar23","AugM23","OctM23","Pink","AprM24","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.07430287969300897,y:-.2543552689406354,z:.008162311590720062}},{id:1388,name:"Fusion Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fusion",tags:["Newsletter","Mar23","White","Blue"]},is_available:!1,unlock:"manual",align:{x:-.1272141776982595,y:-.1666806724852818,z:-.058220546897934496}},{id:1389,name:"Harp Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Harp",tags:["Premium","Mar23","Gold","bun_cupid"]},is_available:!1,unlock:"premium",align:{x:.1072334707841979,y:-.146697731985604,z:.05092813371967474}},{id:1390,name:"Longhorn Bros",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_longhorns",tags:["BBros","MarM23","Bone","Yellow","White"]},is_available:!1,unlock:"purchase",align:{x:-.06454526283356454,y:-.2600443036405822,z:-.029539627617489794}},{id:1391,name:"Purdue Bros",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purdue",tags:["BBros","MarM23","Yellow","White","Black"]},is_available:!1,unlock:"purchase",align:{x:-.08672038099648693,y:-.25892611471854643,z:-.039685665312970575}},{id:1392,name:"Scoreboard Bros",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scoreboard",tags:["BBros","MarM23","Blue","Red","SepM24"]},is_available:!1,unlock:"purchase",align:{x:-.11214738641040467,y:-.3311205910061972,z:-.08632608055886049}},{id:1393,name:"Drenched Bros",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerjuice",tags:["BBros","MarM23","Blue","Grey","Gray","Orange","Electrolytes"]},is_available:!1,unlock:"purchase",align:{x:-.09519071283078828,y:-.3547416629903286,z:-.00511330334446225}},{id:1394,name:"Hooped Hat",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Hoop",tags:["BBros","MarM23","White","Red","AprM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_hooped"],align:{x:-.01236207382970056,y:-.18682160652455493,z:-.005657596523953062}},{id:1395,name:"Brown Wizard Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_brownwizard",tags:["Heroes","Apr23","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.0804820787820959,y:-.34663407402899415,z:-.03683323194092522}},{id:1396,name:"Elf Ears Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_elfear",tags:["Heroes","Apr23","Grey","Gray","Hair"]},is_available:!1,unlock:"purchase",align:{x:.008861862981141222,y:-.14702279082100755,z:.005539460612354219}},{id:1397,name:"Dwarf Beard",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dwarf",tags:["Heroes","Apr23","Orange"]},is_available:!1,unlock:"purchase",align:{x:-.16295681170247578,y:.09907638184290868,z:-.07457841737562876}},{id:1398,name:"Gelatinous Cube Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cube",tags:["Monsters","Apr23","Green"]},is_available:!1,unlock:"purchase",align:{x:-.11104016614231416,y:-.3456780036754328,z:-.03357725521046473}},{id:1399,name:"Purple Worm Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wurm",tags:["Monsters","Apr23","Purple","Pink"]},is_available:!1,unlock:"purchase",align:{x:-.011546657671685487,y:-.19726818778411098,z:-.03183251542878959}},{id:1400,name:"Question Block Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_MysteryWings",tags:["AprM23","Aug23","JanM24","White","Yellow","?"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_qwings"],align:{x:.11004874508599694,y:-.20316619077538176,z:.050364640570313604}},{id:1401,name:"Green Dino Head",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_greendino",tags:["Dino2","May23","Green","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.10805242748329436,y:-.27514999829643605,z:-.04945692647317679}},{id:1402,name:"Blue Dino Tail",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailblue",tags:["Dino2","May23","Blue","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.09757484018737961,y:-.13401897970572288,z:.16449231309178208}},{id:1403,name:"Caveman Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_caveman",tags:["Dino2","May23","Brown","AugM24"]},is_available:!1,unlock:"purchase",align:{x:-.010869634182571808,y:-.07848510092529004,z:-.010236613975144027}},{id:1404,name:"Leopard Sash",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skinsash",tags:["Dino2","May23","Orange","Black","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.018109172961424003,y:.014556123753856731,z:-.03063797581379002}},{id:1405,name:"Tiger Sash",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tigersash",tags:["Dino2","May23","Newsletter","Orange","Black","AugM24"]},is_available:!1,unlock:"manual",align:{x:.01876618405057595,y:.013850888481395263,z:-.03046859499892196}},{id:1406,name:"Egg Chest Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goldchest",tags:["Eggflation","MayM23","Gold","Brown"]},is_available:!0,unlock:"purchase",align:{x:-.05230654862607875,y:-.380141103214434,z:-.0239331287279429}},{id:1407,name:"Golden Nugget Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goldnugget",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase",align:{x:-.04822470318959571,y:-.213927101437404,z:-.02207040007641481}},{id:1408,name:"Photobooth Top Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothtophat",tags:["Photo","Jun23","Black","premFeatOne","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.21431328988746134,y:-.16351137409181637,z:-.09961284301516274}},{id:1409,name:"Photobooth Bow",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothbow",tags:["Photo","Jun23","Black","Red"]},is_available:!1,unlock:"purchase",align:{x:-.2098841731917156,y:-.15178669997345284,z:-.12104457557040586}},{id:1410,name:"Photobooth Crown",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothcrown",tags:["Photo","Jun23","Gold"]},is_available:!1,unlock:"purchase",align:{x:-.19827018482043246,y:-.21454857065154342,z:-.08740226191376034}},{id:1411,name:"Photobooth Cake",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothcake",tags:["Newsletter","Photo","Jun23","White"]},is_available:!1,unlock:"manual",align:{x:-.17442659431714547,y:-.2307127983402863,z:-.0585189294705932}},{id:1412,name:"Red Snorkel",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snorkelred",tags:["Summer2","JunM23","Red","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.08452722773723353,y:-.08806286153092957,z:-.024090441006014318}},{id:1413,name:"Blue Snorkel",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snorkelblue",tags:["Summer2","JunM23","Red","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.08452722773723353,y:-.08806286153092957,z:-.024090441006014318}},{id:1414,name:"Beach Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beach",tags:["Summer2","JunM23","Yellow","Green","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.07565028269552926,y:-.25895549324911094,z:.006404318418288427}},{id:1415,name:"Sandcastle Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sandcastle",tags:["Summer2","JunM23","Gold","Yellow","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.12876061452866017,y:-.4097997603581035,z:-.030514806124142535}},{id:1416,name:"Crab Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crab",tags:["Summer2","JunM23","Red","Meme"]},is_available:!1,unlock:"purchase",align:{x:-.10068510003333841,y:-.24499355337767836,z:-.02337243991233373}},{id:1417,name:"Octopus Surfboard",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Octopus",tags:["Summer2","JunM23","Brown","JunM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_surf"],align:{x:.22393085055634598,y:-.11030590875211177,z:.11750241492051972}},{id:1418,name:"Equinox Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinox",tags:["Equinox","July23","Gold","Yellow","Blue","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.037617305074609586,y:-.2172802487320009,z:-.019265288039641393}},{id:1419,name:"Equinox Sun Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinoxSun",tags:["Equinox","July23","Gold","Yellow","Blue","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.06938082193720652,y:-.2592012664240997,z:-.03174618472965968}},{id:1420,name:"Equinox Moon Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinoxMoon",tags:["Equinox","July23","Blue","White","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.07093676588009012,y:-.23125672830481214,z:-.032460175208326225}},{id:1421,name:"Bonsai Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bonsai",tags:["Equinox","July23","Blue","Yellow","Green","Brown","JanM25"]},is_available:!1,unlock:"purchase",align:{x:-.09619353264858921,y:-.4061319323215409,z:-.03900086303481454}},{id:1422,name:"Skull Trio Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skulls",tags:["Newsletter","July23","Bone","Brown"]},is_available:!1,unlock:"manual",align:{x:-.07507010492730903,y:-.3635214269340585,z:-.03551129767586808}},{id:1423,name:"Scales of Justice Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Scales",tags:["July23","Gold","JanM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_scales"],align:{x:.19150246040586572,y:-.19256754847920388,z:.08764254943023048}},{id:1424,name:"Biker Helmet",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremehelm",tags:["Sports2","JulyM23","Black","Red","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.050801832540607994,y:-.20212157456782848,z:-.023253939707554898}},{id:1425,name:"Climbing Gear Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremeclimb",tags:["Sports2","JulyM23","Blue"]},is_available:!1,unlock:"purchase",align:{x:.021732529407735512,y:-.029624623104741232,z:-.005432548962853279}},{id:1426,name:"Ski Bum Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremeskis",tags:["Sports2","JulyM23","Rainbow"]},is_available:!1,unlock:"purchase",align:{x:.058974643037587815,y:-.25217970728432826,z:.03644558094795056}},{id:1427,name:"Stickers Helmet",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_stickers",tags:["Sports2","JulyM23","Black","Egg"]},is_available:!1,unlock:"purchase",align:{x:-.029612593507459373,y:-.1538837240702784,z:-.020693402475527256}},{id:1428,name:"Hang Glider Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Glider",tags:["Sports2","JulyM23","Rainbow"]},is_available:!1,unlock:"premium",align:{x:.15806814144004577,y:-.19535527419964233,z:.07234108048743282}},{id:1429,name:"Red Kart",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartRed",tags:["Kart","Aug23","Red","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.021915916439513516,y:.13129564198078736,z:.010018611906794539}},{id:1430,name:"Green Kart",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartGreen",tags:["Kart","Aug23","Green","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.0208010053824621,y:.12650892279592885,z:.009517672561720425}},{id:1431,name:"Pink Kart",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartPink",tags:["Kart","Aug23","Pink","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.021915916439513516,y:.13129564198078736,z:.010018611906794539}},{id:1432,name:"Yellow Kart",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartYellow",tags:["Kart","Aug23","Yellow","AugM24"]},is_available:!1,unlock:"purchase",align:{x:.02370142462174929,y:.1390009434188464,z:.01084507135885926}},{id:1433,name:"Piranha Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_piranha",tags:["Kart","Aug23","Red","White","Green"]},is_available:!1,unlock:"purchase",align:{x:.0006045990621803554,y:-.4501550155901276,z:.0002854995959842843}},{id:1434,name:"Big Biter Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chomp",tags:["Kart","Aug23","Blue","Chomp"]},is_available:!1,unlock:"purchase",align:{x:-.03449437859488835,y:-.4255526254165696,z:-.01578687531337597}},{id:1435,name:"Gang Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gang",tags:["SL","Blue"]},is_available:!1,unlock:"manual",align:{x:-.0742216025570741,y:-.31996611618895443,z:-.03396807765621901}},{id:1436,name:"Fluffly Meteor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fluffy",tags:["Drops5","AugM23","Blue"]},is_available:!1,unlock:"manual",align:{x:-.10687674474070041,y:-.3963768688642315,z:-.009694370022676202}},{id:1437,name:"King Hayden Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hayden",tags:["Drops5","AugM23","Gold"]},is_available:!1,unlock:"manual",align:{x:-.09881768637038846,y:-.27704802426136776,z:.02766423062606671}},{id:1438,name:"Anarchy Aiden",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academymale",tags:["Sep23","Pencil3","Egg","Blue","White","Sep24"]},is_available:!1,unlock:"purchase",align:{x:-.003854125100355432,y:.02120377863344247,z:-.0017562001329524124}},{id:1439,name:"Anarchy Ashley",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academyfemale",tags:["Sep23","Pencil3","Egg","Blue","White","Sep24"]},is_available:!1,unlock:"purchase",align:{x:.00533333956619142,y:.02741258526573187,z:.0024410398311239256}},{id:1440,name:"Dunce Cap",price:4e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dunce",tags:["Sep23","Pencil3","White"]},is_available:!1,unlock:"purchase",align:{x:-.08967990138936432,y:-.3866815477837924,z:-.04443854680037673}},{id:1441,name:"The Toolbelt",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toolbelt",tags:["Sep23","Pencil3","Newsletter","Brown"]},is_available:!1,unlock:"manual",align:{x:-.013502744844512193,y:.020367655645501692,z:.04201065787545022}},{id:1442,name:"Wrestle Shoes Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shoetie",tags:["SepM23","WBros","Black"]},is_available:!1,unlock:"purchase",align:{x:-.10093822397363705,y:-.1473264329539556,z:-.020321618573445617}},{id:1443,name:"Wrestling Belt",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wrestlebelt",tags:["SepM23","WBros","Gold","Black"]},is_available:!1,unlock:"purchase",align:{x:.0110659387040144,y:.10248215404849947,z:.005069916726395229}},{id:1444,name:"Wrestling Ring Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wrestlering",tags:["SepM23","WBros","White","Black","Red","White","Blue"]},is_available:!1,unlock:"purchase",align:{x:-.07282671191567625,y:-.3136625998694875,z:-.03332971179400285}},{id:1445,name:"The Grand Entrance Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Firework",tags:["SepM23","WBros","Red","Yellow"]},is_available:!1,unlock:"premium",align:{x:-.0572610207721147,y:-.2426137142559055,z:-.026205906376740168}},{id:1446,name:"Angler Fish Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angler",tags:["Oct23","Halloween4","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.11856385818199167,y:-.2454609004466619,z:-.05426164633452166}},{id:1447,name:"Hungry Shark Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shark",tags:["Oct23","Halloween4","Grey","Gray","Silver"]},is_available:!1,unlock:"purchase",align:{x:-.0482715334959154,y:-.36548575131680006,z:-.022096797700171797}},{id:1448,name:"Baby Ghost Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_babyghost",tags:["Oct23","Halloween4","White","OctM24"]},is_available:!1,unlock:"purchase",align:{x:-.07443624059748011,y:-.31585657908966125,z:-.03406634115519175}},{id:1449,name:"Captain Inksalot Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_squidpatch",tags:["Oct23","Halloween4","Newsletter","Green"]},is_available:!1,unlock:"manual",align:{x:-.04399797329171973,y:-.32983261562076716,z:-.0164697814700632}},{id:1450,name:"Demon Pixel Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelDemon",tags:["Oct23","Halloween4","Black"]},is_available:!1,unlock:"premium",align:{x:.05466192320814933,y:-.14156134563379286,z:.02501634429342456}},{id:1451,name:"Purple Witch's Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purplewitch",tags:["OctM23","Halloween4","Purple"]},is_available:!1,unlock:"purchase",align:{x:-.07349753031540551,y:-.3165613774455478,z:-.033642337838353575}},{id:1452,name:"Wednesday Morning Hair",price:2020,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_addams",tags:["OctM23","Halloween4","Black"]},is_available:!1,unlock:"purchase",align:{x:-.02403582432085649,y:-.07057495271745284,z:-.011000176764286496}},{id:1453,name:"Ectoplasmic Goo",price:1980,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slime",tags:["OctM23","Halloween4","Green"]},is_available:!1,unlock:"purchase",align:{x:-.012645094542945934,y:-.13571641390181843,z:-.011392387757339667}},{id:1454,name:"Stapled Bear Friend",price:2010,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bear",tags:["OctM23","Halloween4","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.07585449914001297,y:-.31015195172031684,z:-.03912391584435121}},{id:1455,name:"Ancient Egg Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ruins",tags:["Nov23","Mayan","Green","Gray","Grey","Stone","Plant"]},is_available:!1,unlock:"purchase",align:{x:-.09525324482895936,y:-.25954823271889493,z:-.016011557004969507}},{id:1456,name:"The Ruins Explorer",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ruinsexplorer",tags:["Nov23","Mayan","Brown","Stone","Plant","Gray","Grey"]},is_available:!1,unlock:"purchase",align:{x:-.04924187010309966,y:-.27254017384302986,z:-.022536471365236677}},{id:1457,name:"Indianapolis Jones",price:1750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_explorer",tags:["Nov23","Mayan","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.02506490018106522,y:-.14141917816246918,z:-.010903410658237134}},{id:1458,name:"Mayan Warrior Mask",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mayan",tags:["Nov23","Mayan","Brown","Green","Yellow","Nov24"]},is_available:!1,unlock:"purchase",align:{x:-.10286629613972376,y:-.2713354927050634,z:-.047070442523333575}},{id:1459,name:"Meso-Mage Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mayan2",tags:["Nov23","Mayan","Brown","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.10069550360080193,y:-.26879019980348207,z:-.044534697383819294}},{id:1460,name:"The Fallen Explorer",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_overgrown",tags:["Nov23","Newsletter","Mayan","Red","Green","Mushroom"]},is_available:!1,unlock:"manual",align:{x:-.06364583554386138,y:-.24908473548113697,z:-.029127965144288642}},{id:1461,name:"Ruins Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Ruins",tags:["Nov23","Mayan","Green","Gray","Grey"]},is_available:!1,unlock:"premium",align:{x:.13483230162508453,y:-.28814409860433626,z:.05063336225019538}},{id:1462,name:"Fall Pilgrim Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fallhat",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase",align:{x:-.07658982353458921,y:-.3118313473182215,z:-.014616762701649633}},{id:1463,name:"Kindergarden Turkey",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sillyturkey",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase",align:{x:-.08171040609951863,y:-.2591170302455612,z:-.03739115726709469}},{id:1464,name:"All the Fixin's Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinner",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase",align:{x:-.12748192914777334,y:-.26717934205433513,z:-.058343003403527716}},{id:1465,name:"Bread Cat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toastcat",tags:["Xsolla","Brown","Meow","Kitty","Kitten"]},is_available:!1,unlock:"manual",align:{x:-.106919336396047,y:-.2016934352689943,z:-.048926035350258745}},{id:1466,name:"Wreathed Egg",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wreath",tags:["Christmas3","Dec23","Green","Red","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.07670957484040786,y:-.26026926108724013,z:-.035110142006809786}},{id:1467,name:"Frosty",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snowman",tags:["Christmas3","Dec23","White","Yellow","Carrot","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.12526994807970437,y:-.31664436738973323,z:-.08257601239245954}},{id:1468,name:"Mistletoe Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mistletoe",tags:["Christmas3","Dec23","Green","Red","Kiss","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.04957526960208325,y:-.2876501081983409,z:.013757112569296626}},{id:1469,name:"Eggsmas Tree",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_christmastree",tags:["Christmas3","Dec23","Green","Red","Star","Dec24"]},is_available:!1,unlock:"purchase",align:{x:-.10231905708142319,y:-.4406982411880487,z:-.046825533367968686}},{id:1470,name:"Snow Owl Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SnowOwl",tags:["Christmas3","Dec23","Green","Red","Dec24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_owl"],align:{x:.061815243583282165,y:-.25447310305349125,z:.02258718103042709}},{id:1471,name:"Egg'Noggin",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggnog",tags:["Christmas3","Dec23","Yellow","Red","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.09318399398619048,y:-.4116537111213029,z:.07701051516243501}},{id:1472,name:"Party Hat 2024",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2024",tags:["NewYears","2024","DecM23","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.09064355390021284,y:-.39039936988703516,z:-.041483707867384534}},{id:1473,name:"2024 Headband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2024",tags:["NewYears","2024","DecM23","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.09492951642647074,y:-.3559587886582341,z:-.04344521104408777}},{id:1474,name:"Discord Dev Day Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_discorders",tags:["promo","Blurple"]},is_available:!1,unlock:"manual",align:{x:-.06795442489383152,y:-.3035879729134885,z:-.031096382242767784}},{id:1475,name:"Disco Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_NewYearsDisco",tags:["NewYears","2024","DecM23","Blurple"]},is_available:!1,unlock:"premium",align:{x:.030166434329798042,y:-.27482812378136545,z:.013805896913517343}},{id:1476,name:"The CyberCluck",price:125e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cybercar",tags:["Cybertruck","Truck","Musk","Silver","Grey","Gray"]},is_available:!0,unlock:"purchase",align:{x:-.013474577056496795,y:.16930203481819195,z:-.006157352086425649}},{id:1477,name:"Lightning Helmet",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lightninghelm",tags:["JanM24","Racer","Orange"]},is_available:!0,unlock:"purchase",align:{x:-.07491807008118823,y:-.20432339514493747,z:-.0349436672778321}},{id:1478,name:"Skull Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skullhelm",tags:["JanM24","Racer","Gray","Grey","Silver"]},is_available:!0,unlock:"purchase",align:{x:-.07931754284925585,y:-.21385281959261682,z:-.03630409160686873}},{id:1479,name:"Targeted Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_targetbandana",tags:["JanM24","Black","Racer"]},is_available:!0,unlock:"purchase",align:{x:-.024794948123451288,y:-.21502251051068977,z:-.01141950405570527}},{id:1480,name:"The Racing Spoiler Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SpoilerWings",tags:["JanM24","Egg","Racer","Orange"]},is_available:!0,unlock:"premium",align:{x:-.00825870243090332,y:-.07832172595582376,z:-.0037842788943276418}},{id:1481,name:"Cute Fox Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fox",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:-.16077933302191028,y:-.19580449761747687,z:-.07358187769334479}},{id:1482,name:"Cute Mouse Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mouse",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:-.08480075319980385,y:-.30491564699774754,z:-.038809705964513}},{id:1483,name:"Cute Deer Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fawn",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:-.08048338470361305,y:-.3416960134560574,z:-.03683382960738385}},{id:1484,name:"Cute Squirrel Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_squirrel",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:.11650162262118846,y:-.2758969224198887,z:.053319864471162576}},{id:1485,name:"Cute Owl Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_owl",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"purchase",align:{x:-.06367038537844705,y:-.24437293359297874,z:-.02914298608834659}},{id:1486,name:"Shell Wiki Staff Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wikiStaff",tags:["Feb24","Critters","Brown","Orange","Red"]},is_available:!1,unlock:"manual",align:{x:-.04096624685909722,y:-.20852336490380108,z:-.021048325634382775}},{id:1487,name:"Argentina Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfArgentina",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05244075537132131,y:-.1593111862268879,z:-.03961551049545556}},{id:1488,name:"England Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfEngland",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05224789100823646,y:-.15928168615741,z:-.040297181127995435}},{id:1489,name:"America Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfAmerica",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05224791201296153,y:-.1592816425351442,z:-.04029725629118422}},{id:1490,name:"Brazil Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfBrazil",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05244074224295803,y:-.15931118991349424,z:-.03961550448716081}},{id:1491,name:"Portugal Scarf",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarfPortugal",tags:["FebM24","SBros","Blue","White"]},is_available:!1,unlock:"purchase",align:{x:-.05244074224295803,y:-.15931118991349424,z:-.03961550448716081}},{id:1492,name:"Patchwork Cap",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_patchwork",tags:["Mar24","StPatricksDay","Brown","Mar24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.07898811547084694,y:-.25701601472386404,z:-.03585440128238787}},{id:1493,name:"Leprechaun Mini Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leprechaunsmall",tags:["Mar24","StPatricksDays","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase",align:{x:-.10272882257863225,y:-.32481178931668575,z:.025166638590053192}},{id:1494,name:"Bad Bunny Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ScaryBunny",tags:["Mar24","Darko","Grey","Gray","Teeth","bun_badbunny"]},is_available:!1,unlock:"premium",align:{x:-.009802806022177979,y:-.18623701441787288,z:-.0044903104315981435}},{id:1495,name:"Slayaway Bunnyface",price:1750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slashbunny",tags:["MarM24","Skullface","Camp","White","Red","Teeth","Easter","Bunny","Carrot","Nov24","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.09468929728517828,y:-.2524876583691392,z:-.02302245686535491}},{id:1496,name:"Chocolate Drip",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chocolate",tags:["MarM24","Egg","Brown","Easter","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.040914625540970695,y:-.1707145084561087,z:-.0023571459506205733}},{id:1497,name:"Trucker Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_trucker",tags:["MarM24","Default","Brown"]},is_available:!0,unlock:"default",align:{x:-.011117594625622118,y:-.15517299675012275,z:.00012578030894222492}},{id:1498,name:"Winner Winner Chicken Dinner",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chicknwinner",tags:["MarM24","Default","Brown"]},is_available:!0,unlock:"default",align:{x:-.08098020615453727,y:-.34813780272226147,z:-.03706120369985133}},{id:1499,name:"Newsboi Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_newsboy",tags:["MarM24","Default","Brown"]},is_available:!0,unlock:"default",align:{x:-.08738006395461273,y:-.265458179063754,z:-.03999385063925037}},{id:1500,name:"Cyborg Happy Bear",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bearSteambot",tags:["Apr24","EGGORG"]},is_available:!1,unlock:"purchase",align:{x:-.10475418436508388,y:-.26662521760024394,z:-.047941544660631885}},{id:1501,name:"Cyborg Train Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_trainSteambot",tags:["Apr24","EGGORG"]},is_available:!1,unlock:"purchase",align:{x:-.12178592407166589,y:-.2588505491467472,z:-.02727616374253189}},{id:1502,name:"Cyborg Gas Mask",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gasSteambot",tags:["Apr24","EGGORG"]},is_available:!1,unlock:"purchase",align:{x:-.11636451395311953,y:-.1695215645537993,z:-.05478758198568795}},{id:1503,name:"Cyboregg",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_steambot",tags:["Apr24","EGGORG","Borg","Brown","bun_borg"]},is_available:!1,unlock:"manual",align:{x:-.09077302794951159,y:-.1406921107433129,z:-.06263409753259673}},{id:1504,name:"30/30 Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_3030",tags:["Apr24","Nate"]},is_available:!1,unlock:"premium",align:{x:-.12075649171164304,y:-.2670312405309474,z:-.055266825951265475}},{id:1505,name:"iMoRTaL_Mafia Lion Hat ",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lion",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual",align:{x:-.05523263519859323,y:-.20578154478727628,z:-.02608652284875536}},{id:1506,name:"Red Stag Antlers",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_antlerRed",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual",align:{x:-.08392912196785507,y:-.3869049059653415,z:-.03841079731237207}},{id:1507,name:"Blue Stag Antlers",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_antlerBlue",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual",align:{x:-.08392912196785507,y:-.3869049059653415,z:-.03841079731237207}},{id:1508,name:"Duck Bill",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_duck",tags:["May24","Farm","Quack"]},is_available:!1,unlock:"purchase",align:{x:-.25727256982514657,y:-.08503653969461433,z:-.11774476940243431}},{id:1509,name:"Piggums",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pig",tags:["May24","Farm","Oink"]},is_available:!1,unlock:"purchase",align:{x:.0340176834848851,y:-.11904433109192025,z:.015571891552903672}},{id:1510,name:"Golden Waffle Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_WaffleWings",tags:["MayM24","Chicken&Waffles","Yellow","Food"]},is_available:!1,unlock:"premium",align:{x:.11523366883526381,y:-.19511899730781984,z:.052737560135949865}},{id:1511,name:"Ant Antennae",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_redantenna",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"purchase",align:{x:-.1412809402214923,y:-.2904071127570663,z:-.06465829072819218}},{id:1512,name:"Blue Antennae",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_blueantenna",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"purchase",align:{x:-.1412809402214923,y:-.2904071127570663,z:-.06465829072819218}},{id:1513,name:"Ladybug",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ladybug",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"purchase",align:{x:-.0816662276945972,y:-.27816936896021205,z:-.03737829669169529}},{id:1514,name:"Snail Shell",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shell",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"purchase",align:{x:-.09442372996202719,y:-.2958729805626792,z:.007481968370596004}},{id:1515,name:"Tarantula Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Tarantula",tags:["Jun24","Bugs","Red","bun_arach"]},is_available:!1,unlock:"manual",align:{x:.023468912065839564,y:-.279627927938108,z:.01074072519656108}},{id:1516,name:"Dragonfly Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DragonflyWings",tags:["Jun24","Bugs","Red"]},is_available:!1,unlock:"premium",align:{x:.11760358438311785,y:-.204291946057281,z:.05382216991343898}},{id:1517,name:"The Beekeeper",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beekeeper",tags:["Jun24","Bugs","Statham","Jason","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.051595910871738315,y:-.22910633203368747,z:-.026408647788614875}},{id:1518,name:"White Pawn",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pawnWhite",tags:["July24","Chess","Piece","White"]},is_available:!1,unlock:"purchase",align:{x:-.09967709355043963,y:-.4300108501066764,z:-.04561455059869335}},{id:1519,name:"White Bishop",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bishopWhite",tags:["July24","Chess","Piece","White"]},is_available:!1,unlock:"purchase",align:{x:-.08994075415156222,y:-.47119862188630207,z:-.04115369218057641}},{id:1520,name:"White Knight",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knightWhite",tags:["July24","Chess","Piece","White","Horse"]},is_available:!1,unlock:"purchase",align:{x:-.08731390904576974,y:-.4432797369028318,z:-.03995624085670224}},{id:1521,name:"White Rook",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rookWhite",tags:["July24","Chess","Piece","White","Castle"]},is_available:!1,unlock:"purchase",align:{x:-.08311623226752252,y:-.41111796217322916,z:-.038035953525808575}},{id:1522,name:"White Queen",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_queenWhite",tags:["July24","Chess","Piece","White"]},is_available:!1,unlock:"purchase",align:{x:-.09676844906929438,y:-.4813948621908833,z:-.044282912197643465}},{id:1523,name:"White King",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kingWhite",tags:["July24","Chess","Piece","White"]},is_available:!1,unlock:"purchase",align:{x:-.10104719864936396,y:-.4825457105896669,z:-.0462449489911656}},{id:1524,name:"Black Pawn",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pawnBlack",tags:["July24","Chess","Piece","Black"]},is_available:!1,unlock:"purchase",align:{x:-.09967707086878352,y:-.43001083935536255,z:-.04561455660581626}},{id:1525,name:"Black Bishop",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bishopBlack",tags:["July24","Chess","Piece","Black"]},is_available:!1,unlock:"purchase",align:{x:-.08994075415156222,y:-.47119862188630207,z:-.04115369218057641}},{id:1526,name:"Black Knight",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knightBlack",tags:["July24","Chess","Piece","Black","Horse"]},is_available:!1,unlock:"purchase",align:{x:-.08731400739706996,y:-.4432797255345075,z:-.03995627767414145}},{id:1527,name:"Black Rook",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rookBlack",tags:["July24","Chess","Piece","Black","Castle"]},is_available:!1,unlock:"purchase",align:{x:-.0831161830361602,y:-.411117975998003,z:-.03803593099470326}},{id:1528,name:"Black Queen",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_queenBlack",tags:["July24","Chess","Piece","Black"]},is_available:!1,unlock:"purchase",align:{x:-.09676844906929438,y:-.4813948621908833,z:-.044282912197643465}},{id:1529,name:"Black King",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kingBlack",tags:["July24","Chess","Piece","Black"]},is_available:!1,unlock:"purchase",align:{x:-.10104719864936396,y:-.4825457105896669,z:-.0462449489911656}},{id:1530,name:"Sciclops Visor",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cyclops",tags:["JulyM24","Eggx-men","xmen","marvel","FebM25"]},is_available:!1,unlock:"purchase",align:{x:-.10551757425891828,y:-.09622404746099888,z:-.04829089948682046}},{id:1531,name:"Wolfverine Mask",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_yellowmask",tags:["JulyM24","Eggx-men","xmen","marvel","Nov24"]},is_available:!1,unlock:"purchase",align:{x:-.06162407556999916,y:-.18689179115304871,z:-.02820272419661591}},{id:1532,name:"Deadpond Swords",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_deadswords",tags:["JulyM24","Eggx-men","xmen","marvel"]},is_available:!1,unlock:"purchase",align:{x:.11204319930156603,y:-.23497365642615092,z:.046029418062671246}},{id:1534,name:"Tempest Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lightning",tags:["JulyM24","Eggx-men","xmen","marvel"]},is_available:!1,unlock:"purchase",align:{x:.007895889724584215,y:-.14803468788029917,z:.0043091670559296524}},{id:1535,name:"Collossal Headgear",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chromeegg",tags:["JulyM24","Eggx-men","xmen","marvel"]},is_available:!1,unlock:"purchase",align:{x:-.036094262557422985,y:-.15544419146008914,z:-.01651084784419639}},{id:1536,name:"Little Green Man",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_alien",tags:["Aug24","Galeggsy","Green"]},is_available:!1,unlock:"purchase",align:{x:-.1551552243277312,y:-.28629906630445223,z:-.07353908510677121}},{id:1537,name:"The UFO",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_alienufo",tags:["Aug24","Galeggsy"]},is_available:!1,unlock:"purchase",align:{x:.03848398917924367,y:.148136853763829,z:.01312069278266803}},{id:1538,name:"ZORG",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_alienChill",tags:["Aug24","Galeggsy","bun_zorg"]},is_available:!1,unlock:"manual",align:{x:-.05840094009621888,y:-.25156516666717677,z:-.026727631849014305}},{id:1539,name:"Rizz Lightyear",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_LightyearWings",tags:["Aug24","Galeggsy"]},is_available:!1,unlock:"premium",align:{x:.16984050226076874,y:-.1521365675214874,z:.0777287904392478}},{id:1540,name:"Pterodactyl Buddy",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pterodactyl",tags:["AugM24","Dino"]},is_available:!1,unlock:"purchase",align:{x:-.09900159122890684,y:-.3764694998272551,z:-.04531206341050714}},{id:1541,name:"Fossil Fedora",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bonehat",tags:["AugM24","Dino"]},is_available:!1,unlock:"purchase",align:{x:-.07596886143235793,y:-.32452148246261436,z:-.03477332843740433}},{id:1542,name:"ATV - All Teeth Vehicle",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_atvteeth",tags:["AugM24","Dino"]},is_available:!1,unlock:"purchase",align:{x:.024516817859058904,y:.10342963067335154,z:.011220307084232828}},{id:1543,name:"T-Rex Skull Mask",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rexskull",tags:["AugM24","Dino"]},is_available:!1,unlock:"purchase",align:{x:-.11496248534634868,y:-.28550241077441996,z:-.052610582983558585}},{id:1544,name:"Dracolich Wings ",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_BoneWings",tags:["AugM24","Dino"]},is_available:!1,unlock:"premium",align:{x:.1090015378592365,y:-.17438504153549697,z:.04988537825347225}},{id:1545,name:"Eggy Potter Glasses",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lightningglasses",tags:["Sep24","EggyP"]},is_available:!1,unlock:"purchase",align:{x:-.12228432910310749,y:-.15101147204329735,z:-.055964364408221}},{id:1546,name:"Mandrake Leaves",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mandrakeplant",tags:["Sep24","EggP","bun_plant"]},is_available:!1,unlock:"manual",align:{x:-.01732750010110795,y:-.42800164534284146,z:.019524762330098366}},{id:1547,name:"The Sorta Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leatherface",tags:["Sep24","EggyP","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.09513927360790042,y:-.4097619414724307,z:-.04354120798716887}},{id:1548,name:"The Guardian",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_guardian",tags:["SepM24","Football","Fbros"]},is_available:!1,unlock:"purchase",align:{x:-.03805563218712571,y:-.13664976044984156,z:-.022544277484762232}},{id:1549,name:"Shell Shoulders",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shoulderpads",tags:["SepM24","Football","Fbros"]},is_available:!1,unlock:"purchase",align:{x:-.0393742662174601,y:-.1719689816208525,z:-.018019930672465434}},{id:1550,name:"The Raiders Garb",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Raiders",tags:["SepM24","Football","Fbros"]},is_available:!1,unlock:"premium",align:{x:-.06081399440956914,y:-.17548223840044253,z:-.027831984430469872}},{id:1551,name:"Quoth, the Raven",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_raven",tags:["Oct24","Black","Newsletter","Halloween5"]},is_available:!1,unlock:"manual",align:{x:-.09488753792390403,y:-.42974676410640456,z:-.02479746319860554}},{id:1552,name:"Neon Birdo Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Neon",tags:["Oct24","Black","Newsletter","Halloween5"]},is_available:!1,unlock:"premium",align:{x:-.04860903410989448,y:-.21843568312173384,z:-.0222462920273842}},{id:1553,name:"Shellraiser",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pins",tags:["OctM24","Halloween5"]},is_available:!1,unlock:"purchase",align:{x:-.07104303718679184,y:-.30597407514043984,z:-.032509614041548285}},{id:1554,name:"Frankenstein's Egg",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frank",tags:["OctM24","Halloween5"]},is_available:!1,unlock:"purchase",align:{x:-.03692161325411414,y:-.19505344100900457,z:-.01689742271140579}},{id:1555,name:"Skullface's Mom",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skullfacemom",tags:["Nov24","SC2","Mum"]},is_available:!1,unlock:"purchase",align:{x:-.04055684615546595,y:-.2479488495980653,z:-.019373281719983523}},{id:1556,name:"Tentacle",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tentacleshoe",tags:["Nov24","SC2","Mum"]},is_available:!1,unlock:"purchase",align:{x:-.08424219372301156,y:-.4331324392171507,z:-.03587487569002756}},{id:1557,name:"Werewolf",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_werewolf",tags:["Nov24","SC2","Mum"]},is_available:!1,unlock:"purchase",align:{x:-.2021165432797547,y:-.2291966245935364,z:-.09134325242098038}},{id:1558,name:"Pinhead",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinhead",tags:["Nov24","SC2","Mum"]},is_available:!1,unlock:"purchase",align:{x:-.09987235365705205,y:-.4212577560245392,z:-.04740130297262457}},{id:1559,name:"Robot Police Person",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RobotCop",tags:["Nov24","SC2","Robot Cop"]},is_available:!1,unlock:"premium",align:{x:-.10415364027513307,y:-.2544572301225956,z:-.04766670111979801}},{id:1560,name:"Fall Umbrella",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_umbrellaleaf",tags:["NovM24","Thanksgiving4","Autumn","Orange","Leaf"]},is_available:!1,unlock:"purchase",align:{x:-.09502903508809402,y:-.2927051280029007,z:.07778037415249078}},{id:1561,name:"Figgy Pudding",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_figgy",tags:["Dec24","Christmas4","Brown","White"]},is_available:!1,unlock:"purchase",align:{x:-.06450817292254918,y:-.27783474915880446,z:-.02952265313343455}},{id:1562,name:"Santa Legs",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santachimney",tags:["Dec24","Christmas4","Brown"]},is_available:!1,unlock:"purchase",align:{x:-.09512430063418353,y:-.4090560627386247,z:-.04314762559715851}},{id:1563,name:"Eggsmas Lights",price:50,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tangledlights",tags:["Dec24","Christmas4","Green"]},is_available:!1,unlock:"purchase",align:{x:-.09478732170786897,y:-.3294985211809085,z:-.039072026783508906}},{id:1564,name:"Mrs Clause",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mrsclause",tags:["Dec24","Christmas4","Pink","Red","White"]},is_available:!1,unlock:"purchase",align:{x:-.0870902407010874,y:-.22809935452291707,z:.011340604815113259}},{id:1565,name:"Santa's Sleigh",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sleigh",tags:["Dec24","Christmas4","Gold","Yellow","Red"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_sleigh"],align:{x:-.002264615090964206,y:.10781845061085127,z:-.00103009266295373}},{id:1566,name:"2025 Headband",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09491965599983421,y:-.3559159888243681,z:-.043440698345275475}},{id:1567,name:"Party Hat 2025",price:200,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09064361647033081,y:-.3903993984543703,z:-.041483736503072244}},{id:1568,name:"Fulcrum Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weaponbalancing",tags:["JanM25","Text","Blue","Weapon","Balancing","Vol1"]},is_available:!1,unlock:"purchase",align:{x:-.07463817271286866,y:-.3199311981528352,z:-.03321799658001279}},{id:1569,name:"The Equalizer",price:3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Equalizer",tags:["JanM25","Green","Yellow","Orange","Red","Rainbow","Sound","Speaker"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_equal"],align:{x:-.006203978958753131,y:-.30640164779834417,z:-.0028392977928960728}},{id:1570,name:"DogEgg Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dogpolice",tags:["Feb25","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.09273167319622111,y:-.2413060385365855,z:-.042439351504266865}},{id:1571,name:"Chief Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dogchief",tags:["Feb25","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.11216442427732165,y:-.32501694753736765,z:-.0513318154037718}},{id:1572,name:"Egg Pro Shops hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggproshop",tags:["Feb25","Blue","Yellow"]},is_available:!1,unlock:"purchase",align:{x:-.12075653081620974,y:-.2670311680328412,z:-.0552668438477662}},{id:1573,name:"Fisherman Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fisherman",tags:["Feb25","green","Yellow"]},is_available:!1,unlock:"manual",align:{x:-.06995068405252614,y:-.30127548502043777,z:-.0320134595070406}},{id:1574,name:"Rogue Contractor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roguecontractor",tags:["Drops7","D7W1","FebM25","Grey","Camo"]},is_available:!1,unlock:"manual",align:{x:-.029641633446784166,y:-.16266604575850696,z:-.013520061952077694}},{id:1575,name:"dropoutbrent Parachute",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_parachute",tags:["Drops7","D7W2","FebM25","Pink","Green"]},is_available:!1,unlock:"manual",align:{x:-.0025717114230223714,y:-.29312739006009203,z:-.001177618590234658}},{id:1576,name:"WinterX AngelCat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winterx",tags:["Drops7","D7W2","FebM25","Pink","Yellow","Cat","Angel","Halo"]},is_available:!1,unlock:"manual",align:{x:-.03185250516164617,y:-.1915971925455225,z:-.014577539830657259}},{id:1577,name:"Henchmen Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_minion",tags:["Drops7","D7W2","FebM25","Yellow","Face","Eye"]},is_available:!1,unlock:"purchase",align:{x:-.06015336519728054,y:-.25544530674481103,z:-.027529658836678406}},{id:1578,name:"The Frostfall Wings",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Frostfall",tags:["Drops7","Premium","FebM25","Perm","Permanent"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_hat_frost"],align:{x:-.04832250932301607,y:-.1581391004944373,z:-.022115194586275998}},{id:1579,name:"St Patrick Sideburns",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leprechaunhair",tags:["Mar25","Bundle","Irish","Green","Orange","Buckle"]},is_available:!1,unlock:"manual",align:{x:-.05185480455074476,y:-.17136269562496276,z:-.023735905871966445}},{id:1580,name:"Lucky Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_luckycap",tags:["Mar25","Stpatricksday","Green","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.1210543003967457,y:-.268313840390229,z:-.05540308757285228}},{id:1581,name:"Island Crown",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paradisecrown",tags:["MarM25","Easter","Green","Moana","Grass","Flower","MarM25"]},is_available:!0,unlock:"purchase",align:{x:-.07105644648360965,y:-.2733141440835456,z:-.02992035560734979}},{id:1582,name:"Snow Blight",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snowhair",tags:["MarM25","White","Hair","Fairest","Red","Black"]},is_available:!0,unlock:"purchase",align:{x:.016196499136843734,y:-.12718797275005234,z:.006757112068581955}},{id:1583,name:"Malcontent Crown",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_evilhorns",tags:["MarM25","White","Queen","Fairest","Black"]},is_available:!0,unlock:"purchase",align:{x:-.08221047186945785,y:-.27911238654565806,z:-.03762758719242561}},{id:1584,name:"Eggfu Master Robe",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_faction1",tags:["Apr25","White","EGGORG","Shadow","Blue","Fairest"]},is_available:!1,unlock:"premium",align:{x:-.01449132984450241,y:-.0009178330569876714,z:-.006627248762252735}},{id:1585,name:"Eggsassin Robe",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_faction2",tags:["Apr25","Black","EGGORG","Shadow","Red","Black"]},is_available:!1,unlock:"premium",align:{x:-.014150440215876081,y:-.0010135521043506124,z:-.006471303595696698}},{id:1586,name:"Yellow Dragon Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_yellowDragon",tags:["Apr25","Yellow","EGGORG","Shadow","Black","Eyes","Newsletter"]},is_available:!1,unlock:"manual",align:{x:-.07748001937217763,y:-.23917631028239605,z:-.035459316781735556}},{id:1587,name:"Red Dragon Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_redDragon",tags:["Apr25","Red","EGGORG","Shadow","Black","Eyes","Bundle"]},is_available:!1,unlock:"manual",align:{x:-.07950583309832826,y:-.24790143060378877,z:-.03638644575222899}},{id:1588,name:"Sumo suit",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sumo",tags:["Apr25","EGGORG","Shadow","Black","Eyes","Premium"]},is_available:!0,unlock:"premium",align:{x:-.002183832012569553,y:-.07013694363675205,z:.0006322943492174105}},{id:1589,name:"Pixel Airplane Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelAirplane",tags:["AprM25","Retro","Wes","Premium"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixair"],align:{x:.213094379983787,y:-.16645957884834417,z:.09752425471968085}},{id:2001,name:"Target Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:0,tags:["Default","Red","Blue","Yellow"]},is_available:!0,unlock:"default"},{id:2002,name:"No Sign Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:0,tags:["Default","Red"]},is_available:!0,unlock:"default"},{id:2003,name:"Question Mark Stamp?",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:0,tags:["Default","Black","?"]},is_available:!0,unlock:"default"},{id:2004,name:"Peace Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:0,tags:["Default","Black"]},is_available:!0,unlock:"default"},{id:2005,name:"Thumbs Up Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:0,tags:["Default","White"]},is_available:!0,unlock:"default"},{id:2006,name:"Pablo Smile Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:0,tags:["Default","Happy","Face","Yellow"]},is_available:!0,unlock:"default"},{id:2007,name:"Skull & Crossbones Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2008,name:"Tyrant Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:3,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2009,name:"Shifty Eye Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:5,tags:["Purple"]},is_available:!0,unlock:"purchase"},{id:2010,name:"Arrow & Heart Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:6,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2011,name:"Grade A Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:1,tags:["Red","USDA"]},is_available:!0,unlock:"purchase"},{id:2012,name:"Anarchy Sign Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:1,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2013,name:"Derp Face Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:2,tags:["Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2014,name:"Wolf Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2015,name:"Chicken Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:6,tags:["Brown","MayM24"]},is_available:!1,unlock:"purchase"},{id:2016,name:"Phoenix Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:7,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2017,name:"Alien Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:7,tags:["Green"]},is_available:!0,unlock:"purchase"},{id:2018,name:"Dapper Mustache Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2019,name:"Happy Bear Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:8,tags:["Pink","Smile"]},is_available:!0,unlock:"purchase"},{id:2020,name:"Ghost Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:8,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2021,name:"Jack Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:8,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2022,name:"Cracks Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:9,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2023,name:"Bat Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:9,tags:["Halloween","Oct23","Grey","Gray","Oct24"]},is_available:!1,unlock:"purchase"},{id:2024,name:"Cthulhu Fhtagn Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:9,tags:["Halloween","Oct23","Green","Oct24"]},is_available:!1,unlock:"purchase"},{id:2025,name:"Elder Sign Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:9,tags:["Halloween","Oct23","Red","Oct24"]},is_available:!1,unlock:"purchase"},{id:2026,name:"Scary Teeth Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:9,tags:["Halloween","Oct23","Smile","Green","Oct24"]},is_available:!1,unlock:"purchase"},{id:2027,name:"Monster Tongue Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:9,tags:["Halloween","Oct23","Face","Oct24"]},is_available:!1,unlock:"purchase"},{id:2028,name:"Spooky Lady Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:9,tags:["Halloween","Oct23","Face","Oct24"]},is_available:!1,unlock:"purchase"},{id:2029,name:"Clown Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:10,tags:["Halloween","Oct23","Smile","Oct24"]},is_available:!1,unlock:"purchase"},{id:2030,name:"Stitch Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:10,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2031,name:"Devil Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:10,tags:["Halloween","Oct23","Smile","Oct24"]},is_available:!1,unlock:"purchase"},{id:2032,name:"Face Mask Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:10,tags:["Halloween","Oct23","Black","Oct24"]},is_available:!1,unlock:"purchase"},{id:2033,name:"Hand Turkey Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:10,tags:["NovM23","Thanksgiving","NovM24"]},is_available:!1,unlock:"purchase"},{id:2034,name:"Turkey Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:10,tags:["NovM23","Thanksgiving","NovM24"]},is_available:!1,unlock:"purchase"},{id:2035,name:"Turkey Crossbones Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:10,tags:["NovM23","Thanksgiving","Brown","NovM24"]},is_available:!1,unlock:"purchase"},{id:2036,name:"Reindeer Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:11,tags:["Dec23","Christmas","Red","Dec24"]},is_available:!1,unlock:"purchase"},{id:2037,name:"Gingerbread Cookie Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:11,tags:["Dec23","Christmas","Brown","Dec24"]},is_available:!1,unlock:"purchase"},{id:2038,name:"Santa Skull Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:11,tags:["Christmas2","Red","Dec24"]},is_available:!1,unlock:"purchase"},{id:2039,name:"2019 Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:11,tags:["NewYears","2019","Yellow","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2040,name:"Fireworks Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:11,tags:["NewYears","Blue","Yellow","DecM24"]},is_available:!1,unlock:"purchase"},{id:2041,name:"Midnight Clock Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:11,tags:["NewYears","DecM24"]},is_available:!1,unlock:"purchase"},{id:2042,name:"Stressed Out Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:7,tags:["Newsletter","Face"]},is_available:!1,unlock:"manual"},{id:2043,name:"Chicken Finger Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:8,tags:["Newsletter"]},is_available:!1,unlock:"manual"},{id:2044,name:"Lyerpald Stamp ",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:8,tags:["Contentcreator"]},is_available:!1,unlock:"manual"},{id:2045,name:"Groundhog Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:11,tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:2046,name:"Winter Snowflake Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:12,tags:["Groundhog","Feb23","Blue","Feb24"]},is_available:!1,unlock:"purchase"},{id:2047,name:"Spring Flower Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:12,tags:["Groundhog","Feb23","Pink","Feb24"]},is_available:!1,unlock:"purchase"},{id:2048,name:"Broken Heart Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:12,tags:["ValentinesDay","Red","Feb24","Feb25"]},is_available:!1,unlock:"purchase"},{id:2049,name:"Rose Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:12,tags:["ValentinesDay","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:2050,name:"Anatomical Heart Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:12,tags:["ValentinesDay","Heart","Feb25"]},is_available:!1,unlock:"purchase"},{id:2051,name:"Shamrock Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:12,tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2052,name:"Ginger Beard Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:12,tags:["StPatricksDay","MarM23","Brown","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2053,name:"Pot of Gold Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:13,tags:["StPatricksDay","MarM23","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2054,name:"Bunny Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:13,tags:["Easter","AprM23","Heart","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:2055,name:"Easter Egg Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:13,tags:["Easter","AprM23","Blue","White","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:2056,name:"Golden Easter Egg Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:13,tags:["Easter","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:2057,name:"Shell League Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:13,tags:["League"]},is_available:!0,unlock:"purchase"},{id:2058,name:"TXC Clan Logo Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:13,tags:["Green","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:2071,name:"GOD Clan Logo",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:15,tags:["Blue"]},is_available:!0,unlock:"purchase"},{id:2059,name:"Sherrif Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:6,tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:2060,name:"Rainbow Cloud Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:5,tags:["Cute"]},is_available:!0,unlock:"purchase"},{id:2061,name:"Angel Wings Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:6,tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:2062,name:"GoE Sigil - Wolf Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:13,tags:["GameOfEggs","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2063,name:"GoE Sigil - Lion Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:14,tags:["GameOfEggs","Red"]},is_available:!0,unlock:"purchase"},{id:2064,name:"GoE Sigil - Bird Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:14,tags:["GameOfEggs","Blue"]},is_available:!0,unlock:"purchase"},{id:2065,name:"GoE Sigil - Stag Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:14,tags:["GameOfEggs","Yellow"]},is_available:!0,unlock:"purchase"},{id:2066,name:"GoE Sigil - Fish Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:14,tags:["GameOfEggs","Orange"]},is_available:!0,unlock:"purchase"},{id:2067,name:"GoE Sigil - Squid Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:14,tags:["GameOfEggs","Black"]},is_available:!0,unlock:"purchase"},{id:2068,name:"GoE Sigil - Sun Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:14,tags:["GameOfEggs","Orange","Red"]},is_available:!0,unlock:"purchase"},{id:2069,name:"GoE Sigil - Flower Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:14,tags:["GameOfEggs","Green","Yellow"]},is_available:!0,unlock:"purchase"},{id:2070,name:"GoE Sigil - Dragon Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:15,tags:["GameOfEggs","Red"]},is_available:!0,unlock:"purchase"},{id:2072,name:"4th of July Stamp",price:1770,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:15,tags:["July4","Red","Blue","forth","Fireworks","JulyM24"]},is_available:!1,unlock:"purchase"},{id:2073,name:"SL MVP Division A Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:15,tags:["League"]},is_available:!1,unlock:"manual"},{id:2074,name:"SL MVP Division B Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:15,tags:["League"]},is_available:!1,unlock:"manual"},{id:2075,name:"CRGI Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:15,tags:["League","Dog"]},is_available:!1,unlock:"manual"},{id:2076,name:"Robot Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:6,tags:["Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2077,name:"Poop Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:7,tags:["Brown","Poop"]},is_available:!0,unlock:"purchase"},{id:2078,name:"Heart Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:1,tags:["Cards","Red"]},is_available:!1,unlock:"purchase"},{id:2079,name:"Spade Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:1,tags:["Cards","Black"]},is_available:!1,unlock:"purchase"},{id:2080,name:"Club Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:1,tags:["Cards","Black"]},is_available:!1,unlock:"purchase"},{id:2081,name:"Diamond Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:1,tags:["Cards","Red"]},is_available:!1,unlock:"purchase"},{id:2082,name:"What Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2083,name:"Yes Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2084,name:"No Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2085,name:"Ribcage Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2086,name:"Angry Cartridge Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:8,tags:["Grey","Gray","Mouth"]},is_available:!0,unlock:"purchase"},{id:2087,name:"DXG Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:0,tags:["League"]},is_available:!1,unlock:"manual"},{id:2088,name:"Tired Space Goblin Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:2,tags:["Eggwalker","Green"]},is_available:!1,unlock:"purchase"},{id:2089,name:"Angry Space Dog Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:3,tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:2090,name:"No Trying Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:4,tags:["Eggwalker","Red"]},is_available:!1,unlock:"purchase"},{id:2091,name:"Disgruntled Space Weasel Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:5,tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:2092,name:"White Beard Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:1,tags:["Newsletter","Christmas","Santa"]},is_available:!1,unlock:"manual"},{id:2093,name:"Strong Egg Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:5,tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:2094,name:"New Year 2020 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:6,tags:["NewYears","2020","Yellow","White"]},is_available:!1,unlock:"purchase"},{id:2095,name:"Bad Eggs For Life Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:8,tags:["BadEggsForLife","Jun23","MarM24"]},is_available:!1,unlock:"purchase"},{id:2096,name:"Pixel Heart Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:9,tags:["Newsletter","Red"]},is_available:!1,unlock:"manual"},{id:2097,name:"Eggy Cash Face Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:15,tags:["EggyCash","Face","Black"]},is_available:!0,unlock:"purchase"},{id:2098,name:"DXG Clan Logo 2 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:10,tags:["League"]},is_available:!1,unlock:"manual"},{id:2099,name:"Raid Land Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:11,tags:["RaidLand"]},is_available:!1,unlock:"purchase"},{id:2100,name:"Egg Org Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:12,tags:["AprilFools","Black"]},is_available:!1,unlock:"purchase"},{id:2101,name:"MVP 2020 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:13,tags:["League"]},is_available:!1,unlock:"manual"},{id:2102,name:"TXC Clan Skull Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:14,tags:["League","Purple"]},is_available:!1,unlock:"manual"},{id:2103,name:"Toxic Skull Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:15,tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:2104,name:"Toxic Nuke Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:0,tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:2105,name:"Toxic Derp Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:1,tags:["Rotten","Green","Smile"]},is_available:!0,unlock:"purchase"},{id:2106,name:"Facepaint Heart Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:5,tags:["Rockstar","JanM23","Pink","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2107,name:"Facepaint Star Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:6,tags:["Rockstar","JanM23","Black","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2108,name:"Facepaint Lightning Bolt Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:4,tags:["Rockstar","JanM23","Yellow","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2109,name:"Pink Starburst Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:7,tags:["Galeggsy","AprM23","Aug24"]},is_available:!1,unlock:"purchase"},{id:2110,name:"Alien Eyes 1 Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:8,tags:["Galeggsy","AprM23","Face","Aug24"]},is_available:!1,unlock:"purchase"},{id:2111,name:"Alien Eyes 2 Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:9,tags:["Galeggsy","AprM23","Face","Cute","Aug24"]},is_available:!1,unlock:"purchase"},{id:2112,name:"Flame Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:7,tags:["Newsletter","Fire","Red","Orange","Yellow"]},is_available:!1,unlock:"manual"},{id:2113,name:"Discord Mod Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:13,tags:["mod"]},is_available:!1,unlock:"manual"},{id:2114,name:"Black Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:14,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2115,name:"Red Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:15,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2116,name:"Pink Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:0,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2117,name:"Killstreak Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:1,tags:["Killstreak","Smile","Red"]},is_available:!1,unlock:"manual"},{id:2118,name:"Red Rooster Wings Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:10,tags:["Chicken","MayM24"]},is_available:!1,unlock:"purchase"},{id:2119,name:"White Rooster Wings Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:11,tags:["Chicken","MayM24"]},is_available:!1,unlock:"purchase"},{id:2120,name:"Gold Rooster Wings Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:12,tags:["Chicken","July23","MayM24"]},is_available:!1,unlock:"purchase"},{id:2121,name:"Ugly Jason Face Stamp",price:1300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:2,tags:["f13"]},is_available:!1,unlock:"purchase"},{id:2122,name:"Little Happy Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:3,tags:["Stampede","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2123,name:"Angry Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:4,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2124,name:"Why Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:5,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2125,name:"Influenced Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:6,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2126,name:"Nervous Crush Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:7,tags:["Stampede","Face","Red"]},is_available:!0,unlock:"purchase"},{id:2127,name:"Girly Eyes Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:8,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2128,name:"Big Smile Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:9,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2129,name:"Cyclops Face Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:10,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2130,name:"Grumpy Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:11,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2131,name:"Big Happy Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:12,tags:["Stampede","Smile","Face"]},is_available:!0,unlock:"purchase"},{id:2132,name:"Scared Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:13,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2133,name:"This Guy Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:14,tags:["Stampede","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2134,name:"Tumble Dude Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:15,tags:["Stampede","White","Face"]},is_available:!0,unlock:"purchase"},{id:2135,name:"Thee_Owl Angry Face Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:0,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2136,name:"Blow Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:1,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2137,name:"Whip Em Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:2,tags:["Stampede","Blue","Whisk"]},is_available:!0,unlock:"purchase"},{id:2138,name:"Baby on Board Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:3,tags:["Stampede","Chick","Yellow"]},is_available:!0,unlock:"purchase"},{id:2139,name:"Thee_Owl Scared Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:4,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2140,name:"Yin Yang Chicken Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:5,tags:["Stampede","Black","White"]},is_available:!0,unlock:"purchase"},{id:2141,name:"Blue Wizard Guy Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:8,tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:2142,name:"God Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:6,tags:["League","Red","Orange"]},is_available:!1,unlock:"manual"},{id:2143,name:"Wero Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:7,tags:["Wero","Beard"]},is_available:!0,unlock:"purchase"},{id:2144,name:"New Year 2021 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:8,tags:["NewYears","2021","Green"]},is_available:!1,unlock:"purchase"},{id:2145,name:"Thee_Owl Logo Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:9,tags:["Thee_Owl","Green"]},is_available:!0,unlock:"purchase"},{id:2146,name:"Biggest Mouth Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:5,tags:["Newsletter","Ahh"]},is_available:!1,unlock:"manual"},{id:2147,name:"C4bra Ram Outfit Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:7,tags:["C4bra"]},is_available:!0,unlock:"purchase"},{id:2148,name:"Hazmatt Thumbs Up Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:8,tags:["Hazmat","Yellow"]},is_available:!0,unlock:"purchase"},{id:2149,name:"Hazmatt POG Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:9,tags:["Hazmat","Yellow"]},is_available:!0,unlock:"purchase"},{id:2150,name:"Pixel Tech Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:10,tags:["Pixel","Green"]},is_available:!0,unlock:"purchase"},{id:2151,name:"Pixel Chicken Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:11,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2152,name:"Pixel Gun Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:12,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2153,name:"Pixel Robot Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:13,tags:["Pixel","Blue"]},is_available:!0,unlock:"purchase"},{id:2154,name:"Pixel Shield Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:14,tags:["Pixel","Eggs"]},is_available:!0,unlock:"purchase"},{id:2155,name:"Pixel Egg Splat Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:15,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2156,name:"Pixel Swords Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:0,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2157,name:"Pixel Happy Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:1,tags:["Pixel","Smile","bun_gamer"]},is_available:!0,unlock:"purchase"},{id:2158,name:"Pixel Angry Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:2,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2159,name:"Pixel Annoyed Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:3,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2160,name:"Pixel Dead Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:4,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2161,name:"Pixel Deal With It Sunglasses Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:5,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2162,name:"Angry Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:12,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2163,name:"Cat Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:13,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2164,name:"Crazy Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:14,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2165,name:"Dog Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:15,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2166,name:"Evil Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:0,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2167,name:"Grinning Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:1,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2168,name:"Happy Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:2,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2169,name:"Laughing Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:3,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2170,name:"Pirate Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:4,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2171,name:"Sick Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:5,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2172,name:"Smiling Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:6,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2173,name:"Tongue-Out Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:7,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2174,name:"Upset Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:8,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2175,name:"Dead BW Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:10,tags:["EGGORG","Wizard","Blue","Apr24","Apr25"]},is_available:!0,unlock:"purchase"},{id:2176,name:"Egg Org Spokesperson Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:11,tags:["EGGORG","Apr24","Apr25"]},is_available:!0,unlock:"purchase"},{id:2177,name:"Aries Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:12,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2178,name:"Diablo Frown Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:9,tags:["EGGORG","Apr24","Apr25"]},is_available:!0,unlock:"purchase"},{id:2179,name:"Train Ticket Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:11,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2180,name:"Train Engine Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:13,tags:["Trains","Cars","Black"]},is_available:!0,unlock:"purchase"},{id:2181,name:"All Aboard Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:14,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2182,name:"Pain Train's Comin Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:15,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2183,name:"Random Life Logo Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:0,tags:["Random","RL"]},is_available:!0,unlock:"purchase"},{id:2184,name:"Mystery QR Code",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:5},is_available:!0,unlock:"purchase"},{id:2185,name:"Ethan Gamer Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:4,tags:["EthanGamer","Red"]},is_available:!0,unlock:"purchase"},{id:2186,name:"Red Aries Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:10,tags:["League"]},is_available:!1,unlock:"manual"},{id:2187,name:"Toilet Paper Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:6,tags:["TP","Poop","2ply","Text","bun_toilet"]},is_available:!1,unlock:"purchase"},{id:2188,name:"Water Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:8,tags:["Summer","JunM23","Blue","Water","JunM24"]},is_available:!1,unlock:"purchase"},{id:2189,name:"Popsicle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:6,tags:["Summer","JunM23","Pink","Food","JunM24"]},is_available:!1,unlock:"purchase"},{id:2190,name:"Sun Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:7,tags:["Summer","JunM23","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:2191,name:"Postage Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:9,tags:["Summer","JunM23","JunM24"]},is_available:!1,unlock:"purchase"},{id:2192,name:"Blue Wizard Skull Stamp",price:1200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:6,tags:["BWD"]},is_available:!0,unlock:"purchase"},{id:2193,name:"Lyerpald Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:8,tags:["Dog","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2194,name:"SL NA#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:1,tags:["League","Yellow"]},is_available:!1,unlock:"manual"},{id:2195,name:"SL EU#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:2,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2196,name:"SL OCE#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:3,tags:["League","Green"]},is_available:!1,unlock:"manual"},{id:2197,name:"I <3 New Yolker Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:11,tags:["Newsletter","Heart","NY"]},is_available:!1,unlock:"manual"},{id:2198,name:"Egg Heart Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:12,tags:["White"]},is_available:!1,unlock:"manual"},{id:2199,name:"Chantigg Face Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:13,tags:["Chantigg","Smile"]},is_available:!0,unlock:"purchase"},{id:2200,name:"Chantigg Cake Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:14,tags:["Chantigg","Food"]},is_available:!0,unlock:"purchase"},{id:2201,name:"Grade A+ Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:0,tags:["Pencil","Sep23","Red","Sep24"]},is_available:!1,unlock:"purchase"},{id:2202,name:"Globe Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:1,tags:["Pencil","Sep23","Earth","Green","Blue","Sep24"]},is_available:!1,unlock:"purchase"},{id:2203,name:"Nerd Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:15,tags:["Pencil","Sep23","Smile","Sep24"]},is_available:!1,unlock:"purchase"},{id:2204,name:"Gold Beak Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:13,tags:["vipItem","Premium","Yellow"]},is_available:!0,unlock:"vip"},{id:2205,name:"Zombie Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:10,tags:["Halloween2","Oct23","Yellow","OctM24"]},is_available:!1,unlock:"purchase"},{id:2206,name:"Werewolf Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:9,tags:["Halloween2","Oct23","Pink","OctM24"]},is_available:!1,unlock:"purchase"},{id:2207,name:"Vampire Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:8,tags:["Halloween2","Oct23","Red","OctM24"]},is_available:!1,unlock:"purchase"},{id:2208,name:"Sasquatch Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:7,tags:["Halloween2","Oct23","Brown","OctM24"]},is_available:!1,unlock:"purchase"},{id:2209,name:"Medusa Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:6,tags:["Halloween2","Oct23","Green","OctM24"]},is_available:!1,unlock:"purchase"},{id:2210,name:"Blue Cyclops Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:5,tags:["Halloween2","Oct23","Blue","OctM24"]},is_available:!1,unlock:"purchase"},{id:2211,name:"Cthulu Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:4,tags:["Halloween2","Oct23","Green","OctM24"]},is_available:!1,unlock:"purchase"},{id:2212,name:"Baldwiz Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:3,tags:["Halloween2","Oct23","Skull","OctM24"]},is_available:!1,unlock:"purchase"},{id:2213,name:"Fang Pablo Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:11,tags:["Halloween2","Oct23","Smile","OctM24"]},is_available:!1,unlock:"purchase"},{id:2214,name:"Jack O' Lantern Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:12,tags:["Halloween2","Oct23","Face","Black","OctM24"]},is_available:!1,unlock:"purchase"},{id:2215,name:"Circle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:0,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2216,name:"Square Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:15,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2217,name:"Umbrella Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:1,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2218,name:"Triangle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:14,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2219,name:"NACL Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:2,tags:["League","Yellow","Blue"]},is_available:!1,unlock:"manual"},{id:2220,name:"RBL Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:3,tags:["League","Black","Red"]},is_available:!1,unlock:"manual"},{id:2221,name:"Sheesh Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:11},is_available:!0,unlock:"purchase"},{id:2222,name:"Black Eggs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:10,tags:["Black Fryday","May24"]},is_available:!1,unlock:"purchase"},{id:2223,name:"Black Fries Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:9,tags:["Black Fryday","AprM24","FebM24"]},is_available:!0,unlock:"purchase"},{id:2224,name:"Red Wins Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:4,tags:["KotC","Red"]},is_available:!0,unlock:"purchase"},{id:2225,name:"Blue Wins Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:5,tags:["KotC","Blue"]},is_available:!0,unlock:"purchase"},{id:2226,name:"I put the OP in Coop Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:6,tags:["KotC"]},is_available:!0,unlock:"purchase"},{id:2227,name:"I rule the Roost Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:7,tags:["KotC"]},is_available:!0,unlock:"purchase"},{id:2228,name:"2022 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:12,tags:["2022","Blue"]},is_available:!1,unlock:"purchase"},{id:2229,name:"Nervous Elf Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:14,tags:["Christmas2","Face","Smile","bun_mistle","Dec24"]},is_available:!1,unlock:"purchase"},{id:2230,name:"Pro Plays Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:13,tags:["Drops","White"]},is_available:!1,unlock:"manual"},{id:2231,name:"Ganbaru Okan Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:15,tags:["Drops","Black","Pink"]},is_available:!1,unlock:"manual"},{id:2232,name:"Cold Face Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:0,tags:["Chilly","Ice"]},is_available:!1,unlock:"purchase"},{id:2233,name:"Snowman Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:1,tags:["Chilly","Smile","Face"]},is_available:!1,unlock:"purchase"},{id:2234,name:"Hockey Sticks Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:2,tags:["Chilly","Brown","Canada"]},is_available:!1,unlock:"purchase"},{id:2235,name:"Happy Aww Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:3,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2236,name:"Sad Aww Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:4,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2237,name:"Heart Eyes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:5,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2238,name:"Star Eyes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:6,tags:["Kawaii","Cute","Face","Yellow"]},is_available:!0,unlock:"purchase"},{id:2239,name:"Shocked Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:7,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2240,name:"Ecstatic Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:8,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2241,name:"Pleased Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:9,tags:["Kawaii","Cute","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2242,name:"Cat Wink Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:10,tags:["Kawaii","Cute","Face","bun_cat"]},is_available:!0,unlock:"purchase"},{id:2243,name:"Nate's Monies Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:11,tags:["Nate","MayM23","Yellow","FebM25"]},is_available:!1,unlock:"purchase"},{id:2244,name:"Nate's Bomb Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:12,tags:["Nate","Black","Apr24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2245,name:"Nate's Eel Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:13,tags:["Nate","Oct23","Black","FebM25"]},is_available:!1,unlock:"purchase"},{id:2246,name:"Nate's Skypunch Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:14,tags:["Nate","MarM23","Pixel","FebM25"]},is_available:!1,unlock:"purchase"},{id:2247,name:"Nate's Stonks Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:15,tags:["Nate","Yellow","Ahh","FebM25"]},is_available:!1,unlock:"purchase"},{id:2248,name:"Nate's Dead Jason Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:15,tags:["Nate","Black","White","FebM25"]},is_available:!1,unlock:"purchase"},{id:2249,name:"Nate's Alive Jason Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:14,tags:["Nate","Black","White","July24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2250,name:"Nate's Noodly Appendages Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:13,tags:["Nate","Smile","FebM25"]},is_available:!1,unlock:"purchase"},{id:2251,name:"Phoenix BLZ Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:10,tags:["SL","Orange","Yellow"]},is_available:!1,unlock:"manual"},{id:2252,name:"Navi Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:9,tags:["SL","Blue","Red"]},is_available:!1,unlock:"manual"},{id:2253,name:"NCR Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:8,tags:["SL","Black","Purple"]},is_available:!1,unlock:"manual"},{id:2254,name:"Ukraine Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:7,tags:["UA","Blue","Yellow","Heart"]},is_available:!1,unlock:"purchase"},{id:2255,name:"Nothin' but Net Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:11,tags:["BBros","Basketball"]},is_available:!1,unlock:"purchase"},{id:2256,name:"On Fire Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:12,tags:["BBros","Basketball","Orange"]},is_available:!1,unlock:"purchase"},{id:2257,name:"Diamonds Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:6,tags:["EGGORG","Red"]},is_available:!1,unlock:"purchase"},{id:2258,name:"Clubs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:5,tags:["EGGORG","Black"]},is_available:!1,unlock:"purchase"},{id:2259,name:"Spades Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:4,tags:["EGGORG","Black"]},is_available:!1,unlock:"purchase"},{id:2260,name:"Hearts Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:3,tags:["EGGORG","Red"]},is_available:!1,unlock:"purchase"},{id:2261,name:"Egg Org Shield Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:2,tags:["EGGORG","Apr23","Red","Yellow","Apr25"]},is_available:!0,unlock:"purchase"},{id:2262,name:"Polarized Moon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:1,tags:["Relic","White"]},is_available:!0,unlock:"purchase"},{id:2263,name:"Shattered EGG ORG Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:0,tags:["Relic","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:2264,name:"Wizard Neko Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:15,tags:["Relic","Mar23","AugM23","Dog"]},is_available:!1,unlock:"purchase"},{id:2265,name:"Jason Eyes Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:14,tags:["Relic","Mar23","AugM23"]},is_available:!1,unlock:"purchase"},{id:2266,name:"Wizard Cheer Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:13,tags:["Relic","Mar23","AugM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2267,name:"Egg Love Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:12,tags:["Relic","Mar23","AugM23","Heart"]},is_available:!1,unlock:"purchase"},{id:2268,name:"Going Eggstinct Stamp",price:350,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:11,tags:["Dino","May23","Black","AugM24"]},is_available:!1,unlock:"purchase"},{id:2269,name:"No Tar Pits Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:10,tags:["Dino","May23","Red","AugM24"]},is_available:!1,unlock:"purchase"},{id:2270,name:"Clutch Up! Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:9,tags:["Dino","May23","Eggs","AugM24"]},is_available:!1,unlock:"purchase"},{id:2271,name:"No Meteors Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:8,tags:["Dino","May23","Red","AugM24"]},is_available:!1,unlock:"purchase"},{id:2272,name:"No Volcanos Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:7,tags:["Dino","May23","Red","AugM24"]},is_available:!1,unlock:"purchase"},{id:2273,name:"RAWR Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:6,tags:["Dino","MarM23","Yellow","Purple","AugM24"]},is_available:!1,unlock:"purchase"},{id:2274,name:"Baby Dino Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:5,tags:["Dino","May23","Green","Eggs","AugM24"]},is_available:!1,unlock:"purchase"},{id:2275,name:"Bluetooth Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:0,tags:["Mobile","JunM23","Smile"]},is_available:!1,unlock:"purchase"},{id:2276,name:"Happy Phone Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:1,tags:["Mobile","Green"]},is_available:!1,unlock:"purchase"},{id:2277,name:"Mad Phone Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:2,tags:["Mobile","Red"]},is_available:!1,unlock:"purchase"},{id:2278,name:"Signal Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:3,tags:["Mobile","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2279,name:"Charging! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:4,tags:["Mobile","Black","Apr24"]},is_available:!1,unlock:"purchase"},{id:2280,name:"Eggy-wan Beard Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:0,tags:["Eggwalker2","Face","Brown"]},is_available:!1,unlock:"purchase"},{id:2281,name:"Control Panel Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:1,tags:["Eggwalker2","Red","Black"]},is_available:!1,unlock:"purchase"},{id:2282,name:"Evader face Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:2,tags:["Eggwalker2","Red"]},is_available:!1,unlock:"purchase"},{id:2283,name:"Ladybug Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:3,tags:["Summer","JunM23","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2284,name:"Camper Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:4,tags:["Summer","JunM23","Green","Tent","JunM24"]},is_available:!1,unlock:"purchase"},{id:2285,name:"Oasis Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:5,tags:["Summer","JunM23","Black","Red","Blue","Tree","JunM24"]},is_available:!1,unlock:"purchase"},{id:2286,name:"Hot Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:6,tags:["Summer","JunM23","Orange","JunM24"]},is_available:!1,unlock:"purchase"},{id:2287,name:"Sun's out Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:7,tags:["Summer","JunM23","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:2288,name:"Blue's #1 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:8,tags:["Sports","JulyM23","Blue","JunM24"]},is_available:!1,unlock:"purchase"},{id:2289,name:"Red's #1 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:9,tags:["Sports","JulyM23","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2290,name:"Football Laces Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:10,tags:["Sports","JulyM23","White","Fbros","JunM24","SepM24"]},is_available:!1,unlock:"purchase"},{id:2291,name:"Hockey crossed sticks Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:11,tags:["Sports","JulyM23","Black","JunM24"]},is_available:!1,unlock:"purchase"},{id:2292,name:"Trophy #1 Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:12,tags:["Sports","JulyM23","Yellow","Gold","JunM24"]},is_available:!1,unlock:"purchase"},{id:2293,name:"What's the play? Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:13,tags:["Sports","JulyM23","Eggs","JunM24"]},is_available:!1,unlock:"purchase"},{id:2294,name:"Whistle Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:14,tags:["Sports","JulyM23","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2295,name:"Go Team Eggs Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:15,tags:["Sports","JulyM23","JunM24"]},is_available:!1,unlock:"purchase"},{id:2296,name:"GOAL Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:0,tags:["Sports","JulyM23","JunM24"]},is_available:!1,unlock:"purchase"},{id:2297,name:"Cooked Chicken Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:1,tags:["Chicken","Food","MayM24"]},is_available:!1,unlock:"purchase"},{id:2298,name:"Lil Nugz Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:2,tags:["Chicken","MayM24"]},is_available:!1,unlock:"purchase"},{id:2299,name:"Toast Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:3,tags:["Breakfast","Eggs","MayM24"]},is_available:!1,unlock:"purchase"},{id:2300,name:"Butter believe it Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:4,tags:["Breakfast","Food","NovM23","MayM24"]},is_available:!1,unlock:"purchase"},{id:2301,name:"Sour Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:5,tags:["Breakfast","July23","MayM24"]},is_available:!1,unlock:"purchase"},{id:2302,name:"Pancakes Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:6,tags:["Breakfast","Brown","Food","MayM24"]},is_available:!1,unlock:"purchase"},{id:2303,name:"Hard Boiled Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:7,tags:["Breakfast","Eggs","MayM24"]},is_available:!1,unlock:"purchase"},{id:2304,name:"Coffee makes me happy! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:8,tags:["Breakfast","Smile","MayM24"]},is_available:!1,unlock:"purchase"},{id:2305,name:"Bacon Bacon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:9,tags:["Breakfast","Red","Food","MayM24"]},is_available:!1,unlock:"purchase"},{id:2306,name:"Scavenger Statue Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:10,tags:["Scavenger","Blue","Wizard"]},is_available:!1,unlock:"purchase"},{id:2307,name:"Scavenger Map Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:11,tags:["Scavenger","Wizard"]},is_available:!1,unlock:"purchase"},{id:2308,name:"Scavenger Magnifeye Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:12,tags:["Scavenger","Blue"]},is_available:!1,unlock:"purchase"},{id:2309,name:"Scavenger Compass Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:13,tags:["Scavenger","Blue"]},is_available:!1,unlock:"purchase"},{id:2310,name:"Scavenger Monocle Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:14,tags:["Scavenger","Yellow"]},is_available:!1,unlock:"purchase"},{id:2311,name:"Paint Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:15,tags:["Pencil2","Sep23","Rainbow","Sep24"]},is_available:!1,unlock:"purchase"},{id:2312,name:"Science Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:0,tags:["Pencil2","Sep23","Blue","Purple","Red","Sep24"]},is_available:!1,unlock:"purchase"},{id:2313,name:"Schoolbus Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:1,tags:["Pencil2","Sep23","Yellow","Sep24"]},is_available:!1,unlock:"purchase"},{id:2314,name:"Math Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:2,tags:["Pencil2","Sep23","Black","Sep24"]},is_available:!1,unlock:"purchase"},{id:2315,name:"Sharkbucks Stamp",price:6900,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:3,tags:["Sep22","Green","Face"]},is_available:!0,unlock:"purchase"},{id:2316,name:"Kilzomatic Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:4,tags:["Sep22","Drops3","Blue","Eggs"]},is_available:!1,unlock:"manual"},{id:2317,name:"Diablo Sticker Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:5,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2318,name:"Pablo Sticker Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:6,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2319,name:"The Jaw Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:8,tags:["Sep22","Drops3","Face","Black"]},is_available:!1,unlock:"manual"},{id:2320,name:"Pablo GG Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:7,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2321,name:"Trick Or Treat Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:9,tags:["Halloween3","OctM23","Orange","OctM24"]},is_available:!1,unlock:"purchase"},{id:2322,name:"Scary Clown Face Stamp",price:1990,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:10,tags:["Halloween3","OctM23","It","OctM24"]},is_available:!1,unlock:"purchase"},{id:2323,name:"KJDCitsme Jacko Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:14,tags:["Halloween3","OctM23","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2324,name:"KJDCitsme Shock Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:11,tags:["Halloween3","OctM23","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2325,name:"Thee_Owl Breakout Yolk Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:13,tags:["Halloween3","OctM23","Yellow","Face","OctM24"]},is_available:!0,unlock:"purchase"},{id:2326,name:"Thee_Owl Peekout Yolk Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:9,tags:["Halloween3","OctM23","Yellow","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2327,name:"Zamsgod Scratch Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:12,tags:["Halloween3","OctM23","Face","Black","OctM24"]},is_available:!1,unlock:"purchase"},{id:2328,name:"Artshocks Half Asleep Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:10,tags:["Halloween3","OctM23","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2329,name:"Scared Stupid Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:8,tags:["Halloween3","OctM23","Face","Black","OctM24"]},is_available:!1,unlock:"purchase"},{id:2330,name:"One Cluck Man Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:7,tags:["Halloween3","OctM23","Face","OctM24"]},is_available:!1,unlock:"purchase"},{id:2331,name:"Skullface Kills Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:6,tags:["Halloween3","OctM23","Eggs","OctM24"]},is_available:!1,unlock:"purchase"},{id:2332,name:"Witches Broom Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:15,tags:["Halloween3","OctM23","Brown","OctM24"]},is_available:!1,unlock:"purchase"},{id:2333,name:"Fall Leaf Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:11,tags:["NovM23","Thanksgiving","Brown","NovM24"]},is_available:!1,unlock:"purchase"},{id:2334,name:"Turkey head on Stamp",price:400,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:12,tags:["NovM23","Thanksgiving","Brown","NovM24"]},is_available:!1,unlock:"purchase"},{id:2335,name:"Forest Shroom Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:13,tags:["NovM23","Thanksgiving2","Red","Food"]},is_available:!1,unlock:"purchase"},{id:2336,name:"Apple Core Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:14,tags:["NovM23","Thanksgiving2","Food"]},is_available:!1,unlock:"purchase"},{id:2337,name:"Drumstick Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:15,tags:["NovM23","Thanksgiving2","Brown","Food"]},is_available:!1,unlock:"purchase"},{id:2338,name:"It's Corn Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:4,tags:["NovM23","Thanksgiving2","Yellow","Green","Food"]},is_available:!1,unlock:"purchase"},{id:2339,name:"Corntastic Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:5,tags:["NovM23","Thanksgiving","Yellow","Orange","NovM24"]},is_available:!1,unlock:"purchase"},{id:2340,name:"You won a 1v1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:3,tags:["Badegg","Purple","Blue","Eggs"]},is_available:!1,unlock:"manual"},{id:2341,name:"Wizard Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:2,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2342,name:"Reload the clip Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:1,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2343,name:"Regeneration Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:0,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2344,name:"Upgrade Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:0,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2345,name:"Health Drop Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:1,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2346,name:"Sleeps Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:2,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2347,name:"Marksman Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:3,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2348,name:"Restocked Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:4,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2349,name:"Rambod Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:5,tags:["Badegg","Black","DecM23","July24"]},is_available:!1,unlock:"purchase"},{id:2350,name:"Surprise! Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:6,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2351,name:"Goose Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:7,tags:["Badegg","Black","premFeatOne","MarM25"]},is_available:!0,unlock:"purchase"},{id:2352,name:"New Year 2023 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:8,tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2353,name:"Mixtape Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:9,tags:["Rockstar","JanM23","Grey","Gray","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2354,name:"Treble clef Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:10,tags:["Rockstar","JanM23","Black","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2355,name:"Rock on Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:11,tags:["Rockstar","JanM23","Yellow","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2356,name:"Buck Teeth",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:13,tags:["Groundhog","Feb23","Face","Feb24"]},is_available:!1,unlock:"purchase"},{id:2357,name:"Alarm Clock Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:12,tags:["Groundhog","Newsletter","Feb23","White","Silver","Feb24"]},is_available:!1,unlock:"manual"},{id:2358,name:"Horseshoe Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:15,tags:["farm","FebM23","Brown","May24"]},is_available:!1,unlock:"purchase"},{id:2359,name:"Sunflower Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:14,tags:["farm","FebM23","Yellow","May24"]},is_available:!1,unlock:"purchase"},{id:2360,name:"CEO Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:0,tags:["League","Red"]},is_available:!1,unlock:"manual"},{id:2361,name:"LEV Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:1,tags:["League","Green"]},is_available:!1,unlock:"manual"},{id:2362,name:"RTV Clan Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:2,tags:["League","Blue","Purple"]},is_available:!1,unlock:"manual"},{id:2363,name:"Shell Tournaments Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:3,tags:["League","Orange"]},is_available:!0,unlock:"purchase"},{id:2364,name:"NPS Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:4,tags:["League","White"]},is_available:!1,unlock:"manual"},{id:2365,name:"Shell Tournaments #1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:5,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2366,name:"Hello my name is Pablo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:6,tags:["Drops4","Mar23","AugM23","Red","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2367,name:"Happily Fried Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:7,tags:["Drops4","Mar23","AugM23","White","Eggs","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2368,name:"Game Of The Year Stamp",price:350,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:8,tags:["Drops4","Mar23","Yellow","GOTY","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2369,name:"Wizards on Fire! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:9,tags:["Drops4","Mar23","Blue","BWD","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2370,name:"Banned Aid Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:10,tags:["Drops4","Mar23","Brown","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2371,name:"xQc Ape Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:11,tags:["Drops4","Mar23","White"]},is_available:!1,unlock:"manual"},{id:2372,name:"Shell Shockers Logo Stamp",price:50,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:12,tags:["Drops4","Mar23","Eggs","White","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2373,name:"Griffen Chin Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:13,tags:["Drops4","Mar23","Face","Black"]},is_available:!1,unlock:"manual"},{id:2374,name:"That's a Fowl Stamp",price:150,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:14,tags:["BBros","MarM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2375,name:"Stuffed Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:15,tags:["BBros","MarM23"]},is_available:!1,unlock:"purchase"},{id:2376,name:"Bear Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:0,tags:["BBros","MarM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2377,name:"Tiger Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:1,tags:["BBros","MarM23","Tiger","Cat"]},is_available:!1,unlock:"purchase"},{id:2378,name:"Basket Bros Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:2,tags:["BBros","MarM23","Orange"]},is_available:!1,unlock:"purchase"},{id:2379,name:"Hydrate! Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:3,tags:["BBros","MarM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2380,name:"Egg Jordan Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:4,tags:["BBros","MarM23","Black","Eggs"]},is_available:!1,unlock:"purchase"},{id:2381,name:"Kiss me I'm Irish Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:5,tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2382,name:"Monster Talisman Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:6,tags:["Monsters","Apr23"]},is_available:!1,unlock:"purchase"},{id:2383,name:"Hero Talisman Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:7,tags:["Heroes","Apr23"]},is_available:!1,unlock:"purchase"},{id:2384,name:"Judgement arrow Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:8,tags:["Apr23","Gold","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:2385,name:"Critical Hit Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:9,tags:["Apr23","Red","Gold","D20","Yellow"]},is_available:!1,unlock:"purchase"},{id:2386,name:"Breath Weapon Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:10,tags:["Apr23","Red","Gold","Dragon"]},is_available:!1,unlock:"purchase"},{id:2387,name:"Egg Org & Eggventure Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:11,tags:["Apr23","Red","Gold","Dragon"]},is_available:!1,unlock:"purchase"},{id:2388,name:"Heroes Potion Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:12,tags:["Heroes","Apr23","Green","Heart"]},is_available:!1,unlock:"manual"},{id:2389,name:"Monsters Potion Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:13,tags:["Apr23","Monsters","Red","Skull"]},is_available:!1,unlock:"manual"},{id:2390,name:"Monobrow Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:14,tags:["May23","Dino2","Black","Face","AugM24"]},is_available:!1,unlock:"purchase"},{id:2391,name:"Slay the Beast Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:15,tags:["May23","Dino2","Black","AugM24"]},is_available:!1,unlock:"purchase"},{id:2392,name:"Caveman Classic Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:0,tags:["May23","Dino2","Face","Smile","AugM24"]},is_available:!1,unlock:"purchase"},{id:2393,name:"Stone Tools Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:1,tags:["May23","Dino2","Brown","AugM24"]},is_available:!1,unlock:"purchase"},{id:2394,name:"Chart Stamp",price:10,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:3,tags:["MayM23","Eggflation","Red"]},is_available:!0,unlock:"purchase"},{id:2395,name:"Money Tree Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:4,tags:["MayM23","Eggflation","Green"]},is_available:!0,unlock:"purchase"},{id:2396,name:"Eggflation Rollercoaster Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:2,tags:["MayM23","Eggflation","Red"]},is_available:!0,unlock:"purchase"},{id:2397,name:"HODL Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:5,tags:["MayM23","Eggflation"]},is_available:!0,unlock:"purchase"},{id:2398,name:"Polaroid Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:6,tags:["Jun23","Photo","Eggs"]},is_available:!1,unlock:"purchase"},{id:2399,name:"Wedding Crasher Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:7,tags:["Jun23","Photo","Blue"]},is_available:!1,unlock:"purchase"},{id:2400,name:"Apature Stamp",price:825,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:8,tags:["Jun23","Photo","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2401,name:"Dour Mustache Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:9,tags:["Jun23","Photo","Brown"]},is_available:!1,unlock:"purchase"},{id:2402,name:"Starfish Stamp",price:505,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:10,tags:["JunM23","Summer2","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2403,name:"Jellyfish Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:11,tags:["JunM23","Summer2","White","JunM24"]},is_available:!1,unlock:"purchase"},{id:2404,name:"Beach Vibes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:12,tags:["JunM23","Summer2","JunM24"]},is_available:!1,unlock:"purchase"},{id:2405,name:"Beach Ball Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:13,tags:["JunM23","Summer2","White","Blue","Yellow","Red","JunM24"]},is_available:!1,unlock:"purchase"},{id:2406,name:"Equinox Sun Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:0,tags:["July23","Equinox","Yellow","JanM25"]},is_available:!1,unlock:"purchase"},{id:2407,name:"Equinox Moon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:1,tags:["July23","Equinox","Grey","Gray","JanM25"]},is_available:!1,unlock:"purchase"},{id:2408,name:"Equinox YinYang Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:14,tags:["July23","Equinox","Blue","Yellow","JanM25"]},is_available:!1,unlock:"purchase"},{id:2409,name:"Pablodala Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:15,tags:["July23","Equinox","Mandala","Blue","Yellow","JanM25"]},is_available:!1,unlock:"purchase"},{id:2410,name:"Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:2,tags:["JulyM23","Sports2"]},is_available:!1,unlock:"purchase"},{id:2411,name:"Grind Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:4,tags:["JulyM23","Sports2","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2412,name:"Fellow Kids Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:3,tags:["JulyM23","Sports2","Red","Skateboard"]},is_available:!1,unlock:"purchase"},{id:2413,name:"Safety Team Approved Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:5,tags:["JulyM23","Sports2","DecM24"]},is_available:!1,unlock:"purchase"},{id:2414,name:"The MenoXD Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:6,tags:["JulyM23","Red","xd"]},is_available:!0,unlock:"purchase"},{id:2415,name:"Red S-tier Racing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:7,tags:["Aug23","Eggs","Kart"]},is_available:!1,unlock:"purchase"},{id:2416,name:"Green S-tier Racing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:8,tags:["Aug23","Eggs","Kart"]},is_available:!1,unlock:"purchase"},{id:2417,name:"Question block Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:9,tags:["Aug23","Yellow","?","JanM24","Kart"]},is_available:!1,unlock:"purchase"},{id:2418,name:"Racing Flags Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:10,tags:["Aug23","Black","White","Kart"]},is_available:!1,unlock:"purchase"},{id:2419,name:"Stopwatch Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:11,tags:["Newsletter","Aug23","White","Clock","Kart"]},is_available:!1,unlock:"manual"},{id:2420,name:"Shy Egg Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:12,tags:["Aug23","White","Kart"]},is_available:!1,unlock:"purchase"},{id:2421,name:"Banana Peel Stamp",price:1200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:13,tags:["Aug23","Yellow","Kart"]},is_available:!1,unlock:"purchase"},{id:2422,name:"Respawn Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:14,tags:["Aug23","Mushroom","Green","1up","Kart"]},is_available:!1,unlock:"purchase"},{id:2423,name:"Om Nom Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:15,tags:["AugM23","Drops5","Yellow","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2424,name:"Harrison Cat Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:0,tags:["AugM23","Drops5","Thumb","Black","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2425,name:"Flushed Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:1,tags:["AugM23","Drops5","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2426,name:"Albino Snake Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:2,tags:["AugM23","Drops5","Grey","Gray","ABHS"]},is_available:!1,unlock:"manual"},{id:2427,name:"Shell Wiki Stamp",price:3210,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:3,tags:["AugM23","Drops5","Egg","White"]},is_available:!0,unlock:"purchase"},{id:2428,name:"Wiz Ears Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:4,tags:["AugM23","Drops5","Blue","BWD","AprM24","FebM25"]},is_available:!1,unlock:"purchase"},{id:2429,name:"r/place Pablo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:5,tags:["AugM23","Drops5","Yellow","Orange","Smile"]},is_available:!1,unlock:"manual"},{id:2430,name:"r/place BWD skull Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:6,tags:["AugM23","Drops5","Blue"]},is_available:!1,unlock:"manual"},{id:2431,name:"r/place BWD logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:7,tags:["AugM23","Drops5","Blue"]},is_available:!1,unlock:"manual"},{id:2432,name:"Solve for X Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:8,tags:["Sep23","Pencil3","Orange"]},is_available:!1,unlock:"purchase"},{id:2433,name:"Anarchy Academy",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:9,tags:["Sep23","Pencil3","Red"]},is_available:!1,unlock:"purchase"},{id:2434,name:"Egg-lectrons Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:10,tags:["Sep23","Pencil3","Science","Black"]},is_available:!1,unlock:"purchase"},{id:2435,name:"Blue Wizard Wrestling Federation Logo",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:12,tags:["SepM23","WBros","Wrestle","BWD","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2436,name:"Bron Lester Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:13,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2437,name:"Jan Seeya Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:14,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2438,name:"Rocky Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:15,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2439,name:"Brogan Paw Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:0,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2440,name:"Romeo Rain Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:1,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2441,name:"Nacho Mann Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:2,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2442,name:"Death Brawlin Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:3,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2443,name:"Bulk Logan Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:4,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2444,name:"Ray Mystery Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:5,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2445,name:"Binky Flinch Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:6,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2446,name:"Bonka Beware Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:7,tags:["SepM23","WBros","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2447,name:"Wrestlebros 1v1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:11,tags:["SepM23","WBros","Blue","Purple"]},is_available:!1,unlock:"manual"},{id:2448,name:"Rotting Zombie Fish Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:8,tags:["Oct23","Halloween4","Blue"]},is_available:!1,unlock:"purchase"},{id:2449,name:"Shark Chomp Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:9,tags:["Oct23","Halloween4","Blue"]},is_available:!1,unlock:"purchase"},{id:2450,name:"Squiddy Friend Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:10,tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:2451,name:"Venomous Sea Snake Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:11,tags:["Oct23","Halloween4","Green"]},is_available:!1,unlock:"purchase"},{id:2452,name:"Bait Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:12,tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:2453,name:"Wilson. Wilson... WILSON!",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:13,tags:["Oct23","Halloween4","Red","Hand"]},is_available:!1,unlock:"purchase"},{id:2454,name:"Demonic Face Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:14,tags:["Oct23","Face","bun_demon"]},is_available:!1,unlock:"manual"},{id:2455,name:"Boo Crew Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:15,tags:["OctM23","Text","Purple"]},is_available:!1,unlock:"purchase"},{id:2456,name:"Cool Maid Face",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:0,tags:["OctM23","Face"]},is_available:!1,unlock:"purchase"},{id:2457,name:"Ghoul Power Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:1,tags:["OctM23","Text","Pink"]},is_available:!1,unlock:"purchase"},{id:2458,name:"Ghost Malone",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:2,tags:["OctM23","Meme","White"]},is_available:!1,unlock:"purchase"},{id:2459,name:"Seen too much Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:3,tags:["OctM23","Purple","Oct24"]},is_available:!1,unlock:"purchase"},{id:2460,name:"Pumpkin Wizard Digital",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:4,tags:["OctM23","Orange","BWD","Infinite Smasher"]},is_available:!1,unlock:"purchase"},{id:2461,name:"Get Ghosted Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:5,tags:["OctM23","Black","Ghost","Text"]},is_available:!1,unlock:"purchase"},{id:2462,name:"Sacred Sun Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:6,tags:["Nov23","Mayan","Calendar","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2463,name:"Sea to Sun Totem Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:7,tags:["Nov23","Mayan","Red","Orange","Blue","Eye"]},is_available:!1,unlock:"purchase"},{id:2464,name:"Ancient Skull Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:8,tags:["Nov23","Mayan","Bone","Yellow"]},is_available:!1,unlock:"purchase"},{id:2465,name:"Snake Deity Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:9,tags:["Nov23","Mayan","Green","Snek"]},is_available:!1,unlock:"purchase"},{id:2466,name:"Raven Lord Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:10,tags:["Nov23","Mayan","Black","Nevermore","Oct24"]},is_available:!1,unlock:"purchase"},{id:2467,name:"Tepey\xf3llotl Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:11,tags:["Nov23","Mayan","Leopard","Orange","bun_mayan"]},is_available:!1,unlock:"purchase"},{id:2468,name:"Give Thanksing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:12,tags:["NovM23","Text","Thanksgiving3","Orange","Red"]},is_available:!1,unlock:"purchase"},{id:2469,name:"Football Turkey Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:13,tags:["NovM23","Thanksgiving3","Brown","Basted"]},is_available:!1,unlock:"purchase"},{id:2470,name:"Basted Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:14,tags:["NovM23","Thanksgiving3","Yellow","Text"]},is_available:!1,unlock:"purchase"},{id:2471,name:"Feast Mode Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:15,tags:["NovM23","Thanksgiving3","Red","Text"]},is_available:!1,unlock:"purchase"},{id:2472,name:"HoHoHo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:3,tags:["Dec23","Christmas3","Red","Green","Text","Dec24"]},is_available:!1,unlock:"purchase"},{id:2473,name:"Nice Egg Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:1,tags:["Dec23","Christmas3","Red","Green","Text","Dec24"]},is_available:!1,unlock:"purchase"},{id:2474,name:"Naughty Egg Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:0,tags:["Dec23","Christmas3","Pink","Purple","Text","Dec24"]},is_available:!1,unlock:"purchase"},{id:2475,name:"Big Baubles Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:2,tags:["Dec23","Christmas3","Red","Green","Dec24"]},is_available:!1,unlock:"purchase"},{id:2476,name:"New Year 2024 Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:6,tags:["NewYears","DecM23","2024","Blue","White"]},is_available:!1,unlock:"purchase"},{id:2477,name:"Out with the Old",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:4,tags:["NewYears","DecM23","2024","Blue","White","DecM24"]},is_available:!1,unlock:"purchase"},{id:2478,name:"In with the New",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:5,tags:["NewYears","DecM23","2024","Blue","White","DecM24"]},is_available:!1,unlock:"purchase"},{id:2479,name:"Yolk Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:8,tags:["JanM24","Text","Racer","Grey","Gray","Yellow"]},is_available:!0,unlock:"purchase"},{id:2480,name:"Crown Stamp",price:25e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:9,tags:["JanM24","Winner","Racer","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:2481,name:"Stop Healing Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:10,tags:["JanM24","Winner","Racer"]},is_available:!0,unlock:"purchase"},{id:2482,name:"Chinese Egg Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:11,tags:["JanM24","Purple","Yellow","Text","Racer"]},is_available:!0,unlock:"purchase"},{id:2483,name:"Pireggi Logo",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:7,tags:["JanM24","Text","Black","Pireggi"]},is_available:!0,unlock:"purchase"},{id:2484,name:"Deez Acorns",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:12,tags:["Feb24","Nuts","Nutz","Brown","NovM24"]},is_available:!1,unlock:"purchase"},{id:2485,name:"Cute Bear Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:13,tags:["Feb24","Tongue","Face","Brown"]},is_available:!1,unlock:"purchase"},{id:2486,name:"Truth or Deer Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:14,tags:["Feb24","Text","Brown"]},is_available:!1,unlock:"purchase"},{id:2487,name:"Cute Owl Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:15,tags:["Feb24","Face","Who","Brown"]},is_available:!1,unlock:"purchase"},{id:2488,name:"Cupid Squee Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:16,tags:["Feb24","Pink","Red","Face","bun_cupid"]},is_available:!1,unlock:"manual"},{id:2489,name:"Kyler Bappy",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2490,name:"Nay Moore",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2491,name:"Davey Bendem",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2492,name:"Meggy Repo",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2493,name:"Lion Messy",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2494,name:"Chris Ronald",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:16,tags:["FebM24","Player","Face","Sbros"]},is_available:!1,unlock:"purchase"},{id:2495,name:"SUUIII",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:16,tags:["FebM24","Player","Face","Blue","Sbros","Ronaldo","Apr25","premFeatTwo"]},is_available:!0,unlock:"purchase"},{id:2496,name:"Red Card!",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:16,tags:["FebM24","Foul","Penalty","Red","Sbros"]},is_available:!1,unlock:"purchase"},{id:2497,name:"Triskelion Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:16,tags:["Mar24","StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2498,name:"Negative Ward Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2499,name:"Celtic Knot Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2500,name:"Bad Bunny Patch",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:16,tags:["Mar24","Rabbit","Fur","White","bun_badbunny"]},is_available:!1,unlock:"manual"},{id:2501,name:"Triquetra Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2502,name:"Finest Emeralds",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2503,name:"Lucky Horseshoe Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:16,tags:["StPatricksDay","Irish","Celtic","Green","Gold","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:2504,name:"Gang Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:16,tags:["Clan","Mar24"]},is_available:!1,unlock:"manual"},{id:2505,name:"Wooly Beard",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:16,tags:["Future"]},is_available:!1,unlock:"manual"},{id:2506,name:"Jelly Beanz!",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:16,tags:["MarM24","Easter","Food","Rainbow","MarM25"]},is_available:!0,unlock:"purchase"},{id:2507,name:"Full of Eggs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:16,tags:["MarM24","Easter","Food","Rainbow","MarM25"]},is_available:!0,unlock:"purchase"},{id:2508,name:"Chocolate Egg",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:16,tags:["MarM24","Easter","Food","Brown","MarM25"]},is_available:!0,unlock:"purchase"},{id:2509,name:"Candy Coma Bunny Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:16,tags:["MarM24","Easter","Food","Rabbit","White","MarM25"]},is_available:!0,unlock:"purchase"},{id:2510,name:"Outta Chocolate Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:16,tags:["MarM24","Easter","Food","Rabbit","Face","Brown","MarM25"]},is_available:!0,unlock:"purchase"},{id:2511,name:"E&E stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:16,tags:["MarM24","Easter","Text","Food","Brown","MarM25"]},is_available:!0,unlock:"purchase"},{id:2512,name:"Recycled Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:16,tags:["MarM24","Default","Green","Symbol"]},is_available:!0,unlock:"default"},{id:2513,name:"Yum Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:16,tags:["MarM24","Default","Emoji","Tongue","Yellow"]},is_available:!0,unlock:"default"},{id:2514,name:"Moai Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:16,tags:["MarM24","Default","Emoji","Easter","Grey","Gray","Silver"]},is_available:!0,unlock:"default"},{id:2515,name:"Cyborg Bear Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:16,tags:["Apr24","Brown","RotR"]},is_available:!1,unlock:"purchase"},{id:2516,name:"Resistance is Futile Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:16,tags:["Apr24","Text","RotR"]},is_available:!1,unlock:"purchase"},{id:2517,name:"Cyborg Wiz Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:16,tags:["Apr24","Blue","RotR","Purple","Blurple"]},is_available:!1,unlock:"purchase"},{id:2518,name:"Cyborg Scared Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:16,tags:["Apr24","Gray","Thee_Owl","RotR","Grey","Face","Red"]},is_available:!1,unlock:"manual"},{id:2519,name:"Cyborg Angry Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:16,tags:["Apr24","Gray","Thee_Owl","RotR","Grey","Face","Red","bun_borg"]},is_available:!1,unlock:"manual"},{id:2520,name:"Rise of the Robots Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:17,tags:["Apr24","Yellow","RotR","Blue","Text","Newsletter"]},is_available:!1,unlock:"manual"},{id:2521,name:"Cut Diamond Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:17,tags:["Apr24","Blue"]},is_available:!1,unlock:"manual"},{id:2522,name:"Mecha-Nate Down Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:17,tags:["Apr24","Face","Red","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2523,name:"Mecha-Nate Up Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:17,tags:["Apr24","Face","Green","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2524,name:"Mecha-Nate Squaree Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:17,tags:["Apr24","Punchable","Face","White","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2525,name:"Mecha-Nate Creep Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:17,tags:["Apr24","Face","White","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2526,name:"Mecha-Nate Suckerguy Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:17,tags:["Apr24","Face","White","Mouth","RotR"]},is_available:!1,unlock:"manual"},{id:2527,name:"Mecha-Nate Bottle Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:17,tags:["Apr24","Alien","Green","RotR"]},is_available:!1,unlock:"manual"},{id:2528,name:"Mecha-Nate Moai Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:17,tags:["Apr24","Stone","Gray","Grey","RotR"]},is_available:!1,unlock:"manual"},{id:2529,name:"Mecha-Nate Gurfield Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:17,tags:["Apr24","Cat","Face","White","RotR"]},is_available:!1,unlock:"manual"},{id:2530,name:"Joining Forces",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:17,tags:["Apr24","Pablo","Face","Diablo","RotR"]},is_available:!1,unlock:"purchase"},{id:2531,name:"Shell Shockers Cyborged Logo",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:17,tags:["Apr24","Text","Logo","RotR"]},is_available:!1,unlock:"purchase"},{id:2532,name:"Mount Rushmore Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:17,tags:["AprM24","Pablo","Rock","Smile","Drops6"]},is_available:!1,unlock:"manual"},{id:2533,name:"Bald Meno Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:17,tags:["AprM24","Face","Drops6"]},is_available:!1,unlock:"manual"},{id:2534,name:"Oink Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:17,tags:["May24","Farm","Pink","Text","Pig"]},is_available:!1,unlock:"purchase"},{id:2535,name:"Moo Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:17,tags:["May24","Farm","Black","White","Text","Cow"]},is_available:!1,unlock:"purchase"},{id:2536,name:"Quack Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:17,tags:["May24","Farm","White","Yellow","Text","Duck"]},is_available:!1,unlock:"purchase"},{id:2537,name:"Scarecrow Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:17,tags:["May24","Farm","Face","Yellow","Brown","Badoi"]},is_available:!1,unlock:"purchase"},{id:2538,name:"Farm Life Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:17,tags:["May24","Farm","Yellow","Text","Eat","Sleep","Repeat"]},is_available:!1,unlock:"purchase"},{id:2539,name:"Farm Tools Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:17,tags:["May24","Farm","Brown","Silver","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:2540,name:"Robots Defeated Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:17,tags:["May24","Red","Black","Eye","EGGORG"]},is_available:!1,unlock:"manual"},{id:2541,name:"USDA Organic",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:1,tags:["May24","Farm","Newsletter","Text"]},is_available:!1,unlock:"manual"},{id:2542,name:"Shell Leaks Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:17,tags:["May24","Community","Egg"]},is_available:!1,unlock:"manual"},{id:2543,name:"Clucky Charms",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:17,tags:["MayM24","Rooster","Wizard","Chicken&Waffles","Blue"]},is_available:!1,unlock:"purchase"},{id:2544,name:"Toast Ghost",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:17,tags:["MayM24","Bread","White","Brown","Chicken&Waffles","OctM24"]},is_available:!1,unlock:"purchase"},{id:2545,name:"Breakfast of Champions",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:17,tags:["MayM24","Trophy","Egg","Gold","Blue","Chicken&Waffles"]},is_available:!1,unlock:"purchase"},{id:2546,name:"Caffeine Rush",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:17,tags:["MayM24","Egg","Face","White","Chicken&Waffles"]},is_available:!1,unlock:"purchase"},{id:2547,name:"Skipped Breakfast",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:17,tags:["MayM24","Chicken","Face","White","Chicken&Waffles"]},is_available:!1,unlock:"purchase"},{id:2548,name:"Chicken & Waffles",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:17,tags:["MayM24","Chicken","Face","White","Chicken&Waffles"]},is_available:!1,unlock:"purchase"},{id:2549,name:"Ant Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:17,tags:["Jun24","Eyes","Face","Brown","Bugs"]},is_available:!1,unlock:"purchase"},{id:2550,name:"Worker Bee Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:17,tags:["Jun24","Eyes","Yellow","Black","Bugs"]},is_available:!1,unlock:"purchase"},{id:2551,name:"Spider Web Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:17,tags:["Jun24","Black","Bugs","bun_arach"]},is_available:!1,unlock:"manual"},{id:2552,name:"Spider Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:17,tags:["Jun24","Eyes","Face","Red","Bugs"]},is_available:!1,unlock:"purchase"},{id:2553,name:"Grasshopper Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:18,tags:["Jun24","Eyes","Face","Blue","Bugs"]},is_available:!1,unlock:"purchase"},{id:2554,name:"Fly Eyes Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:18,tags:["Jun24","Eyes","Face","Red","Bugs"]},is_available:!1,unlock:"purchase"},{id:2555,name:"Catapiller Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:18,tags:["Jun24","Eyes","Egg","Green","Bugs"]},is_available:!1,unlock:"purchase"},{id:2556,name:"Dill With It Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:18,tags:["JunM24","Text","Pickle","Green","Blue","Food"]},is_available:!1,unlock:"purchase"},{id:2557,name:"Shell Yeah Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:18,tags:["JunM24","Text","Blue","Summer"]},is_available:!1,unlock:"purchase"},{id:2558,name:"Wiffle Ball Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:18,tags:["JunM24","Purple","Blue","Blurple","Sports"]},is_available:!1,unlock:"purchase"},{id:2559,name:"Summer Vibes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:18,tags:["JunM24","Pink","Text","Summer"]},is_available:!1,unlock:"purchase"},{id:2560,name:"SL MVP 2024+ Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:18,tags:["July24","Purple","Text","League"]},is_available:!1,unlock:"manual"},{id:2561,name:"Chess Clock Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:18,tags:["July24","Newsletter","Brown","Chess"]},is_available:!1,unlock:"manual"},{id:2562,name:"Tactical Pawns Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:18,tags:["July24","Bundle","Chess","bun_tactic"]},is_available:!1,unlock:"manual"},{id:2563,name:"Magnus Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:18,tags:["July24","Face","Chess","Black"]},is_available:!1,unlock:"purchase"},{id:2564,name:"Checkmate Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:18,tags:["July24","Text","Chess"]},is_available:!1,unlock:"purchase"},{id:2565,name:"Short King",price:5800,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:18,tags:["July24","Text","Chess","Wizups"]},is_available:!1,unlock:"purchase"},{id:2566,name:"Knight Moves",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:18,tags:["July24","Text","Chess","Night"]},is_available:!1,unlock:"purchase"},{id:2567,name:"Botez Gambit",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:18,tags:["July24","Text","Chess","Sacrifice"]},is_available:!1,unlock:"purchase"},{id:2568,name:"Time Varience Face",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:18,tags:["JulyM24","Face","Clock","Minutes"]},is_available:!1,unlock:"purchase"},{id:2569,name:"Deadpond Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:18,tags:["JulyM24","Face","Black","Eyes"]},is_available:!1,unlock:"purchase"},{id:2570,name:"Claw Slash Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:18,tags:["JulyM24","Claws","Wolverine","X","Eggx-men"]},is_available:!1,unlock:"purchase"},{id:2571,name:"Eggx-Men Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:18,tags:["JulyM24","Text","Logo","X","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2572,name:"Maximum Effort Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:18,tags:["JulyM24","Text","Deadpond","Deadpool","Red","Face"]},is_available:!1,unlock:"purchase"},{id:2573,name:"Take me to your Leader",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:18,tags:["Aug24","Text","Alien","Galeggsy","White","Yellow","bun_zorg"]},is_available:!1,unlock:"manual"},{id:2574,name:"Peeking Alien Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:18,tags:["Aug24","Eyes","Egg","White","Green"]},is_available:!1,unlock:"purchase"},{id:2575,name:"Three eyes Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:18,tags:["Aug24","Eyes","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2576,name:"Gray Space Alien Face",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:18,tags:["Aug24","Eyes","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2577,name:"Alien Side Eye",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:18,tags:["Aug24","Eyes","Green","Newsletter"]},is_available:!1,unlock:"manual"},{id:2578,name:"Eggventure Jeep Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:18,tags:["AugM24","White","Kart"]},is_available:!1,unlock:"purchase"},{id:2579,name:"Dino Derby Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:18,tags:["AugM24","White","Kart","Text","Logo"]},is_available:!1,unlock:"purchase"},{id:2580,name:"Gryffinhatch House",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:18,tags:["Sep24","EggyP","Orange"]},is_available:!1,unlock:"purchase"},{id:2581,name:"Ravencluck House",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:18,tags:["Sep24","EggyP","Blue"]},is_available:!1,unlock:"purchase"},{id:2582,name:"Slytheregg House",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:18,tags:["Sep24","EggyP","Green"]},is_available:!1,unlock:"purchase"},{id:2583,name:"Hugglepeck House",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:18,tags:["Sep24","EggyP","Yellow"]},is_available:!1,unlock:"purchase"},{id:2584,name:"Shellshriek Face",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:18,tags:["Sep24","EggyP","Eyes","Teeth","bun_plant"]},is_available:!1,unlock:"manual"},{id:2585,name:"Platform 9 3/4 Stamp",price:9340,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:19,tags:["Sep24","EggyP","Text","Red","White"]},is_available:!1,unlock:"purchase"},{id:2586,name:"Pixel Football Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:19,tags:["SepM24","Fbros","Brown"]},is_available:!1,unlock:"purchase"},{id:2587,name:"Football Bros Logo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:19,tags:["SepM24","Fbros","Text","Red"]},is_available:!1,unlock:"purchase"},{id:2588,name:"Quarterback Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:19,tags:["SepM24","Fbros","Red","Football"]},is_available:!1,unlock:"purchase"},{id:2589,name:"Neon Chicken Breast",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:19,tags:["Oct24","Halloween5","Bones","Purple"]},is_available:!1,unlock:"purchase"},{id:2590,name:"Flock of the Damned",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:19,tags:["Oct24","Halloween5","Text","Wings","Silver","Grey","Gray","Red"]},is_available:!1,unlock:"purchase"},{id:2591,name:"Zombozo",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:19,tags:["Oct24","Halloween5","Brown","White","Beak","Eye"]},is_available:!1,unlock:"purchase"},{id:2592,name:"Dovely face",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:19,tags:["Oct24","Halloween5","Brown","White","Beak","Eye","bun_dove"]},is_available:!1,unlock:"manual"},{id:2593,name:"Eggar Allen Poe",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:19,tags:["OctM24","Halloween5","Face","Black"]},is_available:!1,unlock:"purchase"},{id:2594,name:"Shellraiser Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:19,tags:["OctM24","Halloween5","Text","Red"]},is_available:!1,unlock:"purchase"},{id:2595,name:"Peek-a-BOO Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:19,tags:["OctM24","Halloween5","Text","Orange"]},is_available:!1,unlock:"purchase"},{id:2596,name:"Trigger Warning Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:19,tags:["Nov24","SC2","Text","Red","Newsletter"]},is_available:!1,unlock:"manual"},{id:2597,name:"Killer Fridge Faded Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:19,tags:["Nov24","SC2","Face","Red"]},is_available:!1,unlock:"purchase"},{id:2598,name:"Damaged Target Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:19,tags:["Nov24","SC2","Yellow","Black","Yolk"]},is_available:!1,unlock:"purchase"},{id:2599,name:"Swamp Thing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:19,tags:["Nov24","SC2","Face","Green"]},is_available:!1,unlock:"purchase"},{id:2600,name:"Now on Steam Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:19,tags:["Nov24","SC2","Text","Black","Logo","Gear"]},is_available:!1,unlock:"manual"},{id:2601,name:"Mad Mouth Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:19,tags:["Nov24","SC2","Teeth","Black","White","Red"]},is_available:!1,unlock:"purchase"},{id:2602,name:"Slayaway Camp 2 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:19,tags:["Nov24","SC2","Logo","Text","Black","Red"]},is_available:!1,unlock:"purchase"},{id:2603,name:"Killer Fridge Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:19,tags:["Nov24","SC2","Face","Red"]},is_available:!1,unlock:"purchase"},{id:2604,name:"Terrortube Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:19,tags:["Nov24","SC2","Text","Red"]},is_available:!1,unlock:"purchase"},{id:2605,name:"Honey Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:19,tags:["NovM24","Thanksgiving4","Food","Yellow"]},is_available:!1,unlock:"purchase"},{id:2606,name:"Jam Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:19,tags:["NovM24","Thanksgiving4","Food","Red"]},is_available:!1,unlock:"purchase"},{id:2607,name:"Gnome Gnose Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:19,tags:["Dec24","Christmas4","White","Pink"]},is_available:!1,unlock:"purchase"},{id:2608,name:"Sleigh Me Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:19,tags:["Dec24","Thanksgiving4","Text","Blue"]},is_available:!1,unlock:"purchase"},{id:2609,name:"LCC stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:19,tags:["League","Community","Text","Black"]},is_available:!1,unlock:"manual"},{id:2610,name:"New Year 2025 Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:19,tags:["NewYears","DecM24","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:2611,name:"Algebruh Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:19,tags:["JanM25","Red","Green"]},is_available:!1,unlock:"purchase"},{id:2612,name:"Fractal Target Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:19,tags:["JanM25","Blue"]},is_available:!1,unlock:"purchase"},{id:2613,name:"Perfectly Balanced Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:19,tags:["JanM25","Black"]},is_available:!1,unlock:"purchase"},{id:2614,name:"I love Feesh Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:19,tags:["Feb25","Pink","Fish","Blue"]},is_available:!1,unlock:"purchase"},{id:2615,name:"I'm Hooked Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:19,tags:["Feb25","Green","Fish","Newsletter"]},is_available:!1,unlock:"manual"},{id:2616,name:"Swedish Fish Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:19,tags:["Feb25","Sweet","Red","Fish","Candy"]},is_available:!1,unlock:"purchase"},{id:2617,name:"Heart Shaped Box Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:20,tags:["Feb25","Sweet","Red","White","Candy"]},is_available:!1,unlock:"purchase"},{id:2618,name:"Zaxonius Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:20,tags:["FebM25","Drops7","D7W2","Pink","Purple"]},is_available:!1,unlock:"manual"},{id:2619,name:"The Pixel Fox",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:20,tags:["FebM25","Drops7","Orange","Eye"]},is_available:!1,unlock:"purchase"},{id:2620,name:"PLANS Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:20,tags:["FebM25","Drops7","D7W1","Egg","White","Black"]},is_available:!1,unlock:"manual"},{id:2621,name:"Angry Snipes Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:20,tags:["FebM25","Drops7","Blue","Crackshot"]},is_available:!1,unlock:"purchase"},{id:2622,name:"Grotesque Grin Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:20,tags:["FebM25","Drops7","D7W1","Face","Black"]},is_available:!1,unlock:"manual"},{id:2623,name:"Grotesque Grief Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:20,tags:["FebM25","Drops7","D7W2","Face","Black"]},is_available:!1,unlock:"manual"},{id:2624,name:"#Blame Harrison",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:20,tags:["FebM25","Drops7","D7W2","Face","Black"]},is_available:!1,unlock:"purchase"},{id:2625,name:"Shamrocked Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:20,tags:["Mar25","StPatricksDay","Clover","Green"]},is_available:!0,unlock:"purchase"},{id:2627,name:"Easter Island",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:20,tags:["MarM25","Text","Orange"]},is_available:!0,unlock:"purchase"},{id:2628,name:"Dwarf #8",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:20,tags:["MarM25","Snow","White","Tipsy"]},is_available:!0,unlock:"purchase"},{id:3100,name:"The Eggk-47",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47",tags:["default","Blue","Purple"]},is_available:!0,unlock:"default"},{id:3101,name:"GOLD Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3102,name:"Happy Bear Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3103,name:"Halloween Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3104,name:"Thanksgiving Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3105,name:"Christmas Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3106,name:"2019 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3107,name:"Groundhog Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3108,name:"Buck Rogers Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3109,name:"Valentines Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3110,name:"St Patricks Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3111,name:"Easter Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Easter",tags:["Easter","Red","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3112,name:"Flame Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3113,name:"Rainbow Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3114,name:"Steampunk Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3115,name:"Memphis Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Memphis",tags:["Memphis","Blue","Orange","Purple"]},is_available:!0,unlock:"purchase"},{id:3116,name:"Eggwalker Eggk-47",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3117,name:"Nuke Zone Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NukeZone",tags:["NukeZone","Black","Neon","Pink"]},is_available:!0,unlock:"purchase"},{id:3118,name:"2020 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3119,name:"Country Singer Eggk-47",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3120,name:"Albino Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3121,name:"Raid Land Eggk-47",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_RaidLand",tags:["RaidLand","Blue","Black"]},is_available:!1,unlock:"purchase"},{id:3122,name:"Toxic Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3123,name:"Music Eggk-47",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Music",tags:["Rockstar","JanM23","Black","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3124,name:"Galeggsy Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3125,name:"Chicken Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3126,name:"Techno Eggk-47",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Techno",tags:["Dec23","Blue","Yellow","Black","Pog","DecM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["gun_eggk47_techno"]},{id:3127,name:"2021 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3128,name:"Car Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_car",tags:["Cars","Trains","Blue"]},is_available:!0,unlock:"purchase"},{id:3129,name:"Merc Zone Eggk-47",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Merc",tags:["Merc","Suit","Black","Tie","Blue"]},is_available:!0,unlock:"purchase"},{id:3130,name:"Summer Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3131,name:"Pencil Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Pencil",tags:["Pencil","Sep23","Yellow","Sep24"]},is_available:!1,unlock:"purchase"},{id:3132,name:"2022 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3133,name:"Cards Eggk-47",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3134,name:"Retro Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Retro",tags:["Retro","Pixel","FebM23","Blue","Purple","Wings","DecM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_ak_retro"]},{id:3135,name:"Dino Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Dino",tags:["Dino","May23","Red","Brown","AugM24"]},is_available:!1,unlock:"purchase"},{id:3136,name:"Valkyrie Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_ak_valkyrie"]},{id:3137,name:"Eggwalker Alt Eggk-47",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:3138,name:"SPORTS Eggk-47",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Sports",tags:["Sports","JulyM23","Brown","Orange","Cricket","Bat","JunM24"]},is_available:!1,unlock:"purchase"},{id:3139,name:"Breakfast Eggk-47",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Breakfast",tags:["Breakfast","Food","Brown","Syrup","Waffles","MayM24"]},is_available:!1,unlock:"purchase"},{id:3140,name:"2023 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3141,name:"Farm Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Farm",tags:["Farm","FebM23","Food","Orange","Green","Carrot","May24"]},is_available:!1,unlock:"purchase"},{id:3142,name:"Fusion Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Fusion",tags:["Premium","fusion","FebM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak47_fusion"]},{id:3143,name:"Hero Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Fantasy",tags:["Heroes","Apr23","Sword","Silver"]},is_available:!1,unlock:"purchase"},{id:3144,name:"Monster Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_FantasyEvil",tags:["Monsters","Apr23","Purple","Sword"]},is_available:!1,unlock:"purchase"},{id:3145,name:"Equinox Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3146,name:"Paintball Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Paintball",tags:["Sports2","JulyM23","Grey","Gray","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:3147,name:"Kart Eggk-47",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Kart",tags:["Kart","Aug23","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3148,name:"BWD Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Wizard",tags:["Drops5","AugM23","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3149,name:"Infernal Eggk-47",price:4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Infernal",tags:["OctM23","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak_infernal"]},{id:3150,name:"Ancient Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3151,name:"Holideggs Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3152,name:"2024 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!1,unlock:"purchase"},{id:3153,name:"Racer Eggk-47",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3154,name:"Chocolate Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Chocolate",tags:["MarM24","Brown","Gold","premFeatOne","MarM25"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak_choc"]},{id:3155,name:"Mecha-Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Steambot",tags:["Apr24","Brown","Gold","Premium"]},is_available:!1,unlock:"premium"},{id:3156,name:"MenoXD Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Meno",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:3157,name:"Alien Eggk-47",price:5e5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Alien",tags:["Aug24","Perm","Premium","eggyp"]},is_available:!0,unlock:"purchase"},{id:3158,name:"Spore Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3159,name:"2025 Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2025",tags:["NewYears","DecM24","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3160,name:"Sleigh Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Christmas",tags:["Newsletter","Gift","DecM24","Gold","Red"]},is_available:!1,unlock:"manual"},{id:3161,name:"Golden Dragon Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_dragongold",tags:["EGGORG","Shadows","Apr25","Gold"]},is_available:!0,unlock:"purchase"},{id:3400,name:"The Free Ranger",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1",tags:["default","Orange","Green","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3401,name:"GOLD Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3402,name:"Happy Bear Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3403,name:"Halloween Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3404,name:"Thanksgiving Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3405,name:"Christmas Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3406,name:"2019 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3407,name:"Groundhog Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3408,name:"Buck Rogers Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3409,name:"Valentines Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3410,name:"St Patricks Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3411,name:"Easter Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Easter",tags:["Easter","Blue","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3412,name:"Flame Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3413,name:"Rainbow Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3414,name:"Steampunk Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3415,name:"Memphis Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Memphis",tags:["Memphis","Blue","Orange","Purple"]},is_available:!0,unlock:"purchase"},{id:3416,name:"Eggwalker Free Ranger",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_spaceEgg",tags:["sale","Eggwalker","July23","Black","Grey","Gray","Yellow","MarM24","Welcome","Bundle"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_csg1_space"]},{id:3417,name:"Nuke Zone Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NukeZone",tags:["NukeZone","Yellow","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:3418,name:"2020 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3419,name:"Country Singer Free Ranger",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3420,name:"Albino Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3421,name:"Raid Land Free Ranger",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RaidLand",tags:["RaidLand","Blue","Yellow","Brown","Wings"]},is_available:!1,unlock:"purchase"},{id:3422,name:"Toxic Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3423,name:"Music Free Ranger",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Music",tags:["Rockstar","JanM23","Black","Guitar","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3424,name:"Galeggsy Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3425,name:"Chicken Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3426,name:"Techno Free Ranger",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Techno",tags:["Premium","Techno","Cats","Catz","Purple","Yellow","Black","AprM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_csg1_techno"]},{id:3427,name:"2021 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3428,name:"Car Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_car",tags:["Cars","Trains","Red","Firetruck"]},is_available:!0,unlock:"purchase"},{id:3429,name:"Merc Zone Free Ranger",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Merc",tags:["Merc","Suit","Black","Tie","Yellow"]},is_available:!0,unlock:"purchase"},{id:3430,name:"Summer Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3431,name:"Retro Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Retro",tags:["Retro","Premium","Pixel","Green","Wings","JanM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_csg1_retro"]},{id:3432,name:"Pencil Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Pencil",tags:["Pencil","Sep23","Yellow","Paintbrush","Sep24"]},is_available:!1,unlock:"purchase"},{id:3433,name:"2022 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3434,name:"BWD Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Wizard",tags:["Drops","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3435,name:"Cards Free Ranger",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3436,name:"Dino Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Dino",tags:["Dino","May23","Green","Orange","AugM24"]},is_available:!1,unlock:"purchase"},{id:3437,name:"Eggpire Free Ranger",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3438,name:"SPORTS Free Ranger",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Sports",tags:["Sports","JulyM23","Brown","White","Baseball","JunM24"]},is_available:!1,unlock:"purchase"},{id:3439,name:"Rubber Chicken Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RubberChicken",tags:["Aug23","Yellow","MayM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_csg1_rubchick"]},{id:3440,name:"Breakfast Free Ranger",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Breakfast",tags:["Breakfast","Food","Toast","Brown","Eggs","Bread","MayM24"]},is_available:!1,unlock:"purchase"},{id:3441,name:"Valkyrie Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Valkyrie",tags:["Valkyrie","Premium","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_range_valk"]},{id:3442,name:"2023 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3443,name:"Fusion Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Fusion",tags:["Premium","JanM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_csg1_fusion"]},{id:3444,name:"Farm Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Farm",tags:["Farm","FebM23","Food","Yellow","Green","Corn","May24","NovM24"]},is_available:!1,unlock:"purchase"},{id:3445,name:"Shellpreme Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Shellpreme",tags:["MayM23","Eggflation","Premium","Red","Sep24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_csg1_shellpreme"]},{id:3446,name:"Equinox Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3447,name:"Kart Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Kart",tags:["Aug23","Kart","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:3448,name:"lifeofnurse Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Nurse",tags:["AugM23","Drops5","Blue","Purple","Heart"]},is_available:!1,unlock:"manual"},{id:3449,name:"Bone Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bones",tags:["OctM23","Halloween4","Bone","White","Oct24"]},is_available:!1,unlock:"purchase"},{id:3450,name:"Ancient Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3451,name:"Holideggs Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3452,name:"2024 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:3453,name:"Sleigh Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Christmas",tags:["DecM23","Newsletter","Gold","Green","Red"]},is_available:!0,unlock:"manual"},{id:3454,name:"Racer Free Ranger",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3455,name:"Infernal Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Infernal",tags:["JanM24","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_csg1_infernal"]},{id:3456,name:"Mecha-Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Steambot",tags:["JanM24","RotR","Orange","Apr24","Premium"]},is_available:!1,unlock:"premium"},{id:3457,name:"Grasshopper Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bugs",tags:["Jun24","Bugs","Green"]},is_available:!1,unlock:"purchase"},{id:3458,name:"Spore Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3459,name:"2025 Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2025",tags:["DecM24","New Years","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3460,name:"Green Snake Free Ranger",price:15e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SnakePatrick",tags:["Mar25","StPatricksday","Green","White","Yellow","Mar25"]},is_available:!0,unlock:"purchase"},{id:3461,name:"Golden Dragon Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:3600,name:"The Scrambler",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge",tags:["default","Orange","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3601,name:"GOLD Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3602,name:"Happy Bear Scrambler ",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3603,name:"Halloween Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3604,name:"Thanksgiving Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3605,name:"Christmas Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3606,name:"2019 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3607,name:"Groundhog Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3608,name:"Buck Rogers Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3609,name:"Valentines Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3610,name:"St Patricks Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3611,name:"Easter Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Easter",tags:["Easter","Yellow","Green","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3612,name:"Flame Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3613,name:"Rainbow Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3614,name:"Steampunk Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3615,name:"Memphis Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Memphis",tags:["Memphis","Yellow","Green","Black","White"]},is_available:!0,unlock:"purchase"},{id:3616,name:"Eggwalker Scrambler",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3617,name:"Nuke Zone Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NukeZone",tags:["NukeZone","Black","Blue","Neon"]},is_available:!0,unlock:"purchase"},{id:3618,name:"2020 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3619,name:"Country Singer Scrambler",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3620,name:"Albino Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3621,name:"Raid Land Scrambler",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_RaidLand",tags:["RaidLand","Brown","White"]},is_available:!1,unlock:"purchase"},{id:3622,name:"Toxic Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3623,name:"Music Scrambler",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Music",tags:["Rockstar","JanM23","Red","Gold","Guitar","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3624,name:"Galeggsy Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3625,name:"Killstreak Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Killstreak",tags:["Killstreak","Smile","Yellow","Brown","Blue"]},is_available:!1,unlock:"manual"},{id:3626,name:"Chicken Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3627,name:"Techno Scrambler",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Techno",tags:["Techno","premium","SepM23","Badoosh","Red","Purple","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["gun_gauge_techno"]},{id:3628,name:"2021 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3629,name:"Car Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_car",tags:["Cars","Trains","Yellow"]},is_available:!0,unlock:"purchase"},{id:3630,name:"Merc Zone Scrambler",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Merc",tags:["Merc","Suit","Black","Tie","Orange"]},is_available:!0,unlock:"purchase"},{id:3631,name:"Summer Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3632,name:"Pencil Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Pencil",tags:["Pencil","Sep23","Highlighter","Sep24"]},is_available:!1,unlock:"purchase"},{id:3633,name:"BWD Fan-art Scrambler",price:15e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_BWD",tags:["Kids","Wizard","Blue","Rainbow"]},is_available:!0,unlock:"purchase"},{id:3634,name:"Retro Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Retro",tags:["Retro","Premium","Pixel","Grey","Gray","Orange","Wings","Mar24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_crack_retro"]},{id:3635,name:"2022 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3636,name:"Thee_Owl Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_TheeOwl",tags:["Relic","Drops2","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3637,name:"Basket Bros Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Basketball",tags:["BBros","JulyM23","Orange","Hoops","FebM24","JunM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_bros"]},{id:3638,name:"Cards Scrambler",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3639,name:"JWBerry3D Scrambler",price:75e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_JWBerry",tags:["Relic","Black","Red","Glasses"]},is_available:!0,unlock:"purchase"},{id:3640,name:"Dino Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Dino",tags:["Dino","May23","Blue","AugM24"]},is_available:!1,unlock:"purchase"},{id:3641,name:"Eggpire Scrambler",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3642,name:"Valkyrie Scrambler",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Valkyrie",tags:["Eggwalker2","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_valk"]},{id:3643,name:"SPORTS Scrambler",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Sports",tags:["Sports","JulyM23","Black","White","Green","Soccer","Football","FebM24","JunM24"]},is_available:!1,unlock:"purchase"},{id:3644,name:"Breakfast Scrambler",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Breakfast",tags:["Breakfast","Food","Red","Ketchup","MayM24"]},is_available:!1,unlock:"purchase"},{id:3645,name:"Sharkbucks Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Sharkbucks",tags:["Sep22","Drops3","Blue","Smile"]},is_available:!1,unlock:"manual"},{id:3646,name:"Kilzomatic Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Kilzomatic",tags:["Sep22","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:3647,name:"Badegg Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Badegg",tags:["Badegg","Red","Yellow","DecM23"]},is_available:!1,unlock:"purchase"},{id:3648,name:"2023 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3649,name:"Sleigh Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Christmas",tags:["Christmas2","Newsletter","Red","White","Gold","Sleigh"]},is_available:!0,unlock:"manual"},{id:3650,name:"Octopus Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Octopus",tags:["JanM23","Oct23","Blue","Pink"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gauge_octopus"]},{id:3651,name:"Farm Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Farm",tags:["Farm","FebM23","Yellow","Gold","Wheat","May24"]},is_available:!1,unlock:"purchase"},{id:3652,name:"BWD Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Wizard",tags:["Drops4","Mar23","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3653,name:"Green Snake Scrambler",price:15e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SnakePatrick",tags:["Mar23","StPatricksDay","Snek","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3654,name:"Beholder Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Fantasy",tags:["Monsters","Apr23","Purple","Yellow","Eyes","Apr24","Apr25","premFeatTwo"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_monster"]},{id:3655,name:"Fusion Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Fusion",tags:["Premium","MidM23","Fusion","White","Blue","Grey","Gray","bun_zorg"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_fusion"]},{id:3656,name:"Equinox Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3657,name:"Kart Scrambler",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Kart",tags:["Aug23","Kart","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3658,name:"Ancient Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3659,name:"Holideggs Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3660,name:"2024 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2024",tags:["DecM23","2024","NewYears","White","Blue"]},is_available:!1,unlock:"purchase"},{id:3661,name:"Racer Scrambler",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3662,name:"Cloudkicker Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Clouds",tags:["Feb24","Clouds","White","Rainbow","Feb25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gauge_cloud"]},{id:3663,name:"Irish Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Irish",tags:["Mar24","StPatricksDay","Green","Gold","Mar24","Mar25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gauge_irish"]},{id:3664,name:"Mecha-Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Steambot",tags:["Apr24","RotR","Premium"]},is_available:!1,unlock:"premium"},{id:3665,name:"Infernal Scrambler",price:4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Infernal",tags:["JulyM24","Infernal","Premium","Red","Orange","Black"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_infernal"]},{id:3666,name:"Bone Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Bones",tags:["OctM24","Halloween5"]},is_available:!1,unlock:"purchase"},{id:3667,name:"Spore Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3668,name:"2025 Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3669,name:"Golden Dragon Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:3e3,name:"The Cluck 9mm",price:0,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm",tags:["Red","Grey","Gray","Silver"]},is_available:!0,unlock:"default"},{id:3001,name:"GOLD Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3002,name:"Happy Bear Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3003,name:"Halloween Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3004,name:"Thanksgiving Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3005,name:"Christmas Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3006,name:"2019 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3007,name:"Groundhog Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3008,name:"Buck Rogers Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Buck",tags:["Promotional","Gray","Grey","Silver"]},is_available:!1,unlock:"manual"},{id:3009,name:"Valentines Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3010,name:"St Patricks Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3011,name:"Easter Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Easter",tags:["Easter","Pink","Blue","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3012,name:"Flame Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3013,name:"Rainbow Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3014,name:"Steampunk Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3015,name:"Memphis Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Memphis",tags:["Memphis","White","Black","Pink"]},is_available:!0,unlock:"purchase"},{id:3016,name:"Eggwalker Cluck 9mm",price:4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_space"]},{id:3017,name:"Nuke Zone Skin Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NukeZone",tags:["NukeZone","Yellow","Black","Neon"]},is_available:!1,unlock:"manual"},{id:3018,name:"2020 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3019,name:"Country Singer Cluck 9mm",price:1e5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3020,name:"Albino Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_SnakeAlbino",tags:["EggyCashAlbino","Snek","White","Gray","Grey","Red","ABHS"]},is_available:!1,unlock:"manual"},{id:3021,name:"Raid Land Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_RaidLand",tags:["RaidLand","Newsletter","Rabbit","Wabbit","Heart","Green","Brown","bun_badbunny"]},is_available:!1,unlock:"manual"},{id:3022,name:"Toxic Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3023,name:"Music Cluck 9mm",price:8e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Music",tags:["Rockstar","JanM23","Grey","Gray","Harmonica","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3024,name:"Galeggsy Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3025,name:"Techno Cluck 9mm",price:10,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Techno",tags:["AprM23","Red","Orange","Yellow","Pop","Black","SepM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_techno"]},{id:3026,name:"Cubic Castles Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_CubicCastles",tags:["CubicCastles","White","Black","Red","Skull"]},is_available:!1,unlock:"manual"},{id:3027,name:"Chicken Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3028,name:"2021 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3029,name:"Retro Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Retro",tags:["Retro","Premium","Pixel","Red","Gray","Grey","Silver","Wings","OctM23","bun_gamer"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_retro_9mm"]},{id:3030,name:"Car Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_car",tags:["Cars","Trains","Red"]},is_available:!0,unlock:"purchase"},{id:3031,name:"Merc Zone Cluck 9mm",price:7e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Merc",tags:["Merc","Suit","Black","Tie","Red"]},is_available:!0,unlock:"purchase"},{id:3032,name:"Summer Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3033,name:"Lyerpald Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_lyerpald",tags:["Dog","Grey","Gray","Purple"]},is_available:!0,unlock:"purchase"},{id:3034,name:"Pencil Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Pencil",tags:["Pencil","Sep23","Orange","Yellow","Sep24"]},is_available:!1,unlock:"purchase"},{id:3035,name:"Devilish Cluck 9mm",price:15e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Devilish",tags:["Kids","Red","Black","Purple","Fork","bun_demon"]},is_available:!0,unlock:"purchase"},{id:3036,name:"Bone Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bones",tags:["Halloween2","Oct23","Oct24","bun_dove"]},is_available:!1,unlock:"purchase"},{id:3037,name:"2022 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3038,name:"Sleigh Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Christmas",tags:["Christmas2","Newsletter","Red","Yellow","Green","Gold","Sleigh"]},is_available:!1,unlock:"manual"},{id:3039,name:"Cards Cluck 9mm",price:1520,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Cards",tags:["EGGORG","Apr23","Aug24"]},is_available:!1,unlock:"purchase"},{id:3040,name:"BWD Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Wizard",tags:["Relic","Drops2","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3041,name:"Dino Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Dino",tags:["Dino","May23","Brown","Yellow","AugM24"]},is_available:!1,unlock:"purchase"},{id:3042,name:"Eggpire Cluck 9mm",price:12500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3043,name:"SPORTS Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Sports",tags:["Sports","JulyM23","White","Bowling","Pin","JunM24"]},is_available:!1,unlock:"purchase"},{id:3044,name:"Breakfast Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Breakfast",tags:["Breakfast","Food","Apple","Juice","Red","MayM24"]},is_available:!1,unlock:"purchase"},{id:3045,name:"Valkyrie Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Valkyrie",tags:["Scavenger","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_valk"]},{id:3046,name:"Protractor Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Protractor",tags:["Pencil2","Sep23","Grey","Gray","Black"]},is_available:!1,unlock:"purchase"},{id:3047,name:"Badegg Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Badegg",tags:["Badegg","Yellow"]},is_available:!1,unlock:"purchase"},{id:3048,name:"2023 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3049,name:"Aquarius Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Aquarius",tags:["Groundhog","Feb23","Blue","Stars","Feb25"]},is_available:!1,unlock:"purchase"},{id:3050,name:"Cloudkicker Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Clouds",tags:["Premium","Feb23","Clouds","Rainbow","White","Feb24","Feb25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_9mm_cloud"]},{id:3051,name:"Farm Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Farm",tags:["Farm","FebM23","Food","Red","Tomato","May24"]},is_available:!1,unlock:"purchase"},{id:3052,name:"Thee_Owl Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_TheeOwl",tags:["Drops4","Mar23","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3053,name:"Merc Zone Final Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_MercF",tags:["Merc","Suit","Black","Tie"]},is_available:!1,unlock:"manual"},{id:3054,name:"Fusion Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Fusion",tags:["Premium","AprM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_9mm_fusion"]},{id:3055,name:"Caught in 4k Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Camera",tags:["Jun23","Photo","Smile","Meme","FebM24","DecM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_9mm_camera"]},{id:3056,name:"Equinox Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3057,name:"Kart Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Kart",tags:["Aug23","Kart","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:3058,name:"Infernal Cluck 9mm",price:4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Infernal",tags:["MarM24","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_9mm_infernal"]},{id:3059,name:"Megaphone Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Megaphone",tags:["Sep23","Red","White","FebM24","bun_tactic"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_9mm_mega"]},{id:3060,name:"Mouse Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Mouse",tags:["Sep23","Grey","Gray","Yellow","Cheese","bun_cat"]},is_available:!1,unlock:"manual"},{id:3061,name:"Ancient Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3062,name:"Holideggs Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3063,name:"2024 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:3064,name:"Racer Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3065,name:"Soccer Bros Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Soccer",tags:["FebM24","Sbros","Sports","Ball","Black","White"]},is_available:!1,unlock:"purchase"},{id:3066,name:"Mecha-Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Steambot",tags:["Apr24","RotR","Robots","Premium"]},is_available:!1,unlock:"premium"},{id:3067,name:"Stinkbug Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bugs",tags:["Jun24","Bugs","Brown"]},is_available:!1,unlock:"purchase"},{id:3068,name:"Spore Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3069,name:"2025 Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3070,name:"Frostfall 9mm",price:3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Frostfall",tags:["MarM25","Permanent","Blue","White"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_9mm_frost"]},{id:3071,name:"Golden Dragon 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_dragongold",tags:["Apr25","EGGORG","Shadows","Yellow","Gold"]},is_available:!0,unlock:"purchase"},{id:3800,name:"The RPEGG",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg",tags:["default","Yellow","Green","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3801,name:"GOLD RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3802,name:"Happy Bear RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3804,name:"Thanksgiving RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:3805,name:"Christmas RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:3806,name:"2019 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3807,name:"Groundhog RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:3808,name:"Buck Rogers RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3809,name:"Valentines RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:3810,name:"St Patricks RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3811,name:"Easter RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Easter",tags:["Easter","Orange","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:3812,name:"Flame RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3813,name:"Rainbow RPEGG",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3814,name:"Steampunk RPEGG",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3815,name:"Memphis RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Memphis",tags:["Memphis","Black","White"]},is_available:!0,unlock:"purchase"},{id:3816,name:"Halloween Skin RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:3817,name:"Eggwalker RPEGG",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3818,name:"Nuke Zone RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NukeZone",tags:["NukeZone","Black","Green","Neon"]},is_available:!0,unlock:"purchase"},{id:3819,name:"2020 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3820,name:"Country Singer RPEGG",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3821,name:"Albino RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3822,name:"Raid Lands RPEGG",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_RaidLand",tags:["RaidLand","Silver","Grey","Gray","Green"]},is_available:!1,unlock:"purchase"},{id:3823,name:"Toxic RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3824,name:"Music RPEGG",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Music",tags:["Rockstar","JanM23","Yellow","Gold","Tuba","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:3825,name:"Galeggsy RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:3826,name:"Chicken RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:3827,name:"2021 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3828,name:"Techno RPEGG",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Techno",tags:["Techno","Premium","JunM23","Yeet","Rainbow","Red","Yellow","Green","Blue","Purple"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_rpeggTechno"]},{id:3829,name:"Car RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_car",tags:["Cars","Trains","Silver"]},is_available:!0,unlock:"purchase"},{id:3830,name:"Merc Zone RPEGG",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Merc",tags:["Merc","Suit","Black","Tie","Green"]},is_available:!0,unlock:"purchase"},{id:3831,name:"Summer RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:3832,name:"Pencil RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Pencil",tags:["Pencil","Sep23","Yellow","Tape","Sep24"]},is_available:!1,unlock:"purchase"},{id:3833,name:"Bone RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bones",tags:["Halloween2","Oct23","Oct24"]},is_available:!1,unlock:"purchase"},{id:3834,name:"2022 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3835,name:"Retro RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Retro",tags:["Retro","Premium","Pixel","Mar23","Green","Wings","July24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_rpegg_retro"]},{id:3836,name:"Cards RPEGG",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3837,name:"Dino RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Dino",tags:["Dino","May23","Orange","AugM24"]},is_available:!1,unlock:"purchase"},{id:3838,name:"Eggpire RPEGG",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3839,name:"SPORTS RPEGG",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Sports",tags:["Sports","JulyM23","Brown","Football","JunM24","Fbros","SepM24"]},is_available:!1,unlock:"purchase"},{id:3840,name:"Breakfast RPEGG",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Breakfast",tags:["Breakfast","Food","Sausage","MayM24"]},is_available:!1,unlock:"purchase"},{id:3841,name:"Scavenger RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Scavenger",tags:["Scavenger","Black","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:3842,name:"Egg Carton RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Eggs",tags:["Sep22","Drops3","Purple","Grey","Gray","Food"]},is_available:!1,unlock:"manual"},{id:3843,name:"Valkyrie RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Valkyrie",tags:["Valkyrie","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_rpegg_valk"]},{id:3844,name:"Missile Toe RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Christmas",tags:["Christmas2","Premium","Red","White","Hohoho","bun_mistle","Dec24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_rpegg_christ"]},{id:3845,name:"2023 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3846,name:"Farm RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Farm",tags:["Farm","FebM23","Barn","Red","May24"]},is_available:!1,unlock:"purchase"},{id:3947,name:"Equinox RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:3948,name:"MenoXD RPEGG",price:75e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Meno",tags:["JulyM23","Red","Black","xd"]},is_available:!0,unlock:"purchase"},{id:3949,name:"Kart RPEGG",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Kart",tags:["Kart","Aug23","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3950,name:"Thee_Owl RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_TheeOwl",tags:["Drops5","AugM23","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3951,name:"Fusion RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Fusion",tags:["Oct23","Premium","Blue","White","Gray","Grey","bun_borg"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_rpegg_fusion"]},{id:3952,name:"Skellington RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Skeleton",tags:["OctM23","Premium","Black","White","Oct24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_rpegg_skele"]},{id:3953,name:"Ancient RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3954,name:"Holideggs RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3955,name:"2024 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:3956,name:"Racer RPEGG",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3687,name:"Broken item - do not use",price:5e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Pickles",tags:["JunM24","Food","Green","Nobby"]},is_available:!1,unlock:"purchase"},{id:3957,name:"Chubby Pickle RPEGG",price:5e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Pickles",tags:["JunM24","Food","Green","Nobby"]},is_available:!0,unlock:"purchase"},{id:3958,name:"Infernal RPEGG",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Infernal",tags:["AugM24","Infernal","Black","Red","Orange"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_rpegg_infernal"]},{id:3959,name:"Spore RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:3960,name:"2025 RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:3961,name:"The BFG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_BFG",tags:["DecM24","NewYears","Premium","Big Festive Gun"]},is_available:!1,unlock:"premium"},{id:3962,name:"BWD RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Wizard",tags:["FebM25","Drops7","D7W1"]},is_available:!1,unlock:"manual"},{id:3963,name:"The Bouzouki",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bouzouki",tags:["Mar25","StPatrickDay","Bundle"]},is_available:!1,unlock:"premium"},{id:3964,name:"Golden Dragon RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:4e3,name:"The Whipper",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg",tags:["default","Grey","Gray","Purple"]},is_available:!0,unlock:"default"},{id:4001,name:"GOLD Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4002,name:"Happy Bear Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4003,name:"Halloween Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:4004,name:"Thanksgiving Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:4005,name:"Christmas Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:4006,name:"Timewarp 2019 Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:4007,name:"Groundhog Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:4008,name:"Buck Rogers Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4009,name:"Valentines Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:4010,name:"St Patricks Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:4011,name:"Easter Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Easter",tags:["Easter","Eggs","Purple","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:4012,name:"Flame Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:4013,name:"Rainbow Whipper",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4014,name:"Steampunk Whipper",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4015,name:"Memphis Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Memphis",tags:["Memphis","White","Black","Pink"]},is_available:!0,unlock:"purchase"},{id:4016,name:"Eggwalker Whipper",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:4017,name:"Nuke Zone Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NukeZone",tags:["NukeZone","Red","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:4018,name:"2020 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:4019,name:"Country Singer Whipper",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4020,name:"Albino Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4021,name:"Raid Land Whipper",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_RaidLand",tags:["RaidLand","Blue","JulyM24"]},is_available:!1,unlock:"purchase"},{id:4022,name:"Toxic Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4023,name:"Music Whipper",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Music",tags:["Rockstar","JanM23","Red","Orange","Keytar","Piano","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:4024,name:"Galeggsy Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:4025,name:"Chicken Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:4026,name:"Techno Whipper",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Techno",tags:["Techno","AugM23","Tuh","Green","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_techno"]},{id:4027,name:"2021 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:4028,name:"Car Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_car",tags:["Cars","Trains","Purple"]},is_available:!0,unlock:"purchase"},{id:4029,name:"Merc Zone Whipper",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Merc",tags:["Merc","Suit","Black","Tie","Purple"]},is_available:!0,unlock:"purchase"},{id:4030,name:"Summer Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:4031,name:"Pencil Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Pencil",tags:["Pencil","Sep23","Yellow","Crayons","Sep24"]},is_available:!1,unlock:"purchase"},{id:4032,name:"Retro Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Retro",tags:["Retro","Nov23","Pixel","Purple","Wings","JanM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_retro"]},{id:4033,name:"2022 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4034,name:"Cards Whipper",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4035,name:"Dino Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Dino",tags:["Dino","May23","Blue","Yellow","AugM24"]},is_available:!1,unlock:"purchase"},{id:4036,name:"Eggpire Whipper",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4037,name:"SPORTS Whipper",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Sports",tags:["Sports","JulyM23","Red","Brown","Badminton","JunM24"]},is_available:!1,unlock:"purchase"},{id:4038,name:"Breakfast Whipper",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Breakfast",tags:["Breakfast","Food","Brown","Red","Eggs","Bacon","MayM24"]},is_available:!1,unlock:"purchase"},{id:4039,name:"Teggtris Whipper",price:1980,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Teggtris",tags:["Sep22","Mar23","Red","Orange","Yellow","Blue","Grey","Gray","Tetris","GameBoy","AprM24","bun_gamer","FebM25"]},is_available:!1,unlock:"purchase"},{id:4040,name:"Turkey-Supreme Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SpecialTurkey",tags:["NovM23","Thanksgiving","Brown","Yellow","NovM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_turk"]},{id:4041,name:"2023 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4042,name:"Valkyrie Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_valk"]},{id:4043,name:"The Pea90",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Farm",tags:["Farm","FebM23","Food","Green","Peas","May24"]},is_available:!1,unlock:"purchase"},{id:4044,name:"Fusion Whipper",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Fusion",tags:["Premium"," Fusion","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_smg_fusion"]},{id:4045,name:"Eggflation Whipper",price:8e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Eggflation",tags:["Eggflation","MayM23","Gold","Yellow","Eggs"]},is_available:!0,unlock:"purchase"},{id:4046,name:"Equinox Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:4047,name:"Kart Whipper",price:3500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Kart",tags:["Kart","Aug23","Pink","Yellow","Princess","Peach"]},is_available:!1,unlock:"purchase"},{id:4048,name:"KJDCitsme Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_KJ",tags:["Drops5","AugM23","Pink","Purple","Blue"]},is_available:!1,unlock:"manual"},{id:4049,name:"Wrestle Bros Whipper",price:3500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Wrestlebros",tags:["WBros","SepM23","Gold","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:4050,name:"Ancient Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4051,name:"Holideggs Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4052,name:"2024 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!1,unlock:"purchase"},{id:4053,name:"Racer Whipper",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4054,name:"Infernal Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Infernal",tags:["MayM24","Infernal","Red","Orange","Black"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_smg_infernal"]},{id:4055,name:"Jack O' Lantern Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Pumpkin",tags:["OctM24","Halloween5","Red","Orange","Black"]},is_available:!1,unlock:"premium"},{id:4056,name:"Spore Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:4057,name:"2025 Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:4058,name:"Irish Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Irish",tags:["Mar25","StPatrickDay","Green"]},is_available:!1,unlock:"premium"},{id:4059,name:"Golden Dragon Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:4200,name:"The Crackshot",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24",tags:["default","Blue","Grey","Gray"]},is_available:!0,unlock:"default"},{id:4201,name:"GOLD Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4202,name:"Happy Bear Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4203,name:"Halloween Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:4204,name:"Thanksgiving Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:4205,name:"Christmas Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:4206,name:"Timewarp 2019 Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:4207,name:"Groundhog Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:4208,name:"Buck Rogers Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4209,name:"Valentines Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:4210,name:"St Patricks Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:4211,name:"Easter Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Easter",tags:["Easter","Eggs","Green","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:4212,name:"Flame Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:4213,name:"Rainbow Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4214,name:"Steampunk Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4215,name:"Memphis Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Memphis",tags:["Memphis","Yellow","Black","White"]},is_available:!0,unlock:"purchase"},{id:4216,name:"Eggwalker Crackshot",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:4217,name:"Nuke Zone Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NukeZone",tags:["NukeZone","Black","Purple","Neon"]},is_available:!0,unlock:"purchase"},{id:4218,name:"2020 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:4219,name:"Country Singer Crackshot",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4220,name:"Albino Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4221,name:"Raid Land Crackshot",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_RaidLand",tags:["RaidLand","May23","Purple","Brown"]},is_available:!1,unlock:"purchase"},{id:4222,name:"Toxic Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4223,name:"Techno Crackshot",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Techno",tags:["Premium","MayM23","Untz","Pink","Blue","Purple","July24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_techno"]},{id:4224,name:"Music Crackshot",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Music",tags:["Rockstar","JanM23","Red","Guitar","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:4225,name:"Galeggsy Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:4226,name:"Chicken Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:4227,name:"2021 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:4228,name:"Car Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_car",tags:["Cars","Trains","Blue","White","Limosine"]},is_available:!0,unlock:"purchase"},{id:4229,name:"Retro Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Retro",tags:["Retro","Premium","Pixel","Blue","Wings","Aug24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_retro"]},{id:4230,name:"Merc Zone Crackshot",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Merc",tags:["Merc","Suit","Black","Tie","Blue","Teal"]},is_available:!0,unlock:"purchase"},{id:4231,name:"Summer Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:4232,name:"Pencil Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Pencil",tags:["Pencil","Sep23","Yellow","Stapler","Sep24"]},is_available:!1,unlock:"purchase"},{id:4233,name:"2022 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4234,name:"Graysocean Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Graysocean",tags:["Drops","Blue"]},is_available:!1,unlock:"manual"},{id:4235,name:"Cards Crackshot",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4236,name:"Dino Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Dino",tags:["Dino","May23","Brown","AugM24"]},is_available:!1,unlock:"purchase"},{id:4237,name:"Eggpire Crackshot",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4238,name:"SPORTS Crackshot",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Sports",tags:["Sports","JulyM23","Silver","Golf","Clubs","JunM24"]},is_available:!1,unlock:"purchase"},{id:4239,name:"Breakfast Crackshot",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Breakfast",tags:["Breakfast","Food","Fork","Red","Grey","Gray","MayM24"]},is_available:!1,unlock:"purchase"},{id:4240,name:"Scavenger Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Scavenger",tags:["Scavenger","Premium","Black","White","OctM23","bun_tactic","Telescope","FebM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_scav"]},{id:4241,name:"BWD Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Wizard",tags:["Sep22","Drops3","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:4242,name:"Valkyrie Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_valk"]},{id:4243,name:"2023 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4244,name:"Farm Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Farm",tags:["Farm","FebM23","Food","Green","Asparagus","May24"]},is_available:!1,unlock:"purchase"},{id:4245,name:"MenoXD Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Meno",tags:["Drops4","Mar23","Red","Black","xd"]},is_available:!1,unlock:"manual"},{id:4246,name:"Equinox Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:4247,name:"Kart Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Kart",tags:["Kart","Aug23","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:4248,name:"The Fusion Crackshot",price:6,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Fusion",tags:["Fusion","SepM23","Blue","White","Black"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_fusion"]},{id:4249,name:"The Pablo Rifle",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Badegg",tags:["Badegg","Premium","Yellow","Brown","Grey","Gray"]},is_available:!1,unlock:"premium"},{id:4250,name:"Ancient Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4251,name:"Holideggs Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4252,name:"2024 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2024",tags:["DecM23","NewYears","2024","White","Blue"]},is_available:!1,unlock:"purchase"},{id:4253,name:"Infernal Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Infernal",tags:["DecM23","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_infernal"]},{id:4254,name:"Racer Crackshot",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4255,name:"Wooden Grove Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Grove",tags:["Feb24","Newsletter","Wood","Brown"]},is_available:!1,unlock:"manual"},{id:4256,name:"Cyborg Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Cyborg",tags:["Apr24","RotR","Robot","Grey","EGGORG","Apr25","premFeatTwo"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_cyborg"]},{id:4257,name:"K4hhny Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_K4nny",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:4258,name:"The Quackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Quackshot",tags:["May24","Duck","Crackshot"]},is_available:!1,unlock:"premium"},{id:4259,name:"Praying Mantis Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Bugs",tags:["Jun24","Bugs","Green"]},is_available:!1,unlock:"purchase"},{id:4260,name:"The Checkmate Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Chess",tags:["July24","Chess","Black","White"]},is_available:!1,unlock:"premium"},{id:4261,name:"Bone Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Bones",tags:["Oct24","Halloween5","White"]},is_available:!1,unlock:"purchase"},{id:4262,name:"Spore Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:4263,name:"2025 Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:4264,name:"Golden Dragon Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:16e3,name:"Grenade",price:0,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade",tags:["default","green"]},is_available:!0,unlock:"default"},{id:16001,name:"GOLD Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:16002,name:"Happy Bear Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:16003,name:"Rainbow Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Rainbow",tags:["boom","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:16004,name:"Steampunk Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:16005,name:"Memphis Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Memphis",tags:["Memphis","pink","blue"]},is_available:!0,unlock:"purchase"},{id:16006,name:"Nuke Zone Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NukeZone",tags:["NukeZone","Green","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:16007,name:"Country Singer Grenade",price:1e5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:16008,name:"Raid Land Grenade",price:6500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaidLand",tags:["SepM23","brown"]},is_available:!1,unlock:"purchase"},{id:16009,name:"Toxic Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:16010,name:"Albino Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_SnakeAlbino",tags:["countrysinger","EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:16011,name:"Holy Hand Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Holy",tags:["Premium","vipItem","Blue","Yellow"],sound:"grenade_holy",cell:3,smokeColors:"white",fireColors:"gold"},is_available:!1,unlock:"vip"},{id:16012,name:"Groundhog Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Groundhog",tags:["Groundhog","Feb23","Brown","Smile","Feb24"]},is_available:!1,unlock:"purchase"},{id:16013,name:"Corrupted Grenade",price:75e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Corrupted",tags:["Brown","Eye"],sound:"grenade_corrupt",cell:4,smokeColors:"corrupt",fireColors:"corrupt"},is_available:!0,unlock:"purchase"},{id:16014,name:"Skullnado Grenade",price:7,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Skull",tags:["SepM23","OctM23","White","Halloween","Oct24"],sound:"grenade_skullnado",cell:2,smokeColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_skullnado"]},{id:16015,name:"St Patricks Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:16016,name:"Easter Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Easter",tags:["Easter","Blue","Pink","Eggs","MarM24","bun_badbunny","MarM25"]},is_available:!0,unlock:"purchase"},{id:16017,name:"Pablo Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Pablo",tags:["Brown","Yellow","Hat","Smile"]},is_available:!0,unlock:"purchase"},{id:16018,name:"Diablo Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Diablo",tags:["EGGORG","Apr23","Brown","Frown","Apr25"]},is_available:!0,unlock:"purchase"},{id:16019,name:"Unicorn Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Unicorn",tags:["FebM23","Sep23","Pink","Nov24"],sound:"grenade_unicorn",cell:1,smokeColors:"white",fireColors:"rainbow"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_unicorn"]},{id:16020,name:"Phone Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Phone",tags:["Mobile","Fire","Red"],sound:"grenade_cellphone",cell:5,smokeColors:"white"},is_available:!1,unlock:"manual"},{id:16021,name:"Merc Zone Grenade",price:7e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Merc",tags:["Merc","Suit","Black","Tie"]},is_available:!0,unlock:"purchase"},{id:16022,name:"The Coconut Punch",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Coconut",tags:["Summer","JunM23","Food","Brown","Drink","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:16023,name:"Toilet Paper Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_ToiletPaper",tags:["Premium","AugM23","Poop","White","bun_toilet"],sound:"grenade_tp",cell:6,smokeColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_toilet_papr"]},{id:16024,name:"Buck Rogers Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:16025,name:"Galeggsy Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:16026,name:"ChantiGG Booth Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Booth",tags:["Chantigg","Red","Phone"]},is_available:!0,unlock:"purchase"},{id:16027,name:"Glitterbomb Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Glitterbomb",tags:["Pencil","Premium","Pink","Disco","JanM25"],sound:"grenade_glitterbomb",smokeColors:"white",fireColors:"gold",cell:7},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_glitterbomb"]},{id:16028,name:"Apple Grenade",price:750,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Apple",tags:["Pencil","Sep23","Red","Food","MayM24","Sep24"]},is_available:!1,unlock:"purchase"},{id:16029,name:"Chickaletta Grenade",price:1250,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Wero",tags:["Wero","Chicken","Yellow"]},is_available:!0,unlock:"purchase"},{id:16030,name:"Halloween Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Halloween",tags:["Halloween","Oct23","Pumpkin","Jack","Orange","Smile","Oct24"]},is_available:!1,unlock:"purchase"},{id:16031,name:"Thanksgiving Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Turkey",tags:["NovM23","Thanksgiving","Eye","Yellow","NovM24"]},is_available:!1,unlock:"purchase"},{id:16032,name:"Thermal Detonator Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Thermal",tags:["Premium","JunM23","Red","Black"],sound:"grenade_thermal",cell:8,smokeColors:"thermal",fireColors:"thermal"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_thermal"]},{id:16033,name:"Christmas Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Present",tags:["Christmas2","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:16034,name:"Eggs of Legends Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Crystal",tags:["Eggteam","Blue","Lol","bun_zorg"]},is_available:!0,unlock:"purchase"},{id:16035,name:"2022 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:16036,name:"Techno Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Supernova",tags:["AprM23","Rainbow","White","JanM24","Aug24"],sound:"grenade_supernova",cell:9,smokeColors:"supernova",fireColors:"thermal"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_supernova"]},{id:16037,name:"Valentines Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Valentines",tags:["Valentines","Heart","Red","bun_cupid","Feb25"]},is_available:!1,unlock:"purchase"},{id:16038,name:"Octopus Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Octopus",tags:["May23","Oct23","White","Cute","Feb24"],sound:"grenade_octopus",cell:10,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_octopus"]},{id:16039,name:"Basket Bros Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_BBros",tags:["Premium","BBros","Orange"],sound:"grenade_bbros",cell:11,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"manual"},{id:16040,name:"Cards Grenade",price:1520,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:16041,name:"Diablo Cannonball",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_DiabloCannon",tags:["Mar23","EGGORG","Blue","Face","Apr24","Apr25","premFeatTwo"],sound:"grenade_diablocannon",cell:12,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_diablo"]},{id:16042,name:"Yoyo Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Yoyo",tags:["Relic","Drops2","Blue","White"]},is_available:!1,unlock:"manual"},{id:16043,name:"Dino Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Dino",tags:["Dino","May23","Orange","AugM24"]},is_available:!1,unlock:"purchase"},{id:16044,name:"Bumblebee Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Bee",tags:["Premium","Summer","Mar23","Yellow","Black","Cute","Jun24","bun_plant"],sound:"grenade_bees",cell:13,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_bumble"]},{id:16045,name:"Soccer Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Soccer",tags:["Sports","JulyM23","Black","White","FebM24","JunM24"]},is_available:!1,unlock:"purchase"},{id:16046,name:"Football Helmet Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Football",tags:["Premium","Sports","JulyM23","Red","JunM24","Fbros","SepM24"],sound:"grenade_football",cell:14,smokeColors:"softblack",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_football"]},{id:16047,name:"Unhatched Chicken Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Chicken",tags:["Chicken","Eggs","MayM24"]},is_available:!1,unlock:"purchase"},{id:16048,name:"Valkyrie Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"],sound:"grenade_valkyrie",cell:15,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_valk"]},{id:16049,name:"Milk Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Milk",tags:["Premium","Breakfast","MayM23","Pink","Food","May24","Sep24"],sound:"grenade_milk",cell:16,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_milk"]},{id:16050,name:"Breakfast Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Breakfast",tags:["Breakfast","Food","Eggs","Bacon","MayM24"]},is_available:!1,unlock:"purchase"},{id:16051,name:"Eyeball Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Eyeball",tags:["Scavenger","AugM23","Blue"]},is_available:!1,unlock:"purchase"},{id:16052,name:"Padlock Grenade",price:4200,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Padlock",tags:["Pencil2","Sep23","Grey","Gray","Locker","Sep24"]},is_available:!1,unlock:"purchase"},{id:16053,name:"Barrel Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Barrel",tags:["Sep22","Mar23","Brown"]},is_available:!1,unlock:"purchase"},{id:16054,name:"Bloodonade Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Blood",tags:["Premium","Halloween3","Red","DecM23","bun_arach","bun_demon","OctM24"],sound:"grenade_bloodonade",cell:17,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_blood"]},{id:16055,name:"Nutcracker Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Nutcracker",tags:["Christmas2","Red","White","Face","Dec24"]},is_available:!1,unlock:"purchase"},{id:16056,name:"2023 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2023",tags:["NewYears","2023","Red","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:16057,name:"Tambourine Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Tambourine",tags:["Rockstar","JanM23","Aug23","Music","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:16058,name:"Blue Shell Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Turtle",tags:["Community","BWD"],sound:"grenade_blueshell",cell:20,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"manual"},{id:16059,name:"Slop Bucket Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Pail",tags:["Premium","farm","FebM23","Food","May24"],sound:"grenade_milkbucket",cell:16,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium"},{id:16060,name:"Green Shell Grenade",price:3500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TurtleGreen",tags:["Kart","AprM23","Turtle","AugM24"]},is_available:!1,unlock:"purchase"},{id:16061,name:"Red Shell Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TurtleRed",tags:["Kart","AprM23","Turtle","JanM24","AugM24"]},is_available:!1,unlock:"purchase"},{id:16062,name:"Equinox Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","bun_mayan","JanM25"]},is_available:!1,unlock:"purchase"},{id:16063,name:"Kart Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Kart",tags:["Kart","Aug23","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:16064,name:"Timebomb Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Timebomb",tags:["Kart","Aug23","Blue","Yellow","AugM24"],sound:"grenade_Timebomb",cell:18,smokeColors:"blue",fireColors:"blue"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_timebomb"]},{id:16065,name:"Luchador Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Luchador",tags:["WBros","SepM23","Wrestle","Face"]},is_available:!1,unlock:"purchase"},{id:16066,name:"Smooth Brain Grenade",price:2100,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Brain",tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:16067,name:"Ancient Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:16068,name:"Holideggs Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:16069,name:"2024 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:16070,name:"Racer Frag Grenade",price:25e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaceCarFrag",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:16071,name:"Rogue Tire Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaceCarPremium",tags:["JanM24","Black","Text","Pireggi"],sound:"grenade_tire",cell:21,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium"},{id:16074,name:"Fusion Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Fusion",tags:["FebM23","White"],sound:"grenade_fusion",cell:22,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_fusion"]},{id:16078,name:"Mecha-Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Steambot",tags:["Apr24","RotR","Robots","White","bun_borg"],sound:"grenade_Steambot",cell:12,smokeColors:"black",fireColors:"red"},is_available:!1,unlock:"premium"},{id:16079,name:"Novosuper Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Novo",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:16080,name:"The Fly Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Fly",tags:["Jun24","Bugs"]},is_available:!1,unlock:"purchase"},{id:16081,name:"Mort Face Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Mort",tags:["Sep24","EggyP"],sound:"grenade_mort",cell:23,smokeColors:"default",fireColors:"default"},is_available:!1,unlock:"premium"},{id:16082,name:"Infernal Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Infernal",tags:["SepM24","Red","Orange","Black"],sound:"grenade_infernal",cell:22,smokeColors:"default",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_infernal"]},{id:16083,name:"Rest in Peaces Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Dove",tags:["Oct24","White","Bird","bun_dove"],sound:"grenade_Dove",cell:24,smokeColors:"default",fireColors:"default"},is_available:!1,unlock:"premium"},{id:16084,name:"Spore Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:16085,name:"Cool Whip Grenade",price:25e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Whip",tags:["NovM24","Gray","Perm","Premium","eggyp"],sound:"grenade_Whip",cell:25,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"purchase"},{id:16086,name:"Eggsmas Present",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_ChristmasGift",tags:["Dec24","Christmas4","Red","Gold","Newsletter"]},is_available:!1,unlock:"manual"},{id:16087,name:"2025 Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:16088,name:"Kettlebell Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Kettlebell",tags:["JanM25","80KG","Black","Text","80KG"],sound:"grenade_Kettlebell",smokeColors:"black",fireColors:"Red",cell:8},is_available:!1,unlock:"premium"},{id:16089,name:"Can of Worms Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Worms",tags:["Feb25","Text","Bait","Pink","Yellow","Grey","Gray","Silver"],sound:"grenade_worms",smokeColors:"default",fireColors:"default",cell:26},is_available:!1,unlock:"premium"},{id:16090,name:"Thee_Owl Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TheeOwl",tags:["FebM25","Drops7","D7W1"]},is_available:!1,unlock:"manual"},{id:16091,name:"Green Snack Grenade",price:1500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_greenSnack",tags:["Apr25","EGGORG","Shadows","Green","Food","Rice"]},is_available:!0,unlock:"purchase"},{id:4500,name:"The Tri-Hard",price:0,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug",tags:["Default","Red"]},is_available:!0,unlock:"default"},{id:4501,name:"GOLD Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4502,name:"Happy Bear Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4503,name:"Rainbow Tri-Hard",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Rainbow",tags:["White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4504,name:"Steampunk Tri-Hard",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Steampunk",tags:["Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4505,name:"Memphis Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Memphis",tags:["Memphis","Black","Green"]},is_available:!0,unlock:"purchase"},{id:4506,name:"Nuke Zone Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NukeZone",tags:["Purple","Blue","Black","Blurple","Neon"]},is_available:!0,unlock:"purchase"},{id:4507,name:"Country Singer Tri-Hard",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4508,name:"Raid Land Tri-Hard",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_RaidLand",tags:["RaidLand","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:4509,name:"Toxic Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4510,name:"Albino Snake Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4511,name:"St Patricks Day Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Yellow","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:4512,name:"Retro Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Retro",tags:["Retro","Premium","Sep23","Red","Green","Pixel","Wings"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_aug_retro"]},{id:4513,name:"Easter Tri-Hard",price:1e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Easter",tags:["Easter","JunM23","Green","Eggs","MarM24","MarM25"]},is_available:!0,unlock:"purchase"},{id:4514,name:"Car Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_car",tags:["Cars","Trains","Truck","Green","Red","Yellow"]},is_available:!0,unlock:"purchase"},{id:4515,name:"Merc Zone Tri-Hard",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Merc",tags:["Merc","Suit","Pink","Black"]},is_available:!0,unlock:"purchase"},{id:4516,name:"Summer Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","Blue","Orange","Yellow","JunM24"]},is_available:!1,unlock:"purchase"},{id:4517,name:"Buck Rogers Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4518,name:"Galeggsy Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars","Aug24"]},is_available:!1,unlock:"purchase"},{id:4519,name:"Pencil Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Pencil",tags:["Pencil","Sep23","Smile","Yellow","Blue","Scissors","Sep24"]},is_available:!1,unlock:"purchase"},{id:4520,name:"Halloween Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings","Oct24"]},is_available:!1,unlock:"purchase"},{id:4521,name:"Thanksgiving Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye","NovM24"]},is_available:!1,unlock:"purchase"},{id:4522,name:"Christmas Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present","Dec24"]},is_available:!1,unlock:"purchase"},{id:4523,name:"2022 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4524,name:"ChantiGG Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Chantigg",tags:["Drops","Red","Phone","Booth"]},is_available:!1,unlock:"manual"},{id:4525,name:"Valentines Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red","Feb25"]},is_available:!1,unlock:"purchase"},{id:4526,name:"Kawaii Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cutesy",tags:["Kawaii","Pink","Yellow","Blue"]},is_available:!0,unlock:"purchase"},{id:4527,name:"Cards Tri-Hard",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4528,name:"Valkyrie Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_valk_aug"]},{id:4529,name:"Dino Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Dino",tags:["Dino","May23","Orange","AugM24"]},is_available:!1,unlock:"purchase"},{id:4530,name:"Eggpire Tri-Hard",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4531,name:"SPORTS Tri-Hard",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Sports",tags:["Sports","JulyM23","Green","Blue","Tennis","JunM24"]},is_available:!1,unlock:"purchase"},{id:4532,name:"Chicken Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Chicken",tags:["Chicken","Red","White","MayM24"]},is_available:!1,unlock:"purchase"},{id:4533,name:"Breakfast Tri-Hard",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Breakfast",tags:["Breakfast","Food","Spoon","Red","Grey","Gray","MayM24"]},is_available:!1,unlock:"purchase"},{id:4534,name:"Bone Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Bones",tags:["Halloween3","OctM23","Oct24"]},is_available:!1,unlock:"purchase"},{id:4535,name:"2023 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4536,name:"Music Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Music",tags:["Rockstar","JanM23","Gold","Yellow","Saxaphone","Saxamaphone","SepM24","Mar25"]},is_available:!0,unlock:"purchase"},{id:4537,name:"Groundhog Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Groundhog",tags:["Groundhog","Feb23","Brown","Feb24"]},is_available:!1,unlock:"purchase"},{id:4538,name:"Farm Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Farm",tags:["Farm","FebM23","Food","Red","Yellow","Orange","Peppers","May24"]},is_available:!1,unlock:"purchase"},{id:4539,name:"Equinox Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon","JanM25"]},is_available:!1,unlock:"purchase"},{id:4540,name:"Fusion Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Fusion",tags:["Premium","Fusion","JulyM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_aug_fusion"]},{id:4541,name:"Kart Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Kart",tags:["Kart","Aug23","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:4542,name:"Ancient Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4543,name:"Holideggs Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4544,name:"2024 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!1,unlock:"purchase"},{id:4545,name:"Racer Tri-Hard",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4546,name:"Cupid Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cupid",tags:["Feb24","White","Orange","Grey","Gray","bun_cupid"]},is_available:!1,unlock:"premium"},{id:4547,name:"Green Snake Tri-Hard",price:15e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SnakePatrick",tags:["Mar24","White","StPatricksDay","Green","Grey","Gray","Albino","Mar25"]},is_available:!0,unlock:"purchase"},{id:4548,name:"Flame Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Flames",tags:["Mar24","Fire","Brown","Orange"]},is_available:!1,unlock:"manual"},{id:4549,name:"King Hayden Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Hayden",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:4550,name:"Infernal Tri-hard",price:3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Infernal",tags:["AprM24","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_aug_infernal"]},{id:4551,name:"Spore Tri-hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:4552,name:"The Pumpkin Pie-hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Pumpkinpie",tags:["NovM24","Thanksgiving4"]},is_available:!1,unlock:"premium"},{id:4553,name:"2025 Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:4554,name:"Techno Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Techno",tags:["FebM25"]},is_available:!1,unlock:"premium"},{id:4555,name:"Golden Dragon Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_dragongold",tags:["Apr25","EGGORG","Shadows","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:15e3,name:"The Whisk Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"whisk",tags:["Silver"]},is_available:!0,unlock:"default"},{id:15001,name:"Corn Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_corn",tags:["Yellow","Green","Food","Meme"]},is_available:!0,unlock:"default"},{id:15002,name:"Club Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_stick",tags:["Brown","bun_plant","Stick","Wood"]},is_available:!0,unlock:"default"},{id:15003,name:"GOLD Melee",price:2500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_gold",tags:["Brown","Gold","Whisk"]},is_available:!0,unlock:"purchase"},{id:15004,name:"Pink Bear Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_bear",tags:["Pink","Cute","Heart","Whisk"]},is_available:!0,unlock:"purchase"},{id:15005,name:"Steampunk Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_steampunk",tags:["Brown","Gold","Whisk"]},is_available:!0,unlock:"purchase"},{id:15006,name:"Rainbow Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rainbow",tags:["Red","Orange","Yellow","Green","Blue","Clouds","Whisk"]},is_available:!0,unlock:"purchase"},{id:15007,name:"Memphis Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_memphis",tags:["Black","White","Rainbow","Whisk"]},is_available:!0,unlock:"purchase"},{id:15008,name:"Toxic Melee",price:15e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_toxic",tags:["Pipe","Green","Black","bun_arach"]},is_available:!0,unlock:"purchase"},{id:15009,name:"Car Melee",price:2e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_shift",tags:["Black","Silver","Gear"]},is_available:!0,unlock:"purchase"},{id:15010,name:"Brown Snake Melee",price:1e5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_snake",tags:["Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:15011,name:"Hoe Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hoe",tags:["FebM23","farm","Tools","May24"]},is_available:!1,unlock:"purchase"},{id:15012,name:"Flame Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_flame",tags:["Orange","Yellow","Fire"]},is_available:!1,unlock:"manual"},{id:15013,name:"Valkyrie Melee",price:6,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_valkyrie",tags:["Gold","Blue","Yellow","Premium"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_valk"]},{id:15014,name:"BWD Wizard Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wizard",tags:["Drops4","Mar23","Blue","Brown","Staff"]},is_available:!1,unlock:"manual"},{id:15015,name:"Sneaker Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_sneaker",tags:["BBros","MarM23","White","Blue","Shoe"]},is_available:!1,unlock:"purchase"},{id:15016,name:"Fiddle Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fiddle",tags:["StPatricksDay","MarM23","Music","Brown","Mar24","Mar25"]},is_available:!0,unlock:"purchase"},{id:15017,name:"Medieval Key Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mediKey",tags:["Apr23","Newsletter","Gold","Yellow"]},is_available:!1,unlock:"manual"},{id:15018,name:"Galeggsy Whisk",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_galaxy",tags:["AprM23","Galeggsy","Blue","Purple","Planets","OctM23","Aug24"]},is_available:!1,unlock:"purchase"},{id:15019,name:"Giant Spoon Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_spoon",tags:["AprM23","Silver","Food","MayM24"]},is_available:!1,unlock:"purchase"},{id:15020,name:"Albino Snake Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_albino",tags:["Giveaway","White","ABHS","Snek"]},is_available:!1,unlock:"manual"},{id:15021,name:"Forkin' Fork! Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fork",tags:["Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15022,name:"Bone Bonker",price:4500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_bone",tags:["May23","Dino2","Caveman","AugM24"]},is_available:!1,unlock:"purchase"},{id:15023,name:"Stone Hammer Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rock",tags:["May23","Nov23","Dino2","Grey","Gray","AugM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_melee_stone"]},{id:15024,name:"Eggflation Whisk",price:8e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_eggflation",tags:["MayM23","Eggflation","Gold","Yellow","80k"]},is_available:!0,unlock:"purchase"},{id:15025,name:"Butterknife Melee",price:6500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_butterknife",tags:["MayM23","Eggflation","Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15026,name:"Shellfie Stick Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_selfiestick",tags:["Jun23","Photo","Cheese"]},is_available:!1,unlock:"purchase"},{id:15027,name:"Spatula Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_spatula",tags:["Jun23","Silver"]},is_available:!0,unlock:"purchase"},{id:15028,name:"Popsicle Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_popsicle",tags:["JunM23","Summer2","Pink","Food"]},is_available:!1,unlock:"purchase"},{id:15029,name:"Wrench Melee",price:4500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wrench",tags:["JunM23","Summer2","Blue","Yellow","Tools"]},is_available:!1,unlock:"purchase"},{id:15030,name:"Fusion Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fusion",tags:["JunM23","Blue","White","Gray","Grey"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_fusion"]},{id:15031,name:"Equinox Melee",price:3e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_equinox",tags:["July23","Equinox","Blue","Yellow","Sun","Moon","Whisk","JanM25"]},is_available:!1,unlock:"purchase"},{id:15032,name:"Crowbar Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_crowbar",tags:["July23","Blue","Yellow","Red","Tools"]},is_available:!0,unlock:"purchase"},{id:15033,name:"Hockey Melee",price:8e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hockey",tags:["JulyM23","Sports2","Stick"]},is_available:!1,unlock:"purchase"},{id:15034,name:"Shovel Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_shovel",tags:["JulyM23","Pink","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:15035,name:"MenoXD Katana",price:125e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_meno",tags:["JulyM23","Red","Black"]},is_available:!0,unlock:"purchase"},{id:15036,name:"Kart Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_kart",tags:["Aug23","Kart","Red","Blue","Whisk"]},is_available:!1,unlock:"purchase"},{id:15037,name:"Harrison Cat Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_harrison",tags:["AugM23","Drops5","Black","White","Cat","FebM25"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_melee_cat"]},{id:15039,name:"Ruler Melee",price:6500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ruler",tags:["Sep23","Pencil3","Brown"]},is_available:!1,unlock:"purchase"},{id:15040,name:"Fighting Fish Slapper",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fish",tags:["Sep23","bun_cat","Food","eyes"]},is_available:!1,unlock:"premium"},{id:15041,name:"Folding Chair Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_chair",tags:["SepM23","WBros","Wrestle","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:15042,name:"Pitchfork Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_devil",tags:["Oct23","Halloween4","Red","Black"]},is_available:!1,unlock:"purchase"},{id:15043,name:"Rolling Pin Whalloper",price:8e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rollingpin",tags:["Oct23","Brown"]},is_available:!0,unlock:"purchase"},{id:15044,name:"Ancient Club",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ruins",tags:["Nov23","Green","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:15045,name:"Mayan Macuahuitl",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mayan",tags:["Nov23","Red","Black","Brown","bun_mayan"]},is_available:!1,unlock:"premium"},{id:15046,name:"Turkey Drumstick",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_drumstick",tags:["NovM23","Red","Black","Brown"]},is_available:!1,unlock:"purchase"},{id:15047,name:"The Turkey Carver",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_carver",tags:["NovM23","Blue","Black","Gas","NovM24"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_melee_turkcar"]},{id:15048,name:"The Candy Cane-r",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_candycane",tags:["Dec23","Blue","Black","Gas"]},is_available:!1,unlock:"purchase"},{id:15049,name:"Elf on a Shelf Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_elf",tags:["Dec23","Blue","Black","Gas","bun_mistle"]},is_available:!1,unlock:"premium"},{id:15050,name:"2024 Whisk",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_newyear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!1,unlock:"purchase"},{id:15051,name:"Racer Lug Wrench",price:5e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_lugwrench",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:15052,name:"Groundhog Melee",price:7e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_groundhog",tags:["Feb24","Groundhog","White","Orange","Grey","Gray","Feb24"]},is_available:!1,unlock:"purchase"},{id:15053,name:"Buck Rogers Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_buck",tags:["Jan24","White","Orange","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:15054,name:"Vuvuzela Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_vuvuzela",tags:["FebM24","White","Orange","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:15055,name:"World Cup Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_cup",tags:["FebM24","Gold","Yellow"]},is_available:!1,unlock:"premium"},{id:15056,name:"Chocolate Bunny Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_chocolatebun",tags:["MarM24","Rabbit","Brown","Easter","Gold","MarM25"]},is_available:!0,unlock:"purchase"},{id:15057,name:"Mecha-Hammer",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_steambot",tags:["Apr24","Robot","RotR"]},is_available:!1,unlock:"premium"},{id:15058,name:"Robo-Wrench",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_steamwrench",tags:["Apr24","Robot","RotR"]},is_available:!1,unlock:"purchase"},{id:15059,name:"Thee_Owl Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_theeowl",tags:["AprM24","Drops6"]},is_available:!1,unlock:"manual"},{id:15060,name:"Goldfish Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_gfish",tags:["AprM24","Orange"]},is_available:!1,unlock:"premium"},{id:15061,name:"Plunger Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_plunger",tags:["May24","Red","Wood","Toilet","bun_toilet"]},is_available:!1,unlock:"premium"},{id:15062,name:"Army Ant  Melee",price:15e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ant",tags:["Jun24","Bugs"]},is_available:!1,unlock:"purchase"},{id:15063,name:"Infernal Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_infernal",tags:["JunM24","Red","Orange"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_infernal"]},{id:15064,name:"Pickleball Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_pickleball",tags:["JunM24"]},is_available:!1,unlock:"premium"},{id:15065,name:"Chess Board Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_chess",tags:["July24","Chess","Checkerboard","Black","White"]},is_available:!1,unlock:"purchase"},{id:15066,name:"Techno Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_techno",tags:["JulyM24","Techno","Premium","Purple","White"]},is_available:!1,unlock:"premium"},{id:15067,name:"Jawbone Melee",price:2e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_jawbone",tags:["AugM24","Dino","AugM24"]},is_available:!1,unlock:"purchase"},{id:15068,name:"The Elder Wand",price:5e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wand",tags:["Sep24","EggyP"]},is_available:!1,unlock:"purchase"},{id:15069,name:"Broomstick Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_broom",tags:["Sep24","EggyP"]},is_available:!1,unlock:"purchase"},{id:15070,name:"Keytar Melee",price:3e5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_keytar",tags:["SepM24","Perm","Premium","Music","SepM24","eggyp"]},is_available:!0,unlock:"purchase"},{id:15071,name:"Halloween Melee",price:5e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_halloween",tags:["OctM24","Halloween5"]},is_available:!1,unlock:"purchase"},{id:15072,name:"Frying Pan Melee",price:1,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fryingpan",tags:["OctM24","Perm","Permanent"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_pan"]},{id:15073,name:"Butcher Knife Melee",price:125e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_butcher",tags:["Nov24","SC2"]},is_available:!1,unlock:"purchase"},{id:15074,name:"Let Them Cook Melee",price:2,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_eggpan",tags:["Nov24","Perm"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_panegg"]},{id:15075,name:"Monster Hand Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_zombiehand",tags:["OctM24","Bundle"]},is_available:!1,unlock:"premium"},{id:15077,name:"Big Kahuna Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_properfish",tags:["NovM24","Select","Community","BWD"]},is_available:!1,unlock:"premium"},{id:15078,name:"Spore Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mushroom",tags:["NovM24","Giveaway","Funghi","Green"]},is_available:!1,unlock:"manual"},{id:15079,name:"mistake",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_frostfall",tags:["null"]},is_available:!1,unlock:"premium"},{id:15080,name:"Eggsmas Bell Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_christmasbell",tags:["Dec24","Christmas4","Gold","Yellow","Brown","Red"]},is_available:!1,unlock:"purchase"},{id:15081,name:"Nutcracker Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_nutcracker",tags:["Dec24","Christmas4","Bundle"]},is_available:!1,unlock:"premium"},{id:15082,name:"2025 Whisk",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_newyear2025",tags:["DecM24","NewYears","Green","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:15083,name:"Frostfall Whisk",price:4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_frostfall",tags:["DecM24","NewYears","perm","Premium"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_frost"]},{id:15084,name:"Mj\xf6lnir",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hammer",tags:["JanM25","Thor","Silver"]},is_available:!1,unlock:"premium"},{id:15085,name:"Fishing Rod Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_frod",tags:["Feb25","Silver"]},is_available:!1,unlock:"premium"},{id:15086,name:"Harlequin Mallet",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mallet",tags:["Drops7","D7W2","FebM25"]},is_available:!1,unlock:"manual"},{id:15087,name:"Moai Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_moai",tags:["Easter","Gray","Grey","Premium","MarM25"]},is_available:!0,unlock:"premium"},{id:15088,name:"Your Greatest Fan",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fan",tags:["Shadows","Bundle","Red","Premium","Apr25"]},is_available:!0,unlock:"premium"}],XI=[{id:1,loc_ref:"chlg_kill_streak_five",type:0,subType:0,period:0,goal:1,reward:100,conditional:0,value:"5",valueTwo:null,tier:2},{id:2,loc_ref:"chlg_kill_streak_ten",type:0,subType:0,period:0,goal:1,reward:200,conditional:0,value:"10",valueTwo:null,tier:2},{id:3,loc_ref:"chlg_kill_streak_fifteen",type:0,subType:0,period:0,goal:1,reward:500,conditional:0,value:"15",valueTwo:null,tier:3},{id:4,loc_ref:"chlg_kill_streak_twenty",type:0,subType:0,period:0,goal:1,reward:1e3,conditional:0,value:"20",valueTwo:null,tier:3},{id:5,loc_ref:"chlg_kill_streak_fifty",type:0,subType:0,period:0,goal:1,reward:5e3,conditional:0,value:"50",valueTwo:null,tier:3},{id:6,loc_ref:"chlg_kill_kills_ten",type:0,subType:10,period:0,goal:10,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:7,loc_ref:"chlg_kill_kills_twenty",type:0,subType:10,period:0,goal:20,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:8,loc_ref:"chlg_kill_kills_fifty",type:0,subType:10,period:0,goal:50,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:9,loc_ref:"chlg_kill_kills_hundred",type:0,subType:10,period:0,goal:100,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:10,loc_ref:"chlg_kill_kills_two_fifty",type:0,subType:10,period:0,goal:250,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:11,loc_ref:"chlg_kill_timePlayed_two",type:0,subType:6,period:0,goal:1,reward:100,conditional:null,value:"2",valueTwo:"60",tier:0},{id:12,loc_ref:"chlg_kill_timePlayed_four",type:0,subType:6,period:0,goal:1,reward:500,conditional:null,value:"4",valueTwo:"60",tier:2},{id:13,loc_ref:"chlg_kill_timePlayed_seven",type:0,subType:6,period:0,goal:1,reward:1e3,conditional:null,value:"7",valueTwo:"60",tier:3},{id:14,loc_ref:"chlg_kill_timePlayed_ten",type:0,subType:6,period:0,goal:1,reward:2500,conditional:null,value:"10",valueTwo:"60",tier:3},{id:15,loc_ref:"chlg_kill_con_kill_one_shot",type:0,subType:8,period:0,goal:1,reward:100,conditional:11,value:"1",valueTwo:"1",tier:1},{id:16,loc_ref:"chlg_kill_con_kill_hp_ten",type:0,subType:8,period:0,goal:1,reward:500,conditional:12,value:"1",valueTwo:"10",tier:1},{id:17,loc_ref:"chlg_kill_con_kill_five_streak",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:0,value:"0",valueTwo:"5",tier:2},{id:18,loc_ref:"chlg_kill_con_kill_ten_streak",type:0,subType:8,period:0,goal:1,reward:2500,conditional:0,value:"0",valueTwo:"10",tier:3},{id:19,loc_ref:"chlg_kill_con_kill_scoped",type:0,subType:8,period:0,goal:1,reward:200,conditional:13,value:null,valueTwo:null,tier:2},{id:20,loc_ref:"chlg_kill_con_two_kills_one_shot",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:null,tier:2},{id:21,loc_ref:"chlg_kill_con_reloading",type:0,subType:8,period:0,goal:1,reward:100,conditional:17,value:null,valueTwo:null,tier:1},{id:22,loc_ref:"chlg_kill_con_kill_scoped_melee",type:0,subType:8,period:0,goal:1,reward:200,conditional:13,value:null,valueTwo:"9",tier:2},{id:23,loc_ref:"chlg_kill_con_kill_two_grenade",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:"8",tier:2},{id:24,loc_ref:"chlg_kill_con_kill_three_grenade",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:16,value:"3",valueTwo:"8",tier:3},{id:25,loc_ref:"chlg_kill_con_kill_two_rpegg",type:0,subType:8,period:0,goal:1,reward:200,conditional:16,value:"2",valueTwo:"4",tier:2},{id:26,loc_ref:"chlg_kill_con_kill_three_rpegg",type:0,subType:8,period:0,goal:1,reward:1e3,conditional:16,value:"3",valueTwo:"4",tier:3},{id:27,loc_ref:"chlg_kill_weaponType_Cluck9mm_five",type:0,subType:1,period:0,goal:5,reward:200,conditional:null,value:null,valueTwo:"3",tier:1},{id:28,loc_ref:"chlg_kill_weaponType_Cluck9mm_ten",type:0,subType:1,period:0,goal:10,reward:500,conditional:null,value:null,valueTwo:"3",tier:1},{id:29,loc_ref:"chlg_kill_weaponType_Cluck9mm_twenty",type:0,subType:1,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:"3",tier:2},{id:30,loc_ref:"chlg_kill_weaponType_Cluck9mm_fifty",type:0,subType:1,period:0,goal:50,reward:2500,conditional:null,value:null,valueTwo:"3",tier:3},{id:31,loc_ref:"chlg_kill_weaponType_Scrambler_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"1",tier:1},{id:32,loc_ref:"chlg_kill_weaponType_Scrambler_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"1",tier:1},{id:33,loc_ref:"chlg_kill_weaponType_Scrambler_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"1",tier:2},{id:34,loc_ref:"chlg_kill_weaponType_Scrambler_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"1",tier:3},{id:35,loc_ref:"chlg_kill_weaponType_Rpegg_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"4",tier:2},{id:36,loc_ref:"chlg_kill_weaponType_Rpegg_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"4",tier:2},{id:37,loc_ref:"chlg_kill_weaponType_Rpegg_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"4",tier:2},{id:38,loc_ref:"chlg_kill_weaponType_Rpegg_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"4",tier:3},{id:39,loc_ref:"chlg_kill_weaponType_Whipper_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"5",tier:1},{id:40,loc_ref:"chlg_kill_weaponType_Whipper_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"5",tier:1},{id:41,loc_ref:"chlg_kill_weaponType_Whipper_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"5",tier:2},{id:42,loc_ref:"chlg_kill_weaponType_Whipper_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"5",tier:3},{id:43,loc_ref:"chlg_kill_weaponType_Eggk47_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"0",tier:0},{id:44,loc_ref:"chlg_kill_weaponType_Eggk47_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"0",tier:1},{id:45,loc_ref:"chlg_kill_weaponType_Eggk47_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"0",tier:2},{id:46,loc_ref:"chlg_kill_weaponType_Eggk47_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"0",tier:3},{id:47,loc_ref:"chlg_kill_weaponType_FreeRanger_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"2",tier:1},{id:48,loc_ref:"chlg_kill_weaponType_FreeRanger_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"2",tier:1},{id:49,loc_ref:"chlg_kill_weaponType_FreeRanger_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"2",tier:2},{id:50,loc_ref:"chlg_kill_weaponType_FreeRanger_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"2",tier:3},{id:51,loc_ref:"chlg_kill_weaponType_Crackshot_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"6",tier:1},{id:52,loc_ref:"chlg_kill_weaponType_Crackshot_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"6",tier:1},{id:53,loc_ref:"chlg_kill_weaponType_Crackshot_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"6",tier:2},{id:54,loc_ref:"chlg_kill_weaponType_Crackshot_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"6",tier:3},{id:55,loc_ref:"chlg_kill_weaponType_TriHard_five",type:0,subType:1,period:0,goal:5,reward:100,conditional:null,value:null,valueTwo:"7",tier:1},{id:56,loc_ref:"chlg_kill_weaponType_TriHard_ten",type:0,subType:1,period:0,goal:10,reward:200,conditional:null,value:null,valueTwo:"7",tier:1},{id:57,loc_ref:"chlg_kill_weaponType_TriHard_twenty",type:0,subType:1,period:0,goal:20,reward:500,conditional:null,value:null,valueTwo:"7",tier:2},{id:58,loc_ref:"chlg_kill_weaponType_TriHard_fifty",type:0,subType:1,period:0,goal:50,reward:1e3,conditional:null,value:null,valueTwo:"7",tier:3},{id:59,loc_ref:"chlg_kill_weaponType_Melee_five",type:0,subType:1,period:0,goal:5,reward:200,conditional:null,value:null,valueTwo:"9",tier:2},{id:60,loc_ref:"chlg_kill_weaponType_Melee_ten",type:0,subType:1,period:0,goal:10,reward:500,conditional:null,value:null,valueTwo:"9",tier:2},{id:61,loc_ref:"chlg_kill_weaponType_Melee_twenty",type:0,subType:1,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:"9",tier:3},{id:62,loc_ref:"chlg_kill_weaponType_Melee_fifty",type:0,subType:1,period:0,goal:50,reward:2500,conditional:null,value:null,valueTwo:"9",tier:3},{id:63,loc_ref:"chlg_damage_five_hundred",type:1,subType:null,period:0,goal:500,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:64,loc_ref:"chlg_damage_one_thousand",type:1,subType:null,period:0,goal:1e3,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:65,loc_ref:"chlg_damage_twenty_five_hundred",type:1,subType:null,period:0,goal:2500,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:66,loc_ref:"chlg_damage_five_thousand",type:1,subType:null,period:0,goal:5e3,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:67,loc_ref:"chlg_damage_ten_thousand",type:1,subType:null,period:0,goal:1e4,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:68,loc_ref:"chlg_damage_twenty_five_thousand",type:1,subType:null,period:0,goal:25e3,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:69,loc_ref:"chlg_deaths_ten",type:2,subType:null,period:0,goal:10,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:70,loc_ref:"chlg_deaths_twenty",type:2,subType:null,period:0,goal:20,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:71,loc_ref:"chlg_deaths_fifty",type:2,subType:null,period:0,goal:50,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:72,loc_ref:"chlg_movement_distance_five_hunderd",type:3,subType:3,period:0,goal:500,reward:100,conditional:null,value:null,valueTwo:null,tier:0},{id:73,loc_ref:"chlg_movement_distance_one_thousand",type:3,subType:3,period:0,goal:1e3,reward:500,conditional:null,value:null,valueTwo:null,tier:1},{id:74,loc_ref:"chlg_movement_distance_five_thousand",type:3,subType:3,period:0,goal:5e3,reward:2500,conditional:null,value:null,valueTwo:null,tier:2},{id:75,loc_ref:"chlg_movement_jump_one_hundred",type:3,subType:4,period:0,goal:100,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:76,loc_ref:"chlg_movement_jump_five_hundred",type:3,subType:4,period:0,goal:500,reward:500,conditional:null,value:null,valueTwo:null,tier:1},{id:77,loc_ref:"chlg_kill_jump_one",type:0,subType:4,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:2},{id:78,loc_ref:"chlg_kill_jump_five",type:0,subType:4,period:0,goal:5,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:79,loc_ref:"chlg_kill_jump_victim_jump",type:0,subType:4,period:0,goal:1,reward:2500,conditional:4,value:null,valueTwo:null,tier:3},{id:80,loc_ref:"chlg_movement_collect_ammo_ten",type:4,subType:18,period:0,goal:10,reward:100,conditional:16,value:"0",valueTwo:null,tier:1},{id:81,loc_ref:"chlg_movement_collect_ammo_twenty_five",type:4,subType:18,period:0,goal:25,reward:500,conditional:16,value:"0",valueTwo:null,tier:2},{id:82,loc_ref:"chlg_movement_collect_ammo_fifty",type:4,subType:18,period:0,goal:50,reward:1e3,conditional:16,value:"0",valueTwo:null,tier:3},{id:83,loc_ref:"chlg_movement_collect_grenade_ten",type:4,subType:18,period:0,goal:10,reward:100,conditional:17,value:"1",valueTwo:null,tier:1},{id:84,loc_ref:"chlg_movement_collect_grenade_twenty_five",type:4,subType:18,period:0,goal:25,reward:500,conditional:17,value:"1",valueTwo:null,tier:2},{id:85,loc_ref:"chlg_movement_collect_grenade_fifty",type:4,subType:18,period:0,goal:50,reward:1e3,conditional:17,value:"1",valueTwo:null,tier:3},{id:86,loc_ref:"chlg_timed_timeAlive_thirty",type:5,subType:7,period:0,goal:1,reward:100,conditional:7,value:"30",valueTwo:null,tier:1},{id:87,loc_ref:"chlg_timed_timeAlive_sixty",type:5,subType:7,period:0,goal:1,reward:200,conditional:7,value:"60",valueTwo:null,tier:2},{id:88,loc_ref:"chlg_timed_timeAlive_three_hundred",type:5,subType:7,period:0,goal:1,reward:2500,conditional:7,value:"300",valueTwo:null,tier:3},{id:90,loc_ref:"chlg_timed_timePlayed_three_hundred",type:5,subType:6,period:0,goal:300,reward:200,conditional:6,value:"300",valueTwo:null,tier:0},{id:91,loc_ref:"chlg_timed_timePlayed_nine_hundred",type:5,subType:6,period:0,goal:900,reward:500,conditional:6,value:"900",valueTwo:null,tier:1},{id:92,loc_ref:"chlg_timed_timePlayed_eighteen_hundred",type:5,subType:6,period:0,goal:1800,reward:1e3,conditional:6,value:"1800",valueTwo:null,tier:2},{id:93,loc_ref:"chlg_timed_timePlayed_thirty_six_hundred",type:5,subType:6,period:0,goal:3600,reward:2500,conditional:6,value:"3600",valueTwo:null,tier:3},{id:94,loc_ref:"chlg_kotc_capturing_timeAlive_twenty",type:6,subType:20,period:0,goal:1,reward:100,conditional:7,value:"10",valueTwo:null,tier:1},{id:95,loc_ref:"chlg_kotc_capture",type:6,subType:21,period:0,goal:1,reward:100,conditional:null,value:null,valueTwo:null,tier:1},{id:96,loc_ref:"chlg_kotc_win_one",type:6,subType:23,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:97,loc_ref:"chlg_kotc_win_three",type:6,subType:23,period:0,goal:3,reward:500,conditional:null,value:null,valueTwo:null,tier:2},{id:98,loc_ref:"chlg_kotc_win_five",type:6,subType:23,period:0,goal:5,reward:1e3,conditional:null,value:null,valueTwo:null,tier:3},{id:99,loc_ref:"chlg_kotc_win_ten",type:6,subType:23,period:0,goal:10,reward:2500,conditional:null,value:null,valueTwo:null,tier:3},{id:100,loc_ref:"chlg_kotc_coop_kill",type:6,subType:20,period:0,goal:1,reward:200,conditional:10,value:null,valueTwo:null,tier:1},{id:101,loc_ref:"chlg_kotc_coop_kill_victim_capturing",type:6,subType:20,period:0,goal:1,reward:200,conditional:10,value:"18",valueTwo:null,tier:1},{id:102,loc_ref:"chlg_cts_pick_up",type:7,subType:21,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:1},{id:103,loc_ref:"chlg_cts_capture_timeAlive_thirty",type:7,subType:21,period:0,goal:1,reward:500,conditional:7,value:"30",valueTwo:null,tier:2},{id:104,loc_ref:"chlg_cts_win_ten",type:7,subType:23,period:0,goal:20,reward:1e3,conditional:null,value:null,valueTwo:null,tier:1},{id:105,loc_ref:"chlg_cts_win_twenty_five",type:7,subType:23,period:0,goal:50,reward:4e3,conditional:null,value:null,valueTwo:null,tier:2},{id:106,loc_ref:"chlg_cts_win_fifty",type:7,subType:23,period:0,goal:100,reward:1e4,conditional:null,value:null,valueTwo:null,tier:3},{id:107,loc_ref:"chlg_cts_kills_victim_spatula",type:7,subType:10,period:0,goal:1,reward:200,conditional:null,value:null,valueTwo:null,tier:2},{id:108,loc_ref:"chlg_cts_kills_killstreak_five",type:7,subType:10,period:0,goal:1,reward:500,conditional:0,value:"5",valueTwo:null,tier:3}],YI=[1340,1206,15024,1050,1013,3066,1415,1024,2521,2305,1393,1230,1350,2250,3014,16006,16028,1504,3155,1410,1097,1216,4244,1158,2526,2262,3413,1252,4028,1151,2527,3456,1274,1264,2067,1187,4519,2292,1305,2273,2522,1046,1246,3633,2368,1038,1039,1360,1052,1398,2524,1327,3664,1141,2161,1370,3838,2149,16061,1047,1476,2319,15057,1048,1040,2373,2146,1134,15017,2096,1199,2090,2529,1287,3653,1173,2523,1067,1201,1474,1049,1041,1343,3021,3008,4012,3608,4517,3120,3112,15053,3812,3412,4510,16024,15020,3808,3408,2525,2528,2008,16007,4255,2231,3448],jI=["tip_001","tip_ofthe_day_1","tip_ofthe_day_4","tip_ofthe_day_6","tip_ofthe_day_9","tip_ofthe_day_10","tip_ofthe_day_11","tip_ofthe_day_13","tip_ofthe_day_15","tip_ofthe_day_16","tip_ofthe_day_17","tip_ofthe_day_18","tip_ofthe_day_19","tip_ofthe_day_26","tip_ofthe_day_27","tip_ofthe_day_28","tip_ofthe_day_30","tip_ofthe_day_33","tip_ofthe_day_34","tip_ofthe_day_35","tip_ofthe_day_37","tip_ofthe_day_39","tip_ofthe_day_40","tip_ofthe_day_41","tip_ofthe_day_42","tip_ofthe_day_44","tip_ofthe_day_45","tip_ofthe_day_46","tip_ofthe_day_47","tip_ofthe_day_49","tip_ofthe_day_51","tip_ofthe_day_52","tip_ofthe_day_53","tip_ofthe_day_54","tip_ofthe_day_56","tip_ofthe_day_58","tip_ofthe_day_59","tip_ofthe_day_60","tip_ofthe_day_62","tip_ofthe_day_63","tip_ofthe_day_64","tip_ofthe_day_65","tip_ofthe_day_66","tip_ofthe_day_67","tip_ofthe_day_68","tip_ofthe_day_69","tip_ofthe_day_70","tip_ofthe_day_72","tip_ofthe_day_73","tip_ofthe_day_74","tip_ofthe_day_75","tip_ofthe_day_76","tip_ofthe_day_77","tip_ofthe_day_78","tip_ofthe_day_79","tip_ofthe_day_80","tip_ofthe_day_81","tip_ofthe_day_83","tip_ofthe_day_84","tip_ofthe_day_85","tip_ofthe_day_86","tip_ofthe_day_87","tip_ofthe_day_88","tip_ofthe_day_89","tip_ofthe_day_90","tip_ofthe_day_91","tip_ofthe_day_92","tip_ofthe_day_93","tip_ofthe_day_94","tip_ofthe_day_95","tip_ofthe_day_96","tip_ofthe_day_97","tip_ofthe_day_98","tip_ofthe_day_99","tip_ofthe_day_100","tip_ofthe_day_101","tip_ofthe_day_102","tip_ofthe_day_103","tip_ofthe_day_104","tip_ofthe_day_105","tip_ofthe_day_106","tip_ofthe_day_107","tip_ofthe_day_108"],KI=["tipNew_ofthe_day_2","tipNew_ofthe_day_3","tipNew_ofthe_day_7","tipNew_ofthe_day_8","tipNew_ofthe_day_14","tipNew_ofthe_day_22","tipNew_ofthe_day_23","tipNew_ofthe_day_24","tipNew_ofthe_day_25","tipNew_ofthe_day_29","tipNew_ofthe_day_31","tipNew_ofthe_day_32","tipNew_ofthe_day_38","tipNew_ofthe_day_48","tipNew_ofthe_day_50","tipNew_ofthe_day_55","tipNew_ofthe_day_57","tipNew_ofthe_day_61","tipNew_ofthe_day_71","tipNew_ofthe_day_82","tipNew_ofthe_day_109","tipNew_ofthe_day_110"],$I=["loading_msgs_1","loading_msgs_2","loading_msgs_3","loading_msgs_4","loading_msgs_5","loading_msgs_6","loading_msgs_7","loading_msgs_8","loading_msgs_9","loading_msgs_10","loading_msgs_11","loading_msgs_12","loading_msgs_13","loading_msgs_14","loading_msgs_15","loading_msgs_16","loading_msgs_17","loading_msgs_18","loading_msgs_19","loading_msgs_20","loading_msgs_21","loading_msgs_22","loading_msgs_23","loading_msgs_24","loading_msgs_25","loading_msgs_26","loading_msgs_27","loading_msgs_28","loading_msgs_29","loading_msgs_30","loading_msgs_31","loading_msgs_32","loading_msgs_33","loading_msgs_34","loading_msgs_35","loading_msgs_36","loading_msgs_37","loading_msgs_38","loading_msgs_39","loading_msgs_40","loading_msgs_41","loading_msgs_42","loading_msgs_43","loading_msgs_44","loading_msgs_45","loading_msgs_46","loading_msgs_47","loading_msgs_48","loading_msgs_49","loading_msgs_50","loading_msgs_51","loading_msgs_52","loading_msgs_53","loading_msgs_54","loading_msgs_55","loading_msgs_56","loading_msgs_57","loading_msgs_58","loading_msgs_59","loading_msgs_60","loading_msgs_61","loading_msgs_62","loading_msgs_63","loading_msgs_64","loading_msgs_65","loading_msgs_66","loading_msgs_67","loading_msgs_68","loading_msgs_69","loading_msgs_70"];function qI(e){let t=new dv(e);return t.useRightHandedSystem=!0,t.useGeometryIdsMap=!0,t.useMaterialMeshMap=!0,t.useClonedMeshMap=!0,t}function JI(e,t,i,n){var a=NO.getMeshByName(e);let s=new wm(e,t,i,a);return s.setEnabled(!0),a?a.skeleton&&(s.skeleton=a.skeleton.clone(),s.skeleton._scene=t,s.animations=a.animations.map((e=>{let i=e.clone("",(e=>{let t=s.skeleton.getBoneIndexByName(e.name),i=s.skeleton.bones[t];return i.linkTransformNode(i),i}),!0);return i._scene=t,i})),s.skeleton.returnToRest()):console.error("Cannot find mesh to clone:",e),n?s.material=n:s.material&&s.material._scene!=t&&(s.material=QI(s.material.name,t)),s}function QI(e,t){let i=t.getMaterialByName(e);return i||(i=NO.getMaterialByName(e).clone(e,t),t.addMaterial(i)),i}function ZI(e,t,i=1){e.currentAnimation&&e.currentAnimation.stop();let n=e.getAnimationByName(t);e.currentAnimation=n,n.speedRatio=i,n.play()}function ex(e,t,i){let n=e.getAnimationByName(t);i&&n.onAnimationGroupPauseObservable.addOnce(i),n.play(),n.goToFrame(0),n.pause()}function tx(e){this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.Ik=0,this.active=!1,this.Xk=null,this.damage=20,this.range=0,this.velocity=0,this.hitsMap=!1,this.origin=new wh,this.direction=new wh,this.end=new wh,this.meshName="",this.weaponClassId=0,this.Nk=new hb(this)}oy.prototype.disableBlending=function(){this.bones.forEach((function(e){e.animations.forEach((function(e){e.enableBlending=!1}))}))},Zv.prototype.clearRect=function(e,t,i,n){this._context.clearRect(e,t,i,n)},Bd.prototype.setLayerMask=function(e){this.layerMask=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[i].setLayerMask(e)},Bd.prototype.setRenderingGroupId=function(e){this.Ct=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[i].setRenderingGroupId(e)},Xh.prototype.Ak=function(e){this.isVisible=e,this._isWorldMatrixFrozen=!e;for(var t=this.getChildTransformNodes(),i=0;i<t.length;i++)t[i].Ak(e)},Bd.prototype.setMaterial=function(e){this.material=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[i].setMaterial(e)},tx.damageExp=4,tx.wk=new wh,tx.Jk=new wh,tx.ak=new wh,tx.position=new wh,tx.fire=function(e,t,i,n){rP.bulletPool.retrieve().fireThis(e,t,i,n)},tx.prototype.fireThis=function(e,t,i,n){this.Xk=e,this.x=t.x,this.y=t.y,this.z=t.z,this.origin.set(this.x,this.y,this.z),this.direction.copyFrom(i).normalize().scaleInPlace(n.velocity),this.dx=this.direction.x,this.dy=this.direction.y,this.Ik=this.direction.z,this.weaponClass=n,this.damage=n.damage,this.active=!0,this.range=n.range,this.velocity=n.velocity,this.hitsMap=!1,this.powerful=!1,this.dmgTypeId=n.dmgTypeId;var a=ax.Tk(t,i,ax.projectileCollidesWithCell);a&&(this.end.copyFrom(a.pick.pickedPoint),this.range=wh.Distance(t,a.pick.pickedPoint),this.hitsMap=!0),e.activeShellStreaks&uc.EggBreaker&&(this.powerful=!0,this.damage*=1.5),0==this.Xk.Fk.tracer?this.Nk.fire(this.powerful):this.Nk.delayFrames=Number.MAX_SAFE_INTEGER},tx.prototype.remove=function(){rP.bulletPool.recycle(this),this.Nk.remove()},tx.prototype.update=function(){if(tx.position.set(this.x,this.y,this.z),this.range<this.velocity&&this.direction.scaleInPlace(this.range/this.velocity),!ax.Bk(tx.position,this.direction,this))if(this.x+=this.dx,this.y+=this.dy,this.z+=this.Ik,this.range-=this.velocity,this.range<=0){if(this.hitsMap){var e=this.end,t=.1*-this.dx,i=.1*-this.dy,n=.1*-this.Ik;!function(e,t,i,n,a,s){var r=xb.getSprite(0);r.animLength=20*Math.random()+30,r.easing=Ex.outQuint,r.position.x=e,r.position.y=t,r.position.z=i,r.dx=.1*n,r.dy=.1*a,r.Ik=.1*s,r.startSize=.1,r.endSize=.2*Math.random()+.4,r.angle=Math.random()*Math.PI2,r.rotate=.08*Math.random()-.04,r.animColors=LP}(e.x,e.y,e.z,t,i,n)}this.remove()}else;},tx.prototype.collidesWithPlayer=function(e,t){tx.wk.x=this.dx,tx.wk.y=this.dy,tx.wk.z=this.Ik,tx.wk.normalize();var i=.8*-wh.Dot(tx.wk,t)+.2,n=this.damage*Math.pow(i,tx.damageExp+Math.pow(i,tx.damageExp));isNaN(n)&&console.error("Bullet.collidesWithPlayer damage is NaN",this.weaponClass),fw(e,this,n,tx.wk.x,tx.wk.z),this.remove()};var ix=class{recurseObjectsWithRay(e,t,i,n){for(var a=0;a<i.length;a++){var s=i[a];if(af.IntersectsRay(s,e,t)){for(var r=0;r<s.objects.length;r++){var o=s.objects[r];o.checkTick!=this.checkTick&&af.IntersectsRay(o.bb,e,t)&&(o.checkTick=this.checkTick,n(s.objects[r]))}this.recurseObjectsWithRay(e,t,s.bvh,n)}}}recurseObjects(e,t,i){for(var n=0;n<t.length;n++){var a=t[n];if(af.Intersects(e,a)){for(var s=0;s<a.objects.length;s++){var r=a.objects[s];r.checkTick!=this.checkTick&&af.Intersects(e,r.bb)&&(r.checkTick=this.checkTick,i(a.objects[s]))}this.recurseObjects(e,a.bvh,i)}}}getObjectsWithRay(e,t,i){this.checkTick++,this.recurseObjectsWithRay(e,t,this.bvh,i)}createNode(e,t){var i=[],n=(e.maximumWorld.x-e.minimumWorld.x)/t,a=(e.maximumWorld.z-e.minimumWorld.z)/t;if(n>jb.height)var s=0,r=jb.height,o=jb.height;else s=e.minimumWorld.y,o=((r=e.maximumWorld.y)-s)/t;for(var l=e.minimumWorld.x;l<e.maximumWorld.x;l+=n)for(var c=s;c<r;c+=o)for(var h=e.minimumWorld.z;h<e.maximumWorld.z;h+=a){var f=new wh(l,c,h),u=new wh(l+n,c+o,h+a),d=new af(f,u);d.bvh=[],d.objects=[],i.push(d)}return i}constructor(){var e=new wh(0,0,0),t=new wh(jb.width,jb.height,jb.depth);this.world=new af(e,t),this.bvh=this.createNode(this.world,2),this.checkTick=0}add(e,t){t=t||this.bvh;for(var i=0;i<t.length;i++){var n=t[i];af.Intersects(e.bb,n)&&(n.maximumWorld.x-n.minimumWorld.x>.5*(e.bb.maximumWorld.x-e.bb.minimumWorld.x)&&n.maximumWorld.y-n.minimumWorld.y>.5*(e.bb.maximumWorld.y-e.bb.minimumWorld.y)&&n.maximumWorld.z-n.minimumWorld.z>.5*(e.bb.maximumWorld.z-e.bb.minimumWorld.z)?(0==n.bvh.length&&(n.bvh=this.createNode(n,2)),e.checkTick=0,this.add(e,n.bvh)):n.objects.push(e))}}getObjects(e,t){this.checkTick++,this.recurseObjects(e,this.bvh,t)}};function nx(){if(null==zI)throw"Items is undefined or null, cannot create Catalog";this.isSetup=!1,this.filterItems=function(e,t){for(var i=[],n=0;n<e.length;n++)t(e[n])&&i.push(e[n]);return i},this.findItemInListById=function(e,t){for(var i=0;i<t.length;i++)if(t[i]&&t[i].id===e)return t[i];return null},this.findItemsByIds=function(e){return zI.filter((t=>e.includes(t.id)))},this.findItemById=function(e){return this.findItemInListById(e,zI)},this.findItemBy8BitItemId=function(e,t,i){if(!1===this.isSetup&&this.setupCatalog(),void 0===t||t>=_c.length)return null;var n=i;switch(e){case pc.Hat:return 0===i?null:this.findItemInListById(n,this.hats);case pc.Stamp:return 0===i?null:this.findItemInListById(n,this.stamps);case pc.Primary:return this.findItemInListById(n,this.forClass[t].forWeaponSlot[mc.Primary]);case pc.Secondary:return this.findItemInListById(n,this.forClass[t].forWeaponSlot[mc.Secondary]);case pc.Grenade:return this.findItemInListById(n,this.grenades);case pc.Melee:return this.findItemInListById(n,this.melee)}},this.addWeaponFunctions=function(e){e.instantiateNew=function(e){var t;return t=null===this.exclusive_for_class?new mx(e,this.item_data.meshName):new xc.classes[this.exclusive_for_class].Fk(e,this.item_data.meshName),e.Nk&&e.Nk.setWeaponSkeleton(t.Nk.skeleton),t}},this.addGrenadeFunctions=function(e){e.instantiateNew=function(e){let t=JI(this.item_data.meshName,e.scene),i={scene:e.scene,player:e,Nk:{dk:t,dispose:()=>{t.dispose()}}};return t.position.y=.5,t.position.z=1,i}},this.addMeleeFunctions=function(e){e.instantiateNew=function(e){let t=JI(this.item_data.meshName,e.scene),i={scene:e.scene,player:e,Nk:{weaponMesh:t,skeleton:t.skeleton,dispose:()=>{t.dispose()}}};return e.Nk&&e.Nk.setWeaponSkeleton(i.Nk.skeleton),i}},this.getTaggedItems=function(e,t){if(!e)return[];const i=(e=e.replace(/\s/g,"")).split(",");return this.filterItems(zI,(function(e){if(void 0!==e.item_data.tags&&null!==e.item_data.tags&&e.item_data.tags.length>0){if(void 0!==t&&e.item_type_name!==getKeyByValue(pc,t))return!1;let n=!1;return e.item_data.tags.forEach((e=>{i.forEach((t=>{t===e&&(n=!0)}))})),n}return!1}))},this.premiumSoundValid=function(e){const t="premium"===e.unlock,i="manual"===e.unlock&&"gun_cluck9mm_CubicCastles"===e.item_data.meshName,n="purchase"===e.unlock&&e.item_data.hasOwnProperty("tags")&&e.item_data.tags.includes("Premium")&&e.price>15e4;return e.hasOwnProperty("unlock")&&(t||i||n)},this.getPremiumGunMeshNames=function(){Object.keys(_c).forEach((e=>{"Soldier"!==e&&(FI[e]=zI.filter((t=>hasValue(t.exclusive_for_class)&&t.exclusive_for_class===_c[e]&&this.premiumSoundValid(t))).map((e=>e.item_data.meshName)))})),Object.keys(pc).forEach((e=>{"Primary"!==e?FI[e]=zI.filter((t=>hasValue(t.item_type_id)&&t.item_type_id===pc[e]&&this.premiumSoundValid(t))).map((e=>e.item_data.meshName)):"Primary"===e&&(FI.Soldier=zI.filter((e=>hasValue(e.item_type_id)&&e.item_type_id===pc.Primary&&!hasValue(e.exclusive_for_class)&&this.premiumSoundValid(e))).map((e=>e.item_data.meshName)))}))},this.setupCatalog=function(){this.defaultItemIds=[],this.hats=[],this.stamps=[],this.primaryWeapons=[],this.secondaryWeapons=[],this.grenades=[],this.melee=[],this.forClass=[];for(var e=0;e<zI.length;e++)switch("default"===zI[e].unlock&&this.defaultItemIds.push(zI[e].id),zI[e].item_type_id){case pc.Hat:this.hats.push(zI[e]);break;case pc.Stamp:this.stamps.push(zI[e]);break;case pc.Primary:this.primaryWeapons.push(zI[e]),this.addWeaponFunctions(zI[e]);break;case pc.Secondary:this.secondaryWeapons.push(zI[e]),this.addWeaponFunctions(zI[e]);break;case pc.Grenade:this.grenades.push(zI[e]),this.addGrenadeFunctions(zI[e]);break;case pc.Melee:this.melee.push(zI[e]),this.addMeleeFunctions(zI[e])}for(var t=0;t<_c.length;t++){var i=function(e){return 0===e.price&&null===e.exclusive_for_class},n=function(e){return 0===e.price&&e.exclusive_for_class===t},a=function(e){return e.price>0&&null===e.exclusive_for_class},s=function(e){return e.price>0&&e.exclusive_for_class===t},r=this,o=function(e){return e=r.filterItems(e,i).concat(r.filterItems(e,n)).concat(r.filterItems(e,a)).concat(r.filterItems(e,s))},l={primaryWeapons:o(this.primaryWeapons),secondaryWeapons:o(this.secondaryWeapons)};l.forWeaponSlot=[l.primaryWeapons,l.secondaryWeapons],this.forClass.push(l)}this.isSetup=!0},this.isSetup||this.setupCatalog()}xc.catalog||(xc.catalog=new nx);var ax={init:function(e){ax.playerCollisionMesh=ey.$t("",{size:.5,height:.6},e),ax.playerCollisionMesh.position.y=.3,ax.playerCollisionMesh.bakeCurrentTransformIntoVertices(),ax.playerCollisionMesh.setEnabled(!1),ax.wedgeCollisionMesh=ey.$t("",{size:1.5},e),ax.wedgeCollisionMesh.position.y=-.75,ax.wedgeCollisionMesh.bakeCurrentTransformIntoVertices(),ax.wedgeCollisionMesh.rotation.x=Math.PI/4,ax.wedgeCollisionMesh.bakeTransformIntoVertices(ax.wedgeCollisionMesh.getWorldMatrix()),ax.wedgeCollisionMesh.setEnabled(!1),ax.wedgeCollisionMesh.flipFaces(),ax.iwedgeCollisionMesh=ey.$t("",{size:1.5},e),ax.iwedgeCollisionMesh.position.y=.75,ax.iwedgeCollisionMesh.bakeCurrentTransformIntoVertices(),ax.iwedgeCollisionMesh.rotation.x=Math.PI/4,ax.iwedgeCollisionMesh.bakeTransformIntoVertices(ax.iwedgeCollisionMesh.getWorldMatrix()),ax.iwedgeCollisionMesh.setEnabled(!1),ax.iwedgeCollisionMesh.flipFaces(),ax.hk=ey.$t("",{size:1},e),ax.hk.setEnabled(!1),ax.hk.flipFaces()},wk:new wh,Jk:new wh,ak:new wh,_k:new wh,Kk:new wh,ray:new Fg(wh.Zero(),wh.Zero(),1),matrix:new Lh,meshCollidesWithMap:function(e,t){var i={};if(isNaN(t.x)||isNaN(t.y)||isNaN(t.z))return!0;for(var n=e.getBoundingInfo().boundingBox,a=0;a<n.vectors.length;a++){var s=Math.floor(t.x+n.vectors[a].x),r=Math.floor(t.y+n.vectors[a].y),o=Math.floor(t.z+n.vectors[a].z);if(s<0||s>=Yb.width||o<0||o>=Yb.depth||r<0)return!0;var l=s+1e3*r+1e6*o;if(r<Yb.height&&!i[l]){var c=ax.meshCollidesWithCell(e,t,s,r,o);if(c)return c;i[l]=!0}}return!1},meshCollidesWithCell:function(e,t,i,n,a,s){var r=Yb.data[i][n][a];if(r.idx){var o=Nx[r.idx];if(s&&o.softness)return!1;switch(o.colliderType){case"full":return{x:i,y:n,z:a,cell:r,mesh:ax.hk};case"ladder":if("pc"!=e.name)return!1;break;case"none":return!1}e.position.x=t.x-i-.5,e.position.y=t.y-n-.5,e.position.z=t.z-a-.5,ax.wk.set(-e.position.x,-e.position.y,-e.position.z),e.setPivotPoint(ax.wk),e.rotation.x=-r.rx,e.rotation.y=-r.ry,e.rotation.z=-r.rz,e.computeWorldMatrix();var l=r.colliderMesh.intersectsMesh(e,r.colliderPrecise,r.colliderChildren);if(l)return{x:i,y:n,z:a,cell:r,mesh:l}}return!1},Tk:function(e,t,i){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))return!1;if(e.x<0||e.x>=Yb.width||e.z<0||e.z>=Yb.depth||e.y<0||e.y>=Yb.height)return!1;var n=t.length(),a=Math.floor(e.x),s=Math.floor(e.y),r=Math.floor(e.z),o=t.x,l=t.y,c=t.z,h=Math.sign(o),f=Math.sign(l),u=Math.sign(c),d=ax.intbound(e.x,o),m=ax.intbound(e.y,l),p=ax.intbound(e.z,c),_=h/o,v=f/l,g=u/c;if(0===o&&0===l&&0===c)return!1;for(n/=Math.sqrt(o*o+l*l+c*c);(h>0?a<Yb.width:a>=0)&&(f>0?s<Yb.height:s>=0)&&(u>0?r<Yb.depth:r>=0);){if(!(a<0||s<0||r<0||a>=Yb.width||s>=Yb.height||r>=Yb.depth)){var S=i(e,t,{x:a,y:s,z:r});if(S&&"verysoft"!=Nx[S.cell.idx].softness)return S}if(d<m)if(d<p){if(d>n)break;a+=h,d+=_}else{if(p>n)break;r+=u,p+=g}else if(m<p){if(m>n)break;s+=f,m+=v}else{if(p>n)break;r+=u,p+=g}}},intbound:function(e,t){return t<0?ax.intbound(-e,-t):(1-(e=(e%1+1)%1))/t},getCellForRay:function(e){try{var t=Yb.data[e.x][e.y][e.z]}catch(t){console.log(e)}if(!t||!t.mesh)return!1;switch(t.mesh.colliderType){case"none":case"ladder":return!1}return t},projectileCollidesWithCell:function(e,t,i){var n=ax.getCellForRay(i);if(!n)return!1;if(n.mesh.softness)return!1;var a=n.colliderMesh;ax.matrix.copyFrom(n.colliderMatrix),ax._k.set(i.x+.5,i.y+.5,i.z+.5),ax.wk.set(e.x,e.y,e.z),ax.Jk.copyFrom(t),ax.wk.subtractInPlace(ax._k),ax.ray.origin.copyFrom(ax.wk),ax.ray.direction.copyFrom(ax.Jk),ax.ray.length=1,Fg.TransformToRef(ax.ray,ax.matrix,ax.ray);var s=ax.intersectsColliderMesh(a,!1);if(a=s.pickedMesh,s.hit){var r=wh.TransformCoordinates(s.pickedPoint,ax.matrix.invert());return r.addInPlace(ax._k),s.pickedPoint=r,{cell:n,pick:s}}return!1},grenadeCollidesWithCell:function(e,t,i){var n=ax.getCellForRay(i);if(!n)return!1;var a=n.colliderMesh;ax.matrix.copyFrom(n.colliderMatrix),ax._k.set(i.x+.5,i.y+.5,i.z+.5),ax.wk.set(e.x,e.y,e.z),ax.Jk.copyFrom(t);var s=t.length();ax.Jk.normalize().scaleInPlace(10),ax.wk.subtractInPlace(ax._k),ax.ray.origin.copyFrom(ax.wk),ax.ray.direction.copyFrom(ax.Jk),ax.ray.length=1,Fg.TransformToRef(ax.ray,ax.matrix,ax.ray);var r=ax.intersectsColliderMesh(a,!1);if((a=r.pickedMesh,r.hit)&&wh.Distance(ax.ray.origin,r.pickedPoint)<=s){ax.matrix.invert();var o=wh.TransformCoordinates(r.pickedPoint,ax.matrix);o.addInPlace(ax._k),r.pickedPoint=o;var l=wh.TransformCoordinates(r.normal,ax.matrix);return{cell:n,pick:r,normal:l,dot:wh.Dot(t,l)}}return!1},intersectsColliderMesh:function(e,t){var i=ax.ray.intersectsMeshes([e,...e.getChildMeshes()],t)[0];if(void 0!==i&&!0===i.hit){if(i.normal=i.getNormal(!0,!1),wh.Dot(ax.ray.direction,i.normal)<0){if(!(i=ax.ray.intersectsMesh(ax.hk,t)).hit)return{hit:!1};i.normal=i.getNormal(!0,!1)}else Math.abs(i.pickedPoint.x)>.5||Math.abs(i.pickedPoint.y)>.5||Math.abs(i.pickedPoint.z)>.5?(ax.ray.origin=i.pickedPoint,(i=ax.ray.intersectsMesh(ax.hk,t)).normal=i.getNormal(!0,!1)):i.normal.negateInPlace();return i}return{hit:!1}},Bk:function(e,t,i,n){for(var a=i?i.Xk.team:null,s=i?i.Xk.id:null,r=0;r<TO;r++){var o=Jb[r];if(o&&(o.nk||o.pauseTargetTime>0)&&o.id!=s&&(0==o.team||o.team!=a)){ax.ray.origin.copyFrom(e),ax.ray.direction.copyFrom(t),ax.ray.length=1;var l=ax.rayCollidesWithPlayerHelper(ax.ray,o,n);l&&i&&i.collidesWithPlayer(o,l)}}return!1},rayCollidesWithPlayerHelper:function(e,t,i){var n=e.origin,a=i||.3;a*=t.scale;var s=ax.wk;s.copyFrom(n).addInPlace(e.direction);var r=ax.Kk;r.set(t.Ek,t.Zk+.3*t.scale,t.ek);var o=ax.Jk;o.copyFrom(e.origin),o.subtractInPlace(r);var l=wh.Dot(e.direction,e.direction),c=2*wh.Dot(e.direction,o),h=wh.Dot(o,o)-a*a,f=Math.pow(c,2)-4*l*h,u=ax.ak,d=ax._k;if(f<0)return!1;if(0==f)return wh.LerpToRef(n,s,f,u),u.subtractToRef(r,d),d.normalize(),d;var m=(-c-Math.sqrt(f))/(2*l);Math.sqrt(f);return m>=0&&m<=1&&(wh.LerpToRef(n,s,m,u),u.subtractToRef(r,d),d.normalize(),d)}},sx=class e{static add(t){e.bvh.add(t)}static sphereCollidesWithStructure(t,i,n,a){var s=e.box,r=e.wk,o=e.Jk;s.minimumWorld.copyFrom(t),s.minimumWorld.x-=i,s.minimumWorld.y-=i,s.minimumWorld.z-=i,s.maximumWorld.copyFrom(t),s.maximumWorld.x+=i,s.maximumWorld.y+=i,s.maximumWorld.z+=i,n.copyFromFloats(0,0,0);var l=0,c=!1;return e.bvh.getObjects(s,(s=>{e.sphereCollidesWithBox(t,i,s,r,o)&&(o.y<-.707&&(r.y=r.length(),r.x=0,r.z=0),r.length()>n.length()&&(n.copyFrom(r),a.copyFrom(o),c=s),l++)})),l>0&&c}static init(){e.bvh=new ix}static pointCollidesWithBox(t,i){var n=e.ak,a=e.mtx2;return n.copyFrom(t),n.subtractInPlace(i.position),i.matrix.invertToRef(a),wh.TransformNormalToRef(n,a,n),n.x>=i.minimumWorld.x&&n.x<=i.maximumWorld.x&&n.y>=i.minimumWorld.y&&n.y<=i.maximumWorld.y&&n.z>=i.minimumWorld.z&&n.z<=i.maximumWorld.z}static sphereCollidesWithBox(t,i,n,a,s){var r=e.ak,o=e._k,l=e.mtx2;if(r.copyFrom(t),r.subtractInPlace(n.position),n.matrix.invertToRef(l),wh.TransformNormalToRef(r,l,r),wh.ClampToRef(r,n.minimumWorld,n.maximumWorld,o),(c=wh.Distance(r,o))<i){o.subtractInPlace(r),wh.TransformNormalToRef(o,n.matrix,o),o.addInPlace(t),o.subtractInPlace(n.position),wh.ClampToRef(o,e.vmin,e.vmax,o),o.addInPlace(n.position);var c=wh.Distance(t,o);if(o.subtractInPlace(t).normalize(),c<(i*=.16*Math.abs(o.y)+.84))return s.copyFrom(o),o.scaleInPlace(c-i-.001),a.copyFrom(o),!0}return!1}static pointCollidesWithStructure(t){var i=e.box;i.minimumWorld.copyFrom(t),i.maximumWorld.copyFrom(t);let n=!1;return e.bvh.getObjects(i,(i=>{e.pointCollidesWithBox(t,i)&&(n=!0)})),n}};sx.wk=new wh,sx.Jk=new wh,sx.ak=new wh,sx._k=new wh,sx.Kk=new wh,sx.Wk=new wh,sx.vk=new wh,sx.mtx1=new Lh,sx.mtx2=new Lh,sx.vmin=new wh(-.5,-.5,-.5),sx.vmax=new wh(.5,.5,.5),sx.box=new af(wh.Zero(),wh.Zero()),sx.Type={full:1,wedge:2,iwedge:4,aabb:8,obb:16,ladder:32},sx.aabbMask=sx.Type.full|sx.Type.aabb|sx.Type.ladder;var rx=class{static usingDefaults(){let e=this.getDefaults(),t=!0;return Object.keys(e).forEach((i=>{let n=this.value[i];if("flags"===i&&(n^=n&ox.locked),n instanceof Array){for(let a=0;a<n.length;a++)if(n[a]!==e[i][a])return void(t=!1)}else if(n!==e[i])return void(t=!1)})),t}static set(e){this.value=e}static init(){this.value=this.getDefaults()}static serialize(){var e=Tc.getBuffer();return e.BkMzMvJt(nc.D),e.BkMzMvJt(4*this.value.gravity),e.BkMzMvJt(4*this.value.damage),e.BkMzMvJt(4*this.value.healthRegen),e.BkMzMvJt(this.value.flags),this.value.weaponDisabled.forEach((t=>{e.BkMzMvJt(t?1:0)})),e}static areAllWeaponsDisabled(){return!!this.value&&!this.value.weaponDisabled.includes(!1)}static isSelectedWeaponDisabled(e){return!this.areAllWeaponsDisabled()&&this.value.weaponDisabled[e]}static parse(e=!0){let t=Nc.unPackInt8U(),i=Nc.unPackInt8U(),n=Nc.unPackInt8U(),a=Nc.unPackInt8U(),s=xc.classes.map((()=>1===Nc.unPackInt8U()));return!!e&&((t<1||t>4)&&(t=4),(i<0||i>8)&&(i=4),n>16&&(n=4),this.value={gravity:t/4,damage:i/4,healthRegen:n/4,flags:a,weaponDisabled:s},!0)}static getDefaults(){let e={gravity:1,damage:1,healthRegen:1,flags:0,weaponDisabled:new Array(xc.classes.length)};return e.weaponDisabled.fill(!1),e}static setToDefaults(){this.value=this.getDefaults()}},ox={locked:1,noTeamChange:2,noTeamShuffle:4},lx={reset:1,pause:2};function cx(e){this.dmgTypeId=lc.findIndex((e=>"Grenade"===e.name)),this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.Ik=0,this.ttl=0,this.resting=!1,this.active=!1,this.Xk=null,this.Nk=new eL(this)}cx.wk=new wh,cx.Jk=new wh,cx.ak=new wh,cx._k=new wh,cx.matrix=new Lh,cx.prototype.update=function(){if(this.ttl<=0)this.remove();else{if(!this.resting){var e=this.dx,t=this.dy,i=this.Ik,n=.5*(this.dx+e),a=.5*(this.dy+t),s=.5*(this.Ik+i);Math.length3(n,a,s);this.collidesWithMap()||(this.x+=n,this.y+=a,this.z+=s,this.dy-=.012*rx.value.gravity),this.dx*=.96,this.Ik*=.96}this.ttl-=1}},cx.prototype.remove=function(){rP.grenadePool.recycle(this),this.Nk.remove()},cx.prototype.collidesWithMap=function(){cx.wk.set(this.x,this.y-.07,this.z),cx.Jk.set(this.dx,this.dy,this.Ik),cx.ak.set(this.dx,this.dy,this.Ik);var e=ax.Tk(cx.wk,cx.Jk,ax.grenadeCollidesWithCell);if(e){if(!(1==e.normal.y&&cx.ak.length()<.05))return cx.ak.subtractInPlace(e.normal.scale(1.6*e.dot)),this.dx=.98*cx.ak.x,this.dy=cx.ak.y,this.Ik=.98*cx.ak.z,this.Nk.bounce(),e;this.resting=!0}return!1},cx.prototype.throw=function(e,t,i){this.Xk=e,this.x=t.x,this.y=t.y,this.z=t.z,this.dx=i.x,this.dy=i.y,this.Ik=i.z,this.ttl=75,this.damage=150,this.radius=3,this.resting=!1,this.active=!0,this.Nk.throw()};var hx=class{collectAmmo(){return this.ammo.store=Math.min(this.ammo.Gk,this.ammo.store+this.ammo.pickup),!0}equip(e){this.Xk.zk=this.Xk.equipWeaponIdx,this.Xk.Fk=this.Xk.weapons[this.Xk.zk],this.Xk.Fk.Nk.equip(e),this.Xk.id==RO&&yw(),this.Xk.lastWeaponChange=0}update(){this.burstQueue>0&&(this.burstQueue%this.constructor.burstRof==0&&this.fire(),this.burstQueue--),this.Xk.scope&&0===this.Xk.scopeDelay?this.accuracyMod=this.adsMod:this.accuracyMod=1;let e=14.41*Math.length2(this.Xk.dx,this.Xk.Ik),t=Math.min(1,14.41*Math.abs(this.Xk.dy)),i=this.constructor.reloadBloom&&this.Xk.reloadCountdown>0||this.Xk.swapWeaponCountdown>0||this.Xk.Uk>0,n=this.Xk.scope&&0===this.Xk.scopeDelay,a=(e+t+(i?1:0))*this.constructor.Ok;this.movementAccuracy<a?this.movementAccuracy=a:this.movementAccuracy=Math.max(this.movementAccuracy-this.constructor.accuracyRecover,a),n?(this.ik=this.constructor.ik*this.adsMod,this.Ok=this.constructor.Ok*this.adsMod,this.mk=this.constructor.mk*this.adsMod):(this.ik=this.constructor.ik,this.Ok=this.constructor.Ok,this.mk=this.constructor.mk),this.accuracyRecover=Math.min(this.accuracyRecover+this.constructor.accuracyRecover,this.constructor.accuracyRecover);let s=Math.max(this.accuracyRecover,0);this.shootingAccuracy=Math.max(this.shootingAccuracy-s,this.ik),this.accuracy=this.movementAccuracy*this.movementAccuracyMod+this.shootingAccuracy,this.constructor.absoluteMinAccuracy&&(this.accuracy=Math.min(this.accuracy,this.constructor.absoluteMinAccuracy))}fire(){var e=Lh.lt(this.Xk.Qk+Math.PI,-this.Xk.Dk,0),t=Lh.Translation(0,0,this.constructor.range).multiply(e),i=t.getTranslation();this.shootingAccuracy=Math.min(this.shootingAccuracy+this.mk,this.Ok),this.accuracyRecover=8*-this.constructor.accuracyRecover;let n=this.accuracy;if(isNaN(n)&&(n=0),this.constructor.burst&&this.burstQueue<=0&&(this.burstQueue=(this.constructor.burst-1)*this.constructor.burstRof),this.constructor!==ux){let e=n,i=Lh.lt((this.Xk.bk.getFloat()-.5)*e,(this.Xk.bk.getFloat()-.5)*e,(this.Xk.bk.getFloat()-.5)*e);t=t.multiply(i)}i=t.getTranslation();var a=Lh.Translation(0,.1,0),s=(a=(a=a.multiply(e)).add(Lh.Translation(this.Xk.Ek,this.Xk.Zk+.3*this.Xk.playerScale,this.Xk.ek))).getTranslation();s.x=Math.floor(256*s.x)/256,s.y=Math.floor(256*s.y)/256,s.z=Math.floor(256*s.z)/256,i.x=Math.floor(256*i.x)/256,i.y=Math.floor(256*i.y)/256,i.z=Math.floor(256*i.z)/256,this.ammo.Yk--,this.Xk.id==RO&&yw(),this.Nk.fire(),this.fireMunitions(s,i),--this.tracer<0&&(this.tracer=this.constructor.tracer)}constructor(e){this.dmgTypeId=0,this.Xk=e,this.scene=this.Xk.scene,this.highPrecision=!1,this.equipTime=13,this.stowWeaponTime=13,this.accuracy=this.constructor.ik,this.shootingAccuracy=this.constructor.ik,this.movementAccuracy=this.constructor.ik,this.ik=this.constructor.ik,this.Ok=this.constructor.Ok,this.mk=this.constructor.mk,this.accuracyRecover=this.constructor.accuracyRecover,this.tracer=0,this.burstQueue=0,this.adsMod=this.constructor.adsMod||.5,this.movementAccuracyMod=this.constructor.movementAccuracyMod||1}};hx.reloadBloom=!0,hx.reloadTimeMod=1;var fx=class e extends hx{constructor(e,t){super(e),this.ammo={Yk:30,St:30,reload:30,store:240,Gk:240,pickup:30},this.longReloadTime=205,this.shortReloadTime=160,this.Nk=new iL(this,t)}fireMunitions(t,i){tx.fire(this.Xk,t,i,e)}};fx.dmgTypeId=lc.findIndex((e=>"Eggk47"===e.name)),fx.weaponName="EggK-47",fx.Rk="eggk47",fx.rof=3,fx.recoil=7,fx.automatic=!0,fx.damage=20,fx.totalDamage=20,fx.range=20,fx.velocity=1.5,fx.tracer=1;var ux=class e extends hx{constructor(e,t){super(e),this.ammo={Yk:2,St:2,reload:2,store:24,Gk:24,pickup:8},this.longReloadTime=155,this.shortReloadTime=155,this.wk=new wh,this.Nk=new nL(this,t)}fireMunitions(t,i){for(var n=this.accuracy,a=.6*n,s=0;s<20;s++)this.wk.set(i.x+this.Xk.bk.getFloat(-n,n)*e.range,i.y+this.Xk.bk.getFloat(-a,a)*e.range,i.z+this.Xk.bk.getFloat(-n,n)*e.range),tx.fire(this.Xk,t,this.wk,e)}};ux.dmgTypeId=lc.findIndex((e=>"Scrambler"===e.name)),ux.weaponName="Dozen Gauge",ux.Rk="dozenGauge",ux.rof=8,ux.recoil=10,ux.automatic=!1,ux.damage=8,ux.totalDamage=20*ux.damage,ux.range=8,ux.velocity=1,ux.tracer=0;var dx=class e extends hx{constructor(e,t){super(e),this.ammo={Yk:15,St:15,reload:15,store:60,Gk:60,pickup:15},this.hasScope=!0,this.longReloadTime=225,this.shortReloadTime=165,this.highPrecision=!0,this.Nk=new aL(this,t)}fireMunitions(t,i){tx.fire(this.Xk,t,i,e)}};dx.dmgTypeId=lc.findIndex((e=>"FreeRanger"===e.name)),dx.weaponName="CSG-1",dx.Rk="csg1",dx.rof=13,dx.recoil=13,dx.automatic=!1,dx.damage=110,dx.totalDamage=110,dx.range=50,dx.velocity=1.75,dx.tracer=0;var mx=class e extends hx{fireMunitions(t,i){tx.fire(this.Xk,t,i,e)}constructor(e,t){super(e),this.ammo={Yk:15,St:15,reload:15,store:60,Gk:60,pickup:15},this.longReloadTime=195,this.shortReloadTime=160,this.Nk=new sL(this,t)}};mx.dmgTypeId=lc.findIndex((e=>"Cluck9mm"===e.name)),mx.weaponName="Cluck 9mm",mx.Rk="cluck9mm",mx.rof=4,mx.recoil=6,mx.automatic=!1,mx.damage=25,mx.totalDamage=25,mx.range=15,mx.velocity=1,mx.tracer=0;var px=class e extends hx{constructor(e,t){super(e),this.ammo={Yk:1,St:1,reload:1,store:3,Gk:3,pickup:1},this.hasScope=!0,this.longReloadTime=170,this.shortReloadTime=170,this.Nk=new rL(this,t)}fireMunitions(t,i){Hx.fire(this.Xk,t,i,e);for(var n=0;n<10;n++){var a=.04*Math.random()-.02,s=.04*Math.random()-.02,r=.04*Math.random()-.02;PP(xb,10,t.x,t.y,t.z,a,s,r,.4,!1,0)}}};px.dmgTypeId=lc.findIndex((e=>"Rpegg"===e.name)),px.weaponName="RPEGG",px.Rk="rpegg",px.rof=40,px.recoil=60,px.automatic=!1,px.damage=140,px.radius=2.75,px.totalDamage=px.damage*px.radius*.5,px.range=45,px.minRange=3,px.velocity=.4;var _x=class e extends hx{constructor(e,t){super(e),this.ammo={Yk:40,St:40,reload:40,store:200,Gk:200,pickup:40},this.longReloadTime=225,this.shortReloadTime=190,this.Nk=new oL(this,t)}fireMunitions(t,i){tx.fire(this.Xk,t,i,e)}};_x.dmgTypeId=lc.findIndex((e=>"Whipper"===e.name)),_x.weaponName="SMEGG",_x.Rk="smg",_x.rof=2,_x.recoil=7,_x.automatic=!0,_x.damage=15,_x.totalDamage=15,_x.range=20,_x.velocity=1.25,_x.tracer=2;var vx=class e extends hx{constructor(e,t){super(e),this.ammo={Yk:1,St:1,reload:1,store:12,Gk:12,pickup:4},this.hasScope=!0,this.longReloadTime=144,this.shortReloadTime=144,this.Nk=new lL(this,t)}fireMunitions(t,i){tx.fire(this.Xk,t,i,e)}};vx.dmgTypeId=lc.findIndex((e=>"Crackshot"===e.name)),vx.weaponName="M2DZ",vx.Rk="m24",vx.rof=15,vx.recoil=20,vx.automatic=!1,vx.damage=200,vx.totalDamage=15,vx.range=60,vx.velocity=2,vx.tracer=0;var gx=class e extends hx{fireMunitions(t,i){tx.fire(this.Xk,t,i,e)}constructor(e,t){super(e),this.ammo={Yk:24,St:24,reload:24,store:150,Gk:150,pickup:24},this.longReloadTime=205,this.shortReloadTime=160,this.Nk=new cL(this,t)}};gx.dmgTypeId=lc.findIndex((e=>"TriHard"===e.name)),gx.weaponName="TriHard",gx.Rk="aug",gx.rof=15,gx.recoil=18,gx.automatic=!1,gx.movementInstability=2,gx.damage=20,gx.totalDamage=20,gx.range=20,gx.velocity=1.5,gx.tracer=0,gx.burst=3,gx.burstRof=3,fx.damage=30,fx.ik=.03,fx.Ok=.15,fx.mk=.05,fx.accuracyRecover=.025,fx.totalDamage=30,ux.damage=8.5,ux.ik=.13,ux.Ok=.16,ux.mk=.17,ux.accuracyRecover=.02,ux.totalDamage=170,ux.adsMod=.6,ux.movementAccuracyMod=.2,dx.damage=105,dx.ik=.004,dx.Ok=.3,dx.mk=.3,dx.accuracyRecover=.025,dx.totalDamage=105,px.ik=.015,px.Ok=.3,px.mk=.3,px.accuracyRecover=.02,px.absoluteMinAccuracy=.3,_x.damage=23,_x.ik=.06,_x.Ok=.19,_x.mk=.045,_x.accuracyRecover=.05,_x.totalDamage=23,_x.adsMod=.6,_x.movementAccuracyMod=.7,vx.damage=170,vx.ik=0,vx.Ok=.35,vx.mk=.1,vx.accuracyRecover=.023,vx.totalDamage=170,vx.movementAccuracyMod=1.3,vx.reloadBloom=!1,vx.reloadTimeMod=.8,mx.damage=26,mx.ik=.035,mx.Ok=.15,mx.mk=.09,mx.accuracyRecover=.08,mx.totalDamage=26,mx.adsMod=.8,mx.movementAccuracyMod=.6,gx.damage=32,gx.ik=.03,gx.Ok=.15,gx.mk=.037,gx.accuracyRecover=.03,gx.totalDamage=34,gx.adsMod=.6,gx.movementAccuracyMod=.8;var Sx=[{filename:"aqueduct",hash:"11dp765kifr",name:"Aqueduct",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"backstage",hash:"9dsromfqr1",name:"Backstage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"bastion",hash:"uuwh7401no",name:"Bastion",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"bedrock",hash:"yqbkimntiu",name:"Bedrock",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"biohazard",hash:"kzarr9ebqx",name:"BioHazard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"blender",hash:"1vvfxp9rt8u",name:"Blender",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"blue",hash:"2e7izzo70bk",name:"Blue",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"bridge",hash:"20vcy8e1ev0",name:"Bridge",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"canyon",hash:"2avqtv9ygk1",name:"Canyon",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"cash",hash:"1427gfre8ma",name:"Cash",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"castle",hash:"2d2tcz2mw7e",name:"Castle",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"castleArena",hash:"9dhs3kms6l",name:"Castle Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"8"},{filename:"catacombs",hash:"2el91jtcun0",name:"Catacombs",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"chickenItza",hash:"hyjqbat0i3",name:"Chicken Itza",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"cluckgrounds",hash:"1h9z3hj51g5",name:"Cluckgrounds",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"crossed",hash:"ead3tcf30r",name:"Crossed",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"crowsnest",hash:"1ze2s5zr9bm",name:"Crowsnest",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"8"},{filename:"deathpit",hash:"1cc9cvjf607",name:"Death Pit",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"dirt",hash:"1u3k5nfvwuh",name:"Dirt",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"dirt2",hash:"494aka3mb4",name:"Dirt 2",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"dirtbase",hash:"6e9r2y7dxk",name:"Dirt Base",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"downfall",hash:"26g5aj8aruc",name:"Downfall",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"duelPyramid",hash:"vmg0rj2e3b",name:"Duel Pyramid",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"eggcrates",hash:"j0i36e808n",name:"Eggcrates",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"6"},{filename:"enchanted",hash:"1igxtcyetaw",name:"Enchanted",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"exposure",hash:"15hv3cme1fh",name:"Exposure",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"facility",hash:"18djbmo35ru",name:"Facility",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"feedlot",hash:"iuj8rc7kyh",name:"Feedlot",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"field",hash:"e4aszuch87",name:"Field",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"fortFlip",hash:"1w1b6dkalc2",name:"Fort Flip",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"foundation",hash:"11y636vc64b",name:"Foundation",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"fourQuarters",hash:"1a0w7vbz8is",name:"Four Quarters",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"growler",hash:"1izyni7tb1e",name:"Growler",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"12"},{filename:"haunted",hash:"2dma8z1jdev",name:"Haunted",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"helix",hash:"i2sl4vsg3h",name:"Helix",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"hydro",hash:"8znnxbxfss",name:"Hydro",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"indigo",hash:"23rhtt62i3u",name:"Indigo",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"jailbreak",hash:"2a3blmd9hf4",name:"Jail Break",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"jinx",hash:"24u6pohagnj",name:"Jinx",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"junction",hash:"bkca8j2ppd",name:"Junction",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"kingsCourt",hash:"aq1t2lsjza",name:"King's Court",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"lunarmodule",hash:"1448aqjdqvl",name:"Lunar Module",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mansion",hash:"nqhtvwj3fo",name:"Mansion",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mazerunner",hash:"j16i30k9dz",name:"Maze Runner",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"metamorph",hash:"l9o69l8e1b",name:"Metamorph",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"14"},{filename:"moonbase",hash:"1yzocf1mex3",name:"Moonbase",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mudGulch",hash:"kto278skze",name:"Mud Gulch",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"nextdoor",hash:"s2i5za1kx9",name:"Nextdoor",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"outer",hash:"w1biqokp89",name:"Outer Reach",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"overcooked",hash:"29ca98hgdeh",name:"Overcooked",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"palaceSiege",hash:"1enghs5hsxe",name:"Palace Siege",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"quarry",hash:"2crjk106pa",name:"Quarry",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"queenscourt",hash:"raudy4h9pv",name:"Queen's Court",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"raceway",hash:"1a3eo6xaoju",name:"Raceway",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"rameses",hash:"177jt4j8so9",name:"Rameses",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"rats",hash:"13r2oqql8se",name:"Rats",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"relic",hash:"lxzknz53a2",name:"Relic",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"rivals",hash:"26fkvcef2h6",name:"Rivals",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"road",hash:"2h312vlocd",name:"Road",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"ruins",hash:"3ycs8z9bcu",name:"Ruins",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"scales",hash:"101v5lpkv1s",name:"Scales",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"shadyglen",hash:"2d0d4bj7aq3",name:"Shady Glen",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"shellville",hash:"fdgmkbfe7n",name:"Shellville",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"shipyard",hash:"1n1sptszksq",name:"Shipyard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"skyScratcher",hash:"1th1c8epp95",name:"Sky Scratcher",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"spaceFactory",hash:"10802a2az0f",name:"Space Factory",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"10"},{filename:"spacearena",hash:"k9zf5lqzze",name:"Space Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"14"},{filename:"sparta",hash:"274wwdyll9w",name:"Sparta",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"spellbound",hash:"1curtd0i4ls",name:"Spellbound",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"stage",hash:"1zn44r9jb3t",name:"Stage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"starship",hash:"27xerc3smw5",name:"Starship",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"staxarena",hash:"1jid8ffda0z",name:"Stax Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"teggtris",hash:"1y4rswkkv3l",name:"Teggtris",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"temple",hash:"bp6twwct9v",name:"Temple",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"timetwist",hash:"1ad75xyk2rv",name:"Timetwist",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"trainyard",hash:"2e1w70fjqet",name:"Trainyard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"treefort",hash:"14a9akanqms",name:"Tree Fort",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"twoTowers",hash:"2asidv5c0ff",name:"Two Towers",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"uncovered",hash:"bxrd0zdvtn",name:"Uncovered",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"12"},{filename:"vert",hash:"25a9ikled77",name:"Vert",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"wimble",hash:"13smnxheae1",name:"Wimble",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"wonderland",hash:"5n6ixyepvy",name:"Wonderland",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"wreckage",hash:"nkiu4z6uj1",name:"Wreckage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"yolkido",hash:"127ppvq4k6n",name:"Yolkido Garrison",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"}];function yx(){this.seed=100}Math.PI2=2*Math.PI,Math.PI90=Math.PI/2,Math.mod=function(e,t){var i=e%t;return i>=0?i:i+t},Math.length2=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},Math.length3=function(e,t,i){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(i,2))},Math.capVector2=function(e,t){var i=Math.length2(e.x,e.y);return i>t&&(e.x*=t/i,e.y*=t/i),e},Math.capVector3=function(e,t){var i=Math.length3(e.x,e.y,e.z);return i>t&&(e.x*=t/i,e.y*=t/i,e.z*=t/i),e},Math.normalize2=function(e,t){t=t||1;var i=Math.length2(e.x,e.y);return e.x*=t/i,e.y*=t/i,e},Math.normalize3=function(e,t){t=t||1;var i=Math.length3(e.x,e.y,e.z);return e.x*=t/i,e.y*=t/i,e.z*=t/i,e},Math.clamp=function(e,t,i){return Math.max(Math.min(e,i),t)},Math.radAdd=function(e,t){return Math.floor(8192*Math.mod(e+t,Math.PI2))/8192},Math.radSub=function(e,t){return Math.floor(8192*Math.mod(e-t,Math.PI2))/8192},Math.radRange=function(e){return Math.mod(e,Math.PI2)},Math.radDifference=function(e,t){var i=(e-t+Math.PI)%Math.PI2-Math.PI;return i=i<-Math.PI?i+Math.PI2:i},Math.cardVals=[0,Math.PI90,Math.PI,3*Math.PI90],Math.cardToRad=function(e){return Math.cardVals[e]},Math.randomInt=function(e,t){return Math.floor(Math.random()*(t-e)+e)},Math.diff=function(e,t,i){return e<t?i-e+t:e-t},yx.prototype.setSeed=function(e){this.seed=e},yx.prototype.getFloat=function(e,t){return e=e||0,t=t||1,this.seed=(9301*this.seed+49297)%233280,e+this.seed/233280*(t-e)},yx.prototype.getInt=function(e,t){return Math.floor(this.getFloat(e,t))};var Ex={linear:function(e){return e},inQuad:function(e){return e*e},outQuad:function(e){return e*(2-e)},inOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},inCubic:function(e){return e*e*e},outCubic:function(e){return--e*e*e+1},inOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},inQuart:function(e){return e*e*e*e},outQuart:function(e){return 1- --e*e*e*e},inOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},inQuint:function(e){return e*e*e*e*e},outQuint:function(e){return 1+--e*e*e*e*e},inOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},Ax=class e{collidesWithPlayer(e){let t=40;this.Xk.activeShellStreaks&uc.EggBreaker&&(t=255),fw(e,this,t,this.dir.x,this.dir.z)}update(){this.collisionCountdown>0&&0==--this.collisionCountdown&&this.checkCollisions()}constructor(e){this.Xk=e,this.scene=this.Xk.scene,this.collisionCountdown=0,this.dmgTypeId=lc.findIndex((e=>"Melee"===e.name)),e.Nk&&(this.Nk=new SL(this,this.Xk.meleeItem.item_data.meshName)),this.dir=new wh}checkCollisions(){var t=Lh.lt(this.Xk.Qk,this.Xk.Dk,0),i=Lh.Translation(0,0,-.8).multiply(t);this.dir=i.getTranslation(),e.wk.set(this.Xk.Ek-.25*this.dir.x,this.Xk.Zk-.25*this.dir.y+.3,this.Xk.ek-.25*this.dir.z),ax.Bk(e.wk,this.dir,this,.475)}attack(){this.collisionCountdown=5}};function Cx(e){this.bulletPool=new Cc((function(){return new tx(e)}),200),this.rocketPool=new Cc((function(){return new Hx(e)}),20),this.grenadePool=new Cc((function(){return new cx(e)}),10)}Ax.wk=new wh,Ax.Jk=new wh,Cx.prototype.updateLogic=function(){this.bulletPool.forEachActive((function(e){e.update()})),this.rocketPool.forEachActive((function(e){e.update()})),this.grenadePool.forEachActive((function(e){e.update()}))},Cx.prototype.updateActors=function(e){this.bulletPool.forEachActive((function(t){t.Nk.update(e)})),this.rocketPool.forEachActive((function(t){t.Nk.update(e)})),this.grenadePool.forEachActive((function(t){t.Nk.update(e)}))},Cx.prototype.removeAll=function(){this.bulletPool.forEachActive((function(e){e.remove()})),this.rocketPool.forEachActive((function(e){e.remove()})),this.grenadePool.forEachActive((function(e){e.remove()}))},Cx.prototype.throwGrenade=function(e,t,i){this.grenadePool.retrieve().throw(e,t,i)},Cx.prototype.getMapIntersectionPoint=function(e,t){if(t&&!Nx[t.cell.idx].softness&&t.cell&&t.cell.idx){var i=Nx[t.cell.idx],n=new Fg(new wh(e.x-e.dx-t.x-.5,e.y-e.dy-t.y-.5,e.z-e.Ik-t.z-.5),new wh(2*e.dx,2*e.dy,2*e.Ik),1);i.rotation.x=t.cell.rx,i.rotation.y=t.cell.ry,i.rotation.z=t.cell.rz;var a=n.intersectsMesh(i,!1);if(a.hit){var s=new wh(-e.dx,-e.dy,-e.Ik).normalize().scale(.005);return{x:a.pickedPoint.x+t.x+.5+s.x,y:a.pickedPoint.y+t.y+.5+s.y,z:a.pickedPoint.z+t.z+.5+s.z}}}return!1};var Rx={up:1,down:2,left:4,right:8,jump:16,fire:32,melee:64,scope:128,ascend:256,descend:512};xc.classes=[{name:"Soldier",Fk:fx},{name:"Scrambler",Fk:ux},{name:"Free Ranger",Fk:dx},{name:"Eggsploder",Fk:px},{name:"Whipper",Fk:_x},{name:"Crackshot",Fk:vx},{name:"TriHard",Fk:gx}];var Tx,Nx,Mx=["streak","kills","killsCluck9mm","killsGrenade","killsRpegg","killsEggk47","killsScrambler","killsFreeRanger","killsWhipper","killsCrackshot","killsTriHard","killsMelee","killsPrivate","killsPublic","killsKing","killsSpatula","killsTeams","killsFFA","deaths","deathsCluck9mm","deathsGrenade","deathsRpegg","deathsEggk47","deathsScrambler","deathsFreeRanger","deathsWhipper","deathsCrackshot","deathsTriHard","deathsMelee","deathsFall","deathsPrivate","deathsPublic","deathsKing","deathsSpatula","deathsTeams","deathsFFA","kotcCaptured","kotcWins"],Ix=256;function xx(e,t){this.id=e.jk,this.xt=e.pk,this.name=e.ck,this.yk=e.lk,this.safeName=e.Hk,this.charClass=e.xk,this.team=e.Sk,this.primaryWeaponItem=e.fk,this.secondaryWeaponItem=e.sk,this.shellColor=e.$k,this.hatItem=e.gk,this.stampItem=e.uk,this.stampPositionX=e.Vk,this.stampPositionY=e.qk,this.grenadeItem=e.Lk,this.meleeItem=e.Ck,this.Ek=e.Ek,this.Zk=e.Zk,this.ek=e.ek,this.dx=e.Pk,this.dy=e.tM,this.Ik=e.kM,this.MM=e.MM,this.Qk=e.Qk,this.Dk=e.Dk,this.speed=0,this.scope=!1,this.scopeDelay=0,this.primaryWeaponDisabled=!1,this.reloading=!1,this.dM=e.rM,this.lifetimeDeaths=e.IM,this.totalKills=0,this.XM=0,this.NM=e.AM,this.bestOverallStreak=e.wM,this.stats={},Mx.forEach((t=>{this.stats[t]=e.JM[t]})),this.gameData=e.aM,this.shield=e.TM,this.FM=e.FM,this.BM=0,this.nk=e.hM,this.zk=e._M,this.upgradeProductId=e.KM,this.mobileMultiplier=1,this.isGameOwner=e.nM,this.capturing=!1,this.kotcCapturing=!1,this.activeShellStreaks=e.EM,this.oM=0,this.eggBreakerValue=0,this.ksEggMuliplierValue=0,this.skMiniEggValue=0,this.playerScale=1,this.shellStreakIncrement=450,this.adminRoles=e.ZM,this.muted=e.eM,this.scene=t,this.corrected={dx:0,dy:0,Ik:0,Dk:0,Qk:0},this.corrections=0,this.totalCorrections=2,this.resetCountdowns(),this.equipWeaponIdx=this.zk,this.WM=1,this.vM=3,this.lastWeaponChange=0,this.jumpQueued=0,this.GM=!1,this.onGround=4,this.zM=!1,this.bobble=0,this.stateIdx=0,this.serverStateIdx=0,this.respawnTargetTime=0,this.pauseTargetTime=0,this.ready=!1,this.chatLines=0,this.respawnQueued=!1,this.canTakeTeamBonus=!0,this.changingCharacter=!1,this.lastDamageTakenType=0,this.lastDamageGivenType=0,this.lastDmgType=0,this.lastPosition={x:this.Ek,y:this.Zk,z:this.ek},this.firstUpdate=!0,this.damageMod=e.UM,this.abBucket=e.OM,this.aBTestInventoryReady=!1,this.Nk=new RL(this),this.changeWeaponLoadout(this.primaryWeaponItem,this.secondaryWeaponItem),this.iM=[],this.resetStateBuffer(),this.bk=new yx,this.social=e.mM,this.hideBadge=e.QM,this.challengesActive=[],this.challengeKills=[],this.challengeDeaths=[],this.challengeKotc=[],this.challengeFfa=[],this.challengeCts=[],this.challengeTimed={alive:[],played:[],cts:[],kotc:[],kill:[]},this.challengesDelayedChecks=[],this.eggsEarned=0,this.timers={alive:0,played:0,cts:0,kotc:0,kill:0},this.distanceTime=Date.now(),this.dmgGiven=0,this.distanceTraveled=0,this.timesJumped=0,this.jumps=0,this.ammoCollected=[0,0],this.cstCapturingTime=0,this.ctsControlled=!1,this.streakCtsKills=0,this.teamPoints=0,this.challengesGet(e.challengesActive),this.shellStreakMsg=""}xx.wk=new wh,xx.Jk=new wh,xx.ak=new wh,xx._k=new wh,xx.Kk=new Ph,xx.Wk=new Ph,xx.vk=new wh,xx.DM=new wh,xx.ray=new Fg,xx.matrix=new Lh,xx.prototype.ctsCapture=function(e){this.ctsControlled=e===this.xt},xx.prototype.changeWeaponLoadout=function(e,t){this.weapons&&(this.weapons[0].Nk.dispose(),this.weapons[1].Nk.dispose(),this.meleeWeapon.Nk.dispose()),this.meleeWeapon=new Ax(this),this.primaryWeaponItem=e,this.secondaryWeaponItem=t,this.weapons=[e.instantiateNew(this),t.instantiateNew(this)],this.Fk=this.weapons[this.zk],this.Fk.Nk.equip()},xx.prototype.bM=function(e){var t=0,i=0,n=0;if(e||this.id!=RO||(this.MM=Gb),!this.Nk||this.id!=RO){var a=this.stateIdx;a=Math.min(a,cc-1),this.MM=this.iM[a].MM,this.Qk=this.iM[a].Qk,this.Dk=this.iM[a].Dk,this.playerScale=this.iM[a].scale,this.iM[a].MM=0}(u=this.iM[this.stateIdx]).MM=this.MM,u.Qk=this.Qk,u.Dk=this.Dk,u.scale=this.playerScale,this.MM&Rx.left&&(t-=Math.cos(this.Qk),n+=Math.sin(this.Qk)),this.MM&Rx.right&&(t+=Math.cos(this.Qk),n-=Math.sin(this.Qk)),this.MM&Rx.up&&(this.zM?i+=1:(t-=Math.sin(this.Qk),n-=Math.cos(this.Qk))),this.MM&Rx.down&&(this.zM?i-=1:(t+=Math.sin(this.Qk),n+=Math.cos(this.Qk))),this.MM&Rx.jump&&(this.jumpQueued=10,this.MM^=this.MM&Rx.jump,this.id==RO&&(Gb^=Gb&Rx.jump)),this.MM&Rx.scope?this.scope||this.scopeIn():this.scope&&this.scopeOut(),this.jumpQueued>0&&(this.jumpQueued--,this.jump());let s=this.scope&&0===this.scopeDelay;if(this.zM){this.setJumping(!1);var r=this.dy;this.corrections&&(r+=this.corrected.dy/this.totalCorrections,this.corrections--),this.dy+=.028*i;var o=.5*(this.dy+r);this.Zk+=o,this.dy*=.5,Math.floor(this.Zk)>=Yb.height&&(this.zM=!1),this.move(0,o,0)}else{var l=new wh(t,i,n).normalize();s&&(l.x*=.5,l.z*=.5),this.dx+=.025*l.x,this.Ik+=.025*l.z,this.dy-=.012*rx.value.gravity,this.dy=Math.max(-.29,this.dy);var c=xx._k;if(c.copyFromFloats(this.Ek,this.Zk,this.ek),this.move(this.dx,this.dy,this.Ik),this.dx=this.Ek-c.x,this.dy=this.Zk-c.y,this.Ik=this.ek-c.z,this.onGround&&this.dy>0){var h=1-.5*xx.vk.copyFromFloats(this.dx,this.dy,this.Ik).normalize().y;this.dx*=h,this.Ik*=h}if(!e&&this.corrections){let e=0,t=this.corrected.dx/this.totalCorrections;this.zM&&(e=this.corrected.dy/this.totalCorrections);let i=this.corrected.Ik/this.totalCorrections;this.corrections--,this.move(t,e,i)}}if(!e){this.shield>0&&this.nk&&(this.shield-=2,(0!=t||0!=i||this.shield<=0)&&this.disableShield()),this.scopeDelay=Math.max(0,this.scopeDelay-1),this.lastWeaponChange++;var f=Math.max(0,Math.length3(this.dx,this.dy,this.Ik)-.012);this.speed=f,(this.zM||this.GM)&&(f*=2),this.bobble=(this.bobble+7*(f+.01))%Math.PI2,this.Fk&&this.Fk.update(),this.meleeWeapon.update(),this.meleeCountdown>0&&0==--this.meleeCountdown&&(this.id==RO&&this.MM&Rx.melee?this.inspectMelee():(this.swapWeaponCountdown=.5*this.Fk.equipTime,this.Nk.wieldGun(),this.id===CO&&Db.show())),this.inspectMeleeCountdown>0&&0==--this.inspectMeleeCountdown&&(this.swapWeaponCountdown=.5*this.Fk.equipTime,this.Nk.wieldGun(),this.id===CO&&Db.show()),this.updateHealth(),this.swapWeaponCountdown>0&&(this.swapWeaponCountdown--,this.swapWeaponCountdown<=0&&this.id==RO&&Db.show()),this.timers.alive++,this.timers.played++,this.timers.played%30==0&&this.challengeChecksDelay(),this.ctsControlled&&this.challengeCts.length>0?this.timers.cts++:this.timers.cts=0,this.kotcCapturing&&this.challengeKotc.length>0?this.timers.kotc++:this.timers.kotc=0,this.reloadCountdown>0&&(this.lastWeaponChange=0,this.reloadCountdown-=2,this.reloadCountdown<=0&&(this.reloadCountdown=0,this.reloaded())),this.rofCountdown>0&&(this.rofCountdown=Math.max(this.rofCountdown-1,0)),this.recoilCountdown>0&&(this.recoilCountdown=Math.max(this.recoilCountdown-2,0)),this.Uk>0&&(this.Uk-=2),this.id==RO&&(this.triggerPulled&&this.fire(),this.shellStreakTimers()),this.stateIdx=Math.mod(this.stateIdx+1,Ix);var u=this.iM[this.stateIdx];this.saveState(u),uO&&this.id==RO&&CO.stateIdx%cc==0&&uO.readyState==uO.OPEN&&CO.nk&&!BM&&function(){if(CO){var e=Tc.getBuffer();e.BkMzMvJt(nc.Qt),e.BkMzMvJt(CO.serverStateIdx),e.BkMzMvJt(Math.mod(CO.stateIdx-cc,Ix));for(var t=Math.mod(CO.stateIdx-cc,Ix),i=0;i<cc;i++){var n=Math.mod(t+i,Ix);e.BkMzMvJt(CO.iM[n].MM),e.BkMzMvJt(CO.iM[n].shots),e.BkMzMvLe(CO.iM[n].Qk),e.kMzMvLp(CO.iM[n].Dk),e.BkMzMvJt(100*CO.iM[n].scale),CO.iM[Math.mod(n-Ix/2,Ix)].shots=0}e.send(uO)}}()}if(this.dx*=.64,this.Ik*=.64,this.zM&&(this.dy*=.64),this.Nk&&this.id==RO||(this.reloadsQueued>0&&this.reload(),this.weaponSwapsQueued>0&&this.swapWeapon(this.equipWeaponIdx)),!this.Nk&&this.Zk<-10){let e=lc.findIndex((e=>"Fall"===e.name));this.lastDmgType=e,this.die(),dO.scoreKill(this,this);var d=Tc.getBuffer();d.BkMzMvJt(nc.Ft),d.BkMzMvJt(this.id),d.BkMzMvJt(this.id),d.BkMzMvJt(8),d.BkMzMvJt(e),d.BkMzMvJt(e),sendToAll(d)}},xx.prototype.saveState=function(e){e.Ek=this.Ek,e.Zk=this.Zk,e.ek=this.ek,e.dx=this.dx,e.dy=this.dy,e.Ik=this.Ik,e.GM=this.GM,e.zM=this.zM,e.zk=this.zk,e.Yk=this.Fk.ammo.Yk,e.store=this.Fk.ammo.store},xx.prototype.move=function(e,t,i){var n,a=xx.wk,s=xx.DM,r=xx.Jk,o=xx.ak;if(this.onGround=Math.max(--this.onGround,0),this.Zk+=.31,s.copyFromFloats(e,t,i),Math.capVector3(s,.29),a.copyFromFloats(this.Ek,this.Zk,this.ek),a.addInPlace(s),a.x=Math.clamp(a.x,.1,Yb.width-.1),a.z=Math.clamp(a.z,.1,Yb.depth-.1),this.firstUpdate)this.distanceTraveled=0,this.firstUpdate=!1;else{let e=Math.sqrt((a.x-this.lastPosition.x)*(a.x-this.lastPosition.x)+(a.y-this.lastPosition.y)*(a.y-this.lastPosition.y)+(a.z-this.lastPosition.z)*(a.z-this.lastPosition.z));this.onGround>0&&e>.01&&(this.distanceTraveled+=e)}this.lastPosition.x=a.x,this.lastPosition.y=a.y,this.lastPosition.z=a.z;for(var l=0;l<8;l++){var c=sx.sphereCollidesWithStructure(a,.31,r,o);if(!c)break;o.y<-.707&&(this.onGround=4),this.zM||c.colliderType&sx.Type.ladder&&this.tryToClimbLadder(c,o),a.addInPlace(r),this.onGround&&(this.GM?(this.setJumping(!1),this.dy=0):this.MM&Rx.down&&(this.zM=!1))}if(8==l&&(s.scaleInPlace(.9),a.subtractInPlace(s)),this.Ek=a.x,this.Zk=a.y,this.ek=a.z,!this.zM||this.Nk&&this.id!=RO){f=Math.floor(this.Ek);var h=Math.floor(this.Zk);u=Math.floor(this.ek);if(this.nk)if(n=Ux(f,h,u))n.zone||(this.capturing=!1,this.timers.kotc=0);if(n=Ux(f,Math.floor(this.Zk-.5),u)){let e=n.mesh;e&&"jump-pad"==e.shortName&&this.canJump()&&Math.length2(f+.5-this.Ek,u+.5-this.ek)<.3&&(this.Zk+=.26,this.setJumping(!0))}}else{var f=this.climbX,u=this.climbZ;this.zM=!1,this.capturing=!1,(n=Ux(f,Math.floor(this.Zk-.25),u))&&Math.floor(n.ry/Math.PI90)==this.climbRY&&n.mesh&&"ladder"==n.mesh.colliderType&&(this.zM=!0),(n=Ux(f,Math.floor(this.Zk+.25),u))&&Math.floor(n.ry/Math.PI90)==this.climbRY&&n.mesh&&"ladder"==n.mesh.colliderType&&(this.zM=!0)}this.Zk-=.31},xx.prototype.tryToClimbLadder=function(e,t){if(this.MM&Rx.up&&!(Math.abs(e.position.y-(this.Zk+.18))>.9)){var i=Math.round(this.Qk/Math.PI90)%4,n=e.cell.ry;if(i==n||(i+2)%4==n){var a=xx.Kk.set(t.x,t.z).normalize(),s=xx.Wk.set(-Math.cos(this.Qk),Math.sin(this.Qk)),r=Ph.Dot(s,a);Math.abs(r)<.4&&(this.zM=!0,this.climbX=Math.clamp(Math.floor(e.position.x),0,Yb.width-1),this.climbZ=Math.clamp(Math.floor(e.position.z),0,Yb.depth-1),this.climbRY=e.cell.ry,this.dy=0,this.setJumping(!1))}}},xx.prototype.scopeIn=function(){this.isAtReady()&&(this.Fk.Nk&&this.Fk.Nk.restPose(),this.Nk.wieldingMelee&&this.Nk.wieldGun(),this.scope=!0,this.scopeDelay=7)},xx.prototype.scopeOut=function(){this.scope=!1},xx.prototype.disableShield=function(){this.shield=0,this.Nk.YM.renderOverlay=!1,this.Nk.hands.renderOverlay=!1},xx.prototype.RM=function(){this.shield=120,this.Nk.YM.overlayColor=xx.OverlayColor.green,this.Nk.hands.overlayColor=xx.OverlayColor.green,this.Nk.YM.renderOverlay=!0,this.Nk.hands.renderOverlay=!0},xx.prototype.resetStateBuffer=function(){for(var e=0;e<Ix;e++)this.iM[e]={Qk:this.Qk,Dk:this.Dk,fire:!1,GM:this.GM,zM:this.zM,Ek:this.Ek,Zk:this.Zk,ek:this.ek,dx:this.dx,dy:this.dy,Ik:this.Ik,MM:this.MM,shots:0,Yk:[0,0],store:[0,0],scale:this.playerScale}},xx.prototype.canJump=function(){return this.zM|this.onGround},xx.prototype.jump=function(){this.zM&&(this.dy=.065,this.zM=!1,this.setJumping(!0)),this.canJump()&&(this.dy=.13,this.scope&&0===this.scopeDelay&&(this.dy*=.66),this.setJumping(!0))},xx.prototype.setJumping=function(e){this.jumpQueued=!1,this.onGround=0,e&&!this.GM&&this.jumps++,this.GM=e,this.iM[this.stateIdx].GM=e},xx.prototype.changeCharacter=function(e,t,i,n,a,s,r,o,l,c){var h=function(e,t){return e&&!t||!e&&t||null!==e&&null!==t&&e.id!==t.id};(e!==this.charClass||t.id!==this.primaryWeaponItem.id||i.id!==this.secondaryWeaponItem.id||n!==this.shellColor||h(this.hatItem,a)||h(this.stampItem,s)||this.grenadeItem!==l||this.meleeItem!==c||this.stampPositionX!=r||this.stampPositionY!=o)&&(this.charClass=e,this.primaryWeaponItem=t,this.secondaryWeaponItem=i,this.shellColor=n,this.hatItem=a,this.stampItem=s,this.stampPositionX=r,this.stampPositionY=o,this.grenadeItem=l,this.meleeItem=c,this.Nk.setShellColor(n),this.Nk.setStampPosition(r,o),this.id!==RO&&(this.Nk.wearHat(this.hatItem),this.Nk.applyStamp(this.stampItem),this.Nk.setStampPosition(this.stampPositionX,this.stampPositionY)),this.changeWeaponLoadout(t,i))},xx.prototype.swapWeapon=function(e){if(this.primaryWeaponDisabled)return!1;if(this.Nk&&this.id!=RO||this.canSwapOrReload()&&e<2){if(this.equipWeaponIdx=e,this.releaseTrigger(),this.swapWeaponCountdown=this.Fk.stowWeaponTime+this.weapons[e].equipTime,this.id==RO&&Db.hide(),this.Nk.wieldingMelee=!1,this.Fk.Nk.stow(),this.id==RO){var t=Tc.getBuffer();t.BkMzMvJt(nc.t),t.BkMzMvJt(e),t.send(uO)}return!0}return!1},xx.prototype.collectItem=function(e,t){switch(e){case _L.AMMO:return!!this.weapons[t].collectAmmo()&&(this.ammoCollected[e]++,Ib.play("pickup",this.Nk.YM.absolutePosition,this.id==RO),yw(),!0);case _L.GRENADE:return this.WM<this.vM&&(this.WM++,this.ammoCollected[e]++,Ib.play("pickup",this.Nk.YM.absolutePosition,this.id==RO),yw(),!0)}},xx.prototype.isAtReady=function(){return!(!(this.nk&&this.Fk&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.Uk<=0&&this.meleeCountdown<=0)||this.Nk&&0!=Pb)},xx.prototype.canMelee=function(){return!!(this.nk&&this.Fk&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&(this.Nk||this.Uk<=0)&&this.shotsQueued<=0)},xx.prototype.canSwapOrReload=function(){return!(!(this.nk&&this.Fk&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.Uk<=0&&this.shotsQueued<=0&&this.meleeQueued<=0)||this.Nk&&0!=Pb)},xx.prototype.fire=function(){this.shield>0?this.releaseTrigger():this.isAtReady()&&this.rofCountdown<=0&&(this.Fk.ammo.Yk>0?(this.recoilCountdown=this.Fk.constructor.recoil,this.rofCountdown=this.Fk.constructor.rof,this.Nk.fire(),this.Fk.fire(),this.id==RO&&(this.iM[this.stateIdx].shots++,this.lastWeaponChange=0),0==this.Fk.constructor.automatic&&this.releaseTrigger()):(this.shotsQueued=0,this.Fk.Nk.dryFire(),this.releaseTrigger()))},xx.prototype.pullTrigger=function(){if(1==Pb&&CO.Uk<=0)this.jM();else if(this.isAtReady()&&this.rofCountdown<=0)return this.Fk.ammo.Yk>0?(this.triggerPulled=!0,this.fire()):this.Fk.ammo.store>0?this.reload():this.Fk.Nk.dryFire(),!0;return!1},xx.prototype.releaseTrigger=function(){this.triggerPulled=!1,this.Fk.tracer=0},xx.prototype.melee=function(){if(1==Pb&&CO.Uk<=0&&this.jM(),this.shield>0||!this.canMelee())return!1;this.meleeCountdown=17,this.recoilCountdown=40,this.id===RO&&Db.hide(),this.Nk.melee();var e=Tc.getBuffer();return e.BkMzMvJt(nc.P),e.send(uO),this.meleeWeapon.attack(),!0},xx.prototype.inspectMelee=function(){return this.inspectMeleeCountdown=60,this.Nk.inspectMelee(),this.id===RO&&Db.hide(),!0},xx.prototype.reload=function(){if(this.id==RO){if(this.Fk.ammo.Yk==this.Fk.ammo.St||0==this.Fk.ammo.store||!this.canSwapOrReload())return!1;var e=Math.min(Math.min(this.Fk.ammo.St,this.Fk.ammo.reload)-this.Fk.ammo.Yk,this.Fk.ammo.store);this.roundsToReload=e,this.scopeOut(),this.reloading=!0,this.id===RO&&Db.hide(),this.Fk.Nk.reload(),this.Nk.wieldingMelee&&this.Nk.wieldGun(),this.releaseTrigger();var t=Tc.getBuffer();return t.BkMzMvJt(nc.Et),t.send(uO),0==this.Fk.ammo.Yk?this.reloadCountdown=this.Fk.longReloadTime:this.reloadCountdown=this.Fk.shortReloadTime,!0}this.Fk.Nk.reload()},xx.prototype.reloaded=function(){var e=this.Fk.ammo;e.Yk+=this.roundsToReload,e.store-=this.roundsToReload,this.reloading=!1,this.id==RO&&(Db.show(),yw())},xx.prototype.jM=function(){Pb=!1,CO.Uk=30,this.id==RO&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),this.Nk.gripBone._frozen=!1},xx.prototype.throwGrenade=function(){this.shield>0&&this.disableShield();var e=Tc.getBuffer();e.BkMzMvJt(nc.tt),e.ABkMzMvKl(Math.clamp(qb,0,1)),e.send(uO),CO.Uk=80,this.Nk.reachForGrenade()},xx.prototype.removeFromPlay=async function(){this.ksRemoveFromPlay(),this.nk=!1,this.MM=0,this.GM=!1,this.jumpQueued=0,this.scope=!1,this.zM=!1,this.oM=0,this.playerScale=1,this.activeShellStreaks=0,this.pauseTargetTime=0,this.lastDmgType=0,this.dmgGiven=0,this.distanceTraveled=0,this.jumps=0,this.ammoCollected=[0,0],this.streakCtsKills=0,this.meleeWeapon.collisionCountdown=0,this.firstUpdate=!0,this.BM=0,this.Nk.removeFromPlay(),this.id==RO&&iw()},xx.prototype.setStats=function(e){let t=this.gameData.private?"Private":"Public";this.stats[e+t]++;let i=e+oc[this.gameData.gameType].shortName;this.stats[i]++;let n=e+lc[this.lastDmgType].name;"deaths"!==e&&(n=e+lc[this.lastDamageGivenType].name),this.stats[n]++},xx.prototype.resetStats=function(){return Object.keys(this.stats).forEach((e=>{if("streak"!=e)return this.stats[e]=0}))},xx.prototype.scoreKill=function(){this.stats.kills++,this.totalKills++,this.scoreKillStreak(),this.scoreKillCts(),this.setStats("kills"),this.lastDmgType=0},xx.prototype.scoreKillCts=function(){this.ctsControlled&&this.streakCtsKills++},xx.prototype.scoreKillStreak=function(){this.stats.streak++,this.NM=Math.max(this.NM,this.stats.streak),this.bestOverallStreak=Math.max(this.bestOverallStreak,this.stats.streak),this.dM=this.stats.streak,this.killStreakIncrementer()},xx.prototype.killStreakIncrementer=function(){[{streak:uc.EggBreaker,value:"eggBreakerValue"},{streak:uc.MiniEgg,value:"skMiniEggValue"},{streak:uc.DoubleEggs,value:"ksEggMuliplierValue"}].forEach((e=>{this.activeShellStreaks&e.streak&&(this[e.value]=Math.min(this[e.value]+90,this.shellStreakIncrement))}))},xx.prototype.resetKsTypes=function(e){var t=Tc.getBuffer();t.BkMzMvJt(nc.ht),t.BkMzMvJt(this.id),t.BkMzMvJt(e),sendToAll(t)},xx.prototype.ksRemoveFromPlay=function(){[["eggBreakerValue",uc.EggBreaker],["ksEggMuliplierValue",uc.DoubleEggs],["skMiniEggValue",uc.MiniEgg]].forEach((([e,t])=>{this[e]&&(this[e]=0)}))},xx.prototype.checkAndEndShellStreak=function(e,t){this[e]&&--this[e]<=0&&(this.endShellStreak(t),this.resetKsTypes(t))},xx.prototype.updateShellStreaks=function(){this.checkAndEndShellStreak("eggBreakerValue",uc.EggBreaker),this.checkAndEndShellStreak("ksEggMuliplierValue",uc.DoubleEggs),this.checkAndEndShellStreak("skMiniEggValue",uc.MiniEgg)},xx.prototype.kotcStatScoreCapture=function(){this.stats.kotcCaptured++,this.challengeKotcCheck({type:1})},xx.prototype.kotcStatScoreWin=function(){this.stats.kotcWins++,this.challengeKotcCheck({type:2})},xx.prototype.die=function(){this.dM=0,this.stats.streak=0,this.stats.deaths++,this.XM++,this.streakCtsKills=0,this.reloading=!1,this.setStats("deaths"),this.lastDmgType=0,this.FM=0,this.removeFromPlay(),this.timers.alive=0},xx.prototype.aBTestInventoryCheck=function(){this.lifetimeDeaths++,this.abBucket&&this.XM>2&&this.lifetimeDeaths<15&&(this.aBTestInventoryReady=!0)},xx.prototype.beginShellStreak=function(e){e!==uc.EggBreaker&&e!==uc.HardBoiled&&e!==uc.DoubleEggs&&e!==uc.MiniEgg||(this.activeShellStreaks|=e);const t={[uc.HardBoiled]:()=>{this.shellStreakHardBoiled()},[uc.EggBreaker]:()=>{this.shellStreakEggBreaker()},[uc.Restock]:()=>{this.shellStreakRestock()},[uc.OverHeal]:()=>{this.shellStreakOverHeal()},[uc.DoubleEggs]:()=>{this.shellStreakEggMuliplier()},[uc.MiniEgg]:()=>{this.shellStreakMiniEgg()}};t[e]&&t[e](),this.Nk.beginShellStreak(e)},xx.prototype.endShellStreak=function(e){e!==uc.EggBreaker&&e!==uc.HardBoiled&&e!==uc.DoubleEggs&&e!==uc.MiniEgg||(this.activeShellStreaks&=~e);let t=null;const i={[uc.HardBoiled]:()=>{this.oM=0,t="shellstreak_end"},[uc.EggBreaker]:()=>{t="shellstreak_end"},[uc.DoubleEggs]:()=>{this.BM=0,t="ks_double_eggs_end"},[uc.MiniEgg]:()=>{this.playerScale=1,t="sk_egg_grow"}};i[e]&&(i[e](),t&&Ib.play(t,this.Nk.dk.position,!0)),this.Nk.endShellStreak(e)},xx.prototype.shellStreakEggBreaker=function(){this.shellStreakMsg="EGG BREAKER",Ib.play("shellstreak_start",this.Nk.dk.position,!0),this.eggBreakerValue=450},xx.prototype.shellStreakHardBoiled=function(){this.shellStreakMsg="HARD BOILED",Ib.play("shellstreak_start",this.Nk.dk.position,!0),this.oM=100},xx.prototype.shellStreakRestock=function(){this.resetAmmoGrenade(!0),this.shellStreakMsg="RESTOCK",Ib.play("ks_reload",this.Nk.dk.position,!0)},xx.prototype.shellStreakOverHeal=function(){this.FM=Math.min(200,this.FM+100),this.shellStreakMsg="MORE HEALTH",Ib.play("ks_overheal",this.Nk.dk.position,!0)},xx.prototype.shellStreakEggMuliplier=function(){this.ksEggMuliplierValue=this.shellStreakIncrement,this.BM=2,this.shellStreakMsg="DOUBLE EGGS",Ib.play("ks_double_eggs_start",this.Nk.dk.position,!0)},xx.prototype.shellStreakMiniEgg=function(){this.skMiniEggValue=this.shellStreakIncrement,this.playerScale=.5,Ib.play("ks_egg_shrink",this.Nk.dk.position,!0),this.shellStreakMsg="SMALL EGG SPLATTER"},xx.prototype.updateShellStreakTimer=function(e,t,i,n){this.activeShellStreaks&i&&(e[t]=Math.max(0,e[t]-1));var a=Math.floor(e[t]/30),s=document.getElementById(n);null!==s&&a!=parseInt(s.innerText)&&(s.innerText=a)},xx.prototype.shellStreakTimers=function(){this.updateShellStreakTimer(this,"eggBreakerValue",uc.EggBreaker,"shellStreak-egg-breaker-timer"),this.updateShellStreakTimer(this,"ksEggMuliplierValue",uc.DoubleEggs,"shellStreak-double-eggs-timer"),this.updateShellStreakTimer(this,"skMiniEggValue",uc.MiniEgg,"shellStreak-shrink-timer")},xx.prototype.updateHealth=function(){const e=.1*rx.value.healthRegen;this.FM>0&&(this.FM>100?this.FM=Math.max(100,this.FM-e):this.FM=Math.min(100,this.FM+e))},xx.prototype.respawn=function(e,t,i){this.Qk=Math.floor(Math.random()*Math.PI2*8192)/8192,this.Dk=0,this.Ek=e,this.Zk=t,this.ek=i,this.dx=0,this.dy=0,this.Ik=0,this.respawnQueued=!1,this.nk=!0,this.onGround=4,this.zM=!1,this.GM=!1,this.MM=0,this.capturing=!1,this.weapons[0].burstQueue=0,this.FM<=0?(this.FM=100,this.resetWeaponState()):this.resetWeaponState(!0),this.id==RO&&(uM=RO),this.corrections=0,this.Nk.resetLerp(),this.Nk.restoreToPlay(),this.Fk.equip(),this.id==uM&&(EL=0,Db.show(),Db.showDot(),yw()),this.RM(),this.resetStateBuffer()},xx.prototype.resetWeaponState=function(e){this.resetCountdowns(),this.releaseTrigger(),rx.areAllWeaponsDisabled()?(this.primaryWeaponDisabled=!0,this.zk=1):(this.primaryWeaponDisabled=!1,this.zk=0),this.equipWeaponIdx=this.zk,this.Fk=this.weapons[this.zk],this.weapons[0].Nk.pM.setEnabled(!1),this.weapons[1].Nk.pM.setEnabled(!1),this.resetAmmoGrenade(!1);var t=this.weapons[0];t.burstQueue=0,t.constructor.burst&&(t.ammo.Yk=Math.ceil(t.ammo.Yk/t.constructor.burst)*t.constructor.burst,t.ammo.store=Math.ceil(t.ammo.store/t.constructor.burst)*t.constructor.burst)},xx.prototype.resetAmmoGrenade=function(e){for(var t=0;t<this.weapons.length;t++)this.weapons[t]&&(this.weapons[t].ammo.Yk=this.weapons[t].ammo.St,this.weapons[t].ammo.store=this.weapons[t].ammo.Gk);this.updateGrenadeCount(e),yw()},xx.prototype.updateGrenadeCount=function(e){this.WM=e?Math.min(3,Math.max(this.WM,3)):Math.max(this.WM,1)},xx.prototype.isDead=function(){return this.FM<=0},xx.prototype.resetCountdowns=function(){this.rofCountdown=0,this.triggerPulled=!1,this.shotsQueued=0,this.meleeQueued=0,this.meleeCountdown=0,this.inspectMeleeCountdown=0,this.roundsToReload=0,this.recoilCountdown=0,this.reloadCountdown=0,this.reloadsQueued=0,this.swapWeaponCountdown=0,this.weaponSwapsQueued=0,this.Uk=0,this.grenadesQueued=0},xx.prototype.getChallengeData=function(e){const t=this.challengesActive.filter((t=>t.id===e));if(t.length>0)return t.length>0?t[0]:null},xx.prototype.challengeCheckComplete=async function(e){if(null!=e&&"function"==typeof e[Symbol.iterator])for(const t of e){if(!t.didComplete)continue;const e=Tc.getBuffer();e.BkMzMvJt(nc.ct),e.BkMzMvJt(this.id);const i=this.getChallengeData(t.data.challengeId);null!==i&&i.isComplete()&&(e.BkMzMvJt(i.id),sendToAll(e))}},xx.prototype.challengeResetProps=function(){this.dmgGiven=0,this.distanceTraveled=0,this.timesJumped=0,this.jumps=0,this.ammoCollected=[0,0],this.timers.played=0,this.timers.timePlayed=0,this.teamPoints=0},xx.prototype.challengeKill=async function(e){const{player:t,playerHit:i}=e;Object.assign(t,{kills:this.stats.kills,streak:this.stats.streak,Fk:this.lastDamageGivenType,spatula:this.ctsControlled,streakCtsKills:this.streakCtsKills});const n=[this.challengeCheck([t,i,this.timers],this.challengeKills),this.challengeCtsCheck()],[a,s]=await Promise.all(n),r=[...a,...s].filter((e=>void 0!==e));this.teamPoints=0,await this.challengeCheckComplete(r)},xx.prototype.challengeDeath=async function(e){if(!e.player||!e.playerHit)return void console.error("Invalid player data provided.");const t=await this.challengeCheck([e.player,e.playerHit],this.challengeDeaths);this.challengeCheckComplete(t)},xx.prototype.challengeKotcCheck=async function(e){if(this.challengeKotc.length>0){const t=await this.challengeCheck(e,this.challengeKotc);this.challengeCheckComplete(t)}},xx.prototype.challengeCtsCheck=async function(){return this.challengeCts.length>0?this.challengeCheck({timer:this.timers.cts,teamPoints:this.teamPoints},this.challengeCts):[]},xx.prototype.challengeChecksDelay=async function(){if(this.challengesDelayedChecks.length>0){const e=await this.challengeCheck({streak:this.stats.streak,timers:this.timers,kills:this.stats.kills,dmgGiven:this.dmgGiven,distance:this.distanceTraveled,jumps:this.jumps,ammo:this.ammoCollected,cstTimer:this.timers.cts,teamPoints:this.teamPoints,ctsCon:this.ctsControlled},this.challengesDelayedChecks);this.challengeResetProps(),await this.challengeCheckComplete(e)}},xx.prototype.challengeCheck=async function(e,t){if(this.Nk)return void console.log("Challenge check aborted: actor is present");const i=t.map((async t=>{const i=this.challengesActive.find((e=>e.challenge.id===t.challengeId));return i?i.updateData(e):(console.log("Challenge not found:",t.challengeId),null)}));return(await Promise.all(i)).filter((e=>void 0!==e))},xx.prototype.challengeCompleted=function(e){!function(e){const t=XI.find((t=>t.id===e));if(t){const e=extern.playerChallenges.iconSrc(t.loc_ref),i=ZO(`${t.loc_ref}_title`),n=ZO(`${t.loc_ref}_desc`);vueApp.challengeMsg({icon:e,title:i,desc:n})}else console.warn("Challenge not found for ID:",e)}(e)},xx.prototype.challengesReset=function(){this.challengesActive=[],this.challengeKills=[],this.challengeDeaths=[],this.challengeKotc=[],this.challengeFfa=[],this.challengeCts=[],this.challengesDelayedChecks=[],this.challengeTimed={alive:[],played:[],cts:[],kotc:[],kill:[]}},xx.prototype.challengesReroll=async function(e){if(!e.length)return;const t=[];try{for(let i=0;i<e.length;i++)t.push(await parent.getPlayerChallenges({playerId:this.dbId,challengeId:e[i]}));setTimeout((()=>{t.length&&(this.challengesReset(),this.challengesGet(t))}),100)}catch(e){console.error("Error fetching challenges:",e)}},xx.prototype.challengesGet=async function(e){if(this.Nk)return;const t=new Map(XI.map((e=>[e.id,e])));for(const i of e){const e=t.get(i.challengeId)||null;if(!e){console.log("Player challenge init failed, unknown challenge id:",i.challengeId);continue}const n=await playerChallengeSet(e,i);if(!n){console.log("Player challenge empty:",i.challengeId);continue}n.init();const a=ChallengeType[n.challenge.type],s=ChallengeSubType[n.challenge.subType],r=ChallengeConditions[n.challenge.conditional];({kills:()=>this.challengeKills.push(i),deaths:()=>this.challengeDeaths.push(i),timed:()=>{this.challengesDelayedChecks.push(i)},cts:()=>{this.challengeCts.push(i),"kills"===s&&this.challengeKills.push(i),this.challengesDelayedChecks.push(i)},ffa:()=>{this.challengeFfa.push(i),this.challengesDelayedChecks.push(i)},kotc:()=>{"kills"===r?this.challengeKills.push(i):this.challengeKotc.push(i),this.challengesDelayedChecks.push(i)},collect:()=>{this.challengesDelayedChecks.push(i)}}[a]||(()=>{this.challengesDelayedChecks.push(i)}))(),this.challengesActive.push(n)}},xx.prototype.selectedWeaponAllowed=function(){return!!rx.areAllWeaponsDisabled()||!rx.value.weaponDisabled[this.charClass]};try{r("fs"),Tx=void 0}catch(e){Tx=window.Loader}void 0===Tx&&(Tx={addTask:()=>{},progress:()=>{},finish:()=>{}});var bx,Px=!1;function wx(e,t,i){var n=ey.$t(e,{size:1},t),a=new Og("",t,!0);return a.diffuseColor=i,a.emissiveColor=i,a.specularColor=Ah.Black(),a.wireframe=!0,n.material=a,n.setEnabled(!1),n}function Ox(e){var t=C_.bullet("bullet",e);(t=new uS("map",e,{vertexSource:"\nprecision highp float;\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec3 normal;\n\nuniform mat4 worldViewProjection;\nuniform mat4 shadowMat;\n\nvarying vec4 vPositionFromLight;\nvarying vec4 vColor;\nvarying float vNormalZ;\n\nvoid main() {\n    vec4 p = vec4(position, 1.);\n    vPositionFromLight = shadowMat * p;\n\tvColor = pow(color, vec4(vec3(0.5), 1.));\n\tvNormalZ = normal.y;\n    gl_Position = worldViewProjection * p;\n}\n\t\t",fragmentSource:"\nprecision highp float;\n\nuniform sampler2D shadowSampler;\n\nvarying vec4 vPositionFromLight;\nvarying vec4 vColor;\nvarying float vNormalZ;\n\nvoid main() {\n    vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tdepth = 0.5 * depth + vec3(0.5);\n\tvec2 uv = depth.xy;// + vec2(1. / 30.);\n    float s = texture2D(shadowSampler, uv).x;\n\n    if (depth.z < s) {\n        s = 1.;\n    } else {\n        s = clamp((depth.z - s) * 80., 0.5, 1.0);\n        s = min(1.0, max(s, length(vPositionFromLight.xy)));\n        s = mix(1., s, vNormalZ);\n    }\n\n    gl_FragColor = vColor * vec4(vec3(s), 1.);\n}\n\t\t"},{attributes:["position","color","normal"],uniforms:["worldViewProjection","shadowMat"],samplers:["shadowSampler"]})).onBind=function(e){var t=e.material.getEffect();t.setMatrix("shadowMat",YN.getTransformMatrix()),t.setTexture("shadowSampler",YN.getShadowMapForRendering())},t=C_.standard("standard",e),t=C_.instanced("standardInstanced",e),(t=C_.shell("shell",e)).onBind=function(e){var t=e.material.getEffect();t.setFloat("u_hp",e.hp),t.setColor3("u_customColor",e.shellColor),t.setDirectColor4("u_teamColor",e.teamColor),t.setFloat2("u_stampPosition",e.stampPositionX,e.stampPositionY),t.setVector2("u_stampOffset",e.stampOffset)},(t=C_.standard("emissive",e)).onBind=function(e){e.material.getEffect().setColor3("u_emissiveColor",e.emissiveColor)},t=C_.colorized("colorized",e),(t=new Og("wireframe",e,!0)).wireframe=!0,(t=new Og("normalBackface",e,!0)).diffuseColor=new Ah(.5,.5,.5),t.ambientColor=new Ah(.5,.5,.5),t.specularColor=new Ah(0,0,0),t.backFaceCulling=!1,t.twoSidedLighting=!0,(t=new Og("muzzleFlash",e,!0)).emissiveColor=Ah.White(),(t=new Og("ui",e,!0)).disableLighting=!0,t.emissiveColor=Ah.White(),t.fogEnabled=!1}function Dx(e,t,i,n,a){var s=t.length,r=this,o=e.getMaterialByName("standard");e.useRightHandedSystem=!0;for(var l=0,c=0,h=0;h<s;h++){var f=a?"models/full/":"models/",u=t[h]+".glb";u+="?"+Ac;let d=Tx.addTask();!function(e,t,a){Hy.ImportMesh("",e,t,a,(function(e,a,h,f){for(var u=0;u<e.length;u++){var m=e[u];if("__root__"!==m.name){if(m.animations=f,"egg"==m.name&&l++,"hands"==m.name){c++;for(let e of m.animations)if(e.name.startsWith("grenade"))for(let t=0;t<e._targetedAnimations.length;t++){let i=e._targetedAnimations[t];if("gripHand"===i.target.name){let e=i.animation;e.enableBlending=!0,e.blendingSpeed=0}}}!Px&&(l>1||c>1)&&(Px=!0,alert("Duplicate egg and/or hand models detected in "+t+".\n\nOpen the weapon models in Blender and make sure egg/hands layers are turned off, then re-export.")),m.setMaterial&&m.setMaterial(o),m.material=o,m.setEnabled(!1),m.isPickable=!1,m.rotationQuaternion&&(m.rotation=m.rotationQuaternion.toEulerAngles(),m.rotationQuaternion=null),"__root__"===m.parent.name&&(m.parent=void 0)}i&&i(m)}0==--s&&n&&n.call(r),Tx.finish(d)}),(function(e){d=Tx.progress(d,e.loaded,e.total)}))}(f,u,e)}}var Lx=[];function Fx(e){sx.init(),(Yb={width:jb.width,height:jb.height+1,depth:jb.depth,surfaceArea:jb.surfaceArea}).data=function(e,t,i,n){for(var a=Array(e),s=0;s<e;s++){a[s]=Array(t);for(var r=0;r<t;r++){a[s][r]=Array(i);for(var o=0;o<i;o++)a[s][r][o]=n||{}}}return a}(Yb.width,Yb.height,Yb.depth),bx=0;for(var t={},i=1;i<Nx.length;i++){var n=Nx[i];t[n.name]=i}var a={};"undefined"==typeof window&&(spawnPoints=[[],[],[]]),Object.keys(jb.data).forEach((function(e){var i=jb.data[e],n=t[e],s=Nx[n];if(n){var r,o,l,c=e.split(".");if(s.theme=c[0],s.shortName=c[1],s.colliderType=c[2],s.softness=c[3],"undefined"==typeof window&&"SPECIAL"==s.theme){if(s.shortName.startsWith("spawn")){for(let e of i)spawnPoints[0].push({x:e.x,y:e.y,z:e.z}),"spawn-blue"==s.shortName?spawnPoints[sc.blue].push({x:e.x,y:e.y,z:e.z}):spawnPoints[sc.red].push({x:e.x,y:e.y,z:e.z});return}if("spatula"==s.shortName){for(let e of i)spatulaSpawnPoints.push({x:e.x+.5,y:e.y+.1,z:e.z+.5});return}}switch(s.colliderType){case"full":r=ax.hk,o=!1,l=!1;break;case"wedge":r=ax.wedgeCollisionMesh,o=!0,l=!1;break;case"iwedge":r=ax.iwedgeCollisionMesh,o=!0,l=!1;break;case"ladder":r=s.colliderMesh,o=!1,l=!1;break;case"aabb":r=s.colliderMesh,o=!1,l=!0;break;case"obb":r=s.colliderMesh,o=!0,l=!0}for(let e of i){void 0===e.ry&&(e.ry=0);var h=e.rx*Math.PI90||0,f=e.ry*Math.PI90||0,u=e.rz*Math.PI90||0;Yb.data[e.x][e.y][e.z]={item:void 0,mesh:s,idx:n,colliderMesh:r,colliderPrecise:o,colliderChildren:l,colliderMatrix:Lh.lt(-f,h,u),rx:h,ry:f,rz:u},r&&Gx(r,sx.Type[s.colliderType],e)}if("capture-zone"==s.shortName)for(let e of i)if(!Yb.data[e.x][e.y][e.z].zone){var d;e.zone=++bx,Yb.data[e.x][e.y][e.z].zone=e.zone,0==e.y&&(console.log("INVALID ZONE",e),Lx.push(e.zone));do{d=0;let t=[{x:-1,z:0},{x:1,z:0},{x:0,z:-1},{x:0,z:1}];for(let n of i)if(!Yb.data[n.x][n.y][n.z].zone)for(let i of t){let t=Ux(n.x+i.x,n.y,n.z+i.z);if(t&&t.zone==e.zone){d++,n.zone=e.zone,Yb.data[n.x][n.y][n.z].zone=e.zone;break}}}while(d>0)}}else a[e]=!0}));var s="";return Object.keys(a).forEach((function(e){s+=e+"\n"})),""!=s&&(console.log("buildMapData error",s),e&&e(s)),t}var kx=new wh,Bx=new wh;function Gx(e,t,i){var n=i.rx*Math.PI90||0,a=i.ry*Math.PI90||0,s=i.rz*Math.PI90||0;Bx.copyFrom(e.position),kx.copyFrom(e.rotation),e.unfreezeWorldMatrix(),e.rotation.copyFromFloats(0,0,0),e.computeWorldMatrix(!0);var r=e.getBoundingInfo().boundingBox.minimumWorld.clone(),o=e.getBoundingInfo().boundingBox.maximumWorld.clone(),l=new af(r,o);l.matrix=Lh.lt(kx.y,kx.x,kx.z),Lh.RotationYawPitchRollToRef(a,n,s,ax.matrix),l.matrix.multiplyToRef(ax.matrix,l.matrix),l.position=new wh(i.x+.5,i.y+.5,i.z+.5),l.colliderType=t,l.cell=i;var c=new af(new wh(i.x,i.y,i.z),new wh(i.x+1,i.y+1,i.z+1));l.bb=c,l.name=e.name;for(var h=e.getChildMeshes(),f=0;f<h.length;f++)h[f].rotationQuaternion=null;sx.add(l),e.position.copyFrom(Bx),e.rotation.copyFrom(kx),e.freezeWorldMatrix();for(h=e.getChildMeshes(),f=0;f<h.length;f++)Gx(h[f],t,i)}function Ux(e,t,i){return e<0||e>Yb.width-1||i<0||i>Yb.depth-1||t<0||t>Yb.height-1?null:Yb.data[e][t][i]}function Hx(e){this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.Ik=0,this.active=!1,this.Xk=null,this.damage=150,this.origin=new wh,this.direction=new wh,this.end=new wh,this.dmgTypeId="",this.Nk=new DL(this)}function Vx(e,t){this.scene=e,this.init(t),this.lastControlTeam=255,this.Nk=new YL(this,e)}function Wx(e){var t=(e=" "+(e=e.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[\u2018\u2019\u201A\u201B]/g,"'").replace(/[\u201C\u201D\u201E\u201F]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/[\u00A0\u2007\u202F]/g," ").replace(/[\u00B4]/g,"'").replace(/[\u02C6]/g,"^").replace(/[\u02DC]/g,"~").replace(/[\u00B5]/g,"u").replace(/[\u00D7]/g,"x").replace(/[\u00F7]/g,"/"))+" ").toLowerCase().replace(/[^a-zA-Z0-9|!\|@|$|;|\xa1]/g,"").replace(/6|g/g,"9").replace(/b/g,"6").replace(/\||l|i|1|;|\xa1/g,"!").replace(/e/g,"3").replace(/a|@/g,"4").replace(/o/g,"0").replace(/s|\$/g,"5").replace(/t/g,"7").replace(/z/g,"2").replace(/7h3|my|y0ur|7h3!r|h!5|h3r/g,""),i=t.search(/( 94y | 455 )/),n=/(n421|5chu72574ff3!|n994|m457ur647|m4r!c4|n!qq4|fck|cn7|57urm4673!!un9|!uf7w4ff3|k!4n|66c|n993r|n!443r|n!99r|m4y473|64ch!ch4|64ch!ch3|c474!uf0|fr4nchu7|fr!j0!3r0|9464ch0|94chup!n|m0r0m!3rd4|54!74mur05|pu74|j0d3r|m0n90|c0n0|c4r4j0|m!3rd4|20rr4|chup4m3!|cu!0|p3nd3j0|c46r0n|0r70|pu70|p!r06|qu33f|455h47|ch04d|cum|k0ck|k0ch|pu74|n!94|n3993r|4fr!c4n|kn336r0|5ch00!5h007|n!qq3r|73rr0r!5t|qu33r|d!ck|w4nk|p!55|7357!c|735735|64!!5|nu75|nu72|j3w|k!k3|r374r|4u7!5|d0wn55|6006|8d|p0rn|5w4!!0w|347m3|347my|d!k|0r4!|5p0093|fuk|j!2|5u!c!d|m4573r6|5p0063|5p3rm|p3nu5|pu55y|6u7753x|fux|6u77h0!3|4n4!|4nu5|k!!!b!4ck5|murd3rb!4ck5|h!7!3r|w3764ck|49!n4|94y|455h0!3|5uck|j3w|5p!c|ch!nk|n!994|n!993|n!663|n!994|n!664|5h!7|6!7ch|fuck|cun7|kkk|wh0r3|f49|7w47|p3n!|r4p3w0m|r4p39!r|r4p!57|r4p3r|r4p3|r4p!n|n!93r|!d!07|c0ck|dum6|5!4v3|7!75|@|455|pu5y|ju!cy|nud3|fk|v!49r4|64n9|53x|h03|d473|h473|d47!n9|d473r|h4ck|h4ck3r|h4ck!n9|60yfr!3nd|9!r!fr!3nd|900k|gf|bf|m0nk3y|m0nk!35|d4ddy|5!u7|pr057!7u7|nud3|33m4!!|d!ckh34d|r374rd|n4993r|n0993r|4d0!f|kn339r0w|6umh0!3|c0kk|cuck|!3573r|!5r43!|p4!357!n3|ph!!3|n3994|f4ck|pr3d470r|pn!5|n!95|fr!ck|m0!3573r|n!94rd!y|m0!357|73rr0r!57|5h!4d|60!!0ck5|7r4n5|64!!649|n!9993r|ky5|60yfr!3nd|9!r!fr!3nd|d0uch3|pu55!35|57473f4rm|5fn37w0rk|n!gh4|5fc|n3g3r|53q|!u57|g3757473)/g,a=(t=t.replace(/ /g,"")).search(n),s=(t=t.replace(/(.)(?=\1)/g,"")).search(n);return i>-1||a>-1||s>-1}function zx(){var e,t=["Captain","Lord","Supreme","Master","Pro","Noob"],i=["Egg","Yolk","Shell","Cluck","Chick","Bird"];do{e=Math.randomInt(1,99)}while(69==e);return 0==Math.randomInt(0,2)?t[Math.randomInt(0,t.length)]+i[Math.randomInt(0,i.length)]+e:i[Math.randomInt(0,i.length)]+t[Math.randomInt(0,t.length)]+e}Hx.position=new wh,Hx.fire=function(e,t,i,n){rP.rocketPool.retrieve().fireThis(e,t,i,n)},Hx.prototype.fireThis=function(e,t,i,n){this.x=t.x,this.y=t.y,this.z=t.z,this.origin.set(this.x,this.y,this.z),this.direction.copyFrom(i).normalize().scaleInPlace(n.velocity),this.dx=this.direction.x,this.dy=this.direction.y,this.Ik=this.direction.z,this.radius=n.radius,this.Xk=e,this.weaponClass=n,this.damage=n.damage,this.active=!0,this.range=n.range,this.minRange=n.minRange,this.velocity=n.velocity,this.dmgTypeId=n.dmgTypeId;var a=ax.Tk(t,i,ax.projectileCollidesWithCell);a&&(this.end.copyFrom(a.pick.pickedPoint),this.range=wh.Distance(t,a.pick.pickedPoint)),this.Nk.fire()},Hx.prototype.remove=function(){rP.rocketPool.recycle(this),this.Nk.remove()},Hx.prototype.update=function(){if(Hx.position.set(this.x,this.y,this.z),this.range<this.velocity&&this.direction.scaleInPlace(this.range/this.velocity),!ax.Bk(Hx.position,this.direction,this)){this.x+=this.dx,this.y+=this.dy,this.z+=this.Ik;var e=this.velocity;return this.range-=e,this.minRange-=e,this.range<=0?(this.x-=this.dx,this.y-=this.dy,this.z-=this.Ik,void(this.minRange<=0?this.explode():this.poof())):void 0}},Hx.prototype.collidesWithPlayer=function(e){this.minRange<=0?this.explode():this.poof()},Hx.prototype.explode=function(){this.remove()},Hx.prototype.poof=function(){Hx.position.set(this.x,this.y,this.z),Ib.play("gun_rpegg_rocket_poof",Hx.position);for(var e=0;e<10;e++){var t=.2*Math.random()-.1,i=.2*Math.random()-.1,n=.2*Math.random()-.1;PP(xb,10,this.x,this.y,this.z,t,i,n,.4,!1,0)}this.remove()},Vx.prototype.init=function(e){this.x=e.x,this.y=e.y,this.z=e.z,this.dx=0,this.dy=0,this.Ik=0,this.cM=255,this.controlledByTeam=255},Vx.prototype.capture=function(e){var t;CO.id==e.id&&((t=document.getElementById("spatulaPlayer")).classList.remove("drop"),t.classList.add("capture"));e.team!=this.lastControlTeam&&(dO.teamScore[e.team]=0),this.cM=e.id,this.controlledByTeam=e.team,this.lastControlTeam=e.team,e.ctsCapture(e.xt),this.Nk.capture(e),BAWK.play("capture_spatula"),(t=document.getElementById("teamScoreNum"+e.team)).innerText=dO.teamScore[e.team]},Vx.prototype.drop=function(){var e=Jb[this.cM];e.ctsCapture(!1),this.cM=255,this.controlledByTeam=255,this.x=e.Ek,this.y=e.Zk,this.z=e.ek,this.dy=e.dy+.05;var t=document.getElementById("spatulaPlayer");t.classList.remove("capture"),t.classList.add("drop"),this.Nk.drop()},Vx.prototype.respawn=function(){var e=spatulaSpawnPoints.length,t=spatulaSpawnPoints[Math.randomInt(0,e)];this.init(t);let i=Tc.getBuffer();dO.packState(i),sendToAll(i)},Vx.prototype.update=function(){this.dy-=.012*rx.value.gravity,this.dy=Math.max(-.29,this.dy);var e=Vx.Kk;e.copyFromFloats(this.x,this.y,this.z),this.move(this.dx,this.dy,this.Ik),this.dx=this.x-e.x,this.dy=this.y-e.y,this.Ik=this.z-e.z},Vx.prototype.move=function(e,t,i){if(255==this.cM){let e=Vx.wk,t=Vx.Jk,i=Vx.ak,a=Vx._k;this.y+=.31,a.copyFromFloats(0,this.dy,0),Math.capVector3(a,.29),e.copyFromFloats(this.x,this.y,this.z),e.addInPlace(a),e.x=Math.clamp(e.x,.1,Yb.width-.1),e.z=Math.clamp(e.z,.1,Yb.depth-.1);for(var n=0;n<8;n++){if(!sx.sphereCollidesWithStructure(e,.31,t,i))break;i.y<-.707&&(this.dy=0),t.x=0,t.z=0,e.addInPlace(t)}8==n&&(a.scaleInPlace(.9),e.subtractInPlace(a)),this.x=e.x,this.y=e.y,this.z=e.z}else{var a=Jb[this.cM];a&&(this.x=a.Ek+.3*Math.sin(a.Qk),this.y=a.Zk,this.z=a.ek+.3*Math.cos(a.Qk))}this.y-=.31},Vx.wk=new wh,Vx.Jk=new wh,Vx.ak=new wh,Vx._k=new wh,Vx.Kk=new wh,Vx.prototype.collidesWithMap=function(){return Vx.wk.set(this.x,this.y,this.z),ax.meshCollidesWithMap(ax.playerCollisionMesh,Vx.wk)};var Xx,Yx=class{get kills(){return this._kills}end(){this.endTime=this.getPlayTimeInGame(),this.getPlayTime()}updateTerminus(e,t,i,n){this.charClass[e][t][i]++,this.charClass[e][i]++,this.weapons[t][i]++,this[i]++,n&&this.suicides++}getPlayTimeInGame(){if(!this.sessionStart)return"0:00";const e=Date.now()-this.sessionStart,t=(e%6e4/1e3).toFixed(0);return Math.floor(e/6e4)+":"+(t<10?"0":"")+t}set kills(e){this._kills=e,this.getRatio()}constructor(){this.kills=0,this.deaths=0,this.suicides=0,this.streak=0,this.weapons={},this.sessionStart=0,this.sessionEnd=0,this.endTime=0,this.playTime=0,this.ratio=0,this.charClass={},this.init()}getStats(){return{kills:this.kills,deaths:this.deaths,suicides:this.suicides,weapons:this.weapons,charClass:this.charClass,playTime:this.getPlayTimeInGame(),endTime:this.endTime,ratio:this.ratio}}set deaths(e){this._deaths=e,this.getRatio()}get deaths(){return this._deaths}setupWeapons(){lc.forEach((e=>this.weapons[e.name]={deaths:0,kills:0})),Object.keys(_c).forEach((e=>this.charClass[e]=JSON.parse(JSON.stringify(this.weapons)))),Object.keys(this.charClass).forEach((e=>{this.charClass[e].kills=0,this.charClass[e].deaths=0})),console.log(this.charClass)}init(){this.setupWeapons(),this.start()}start(){this.sessionStart=Date.now()}getPlayTime(){this.sessionEnd=Date.now()-this.sessionStart;const e=(this.sessionEnd%6e4/1e3).toFixed(0);this.playTime=Math.floor(this.sessionEnd/6e4)+":"+(e<10?"0":"")+e}getRatio(){this.ratio=Math.floor(this.kills/Math.max(this.kills+this.deaths,1)*100)}},jx=class{deleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}hashString(e){let t="number"==typeof e?e.toString():e,i=0;for(let e=0;e<t.length;e++){i=(i<<5)-i+t.charCodeAt(e),i|=0}return i}getIsNewVariant(){return this.isNewVariant}getAssignedVariant(){return this.assignedVariant||(this.assignedVariant=this.getCookie(this.cookieName)),this.assignedVariant}setCookie(e,t,i){const n=i??this.expires;let a="";if(n){const e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),a="; expires="+e.toUTCString()}document.cookie=`${e}=${t||""}${a}; path=/`}getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}getOrCreateRandID(){let e=this.getCookie(this.randIDCookieName);return e||(e=this.createUniqueID(),this.setCookie(this.randIDCookieName,e,this.expires),this.isNewRandID=!0),this.randID=e,this.randID}assignABTestVariant(){const e=this.randID||this.getOrCreateRandID(),t=(this.hashString(e)%100+100)%100;let i=0,n="control";for(const[e,a]of Object.entries(this.groupPercentages))if(i+=a,t<i){n=e;break}let a=this.getCookie(this.cookieName);return a||(this.setCookie(this.cookieName,n,this.expires),this.isNewVariant=!0,a=n),this.assignedVariant=a,this.assignedVariant}usePlayerId(){this.randID=xc.playerAccount.id,this.isNewrandID=!1}constructor(e=yc,t="shell_ab_variant",i="shell_rand_id",n=365){this.groupPercentages=e,this.isNewRandID=!1,this.isNewVariant=!1,this.randID=null,this.assignedVariant=null,this.cookieName=t,this.randIDCookieName=i,this.expires=n;const a=Object.values(e).reduce(((e,t)=>e+t),0);if(a>100)throw new Error("Group percentages exceed 100%. Adjust the distribution.");this.controlPercentage=100-a}createUniqueID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},Kx=(e,t)=>{console.log("%c%s","color: white; background: #006700; padding: 2px 6px; border-radius: 3px; margin-right: 5px;","Chick'n Winner",e,t||"")};function $x(e){Kx("checkStartChicknWinner() success");const t=Math.trunc(Date.now()/1e3),i=e;if(console.log("api_chicknWinnerPlayerRewardCheck data",i),i&&Object.keys(i).length>0){const{reset:e,limit:n,span:a=1,period:s}=i;qx(n<=dc.dailyLimit?t+a:t+s,n<=dc.dailyLimit?dc.cooldown:dc.dailyCooldown,n,e)}vueApp.chicknWinnerError(!1)}function qx(e,t,i,n=0){dI&&(dI.clearTimer(),dI=null),dI=new fb(e,t,i,n)}function Jx(e){var t,i;qx(Math.trunc(Date.now()/1e3)+1,dc.cooldown,0),Kx("checkStartChicknWinner() start"),e?$x(e):(t=$x,i=e=>Zx("checkStartChicknWinner()",e.error),ib({cmd:"chicknWinnerReady",id:xc.playerAccount.id,sessionId:xc.playerAccount.sessionId},t,i))}function Qx(){yI.isChwRequest?sb((e=>{yI.isChwRequest=!1;const t=e.result;if(Kx(`getIncetivizedReward() response ${t}`),"SUCCESS"!==t)return void("SESSION_EXPIRED"===t&&Zx("getIncetivizedReward",t));const i=dI.count?dI.count:"free";if(e.reward.itemIds.length>0){const t=xc.catalog.findItemById(e.reward.itemIds[0]);xc.playerAccount.addToInventory(t,!0),t&&(ga("send","event","Chickn Winner","Reward",`${i} - item`),(e.reward_lvl||e.reward.rewardTier)&&ga("send","event","Chickn Winner","Reward item",`${t.name} - ${e.reward.rewardTier?e.reward.rewardTier:e.reward_lvl}`))}e.reward.eggsGiven&&e.reward.eggsGiven>0&&(ga("send","event","Chickn Winner","Reward",`${i} - ${e.reward.eggsGiven}`),ga("send","event","Chickn Winner","Reward amount",`${e.reward.eggsGiven}`)),vueApp.chw.reward.ownedItem=e.ownedItemId,vueApp.chw.reward.eggs=e.reward.eggsGiven,e.reward.itemIds.forEach((e=>vueApp.chw.reward.itemIds.push(e))),vueApp.chicknWinnerError(!1),vueApp.showChicknWinnerPopup()}),(e=>Zx("getIncetivizedReward",e.error))):Kx("getIncetivizedReward() Request called directly. CHW not played")}function Zx(e,t){vueApp.chicknWinnerError(!0),vueApp.chwOnClick(!1),hasValue(t)&&("SESSION_EXPIRED"===t?vueApp.showGenericPopup("session_expired","session_expired_msg","ok"):vueApp.showGenericPopup("uh_oh","purchase_disabled","ok"),e&&console.log(`${e} fail: `,t))}var eb=class e{static update(){for(var t=0;t<e.inputs.length;t++){var i=e.inputs[t];if(Date.now()-i<100)switch(t){case e.jump:break;case e.fire:CO.pullTrigger()&&e.remove(t);break;case e.swap:CO.swapWeapon(0==CO.zk?1:0)&&e.remove(t);break;case e.reload:CO.reload()&&e.remove(t);break;case e.melee:CO.melee()&&(Xx||(ga("send","event","weapon","triggered","Melee"),Xx=!0),e.remove(t))}}!CO.triggerPulled||Gb&Rx.fire||CO.releaseTrigger()}static add(t){e.inputs[t]=Date.now()}static remove(t){e.inputs[t]=0}static init(){e.inputs=[0,0,0,0,0],Xx=!1}};eb.jump=0,eb.fire=1,eb.swap=2,eb.reload=3,eb.melee=4,parsedUrl.query.adTest&&(QM=!0);var tb=class{showAdBlockerVideo(){vueApp.showAdBlockerVideo(),setTimeout((()=>{vueApp.hideAdBlockerVideo(),vueApp.gameUiRemoveClassForNoScroll(),crazyGamesActive||testCrazy?this.onVideoAdCompleted():this.afterVideoAdComplete()}),1e4)}ADSLOG(e,t,i){console.log("%c%s",`color: white; background: #${e}; padding: 2px 6px; border-radius: 3px; margin-right: 5px;`,t,i)}get adBlocker(){return this.adsBlocked}cgAdFinished(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"ended.",e),vueApp.setDarkOverlay(!1),this.cgErr&&(this.didVideoPlay=!1,this.rewardedAdPlayed=!1),this.onVideoAdCompleted("3C1E6E",this.cgErrTxt),this.cgRmListeners(),this.cgErr=!1,crazySdk.thirdPartyAdblocker&&vueApp.hideAdBlockerVideo()}cgAdError(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"error.",e),this.cgErr=!0,this.didVideoPlay=!1,this.cgAdFinished()}afterVideoAdComplete(e){this.ADSLOG("F79520","Shell Shockers AIP","afterVideoAdComplete"),this.isChwRequest||null!==this.challengeRerollRequest||vueApp.setDarkOverlay(!1),e&&!["video-ad-skipped","video-ad-completed"].includes(e)?this.error(e):this.didVideoPlay=!0,this.onVideoAdCompleted("F79520","Shell Shockers AIP")}completedChwReward(){this.didVideoPlay?Qx():(this.isChwRequest=!1,vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok"))}initializeAipPlayer(){sM=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!1,AD_CENTERPLAYER:!0,LOADING_TEXT:"loading advertisement",PREROLL_ELEM:()=>document.getElementById("preroll"),AIP_COMPLETE:e=>{this.ADSLOG("F79520","Shell Shockers AIP_COMPLETE",e),this.afterVideoAdComplete(e),ga("send","event","aip-complete","regular",e)},AIP_REMOVE:()=>{},AIP_REWARDEDCOMPLETE:e=>{this.ADSLOG("F79520","Shell Shockers AIP Reward Complete",e),this.afterVideoAdComplete(e),ga("send","event","aip-complete","reward",e)},AIP_REWARDEDGRANTED:e=>{this.ADSLOG("F79520","Shell Shockers AIP Reward Granted",e),this.rewardedAdPlayed=!0,ga("send","event","aip-complete","reward-granted",e)}})}completedPlayerChallengeReroll(e,t,i){if(vueApp.setDarkOverlay(!1),this.didVideoPlay){const n=e;this.ADSLOG(t,i,`Trying reroll for challenge id: ${n}`),ob(n,(e=>{if(e.challengeId===n)console.log("Challenge slot already rerolled!!!");else{const t=CI.challengeGet(n);ga("send","event","dailyChallenge","reroll",t.loc_ref),xc.playerAccount.challenges=e,CI.resetInGame()}}),(e=>{console.log("playerChallengesReroll error: ",e.error),vueApp.showGenericPopup("uh_oh","chlg_no_challenges","ok")})),this.completedDefault()}else vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok")}cgRequestAd(){this.cgListeners(),crazySdk.requestAd(this.cgAdType,this.cgCallBacks),this.cgAdType="midgame"}onVideoAdCompleted(e,t){this.isChwRequest?this.completedChwReward():null!==this.challengeRerollRequest?this.completedPlayerChallengeReroll(this.challengeRerollRequest,e,t):this.completedDefault(),VL(),this.didVideoPlay=!1,this.challengeRerollRequest=null,this.rewardedAdPlayed=!1,this.callback&&(this.callback(),this.callback=null),this.adUnit=null}setAdVideoLocalStorage(){localStore.setItem("lastPreRoll",Date.now())}error(e){e&&this.ADSLOG("F79520","Shell Shockers AIP video error: ",e);const t=this.isChwRequest,i=this.isPlayingVideoAd;"user-has-adblock"===e&&this.adBlockerDetected(),vueApp.chwOnClick(!1),this.didVideoPlay=!1,this.isChwRequest=!1,this.isPlayingVideoAd=!1,i&&t&&ab((()=>{xc.playerAccount.isUpgraded()||t&&(vueApp.showGenericPopup("chw_video_error_title","chw_video_error_msg","ok"),Jx())}))}cgAdStarted(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"started.",e),bM&&vueApp.hideGameMenu(),vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame),this.isPlayingVideoAd=!0,this.didVideoPlay=!0,VL(0)}preroll(){this.adBlocker?(this.ADSLOG("F79520","Shell Shockers AIP","Ad blocker detected."),this.showAdBlockerVideo()):void 0!==sM?aiptag.cmd.display.hasOwnProperty("push")&&aiptag.cmd.player.hasOwnProperty("push")?aiptag.cmd.player.push((()=>{try{this.ADSLOG("F79520","Shell Shockers AIP",`Play: ${this.adUnit}`),vueApp.gameUiAddClassForNoScroll(),bM&&(vueApp.hideGameMenu(),vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame)),sM.startPreRoll(this.adUnit)}catch(e){this.error(e),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error")}})):(this.error("push method missing"),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error")):(this.error("aipPrerollPlayer undefined"),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error"))}isAdBlocking(){return crazyGamesActive?crazySdk.thirdPartyAdblocker:this.adBlocker}set adBlocker(e){this.adsBlocked=e,this.adsBlocked&&!xc.productBlockAds&&this.adBlockerDetected()}play(e,t){if(this.adUnit=e,this.callback=t,QM&&this.ADSLOG("F79520","Shell Shockers AIP","AD test active"),testCrazy&&this.ADSLOG("3C1E6E","CG video ad","Crazy Games test ads"),this.ADSLOG("F79520","Shell Shockers AIP",`Play video ads Ad unit: ${this.adUnit}`),this.isChwRequest||null!==this.challengeRerollRequest||this.setAdVideoLocalStorage(),crazyGamesActive)return this.ADSLOG("3C1E6E",this.cgErrTxt,"Crazy Game video ad request."),(this.isChwRequest||null!==this.challengeRerollRequest)&&(this.cgAdType="rewarded"),void this.cgAdRequested();vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame),VL(0),this.isPlayingVideoAd=!0,this.preroll()}init(){if(pokiActive||crazyGamesActive||xc.productBlockAds)return this.adInPlayActive=!1,void console.log("initAdInPlay Cancelled. Is portal?",pokiActive||crazyGamesActive);try{this.ADSLOG("F79520","Shell Shockers AIP","AIP init success!"),this.adInPlayActive=!testCrazy,aiptag.cmd.player.push((()=>{this.initializeAipPlayer(),this.checkAdBlocker()})),abTestNoobNoAdsSetAIPSubid()}catch(e){this.ADSLOG("F79520","Shell Shockers AIP",`AIP error message: ${e}`),this.error(e)}}adBlockerDetected(){vueApp.chwAdBlockerDetected(),this.adInPlayActive=!1}cgAdRequested(){this.ADSLOG("3C1E6E",this.cgErrTxt,"requested."),crazySdk.thirdPartyAdblocker?(this.showAdBlockerVideo(),setTimeout((()=>this.cgRequestAd()),1e4)):this.cgRequestAd()}constructor(){this.rewardedAdPlayed=!1,this.didVideoPlay=!1,this.adsBlocked=!1,this.isPlayingVideoAd=!1,this.callback=null,this.adUnit=null,this.isChwRequest=!1,this.challengeRerollRequest=null,this.cgAdType="midgame",this.cgErr=!1,this.cgErrTxt="CG video ad",this.cgCallBacks={adFinished:this.cgAdFinished.bind(this),adError:this.cgAdError.bind(this),adStarted:this.cgAdStarted.bind(this)}}cgListeners(){this.ADSLOG("3C1E6E",this.cgErrTxt,"add eventListeners")}checkAdBlocker(){this.adBlocker=aipAPItag&&aipAPItag.hasOwnProperty("sdkBlocked")&&aipAPItag.sdkBlocked}cgRmListeners(){this.ADSLOG("3C1E6E",this.cgErrTxt,"remove eventListeners"),vueApp.setDarkOverlay(!1)}completedDefault(){bM&&(vueApp.disableRespawnButton(!1),vueApp.showGameMenu(),AP()),vueApp.gameUiRemoveClassForNoScroll()}};function ib(e,t,i,n){console.log("'{0}' api command".format(e.cmd));try{console.log("services server: "+xc.servicesServer);var a=new WebSocket(xc.servicesServer)}catch(e){console.log(e)}e&&!e.hasOwnProperty("sessionId")&&xc.playerAccount.hasOwnProperty("sessionId")&&(e.sessionId=xc.playerAccount.sessionId),a.onopen=function(t){a.send(JSON.stringify(e)),console.log("servicesWs opened, and "+e.cmd+" request sent")},a.onmessage=function(n){var s=null;try{s=JSON.parse(n.data)}catch(e){return console.log("Invalid data returned from services API",e.data),void i(e)}s.error?(console.log(e.cmd+" error: "+JSON.stringify(s.error)),i(s)):t(s),a.close()},a.onclose=function(t){console.log(e.cmd+" servicesWs closed, code: "+t.code,"reason: "+t.reason,"clean: "+t.wasClean),n&&n(t.code)},a.onerror=function(t){console.log(e.cmd+" servicesWs error: "+JSON.stringify(t)),Tx.hide(),i(t)}}function nb(){ib({cmd:"checkBalance",firebaseId:xc.playerAccount.firebaseId},(function(e){console.log("Check Balance response: "+JSON.stringify(e)),e.error?console.log("Check Balance call failed: "+JSON.stringify(e.error)):xc.playerAccount.setEggBalances(e.currentBalance)}),(function(){console.log("Error running check balance call")}))}function ab(e,t){!function(e,t){ib({cmd:"checkUpgrade",firebase_id:xc.playerAccount.firebaseId,session:xc.playerAccount.session,sessionId:xc.playerAccount.sessionId},e,t)}((function(t){xc.playerAccount.setUpgrade(t),!xc.playerAccount.isUpgraded()&&bM&&(document.getElementById("chickenBadge").style.display="none"),xc.productBlockAds=xc.playerAccount.isUpgraded(),xc.productBlockAds&&vueApp.runProductCheck(),e&&e(t)}),(function(e){t&&t(e),console.log("Error checking account upgrade status")}))}function sb(e,t){if(!yI.isChwRequest)return void console.log("api_incentivizedVideoRewardRequest() API called directly. chw not played");ib({cmd:"incentivizedVideoReward",token:wM,id:xc.playerAccount.id,firebaseId:xc.playerAccount.firebaseId,sessionId:xc.playerAccount.sessionId},e,t)}oI&&console.log("adTagDebug debug is on"),setTimeout((()=>{const e=e=>e&&e.toString().includes("[native code]");e(window.fetch)&&e(window.Function)&&e(window.eval)&&e(window.XMLHttpRequest)||(nc.Qt=nc.J,nc.wt=nc.J)}),6e4*Math.random()+2e4),function(){const e="#######";let t=document.currentScript.textContent.replace(e,"#######"),i=0;for(let e=0;e<t.length;e++)i+=t.charCodeAt(e);i%=1e6,i!==parseInt(e)&&(nc.Qt=nc.J)}(),xc.api_saveLoadout=function(e,t){var i,n={cmd:"saveLoadout",firebaseId:xc.playerAccount.firebaseId,save:"undefined"==typeof checkStatus||checkStatus(),loadout:e};t&&(i=setTimeout((()=>{t()}),5e3)),ib(n,(function(e){console.log("Save Loadout response: "+JSON.stringify(e)),e.error?console.log("Save Loadout call failed: "+JSON.stringify(e.error)):console.log("Successfully saved player loadout"),t&&(clearTimeout(i),t())}),(function(){console.log("Error running save loadout call")}))},xc.checkUpgrade=ab;var rb=(e,t,i)=>ib({cmd:"urlRewardParams",reward:e,firebaseId:xc.playerAccount.firebaseId,sessionId:xc.playerAccount.sessionId},t,i);function ob(e,t,i){ib({cmd:"challengeRerollSlot",slotId:e,sessionId:xc.playerAccount.sessionId},t,i)}var lb=(e,t)=>{ib({cmd:"challengeGetDaily",playerId:xc.playerAccount.id,sessionId:xc.playerAccount.sessionId},e,t)},cb=()=>{ib({cmd:"getEggOrgLeaderBoard"},(e=>function(e){vueApp.eggOrgUpdateGlobalLeaderBoards(e)}(e)),(e=>console.log("eggOrg leaderboard error",e)))};function hb(e){this.scene=e.scene,this.bullet=e,this.delayFrames=0,this.dk=this.scene.getMeshByName("bullet").createInstance(""),this.dk.setEnabled(!1)}hb.prototype.fire=function(e){this.delayFrames=3,e?(this.dk.scaling.x=2,this.dk.scaling.y=2):(this.dk.scaling.x=1,this.dk.scaling.y=1),this.dk.position.x=this.bullet.x,this.dk.position.y=this.bullet.y,this.dk.position.z=this.bullet.z,this.dk.lookAt(new wh(this.bullet.x+this.bullet.dx,this.bullet.y+this.bullet.dy,this.bullet.z+this.bullet.Ik)),this.dk.scaling.z=.5},hb.prototype.update=function(e){this.delayFrames>0?this.delayFrames--:this.dk.setEnabled(!0),this.dk.position.x+=.5*(this.bullet.x-this.dk.position.x),this.dk.position.y+=.5*(this.bullet.y-this.dk.position.y),this.dk.position.z+=.5*(this.bullet.z-this.dk.position.z),this.bullet.Xk.id!=RO&&(this.dk.scaling.z=Math.min(this.dk.scaling.z+.03,3))},hb.prototype.remove=function(){this.dk.setEnabled(!1)};var fb=class e{startTimer(){this.timer||(this.timer=setInterval((()=>this.updateTimerData()),1e3))}init(){this.limitReached=this.count>dc.dailyLimit,this.startTimer()}clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}constructor(e,t,i,n){this.watchedCount=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0,this.progress=1,this.timer=null,this.reset=n||0,this.gap=0,this.end=e,this.span=t,this.limitReached=!1,this.ready=!1,this.count=i||0,this.init()}calculateTimeRemaining(){this.days=Math.floor(this.gap/e.SECONDS_IN_A_DAY);let t=this.gap-this.days*e.SECONDS_IN_A_DAY;this.hours=Math.floor(t/e.SECONDS_IN_AN_HOUR),t-=this.hours*e.SECONDS_IN_AN_HOUR,this.minutes=Math.floor(t/e.SECONDS_IN_A_MINUTE),this.seconds=t%e.SECONDS_IN_A_MINUTE,vueApp.chwUiTimerUpdate(this.hours,this.minutes,this.seconds,this.progress,this.ready,this.limitReached,this.count,this.reset)}updateTimerData(){const e=Math.trunc(Date.now()/1e3);this.gap=Math.max(this.end-e,0),this.progress=Math.floor((this.span-this.gap)/this.span*100),this.progress<100?this.calculateTimeRemaining():(this.ready=!0,this.clearTimer(),vueApp.chwUiTimerUpdate(0,0,0,0,!0,this.limitReached,this.count,this.reset))}};fb.SECONDS_IN_A_DAY=86400,fb.SECONDS_IN_AN_HOUR=3600,fb.SECONDS_IN_A_MINUTE=60;var ub,db,mb,pb,_b,vb,gb,Sb,yb,Eb,Ab,Cb,Rb,Tb,Nb,Mb,Ib,xb,bb,Pb,wb,Ob,Db,Lb,Fb,kb,Bb,Gb,Ub,Hb,Vb,Wb,zb,Xb,Yb,jb,Kb,$b,qb,Jb,Qb,Zb,eP,tP,iP,nP,aP,sP,rP,oP,lP=new wh,cP=new wh,hP=0,fP=!1,uP=new wh,dP=!1,mP=[0,0,0];function pP(){console.log("startGame()");var e=document.getElementById("onesignal-bell-container");Tb=Date.now(),e&&(e.style.display="none"),Cb=!1,Jb=[],Nb=[],ub=-1,vueApp.game.respawnTime=0,CO=null,$b=null,Pb=!1,iP=null,Gb=0,sI=!0,dP=!1,kb=!1,gb=new jL,yb=performance.now(),aP=0,KM=0,tM=0,iM=0,nM=-1,aM=0,0,Eb=0,Ub=0,Hb=0,Vb=0,KN=Date.now(),Date.now()+1e3,Xb=qI(xc.engine),IM.autoDetail||(Xb.shadowsEnabled=IM.shadowsEnabled),Xb.autoClear=!0,Xb.autoClearDepthAndStencil=!0,jN=new yv("camera",wh.Zero(),Xb),Xb.activeCameras.push(jN),jN.maxZ=1e3,jN.Lt=1.25,jN.minZ=.05,BAWK.attach(jN.globalPosition,uP),(db=new Qv("uiCamera",new wh(0,0,-1),Xb)).mode=fd.ORTHOGRAPHIC_CAMERA,db.layerMask=536870912,db.autoClear=!1,Xb.activeCameras.push(db),Qb=new Zv("",2048,Xb,!0,2),(Zb=new Gg("","",18,{width:512,height:256},Xb)).fogEnabled=!1,Zb.texture=Qb,MO=JN==rc.teams||JN==rc.ctf||JN==rc.king,(eP=new Gg("","img/particles.webp?"+Ac,18,128,Xb)).fogEnabled=!0,Ox(Xb),window.onfocus=function(){yb=performance.now(),CO&&function(){if(!bM)return;dO.suppressSound=!0;var e=Tc.getBuffer();e.BkMzMvJt(nc.M),e.send(uO)}()},window.onblur=function(){},document.onpointerlockchange=function(){!document.pointerLockElement&&CO&&_P()},document.body.style.overflow="hidden",eb.init(),async function(e,t){if(console.log("loadMap()"),ax.init(Xb),OM)jb=JSON.parse(localStore.getItem("mapBackup"));else{var i=Sx[e].filename,n=await fetch("maps/"+i+".json?"+Sx[e].hash);jb=await n.json(),console.log("MAP: "+i),vueApp.setGameDataUi(jb.name)}jb.sun?Xb.sunLight={direction:new wh(jb.sun.direction.x,jb.sun.direction.y,jb.sun.direction.z),diffuse:Ah.FromHexString(jb.sun.color)}:Xb.sunLight={direction:new wh(.2,1,.1),diffuse:Ah.White()};jb.ambient?Xb.ambientColor=Ah.FromHexString(jb.ambient):Xb.ambientColor=new Ah(.2,.2,.2);jb.fog?(console.log("FOG:",jb.fog),jb.fog.density>0?(Xb.fogMode=dv.FOGMODE_EXP2,Xb.fogColor=Ah.FromHexString(jb.fog.color),Xb.fogDensity=jb.fog.density,Xb.fogEnabled=!0):(Xb.fogEnabled=!1,Xb.fogDensity=0)):(Xb.fogMode=dv.FOGMODE_EXP2,Xb.fogColor=new Ch(.5,.55,.6,1),Xb.fogDensity=.01);jb.extents.x.min=0,jb.extents.y.min=0,jb.extents.z.min=0,await new Promise((e=>{var t=setInterval((()=>{TM&&(clearInterval(t),vueApp.assetLoaded(),e())}),100)}));var a=Fx((function(e){alert("The following map meshes were not found:\n\n"+e+"\nTry clearing your cache and reload the page!")}));if(iF.yM(Xb,a,jb,null,null,((e,t)=>{vueApp.assetLoaded(),(tP=iF.stripTris(Yb.data,Nx,e,t)).position.set(.5,.5,.5),tP.bakeCurrentTransformIntoVertices(),tP.receiveShadows=!0,r()})),Mb=[],JN==rc.king)for(var s=1;s<=bx;s++)iF.yM(Xb,a,jb,"DYNAMIC.capture-zone.none",s,((e,t)=>{if(e){let i=new wh;for(let e of t)i.x+=e.x,i.y+=e.y,i.z+=e.z;i.scaleInPlace(1/t.length),i.x+=.5,i.y+=.6,i.z+=.5,e.capIconPosition=i,e.position.set(.5,.5,.5),e.material=Xb.getMaterialByName("colorized"),e.material.colorNode=e.material.getBlockByName("color"),e.sideOrientation=Am.BACKSIDE,Mb.push(e)}}));async function r(){var t;if(function(){Xb.clearColor=Ah.Black(),(Kb=new vv("",new wh(0,-1,0),Xb)).lightmapMode=mv.LIGHTMAP_SHADOWSONLY,Kb.intensity=1.2,Kb.autoUpdateExtends=!1,Kb.shadowMinZ=.1,Kb.shadowMaxZ=100,Kb.shadowFrustumSize=15,Kb.diffuse=Ah.Black(),Kb.specular=Ah.Black(),(YN=new Sv(1024,Kb)).forceBackFacesOnly=!0,YN.depthScale=100,YN.frustumEdgeFalloff=3,YN.onBeforeShadowMapRenderObservable.add((()=>{xc.engine.setAlphaMode(Md.ALPHA_COMBINE)})),YN.onAfterShadowMapRenderObservable.add((()=>{xc.engine.setAlphaMode(Md.ALPHA_DISABLE)}));var e=new pv("",new wh(0,-1,0),Xb);e.intensity=.6,e.groundColor=new Ah(.3,.3,.3);let t=new vv("",Xb.sunLight.direction.negate(),Xb);t.intensity=1.2,t.diffuse=Xb.sunLight.diffuse}(),OM?(t=localStorage.getItem("lightmap"),t=JSON.parse(t)):t=await async function(e,t){var i=await fetch(e),n=i.body.getReader(),a=+i.headers.get("Content-Length"),s=0,r=[];for(;;){var{done:o,value:l}=await n.read();if(o)break;r.push(l),s+=l.length,t&&t(s,a)}var c=new Uint8Array(s),h=0;for(var f of r)c.set(f,h),h+=f.length;var u=new Uint8Array(c);return u}("maps/"+i+".lightmap?"+Sx[e].hash,((e,t)=>{})),t){var n=tP.getVerticesData($h.ColorKind);vueApp.assetLoaded();for(var a=0,s=0;a<t.length;a+=3,s+=4)n[s]=t[a]/255,n[s+1]=t[a+1]/255,n[s+2]=t[a+2]/255;tP.updateVerticesData($h.ColorKind,n)}if(tP.material=Xb.getMaterialByName("map"),tP.material.sideOrientation=Am.CounterClockWiseSideOrientation,tP.freezeWorldMatrix(),!GM){var r=jb.skybox||"default",l=ey.$t("skyBox",{size:200},Xb);l.infiniteDistance=!0;var c=new Og("skyBox",Xb);c.backFaceCulling=!1,c.fogEnabled=!1,c.reflectionTexture=new Eg("img/skyboxes/"+r+"/skybox",Xb),c.reflectionTexture.coordinatesMode=yp.SKYBOX_MODE,c.diffuseColor=new Ah(0,0,0),c.specularColor=new Ah(0,0,0),l.material=c,l.rotation.y=Math.PI}let h=Date.now()-Tb;h>3e3?o():setTimeout((()=>o()),3e3-h)}function o(){console.log("Now complete"),vueApp.assetLoaded(),setTimeout((()=>{OM&&Tx.hide(),setTimeout((()=>{vueApp.hideSpinner()}),600),vueApp.progressBarReset(),crazySdk.showInviteButton({crazyShare:QN}),ga("send","timing","load","mapLoaded",Math.round(performance.now())-Math.round(MM),jb.name),t()}),100)}}(ZN,WP),gI&&(gI=!1),async function(){const e=function(){const e=navigator.userAgent.match(/Chrome\/(\d+)\./);if(e&&e.length>1)return parseInt(e[1],10);return null}();if(!e||e<131)return;try{const e=await navigator.permissions.query({name:"pointer-lock"});"denied"===e.state&&(Qw(),MI=!1),e.onchange=()=>{"denied"===e.state?(bM&&(Qw(),Jw()),MI=!1):"granted"===e.state&&(MI=!0)}}catch(e){console.error("Error checking Pointer Lock permission:",e)}}()}function _P(){Aw=null,Gb=0,CO.MM=0,CO.releaseTrigger(),setTimeout((()=>{var e=Tc.getBuffer();e.BkMzMvJt(nc.i),e.send(uO),CO.resetCountdowns(),EP(!xM||xc.productBlockAds||pokiActive?5:10)}),100),sI=!0,vueApp.statsLoading(),yD.set((function(){CO.removeFromPlay(),DD()}),3e3),console.log("pausing game via pointerlock exit"),SP(),crazySdk.gameplayStop()}function vP(e){vb||bM&&!sI&&document.pointerLockElement&&(document.exitPointerLock(),console.log("pausing game on key: ",e))}function gP(){document.pointerLockElement?(console.log("pausing game and breaking pointerlock"),document.exitPointerLock()):(console.log("pausing game via esc key"),SP())}function SP(){if(vueApp.showScreen===vueApp.screens.equip)return;cb(),lb((e=>{xc.playerAccount.challenges=e}),(e=>console.log("playerChallengesData error",e.error))),sI=!0,kb=!1,SD.clear(Sb),nP=!0,rw(),$w(),vueApp.setPause(sI),vueApp.showGameMenu(),vueApp.showWelcomeBundleCtaInGame(),aw(),document.getElementById("grenadeThrowContainer").style.visibility="hidden";["weaponBox","healthContainer","killTicker","spectate","captureIconContainer"].forEach((e=>document.getElementById(e).style.display="none")),document.getElementById("serverAndMapInfo").style.display="block",document.getElementById("chw-game-screen").style.display="block",document.getElementById("playerList").style.pointerEvents="auto";const e=document.getElementById("gameAdContainer");e&&(e.style.display="block"),Db.hide(),Db.hideDot(),vb&&rM.focus(),!1,Ab||(Ab=document.querySelector(".chat-container")),setTimeout((()=>{Ab.scrollTop=Ab.scrollHeight,tD()}),300)}function yP(){if(console.log("resumeGame called"),CO){sI=!1,vueApp.hideGameMenu(),document.getElementById("killTicker").style.display="block",["serverAndMapInfo","chw-game-screen","welcome-bundle-ui"].forEach((e=>document.getElementById(e).style.display="none")),JN==rc.king&&(document.getElementById("captureIconContainer").style.display="block"),document.getElementById("playerList").style.pointerEvents="none",kb?document.getElementById("spectate").style.display="block":(document.getElementById("weaponBox").style.display="block",document.getElementById("healthContainer").style.display="block",uw());const e=document.getElementById("gameAdContainer");e&&(e.style.display="block"),window.focus(),setTimeout((()=>{!function(){console.log("Adding canvas event listeners"),canvas.hasAttribute("tabindex")||canvas.setAttribute("tabindex","0");canvas.focus(),canvas.style.pointerEvents="all",function(){const e=xc.engine.scenes[0];if(!e)return void console.error("Scene not found.");jw=e.onPointerObservable.add((e=>{const t=e.event;switch(e.type){case b_.POINTERDOWN:MP(t);break;case b_.POINTERUP:IP(t)}}))}(),Kw.forEach((e=>canvas.addEventListener(e.type,e.listener,e.options))),addEventListener("gamepadbuttondown",qw)}(),vb?rM.focus():Cw()}),0),setTimeout((()=>{tD()}),300),cD()}}function EP(e){ub=Math.max(e,ub),vueApp.game.respawnTime=ub,Rb&&SD.clear(Rb),Rb=SD.set((function(){ub--,vueApp.game.respawnTime=Math.min(ub,e),ub<=0&&bM&&(ub=-1,SD.clear(Rb),AP(),XP())}),1200)}function AP(){if(TP())return void console.log("prepRespawnButton","ad first");console.log("prepRespawnButton");document.querySelector(".btn-respawn").addEventListener("click",CP,{once:!0})}function CP(){canvas.requestPointerLock({unadjustedMovement:IM.fastPollMouse})}var RP={};function TP(){if(xc.productBlockAds||Cb)return!1;let e=QM?3e4:24e4;pokiActive&&(e=0);const t=EI||eM>1,i=getStoredNumber("lastPreRoll",Date.now())+e,n=t&&Hb>1&&Date.now()>i,a=mO.timeToPlayVideoAd();if(null!==a)return a;if(n){console.log("video ad cancels respawnBtn click");document.querySelector(".btn-respawn").removeEventListener("click",CP,{once:!0})}return n}var NP=!1;function MP(e){document.pointerLockElement||(e.preventDefault(),CP()),Nw("keyboard","MOUSE "+e.button),e.preventDefault(),e.stopPropagation(),console.log(`Mouse button ${e.button} down, Pointer Lock: ${!!document.pointerLockElement}`)}function IP(e){console.log(`Mouse button ${e.button} up, Pointer Lock: ${!!document.pointerLockElement}`),Iw("keyboard","MOUSE "+e.button),e.preventDefault(),e.stopPropagation()}var xP=new Ch(1,1,1,1);function bP(e,t,i,n,a){var s=new Gg("","img/"+e+"?"+Ac,t,128,a);s.oldRender=s.render,s.render=function(){xc.engine.setDepthFunctionToLessOrEqual(),xc.engine.setAlphaMode(Md.ALPHA_COMBINE),this.oldRender(),xc.engine.setAlphaMode(Md.ALPHA_DISABLE),xc.engine.setDepthFunctionToLess()};for(var r=0;r<t;r++){new Lg("",s).isVisible=!1}return s.nextIdx=0,s.getSprite=function(e){var t=this.sprites[this.nextIdx];return t.cellIndex=void 0!==e?i+e:Math.randomInt(i,n),t.isVisible=!0,t.easing=Ex.linear,t.startSize=-1,t.endSize=-1,t.gravity=0,t.dx=0,t.dy=0,t.Ik=0,t.float=0,t.anim=0,t.slow=0,t.angle=0,t.rotate=0,t.stopped=!1,t.animColors=null,t.collide=!1,t.color.copyFrom(xP),this.nextIdx=++this.nextIdx%this.sprites.length,t},s}function PP(e,t,i,n,a,s,r,o,l,c,h){let f=0,u=0,d="default",m="default";h&&(f=h.item_data.cell||0,e==xb&&f&&(u=h.item_data.smokeCell,isNaN(u)&&(u=f)),d=h.item_data.fireColors||"default",m=h.item_data.smokeColors||"default");var p=e.getSprite(f);return p.animLength=t,p.easing=Ex.inOutQuad,p.position.x=i,p.position.y=n,p.position.z=a,p.size=l,p.dx=s,p.dy=r,p.Ik=o,p.slow=.7,p.angle=Math.random()*Math.PI2,p.rotate=.04*Math.random()-.02,p.animColors=e==bb?OP[d]:DP[m],p}function wP(e,t,i,n,a,s){for(var r=0;r<Math.floor(n/4);r++){var o=80*Math.random()+80,l=1*Math.random()+.5,c=.5*(.9-l),h=(2*Math.random()-1)*c,f=(2*Math.random()-1)*c+.1,u=(2*Math.random()-1)*c,d=PP(xb,o,e,t,i,h,f,u,l,0,s);d.float=.015*Math.random()+.001,d.collide=!0,(d=PP(bb,.075*o,e,t,i,1.5*h,1.5*f,1.5*u,l,0,s)).collide=!0}if(CO){var m=Math.length3(CO.Ek-e,CO.Zk-t,CO.ek-i);if(m<(a*=1.5)){var p=Math.max(0,(a-m)/a);EL=Math.min(7,EL+6*p)}}}var OP={default:[{pos:0,color:new Ch(1,.9,.8,1)},{pos:.2,color:new Ch(1,.5,.1,1)},{pos:.4,color:new Ch(.6,.2,.1,1)},{pos:.7,color:new Ch(0,0,0,0)},{pos:1,color:new Ch(0,0,0,0)}],rainbow:[{pos:0,color:new Ch(1,.1,.1,1)},{pos:.2,color:new Ch(1,1,.1,1)},{pos:.4,color:new Ch(.1,1,.1,1)},{pos:.7,color:new Ch(.1,.1,1,.5)},{pos:1,color:new Ch(1,.1,1,0)}],gold:[{pos:0,color:new Ch(1,1,.3,1)},{pos:.4,color:new Ch(1,.8,.2,1)},{pos:1,color:new Ch(1,.6,.1,0)}],corrupt:[{pos:0,color:new Ch(1,.1,.1,1)},{pos:.3,color:new Ch(1,1,1,1)},{pos:.6,color:new Ch(1,.1,.1,1)},{pos:1,color:new Ch(1,1,1,0)}],thermal:[{pos:0,color:new Ch(1,.9,.8,1)},{pos:.2,color:new Ch(1,.5,.1,1)},{pos:.4,color:new Ch(.6,.2,.1,1)},{pos:.5,color:new Ch(1,1,1,1)},{pos:.6,color:new Ch(1,1,1,0)},{pos:.7,color:new Ch(1,1,1,1)},{pos:1,color:new Ch(0,0,0,0)}],black:[{pos:0,color:new Ch(0,0,0,1)},{pos:1,color:new Ch(0,0,0,0)}],red:[{pos:0,color:new Ch(1,.7,.3,1)},{pos:1,color:new Ch(0,0,0,0)}],blue:[{pos:0,color:new Ch(.3,.7,1,1)},{pos:1,color:new Ch(0,0,0,0)}]},DP={default:[{pos:0,color:new Ch(.3,.3,.3,1)},{pos:1,color:new Ch(.7,.7,.7,0)}],white:[{pos:0,color:new Ch(1,1,1,.5)},{pos:1,color:new Ch(1,1,1,0)}],corrupt:[{pos:0,color:new Ch(1,1,1,.6)},{pos:.5,color:new Ch(1,.1,.1,.4)},{pos:1,color:new Ch(0,0,0,0)}],thermal:[{pos:0,color:new Ch(.5,.1,.01,.3)},{pos:.3,color:new Ch(.7,.4,0,.1)},{pos:1,color:new Ch(0,0,0,0)}],supernova:[{pos:0,color:new Ch(1,1,1,.5)},{pos:1,color:new Ch(1,0,1,0)}],black:[{pos:0,color:new Ch(0,0,0,1)},{pos:1,color:new Ch(0,0,0,0)}],softblack:[{pos:0,color:new Ch(0,0,0,.5)},{pos:1,color:new Ch(0,0,0,0)}],red:[{pos:0,color:new Ch(1,.7,.3,1)},{pos:.5,color:new Ch(1,.3,0,.6)},{pos:1,color:new Ch(0,0,0,0)}],blue:[{pos:0,color:new Ch(.3,.7,1,1)},{pos:.5,color:new Ch(0,.3,1,.6)},{pos:1,color:new Ch(0,0,0,0)}]},LP=[{pos:0,color:new Ch(1,1,1,1)},{pos:.2,color:new Ch(.7,.7,.7,.7)},{pos:1,color:new Ch(.7,.7,.7,0)}],FP=[{pos:0,color:new Ch(1,1,1,1)},{pos:.8,color:new Ch(1,1,1,1)},{pos:1,color:new Ch(1,1,1,0)}];function kP(e,t,i){for(var n=e.length-2;n>=0;n--)if(t>=e[n].pos)return void Ch.LerpToRef(e[n].color,e[n+1].color,(t-e[n].pos)*(1/(e[n+1].pos-e[n].pos)),i)}function BP(e,t,i,n){for(var a=0;a<t;a++){var s=Math.random()*n+.5*n,r=a/(.5*t)*i+.5*i,o=.08/(r+1),l=(2*Math.random()-1)*o,c=(2*Math.random()-.5)*o,h=(2*Math.random()-1)*o,f=pb.getSprite();f.animLength=s,f.easing=Ex.inQuad,f.position.x=e.Nk.dk.position.x,f.position.y=e.Nk.dk.position.y+.3,f.position.z=e.Nk.dk.position.z,f.startSize=r,f.endSize=0,f.gravity=.003,f.dx=l,f.dy=c,f.Ik=h,f.angle=Math.random()*Math.PI2,f.rotate=.2*Math.random()-.1,f.collide=!0;let u=e.Nk.YM.shellColor;f.color.copyFromFloats(u.r,u.g,u.b,1)}}function GP(e){for(var t=0;t<10;t++){var i=80*Math.random()+80,n=t/5*.2+.2,a=.05/(n+1),s=(2*Math.random()-1)*a,r=(2*Math.random()-.25)*a*1.5,o=(2*Math.random()-1)*a,l=sP.getSprite();l.animLength=i,l.easing=Ex.inQuad,l.position.x=e.Nk.dk.position.x,l.position.y=e.Nk.dk.position.y+.3,l.position.z=e.Nk.dk.position.z,l.startSize=n,l.endSize=0,l.gravity=.005,l.dx=s,l.dy=r,l.Ik=o,l.slow=.9,l.angle=Math.random()*Math.PI2,l.rotate=.2*Math.random()-.1,l.collide=!0}}function UP(e,t){for(var i=Math.floor(t/33)+1,n=0;n<i;n++){var a=9*Math.random()+9,s=.03/1.8,r=(2*Math.random()-1)*s,o=(2*Math.random()-.25)*s*1.5,l=(2*Math.random()-1)*s;lP.set(CO.Ek,CO.Zk,CO.ek),cP.set(e.Ek,e.Zk,e.ek),lP.subtractInPlace(cP).normalize().scaleInPlace(.26);var c=_b.getSprite();c.animLength=a,c.easing=Ex.linear,c.position.x=e.Nk.dk.position.x,c.position.y=e.Nk.dk.position.y+.3,c.position.z=e.Nk.dk.position.z,c.startSize=.8*.2,c.endSize=.8,c.gravity=.003,c.dx=r+e.dx,c.dy=o,c.Ik=l+e.Ik,c.slow=.95,c.angle=Math.random()*Math.PI2,c.rotate=.02*Math.random()-.001,c.collide=!1,c.animColors=FP}}function HP(e,t){for(var i=Math.floor(t/33)+1,n=0;n<i;n++){var a=9*Math.random()+9,s=.8,r=.03/((s*=e.playerScale)+1),o=(2*Math.random()-1)*r,l=(2*Math.random()-.25)*r*1.5,c=(2*Math.random()-1)*r;lP.set(CO.Ek,CO.Zk,CO.ek),cP.set(e.Ek,e.Zk,e.ek),lP.subtractInPlace(cP).normalize().scaleInPlace(.26);var h=mb.getSprite();h.animLength=a,h.easing=Ex.linear,h.position.x=e.Nk.dk.position.x,h.position.y=e.Nk.dk.position.y+.3,h.position.z=e.Nk.dk.position.z,h.startSize=.2*s,h.endSize=s,h.gravity=.003,h.dx=o+e.dx,h.dy=l,h.Ik=c+e.Ik,h.slow=.95,h.angle=Math.random()*Math.PI2,h.rotate=.02*Math.random()-.001,h.collide=!1,h.animColors=FP}}function VP(e,t){for(var i=0;i<e.sprites.length;i++){var n=e.sprites[i];if(n.isVisible){var a=n.easing(n.anim);if(n.endSize>=0&&(n.size=n.startSize+a*(n.endSize-n.startSize)),n.animColors&&kP(n.animColors,a,n.color),!n.stopped){n.position.x+=n.dx*t,n.position.y+=n.dy*t+n.float,n.position.z+=n.Ik*t,n.rotate&&(n.angle+=n.rotate*t);var s=!1;n.collide&&(lP.set(n.position.x,n.position.y,n.position.z),s=sx.pointCollidesWithStructure(lP,!0)),s?(n.stopped=!0,n.position.x-=n.dx*t,n.position.y-=n.dy*t,n.position.z-=n.Ik*t):n.gravity&&(n.dy-=n.gravity*t),n.slow&&(n.dx*=Math.pow(n.slow,t),n.dy*=Math.pow(n.slow,t),n.Ik*=Math.pow(n.slow,t))}n.anim+=t/n.animLength,n.anim>=1&&(n.isVisible=!1)}}}function WP(){console.log("onLoadingComplete"),Ib=new Ic({numChannels:24},{distanceModel:"exponential"});try{Ob=new Gw,Lb=new Uw,Fb=new Bm(Xb),IM.hitMarkers?Fb.show():Fb.hide(),(Db=new Hw).hide(),Db.hideDot(),JI("muzzleFlash",Xb,null,Xb.getMaterialByName("muzzleFlash")).setEnabled(!1),JI("bullet",Xb,null,Xb.getMaterialByName("bullet")).setEnabled(!1),JI("rocket",Xb,null,Xb.getMaterialByName("standardInstanced")).setEnabled(!1),JI("ammo",Xb,null,Xb.getMaterialByName("standardInstanced")).setEnabled(!1),JI("grenadeItem",Xb,null,Xb.getMaterialByName("standardInstanced")).setEnabled(!1),JI("spatula",Xb,null,Xb.getMaterialByName("emissive")).setEnabled(!1);for(let e=0;e<xc.catalog.grenades.length;e++){JI(xc.catalog.grenades[e].item_data.meshName,Xb,null,Xb.getMaterialByName("emissive")).setEnabled(!1)}if(rP=new Cx(Xb),oP=new _L,(xb=bP("particles.webp",300,16,23,Xb)).fogEnabled=!0,(bb=bP("particles.webp",300,16,23,Xb)).fogEnabled=!0,bb.blendMode=Md.ALPHA_ADD,(pb=bP("particles.webp",400,3,6,Xb)).fogEnabled=!0,window.P=pb,(sP=bP("particles.webp",100,2,2,Xb)).fogEnabled=!0,xc.engine.clear(Ah.Black()),xc.engine.stopRenderLoop(),vueApp.switchToGameUi(),xc.playerAccount.isUpgraded()&&(document.getElementById("chickenBadge").style.display="block"),(mb=bP("particles.webp",20,0,0,Xb)).fogEnabled=!0,(_b=bP("particles.webp",20,7,7,Xb)).fogEnabled=!0,OM){RO=0,mO={update:()=>{},render:()=>{}},dO={update:()=>{}};var e={jk:0,pk:0,ck:"Test",xk:0,Sk:0,fk:xc.playerAccount.getPrimaryWeapon(),sk:xc.playerAccount.getSecondaryWeapon(),$k:0,gk:null,uk:null,Vk:0,qk:0,rM:0,lM:0,HM:0,xM:0,SM:0,fM:0,AM:0,wM:0,Ek:kM.x+.5,Zk:kM.y-.32,ek:kM.z+.5,Pk:0,tM:0,kM:0,sM:0,Dk:kM.pitch,Qk:kM.yaw,TM:0,FM:0,hM:!1,_M:0,MM:0,$M:0,KM:void 0!==xc.playerAccount.upgradeProductId&&null!==xc.playerAccount.upgradeProductId?xc.playerAccount.upgradeProductId:0,EM:0,mM:[],QM:0,UM:1,JM:{}};vc.forEach((t=>e.JM[t]=0)),dw(e),Jb[RO].FM=100,YP(),KP(),$P(),gP(),Db.show(),Db.showDot(),ub=-1,nM=0,vueApp.delayTheCracking=!0}else{wb=!0,uO.onmessage=function(e){for(Nc.init(e.data);Nc.isMoreDataAvailable();){var t=Nc.unPackInt8U();switch(t){case nc.jt:var i=Nc.unPackInt8U(),n=Nc.unPackString(128),a=Nc.unPackString(32);if(we=Jb[i]){we.dbId=n,we.ip=a;for(var s=0;s<Nb.length;s++)if(Nb[s].id===i){Nb[s].dbId=n,Nb[s].ip=a;break}}break;case nc.Yt:var r=Nc.unPackLongString();ew(r);break;case nc.i:i=Nc.unPackInt8U(),(we=Jb[i])&&we.removeFromPlay();break;case nc.Mt:console.log("eventModifier"),(o=Tc.getBuffer()).BkMzMvJt(nc.Mt),o.send(uO);break;case nc.Wt:tw(Nc.unPackString()),!0,ub=-1,nM=0,KP(),$P(),vueApp.delayInGamePlayButtons();let e=Vw();var o;vueData.game.shareLinkPopup.code=QN,vueData.game.shareLinkPopup.url=e,aI?(vueApp.hideHeaderAd(!0),setTimeout((()=>{vueApp.onGamePauseUi(),vueApp.onGameOptionsClick()}),200)):gP(),IM.autoDetail?iD():(aD(IM.highRes),sD(IM.shadowsEnabled)),(o=Tc.getBuffer()).BkMzMvJt(nc.J),o.send(uO);break;case nc.u:var l=Nc.unPackInt8U(),c=Nc.unPackString(),h=Nc.unPackString(),f=Nc.unPackString(),u=Nc.unPackInt8U(),d={jk:l,pk:c,ck:h=RD(h,80),Hk:f,xk:u,Sk:Nc.unPackInt8U(),fk:xc.catalog.findItemById(Nc.unPackInt16U()),sk:xc.catalog.findItemById(Nc.unPackInt16U()),$k:Nc.unPackInt8U(),gk:xc.catalog.findItemById(Nc.unPackInt16U()),uk:xc.catalog.findItemById(Nc.unPackInt16U()),Vk:Nc.unPackInt8(),qk:Nc.unPackInt8(),Lk:xc.catalog.findItemById(Nc.unPackInt16U()),Ck:xc.catalog.findItemById(Nc.unPackInt16U()),Ek:Nc.unPackFloat(),Zk:Nc.unPackFloat(),ek:Nc.unPackFloat(),Pk:Nc.unPackFloat(),tM:Nc.unPackFloat(),kM:Nc.unPackFloat(),Qk:Nc.unPackRadU(),Dk:Nc.unPackRad(),rM:Nc.unPackInt32U(),lM:Nc.unPackInt16U(),HM:Nc.unPackInt16U(),xM:Nc.unPackInt16U(),SM:Nc.unPackInt32U(),fM:Nc.unPackInt32U(),AM:Nc.unPackInt16U(),wM:Nc.unPackInt16U(),TM:Nc.unPackInt8U(),FM:Nc.unPackInt8U(),hM:Nc.unPackInt8U(),_M:Nc.unPackInt8U(),MM:Nc.unPackInt8U(),KM:Nc.unPackInt8U(),EM:Nc.unPackInt8U(),mM:Nc.unPackLongString(),QM:Nc.unPackInt8U(),aM:{}};if(d.aM.mapIdx=Nc.unPackInt8U(),d.aM.private=Nc.unPackInt8U(),d.aM.gameType=Nc.unPackInt8U(),d.JM={},vc.forEach((e=>d.JM[e]=0)),d.JM.kills=d.lM,d.JM.deaths=d.HM,d.JM.streak=d.xM,d.ck=ND(d.ck),!Jb[d.jk]){RO==d.jk||LM?(d.lk=d.ck,d.Hk=d.ck):(d.lk=d.ck.replace(/<|>/g,""),(0==d.lk.length||Wx(d.lk))&&(d.lk=d.Hk),IM.safeNames?d.ck=d.Hk:d.ck=d.lk);let e=vw(c);e?(d.eM=e.muted,d.eM&&!IM.safeNames&&(d.ck=d.Hk)):d.eM=!1,dw(d)}break;case nc.V:mw(i=Nc.unPackInt8U());break;case nc.I:l=Nc.unPackInt16U();var m=Nc.unPackInt8U(),p=Nc.unPackFloat(),_=Nc.unPackFloat(),v=Nc.unPackFloat();oP.spawnItem(l,m,p,_,v);break;case nc.It:i=Nc.unPackInt8U(),m=Nc.unPackInt8U();var g=Nc.unPackInt8U();l=Nc.unPackInt16U(),oP.collectItem(m,l),i==RO&&CO.collectItem(m,g);break;case nc.Ft:var S,y,E=Nc.unPackInt8U(),A=Nc.unPackInt8U(),C=Nc.unPackInt8U(),R=Jb[E],T=Jb[A],N=Nc.unPackInt8U(),M=Nc.unPackInt8U();if(T.lastDmgType=N,R.lastDmgType=M,E==RO&&A!=RO?vM.updateTerminus(getKeyByValue(_c,R.charClass),lc[M].name,"deaths"):A==RO&&E==RO&&(vM.updateTerminus(getKeyByValue(_c,R.charClass),"Grenade","deaths",!0),ga("send","event","weapon","deathBy","Suicide")),R){dO.scoreKill(T,R)&&Yw(),S=R.name;var I=new wh(R.Ek,R.Zk+.32,R.ek);Ib.play("shell_burst",I);var x=Math.randomInt(0,10)+1;Ib.play("death_scream"+x,I),HP(R,100),UP(R,100),BP(R,80,.2,40),GP(R),R.die(),!0,R.Nk.dk.position.x=R.Ek,R.Nk.dk.position.y=R.Zk,R.Nk.dk.position.z=R.ek}else S="N/A";T?(A===RO&&E!==A&&(vM.streak=T.NM,vM.updateTerminus(getKeyByValue(_c,T.charClass),lc[M].name,"kills"),"Grenade"!==lc[M].name&&"Melee"!==lc[M].name||ga("send","event","weapon","killedWith",lc[M].name)),y=T.name,T.isDead()||(T.scoreKill(),A==RO&&vueApp.bestStreakUpdate(T.bestOverallStreak),A==RO&&(Ub++,Vb=Math.max(Vb,T.stats.streak)))):y="N/A",E!=RO?A==RO&&(vueApp.killedName=S,vueApp.shellIngameNotification({msg:S,type:0,streak:CO.stats.streak>1?CO.stats.streak:""})):(sI=!0,jN.parent=null,jN.position=new wh($b.Nk.dk.position.x,$b.Nk.dk.position.y+.2,$b.Nk.dk.position.z),T&&(jN.lockedTarget=T.Nk.head),vueApp.shellIngameNotification({msg:y,type:1,streak:0}),Hb++,EP(!xM||xc.productBlockAds||pokiActive?C-1:12),$w(),yD.set((function(){bM&&uM==RO&&gP()}),3e3)),T&&R&&bw(T,R),Sw();break;case nc.wt:i=Nc.unPackInt8U();var b=Nc.unPackInt8U();Ow(Nc.unPackString().valueOf(),b,i);break;case nc.it:dO._unPackState(Nc);break;case nc.Qt:l=Nc.unPackInt8U();var P=Nc.unPackInt8U(),w=Nc.unPackInt8U(),O=(p=Nc.unPackFloat(),_=Nc.unPackFloat(),v=Nc.unPackFloat(),Nc.unPackInt8U()),D=Nc.unPackInt8U(),L=Nc.unPackInt8U();(we=Jb[l]).serverStateIdx=w;var F=we.Ek,k=we.Zk,B=we.ek,G=we.dx,U=we.dy,H=we.Ik,V=we.Qk,W=we.Dk,z=(s=P,we.iM[s]),X=Math.mod(we.stateIdx-P,Ix)+8*cc;if(we.lastWeaponChange>X&&(D!==z.Yk||L!==z.store)){for(var Y=P;Y!=we.stateIdx;Y=Math.mod(Y+1,Ix)){var j=we.iM[Y];D-=j.shots,j.Yk=D}we.Fk.ammo.Yk=D,we.Fk.ammo.store=L,yw()}if(O)var K=Math.length3(z.Ek-p,z.Zk-_,z.ek-v);else K=Math.length2(z.Ek-p,z.ek-v);if(0!=Gb){if(K<.1){var $=2*cc;we.totalCorrections=$,we.corrections=$,we.corrected.dx=p-z.Ek,we.corrected.dy=_-z.Zk,we.corrected.Ik=v-z.ek;break}$=2*cc}else{if(K<.02)break;$=2*cc}we.totalCorrections=$,we.Ek=p,we.Zk=_,we.ek=v,we.dx=z.dx,we.dy=z.dy,we.Ik=z.Ik,we.zM=z.zM,we.GM=z.GM,we.playerScale=z.scale;for(var q=CO.MM;s!=we.stateIdx;s=Math.mod(s+1,Ix))z=we.iM[s],we.MM=z.MM,we.Qk=z.Qk,we.bM(!0);(K=we.zM?Math.length3(we.Ek-F,we.Zk-k,we.ek-B):Math.length2(we.Ek-F,we.ek-B))<.2?(we.corrections=$,we.corrected.dx=we.Ek-F,we.corrected.dy=we.Zk-k,we.corrected.Ik=we.ek-B,we.Ek=F,we.Zk=k,we.ek=B,we.dx=G,we.dy=U,we.Ik=H):we.corrections=0,we.Qk=V,we.Dk=W,we.MM=q;break;case nc.Jt:if(l=Nc.unPackInt8U(),p=Nc.unPackFloat(),_=Nc.unPackFloat(),v=Nc.unPackFloat(),O=Nc.unPackInt8U(),!(we=Jb[l])||we.id==RO){for(s=0;s<cc;s++)Nc.unPackInt8U(),Nc.unPackRadU(),Nc.unPackRad(),Nc.unPackInt8U();break}for(we.stateIdx=0,s=0;s<cc;s++)we.iM[s].MM=Nc.unPackInt8U(),we.iM[s].Qk=Nc.unPackRadU(),we.iM[s].Dk=Nc.unPackRad(),we.iM[s].scale=Nc.unPackInt8U()/100;we.Ek=p,(!we.GM||Math.abs(we.Zk-_)>.5)&&(we.Zk=_),we.ek=v,we.iM[0].Ek=p,we.iM[0].Zk=_,we.iM[0].ek=v,we.zM=O;break;case nc.C:if(l=Nc.unPackInt8U(),lP.x=Nc.unPackFloat(),lP.y=Nc.unPackFloat(),lP.z=Nc.unPackFloat(),cP.x=Nc.unPackFloat(),cP.y=Nc.unPackFloat(),cP.z=Nc.unPackFloat(),!(we=Jb[l]))break;l!=RO&&(we.Fk.Nk.fire(),we.Fk.fireMunitions(lP,cP),--we.Fk.tracer<0&&(we.Fk.tracer=we.Fk.constructor.tracer));break;case nc.P:l=Nc.unPackInt8U(),Jb[l]&&(Jb[l].meleeCountdown=17,Jb[l].Nk.melee());break;case nc.tt:l=Nc.unPackInt8U(),p=Nc.unPackFloat(),_=Nc.unPackFloat(),v=Nc.unPackFloat();var J=Nc.unPackFloat(),Q=Nc.unPackFloat(),Z=Nc.unPackFloat();if(!(we=Jb[l]))break;we.WM--,l!=RO?(we.Nk.head.rotation.x=we.Dk,we.Nk.dk.rotation.y=we.Qk):yw(),we.Nk.throwGrenade(),rP.throwGrenade(we,{x:p,y:_,z:v},{x:J,y:Q,z:Z});break;case nc.Dt:var ee=Nc.unPackInt8U(),te=Nc.unPackInt16U(),ie=(p=Nc.unPackFloat(),_=Nc.unPackFloat(),v=Nc.unPackFloat(),Nc.unPackInt8U()),ne=Nc.unPackFloat();let t=null;ee>0&&(t=xc.catalog.findItemById(te)),wP(p,_,v,ie,ne,t),lP.set(p,_,v),ee==pc.Grenade?Ib.play(t.item_data.sound||"grenade",lP):Ib.play("gun_rpegg_rocket_hit",lP);break;case nc.Et:l=Nc.unPackInt8U(),Jb[l]&&Jb[l].reload();break;case nc.t:l=Nc.unPackInt8U();var ae=Nc.unPackInt8U();Jb[l]&&Jb[l].swapWeapon(ae);break;case nc.rt:var se=Nc.unPackInt8U();J=Nc.unPackFloat(),Z=Nc.unPackFloat(),CO.FM=se,CO.Nk.hit(),Lb.hit(J,Z),Fb.hit(J,Z);break;case nc.Rt:var re=Nc.unPackInt8U();se=Nc.unPackInt8U(),J=Nc.unPackFloat(),Z=Nc.unPackFloat(),CO.FM=se,CO.oM=re,CO.Nk.hit(),Lb.hit(J,Z),Fb.hit(J,Z),uw();break;case nc.dt:if(l=Nc.unPackInt8U(),se=Nc.unPackInt8U(),!(we=Jb[l]))break;we.FM=se,we.lastDmgType=we.Fk.constructor.id,we.Nk.hit(),se>0&&UP(we,Math.clamp(we.FM-se,0,100));break;case nc.ot:Cb=!1,l=Nc.unPackInt8U();var oe=Nc.unPackInt16U(),le=(p=Nc.unPackFloat(),_=Nc.unPackFloat(),v=Nc.unPackFloat(),Nc.unPackInt8U()),ce=Nc.unPackInt8U(),he=Nc.unPackInt8U(),fe=Nc.unPackInt8U(),ue=Nc.unPackInt8U();(we=Jb[l])&&(we.Nk.removeFromPlay(),we.bk.setSeed(oe),we.weapons[0].ammo.Yk=le,we.weapons[0].ammo.store=ce,we.weapons[1].ammo.Yk=he,we.weapons[1].ammo.store=fe,we.grenades=ue,we.respawn(p,_,v),l==RO?(yP(),iw(),eb.init(),YP(),Db.show(),Db.showDot(),vb&&rM.focus()):Sw());break;case nc.Zt:gP();break;case nc.O:l=Nc.unPackInt8U();var de=Nc.unPackInt8U(),me=Nc.unPackInt16U(),pe=Nc.unPackInt16U(),_e=Nc.unPackInt8U(),ve=Nc.unPackInt16U(),ge=Nc.unPackInt16U(),Se=Nc.unPackInt16U(),ye=Nc.unPackInt16U(),Ee=Nc.unPackInt8(),Ae=Nc.unPackInt8(),Ce=xc.catalog.findItemById(me),Re=xc.catalog.findItemById(pe),Te=xc.catalog.findItemById(ve),Ne=xc.catalog.findItemById(ge),Me=xc.catalog.findItemById(Se),Ie=xc.catalog.findItemById(ye);(we=Jb[l])&&we.changeCharacter(de,Ce,Re,_e,Te,Ne,Ee,Ae,Me,Ie);break;case nc.U:l=Nc.unPackInt8U();var xe=Nc.unPackInt8U();(we=Jb[l])&&(l==RO&&(dM=xe,vueApp.setTeam(dM),dO.teamScore[xe]>=dO.teamScore[we.team]&&dO.teamScore[xe]>0&&(we.canTakeTeamBonus=!1)),we.team=xe,we.dM=0,we.stats.kills=0,we.stats.streak=0,we.NM=0,Nc.isMoreDataAvailable()&&Nc.peekInt8U()===nc.U||(rw(),Sw()));break;case nc.Ut:vueApp.showGenericPopup("ui_game_fairteams_header","ui_game_fairteams_text","ok");break;case nc.J:aP=Date.now()-cw,tM+=aP,iM++,(De=document.getElementById("ping")).style.color=aP<100?"#0f0":aP<150?"#ff0":aP<200?"#f90":"#f00",De.innerText=aP+"ms",setTimeout((function(){if(uO){var e=Tc.getBuffer();e.BkMzMvJt(nc.J),e.send(uO),cw=Date.now()}}),1e3);break;case nc.K:notify(vueApp.loc.ui_game_locked,1e4);break;case nc.nt:var be=Nc.unPackInt32U();console.log("updating balance from server: "+be),xc.playerAccount.currentBalance=be;break;case nc.Ot:console.log("upgrade has expired"),ab();break;case nc.Bt:l=Nc.unPackInt8U();var Pe=Nc.unPackInt8U();(we=Jb[l]).beginShellStreak(Pe);break;case nc.ht:l=Nc.unPackInt8U(),Pe=Nc.unPackInt8U(),(we=Jb[l]).endShellStreak(Pe);break;case nc.ct:l=Nc.unPackInt8U();var we,Oe=Nc.unPackInt8U();(we=Jb[l]).id===RO&&we.challengeCompleted(Oe);break;case nc.D:rx.parse(),vueData.selectedWeaponDisabled=rx.isSelectedWeaponDisabled(xc.playerAccount.classIdx),vueApp.$refs.gameScreen.$forceUpdate(),vueApp.$refs.gameScreen.$refs.weaponSelect.$forceUpdate();break;case nc.j:switch(Nc.unPackInt8U()){case lx.reset:var De;dO.reset(),(De=document.getElementById("gameMessage")).innerHTML=ZO("ingame_reset"),De.className="show",setTimeout((()=>{De.className="hide"}),3e3);break;case lx.pause:CO.nk&&gP()}break;case nc.At:l=Nc.unPackInt8U(),te=Nc.unPackInt16U(),Nc.unPackInt24U();break;case nc.yt:tw(Nc.unPackString())}JP.push(t),JP.length>4&&JP.shift()}},uO.onclose=e=>{gD(e.code)};var t=Tc.getBuffer();t.BkMzMvJt(nc.Wt),t.send(uO),cw=Date.now(),xL();Ow(ZO("ingame_chat_msg_2"),ac.none,null,zP,"<i class='fas fa-user-friends'></i>"),vueApp.eggOrgCheckShowPopupInGame()}hD(!1)}catch(e){console.log(e)}}function zP(){ga("send","event","game","click","openShareLinkChat"),Ww()}function XP(){jN.parent=null,jN.position.set(0,Yb.height+1,0),jN.lockedTarget=null,jN.setTarget(new wh(Yb.width/2,Yb.height/4,Yb.depth/2)),wb=!0,$b=CO,uM=RO,Xb.autoClear=!0,Xb.autoClearDepthAndStencil=!0}function YP(e){jN.position.set(0,0,0),jN.rotation.set(0,Math.PI,0),jN.parent=e?e.Nk.eye:CO.Nk.eye,jN.lockedTarget=null,wb=!1,Xb.autoClear=!1,Xb.autoClearDepthAndStencil=!1}var jP=!1;function KP(e){hasValue(e)||tD(),xc.engine.qt((function(){!function(){var e=performance.now(),t=Math.min((e-hw)/(1e3/60),8);if(hw=e,nM>=0){var i=xc.engine.getFps();nM+=i,aM++}if(aM%10==0){nM/aM,document.getElementById("FPS").innerText=Math.floor(i+.5),$b&&uw()}iM>10&&(KM=Math.max(KM,aP));if(BM)CO.Nk.update(t);else{for(var n=0;n<TO;n++){var a=Jb[n];a&&a.nk&&(a.Nk.handsToWeaponSkeleton(),a.Nk&&a.Nk.update(t))}iP&&iP.Nk.update(t)}CO&&(Lb.update(t),Db.update(t),Fb.update(t,CO.Qk));BM||(rP.updateActors(t),oP.update(t),VP(xb,t),VP(bb,t),VP(mb,t),VP(pb,t),VP(sP,t),VP(_b,t));wb&&(hP-=.002*t,jN.position.x=Math.sin(hP)*Yb.height+Yb.width/2,jN.position.z=Math.cos(hP)*Yb.height+Yb.depth/2,jN.setTarget(new wh(Yb.width/2,Yb.height/4,Yb.depth/2)));kb&&gb.update(t)}(),$b&&(Kb.position.x=$b.Ek,Kb.position.y=$b.Zk+2,Kb.position.z=$b.ek),Xb.render(),mO.render()}))}function $P(){Cw(),wb&&XP(),Wb=setInterval(lw,1e3/30)}var qP=document.createElement("DIV"),JP=[],QP="",ZP=!1,ew=e=>{if(!ZP&&e?(ZP=!0,vueApp.musicWidget(!0)):ZP&&!e&&(ZP=!1,vueApp.musicWidget(!1)),QP!==e){QP=e;var t=decodeURI(e);console.log("Music metadata",t),data=JSON.parse(t),vueApp.music.serverTracks=data,"localhost"==location.host||"localshelldev.bluewizard.com"==location.host?vueApp.music.serverTracks.albumArt="https://shellshock.io/data/img/albumArt/"+data.id+data.albumExt+"?"+data.query:vueApp.music.serverTracks.albumArt=dynamicContentPrefix+"data/img/albumArt/"+data.id+data.albumExt+"?"+data.query,vueApp.songChanged=!0}};function tw(e){vueApp.eggOrgUpdateGameStats(e)}function iw(){Db.hide(),Db.hideDot(),Ob.hide(),Db.setPowerful(!1),jN.Lt=1.25,Pb=!1,document.getElementById("grenadeThrowContainer").style.visibility="hidden"}function nw(e){if(void 0!==CO&&CO.shellStreakMsg){var t=CO.stats&&void 0!==CO.stats.streak?CO.stats.streak:null;vueApp.shellIngameNotification({type:2,msg:CO.shellStreakMsg,streak:t,streakType:e}),CO.shellStreakMsg=""}}function aw(){const e={MiniEgg:"shellStreak-shrink",DoubleEggs:"shellStreak-double-eggs",EggBreaker:"shellStreak-egg-breaker",Restock:"shellStreak-restock"};for(const[t,i]of Object.entries(e))LI[t]=document.getElementById(i),LI[t].style.display="none"}function sw(e,t){const i=t?"grid":"none";if(new Set([uc.EggBreaker,uc.DoubleEggs,uc.MiniEgg,uc.Restock]).has(e)){const t=getKeyByValue(uc,e);[LI[t]].forEach((t=>{t&&(t.style.display=i,e===uc.Restock&&setTimeout((()=>{t.style.display="none"}),2e3))}))}}function rw(){for(var e=0;e<TO;e++){var t=Jb[e];t&&t.Nk&&t.Nk.updateTeam()}}var ow=Math.PI/2;function lw(){var e=performance.now();if(zb=e,!dP){iM>10&&(KM=Math.max(KM,aP));for(eb.update();yb<e;){if(yb+=33.333333333333336,BM)CO.Nk.gM(),CO.bM();else{for(var t=0;t<TO;t++){var i=Jb[t];i&&(i.id===RO&&(i.chatLines=Math.max(0,i.chatLines-1/120),i.chatLines<=2&&(rM.style.visibility="visible"),i.nk&&(vueApp.player.challengeTimer.played=Math.floor(i.timers.played/30))),i.nk&&(i.Nk.gM(),i.bM()))}iP&&iP.update()}CO&&(CO.Fk&&0==CO.Fk.ammo.Yk&&(CO.stateIdx%20==0?document.getElementById("ammo").style.color="#f00":CO.stateIdx%20==10&&(document.getElementById("ammo").style.color="#fff")),1==Pb&&(qb=Math.min(qb+.03,1))>0&&(document.getElementById("grenadeThrowContainer").style.visibility="visible",document.getElementById("grenadeThrow").style.height=100*qb+"%")),BM||rP.updateLogic(),dO.update()}var n=Lh.Invert(jN.getViewMatrix());uP.copyFrom(wh.TransformNormal(new wh(0,0,-1),n)),uP.normalize(),BAWK.update(),mO.update()}}var cw,hw=performance.now();function fw(e,t,i,n,a){(i*=rx.value.damage,t.Xk.lastDamageGivenType=t.dmgTypeId,e.lastDamageTakenType=t.dmgTypeId,!e.nk||e.shield>0)||Math.max(0,Math.floor(e.FM-i))>0&&HP(e,Math.clamp(i,0,100))}function uw(){const{activeShellStreaks:e,oM:t,FM:i}=$b,n=document.getElementById("healthContainer"),a=document.getElementById("hardBoiled-bar"),s=document.getElementById("hardBoiled-stroke"),r=document.getElementById("healthBar"),o=document.getElementById("healthHp");if(e&uc.HardBoiled&&t>0){n.classList.add("hard-boiled"),a.style.display="block",s.style.display="block";const e=2.3-t/43.478;a.setAttribute("stroke-dashoffset",6.2832*e+"em")}else n.classList.remove("hard-boiled"),a.style.display="none",s.style.display="none";const l=i>100?i-100:0,c=2.3-Math.min(i,100)/43.478;if(r.setAttribute("stroke-dashoffset",6.2832*c+"em"),l>0){const e=1-l/100,t=23+232*e,i=146+109*e,n=0+255*e;r.style.stroke=`rgb(${Math.round(t)}, ${Math.round(i)}, ${Math.round(n)})`}else r.style.stroke="rgb(255, 255, 255)";o.innerText=Math.floor(i)}function dw(e){e.jk==RO&&(uM=e.jk);var t=new xx(e,Xb);if(t.id==RO)$b=t,(CO=t).ws=uO,yw();else{let t=Nb.findIndex((t=>t.xt===e.pk));t>=0&&Nb.splice(t,1),Nb.push({id:e.jk,xt:e.pk,name:e.ck,muted:e.eM,isGameOwner:e.nM}),Nb.length>50&&Nb.shift()}t.nk||t.Nk.removeFromPlay(),Jb[e.jk]=t,Sw()}function mw(e){var t=Jb[e];e!=RO?t&&(t.Nk.remove(),uM===e&&gb.unlock(),delete Jb[e],Sw()):console.log("Tried to remove ME")}function pw(e){if(e){try{const t=JSON.parse(e);if(t.length>0&&hasValue(t[0]))return t.find((e=>e.active))}catch(e){}return!1}return!1}function _w(e){if(e.hideBadge)return!1;let t=null;e.social&&(t=JSON.parse(e.social));const i=t&&Array.isArray(t)&&t.some((e=>1==e.active));return e.upgradeProductId&&e.upgradeProductId>0||i}function vw(e){for(let t=0;t<TO;t++)if(Jb[t]&&Jb[t].xt===e)return Jb[t];return Nb.find((t=>t.xt===e))}function gw(e,t,i){let n=vw(e);if(n)return function(){var a={xt:e,isGameOwner:n.isGameOwner,muted:n.muted,playerName:n.name,muteFunc:function(){!function(e){for(let i=0;i<TO;i++){if((t=Jb[i])&&t.id!==RO&&t.xt===e){t.muted?(t.muted=!1,IM.safeNames||(t.name=t.yk)):(t.muted=!0,IM.safeNames||(t.name=t.safeName)),t.Nk.setupNameSprite(),Sw();break}}var t=Nb.find((t=>t.id!==RO&&t.xt===e));t&&(t.muted=!t.muted)}(e)},bootFunc:function(){!function(e){var t=Tc.getBuffer();t.BkMzMvJt(nc.T),t.AABkMzMvLI(e),t.send(uO)}(e)},banFunc:function(t,i){!function(e,t,i){var n=Tc.getBuffer();n.BkMzMvJt(nc.F),n.AABkMzMvLI(e),n.AABkMzMvLI(t),n.BkMzMvJt(i),n.send(uO)}(e,t,i)},infoFunc:function(){!function(e){let t=vw(e);if(!t)return;let i=new BroadcastChannel("ShellShockersAdmin");i.postMessage({cmd:"getPlayer",id:t.dbId,ip:t.ip}),i.close()}(e)},reportFunc:function(t){!function(e,t){var i=Tc.getBuffer();i.BkMzMvJt(nc.W),i.AABkMzMvLI(e),i.BkMzMvJt(t),i.send(uO),vueApp.showGenericPopup("report_confirm_title","report_confirm_message","ok")}(e,t)},social:t,vipMember:i};vueApp.showPlayerActionsPopup(a)}}function Sw(){mP[0]=0,mP[1]=0,mP[2]=0;for(var e=[],t=0;t<TO;t++)Jb[t]&&(e.push(t),mP[Jb[t].team]++);mO.sortPlayerList(e);var i=document.getElementById("playerList").children;for(t=0;t<e.length;t++){var n=Jb[e[t]],a=i[t],s=a.children[0],r=s.children[0],o=s.children[1],l=a.children[1];r.classList.add("playerSlot--name"),o.classList.add("playerSlot--score"),l.classList.add("playerSlot--icons"),a.style.display="block",a.style.opacity=1,r.innerText=n.name;const c=pw(n.social);if(n.id!=RO){let e=!n.hideBadge&&c;const t=n.upgradeProductId&&n.upgradeProductId>0&&!n.hideBadge;a.onclick=gw(n.xt,e,t),a.style.pointerEvents="all",a.style.cursor="pointer",n.nk||(a.style.opacity=.3)}o.innerText=n.dM,s.classList.add("playerSlot--name-score");let h="playerSlot--name-score",f="playerSlot-player-is-me",u="playerSlot-player-is-them",d="";kb&&Bb===KL.firstPerson&&n.id===gb.playerIdx&&(d="playerSlot-spectating"),n.id==RO?s.className=`${h} ${f} ${GI.meClass[n.team]}`:s.className=`${d} ${h} ${u} ${GI.rk[n.team]}`,l.innerText="";const m=document.createElement("i"),p=document.createElement("i"),_=document.createElement("i");m.className="fas fa-egg hidden text_gold vip-egg",c&&(m.className=`fab ${SOCIALMEDIA[c.id]} hidden`),p.className="fas fa-ban hidden";_w(n)&&m.classList.remove("hidden"),n.muted&&p.classList.remove("hidden"),_.className="fas fa-exclamation-triangle red hidden",FM===n.xt&&_.classList.remove("hidden"),l.appendChild(m),l.appendChild(p),l.appendChild(_)}for(;t<TO;)i[t].style.display="none",t++}function yw(){if(CO){var e=document.getElementById("weaponName");e.innerHTML=CO.Fk.constructor.weaponName,(e=document.getElementById("ammo")).style.color="#fff";var t=CO.Fk.ammo,i=Math.max(Math.min(t.Yk,t.St),0),n=Math.max(Math.min(t.store,t.Gk),0);e.innerHTML=i+"/"+n;for(var a=1;a<=3;a++)CO.WM>=a?document.getElementById("grenade"+a).src="img/ico_grenade.webp?v=1":document.getElementById("grenade"+a).src="img/ico_grenadeEmpty.webp?v=1"}}var Ew,Aw=null;function Cw(){Aw=null,document.addEventListener("keydown",kw),document.addEventListener("keyup",Bw)}function Rw(){document.removeEventListener("keydown",kw),document.removeEventListener("keyup",Bw)}function Tw(e,t){if(kb)(i=DM[e].spectate[t])||(i=DM[e].game[t]),Bb===KL.firstPerson&&("ARROWUP"===t&&(i="up"),"ARROWDOWN"===t&&(i="down"));else var i=DM[e].game[t];return i}function Nw(e,t){(kb||document.pointerLockElement&&CO.nk)&&Mw(Tw(e,t))}function Mw(e){switch(e){case"up":case"down":case"left":case"right":case"jump":case"ascend":case"descend":var t=Rx[e];Gb|=t;break;case"inspect":document.pointerLockElement&&CO&&CO.Nk.inspect();break;case"melee":document.pointerLockElement&&CO&&eb.add(eb.melee);t=Rx[e];Gb|=t;break;case"fire":document.pointerLockElement&&CO&&eb.add(eb.fire);t=Rx[e];Gb|=t;break;case"grenade":document.pointerLockElement&&CO&&!Pb&&CO.canSwapOrReload()&&CO.WM>0&&(Pb=!0,qb=-.15);break;case"scope":t=Rx[e];IM.holdToAim?Gb|=t:CO.scope?Gb^=Gb&t:Gb|=t;break;case"reload":eb.add(eb.reload);break;case"swap_weapon":eb.add(eb.swap);break;case"toggle_freecam":kb&&(Bb===KL.freeCamera?(Bb=KL.firstPerson,gb.firstPerson()):(Bb=KL.freeCamera,gb.freeCamera()));break;case"despawn":crazyGamesActive&&vP();break;case"slow":kb&&Bb===KL.freeCamera&&gb.startSlow()}}function Iw(e,t){(kb||document.pointerLockElement&&CO.nk)&&xw(Tw(e,t))}function xw(e){switch(e){case"fire":var t=Rx[e];Gb^=Gb&t;break;case"scope":if(IM.holdToAim){CO.scopeOut();t=Rx[e];Gb^=Gb&t}break;case"grenade":document.pointerLockElement&&Pb&&CO&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden",Pb=!1,CO.throwGrenade(qb));break;case"slow":kb&&Bb===KL.freeCamera&&gb.endSlow();break;case"up":if(kb&&Bb===KL.firstPerson){gb.spectateNextPlayer(-1),Gb=0;break}case"down":if(kb&&Bb===KL.firstPerson){gb.spectateNextPlayer(1),Gb=0;break}case"left":case"right":case"jump":case"melee":case"ascend":case"descend":t=Rx[e];Gb^=Gb&t}}function bw(e,t){var i=[` ${ZO("ingame_kill_text_scrambled")} `,` ${ZO("ingame_kill_text_beat")} `,` ${ZO("ingame_kill_text_poached")} `,` ${ZO("ingame_kill_text_whipped")} `,` ${ZO("ingame_kill_text_fried")} `,` ${ZO("ingame_kill_text_cracked")} `],n='<span style="color: '+GI.text[e.team]+'">'+e.name+"</span>"+i[Math.randomInt(0,i.length)]+'<span style="color: '+GI.text[t.team]+'">'+t.name+"</span>";(lM.innerHTML.match(/<br>/g)||[]).length>4&&(lM.innerHTML=lM.innerHTML.substr(lM.innerHTML.search("<br>")+4)),lM.innerHTML+=n+"<br>"}function Pw(){return!!(cM||xc.playerAccount.isEmailVerified||new Date(xc.playerAccount.dateCreated).getTime()<17145468e5)}function ww(){canvas.focus(),rM.style.display="block",Pw()?(rM.value=ZO("ingame_press_enter_to_chat"),rM.style.pointerEvents="auto"):(rM.value=ZO("ingame_sign_in_to_chat"),rM.style.pointerEvents="all",rM.style.cursor="pointer",rM.onclick=()=>{vueApp.onShowloginPopupWarning()}),rM.style.background="transparent",rM.blur(),vb=!1}function Ow(e,t,i,n,a){const s=oM.querySelectorAll(".chat-item");if(t&ac.pinned&&!e){for(let e of s)e.classList.contains("chat-pinned-item")&&e.remove();return}const r=document.createElement("div"),o=document.createElement("span"),l=document.createElement("div"),c=document.createElement("span"),h=document.createElement("i");let f=!1,u=!1,d=!1;if(r.classList.add("chat-item"),l.style.display="inline-block",i>253)255===i?(c.textContent="SERVER: ",l.style.color="#ff0"):254===i&&(c.textContent="MOD: ",l.style.color="#0f0"),c.classList.add("chat-player-name","ss_marginright_xs"),l.appendChild(c);else{let n=Jb[i];if(qP.innerHTML=e,e=ND(qP.textContent.trim()),i===RO||null!==i&&n&&!n.muted&&e.length>0&&!Wx(e)&&e.indexOf("<")<0)f=!!(n.upgradeProductId&&n.upgradeProductId>0),u=pw(n.social),u&&!n.hideBadge?(h.classList.add("fab",SOCIALMEDIA[u.id]),h.classList.add("ss_marginright_xs")):f&&!n.hideBadge&&(h.classList.add("fas","fa-egg","hidden","text_gold","vip-egg"),h.classList.add("ss_marginright_xs")),d=n.xt,c.classList.add("chat-player-name","ss_marginright_xs"),c.textContent=n.name+": ",t&ac.team&&(o.style.color=GI.text[n.team],o.classList.add("chat-team")),l.style.color=GI.text[n.team],l.appendChild(h),l.appendChild(c);else if(null!==i)return}s.length>4&&(s[0].classList.contains("chat-pinned-item")?t&ac.pinned?s[0].remove():s[1].remove():s[0].remove()),a&&(e=e.format(a)),o.innerHTML=e,t&ac.pinned&&(o.classList.add("chat-pinned"),r.classList.add("chat-pinned-item")),r.appendChild(l),r.appendChild(o),r.classList.add("clickme"),r.onclick=()=>{c.classList.add("clickme"),!d&&n?n():d!=CO.xt&&(c.classList.add("clickme"),gw(d,u,f)())},oM.appendChild(r),Ab&&(Ab.scrollTop=Ab.scrollHeight)}function Dw(e){var t=Tc.getBuffer();t.BkMzMvJt(nc.wt),t.AABkMzMvLI(e),t.send(uO)}function Lw(){CO.chatLines<=2&&Pw()&&(Rw(),rM.style.background="rgba(0, 0, 0, 0.5)",rM.value="",rM.focus(),Aw=null,vb=!0)}function Fw(){ww(),Cw()}function kw(e){var t=(e=e||window.event).key;if(t!=Aw)if(Aw=t,Pb||0!=Gb||"Enter"!=t||!IM.enableChat){vb||"Tab"==t&&(i="ESCAPE",e.preventDefault(),vP("down"));var i=(""+t).toLocaleUpperCase();if(" "==i&&(i="SPACE",e.preventDefault()),LL){if("`"==i)return void function(){if(Ew){for(var e=0;e<TO;e++){var t=Jb[e];if(t){var i={name:t.name,hp:t.FM,nk:t.nk,posX:t.Ek,posY:t.Zk,posZ:t.ek,actorX:t.Nk.dk.position.x,actorY:t.Nk.dk.position.y,actorZ:t.Nk.dk.position.z,transformEnabled:t.Nk.dk.isEnabled(),transformVisible:t.Nk.dk.isVisible,transformFrozen:t.Nk.dk.isWorldMatrixFrozen,shellEnabled:t.Nk.YM.isEnabled(),shellVisible:t.Nk.YM.isVisible,shellFrozen:t.Nk.YM.isWorldMatrixFrozen,weaponEnabled:t.Fk.Nk.pM.isEnabled(),weaponVisible:t.Fk.Nk.pM.isVisible};Ew.document.write(JSON.stringify(i)+"\n")}}Ew.document.write("<hr>")}else(Ew=window.open("","","name=Debug")).document.write("<pre>")}();if("\\"==i){BM=!0;for(var n=0;n<Xb.particleSystems.length;n++)Xb.particlesPaused=!0;for(n=0;n<TO;n++)Jb[n]&&Jb[n].Nk&&(Jb[n].Nk.dk.Ak(!0),Jb[n].Nk.showNameSprite(),Jb[n].Nk.positionNameSprite());uO.close()}}Nw("keyboard",i)}else Lw()}function Bw(e){var t=(e=e||window.event).key;t==Aw&&(Aw=null);var i=(""+t).toLocaleUpperCase();" "==i&&(i="SPACE",e.preventDefault()),Iw("keyboard",i)}function Gw(){var e=[[new wh(-1,0,0),new wh(1,0,0)],[new wh(0,-1,0),new wh(0,1,0)]];this.uM=ey.CreateLineSystem("crosshairs",{lines:e},Xb),this.uM.setEnabled(!1),this.uM.position.z=2,this.uM.applyFog=!1,this.uM.layerMask=536870912,this.uM.color=Ah.Black()}function Uw(){this.dk=new wm("hitIndicator",Xb),this.dk.updatable=!0,this.dk.hasVertexAlpha=!0,this.positions=[0,0,0,0,.5,0,.5,.5,0,.5,0,0,.5,-.5,0,0,-.5,0,-.5,-.5,0,-.5,0,0,-.5,.5,0];this.colors=new Array(48).fill(0);for(var e=0;e<48;e+=4)this.colors[e]=1,this.colors[e+1]=.9,this.colors[e+2]=0,this.colors[e+3]=-.5;var t=new _f;t.positions=this.positions,t.indices=[0,1,8,0,2,1,0,2,1,0,3,2,0,3,2,0,4,3,0,4,3,0,5,4,0,5,4,0,6,5,0,6,5,0,7,6,0,7,6,0,8,7,0,8,7,0,1,8],t.colors=this.colors,t.applyToMesh(this.dk,!0),this.dk.layerMask=536870912,this.dk.material=Xb.getMaterialByName("ui"),this.resize()}function Hw(){this.uM=[],this.shotBrackets=[];for(var e=0;e<4;e++)this.uM.push(document.getElementById("crosshair"+e)),this.shotBrackets.push(document.getElementById("shotBracket"+e));this.crosshairReticle=document.getElementById("crosshairContainer"),this.readyBrackets=document.getElementById("readyBrackets"),this.shotReticle=document.getElementById("shotReticleContainer"),this.redDotReticle=document.getElementById("redDotReticle"),this.reticleDot=document.getElementById("reticleDot")}function Vw(){var e=(""==dynamicContentPrefix?parsedUrl.root:dynamicContentPrefix)+"#"+QN;const t=crazySdk.inviteLink({crazyShare:QN});return crazyGamesActive?t:e}function Ww(){vueApp.showShareLinkPopup(Vw(),QN),aI=!1}function zw(e,t){if(BM)return!0;for(var i=t||e.getBoundingInfo().boundingBox.center.z,n=e.position.x-jN.globalPosition.x,a=e.position.y+i-jN.globalPosition.y,s=e.position.z-jN.globalPosition.z,r=Math.length3(n,a,s),o=Math.normalize3({x:n,y:a,z:s},.9),l=jN.globalPosition.x,c=jN.globalPosition.y,h=jN.globalPosition.z,f=0,u=0;u<r-.9&&(l+=o.x,c+=o.y,h+=o.z,!(l<0||l>=Yb.width||h<0||h>=Yb.depth||c<0||c>=Yb.height));u+=.9){var d=Yb.data[Math.floor(l)][Math.floor(c)][Math.floor(h)];if(d.idx){var m=Nx[d.idx];if("full"==m.colliderType&&!m.softness&&"barrier"!==m.shortName&&2==++f)return!1}}return!0}function Xw(){xc.engine.stopRenderLoop(),PM.startRendering()}function Yw(){for(var e=1;e<=2;e++){document.getElementById("teamScoreNum"+e).innerText=dO.teamScore[e];var t=document.getElementById("teamScore"+e);iP&&(iP.controlledByTeam==e?t.classList.replace("inactive","active"):iP.lastControlTeam!=e&&t.classList.replace("active","inactive"))}}Gw.prototype.show=function(){var e=xc.engine.getRenderHeight();this.uM.scaling.x=e/2,this.uM.scaling.y=e/2,this.uM.setEnabled(!0),document.getElementById("scopeBorder").style.display="flex",jN.viewport.width=e/xc.engine.getRenderWidth(),jN.viewport.x=.5-.5*jN.viewport.width},Gw.prototype.hide=function(){this.uM.setEnabled(!1),document.getElementById("scopeBorder").style.display="none",jN.viewport.width=1,jN.viewport.x=0},Uw.prototype.resize=function(){this.dk.scaling.x=xc.engine.getRenderWidth(),this.dk.scaling.y=xc.engine.getRenderHeight()},Uw.prototype.update=function(e){for(var t=7;t<48;t+=4)this.colors[t]-=(this.colors[t]+.5)/10*e;var i=Math.pow(.9,e);CO&&CO.nk&&(jN.position.x*=i,jN.position.z*=i),this.dk.updateVerticesData($h.ColorKind,this.colors,!0)},Uw.prototype.hit=function(e,t){var i=-Math.atan2(-e,t),n=Math.radRange(i-CO.Qk+.393);n=Math.floor(n/Math.PI2*8);var a=new Ph(-this.positions[3*n+3],-this.positions[3*n+4]).normalize();jN.position.x=.03*a.x,jN.position.z=.03*a.y,this.colors[4*n+7]=2},Hw.prototype.show=function(){if(document.getElementById("reticleContainer").className="",CO.Fk.constructor.readySpread){this.readyBrackets.className="notReady";var e="62.5vw";this.readyBrackets.style.width=e,this.readyBrackets.style.height=e}else this.readyBrackets.className="hideme";this.redDotReticle.className="hideme",this.crosshairReticle.className=CO.Fk.constructor===ux?"hideme":"",this.shotReticle.className=CO.Fk.constructor===ux?"":"hideme"},Hw.prototype.hide=function(){document.getElementById("reticleContainer").className="hideme"},Hw.prototype.hideDot=function(){this.reticleDot.className="hideme"},Hw.prototype.showDot=function(){IM.centerDot&&(this.reticleDot.className="")},Hw.prototype.fireDenied=function(){this.readyBrackets.className="";var e=this;setTimeout((function(){e.readyBrackets.className="notReady"}),10)},Hw.prototype.setPowerful=function(e){for(var t=0;t<4;t++){var i=this.uM[t],n=this.shotBrackets[t];e?(i.classList.remove("normal"),i.classList.add("powerful"),n.classList.remove("normal"),n.classList.add("powerful")):(i.classList.add("normal"),i.classList.remove("powerful"),n.classList.add("normal"),n.classList.remove("powerful"))}},Hw.prototype.update=function(e){if(jN.forwardRay=jN.getForwardRay(),jN.forwardRay.origin=CO.Nk.eye.getAbsolutePosition(),CO.Fk){var t=CO.Fk.accuracy;if(CO.Fk.constructor===ux){var i=t*(200/jN.Lt);this.shotReticle.style.width=i+"vh",this.shotReticle.style.height=i+"vh"}else{i=t*(50/jN.Lt);for(var n=0;n<4;n++){this.uM[n].style.transform="rotate("+90*n+"deg) translateY(calc("+i+"vh + 0.12em))"}}jN.forwardRay.direction.scaleInPlace(1e3);var a=ax.Tk(jN.forwardRay.origin,jN.forwardRay.direction,ax.projectileCollidesWithCell);if(a){var s=wh.Distance(jN.forwardRay.origin,a.pick.pickedPoint);jN.forwardRay.range=s,CO.Fk.constructor.minRange&&(s-.01>=CO.Fk.constructor.minRange?this.readyBrackets.className="ready":this.readyBrackets.className="notReady")}else CO.Fk.constructor.minRange&&(this.readyBrackets.className="ready"),jN.forwardRay.range=1e6;CO.Fk.constructor.burst&&(jN.Lt-CO.Fk.Nk.scopeFov<.006?this.redDotReticle.className="":this.redDotReticle.className="hideme")}},Hw.prototype.resize=function(){};var jw=null;var Kw=[{type:"mousedown",listener:MP,options:{once:!1}},{type:"mouseup",listener:IP,options:{once:!1}},{type:"pointermove",listener:function(e){if(document.pointerLockElement&&!nP&&CO&&(CO.FM>0||kb)){var t=Math.pow(.001*IM.mouseSpeed,2);CO.scope&&(t*=CO.Fk.Nk.scopeFov);var i=e.movementX,n=e.movementY;RP.x&&Math.sign(i)!=Math.sign(RP.x)&&(i=0),RP.y&&Math.sign(n)!=Math.sign(RP.y)&&(n=0),RP.x=i,RP.y=n,CO.Qk=Math.radAdd(CO.Qk,-i*t),CO.Dk=Math.clamp(CO.Dk+n*IM.mouseInvert*-t,-1.5,1.5)}nP=!1},options:{once:!1}},{type:"wheel",listener:function(e){e.wheelDelta>0?(Nw("keyboard","WHEEL UP"),Iw("keyboard","WHEEL UP")):(Nw("keyboard","WHEEL DOWN"),Iw("keyboard","WHEEL DOWN"))},options:{once:!1}}];function $w(){console.log("Removing canvas event listeners"),canvas.style.pointerEvents="none",function(){if(jw){const e=xc.engine.scenes[0];e&&e.onPointerObservable.remove(jw),jw=null}}(),Kw.forEach((e=>canvas.removeEventListener(e.type,e.listener))),removeEventListener("gamepadbuttondown",qw)}function qw(e){8==e.detail&&document.exitPointerLock()}function Jw(){bM&&!sI&&_P()}function Qw(){vueApp.chromeIsABuggerPopupShow()}var Zw=class{getTeamWithHighestScore(){let e=this.lastLeadingTeam;return this.teamScore[1]>this.teamScore[2]?e=1:this.teamScore[2]>this.teamScore[1]&&(e=2),this.lastLeadingTeam=e,e}playSound(e){this.suppressSound||BAWK.play(e)}update(){}constructor(){this.teamScore=[0,0,0],this.suppressSound=!0,this.lastLeadingTeam=1,this.zoneMesh=null}scoreKill(e,t){}getTeamWithMostKills(){let e=this.lastLeadingTeam,t=[0,0,0];for(let e=0;e<TO;e++){let i=Jb[e];i&&(t[i.team]+=i.dM)}return t[1]>t[2]?e=1:t[2]>t[1]&&(e=2),this.lastLeadingTeam=e,e}reset(){CO&&(CO.canTakeTeamBonus=!0),dO.teamScore=[0,0,0];for(var e=0;e<TO;e++){var t=Jb[e];t&&(t.dM=0,t.stats.streak=0)}Sw()}_unPackState(e){this.unPackState(e),this.suppressSound=!1}static otherTeam(e){return 1==e.team?2:1}},eO=class{sortPlayerListByTeamKills(e){this.sortPlayerListByKills(e);let t=dO.getTeamWithMostKills();this.sortPlayerListByLeadingTeam(e,t)}sortPlayerListByTeamScore(e){this.sortPlayerListByKills(e);let t=dO.getTeamWithHighestScore();this.sortPlayerListByLeadingTeam(e,t)}timeToPlayVideoAd(){return null}update(){}sortPlayerListByLeadingTeam(e,t){e.sort(((e,i)=>Jb[i].team==t?1:Jb[e].team==t?-1:0))}playSound(e){dO.suppressSound||BAWK.play(e)}constructor(){}render(){}sortPlayerListByKills(e){e.sort(((e,t)=>Jb[t].dM-Jb[e].dM))}sortPlayerList(){}},tO=class e extends Zw{constructor(){super(),this.init()}unPackState(t){let i=this.activeZone;switch(this.state=t.unPackInt8U(),this.activeZone=t.unPackInt8U(),this.teams=t.unPackInt8U(),this.progress=t.unPackInt16U(),this.numCapturing=t.unPackInt8U(),this.teamScore[1]=t.unPackInt8U(),this.teamScore[2]=t.unPackInt8U(),console.log("ACTIVE ZONE IS NOW",this.activeZone),this.state){case e.state.win:rP.removeAll(),dP=!0,mO.win(),this.playSound("kotc_roundend");break;case e.state.start:if(dP&&(dP=!1,this.reset(),mP[1]+mP[2]>2)){var n=document.getElementById("gameMessage");n.innerHTML=ZO("ingame_coop_shuffle"),n.className="show",setTimeout((()=>{n.className="hide"}),3e3)}break;case e.state.dM:this.playSound("kotc_pointscore");break;case e.state.contested:this.playSound("kotc_contested")}this.activeZone&&this.activeZone!=i&&this.playSound("kotc_zonespawn"),mO.setCaptureState(this.teams)}init(){this.activeZone=null,this.teams=null,this.progress=null,this.numCapturing=null,this.teamsBalanced=!1,this.state=e.state.capturing}reset(){super.reset(),this.init()}update(){if(this.activeZone)if(this.state==e.state.takeover)this.progress>0&&(this.progress-=e.takeOverSpeed);else if(this.state==e.state.capturing&&(1==this.teams||2==this.teams)){let t=e.captureSpeeds[this.numCapturing-1];this.progress+=t}}},iO=class e extends eO{update(){if(0!=dO.activeZone){if(dO.state==tO.state.takeover){let t=Math.max(dO.progress,0);this.setBarProgress(1-t/tO.takeOverTime);let i=.5*Math.cos(zb/100%(2*Math.PI))+.5;Ah.LerpToRef(sO[1==dO.teams?2:1].lightZone,e.zoneColor.takeover,i,e.color),this.setZoneColor(this.zoneMesh,e.color)}else if(1==dO.teams||2==dO.teams){let e=Math.min(dO.progress,1200);this.setBarProgress(e/1200)}if(dO.state==tO.state.contested){let t=.5*Math.cos(zb/100%(2*Math.PI))+.5;Ah.LerpToRef(sO[1].lightZone,sO[2].lightZone,t,e.color),this.setZoneColor(this.zoneMesh,e.color)}if(CO&&dO.activeZone){let e=Mb[dO.activeZone-1].capIconPosition,t=Math.length3(CO.Ek-e.x,CO.Zk-e.y,CO.ek-e.z),i=Math.max(0,Math.min(.5*t-1+.5*Math.abs(CO.Zk-e.y+.4),.6));this.captureIconContainer.style.opacity=i,this.captureIconCaption.innerText=Math.floor(2*t)+"M"}}else"&nbsp;"!=this.captureBarTextEl.innerHTML||0!=mP[1]&&0!=mP[2]||(this.captureBarTextEl.innerText=ZO("ingame_coop_waiting"))}setBarProgress(e){this.captureBarEl.style.transform="scaleX("+e+")";let t=100*(1-e);this.captureRingContainer.style.transform="translateY("+t+"%)",this.captureRing.style.transform="translateY("+-t+"%)"}render(){let e=this.captureIconContainer;if(!dO.activeZone)return void e.classList.remove("on");e.classList.add("on");let t=jN.getViewMatrix().multiply(jN.getProjectionMatrix()),i=Mb[dO.activeZone-1].capIconPosition,n=xc.engine.getHardwareScalingLevel(),a=xc.engine.getRenderWidth()*n,s=xc.engine.getRenderHeight()*n,r=wh.TransformCoordinates(i,t);r.y*=-1;let o,l,c=jN.getDirection(wh.Backward()),h=jN.globalPosition,f=i.x-h.x,u=i.y-h.y,d=i.z-h.z,m=Math.length3(f,u,d),p=(c.x*f+c.y*u+c.z*d)/m,_=r.x,v=r.y;if(p<0){_*=-1,v*=-1,o=Math.min(1,1/Math.abs(_)),l=Math.min(1,1/Math.abs(v)),_*=l,v*=o,Math.abs(_)>Math.abs(v)?_=Math.sign(_):v=Math.sign(v)}else o=Math.min(1,1/Math.abs(_)),l=Math.min(1,1/Math.abs(v)),_*=l,v*=o;_=_*(a/2)+a/2,v=v*(s/2)+s/2,_=Math.max(Math.min(_,.9*a),.1*a),v=Math.max(Math.min(v,.9*s),.1*s),e.style.transform="translate("+_+"px,"+v+"px)"}setCaptureState(t){this.teamScoreEl[1].innerText=dO.teamScore[1]+" / "+tO.goalScore,this.teamScoreEl[2].innerText=dO.teamScore[2]+" / "+tO.goalScore;switch(dO.activeZone&&(this.zoneMesh=Mb[dO.activeZone-1]),dO.state){case tO.state.win:this.captureBarTextEl.innerText=ZO("ingame_coop_nextround"),this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.previousCapturingTeam=0;break;case tO.state.dM:case tO.state.start:this.captureBarTextEl.innerHTML="&nbsp;",this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.previousCapturingTeam=0;break;case tO.state.unclaimed:this.captureBarTextEl.innerText=ZO("ingame_coop_find"),this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.setZoneColor(this.zoneMesh,e.zoneColor.unclaimed);break;case tO.state.capturing:var i=["","blue","red"];this.captureBarTextEl.innerText=ZO(sO[t].name).toUpperCase()+" "+ZO("ingame_coop_capturing")+" ("+dO.numCapturing+"X)",this.captureBarEl.className=i[t],this.captureRing.className=i[t],this.captureIcon.setAttribute("class",i[t]),t>0&&t!=this.previousCapturingTeam&&(this.previousCapturingTeam=t,CO.team==t?this.playSound("kotc_capturing_player"):this.playSound("kotc_capturing_opponents")),this.setZoneColor(this.zoneMesh,sO[t].lightZone);break;case tO.state.abandoned:i=["","blueAbandoned","redAbandoned"];this.captureBarTextEl.innerText=ZO(sO[t].name).toUpperCase()+" "+ZO("ingame_coop_capturing"),this.captureBarEl.className=i[t],this.captureRing.className=i[t],this.captureIcon.setAttribute("class",i[t]),this.setZoneColor(this.zoneMesh,sO[t].darkZone);break;case tO.state.contested:this.captureBarTextEl.innerText=ZO("ingame_coop_contested"),this.captureBarEl.className="contested",this.captureRing.className="contested",this.captureIcon.setAttribute("class","contested");break;case tO.state.takeover:this.captureBarTextEl.innerText=ZO("ingame_coop_takeover"),this.captureBarEl.className="takeover",this.captureRing.className="takeover",this.captureIcon.setAttribute("class","takeover")}for(let e=0;e<Mb.length;e++){Mb[e].visibility=dO.activeZone==e+1}}timeToPlayVideoAd(){return 4!==dO.teamScore[1]&&4!==dO.teamScore[2]&&null}sortPlayerList(e){this.sortPlayerListByTeamScore(e)}win(){this.setCaptureState(0);let e=document.getElementById("bigMessageContainer");e.style.display="block";let t=dO.teamScore[1]>dO.teamScore[2]?1:2;document.documentElement.style.setProperty("--ss-big-message-border-color",sO[t].lightColor),document.getElementById("bigMessage").innerHTML='<span class="bigMessageText" style="color: var(--ss-big-message-border-color)">'+ZO(sO[t].name).toUpperCase()+'</span><span class="bigMessageText">&nbsp;'+ZO("ingame_coop_win")+"</span>",t==CO.team&&CO.canTakeTeamBonus?document.getElementById("bigMessageCaption").innerHTML=ZO("ingame_coop_bonus")+' +250 <img src="img/ico_goldenEgg.webp" style="height: 2em; vertical-align: text-top" />':document.getElementById("bigMessageCaption").innerHTML=ZO("ingame_coop_nextroundbig"),setTimeout((()=>{e.style.display="none"}),5e3)}constructor(){super(),this.captureBarEl=document.getElementById("captureBar"),this.captureBarTextEl=document.getElementById("captureBarText"),this.captureIconContainer=document.getElementById("captureIconContainer"),this.captureIcon=document.getElementById("captureIcon"),this.captureRingContainer=document.getElementById("captureRingContainer"),this.captureRing=document.getElementById("captureRing"),this.captureIconCaption=document.getElementById("captureIconCaption"),this.previousCapturingTeam=0,this.teamScoreEl=[null,document.getElementById("captureScoreBlue"),document.getElementById("captureScoreRed")]}setZoneColor(e,t){e&&e.material.colorNode.value.set(t.r,t.g,t.b)}};function nO(e){return getComputedStyle(document.documentElement).getPropertyValue(e)}function aO(e){let t=nO(e);return t=t.match(/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(,\s*\d+\.*\d+)?\)\s*$/),Ah.FromInts(t[1],t[2],t[3])}iO.zoneColor={unclaimed:new Ah(.3,.3,.3),takeover:new Ah(.8,.8,.8)},iO.color=new Ah;var sO=[null,{name:"team_blue",lightColor:nO("--ss-team-blue-light"),darkColor:nO("--ss-team-blue-dark"),lightZone:aO("--ss-team-blue-light"),darkZone:aO("--ss-team-blue-dark")},{name:"team_red",lightColor:nO("--ss-team-red-light"),darkColor:nO("--ss-team-red-dark"),lightZone:aO("--ss-team-red-light"),darkZone:aO("--ss-team-red-dark")}],rO=[{logic:class extends Zw{constructor(){super()}},ui:class extends eO{constructor(){super()}sortPlayerList(e){this.sortPlayerListByKills(e)}}},{logic:class extends Zw{scoreKill(e){this.teamScore[e]++}constructor(){super()}unPackState(e){this.teamScore[1]=e.unPackInt16U(),this.teamScore[2]=e.unPackInt16U()}},ui:class extends eO{constructor(){super()}sortPlayerList(e){this.sortPlayerListByTeamKills(e)}}},{logic:class extends Zw{scoreKill(e,t){iP.Nk||iP.cM!=t.id||iP.drop();var i=Zw.otherTeam(t);iP.controlledByTeam==i&&(this.teamScore[i]++,Yw())}reset(){super.reset(),this.resetSpatula()}constructor(){super()}unPackState(e){this.teamScore[1]=e.unPackInt16U(),this.teamScore[2]=e.unPackInt16U();let t={x:e.unPackFloat(),y:e.unPackFloat(),z:e.unPackFloat()},i=e.unPackInt8U(),n=e.unPackInt8U();if(iP){if(iP.x=t.x,iP.y=t.y,iP.z=t.z,iP.cM!=i){var a=["",'<h1 class="blueTeam">'+vueApp.loc.team_blue+"</h1>",'<h1 class="redTeam">'+vueApp.loc.team_red+"</h1>"];if(255==i)CO.nk&&vueApp.ctsCapturedMsg({team:a[n],msg:"ingame_dropped_the_spatula"}),iP.drop(t);else{CO.nk&&vueApp.ctsCapturedMsg({team:n,msg:"ingame_captured_the_spatula"});let e=Jb[i];e&&e.nk&&iP.capture(Jb[i])}}}else(iP=new Vx(Xb,t)).cM=i,iP.controlledByTeam=n,255!=i&&iP.Nk.capture(Jb[i]);Yw()}resetSpatula(){iP.Nk.dispose(),iP=null;var e=document.getElementById("spatulaPlayer");e.classList.remove("capture"),e.classList.add("drop")}},ui:class extends eO{sortPlayerList(e){this.sortPlayerListByTeamScore(e)}constructor(){super()}}},{logic:tO,ui:iO}],oO=class{apiSuccess(e){this.debuglog("apiSuccess"),e&&(this.leaderboard=e,vueApp.eggOrgUpdateGlobalLeaderBoards(this.leaderboard))}apiGet(e=!0){this.debuglog("apiGet"),ib({cmd:"getEggOrgLeaderBoard"},(e=>this.apiSuccess(e)),(e=>this.apiError(e))),e&&!this.refreshLeaderboard&&(this.refreshLeaderboard=setInterval((()=>this.refreshWithLimit()),this.REFRESH_INTERVAL))}apiError(e){this.debuglog("apiError"),e&&console.log("eggOrg leaderboard error",e)}cancelRefresh(){this.debuglog("cancelRefresh"),this.refreshLeaderboard&&(clearInterval(this.refreshLeaderboard),this.refreshLeaderboard=null,this.refreshCount=0)}constructor(){this.name="EggOrgEvent",this.refreshLeaderboard=null,this.debug=!0,this.refreshCount=0,this.MAX_REFRESH_COUNT=6,this.REFRESH_INTERVAL=1e4}refreshWithLimit(){this.debuglog("refreshWithLimit"),++this.refreshCount>this.MAX_REFRESH_COUNT?this.cancelRefresh():this.apiGet(!1)}getName(){return this.name}debuglog(e){this.debug&&console.log(`${this.name}: ${e}`)}};function lO(e){return xc.playerAccount.isItemOwned(e)}function cO(){if(!PM)return;uI&&(PM=new yL);let e=xc.playerAccount.getEquippedItems();e[pc.Grenade]=null,e[pc.Melee]=null,PM.posingItems={[pc.Primary]:null,[pc.Secondary]:null,[pc.Grenade]:null,[pc.Melee]:null,[pc.Hat]:null,[pc.Stamp]:null},PM.poseWithItems(e,xc.playerAccount.stampPositionX,xc.playerAccount.stampPositionY),PM.poseWithColor(xc.playerAccount.colorIdx)}async function hO(){return new Promise(((e,t)=>{try{const t={apiKey:"AIzaSyDP4SIjKaw6A4c-zvfYxICpbEjn1rRnN50",authDomain:"shellshockio-181719.firebaseapp.com",databaseURL:"https://shellshockio-181719.firebaseio.com",projectId:"shellshockio-181719",storageBucket:"shellshockio-181719.appspot.com",messagingSenderId:"68327206324"};firebase.apps.length?firebase.app():firebase.initializeApp(t),new Date,xc.playerAccount=new Dc;const i=localStore.getItem("localLoadOut");if(i){const e=JSON.parse(i);xc.playerAccount.applyLocalLoadout(e.items)}else xc.playerAccount.applyRandomLoadout();console.log("Start account search with Firebase..."),parsedUrl.query.sandbox&&firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION);const n=setTimeout((()=>{console.warn("Firebase auth timeout"),e(!1)}),5e3);firebase.auth().onAuthStateChanged((t=>{clearTimeout(n),XM&&!hasValue(t)||(t&&(cI=!0),e(!0),console.log("firebase resolved: has account",cI),t?((WM=t).isAnonymous?(console.log("Firebase: anonymous user"),VM=WM,cI||!0):(console.log("Firebase: auth provider: "+WM.providerData[0].providerId),WM.emailVerified||"password"!==WM.providerData[0].providerId||(console.log("Firebase: email not yet verified"),SI=!0)),fO()):(console.log("Firebase: no account found"),console.log("No account created yet :("),zM=!1,CM=!0,cI=!1,JO(),TI.aBParamCheck&&(TI.getOrCreateRandID(),TI.assignABTestVariant(),"a"===TI.getAssignedVariant()&&GD())))}))}catch(e){console.error("Error in signIn:",e),t(e)}}))}function fO(){if(!zM&&(zM=!0,XM=!1,cI=!0,WM.getIdToken(!0).then((e=>{!function(e,t,i,n){ib({cmd:"auth",firebaseToken:e},t,i,n)}(e,vO,gO,SO)})).catch((function(e){console.log(e),zM=!1})),WM.providerData.length>0&&WM.providerData[0].providerId,WM.photoURL&&WM.providerData&&WM.providerData.length>0)){var e=WM.photoURL;wI=e}}xc.resetPaperDoll=cO;var uO,dO,mO,pO=null;function _O(){console.log("sending Firebase email verification"),WM.sendEmailVerification()}async function vO(e){const{playerOutput:t,gameOutput:i}=e;if(i.premiumSkuId&&hI.replaceItemProduct(204),t.hasOwnProperty("dateModified")&&t.hasOwnProperty("dateCreated")){const e=Math.floor(Math.abs(new Date(t.dateModified)-new Date(t.dateCreated))/36e5);EI=e>1}if(t.hasOwnProperty("banRemaining")){let e,i=t.banRemaining.split(":"),n=parseInt(i[0]),a=parseInt(i[1]);e=n>24?`${Math.floor(n/24)} ${ZO("time_days")}`:n>0?`${n} ${ZO("time_hours")}`:`${a} ${ZO("time_minutes")}`,vueApp.showBannedPopup(e)}else if(e.error)console.log("accountDataResponse Error: "+JSON.stringify(accountDataResponse.error));else{if(await new Promise((e=>{let t=setInterval((()=>{xc.ready_meshes&&(clearInterval(t),e())}))})),xc.playerAccount.signedIn(WM,t),vueApp.authCompleted(),CM=!0,setTimeout((()=>xc.playerAccount.syncToServer()),1e3),Jx(t.chwReady),uI&&(fI&&tryMidMonthNewYolkerReward(),xc.showSigninBonus&&(BO(),xc.showSigninBonus=!1),JO(),vueApp.progressBarReset()),null!==VM)ga("set","vip_status","NoVIP");else{parsedUrl.query.signInPrompt&&parsedUrl.query.closeAfterSign&&window.close();const e=t.active_sub;ga("set","vip_status",null===e?"NoVIP":e?"IsVIP":"WasVIP"),e&&vueApp.hideHomeScreenAds(!0)}CI.dailyTimerStart(),console.log("Signed in"),cI||null===pO||(console.log("Nonaccount is now anon. Time for play"),vueApp.assetLoaded(),cI=!0,hD(!1),FO(),fD(pO))}!1}function gO(){console.log("authorization failed"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.signIn,vueData.googleAnalytics.label.signInAuthFailed),Tx.hide(),vueApp.authCompleted()}function SO(e){console.log("auth ws closed, code: "+e),1006!==e?zM=!1:vueApp.showGenericPopup("signin_failed_title","signin_failed","ok")}function yO(){HM||(HM=new firebaseui.auth.AuthUI(firebase.auth()));var e={autoUpgradeAnonymousUsers:!0,callbacks:{signInSuccessWithAuthResult:EO,signInFailure:AO,uiShown:function(e){console.log("UI: showed firebase UI");const t=document.querySelector(".firebaseui-idp-list");if(t){const e=document.createElement("li"),i=document.createElement("button"),n=document.createElement("span"),a=document.createElement("img"),s=document.createElement("span");i.onclick=()=>{vueApp.fbTransferAccountSignin()},i.className="firebaseui-idp-button mdl-button mdl-js-button mdl-button--raised firebaseui-idp-facebook firebaseui-id-idp-button",i.style.backgroundColor="#3b5998",s.className="firebaseui-idp-text firebaseui-idp-text-long",s.textContent="Sign in with Facebook",n.className="firebaseui-idp-icon-wrapper",a.className="firebaseui-idp-icon",a.src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg",e.className="firebaseui-list-item",n.appendChild(a),i.appendChild(n),i.appendChild(s),e.appendChild(i),t.appendChild(e)}}},credentialHelper:firebaseui.auth.CredentialHelper.NONE,signInFlow:"popup",signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1},firebase.auth.GoogleAuthProvider.PROVIDER_ID],tosUrl:"http://www.bluewizard.com/terms"};HM.start("#firebaseui-auth-container",e),uI=!0,wO()}function EO(e,t){var i=(WM=e.user).emailVerified,n=(e.credential,e.additionalUserInfo.isNewUser,e.additionalUserInfo.providerId);e.operationType;return vueApp.hideFirebaseSignIn(),"password"!=n||i||_O(),console.log("Authing Firebase ID"),fO(),!1}function AO(e){if(vueApp.hideFirebaseSignIn(),console.log("Firebase: sign in failure, error code: "+e.code),"firebaseui/anonymous-upgrade-merge-conflict"!==e.code)return Promise.resolve();XM=!0,firebase.auth().signInWithCredential(e.credential),VM.delete(),setTimeout((()=>{vueApp.$nextTick((()=>{vueApp.urlParamSet=!!vueApp.urlParams||null,vueApp.shellShockUrlParamaterEvents()}))}),2e3)}var CO,RO,TO,NO,MO=!1;async function IO(e){try{if(!await async function(){return(SM=Ec)?(yM=getStoredString("lastVersionPlayed",Ac))&&yM!==Ac?(rD(),!1):(localStore.setItem("lastVersionPlayed",Ac),!0):(console.error("Failed to retrieve version"),!1)}())return;PI=await hO().catch((e=>(console.error("Firebase sign-in failed:",e),null))),parsedUrl.query.testMap&&(OM=!0);const e=(mM=getStoredString("languageSelected",null),hasValue(mM)?mM:xO());vI=function(){let e="",t=document.createElement("canvas").getContext("webgl");e+=t.getParameter(t.VERSION);let i=t.getExtension("WEBGL_debug_renderer_info");null!=i&&(e+=t.getParameter(i.UNMASKED_RENDERER_WEBGL),e+=t.getParameter(i.UNMASKED_VENDOR_WEBGL)),e+=navigator.userAgent+navigator.language,vI=1;for(let t in e)vI=vI*e.charCodeAt(t)%Number.MAX_SAFE_INTEGER;vI+=(navigator.hardwareConcurrency+navigator.maxTouchPoints)%Number.MAX_SAFE_INTEGER}(),JN=getStoredNumber("gameType",oc.find((e=>"Spatula"===e.shortName)).value),await async function(){const e=document.getElementById("canvas");if(!e)throw new Error("Canvas element not found");xc.engine=new Md(e,!0,{preserveDrawingBuffer:!0,stencil:!0},!1),xc.engineCaps=xc.engine.getCaps(),xc.engineCaps.parallelShaderCompile=void 0,xc.engine.disableManifestCheck=crazyGamesActive,xc.engine.enableOfflineSupport=!crazyGamesActive}(),(hI=new PL).init(),xc.catalog=new nx,xc.catalog.getPremiumGunMeshNames(),CI=new TL,eggOrgLeaderboard=new oO,tD(),gL.connect(),LO(),function(){let e=getStoredString("selectedLanguage",null);if(!hasValue(e))return;let t=xO();"en"!==e&&e===t&&(console.log("Updating to new localStore for language setting"),localStore.setItem("languageSelected",t),ga("send","event",{eventCategory:vueData.googleAnalytics.cat.playerStats,eventAction:vueData.googleAnalytics.action.langBeforeUpdate,eventLabel:e}));localStore.removeItem("selectedLanguage"),console.log("selectedLanguage item removed")}(),vueData.maps=Sx;const t=await QO(e);gM=new OL(16029),startVue(e,t),console.log("ShellShockers startup complete")}catch(e){console.error("Critical error during game startup:",e)}}function xO(){let e=rI.includes("-")?rI.split("-")[0].toLowerCase():rI,t=vueData.languages,i=null;for(let n=0;n<t.length;n++)if(t[n].code===e){i=!0;break}return hasValue(i)?e:"en"}function bO(){(yI=new tb).init(),xM=yI.isAdBlocking(),function e(t=0){"undefined"!=typeof aiptag&&aiptag.stack?ga("send","event","user_property","aip_stack",aiptag.stack):t<10&&setTimeout((()=>{e(t+1)}),100)}()}function PO(){if(console.log("afterResourcesLoaded"),xc.ready_meshes=!0,UD.init(),GL(),getRequest("data/housePromo.json?"+Date.now(),(function(e,t){if(0===Object.keys(HouseAds).length&&HouseAds.constructor===Object)iI={big:[],small:[],bigBanner:[],houseAdPercentChance:100,smHouseAds:[],shellLogo:[]};else{const e={socialMedia:"",premFeat:""};iI=HouseAds,hL(),console.log("special items tag: "+iI.specialItemsTag),hasValue(iI.specialItemsTag)&&xc.catalog.getTaggedItems(iI.specialItemsTag).length>0?vueApp.useSpecialItemsTag(iI.specialItemsTag):vueApp.disableSpecialItems(),hasValue(iI.featuredSocialMedia)&&(e.socialMedia=iI.featuredSocialMedia),hasValue(iI.premFeatured)&&(e.premFeat=iI.premFeatured,BI[e.premFeat]=!0),iI.smHouseAds.length>0&&vueApp.ui.houseAds.homeScreen.push(...iI.smHouseAds),vueApp.useTags(e)}!0})),console.log("From EU: "+isFromEU),VL(),IM.autoDetail||aD(IM.highRes),OM)return kM.x=parsedUrl.query.x,kM.y=parsedUrl.query.y,kM.z=parsedUrl.query.z,kM.pitch=parsedUrl.query.pitch,kM.yaw=parsedUrl.query.yaw,TO=1,uO={send:function(){}},bM=!0,vueApp.setInGame(bM),xc.engine.stopRenderLoop(),void pP();PM=new yL,RM=!0,pM=new AL,NL(),parsedUrl.query.openSettings&&vueApp.showSettingsPopup(),parsedUrl.query.test&&(UM=!0),parsedUrl.query.noSkybox&&(GM=!0),pokiActive&&vueApp.isPlayingPoki(),AM=!0}async function wO(){return OI?(vueApp.assetSetup(vueApp.ui.homeToGameProgressBar.accountTotal),!0):(console.log("Loading all object meshes..."),OI=!0,await new Promise((e=>{Dx(NO,["egg","gun_eggk47","gun_csg1","gun_cluck9mm","gun_dozenGauge","gun_rpegg","gun_smg","gun_m24","gun_aug","melee","munitions"],null,(()=>{console.log("All object meshes loaded"),vueApp.assetLoaded(),e()}),OI)})),qN=new yp("img/stamps.webp?v="+SM,NO,!1,!0),vueApp.assetLoaded(),PM||(PM=new yL),PM.setStampTexture(),uL=new vL,vueApp.assetLoaded(),NO.cleanCachedTextureBuffer(),console.log("All meshes and ItemRenderer loaded and initialized"),mI||Xw(),!0)}function OO(){return hasValue(vueApp)&&vueApp.ready&&AM&&CM&&RM&&NM}var DO=0;function LO(){if(DO>=100)return vueApp.showGenericPopup("uh_oh","error","ok"),void ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.error,vueData.googleAnalytics.label.waitForGameReadyTimeout);OO()?function(){if(OM)return;var e=document.getElementById("onesignal-bell-container");e&&(e.style.display="none");(function(){const e=document.getElementById("changelog-link");e&&e.addEventListener("click",(e=>{e.preventDefault(),vueApp.hideChangelogPopup(),vueApp.showScavengerHuntPopup(),ga("send","event","changelog","clicked","showScavengerHuntPopup")}))})(),ga("send","event","ads","ad blocker",xM.toString()),cO(),!0,KD(),t=getStoredString("lastUsername",zx()),vueApp.setPlayerName(t);var t;[UO,GO,$O,kO,jO,qO,VO,WO,KO,zO,YO,HO].some((e=>e())),eggOrgLeaderboard.apiGet(),function(){if(!cI)return!0;if(xc.playerAccount.isItemOwned({id:16020}))return vueApp.hasMobileReward=!0,!0}(),vueApp.hideSpinner(),Tx.hide(),e&&(e.style.display="none");console.log("After Game Ready"),vueApp.shellShockUrlParamaterEvents(),function(){const{notification:e,factionActivated:t}=xc.playerAccount;if(!e||e.read)return void(t&&(vueApp.showFactionActivatedPopup(),xc.playerAccount.factionActivated=!1));t&&(vueApp.faction.showPopup=!0,xc.playerAccount.factionActivated=!1);const{type:i}=e,n=[];let a=0;const s=()=>{setTimeout((()=>{var e,t;e=()=>console.log("Notifications: SUCCESS"),t=()=>console.log("Notifications: ERROR"),ib({cmd:"notify_mark_as_complete",firebase_id:xc.playerAccount.firebaseId},e,t)}),500)},r=(e,t,i,a,s=null)=>{n.push({type:e,data:{items:t,eggs:i,ids:a,product:s}})};Object.entries(i).forEach((([e,t])=>{const i=Array.isArray(t?.ids)?[...new Set(t.ids)]:[],n="number"==typeof t?.eggs?t.eggs:0;let s=null;if("pass"===e||"bundle"===e){const t=function(e,t){return hI.getProductByItemIds(e,t)}(e,i);s=t&&t.length?t[0]:null}a+=n;const o=i.length>0?xc.catalog.findItemsByIds(i):[];(o.length>0||n>0)&&(console.log(`Processing notification type: ${e}`),console.log("Product Data:",s),r(e,o,n,i,s))})),a>0&&r("currency",[1],a,[]);n.length>0&&(console.log("Displaying Popup Data:",n),vueApp.showPurchasesPopup(n,s))}(),ga("send","timing","load","homeLoaded",Math.round(performance.now()),"home"),bO(),xc.productBlockAds||vueApp.showTitleScreenAd();CI.resizeAllText(),function(){const e=xc.catalog.findItemById(bI);II=!!e&&xc.playerAccount.isItemOwned(e)}(),FO(),kD(),function(){if(cI||VM)return;vueApp.statsCurrent=new bc,vueApp.statsLifetime=vueApp.statsCurrent}(),HI=!0,qL(!0)}():setTimeout(LO,200)}function FO(){vueApp.eggStoreItems=hI.getStoreItems(),vueApp.premiumShopItems=hI.getShopItems(),vueApp.subStoreItems=hI.getSubscriptions()}function kO(){const e=xc.playerAccount.challengesHasAutoClaim;if(!e||0===e.length)return!1;const t=e.filter((e=>"claimed"===e.status)).map((e=>{const t=extern.playerChallenges.challengeGet(e.id);return t?.loc_ref&&(e.loc_ref=t.loc_ref),t?.reward&&(e.reward=t.reward),[e.id,e.loc_ref,e.reward]}));return vueApp.showPurchasesPopup([{type:"challenges",data:{items:t}}]),nb(),xc.playerAccount.challengesHasAutoClaim=[],!0}function BO(){return!!xc.showSigninBonus&&(vueApp.ui.bonus.showing=!0,vueApp.showPurchasesPopup([{type:"currency",data:{ids:[],items:[],eggs:vueApp.ui.bonus.amount}}]),!0)}function GO(){if(SI)return SI=!1,void vueApp.showResendEmail();BO()}function UO(){parsedUrl.hash&&parsedUrl.query.observe?(console.log("TRYING TO JOIN GAME AUTOMATICALLY",parsedUrl.hash),LM=!0,FM=parsedUrl.query.watchPlayer):LM=!1;const e="crazyShare"in parsedUrl.query;if(!parsedUrl.hash&&!e)return!1;const t=e?parsedUrl.query.crazyShare:parsedUrl.hash;return vueApp.showJoinPrivateGamePopup(t),!0}function HO(){var e=new URLSearchParams(document.location.search);return!1!==e.has("storeItem")&&(vueApp.showPopupEggStoreSingle(e.get("storeItem")),!0)}function VO(){var e=new URLSearchParams(document.location.search);if(!1===e.has("showItem"))return!1;var t=parseInt(e.get("showItem"));if(!1===(Number.isInteger(t)&&null!==xc.catalog.findItemById(t)&&!1===$M))return!1;var i=xc.catalog.findItemById(t);return vueApp.showItemOnEquipScreen(i),!0}function WO(e){return null!==(qM=e||qM)&&(vueApp.showTaggedItemsOnEquipScreen(qM),!0)}function zO(){if(null===JM||xc.playerAccount.isUpgraded())return!1;vueApp.showChicknWinnerPopup(),JM=null}function XO(){vueApp.onWelcomeBundlePopupShow()}function YO(){var e=new URLSearchParams(document.location.search);if(!e.has("purchase"))return!1;if(xc.playerAccount.isAnonymous)return vueApp.showGenericPopup("uh_oh","anon_account","ok"),!1;var t=e.get("purchase");return vueApp.showPopupEggStoreSingle(t),!0}function jO(){return!1!==new URLSearchParams(document.location.search).has("signInPrompt")&&(yO(),vueApp.$refs.firebaseSignInPopup.show(),!0)}function KO(){const{vipSubEnded:e,passEnded:t}=xc;if(e||t){const t=e?0:1;return vueApp.vipEndedPopup(t),!0}return!1}function $O(){var e,t,i,n=new URLSearchParams(document.location.search);if(!n.has("invoice_id")&&!localStore.getItem("xsollaPurchase"))return!1;localStore.removeItem("xsollaPurchase"),window.history.replaceState(null,null,"/"),e=n.get("invoice_id"),t=e=>{if("SUCCESS"===e.result&&(e.details.item_id||e.details.amount)){let t=null;if(e.details.item_id){const i=xc.catalog.findItemById(e.details.item_id);t=xc.playerAccount.isItemOwned(i)?i:null}return t&&vueApp.showItem(t),vueApp.showGiveStuffPopup("give_stuff_twitch_title",e.details.amount,hasValue(t)?[t]:t),!0}return!1},i=e=>!1,ib({cmd:"checkAfterStorePurchase",playerId:xc.playerAccount.id,transactionId:e},t,i)}function qO(){let e;const t=new URLSearchParams(document.location.search);if(kI.forEach((i=>{t.has(i)&&(e=i)})),!hasValue(e))return!1;console.log("tryUrlParam reward",e);let i=Date.now();const n=localStore.getItem(e);if(hasValue(n)){const t=Number(n)+432e6;if(i<t)return console.log(e+" reward already given!"),!1}var a,s;return a=function(t){PD(t,{success(){localStore.setItem(e,i)},prevGiven(){this.success()},expired(){this.succces()},playerNotFound(){vueApp.showGenericPopup("player_not_found_title","player_not_found_desc","ok")},error(){this.playerNotFound()},default(){this.playerNotFound()}})},s=function(){console.log(e,"error")},ib({cmd:"urlRewardParams",reward:e,sessionId:xc.playerAccount.sessionId,firebaseId:xc.playerAccount.firebaseId},a,s),!0}function JO(){const e=["lastPreRoll","localLoadOut","showBigAd","lastUsername"],t=vueApp?.ui?.socialMedia?.footer;t&&Array.isArray(t)&&t.forEach((t=>e.push(t.reward+"Rewarded"))),e.push(...kI),e.forEach((e=>{localStore.getItem(e)&&localStore.removeItem(e)}))}async function QO(e){try{const t=await fetch(`language/${e}.json?${SM}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();return CI.resizeAllText(),vueApp?.setLocData?.(e,i),i}catch(e){throw console.error("Error loading language data:",e),e}}function ZO(e){return vueData.loc[e]||"["+e+"]"}var eD=null;function tD(){clearTimeout(eD),eD=setTimeout((()=>(eD=null,console.log("%cSTOP!","color:red; font-size:60px; font-weight: bold; text-shadow: 0 0 2px black;"),void console.log("%cThis is a browser feature intended for developers. If someone told you to copy and paste something here, there is a good chance that they are attempting to gain access to your account and personal information!","font-size: 18px;"))),500),canvas&&(canvas.style.width="100%",canvas.style.height="100%"),xc.engine&&(xc.engine.resize(),IM&&IM.highRes&&xc.engine.setHardwareScalingLevel(IM.highRes)),bM&&(Lb&&Lb.resize(),Fb&&Fb.resize(),Db&&Db.resize())}function iD(){$N&&SD.clear($N),console.log("Auto detail enabled"),$N=SD.set((()=>{nM/aM<40&&xc.engine.getFps()<40&&(Xb.shadowsEnabled?(sD(!1),IM.shadows=!1):(aD(!1),IM.highRes=!1,nD()),UL())}),4e3)}function nD(){$N&&(SD.clear($N),$N=null)}function aD(e){console.log("setting high resolution: "+e),xc.engine.setHardwareScalingLevel(e?1:2),function(){Db&&Db.resize();Lb&&Lb.resize();Fb&&Fb.resize();Ob&&Ob.uM.isEnabled()&&Ob.show()}()}function sD(e){console.log("setting shadows: "+e),Xb.shadowsEnabled=e}function rD(){var e=window.indexedDB.deleteDatabase("babylonjs");e.onerror=function(e){oD()},e.onsuccess=function(e){oD()}}function oD(){localStore.setItem("lastVersionPlayed",Ac),window.location.reload(!0)}function lD(){xc.engine.resize()}function cD(e){xc.playerAccount.syncToServer(e)}function hD(e){mI=e,vueApp.disablePlayButton(e)}function fD(e){if(!mI){if(ZM&&(clearInterval(ZM),ZM=null),hD(!0),PM.scale(),cI&&(eM=getSetIncrementStoredNum("timesPlayed",1)),!xc.productBlockAds){var t=getStoredNumber("lastPreRoll",0),i=!1;if(0==t&&(t=Date.now(),localStore.setItem("lastPreRoll",t)),(EI||eM>1)&&(i=!0),QM||Date.now()>t+24e4&&i)return console.log("play() calls PVA"),yI.play("shellshock.io_preroll",(()=>uD(e))),void vueApp.hideHomeScreenAds(!0)}uD(e)}}async function uD(e){if(console.log("play(): "+JSON.stringify(e)),vueApp.setDarkOverlay(!1),!cI)return console.log("Create account now."),gI=!0,vueApp.onTutorialPopupClick(),ga("send","event","tutorial","newUserPopup"),vueApp.assetSetup(vueApp.ui.homeToGameProgressBar.nonAccountTotal),void function(e){!0,firebase.auth().signInAnonymously().then((()=>{firebase.auth().onAuthStateChanged((t=>{cI=!0,!0,null!==t&&e&&t.isAnonymous&&(cI=!1,pO=e)}))})).catch((function(e){console.debug("Failed Firebase anonymous signin, code: {0}, msg: {1}".format(e.code,e.message))}))}(e);eggOrgLeaderboard.cancelRefresh();await wO()?(hasValue(e.playerName)&&0!==e.playerName.length&&!/^ *$/.test(e.playerName)||(e.playerName=zx(),vueApp.setPlayerName(e.playerName)),localStore.setItem("lastUsername",e.playerName),e.playType===vueApp.playTypes.joinPrivate?gL.joinPrivateGame(e).then((t=>{cM=t.private,e.subdomain=t.subdomain,e.id=t.id,QN=t.id,e.uuid=t.uuid,vueApp.currentRegionId=t.region,dD(e)})).catch((e=>gD(e))):gL.findGame(e).then((t=>{cM=t.private,e.subdomain=t.subdomain,e.id=t.id,QN=t.id,e.uuid=t.uuid,vueApp.currentRegionId=t.region,dD(e)})).catch((e=>{gL.getRegions().then((()=>CL())),gD(e)}))):console.log("all mesh load error")}function dD(e){console.log("prepareToJoinGame",e),document.body.scrollTop=document.documentElement.scrollTop=0,MM=performance.now(),function(e){vueApp.mediaTabsCancelRotate(),_D(1),pD=null,e.playerName=RD(e.playerName,80),aI=!1,e.playType===vueApp.playTypes.createPrivate?aI=!0:(e.playType,vueApp.playTypes.joinPrivate);e.playType;let t=0;function i(){let n=(isHttps()?"wss":"ws")+"://"+mD(e.subdomain)+"/game/"+e.id;console.log("Connecting to: "+n),(uO=new WebSocket(n)).binaryType="arraybuffer",uO.onopen=function(e){console.log("WebSocket opened")},uO.onclose=function(e){e.code===tc.sessionNotFound?(console.log(`Connect attempt #${t} - code: ${e.code}`),++t>10?gD(e.code):setTimeout(i,1e3)):gD(e.code)},uO.onmessage=function(t){switch(Nc.init(t.data),Nc.unPackInt8U()){case nc.$:ga("send","event","play game","class",xc.classes[xc.playerAccount.classIdx].name);const t=getStoredBool("hideBadge",0)?1:0;!function(){wD("primaryGun",xc.playerAccount.getPrimaryWeapon().name),wD("SecondaryGun",xc.playerAccount.getSecondaryWeapon().name),"undefined"!=typeof EGGCOLOR&&wD("eggColor",Object.keys(EGGCOLOR).find((e=>EGGCOLOR[e]===xc.playerAccount.colorIdx)));null!==xc.playerAccount.hatItem&&wD("hat",xc.playerAccount.hatItem.name);null!==xc.playerAccount.stampItem&&wD("stamp",xc.playerAccount.stampItem.name);null!==xc.playerAccount.grenadeItem&&xc.playerAccount.grenadeItem.hasOwnProperty("name")&&wD("grenade",xc.playerAccount.grenadeItem.name)}();var i=Tc.getBuffer();LM?i.BkMzMvJt(nc.N):i.BkMzMvJt(nc.k),i.AABkMzMvLI(e.playerName),i.AABkMzMvLI(e.uuid),i.BkMzMvJt(t),i.BkMzMvJt(xc.playerAccount.classIdx),xc.playerAccount.firebaseId&&(i.ABkMzMvKa(xc.playerAccount.session),i.AABkMzMvLI(xc.playerAccount.firebaseId),i.AABkMzMvLI(xc.playerAccount.sessionId)),i.send(uO);break;case nc.Yt:var n=Nc.unPackLongString();ew(n);break;case nc.S:console.log("BkMzMvJM.gameJoined_ received"),RO=Nc.unPackInt8U(),dM=Nc.unPackInt8U(),JN=Nc.unPackInt8U(),ZN=Nc.unPackInt8U(),TO=Nc.unPackInt8U(),fM=1==Nc.unPackInt8U(),cM=1==Nc.unPackInt8U();Nc.unPackInt8U();let a=rO[JN];dO=new a.logic,mO=new a.ui,function(){rM=document.getElementById("chatIn"),oM=document.getElementById("chatOut"),lM=document.getElementById("killTicker");var e=document.getElementById("playerList");!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(e);for(var t=document.getElementById("playerSlot"),i=0;i<20;i++){var n=t.cloneNode(!0);e.appendChild(n)}oM.innerHTML="",1==IM.enableChat&&(ww(),oM.style.display="block",rM.style.display="block"),lM.innerHTML="",oM.value="",document.getElementById("scopeBorder").style.display="none",document.getElementById("spatulaPlayer").classList.replace("capture","drop"),document.getElementById("spectate").style.display="none",document.getElementById("teamScores").style.display=JN==rc.ctf?"grid":"none",document.getElementById("captureContainer").style.display=JN==rc.king?"block":"none",document.getElementById("captureIconContainer").style.display="none",document.getElementById("playerList").style.pointerEvents="auto",aw(),Db&&Db.setPowerful(!1),console.log("resetGameUI")}(),Yw(),MO=JN==rc.teams||JN==rc.ctf,console.log("game joined: game type:  "+JN),vueApp.gameJoined(JN,dM),console.log("is game owner: "+fM),bM=!0,vueApp.setInGame(bM);const s=vueData.gameTypes.find((({value:e})=>e===JN));hM=e.playType===vueApp.playTypes.createPrivate?"createPrivate":cM?"joinPrivate":""!==e.joinCode?"joinPublicByInvite":"joinPublic",vM=new Yx,ED=!1,ga("send","event",vueData.googleAnalytics.cat.play,hM,`Map - ${Sx[ZN].name}`),ga("send","event",vueData.googleAnalytics.cat.play,hM,`Game type - ${s.locKey}`),ga("send","event",vueData.googleAnalytics.cat.play,hM,vueData.googleAnalytics.action.playerLimit,TO),ga("send","event",vueData.googleAnalytics.cat.play,hM,vueData.googleAnalytics.action.timesPlayed,eM),pP();break;case nc.H:vD()}}}i()}(e)}function mD(e){let t=dynamicContentRoot||window.location.hostname;return t=t.split("."),t.length>2&&(t=t.slice(-2)),t=t.join("."),`${e}.${t}`}document.onfullscreenchange=lD,document.onmsfullscreenchange=lD,document.onmozfullscreenchange=lD,document.onwebkitfullscreenchange=lD;var pD=null;function _D(e){const t=document.getElementById("chw-home"),i=document.getElementById("chw-game-screen"),n=document.getElementById("chw-home-timer");1===e?i.appendChild(n):t.appendChild(n)}function vD(){rx.serialize().send(uO)}function gD(e){if(hD(!1),vueApp.mediaTabsStartRotate(),BM)return;let t=!1;switch(Object.keys(tc).forEach((i=>{tc[i]===e&&(console.log("Socket Closed: "+i),t=!0)})),t||console.log("Socket Closed: "+e),e){case tc.locked:console.log("Game locked"),ga("send","event","Websocket","onclose","Game locked"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_locked","game_locked_msg","ok");break;case tc.uuidNotFound:console.log("UUID invalid"),ga("send","event","Websocket","onclose","UUID not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect","session_expired_msg","ok");break;case tc.sessionNotFound:console.log("Session not found"),ga("send","event","Websocket","onclose","Session not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect","session_expired_msg","ok");break;case tc.gameNotFound:console.log("Game not found"),ga("send","event","Websocket","onclose","Game not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_not_found","game_not_found_msg","ok");break;case tc.gameFull:case tc.gameMaxPlayersExceeded:console.log("Game full"),ga("send","event","Websocket","onclose","Game full"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_full","game_full_msg","ok");break;case tc.mainMenu:ga("send","event","Websocket","onclose","Return to main menu");break;case tc.regionFull:ga("send","event","Websocket","onclose","Region full"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case tc.clusterFullCpu:ga("send","event","Websocket","onclose","Game Cluster max CPU"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case tc.clusterFullMem:ga("send","event","Websocket","onclose","Game Cluster max RAM"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case tc.booted:bM?vueApp.leaveGame():vueApp.hideSpinner(),vueApp.showGenericPopup("connection_lost","booted","ok");break;case tc.gameIdleExceeded:vueApp.leaveGame(),vueApp.showGenericPopup("connection_lost","inactivity","ok");break;default:if(bM)ga("send","event","Websocket","onclose","Connection Lost"),vueApp.leaveGame(),vueApp.showGenericPopup("connection_lost","connection_lost_msg","ok");else{var i="";if(pD===nc._)i="login_required";else i="generic_conn_failed";vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect",i,"ok")}}}var SD={intervals:{},set:function(e,t){var i=setInterval.apply(window,[e,t].concat([].slice.call(arguments,2)));return SD.intervals[i]=!0,i},clear:function(e){return delete SD.intervals[e],clearInterval(e)},clearAll:function(){for(var e=Object.keys(SD.intervals),t=e.length;t-- >0;)clearInterval(e.shift());SD.intervals={}}},yD={timeouts:{},set:function(e,t){var i=setTimeout.apply(window,[e,t].concat([].slice.call(arguments,2)));return yD.timeouts[i]=!0,i},clear:function(e){return delete yD.timeouts[e],clearTimeout(e)},clearAll:function(){for(var e=Object.keys(yD.timeouts),t=e.length;t-- >0;)clearTimeout(e.shift());yD.timeouts={}}};var ED=!1;function AD(e){if(CO&&(vM.kills>0||vM.deaths>0)){const t="player stats",i=xc.classes[CO.charClass].name;0===vM.kills&&vM.deaths>0?ga("send","event",t,"rageQuit",i,vM.deaths):ga("send","event",t,"best kill streak",i,Vb),e&&e()}}function CD(){iM>10&&(ga("send","timing","game","ping",Math.floor(tM/iM),vueData.currentRegionId),ga("send","event","game","stats","fps",Math.ceil(nM/aM)))}function RD(e,t){t=t||80;var i=nI.getContext("2d");for(i.font="1em Nunito, sans-serif";;){if(i.measureText(e).width<t)break;e=e.substr(0,e.length-1)}return e}var TD=[{start:688,end:7679},{start:7936,end:11359},{start:11392,end:11903},{start:12032,end:12255},{start:12272,end:12287},{start:12352,end:12735},{start:12784,end:12799},{start:19904,end:19967},{start:40960,end:42783},{start:43008,end:43823},{start:43888,end:63743},{start:64256,end:65071},{start:65104,end:65535}];function ND(e){let t="";for(let i of e){let e=i.codePointAt(0),n=!0;if(e>65535||21325==e||21328==e)n=!1;else for(let t of TD)if(e>=t.start&&e<=t.end){n=!1;break}n&&(t+=i)}return t}var MD,ID,xD=["dGV4dENvbnRlbnQ=","b2JzZXJ2ZQ==","TXV0YXRpb25PYnNlcnZlcg==","bGVuZ3Ro","dGFyZ2V0","b3V0ZXJUZXh0"];MD=xD,ID=458,function(e){for(;--e;)MD.push(MD.shift())}(++ID);var bD=function(e,t){var i,n=xD[e-=0];void 0===bD.IFPkJC&&((i=function(){var e;try{e=Function('return (function() {}.constructor("return this")( ));')()}catch(t){e=window}return e}()).atob||(i.atob=function(e){for(var t,i,n=String(e).replace(/=+$/,""),a="",s=0,r=0;i=n.charAt(r++);~i&&(t=s%4?64*t+i:i,s++%4)?a+=String.fromCharCode(255&t>>(-2*s&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return a}),bD.vaQvzy=function(e){for(var t=atob(e),i=[],n=0,a=t.length;n<a;n++)i+="%"+("00"+t.charCodeAt(n).toString(16)).slice(-2);return decodeURIComponent(i)},bD.QEYrQv={},bD.IFPkJC=!0);var a=bD.QEYrQv[e];return void 0===a?(n=bD.vaQvzy(n),bD.QEYrQv[e]=n):n=a,n};function PD(e,t,i,n){let a=i||"reward_title";if(hasValue(t.name)||(t.name="Game reward"),e.error)console.log(t.name+" Error: "+JSON.stringify(e.error));else switch(console.log(t.name+" response: "+e.result),e.result){case"SUCCESS":void 0!==t.success&&t.success();var s=0;hasValue(e.eggsGiven)&&e.eggsGiven>0&&(s=e.eggsGiven,nb());var r=[];hasValue(e.itemIds)&&e.itemIds.length>0&&(r=xc.catalog.findItemsByIds(e.itemIds)).forEach((e=>{xc.playerAccount.isItemOwned(e)||(xc.playerAccount.inventory.push(e),console.log(t.name+" Reward item given, id: "+e.id))})),vueApp.showGiveStuffPopup(a,s,r,i);break;case"REWARD_PREV_GIVEN":void 0!==t.prevGiven&&t.prevGiven(),vueApp.showGenericPopup("uh_oh","reward_already","ok");break;case"REWARD_EXPIRED":void 0!==t.expired&&t.expired(),vueApp.showGenericPopup("uh_oh","reward_expired","ok");break;case"REWARD_NOT_FOUND":case"URL_PARAM_NOT_FOUND":void 0!==t.notFound&&t.notFound(),vueApp.showGenericPopup("uh_oh","reward_not_found","ok");break;case"PLAYER_NOT_FOUND":void 0!==t.playerNotFound&&t.playerNotFound();break;case"ERROR":void 0!==t.error&&t.error(),console.log(t.name+" error: "+e.error),vueApp.showGenericPopup("uh_oh","error","ok");break;default:void 0!==t.default&&t.default(),vueApp.showGenericPopup("uh_oh","error","ok")}}function wD(e,t){return ga("send","event","play game",e,t)}new(window[bD("0x0")])((e=>{for(var t=0;t<e[bD("0x1")];t++){var i=e[t];(i[bD("0x2")][bD("0x3")][bD("0x1")]>3e6||i.target[bD("0x4")].length>3e6)&&255}}))[bD("0x5")](document,{childList:!0,subtree:!0});var OD=()=>{if(window.self===window.top)return console.log("Not playing in iframe"),!0;console.log("Playing in iframe");const e=(()=>{const e=window.location!=window.parent.location?document.referrer:document.location.href,t=new URL(e).hostname.replace(/(www.)/,"").split(".");return!(!Array.isArray(t)&&!t.length)&&{domain:t,index:t.length-2}})();e.domain,e.index;return!0};function DD(){!function(e,t){ib({cmd:"updatePlayerStats",playerId:xc.playerAccount.id},e,t)}((function(e){e&&(xc.playerAccount.setStats(e.statsLifetime,e.statsCurrent),xc.playerAccount.eggsSpent=e.eggsSpent,xc.playerAccount.eggsSpentMonthly=e.eggsSpentMonthly),vueApp.statsLoading()}),(function(e){console.log("Player stats error",e),vueApp.statsLoading()}))}function LD(){return vM?vM.getStats():{}}function FD(){vueApp.openPhotoBooth()}function kD(){bM||AI?eI&&(clearTimeout(eI),eI=null):(eI&&clearTimeout(eI),eI=setTimeout((()=>{ZM&&clearInterval(ZM),ZM=setInterval((()=>{hL()}),5e3)}),4e3))}async function BD(){const e=new URL(window.location.href).host;if(!NI&&(e.includes("shellshock")||e.includes("crazygames")))return;const t=await async function(){try{const e=await fetch("/unblocked/json/proxy-list.json");if(!e.ok)throw new Error("Network response was not ok "+e.statusText);return await e.json()}catch(e){console.error("Fetch error:",e)}}();TI.aBParamCheck=!!NI||t.includes(e),TI.aBParamCheck&&("a"!==TI.getCookie("shell_ab_variant")||GD())}function GD(){window.location.href="https://freegames.io/game/shell-shockers?utm_source=ssforward&utm_medium=referral&utm_campaign=proxy"}var UD=class e{static init(){this.getGamepads=(navigator.getGamepads||navigator.webkitGetGamepads).bind(navigator),this.getGamepads?(this.index=null,this.buttonThreshold=.1,this.assist=1,e.detectControllerType(getStoredString("controllerId",ZO("p_settings_nocontroller"))),addEventListener("gamepadconnected",(t=>{this.buttonState=[],this.lastMoveX=0,this.lastMoveZ=0,this.index=t.gamepad.index;var i=navigator.getGamepads()[t.gamepad.index];console.log("Gamepad connected at index: "+i.index+": "+i.id+". It has "+i.buttons.length+" buttons and "+i.axes.length+" axes."),ga("send","event","game","settings","controller connected",i.id),addEventListener("gamepadbuttondown",this.onButtonDown),addEventListener("gamepadbuttonup",this.onButtonUp),e.detectControllerType(i.id),this.poll(),this.assistInterval=setInterval(e.calculateAssist,67)})),addEventListener("gamepaddisconnected",(t=>{t.gamepad.index==this.index&&(cancelAnimationFrame(this.pollLoop),clearInterval(this.assistInterval),this.index=null,removeEventListener("gamepadbuttondown",this.onButtonDown),removeEventListener("gamepadbuttonup",this.onButtonUp),console.log("Gamepad disconnected"),e.detectControllerType(ZO("p_settings_nocontroller")))}))):console.log("Gamepad API not detected")}static calculateAssist(){if(!CO||!CO.nk)return 1;var t=e.wk,i=e.Jk,n=jN.forwardRay.origin,a=jN.forwardRay.direction,s=null,r=null,o=1e7;for(var l of Jb)if(l&&l.id!=RO&&l.nk&&l.Nk&&l.Nk.dk.isVisible&&(0==l.team||l.team!=CO.team)){var c=wh.Distance(l.Nk.dk.position,n);t.copyFrom(l.Nk.dk.position),t.y+=.3,t.subtractToRef(n,i),i.normalize(),a.normalize();var h=(1-wh.Dot(i,a))*c*.5;c<jN.forwardRay.range+1&&h<=.05&&c<o&&(s=l,o=c,r=h)}return s?Math.max(20*r,.2):1}static detectControllerType(e){/xbox|xinput/i.test(e)?vueData.controllerType="xbox":/54c/i.test(e)?vueData.controllerType="ps":/pro controller/i.test(e)?vueData.controllerType="switchpro":vueData.controllerType="generic",vueData.controllerId=e,localStore.setItem("controllerId",e)}static applyDeadZone(e){if(isNaN(e))return 0;var t=IM.deadzone,i=(Math.abs(e)-t)/(1-t);return i<0&&(i=0),i*(e>0?1:-1)}static poll(){var t=e.getGamepads()[e.index];if(t){if(CO&&CO.nk&&document.pointerLockElement||kb){var i=e.calculateAssist(),n=.0025*IM.controllerSpeed+.005;CO.scope&&(n*=.2,i*=2);var a=e.applyDeadZone(t.axes[2]),s=e.applyDeadZone(t.axes[3]);Math.length2(a,s);n*=i,CO.Qk=Math.radAdd(CO.Qk,-a*n),CO.Dk=Math.max(Math.min(CO.Dk-s*IM.controllerInvert*n,1.5),-1.5);var r=e.applyDeadZone(t.axes[0]),o=e.applyDeadZone(t.axes[1]);r<0&&e.lastMoveX>=0?Mw("left"):r>=0&&e.lastMoveX<0&&xw("left"),r>0&&e.lastMoveX<=0?Mw("right"):r<=0&&e.lastMoveX>0&&xw("right"),o<0&&e.lastMoveZ>=0?Mw("up"):o>=0&&e.lastMoveZ<0&&xw("up"),o>0&&e.lastMoveZ<=0?Mw("down"):o<=0&&e.lastMoveZ>0&&xw("down"),e.lastMoveX=r,e.lastMoveZ=o}for(var l in t.buttons)t.buttons[l].value>e.buttonThreshold&&!e.buttonState[l]?(e.buttonState[l]=!0,dispatchEvent(new CustomEvent("gamepadbuttondown",{detail:l}))):t.buttons[l].value<=e.buttonThreshold&&e.buttonState[l]&&(e.buttonState[l]=!1,dispatchEvent(new CustomEvent("gamepadbuttonup",{detail:l})))}e.pollLoop=requestAnimationFrame(e.poll)}static onButtonUp(e){CO&&Iw("gamepad",e.detail)}static onButtonDown(e){CO&&Nw("gamepad",e.detail)}};UD.wk=new wh,UD.Jk=new wh;var HD,VD,WD,zD,XD,YD,jD=0;function KD(){isFromEU&&(jD>8||("undefined"!=typeof googletag?((EM=localStore.getItem("consent"))?(EM=JSON.parse(EM),googletag.consented=EM&&EM.ofAge&&EM.targetedAds||!isFromEU,vueApp.setPrivacySettings(EM.ofAge,EM.targetedAds)):(EM={ofAge:!1,targetedAds:!1},vueApp.showGdprNotification()),console.log("AIP consent: "+googletag.consented)):setTimeout((()=>{jD++,KD()}),1e3)))}HD=window,VD=document,WD="script",zD="ga",HD.GoogleAnalyticsObject=zD,HD[zD]=HD[zD]||function(){(HD[zD].q=HD[zD].q||[]).push(arguments)},HD[zD].l=1*new Date,XD=VD.createElement(WD),YD=VD.getElementsByTagName(WD)[0],XD.async=1,XD.src="https://www.google-analytics.com/analytics.js",YD.parentNode.insertBefore(XD,YD),XD.onload=function(){window.ga&&ga.create&&($D=window.ga,window.ga=qD)};var $D=window.ga,qD=function(){switch($D.apply(window,arguments),arguments[0]){case"create":break;case"set":var e=arguments[2],t={};t[arguments[1]]=e,gtag("set","user_properties",t);break;case"send":var i={hitType:arguments[1]};switch(i.hitType){case"pageview":gtag("pageview",{page_location:location.href});break;case"event":"object"==typeof arguments[2]?i=Object.assign(i,arguments[2]):(i.eventCategory=arguments[2],i.eventAction=arguments[3],i.eventLabel=arguments[4],i.eventValue=arguments[5],"object"==typeof arguments[6]&&(i=Object.assign(i,arguments[6]))),gtag("event",i.eventAction,i);break;case"timing":i.timingCategory=arguments[2],i.timingVar=arguments[3],i.timingValue=arguments[4],i.timingLabel=arguments[5],gtag("event","timing_complete",i)}}};window.ga=qD,ga("set","anonymizeIp",!isFromEU),ga("create","UA-105800112-1",{cookieDomain:"auto",siteSpeedSampleRate:10,cookieFlags:"samesite=none;secure"}),ga("send","pageview"),ga("set","account","web");var JD=(e,t)=>{t=t||"event",e.forEach((e=>{ga("send",t,{eventCategory:e[0],eventAction:e[1],eventLabel:e[2],eventValue:e[3]})}))},QD=(e,t)=>{t=t||"";let i=Date.now()-e;ga("send","timing","game","play time",i),fbq("trackCustom","EndGame",{timePlayed:i}),t&&ga("send","timing","Maps",t,i)},ZD=[new Ah(1,1,0),new Ah(0,.5,1),new Ah(1,0,0)];function eL(e){this.grenade=e,this.scene=e.scene,this.meshes={};for(let e=0;e<xc.catalog.grenades.length;e++){let t=xc.catalog.grenades[e],i=JI(t.item_data.meshName,this.scene);i.material=this.scene.getMaterialByName("emissive"),i.emissiveColor=new Ah(0,0,0),this.meshes[t.id]=i,i.setEnabled(!1)}this.dk=null,this.beep=!1,this.flashColor=null}eL.prototype.dispose=function(){for(let e of Object.values(this.meshes))e.dispose()},eL.prototype.throw=function(){this.dk=this.meshes[this.grenade.Xk.grenadeItem.id],this.dk.setEnabled(!0),this.dk.position.x=this.grenade.x,this.dk.position.y=this.grenade.y,this.dk.position.z=this.grenade.z,this.grenade.Xk.id==RO?this.flashColor=ZD[0]:this.flashColor=ZD[this.grenade.Xk.team],Ib.play("grenade_pin",this.dk.position),this.bounce()},eL.prototype.update=function(e){this.grenade.resting||(this.dk.position.x+=.5*(this.grenade.x-this.dk.position.x),this.dk.position.y+=.5*(this.grenade.y-this.dk.position.y),this.dk.position.z+=.5*(this.grenade.z-this.dk.position.z),this.dk.rotation.x+=this.rx,this.dk.rotation.y+=this.ry,this.dk.rotation.z+=this.rz),Math.sqrt(2*this.grenade.ttl)%2>1?(0==this.beep&&(Ib.play("grenade_beep",this.dk.position),this.beep=!0),this.dk.emissiveColor.set(this.flashColor.r,this.flashColor.g,this.flashColor.b)):(this.dk.emissiveColor.set(0,0,0),this.beep=!1)},eL.prototype.remove=function(){this.dk.setEnabled(!1)},eL.prototype.bounce=function(){var e=Math.length3(this.grenade.dx,this.grenade.dy,this.grenade.Ik);this.rx=(2*Math.random()-1)*e,this.ry=(2*Math.random()-1)*e,this.rz=(2*Math.random()-1)*e},eL.prototype.stop=function(){this.rx=0,this.ry=0,this.rz=0};var tL=class{restPose(){void 0!==Xb&&ZI(this.pM,"fire")}dryFire(){Ib.play(this.dryFireSound,this.VM.Xk.Nk.dk.position,!0)}stow(){Ib.play("weapon_swap",this.VM.Xk.Nk.dk.position,!0),this.scene.beginAnimation(this.playerActor.qM,0,25,!1,1,(()=>{this.pM.setEnabled(!1),this.VM.equip()}))}fire(){if(this.VM.constructor.burst&&this.roundsFired%this.VM.constructor.burst!=0||(this.fireSound&&Ib.play(this.fireSound,this.VM.Xk.Nk.dk.position,!0),ZI(this.pM,"fire")),this.roundsFired++,this.muzzleFlash){this.muzzleFlash.rotation.z=3.141*Math.random(),this.muzzleFlash.setEnabled(!0);var e=this;setTimeout((function(){e.muzzleFlash.setEnabled(!1)}),33)}}constructor(e,t){this.VM=e,this.meshName=t,this.scene=e.scene,this.Rk="gun_"+e.constructor.Rk,this.playerActor=e.Xk.Nk,this.roundsFired=0,this.dryFireSound="gun_eggk47_dry_fire"}addSoundEvent(e,t,i){let n=this.pM.getAnimationByName(e).targetedAnimations[0].animation;var a,s,r=new ty(t,(a=i,s=this.VM.Xk.Nk.dk.position,function(){Ib.play(a,s,!0)}));n.addEvent(r)}getFireSound(e,t){const i=e+"_fire";return BAWK.sounds[i]?i:t}update(){}equip(e){this.VM.Xk.meleeWeapon.Nk.weaponMesh.setEnabled(!1),this.playerActor.setWeaponSkeleton(this.skeleton),this.playerActor.qM.setEnabled(!1),ex(this.pM,"fire"),this.scene.beginAnimation(this.playerActor.qM,30,55,!1,e||1),this.pM.setEnabled(!0),this.roundsFired=0,setTimeout((()=>{this.playerActor.qM.setEnabled(!0)}),1)}inspect(){ZI(this.pM,"inspect")}denyFire(){Db.fireDenied(),Ib.play(this.dryFireSound,this.VM.Xk.Nk.dk.position,!0),Ib.play(this.denyFireSound,this.VM.Xk.Nk.dk.position,!0)}setup(e){this.pM=JI(this.meshName,this.scene,this.playerActor.qM),this.skeleton=this.pM.skeleton,this.pM.material=QI("standard",this.scene),this.pM.setEnabled(!1),e&&(this.muzzleFlash=JI("muzzleFlash",this.scene,this.playerActor.qM),this.muzzleFlash.material=QI("muzzleFlash",this.scene),this.muzzleFlash.setEnabled(!1),this.muzzleFlash.position.x=.25,this.muzzleFlash.position.z=-e,this.muzzleFlash.rotation.y=Math.PI,this.muzzleFlash.scaling.copyFromFloats(.7,.7,.7)),this.VM.Xk.id==RO&&(this.pM.setRenderingGroupId(2),this.muzzleFlash&&this.muzzleFlash.setRenderingGroupId(2))}dispose(){this.pM.dispose()}reload(){this.VM.longReloadTime==this.VM.shortReloadTime?ZI(this.pM,"reload",this.VM.constructor.reloadTimeMod):this.VM.ammo.Yk>0?ZI(this.pM,"shortReload",this.VM.constructor.reloadTimeMod):ZI(this.pM,"longReload",this.VM.constructor.reloadTimeMod)}},iL=class extends tL{constructor(e,t){super(e,t),this.scopeFov=.9,this.scopeY=.0438,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_eggk47_fire"),this.addSoundEvent("shortReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",123,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",123,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",155,"gun_eggk47_full_cycle")}},nL=class extends tL{constructor(e,t){super(e,t),this.scopeFov=1,this.scopeY=.072,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_dozenGauge_fire"),this.addSoundEvent("reload",0,"gun_dozenGauge_open"),this.addSoundEvent("reload",80,"gun_dozenGauge_load"),this.addSoundEvent("reload",115,"gun_dozenGauge_close")}},aL=class extends tL{constructor(e,t){super(e,t),this.scopeFov=.5,this.scopeY=.0345,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_csg1_fire"),this.addSoundEvent("shortReload",25,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",125,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_csg1_pull_action"),this.addSoundEvent("longReload",75,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",160,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",190,"gun_csg1_release_action")}},sL=class extends tL{constructor(e,t){super(e,t),this.scopeFov=1.1,this.scopeY=.069,this.setup(.48),this.fireSound=this.getFireSound(t,"gun_cluck9mm_fire"),this.addSoundEvent("shortReload",15,"gun_cluck9mm_remove_mag"),this.addSoundEvent("shortReload",110,"gun_cluck9mm_insert_mag"),this.addSoundEvent("longReload",15,"gun_cluck9mm_remove_mag"),this.addSoundEvent("longReload",110,"gun_cluck9mm_insert_mag"),this.addSoundEvent("longReload",155,"gun_eggk47_full_cycle")}},rL=class extends tL{constructor(e,t){super(e,t),this.scopeFov=.9,this.scopeY=.1-.0862,this.setup(.51),this.fireSound=this.getFireSound(t,"gun_rpegg_fire"),this.denyFireSound="gun_rpegg_deny_fire",this.addSoundEvent("reload",115,"gun_rpegg_load")}},oL=class extends tL{constructor(e,t){super(e,t),this.scopeFov=1,this.scopeY=.1-.09635,this.setup(.55),this.fireSound=this.getFireSound(t,"gun_smg_fire"),this.addSoundEvent("shortReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",150,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",150,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",185,"gun_smg_cycle")}},lL=class extends tL{constructor(e,t){super(e,t),this.scopeFov=.4,this.scopeY=.1-.03507,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_m24_fire"),this.addSoundEvent("reload",10,"gun_m24_bolt_open"),this.addSoundEvent("reload",75,"gun_eggk47_insert_mag"),this.addSoundEvent("reload",94,"gun_m24_bolt_close")}},cL=class extends tL{constructor(e,t){super(e,t),this.scopeFov=.7,this.scopeY=.0385,this.setup(.6),this.fireSound=this.getFireSound(t,"gun_aug_fire"),this.addSoundEvent("shortReload",28,"gun_aug_remove_mag"),this.addSoundEvent("shortReload",118,"gun_aug_insert_mag"),this.addSoundEvent("longReload",28,"gun_aug_remove_mag"),this.addSoundEvent("longReload",118,"gun_aug_insert_mag"),this.addSoundEvent("longReload",153,"gun_aug_cycle")}};function hL(){for(var e=[],t=0;t<iI.small.length;t++)if(iI.small[t].active){if(crazyGamesActive&&iI.small[t].hideOnCG){console.log("HouseAdSmall not showing on Crazy Games");continue}e.push(t),iI.small[t].weighted&&e.push(t)}e.length>0&&(null!==tI&&e.length>1&&e.splice(e.indexOf(tI),1),tI=e[Math.floor(Math.random()*e.length)],vueApp.useHouseAdSmall(iI.small[tI]))}function fL(e){switch(e.linksTo){case"linksToTaggedItems":break;case"linksToItemId":!function(e){isString(e.linksToItemId)&&(e.linksToItemId=parseInt(e.linksToItemId,10));var t=catalog.findItemById(e.linksToItemId);vueApp.showItemOnEquipScreen(t)}(e);break;case"linksToPass":XO();break;case"linksToPhotoBooth":FD();break;case"linksToVipStore":vueApp.showSubStorePopup();break;case"linkToShop":vueApp.openEquipSwitchTo(parseInt(e.linkToShop,10));break;case"linkToChw":vueApp.showNuggyPopup();break;case"linkToBlackFriday":vueApp.showEggStorePopup();break;case"linkToEggOrg":vueApp.showSelectedTaggedItemsOnEquipScreen("EGGORG");break;case"linkToTwitch":window.open(dynamicContentPrefix+"twitch?utm_medium=referral&utm_campaign=featureslot","_blank");break;case"linksToCreateGame":vueApp.showCreateGamePopup();break;default:e.link.length>1&&crazyGamesActive?window.open(e.link[1],"_window"):window.open(e.link[0],"_window")}ga("send","event","home-display-ad","click",e.label.toLowerCase().replace(/ /g,"-"))}var uL;function dL(e){this.kind=e,this.scene=Xb}function mL(){dL.call(this,_L.AMMO),this.dk=this.scene.getMeshByName("ammo").createInstance(""),this.dk.setEnabled(!1),YN&&YN.getShadowMap().Pt.push(this.dk)}function pL(){dL.call(this,_L.GRENADE),this.dk=this.scene.getMeshByName("grenadeItem").createInstance(""),this.dk.setEnabled(!1),YN&&YN.getShadowMap().Pt.push(this.dk)}function _L(){this.pools=[new Cc((function(){return new _L.Constructors[_L.AMMO]}),100),new Cc((function(){return new _L.Constructors[_L.GRENADE]}),20)]}function vL(){this.scene=qI(xc.engine),this.scene.clearColor=new Ch(0,0,0,0),new pv("",new wh(0,-1,0),this.scene).intensity=1,new vv("",new wh(-.5,-1,.5),this.scene).intensity=1,this.canvas=xc.engine.getRenderingCanvas(),this.meshRenderStaging={},Ox(this.scene),this.camera=new yv("",new wh(1.5,0,0),this.scene),this.camera.target=new wh(0,0,0),this.loadStampSprites(),this.camera.Lt=.5,this.camera.maxZ=100,this.camera.minZ=.01}dL.prototype.update=function(e){this.dk.rotation.y+=.03*e},dL.prototype.remove=function(){this.dk.setEnabled(!1)},mL.prototype=Object.create(dL.prototype),mL.prototype.constructor=dL,pL.prototype=Object.create(dL.prototype),pL.prototype.constructor=dL,_L.AMMO=0,_L.GRENADE=1,_L.Constructors=[mL,pL],_L.prototype.update=function(e){for(var t=0;t<this.pools.length;t++)this.pools[t].forEachActive((function(t){t.update(e),t.dk.isVisible=zw(t.dk)}))},_L.prototype.spawnItem=function(e,t,i,n,a){var s=this.pools[t].retrieve(e);s.dk.setEnabled(!0),s.dk.position.x=i,s.dk.position.y=n,s.dk.position.z=a,UM&&s.dk.freezeWorldMatrix()},_L.prototype.collectItem=function(e,t){var i=this.pools[e];i.recycle(i.objects[t]),i.objects[t].remove()},_L.prototype.recycleAllItems=function(){for(var e=this,t=0;t<this.pools.length;t++)this.pools[t].forEachActive((function(i){e.pools[t].recycle(i),i.remove()}))},vL.prototype.clearCanvas=function(e){e.getContext("2d").clearRect(0,0,256,256)},vL.prototype.renderToCanvas=function(e,t,i){let n=e.item_data.meshName;if(!this.scene.isReady())return void setTimeout((()=>this.renderToCanvas(e,t,i)),0);var a=JI(n,this.scene);let s;switch(a.setEnabled(!0),a.material=QI("standard",this.scene),e.item_type_id!==pc.Primary&&e.item_type_id!==pc.Secondary||ex(a,"fire"),a.layerMask=1,this.camera.layerMask=1,e.item_type_id){case pc.Hat:s={radius:1.4,rotation:new wh(-.25,-2,0),position:new wh(.5*e.align.x,e.align.y,e.align.z)};break;case pc.Grenade:s={radius:.4,rotation:new wh(0,1.3,0),position:new wh(0,-.01,0)};break;case pc.Melee:s={radius:.7,rotation:new wh(.4,-3.8,-.9),position:new wh(0,-.05,.07)};break;case pc.Primary:switch(s={radius:1.3,rotation:new wh(.7,-.02,0)},e.exclusive_for_class){case _c.Soldier:s.position=new wh(0,-.18,.27);break;case _c.Eggsploder:s.position=new wh(0,-.15,.21);break;case _c.Scrambler:s.position=new wh(0,-.18,.27);break;case _c.Ranger:s.position=new wh(0,-.2,.26);break;case _c.Whipper:s.position=new wh(0,-.15,.22);break;case _c.Crackshot:s.position=new wh(0,-.16,.26);break;case _c.TriHard:s.position=new wh(0,-.16,.25);break;default:s.position=new wh(0,-.15,.25)}break;case pc.Secondary:s={radius:1,rotation:new wh(0,0,0),position:new wh(0,.05,.36)}}a.position.copyFrom(s.position),a.rotation.copyFrom(s.rotation),a.computeWorldMatrix(!0),this.camera.position.x=s.radius,this.camera.computeWorldMatrix(),this.scene.render(),a.dispose();var r=t.getContext("2d");r.clearRect(0,0,256,256),r.drawImage(this.canvas,(this.canvas.width-this.canvas.height)/2,0,this.canvas.height,this.canvas.height,0,0,256,256),this.camera.layerMask=0,i&&i()},vL.prototype.renderStampToCanvas=function(e,t,i){var n=e.item_data.x,a=e.item_data.y;this.stampSprites.layerMask=2,this.camera.layerMask=2,this.stampSprite.cellIndex=n+32*a,this.camera.position.x=2.5,this.scene.render();var s=t.getContext("2d");s.clearRect(0,0,256,256),s.drawImage(this.canvas,(this.canvas.width-this.canvas.height)/2,0,this.canvas.height,this.canvas.height,0,0,256,256),this.camera.layerMask=0,this.scene.render(),i&&i()},vL.prototype.loadStampSprites=function(){const e=cI||uI?"img/stamps.webp?v="+SM:"";this.stampSprites=new Gg("",e,1024,128,this.scene),this.stampSprite=new Lg("",this.stampSprites),this.stampSprite.size=1,this.stampSprite.invertU=!0};var gL=class{static joinPrivateGame(e){return new Promise(((t,i)=>{let n={command:"joinGame",id:e.joinCode.toLowerCase(),observe:e.observe,sessionId:xc.playerAccount.sessionId};this.ws.send(JSON.stringify(n)),this.ws.onmessage=e=>{let n=JSON.parse(e.data);if(n.error)i(tc[n.error]);else if("gameFound"===n.command)this.ws.onerror=e=>{},t(n);else this.handleMatchmakerMessage(e)},this.ws.onerror=e=>{i(e),this.handleError(e)}}))}static handleNotices(e){Object.keys(e).forEach((t=>{switch(t){case"announcement":vueData.announcementMessage=e[t];break;case"version":if(e[t]!==SM)if(localStorage.getItem("cacheNuked")){console.log("Wrong client version");let e=setInterval((()=>{vueApp&&(clearInterval(e),vueApp.showGenericPopup("wrong_version","wrong_version_msg","ok"))}),100)}else localStorage.setItem("cacheNuked",!0),rD();else localStorage.removeItem("cacheNuked")}}))}static handleMatchmakerMessage(e){let t=JSON.parse(e.data);if("notice"===t.command)this.handleNotices(t.notices)}static connect(){return new Promise(((e,t)=>{var i=dynamicContentRoot||location.host,n=(isHttps()?"wss":"ws")+"://"+i+"/matchmaker/";this.ws=new wL(n),this.ws.onopen=()=>{e(this.ws)},this.ws.onmessage=e=>this.handleMatchmakerMessage(e),this.ws.onerror=()=>{}}))}static getRegions(){return new Promise(((e,t)=>{this.ws.send('{ "command": "regionList" }'),this.ws.onmessage=t=>{let i=JSON.parse(t.data);if("regionList"===i.command){this.ws.onerror=e=>{},this.regionList=i.regionList;for(let e of this.regionList)e.locKey="server_"+e.id,e.ping=null;vueApp.regionList=this.regionList,e()}else this.handleMatchmakerMessage(t)},this.ws.onerror=e=>{t(e),this.handleError(e)}}))}static handleError(e){this.ws.onerror=e=>{},Tx.hide(),vueApp.hideSpinner(),console.log("Failed to connect to Matchmaker",e),vueApp.showGenericPopup("matchmaker_offline","matchmaker_offline_msg","ok")}static findGame(e){let t=vueApp.currentRegionId;!function(e){for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=0,n=Math.max(0,e.length-5);n<e.length;n++){var a=t.indexOf(e[n]);if(a<0)return NaN;i+=a*Math.pow(62,e.length-n-1)}}(xc.playerAccount.firebaseId);return new Promise(((i,n)=>{let a=xc.playerAccount.statsLifetime.kills.total<12,s={command:"findGame",region:t,playType:e.playType,gameType:e.gameType,sessionId:xc.playerAccount.sessionId,noobLobby:a};e.playType===vueData.playTypes.createPrivate&&(s.map=e.mapIdx),this.ws.send(JSON.stringify(s)),this.ws.onmessage=e=>{let t=JSON.parse(e.data);if(t.error)n(tc[t.error]);else if("gameFound"===t.command)this.ws.onerror=e=>{},i(t);else this.handleMatchmakerMessage(e)},this.ws.onerror=e=>{n(e),this.handleError(e)}}))}},SL=class{constructor(e,t){this.Fk=e,this.meshName=t,this.scene=e.scene,this.Xk=e.Xk,this.playerActor=e.Xk.Nk,this.weaponMesh=JI(this.meshName,this.scene,this.playerActor.qM),this.skeleton=this.weaponMesh.skeleton,this.weaponMesh.material=QI("standard",this.scene),this.weaponMesh.setEnabled(!1),this.swingSounds=this.getSwingSounds(t),this.Fk.Xk.id==RO&&this.weaponMesh.setRenderingGroupId(2)}attack(){ZI(this.weaponMesh,"melee"),setTimeout((()=>{let e=Math.randomInt(0,this.swingSounds.length);Ib.play(this.swingSounds[e],this.playerActor.dk.position,!0)}),68)}getSwingSounds(e){return FI.Melee.includes(e)?Object.keys(BAWK.sounds).filter((t=>t.startsWith(e))):["melee_whisk_a","melee_whisk_b"]}stow(){this.weaponMesh.setEnabled(!1)}dispose(){this.weaponMesh.dispose()}inspect(){ZI(this.weaponMesh,"inspect")}};function yL(){this.posingItems={[pc.Primary]:null,[pc.Secondary]:null,[pc.Grenade]:null,[pc.Melee]:null,[pc.Hat]:null,[pc.Stamp]:null},this.grenadeOnHip=!1,this.camX=0,this.camY=.35,this.camRadius=3.4,this.rotY=0,this.rotX=0,this.jump=0,this.turnCountdown=60,this.buyingItem=null,this.autoUpdate=!0,this.scaleSizes=[1,1.25,1.5],this.dmg=100,this.setupScene(),this.onResourcesLoaded()}yL.prototype.onResourcesLoaded=function(){var e=this;this.startRendering();var t=xc.playerAccount.getPrimaryWeapon().item_data.meshName;function i(i){this.scene=e.scene,this.id=-1,this.name="",this.Ek=0,this.Zk=0,this.ek=0,this.FM=100,this.hatItem=xc.playerAccount.hatItem,this.stampItem=xc.playerAccount.stampItem,this.stampPositionX=xc.playerAccount.stampPositionX,this.stampPositionY=xc.playerAccount.stampPositionY,this.shellColor=xc.playerAccount.colorIdx,this.meleeItem=xc.playerAccount.meleeItem,this.Nk=new RL(this),this.Nk.dk.rotation.y=e.rotY,this.meleeWeapon=new Ax(this),this.Fk=new xc.classes[i].Fk(this,t)}this.dualAvatar=new i(xc.playerAccount.classIdx),this.dualAvatar.Nk.YM.setEnabled(!1),this.dualAvatar.Nk.hands.material.backFaceCulling=!1,this.dualAvatar.Nk.foreBone.setScale(wh.Zero()),this.dualAvatar.Nk.setupStowAnims(0,!0),this.dualAvatar.Fk.Nk.equip(),this.avatar=new i(xc.playerAccount.classIdx),this.avatar.Nk.foreBone.setScale(wh.Zero()),this.avatar.Nk.setupStowAnims(0),this.avatar.Fk.Nk.equip();var n=Date.now();this.scene.registerBeforeRender((function(){var t=Date.now(),i=t-n;n=t,i/=17,e.update(i)})),this.manualOrientation=!1,this.isMouseDown=!1,this.drag=!1,this.equipContainer=document.getElementById("equip_purchase_top"),this.dollContainer=document.getElementById("paper_doll_container"),this.equipContainer.addEventListener("mousemove",(e=>{if(this.manualOrientation=!0,"equip_purchase_top"!==e.target.id)return!1;this.drag=!1,this.pointEggEvent(e)})),this.dollContainer.addEventListener("mousemove",(e=>{this.manualOrientation=!0,this.drag=!1,this.pointEggEvent(e)})),this.equipContainer.addEventListener("pointerleave",(e=>{this.manualOrientation=!1,this.isMouseDown=!1})),this.dollContainer.addEventListener("pointerleave",(e=>{this.manualOrientation=!1,this.isMouseDown=!1})),this.equipContainer.addEventListener("mousedown",(e=>{this.autoUpdate||(this.isMouseDown=!0,this.drag=!0)})),this.dollContainer.addEventListener("mousedown",(e=>{this.autoUpdate||(this.isMouseDown=!0,this.drag=!0)})),this.equipContainer.addEventListener("mouseup",(e=>{this.isMouseDown=!1,clearInterval(this.mouseIntval)})),this.dollContainer.addEventListener("mouseup",(e=>{this.isMouseDown=!1,clearInterval(this.mouseIntval)})),this.dollContainer.addEventListener("click",(e=>{this.autoUpdate||this.eggDamage()})),this.equipContainer.addEventListener("click",(e=>{this.autoUpdate||this.eggDamage()}))},yL.prototype.setStampTexture=function(){this.avatar.Nk.setStampTexture()},yL.prototype.pointEggEvent=function(e){(this.autoUpdate&&!this.isMouseDown||!this.autoUpdate&&this.isMouseDown)&&this.pointEgg(e)},yL.prototype.pointEgg=function(e){var t=e.target.getBoundingClientRect();this.rotY=(e.x-t.left)/t.width*4-2,this.rotX=1.5*-((e.y-t.top)/t.height-.5)},yL.prototype.startRendering=function(){xc.engine.qt((()=>this.scene.render()))},yL.prototype.avatars=function(e){e(this.avatar),e(this.dualAvatar)},yL.prototype.update=function(e){if(this.camera.target.x+=(this.camX-this.camera.target.x)/5,this.camera.target.y+=(this.camY-this.camera.target.y)/5,this.camera.radius+=(this.camRadius-this.camera.radius)/5,this.jump-=.002*e,this.avatars((t=>{t.Nk.head.rotation.x+=(this.rotX-t.Nk.head.rotation.x)/5,t.Nk.dk.rotation.y+=(this.rotY-t.Nk.dk.rotation.y)/5,t.Nk.dk.rotation.x=.5*t.Nk.head.rotation.x,t.Nk.dk.position.x=.1*t.Nk.dk.rotation.y,t.Nk.dk.position.y=Math.max(0,t.Nk.dk.position.y+this.jump*e)})),!this.manualOrientation&&this.autoUpdate&&(this.turnCountdown-=e,this.turnCountdown<=0)){var t=.6*Math.random()-.4,i=2*Math.random()-1+.5*this.camX,n=Math.length2(t-this.rotX,i-this.rotY);this.rotX=t,this.rotY=i,this.jump=Math.min(.01,n/100),this.turnCountdown=90*Math.random()+30}this.fakeShadow.position.x=this.avatar.Nk.dk.position.x,this.fakeShadow.position.z=this.avatar.Nk.dk.position.z},yL.prototype.setupScene=function(){this.scene=qI(xc.engine);var e=new pv("",new wh(0,-1,0),this.scene);e.intensity=.8,e.diffuse=new Ah(.67,.87,1),new vv("",new wh(-.2,-1,.4),this.scene).intensity=1.2,Ox(this.scene),this.scene.autoClear=!0,this.scene.clearColor=new Ch(0,0,0,0),this.scene.fogMode=dv.FOGMODE_EXP2,this.scene.fogDensity=.06;var t=new Ah(.35,.65,.8);this.scene.fogColor=t,this.scene.sunLight={direction:new wh(.2,1,.1),diffuse:Ah.White()},this.camera=new Wv("",.5*-Math.PI,1.5,this.camRadius,new wh(this.camX,this.camY,0),this.scene),this.scene.activeCameras.push(this.camera),this.camera.maxZ=10,this.camera.Lt=.5,this.camera.minZ=.1;var i=new Og("shadowMat",this.scene);i.emissiveColor=new Ah(.07,.57,.74),i.diffuseColor=Ah.Black(),i.alpha=.5,this.fakeShadow=ey.gt("fakeShadow",{radius:.25},this.scene),this.fakeShadow.material=i,this.fakeShadow.rotation.x=Math.PI/2,this.fakeShadow.position.y=0,this.scene.render()},yL.prototype.poseWithItems=function(e,t,i){this.poseWithHat(e[pc.Hat]),this.poseWithStamp(e[pc.Stamp],t,i),this.poseWithPrimaryWeapon(e[pc.Primary]),this.poseWithSecondaryWeapon(e[pc.Secondary]),this.poseWithGrenade(e[pc.Grenade]),this.poseWithMelee(e[pc.Melee])},yL.prototype.poseWithPrimaryWeapon=function(e){if(void 0!==e&&(null===e||this.posingItems[pc.Primary]!==e)){if(this.avatar.Fk.Nk.dispose(),null!==e){let t=e.instantiateNew(this.avatar);this.avatar.Fk=t,ex(t.Nk.pM,"fire",(()=>{let e=this.avatar.Nk;e.setWeaponSkeleton(t.Nk.skeleton),e.gripBone.position=e.weaponGripBone.position,e.gripBone.setRotationQuaternion(e.weaponGripBone.rotationQuaternion),this.dualAvatar.Nk.foreBone.setScale(wh.Zero())})),t.Nk.pM.setEnabled(!0)}this.posingItems[pc.Primary]=e,null!==this.posingItems[pc.Melee]&&this.poseWithMelee(this.posingItems[pc.Melee],!0)}},yL.prototype.poseWithSecondaryWeapon=function(e){if(void 0!==e&&(null===e||this.posingItems[pc.Secondary]!==e)){if(this.dualAvatar.Fk.Nk.dispose(),null!==e){let t=e.instantiateNew(this.dualAvatar);this.dualAvatar.Fk=t,ex(t.Nk.pM,"fire");let i=this.dualAvatar.Nk;if(i.setWeaponSkeleton(t.Nk.skeleton),i.gripBone.position=i.weaponGripBone.position,i.gripBone.setRotationQuaternion(i.weaponGripBone.rotationQuaternion),i.gripBone.setScale(new wh(1,1,1)),t.Nk.pM.setEnabled(!0),this.avatar.Nk.foreBone.setScale(wh.Zero()),null!==this.posingItems[pc.Grenade]&&!this.grenadeOnHip){let e=this.dualAvatar.grenade.Nk.dk;e.parent=this.dualAvatar.Nk.dk,e.position.set(.29,.17,-.08),e.rotation.y=Math.PI+.3,e.rotation.z=-.3,this.grenadeOnHip=!0}}this.posingItems[pc.Secondary]=e,null!==this.posingItems[pc.Grenade]&&this.poseWithGrenade(this.posingItems[pc.Grenade],!0)}},yL.prototype.poseWithGrenade=function(e,t){if(void 0!==e&&(t||null===e||this.posingItems[pc.Grenade]!==e)){if(this.dualAvatar.grenade&&this.dualAvatar.grenade.Nk.dispose(),null!==e){this.dualAvatar.grenade=e.instantiateNew(this.dualAvatar);let t=this.dualAvatar.grenade.Nk.dk;if(t.setEnabled(!0),null!==this.posingItems[pc.Secondary])t.parent=this.dualAvatar.Nk.dk,t.position.set(.29,.17,.08),t.rotation.y=Math.PI-.3,t.rotation.z=-.3,this.grenadeOnHip=!0;else{t.position.set(-.25,0,-.3),t.rotation.y=Math.PI;let e=this.avatar.Nk;this.dualAvatar.Nk.gripBone.setScale(wh.Zero()),e.foreBone.setScale(new wh(1,1,1)),e.foreBone.position=new wh(-.25,-.11,-.28),e.foreBone.setRotation(new wh(-1.7,.14,0)),this.grenadeOnHip=!1,t.parent=e.head}}this.posingItems[pc.Grenade]=e}},yL.prototype.poseWithMelee=function(e,t){if(void 0!==e&&(t||null===e||this.posingItems[pc.Melee]!==e)){if(this.avatar.meleeWeapon&&this.avatar.meleeWeapon.Nk.dispose(),null!==e){let t=e.instantiateNew(this.avatar);this.avatar.meleeWeapon=t;let i=t.Nk.weaponMesh;i.setEnabled(!0),null!==this.posingItems[pc.Primary]?(i.parent=this.avatar.Nk.dk,i.position.set(-.53,-.02,-.07),i.rotation.x=2.1,i.rotation.y=.3,ex(i,"melee")):(i.parent=this.avatar.Nk.qM,ex(i,"melee",(()=>{this.avatar.Nk.gripBone.setScale(new wh(1,1,1)),this.avatar.Nk.gripBone.position=this.avatar.Nk.weaponGripBone.position,this.avatar.Nk.gripBone.setRotationQuaternion(this.avatar.Nk.weaponGripBone.rotationQuaternion),this.dualAvatar.Nk.foreBone.setScale(wh.Zero())})),this.avatar.Nk.wieldMelee())}this.posingItems[pc.Melee]=e}},yL.prototype.poseWithHat=function(e){void 0!==e&&(null!==e&&this.posingItems[pc.Hat]===e||(this.avatar.Nk.removeHat(),null!==e&&this.avatar.Nk.wearHat(e),this.posingItems[pc.Hat]=e))},yL.prototype.poseWithStamp=function(e,t,i){if(this.avatar.Nk.setStampPosition(t,i),void 0!==e){if(this.posingItems[pc.Stamp]===e)return;null===e?this.avatar.Nk.removeStamp():this.avatar.Nk.applyStamp(e),this.posingItems[pc.Stamp]=e}},yL.prototype.poseWithColor=function(e){e>=7&&!xc.playerAccount.isSubscriber&&(e=0,vueApp.equip.colorIdx=0),this.avatar.Nk.setShellColor(e),this.dualAvatar.Nk.setShellColor(e),vueApp.setShellColor(e)},yL.prototype.photoBoothHideItem=function(e){switch(e.value){case pc.Hat:hasValue(this.posingItems[e.value])?this.poseWithHat(null):this.poseWithHat(xc.playerAccount.hatItem);break;case pc.Stamp:this.posingItems[e.value]?this.poseWithStamp(null,0,0):this.poseWithStamp(xc.playerAccount.stampItem,xc.playerAccount.stampPositionX,xc.playerAccount.stampPositionY);break;case pc.Grenade:this.posingItems[e.value]?this.poseWithGrenade(null):this.poseWithGrenade(xc.playerAccount.grenadeItem);break;case pc.Melee:this.posingItems[e.value]?this.poseWithMelee(null):this.poseWithMelee(xc.playerAccount.meleeItem);break;case pc.Primary:this.posingItems[e.value]?this.poseWithPrimaryWeapon(null):this.poseWithPrimaryWeapon(xc.playerAccount.getPrimaryWeapon());break;case pc.Secondary:this.posingItems[e.value]?this.poseWithSecondaryWeapon(null):this.poseWithSecondaryWeapon(xc.playerAccount.getSecondaryWeapon())}null===this.posingItems[pc.Grenade]&&null===this.posingItems[pc.Secondary]&&(this.dualAvatar.Nk.gripBone.setScale(wh.Zero()),this.avatar.Nk.foreBone.setScale(new wh(1,1,1)),this.avatar.Nk.foreBone.position=new wh(-.34,-.12,-.1),this.avatar.Nk.foreBone.setRotation(new wh(.3,1.5,-1.7))),null===this.posingItems[pc.Primary]&&null===this.posingItems[pc.Melee]?(this.avatar.Nk.gripBone.setScale(wh.Zero()),this.dualAvatar.Nk.foreBone.setScale(new wh(1,1,1)),this.dualAvatar.Nk.foreBone.position=new wh(-.34,-.12,-.1),this.dualAvatar.Nk.foreBone.setRotation(new wh(.3,1.5,-1.7))):(this.avatar.Nk.gripBone.setScale(new wh(1,1,1)),this.dualAvatar.Nk.foreBone.setScale(wh.Zero()))},yL.prototype.scale=function(e){void 0===e&&(e=0),this.avatar.Nk.dk.scaling=new wh(this.scaleSizes[e],this.scaleSizes[e],this.scaleSizes[e]),this.dualAvatar.Nk.dk.scaling=new wh(this.scaleSizes[e],this.scaleSizes[e],this.scaleSizes[e]),this.fakeShadow.scaling=new wh(this.scaleSizes[e],this.scaleSizes[e],this.scaleSizes[e])},yL.prototype.eggDamage=function(e){e?this.avatar.FM=100:pM.open&&this.drag&&(this.avatar.FM=this.dmg>0?this.dmg-=25:this.dmg+=100)},yL.prototype.photoBoothOpen=function(){this.poseWithItems(xc.playerAccount.getEquippedItems(),xc.playerAccount.stampPositionX,xc.playerAccount.stampPositionY),this.autoUpdate=!1,this.fakeShadow.material.emissiveColor=new Ah(0,0,0)},yL.prototype.photoBoothClose=function(){this.autoUpdate=!0,this.fakeShadow.material.emissiveColor=new Ah(.07,.57,.74),this.eggDamage(!0),cO()};var EL,AL=class{getScreenshot(e){this.zoooMsg(),!this.isOpen&&bM||(e?this.getScreenshotWithCrop():html2canvas(document.body,{allowTaint:!1,logging:!1,backgroundColor:null}).then((e=>vueApp.screenGrabDone(e.toDataURL()))))}eggDollSize(e){bM&&!this.isOpen&&(e=0),PM.scale(e)}zoooMsg(){this.zoomMsgRead||(localStore.setItem("photoBoothZooming",!0),this.zoomMsgRead=localStore.getItem("photoBoothZooming"),vueApp.showGenericPopup("screen_photo_booth_zoom_title","screen_photo_booth_zoom_msg","ok"))}close(){this.isOpen=!1,this.eggDollSize(0),vueApp.$refs.photoBooth.close(),PM.photoBoothClose()}hideItem(e){bM&&!this.isOpen&&(e=null),PM.photoBoothHideItem(e)}constructor(){this.isOpen=!1,this.zoomMsgRead=!1}getScreenshotWithCrop(){if(this.zoooMsg(),!this.isOpen&&bM)return;const e=document.createElement("canvas").getContext("2d"),t={allowTaint:!1,logging:!1,backgroundColor:null},i=window.innerWidth,n=i/2,a=window.innerHeight;return t.height=a,t.width=i,t.x=Math.round(t.x),html2canvas(document.body,t).then((s=>{e.canvas.width=n,e.canvas.height=a,e.drawImage(s,-Math.max(0,(i-n)/2||0),-(+t.y||0)),vueApp.screenGrabDone(e.canvas.toDataURL())}))}open(){bM?this.close():(this.isOpen=!0,this.zoomMsgRead=localStorage.getItem("photoBoothZooming"),vueApp.$refs.photoBooth.open(),PM.photoBoothOpen())}};function CL(e){console.log("Pinging regions");var t=1e6;document.location.protocol;for(let e of gL.regionList)!function(i){let n=(isHttps()?"wss":"ws")+"://"+mD(i.sub)+"/game/";var a,s=new WebSocket(n);s.onopen=e=>{console.log("Pinging "+i.id),s.send(JSON.stringify({command:"ping"})),a=Date.now()},s.onmessage=i=>{clearTimeout(r),e.ping=Date.now()-a,vueApp.regionList=gL.regionList.filter((e=>null!==e.ping)).sort(((e,t)=>e.ping<t.ping?-1:e.ping>t.ping?1:0)),NM=!0,e.ping<t&&(t=e.ping,vueApp.currentRegionId=e.id)},s.onerror=t=>{clearTimeout(r),e.ping=null};var r=setTimeout((()=>{e.ping=null,s.close()}),4e3)}(e)}function RL(e){this.Xk=e,this.scene=this.Xk.scene,this.dk=new Xh(""),this.hat=null,this.spriteSize=1,this.spriteShrinkSize=.5,this.YM=JI("egg",this.scene,this.dk),this.YM._scene=this.scene,this.YM.position.y=.32,this.YM.Xk=this.Xk,this.YM.stampOffset=new Ph,this.lerpToPosition=new wh,this.positionLerp=0,this.lerpFromPosition=new wh,this.lerpTargetPosition=new wh,this.YM.material=QI("shell",this.scene),this.setStampTexture(),this.YM.setEnabled(!0),this.YM.hp=1,this.head=new Xh,this.head.parent=this.dk,this.head.position.y=.3,this.head.position.z=0,this.qM=new Xh,this.qM.parent=this.head,this.qM.rotation.y=.14,this.qM.rotation.x=.035,this.setupStowAnims(),this.eye=new Xh,this.eye.position.y=.1,this.eye.position.x=0,this.eye.rotation.y=0,this.eye.parent=this.head,this.hands=JI("hands",this.scene,this.qM),this.hands.material=QI("shell",this.scene),this.hands.teamColor=GI.outline[0],this.hands.stampOffset=new Ph,this.hands.hp=1,this.hands.setEnabled(!0),this.hands.getAnimationByName("grenade_grab").onAnimationEndObservable.add((()=>{this.hands.skeleton&&this.hands.skeleton.disableBlending()})),this.hands.getAnimationByName("grenade_throw").onAnimationEndObservable.add((()=>{this.hands.skeleton&&(this.throwingGrenade=!1,this.gripBone._frozen=!1)})),this.gripBone=this.hands.skeleton.bones[this.hands.skeleton.getBoneIndexByName("gripHand")],this.foreBone=this.hands.skeleton.bones[this.hands.skeleton.getBoneIndexByName("foreHand")],this.Xk.shield>0&&(this.YM.overlayColor=xx.OverlayColor.green,this.hands.overlayColor=xx.OverlayColor.green,this.YM.renderOverlay=!0,this.hands.renderOverlay=!0),this.setShellColor(this.Xk.shellColor),EL=0,this.dk.position.x=this.Xk.Ek,this.dk.position.y=this.Xk.Zk,this.dk.position.z=this.Xk.ek,this.Xk.id!=RO&&(this.wearHat(this.Xk.hatItem),this.applyStamp(this.Xk.stampItem),this.setStampPosition(this.Xk.stampPositionX,this.Xk.stampPositionY)),OM&&this.hands.setEnabled(!1),this.bobbleIntensity=0,this.zoomed=!1,this.hitSoundDelay=0,this.auraSprite=null,this.auraSpriteFrame=0;for(let e=0;e<Object.keys(uc).length;e++){let t=1<<e;this.Xk.activeShellStreaks&t&&this.beginShellStreak(t)}this.YM.teamColor=GI.outline[0],bM&&(YN&&YN.getShadowMap().Pt.push(this.YM),this.Xk.id==RO?this.hands.setRenderingGroupId(2):(this.setupNameSprite(),this.showSprites()),bM&&this.updateTeam())}RL.prototype.setStampTexture=function(){this.YM.material.getBlockByName("ImageSource").texture=qN},RL.prototype.wearHat=function(e){this.removeHat(),null!==e&&(this.hat=JI(e.item_data.meshName,this.scene,this.YM),this.hat.setEnabled(!0),this.hat.position.y=-.02)},RL.prototype.removeHat=function(){void 0!==this.hat&&null!==this.hat&&this.hat.dispose()},RL.prototype.applyStamp=function(e){this.removeStamp(),null!==e&&this.YM.stampOffset.set(e.item_data.x/32,1-e.item_data.y/32)},RL.prototype.removeStamp=function(){this.YM.stampOffset.set(0,1)},RL.prototype.setStampPosition=function(e,t){this.YM.stampPositionX=e,this.YM.stampPositionY=t},RL.prototype.drawTextOnNameTexture=function(e,t,i,n,a,s){var r=[{x:0,y:-4},{x:-4,y:0},{x:4,y:0},{x:0,y:4}],o=[{x:0,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1}];t+=this.Xk.id%4*512,i=-i+(2048-256*Math.floor(this.Xk.id/4)),s&&(t+=256-function(e,t){var i=nI.getContext("2d");return i.font="bold "+t+"px Nunito, sans-serif",i.measureText(e).width}(e,n)/2);for(var l=0;l<4;l++)Qb.drawText(e,t+r[l].x,i+r[l].y,"bold "+n+"px Nunito, sans-serif","rgba(0, 0, 0, 0.5)","transparent");for(l=0;l<4;l++)Qb.drawText(e,t+o[l].x,i+o[l].y,"bold "+n+"px Nunito, sans-serif",a,"transparent")},RL.prototype.setupNameSprite=function(){var e=this.Xk.id%4*512,t=2048-256*Math.floor(this.Xk.id/4);Qb.clearRect(e,t-256,512,256),this.drawTextOnNameTexture(this.Xk.name,0,32,60,"white",!0)},RL.prototype.updateTeam=function(){this.Xk.team==dM||kb?this.YM.teamColor=GI.outline[this.Xk.team]:this.YM.teamColor=GI.outline[0],this.nameSprite&&(this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.color=GI.textColor[this.Xk.team])},RL.prototype.update=function(e){var t=Math.cos(this.Xk.bobble)*this.bobbleIntensity,i=Math.abs(Math.sin(this.Xk.bobble)*this.bobbleIntensity),n=Math.sin(2*this.Xk.bobble)*this.bobbleIntensity;if(this.Xk.shield>0){var a=.7*Math.random()+.2;this.YM.overlayAlpha=a,this.hands.overlayAlpha=a}if(this.Xk.activeShellStreaks&uc.EggBreaker){a=.5*Math.cos(zb/100)+.5;this.YM.overlayAlpha=a,this.hands.overlayAlpha=a}var s,r=.333*(e=Math.min(e,1));if(uM==this.Xk.id?this.Xk.Fk.Nk.pM.alwaysSelectAsActiveMesh=!0:this.Xk.Fk.Nk.pM.alwaysSelectAsActiveMesh=!1,this.Xk.id==RO)if(this.Xk.scope&&this.Xk.isAtReady(!0))jN.Lt=jN.Lt+(this.Xk.Fk.Nk.scopeFov-jN.Lt)*r,this.qM.rotation.y*=r,this.qM.rotation.x*=r,this.qM.position.x+=(-.24999999-this.qM.position.x)*r,this.qM.position.y+=(this.Xk.Fk.Nk.scopeY-this.qM.position.y)*r,this.qM.position.z+=(.05-this.qM.position.z)*r,this.Xk.Fk.hasScope&&!this.zoomed&&jN.Lt<this.Xk.Fk.Nk.scopeFov+.05&&(Ob.show(),this.qM.setEnabled(!1),this.zoomed=!0);else{jN.Lt=jN.Lt+(1.25-jN.Lt)*r;var o=1-r;this.qM.rotation.y+=(.14+2*t-this.qM.rotation.y)*r,this.qM.rotation.x+=(.035+.75*n-this.qM.rotation.x)*r,this.qM.position.x*=o,this.qM.position.y*=o,this.qM.position.z*=o,this.zoomed&&jN.Lt>this.Xk.Fk.Nk.scopeFov+.05&&(Ob.hide(),this.qM.setEnabled(!0),this.zoomed=!1)}else if(this.qM.rotation.y+=(.14+2*t-this.qM.rotation.y)*r,this.qM.rotation.x+=(.035+.75*n-this.qM.rotation.x)*r,this.Xk.team>0&&(this.Xk.team==dM||kb)&&this.nameSprite){var l=Math.length3(this.Xk.Ek-CO.Ek,this.Xk.Zk-CO.Zk,this.Xk.ek-CO.ek),c=Math.pow(l,1.25);this.nameSprite.width=c/10+.6,this.nameSprite.height=c/20+.3}if(this.lerpToPosition.copyFromFloats(this.Xk.Ek,this.Xk.Zk,this.Xk.ek),wh.LerpToRef(this.lerpFromPosition,this.lerpToPosition,Math.min(this.positionLerp,1),this.lerpTargetPosition),this.positionLerp+=e/2,this.dk.position.x+=.5*(this.lerpTargetPosition.x-this.dk.position.x),this.dk.position.y+=.5*(this.lerpTargetPosition.y-this.dk.position.y),this.dk.position.z+=.5*(this.lerpTargetPosition.z-this.dk.position.z),this.Xk.id!==RO){var h=Math.radDifference(this.Xk.Qk,this.dk.rotation.y),f=Math.radDifference(this.Xk.Dk,this.head.rotation.x);this.dk.rotation.y+=h/2*e,this.head.rotation.x+=f/2*e}else this.dk.rotation.y=this.Xk.Qk,this.head.rotation.x=this.Xk.Dk;if(this.YM.rotation.x=this.head.rotation.x/4,s=this.Xk.onGround||this.Xk.zM?Math.length3(this.Xk.dx,this.Xk.dy,this.Xk.Ik):0,this.bobbleIntensity+=(s-this.bobbleIntensity)/10,this.YM.rotation.z=5*t,this.YM.position.y=1.5*i+.32,EL>0)if((EL*=.9)<.001)EL=0;else{var u=Math.random()*EL-.5*EL,d=Math.random()*EL-.5*EL,m=Math.random()*EL-.5*EL;this.eye.rotation.x+=(u-this.eye.rotation.x)/10,this.eye.rotation.y+=(d-this.eye.rotation.y)/10,this.eye.rotation.z+=(m-this.eye.rotation.z)/10}else this.eye.rotation.x*=.9,this.eye.rotation.y*=.9,this.eye.rotation.z*=.9;if(this.Xk.id!=uM){var p=zw(this.dk,.31);this.dk.Ak(p),p?this.showSprites():this.hideSprites(),(this.nameSprite||this.auraSprite)&&this.positionSprites()}this.hitSoundDelay=Math.max(this.hitSoundDelay-e,0),this.Xk.Fk.Nk&&this.Xk.Fk.Nk.update(e),this.YM.hp=100===this.Xk.FM?1:.008*this.Xk.FM},RL.prototype.gM=function(){this.positionLerp=0,this.lerpFromPosition.copyFromFloats(this.Xk.Ek,this.Xk.Zk,this.Xk.ek)},RL.prototype.resetLerp=function(){this.dk.position.x=this.Xk.Ek,this.dk.position.y=this.Xk.Zk,this.dk.position.z=this.Xk.ek,this.positionLerp=0,this.lerpToPosition.copyFromFloats(this.Xk.Ek,this.Xk.Zk,this.Xk.ek),this.lerpFromPosition.copyFromFloats(this.Xk.Ek,this.Xk.Zk,this.Xk.ek),this.lerpTargetPosition.copyFromFloats(this.Xk.Ek,this.Xk.Zk,this.Xk.ek)},RL.v3_1=new wh,RL.v3_2=new wh,RL.prototype.positionSprites=function(){var e,t;this.nameSprite&&((e=RL.v3_1).copyFrom(this.dk.position),e.y+=.5*this.nameSprite.height+.65,(t=this.nameSprite.position).copyFrom(jN.globalPosition),t.subtractInPlace(e),t.normalize(),t.scaleInPlace(.4),t.addInPlace(e));this.auraSprite&&((e=RL.v3_1).copyFrom(this.dk.position),e.y+=.35*this.Xk.playerScale,(t=this.auraSprite.position).copyFrom(jN.globalPosition),t.subtractInPlace(e),t.normalize(),t.scaleInPlace(.4),t.addInPlace(e),this.auraSprite.width=.7*this.Xk.playerScale,this.auraSprite.height=.7*this.Xk.playerScale)},RL.prototype.showSprites=function(){this.Xk.nk&&(this.nameSprite||(this.nameSprite=new Lg("",Zb),this.nameSprite.invertV=!0,this.nameSprite.invertU=!0,this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.cellIndex=this.Xk.id,this.nameSprite.color=GI.textColor[this.Xk.team],this.Xk.team==dM||kb?this.YM.teamColor=GI.outline[this.Xk.team]:this.YM.teamColor=GI.outline[0]),!this.auraSprite&&this.Xk.activeShellStreaks&uc.HardBoiled&&(this.auraSprite=new Lg("",eP),this.auraSprite.invertV=!0,this.auraSprite.width=.7,this.auraSprite.height=.7,this.auraSprite.playAnimation(this.auraSpriteFrame,this.auraSpriteFrame+7,!0,67)))},RL.prototype.hideSprites=function(){this.nameSprite&&(this.nameSprite.dispose(),this.nameSprite=null),this.auraSprite&&(this.auraSprite.dispose(),this.auraSprite=null)},RL.prototype.hit=function(){this.hitSoundDelay<=0&&(this.Xk.activeShellStreaks&uc.HardBoiled?Ib.play("shield_hit",this.YM.absolutePosition,!0):Ib.play("hit",this.YM.absolutePosition,!0),this.hitSoundDelay=10)},RL.prototype.beginShellStreak=function(e){const t={[uc.HardBoiled]:()=>{this.auraSpriteFrame=8,this.Xk.id==RO&&(nw(e),uw())},[uc.EggBreaker]:()=>{this.Xk.id==RO&&(nw(e),Db.setPowerful(!0)),this.YM.overlayColor=xx.OverlayColor.red,this.hands.overlayColor=xx.OverlayColor.red,this.YM.renderOverlay=!0,this.hands.renderOverlay=!0},[uc.OverHeal]:()=>{nw(e)},[uc.Restock]:()=>{this.Xk.id==RO&&nw(e)},[uc.MiniEgg]:()=>{this.shellStreakShrinkPlayer(this.dk,new wh(1,1,1),new wh(.5,.5,.5),60),this.Xk.id==RO&&nw(e)},[uc.DoubleEggs]:()=>{this.Xk.id==RO&&nw(e)}};t[e]&&t[e](),this.Xk.id==RO&&sw(e,!0),this.showSprites()},RL.prototype.endShellStreak=function(e){const t={[uc.HardBoiled]:()=>{this.Xk.id==RO&&uw(),this.auraSprite&&(this.auraSprite.dispose(),this.auraSprite=null)},[uc.EggBreaker]:()=>{this.Xk.id==RO&&Db.setPowerful(!1),this.YM.renderOverlay=!1,this.hands.renderOverlay=!1},[uc.MiniEgg]:()=>{this.shellStreakShrinkPlayer(this.dk,new wh(.5,.5,.5),new wh(1,1,1),60)}};t[e]?t[e]():console.warn(`Unknown ksType: ${e}`),this.Xk.id==RO&&sw(e,!1)},RL.prototype.removeFromPlay=function(){this.zoomed=!1,this.throwingGrenade=!1,this.gripBone._frozen=!1,this.wieldingMelee=!1,this.dk.setEnabled(!1),this.hideSprites()},RL.prototype.restoreToPlay=function(){this.dk.setEnabled(!0),this.qM.setEnabled(!0),this.Xk.id!=RO&&this.showSprites()},RL.prototype.remove=function(){this.dk.dispose(),this.hideSprites()},RL.prototype.fire=function(){this.zoomed&&this.Xk.Fk.hasScope?(EL=.15,this.eye.rotation.x=.05):IM.shakeEnabled&&(EL=.08*jN.Lt),this.wieldingMelee&&this.wieldGun()},RL.prototype.inspect=function(){this.Xk.Fk&&!this.Xk.scope&&this.Xk.canSwapOrReload()&&this.Xk.Fk.Nk.inspect()},RL.prototype.melee=function(){this.Xk.id===RO&&(EL=.05),this.wieldingMelee||this.wieldMelee(),this.Xk.meleeWeapon.Nk.attack()},RL.prototype.wieldMelee=function(){this.wieldingMelee=!0,this.Xk.Fk.Nk.restPose(),this.setWeaponSkeleton(this.Xk.meleeWeapon.Nk.skeleton),this.Xk.meleeWeapon.Nk.weaponMesh.setEnabled(!0),this.Xk.Fk.Nk.pM.setEnabled(!1)},RL.prototype.inspectMelee=function(){this.wieldingMelee=!0,this.Xk.Fk.Nk.restPose(),this.setWeaponSkeleton(this.Xk.meleeWeapon.Nk.skeleton),this.Xk.meleeWeapon.Nk.weaponMesh.setEnabled(!0),this.Xk.Fk.Nk.pM.setEnabled(!1),this.Xk.meleeWeapon.Nk.inspect()},RL.prototype.wieldGun=function(){this.wieldingMelee=!1,this.setWeaponSkeleton(this.Xk.Fk.Nk.skeleton),this.Xk.meleeWeapon.Nk.weaponMesh.setEnabled(!1),this.Xk.Fk.Nk.pM.setEnabled(!0)},RL.prototype.reachForGrenade=function(){var e;this.throwingGrenade=!0,(e=this.Xk.Fk.Nk.pM).currentAnimation&&e.currentAnimation.stop(),ex(this.Xk.Fk.Nk.pM,"fire"),ZI(this.hands,"grenade_grab")},RL.prototype.throwGrenade=function(){this.Xk.id==RO&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),ZI(this.hands,"grenade_throw")},RL.prototype.setShellColor=function(e){(e<0||e>=shellColors.length)&&(console.log("Shell color out of bounds: "+e),e=0);var t=Ah.FromHexString(shellColors[e]);this.YM.shellColor=t,this.hands.shellColor=t},RL.prototype.setWeaponSkeleton=function(e){this.skeleton=e,this.weaponGripBone=this.skeleton.bones[this.skeleton.getBoneIndexByName("gripHand")],this.weaponForeBone=this.skeleton.bones[this.skeleton.getBoneIndexByName("foreHand")]},RL.prototype.handsToWeaponSkeleton=function(){this.gripBone.position=this.weaponGripBone.position,this.gripBone.setRotationQuaternion(this.weaponGripBone.rotationQuaternion),1!=this.throwingGrenade&&(this.foreBone.position=this.weaponForeBone.position,this.foreBone.setRotationQuaternion(this.weaponForeBone.rotationQuaternion))},RL.prototype.setupStowAnims=function(e,t){e=void 0===e?.14:e,t=t?-1:1;var i=new Ov("","rotation",60,Ov.ANIMATIONTYPE_VECTOR3,Ov.ANIMATIONLOOPMODE_CONSTANT),n=new Ov("","scaling",60,Ov.ANIMATIONTYPE_VECTOR3,Ov.ANIMATIONLOOPMODE_CONSTANT),a=new Ov("","position",60,Ov.ANIMATIONTYPE_VECTOR3,Ov.ANIMATIONLOOPMODE_CONSTANT),s=new Cv;s.setEasingMode(Av.EASINGMODE_EASEINOUT),i.setEasingFunction(s);var r=new Cv;r.setEasingMode(Av.EASINGMODE_EASEINOUT),n.setEasingFunction(r);var o=new Cv;o.setEasingMode(Av.EASINGMODE_EASEINOUT),a.setEasingFunction(o);var l=[{frame:0,value:new wh(.035,e*t,0)},{frame:25,value:new wh(-1,1.5*t,0)},{frame:30,value:new wh(1,1.5*t,0)},{frame:55,value:new wh(.035,e*t,0)}],c=[{frame:0,value:new wh(1,1,1)},{frame:25,value:new wh(.25*t,.25,.25)},{frame:30,value:new wh(.25*t,.25,.25)},{frame:55,value:new wh(1*t,1,1)}],h=[{frame:0,value:new wh(0,0,0)},{frame:25,value:new wh(.1*t,.1,.2)},{frame:30,value:new wh(.1*t,0,.2)},{frame:55,value:new wh(0,0,0)}];i.setKeys(l),n.setKeys(c),a.setKeys(h),this.qM.animations.push(i),this.qM.animations.push(n),this.qM.animations.push(a)},RL.prototype.shellStreakShrinkPlayer=function(e,t,i,n){const a=new Ov("scalingAnimation","scaling",30,Ov.ANIMATIONTYPE_VECTOR3,Ov.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:t}),s.push({frame:n/2,value:i}),a.setKeys(s);const r=new Rv;r.setEasingMode(Av.EASINGMODE_EASEINOUT),a.setEasingFunction(r),e.animations=[],e.animations.push(a),this.scene.beginAnimation(e,0,n,!1)},xx.OverlayColor={green:new Ah(0,1,0),red:new Ah(1,0,0)};var TL=class{claim(e){var t,i;t=t=>{if(xc.playerAccount.challenges=t.challenges,t.reward){const i=this.challengeGet(e);ga("send","event","dailyChallenge","claim",i.loc_ref),vueApp.showGiveStuffPopup("challenge_reward",t.reward),nb()}},i=e=>{this.log(1,e.error)},ib({cmd:"challengeClaimReward",slotId:e,sessionId:xc.playerAccount.sessionId},t,i)}rerollVipSuccess(e){if(e.challengeId===this.rerollId)this.log(1,"Challenge slot already rerolled!!!");else{const t=this.challengeGet(this.rerollId);this.rerollId=null,ga("send","event","dailyChallenge","reroll",t.loc_ref),xc.playerAccount.challenges=e,this.resetInGame()}}getNew(){lb(this.getNewSuccess.bind(this),this.getNewError.bind(this))}getNewSuccess(e){xc.playerAccount.challenges=e,this.dailyTimerStart(),this.resetInGame()}log(e,t){console.log(`PlayerChallenges ${["success","error"][e]}: ${t}`)}challengeGet(e){return XI&&XI.length>0?XI.find((t=>t.id===e)):null}dailyTimerStart(){null===this.playerChallengesTimerInterval&&(this.playerChallengesRequestNew=!1,this.playerChallengesTimerInterval=setInterval(this.timer.bind(this),1e3))}rerollVipError(e){this.rerollId=null,this.log(1,"Reroll VIP error"),console.log("playerChallengesReroll error: ",e.error),vueApp.showGenericPopup("uh_oh","chlg_no_challenges","ok")}reroll(e){this.rerollId=e,ab((()=>{var t,i,n;xc.playerAccount.isUpgraded()?ob(e,this.rerollVipSuccess.bind(this),this.rerollVipError.bind(this)):(t=e,i=this.rerollSuccess.bind(this),n=this.rerollError.bind(this),ib({cmd:"challengeRerollSlotCheck",sessionId:xc.playerAccount.sessionId,challengeId:t},i,n))}),(e=>{this.rerollId=null,yI.challengeRerollRequest=null,this.log(1,`reroll() ${JSON.stringify(e)}`)}))}getNewError(){clearInterval(this.playerChallengesTimerInterval),this.playerChallengesTimerInterval=null,this.playerChallengesRequestNew=!1}constructor(){this.playerChallengesTimerInterval=null,this.playerChallengesRequestNew=!1,this.rerollId=null}timer(){let e=Math.floor(xc.playerAccount.challengesDailyEnd-Date.now()/1e3);e<0&&(e=0,this.playerChallengesRequestNew||(this.playerChallengesRequestNew=!0,clearInterval(this.playerChallengesTimerInterval),this.playerChallengesTimerInterval=null,this.getNew()));const t={days:Math.floor(e/86400),hours:this.timeFormat(Math.floor(e%86400/3600)),minutes:this.timeFormat(Math.floor(e%3600/60)),seconds:this.timeFormat(e%60)};vueApp.player.challengeDailyData=t}timeFormat(e){return e<10?"0"+e:e.toString()}resetInGame(){bM&&hasValue(CO)&&void 0!==CO.xt&&setTimeout((()=>{var e,t;e=CO.xt,(t=Tc.getBuffer()).BkMzMvJt(nc.Xt),t.AABkMzMvLI(e),t.send(uO)}),100)}resizeTextToFit(e,t){const i=e.querySelector(".dynamic-text");if(!i)return;const n=e.clientWidth;e.clientHeight;let a=1;for(i.style.fontSize=a+"em";i.scrollWidth<=n&&a<t;)a+=.1,i.style.fontSize=a+"em";for(a=Math.min(a,t),i.style.fontSize=a+"em";i.scrollWidth>n&&a>.5;)a-=.01,i.style.fontSize=a+"em"}rerollSuccess(){this.log(0,"Reroll check"),yI.adInPlayActive||window.crazySdk.initialized?(yI.challengeRerollRequest=this.rerollId,this.rerollId=null,yI.play("shellshock.io_rpreroll_30s")):(vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok"),this.log(1,"Reroll no video ads!"))}iconSrc(e){const t=e.toLowerCase(),i=Object.entries({kill_streak:"kill_streak.svg",time:"timed.svg",kill_kills:"kills-kills.svg",grenade:"grenade.svg",kill_con:"kills-shot.svg",cluck9mm:"cluck9mm.svg",scrambler:"scrambler.svg",rpegg:"rpegg.svg",whipper:"whipper.svg",eggk47:"eggk47.svg",freeranger:"freeranger.svg",crackshot:"crackshot.svg",trihard:"trihard.svg",melee:"melee.svg",damage:"damage.svg",deaths:"deaths.svg",distance:"distance.svg",jump:"jump.svg",collect:"collect.svg",kotc:"kotc.svg",cts:"cts.svg"}).find((([e])=>t.includes(e)));return i?`img/challenges/${i[1]}`:""}resizeAllText(){setTimeout((()=>{document.querySelectorAll(".dynamic-text").forEach((e=>{this.resizeTextToFit(e,1)}))}),10)}rerollError(e){this.rerollId=null,e.error&&(vueApp.showGenericPopup("uh_oh","chlg_no_challenges","ok"),this.log(1,e.error))}},NL=()=>{pokiActive&&(thirdPartyAdblocker||"undefined"!=typeof googletag&&window.googletag&&googletag.apiReady&&googletag.pubads().addEventListener("impressionViewable",(e=>{const t=e.slot.getSlotElementId(),i=document.getElementById(t).parentNode.id;i&&ga("send","event","Poki","Display ad",i)})))},ML=e=>{pokiActive&&PokiSDK.happyTime(e)},IL=()=>{},xL=()=>{pokiActive&&(vueData.isPokiGameLoad=!0)},bL=()=>{pokiActive&&(console.log("clearPokiRewardTimer"),vueData.isPokiGameLoad=!1,vueData.isPokiNewRewardTimer=!1,vueData.pokiRewardReady=!1)},PL=class{getSubscriptions(){return this.getActiveByType("subscription")}isInitialized(){return!!this.initialized||(console.warn("Product class not initialized."),!1)}getBundles(){return this.getActiveByType("bundle")}getStoreItems(){if(!this.isInitialized())return[];const e=WI.filter((e=>!("item"===e.type||!e.inStore||!e.isActive)||!!e.showInStore));return e.length?this.categories.pass&&this.categories.pass.length>0?this.storeItemsFilterPassBundle(e):e:[]}storeItemsFilterPassBundle(e){const t=xc.catalog.findItemById(bI);if(!t)return e.filter((e=>"pass"!==e.type));return xc.playerAccount.isItemOwned(t)?e.filter((e=>"pass"!==e.type)):e.filter((e=>1!==e.id))}getProductTitleByEggValue(e){if(!this.isInitialized())return null;const t=this.categories.currency.find((t=>t.currency===e));return t?.sku||null}getBySku(e){if(this.isInitialized())return WI.find((t=>t.sku===e))||null}getPassByItemId(e){return this.categories.pass.filter((t=>this.matchItemIds(t.itemIds,e)))}getProductByItemIds(e,t){return this.isInitialized()&&this.categories[e]?this.categories[e].filter((e=>this.matchItemIds(e.itemIds,t))):[]}constructor(){this.categories={currency:[],item:[],subscription:[],pass:[],bundle:[]},this.initialized=!1,this.welcomeBundleItemId=bI}init(){WI&&Array.isArray(WI)?(Object.keys(this.categories).forEach((e=>{this.categories[e]=WI.filter((t=>t.type===e))})),this.initialized=!0):console.log("No products")}replaceItemProduct(e){if(!e)return void console.warn("Invalid product provided to replaceItemProduct");const t=this.categories.item.findIndex((t=>t.id===e));-1!==t?(this.categories.item[t].showInStore=!0,this.categories.item[t].isActive=!0,this.categories.item[t].inStore=!0):console.warn(`Product with id ${e} not found in categories`)}matchItemIds(e,t){return!(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)&&e.every(((e,i)=>e===t[i]))}getActiveByType(e){return this.isInitialized()&&this.categories[e]?.filter((e=>e.isActive))||[]}getProductType(e){const t=this.getBySku(e);return t?.type||null}getBundlesByItemId(e){return this.getBundles().filter((t=>this.matchItemIds(t.itemIds,e)))}getProductsById(e){if(!this.isInitialized())return null;return WI.find((t=>t.id===e))||null}getShopItems(){return this.isInitialized()?this.categories.item.filter((e=>e.isActive)):[]}},wL=class{_onerror(e){this.reconnectTimeoutTime>4&&(this.queue=[],this.onerror(e))}onclose(e){}send(e){this.ws.readyState===WebSocket.OPEN?this.ws.send(e):(this.queue.push(e),this.ws.readyState!==WebSocket.CONNECTING&&this.connect())}onmessage(e){}onopen(){}onerror(e){}constructor(e){this.url=e,this.ws=null,this.queue=[],this.reconnectTimeout=null,this.reconnectTimeoutTime=0,this.pingInterval=null,this.connect(e)}connect(){if(!this.ws||this.ws.readyState!==WebSocket.CONNECTING&&this.ws.readyState!==WebSocket.OPEN){console.log(`ReliableWebSocket: Connecting to ${this.url}`);try{this.ws=new WebSocket(this.url)}catch(e){return void this._onerror(e)}this.ws.onopen=()=>{console.log(`ReliableWebSocket: Connected to ${this.url}`),this.reconnectTimeoutTime=0,this.queue.forEach((e=>{this.ws.send(e)})),this.queue=[],this.pingInterval=setInterval((()=>{this.ws.send("ping")}),3e4),this.onopen()},this.ws.onclose=e=>{console.log(`ReliableWebSocket: Disconnected from ${this.url} with code ${e.code} - Attempting to reconnect in ${this.reconnectTimeoutTime} seconds...`),clearInterval(this.pingInterval),e.code===tc.NORMAL_CLOSURE||this.reconnectTimeout||(this.reconnectTimeout=setTimeout((()=>{this.reconnectTimeout=null,this.connect()}),1e3*this.reconnectTimeoutTime),this.reconnectTimeoutTime=Math.min(this.reconnectTimeoutTime+1,10)),this.onclose(e)},this.ws.onerror=e=>this._onerror(e),this.ws.onmessage=e=>this.onmessage(e)}}},OL=class{doReward(){vueApp.giveStuffPopup.titleLoc=this.locGiveGrenade,this.rewardedItem=xc.catalog.findItemById(this.itemId),rb("abTestReward",(()=>{this.addItemToInventory(),vueApp.showGiveStuffPopup("abTestReward_title",0,[this.rewardedItem],"abTestReward")}))}tryReward(){this.isEligible()&&(bM||this.doReward())}constructor(e=16029,t=1250){this.eggs=t,this.itemId=e,this.locGiveEggs="ab_test_inventory_title",this.locGiveGrenade="ab_test_inventory_title_grenade",this.accountLength=12096e5}isItemOwned(){const e=xc.catalog.findItemById(this.itemId);return xc.playerAccount.isItemOwned(e)}addItemToInventory(){this.rewardedItem&&xc.playerAccount.addToInventory(this.rewardedItem,!0)}isEligible(){if(this.isItemOwned())return!1;return localStore.getItem("lastPreRoll")&&xc.playerAccount.accountAge<this.accountLength}};function DL(e){this.rocket=e,this.scene=e.scene,this.armed=!1,this.delayFrames=0,this.dk=this.scene.getMeshByName("rocket").createInstance(""),this.dk.setEnabled(!1)}DL.v3_1=new wh,DL.prototype.fire=function(){this.armed=!1,this.delayFrames=2,this.dk.position.x=this.rocket.x,this.dk.position.y=this.rocket.y,this.dk.position.z=this.rocket.z;var e=DL.v3_1;e.set(this.rocket.x+this.rocket.dx,this.rocket.y+this.rocket.dy,this.rocket.z+this.rocket.Ik),this.dk.lookAt(e)},DL.prototype.update=function(){if(--this.delayFrames<=0&&this.dk.setEnabled(!0),!this.armed&&this.rocket.minRange<=0&&(this.armed=!0,Ib.play("gun_rpegg_rocket_fly",this.dk.position,!0)),this.delayFrames%2==0){var e=.04*Math.random()-.02,t=.04*Math.random()-.02,i=.04*Math.random()-.02;this.armed&&(PP(xb,30,this.rocket.x,this.rocket.y,this.rocket.z,e,t,i,.4,0,null),PP(bb,10,this.rocket.x,this.rocket.y,this.rocket.z,e,t,i,.4,0,null))}this.dk.position.x+=.5*(this.rocket.x-this.dk.position.x),this.dk.position.y+=.5*(this.rocket.y-this.dk.position.y),this.dk.position.z+=.5*(this.rocket.z-this.dk.position.z)},DL.prototype.remove=function(){this.dk.setEnabled(!1)};var LL=!1,FL=location.hostname.startsWith("localshelldev"),kL=location.hostname.startsWith("localhost");xc.servicesServer=`${isHttps()?"wss":"ws"}://${location.hostname}/services/`;var BL=new URLSearchParams(location.search).get("portalTest");function GL(){(IM={volume:getStoredNumber("volume",.6),mouseSensitivity:getStoredNumber("mouseSensitivity",null),mouseSpeed:getStoredNumber("mouseSpeed",50),mouseInvert:getStoredNumber("mouseInvert",1),fastPollMouse:getStoredBool("fastPollMouse",!1),holdToAim:getStoredBool("holdToAim",!0),enableChat:getStoredBool("enableChat",!0),safeNames:getStoredBool("safeNames",!1),autoDetail:getStoredBool("autoDetail",!0),shadowsEnabled:getStoredBool("shadowsEnabled",!0),highRes:getStoredBool("highRes",!0),controllerSpeed:getStoredNumber("controllerSpeed",20),deadzone:getStoredNumber("deadzone",.3),controllerInvert:getStoredNumber("controllerInvert",1),controls:getStoredObject("controls",{keyboard:{game:{up:"W",down:"S",left:"A",right:"D",jump:"SPACE",melee:"F",inspect:"G",fire:"MOUSE 0",scope:"SHIFT",reload:"R",swap_weapon:"E",grenade:"Q",despawn:"P"},spectate:{ascend:"SPACE",descend:"SHIFT",toggle_freecam:"V",slow:"MOUSE 0"}},gamepad:{game:{jump:0,fire:7,scope:6,reload:2,swap_weapon:3,grenade:5,melee:1,inspect:4},spectate:{ascend:6,descend:7}}}),musicVolume:getStoredNumber("musicVolume",.5),musicStatus:getStoredBool("musicStatus",!0),hideBadge:getStoredBool("hideBadge",!1),closeWindowAlert:getStoredBool("closeWindowAlert",!1),shakeEnabled:getStoredBool("shakeEnabled",!0),centerDot:getStoredBool("centerDot",!0),hitMarkers:getStoredBool("hitMarkers",!0)}).mouseSpeed||null===IM.mouseSensitivity||(IM.mouseSpeed=Math.floor(Math.sqrt(350*IM.mouseSensitivity)+19),localStore.removeItem("mouseSensitivity")),function(){function e(t,i){Object.keys(t).forEach((n=>{"object"==typeof t[n]?(i[n]||(i[n]={}),e(t[n],i[n])):i[n]||(i[n]=t[n])}))}e({keyboard:{game:{up:"W",down:"S",left:"A",right:"D",jump:"SPACE",melee:"F",inspect:"G",fire:"MOUSE 0",scope:"SHIFT",reload:"R",swap_weapon:"E",grenade:"Q",despawn:"P"},spectate:{ascend:"SPACE",descend:"SHIFT",toggle_freecam:"V",slow:"MOUSE 0"}},gamepad:{game:{jump:0,fire:7,scope:6,reload:2,swap_weapon:3,grenade:5,melee:1,inspect:4},spectate:{ascend:6,descend:7}}},IM.controls)}(),HL(IM.controls),vueApp.setUiSettings(IM)}function UL(){localStore.setItem("volume",IM.volume),localStore.setItem("mouseSpeed",IM.mouseSpeed),localStore.setItem("mouseInvert",IM.mouseInvert),localStore.setItem("fastPollMouse",IM.fastPollMouse),localStore.setItem("holdToAim",IM.holdToAim),localStore.setItem("enableChat",IM.enableChat),localStore.setItem("safeNames",IM.safeNames),localStore.setItem("autoDetail",IM.autoDetail),localStore.setItem("shadowsEnabled",IM.shadowsEnabled),localStore.setItem("highRes",IM.highRes),localStore.setItem("controllerSpeed",IM.controllerSpeed),localStore.setItem("deadzone",IM.deadzone),localStore.setItem("controllerInvert",IM.controllerInvert),localStore.setItem("controls",JSON.stringify(IM.controls)),localStore.setItem("musicVolume",IM.musicVolume),localStore.setItem("musicStatus",IM.musicStatus),localStore.setItem("hideBadge",IM.hideBadge),localStore.setItem("closeWindowAlert",IM.closeWindowAlert),localStore.setItem("shakeEnabled",IM.shakeEnabled),localStore.setItem("centerDot",IM.centerDot),localStore.setItem("hitMarkers",IM.hitMarkers)}function HL(e){DM={keyboard:{game:{},spectate:{}},gamepad:{game:{},spectate:{}}},Object.keys(e.keyboard).forEach((t=>{Object.keys(e.keyboard[t]).forEach((i=>{DM.keyboard[t][e.keyboard[t][i]]=i}))})),Object.keys(e.gamepad).forEach((t=>{Object.keys(e.gamepad[t]).forEach((i=>{DM.gamepad[t][e.gamepad[t][i]]=i}))}))}function VL(e,t){if(0===e)return console.log("game volume suspended"),vueApp.volume=0,BAWK.setVolume(0),BAWK.suspend();e=e||IM.volume,console.log("volume set to: "+e),BAWK.resume(),BAWK.setVolume(e),vueApp.volume=e}function WL(e){IM.mouseSpeed=e}function zL(e){IM.controllerSpeed=e}function XL(e){IM.deadzone=e}function YL(e,t){this.spatula=e,this.scene=e.scene,this.dk=JI("spatula",t),this.dk.material=Xb.getMaterialByName("emissive"),this.dk.emissiveColor=new Ah(.8,.6,.2),this.dk.setRenderingGroupId(1)}function jL(){this.dx=0,this.dy=0,this.Ik=0,this.speedMultiplier=1,this.dampenLambda=.2,this.playerIdx=0}BL&&(dynamicContentRoot=`${BL}.shellshock.io`,dynamicContentPrefix=`https://${BL}.shellshock.io/`),dynamicContentRoot?xc.servicesServer=(isHttps()?"wss":"ws")+"://"+dynamicContentRoot+"/services/":(kL||FL||location.hostname.startsWith("staging"))&&(LL=!0),YL.prototype.dispose=function(){this.dk.dispose()},YL.prototype.drop=function(){this.dk.parent=null,BAWK.play("drop_spatula")},YL.prototype.capture=function(e){this.dk.parent=e.Nk.YM,this.dk.position.set(0,-.2,.3),this.dk.rotation.y=0},YL.prototype.update=function(e){255==this.spatula.cM?(this.dk.position.x+=.5*(this.spatula.x-this.dk.position.x),this.dk.position.y+=.5*(this.spatula.y+.1-this.dk.position.y),this.dk.position.z+=.5*(this.spatula.z-this.dk.position.z),this.dk.rotation.y+=.1*e):this.dk.parent.parent.Ak(!0)};var KL={freeCamera:0,firstPerson:1};xx.wk=new wh,xx.Jk=new wh,xx.ray=new Fg,xx.matrix=new Lh;var $L=function(e,t,i,n){return vh.Lerp(e,t,1-Math.exp(-i*n))};function qL(e){let t=Date.now()-JL;ga("send","event","onLoad",e?"loaded":"loading",Math.floor(t/1e3)+" - seconds"),e&&clearInterval(QL)}jL.prototype.firstPerson=function(){let e=Jb[this.playerIdx];e&&e.nk&&this.playerIdx!==RO||(e=this.findNextPlayer()),e&&this.spectatePlayer(e)},jL.prototype.freeCamera=function(){uM!==RO&&(CO.Dk=jN.rotation.x,CO.Qk=jN.rotation.y),jN.parent=null,jN.lockedTarget=null,uM=RO,$b=CO,Gb=0,vueData.ui.game.spectatingPlayerName=null,this.restorePreviousPlayerActor()},jL.prototype.restorePreviousPlayerActor=function(){let e=Jb[this.playerIdx];e&&e.Nk.hat&&e.Nk.hat.Ak(!0)},jL.prototype.spectatePlayer=function(e){this.restorePreviousPlayerActor(),this.playerIdx=e.id,uM=e.id,$b=e,e.Nk.dk.Ak(!0),e.Nk.hat&&e.Nk.hat.Ak(!1),jN.lockedTarget=null,wb=!1,Sw(),vueData.ui.game.spectatingPlayerName=e.name,Xb.autoClear=!0,Xb.autoClearDepthAndStencil=!0},jL.prototype.spectateNextPlayer=function(e=1){let t=this.findNextPlayer(e);t&&this.spectatePlayer(t)},jL.prototype.findNextPlayer=function(e=1){let t=null;for(var i=[],n=0;n<TO;n++){let e=Jb[n];e&&i.push(e.id)}if(0===i.length)return this.unlock(),null;mO.sortPlayerList(i);for(let e=0;e<i.length;e++)if(Jb[i[e]].id===this.playerIdx){t=e;break}null===t&&(t=0);let a=t;for(;a=Math.mod(a+e,i.length),a!==t;){let e=Jb[i[a]];if(e&&e.nk&&e.id!==RO)return e}return this.unlock(),null},jL.prototype.unlock=function(){uM=null,$b=null,this.playerIdx=null},jL.prototype.update=function(e){if(Bb===KL.firstPerson)$b&&$b.nk&&(jN.position.copyFrom($b.Nk.eye.getAbsolutePosition()),jN.rotation.y=$b.Nk.dk.rotation.y+Math.PI,jN.rotation.x=-$b.Nk.head.rotation.x);else{var t=0,i=0,n=0;Gb&Rx.left&&(t+=Math.cos(CO.Qk),n-=Math.sin(CO.Qk)),Gb&Rx.right&&(t-=Math.cos(CO.Qk),n+=Math.sin(CO.Qk)),Gb&Rx.up&&(t+=Math.sin(CO.Qk),n+=Math.cos(CO.Qk)),Gb&Rx.down&&(t-=Math.sin(CO.Qk),n-=Math.cos(CO.Qk)),Gb&Rx.ascend&&(i=1),Gb&Rx.descend&&(i=-1);var a=new wh(t,i,n).normalize(),s=this.dx,r=this.dy,o=this.Ik;this.dx+=.016*a.x,this.dy+=.008*a.y,this.Ik+=.016*a.z;var l=.5*(this.dx+s),c=.5*(this.dy+r),h=.5*(this.Ik+o);jN.position.x+=l*e*this.speedMultiplier,jN.position.y+=c*e*this.speedMultiplier,jN.position.z+=h*e*this.speedMultiplier,jN.position.y=Math.min(Math.max(1.5,jN.position.y),50),CO.Ek=jN.position.x,CO.Zk=jN.position.y,CO.ek=jN.position.z,this.dx=$L(this.dx,0,this.dampenLambda,e),this.dy=$L(this.dy,0,this.dampenLambda,e),this.Ik=$L(this.Ik,0,this.dampenLambda,e),jN.rotation.x=-CO.Dk,jN.rotation.y=CO.Qk}},jL.prototype.startSlow=function(){this.speedMultiplier=.1,this.dampenLambda=.075},jL.prototype.endSlow=function(){this.speedMultiplier=1,this.dampenLambda=.2},window.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),window.onresize=function(){tD()},window.mobileAndTabletcheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),/Googlebot/i.test(navigator.userAgent)&&(e=!1),e},window.onloadingcomplete=function(){if("undefined"==typeof startVue||"undefined"==typeof firebase)return void setTimeout(window.onloadingcomplete,100);if(NI=new URL(window.location.href).searchParams.get("abTest"),TI=new jx({a:20}),BD(),OD())return console.log("startShellShockers"),IO(),void(window.onload=null);const e=location.protocol+"//"+location.host;window.location.href=e+"/portals"},window.addEventListener("beforeunload",(e=>{if(bM&&IM.closeWindowAlert){const t="Are you sure you want to exit?";return e.preventDefault(),e.returnValue=t,hasValue(vM.sessionStart)&&(QD(KN,Sx[ZN].name),AD(vM.end()),CD()),t}}));var JL=Date.now(),QL=setInterval((()=>{Date.now();qL(!1)}),5e3);function ZL(e,t){const i=function(){let e="Shell Shockers";return pokiActive?e="Poki":crazyGamesActive&&(e="Crazy Games"),e}();if(console.log("getXsollaToken called (firebase ID: {0})".format(xc.playerAccount.firebaseId),t),lI=e,function(e){const t=e===xI,{isAnonymous:i,isEmailVerified:n,firebaseId:a}=xc.playerAccount;if(t){const e=!!a;return e||vueApp.showGenericPopup("player_not_found_title","player_not_found_welcome_bundle_desc","ok"),e}return!(i||!n)||(vueApp.denyAnonUser(),!1)}(e)){!function(e,t,i,n,a){n=n||!1,ib({cmd:"xsollaToken",firebaseId:xc.playerAccount.firebaseId,productSku:e,subscription:n,playerSource:a},t,i)}(e,(function(e){e.error?(console.log("xsollaTokenResponse Error: "+JSON.stringify(e)),disableProductPurchasing()):(console.log("response: "+JSON.stringify(e)),"SUCCESS"==e.result?(console.log("Got Xsolla token: "+e.token),function(e){var t={access_token:e,sandbox:location.hostname.startsWith("localshelldev")||location.hostname.startsWith("staging"),lightbox:{spinner:"round",overlayOpacity:.8}},i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="//static.xsolla.com/embed/paystation/1.0.7/widget.min.js",i.addEventListener("load",(function(e){XPayStationWidget.on("init",(function(e){console.log("Xsolla PayStation initialized"),XPayStationWidget.open()})),XPayStationWidget.on("close",(function(e){console.log("Xsolla PayStation closed"),bM?(vueApp.showGameMenu(),vueApp.setDarkOverlay(!1)):vueApp.toggleTitleScreenAd(!0),setTimeout((function(){nb(),ab()}),3e3)})),XPayStationWidget.on("open",(function(e){bM?vueApp.hideGameMenu():vueApp.toggleTitleScreenAd(!1),console.log("Xsolla PayStation open"),console.log(lI)})),XPayStationWidget.on("status",(function(e){console.log("Xsolla PayStation status"),console.log("status",e),console.log(lI)})),XPayStationWidget.on("status-invoice",(function(e){console.log("Xsolla PayStation status-invoice"),console.log("status-invoice",e),console.log(lI)})),XPayStationWidget.on("status-delivering",(function(e){console.log("Xsolla PayStation status-delivering"),console.log("status-delivering",e),console.log(lI)})),XPayStationWidget.on("status-done",(function(e){console.log("Xsolla PayStation status-done"),console.log("status-done",e),console.log(lI),localStore.setItem("xsollaPurchase",!0),"golden_chicken_pass"===lI&&ML(1),eF()})),XPayStationWidget.init(t)}),!1),document.getElementsByTagName("head")[0].appendChild(i),xsollaSetup=!0}(e.token),console.log(e)):(console.log("Failed to get Xsolla token"),tF()))}),(function(e){console.log("Error getting Xsolla token: "+JSON.stringify(e)),tF()}),t,i)}}qL(0);var eF=()=>{if(!hasValue(lI))return;let e=vueData.eggStoreItems.filter((e=>e.sku===lI))[0],t=e.sku,i=e.salePrice?Math.round(e.salePrice):"",n=Math.round(e.price),a=i||n;if(!hasValue(t)&&!hasValue(a))return console.log("No Price no sku"),void(lI=null);let s=vueApp.eggStoreReferral?t+" "+vueApp.eggStoreReferral:t;return lI=null,ga("send","event",vueApp.googleAnalytics.cat.purchases,vueApp.googleAnalytics.action.purchaseComplete,s,a)};function tF(){vueApp.showGenericPopup("uh_oh","purchase_disabled","ok")}tO.state={start:0,dM:1,win:2,capturing:3,contested:4,takeover:5,abandoned:6,unclaimed:7},tO.captureSpeeds=[1.2,1.5,2.04,3,4.8],tO.goalScore=5,tO.takeOverTime=90,tO.takeOverSpeed=1;var iF=class{static stripTris(e,t,i,n){for(var a=i.getIndices(),s=i.getVerticesData($h.PositionKind),r=i.getVerticesData($h.NormalKind),o=new wh,l=new wh,c=[],h={x:0,y:0,z:0},f=0;f<a.length;f+=3){for(var u=!1,d=0,m=0,p=0,_=0,v=0,g=0,S=0;S<3;S++){var y=a[f+S],E=n[y];if(y*=3,!E){u=!0;break}{d=s[y+0],m=s[y+1],p=s[y+2];let i=1024,n=.5/i;d=Math.floor((d+n)*i)/i,m=Math.floor((m+n)*i)/i,p=Math.floor((p+n)*i)/i,h.x=d-E.x,h.y=m-E.y,h.z=p-E.z;var A=this.normalizeManhattan(h);_=.75*r[y+0],v=.75*r[y+1],g=.75*r[y+2];if(A){if(o.set(_,v,g).normalize(),l.set(h.x,h.y,h.z).normalize(),wh.Dot(o,l)<.5){u=!0;break}var C=Math.floor(E.x+_+.5),R=Math.floor(E.y+v+.5),T=Math.floor(E.z+g+.5)}else C=Math.floor(d+h.x+.5),R=Math.floor(m+h.y+.5),T=Math.floor(p+h.z+.5);if(!u)try{var N=e[C][R][T];if(!N||!N.idx){u=!0;break}if(!t[N.idx].name.endsWith(".full")||"SPECIAL"===t[N.idx].theme){u=!0;break}}catch(e){u=!0;break}}}u&&(c.push(a[f+0]),c.push(a[f+1]),c.push(a[f+2]))}return console.log("stripped "+(a.length-c.length)+" tris",a.length,c.length),i.setIndices(c),i}static normalizeManhattan(e){var t=Math.abs(e.x),i=Math.abs(e.y),n=Math.abs(e.z),a=Math.max(t,Math.max(i,n));return 0==a?(e.x=0,e.y=0,e.z=0):(e.x=.5*Math.trunc(e.x/a),e.y=.5*Math.trunc(e.y/a),e.z=.5*Math.trunc(e.z/a)),e.x*e.y!=0||e.x*e.z!=0||e.y*e.z!=0}static yM(e,t,i,n,a,s){var r;if(n){if(!i.data[n])return void s();r=[n]}else r=Object.keys(i.data);var o=[],l=new uy("SPS",e,{updatable:!0,autoFixFaceOrientation:!1});l.computeParticleColor=!1,l.computeParticleTexture=!1,l.computeParticleRotation=!1,l.recomputeNormals=!1;var c=function e(c){if(c!=r.length){var h=r[c],f=i.data[h],u=t[h];void 0===(g=Nx[u])&&console.log("mesh not found: "+h);var d=h.split(".");if(g.theme=d[0],g.colliderType=d[2],g.softness=d[3],"SPECIAL"!=g.theme&&("DYNAMIC"!=g.theme||n)){var m,p=0,_=Object.values(f).filter((e=>!a||e.zone==a));l.addShape(g,_.length,{positionFunction:function(e,t,n){var a=_[p].rx||0,s=_[p].ry||0,r=_[p].rz||0;e.position.x=_[p].x+i.extents.x.min,e.position.y=_[p].y+i.extents.y.min,e.position.z=_[p].z+i.extents.z.min,e.rotation.x=a*ow,e.rotation.y=s*ow,e.rotation.z=r*ow,e.alive=!1,m=h.endsWith(".full")||h.includes("capture-zone")?{x:e.position.x,y:e.position.y,z:e.position.z}:0,p++},vertexFunction:function(e,t,i){o.push(m)}})}var v=e.bind(this,c+1);window.requestAnimationFrame(v)}else{var g=l.buildMesh();s(g,o)}}.bind(this,0);window.requestAnimationFrame(c)}};window.extern={catalog:xc.catalog,play:fD,getLanguageData:QO,continueStartup:function(){if(window.mobileAndTabletcheck()){location.protocol,location.host;window.location.href="https://shellshock.io/mobile"}else(function(){if(navigator.userAgent.indexOf("Edge")>=0)return vueApp.showUnsupportedPlatformPopup("unsupported_oldmsedge"),!0;return!1})()||function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var e=[];Md.isSupported()||e.push('{0} (<a href="https://shellshock.io/faq.html#webgl" target="_window">{1}</a>)'.format(vueApp.loc.missing_webgl,vueApp.loc.missing_moreinfo));(!document.exitPointerLock||navigator.userAgent.indexOf("10.1.2 Safari")>=0)&&e.push('{0} (<a href="https://shellshock.io/faq.html#pointerlock" target="_window">{1}</a>)'.format(vueApp.loc.missing_pointerlock,vueApp.loc.missing_moreinfo));localStore||e.push(vueApp.loc.missing_localstorage);void 0===new KeyboardEvent("").key&&e.push(vueApp.loc.missing_keyboardevent);if(vueApp.missingFeatures=e,e.length>0)return vueApp.showMissingFeaturesPopup(),!0;return!1}()||(navigator.userAgent.indexOf("Chrome/84"),async function(e){NO=new dv(xc.engine);let t=new yv("camera",wh.Zero(),NO);if(NO.activeCameras.push(t),gL.getRegions().then(CL),console.log("loadResources()"),Ox(NO),function(e,t){(Nx=[null]).push(wx("SPECIAL.barrier.full.verysoft",e,new Ah(1,0,0))),Nx.push(wx("SPECIAL.barrier.full",e,new Ah(0,1,0))),Nx.push(wx("SPECIAL.barrier.none",e,new Ah(1,1,1)));for(var i=[],n=0;n<=1;n+=.125){var a=-Math.PI/2+Math.PI*n,s=Math.cos(a),r=.5*Math.sin(a+.05)+.5;s=.25*Math.pow(s,1.3),r=.6*Math.pow(r,1.3)-.48,i.push(new wh(s,r,0))}var o,l=ey.kk("SPECIAL.spawn-blue.none",{shape:i,tessellation:12},e);(o=new Og("",e,!0)).diffuseColor=new Ah(0,.5,1),o.specularColor=new Ah(.1,.2,.4),o.specularPower=8,l.material=o,l.setEnabled(!1),Nx.push(l),l=ey.kk("SPECIAL.spawn-red.none",{shape:i,tessellation:12},e),(o=new Og("",e,!0)).diffuseColor=new Ah(1,.25,.25),o.specularColor=new Ah(.4,.3,.3),o.specularPower=8,l.material=o,l.setEnabled(!1),Nx.push(l),Dx(e,["map"],(function(e){e.parent||"__root__"==e.name?e.freezeWorldMatrix():Nx.push(e)}),(function(){for(var e=1;e<Nx.length;e++){var i=Nx[e].getChildMeshes()[0];i&&(Nx[e].colliderMesh=i)}t()}))}(NO,(()=>{var e={name:"SPECIAL.spatula.none"};Nx.push(e),TM=!0})),PI){console.log("Start resource loading");try{await Promise.all([new Promise((e=>{var t;t=()=>{console.log("Sounds loaded"),e()},BAWK.load("sound/sounds.json?"+Ac).then((()=>t()))})),new Promise((e=>{const t=cI?"Loading all object meshes":"Loading default object meshes";console.log(t),Dx(NO,["egg","gun_eggk47","gun_csg1","gun_cluck9mm","gun_dozenGauge","gun_rpegg","gun_smg","gun_m24","gun_aug","munitions","muzzleFlash","items","reticle","melee"],null,(()=>{console.log("Object meshes loaded"),OI=cI,e()}),cI)}))]),NO.cleanCachedTextureBuffer(),cI&&(qN=new yp(`img/stamps.webp?v=${SM}`,NO,!1,!0)),uL=new vL,vueApp.chwRewardIds=[...vueApp.chwRewardIds,...YI],e()}catch(e){console.error("Error during resource loading:",e)}}}(PO))},showSignInDialog:yO,signOut:function(){firebase.auth().signOut().then((function(){xc.playerAccount=new Dc,xc.playerAccount.loggingOut(),xc.playerAccount.applyRandomLoadout(),productBlockAds=!1,pokiActive||crazyGamesActive||(bO(),vueApp.showTitleScreenAd()),setTimeout((()=>vueApp.setDarkOverlay(!1)),1500)}),(function(e){console.log(e)})),ga("set","dimension4","noVip"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.signIn,vueData.googleAnalytics.label.signInOut),vueApp.photoUrl=null,JO(),Jx(),uI=!1},sendFirebaseVerificationEmail:_O,selectRegion:function(e){let t=gL.regionList.find((function(t){return t.id===e}));hasValue(t)||(t=gL.regionList[0]),vueApp.currentRegionId=t.id,localStore.setItem("selectedRegionId",t.id)},generateRandomName:zx,changeClass:function(e){xc.playerAccount.setClass(e),vueData.selectedWeaponDisabled=rx.isSelectedWeaponDisabled(e)},toggleFullscreen:function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement){(e=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen)&&e.call(document)}else{var e,t=document.documentElement;(e=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen)&&e.call(t)}},applyUiSettings:function(e,t){var i;Object.values(e.adjusters).forEach((e=>{e.forEach((e=>{IM[e.id]=e.value}))})),Object.values(e.togglers).forEach((e=>{e.forEach((e=>{"mouseInvert"===e.id||"controllerInvert"==e.id?IM[e.id]=e.value?-1:1:IM[e.id]=e.value}))})),e.controls.keyboard.game.forEach((e=>{IM.controls.keyboard.game[e.id]=e.value})),e.controls.keyboard.spectate.forEach((e=>{IM.controls.keyboard.spectate[e.id]=e.value})),e.controls.gamepad.game.forEach((e=>{IM.controls.gamepad.game[e.id]=e.value})),e.controls.gamepad.spectate.forEach((e=>{IM.controls.gamepad.spectate[e.id]=e.value})),HL(IM.controls),VL(),WL(IM.mouseSpeed),zL(IM.controllerSpeed),XL(IM.deadzone),i=IM.enableChat,console.log("setting chat: "+i),i?(IM.enableChat=!0,localStore.setItem("enableChat",!0),bM&&(Pw()?(rM.value=ZO("ingame_press_enter_to_chat"),rM.style.pointerEvents="auto"):(rM.value=ZO("ingame_sign_in_to_chat"),rM.style.pointerEvents="none"),oM.style.display="block",rM.style.display="block")):(IM.enableChat=!1,localStore.setItem("enableChat",!1),bM&&(oM.style.display="none",rM.style.display="none")),Xb&&(IM.autoDetail?t.autoDetail||(aD(!0),sD(!0),iD()):(aD(IM.highRes),sD(IM.shadowsEnabled),nD()),IM.centerDot?Db.showDot():Db.hideDot(),IM.hitMarkers?Fb.show():Fb.hide()),UL()},resetSettings:function(){localStore.removeItem("volume"),localStore.removeItem("mouseSensitivity"),localStore.removeItem("mouseSpeed"),localStore.removeItem("mouseInvert"),localStore.removeItem("fastPollMouse"),localStore.removeItem("holdToAim"),localStore.removeItem("enableChat"),localStore.removeItem("safeNames"),localStore.removeItem("autoDetail"),localStore.removeItem("shadowsEnabled"),localStore.removeItem("highRes"),localStore.removeItem("controlConfig"),localStore.removeItem("controllerSpeed"),localStore.removeItem("deadzone"),localStore.removeItem("controllerInvert"),localStore.removeItem("controls"),localStore.removeItem("hideBadge"),localStore.removeItem("closeWindowAlert"),localStore.removeItem("shakeEnabled"),localStore.removeItem("centerDot"),GL()},setVolume:VL,setSafeNames:function(e){if(bM){for(var t=0;t<TO;t++){var i=Jb[t];i&&(i.name=e?i.safeName:i.yk,i.Nk.setupNameSprite())}Sw()}},setMouseSpeed:WL,setControllerSpeed:zL,setDeadzone:XL,setShadows:sD,renderItemToCanvas:function(e,t,i){e||uL.clearCanvas(t),e.item_type_id===pc.Stamp?uL.renderStampToCanvas(e,t,i):uL.renderToCanvas(e,t,i)},getEquippedItems:function(){return xc.playerAccount.getEquippedItems()},getTaggedItems:function(e,t){return xc.catalog.getTaggedItems(e,t)},getPremiumItems:function(){return xc.catalog.getPremiumItems()},getItemsOfType:function(e){switch(e){case pc.Hat:return xc.catalog.hats;case pc.Stamp:return xc.catalog.stamps;case pc.Primary:return xc.catalog.forClass[xc.playerAccount.classIdx].forWeaponSlot[mc.Primary];case pc.Secondary:return xc.catalog.forClass[xc.playerAccount.classIdx].forWeaponSlot[mc.Secondary];case pc.Grenade:return xc.catalog.grenades;case pc.Melee:return xc.catalog.melee;default:return[]}},isItemOwned:lO,tryEquipItem:function(e,t){if(t=t||e.item_type_id,null===e||lO(e)||"default"===e.unlock)switch(t){case pc.Hat:xc.playerAccount.hatItem=e;break;case pc.Stamp:xc.playerAccount.stampItem=e;break;case pc.Primary:xc.playerAccount.pickWeapon(mc.Primary,e);break;case pc.Secondary:xc.playerAccount.pickWeapon(mc.Secondary,e);break;case pc.Grenade:xc.playerAccount.grenadeItem=e;break;case pc.Melee:xc.playerAccount.meleeItem=e}},poseWithItems:(e,t,i)=>PM.poseWithItems(e,t,i),setShellColor:function(e){xc.playerAccount.colorIdx=e,PM.poseWithColor(e)},setStampPosition:function(e,t){PM.poseWithStamp(void 0,e,t)},api_checkBalance:nb,checkUpgrade:ab,api_buy:function(e,t,i){ib({cmd:"buy",firebaseId:xc.playerAccount.firebaseId,itemId:e.id,save:"undefined"==typeof checkStatus||checkStatus()},(function(e){switch(console.log("purchase response: "+e.result),e.result){case"SUCCESS":if(hasValue(e.itemId)){var n=xc.catalog.findItemById(e.itemId);xc.playerAccount.addToInventory(n,!0)}xc.playerAccount.currentBalance=e.currentBalance,vueApp.statsLoading(),DD(),ML(.5),t();break;case"INSUFFICIENT_FUNDS":vueApp.needMoreEggsPopupCall();break;case"ALREADY_OWNED":vueApp.showGenericPopup("p_buy_owned_title","p_buy_owned_content","ok");break;case"ERROR_CODE_4225":vueApp.showGenericPopup("p_error_4225_title","p_buy_error_content","ok");break;default:i()}}),(function(){i()}))},api_redeem:function(e,t,i){if(5831==e)return vueApp.giveStuffPopup.eggOrg=!0,void vueApp.showGiveStuffPopup("p_give_stuff_title");ib({cmd:"redeem",firebaseId:xc.playerAccount.firebaseId,id:xc.playerAccount.id,code:e},(function(e){switch(console.log("Redeem Code response: "+e.result),e.result){case"SUCCESS":e.eggs_given||(e.eggs_given=0),e.item_ids||(e.item_ids=[]),e.eggs_given&&e.eggs_given>0&&nb();var n=[];if(e.item_ids)for(var a=0;a<e.item_ids.length;a++){var s=xc.catalog.findItemById(e.item_ids[a]);xc.playerAccount.addToInventory(s),n.push(s)}ML(.5),t(e.eggs_given,n);break;case"PLAYER_NOT_FOUND":vueApp.showGenericPopup("p_redeem_error_no_player_title","p_redeem_error_no_player_content","ok");break;case"CODE_DOUBLE_DOUBLE":vueApp.showGenericPopup("p_redeem_code_redeem_in_progress_title","p_redeem_code_redeem_in_progress_content","ok");break;case"CODE_PREV_REDEEMED":vueApp.showGenericPopup("p_redeem_prev_title","p_redeem_prev_content","ok");break;case"CODE_NOT_FOUND":vueApp.showGenericPopup("p_redeem_badcode_title","p_redeem_badcode_content","ok");break;case"RATE_LIMIT_REACHED":vueApp.showGenericPopup("p_redeem_ratelimited_title","p_redeem_ratelimited_content","ok");break;default:i()}}),(function(){console.log("there be an error"),i()}))},saveEquipment:cD,buyGoldenChicken:function(){ZL("golden_chicken_pass")},checkStartChicknWinner:Jx,api_feedback:function(e,t,i){const n=()=>vueApp.showGenericPopup("uh_oh","feedback_error_msg","ok");for(var a=xc.engine.getGlInfo(),s=xc.engine.getCaps(),r=[],o=0;o<_c.length;o++)r.push([xc.playerAccount.pickedWeapons[o][0].id,xc.playerAccount.pickedWeapons[o][1].id]);var l="";if(e!==fc||hasValue(xc.playerAccount.firebaseId)){try{l=JSON.stringify({debugObject:jM,debugArray:YM})}catch(e){console.log(e)}ib({cmd:"feedback",feedbackType:e,gameVersion:SM,userAgent:window.navigator.userAgent,username:vueApp.playerName,comments:i,email:t,firebaseId:xc.playerAccount.firebaseId||null,fromEU:isFromEU,gameServer:vueApp.loc[vueApp.currentRegionLocKey]||null,session:xc.playerAccount.session||null,ping:iM>0?Math.floor(tM/iM):null,highestPing:KM||null,fps:aM>0?Math.ceil(nM/aM):null,gameType:JN||null,privateGame:null,localKills:Ub||0,localDeaths:Hb||0,localStreak:Vb||0,url:parsedUrl.root,referrer:document.referrer,LM:QN||null,screenSize:screen.width+"x"+screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth,innerSize:window.innerWidth+"x"+window.innerHeight,glVendor:a.vendor,renderer:a.renderer,glVersion:a.version,maxTextureSize:s.maxTextureSize,Lt:jN?jN.Lt:null,controls:localStorage.getItem("controls"),ofAge:EM?EM.ofAge:null,targetedAds:EM?EM.targetedAds:null,volume:IM.volume,mouseSpeed:IM.mouseSpeed,mouseInvert:IM.mouseInvert,holdToAim:IM.holdToAim,enableChat:IM.enableChat,safeNames:IM.safeNames,autoDetail:IM.autoDetail,shadowsEnabled:IM.shadowsEnabled,highRes:IM.highRes,selectedClass:xc.playerAccount.classIdx,selectedColor:xc.playerAccount.colorIdx,hat:xc.playerAccount.hatItem?xc.playerAccount.hatItem.id:null,stamp:xc.playerAccount.stampItem?xc.playerAccount.stampItem.id:null,stampPositionX:xc.playerAccount.stampPositionX,stampPositionY:xc.playerAccount.stampPositionY,grenade:xc.playerAccount.grenadeItem?xc.playerAccount.grenadeItem.id:null,weapons:"[[0,0],[0,0],[0,0]]",timesPlayed:null,xsollaToken:null,current_balance:xc.playerAccount.currentBalance,log:"",debug:l},(function(e){const t={title:"",desc:""};e.status?e.type===fc?(t.title="feedback_delete_title",t.desc="feedback_delete_msg"):(t.title="feedback_sent_title",t.desc="feedback_sent_msg"):(t.title="uh_oh",t.desc="feedback_error_msg");setTimeout((function(){vueApp.showGenericPopup(t.title,t.desc,"ok")}),1e3)}),(function(e){n()}))}else n()},releaseKeys:Rw,captureKeys:Cw,respawn:function(){return OM?(CO.nk=!0,void canvas.requestPointerLock({unadjustedMovement:IM.fastPollMouse})):(console.log("Respawn pressed - respawnTime: "+ub),ub<0?(SD.clearAll(),yD.clearAll(),SD.set((()=>{"IFRAME"==document.activeElement.tagName&&(console.log("iframe attempted to steal focus:",document.activeElement),document.activeElement.blur())}),100),IM.autoDetail&&iD(),TP()?(Cb=!0,void yI.play("shellshock.io_preroll",gP)):function(){if(!MI)return console.log("requestRespawn - isChromeSuxPointerAllowed"),void Qw();if(console.log(`requestRespawnBlocked ${NP}`),NP)return;if(NP=!0,setTimeout((()=>NP=!1),1e3),fP){CO.changeCharacter(xc.playerAccount.classIdx,xc.playerAccount.getPrimaryWeapon(),xc.playerAccount.getSecondaryWeapon(),xc.playerAccount.colorIdx,xc.playerAccount.hatItem,xc.playerAccount.stampItem,xc.playerAccount.stampPositionX,xc.playerAccount.stampPositionY,xc.playerAccount.grenadeItem,xc.playerAccount.meleeItem),(e=Tc.getBuffer()).BkMzMvJt(nc.O),e.BkMzMvJt(xc.playerAccount.classIdx),e.send(uO),fP=!1}var e;(e=Tc.getBuffer()).BkMzMvJt(nc.vt),e.send(uO),vueApp.setPause(!1),crazySdk.gameplayStart()}()):void 0)},leaveGame:function(e){xc.engine&&xc.engine.stopRenderLoop(),cb(),RO=0,uM=0,vueApp.resetGameOptions(),bM?(CO&&(xc.playerAccount.kills+=Ub,xc.playerAccount.deaths+=Hb,xc.playerAccount.streak=Math.max(Vb,xc.playerAccount.streak),vM.streak=Vb),SD.clearAll(),yD.clearAll(),clearInterval(Wb),uO.close(tc.mainMenu),uO=null,Rw(),document.exitPointerLock(),KN>0&&(QD(KN,Sx[ZN].name),vM.end(),AD(),CD(),function(){if(ED)return;ED=!0;const e=LD();if(0===Object.keys(e).length)return;e.kills&&ga("send","event","player stats","game_stats","total_kills",e.kills);e.deaths&&ga("send","event","player stats","game_stats","total_deaths",e.deaths);if(!e.hasOwnProperty("charClass"))return;const t=Object.keys(e.charClass);if(0===t.length)return;t.forEach((t=>{const i="Ranger"===t?"Free Ranger":t;(e.charClass[t].kills||e.charClass[t].deaths)&&(ga("send","event","player stats","kills",i,e.charClass[t].kills),ga("send","event","player stats","deaths",i,e.charClass[t].deaths),ga("send","event","player stats","kill ratio",i,Math.floor(e.charClass[t].kills/Math.max(e.charClass[t].kills+e.charClass[t].deaths,1)*100)))}))}()),Xb.dispose(),bM=!1,vueApp.setInGame(bM),CL(),PM=new yL,e(),bL(),vueApp.hideRespawnDisplayAd(),AI=!1,hL(),kD(),eggOrgLeaderboard.apiGet(),gM.tryReward()):vueApp.switchToHomeUi(),crazySdk.hideInviteButton(),_D(),DD()},openEquipInGame:Xw,closeEquipInGame:function(e){xc.engine.stopRenderLoop(),KP(e),fP=!0,vb&&rM.focus()},buyProductForMoney:function(e){parsedUrl.dom+parsedUrl.top!=="devshellshock"||localStore.getItem("xsollaPopupConfrim")?(lI=e,ZL(e,"subscription"===hI.getProductType(e)),localStore.removeItem("xsollaPopupConfrim")):vueApp.openDevXsollaPopup(e)},clickedHouseAdSmall:function(e){ga("send","event",{eventCategory:"House banner ad",eventAction:"click",eventLabel:e.label}),fL(e)},clickedHouseAdBig:function(e){ga("send","event",{eventCategory:"Big ad",eventAction:"click",eventLabel:e.label}),fL(e)},clickedHouseLink:fL,doConsent:function(){ga("send","event","privacy","age gate","agree"),EM={ofAge:!0,targetedAds:!0},googletag.consented=!0,vueApp.setPrivacySettings(!0,!0),localStore.setItem("consent",JSON.stringify(EM))},doNotConsent:function(){ga("send","event","privacy","age gate","disagree"),googletag.consented=!1,vueApp.setPrivacySettings(!1,!1),localStore.setItem("consent",JSON.stringify(EM))},setOfAge:function(e){EM.ofAge=e,ga("send","event","privacy","of age",e?"yes":"no"),e||(EM.targetedAds=!1,googletag.consented=!1),localStore.setItem("consent",JSON.stringify(EM))},setTargetedAds:function(e){EM.targetedAds=e,googletag.consented=e,ga("send","event","privacy","targetedAds",e?"yes":"no"),localStore.setItem("consent",JSON.stringify(EM))},settingsMenuOpened:function(){bM&&1==IM.enableChat&&ww()},copyFriendCode:function(e){!function(){const e=vueData.gameTypes.find((({value:e})=>e===JN)),t=vueData.googleAnalytics;JD([[t.cat.play,t.action.shareGameCopy,`Map - ${jb.name}`,""],[t.cat.play,t.action.shareGameCopy,e.locKey?`Game type - ${e.locKey}`:"n/a",""],[t.cat.play,t.action.shareGameCopy,`Play type - ${hM}`,""]])}();try{navigator.clipboard.writeText(e)}catch(e){console.log("Unable to copy to clipboard")}},switchTeam:function(){if(sI){console.log("Team switch requested");var e=Tc.getBuffer();e.BkMzMvJt(nc.U),e.send(uO)}},onChatKeyDown:function(e){var t=(e=e||window.event).key;switch(rM.value=RD(rM.value,280),t){case"Enter":var i=rM.value.trim();if(""!=i&&i.indexOf("<")<0){Dw(i);var n=function(e){if(!e.startsWith("/"))return ac.none;let t=e.slice(1).split(" ");switch(t[0].toLowerCase()){case"t":case"team":return t[1]?MO?ac.team:ac.none:null;case"p":case"pin":return fM?ac.pinned:ac.none;default:return ac.none}}(i);n!=ac.none&&(i=function(e){let t=e.split(" ");return e.slice(t[0].length+1)}(i)),LM||Ow(i,n,RO),xc.adminRoles||fM||(CO.chatLines++,CO.chatLines>2&&(rM.style.visibility="hidden")),1===++Eb&&ga("send","event","game","stats","chat",Eb)}case"Tab":e.preventDefault(),e.stopPropagation(),Fw()}},startChat:Lw,stopChat:Fw,selectGameType:function(e){JN=e,localStore.setItem("gameType",e)},inviteFriends:Ww,hasHouseLink:function(e){return e.link||e.linksToTaggedItems||e.linksToItemId||e.linksToPass||e.linksToPhotoBooth},enterSpectatorMode:function(){jP||(jP=!0,setTimeout((()=>jP=!1),1e3),ub<0&&(wb=!1,kb=!0,Bb=KL.freeCamera,vueApp.setPause(!1),vueApp.setInGame(kb),gb.freeCamera(),yP(),CP(),CO.Qk=Math.radRange(jN.rotation.y),CO.Dk=-jN.rotation.x,Sb=SD.set((function(){var e=Tc.getBuffer();e.BkMzMvJt(nc.bt),e.send(CO.ws)}),15e3),rw()))},fixStringWidth:RD,filterUnicode:ND,clickedWebFeedItem:function(e){function t(e){ga("send","event","newsItem","clicked",e)}if("linksToItemId"in e){let i=xc.catalog.findItemById(parseInt(e.linksToItemId,10));return vueApp.showItemOnEquipScreen(i),void t(`item=${i.name}`)}return"linksToTaggedItems"in e?(qM=1==e.linksToTaggedItems?iI.specialItemsTag:e.linksToTaggedItems,_I=!0,WO(),void t(`tagged=${e.linksToTaggedItems}`)):"linksToChangeLog"in e?(vueApp.showChangelogPopup(),void t("sschangelog")):"link"in e?(window.open(e.link,"_window"),void t(e.link)):"linksToPhotoBooth"in e?(FD(),void t("openPhotoBooth")):("linksToPass"in e&&(XO(),t("pass")),"linksToEggStoreItem"in e?(vueApp.showPopupEggStoreSingle(e.linksToEggStoreItem),void t(`skuItem=${e.linksToEggStoreItem}`)):void("linksToVipStore"in e&&(vueApp.showSubStorePopup(),t(`skuItem=${e.linksToVipStore}`))))},pokiRewardedBreak:(e,t)=>{pokiActive&&(VL(0),PokiSDK.rewardedBreak().then((()=>{IL(),e&&e(hc.video),VL(),console.log("POKI Reward given")})).catch((e=>{console.log("Reward failed. ",e),t&&t(),VL()})))},api_inGameReward:function(e,t,i){const n={cmd:"inGameReward",firebaseId:xc.playerAccount.firebaseId};vueApp.showSpinner(),ib(n,(n=>{switch(console.log("In Game reward response: "+n.result),vueApp.hideSpinner(),n.result){case"SUCCESS":case"SUCCESS_FIRST":e();break;case"REACHED_DAILY_LIMIT":i();break;case"ERROR":t()}}),t)},socialReward:function(e){const t=e+"Rewarded";if(DI[t]>=1)return void localStore.setItem(t,!0);DI[t]++,vueApp.showSpinner();const i={};i.tag=hc[e],function(e,t,i,n){ib({cmd:"reward",firebaseId:xc.playerAccount.firebaseId,rewardTag:e.tag},t,i)}(i,(function(e){vueApp.hideSpinner();PD(e,{name:"Social media reward",success(){localStore.setItem(t,!0)},prevGiven(){this.success()},expired(){this.succces()},notFound(){localStore.setItem(t,!1)},playerNotFound(){localStore.getItem(t)&&localStore.removeItem(t)},error(){this.playerNotFound()},default(){this.playerNotFound()}})}),(function(e){console.log("servicesWs Error: "+JSON.stringify(e,["message","arguments","type","name"])),vueApp.showGenericPopup("uh_oh","generic_conn_failed","ok"),vueApp.hideSpinner()}))},getHouseAd:e=>{if(!iI.length)return;const t=iI[e].filter((e=>e.active));if(!t.length)return;const i=[],n=t.filter((e=>e.label.includes("VIP"))).length;let a=Math.round(.5*t.length/n);isFinite(a)||(a=1);const s=t.map((e=>{const t=e.label.toUpperCase();return e.priority=1,t.includes("VIP")&&(e.priority=a),e}));for(let e=0;e<s.length;++e)for(let t=0;t<s[e].priority;++t)i.push(s[e]);return i[Math.floor(Math.random()*i.length)]},getLocText:ZO,GameType:rc,resize:tD,giveBasketBrosReward:function(){var e,t,i,n;e=16039,t="giveBasketBrosReward",xc.playerAccount.isItemOwned({id:e})?console.log(t,"already owned!!!"):rb(t,(e=>{PD(e,{name:t,success:()=>(i&&i(),!0),error:()=>(n&&n(),!1)},t)}),(e=>{console.log(t," error",e)}))},resetPaperDoll:cO,getSessionStats:LD,getProductTitle:function(e,t){return hI.getProductByItemIds(["bundles","passes"][t],e)},chwTryPlay:function(){dI.count<=dc.dailyLimit&&dI.ready?(yI.isChwRequest=!0,vueApp.chicknWinnerError(!1),0===dI.count?(Kx("chwTryPlay() First play!"),Qx()):ab((()=>{xc.playerAccount.isUpgraded()?(Kx("chwTryPlay() VIP. No ads for you! Thank you!"),Qx()):(Kx("chwTryPlay() No vip. Subscribe today for no video ads!"),yI.adInPlayActive||window.crazySdk.initialized?yI.play("shellshock.io_rpreroll_30s"):(vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok"),Zx("chwTryPlay()","No video ads!")))}),(e=>{yI.isChwRequest=!1,Zx("chwTryPlay()",e)}))):(Kx("checkStartChicknWinner not ready"),Jx())},api_incentivizedVideoRewardRequest:sb,getProductTitleByEggVaule:function(e){return hI.getProductTitleByEggVaule(e)},accountCreationNotification:GO,sendChat:Dw,getActiveBundles:function(){return hI.getBundles()},requestJson:function(e,t){getRequest(e+"?"+Date.now(),((e,i)=>{let n=[];if(404===e)console.log("Accept it and move on.");else try{const e=JSON.parse(i);e.length>0&&e.forEach((e=>n.push(e)))}catch(e){console.log("News request error: ",e)}t(n)}))},sendGameOptions:vD,sendGameOptionsMetrics:function(){Object.keys(rx.value).forEach((e=>{switch(e){case"flags":Object.keys(ox).forEach((e=>{let t=rx.value.flags&ox[e]?1:0;ga("send","event","game settings","flags",e,t)}));break;case"weaponDisabled":for(let e=0;e<xc.classes.length;e++){if(rx.value.weaponDisabled[e]){let t=xc.classes[e].name;ga("send","event","game settings","weapon disabled",t)}}break;default:let t=rx.value[e];ga("send","event","game settings","setting",e,t)}}))},sendGameAction:function(e){let t=Tc.getBuffer();t.BkMzMvJt(nc.j),t.BkMzMvJt(e),t.send(uO);let i=Object.keys(lx).find((t=>lx[t]===e));ga("send","event","game settings","action",i)},GameOptions:rx,GameActions:lx,GameFlags:ox,chwResetWithEggs:function(){ib({cmd:"chwReset"},(e=>{const t=e.result;console.log("chwResetWithEggs: ",t),"SUCCESS"===t&&(Jx(),vueApp.chwHomeForceReset(),BAWK.play("ui_playconfirm")),nb()}),(e=>{console.error("chwResetWithEggs error: ",e.error)}))},prepRespawnButton:AP,onChromeIsABuggerPopupConfirm:Jw,loadAllMeshesOnDemand:async function(){if(OI)return!0;if(await wO())return vueApp.hideSpinner(),!0},apiEggOrgSwitchFaction:()=>{ib({cmd:"eggOrgSwitchFaction",sessionId:xc.playerAccount.sessionId},(e=>{xc.playerAccount.factionChanged(e.newItemId),setTimeout((()=>{ab()}),500)}),(e=>{console.log("apiEggOrgSwitchFaction error",e)}))},get metaGame(){return dO},get ShellNews(){return RI},set gameIsOwnerLocked(e){e},get metaGameUI(){return mO},get isPrivateGame(){return cM},get observingGame(){return LM},get isGameOwner(){return fM},get adminRoles(){return xc.adminRoles},get photoBooth(){return pM},get isGameReady(){return OO()},get inGame(){return bM},get gamePaused(){return sI},get gameType(){return JN},get specialItemsTag(){return iI.specialItemsTag},get getPwaEvent(){return""},get account(){return xc.playerAccount},get productBlockAds(){return xc.productBlockAds},get adBlocker(){return xM},get version(){return SM},get changelogData(){return VI},get onJoinGameClick(){return pI},get adsLoaded(){return HI},get openShopOnly(){return _I},set openShopOnly(e){_I=e},set onJoinGameClick(e){pI=e},get fuseOptions(){return UI},get Challenges(){return XI},get gameOptions(){return _M},set gameOptions(e){_M=e},get playerChallenges(){return CI},get getIsWelcomeBundlePurchased(){return II},get getWelcomePassSku(){return xI},get LoadingTips(){return jI},get LoadingTipsNew(){return KI},get LoadingMsgs(){return $I},get firebaseUrl(){return wI},testGameUI:function(){vueApp.hideGameMenu(),document.getElementById("deathBox").style.display="none",document.getElementById("weaponBox").style.display="block",document.getElementById("healthContainer").style.display="block",document.getElementById("killTicker").style.display="block",vb&&rM.focus(),YP(),Db.show(),document.getElementById("gameAdContainer").style.display="none"}}})();